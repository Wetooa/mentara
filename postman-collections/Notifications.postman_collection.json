{
  "info": {
    "name": "Mentara - Notifications",
    "description": "Notifications module endpoints for user notifications, push notifications, email notifications, and notification preferences management.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "mentara-notifications"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Set Bearer token for authenticated requests",
          "if (pm.environment.get('accessToken') && !pm.request.headers.has('Authorization')) {",
          "    pm.request.headers.add({",
          "        key: 'Authorization',",
          "        value: 'Bearer ' + pm.environment.get('accessToken')",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global error handling for all requests",
          "pm.test('Response time is acceptable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(3000);",
          "});",
          "",
          "// Auto-handle Zod validation errors",
          "if (pm.response.code === 400) {",
          "    try {",
          "        const responseJson = pm.response.json();",
          "        if (responseJson.issues && Array.isArray(responseJson.issues)) {",
          "            responseJson.issues.forEach(issue => {",
          "                console.error('❌ Validation Error: ' + issue.message + ' (' + issue.path.join('.') + ');',
          "            });"",
          "        }",
          "    } catch (e) {",
          "        console.error('❌ Failed to parse validation error response');",
          "    }",
          "}"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001/api",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "User Notifications",
      "item": [
        {
          "name": "Get User Notifications",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Notifications retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has notifications array', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('notifications');",
                  "    pm.expect(responseJson.notifications).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications?status=unread&type=all&page=1&limit=20&sortBy=createdAt&sortOrder=desc",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"],
              "query": [
                {
                  "key": "status",
                  "value": "unread"
                },
                {
                  "key": "type",
                  "value": "all"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "sortBy",
                  "value": "createdAt"
                },
                {
                  "key": "sortOrder",
                  "value": "desc"
                }
              ]
            },
            "description": "Get user notifications with filtering"
          },
          "response": []
        },
        {
          "name": "Get Notification by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}"]
            },
            "description": "Get specific notification details"
          },
          "response": []
        },
        {
          "name": "Mark Notification as Read",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Notification marked as read', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Read timestamp updated', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('readAt');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"readAt\": \"{{$isoTimestamp}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}/read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}", "read"]
            },
            "description": "Mark notification as read"
          },
          "response": []
        },
        {
          "name": "Mark All as Read",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"readAt\": \"{{$isoTimestamp}}\",\n  \"type\": \"all\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/read-all",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "read-all"]
            },
            "description": "Mark all notifications as read"
          },
          "response": []
        },
        {
          "name": "Delete Notification",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}"]
            },
            "description": "Delete a notification"
          },
          "response": []
        },
        {
          "name": "Get Notification Count",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/count?status=unread",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "count"],
              "query": [
                {
                  "key": "status",
                  "value": "unread"
                }
              ]
            },
            "description": "Get unread notification count"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Push Notifications",
      "item": [
        {
          "name": "Register Device",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Device registered successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has device ID', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('deviceId');",
                  "    pm.environment.set('deviceId', responseJson.deviceId);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"deviceToken\": \"fcm_token_12345\",\n  \"platform\": \"ios\",\n  \"appVersion\": \"1.2.3\",\n  \"osVersion\": \"17.1\",\n  \"deviceModel\": \"iPhone 14\",\n  \"timeZone\": \"America/New_York\",\n  \"locale\": \"en-US\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/devices",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "devices"]
            },
            "description": "Register device for push notifications"
          },
          "response": []
        },
        {
          "name": "Update Device Token",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"deviceToken\": \"fcm_token_67890\",\n  \"appVersion\": \"1.2.4\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/devices/{{deviceId}}",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "devices", "{{deviceId}}"]
            },
            "description": "Update device token"
          },
          "response": []
        },
        {
          "name": "Send Test Push",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Test Notification\",\n  \"body\": \"This is a test push notification\",\n  \"data\": {\n    \"type\": \"test\",\n    \"timestamp\": \"{{$isoTimestamp}}\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/push/test",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "push", "test"]
            },
            "description": "Send test push notification"
          },
          "response": []
        },
        {
          "name": "Get User Devices",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/devices",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "devices"]
            },
            "description": "Get user's registered devices"
          },
          "response": []
        },
        {
          "name": "Unregister Device",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/devices/{{deviceId}}",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "devices", "{{deviceId}}"]
            },
            "description": "Unregister device"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Notification Preferences",
      "item": [
        {
          "name": "Get Preferences",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/preferences",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "preferences"]
            },
            "description": "Get user notification preferences"
          },
          "response": []
        },
        {
          "name": "Update Preferences",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Preferences updated successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Updated preferences returned', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('preferences');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"preferences\": {\n    \"push\": {\n      \"sessionReminders\": true,\n      \"worksheetReminders\": true,\n      \"messages\": true,\n      \"communityActivity\": false,\n      \"systemUpdates\": true,\n      \"marketingCommunications\": false\n    },\n    \"email\": {\n      \"sessionReminders\": true,\n      \"worksheetReminders\": false,\n      \"messages\": false,\n      \"communityActivity\": false,\n      \"systemUpdates\": true,\n      \"marketingCommunications\": false,\n      \"weeklyDigest\": true\n    },\n    \"sms\": {\n      \"sessionReminders\": true,\n      \"worksheetReminders\": false,\n      \"messages\": false,\n      \"emergencyAlerts\": true\n    },\n    \"timing\": {\n      \"quietHoursStart\": \"22:00\",\n      \"quietHoursEnd\": \"08:00\",\n      \"timeZone\": \"America/New_York\",\n      \"weekendNotifications\": true\n    },\n    \"frequency\": {\n      \"communityDigest\": \"weekly\",\n      \"progressReports\": \"monthly\",\n      \"reminderInterval\": \"daily\"\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/preferences",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "preferences"]
            },
            "description": "Update notification preferences"
          },
          "response": []
        },
        {
          "name": "Reset Preferences",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"resetToDefaults\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/preferences/reset",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "preferences", "reset"]
            },
            "description": "Reset preferences to defaults"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Notification Templates",
      "item": [
        {
          "name": "Get Templates",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/templates?type=all&category=therapy",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "templates"],
              "query": [
                {
                  "key": "type",
                  "value": "all"
                },
                {
                  "key": "category",
                  "value": "therapy"
                }
              ]
            },
            "description": "Get notification templates (admin only)"
          },
          "response": []
        },
        {
          "name": "Create Template",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"session_reminder_24h\",\n  \"title\": \"Session Reminder - 24 Hours\",\n  \"category\": \"therapy\",\n  \"type\": \"session_reminder\",\n  \"channels\": [\"push\", \"email\"],\n  \"templates\": {\n    \"push\": {\n      \"title\": \"Session Tomorrow\",\n      \"body\": \"Don't forget about your therapy session with {{therapist_name}} tomorrow at {{session_time}}\",\n      \"actions\": [\n        {\n          \"id\": \"view_session\",\n          \"title\": \"View Details\",\n          \"action\": \"open_session\"\n        },\n        {\n          \"id\": \"reschedule\",\n          \"title\": \"Reschedule\",\n          \"action\": \"reschedule_session\"\n        }\n      ]\n    },\n    \"email\": {\n      \"subject\": \"Session Reminder: Tomorrow at {{session_time}}\",\n      \"htmlBody\": \"<p>Hi {{client_name}},</p><p>This is a friendly reminder about your therapy session with {{therapist_name}} tomorrow at {{session_time}}.</p><p>Session Details:</p><ul><li>Date: {{session_date}}</li><li>Time: {{session_time}}</li><li>Type: {{session_type}}</li></ul><p>If you need to reschedule, please contact us at least 24 hours in advance.</p><p>Best regards,<br>The Mentara Team</p>\",\n      \"textBody\": \"Hi {{client_name}},\\n\\nThis is a friendly reminder about your therapy session with {{therapist_name}} tomorrow at {{session_time}}.\\n\\nSession Details:\\n- Date: {{session_date}}\\n- Time: {{session_time}}\\n- Type: {{session_type}}\\n\\nIf you need to reschedule, please contact us at least 24 hours in advance.\\n\\nBest regards,\\nThe Mentara Team\"\n    }\n  },\n  \"variables\": [\n    \"client_name\",\n    \"therapist_name\",\n    \"session_date\",\n    \"session_time\",\n    \"session_type\"\n  ],\n  \"triggers\": {\n    \"scheduledTime\": \"24_hours_before\",\n    \"conditions\": [\n      {\n        \"field\": \"session_status\",\n        \"operator\": \"equals\",\n        \"value\": \"scheduled\"\n      }\n    ]\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/templates",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "templates"]
            },
            "description": "Create notification template (admin only)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Notification History",
      "item": [
        {
          "name": "Get Sent Notifications",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/history?type=all&status=sent&page=1&limit=20&sortBy=sentAt&sortOrder=desc",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "history"],
              "query": [
                {
                  "key": "type",
                  "value": "all"
                },
                {
                  "key": "status",
                  "value": "sent"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "sortBy",
                  "value": "sentAt"
                },
                {
                  "key": "sortOrder",
                  "value": "desc"
                }
              ]
            },
            "description": "Get notification history"
          },
          "response": []
        },
        {
          "name": "Get Delivery Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}/delivery-status",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}", "delivery-status"]
            },
            "description": "Get notification delivery status"
          },
          "response": []
        },
        {
          "name": "Get Analytics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/notifications/analytics?period=month&groupBy=type&includeEngagement=true",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "analytics"],
              "query": [
                {
                  "key": "period",
                  "value": "month"
                },
                {
                  "key": "groupBy",
                  "value": "type"
                },
                {
                  "key": "includeEngagement",
                  "value": "true"
                }
              ]
            },
            "description": "Get notification analytics (admin only)"
          },
          "response": []
        }
      ]
    }
  ]
}