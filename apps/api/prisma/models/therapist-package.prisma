// Therapist Package and Subscription Models

model TherapistPackage {
  id              String             @id @default(uuid())
  therapistId     String
  title           String
  description     String
  sessionCount    Int
  price           Decimal            @db.Decimal(10, 2)
  validityDays    Int
  features        Json               @default("[]")
  isApproved      Boolean            @default(false)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  therapist       Therapist          @relation(fields: [therapistId], references: [userId], onDelete: Cascade)
  subscriptions   UserSubscription[]

  @@index([therapistId])
  @@index([isApproved])
}

model UserSubscription {
  id                String             @id @default(uuid())
  userId            String
  packageId         String
  status            SubscriptionStatus @default(ACTIVE)
  sessionsRemaining Int
  purchasedAt       DateTime           @default(now())
  expiresAt         DateTime
  updatedAt         DateTime           @updatedAt
  user              User               @relation("UserSubscriptions", fields: [userId], references: [id], onDelete: Cascade)
  package           TherapistPackage   @relation(fields: [packageId], references: [id], onDelete: Cascade)
  sessionLogs       SessionLog[]

  @@index([userId])
  @@index([packageId])
  @@index([status])
}

model SessionLog {
  id             String           @id @default(uuid())
  subscriptionId String
  appointmentId  String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  subscription   UserSubscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  appointment    Meeting          @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([appointmentId])
}

enum SubscriptionStatus {
  ACTIVE
  FULLY_USED
  EXPIRED
}
