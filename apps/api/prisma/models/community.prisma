model Community {
  id                   String                @id @default(uuid())
  name                 String                @unique
  slug                 String                @unique
  description          String
  imageUrl             String
  category             String                @default("mental-health")
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  memberships          Membership[]
  moderatorCommunities ModeratorCommunity[]
  roomGroups           RoomGroup[]
  groupSessions        GroupTherapySession[]
  tags                 CommunityToTag[]

  @@index([name])
  @@index([slug])
  @@index([createdAt])
  @@index([updatedAt])
}

model CommunityTag {
  id          String           @id @default(uuid())
  name        String           @unique // Display name (e.g., "Anxiety")
  slug        String           @unique // Canonical ID (e.g., "anxiety")
  communities CommunityToTag[]

  @@index([name])
  @@index([slug])
}

model CommunityToTag {
  communityId String
  tagId       String
  community   Community    @relation(fields: [communityId], references: [id], onDelete: Cascade)
  tag         CommunityTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([communityId, tagId])
  @@index([communityId])
  @@index([tagId])
}

model Membership {
// ... existing models follow
  id          String    @id @default(uuid())
  joinedAt    DateTime  @default(now())
  communityId String
  userId      String
  community   Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, communityId])
  @@index([userId])
  @@index([communityId])
}

model ModeratorCommunity {
  id          String    @id @default(uuid())
  moderatorId String
  communityId String
  assignedAt  DateTime  @default(now())
  community   Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  moderator   Moderator @relation(fields: [moderatorId], references: [userId], onDelete: Cascade)

  @@unique([moderatorId, communityId])
  @@index([moderatorId])
  @@index([communityId])
}

model RoomGroup {
  id          String    @id @default(uuid())
  name        String
  order       Int
  communityId String
  rooms       Room[]
  community   Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
}

model Room {
  id          String    @id @default(uuid())
  name        String
  order       Int
  postingRole String    @default("member")
  roomGroupId String
  posts       Post[]
  roomGroup   RoomGroup @relation(fields: [roomGroupId], references: [id], onDelete: Cascade)
}
