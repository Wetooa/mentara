{
  "info": {
    "name": "Mentara - Audit Logs",
    "description": "Audit Logs module endpoints for system audit trails, security logging, compliance tracking, and administrative monitoring.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "mentara-audit-logs"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Set Bearer token for authenticated requests",
          "if (pm.environment.get('accessToken') && !pm.request.headers.has('Authorization')) {",
          "    pm.request.headers.add({",
          "        key: 'Authorization',",
          "        value: 'Bearer ' + pm.environment.get('accessToken')",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global error handling for all requests",
          "pm.test('Response time is acceptable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(3000);",
          "});",
          "",
          "// Auto-handle Zod validation errors",
          "if (pm.response.code === 400) {",
          "    try {",
          "        const responseJson = pm.response.json();",
          "        if (responseJson.issues && Array.isArray(responseJson.issues)) {",
          "            responseJson.issues.forEach(issue => {",
          "                console.error('❌ Validation Error: ' + issue.message + ' (' + issue.path.join('.') + ');',
          "            });"",
          "        }",
          "    } catch (e) {",
          "        console.error('❌ Failed to parse validation error response');",
          "    }",
          "}"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001/api",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Audit Log Management",
      "item": [
        {
          "name": "Get Audit Logs",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Audit logs retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has logs array', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('logs');",
                  "    pm.expect(responseJson.logs).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs?action=user_login&userId={{userId}}&startDate=2024-01-01&endDate=2024-01-31&page=1&limit=50",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs"],
              "query": [
                {
                  "key": "action",
                  "value": "user_login"
                },
                {
                  "key": "userId",
                  "value": "{{userId}}"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                },
                {
                  "key": "endDate",
                  "value": "2024-01-31"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "50"
                }
              ]
            },
            "description": "Get audit logs with filtering (admin only)"
          },
          "response": []
        },
        {
          "name": "Get Audit Log by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/{{auditLogId}}",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "{{auditLogId}}"]
            },
            "description": "Get specific audit log details"
          },
          "response": []
        },
        {
          "name": "Create Manual Audit Log",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Manual audit log created successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has log ID', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('id');",
                  "    pm.environment.set('auditLogId', responseJson.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"manual_account_adjustment\",\n  \"resource\": \"user_account\",\n  \"resourceId\": \"{{userId}}\",\n  \"details\": {\n    \"reason\": \"Customer support request\",\n    \"ticketId\": \"SUP-12345\",\n    \"adjustmentType\": \"subscription_renewal\",\n    \"previousValue\": \"expired\",\n    \"newValue\": \"active\",\n    \"approvedBy\": \"admin@mentara.com\"\n  },\n  \"ipAddress\": \"192.168.1.100\",\n  \"userAgent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\",\n  \"severity\": \"medium\",\n  \"category\": \"account_management\",\n  \"tags\": [\"customer_support\", \"subscription\", \"manual_adjustment\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/audit-logs",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs"]
            },
            "description": "Create manual audit log entry (admin only)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Security Logs",
      "item": [
        {
          "name": "Get Security Events",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Security events retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Security events have required fields', function () {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.events && responseJson.events.length > 0) {",
                  "        const event = responseJson.events[0];",
                  "        pm.expect(event).to.have.property('action');",
                  "        pm.expect(event).to.have.property('severity');",
                  "        pm.expect(event).to.have.property('timestamp');",
                  "        pm.expect(event).to.have.property('ipAddress');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/security?severity=high&action=failed_login&startDate=2024-01-01&limit=100",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "security"],
              "query": [
                {
                  "key": "severity",
                  "value": "high"
                },
                {
                  "key": "action",
                  "value": "failed_login"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                },
                {
                  "key": "limit",
                  "value": "100"
                }
              ]
            },
            "description": "Get security-related audit logs"
          },
          "response": []
        },
        {
          "name": "Get Failed Login Attempts",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/security/failed-logins?userId={{userId}}&ipAddress=192.168.1.100&timeframe=24h",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "security", "failed-logins"],
              "query": [
                {
                  "key": "userId",
                  "value": "{{userId}}"
                },
                {
                  "key": "ipAddress",
                  "value": "192.168.1.100"
                },
                {
                  "key": "timeframe",
                  "value": "24h"
                }
              ]
            },
            "description": "Get failed login attempts"
          },
          "response": []
        },
        {
          "name": "Get Suspicious Activity",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/security/suspicious?severity=high&resolved=false&limit=50",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "security", "suspicious"],
              "query": [
                {
                  "key": "severity",
                  "value": "high"
                },
                {
                  "key": "resolved",
                  "value": "false"
                },
                {
                  "key": "limit",
                  "value": "50"
                }
              ]
            },
            "description": "Get suspicious activity alerts"
          },
          "response": []
        },
        {
          "name": "Mark Security Event as Resolved",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"resolved\",\n  \"resolution\": \"False positive - user was using VPN\",\n  \"resolvedBy\": \"security@mentara.com\",\n  \"actionTaken\": \"no_action_required\",\n  \"notes\": \"User confirmed legitimate activity from different geographic location\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/audit-logs/security/{{auditLogId}}/resolve",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "security", "{{auditLogId}}", "resolve"]
            },
            "description": "Mark security event as resolved"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Compliance Logs",
      "item": [
        {
          "name": "Get HIPAA Compliance Logs",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('HIPAA compliance logs retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Compliance logs have required fields', function () {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.logs && responseJson.logs.length > 0) {",
                  "        const log = responseJson.logs[0];",
                  "        pm.expect(log).to.have.property('action');",
                  "        pm.expect(log).to.have.property('patientId');",
                  "        pm.expect(log).to.have.property('complianceType');",
                  "        pm.expect(log).to.have.property('timestamp');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/compliance/hipaa?patientId={{clientId}}&action=data_access&startDate=2024-01-01&endDate=2024-01-31",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "compliance", "hipaa"],
              "query": [
                {
                  "key": "patientId",
                  "value": "{{clientId}}"
                },
                {
                  "key": "action",
                  "value": "data_access"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                },
                {
                  "key": "endDate",
                  "value": "2024-01-31"
                }
              ]
            },
            "description": "Get HIPAA compliance audit logs"
          },
          "response": []
        },
        {
          "name": "Get Data Access Logs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/compliance/data-access?resourceType=session_notes&resourceId={{sessionId}}&accessedBy={{therapistId}}",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "compliance", "data-access"],
              "query": [
                {
                  "key": "resourceType",
                  "value": "session_notes"
                },
                {
                  "key": "resourceId",
                  "value": "{{sessionId}}"
                },
                {
                  "key": "accessedBy",
                  "value": "{{therapistId}}"
                }
              ]
            },
            "description": "Get data access audit logs"
          },
          "response": []
        },
        {
          "name": "Get Data Export Logs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/compliance/data-export?exportType=patient_data&requestedBy={{therapistId}}&startDate=2024-01-01",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "compliance", "data-export"],
              "query": [
                {
                  "key": "exportType",
                  "value": "patient_data"
                },
                {
                  "key": "requestedBy",
                  "value": "{{therapistId}}"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                }
              ]
            },
            "description": "Get data export audit logs"
          },
          "response": []
        },
        {
          "name": "Get Consent Changes",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/compliance/consent-changes?userId={{clientId}}&consentType=data_sharing&startDate=2024-01-01",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "compliance", "consent-changes"],
              "query": [
                {
                  "key": "userId",
                  "value": "{{clientId}}"
                },
                {
                  "key": "consentType",
                  "value": "data_sharing"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                }
              ]
            },
            "description": "Get consent change audit logs"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Administrative Logs",
      "item": [
        {
          "name": "Get Admin Actions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Admin actions retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Admin actions have required fields', function () {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.actions && responseJson.actions.length > 0) {",
                  "        const action = responseJson.actions[0];",
                  "        pm.expect(action).to.have.property('action');",
                  "        pm.expect(action).to.have.property('performedBy');",
                  "        pm.expect(action).to.have.property('timestamp');",
                  "        pm.expect(action).to.have.property('details');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/admin/actions?performedBy={{adminId}}&action=user_suspension&startDate=2024-01-01&limit=100",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "admin", "actions"],
              "query": [
                {
                  "key": "performedBy",
                  "value": "{{adminId}}"
                },
                {
                  "key": "action",
                  "value": "user_suspension"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                },
                {
                  "key": "limit",
                  "value": "100"
                }
              ]
            },
            "description": "Get administrative actions audit logs"
          },
          "response": []
        },
        {
          "name": "Get Permission Changes",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/admin/permission-changes?targetUserId={{userId}}&changedBy={{adminId}}&startDate=2024-01-01",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "admin", "permission-changes"],
              "query": [
                {
                  "key": "targetUserId",
                  "value": "{{userId}}"
                },
                {
                  "key": "changedBy",
                  "value": "{{adminId}}"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                }
              ]
            },
            "description": "Get permission change audit logs"
          },
          "response": []
        },
        {
          "name": "Get System Configuration Changes",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/admin/config-changes?configType=security_settings&changedBy={{adminId}}&startDate=2024-01-01",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "admin", "config-changes"],
              "query": [
                {
                  "key": "configType",
                  "value": "security_settings"
                },
                {
                  "key": "changedBy",
                  "value": "{{adminId}}"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01"
                }
              ]
            },
            "description": "Get system configuration change logs"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Audit Reports",
      "item": [
        {
          "name": "Generate Audit Report",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Audit report generated successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Report has ID and download URL', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('reportId');",
                  "    pm.expect(responseJson).to.have.property('downloadUrl');",
                  "    pm.environment.set('auditReportId', responseJson.reportId);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Monthly Security Audit Report\",\n  \"description\": \"Comprehensive security audit report for January 2024\",\n  \"reportType\": \"security_audit\",\n  \"dateRange\": {\n    \"startDate\": \"2024-01-01\",\n    \"endDate\": \"2024-01-31\"\n  },\n  \"includeCategories\": [\n    \"security_events\",\n    \"failed_logins\",\n    \"data_access\",\n    \"admin_actions\",\n    \"permission_changes\"\n  ],\n  \"filters\": {\n    \"severity\": [\"high\", \"critical\"],\n    \"resolved\": \"all\"\n  },\n  \"format\": \"pdf\",\n  \"includeCharts\": true,\n  \"includeSummary\": true,\n  \"groupBy\": \"category\",\n  \"sortBy\": \"timestamp\",\n  \"sortOrder\": \"desc\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/audit-logs/reports/generate",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "reports", "generate"]
            },
            "description": "Generate comprehensive audit report"
          },
          "response": []
        },
        {
          "name": "Get Audit Report Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/reports/{{auditReportId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "reports", "{{auditReportId}}", "status"]
            },
            "description": "Get audit report generation status"
          },
          "response": []
        },
        {
          "name": "Download Audit Report",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/reports/{{auditReportId}}/download",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "reports", "{{auditReportId}}", "download"]
            },
            "description": "Download generated audit report"
          },
          "response": []
        },
        {
          "name": "Get Scheduled Reports",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/reports/scheduled?status=active&type=security_audit",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "reports", "scheduled"],
              "query": [
                {
                  "key": "status",
                  "value": "active"
                },
                {
                  "key": "type",
                  "value": "security_audit"
                }
              ]
            },
            "description": "Get scheduled audit reports"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Audit Analytics",
      "item": [
        {
          "name": "Get Audit Summary",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/analytics/summary?period=month&includeComparison=true",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "analytics", "summary"],
              "query": [
                {
                  "key": "period",
                  "value": "month"
                },
                {
                  "key": "includeComparison",
                  "value": "true"
                }
              ]
            },
            "description": "Get audit log summary analytics"
          },
          "response": []
        },
        {
          "name": "Get Security Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/analytics/security-metrics?period=week&includeAlerts=true",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "analytics", "security-metrics"],
              "query": [
                {
                  "key": "period",
                  "value": "week"
                },
                {
                  "key": "includeAlerts",
                  "value": "true"
                }
              ]
            },
            "description": "Get security-related audit metrics"
          },
          "response": []
        },
        {
          "name": "Get Compliance Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit-logs/analytics/compliance-metrics?period=month&standard=hipaa",
              "host": ["{{baseUrl}}"],
              "path": ["audit-logs", "analytics", "compliance-metrics"],
              "query": [
                {
                  "key": "period",
                  "value": "month"
                },
                {
                  "key": "standard",
                  "value": "hipaa"
                }
              ]
            },
            "description": "Get compliance-related audit metrics"
          },
          "response": []
        }
      ]
    }
  ]
}