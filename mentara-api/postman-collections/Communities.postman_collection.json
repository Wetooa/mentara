{
  "info": {
    "name": "Mentara - Communities",
    "description": "Communities module endpoints for support group management, community discovery, member management, and community recommendations.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "mentara-communities"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Set Bearer token for authenticated requests",
          "if (pm.environment.get('accessToken') && !pm.request.headers.has('Authorization')) {",
          "    pm.request.headers.add({",
          "        key: 'Authorization',",
          "        value: 'Bearer ' + pm.environment.get('accessToken')",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global error handling for all requests",
          "pm.test('Response time is acceptable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(3000);",
          "});",
          "",
          "// Auto-handle Zod validation errors",
          "if (pm.response.code === 400) {",
          "    try {",
          "        const responseJson = pm.response.json();",
          "        if (responseJson.issues && Array.isArray(responseJson.issues)) {",
          "            responseJson.issues.forEach(issue => {",
          "                console.error('\u274C Validation Error: ' + issue.message + ' (' + issue.path.join('.') + ')');",
          "            });",
          "        }",
          "    } catch (e) {",
          "        console.error('\u274C Failed to parse validation error response');",
          "    }",
          "}"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001/api",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Community Management",
      "item": [
        {
          "name": "Create Community",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Community created successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has community ID', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('id');",
                  "    pm.environment.set('communityId', responseJson.id);",
                  "});",
                  "",
                  "pm.test('Community has required fields', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('name');",
                  "    pm.expect(responseJson).to.have.property('description');",
                  "    pm.expect(responseJson).to.have.property('category');",
                  "    pm.expect(responseJson).to.have.property('memberCount');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Anxiety Support Group\",\n  \"description\": \"A safe space for people dealing with anxiety to share experiences, coping strategies, and support each other on their mental health journey.\",\n  \"category\": \"mental_health\",\n  \"type\": \"support_group\",\n  \"isPrivate\": false,\n  \"maxMembers\": 100,\n  \"rules\": [\n    \"Be respectful and supportive\",\n    \"No medical advice - only personal experiences\",\n    \"Maintain confidentiality\",\n    \"Report inappropriate behavior\"\n  ],\n  \"tags\": [\"anxiety\", \"support\", \"mental-health\", \"coping-strategies\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities",
              "host": ["{{baseUrl}}"],
              "path": ["communities"]
            },
            "description": "Create a new support community"
          },
          "response": []
        },
        {
          "name": "Get All Communities",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Communities retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has communities array', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('communities');",
                  "    pm.expect(responseJson.communities).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Pagination info included', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('pagination');",
                  "    pm.expect(responseJson.pagination).to.have.property('page');",
                  "    pm.expect(responseJson.pagination).to.have.property('totalPages');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities?page=1&limit=20&category=mental_health&sort=popular",
              "host": ["{{baseUrl}}"],
              "path": ["communities"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "category",
                  "value": "mental_health"
                },
                {
                  "key": "sort",
                  "value": "popular"
                }
              ]
            },
            "description": "Get all communities with filtering and pagination"
          },
          "response": []
        },
        {
          "name": "Get Community by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}"]
            },
            "description": "Get detailed information about a specific community"
          },
          "response": []
        },
        {
          "name": "Update Community",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Anxiety & Depression Support Group\",\n  \"description\": \"A safe space for people dealing with anxiety and depression to share experiences, coping strategies, and support each other on their mental health journey.\",\n  \"rules\": [\n    \"Be respectful and supportive\",\n    \"No medical advice - only personal experiences\",\n    \"Maintain confidentiality\",\n    \"Report inappropriate behavior\",\n    \"Stay on topic\"\n  ],\n  \"tags\": [\"anxiety\", \"depression\", \"support\", \"mental-health\", \"coping-strategies\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}"]
            },
            "description": "Update community details (moderator/admin only)"
          },
          "response": []
        },
        {
          "name": "Delete Community",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Community guidelines violation\",\n  \"notifyMembers\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}"]
            },
            "description": "Delete a community (admin only)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Community Membership",
      "item": [
        {
          "name": "Join Community",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Successfully joined community', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Membership details returned', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('communityId');",
                  "    pm.expect(responseJson).to.have.property('userId');",
                  "    pm.expect(responseJson).to.have.property('joinedAt');",
                  "    pm.expect(responseJson).to.have.property('role');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"introduction\": \"Hi everyone! I'm excited to join this community. I've been dealing with anxiety for a few years and looking forward to connecting with others who understand.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/members",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "members"]
            },
            "description": "Join a community"
          },
          "response": []
        },
        {
          "name": "Leave Community",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Taking a break from social media\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/members/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "members", "{{userId}}"]
            },
            "description": "Leave a community"
          },
          "response": []
        },
        {
          "name": "Get Community Members",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/members?page=1&limit=50&role=member",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "members"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "50"
                },
                {
                  "key": "role",
                  "value": "member"
                }
              ]
            },
            "description": "Get list of community members with pagination"
          },
          "response": []
        },
        {
          "name": "Update Member Role",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"moderator\",\n  \"permissions\": [\"moderate_posts\", \"moderate_comments\", \"manage_members\"],\n  \"reason\": \"Active member with good judgment\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/members/{{targetUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "members", "{{targetUserId}}"]
            },
            "description": "Update member role and permissions (moderator/admin only)"
          },
          "response": []
        },
        {
          "name": "Remove Member",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Violation of community guidelines\",\n  \"notifyUser\": true,\n  \"banDuration\": \"30d\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/members/{{targetUserId}}/remove",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "members", "{{targetUserId}}", "remove"]
            },
            "description": "Remove member from community (moderator/admin only)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Community Discovery",
      "item": [
        {
          "name": "Search Communities",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Search completed successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Search results structure valid', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('results');",
                  "    pm.expect(responseJson).to.have.property('totalCount');",
                  "    pm.expect(responseJson).to.have.property('facets');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/search?q=anxiety&category=mental_health&memberCount=10-100&sort=relevance",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "search"],
              "query": [
                {
                  "key": "q",
                  "value": "anxiety"
                },
                {
                  "key": "category",
                  "value": "mental_health"
                },
                {
                  "key": "memberCount",
                  "value": "10-100"
                },
                {
                  "key": "sort",
                  "value": "relevance"
                }
              ]
            },
            "description": "Search communities by keywords and filters"
          },
          "response": []
        },
        {
          "name": "Get Recommended Communities",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/recommendations?limit=10&reason=true",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "recommendations"],
              "query": [
                {
                  "key": "limit",
                  "value": "10"
                },
                {
                  "key": "reason",
                  "value": "true"
                }
              ]
            },
            "description": "Get personalized community recommendations"
          },
          "response": []
        },
        {
          "name": "Get Popular Communities",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/popular?timeframe=week&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "popular"],
              "query": [
                {
                  "key": "timeframe",
                  "value": "week"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Get trending/popular communities"
          },
          "response": []
        },
        {
          "name": "Get Community Categories",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/categories",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "categories"]
            },
            "description": "Get all available community categories"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Community Moderation",
      "item": [
        {
          "name": "Report Community",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"inappropriate_content\",\n  \"description\": \"This community is promoting harmful content and not following platform guidelines.\",\n  \"evidence\": {\n    \"postIds\": [\"post-123\", \"post-456\"],\n    \"screenshots\": [\"evidence1.png\", \"evidence2.png\"]\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/report",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "report"]
            },
            "description": "Report a community for violations"
          },
          "response": []
        },
        {
          "name": "Get Community Reports",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/reports?status=pending&page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "reports"],
              "query": [
                {
                  "key": "status",
                  "value": "pending"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Get reports for a community (moderator/admin only)"
          },
          "response": []
        },
        {
          "name": "Handle Report",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"approved\",\n  \"resolution\": \"After review, this report was found to be valid. Community guidelines have been reinforced.\",\n  \"actionTaken\": \"warning_issued\",\n  \"notifyReporter\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/communities/reports/{{reportId}}",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "reports", "{{reportId}}"]
            },
            "description": "Handle a community report (moderator/admin only)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Community Statistics",
      "item": [
        {
          "name": "Get Community Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/stats",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "stats"]
            },
            "description": "Get community statistics (moderator/admin only)"
          },
          "response": []
        },
        {
          "name": "Get Community Activity",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/communities/{{communityId}}/activity?timeframe=week&metrics=posts,comments,members",
              "host": ["{{baseUrl}}"],
              "path": ["communities", "{{communityId}}", "activity"],
              "query": [
                {
                  "key": "timeframe",
                  "value": "week"
                },
                {
                  "key": "metrics",
                  "value": "posts,comments,members"
                }
              ]
            },
            "description": "Get community activity metrics"
          },
          "response": []
        }
      ]
    }
  ]
}