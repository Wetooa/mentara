model Post {
    id        String      @id @default(uuid())
    title     String
    content   String      @db.Text
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt
    comments  Comment[]
    hearts    PostHeart[] // Hearts instead of votes
    user      User?       @relation(fields: [userId], references: [id])
    userId    String?
    room      Room?       @relation(fields: [roomId], references: [id])
    roomId    String?

    // File attachments
    attachmentUrls  String[] @default([])
    attachmentNames String[] @default([])
    attachmentSizes Int[]    @default([])

    // Reports only (no awards, votes)
    reports Report[]

    @@index([userId])
    @@index([roomId])
}

// Note: PostFile is now replaced by FileAttachment with entityType = POST
// This model is kept for backward compatibility but should be migrated

model Comment {
    id        String  @id @default(uuid())
    postId    String
    userId    String
    content   String  @db.Text
    parentId  String? // For nested comments

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    post   Post @relation(fields: [postId], references: [id])
    user   User @relation(fields: [userId], references: [id])
    parent Comment? @relation("CommentReplies", fields: [parentId], references: [id])

    // File attachments
    attachmentUrls  String[] @default([])
    attachmentNames String[] @default([])
    attachmentSizes Int[]    @default([])

    // Hearts instead of votes
    hearts  CommentHeart[]
    children Comment[] @relation("CommentReplies")
    replies Reply[]

    // Reports only
    reports Report[]

    @@index([postId])
    @@index([userId])
    @@index([parentId])
}

// Note: CommentFile is now replaced by FileAttachment with entityType = COMMENT
// This model is kept for backward compatibility but should be migrated

model CommentHeart {
    id        String   @id @default(uuid())
    commentId String
    createdAt DateTime @default(now())
    comment   Comment  @relation(fields: [commentId], references: [id])
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?

    @@unique([commentId, userId])
    @@index([commentId])
    @@index([userId])
}

model PostHeart {
    id        String   @id @default(uuid())
    postId    String
    createdAt DateTime @default(now())
    post      Post     @relation(fields: [postId], references: [id])
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?

    @@unique([postId, userId])
    @@index([postId])
    @@index([userId])
}

model Reply {
    id        String       @id @default(uuid())
    commentId String
    userId    String
    content   String       @db.Text
    createdAt DateTime     @default(now())
    updatedAt DateTime     @updatedAt
    comment   Comment      @relation(fields: [commentId], references: [id])
    user      User         @relation("UserReplies", fields: [userId], references: [id])
    hearts    ReplyHeart[]

    // File attachments (replaces FileAttachment polymorphic system)
    attachmentUrls  String[] @default([])
    attachmentNames String[] @default([])
    attachmentSizes Int[]    @default([])

    @@index([commentId])
    @@index([userId])
}

// Note: ReplyFile is now replaced by FileAttachment with entityType = REPLY
// This model is kept for backward compatibility but should be migrated

model ReplyHeart {
    id        String   @id @default(uuid())
    replyId   String
    userId    String
    createdAt DateTime @default(now())
    reply     Reply    @relation(fields: [replyId], references: [id])
    user      User     @relation("UserReplyHearts", fields: [userId], references: [id])

    @@unique([replyId, userId])
    @@index([replyId])
    @@index([userId])
}

model Report {
    id       String @id @default(uuid())
    reason   String
    content  String?
    status   String @default("pending") // pending, reviewed, dismissed
    
    // What's being reported
    postId    String?
    commentId String?
    
    // Who reported
    reporterId String
    reporter   User @relation("UserReports", fields: [reporterId], references: [id])
    
    // Relations
    post    Post?    @relation(fields: [postId], references: [id])
    comment Comment? @relation(fields: [commentId], references: [id])
    
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@index([reporterId])
    @@index([postId])
    @@index([commentId])
}
