model Post {
  id              String      @id @default(uuid())
  title           String
  content         String
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  userId          String
  roomId          String?
  attachmentUrls  String[]    @default([])
  attachmentNames String[]    @default([])
  attachmentSizes Int[]       @default([])
  comments        Comment[]
  room            Room?       @relation(fields: [roomId], references: [id])
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  hearts          PostHeart[]
  reports         Report[]

  @@index([userId])
  @@index([roomId])
}

model Comment {
  id              String         @id @default(uuid())
  postId          String
  userId          String
  content         String
  parentId        String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  attachmentUrls  String[]       @default([])
  attachmentNames String[]       @default([])
  attachmentSizes Int[]          @default([])
  parent          Comment?       @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  children        Comment[]      @relation("CommentReplies")
  post            Post           @relation(fields: [postId], references: [id], onDelete: Cascade)
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  hearts          CommentHeart[]
  reports         Report[]

  @@index([postId])
  @@index([userId])
  @@index([parentId])
  @@index([postId, parentId])
}

model CommentHeart {
  id        String   @id @default(uuid())
  commentId String
  createdAt DateTime @default(now())
  userId    String
  comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

model PostHeart {
  id        String   @id @default(uuid())
  postId    String
  createdAt DateTime @default(now())
  userId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
}

model Report {
  id         String       @id @default(uuid())
  reason     String
  content    String?
  status     ReportStatus @default(PENDING)
  postId     String?
  commentId  String?
  reporterId String
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  comment    Comment?     @relation(fields: [commentId], references: [id], onDelete: Cascade)
  post       Post?        @relation(fields: [postId], references: [id], onDelete: Cascade)
  reporter   User         @relation("UserReports", fields: [reporterId], references: [id], onDelete: Cascade)

  @@index([reporterId])
  @@index([postId])
  @@index([commentId])
}

enum ReportStatus {
  PENDING
  REVIEWED
  DISMISSED
}
