model Post {
    id        String      @id @default(uuid())
    title     String
    content   String      @db.Text
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt
    files     PostFile[]
    comments  Comment[]
    hearts    PostHeart[]
    user      User?       @relation(fields: [userId], references: [id])
    userId    String?
    room      Room?       @relation(fields: [roomId], references: [id])
    roomId    String?

    @@index([userId])
    @@index([roomId])
}

model PostFile {
    id     String  @id @default(uuid())
    postId String
    url    String
    type   String?
    post   Post    @relation(fields: [postId], references: [id])

    @@index([postId])
}

model Comment {
    id        String         @id @default(uuid())
    postId    String
    userId    String
    content   String         @db.Text
    createdAt DateTime       @default(now())
    updatedAt DateTime       @updatedAt
    post      Post           @relation(fields: [postId], references: [id])
    user      User           @relation(fields: [userId], references: [id])
    hearts    CommentHeart[]
    files     CommentFile[]
    replies   Reply[]

    @@index([postId])
    @@index([userId])
}

model CommentFile {
    id        String  @id @default(uuid())
    commentId String
    url       String
    type      String?
    comment   Comment @relation(fields: [commentId], references: [id])

    @@index([commentId])
}

model CommentHeart {
    id        String   @id @default(uuid())
    commentId String
    createdAt DateTime @default(now())
    comment   Comment  @relation(fields: [commentId], references: [id])
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?

    @@unique([commentId, userId])
    @@index([commentId])
    @@index([userId])
}

model PostHeart {
    id        String   @id @default(uuid())
    postId    String
    createdAt DateTime @default(now())
    post      Post     @relation(fields: [postId], references: [id])
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?

    @@unique([postId, userId])
    @@index([postId])
    @@index([userId])
}

model Reply {
    id        String       @id @default(uuid())
    commentId String
    userId    String
    content   String       @db.Text
    createdAt DateTime     @default(now())
    updatedAt DateTime     @updatedAt
    comment   Comment      @relation(fields: [commentId], references: [id])
    user      User         @relation(fields: [userId], references: [id])
    hearts    ReplyHeart[]
    files     ReplyFile[]

    @@index([commentId])
    @@index([userId])
}

model ReplyFile {
    id      String  @id @default(uuid())
    replyId String
    url     String
    type    String?
    reply   Reply   @relation(fields: [replyId], references: [id])

    @@index([replyId])
}

model ReplyHeart {
    id        String   @id @default(uuid())
    replyId   String
    userId    String
    createdAt DateTime @default(now())
    reply     Reply    @relation(fields: [replyId], references: [id])
    user      User     @relation(fields: [userId], references: [id])

    @@unique([replyId, userId])
    @@index([replyId])
    @@index([userId])
} 