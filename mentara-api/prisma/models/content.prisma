model Post {
    id        String      @id @default(uuid())
    title     String
    content   String      @db.Text
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt
    comments  Comment[]
    hearts    PostHeart[]
    user      User?       @relation(fields: [userId], references: [id])
    userId    String?
    room      Room?       @relation(fields: [roomId], references: [id])
    roomId    String?

    // Reddit-like features
    votes         PostVote[]        @relation("PostVotes")
    awards        PostAward[]       @relation("PostAwards")
    commentThreads CommentThread[]  @relation("PostCommentThreads")

    @@index([userId])
    @@index([roomId])
}

// Note: PostFile is now replaced by FileAttachment with entityType = POST
// This model is kept for backward compatibility but should be migrated

model Comment {
    id        String  @id @default(uuid())
    postId    String
    userId    String
    content   String  @db.Text
    parentId  String? // For nested comments
    threadId  String? // Reference to comment thread
    depth     Int     @default(0) // Nesting depth (0 = top-level)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    post   Post @relation(fields: [postId], references: [id])
    user   User @relation(fields: [userId], references: [id])
    parent Comment? @relation("CommentReplies", fields: [parentId], references: [id])
    thread CommentThread? @relation("ThreadComments", fields: [threadId], references: [id])

    // Existing relations
    hearts  CommentHeart[]
    replies Reply[]

    // Reddit-like features
    votes       CommentVote[]   @relation("CommentVotes")
    awards      CommentAward[]  @relation("CommentAwards")
    children    Comment[]       @relation("CommentReplies")
    rootThread  CommentThread[] @relation("CommentThreads") // If this is a root comment

    @@index([postId])
    @@index([userId])
    @@index([parentId])
    @@index([threadId])
    @@index([postId, depth])
}

// Note: CommentFile is now replaced by FileAttachment with entityType = COMMENT
// This model is kept for backward compatibility but should be migrated

model CommentHeart {
    id        String   @id @default(uuid())
    commentId String
    createdAt DateTime @default(now())
    comment   Comment  @relation(fields: [commentId], references: [id])
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?

    @@unique([commentId, userId])
    @@index([commentId])
    @@index([userId])
}

model PostHeart {
    id        String   @id @default(uuid())
    postId    String
    createdAt DateTime @default(now())
    post      Post     @relation(fields: [postId], references: [id])
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?

    @@unique([postId, userId])
    @@index([postId])
    @@index([userId])
}

model Reply {
    id        String       @id @default(uuid())
    commentId String
    userId    String
    content   String       @db.Text
    createdAt DateTime     @default(now())
    updatedAt DateTime     @updatedAt
    comment   Comment      @relation(fields: [commentId], references: [id])
    user      User         @relation(fields: [userId], references: [id])
    hearts    ReplyHeart[]

    @@index([commentId])
    @@index([userId])
}

// Note: ReplyFile is now replaced by FileAttachment with entityType = REPLY
// This model is kept for backward compatibility but should be migrated

model ReplyHeart {
    id        String   @id @default(uuid())
    replyId   String
    userId    String
    createdAt DateTime @default(now())
    reply     Reply    @relation(fields: [replyId], references: [id])
    user      User     @relation(fields: [userId], references: [id])

    @@unique([replyId, userId])
    @@index([replyId])
    @@index([userId])
}
