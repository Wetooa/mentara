enum ReportStatus {
    PENDING
    REVIEWED
    DISMISSED
}

model Post {
    id        String      @id @default(uuid())
    title     String
    content   String      @db.Text
    createdAt DateTime    @default(now())
    updatedAt DateTime    @updatedAt
    comments  Comment[]
    hearts    PostHeart[] // Hearts instead of votes
    user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    String
    room      Room?       @relation(fields: [roomId], references: [id], onDelete: SetNull)
    roomId    String?

    // File attachments
    attachmentUrls  String[] @default([])
    attachmentNames String[] @default([])
    attachmentSizes Int[]    @default([])

    // Reports only (no awards, votes)
    reports Report[]

    @@index([userId])
    @@index([roomId])
}

// Note: PostFile is now replaced by FileAttachment with entityType = POST
// This model is kept for backward compatibility but should be migrated

model Comment {
    id       String  @id @default(uuid())
    postId   String
    userId   String
    content  String  @db.Text
    parentId String? // For nested comments - supports infinite nesting depth

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    post   Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
    user   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    parent Comment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)

    // File attachments
    attachmentUrls  String[] @default([])
    attachmentNames String[] @default([])
    attachmentSizes Int[]    @default([])

    // Hearts instead of votes
    hearts   CommentHeart[]
    children Comment[]      @relation("CommentReplies")

    // Reports only
    reports Report[]

    @@index([postId])
    @@index([userId])
    @@index([parentId])
    @@index([postId, parentId]) // Composite index for efficient nested queries
}

// Note: CommentFile is now replaced by FileAttachment with entityType = COMMENT
// This model is kept for backward compatibility but should be migrated

model CommentHeart {
    id        String   @id @default(uuid())
    commentId String
    createdAt DateTime @default(now())
    comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    String

    @@unique([commentId, userId])
    @@index([commentId])
    @@index([userId])
}

model PostHeart {
    id        String   @id @default(uuid())
    postId    String
    createdAt DateTime @default(now())
    post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    String

    @@unique([postId, userId])
    @@index([postId])
    @@index([userId])
}

model Report {
    id      String       @id @default(uuid())
    reason  String
    content String?
    status  ReportStatus @default(PENDING)

    // What's being reported
    postId    String?
    commentId String?

    // Who reported
    reporterId String
    reporter   User   @relation("UserReports", fields: [reporterId], references: [id], onDelete: Cascade)

    // Relations
    post    Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
    comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([reporterId])
    @@index([postId])
    @@index([commentId])
}
