// Additional Database Constraints and Optimizations
// This file contains views, indexes, and constraints that enhance database performance

// Note: These are additional constraints that could be added via raw SQL
// Prisma doesn't support all constraint types natively

/**
 * -- Additional database constraints that should be added via migration
 * -- These ensure data integrity beyond what Prisma schema can enforce
 * -- Business rule constraints
 * ALTER TABLE "User" ADD CONSTRAINT "valid_phone_format"
 * CHECK (phone_number IS NULL OR phone_number ~ '^\+[1-9]\d{1,14}$');
 * ALTER TABLE "User" ADD CONSTRAINT "valid_timezone"
 * CHECK (timezone IS NULL OR timezone ~ '^[A-Za-z]+/[A-Za-z_]+$');
 * ALTER TABLE "Meeting" ADD CONSTRAINT "valid_duration"
 * CHECK (duration > 0 AND duration <= 480);
 * ALTER TABLE "Meeting" ADD CONSTRAINT "future_start_time"
 * CHECK (start_time > NOW() - INTERVAL '1 day');
 * ALTER TABLE "Review" ADD CONSTRAINT "valid_rating"
 * CHECK (rating >= 1 AND rating <= 5);
 * ALTER TABLE "TherapistAvailability" ADD CONSTRAINT "valid_day_of_week"
 * CHECK (day_of_week >= 0 AND day_of_week <= 6);
 * ALTER TABLE "TherapistAvailability" ADD CONSTRAINT "valid_time_format"
 * CHECK (start_time ~ '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
 * AND end_time ~ '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$');
 * ALTER TABLE "TherapistAvailability" ADD CONSTRAINT "end_after_start"
 * CHECK (end_time > start_time);
 * -- Composite indexes for performance
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_user_role_active"
 * ON "User" (role, is_active) WHERE is_active = true;
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_meeting_therapist_date"
 * ON "Meeting" (therapist_id, start_time)
 * WHERE status IN ('SCHEDULED', 'CONFIRMED');
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_message_conversation_created"
 * ON "Message" (conversation_id, created_at DESC)
 * WHERE is_deleted = false;
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_notification_user_unread"
 * ON "Notification" (user_id, created_at DESC)
 * WHERE is_read = false;
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_audit_log_recent"
 * ON "AuditLog" (created_at DESC)
 * WHERE created_at > NOW() - INTERVAL '30 days';
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_file_storage_path"
 * ON "File" USING HASH (storage_path);
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_payment_status_date"
 * ON "Payment" (status, created_at DESC)
 * WHERE status IN ('PENDING', 'PROCESSING');
 * -- Full-text search indexes
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_user_fulltext"
 * ON "User" USING GIN (
 * to_tsvector('english',
 * COALESCE(first_name, '') || ' ' ||
 * COALESCE(last_name, '') || ' ' ||
 * COALESCE(bio, '')
 * )
 * );
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_post_content_fulltext"
 * ON "Post" USING GIN (
 * to_tsvector('english',
 * COALESCE(title, '') || ' ' ||
 * COALESCE(content, '')
 * )
 * );
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_therapist_expertise_fulltext"
 * ON "Therapist" USING GIN (
 * to_tsvector('english', array_to_string(areas_of_expertise, ' '))
 * );
 * -- Partial indexes for soft deletes
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_file_active"
 * ON "File" (id, created_at) WHERE deleted_at IS NULL;
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_user_active"
 * ON "User" (id, last_active_at) WHERE suspended_at IS NULL;
 * -- Indexes for foreign key performance
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_worksheet_client_status"
 * ON "Worksheet" (client_id, status) WHERE is_completed = false;
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_review_therapist_rating"
 * ON "Review" (therapist_id, rating, created_at DESC)
 * WHERE status = 'APPROVED';
 * -- Covering indexes for common queries
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_meeting_therapist_time_covering"
 * ON "Meeting" (therapist_id, start_time)
 * INCLUDE (duration, status, meeting_type);
 * CREATE INDEX CONCURRENTLY IF NOT EXISTS "idx_subscription_user_covering"
 * ON "Subscription" (user_id)
 * INCLUDE (status, current_period_end, tier);
 */
