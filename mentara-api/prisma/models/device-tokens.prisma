// Device Token Management for Push Notifications
// This model stores device tokens for push notifications across different platforms

model DeviceToken {
  id          String   @id @default(uuid())
  userId      String
  token       String   @unique // FCM/APNS token
  platform    Platform
  isActive    Boolean  @default(true)
  lastUsedAt  DateTime @default(now())
  deviceInfo  Json?    // Device metadata (model, OS, app version, etc.)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user        User     @relation("UserDeviceTokens", fields: [userId], references: [id], onDelete: Cascade)
  
  // Indexes for performance
  @@index([userId, isActive])
  @@index([token])
  @@index([platform, isActive])
  @@index([lastUsedAt])
}

model ScheduledNotification {
  id                   String              @id @default(uuid())
  userId               String
  title                String
  body                 String              @db.Text
  type                 NotificationType
  priority             NotificationPriority @default(NORMAL)
  data                 Json?               // Additional data payload
  actionUrl            String?
  notificationChannel  String              @default("push") // push, email, in-app
  scheduledFor         DateTime            // When to send the notification
  sentAt               DateTime?           // When it was actually sent
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  
  // Relations
  user                 User                @relation("UserScheduledNotifications", fields: [userId], references: [id], onDelete: Cascade)
  
  // Indexes for performance
  @@index([userId, scheduledFor])
  @@index([scheduledFor, sentAt])
  @@index([notificationChannel, scheduledFor])
  @@index([type, scheduledFor])
}

enum Platform {
  IOS
  ANDROID
  WEB
}