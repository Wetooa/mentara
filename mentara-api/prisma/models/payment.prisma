model Payment {
  id              String         @id @default(uuid())
  amount          Decimal        @db.Decimal(10, 2)
  currency        String         @default("USD")
  status          PaymentStatus  @default(PENDING)
  clientId        String
  therapistId     String
  meetingId       String?
  paymentMethodId String?
  processedAt     DateTime?
  failedAt        DateTime?
  failureReason   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  client          Client         @relation(fields: [clientId], references: [userId], onDelete: Cascade)
  meeting         Meeting?       @relation(fields: [meetingId], references: [id])
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])
  therapist       Therapist      @relation(fields: [therapistId], references: [userId], onDelete: Cascade)

  @@index([clientId])
  @@index([therapistId])
  @@index([status])
  @@index([meetingId])
}

model PaymentMethod {
  id        String            @id @default(uuid())
  userId    String
  type      PaymentMethodType @default(CARD)
  nickname  String?           // User-friendly name like "My Visa Card"
  isDefault Boolean           @default(false)
  isActive  Boolean           @default(true)
  lastUsed  DateTime?
  
  // Card-specific fields
  cardLast4       String?
  cardBrand       String?
  cardholderName  String?
  cardNumber      String?       // Masked for demo purposes
  expiryMonth     Int?
  expiryYear      Int?
  cardType        String?       // Visa, Mastercard, etc.
  
  // Bank account fields
  bankName          String?
  accountHolderName String?
  accountType       String?     // Checking, Savings
  routingNumber     String?     // Masked
  accountLast4      String?
  
  // Digital wallet fields
  walletProvider    String?     // PayPal, Apple Pay, Google Pay
  walletEmail       String?
  walletAccountName String?
  
  // GCash fields
  gcashNumber   String?         // Mobile number
  gcashName     String?         // Account holder name
  isVerified    Boolean?        // Verification status
  gcashEmail    String?         // Associated email
  
  // Maya fields
  mayaNumber    String?         // Mobile number
  mayaName      String?         // Account holder name
  mayaVerified  Boolean?        // Verification status
  mayaEmail     String?         // Associated email
  
  // Address (stored as JSON)
  billingAddress Json?
  
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  payments  Payment[]
  user      User              @relation("UserPaymentMethods", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isDefault])
  @@index([type])
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethodType {
  CARD
  BANK_ACCOUNT
  DIGITAL_WALLET
  GCASH
  MAYA
}
