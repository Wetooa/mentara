model Payment {
  id              String         @id @default(uuid())
  amount          Decimal        @db.Decimal(10, 2)
  currency        String         @default("USD")
  status          PaymentStatus  @default(PENDING)
  clientId        String
  therapistId     String
  meetingId       String?
  paymentMethodId String?
  processedAt     DateTime?
  failedAt        DateTime?
  failureReason   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  client          Client         @relation(fields: [clientId], references: [userId], onDelete: Cascade)
  meeting         Meeting?       @relation(fields: [meetingId], references: [id])
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])
  therapist       Therapist      @relation(fields: [therapistId], references: [userId], onDelete: Cascade)

  @@index([clientId])
  @@index([therapistId])
  @@index([status])
  @@index([meetingId])
}

model PaymentMethod {
  id        String            @id @default(uuid())
  userId    String
  type      PaymentMethodType @default(CARD)
  cardLast4 String?
  cardBrand String?
  isDefault Boolean           @default(false)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  payments  Payment[]
  user      User              @relation("UserPaymentMethods", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isDefault])
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethodType {
  CARD
  BANK_ACCOUNT
  DIGITAL_WALLET
}
