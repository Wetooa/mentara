model User {
    id         String    @id @unique @default(uuid()) // Clerk user ID for authentication
    email      String    @unique // User's email address
    firstName  String
    middleName String?
    lastName   String
    birthDate  DateTime?
    address    String?
    avatarUrl  String? // Profile image URL
    role       String    @default("client") // client, therapist, moderator, admin
    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt

    // Profile and verification
    bio           String?
    coverImageUrl String?
    isActive      Boolean @default(true)

    // Community and content relations (available to all users)
    memberships   Membership[]
    posts         Post[]
    comments      Comment[]
    postHearts    PostHeart[]
    commentHearts CommentHeart[]

    // Role-specific relations
    client    Client?    @relation("UserClient")
    therapist Therapist? @relation("UserTherapist")
    moderator Moderator? @relation("UserModerator")
    admin     Admin?     @relation("UserAdmin")

    replies        Reply[]
    replyHearts    ReplyHeart[]
    reviewsHelpful ReviewHelpful[]

    // Messaging relations
    conversations      ConversationParticipant[] @relation("UserConversations")
    sentMessages       Message[]                 @relation("UserMessages")
    messageReadReceipts MessageReadReceipt[]    @relation("UserReadReceipts")
    messageReactions   MessageReaction[]        @relation("UserMessageReactions")
    blocking           UserBlock[]              @relation("UserBlocking")
    blockedBy          UserBlock[]              @relation("UserBlocked")

    @@index([email])
    @@index([role])
}

model Client {
    userId String @unique
    user   User   @relation("UserClient", fields: [userId], references: [id], onDelete: Cascade)

    // Patient-specific relations
    worksheets           Worksheet[]
    preAssessment        PreAssessment?
    worksheetSubmissions WorksheetSubmission[]
    clientMedicalHistory ClientMedicalHistory[]
    clientPreferences    ClientPreference[]
    assignedTherapists   ClientTherapist[]
    meetings             Meeting[]              @relation("ClientMeetings")
    reviews              Review[] // Reviews written by this client

    hasSeenTherapistRecommendations Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    @@index([userId])
}

model Moderator {
    userId String @unique
    user   User   @relation("UserModerator", fields: [userId], references: [id], onDelete: Cascade)

    // Moderator-specific fields
    permissions         String[] // Array of moderator permissions
    assignedCommunities Json? // Communities they moderate

    createdAt            DateTime             @default(now())
    updatedAt            DateTime             @updatedAt
    moderatorCommunities ModeratorCommunity[]

    @@index([userId])
}

model Admin {
    userId String @unique
    user   User   @relation("UserAdmin", fields: [userId], references: [id], onDelete: Cascade)

    // Admin-specific fields
    permissions         String[] // Array of admin permissions
    adminLevel          String      @default("admin") // admin, super_admin, etc.
    processedTherapists Therapist[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
}
