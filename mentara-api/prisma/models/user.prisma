model User {
    id         String    @id @unique // Clerk user ID for authentication
    email      String    @unique // User's email address
    firstName  String
    middleName String?
    lastName   String
    birthDate  DateTime?
    address    String?
    avatarUrl  String? // Profile image URL
    role       String    @default("client") // client, therapist, moderator, admin
    isActive   Boolean   @default(true)
    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt

    // Community and content relations (available to all users)
    memberships   Membership[]
    posts         Post[]
    comments      Comment[]
    postHearts    PostHeart[]
    commentHearts CommentHeart[]

    // Role-specific relations
    client    Client?    @relation("UserClient")
    therapist Therapist? @relation("UserTherapist")
    moderator Moderator? @relation("UserModerator")
    admin     Admin?     @relation("UserAdmin")

    replies        Reply[]
    replyHearts    ReplyHeart[]
    reviewsHelpful ReviewHelpful[]

    // Messaging relations
    conversations      ConversationParticipant[] @relation("UserConversations")
    sentMessages       Message[]                 @relation("UserMessages")
    messageReadReceipts MessageReadReceipt[]    @relation("UserReadReceipts")
    messageReactions   MessageReaction[]        @relation("UserMessageReactions")
    blocking           UserBlock[]              @relation("UserBlocking")
    blockedBy          UserBlock[]              @relation("UserBlocked")

    @@index([email])
    @@index([role])
}

model Client {
    userId String @unique
    user   User   @relation("UserClient", fields: [userId], references: [id], onDelete: Cascade)

    // Patient-specific relations
    worksheets           Worksheet[]
    preAssessment        PreAssessment?
    worksheetSubmissions WorksheetSubmission[]
    clientMedicalHistory ClientMedicalHistory[]
    clientPreferences    ClientPreference[]
    assignedTherapists   ClientTherapist[]
    meetings             Meeting[]              @relation("ClientMeetings")
    reviews              Review[] // Reviews written by this client

    hasSeenTherapistRecommendations Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    @@index([userId])
}

model Therapist {
    userId String @id @unique
    user   User   @relation("UserTherapist", fields: [userId], references: [id], onDelete: Cascade)

    // Application/approval
    approved        Boolean   @default(false)
    status          String    @default("pending") // pending, approved, rejected
    submissionDate  DateTime  @default(now())
    processingDate  DateTime?
    processedBy     String?
    applicationData Json?

    // Personal Info
    firstName String
    lastName  String
    email     String
    mobile    String
    province  String

    // Professional Info
    providerType                  String
    professionalLicenseType       String
    isPRCLicensed                 String
    prcLicenseNumber              String
    expirationDateOfLicense       DateTime?
    isLicenseActive               String
    practiceStartDate             DateTime
    areasOfExpertise              Json
    assessmentTools               Json
    therapeuticApproachesUsedList Json
    languagesOffered              Json

    // Practice Details
    providedOnlineTherapyBefore       String
    comfortableUsingVideoConferencing String
    weeklyAvailability                String
    preferredSessionLength            String
    accepts                           Json
    sessionLength                     String?
    hourlyRate                        Decimal? @db.Decimal(10, 2)

    // Denormalized fields (moved from separate tables)
    expertise              Json? // Array of expertise strings
    approaches             Json? // Array of approach strings
    languages              Json? // Array of language strings
    illnessSpecializations Json? // Array of illness specializations
    acceptTypes            Json? // Array of accept types
    treatmentSuccessRates  Json? // Object with illness -> success rate mapping
    uploadedFiles          Json? // Array of file objects

    // Profile and verification
    bio             String? @db.Text
    profileImageUrl String?
    profileComplete Boolean @default(false)
    isActive        Boolean @default(true)

    // Meetings (meetings with clients)
    meetings Meeting[] @relation("TherapistMeetings")

    // Therapist availabilities
    therapistAvailabilities TherapistAvailability[]

    // Therapist-specific relations
    worksheets Worksheet[]

    // Many-to-many with clients
    assignedClients ClientTherapist[]

    // Reviews received by this therapist
    reviews Review[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
    @@index([isActive])
    @@index([approved])
}

model Moderator {
    userId String @unique
    user   User   @relation("UserModerator", fields: [userId], references: [id], onDelete: Cascade)

    // Moderator-specific fields
    permissions         String[] // Array of moderator permissions
    assignedCommunities Json? // Communities they moderate

    createdAt            DateTime             @default(now())
    updatedAt            DateTime             @updatedAt
    moderatorCommunities ModeratorCommunity[]

    @@index([userId])
}

model Admin {
    userId String @unique
    user   User   @relation("UserAdmin", fields: [userId], references: [id], onDelete: Cascade)

    // Admin-specific fields
    permissions String[] // Array of admin permissions
    adminLevel  String   @default("admin") // admin, super_admin, etc.

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
}
