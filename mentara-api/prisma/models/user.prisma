model User {
    id         String    @id @unique @default(uuid())
    email      String    @unique
    firstName  String
    middleName String? // Optional middle name
    lastName   String
    birthDate  DateTime? // User's birth date
    address    String? // User's address
    role       String    @default("client") // client, therapist, moderator, admin
    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt

    // Authentication fields
    password            String? // Hashed password
    emailVerified       Boolean   @default(false)
    emailVerifyToken    String?   @unique
    emailVerifyTokenExp DateTime?
    resetToken          String?   @unique
    resetTokenExpiry    DateTime?
    isActive            Boolean   @default(true)
    isVerified          Boolean   @default(false)
    failedLoginCount    Int       @default(0)
    avatarUrl           String?
    coverImageUrl       String? // Cover/banner image URL
    bio                 String?

    // Account status fields
    suspendedAt        DateTime?
    suspendedBy        String?
    suspensionReason   String?
    deactivatedAt      DateTime?
    deactivatedBy      String?
    deactivationReason String?
    lastLoginAt        DateTime?
    lockoutUntil       DateTime?

    // Essential content relations
    posts         Post[]
    comments      Comment[] // Supports nested comments through parentId
    postHearts    PostHeart[]
    commentHearts CommentHeart[] // Supports hearts on all comment levels

    // Reports (instead of reddit-like features)
    reports Report[] @relation("UserReports")

    // Role-specific relations
    client    Client?    @relation("UserClient")
    therapist Therapist? @relation("UserTherapist")
    moderator Moderator? @relation("UserModerator")
    admin     Admin?     @relation("UserAdmin")

    // Essential messaging
    conversations       ConversationParticipant[] @relation("UserConversations")
    sentMessages        Message[]                 @relation("UserMessages")
    messageReadReceipts MessageReadReceipt[]      @relation("UserReadReceipts")
    messageReactions    MessageReaction[]         @relation("UserMessageReactions")

    // User blocking system
    blocking  UserBlock[] @relation("UserBlocking")
    blockedBy UserBlock[] @relation("UserBlocked")

    // Simple notifications (WebSocket only)
    notifications Notification[] @relation("UserNotifications")

    // Simple billing
    paymentMethods PaymentMethod[] @relation("UserPaymentMethods")

    // Essential community features (minimal)
    memberships Membership[]

    @@index([email])
    @@index([role])
}

model Client {
    userId String @id @unique
    user   User   @relation("UserClient", fields: [userId], references: [id], onDelete: Cascade)

    // Patient-specific relations
    worksheets         Worksheet[]
    preAssessment      PreAssessment?
    assignedTherapists ClientTherapist[]
    meetings           Meeting[]         @relation("ClientMeetings")
    reviews            Review[] // Reviews written by this client
    paymentsAsClient   Payment[] // Payments made by this client

    hasSeenTherapistRecommendations Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now())

    @@index([userId])
}

model Moderator {
    userId String @id @unique
    user   User   @relation("UserModerator", fields: [userId], references: [id], onDelete: Cascade)

    // Moderator-specific fields
    permissions         String[] // Array of moderator permissions
    assignedCommunities Json? // Communities they moderate

    createdAt            DateTime             @default(now())
    updatedAt            DateTime             @updatedAt
    moderatorCommunities ModeratorCommunity[]

    @@index([userId])
}

model Admin {
    userId String @id @unique
    user   User   @relation("UserAdmin", fields: [userId], references: [id], onDelete: Cascade)

    // Admin-specific fields
    permissions         String[] // Array of admin permissions
    adminLevel          String      @default("admin") // admin, super_admin, etc.
    processedTherapists Therapist[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId])
}
