// Community Join Request System
// This model manages requests from users to join communities that require approval
// Includes moderation workflow and assessment profile integration

model CommunityJoinRequest {
  id                   String              @id @default(uuid())
  userId               String
  communityId          String
  status               JoinRequestStatus   @default(PENDING)
  message              String?             @db.Text
  moderatorId          String?
  moderatorNote        String?             @db.Text
  assessmentProfile    Json?               // User's relevant assessment scores
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  processedAt         DateTime?
  
  // Relations
  user                User                @relation("UserJoinRequests", fields: [userId], references: [id], onDelete: Cascade)
  community           Community           @relation("CommunityJoinRequests", fields: [communityId], references: [id], onDelete: Cascade)
  moderator           User?               @relation("ModeratedJoinRequests", fields: [moderatorId], references: [id], onDelete: SetNull)
  
  // Indexes for performance
  @@unique([userId, communityId])
  @@index([communityId, status])
  @@index([moderatorId, status])
  @@index([status, createdAt])
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}