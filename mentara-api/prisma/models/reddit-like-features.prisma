// Reddit-like Features: Voting and Enhanced Comments
// This enhances the existing posts and comments with voting capabilities

// Enhanced voting system for posts
model PostVote {
  id       String   @id @default(uuid())
  postId   String
  userId   String
  voteType VoteType
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  post Post @relation("PostVotes", fields: [postId], references: [id], onDelete: Cascade)
  user User @relation("UserPostVotes", fields: [userId], references: [id], onDelete: Cascade)

  // Constraints
  @@unique([postId, userId]) // One vote per user per post
  @@index([postId, voteType])
  @@index([userId])
}

// Enhanced voting system for comments
model CommentVote {
  id        String   @id @default(uuid())
  commentId String
  userId    String
  voteType  VoteType
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  comment Comment @relation("CommentVotes", fields: [commentId], references: [id], onDelete: Cascade)
  user    User    @relation("UserCommentVotes", fields: [userId], references: [id], onDelete: Cascade)

  // Constraints
  @@unique([commentId, userId]) // One vote per user per comment
  @@index([commentId, voteType])
  @@index([userId])
}

// Thread tracking for nested comments
model CommentThread {
  id               String   @id @default(uuid())
  postId           String
  rootCommentId    String   // The top-level comment that started this thread
  depth            Int      @default(0) // How deep this thread goes
  commentCount     Int      @default(0) // Total comments in this thread
  lastActivityAt   DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  post        Post      @relation("PostCommentThreads", fields: [postId], references: [id], onDelete: Cascade)
  rootComment Comment   @relation("CommentThreads", fields: [rootCommentId], references: [id], onDelete: Cascade)
  comments    Comment[] @relation("ThreadComments")

  // Indexes
  @@index([postId, lastActivityAt])
  @@index([rootCommentId])
  @@index([postId, commentCount])
}

// Awards/badges system (like Reddit awards)
model PostAward {
  id          String    @id @default(uuid())
  postId      String
  userId      String    // User who gave the award
  awardType   AwardType
  message     String?   @db.Text
  isAnonymous Boolean   @default(false)
  createdAt   DateTime  @default(now())

  // Relations
  post Post @relation("PostAwards", fields: [postId], references: [id], onDelete: Cascade)
  user User @relation("UserGivenAwards", fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([postId, awardType])
  @@index([userId])
  @@index([createdAt])
}

model CommentAward {
  id          String    @id @default(uuid())
  commentId   String
  userId      String    // User who gave the award
  awardType   AwardType
  message     String?   @db.Text
  isAnonymous Boolean   @default(false)
  createdAt   DateTime  @default(now())

  // Relations
  comment Comment @relation("CommentAwards", fields: [commentId], references: [id], onDelete: Cascade)
  user    User    @relation("UserGivenCommentAwards", fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([commentId, awardType])
  @@index([userId])
}

// Content moderation reports
model ContentReport {
  id           String       @id @default(uuid())
  reporterId   String
  contentType  ContentType
  contentId    String       // Can be postId or commentId
  reason       ReportReason
  description  String?      @db.Text
  status       ReportStatus @default(PENDING)
  moderatorId  String?
  moderatorNote String?     @db.Text
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  resolvedAt   DateTime?

  // Relations
  reporter  User  @relation("UserReports", fields: [reporterId], references: [id], onDelete: Cascade)
  moderator User? @relation("UserModeratedReports", fields: [moderatorId], references: [id], onDelete: SetNull)

  // Indexes
  @@index([contentType, contentId])
  @@index([status, createdAt])
  @@index([moderatorId])
  @@index([reporterId])
}

// Saved/bookmarked content
model SavedContent {
  id          String      @id @default(uuid())
  userId      String
  contentType ContentType
  contentId   String      // Can be postId or commentId
  savedAt     DateTime    @default(now())

  // Relations
  user User @relation("UserSavedContent", fields: [userId], references: [id], onDelete: Cascade)

  // Constraints
  @@unique([userId, contentType, contentId])
  @@index([userId, savedAt])
  @@index([contentType, contentId])
}

// User karma/reputation system
model UserKarma {
  id           String     @id @default(uuid())
  userId       String     @unique
  postKarma    Int        @default(0)   // Karma from posts
  commentKarma Int        @default(0)   // Karma from comments
  awardKarma   Int        @default(0)   // Karma from awards received
  totalKarma   Int        @default(0)   // Total combined karma
  lastUpdated  DateTime   @default(now())

  // Relations
  user User @relation("UserKarma", fields: [userId], references: [id], onDelete: Cascade)

  // Indexes
  @@index([totalKarma])
  @@index([userId])
}

// Enums
enum VoteType {
  UPVOTE
  DOWNVOTE
}

enum AwardType {
  HELPFUL      // Free award for helpful content
  SUPPORTIVE   // For supportive comments
  INSPIRING    // For inspiring posts
  FUNNY        // For humorous content
  GOLD         // Premium award (costs coins)
  PLATINUM     // Higher premium award
  COMMUNITY    // Community-specific award
}

enum ContentType {
  POST
  COMMENT
}

enum ReportReason {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  MISINFORMATION
  SELF_HARM
  VIOLENCE
  HATE_SPEECH
  COPYRIGHT
  OTHER
}

enum ReportStatus {
  PENDING
  UNDER_REVIEW
  RESOLVED
  DISMISSED
}