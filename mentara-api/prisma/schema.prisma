generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id          String       @id @default(uuid())
  clerkId     String?      @unique
  firstName   String
  middleName  String?
  lastName    String
  email       String?
  birthDate   DateTime
  address     String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  avatarUrl   String?
  comments    Comment[]
  memberships Membership[]
  posts       Post[]
  worksheets  Worksheet[]

  @@index([clerkId])
}

model Community {
  id          String       @id @default(uuid())
  name        String
  description String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  members     Membership[]
  posts       Post[]
}

model Membership {
  id          String    @id @default(uuid())
  userId      String
  communityId String
  role        String
  joinedAt    DateTime  @default(now())
  community   Community @relation(fields: [communityId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
}

model PostFile {
  id     String @id @default(uuid())
  url    String
  postId String
  post   Post   @relation(fields: [postId], references: [id])
}

model CommentFile {
  id        String  @id @default(uuid())
  url       String
  commentId String
  comment   Comment @relation(fields: [commentId], references: [id])
}

model Post {
  id          String     @id @default(uuid())
  title       String
  content     String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  userId      String
  communityId String
  comments    Comment[]
  community   Community  @relation(fields: [communityId], references: [id])
  user        User       @relation(fields: [userId], references: [id])
  files       PostFile[]
}

model Comment {
  id        String        @id @default(uuid())
  content   String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  postId    String
  userId    String
  parentId  String?
  parent    Comment?      @relation("CommentHierarchy", fields: [parentId], references: [id])
  replies   Comment[]     @relation("CommentHierarchy")
  post      Post          @relation(fields: [postId], references: [id])
  user      User          @relation(fields: [userId], references: [id])
  files     CommentFile[]
}

model AdminUser {
  id          String   @id @default(uuid())
  clerkUserId String   @unique
  email       String   @unique
  role        String   @default("admin")
  permissions String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([clerkUserId])
}

model TherapistApplication {
  id                                 String     @id @default(uuid())
  clerkUserId                        String?    @unique
  status                             String     @default("pending")
  submissionDate                     DateTime   @default(now())
  processingDate                     DateTime?
  processedBy                        String?
  applicationData                    Json
  firstName                          String
  lastName                           String
  email                              String
  mobile                             String
  province                           String
  providerType                       String
  professionalLicenseType            String
  isPRCLicensed                      String
  prcLicenseNumber                   String
  expirationDateOfLicense            DateTime?
  isLicenseActive                    String
  yearsOfExperience                  String
  areasOfExpertise                   Json
  assessmentTools                    Json
  therapeuticApproachesUsedList      Json
  languagesOffered                   Json
  providedOnlineTherapyBefore        String
  comfortableUsingVideoConferencing  String
  weeklyAvailability                 String
  preferredSessionLength             String
  accepts                            Json
  privateConfidentialSpace           String
  compliesWithDataPrivacyAct         String
  professionalLiabilityInsurance     String
  complaintsOrDisciplinaryActions    String
  willingToAbideByPlatformGuidelines String
  uploadedDocuments                  Json?
  createdAt                          DateTime   @default(now())
  updatedAt                          DateTime   @updatedAt
  therapist                          Therapist?

  @@index([status])
  @@index([email])
}

model Therapist {
  id                      String                @id @default(uuid())
  clerkUserId             String                @unique
  email                   String                @unique
  firstName               String
  lastName                String
  mobile                  String
  province                String
  providerType            String
  professionalLicenseType String
  prcLicenseNumber        String?
  licensedSince           DateTime?
  licenseExpiration       DateTime?
  yearsOfExperience       Int?
  areasOfExpertise        Json
  therapeuticApproaches   Json
  languages               Json
  weeklyAvailability      String?
  sessionLength           String?
  accepts                 Json?
  profileComplete         Boolean               @default(false)
  applicationId           String?               @unique
  bio                     String?
  profileImageUrl         String?
  hourlyRate              Decimal?              @db.Decimal(10, 2)
  isActive                Boolean               @default(true)
  isVerified              Boolean               @default(false)
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  application             TherapistApplication? @relation(fields: [applicationId], references: [id])
  worksheets              Worksheet[]

  @@index([clerkUserId])
}

model FileUpload {
  id                     String   @id @default(uuid())
  fileName               String
  fileSize               Int
  fileType               String
  fileUrl                String
  docType                String
  uploadedBy             String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  therapistApplicationId String?

  @@index([docType])
  @@index([uploadedBy])
}

model Worksheet {
  id           String                @id @default(uuid())
  title        String
  instructions String?
  assignedDate DateTime              @default(now())
  dueDate      DateTime
  status       String                @default("upcoming")
  isCompleted  Boolean               @default(false)
  submittedAt  DateTime?
  feedback     String?
  userId       String
  therapistId  String
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  therapist    Therapist             @relation(fields: [therapistId], references: [id])
  user         User                  @relation(fields: [userId], references: [id])
  materials    WorksheetMaterial[]
  submissions  WorksheetSubmission[]

  @@index([userId])
  @@index([therapistId])
  @@index([status])
}

model WorksheetMaterial {
  id          String    @id @default(uuid())
  filename    String
  url         String
  fileSize    Int?
  fileType    String?
  worksheetId String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  worksheet   Worksheet @relation(fields: [worksheetId], references: [id], onDelete: Cascade)

  @@index([worksheetId])
}

model WorksheetSubmission {
  id          String    @id @default(uuid())
  filename    String
  url         String
  fileSize    Int?
  fileType    String?
  worksheetId String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  worksheet   Worksheet @relation(fields: [worksheetId], references: [id], onDelete: Cascade)

  @@index([worksheetId])
}
