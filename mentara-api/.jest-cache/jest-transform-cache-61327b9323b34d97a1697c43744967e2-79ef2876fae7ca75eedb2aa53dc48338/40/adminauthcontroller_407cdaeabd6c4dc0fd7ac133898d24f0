9d1eec52aa3fb6a3dbadfd7f3d7977a4
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdminAuthController = void 0;
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const swagger_1 = require("@nestjs/swagger");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../decorators/current-user-id.decorator");
const current_user_role_decorator_1 = require("../decorators/current-user-role.decorator");
const public_decorator_1 = require("../decorators/public.decorator");
const zod_validation_pipe_1 = require("../../common/pipes/zod-validation.pipe");
const mentara_commons_1 = require("mentara-commons");
const admin_auth_service_1 = require("../services/admin-auth.service");
const express_1 = require("express");
let AdminAuthController = class AdminAuthController {
    adminAuthService;
    constructor(adminAuthService) {
        this.adminAuthService = adminAuthService;
    }
    async createAdminAccount(currentUserRole, registerDto) {
        // Only super admins can create other admins
        if (currentUserRole !== 'admin') {
            throw new common_1.ForbiddenException('Only admins can create admin accounts');
        }
        const result = await this.adminAuthService.createAdminAccount(registerDto.email, registerDto.password, registerDto.firstName, registerDto.lastName, registerDto.adminLevel || 'admin', registerDto.permissions || []);
        return {
            user: {
                id: result.user.id,
                email: result.user.email,
                firstName: result.user.firstName,
                lastName: result.user.lastName,
                role: result.user.role,
                emailVerified: result.user.emailVerified,
            },
            message: result.message,
        };
    }
    async login(loginDto, req) {
        const ipAddress = req.ip;
        const userAgent = req.get('User-Agent');
        const result = await this.adminAuthService.loginAdmin(loginDto.email, loginDto.password, ipAddress, userAgent);
        return {
            user: {
                id: result.user.id,
                email: result.user.email,
                firstName: result.user.firstName,
                lastName: result.user.lastName,
                role: result.user.role,
                emailVerified: result.user.emailVerified,
            },
            accessToken: result.tokens.accessToken,
            refreshToken: result.tokens.refreshToken,
            expiresIn: result.tokens.expiresIn,
        };
    }
    async getProfile(userId) {
        return this.adminAuthService.getAdminProfile(userId);
    }
    async getPermissions(userId) {
        return this.adminAuthService.getAdminPermissions(userId);
    }
    async getDashboardStats(userId) {
        return this.adminAuthService.getAdminDashboardStats(userId);
    }
};
exports.AdminAuthController = AdminAuthController;
__decorate([
    (0, common_1.Post)('create-account'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create new admin account',
        description: 'Create a new admin account. Only existing admins can create new admin accounts.',
    }),
    (0, swagger_1.ApiBody)({
        type: 'object',
        description: 'Admin registration data',
        schema: {
            type: 'object',
            required: ['email', 'password', 'firstName', 'lastName'],
            properties: {
                email: {
                    type: 'string',
                    format: 'email',
                    example: 'admin@mentara.com',
                },
                password: { type: 'string', minLength: 8, example: 'SecurePass123!' },
                firstName: { type: 'string', example: 'John' },
                lastName: { type: 'string', example: 'Doe' },
                adminLevel: {
                    type: 'string',
                    enum: ['admin', 'super_admin'],
                    example: 'admin',
                },
                permissions: {
                    type: 'array',
                    items: { type: 'string' },
                    example: ['read', 'write'],
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Admin account created successfully',
        schema: {
            type: 'object',
            properties: {
                user: {
                    type: 'object',
                    properties: {
                        id: { type: 'string' },
                        email: { type: 'string' },
                        firstName: { type: 'string' },
                        lastName: { type: 'string' },
                        role: { type: 'string' },
                        emailVerified: { type: 'boolean' },
                    },
                },
                message: { type: 'string' },
            },
        },
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({
        description: 'Invalid or missing authentication token',
    }),
    (0, swagger_1.ApiForbiddenResponse)({
        description: 'Only admins can create admin accounts',
    }),
    (0, swagger_1.ApiTooManyRequestsResponse)({
        description: 'Too many admin creation attempts',
    }),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, throttler_1.Throttle)({ default: { limit: 3, ttl: 600000 } }) // 3 admin creations per 10 minutes
    ,
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __param(1, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.RegisterAdminDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", Promise)
], AdminAuthController.prototype, "createAdminAccount", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Admin login',
        description: 'Authenticate admin user and return access tokens',
    }),
    (0, swagger_1.ApiBody)({
        type: 'object',
        description: 'Admin login credentials',
        schema: {
            type: 'object',
            required: ['email', 'password'],
            properties: {
                email: {
                    type: 'string',
                    format: 'email',
                    example: 'admin@mentara.com',
                },
                password: { type: 'string', example: 'SecurePass123!' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Login successful',
        schema: {
            type: 'object',
            properties: {
                user: {
                    type: 'object',
                    properties: {
                        id: { type: 'string' },
                        email: { type: 'string' },
                        firstName: { type: 'string' },
                        lastName: { type: 'string' },
                        role: { type: 'string' },
                        emailVerified: { type: 'boolean' },
                    },
                },
                accessToken: { type: 'string' },
                refreshToken: { type: 'string' },
                expiresIn: { type: 'number' },
            },
        },
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({ description: 'Invalid credentials' }),
    (0, swagger_1.ApiTooManyRequestsResponse)({ description: 'Too many login attempts' }),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 300000 } }) // 10 login attempts per 5 minutes
    ,
    (0, common_1.Post)('login'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.LoginDtoSchema))),
    __param(1, (0, common_1.Req)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_b = typeof express_1.Request !== "undefined" && express_1.Request) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], AdminAuthController.prototype, "login", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiOperation)({
        summary: 'Get admin profile',
        description: 'Retrieve the authenticated admin user profile information',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Admin profile retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                id: { type: 'string' },
                email: { type: 'string' },
                firstName: { type: 'string' },
                lastName: { type: 'string' },
                role: { type: 'string' },
                adminLevel: { type: 'string' },
                permissions: { type: 'array', items: { type: 'string' } },
                createdAt: { type: 'string', format: 'date-time' },
                lastLoginAt: { type: 'string', format: 'date-time' },
            },
        },
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({
        description: 'Invalid or missing authentication token',
    }),
    (0, common_1.Get)('profile'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], AdminAuthController.prototype, "getProfile", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiOperation)({
        summary: 'Get admin permissions',
        description: 'Retrieve the permissions for the authenticated admin user',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Admin permissions retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                permissions: { type: 'array', items: { type: 'string' } },
                adminLevel: { type: 'string' },
                canCreateAdmins: { type: 'boolean' },
                canModifyUsers: { type: 'boolean' },
                canAccessAnalytics: { type: 'boolean' },
            },
        },
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({
        description: 'Invalid or missing authentication token',
    }),
    (0, common_1.Get)('permissions'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], AdminAuthController.prototype, "getPermissions", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiOperation)({
        summary: 'Get admin dashboard statistics',
        description: 'Retrieve dashboard statistics and metrics for the admin panel',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Dashboard statistics retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                totalUsers: { type: 'number' },
                totalTherapists: { type: 'number' },
                totalAdmins: { type: 'number' },
                activeUsers: { type: 'number' },
                pendingApplications: { type: 'number' },
                systemHealth: { type: 'string' },
                lastUpdated: { type: 'string', format: 'date-time' },
            },
        },
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({
        description: 'Invalid or missing authentication token',
    }),
    (0, common_1.Get)('dashboard-stats'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], AdminAuthController.prototype, "getDashboardStats", null);
exports.AdminAuthController = AdminAuthController = __decorate([
    (0, swagger_1.ApiTags)('admin-auth'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('auth/admin'),
    __metadata("design:paramtypes", [typeof (_a = typeof admin_auth_service_1.AdminAuthService !== "undefined" && admin_auth_service_1.AdminAuthService) === "function" ? _a : Object])
], AdminAuthController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvY29udHJvbGxlcnMvYWRtaW4tYXV0aC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FVd0I7QUFDeEIsaURBQTZDO0FBQzdDLDZDQVN5QjtBQUN6Qiw2REFBd0Q7QUFDeEQsdUZBQXdFO0FBQ3hFLDJGQUE0RTtBQUM1RSxxRUFBd0Q7QUFDeEQsZ0ZBQTJFO0FBQzNFLHFEQUt5QjtBQUN6Qix1RUFBa0U7QUFDbEUscUNBQWtDO0FBSzNCLElBQU0sbUJBQW1CLEdBQXpCLE1BQU0sbUJBQW1CO0lBQ0Q7SUFBN0IsWUFBNkIsZ0JBQWtDO1FBQWxDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7SUFBRyxDQUFDO0lBcUU3RCxBQUFOLEtBQUssQ0FBQyxrQkFBa0IsQ0FDSCxlQUF1QixFQUUxQyxXQUE2QjtRQUU3Qiw0Q0FBNEM7UUFDNUMsSUFBSSxlQUFlLEtBQUssT0FBTyxFQUFFLENBQUM7WUFDaEMsTUFBTSxJQUFJLDJCQUFrQixDQUFDLHVDQUF1QyxDQUFDLENBQUM7UUFDeEUsQ0FBQztRQUVELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixDQUMzRCxXQUFXLENBQUMsS0FBSyxFQUNqQixXQUFXLENBQUMsUUFBUSxFQUNwQixXQUFXLENBQUMsU0FBUyxFQUNyQixXQUFXLENBQUMsUUFBUSxFQUNwQixXQUFXLENBQUMsVUFBVSxJQUFJLE9BQU8sRUFDakMsV0FBVyxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQzlCLENBQUM7UUFFRixPQUFPO1lBQ0wsSUFBSSxFQUFFO2dCQUNKLEVBQUUsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2xCLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUs7Z0JBQ3hCLFNBQVMsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNB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QVEsRUFBRTtnQkFDL0IsbUJBQW1CLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO2dCQUN2QyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO2dCQUNoQyxXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUU7YUFDckQ7U0FDRjtLQUNGLENBQUM7SUFDRCxJQUFBLGlDQUF1QixFQUFDO1FBQ3ZCLFdBQVcsRUFBRSx5Q0FBeUM7S0FDdkQsQ0FBQztJQUNELElBQUEsWUFBRyxFQUFDLGlCQUFpQixDQUFDO0lBQ0UsV0FBQSxJQUFBLHlDQUFhLEdBQUUsQ0FBQTs7Ozs0REFFdkM7OEJBMVFVLG1CQUFtQjtJQUgvQixJQUFBLGlCQUFPLEVBQUMsWUFBWSxDQUFDO0lBQ3JCLElBQUEsdUJBQWEsRUFBQyxVQUFVLENBQUM7SUFDekIsSUFBQSxtQkFBVSxFQUFDLFlBQVksQ0FBQzt5REFFd0IscUNBQWdCLG9CQUFoQixxQ0FBZ0I7R0FEcEQsbUJBQW1CLENBMlEvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYXV0aC9jb250cm9sbGVycy9hZG1pbi1hdXRoLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQm9keSxcbiAgQ29udHJvbGxlcixcbiAgR2V0LFxuICBQb3N0LFxuICBVc2VHdWFyZHMsXG4gIEh0dHBDb2RlLFxuICBIdHRwU3RhdHVzLFxuICBSZXEsXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVGhyb3R0bGUgfSBmcm9tICdAbmVzdGpzL3Rocm90dGxlcic7XG5pbXBvcnQge1xuICBBcGlUYWdzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVJlc3BvbnNlLFxuICBBcGlCb2R5LFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlVbmF1dGhvcml6ZWRSZXNwb25zZSxcbiAgQXBpRm9yYmlkZGVuUmVzcG9uc2UsXG4gIEFwaVRvb01hbnlSZXF1ZXN0c1Jlc3BvbnNlLFxufSBmcm9tICdAbmVzdGpzL3N3YWdnZXInO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnLi4vZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEN1cnJlbnRVc2VySWQgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1pZC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJSb2xlIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9jdXJyZW50LXVzZXItcm9sZS5kZWNvcmF0b3InO1xuaW1wb3J0IHsgUHVibGljIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9wdWJsaWMuZGVjb3JhdG9yJztcbmltcG9ydCB7IFpvZFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnLi4vLi4vY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHtcbiAgUmVnaXN0ZXJBZG1pbkR0b1NjaGVtYSxcbiAgTG9naW5EdG9TY2hlbWEsXG4gIHR5cGUgUmVnaXN0ZXJBZG1pbkR0byxcbiAgdHlwZSBMb2dpbkR0byxcbn0gZnJvbSAnbWVudGFyYS1jb21tb25zJztcbmltcG9ydCB7IEFkbWluQXV0aFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hZG1pbi1hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuXG5AQXBpVGFncygnYWRtaW4tYXV0aCcpXG5AQXBpQmVhcmVyQXV0aCgnSldULWF1dGgnKVxuQENvbnRyb2xsZXIoJ2F1dGgvYWRtaW4nKVxuZXhwb3J0IGNsYXNzIEFkbWluQXV0aENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGFkbWluQXV0aFNlcnZpY2U6IEFkbWluQXV0aFNlcnZpY2UpIHt9XG5cbiAgQFBvc3QoJ2NyZWF0ZS1hY2NvdW50JylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0NyZWF0ZSBuZXcgYWRtaW4gYWNjb3VudCcsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnQ3JlYXRlIGEgbmV3IGFkbWluIGFjY291bnQuIE9ubHkgZXhpc3RpbmcgYWRtaW5zIGNhbiBjcmVhdGUgbmV3IGFkbWluIGFjY291bnRzLicsXG4gIH0pXG4gIEBBcGlCb2R5KHtcbiAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICBkZXNjcmlwdGlvbjogJ0FkbWluIHJlZ2lzdHJhdGlvbiBkYXRhJyxcbiAgICBzY2hlbWE6IHtcbiAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgcmVxdWlyZWQ6IFsnZW1haWwnLCAncGFzc3dvcmQnLCAnZmlyc3ROYW1lJywgJ2xhc3ROYW1lJ10sXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgZm9ybWF0OiAnZW1haWwnLFxuICAgICAgICAgIGV4YW1wbGU6ICdhZG1pbkBtZW50YXJhLmNvbScsXG4gICAgICAgIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7IHR5cGU6ICdzdHJpbmcnLCBtaW5MZW5ndGg6IDgsIGV4YW1wbGU6ICdTZWN1cmVQYXNzMTIzIScgfSxcbiAgICAgICAgZmlyc3ROYW1lOiB7IHR5cGU6ICdzdHJpbmcnLCBleGFtcGxlOiAnSm9obicgfSxcbiAgICAgICAgbGFzdE5hbWU6IHsgdHlwZTogJ3N0cmluZycsIGV4YW1wbGU6ICdEb2UnIH0sXG4gICAgICAgIGFkbWluTGV2ZWw6IHtcbiAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICBlbnVtOiBbJ2FkbWluJywgJ3N1cGVyX2FkbWluJ10sXG4gICAgICAgICAgZXhhbXBsZTogJ2FkbWluJyxcbiAgICAgICAgfSxcbiAgICAgICAgcGVybWlzc2lvbnM6IHtcbiAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgIGl0ZW1zOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgZXhhbXBsZTogWydyZWFkJywgJ3dyaXRlJ10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDEsXG4gICAgZGVzY3JpcHRpb246ICdBZG1pbiBhY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICBzY2hlbWE6IHtcbiAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgaWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgIGVtYWlsOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICByb2xlOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB7IHR5cGU6ICdib29sZWFuJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2U6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVVuYXV0aG9yaXplZFJlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ0ludmFsaWQgb3IgbWlzc2luZyBhdXRoZW50aWNhdGlvbiB0b2tlbicsXG4gIH0pXG4gIEBBcGlGb3JiaWRkZW5SZXNwb25zZSh7XG4gICAgZGVzY3JpcHRpb246ICdPbmx5IGFkbWlucyBjYW4gY3JlYXRlIGFkbWluIGFjY291bnRzJyxcbiAgfSlcbiAgQEFwaVRvb01hbnlSZXF1ZXN0c1Jlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ1RvbyBtYW55IGFkbWluIGNyZWF0aW9uIGF0dGVtcHRzJyxcbiAgfSlcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDMsIHR0bDogNjAwMDAwIH0gfSkgLy8gMyBhZG1pbiBjcmVhdGlvbnMgcGVyIDEwIG1pbnV0ZXNcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuQ1JFQVRFRClcbiAgYXN5bmMgY3JlYXRlQWRtaW5BY2NvdW50KFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSBjdXJyZW50VXNlclJvbGU6IHN0cmluZyxcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoUmVnaXN0ZXJBZG1pbkR0b1NjaGVtYSkpXG4gICAgcmVnaXN0ZXJEdG86IFJlZ2lzdGVyQWRtaW5EdG8sXG4gICkge1xuICAgIC8vIE9ubHkgc3VwZXIgYWRtaW5zIGNhbiBjcmVhdGUgb3RoZXIgYWRtaW5zXG4gICAgaWYgKGN1cnJlbnRVc2VyUm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignT25seSBhZG1pbnMgY2FuIGNyZWF0ZSBhZG1pbiBhY2NvdW50cycpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWRtaW5BdXRoU2VydmljZS5jcmVhdGVBZG1pbkFjY291bnQoXG4gICAgICByZWdpc3RlckR0by5lbWFpbCxcbiAgICAgIHJlZ2lzdGVyRHRvLnBhc3N3b3JkLFxuICAgICAgcmVnaXN0ZXJEdG8uZmlyc3ROYW1lLFxuICAgICAgcmVnaXN0ZXJEdG8ubGFzdE5hbWUsXG4gICAgICByZWdpc3RlckR0by5hZG1pbkxldmVsIHx8ICdhZG1pbicsXG4gICAgICByZWdpc3RlckR0by5wZXJtaXNzaW9ucyB8fCBbXSxcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IHJlc3VsdC51c2VyLmlkLFxuICAgICAgICBlbWFpbDogcmVzdWx0LnVzZXIuZW1haWwsXG4gICAgICAgIGZpcnN0TmFtZTogcmVzdWx0LnVzZXIuZmlyc3ROYW1lLFxuICAgICAgICBsYXN0TmFtZTogcmVzdWx0LnVzZXIubGFzdE5hbWUsXG4gICAgICAgIHJvbGU6IHJlc3VsdC51c2VyLnJvbGUsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHJlc3VsdC51c2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2UsXG4gICAgfTtcbiAgfVxuXG4gIEBQdWJsaWMoKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnQWRtaW4gbG9naW4nLFxuICAgIGRlc2NyaXB0aW9uOiAnQXV0aGVudGljYXRlIGFkbWluIHVzZXIgYW5kIHJldHVybiBhY2Nlc3MgdG9rZW5zJyxcbiAgfSlcbiAgQEFwaUJvZHkoe1xuICAgIHR5cGU6ICdvYmplY3QnLFxuICAgIGRlc2NyaXB0aW9uOiAnQWRtaW4gbG9naW4gY3JlZGVudGlhbHMnLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICByZXF1aXJlZDogWydlbWFpbCcsICdwYXNzd29yZCddLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGZvcm1hdDogJ2VtYWlsJyxcbiAgICAgICAgICBleGFtcGxlOiAnYWRtaW5AbWVudGFyYS5jb20nLFxuICAgICAgICB9LFxuICAgICAgICBwYXNzd29yZDogeyB0eXBlOiAnc3RyaW5nJywgZXhhbXBsZTogJ1NlY3VyZVBhc3MxMjMhJyB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnTG9naW4gc3VjY2Vzc2Z1bCcsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIGlkOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBlbWFpbDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgZmlyc3ROYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBsYXN0TmFtZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgcm9sZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgZW1haWxWZXJpZmllZDogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NUb2tlbjogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICByZWZyZXNoVG9rZW46IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgZXhwaXJlc0luOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBBcGlVbmF1dGhvcml6ZWRSZXNwb25zZSh7IGRlc2NyaXB0aW9uOiAnSW52YWxpZCBjcmVkZW50aWFscycgfSlcbiAgQEFwaVRvb01hbnlSZXF1ZXN0c1Jlc3BvbnNlKHsgZGVzY3JpcHRpb246ICdUb28gbWFueSBsb2dpbiBhdHRlbXB0cycgfSlcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogMTAsIHR0bDogMzAwMDAwIH0gfSkgLy8gMTAgbG9naW4gYXR0ZW1wdHMgcGVyIDUgbWludXRlc1xuICBAUG9zdCgnbG9naW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgbG9naW4oXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKExvZ2luRHRvU2NoZW1hKSkgbG9naW5EdG86IExvZ2luRHRvLFxuICAgIEBSZXEoKSByZXE6IFJlcXVlc3QsXG4gICkge1xuICAgIGNvbnN0IGlwQWRkcmVzcyA9IHJlcS5pcDtcbiAgICBjb25zdCB1c2VyQWdlbnQgPSByZXEuZ2V0KCdVc2VyLUFnZW50Jyk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFkbWluQXV0aFNlcnZpY2UubG9naW5BZG1pbihcbiAgICAgIGxvZ2luRHRvLmVtYWlsLFxuICAgICAgbG9naW5EdG8ucGFzc3dvcmQsXG4gICAgICBpcEFkZHJlc3MsXG4gICAgICB1c2VyQWdlbnQsXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiByZXN1bHQudXNlci5pZCxcbiAgICAgICAgZW1haWw6IHJlc3VsdC51c2VyLmVtYWlsLFxuICAgICAgICBmaXJzdE5hbWU6IHJlc3VsdC51c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHJlc3VsdC51c2VyLmxhc3ROYW1lLFxuICAgICAgICByb2xlOiByZXN1bHQudXNlci5yb2xlLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiByZXN1bHQudXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgfSxcbiAgICAgIGFjY2Vzc1Rva2VuOiByZXN1bHQudG9rZW5zLmFjY2Vzc1Rva2VuLFxuICAgICAgcmVmcmVzaFRva2VuOiByZXN1bHQudG9rZW5zLnJlZnJlc2hUb2tlbixcbiAgICAgIGV4cGlyZXNJbjogcmVzdWx0LnRva2Vucy5leHBpcmVzSW4sXG4gICAgfTtcbiAgfVxuXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnR2V0IGFkbWluIHByb2ZpbGUnLFxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmUgdGhlIGF1dGhlbnRpY2F0ZWQgYWRtaW4gdXNlciBwcm9maWxlIGluZm9ybWF0aW9uJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0FkbWluIHByb2ZpbGUgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgaWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgZW1haWw6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgZmlyc3ROYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgIGxhc3ROYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgIHJvbGU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgYWRtaW5MZXZlbDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICBwZXJtaXNzaW9uczogeyB0eXBlOiAnYXJyYXknLCBpdGVtczogeyB0eXBlOiAnc3RyaW5nJyB9IH0sXG4gICAgICAgIGNyZWF0ZWRBdDogeyB0eXBlOiAnc3RyaW5nJywgZm9ybWF0OiAnZGF0ZS10aW1lJyB9LFxuICAgICAgICBsYXN0TG9naW5BdDogeyB0eXBlOiAnc3RyaW5nJywgZm9ybWF0OiAnZGF0ZS10aW1lJyB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpVW5hdXRob3JpemVkUmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnSW52YWxpZCBvciBtaXNzaW5nIGF1dGhlbnRpY2F0aW9uIHRva2VuJyxcbiAgfSlcbiAgQEdldCgncHJvZmlsZScpXG4gIGFzeW5jIGdldFByb2ZpbGUoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmFkbWluQXV0aFNlcnZpY2UuZ2V0QWRtaW5Qcm9maWxlKHVzZXJJZCk7XG4gIH1cblxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0dldCBhZG1pbiBwZXJtaXNzaW9ucycsXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBhdXRoZW50aWNhdGVkIGFkbWluIHVzZXInLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnQWRtaW4gcGVybWlzc2lvbnMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcGVybWlzc2lvbnM6IHsgdHlwZTogJ2FycmF5JywgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSB9LFxuICAgICAgICBhZG1pbkxldmVsOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgIGNhbkNyZWF0ZUFkbWluczogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgICAgY2FuTW9kaWZ5VXNlcnM6IHsgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICAgIGNhbkFjY2Vzc0FuYWx5dGljczogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVVuYXV0aG9yaXplZFJlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ0ludmFsaWQgb3IgbWlzc2luZyBhdXRoZW50aWNhdGlvbiB0b2tlbicsXG4gIH0pXG4gIEBHZXQoJ3Blcm1pc3Npb25zJylcbiAgYXN5bmMgZ2V0UGVybWlzc2lvbnMoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmFkbWluQXV0aFNlcnZpY2UuZ2V0QWRtaW5QZXJtaXNzaW9ucyh1c2VySWQpO1xuICB9XG5cbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdHZXQgYWRtaW4gZGFzaGJvYXJkIHN0YXRpc3RpY3MnLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ1JldHJpZXZlIGRhc2hib2FyZCBzdGF0aXN0aWNzIGFuZCBtZXRyaWNzIGZvciB0aGUgYWRtaW4gcGFuZWwnLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRGFzaGJvYXJkIHN0YXRpc3RpY3MgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdG90YWxVc2VyczogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICB0b3RhbFRoZXJhcGlzdHM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgdG90YWxBZG1pbnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgYWN0aXZlVXNlcnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgcGVuZGluZ0FwcGxpY2F0aW9uczogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICBzeXN0ZW1IZWFsdGg6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgbGFzdFVwZGF0ZWQ6IHsgdHlwZTogJ3N0cmluZycsIGZvcm1hdDogJ2RhdGUtdGltZScgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVVuYXV0aG9yaXplZFJlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ0ludmFsaWQgb3IgbWlzc2luZyBhdXRoZW50aWNhdGlvbiB0b2tlbicsXG4gIH0pXG4gIEBHZXQoJ2Rhc2hib2FyZC1zdGF0cycpXG4gIGFzeW5jIGdldERhc2hib2FyZFN0YXRzKEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5hZG1pbkF1dGhTZXJ2aWNlLmdldEFkbWluRGFzaGJvYXJkU3RhdHModXNlcklkKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9