{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/client/client.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/client/client.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport {\n  NotFoundException,\n  InternalServerErrorException,\n  BadRequestException,\n} from '@nestjs/common';\nimport { ClientService } from './client.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { PrismaClientKnownRequestError } from '@prisma/client/runtime/library';\n\ndescribe('ClientService', () => {\n  let service: ClientService;\n  let prismaService: jest.Mocked<PrismaService>;\n\n  const mockClient = {\n    id: 'client-123',\n    userId: 'user-123',\n    hasSeenTherapistRecommendations: false,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    user: {\n      id: 'user-123',\n      email: 'test@example.com',\n      firstName: 'John',\n      lastName: 'Doe',\n      role: 'client',\n    },\n  };\n\n  const mockTherapist = {\n    userId: 'therapist-user-123',\n    hourlyRate: 150,\n    areasOfExpertise: ['Anxiety', 'Depression'],\n    yearsOfExperience: 5,\n    province: 'Metro Manila',\n    status: 'approved',\n    user: {\n      id: 'therapist-user-123',\n      email: 'therapist@example.com',\n      firstName: 'Dr. Jane',\n      lastName: 'Smith',\n      role: 'therapist',\n      title: 'Clinical Psychologist',\n      bio: 'Experienced therapist specializing in anxiety and depression.',\n      profileImage: 'https://example.com/profile.jpg',\n    },\n  };\n\n  beforeEach(async () => {\n    const mockPrismaService = {\n      client: {\n        findUnique: jest.fn(),\n        update: jest.fn(),\n      },\n      clientTherapist: {\n        findFirst: jest.fn(),\n      },\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        ClientService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n      ],\n    }).compile();\n\n    service = module.get<ClientService>(ClientService);\n    prismaService = module.get(PrismaService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('getProfile', () => {\n    it('should return client profile successfully', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockResolvedValue(\n        mockClient,\n      );\n\n      const result = await service.getProfile('user-123');\n\n      expect(result).toEqual(mockClient);\n      expect(prismaService.client.findUnique).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n        include: { user: true },\n      });\n    });\n\n    it('should throw NotFoundException when client not found', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockResolvedValue(null);\n\n      await expect(service.getProfile('nonexistent-user')).rejects.toThrow(\n        NotFoundException,\n      );\n      expect(prismaService.client.findUnique).toHaveBeenCalledWith({\n        where: { userId: 'nonexistent-user' },\n        include: { user: true },\n      });\n    });\n\n    it('should throw InternalServerErrorException on database error', async () => {\n      const dbError = new PrismaClientKnownRequestError('Database error', {\n        code: 'P2002',\n        clientVersion: '4.0.0',\n      });\n      (prismaService.client.findUnique as jest.Mock).mockRejectedValue(dbError);\n\n      await expect(service.getProfile('user-123')).rejects.toThrow(\n        InternalServerErrorException,\n      );\n    });\n\n    it('should throw InternalServerErrorException on unexpected error', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockRejectedValue(\n        new Error('Unexpected error'),\n      );\n\n      await expect(service.getProfile('user-123')).rejects.toThrow(\n        InternalServerErrorException,\n      );\n    });\n  });\n\n  describe('updateProfile', () => {\n    const updateData = {\n      email: 'updated@example.com',\n      firstName: 'UpdatedName',\n      middleName: 'UpdatedMiddle',\n      lastName: 'UpdatedLastName',\n      birthDate: '1990-01-01',\n      address: '123 Updated St',\n      avatarUrl: 'https://example.com/avatar.jpg',\n      role: 'client',\n      bio: 'Updated bio',\n      coverImageUrl: 'https://example.com/cover.jpg',\n      isActive: true,\n    };\n\n    it('should update client profile successfully', async () => {\n      const updatedClient = {\n        ...mockClient,\n        user: { ...mockClient.user, ...updateData },\n      };\n      (prismaService.client.update as jest.Mock).mockResolvedValue(\n        updatedClient,\n      );\n\n      const result = await service.updateProfile('user-123', updateData);\n\n      expect(result).toEqual(updatedClient);\n      expect(prismaService.client.update).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n        data: {\n          user: {\n            update: updateData,\n          },\n        },\n        include: { user: true },\n      });\n    });\n\n    it('should throw NotFoundException when client not found for update', async () => {\n      const dbError = new PrismaClientKnownRequestError('Record not found', {\n        code: 'P2025',\n        clientVersion: '4.0.0',\n      });\n      (prismaService.client.update as jest.Mock).mockRejectedValue(dbError);\n\n      await expect(\n        service.updateProfile('nonexistent-user', updateData),\n      ).rejects.toThrow(NotFoundException);\n    });\n\n    it('should throw BadRequestException on unique constraint violation', async () => {\n      const dbError = new PrismaClientKnownRequestError(\n        'Unique constraint violation',\n        {\n          code: 'P2002',\n          clientVersion: '4.0.0',\n        },\n      );\n      (prismaService.client.update as jest.Mock).mockRejectedValue(dbError);\n\n      await expect(\n        service.updateProfile('user-123', updateData),\n      ).rejects.toThrow(BadRequestException);\n    });\n\n    it('should throw InternalServerErrorException on other database errors', async () => {\n      const dbError = new PrismaClientKnownRequestError(\n        'Other database error',\n        {\n          code: 'P2001',\n          clientVersion: '4.0.0',\n        },\n      );\n      (prismaService.client.update as jest.Mock).mockRejectedValue(dbError);\n\n      await expect(\n        service.updateProfile('user-123', updateData),\n      ).rejects.toThrow(InternalServerErrorException);\n    });\n  });\n\n  describe('needsTherapistRecommendations', () => {\n    it('should return true when client has not seen recommendations', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockResolvedValue({\n        hasSeenTherapistRecommendations: false,\n      });\n\n      const result = await service.needsTherapistRecommendations('user-123');\n\n      expect(result).toBe(true);\n      expect(prismaService.client.findUnique).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n        select: { hasSeenTherapistRecommendations: true },\n      });\n    });\n\n    it('should return false when client has seen recommendations', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockResolvedValue({\n        hasSeenTherapistRecommendations: true,\n      });\n\n      const result = await service.needsTherapistRecommendations('user-123');\n\n      expect(result).toBe(false);\n    });\n\n    it('should return true when client not found', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockResolvedValue(null);\n\n      const result = await service.needsTherapistRecommendations('user-123');\n\n      expect(result).toBe(true);\n    });\n\n    it('should throw InternalServerErrorException on database error', async () => {\n      (prismaService.client.findUnique as jest.Mock).mockRejectedValue(\n        new Error('Database error'),\n      );\n\n      await expect(\n        service.needsTherapistRecommendations('user-123'),\n      ).rejects.toThrow(InternalServerErrorException);\n    });\n  });\n\n  describe('markTherapistRecommendationsSeen', () => {\n    it('should mark recommendations as seen successfully', async () => {\n      const updatedClient = {\n        ...mockClient,\n        hasSeenTherapistRecommendations: true,\n      };\n      (prismaService.client.update as jest.Mock).mockResolvedValue(\n        updatedClient,\n      );\n\n      await service.markTherapistRecommendationsSeen('user-123');\n\n      expect(prismaService.client.update).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n        data: { hasSeenTherapistRecommendations: true },\n      });\n    });\n\n    it('should throw NotFoundException when client not found', async () => {\n      const dbError = new PrismaClientKnownRequestError('Record not found', {\n        code: 'P2025',\n        clientVersion: '4.0.0',\n      });\n      (prismaService.client.update as jest.Mock).mockRejectedValue(dbError);\n\n      await expect(\n        service.markTherapistRecommendationsSeen('nonexistent-user'),\n      ).rejects.toThrow(NotFoundException);\n    });\n\n    it('should throw InternalServerErrorException on other errors', async () => {\n      (prismaService.client.update as jest.Mock).mockRejectedValue(\n        new Error('Unexpected error'),\n      );\n\n      await expect(\n        service.markTherapistRecommendationsSeen('user-123'),\n      ).rejects.toThrow(InternalServerErrorException);\n    });\n  });\n\n  describe('getAssignedTherapist', () => {\n    it('should return assigned therapist successfully', async () => {\n      const mockAssignment = {\n        therapist: mockTherapist,\n      };\n      (prismaService.clientTherapist.findFirst as jest.Mock).mockResolvedValue(\n        mockAssignment,\n      );\n\n      const result = await service.getAssignedTherapist('user-123');\n\n      expect(result).toEqual({\n        id: mockTherapist.userId,\n        firstName: mockTherapist.user.firstName,\n        lastName: mockTherapist.user.lastName,\n        title: mockTherapist.user.title,\n        specialties: mockTherapist.areasOfExpertise,\n        hourlyRate: Number(mockTherapist.hourlyRate),\n        experience: mockTherapist.yearsOfExperience,\n        province: mockTherapist.province,\n        isActive: mockTherapist.status === 'approved',\n        bio: mockTherapist.user.bio,\n        profileImage: mockTherapist.user.profileImage,\n      });\n      expect(prismaService.clientTherapist.findFirst).toHaveBeenCalledWith({\n        where: {\n          clientId: 'user-123',\n          status: 'active',\n        },\n        include: {\n          therapist: {\n            include: { user: true },\n          },\n        },\n        orderBy: { assignedAt: 'desc' },\n      });\n    });\n\n    it('should return null when no active assignment found', async () => {\n      (prismaService.clientTherapist.findFirst as jest.Mock).mockResolvedValue(\n        null,\n      );\n\n      const result = await service.getAssignedTherapist('user-123');\n\n      expect(result).toBeNull();\n    });\n\n    it('should return null when assignment has no therapist', async () => {\n      (prismaService.clientTherapist.findFirst as jest.Mock).mockResolvedValue({\n        therapist: null,\n      });\n\n      const result = await service.getAssignedTherapist('user-123');\n\n      expect(result).toBeNull();\n    });\n  });\n});\n"],"version":3}