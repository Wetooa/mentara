{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/controllers/community-recommendation.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/controllers/community-recommendation.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Param,\n  Body,\n  Query,\n  UseGuards,\n  HttpStatus,\n  HttpCode,\n  ParseUUIDPipe,\n} from '@nestjs/common';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiParam,\n  ApiQuery,\n  ApiBearerAuth,\n} from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { RoleBasedAccessGuard } from '../../auth/guards/role-based-access.guard';\nimport { Roles } from '../../auth/decorators/roles.decorator';\nimport { GetUser } from '../../decorators/get-user.decorator';\nimport { CommunityRecommendationService } from '../services/community-recommendation.service';\nimport {\n  ValidatedBody,\n  ValidatedQuery,\n} from '../../common/decorators/validate-body.decorator';\nimport {\n  GenerateRecommendationsDtoSchema,\n  RecommendationInteractionDtoSchema,\n  RecommendationQueryDtoSchema,\n  type GenerateRecommendationsDto,\n  type RecommendationInteractionDto,\n  type RecommendationQueryDto,\n} from 'mentara-commons';\n\n@ApiTags('Community Recommendations')\n@ApiTags('community-recommendation')\n@ApiBearerAuth('JWT-auth')\n@Controller('communities/recommendations')\n@UseGuards(JwtAuthGuard, RoleBasedAccessGuard)\n@ApiBearerAuth()\nexport class CommunityRecommendationController {\n  constructor(\n    private readonly communityRecommendationService: CommunityRecommendationService,\n  ) {}\n\n  @Post('generate')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({\n    summary: 'Generate community recommendations for current user',\n    description:\n      'Generates personalized community recommendations based on user assessment scores',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Recommendations generated successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        data: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              userId: { type: 'string' },\n              community: {\n                type: 'object',\n                properties: {\n                  id: { type: 'string' },\n                  name: { type: 'string' },\n                  slug: { type: 'string' },\n                  description: { type: 'string' },\n                  imageUrl: { type: 'string' },\n                  memberCount: { type: 'number' },\n                },\n              },\n              compatibilityScore: { type: 'number' },\n              reasoning: { type: 'string' },\n              assessmentScores: { type: 'object' },\n              isAccepted: { type: 'boolean', nullable: true },\n              createdAt: { type: 'string', format: 'date-time' },\n              updatedAt: { type: 'string', format: 'date-time' },\n            },\n          },\n        },\n        message: { type: 'string' },\n      },\n    },\n  })\n  @ApiResponse({\n    status: 404,\n    description: 'User not found',\n  })\n  @ApiResponse({\n    status: 500,\n    description: 'Internal server error',\n  })\n  async generateRecommendations(\n    @GetUser() user: any,\n    @ValidatedBody(GenerateRecommendationsDtoSchema)\n    dto: GenerateRecommendationsDto,\n  ) {\n    try {\n      await this.communityRecommendationService.generateRecommendationsForUser(\n        user.id,\n        dto.force,\n      );\n\n      const recommendations =\n        await this.communityRecommendationService.getUserRecommendations(\n          user.id,\n        );\n\n      return {\n        success: true,\n        data: recommendations,\n        message: `Generated ${recommendations.length} recommendations`,\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Get('me')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @ApiOperation({\n    summary: 'Get current user recommendations',\n    description: 'Retrieves all community recommendations for the current user',\n  })\n  @ApiQuery({\n    name: 'status',\n    required: false,\n    enum: ['pending', 'accepted', 'rejected'],\n    description: 'Filter by recommendation status',\n  })\n  @ApiQuery({\n    name: 'sortBy',\n    required: false,\n    enum: ['compatibility', 'created', 'updated'],\n    description: 'Sort recommendations by field',\n  })\n  @ApiQuery({\n    name: 'sortOrder',\n    required: false,\n    enum: ['asc', 'desc'],\n    description: 'Sort order',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'User recommendations retrieved successfully',\n  })\n  async getUserRecommendations(\n    @GetUser() user: any,\n    @ValidatedQuery(RecommendationQueryDtoSchema) query: RecommendationQueryDto,\n  ) {\n    try {\n      let recommendations =\n        await this.communityRecommendationService.getUserRecommendations(\n          user.id,\n        );\n\n      // Apply status filter if provided\n      if (query.status) {\n        recommendations = recommendations.filter((rec) => {\n          if (query.status === 'pending') return rec.status === 'pending';\n          if (query.status === 'accepted') return rec.status === 'joined';\n          if (query.status === 'rejected') return rec.status === 'dismissed';\n          return true;\n        });\n      }\n\n      // Apply sorting if provided\n      if (query.sortBy) {\n        recommendations.sort((a, b) => {\n          let aValue: any, bValue: any;\n\n          switch (query.sortBy) {\n            case 'compatibility':\n              aValue = a.score;\n              bValue = b.score;\n              break;\n            case 'created':\n              aValue = new Date(a.createdAt || 0);\n              bValue = new Date(b.createdAt || 0);\n              break;\n            case 'updated':\n              aValue = new Date(a.updatedAt || 0);\n              bValue = new Date(b.updatedAt || 0);\n              break;\n            default:\n              aValue = a.score;\n              bValue = b.score;\n          }\n\n          const order = query.sortOrder === 'asc' ? 1 : -1;\n          return aValue > bValue ? order : aValue < bValue ? -order : 0;\n        });\n      }\n\n      return {\n        success: true,\n        data: recommendations,\n        message: 'Recommendations retrieved successfully',\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Get(':recommendationId')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @ApiOperation({\n    summary: 'Get recommendation details',\n    description:\n      'Retrieves detailed information about a specific recommendation',\n  })\n  @ApiParam({\n    name: 'recommendationId',\n    type: 'string',\n    format: 'uuid',\n    description: 'Unique identifier of the recommendation',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Recommendation details retrieved successfully',\n  })\n  @ApiResponse({\n    status: 404,\n    description: 'Recommendation not found',\n  })\n  async getRecommendationDetails(\n    @GetUser() user: any,\n    @Param('recommendationId', ParseUUIDPipe) recommendationId: string,\n  ) {\n    try {\n      const recommendation =\n        await this.communityRecommendationService.getRecommendationById(\n          recommendationId,\n        );\n\n      return {\n        success: true,\n        data: recommendation,\n        message: 'Recommendation details retrieved successfully',\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Put(':recommendationId/interact')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({\n    summary: 'Interact with recommendation',\n    description: 'Accept or reject a community recommendation',\n  })\n  @ApiParam({\n    name: 'recommendationId',\n    type: 'string',\n    format: 'uuid',\n    description: 'Unique identifier of the recommendation',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Recommendation interaction processed successfully',\n  })\n  @ApiResponse({\n    status: 404,\n    description: 'Recommendation not found',\n  })\n  @ApiResponse({\n    status: 400,\n    description: 'Invalid interaction action',\n  })\n  async handleRecommendationInteraction(\n    @GetUser() user: any,\n    @Param('recommendationId', ParseUUIDPipe) recommendationId: string,\n    @ValidatedBody(RecommendationInteractionDtoSchema)\n    dto: RecommendationInteractionDto,\n  ) {\n    try {\n      await this.communityRecommendationService.handleRecommendationInteraction(\n        {\n          recommendationId,\n          action: dto.action,\n          userId: user.id,\n        },\n      );\n\n      return {\n        success: true,\n        message: `Recommendation ${dto.action}ed successfully`,\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Post('refresh')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({\n    summary: 'Refresh user recommendations',\n    description: 'Regenerates recommendations based on updated assessment data',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Recommendations refreshed successfully',\n  })\n  async refreshRecommendations(@GetUser() user: any) {\n    try {\n      await this.communityRecommendationService.generateRecommendationsForUser(\n        user.id,\n        true, // force refresh\n      );\n\n      return {\n        success: true,\n        message: 'Recommendations refreshed successfully',\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Get('stats/me')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @ApiOperation({\n    summary: 'Get user recommendation statistics',\n    description: 'Retrieves recommendation statistics for the current user',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'User recommendation statistics retrieved successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        data: {\n          type: 'object',\n          properties: {\n            totalRecommendations: { type: 'number' },\n            acceptedRecommendations: { type: 'number' },\n            rejectedRecommendations: { type: 'number' },\n            pendingRecommendations: { type: 'number' },\n            averageCompatibilityScore: { type: 'number' },\n            topCommunities: {\n              type: 'array',\n              items: {\n                type: 'object',\n                properties: {\n                  communityId: { type: 'string' },\n                  communityName: { type: 'string' },\n                  acceptanceRate: { type: 'number' },\n                  totalRecommendations: { type: 'number' },\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n  })\n  async getUserRecommendationStats(@GetUser() user: any) {\n    try {\n      const stats =\n        await this.communityRecommendationService.getRecommendationStats();\n\n      return {\n        success: true,\n        data: stats,\n        message: 'User recommendation statistics retrieved successfully',\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  @Get('stats/global')\n  @Roles('admin', 'moderator')\n  @ApiOperation({\n    summary: 'Get global recommendation statistics',\n    description:\n      'Retrieves platform-wide recommendation statistics (admin/moderator only)',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Global recommendation statistics retrieved successfully',\n  })\n  @ApiResponse({\n    status: 403,\n    description: 'Insufficient permissions',\n  })\n  async getGlobalRecommendationStats() {\n    try {\n      const stats =\n        await this.communityRecommendationService.getRecommendationStats();\n\n      return {\n        success: true,\n        data: stats,\n        message: 'Global recommendation statistics retrieved successfully',\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n}\n"],"version":3}