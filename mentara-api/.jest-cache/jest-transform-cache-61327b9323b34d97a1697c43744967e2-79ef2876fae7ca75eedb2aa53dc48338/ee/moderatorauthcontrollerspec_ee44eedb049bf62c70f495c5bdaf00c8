ae7307a381b977872a400e5832bd1141
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const moderator_auth_controller_1 = require("./moderator-auth.controller");
const moderator_auth_service_1 = require("../services/moderator-auth.service");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const zod_validation_pipe_1 = require("../../common/pipes/zod-validation.pipe");
const auth_testing_helpers_1 = require("../../test-utils/auth-testing-helpers");
describe('ModeratorAuthController', () => {
    let controller;
    let moderatorAuthService;
    let mockJwtAuthGuard;
    // Test data constants
    const mockModeratorUser = {
        id: auth_testing_helpers_1.TEST_USER_IDS.MODERATOR,
        email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
        firstName: 'Jane',
        lastName: 'Moderator',
        role: 'moderator',
        emailVerified: true,
        permissions: ['moderate_posts', 'ban_users', 'delete_comments'],
        assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP],
        createdAt: new Date(),
        lastLoginAt: new Date(),
    };
    const mockTokens = {
        accessToken: 'mock-access-token',
        refreshToken: 'mock-refresh-token',
        expiresIn: 3600,
    };
    const mockCreateAccountResult = {
        user: mockModeratorUser,
        message: 'Moderator account created successfully',
    };
    const mockLoginResult = {
        user: mockModeratorUser,
        tokens: mockTokens,
    };
    const mockPermissions = {
        permissions: ['moderate_posts', 'ban_users', 'delete_comments'],
        canModeratePosts: true,
        canBanUsers: true,
        canDeleteComments: true,
        canAccessReports: true,
    };
    const mockAssignedCommunities = {
        assignedCommunities: [
            {
                id: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                name: 'Anxiety Support',
                description: 'A supportive community for anxiety management',
                memberCount: 150,
                pendingPosts: 5,
            },
            {
                id: auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP,
                name: 'Depression Help',
                description: 'Support for depression recovery',
                memberCount: 120,
                pendingPosts: 3,
            },
        ],
    };
    const mockDashboardStats = {
        totalPostsModerated: 45,
        pendingReports: 8,
        communitiesManaged: 2,
        usersModerated: 12,
        recentActivity: [
            {
                action: 'post_moderated',
                timestamp: new Date().toISOString(),
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
            },
            {
                action: 'user_banned',
                timestamp: new Date().toISOString(),
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP,
            },
        ],
    };
    beforeEach(async () => {
        // Create mock services
        const mockModeratorAuthService = {
            createModeratorAccount: jest.fn(),
            loginModerator: jest.fn(),
            getModeratorProfile: jest.fn(),
            getModeratorPermissions: jest.fn(),
            getAssignedCommunities: jest.fn(),
            getModeratorDashboardStats: jest.fn(),
        };
        mockJwtAuthGuard = {
            canActivate: jest.fn().mockReturnValue(true),
        };
        const module = await testing_1.Test.createTestingModule({
            imports: [
                throttler_1.ThrottlerModule.forRoot([
                    {
                        name: 'short',
                        ttl: 1000,
                        limit: 3,
                    },
                ]),
            ],
            controllers: [moderator_auth_controller_1.ModeratorAuthController],
            providers: [
                {
                    provide: moderator_auth_service_1.ModeratorAuthService,
                    useValue: mockModeratorAuthService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: jest.fn().mockReturnValue(true) })
            .compile();
        controller = module.get(moderator_auth_controller_1.ModeratorAuthController);
        moderatorAuthService = module.get(moderator_auth_service_1.ModeratorAuthService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('createModeratorAccount', () => {
        const validRegisterDto = {
            email: 'newmoderator@mentara.com',
            password: 'SecurePass123!',
            firstName: 'New',
            lastName: 'Moderator',
            permissions: ['moderate_posts', 'ban_users'],
            assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
        };
        it('should create moderator account successfully for admin user', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', validRegisterDto);
            // Assert
            expect(moderatorAuthService.createModeratorAccount).toHaveBeenCalledWith(validRegisterDto.email, validRegisterDto.password, validRegisterDto.firstName, validRegisterDto.lastName, validRegisterDto.permissions, validRegisterDto.assignedCommunities);
            expect(result).toEqual({
                user: {
                    id: mockModeratorUser.id,
                    email: mockModeratorUser.email,
                    firstName: mockModeratorUser.firstName,
                    lastName: mockModeratorUser.lastName,
                    role: mockModeratorUser.role,
                    emailVerified: mockModeratorUser.emailVerified,
                },
                message: mockCreateAccountResult.message,
            });
        });
        it('should create moderator account with optional fields', async () => {
            // Arrange
            const minimalRegisterDto = {
                email: 'minimal@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Minimal',
                lastName: 'Moderator',
            };
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', minimalRegisterDto);
            // Assert
            expect(moderatorAuthService.createModeratorAccount).toHaveBeenCalledWith(minimalRegisterDto.email, minimalRegisterDto.password, minimalRegisterDto.firstName, minimalRegisterDto.lastName, [], // empty permissions array
            []);
            expect(result).toBeDefined();
        });
        it('should throw ForbiddenException for non-admin users', async () => {
            // Act & Assert
            await expect(controller.createModeratorAccount('client', validRegisterDto)).rejects.toThrow(common_1.ForbiddenException);
            await expect(controller.createModeratorAccount('therapist', validRegisterDto)).rejects.toThrow(common_1.ForbiddenException);
            await expect(controller.createModeratorAccount('moderator', validRegisterDto)).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle email already exists error', async () => {
            // Arrange
            const error = new common_1.BadRequestException('Email already exists');
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.createModeratorAccount('admin', validRegisterDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.createModeratorAccount('admin', validRegisterDto)).rejects.toThrow(error);
        });
    });
    describe('login', () => {
        const validLoginDto = {
            email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
            password: 'SecurePass123!',
        };
        const mockRequest = {
            ip: '192.168.1.1',
            get: jest.fn().mockReturnValue('Test User Agent'),
        };
        it('should login moderator successfully with valid credentials', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(validLoginDto, mockRequest);
            // Assert
            expect(moderatorAuthService.loginModerator).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequest.ip, 'Test User Agent');
            expect(result).toEqual({
                user: {
                    id: mockModeratorUser.id,
                    email: mockModeratorUser.email,
                    firstName: mockModeratorUser.firstName,
                    lastName: mockModeratorUser.lastName,
                    role: mockModeratorUser.role,
                    emailVerified: mockModeratorUser.emailVerified,
                },
                accessToken: mockTokens.accessToken,
                refreshToken: mockTokens.refreshToken,
                expiresIn: mockTokens.expiresIn,
            });
        });
        it('should handle missing User-Agent header', async () => {
            // Arrange
            const mockRequestWithoutUserAgent = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue(undefined),
            };
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            await controller.login(validLoginDto, mockRequestWithoutUserAgent);
            // Assert
            expect(moderatorAuthService.loginModerator).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequestWithoutUserAgent.ip, undefined);
        });
        it('should handle invalid credentials', async () => {
            // Arrange
            const authError = new common_1.UnauthorizedException('Invalid credentials');
            jest.spyOn(moderatorAuthService, 'loginModerator').mockRejectedValue(authError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(authError);
        });
        it('should handle service errors', async () => {
            // Arrange
            const serviceError = new Error('Database connection failed');
            jest.spyOn(moderatorAuthService, 'loginModerator').mockRejectedValue(serviceError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(serviceError);
        });
    });
    describe('getProfile', () => {
        it('should return moderator profile successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockResolvedValue(mockModeratorUser);
            // Act
            const result = await controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getModeratorProfile).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockModeratorUser);
        });
        it('should handle profile not found', async () => {
            // Arrange
            const notFoundError = new Error('Moderator profile not found');
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('getPermissions', () => {
        it('should return moderator permissions successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockResolvedValue(mockPermissions);
            // Act
            const result = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getModeratorPermissions).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockPermissions);
        });
        it('should handle permissions not found', async () => {
            // Arrange
            const notFoundError = new Error('Moderator permissions not found');
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('getAssignedCommunities', () => {
        it('should return assigned communities successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getAssignedCommunities').mockResolvedValue(mockAssignedCommunities);
            // Act
            const result = await controller.getAssignedCommunities(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getAssignedCommunities).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockAssignedCommunities);
        });
        it('should handle assigned communities not found', async () => {
            // Arrange
            const notFoundError = new Error('Assigned communities not found');
            jest.spyOn(moderatorAuthService, 'getAssignedCommunities').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getAssignedCommunities(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('getDashboardStats', () => {
        it('should return dashboard statistics successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const result = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getModeratorDashboardStats).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockDashboardStats);
        });
        it('should handle dashboard stats not found', async () => {
            // Arrange
            const notFoundError = new Error('Dashboard stats not found');
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('Security Tests', () => {
        it('should validate input data through ZodValidationPipe', () => {
            // This tests that the controller uses proper validation
            const validationPipe = new zod_validation_pipe_1.ZodValidationPipe({});
            expect(validationPipe).toBeDefined();
        });
        it('should apply rate limiting through ThrottlerGuard', () => {
            // Test that throttling is configured
            const createAccountMetadata = Reflect.getMetadata('__throttler_options__', controller.createModeratorAccount);
            const loginMetadata = Reflect.getMetadata('__throttler_options__', controller.login);
            expect(createAccountMetadata).toBeDefined();
            expect(loginMetadata).toBeDefined();
        });
        it('should require authentication for protected endpoints', () => {
            // Test that protected endpoints have JwtAuthGuard
            const protectedMethods = ['createModeratorAccount', 'getProfile', 'getPermissions', 'getAssignedCommunities', 'getDashboardStats'];
            protectedMethods.forEach(method => {
                const guards = Reflect.getMetadata('__guards__', controller[method]);
                expect(guards).toBeDefined();
            });
        });
        it('should allow public access to login endpoint', () => {
            // Test that login endpoint is marked as public
            const publicMetadata = Reflect.getMetadata('isPublic', controller.login);
            expect(publicMetadata).toBeTruthy();
        });
    });
    describe('Role-based Access Control', () => {
        it('should test role-based access for moderator creation', async () => {
            // Test that only admin role can create moderators
            const registerDto = {
                email: 'test@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Test',
                lastName: 'Moderator',
            };
            await auth_testing_helpers_1.RoleBasedTestUtils.testWithRoles(async (userId, role) => {
                try {
                    await controller.createModeratorAccount(role, registerDto);
                    return true;
                }
                catch (error) {
                    return false;
                }
            }, {
                client: false,
                therapist: false,
                admin: true,
                moderator: false,
            });
        });
        it('should validate moderator-specific functionality', async () => {
            // Test that moderator-specific endpoints work for moderators
            const moderatorContext = auth_testing_helpers_1.MockBuilder.createAuthContext('moderator');
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockResolvedValue(mockModeratorUser);
            const result = await controller.getProfile(moderatorContext.userId);
            expect(result).toBeDefined();
            expect(result.role).toBe('moderator');
        });
    });
    describe('Error Handling', () => {
        it('should handle network errors gracefully', async () => {
            // Arrange
            const networkError = new Error('Network timeout');
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockRejectedValue(networkError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(networkError);
        });
        it('should handle validation errors', async () => {
            // Test that invalid data would be caught by the validation pipe
            const invalidData = {
                email: 'invalid-email',
                password: '123', // Too short
                firstName: '',
                lastName: '',
            };
            // In a real scenario, this would throw a validation error
            // The pipe would catch this before it reaches the controller
            expect(() => {
                // This would be handled by ZodValidationPipe
                // and would throw a BadRequestException
            }).not.toThrow();
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete moderator account creation workflow', async () => {
            // Arrange
            const createAccountDto = {
                email: 'integration@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Integration',
                lastName: 'Test',
                permissions: ['moderate_posts', 'ban_users'],
                assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
            };
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', createAccountDto);
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockModeratorUser.email);
            expect(result.user.role).toBe('moderator');
            expect(result.message).toBe(mockCreateAccountResult.message);
        });
        it('should handle complete moderator login workflow', async () => {
            // Arrange
            const loginDto = {
                email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
                password: 'SecurePass123!',
            };
            const mockRequest = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue('Test User Agent'),
            };
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(loginDto, mockRequest);
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockModeratorUser.email);
            expect(result.accessToken).toBe(mockTokens.accessToken);
            expect(result.refreshToken).toBe(mockTokens.refreshToken);
            expect(result.expiresIn).toBe(mockTokens.expiresIn);
        });
        it('should handle complete moderator profile workflow', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockResolvedValue(mockModeratorUser);
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockResolvedValue(mockPermissions);
            jest.spyOn(moderatorAuthService, 'getAssignedCommunities').mockResolvedValue(mockAssignedCommunities);
            // Act - Get profile
            const profile = await controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Act - Get permissions
            const permissions = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Act - Get assigned communities
            const communities = await controller.getAssignedCommunities(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(profile).toBeDefined();
            expect(profile.role).toBe('moderator');
            expect(profile.permissions).toEqual(mockModeratorUser.permissions);
            expect(permissions).toBeDefined();
            expect(permissions.canModeratePosts).toBe(true);
            expect(permissions.canBanUsers).toBe(true);
            expect(communities).toBeDefined();
            expect(communities.assignedCommunities).toHaveLength(2);
        });
        it('should handle complete moderator dashboard workflow', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const stats = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(stats).toBeDefined();
            expect(stats.totalPostsModerated).toBe(45);
            expect(stats.pendingReports).toBe(8);
            expect(stats.communitiesManaged).toBe(2);
            expect(stats.recentActivity).toHaveLength(2);
        });
    });
    describe('Data Validation', () => {
        it('should validate moderator creation data structure', () => {
            // Test that we're using the correct DTO structure
            const validModeratorData = {
                email: 'test@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Test',
                lastName: 'Moderator',
                permissions: ['moderate_posts', 'ban_users'],
                assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
            };
            // Verify all required fields are present
            expect(validModeratorData.email).toBeDefined();
            expect(validModeratorData.password).toBeDefined();
            expect(validModeratorData.firstName).toBeDefined();
            expect(validModeratorData.lastName).toBeDefined();
            expect(validModeratorData.permissions).toBeDefined();
            expect(validModeratorData.assignedCommunities).toBeDefined();
        });
        it('should validate login data structure', () => {
            // Test that we're using the correct DTO structure
            const validLoginData = {
                email: 'test@mentara.com',
                password: 'SecurePass123!',
            };
            // Verify all required fields are present
            expect(validLoginData.email).toBeDefined();
            expect(validLoginData.password).toBeDefined();
        });
    });
    describe('Response Format Validation', () => {
        it('should return correctly formatted moderator creation response', async () => {
            // Arrange
            const createAccountDto = {
                email: 'format@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Format',
                lastName: 'Test',
                permissions: ['moderate_posts'],
                assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
            };
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', createAccountDto);
            // Assert
            expect(result).toHaveProperty('user');
            expect(result).toHaveProperty('message');
            expect(result).not.toHaveProperty('accessToken'); // Creation doesn't include tokens
            expect(result).not.toHaveProperty('refreshToken');
            expect(result.user).toHaveProperty('id');
            expect(result.user).toHaveProperty('email');
            expect(result.user).toHaveProperty('firstName');
            expect(result.user).toHaveProperty('lastName');
            expect(result.user).toHaveProperty('role');
            expect(result.user).toHaveProperty('emailVerified');
        });
        it('should return correctly formatted login response', async () => {
            // Arrange
            const loginDto = {
                email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
                password: 'SecurePass123!',
            };
            const mockRequest = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue('Test User Agent'),
            };
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(loginDto, mockRequest);
            // Assert
            expect(result).toHaveProperty('user');
            expect(result).toHaveProperty('accessToken');
            expect(result).toHaveProperty('refreshToken');
            expect(result).toHaveProperty('expiresIn');
            expect(result).not.toHaveProperty('message'); // Login doesn't include message
        });
        it('should return correctly formatted permissions response', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockResolvedValue(mockPermissions);
            // Act
            const result = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(result).toHaveProperty('permissions');
            expect(result).toHaveProperty('canModeratePosts');
            expect(result).toHaveProperty('canBanUsers');
            expect(result).toHaveProperty('canDeleteComments');
            expect(result).toHaveProperty('canAccessReports');
            expect(result.permissions).toBeInstanceOf(Array);
            expect(result.canModeratePosts).toBe(true);
            expect(result.canBanUsers).toBe(true);
        });
        it('should return correctly formatted dashboard stats response', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const result = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(result).toHaveProperty('totalPostsModerated');
            expect(result).toHaveProperty('pendingReports');
            expect(result).toHaveProperty('communitiesManaged');
            expect(result).toHaveProperty('usersModerated');
            expect(result).toHaveProperty('recentActivity');
            expect(result.totalPostsModerated).toBe(45);
            expect(result.recentActivity).toBeInstanceOf(Array);
            expect(result.recentActivity).toHaveLength(2);
        });
    });
    describe('Admin-only Functionality', () => {
        it('should enforce admin-only access for moderator creation', async () => {
            // Arrange
            const createAccountDto = {
                email: 'admin-only@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Admin',
                lastName: 'Only',
            };
            // Test each role
            const roles = ['client', 'therapist', 'moderator'];
            for (const role of roles) {
                await expect(controller.createModeratorAccount(role, createAccountDto)).rejects.toThrow(common_1.ForbiddenException);
            }
            // Test admin access
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            const result = await controller.createModeratorAccount('admin', createAccountDto);
            expect(result).toBeDefined();
        });
        it('should validate admin role before moderator creation', async () => {
            // Arrange
            const createAccountDto = {
                email: 'validation@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Validation',
                lastName: 'Test',
            };
            // Act & Assert
            await expect(controller.createModeratorAccount('invalid-role', createAccountDto)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvY29udHJvbGxlcnMvbW9kZXJhdG9yLWF1dGguY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDJDQUl3QjtBQUN4QixpREFBb0U7QUFDcEUsMkVBQXNFO0FBQ3RFLCtFQUEwRTtBQUMxRSw2REFBd0Q7QUFDeEQsZ0ZBQTJFO0FBQzNFLGdGQVMrQztBQUUvQyxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUksVUFBbUMsQ0FBQztJQUN4QyxJQUFJLG9CQUEwQyxDQUFDO0lBQy9DLElBQUksZ0JBQTJDLENBQUM7SUFFaEQsc0JBQXNCO0lBQ3RCLE1BQU0saUJBQWlCLEdBQUc7UUFDeEIsRUFBRSxFQUFFLG9DQUFhLENBQUMsU0FBUztRQUMzQixLQUFLLEVBQUUsa0NBQVcsQ0FBQyxTQUFTO1FBQzVCLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLFFBQVEsRUFBRSxXQUFXO1FBQ3JCLElBQUksRUFBRSxXQUFXO1FBQ2pCLGFBQWEsRUFBRSxJQUFJO1FBQ25CLFdBQVcsRUFBRSxDQUFDLGdCQUFnQixFQUFFLFdBQVcsRUFBRSxpQkFBaUIsQ0FBQztRQUMvRCxtQkFBbUIsRUFBRSxDQUFDLHlDQUFrQixDQUFDLGVBQWUsRUFBRSx5Q0FBa0IsQ0FBQyxlQUFlLENBQUM7UUFDN0YsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtLQUN4QixDQUFDO0lBRUYsTUFBTSxVQUFVLEdBQUc7UUFDakIsV0FBVyxFQUFFLG1CQUFtQjtRQUNoQyxZQUFZLEVBQUUsb0JBQW9CO1FBQ2xDLFNBQVMsRUFBRSxJQUFJO0tBQ2hCLENBQUM7SUFFRixNQUFNLHVCQUF1QixHQUFHO1FBQzlCLElBQUksRUFBRSxpQkFBaUI7UUFDdkIsT0FBTyxFQUFFLHdDQUF3QztLQUNsRCxDQUFD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Q2pCLE1BQU0sS0FBSyxHQUFHLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUVuRCxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUN6QixNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUNyRiwyQkFBa0IsQ0FDbkIsQ0FBQztZQUNKLENBQUM7WUFFRCxvQkFBb0I7WUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDdEcsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsT0FBTyxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFDbEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BFLFVBQVU7WUFDVixNQUFNLGdCQUFnQixHQUFHO2dCQUN2QixLQUFLLEVBQUUsd0JBQXdCO2dCQUMvQixRQUFRLEVBQUUsZ0JBQWdCO2dCQUMxQixTQUFTLEVBQUUsWUFBWTtnQkFDdkIsUUFBUSxFQUFFLE1BQU07YUFDakIsQ0FBQztZQUVGLGVBQWU7WUFDZixNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQUMsY0FBYyxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUMvRiwyQkFBa0IsQ0FDbkIsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYXV0aC9jb250cm9sbGVycy9tb2RlcmF0b3ItYXV0aC5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBcbiAgVW5hdXRob3JpemVkRXhjZXB0aW9uLCBcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbiwgXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbiBcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVGhyb3R0bGVyR3VhcmQsIFRocm90dGxlck1vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGhyb3R0bGVyJztcbmltcG9ydCB7IE1vZGVyYXRvckF1dGhDb250cm9sbGVyIH0gZnJvbSAnLi9tb2RlcmF0b3ItYXV0aC5jb250cm9sbGVyJztcbmltcG9ydCB7IE1vZGVyYXRvckF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbW9kZXJhdG9yLWF1dGguc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICcuLi8uLi9jb21tb24vcGlwZXMvem9kLXZhbGlkYXRpb24ucGlwZSc7XG5pbXBvcnQge1xuICBNb2NrQnVpbGRlcixcbiAgVGVzdERhdGFHZW5lcmF0b3IsXG4gIFRlc3RBc3NlcnRpb25zLFxuICBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLFxuICBSb2xlQmFzZWRUZXN0VXRpbHMsXG4gIFRFU1RfVVNFUl9JRFMsXG4gIFRFU1RfRU1BSUxTLFxuICBURVNUX0NPTU1VTklUWV9JRFMsXG59IGZyb20gJy4uLy4uL3Rlc3QtdXRpbHMvYXV0aC10ZXN0aW5nLWhlbHBlcnMnO1xuXG5kZXNjcmliZSgnTW9kZXJhdG9yQXV0aENvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBNb2RlcmF0b3JBdXRoQ29udHJvbGxlcjtcbiAgbGV0IG1vZGVyYXRvckF1dGhTZXJ2aWNlOiBNb2RlcmF0b3JBdXRoU2VydmljZTtcbiAgbGV0IG1vY2tKd3RBdXRoR3VhcmQ6IGplc3QuTW9ja2VkPEp3dEF1dGhHdWFyZD47XG5cbiAgLy8gVGVzdCBkYXRhIGNvbnN0YW50c1xuICBjb25zdCBtb2NrTW9kZXJhdG9yVXNlciA9IHtcbiAgICBpZDogVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IsXG4gICAgZW1haWw6IFRFU1RfRU1BSUxTLk1PREVSQVRPUixcbiAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICBsYXN0TmFtZTogJ01vZGVyYXRvcicsXG4gICAgcm9sZTogJ21vZGVyYXRvcicsXG4gICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICBwZXJtaXNzaW9uczogWydtb2RlcmF0ZV9wb3N0cycsICdiYW5fdXNlcnMnLCAnZGVsZXRlX2NvbW1lbnRzJ10sXG4gICAgYXNzaWduZWRDb21tdW5pdGllczogW1RFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIFRFU1RfQ09NTVVOSVRZX0lEUy5ERVBSRVNTSU9OX0hFTFBdLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICBsYXN0TG9naW5BdDogbmV3IERhdGUoKSxcbiAgfTtcblxuICBjb25zdCBtb2NrVG9rZW5zID0ge1xuICAgIGFjY2Vzc1Rva2VuOiAnbW9jay1hY2Nlc3MtdG9rZW4nLFxuICAgIHJlZnJlc2hUb2tlbjogJ21vY2stcmVmcmVzaC10b2tlbicsXG4gICAgZXhwaXJlc0luOiAzNjAwLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0ID0ge1xuICAgIHVzZXI6IG1vY2tNb2RlcmF0b3JVc2VyLFxuICAgIG1lc3NhZ2U6ICdNb2RlcmF0b3IgYWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gIH07XG5cbiAgY29uc3QgbW9ja0xvZ2luUmVzdWx0ID0ge1xuICAgIHVzZXI6IG1vY2tNb2RlcmF0b3JVc2VyLFxuICAgIHRva2VuczogbW9ja1Rva2VucyxcbiAgfTtcblxuICBjb25zdCBtb2NrUGVybWlzc2lvbnMgPSB7XG4gICAgcGVybWlzc2lvbnM6IFsnbW9kZXJhdGVfcG9zdHMnLCAnYmFuX3VzZXJzJywgJ2RlbGV0ZV9jb21tZW50cyddLFxuICAgIGNhbk1vZGVyYXRlUG9zdHM6IHRydWUsXG4gICAgY2FuQmFuVXNlcnM6IHRydWUsXG4gICAgY2FuRGVsZXRlQ29tbWVudHM6IHRydWUsXG4gICAgY2FuQWNjZXNzUmVwb3J0czogdHJ1ZSxcbiAgfTtcblxuICBjb25zdCBtb2NrQXNzaWduZWRDb21tdW5pdGllcyA9IHtcbiAgICBhc3NpZ25lZENvbW11bml0aWVzOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICBuYW1lOiAnQW54aWV0eSBTdXBwb3J0JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBIHN1cHBvcnRpdmUgY29tbXVuaXR5IGZvciBhbnhpZXR5IG1hbmFnZW1lbnQnLFxuICAgICAgICBtZW1iZXJDb3VudDogMTUwLFxuICAgICAgICBwZW5kaW5nUG9zdHM6IDUsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogVEVTVF9DT01NVU5JVFlfSURTLkRFUFJFU1NJT05fSEVMUCxcbiAgICAgICAgbmFtZTogJ0RlcHJlc3Npb24gSGVscCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnU3VwcG9ydCBmb3IgZGVwcmVzc2lvbiByZWNvdmVyeScsXG4gICAgICAgIG1lbWJlckNvdW50OiAxMjAsXG4gICAgICAgIHBlbmRpbmdQb3N0czogMyxcbiAgICAgIH0sXG4gICAgXSxcbiAgfTtcblxuICBjb25zdCBtb2NrRGFzaGJvYXJkU3RhdHMgPSB7XG4gICAgdG90YWxQb3N0c01vZGVyYXRlZDogNDUsXG4gICAgcGVuZGluZ1JlcG9ydHM6IDgsXG4gICAgY29tbXVuaXRpZXNNYW5hZ2VkOiAyLFxuICAgIHVzZXJzTW9kZXJhdGVkOiAxMixcbiAgICByZWNlbnRBY3Rpdml0eTogW1xuICAgICAge1xuICAgICAgICBhY3Rpb246ICdwb3N0X21vZGVyYXRlZCcsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGFjdGlvbjogJ3VzZXJfYmFubmVkJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGNvbW11bml0eUlkOiBURVNUX0NPTU1VTklUWV9JRFMuREVQUkVTU0lPTl9IRUxQLFxuICAgICAgfSxcbiAgICBdLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBtb2NrIHNlcnZpY2VzXG4gICAgY29uc3QgbW9ja01vZGVyYXRvckF1dGhTZXJ2aWNlID0ge1xuICAgICAgY3JlYXRlTW9kZXJhdG9yQWNjb3VudDogamVzdC5mbigpLFxuICAgICAgbG9naW5Nb2RlcmF0b3I6IGplc3QuZm4oKSxcbiAgICAgIGdldE1vZGVyYXRvclByb2ZpbGU6IGplc3QuZm4oKSxcbiAgICAgIGdldE1vZGVyYXRvclBlcm1pc3Npb25zOiBqZXN0LmZuKCksXG4gICAgICBnZXRBc3NpZ25lZENvbW11bml0aWVzOiBqZXN0LmZuKCksXG4gICAgICBnZXRNb2RlcmF0b3JEYXNoYm9hcmRTdGF0czogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBtb2NrSnd0QXV0aEd1YXJkID0ge1xuICAgICAgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgaW1wb3J0czogW1xuICAgICAgICBUaHJvdHRsZXJNb2R1bGUuZm9yUm9vdChbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ3Nob3J0JyxcbiAgICAgICAgICAgIHR0bDogMTAwMCxcbiAgICAgICAgICAgIGxpbWl0OiAzLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0pLFxuICAgICAgXSxcbiAgICAgIGNvbnRyb2xsZXJzOiBbTW9kZXJhdG9yQXV0aENvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBNb2RlcmF0b3JBdXRoU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja01vZGVyYXRvckF1dGhTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KVxuICAgICAgLm92ZXJyaWRlR3VhcmQoSnd0QXV0aEd1YXJkKVxuICAgICAgLnVzZVZhbHVlKG1vY2tKd3RBdXRoR3VhcmQpXG4gICAgICAub3ZlcnJpZGVHdWFyZChUaHJvdHRsZXJHdWFyZClcbiAgICAgIC51c2VWYWx1ZSh7IGNhbkFjdGl2YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpIH0pXG4gICAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8TW9kZXJhdG9yQXV0aENvbnRyb2xsZXI+KE1vZGVyYXRvckF1dGhDb250cm9sbGVyKTtcbiAgICBtb2RlcmF0b3JBdXRoU2VydmljZSA9IG1vZHVsZS5nZXQ8TW9kZXJhdG9yQXV0aFNlcnZpY2U+KE1vZGVyYXRvckF1dGhTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZU1vZGVyYXRvckFjY291bnQnLCAoKSA9PiB7XG4gICAgY29uc3QgdmFsaWRSZWdpc3RlckR0byA9IHtcbiAgICAgIGVtYWlsOiAnbmV3bW9kZXJhdG9yQG1lbnRhcmEuY29tJyxcbiAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgZmlyc3ROYW1lOiAnTmV3JyxcbiAgICAgIGxhc3ROYW1lOiAnTW9kZXJhdG9yJyxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ21vZGVyYXRlX3Bvc3RzJywgJ2Jhbl91c2VycyddLFxuICAgICAgYXNzaWduZWRDb21tdW5pdGllczogW1RFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlRdLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBtb2RlcmF0b3IgYWNjb3VudCBzdWNjZXNzZnVsbHkgZm9yIGFkbWluIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ2FkbWluJywgdmFsaWRSZWdpc3RlckR0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vZGVyYXRvckF1dGhTZXJ2aWNlLmNyZWF0ZU1vZGVyYXRvckFjY291bnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLmVtYWlsLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLnBhc3N3b3JkLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLmZpcnN0TmFtZSxcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5sYXN0TmFtZSxcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5wZXJtaXNzaW9ucyxcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5hc3NpZ25lZENvbW11bml0aWVzLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IG1vY2tNb2RlcmF0b3JVc2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiBtb2NrTW9kZXJhdG9yVXNlci5lbWFpbCxcbiAgICAgICAgICBmaXJzdE5hbWU6IG1vY2tNb2RlcmF0b3JVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbW9ja01vZGVyYXRvclVzZXIubGFzdE5hbWUsXG4gICAgICAgICAgcm9sZTogbW9ja01vZGVyYXRvclVzZXIucm9sZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBtb2NrTW9kZXJhdG9yVXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlOiBtb2NrQ3JlYXRlQWNjb3VudFJlc3VsdC5tZXNzYWdlLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBtb2RlcmF0b3IgYWNjb3VudCB3aXRoIG9wdGlvbmFsIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1pbmltYWxSZWdpc3RlckR0byA9IHtcbiAgICAgICAgZW1haWw6ICdtaW5pbWFsQG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ01pbmltYWwnLFxuICAgICAgICBsYXN0TmFtZTogJ01vZGVyYXRvcicsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ2FkbWluJywgbWluaW1hbFJlZ2lzdGVyRHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9kZXJhdG9yQXV0aFNlcnZpY2UuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1pbmltYWxSZWdpc3RlckR0by5lbWFpbCxcbiAgICAgICAgbWluaW1hbFJlZ2lzdGVyRHRvLnBhc3N3b3JkLFxuICAgICAgICBtaW5pbWFsUmVnaXN0ZXJEdG8uZmlyc3ROYW1lLFxuICAgICAgICBtaW5pbWFsUmVnaXN0ZXJEdG8ubGFzdE5hbWUsXG4gICAgICAgIFtdLCAvLyBlbXB0eSBwZXJtaXNzaW9ucyBhcnJheVxuICAgICAgICBbXSwgLy8gZW1wdHkgYXNzaWduZWRDb21tdW5pdGllcyBhcnJheVxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiBmb3Igbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCdjbGllbnQnLCB2YWxpZFJlZ2lzdGVyRHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBGb3JiaWRkZW5FeGNlcHRpb24sXG4gICAgICApO1xuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgndGhlcmFwaXN0JywgdmFsaWRSZWdpc3RlckR0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgRm9yYmlkZGVuRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ21vZGVyYXRvcicsIHZhbGlkUmVnaXN0ZXJEdG8pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbWFpbCBhbHJlYWR5IGV4aXN0cyBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcpLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCdhZG1pbicsIHZhbGlkUmVnaXN0ZXJEdG8pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdjcmVhdGVNb2RlcmF0b3JBY2NvdW50JykubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ2FkbWluJywgdmFsaWRSZWdpc3RlckR0bykpLnJlamVjdHMudG9UaHJvdyhlcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsb2dpbicsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZExvZ2luRHRvID0ge1xuICAgICAgZW1haWw6IFRFU1RfRU1BSUxTLk1PREVSQVRPUixcbiAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgIH07XG5cbiAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgIGlwOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdUZXN0IFVzZXIgQWdlbnQnKSxcbiAgICB9IGFzIGFueTtcblxuICAgIGl0KCdzaG91bGQgbG9naW4gbW9kZXJhdG9yIHN1Y2Nlc3NmdWxseSB3aXRoIHZhbGlkIGNyZWRlbnRpYWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2xvZ2luTW9kZXJhdG9yJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvZ2luUmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmxvZ2luKHZhbGlkTG9naW5EdG8sIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9kZXJhdG9yQXV0aFNlcnZpY2UubG9naW5Nb2RlcmF0b3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB2YWxpZExvZ2luRHRvLmVtYWlsLFxuICAgICAgICB2YWxpZExvZ2luRHRvLnBhc3N3b3JkLFxuICAgICAgICBtb2NrUmVxdWVzdC5pcCxcbiAgICAgICAgJ1Rlc3QgVXNlciBBZ2VudCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBtb2NrTW9kZXJhdG9yVXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogbW9ja01vZGVyYXRvclVzZXIuZW1haWwsXG4gICAgICAgICAgZmlyc3ROYW1lOiBtb2NrTW9kZXJhdG9yVXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgbGFzdE5hbWU6IG1vY2tNb2RlcmF0b3JVc2VyLmxhc3ROYW1lLFxuICAgICAgICAgIHJvbGU6IG1vY2tNb2RlcmF0b3JVc2VyLnJvbGUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogbW9ja01vZGVyYXRvclVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgICAgfSxcbiAgICAgICAgYWNjZXNzVG9rZW46IG1vY2tUb2tlbnMuYWNjZXNzVG9rZW4sXG4gICAgICAgIHJlZnJlc2hUb2tlbjogbW9ja1Rva2Vucy5yZWZyZXNoVG9rZW4sXG4gICAgICAgIGV4cGlyZXNJbjogbW9ja1Rva2Vucy5leHBpcmVzSW4sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgVXNlci1BZ2VudCBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdFdpdGhvdXRVc2VyQWdlbnQgPSB7XG4gICAgICAgIGlwOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnbG9naW5Nb2RlcmF0b3InKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG9naW5SZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIubG9naW4odmFsaWRMb2dpbkR0bywgbW9ja1JlcXVlc3RXaXRob3V0VXNlckFnZW50KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9kZXJhdG9yQXV0aFNlcnZpY2UubG9naW5Nb2RlcmF0b3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB2YWxpZExvZ2luRHRvLmVtYWlsLFxuICAgICAgICB2YWxpZExvZ2luRHRvLnBhc3N3b3JkLFxuICAgICAgICBtb2NrUmVxdWVzdFdpdGhvdXRVc2VyQWdlbnQuaXAsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGNyZWRlbnRpYWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgYXV0aEVycm9yID0gbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2xvZ2luTW9kZXJhdG9yJykubW9ja1JlamVjdGVkVmFsdWUoYXV0aEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5sb2dpbih2YWxpZExvZ2luRHRvLCBtb2NrUmVxdWVzdCkpLnJlamVjdHMudG9UaHJvdyhhdXRoRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnbG9naW5Nb2RlcmF0b3InKS5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmxvZ2luKHZhbGlkTG9naW5EdG8sIG1vY2tSZXF1ZXN0KSkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQcm9maWxlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIG1vZGVyYXRvciBwcm9maWxlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JQcm9maWxlJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvclVzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vZGVyYXRvckF1dGhTZXJ2aWNlLmdldE1vZGVyYXRvclByb2ZpbGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01vZGVyYXRvclVzZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcHJvZmlsZSBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdNb2RlcmF0b3IgcHJvZmlsZSBub3QgZm91bmQnKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JQcm9maWxlJykubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShURVNUX1VTRVJfSURTLk1PREVSQVRPUikpLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFBlcm1pc3Npb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIG1vZGVyYXRvciBwZXJtaXNzaW9ucyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yUGVybWlzc2lvbnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGVybWlzc2lvbnMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UGVybWlzc2lvbnMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JBdXRoU2VydmljZS5nZXRNb2RlcmF0b3JQZXJtaXNzaW9ucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGVybWlzc2lvbnMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGVybWlzc2lvbnMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignTW9kZXJhdG9yIHBlcm1pc3Npb25zIG5vdCBmb3VuZCcpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclBlcm1pc3Npb25zJykubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0UGVybWlzc2lvbnMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBc3NpZ25lZENvbW11bml0aWVzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFzc2lnbmVkIGNvbW11bml0aWVzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRBc3NpZ25lZENvbW11bml0aWVzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Fzc2lnbmVkQ29tbXVuaXRpZXMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QXNzaWduZWRDb21tdW5pdGllcyhURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vZGVyYXRvckF1dGhTZXJ2aWNlLmdldEFzc2lnbmVkQ29tbXVuaXRpZXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0Fzc2lnbmVkQ29tbXVuaXRpZXMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXNzaWduZWQgY29tbXVuaXRpZXMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignQXNzaWduZWQgY29tbXVuaXRpZXMgbm90IGZvdW5kJyk7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0QXNzaWduZWRDb21tdW5pdGllcycpLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldEFzc2lnbmVkQ29tbXVuaXRpZXMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXREYXNoYm9hcmRTdGF0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBkYXNoYm9hcmQgc3RhdGlzdGljcyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yRGFzaGJvYXJkU3RhdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGFzaGJvYXJkU3RhdHMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0RGFzaGJvYXJkU3RhdHMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JBdXRoU2VydmljZS5nZXRNb2RlcmF0b3JEYXNoYm9hcmRTdGF0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRGFzaGJvYXJkU3RhdHMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGFzaGJvYXJkIHN0YXRzIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5vdEZvdW5kRXJyb3IgPSBuZXcgRXJyb3IoJ0Rhc2hib2FyZCBzdGF0cyBub3QgZm91bmQnKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JEYXNoYm9hcmRTdGF0cycpLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldERhc2hib2FyZFN0YXRzKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKSkucmVqZWN0cy50b1Rocm93KG5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBpbnB1dCBkYXRhIHRocm91Z2ggWm9kVmFsaWRhdGlvblBpcGUnLCAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHRlc3RzIHRoYXQgdGhlIGNvbnRyb2xsZXIgdXNlcyBwcm9wZXIgdmFsaWRhdGlvblxuICAgICAgY29uc3QgdmFsaWRhdGlvblBpcGUgPSBuZXcgWm9kVmFsaWRhdGlvblBpcGUoe30gYXMgYW55KTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0aW9uUGlwZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXBwbHkgcmF0ZSBsaW1pdGluZyB0aHJvdWdoIFRocm90dGxlckd1YXJkJywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IHRocm90dGxpbmcgaXMgY29uZmlndXJlZFxuICAgICAgY29uc3QgY3JlYXRlQWNjb3VudE1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnX190aHJvdHRsZXJfb3B0aW9uc19fJywgY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KTtcbiAgICAgIGNvbnN0IGxvZ2luTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdfX3Rocm90dGxlcl9vcHRpb25zX18nLCBjb250cm9sbGVyLmxvZ2luKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNyZWF0ZUFjY291bnRNZXRhZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChsb2dpbk1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uIGZvciBwcm90ZWN0ZWQgZW5kcG9pbnRzJywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IHByb3RlY3RlZCBlbmRwb2ludHMgaGF2ZSBKd3RBdXRoR3VhcmRcbiAgICAgIGNvbnN0IHByb3RlY3RlZE1ldGhvZHMgPSBbJ2NyZWF0ZU1vZGVyYXRvckFjY291bnQnLCAnZ2V0UHJvZmlsZScsICdnZXRQZXJtaXNzaW9ucycsICdnZXRBc3NpZ25lZENvbW11bml0aWVzJywgJ2dldERhc2hib2FyZFN0YXRzJ107XG4gICAgICBcbiAgICAgIHByb3RlY3RlZE1ldGhvZHMuZm9yRWFjaChtZXRob2QgPT4ge1xuICAgICAgICBjb25zdCBndWFyZHMgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdfX2d1YXJkc19fJywgY29udHJvbGxlclttZXRob2QgYXMga2V5b2YgTW9kZXJhdG9yQXV0aENvbnRyb2xsZXJdKTtcbiAgICAgICAgZXhwZWN0KGd1YXJkcykudG9CZURlZmluZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBwdWJsaWMgYWNjZXNzIHRvIGxvZ2luIGVuZHBvaW50JywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IGxvZ2luIGVuZHBvaW50IGlzIG1hcmtlZCBhcyBwdWJsaWNcbiAgICAgIGNvbnN0IHB1YmxpY01ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnaXNQdWJsaWMnLCBjb250cm9sbGVyLmxvZ2luKTtcbiAgICAgIGV4cGVjdChwdWJsaWNNZXRhZGF0YSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUm9sZS1iYXNlZCBBY2Nlc3MgQ29udHJvbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRlc3Qgcm9sZS1iYXNlZCBhY2Nlc3MgZm9yIG1vZGVyYXRvciBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBvbmx5IGFkbWluIHJvbGUgY2FuIGNyZWF0ZSBtb2RlcmF0b3JzXG4gICAgICBjb25zdCByZWdpc3RlckR0byA9IHtcbiAgICAgICAgZW1haWw6ICd0ZXN0QG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBsYXN0TmFtZTogJ01vZGVyYXRvcicsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBSb2xlQmFzZWRUZXN0VXRpbHMudGVzdFdpdGhSb2xlcyhcbiAgICAgICAgYXN5bmMgKHVzZXJJZDogc3RyaW5nLCByb2xlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KHJvbGUsIHJlZ2lzdGVyRHRvKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY2xpZW50OiBmYWxzZSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IGZhbHNlLFxuICAgICAgICAgIGFkbWluOiB0cnVlLFxuICAgICAgICAgIG1vZGVyYXRvcjogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBtb2RlcmF0b3Itc3BlY2lmaWMgZnVuY3Rpb25hbGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBtb2RlcmF0b3Itc3BlY2lmaWMgZW5kcG9pbnRzIHdvcmsgZm9yIG1vZGVyYXRvcnNcbiAgICAgIGNvbnN0IG1vZGVyYXRvckNvbnRleHQgPSBNb2NrQnVpbGRlci5jcmVhdGVBdXRoQ29udGV4dCgnbW9kZXJhdG9yJyk7XG4gICAgICBcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JQcm9maWxlJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvclVzZXIpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFByb2ZpbGUobW9kZXJhdG9yQ29udGV4dC51c2VySWQpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yb2xlKS50b0JlKCdtb2RlcmF0b3InKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5ldHdvcmsgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBuZXR3b3JrRXJyb3IgPSBuZXcgRXJyb3IoJ05ldHdvcmsgdGltZW91dCcpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclByb2ZpbGUnKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXR3b3JrRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFByb2ZpbGUoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpKS5yZWplY3RzLnRvVGhyb3cobmV0d29ya0Vycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZhbGlkYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IGludmFsaWQgZGF0YSB3b3VsZCBiZSBjYXVnaHQgYnkgdGhlIHZhbGlkYXRpb24gcGlwZVxuICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAnaW52YWxpZC1lbWFpbCcsXG4gICAgICAgIHBhc3N3b3JkOiAnMTIzJywgLy8gVG9vIHNob3J0XG4gICAgICAgIGZpcnN0TmFtZTogJycsXG4gICAgICAgIGxhc3ROYW1lOiAnJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIEluIGEgcmVhbCBzY2VuYXJpbywgdGhpcyB3b3VsZCB0aHJvdyBhIHZhbGlkYXRpb24gZXJyb3JcbiAgICAgIC8vIFRoZSBwaXBlIHdvdWxkIGNhdGNoIHRoaXMgYmVmb3JlIGl0IHJlYWNoZXMgdGhlIGNvbnRyb2xsZXJcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIC8vIFRoaXMgd291bGQgYmUgaGFuZGxlZCBieSBab2RWYWxpZGF0aW9uUGlwZVxuICAgICAgICAvLyBhbmQgd291bGQgdGhyb3cgYSBCYWRSZXF1ZXN0RXhjZXB0aW9uXG4gICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgbW9kZXJhdG9yIGFjY291bnQgY3JlYXRpb24gd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjcmVhdGVBY2NvdW50RHRvID0ge1xuICAgICAgICBlbWFpbDogJ2ludGVncmF0aW9uQG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0ludGVncmF0aW9uJyxcbiAgICAgICAgbGFzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgcGVybWlzc2lvbnM6IFsnbW9kZXJhdGVfcG9zdHMnLCAnYmFuX3VzZXJzJ10sXG4gICAgICAgIGFzc2lnbmVkQ29tbXVuaXRpZXM6IFtURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUXSxcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdjcmVhdGVNb2RlcmF0b3JBY2NvdW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZUFjY291bnRSZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnYWRtaW4nLCBjcmVhdGVBY2NvdW50RHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLmVtYWlsKS50b0JlKG1vY2tNb2RlcmF0b3JVc2VyLmVtYWlsKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlci5yb2xlKS50b0JlKCdtb2RlcmF0b3InKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9CZShtb2NrQ3JlYXRlQWNjb3VudFJlc3VsdC5tZXNzYWdlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXRlIG1vZGVyYXRvciBsb2dpbiB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGxvZ2luRHRvID0ge1xuICAgICAgICBlbWFpbDogVEVTVF9FTUFJTFMuTU9ERVJBVE9SLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdUZXN0IFVzZXIgQWdlbnQnKSxcbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnbG9naW5Nb2RlcmF0b3InKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG9naW5SZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubG9naW4obG9naW5EdG8sIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLmVtYWlsKS50b0JlKG1vY2tNb2RlcmF0b3JVc2VyLmVtYWlsKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWNjZXNzVG9rZW4pLnRvQmUobW9ja1Rva2Vucy5hY2Nlc3NUb2tlbik7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZnJlc2hUb2tlbikudG9CZShtb2NrVG9rZW5zLnJlZnJlc2hUb2tlbik7XG4gICAgICBleHBlY3QocmVzdWx0LmV4cGlyZXNJbikudG9CZShtb2NrVG9rZW5zLmV4cGlyZXNJbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBtb2RlcmF0b3IgcHJvZmlsZSB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JQcm9maWxlJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvclVzZXIpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclBlcm1pc3Npb25zJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Blcm1pc3Npb25zKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRBc3NpZ25lZENvbW11bml0aWVzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Fzc2lnbmVkQ29tbXVuaXRpZXMpO1xuXG4gICAgICAvLyBBY3QgLSBHZXQgcHJvZmlsZVxuICAgICAgY29uc3QgcHJvZmlsZSA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG4gICAgICBcbiAgICAgIC8vIEFjdCAtIEdldCBwZXJtaXNzaW9uc1xuICAgICAgY29uc3QgcGVybWlzc2lvbnMgPSBhd2FpdCBjb250cm9sbGVyLmdldFBlcm1pc3Npb25zKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcbiAgICAgIFxuICAgICAgLy8gQWN0IC0gR2V0IGFzc2lnbmVkIGNvbW11bml0aWVzXG4gICAgICBjb25zdCBjb21tdW5pdGllcyA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QXNzaWduZWRDb21tdW5pdGllcyhURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHByb2ZpbGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocHJvZmlsZS5yb2xlKS50b0JlKCdtb2RlcmF0b3InKTtcbiAgICAgIGV4cGVjdChwcm9maWxlLnBlcm1pc3Npb25zKS50b0VxdWFsKG1vY2tNb2RlcmF0b3JVc2VyLnBlcm1pc3Npb25zKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmNhbk1vZGVyYXRlUG9zdHMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuQmFuVXNlcnMpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb21tdW5pdGllcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChjb21tdW5pdGllcy5hc3NpZ25lZENvbW11bml0aWVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBtb2RlcmF0b3IgZGFzaGJvYXJkIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvckRhc2hib2FyZFN0YXRzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Rhc2hib2FyZFN0YXRzKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0RGFzaGJvYXJkU3RhdHMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChzdGF0cykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFBvc3RzTW9kZXJhdGVkKS50b0JlKDQ1KTtcbiAgICAgIGV4cGVjdChzdGF0cy5wZW5kaW5nUmVwb3J0cykudG9CZSg4KTtcbiAgICAgIGV4cGVjdChzdGF0cy5jb21tdW5pdGllc01hbmFnZWQpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoc3RhdHMucmVjZW50QWN0aXZpdHkpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGEgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG1vZGVyYXRvciBjcmVhdGlvbiBkYXRhIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCB3ZSdyZSB1c2luZyB0aGUgY29ycmVjdCBEVE8gc3RydWN0dXJlXG4gICAgICBjb25zdCB2YWxpZE1vZGVyYXRvckRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAndGVzdEBtZW50YXJhLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgICBmaXJzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgbGFzdE5hbWU6ICdNb2RlcmF0b3InLFxuICAgICAgICBwZXJtaXNzaW9uczogWydtb2RlcmF0ZV9wb3N0cycsICdiYW5fdXNlcnMnXSxcbiAgICAgICAgYXNzaWduZWRDb21tdW5pdGllczogW1RFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlRdLFxuICAgICAgfTtcblxuICAgICAgLy8gVmVyaWZ5IGFsbCByZXF1aXJlZCBmaWVsZHMgYXJlIHByZXNlbnRcbiAgICAgIGV4cGVjdCh2YWxpZE1vZGVyYXRvckRhdGEuZW1haWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodmFsaWRNb2RlcmF0b3JEYXRhLnBhc3N3b3JkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHZhbGlkTW9kZXJhdG9yRGF0YS5maXJzdE5hbWUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodmFsaWRNb2RlcmF0b3JEYXRhLmxhc3ROYW1lKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHZhbGlkTW9kZXJhdG9yRGF0YS5wZXJtaXNzaW9ucykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh2YWxpZE1vZGVyYXRvckRhdGEuYXNzaWduZWRDb21tdW5pdGllcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgbG9naW4gZGF0YSBzdHJ1Y3R1cmUnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgd2UncmUgdXNpbmcgdGhlIGNvcnJlY3QgRFRPIHN0cnVjdHVyZVxuICAgICAgY29uc3QgdmFsaWRMb2dpbkRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAndGVzdEBtZW50YXJhLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgfTtcblxuICAgICAgLy8gVmVyaWZ5IGFsbCByZXF1aXJlZCBmaWVsZHMgYXJlIHByZXNlbnRcbiAgICAgIGV4cGVjdCh2YWxpZExvZ2luRGF0YS5lbWFpbCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh2YWxpZExvZ2luRGF0YS5wYXNzd29yZCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Jlc3BvbnNlIEZvcm1hdCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3RseSBmb3JtYXR0ZWQgbW9kZXJhdG9yIGNyZWF0aW9uIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgY3JlYXRlQWNjb3VudER0byA9IHtcbiAgICAgICAgZW1haWw6ICdmb3JtYXRAbWVudGFyYS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnRm9ybWF0JyxcbiAgICAgICAgbGFzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgcGVybWlzc2lvbnM6IFsnbW9kZXJhdGVfcG9zdHMnXSxcbiAgICAgICAgYXNzaWduZWRDb21tdW5pdGllczogW1RFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlRdLFxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2NyZWF0ZU1vZGVyYXRvckFjY291bnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ3JlYXRlQWNjb3VudFJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCdhZG1pbicsIGNyZWF0ZUFjY291bnREdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd1c2VyJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnbWVzc2FnZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkubm90LnRvSGF2ZVByb3BlcnR5KCdhY2Nlc3NUb2tlbicpOyAvLyBDcmVhdGlvbiBkb2Vzbid0IGluY2x1ZGUgdG9rZW5zXG4gICAgICBleHBlY3QocmVzdWx0KS5ub3QudG9IYXZlUHJvcGVydHkoJ3JlZnJlc2hUb2tlbicpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIpLnRvSGF2ZVByb3BlcnR5KCdpZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyKS50b0hhdmVQcm9wZXJ0eSgnZW1haWwnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcikudG9IYXZlUHJvcGVydHkoJ2ZpcnN0TmFtZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyKS50b0hhdmVQcm9wZXJ0eSgnbGFzdE5hbWUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcikudG9IYXZlUHJvcGVydHkoJ3JvbGUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcikudG9IYXZlUHJvcGVydHkoJ2VtYWlsVmVyaWZpZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3RseSBmb3JtYXR0ZWQgbG9naW4gcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBsb2dpbkR0byA9IHtcbiAgICAgICAgZW1haWw6IFRFU1RfRU1BSUxTLk1PREVSQVRPUixcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdCBVc2VyIEFnZW50JyksXG4gICAgICB9IGFzIGFueTtcblxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2xvZ2luTW9kZXJhdG9yJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvZ2luUmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmxvZ2luKGxvZ2luRHRvLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3VzZXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdhY2Nlc3NUb2tlbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3JlZnJlc2hUb2tlbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2V4cGlyZXNJbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkubm90LnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7IC8vIExvZ2luIGRvZXNuJ3QgaW5jbHVkZSBtZXNzYWdlXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0bHkgZm9ybWF0dGVkIHBlcm1pc3Npb25zIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclBlcm1pc3Npb25zJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Blcm1pc3Npb25zKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFBlcm1pc3Npb25zKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncGVybWlzc2lvbnMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdjYW5Nb2RlcmF0ZVBvc3RzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnY2FuQmFuVXNlcnMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdjYW5EZWxldGVDb21tZW50cycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NhbkFjY2Vzc1JlcG9ydHMnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5wZXJtaXNzaW9ucykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jYW5Nb2RlcmF0ZVBvc3RzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jYW5CYW5Vc2VycykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3RseSBmb3JtYXR0ZWQgZGFzaGJvYXJkIHN0YXRzIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvckRhc2hib2FyZFN0YXRzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Rhc2hib2FyZFN0YXRzKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldERhc2hib2FyZFN0YXRzKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndG90YWxQb3N0c01vZGVyYXRlZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3BlbmRpbmdSZXBvcnRzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnY29tbXVuaXRpZXNNYW5hZ2VkJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndXNlcnNNb2RlcmF0ZWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyZWNlbnRBY3Rpdml0eScpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUG9zdHNNb2RlcmF0ZWQpLnRvQmUoNDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWNlbnRBY3Rpdml0eSkudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWNlbnRBY3Rpdml0eSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWRtaW4tb25seSBGdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZW5mb3JjZSBhZG1pbi1vbmx5IGFjY2VzcyBmb3IgbW9kZXJhdG9yIGNyZWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgY3JlYXRlQWNjb3VudER0byA9IHtcbiAgICAgICAgZW1haWw6ICdhZG1pbi1vbmx5QG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0FkbWluJyxcbiAgICAgICAgbGFzdE5hbWU6ICdPbmx5JyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFRlc3QgZWFjaCByb2xlXG4gICAgICBjb25zdCByb2xlcyA9IFsnY2xpZW50JywgJ3RoZXJhcGlzdCcsICdtb2RlcmF0b3InXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCByb2xlIG9mIHJvbGVzKSB7XG4gICAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQocm9sZSwgY3JlYXRlQWNjb3VudER0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgICBGb3JiaWRkZW5FeGNlcHRpb24sXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRlc3QgYWRtaW4gYWNjZXNzXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnYWRtaW4nLCBjcmVhdGVBY2NvdW50RHRvKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFkbWluIHJvbGUgYmVmb3JlIG1vZGVyYXRvciBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNyZWF0ZUFjY291bnREdG8gPSB7XG4gICAgICAgIGVtYWlsOiAndmFsaWRhdGlvbkBtZW50YXJhLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgICBmaXJzdE5hbWU6ICdWYWxpZGF0aW9uJyxcbiAgICAgICAgbGFzdE5hbWU6ICdUZXN0JyxcbiAgICAgIH07XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnaW52YWxpZC1yb2xlJywgY3JlYXRlQWNjb3VudER0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgRm9yYmlkZGVuRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=