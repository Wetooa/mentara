{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/client-auth.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/client-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Post,\n  UseGuards,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterClientDto,\n  VerifyRegistrationOtpDto,\n  ResendRegistrationOtpDto,\n  ClientAuthResponse,\n  ClientProfileResponse,\n  OnboardingStatusResponse,\n  EmailResponse,\n} from '../types';\nimport type { SuccessResponse } from '../../types/global';\n\n// Import validation schemas from local validation\nimport {\n  RegisterClientDtoSchema,\n  VerifyRegistrationOtpDtoSchema,\n  ResendRegistrationOtpDtoSchema,\n} from '../validation';\nimport { ClientAuthService } from '../services/client-auth.service';\nimport { Request } from 'express';\n\n@Controller('auth/client')\nexport class ClientAuthController {\n  constructor(private readonly clientAuthService: ClientAuthService) {}\n\n  @Public()\n  @Throttle({ default: { limit: 5, ttl: 300000 } }) // 5 registrations per 5 minutes\n  @Post('register')\n  @HttpCode(HttpStatus.CREATED)\n  async register(\n    @Body() registerDto: RegisterClientDto,\n  ): Promise<ClientAuthResponse> {\n    const result = await this.clientAuthService.registerClient(registerDto);\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName || '',\n        lastName: result.user.lastName || '',\n        role: result.user.role as any,\n        isEmailVerified: result.user.emailVerified ?? false,\n        createdAt: result.user.createdAt,\n        updatedAt: result.user.updatedAt,\n      },\n      token: result.tokens.accessToken, // Single JWT token\n      message: result.message,\n    };\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(\n    @CurrentUserId() userId: string,\n  ): Promise<ClientProfileResponse> {\n    return this.clientAuthService.getClientProfile(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('first-sign-in-status')\n  @HttpCode(HttpStatus.OK)\n  async getFirstSignInStatus(\n    @CurrentUserId() userId: string,\n  ): Promise<OnboardingStatusResponse> {\n    return this.clientAuthService.getFirstSignInStatus(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Post('mark-recommendations-seen')\n  @HttpCode(HttpStatus.OK)\n  async markRecommendationsSeen(\n    @CurrentUserId() userId: string,\n  ): Promise<SuccessResponse> {\n    return this.clientAuthService.markRecommendationsSeen(userId);\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 10, ttl: 300000 } }) // 10 attempts per 5 minutes\n  @Post('verify-otp')\n  @HttpCode(HttpStatus.OK)\n  async verifyOtp(\n    @Body(new ZodValidationPipe(VerifyRegistrationOtpDtoSchema))\n    verifyDto: VerifyRegistrationOtpDto,\n  ): Promise<EmailResponse> {\n    return this.clientAuthService.verifyRegistrationOtp(\n      verifyDto.email,\n      verifyDto.otpCode,\n    );\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 5, ttl: 300000 } }) // 5 resends per 5 minutes\n  @Post('resend-otp')\n  @HttpCode(HttpStatus.OK)\n  async resendOtp(\n    @Body(new ZodValidationPipe(ResendRegistrationOtpDtoSchema))\n    resendDto: ResendRegistrationOtpDto,\n  ): Promise<EmailResponse> {\n    return this.clientAuthService.resendRegistrationOtp(resendDto.email);\n  }\n}\n"],"version":3}