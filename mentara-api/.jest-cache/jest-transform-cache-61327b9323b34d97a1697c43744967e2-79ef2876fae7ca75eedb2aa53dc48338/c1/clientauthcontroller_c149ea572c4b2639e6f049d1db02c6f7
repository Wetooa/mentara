d0a16d33748415682eb42ba397b1aad8
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ClientAuthController = void 0;
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../decorators/current-user-id.decorator");
const public_decorator_1 = require("../decorators/public.decorator");
const zod_validation_pipe_1 = require("../../common/pipes/zod-validation.pipe");
// Import validation schemas from local validation
const validation_1 = require("../validation");
const client_auth_service_1 = require("../services/client-auth.service");
let ClientAuthController = class ClientAuthController {
    clientAuthService;
    constructor(clientAuthService) {
        this.clientAuthService = clientAuthService;
    }
    async register(registerDto) {
        const result = await this.clientAuthService.registerClient(registerDto);
        return {
            user: {
                id: result.user.id,
                email: result.user.email,
                firstName: result.user.firstName || '',
                lastName: result.user.lastName || '',
                role: result.user.role,
                isEmailVerified: result.user.emailVerified ?? false,
                createdAt: result.user.createdAt,
                updatedAt: result.user.updatedAt,
            },
            token: result.tokens.accessToken, // Single JWT token
            message: result.message,
        };
    }
    async getProfile(userId) {
        return this.clientAuthService.getClientProfile(userId);
    }
    async getFirstSignInStatus(userId) {
        return this.clientAuthService.getFirstSignInStatus(userId);
    }
    async markRecommendationsSeen(userId) {
        return this.clientAuthService.markRecommendationsSeen(userId);
    }
    async verifyOtp(verifyDto) {
        return this.clientAuthService.verifyRegistrationOtp(verifyDto.email, verifyDto.otpCode);
    }
    async resendOtp(resendDto) {
        return this.clientAuthService.resendRegistrationOtp(resendDto.email);
    }
};
exports.ClientAuthController = ClientAuthController;
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 300000 } }) // 5 registrations per 5 minutes
    ,
    (0, common_1.Post)('register'),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", typeof (_b = typeof Promise !== "undefined" && Promise) === "function" ? _b : Object)
], ClientAuthController.prototype, "register", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('profile'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], ClientAuthController.prototype, "getProfile", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('first-sign-in-status'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ClientAuthController.prototype, "getFirstSignInStatus", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Post)('mark-recommendations-seen'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], ClientAuthController.prototype, "markRecommendationsSeen", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 300000 } }) // 10 attempts per 5 minutes
    ,
    (0, common_1.Post)('verify-otp'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.VerifyRegistrationOtpDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], ClientAuthController.prototype, "verifyOtp", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 300000 } }) // 5 resends per 5 minutes
    ,
    (0, common_1.Post)('resend-otp'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.ResendRegistrationOtpDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ClientAuthController.prototype, "resendOtp", null);
exports.ClientAuthController = ClientAuthController = __decorate([
    (0, common_1.Controller)('auth/client'),
    __metadata("design:paramtypes", [typeof (_a = typeof client_auth_service_1.ClientAuthService !== "undefined" && client_auth_service_1.ClientAuthService) === "function" ? _a : Object])
], ClientAuthController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvY29udHJvbGxlcnMvY2xpZW50LWF1dGguY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBUXdCO0FBQ3hCLGlEQUE2QztBQUM3Qyw2REFBd0Q7QUFDeEQsdUZBQXdFO0FBQ3hFLHFFQUF3RDtBQUN4RCxnRkFBMkU7QUFhM0Usa0RBQWtEO0FBQ2xELDhDQUl1QjtBQUN2Qix5RUFBb0U7QUFJN0QsSUFBTSxvQkFBb0IsR0FBMUIsTUFBTSxvQkFBb0I7SUFDRjtJQUE3QixZQUE2QixpQkFBb0M7UUFBcEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtJQUFHLENBQUM7SUFNL0QsQUFBTixLQUFLLENBQUMsUUFBUSxDQUNKLFdBQThCO1FBRXRDLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUV4RSxPQUFPO1lBQ0wsSUFBSSxFQUFFO2dCQUNKLEVBQUUsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ2xCLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUs7Z0JBQ3hCLFNBQVMsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxFQUFFO2dCQUN0QyxRQUFRLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksRUFBRTtnQkFDcEMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBVztnQkFDN0IsZUFBZSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLEtBQUs7Z0JBQ25ELFNBQVMsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVM7Z0JBQ2hDLFNBQVMsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVM7YUFDakM7WUFDRCxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FB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QUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsMEJBQTBCOztJQUMzRSxJQUFBLGFBQUksRUFBQyxZQUFZLENBQUM7SUFDbEIsSUFBQSxpQkFBUSxFQUFDLG1CQUFVLENBQUMsRUFBRSxDQUFDO0lBRXJCLFdBQUEsSUFBQSxhQUFJLEVBQUMsSUFBSSx1Q0FBaUIsQ0FBQywyQ0FBOEIsQ0FBQyxDQUFDLENBQUE7Ozt3REFFM0QsT0FBTyxvQkFBUCxPQUFPO3FEQUVUOytCQTdFVSxvQkFBb0I7SUFEaEMsSUFBQSxtQkFBVSxFQUFDLGFBQWEsQ0FBQzt5REFFd0IsdUNBQWlCLG9CQUFqQix1Q0FBaUI7R0FEdEQsb0JBQW9CLENBOEVoQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYXV0aC9jb250cm9sbGVycy9jbGllbnQtYXV0aC5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEJvZHksXG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgSHR0cENvZGUsXG4gIEh0dHBTdGF0dXMsXG4gIFBvc3QsXG4gIFVzZUd1YXJkcyxcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVGhyb3R0bGUgfSBmcm9tICdAbmVzdGpzL3Rocm90dGxlcic7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJJZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvY3VycmVudC11c2VyLWlkLmRlY29yYXRvcic7XG5pbXBvcnQgeyBQdWJsaWMgfSBmcm9tICcuLi9kZWNvcmF0b3JzL3B1YmxpYy5kZWNvcmF0b3InO1xuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICcuLi8uLi9jb21tb24vcGlwZXMvem9kLXZhbGlkYXRpb24ucGlwZSc7XG4vLyBJbXBvcnQgdHlwZXMgZnJvbSBsb2NhbCBhdXRoIHR5cGVzXG5pbXBvcnQgdHlwZSB7XG4gIFJlZ2lzdGVyQ2xpZW50RHRvLFxuICBWZXJpZnlSZWdpc3RyYXRpb25PdHBEdG8sXG4gIFJlc2VuZFJlZ2lzdHJhdGlvbk90cER0byxcbiAgQ2xpZW50QXV0aFJlc3BvbnNlLFxuICBDbGllbnRQcm9maWxlUmVzcG9uc2UsXG4gIE9uYm9hcmRpbmdTdGF0dXNSZXNwb25zZSxcbiAgRW1haWxSZXNwb25zZSxcbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHR5cGUgeyBTdWNjZXNzUmVzcG9uc2UgfSBmcm9tICcuLi8uLi90eXBlcy9nbG9iYWwnO1xuXG4vLyBJbXBvcnQgdmFsaWRhdGlvbiBzY2hlbWFzIGZyb20gbG9jYWwgdmFsaWRhdGlvblxuaW1wb3J0IHtcbiAgUmVnaXN0ZXJDbGllbnREdG9TY2hlbWEsXG4gIFZlcmlmeVJlZ2lzdHJhdGlvbk90cER0b1NjaGVtYSxcbiAgUmVzZW5kUmVnaXN0cmF0aW9uT3RwRHRvU2NoZW1hLFxufSBmcm9tICcuLi92YWxpZGF0aW9uJztcbmltcG9ydCB7IENsaWVudEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY2xpZW50LWF1dGguc2VydmljZSc7XG5pbXBvcnQgeyBSZXF1ZXN0IH0gZnJvbSAnZXhwcmVzcyc7XG5cbkBDb250cm9sbGVyKCdhdXRoL2NsaWVudCcpXG5leHBvcnQgY2xhc3MgQ2xpZW50QXV0aENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNsaWVudEF1dGhTZXJ2aWNlOiBDbGllbnRBdXRoU2VydmljZSkge31cblxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogNSwgdHRsOiAzMDAwMDAgfSB9KSAvLyA1IHJlZ2lzdHJhdGlvbnMgcGVyIDUgbWludXRlc1xuICBAUG9zdCgncmVnaXN0ZXInKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5DUkVBVEVEKVxuICBhc3luYyByZWdpc3RlcihcbiAgICBAQm9keSgpIHJlZ2lzdGVyRHRvOiBSZWdpc3RlckNsaWVudER0byxcbiAgKTogUHJvbWlzZTxDbGllbnRBdXRoUmVzcG9uc2U+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNsaWVudEF1dGhTZXJ2aWNlLnJlZ2lzdGVyQ2xpZW50KHJlZ2lzdGVyRHRvKTtcblxuICAgIHJldHVybiB7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiByZXN1bHQudXNlci5pZCxcbiAgICAgICAgZW1haWw6IHJlc3VsdC51c2VyLmVtYWlsLFxuICAgICAgICBmaXJzdE5hbWU6IHJlc3VsdC51c2VyLmZpcnN0TmFtZSB8fCAnJyxcbiAgICAgICAgbGFzdE5hbWU6IHJlc3VsdC51c2VyLmxhc3ROYW1lIHx8ICcnLFxuICAgICAgICByb2xlOiByZXN1bHQudXNlci5yb2xlIGFzIGFueSxcbiAgICAgICAgaXNFbWFpbFZlcmlmaWVkOiByZXN1bHQudXNlci5lbWFpbFZlcmlmaWVkID8/IGZhbHNlLFxuICAgICAgICBjcmVhdGVkQXQ6IHJlc3VsdC51c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiByZXN1bHQudXNlci51cGRhdGVkQXQsXG4gICAgICB9LFxuICAgICAgdG9rZW46IHJlc3VsdC50b2tlbnMuYWNjZXNzVG9rZW4sIC8vIFNpbmdsZSBKV1QgdG9rZW5cbiAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlLFxuICAgIH07XG4gIH1cblxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbiAgQEdldCgncHJvZmlsZScpXG4gIGFzeW5jIGdldFByb2ZpbGUoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxDbGllbnRQcm9maWxlUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnRBdXRoU2VydmljZS5nZXRDbGllbnRQcm9maWxlKHVzZXJJZCk7XG4gIH1cblxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbiAgQEdldCgnZmlyc3Qtc2lnbi1pbi1zdGF0dXMnKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgZ2V0Rmlyc3RTaWduSW5TdGF0dXMoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxPbmJvYXJkaW5nU3RhdHVzUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnRBdXRoU2VydmljZS5nZXRGaXJzdFNpZ25JblN0YXR1cyh1c2VySWQpO1xuICB9XG5cbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG4gIEBQb3N0KCdtYXJrLXJlY29tbWVuZGF0aW9ucy1zZWVuJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIG1hcmtSZWNvbW1lbmRhdGlvbnNTZWVuKFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8U3VjY2Vzc1Jlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50QXV0aFNlcnZpY2UubWFya1JlY29tbWVuZGF0aW9uc1NlZW4odXNlcklkKTtcbiAgfVxuXG4gIEBQdWJsaWMoKVxuICBAVGhyb3R0bGUoeyBkZWZhdWx0OiB7IGxpbWl0OiAxMCwgdHRsOiAzMDAwMDAgfSB9KSAvLyAxMCBhdHRlbXB0cyBwZXIgNSBtaW51dGVzXG4gIEBQb3N0KCd2ZXJpZnktb3RwJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHZlcmlmeU90cChcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoVmVyaWZ5UmVnaXN0cmF0aW9uT3RwRHRvU2NoZW1hKSlcbiAgICB2ZXJpZnlEdG86IFZlcmlmeVJlZ2lzdHJhdGlvbk90cER0byxcbiAgKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50QXV0aFNlcnZpY2UudmVyaWZ5UmVnaXN0cmF0aW9uT3RwKFxuICAgICAgdmVyaWZ5RHRvLmVtYWlsLFxuICAgICAgdmVyaWZ5RHRvLm90cENvZGUsXG4gICAgKTtcbiAgfVxuXG4gIEBQdWJsaWMoKVxuICBAVGhyb3R0bGUoeyBkZWZhdWx0OiB7IGxpbWl0OiA1LCB0dGw6IDMwMDAwMCB9IH0pIC8vIDUgcmVzZW5kcyBwZXIgNSBtaW51dGVzXG4gIEBQb3N0KCdyZXNlbmQtb3RwJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHJlc2VuZE90cChcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoUmVzZW5kUmVnaXN0cmF0aW9uT3RwRHRvU2NoZW1hKSlcbiAgICByZXNlbmREdG86IFJlc2VuZFJlZ2lzdHJhdGlvbk90cER0byxcbiAgKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMuY2xpZW50QXV0aFNlcnZpY2UucmVzZW5kUmVnaXN0cmF0aW9uT3RwKHJlc2VuZER0by5lbWFpbCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==