2d543d755d7641d7eb27cf3550559218
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var MeetingsService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingsService = void 0;
const common_1 = require("@nestjs/common");
const jwt_1 = require("@nestjs/jwt");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const event_bus_service_1 = require("../common/events/event-bus.service");
const booking_events_1 = require("../common/events/booking-events");
let MeetingsService = MeetingsService_1 = class MeetingsService {
    prisma;
    eventBus;
    jwtService;
    logger = new common_1.Logger(MeetingsService_1.name);
    constructor(prisma, eventBus, jwtService) {
        this.prisma = prisma;
        this.eventBus = eventBus;
        this.jwtService = jwtService;
    }
    /**
     * Get meeting details with access validation
     */
    async getMeetingById(meetingId, userId) {
        this.logger.debug(`getMeetingById called with meetingId: ${meetingId}, userId: ${userId}`);
        const meeting = await this.prisma.meeting.findFirst({
            where: {
                id: meetingId,
                OR: [{ clientId: userId }, { therapistId: userId }],
            },
            include: {
                client: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                email: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                therapist: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                email: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                meetingNotes: {
                    orderBy: {
                        createdAt: 'desc'
                    }
                },
            },
        });
        if (!meeting) {
            throw new common_1.NotFoundException('Meeting not found or access denied');
        }
        return this.transformSingleMeeting(meeting);
    }
    /**
     * Transform a single meeting to match frontend interface expectations
     */
    transformSingleMeeting(meeting) {
        // Get the latest meeting notes
        const latestNotes = meeting.meetingNotes?.[0];
        let notes = null;
        let feedback = null;
        // Parse notes if they exist
        if (latestNotes?.notes) {
            try {
                const parsedNotes = JSON.parse(latestNotes.notes);
                notes = parsedNotes.sessionNotes || parsedNotes.notes || latestNotes.notes;
                feedback = parsedNotes.feedback || parsedNotes.clientProgress;
            }
            catch {
                // If parsing fails, use raw notes
                notes = latestNotes.notes;
            }
        }
        // Compute therapist name
        const therapistName = meeting.therapist?.user ?
            `${meeting.therapist.user.firstName} ${meeting.therapist.user.lastName}`.trim() :
            undefined;
        return {
            id: meeting.id,
            title: meeting.title,
            description: meeting.description,
            startTime: meeting.startTime,
            endTime: meeting.endTime,
            dateTime: meeting.startTime, // Alias for startTime
            duration: meeting.duration,
            status: meeting.status,
            meetingType: meeting.meetingType,
            type: meeting.meetingType, // Alias for meetingType
            meetingUrl: meeting.meetingUrl,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            notes,
            feedback,
            client: meeting.client ? {
                userId: meeting.client.userId,
                user: meeting.client.user
            } : null,
            therapist: meeting.therapist ? {
                userId: meeting.therapist.userId,
                name: therapistName,
                specialization: meeting.therapist.specialization,
                experience: meeting.therapist.experience,
                user: meeting.therapist.user
            } : null,
            createdAt: meeting.createdAt,
            updatedAt: meeting.updatedAt,
        };
    }
    /**
     * Get user's upcoming meetings
     */
    async getUpcomingMeetings(userId, limit = 10) {
        this.logger.debug(`getUpcomingMeetings called for userId: ${userId}, limit: ${limit}`);
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`getUpcomingMeetings: User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        // This follows REST API best practices: return 200 with empty array rather than 404
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`getUpcomingMeetings: User ${userId} is not a client or therapist, returning empty meetings`);
            return {
                meetings: [],
                total: 0,
            };
        }
        this.logger.debug(`getUpcomingMeetings: User ${userId} is valid client/therapist, fetching meetings`);
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: { in: ['SCHEDULED', 'CONFIRMED'] },
                startTime: { gte: new Date() },
            },
            include: {
                client: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                therapist: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
            },
            orderBy: { startTime: 'asc' },
            take: limit,
        });
        this.logger.log(`Found ${meetings.length} upcoming meetings for user ${userId}`);
        return {
            meetings,
            total: meetings.length,
        };
    }
    /**
     * Generate meeting room URL/token (for integration with video platforms)
     */
    async generateMeetingRoom(meetingId, userId) {
        await this.getMeetingById(meetingId, userId);
        // In a real implementation, this would integrate with video platforms like:
        // - Zoom SDK
        // - WebRTC/Jitsi
        // - Twilio Video
        // - Agora
        const roomUrl = `${process.env.FRONTEND_URL}/meeting/${meetingId}`;
        const roomToken = this.generateRoomToken(meetingId, userId, 'host');
        // Update meeting with room URL
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: { meetingUrl: roomUrl },
        });
        return {
            roomUrl,
            roomToken,
            meetingId,
            expires: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours
        };
    }
    /**
     * Validate meeting access for WebSocket connections
     */
    async validateMeetingAccess(meetingId, userId) {
        try {
            const meeting = await this.prisma.meeting.findFirst({
                where: {
                    id: meetingId,
                    OR: [{ clientId: userId }, { therapistId: userId }],
                    status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },
                },
            });
            return !!meeting;
        }
        catch (error) {
            this.logger.error('Failed to validate meeting access:', error);
            return false;
        }
    }
    /**
     * Get meeting analytics for therapists
     */
    async getMeetingAnalytics(therapistId, dateRange) {
        const whereClause = {
            therapistId,
            status: 'COMPLETED',
        };
        if (dateRange) {
            whereClause.startTime = {
                gte: dateRange.start,
                lte: dateRange.end,
            };
        }
        const meetings = await this.prisma.meeting.findMany({
            where: whereClause,
            include: {
                meetingNotes: true,
            },
        });
        const analytics = {
            totalMeetings: meetings.length,
            totalDuration: meetings.reduce((sum, m) => sum + m.duration, 0),
            averageDuration: meetings.length > 0
                ? meetings.reduce((sum, m) => sum + m.duration, 0) / meetings.length
                : 0,
            meetingsByType: {
                video: meetings.filter((m) => m.meetingType === 'video').length,
                audio: meetings.filter((m) => m.meetingType === 'audio').length,
                chat: meetings.filter((m) => m.meetingType === 'chat').length,
            },
            completionRate: (meetings.filter((m) => m.status === 'COMPLETED').length /
                meetings.length) *
                100,
        };
        return analytics;
    }
    /**
     * Generate secure room access token using JWT
     */
    generateRoomToken(meetingId, userId, role) {
        const payload = {
            sub: userId,
            meetingId,
            role: role || 'participant',
            type: 'meeting_access',
            iat: Math.floor(Date.now() / 1000),
        };
        // Generate JWT with 24-hour expiration for meeting tokens
        return this.jwtService.sign(payload, {
            expiresIn: '24h',
            issuer: 'mentara-meetings',
            subject: userId,
        });
    }
    /**
     * Validate and decode room access token
     */
    validateRoomToken(token) {
        try {
            const decoded = this.jwtService.verify(token, {
                issuer: 'mentara-meetings',
            });
            if (decoded.type !== 'meeting_access') {
                return null;
            }
            return {
                userId: decoded.sub,
                meetingId: decoded.meetingId,
                role: decoded.role,
            };
        }
        catch (error) {
            this.logger.warn(`Invalid room token: ${error instanceof Error ? error.message : String(error)}`);
            return null;
        }
    }
    /**
     * Handle emergency meeting termination
     */
    async emergencyTerminateMeeting(meetingId, reason, terminatedBy) {
        const meeting = await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'CANCELLED',
            },
        });
        // Add emergency termination note
        await this.prisma.meetingNotes.create({
            data: {
                id: `note_${Date.now()}`,
                meetingId,
                notes: `Emergency termination: ${reason}. Terminated by: ${terminatedBy}`,
            },
        });
        void this.eventBus.emit(new booking_events_1.MeetingEmergencyTerminatedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            terminatedBy,
            terminatedAt: new Date(),
            reason,
        }));
        this.logger.warn(`Emergency termination of meeting ${meetingId}: ${reason}`);
        return meeting;
    }
    // ===== VIDEO CALL INTEGRATION METHODS =====
    /**
     * Create a video room for a meeting
     */
    async createVideoRoom(meetingId, userId, createRoomDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        if (meeting.status !== 'SCHEDULED' && meeting.status !== 'CONFIRMED') {
            throw new common_1.BadRequestException('Meeting must be scheduled or confirmed to create video room');
        }
        // Update meeting status to IN_PROGRESS
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: { status: 'IN_PROGRESS' },
        });
        // Generate video room data (in production, integrate with actual video service like Twilio/Zoom)
        const roomId = `room_${meetingId}_${Date.now()}`;
        const accessToken = this.generateRoomToken(meetingId, userId, 'host');
        const participantToken = this.generateRoomToken(meetingId, userId, 'participant');
        const videoRoomResponse = {
            roomId,
            meetingId,
            joinUrl: `https://video.mentara.app/room/${roomId}`,
            roomUrl: `https://video.mentara.app/room/${roomId}`, // Replace with actual video service URL
            accessToken,
            participantToken,
            roomConfig: {
                maxParticipants: createRoomDto.maxParticipants,
                enableRecording: createRoomDto.enableRecording,
                enableChat: createRoomDto.enableChat,
                recordingActive: false,
            },
            participants: [],
            roomSettings: {
                maxParticipants: createRoomDto.maxParticipants || 2,
                recordingEnabled: createRoomDto.recordingEnabled || false,
                screenShareEnabled: createRoomDto.screenShareEnabled || true,
                chatEnabled: createRoomDto.chatEnabled || true,
                waitingRoomEnabled: createRoomDto.waitingRoomEnabled || false,
            },
            expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours
            participantCount: 1,
            status: 'waiting',
            createdAt: new Date().toISOString(),
        };
        // Emit meeting started event
        void this.eventBus.emit(new booking_events_1.MeetingStartedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            startedAt: new Date(),
            actualStartTime: new Date(),
            scheduledStartTime: meeting.startTime,
        }));
        this.logger.log(`Video room created for meeting ${meetingId}`);
        return videoRoomResponse;
    }
    /**
     * Join an existing video room
     */
    async joinVideoRoom(meetingId, userId, joinRoomDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        if (meeting.status !== 'IN_PROGRESS') {
            throw new common_1.BadRequestException('Meeting must be in progress to join video room');
        }
        // Generate participant credentials
        const roomId = `room_${meetingId}_${Date.now()}`;
        const accessToken = this.generateRoomToken(meetingId, userId, joinRoomDto.role);
        const participantToken = this.generateRoomToken(meetingId, userId, joinRoomDto.role);
        const videoRoomResponse = {
            roomId,
            meetingId,
            joinUrl: `https://video.mentara.app/room/${roomId}`,
            roomUrl: `https://video.mentara.app/room/${roomId}`,
            accessToken,
            participantToken,
            roomConfig: {
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
                recordingActive: false,
            },
            participants: [],
            roomSettings: {
                maxParticipants: 2,
                recordingEnabled: false,
                screenShareEnabled: true,
                chatEnabled: true,
                waitingRoomEnabled: false,
            },
            expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(),
            participantCount: 2,
            status: 'active',
            createdAt: new Date().toISOString(),
        };
        this.logger.log(`User ${userId} joined video room for meeting ${meetingId}`);
        return videoRoomResponse;
    }
    /**
     * Get video call status
     */
    async getVideoCallStatus(meetingId, userId) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        // Mock video call status (in production, fetch from actual video service)
        const videoCallStatus = {
            meetingId,
            roomId: `room_${meetingId}`,
            isActive: meeting.status === 'IN_PROGRESS',
            participantCount: 2, // Client + Therapist
            status: meeting.status === 'IN_PROGRESS' ? 'active' : 'waiting',
            participants: [
                {
                    userId: meeting.clientId,
                    id: meeting.clientId,
                    name: 'Client', // In production, fetch actual user names
                    role: 'client',
                    joinedAt: meeting.startTime.toISOString(),
                    isHost: false,
                    audioEnabled: true,
                    videoEnabled: true,
                    connectionStatus: 'connected',
                },
                {
                    userId: meeting.therapistId,
                    id: meeting.therapistId,
                    name: 'Therapist',
                    role: 'therapist',
                    joinedAt: meeting.startTime.toISOString(),
                    isHost: true,
                    audioEnabled: true,
                    videoEnabled: true,
                    connectionStatus: 'connected',
                },
            ],
            startedAt: meeting.startTime.toISOString(),
            endedAt: meeting.status === 'COMPLETED'
                ? new Date(meeting.startTime.getTime() + meeting.duration * 60000).toISOString()
                : undefined,
            duration: meeting.status === 'COMPLETED' ? meeting.duration : undefined,
        };
        return videoCallStatus;
    }
    /**
     * End video call
     */
    async endVideoCall(meetingId, userId, endCallDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        // Update meeting status to completed
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'COMPLETED',
            },
        });
        // Save session summary if provided
        if (endCallDto.duration ||
            endCallDto.reason ||
            endCallDto.participantFeedback) {
            await this.prisma.meetingNotes.create({
                data: {
                    id: `notes_${meetingId}_${Date.now()}`,
                    meetingId,
                    notes: JSON.stringify({
                        sessionType: 'REGULAR_THERAPY',
                        duration: endCallDto.duration,
                        endReason: endCallDto.reason,
                        audioQuality: endCallDto.participantFeedback?.audioQuality,
                        videoQuality: endCallDto.participantFeedback?.videoQuality,
                        overallExperience: endCallDto.participantFeedback?.overallExperience,
                        issues: endCallDto.participantFeedback?.issues,
                        platform: 'video',
                        endTime: new Date().toISOString(),
                    }),
                },
            });
        }
        // Emit meeting completed event
        void this.eventBus.emit(new booking_events_1.MeetingCompletedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            completedAt: new Date(),
            actualDuration: endCallDto.duration || meeting.duration,
            scheduledDuration: meeting.duration,
        }));
        this.logger.log(`Video call ended for meeting ${meetingId}: ${endCallDto.reason}`);
    }
    /**
     * Updated method to use new DTOs
     */
    async updateMeetingStatus(meetingId, userId, updateStatusDto) {
        const meeting = await this.getMeetingById(meetingId, userId);
        const updatedMeeting = await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: updateStatusDto.status.toUpperCase(),
            },
        });
        // Emit appropriate events based on status
        switch (updateStatusDto.status) {
            case 'confirmed':
                void this.eventBus.emit(new booking_events_1.MeetingConfirmedEvent({
                    meetingId,
                    clientId: meeting.clientId,
                    therapistId: meeting.therapistId,
                    confirmedAt: new Date(),
                    startTime: meeting.startTime,
                    duration: meeting.duration,
                }));
                break;
            case 'cancelled':
                void this.eventBus.emit(new booking_events_1.MeetingCancelledEvent({
                    meetingId,
                    clientId: meeting.clientId,
                    therapistId: meeting.therapistId,
                    cancelledBy: userId,
                    cancelledAt: new Date(),
                    cancellationReason: updateStatusDto.reason,
                    originalStartTime: meeting.startTime,
                }));
                break;
        }
        this.logger.log(`Meeting ${meetingId} status updated to ${updateStatusDto.status}`);
        return updatedMeeting;
    }
    /**
     * Updated method to use new DTOs
     */
    async saveMeetingSession(meetingId, userId, sessionData) {
        // Validate meeting access
        await this.getMeetingById(meetingId, userId);
        const session = await this.prisma.meetingNotes.create({
            data: {
                id: `session_${meetingId}_${Date.now()}`,
                meetingId,
                notes: JSON.stringify({
                    sessionType: 'REGULAR_THERAPY',
                    startTime: sessionData.sessionData?.startedAt
                        ? new Date(sessionData.sessionData.startedAt).toISOString()
                        : new Date().toISOString(),
                    endTime: sessionData.sessionData?.endedAt
                        ? new Date(sessionData.sessionData.endedAt).toISOString()
                        : new Date().toISOString(),
                    duration: sessionData.sessionData?.duration || sessionData.duration,
                    status: 'COMPLETED',
                    platform: 'video',
                    sessionNotes: sessionData.sessionNotes,
                    clientProgress: sessionData.clientProgress,
                    followUpActions: sessionData.followUpActions,
                    quality: sessionData.sessionData?.quality,
                    issues: sessionData.sessionData?.issues || [],
                }),
            },
        });
        this.logger.log(`Session data saved for meeting ${meetingId}`);
        return session;
    }
    /**
     * Get user's completed meetings
     */
    async getCompletedMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: 'COMPLETED',
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get user's cancelled meetings
     */
    async getCancelledMeetings(userId, limit = 10) {
        this.logger.debug(`getCancelledMeetings called for userId: ${userId}, limit: ${limit}`);
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`getCancelledMeetings: User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`getCancelledMeetings: User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        this.logger.debug(`getCancelledMeetings: User ${userId} is valid client/therapist, fetching meetings`);
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: { in: ['CANCELLED', 'NO_SHOW'] },
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get user's in-progress meetings
     */
    async getInProgressMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: 'IN_PROGRESS',
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get all meetings with filtering options
     */
    async getAllMeetings(userId, queryOptions) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const whereClause = {
            OR: [{ clientId: userId }, { therapistId: userId }],
        };
        // Add status filter
        if (queryOptions.status) {
            whereClause.status = queryOptions.status.toUpperCase();
        }
        // Add date range filter
        if (queryOptions.dateFrom || queryOptions.dateTo) {
            whereClause.startTime = {};
            if (queryOptions.dateFrom) {
                whereClause.startTime.gte = new Date(queryOptions.dateFrom);
            }
            if (queryOptions.dateTo) {
                whereClause.startTime.lte = new Date(queryOptions.dateTo);
            }
        }
        const meetings = await this.prisma.meeting.findMany({
            where: whereClause,
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: queryOptions.limit || 20,
            skip: queryOptions.offset || 0,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Helper method to get consistent meeting include options
     */
    getMeetingIncludeOptions() {
        return {
            client: {
                include: {
                    user: {
                        select: {
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                },
            },
            therapist: {
                include: {
                    user: {
                        select: {
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                },
            },
        };
    }
    /**
     * Helper method to transform meetings data
     */
    transformMeetings(meetings) {
        return meetings.map((meeting) => ({
            id: meeting.id,
            title: meeting.title,
            description: meeting.description,
            status: meeting.status,
            startTime: meeting.startTime,
            endTime: meeting.endTime,
            duration: meeting.duration,
            meetingType: meeting.meetingType,
            meetingUrl: meeting.meetingUrl,
            client: meeting.client,
            therapist: meeting.therapist,
            createdAt: meeting.createdAt,
            updatedAt: meeting.updatedAt,
        }));
    }
};
exports.MeetingsService = MeetingsService;
exports.MeetingsService = MeetingsService = MeetingsService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof event_bus_service_1.EventBusService !== "undefined" && event_bus_service_1.EventBusService) === "function" ? _b : Object, typeof (_c = typeof jwt_1.JwtService !== "undefined" && jwt_1.JwtService) === "function" ? _c : Object])
], MeetingsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FLd0I7QUFDeEIscUNBQXlDO0FBQ3pDLGdGQUFvRTtBQUNwRSwwRUFBcUU7QUFDckUsb0VBTXlDO0FBNEJsQyxJQUFNLGVBQWUsdUJBQXJCLE1BQU0sZUFBZTtJQUlQO0lBQ0E7SUFDQTtJQUxGLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxpQkFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNELFlBQ21CLE1BQXFCLEVBQ3JCLFFBQXlCLEVBQ3pCLFVBQXNCO1FBRnRCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUN0QyxDQUFDO0lBRUo7O09BRUc7SUFDSCxLQUFLLENBQUMsY0FBYyxDQUFDLFNBQWlCLEVBQUUsTUFBYztRQUNwRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FDZix5Q0FBeUMsU0FBUyxhQUFhLE1BQU0sRUFBRSxDQUN4RSxDQUFDO1FBQ0YsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7WUFDbEQsS0FBSyxFQUFFO2dCQUNMLEVBQUUsRUFBRSxTQUFTO2dCQUNiLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxDQUFDO2FBQ3BEO1lBQ0QsT0FBTyxFQUFFO2dCQUNQLE1BQU0sRUFBRTtvQkFDTixPQUFPLEVBQUU7d0JBQ1AsSUFBSSxFQUFFOzRCQUNKLE1BQU0sRUFBRTtnQ0FDTixTQUFTLEVBQUUsSUFBSTtnQ0FDZixRQUFRLEVBQUUsSUFBSTtnQ0FDZCxLQUFLLEVBQUUsSUFBSTtnQ0FDWCxTQUFTLEVBQUUsSUFBSTs2QkFDaEI7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7Z0JBQ0QsU0FBUyxFQUFFO29CQUNULE9BQU8sRUFBRTt3QkFDUCxJQUFJLEVBQUU7NEJBQ0osTUFBTSxFQUFFO2dDQUNOLFNBQVMsRUFBRSxJQUFJO2dDQUNmLFFBQVEsRUFBRSxJQUFJO2dDQUNkLEtBQUssRUFBRSxJQUFJO2dDQUNYLFNBQVMsRUFBRSxJQUFJOzZCQUNoQjt5QkFDRjtxQkFDRjtpQkFDRjtnQkFDRCxZQUFZLEVBQUU7b0JBQ1osT0FBTyxFQUFFO3dCQUNQLFNBQVMsRUFBRSxNQUFNO3FCQUNsQjtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2IsTUFBTSxJQUFJLDBCQUFpQixDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDcEUsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRDs7T0FFRztJQUNLLHNCQUFzQixDQUFDLE9BQVk7UUFDekMsK0JBQStCO1FBQy9CLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBRXBCLDRCQUE0QjtRQUM1QixJQUFJLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQztZQUN2QixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2xELEtBQUssR0FBRyxXQUFXLENBQUMsWUFBWSxJQUFJLFdBQVcsQ0FBQyxLQUFLLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQztnQkFDM0UsUUFBUSxHQUFHLFdBQVcsQ0FBQyxRQUFRLElBQUksV0FBVyxDQUFDLGNBQWMsQ0FBQztZQUNoRSxDQUFDO1lBQUMsTUFBTSxDQUFDO2dCQUNQLGtDQUFrQztnQkFDbEMsS0FBSyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUM7WUFDNUIsQ0FBQztRQUNILENBQUM7UUFFRCx5QkFBeUI7UUFDekIsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM3QyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ2pGLFNBQVMsQ0FBQztRQUVaLE9BQU87WUFDTCxFQUFFLEVBQUUsT0FBTyxDQUFDLEVBQUU7WUFDZCxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztZQUM1QixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87WUFDeEIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsc0JBQXNCO1lBQ25ELFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtZQUMxQixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07WUFDdEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLElBQUksRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLHdCQUF3QjtZQUNuRCxVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7WUFDOUIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1lBQzFCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztZQUNoQyxLQUFLO1lBQ0wsUUFBUTtZQUNSLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDdkIsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTTtnQkFDN0IsSUFBSSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSTthQUMxQixDQUFDLENBQUMsQ0FBQyxJQUFJO1lBQ1IsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixNQUFNLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNO2dCQUNoQyxJQUFJLEVBQUUsYUFBYTtnQkFDbkIsY0FBYyxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsY0FBYztnQkFDaEQsVUFBVSxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsVUFBVTtnQkFDeEMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSTthQUM3QixDQUFDLENBQUMsQ0FBQyxJQUFJO1lBQ1IsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1lBQzVCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztTQUM3QixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUFDLE1BQWMsRUFBRSxLQUFLLEdBQUcsRUFBRTtRQUNsRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FDZiwwQ0FBMEMsTUFBTSxZQUFZLEtBQUssRUFBRSxDQUNwRSxDQUFDO1FBRUYsa0NBQWtDO1FBQ2xDLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBQ25ELEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUU7WUFDckIsT0FBTyxFQUFFO2dCQUNQLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRTtnQkFDcEMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFO2FBQ3hDO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLHdDQUF3QyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sSUFBSSwwQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFFRCx5RUFBeUU7UUFDekUsb0ZBQW9GO1FBQ3BGLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLDZCQUE2QixNQUFNLHlEQUF5RCxDQUM3RixDQUFDO1lBQ0YsT0FBTztnQkFDTCxRQUFRLEVBQUUsRUFBRTtnQkFDWixLQUFLLEVBQUUsQ0FBQzthQUNULENBQUM7UUFDSixDQUFDO1FBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2YsNkJBQTZCLE1BQU0sK0NBQStDLENBQ25GLENBQUM7UUFFRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztZQUNsRCxLQUFLLEVBQUU7Z0JBQ0wsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLENBQUM7Z0JBQ25ELE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUMsRUFBRTtnQkFDMUMsU0FBUyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksSUFBSSxFQUFFLEVBQUU7YUFDL0I7WUFDRCxPQUFPLEVBQUU7Z0JBQ1AsTUFBTSxFQUFFO29CQUNOLE9BQU8sRUFBRTt3QkFDUCxJQUFJLEVBQUU7NEJBQ0osTUFBTSxFQUFFO2dDQUNOLFNBQVMsRUFBRSxJQUFJO2dDQUNmLFFBQVEsRUFBRSxJQUFJO2dDQUNkLFNBQVMsRUFBRSxJQUFJOzZCQUNoQjt5QkFDRjtxQkFDRjtpQkFDRjtnQkFDRCxTQUFTLEVBQUU7b0JBQ1QsT0FBTyxFQUFFO3dCQUNQLElBQUksRUFBRTs0QkFDSixNQUFNLEVBQUU7Z0NBQ04sU0FBUyxFQUFFLElBQUk7Z0NBQ2YsUUFBUSxFQUFFLElBQUk7Z0NBQ2QsU0FBUyxFQUFFLElBQUk7NkJBQ2hCO3lCQUNGO3FCQUNGO2lCQUNGO2FBQ0Y7WUFDRCxPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFO1lBQzdCLElBQUksRUFBRSxLQUFLO1NBQ1osQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQ2IsU0FBUyxRQUFRLENBQUMsTUFBTSwrQkFBK0IsTUFBTSxFQUFFLENBQ2hFLENBQUM7UUFFRixPQUFPO1lBQ0wsUUFBUTtZQUNSLEtBQUssRUFBRSxRQUFRLENBQUMsTUFBTTtTQUN2QixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUFDLFNBQWlCLEVBQUUsTUFBYztRQUN6RCxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdDLDRFQUE0RTtRQUM1RSxhQUFhO1FBQ2IsaUJBQWlCO1FBQ2pCLGlCQUFpQjtRQUNqQixVQUFVO1FBRVYsTUFBTSxPQUFPLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksWUFBWSxTQUFTLEVBQUUsQ0FBQztRQUNuRSxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUVwRSwrQkFBK0I7UUFDL0IsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDL0IsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRTtZQUN4QixJQUFJLEVBQUUsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFO1NBQzlCLENBQUMsQ0FBQztRQUVILE9BQU87WUFDTCxPQUFPO1lBQ1AsU0FBUztZQUNULFNBQVM7WUFDVCxPQUFPLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLFdBQVc7U0FDakUsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxxQkFBcUIsQ0FDekIsU0FBaUIsRUFDakIsTUFBYztRQUVkLElBQUksQ0FBQztZQUNILE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO2dCQUNsRCxLQUFLLEVBQUU7b0JBQ0wsRUFBRSxFQUFFLFNBQVM7b0JBQ2IsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLENBQUM7b0JBQ25ELE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLFdBQVcsRUFBRSxXQUFXLEVBQUUsYUFBYSxDQUFDLEVBQUU7aUJBQzFEO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ25CLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUN2QixXQUFtQixFQUNuQixTQUFzQztRQUV0QyxNQUFNLFdBQVcsR0FBUTtZQUN2QixXQUFXO1lBQ1gsTUFBTSxFQUFFLFdBQVc7U0FDcEIsQ0FBQztRQUVGLElBQUksU0FBUyxFQUFFLENBQUM7WUFDZCxXQUFXLENBQUMsU0FBUyxHQUFHO2dCQUN0QixHQUFHLEVBQUUsU0FBUyxDQUFDLEtBQUs7Z0JBQ3BCLEdBQUcsRUFBRSxTQUFTLENBQUMsR0FBRzthQUNuQixDQUFDO1FBQ0osQ0FBQztRQUVELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ2xELEtBQUssRUFBRSxXQUFXO1lBQ2xCLE9BQU8sRUFBRTtnQkFDUCxZQUFZLEVBQUUsSUFBSTthQUNuQjtTQUNGLENBQUMsQ0FBQztRQUVILE1BQU0sU0FBUyxHQUFHO1lBQ2hCLGFBQWEsRUFBRSxRQUFRLENBQUMsTUFBTTtZQUM5QixhQUFhLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUMvRCxlQUFlLEVBQ2IsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDO2dCQUNqQixDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNO2dCQUNwRSxDQUFDLENBQUMsQ0FBQztZQUNQLGNBQWMsRUFBRTtnQkFDZCxLQUFLLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxPQUFPLENBQUMsQ0FBQyxNQUFNO2dCQUMvRCxLQUFLLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxPQUFPLENBQUMsQ0FBQyxNQUFNO2dCQUMvRCxJQUFJLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxNQUFNLENBQUMsQ0FBQyxNQUFNO2FBQzlEO1lBQ0QsY0FBYyxFQUNaLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxXQUFXLENBQUMsQ0FBQyxNQUFNO2dCQUN0RCxRQUFRLENBQUMsTUFBTSxDQUFDO2dCQUNsQixHQUFHO1NBQ04sQ0FBQztRQUVGLE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNLLGlCQUFpQixDQUN2QixTQUFpQixFQUNqQixNQUFjLEVBQ2QsSUFBYTtRQUViLE1BQU0sT0FBTyxHQUFHO1lBQ2QsR0FBRyxFQUFFLE1BQU07WUFDWCxTQUFTO1lBQ1QsSUFBSSxFQUFFLElBQUksSUFBSSxhQUFhO1lBQzNCLElBQUksRUFBRSxnQkFBZ0I7WUFDdEIsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQztTQUNuQyxDQUFDO1FBRUYsMERBQTBEO1FBQzFELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ25DLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLE1BQU0sRUFBRSxrQkFBa0I7WUFDMUIsT0FBTyxFQUFFLE1BQU07U0FDaEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ssaUJBQWlCLENBQ3ZCLEtBQWE7UUFFYixJQUFJLENBQUM7WUFDSCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUU7Z0JBQzVDLE1BQU0sRUFBRSxrQkFBa0I7YUFDM0IsQ0FBQyxDQUFDO1lBRUgsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLGdCQUFnQixFQUFFLENBQUM7Z0JBQ3RDLE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQztZQUVELE9BQU87Z0JBQ0wsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHO2dCQUNuQixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7Z0JBQzVCLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSTthQUNuQixDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZCx1QkFBdUIsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQ2hGLENBQUM7WUFDRixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMseUJBQXlCLENBQzdCLFNBQWlCLEVBQ2pCLE1BQWMsRUFDZCxZQUFvQjtRQUVwQixNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUMvQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFO1lBQ3hCLElBQUksRUFBRTtnQkFDSixNQUFNLEVBQUUsV0FBVzthQUNwQjtTQUNGLENBQUMsQ0FBQztRQUVILGlDQUFpQztRQUNqQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQztZQUNwQyxJQUFJLEVBQUU7Z0JBQ0osRUFBRSxFQUFFLFFBQVEsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUN4QixTQUFTO2dCQUNULEtBQUssRUFBRSwwQkFBMEIsTUFBTSxvQkFBb0IsWUFBWSxFQUFFO2FBQzFFO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDckIsSUFBSSxnREFBK0IsQ0FBQztZQUNsQyxTQUFTO1lBQ1QsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1lBQzFCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztZQUNoQyxZQUFZO1lBQ1osWUFBWSxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ3hCLE1BQU07U0FDUCxDQUFDLENBQ0gsQ0FBQztRQUVGLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNkLG9DQUFvQyxTQUFTLEtBQUssTUFBTSxFQUFFLENBQzNELENBQUM7UUFDRixPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBRUQsNkNBQTZDO0lBRTdDOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGVBQWUsQ0FDbkIsU0FBaUIsRUFDakIsTUFBYyxFQUNkLGFBQWlDO1FBRWpDLDBCQUEwQjtRQUMxQixNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxXQUFXLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxXQUFXLEVBQUUsQ0FBQztZQUNyRSxNQUFNLElBQUksNEJBQW1CLENBQzNCLDZEQUE2RCxDQUM5RCxDQUFDO1FBQ0osQ0FBQztRQUVELHVDQUF1QztRQUN2QyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUMvQixLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFO1lBQ3hCLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUU7U0FDaEMsQ0FBQyxDQUFDO1FBRUgsaUdBQWlHO1FBQ2pHLE1BQU0sTUFBTSxHQUFHLFFBQVEsU0FBUyxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBQ2pELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUM3QyxTQUFTLEVBQ1QsTUFBTSxFQUNOLGFBQWEsQ0FDZCxDQUFDO1FBRUYsTUFBTSxpQkFBaUIsR0FBc0I7WUFDM0MsTUFBTTtZQUNOLFNBQVM7WUFDVCxPQUFPLEVBQUUsa0NBQWtDLE1BQU0sRUFBRTtZQUNuRCxPQUFPLEVBQUUsa0NBQWtDLE1BQU0sRUFBRSxFQUFFLHdDQUF3QztZQUM3RixXQUFXO1lBQ1gsZ0JBQWdCO1lBQ2hCLFVBQVUsRUFBRTtnQkFDVixlQUFlLEVBQUUsYUFBYSxDQUFDLGVBQWU7Z0JBQzlDLGVBQWUsRUFBRSxhQUFhLENBQUMsZUFBZTtnQkFDOUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxVQUFVO2dCQUNwQyxlQUFlLEVBQUUsS0FBSzthQUN2QjtZQUNELFlBQVksRUFBRSxFQUFFO1lBQ2hCLFlBQVksRUFBRTtnQkFDWixlQUFlLEVBQUUsYUFBYSxDQUFDLGVBQWUsSUFBSSxDQUFDO2dCQUNuRCxnQkFBZ0IsRUFBRSxhQUFhLENBQUMsZ0JBQWdCLElBQUksS0FBSztnQkFDekQsa0JBQWtCLEVBQUUsYUFBYSxDQUFDLGtCQUFrQixJQUFJLElBQUk7Z0JBQzVELFdBQVcsRUFBRSxhQUFhLENBQUMsV0FBVyxJQUFJLElBQUk7Z0JBQzlDLGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxrQkFBa0IsSUFBSSxLQUFLO2FBQzlEO1lBQ0QsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxVQUFVO1lBQzlFLGdCQUFnQixFQUFFLENBQUM7WUFDbkIsTUFBTSxFQUFFLFNBQVM7WUFDakIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1NBQ3BDLENBQUM7UUFFRiw2QkFBNkI7UUFDN0IsS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDckIsSUFBSSxvQ0FBbUIsQ0FBQztZQUN0QixTQUFTO1lBQ1QsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1lBQzFCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztZQUNoQyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDckIsZUFBZSxFQUFFLElBQUksSUFBSSxFQUFFO1lBQzNCLGtCQUFrQixFQUFFLE9BQU8sQ0FBQyxTQUFTO1NBQ3RDLENBQUMsQ0FDSCxDQUFDO1FBRUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsa0NBQWtDLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDL0QsT0FBTyxpQkFBaUIsQ0FBQztJQUMzQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsYUFBYSxDQUNqQixTQUFpQixFQUNqQixNQUFjLEVBQ2QsV0FBNkI7UUFFN0IsMEJBQTBCO1FBQzFCLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFN0QsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLGFBQWEsRUFBRSxDQUFDO1lBQ3JDLE1BQU0sSUFBSSw0QkFBbUIsQ0FDM0IsZ0RBQWdELENBQ2pELENBQUM7UUFDSixDQUFDO1FBRUQsbUNBQW1DO1FBQ25DLE1BQU0sTUFBTSxHQUFHLFFBQVEsU0FBUyxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBQ2pELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FDeEMsU0FBUyxFQUNULE1BQU0sRUFDTixXQUFXLENBQUMsSUFBSSxDQUNqQixDQUFDO1FBQ0YsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQzdDLFNBQVMsRUFDVCxNQUFNLEVBQ04sV0FBVyxDQUFDLElBQUksQ0FDakIsQ0FBQztRQUVGLE1BQU0saUJBQWlCLEdBQXNCO1lBQzNDLE1BQU07WUFDTixTQUFTO1lBQ1QsT0FBTyxFQUFFLGtDQUFrQyxNQUFNLEVBQUU7WUFDbkQsT0FBTyxFQUFFLGtDQUFrQyxNQUFNLEVBQUU7WUFDbkQsV0FBVztZQUNYLGdCQUFnQjtZQUNoQixVQUFVLEVBQUU7Z0JBQ1YsZUFBZSxFQUFFLENBQUM7Z0JBQ2xCLGVBQWUsRUFBRSxLQUFLO2dCQUN0QixVQUFVLEVBQUUsSUFBSTtnQkFDaEIsZUFBZSxFQUFFLEtBQUs7YUFDdkI7WUFDRCxZQUFZLEVBQUUsRUFBRTtZQUNoQixZQUFZLEVBQUU7Z0JBQ1osZUFBZSxFQUFFLENBQUM7Z0JBQ2xCLGdCQUFnQixFQUFFLEtBQUs7Z0JBQ3ZCLGtCQUFrQixFQUFFLElBQUk7Z0JBQ3hCLFdBQVcsRUFBRSxJQUFJO2dCQUNqQixrQkFBa0IsRUFBRSxLQUFLO2FBQzFCO1lBQ0QsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUU7WUFDbEUsZ0JBQWdCLEVBQUUsQ0FBQztZQUNuQixNQUFNLEVBQUUsUUFBUTtZQUNoQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7U0FDcEMsQ0FBQztRQUVGLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLFFBQVEsTUFBTSxrQ0FBa0MsU0FBUyxFQUFFLENBQzVELENBQUM7UUFDRixPQUFPLGlCQUFpQixDQUFDO0lBQzNCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxrQkFBa0IsQ0FDdEIsU0FBaUIsRUFDakIsTUFBYztRQUVkLDBCQUEwQjtRQUMxQixNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdELDBFQUEwRTtRQUMxRSxNQUFNLGVBQWUsR0FBb0I7WUFDdkMsU0FBUztZQUNULE1BQU0sRUFBRSxRQUFRLFNBQVMsRUFBRTtZQUMzQixRQUFRLEVBQUUsT0FBTyxDQUFDLE1BQU0sS0FBSyxhQUFhO1lBQzFDLGdCQUFnQixFQUFFLENBQUMsRUFBRSxxQkFBcUI7WUFDMUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNLEtBQUssYUFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVM7WUFDL0QsWUFBWSxFQUFFO2dCQUNaO29CQUNFLE1BQU0sRUFBRSxPQUFPLENBQUMsUUFBUTtvQkFDeEIsRUFBRSxFQUFFLE9BQU8sQ0FBQyxRQUFRO29CQUNwQixJQUFJLEVBQUUsUUFBUSxFQUFFLHlDQUF5QztvQkFDekQsSUFBSSxFQUFFLFFBQVE7b0JBQ2QsUUFBUSxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFO29CQUN6QyxNQUFNLEVBQUUsS0FBSztvQkFDYixZQUFZLEVBQUUsSUFBSTtvQkFDbEIsWUFBWSxFQUFFLElBQUk7b0JBQ2xCLGdCQUFnQixFQUFFLFdBQVc7aUJBQzlCO2dCQUNEO29CQUNFLE1BQU0sRUFBRSxPQUFPLENBQUMsV0FBVztvQkFDM0IsRUFBRSxFQUFFLE9BQU8sQ0FBQyxXQUFXO29CQUN2QixJQUFJLEVBQUUsV0FBVztvQkFDakIsSUFBSSxFQUFFLFdBQVc7b0JBQ2pCLFFBQVEsRUFBRSxPQUFPLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRTtvQkFDekMsTUFBTSxFQUFFLElBQUk7b0JBQ1osWUFBWSxFQUFFLElBQUk7b0JBQ2xCLFlBQVksRUFBRSxJQUFJO29CQUNsQixnQkFBZ0IsRUFBRSxXQUFXO2lCQUM5QjthQUNGO1lBQ0QsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFO1lBQzFDLE9BQU8sRUFDTCxPQUFPLENBQUMsTUFBTSxLQUFLLFdBQVc7Z0JBQzVCLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FDTixPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxHQUFHLE9BQU8sQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUN2RCxDQUFDLFdBQVcsRUFBRTtnQkFDakIsQ0FBQyxDQUFDLFNBQVM7WUFDZixRQUFRLEVBQUUsT0FBTyxDQUFDLE1BQU0sS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVM7U0FDeEUsQ0FBQztRQUVGLE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxZQUFZLENBQ2hCLFNBQWlCLEVBQ2pCLE1BQWMsRUFDZCxVQUEyQjtRQUUzQiwwQkFBMEI7UUFDMUIsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUU3RCxxQ0FBcUM7UUFDckMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDL0IsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRTtZQUN4QixJQUFJLEVBQUU7Z0JBQ0osTUFBTSxFQUFFLFdBQVc7YUFDcEI7U0FDRixDQUFDLENBQUM7UUFFSCxtQ0FBbUM7UUFDbkMsSUFDRSxVQUFVLENBQUMsUUFBUTtZQUNuQixVQUFVLENBQUMsTUFBTTtZQUNqQixVQUFVLENBQUMsbUJBQW1CLEVBQzlCLENBQUM7WUFDRCxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQztnQkFDcEMsSUFBSSxFQUFFO29CQUNKLEVBQUUsRUFBRSxTQUFTLFNBQVMsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUU7b0JBQ3RDLFNBQVM7b0JBQ1QsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7d0JBQ3BCLFdBQVcsRUFBRSxpQkFBaUI7d0JBQzlCLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUTt3QkFDN0IsU0FBUyxFQUFFLFVBQVUsQ0FBQyxNQUFNO3dCQUM1QixZQUFZLEVBQUUsVUFBVSxDQUFDLG1CQUFtQixFQUFFLFlBQVk7d0JBQzFELFlBQVksRUFBRSxVQUFVLENBQUMsbUJBQW1CLEVBQUUsWUFBWTt3QkFDMUQsaUJBQWlCLEVBQ2YsVUFBVSxDQUFDLG1CQUFtQixFQUFFLGlCQUFpQjt3QkFDbkQsTUFBTSxFQUFFLFVBQVUsQ0FBQyxtQkFBbUIsRUFBRSxNQUFNO3dCQUM5QyxRQUFRLEVBQUUsT0FBTzt3QkFDakIsT0FBTyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO3FCQUNsQyxDQUFDO2lCQUNIO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELCtCQUErQjtRQUMvQixLQUFLLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNyQixJQUFJLHNDQUFxQixDQUFDO1lBQ3hCLFNBQVM7WUFDVCxRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7WUFDMUIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtZQUN2QixjQUFjLEVBQUUsVUFBVSxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsUUFBUTtZQUN2RCxpQkFBaUIsRUFBRSxPQUFPLENBQUMsUUFBUTtTQUNwQyxDQUFDLENBQ0gsQ0FBQztRQUVGLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLGdDQUFnQyxTQUFTLEtBQUssVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUNsRSxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUN2QixTQUFpQixFQUNqQixNQUFjLEVBQ2QsZUFBdUM7UUFFdkMsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUU3RCxNQUFNLGNBQWMsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUN0RCxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFO1lBQ3hCLElBQUksRUFBRTtnQkFDSixNQUFNLEVBQUUsZUFBZSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQVM7YUFDcEQ7U0FDRixDQUFDLENBQUM7UUFFSCwwQ0FBMEM7UUFDMUMsUUFBUSxlQUFlLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDL0IsS0FBSyxXQUFXO2dCQUNkLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ3JCLElBQUksc0NBQXFCLENBQUM7b0JBQ3hCLFNBQVM7b0JBQ1QsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO29CQUMxQixXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVc7b0JBQ2hDLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtvQkFDdkIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO29CQUM1QixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7aUJBQzNCLENBQUMsQ0FDSCxDQUFDO2dCQUNGLE1BQU07WUFDUixLQUFLLFdBQVc7Z0JBQ2QsS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDckIsSUFBSSxzQ0FBcUIsQ0FBQztvQkFDeEIsU0FBUztvQkFDVCxRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7b0JBQzFCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztvQkFDaEMsV0FBVyxFQUFFLE1BQU07b0JBQ25CLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtvQkFDdkIsa0JBQWtCLEVBQUUsZUFBZSxDQUFDLE1BQU07b0JBQzFDLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxTQUFTO2lCQUNyQyxDQUFDLENBQ0gsQ0FBQztnQkFDRixNQUFNO1FBQ1YsQ0FBQztRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLFdBQVcsU0FBUyxzQkFBc0IsZUFBZSxDQUFDLE1BQU0sRUFBRSxDQUNuRSxDQUFDO1FBQ0YsT0FBTyxjQUFjLENBQUM7SUFDeEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGtCQUFrQixDQUN0QixTQUFpQixFQUNqQixNQUFjLEVBQ2QsV0FBa0M7UUFFbEMsMEJBQTBCO1FBQzFCLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFN0MsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7WUFDcEQsSUFBSSxFQUFFO2dCQUNKLEVBQUUsRUFBRSxXQUFXLFNBQVMsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ3hDLFNBQVM7Z0JBQ1QsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQ3BCLFdBQVcsRUFBRSxpQkFBaUI7b0JBQzlCLFNBQVMsRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLFNBQVM7d0JBQzNDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRTt3QkFDM0QsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO29CQUM1QixPQUFPLEVBQUUsV0FBVyxDQUFDLFdBQVcsRUFBRSxPQUFPO3dCQUN2QyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUU7d0JBQ3pELENBQUMsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtvQkFDNUIsUUFBUSxFQUFFLFdBQVcsQ0FBQyxXQUFXLEVBQUUsUUFBUSxJQUFJLFdBQVcsQ0FBQyxRQUFRO29CQUNuRSxNQUFNLEVBQUUsV0FBVztvQkFDbkIsUUFBUSxFQUFFLE9BQU87b0JBQ2pCLFlBQVksRUFBRSxXQUFXLENBQUMsWUFBWTtvQkFDdEMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxjQUFjO29CQUMxQyxlQUFlLEVBQUUsV0FBVyxDQUFDLGVBQWU7b0JBQzVDLE9BQU8sRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLE9BQU87b0JBQ3pDLE1BQU0sRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLE1BQU0sSUFBSSxFQUFFO2lCQUM5QyxDQUFDO2FBQ0g7U0FDRixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUMvRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsb0JBQW9CLENBQUMsTUFBYyxFQUFFLEtBQUssR0FBRyxFQUFFO1FBQ25ELGtDQUFrQztRQUNsQyxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUNuRCxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFO1lBQ3JCLE9BQU8sRUFBRTtnQkFDUCxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEVBQUU7Z0JBQ3BDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRTthQUN4QztTQUNGLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUM5QyxNQUFNLElBQUksMEJBQWlCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNoRCxDQUFDO1FBRUQseUVBQXlFO1FBQ3pFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLFFBQVEsTUFBTSx5REFBeUQsQ0FDeEUsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUVELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ2xELEtBQUssRUFBRTtnQkFDTCxFQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsQ0FBQztnQkFDbkQsTUFBTSxFQUFFLFdBQVc7YUFDcEI7WUFDRCxPQUFPLEVBQUUsSUFBSSxDQUFDLHdCQUF3QixFQUFFO1lBQ3hDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUU7WUFDOUIsSUFBSSxFQUFFLEtBQUs7U0FDWixDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsb0JBQW9CLENBQUMsTUFBYyxFQUFFLEtBQUssR0FBRyxFQUFFO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNmLDJDQUEyQyxNQUFNLFlBQVksS0FBSyxFQUFFLENBQ3JFLENBQUM7UUFFRixrQ0FBa0M7UUFDbEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7WUFDbkQsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRTtZQUNyQixPQUFPLEVBQUU7Z0JBQ1AsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFO2dCQUNwQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEVBQUU7YUFDeEM7U0FDRixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMseUNBQXlDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDcEUsTUFBTSxJQUFJLDBCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDaEQsQ0FBQztRQUVELHlFQUF5RTtRQUN6RSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNoRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYiw4QkFBOEIsTUFBTSx5REFBeUQsQ0FDOUYsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNmLDhCQUE4QixNQUFNLCtDQUErQyxDQUNwRixDQUFDO1FBRUYsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7WUFDbEQsS0FBSyxFQUFFO2dCQUNMLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxDQUFDO2dCQUNuRCxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLEVBQUU7YUFDekM7WUFDRCxPQUFPLEVBQUUsSUFBSSxDQUFDLHdCQUF3QixFQUFFO1lBQ3hDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUU7WUFDOUIsSUFBSSxFQUFFLEtBQUs7U0FDWixDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMscUJBQXFCLENBQUMsTUFBYyxFQUFFLEtBQUssR0FBRyxFQUFFO1FBQ3BELGtDQUFrQztRQUNsQyxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUNuRCxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFO1lBQ3JCLE9BQU8sRUFBRTtnQkFDUCxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEVBQUU7Z0JBQ3BDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRTthQUN4QztTQUNGLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUM5QyxNQUFNLElBQUksMEJBQWlCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNoRCxDQUFDO1FBRUQseUVBQXlFO1FBQ3pFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLFFBQVEsTUFBTSx5REFBeUQsQ0FDeEUsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUVELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ2xELEtBQUssRUFBRTtnQkFDTCxFQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsQ0FBQztnQkFDbkQsTUFBTSxFQUFFLGFBQWE7YUFDdEI7WUFDRCxPQUFPLEVBQUUsSUFBSSxDQUFDLHdCQUF3QixFQUFFO1lBQ3hDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUU7WUFDOUIsSUFBSSxFQUFFLEtBQUs7U0FDWixDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsY0FBYyxDQUNsQixNQUFjLEVBQ2QsWUFPQztRQUVELGtDQUFrQztRQUNsQyxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUNuRCxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFO1lBQ3JCLE9BQU8sRUFBRTtnQkFDUCxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEVBQUU7Z0JBQ3BDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRTthQUN4QztTQUNGLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUM5QyxNQUFNLElBQUksMEJBQWlCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNoRCxDQUFDO1FBRUQseUVBQXlFO1FBQ3pFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLFFBQVEsTUFBTSx5REFBeUQsQ0FDeEUsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUVELE1BQU0sV0FBVyxHQUFRO1lBQ3ZCLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxDQUFDO1NBQ3BELENBQUM7UUFFRixvQkFBb0I7UUFDcEIsSUFBSSxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEIsV0FBVyxDQUFDLE1BQU0sR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3pELENBQUM7UUFFRCx3QkFBd0I7UUFDeEIsSUFBSSxZQUFZLENBQUMsUUFBUSxJQUFJLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNqRCxXQUFXLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUMzQixJQUFJLFlBQVksQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDMUIsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzlELENBQUM7WUFDRCxJQUFJLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDeEIsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVELENBQUM7UUFDSCxDQUFDO1FBRUQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7WUFDbEQsS0FBSyxFQUFFLFdBQVc7WUFDbEIsT0FBTyxFQUFFLElBQUksQ0FBQyx3QkFBd0IsRUFBRTtZQUN4QyxPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO1lBQzlCLElBQUksRUFBRSxZQUFZLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDOUIsSUFBSSxFQUFFLFlBQVksQ0FBQyxNQUFNLElBQUksQ0FBQztTQUMvQixDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSyx3QkFBd0I7UUFDOUIsT0FBTztZQUNMLE1BQU0sRUFBRTtnQkFDTixPQUFPLEVBQUU7b0JBQ1AsSUFBSSxFQUFFO3dCQUNKLE1BQU0sRUFBRTs0QkFDTixTQUFTLEVBQUUsSUFBSTs0QkFDZixRQUFRLEVBQUUsSUFBSTs0QkFDZCxTQUFTLEVBQUUsSUFBSTt5QkFDaEI7cUJBQ0Y7aUJBQ0Y7YUFDRjtZQUNELFNBQVMsRUFBRTtnQkFDVCxPQUFPLEVBQUU7b0JBQ1AsSUFBSSxFQUFFO3dCQUNKLE1BQU0sRUFBRTs0QkFDTixTQUFTLEVBQUUsSUFBSTs0QkFDZixRQUFRLEVBQUUsSUFBSTs0QkFDZCxTQUFTLEVBQUUsSUFBSTt5QkFDaEI7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSyxpQkFBaUIsQ0FBQyxRQUFlO1FBQ3ZDLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNoQyxFQUFFLEVBQUUsT0FBTyxDQUFDLEVBQUU7WUFDZCxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtZQUN0QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7WUFDNUIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPO1lBQ3hCLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtZQUMxQixXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVc7WUFDaEMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO1lBQzlCLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtZQUN0QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7WUFDNUIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1lBQzVCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztTQUM3QixDQUFDLENBQUMsQ0FBQztJQUNOLENBQUM7Q0FDRixDQUFBO0FBdDlCWSwwQ0FBZTswQkFBZixlQUFlO0lBRDNCLElBQUEsbUJBQVUsR0FBRTt5REFLZ0Isc0NBQWEsb0JBQWIsc0NBQWEsb0RBQ1gsbUNBQWUsb0JBQWYsbUNBQWUsb0RBQ2IsZ0JBQVUsb0JBQVYsZ0JBQVU7R0FOOUIsZUFBZSxDQXM5QjNCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9tZWV0aW5ncy9tZWV0aW5ncy5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEluamVjdGFibGUsXG4gIExvZ2dlcixcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEp3dFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2p3dCc7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHsgRXZlbnRCdXNTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL2V2ZW50cy9ldmVudC1idXMuc2VydmljZSc7XG5pbXBvcnQge1xuICBNZWV0aW5nQ29uZmlybWVkRXZlbnQsXG4gIE1lZXRpbmdTdGFydGVkRXZlbnQsXG4gIE1lZXRpbmdDb21wbGV0ZWRFdmVudCxcbiAgTWVldGluZ0NhbmNlbGxlZEV2ZW50LFxuICBNZWV0aW5nRW1lcmdlbmN5VGVybWluYXRlZEV2ZW50LFxufSBmcm9tICcuLi9jb21tb24vZXZlbnRzL2Jvb2tpbmctZXZlbnRzJztcbmltcG9ydCB0eXBlIHtcbiAgQ3JlYXRlVmlkZW9Sb29tRHRvLFxuICBKb2luVmlkZW9Sb29tRHRvLFxuICBFbmRWaWRlb0NhbGxEdG8sXG4gIFZpZGVvUm9vbVJlc3BvbnNlLFxuICBWaWRlb0NhbGxTdGF0dXMsXG4gIFVwZGF0ZU1lZXRpbmdTdGF0dXNEdG8sXG4gIFNhdmVNZWV0aW5nU2Vzc2lvbkR0byxcbn0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVldGluZ1Nlc3Npb25EYXRhIHtcbiAgbWVldGluZ0lkOiBzdHJpbmc7XG4gIHN0YXJ0VGltZTogRGF0ZTtcbiAgZW5kVGltZT86IERhdGU7XG4gIHBhcnRpY2lwYW50Q291bnQ6IG51bWJlcjtcbiAgZHVyYXRpb246IG51bWJlcjsgLy8gYWN0dWFsIGR1cmF0aW9uIGluIG1pbnV0ZXNcbiAgcmVjb3JkaW5nVXJsPzogc3RyaW5nO1xuICBjaGF0TWVzc2FnZXM/OiBhbnlbXTtcbiAgdGVjaElzc3Vlcz86IHN0cmluZ1tdO1xuICBxdWFsaXR5Pzoge1xuICAgIHZpZGVvUXVhbGl0eTogJ3Bvb3InIHwgJ2ZhaXInIHwgJ2dvb2QnIHwgJ2V4Y2VsbGVudCc7XG4gICAgYXVkaW9RdWFsaXR5OiAncG9vcicgfCAnZmFpcicgfCAnZ29vZCcgfCAnZXhjZWxsZW50JztcbiAgICBjb25uZWN0aW9uU3RhYmlsaXR5OiAncG9vcicgfCAnZmFpcicgfCAnZ29vZCcgfCAnZXhjZWxsZW50JztcbiAgfTtcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1lZXRpbmdzU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihNZWV0aW5nc1NlcnZpY2UubmFtZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBldmVudEJ1czogRXZlbnRCdXNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgand0U2VydmljZTogSnd0U2VydmljZSxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBHZXQgbWVldGluZyBkZXRhaWxzIHdpdGggYWNjZXNzIHZhbGlkYXRpb25cbiAgICovXG4gIGFzeW5jIGdldE1lZXRpbmdCeUlkKG1lZXRpbmdJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKFxuICAgICAgYGdldE1lZXRpbmdCeUlkIGNhbGxlZCB3aXRoIG1lZXRpbmdJZDogJHttZWV0aW5nSWR9LCB1c2VySWQ6ICR7dXNlcklkfWAsXG4gICAgKTtcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IG1lZXRpbmdJZCxcbiAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG1lZXRpbmdOb3Rlczoge1xuICAgICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogJ2Rlc2MnXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghbWVldGluZykge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZWV0aW5nIG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtU2luZ2xlTWVldGluZyhtZWV0aW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2Zvcm0gYSBzaW5nbGUgbWVldGluZyB0byBtYXRjaCBmcm9udGVuZCBpbnRlcmZhY2UgZXhwZWN0YXRpb25zXG4gICAqL1xuICBwcml2YXRlIHRyYW5zZm9ybVNpbmdsZU1lZXRpbmcobWVldGluZzogYW55KSB7XG4gICAgLy8gR2V0IHRoZSBsYXRlc3QgbWVldGluZyBub3Rlc1xuICAgIGNvbnN0IGxhdGVzdE5vdGVzID0gbWVldGluZy5tZWV0aW5nTm90ZXM/LlswXTtcbiAgICBsZXQgbm90ZXMgPSBudWxsO1xuICAgIGxldCBmZWVkYmFjayA9IG51bGw7XG5cbiAgICAvLyBQYXJzZSBub3RlcyBpZiB0aGV5IGV4aXN0XG4gICAgaWYgKGxhdGVzdE5vdGVzPy5ub3Rlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFyc2VkTm90ZXMgPSBKU09OLnBhcnNlKGxhdGVzdE5vdGVzLm5vdGVzKTtcbiAgICAgICAgbm90ZXMgPSBwYXJzZWROb3Rlcy5zZXNzaW9uTm90ZXMgfHwgcGFyc2VkTm90ZXMubm90ZXMgfHwgbGF0ZXN0Tm90ZXMubm90ZXM7XG4gICAgICAgIGZlZWRiYWNrID0gcGFyc2VkTm90ZXMuZmVlZGJhY2sgfHwgcGFyc2VkTm90ZXMuY2xpZW50UHJvZ3Jlc3M7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gSWYgcGFyc2luZyBmYWlscywgdXNlIHJhdyBub3Rlc1xuICAgICAgICBub3RlcyA9IGxhdGVzdE5vdGVzLm5vdGVzO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENvbXB1dGUgdGhlcmFwaXN0IG5hbWVcbiAgICBjb25zdCB0aGVyYXBpc3ROYW1lID0gbWVldGluZy50aGVyYXBpc3Q/LnVzZXIgPyBcbiAgICAgIGAke21lZXRpbmcudGhlcmFwaXN0LnVzZXIuZmlyc3ROYW1lfSAke21lZXRpbmcudGhlcmFwaXN0LnVzZXIubGFzdE5hbWV9YC50cmltKCkgOiBcbiAgICAgIHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB7XG4gICAgICBpZDogbWVldGluZy5pZCxcbiAgICAgIHRpdGxlOiBtZWV0aW5nLnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IG1lZXRpbmcuZGVzY3JpcHRpb24sXG4gICAgICBzdGFydFRpbWU6IG1lZXRpbmcuc3RhcnRUaW1lLFxuICAgICAgZW5kVGltZTogbWVldGluZy5lbmRUaW1lLFxuICAgICAgZGF0ZVRpbWU6IG1lZXRpbmcuc3RhcnRUaW1lLCAvLyBBbGlhcyBmb3Igc3RhcnRUaW1lXG4gICAgICBkdXJhdGlvbjogbWVldGluZy5kdXJhdGlvbixcbiAgICAgIHN0YXR1czogbWVldGluZy5zdGF0dXMsXG4gICAgICBtZWV0aW5nVHlwZTogbWVldGluZy5tZWV0aW5nVHlwZSxcbiAgICAgIHR5cGU6IG1lZXRpbmcubWVldGluZ1R5cGUsIC8vIEFsaWFzIGZvciBtZWV0aW5nVHlwZVxuICAgICAgbWVldGluZ1VybDogbWVldGluZy5tZWV0aW5nVXJsLFxuICAgICAgY2xpZW50SWQ6IG1lZXRpbmcuY2xpZW50SWQsXG4gICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgIG5vdGVzLFxuICAgICAgZmVlZGJhY2ssXG4gICAgICBjbGllbnQ6IG1lZXRpbmcuY2xpZW50ID8ge1xuICAgICAgICB1c2VySWQ6IG1lZXRpbmcuY2xpZW50LnVzZXJJZCxcbiAgICAgICAgdXNlcjogbWVldGluZy5jbGllbnQudXNlclxuICAgICAgfSA6IG51bGwsXG4gICAgICB0aGVyYXBpc3Q6IG1lZXRpbmcudGhlcmFwaXN0ID8ge1xuICAgICAgICB1c2VySWQ6IG1lZXRpbmcudGhlcmFwaXN0LnVzZXJJZCxcbiAgICAgICAgbmFtZTogdGhlcmFwaXN0TmFtZSxcbiAgICAgICAgc3BlY2lhbGl6YXRpb246IG1lZXRpbmcudGhlcmFwaXN0LnNwZWNpYWxpemF0aW9uLFxuICAgICAgICBleHBlcmllbmNlOiBtZWV0aW5nLnRoZXJhcGlzdC5leHBlcmllbmNlLFxuICAgICAgICB1c2VyOiBtZWV0aW5nLnRoZXJhcGlzdC51c2VyXG4gICAgICB9IDogbnVsbCxcbiAgICAgIGNyZWF0ZWRBdDogbWVldGluZy5jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkQXQ6IG1lZXRpbmcudXBkYXRlZEF0LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHVzZXIncyB1cGNvbWluZyBtZWV0aW5nc1xuICAgKi9cbiAgYXN5bmMgZ2V0VXBjb21pbmdNZWV0aW5ncyh1c2VySWQ6IHN0cmluZywgbGltaXQgPSAxMCkge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKFxuICAgICAgYGdldFVwY29taW5nTWVldGluZ3MgY2FsbGVkIGZvciB1c2VySWQ6ICR7dXNlcklkfSwgbGltaXQ6ICR7bGltaXR9YCxcbiAgICApO1xuXG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYGdldFVwY29taW5nTWVldGluZ3M6IFVzZXIgbm90IGZvdW5kOiAke3VzZXJJZH1gKTtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyBJZiB1c2VyIGV4aXN0cyBidXQgaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuIGVtcHR5IG1lZXRpbmdzXG4gICAgLy8gVGhpcyBmb2xsb3dzIFJFU1QgQVBJIGJlc3QgcHJhY3RpY2VzOiByZXR1cm4gMjAwIHdpdGggZW1wdHkgYXJyYXkgcmF0aGVyIHRoYW4gNDA0XG4gICAgaWYgKCF1c2VyRXhpc3RzLmNsaWVudCAmJiAhdXNlckV4aXN0cy50aGVyYXBpc3QpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgYGdldFVwY29taW5nTWVldGluZ3M6IFVzZXIgJHt1c2VySWR9IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybmluZyBlbXB0eSBtZWV0aW5nc2AsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVldGluZ3M6IFtdLFxuICAgICAgICB0b3RhbDogMCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICBgZ2V0VXBjb21pbmdNZWV0aW5nczogVXNlciAke3VzZXJJZH0gaXMgdmFsaWQgY2xpZW50L3RoZXJhcGlzdCwgZmV0Y2hpbmcgbWVldGluZ3NgLFxuICAgICk7XG5cbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgICBzdGF0dXM6IHsgaW46IFsnU0NIRURVTEVEJywgJ0NPTkZJUk1FRCddIH0sXG4gICAgICAgIHN0YXJ0VGltZTogeyBndGU6IG5ldyBEYXRlKCkgfSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGNsaWVudDoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiAnYXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgRm91bmQgJHttZWV0aW5ncy5sZW5ndGh9IHVwY29taW5nIG1lZXRpbmdzIGZvciB1c2VyICR7dXNlcklkfWAsXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBtZWV0aW5ncyxcbiAgICAgIHRvdGFsOiBtZWV0aW5ncy5sZW5ndGgsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBtZWV0aW5nIHJvb20gVVJML3Rva2VuIChmb3IgaW50ZWdyYXRpb24gd2l0aCB2aWRlbyBwbGF0Zm9ybXMpXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZU1lZXRpbmdSb29tKG1lZXRpbmdJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIHZpZGVvIHBsYXRmb3JtcyBsaWtlOlxuICAgIC8vIC0gWm9vbSBTREtcbiAgICAvLyAtIFdlYlJUQy9KaXRzaVxuICAgIC8vIC0gVHdpbGlvIFZpZGVvXG4gICAgLy8gLSBBZ29yYVxuXG4gICAgY29uc3Qgcm9vbVVybCA9IGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vbWVldGluZy8ke21lZXRpbmdJZH1gO1xuICAgIGNvbnN0IHJvb21Ub2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4obWVldGluZ0lkLCB1c2VySWQsICdob3N0Jyk7XG5cbiAgICAvLyBVcGRhdGUgbWVldGluZyB3aXRoIHJvb20gVVJMXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmdJZCB9LFxuICAgICAgZGF0YTogeyBtZWV0aW5nVXJsOiByb29tVXJsIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcm9vbVVybCxcbiAgICAgIHJvb21Ub2tlbixcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIGV4cGlyZXM6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKSwgLy8gMjQgaG91cnNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzIGZvciBXZWJTb2NrZXQgY29ubmVjdGlvbnNcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlTWVldGluZ0FjY2VzcyhcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgaWQ6IG1lZXRpbmdJZCxcbiAgICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICAgICAgc3RhdHVzOiB7IGluOiBbJ1NDSEVEVUxFRCcsICdDT05GSVJNRUQnLCAnSU5fUFJPR1JFU1MnXSB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiAhIW1lZXRpbmc7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gdmFsaWRhdGUgbWVldGluZyBhY2Nlc3M6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbWVldGluZyBhbmFseXRpY3MgZm9yIHRoZXJhcGlzdHNcbiAgICovXG4gIGFzeW5jIGdldE1lZXRpbmdBbmFseXRpY3MoXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICBkYXRlUmFuZ2U/OiB7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfSxcbiAgKSB7XG4gICAgY29uc3Qgd2hlcmVDbGF1c2U6IGFueSA9IHtcbiAgICAgIHRoZXJhcGlzdElkLFxuICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICB9O1xuXG4gICAgaWYgKGRhdGVSYW5nZSkge1xuICAgICAgd2hlcmVDbGF1c2Uuc3RhcnRUaW1lID0ge1xuICAgICAgICBndGU6IGRhdGVSYW5nZS5zdGFydCxcbiAgICAgICAgbHRlOiBkYXRlUmFuZ2UuZW5kLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBtZWV0aW5nTm90ZXM6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYW5hbHl0aWNzID0ge1xuICAgICAgdG90YWxNZWV0aW5nczogbWVldGluZ3MubGVuZ3RoLFxuICAgICAgdG90YWxEdXJhdGlvbjogbWVldGluZ3MucmVkdWNlKChzdW0sIG0pID0+IHN1bSArIG0uZHVyYXRpb24sIDApLFxuICAgICAgYXZlcmFnZUR1cmF0aW9uOlxuICAgICAgICBtZWV0aW5ncy5sZW5ndGggPiAwXG4gICAgICAgICAgPyBtZWV0aW5ncy5yZWR1Y2UoKHN1bSwgbSkgPT4gc3VtICsgbS5kdXJhdGlvbiwgMCkgLyBtZWV0aW5ncy5sZW5ndGhcbiAgICAgICAgICA6IDAsXG4gICAgICBtZWV0aW5nc0J5VHlwZToge1xuICAgICAgICB2aWRlbzogbWVldGluZ3MuZmlsdGVyKChtKSA9PiBtLm1lZXRpbmdUeXBlID09PSAndmlkZW8nKS5sZW5ndGgsXG4gICAgICAgIGF1ZGlvOiBtZWV0aW5ncy5maWx0ZXIoKG0pID0+IG0ubWVldGluZ1R5cGUgPT09ICdhdWRpbycpLmxlbmd0aCxcbiAgICAgICAgY2hhdDogbWVldGluZ3MuZmlsdGVyKChtKSA9PiBtLm1lZXRpbmdUeXBlID09PSAnY2hhdCcpLmxlbmd0aCxcbiAgICAgIH0sXG4gICAgICBjb21wbGV0aW9uUmF0ZTpcbiAgICAgICAgKG1lZXRpbmdzLmZpbHRlcigobSkgPT4gbS5zdGF0dXMgPT09ICdDT01QTEVURUQnKS5sZW5ndGggL1xuICAgICAgICAgIG1lZXRpbmdzLmxlbmd0aCkgKlxuICAgICAgICAxMDAsXG4gICAgfTtcblxuICAgIHJldHVybiBhbmFseXRpY3M7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgc2VjdXJlIHJvb20gYWNjZXNzIHRva2VuIHVzaW5nIEpXVFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJvb21Ub2tlbihcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICByb2xlPzogc3RyaW5nLFxuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBzdWI6IHVzZXJJZCxcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHJvbGU6IHJvbGUgfHwgJ3BhcnRpY2lwYW50JyxcbiAgICAgIHR5cGU6ICdtZWV0aW5nX2FjY2VzcycsXG4gICAgICBpYXQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLFxuICAgIH07XG5cbiAgICAvLyBHZW5lcmF0ZSBKV1Qgd2l0aCAyNC1ob3VyIGV4cGlyYXRpb24gZm9yIG1lZXRpbmcgdG9rZW5zXG4gICAgcmV0dXJuIHRoaXMuand0U2VydmljZS5zaWduKHBheWxvYWQsIHtcbiAgICAgIGV4cGlyZXNJbjogJzI0aCcsXG4gICAgICBpc3N1ZXI6ICdtZW50YXJhLW1lZXRpbmdzJyxcbiAgICAgIHN1YmplY3Q6IHVzZXJJZCxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhbmQgZGVjb2RlIHJvb20gYWNjZXNzIHRva2VuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlUm9vbVRva2VuKFxuICAgIHRva2VuOiBzdHJpbmcsXG4gICk6IHsgdXNlcklkOiBzdHJpbmc7IG1lZXRpbmdJZDogc3RyaW5nOyByb2xlOiBzdHJpbmcgfSB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkZWNvZGVkID0gdGhpcy5qd3RTZXJ2aWNlLnZlcmlmeSh0b2tlbiwge1xuICAgICAgICBpc3N1ZXI6ICdtZW50YXJhLW1lZXRpbmdzJyxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZGVjb2RlZC50eXBlICE9PSAnbWVldGluZ19hY2Nlc3MnKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IGRlY29kZWQuc3ViLFxuICAgICAgICBtZWV0aW5nSWQ6IGRlY29kZWQubWVldGluZ0lkLFxuICAgICAgICByb2xlOiBkZWNvZGVkLnJvbGUsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICBgSW52YWxpZCByb29tIHRva2VuOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgZW1lcmdlbmN5IG1lZXRpbmcgdGVybWluYXRpb25cbiAgICovXG4gIGFzeW5jIGVtZXJnZW5jeVRlcm1pbmF0ZU1lZXRpbmcoXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgcmVhc29uOiBzdHJpbmcsXG4gICAgdGVybWluYXRlZEJ5OiBzdHJpbmcsXG4gICkge1xuICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN0YXR1czogJ0NBTkNFTExFRCcsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGVtZXJnZW5jeSB0ZXJtaW5hdGlvbiBub3RlXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZ05vdGVzLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBgbm90ZV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBub3RlczogYEVtZXJnZW5jeSB0ZXJtaW5hdGlvbjogJHtyZWFzb259LiBUZXJtaW5hdGVkIGJ5OiAke3Rlcm1pbmF0ZWRCeX1gLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgbmV3IE1lZXRpbmdFbWVyZ2VuY3lUZXJtaW5hdGVkRXZlbnQoe1xuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgdGVybWluYXRlZEJ5LFxuICAgICAgICB0ZXJtaW5hdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHJlYXNvbixcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgYEVtZXJnZW5jeSB0ZXJtaW5hdGlvbiBvZiBtZWV0aW5nICR7bWVldGluZ0lkfTogJHtyZWFzb259YCxcbiAgICApO1xuICAgIHJldHVybiBtZWV0aW5nO1xuICB9XG5cbiAgLy8gPT09PT0gVklERU8gQ0FMTCBJTlRFR1JBVElPTiBNRVRIT0RTID09PT09XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHZpZGVvIHJvb20gZm9yIGEgbWVldGluZ1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlVmlkZW9Sb29tKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGNyZWF0ZVJvb21EdG86IENyZWF0ZVZpZGVvUm9vbUR0byxcbiAgKTogUHJvbWlzZTxWaWRlb1Jvb21SZXNwb25zZT4ge1xuICAgIC8vIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzXG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgaWYgKG1lZXRpbmcuc3RhdHVzICE9PSAnU0NIRURVTEVEJyAmJiBtZWV0aW5nLnN0YXR1cyAhPT0gJ0NPTkZJUk1FRCcpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICAnTWVldGluZyBtdXN0IGJlIHNjaGVkdWxlZCBvciBjb25maXJtZWQgdG8gY3JlYXRlIHZpZGVvIHJvb20nLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgbWVldGluZyBzdGF0dXMgdG8gSU5fUFJPR1JFU1NcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7IHN0YXR1czogJ0lOX1BST0dSRVNTJyB9LFxuICAgIH0pO1xuXG4gICAgLy8gR2VuZXJhdGUgdmlkZW8gcm9vbSBkYXRhIChpbiBwcm9kdWN0aW9uLCBpbnRlZ3JhdGUgd2l0aCBhY3R1YWwgdmlkZW8gc2VydmljZSBsaWtlIFR3aWxpby9ab29tKVxuICAgIGNvbnN0IHJvb21JZCA9IGByb29tXyR7bWVldGluZ0lkfV8ke0RhdGUubm93KCl9YDtcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4obWVldGluZ0lkLCB1c2VySWQsICdob3N0Jyk7XG4gICAgY29uc3QgcGFydGljaXBhbnRUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICAncGFydGljaXBhbnQnLFxuICAgICk7XG5cbiAgICBjb25zdCB2aWRlb1Jvb21SZXNwb25zZTogVmlkZW9Sb29tUmVzcG9uc2UgPSB7XG4gICAgICByb29tSWQsXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICBqb2luVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsXG4gICAgICByb29tVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsIC8vIFJlcGxhY2Ugd2l0aCBhY3R1YWwgdmlkZW8gc2VydmljZSBVUkxcbiAgICAgIGFjY2Vzc1Rva2VuLFxuICAgICAgcGFydGljaXBhbnRUb2tlbixcbiAgICAgIHJvb21Db25maWc6IHtcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiBjcmVhdGVSb29tRHRvLm1heFBhcnRpY2lwYW50cyxcbiAgICAgICAgZW5hYmxlUmVjb3JkaW5nOiBjcmVhdGVSb29tRHRvLmVuYWJsZVJlY29yZGluZyxcbiAgICAgICAgZW5hYmxlQ2hhdDogY3JlYXRlUm9vbUR0by5lbmFibGVDaGF0LFxuICAgICAgICByZWNvcmRpbmdBY3RpdmU6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIHBhcnRpY2lwYW50czogW10sXG4gICAgICByb29tU2V0dGluZ3M6IHtcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiBjcmVhdGVSb29tRHRvLm1heFBhcnRpY2lwYW50cyB8fCAyLFxuICAgICAgICByZWNvcmRpbmdFbmFibGVkOiBjcmVhdGVSb29tRHRvLnJlY29yZGluZ0VuYWJsZWQgfHwgZmFsc2UsXG4gICAgICAgIHNjcmVlblNoYXJlRW5hYmxlZDogY3JlYXRlUm9vbUR0by5zY3JlZW5TaGFyZUVuYWJsZWQgfHwgdHJ1ZSxcbiAgICAgICAgY2hhdEVuYWJsZWQ6IGNyZWF0ZVJvb21EdG8uY2hhdEVuYWJsZWQgfHwgdHJ1ZSxcbiAgICAgICAgd2FpdGluZ1Jvb21FbmFibGVkOiBjcmVhdGVSb29tRHRvLndhaXRpbmdSb29tRW5hYmxlZCB8fCBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCksIC8vIDQgaG91cnNcbiAgICAgIHBhcnRpY2lwYW50Q291bnQ6IDEsXG4gICAgICBzdGF0dXM6ICd3YWl0aW5nJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG5cbiAgICAvLyBFbWl0IG1lZXRpbmcgc3RhcnRlZCBldmVudFxuICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgbmV3IE1lZXRpbmdTdGFydGVkRXZlbnQoe1xuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBhY3R1YWxTdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIHNjaGVkdWxlZFN0YXJ0VGltZTogbWVldGluZy5zdGFydFRpbWUsXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBWaWRlbyByb29tIGNyZWF0ZWQgZm9yIG1lZXRpbmcgJHttZWV0aW5nSWR9YCk7XG4gICAgcmV0dXJuIHZpZGVvUm9vbVJlc3BvbnNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEpvaW4gYW4gZXhpc3RpbmcgdmlkZW8gcm9vbVxuICAgKi9cbiAgYXN5bmMgam9pblZpZGVvUm9vbShcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBqb2luUm9vbUR0bzogSm9pblZpZGVvUm9vbUR0byxcbiAgKTogUHJvbWlzZTxWaWRlb1Jvb21SZXNwb25zZT4ge1xuICAgIC8vIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzXG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgaWYgKG1lZXRpbmcuc3RhdHVzICE9PSAnSU5fUFJPR1JFU1MnKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgJ01lZXRpbmcgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBqb2luIHZpZGVvIHJvb20nLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBwYXJ0aWNpcGFudCBjcmVkZW50aWFsc1xuICAgIGNvbnN0IHJvb21JZCA9IGByb29tXyR7bWVldGluZ0lkfV8ke0RhdGUubm93KCl9YDtcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICBqb2luUm9vbUR0by5yb2xlLFxuICAgICk7XG4gICAgY29uc3QgcGFydGljaXBhbnRUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICBqb2luUm9vbUR0by5yb2xlLFxuICAgICk7XG5cbiAgICBjb25zdCB2aWRlb1Jvb21SZXNwb25zZTogVmlkZW9Sb29tUmVzcG9uc2UgPSB7XG4gICAgICByb29tSWQsXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICBqb2luVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsXG4gICAgICByb29tVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsXG4gICAgICBhY2Nlc3NUb2tlbixcbiAgICAgIHBhcnRpY2lwYW50VG9rZW4sXG4gICAgICByb29tQ29uZmlnOiB7XG4gICAgICAgIG1heFBhcnRpY2lwYW50czogMixcbiAgICAgICAgZW5hYmxlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgICAgZW5hYmxlQ2hhdDogdHJ1ZSxcbiAgICAgICAgcmVjb3JkaW5nQWN0aXZlOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBwYXJ0aWNpcGFudHM6IFtdLFxuICAgICAgcm9vbVNldHRpbmdzOiB7XG4gICAgICAgIG1heFBhcnRpY2lwYW50czogMixcbiAgICAgICAgcmVjb3JkaW5nRW5hYmxlZDogZmFsc2UsXG4gICAgICAgIHNjcmVlblNoYXJlRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY2hhdEVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHdhaXRpbmdSb29tRW5hYmxlZDogZmFsc2UsXG4gICAgICB9LFxuICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgcGFydGljaXBhbnRDb3VudDogMixcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFVzZXIgJHt1c2VySWR9IGpvaW5lZCB2aWRlbyByb29tIGZvciBtZWV0aW5nICR7bWVldGluZ0lkfWAsXG4gICAgKTtcbiAgICByZXR1cm4gdmlkZW9Sb29tUmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZpZGVvIGNhbGwgc3RhdHVzXG4gICAqL1xuICBhc3luYyBnZXRWaWRlb0NhbGxTdGF0dXMoXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8VmlkZW9DYWxsU3RhdHVzPiB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICAvLyBNb2NrIHZpZGVvIGNhbGwgc3RhdHVzIChpbiBwcm9kdWN0aW9uLCBmZXRjaCBmcm9tIGFjdHVhbCB2aWRlbyBzZXJ2aWNlKVxuICAgIGNvbnN0IHZpZGVvQ2FsbFN0YXR1czogVmlkZW9DYWxsU3RhdHVzID0ge1xuICAgICAgbWVldGluZ0lkLFxuICAgICAgcm9vbUlkOiBgcm9vbV8ke21lZXRpbmdJZH1gLFxuICAgICAgaXNBY3RpdmU6IG1lZXRpbmcuc3RhdHVzID09PSAnSU5fUFJPR1JFU1MnLFxuICAgICAgcGFydGljaXBhbnRDb3VudDogMiwgLy8gQ2xpZW50ICsgVGhlcmFwaXN0XG4gICAgICBzdGF0dXM6IG1lZXRpbmcuc3RhdHVzID09PSAnSU5fUFJPR1JFU1MnID8gJ2FjdGl2ZScgOiAnd2FpdGluZycsXG4gICAgICBwYXJ0aWNpcGFudHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgICBpZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgICBuYW1lOiAnQ2xpZW50JywgLy8gSW4gcHJvZHVjdGlvbiwgZmV0Y2ggYWN0dWFsIHVzZXIgbmFtZXNcbiAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICBqb2luZWRBdDogbWVldGluZy5zdGFydFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBpc0hvc3Q6IGZhbHNlLFxuICAgICAgICAgIGF1ZGlvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICB2aWRlb0VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Nvbm5lY3RlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgICAgaWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgICAgbmFtZTogJ1RoZXJhcGlzdCcsXG4gICAgICAgICAgcm9sZTogJ3RoZXJhcGlzdCcsXG4gICAgICAgICAgam9pbmVkQXQ6IG1lZXRpbmcuc3RhcnRUaW1lLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgaXNIb3N0OiB0cnVlLFxuICAgICAgICAgIGF1ZGlvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICB2aWRlb0VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Nvbm5lY3RlZCcsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgc3RhcnRlZEF0OiBtZWV0aW5nLnN0YXJ0VGltZS50b0lTT1N0cmluZygpLFxuICAgICAgZW5kZWRBdDpcbiAgICAgICAgbWVldGluZy5zdGF0dXMgPT09ICdDT01QTEVURUQnXG4gICAgICAgICAgPyBuZXcgRGF0ZShcbiAgICAgICAgICAgICAgbWVldGluZy5zdGFydFRpbWUuZ2V0VGltZSgpICsgbWVldGluZy5kdXJhdGlvbiAqIDYwMDAwLFxuICAgICAgICAgICAgKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBkdXJhdGlvbjogbWVldGluZy5zdGF0dXMgPT09ICdDT01QTEVURUQnID8gbWVldGluZy5kdXJhdGlvbiA6IHVuZGVmaW5lZCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHZpZGVvQ2FsbFN0YXR1cztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmQgdmlkZW8gY2FsbFxuICAgKi9cbiAgYXN5bmMgZW5kVmlkZW9DYWxsKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGVuZENhbGxEdG86IEVuZFZpZGVvQ2FsbER0byxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICAvLyBVcGRhdGUgbWVldGluZyBzdGF0dXMgdG8gY29tcGxldGVkXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmdJZCB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFNhdmUgc2Vzc2lvbiBzdW1tYXJ5IGlmIHByb3ZpZGVkXG4gICAgaWYgKFxuICAgICAgZW5kQ2FsbER0by5kdXJhdGlvbiB8fFxuICAgICAgZW5kQ2FsbER0by5yZWFzb24gfHxcbiAgICAgIGVuZENhbGxEdG8ucGFydGljaXBhbnRGZWVkYmFja1xuICAgICkge1xuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZ05vdGVzLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogYG5vdGVzXyR7bWVldGluZ0lkfV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgICAgbm90ZXM6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIHNlc3Npb25UeXBlOiAnUkVHVUxBUl9USEVSQVBZJyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBlbmRDYWxsRHRvLmR1cmF0aW9uLFxuICAgICAgICAgICAgZW5kUmVhc29uOiBlbmRDYWxsRHRvLnJlYXNvbixcbiAgICAgICAgICAgIGF1ZGlvUXVhbGl0eTogZW5kQ2FsbER0by5wYXJ0aWNpcGFudEZlZWRiYWNrPy5hdWRpb1F1YWxpdHksXG4gICAgICAgICAgICB2aWRlb1F1YWxpdHk6IGVuZENhbGxEdG8ucGFydGljaXBhbnRGZWVkYmFjaz8udmlkZW9RdWFsaXR5LFxuICAgICAgICAgICAgb3ZlcmFsbEV4cGVyaWVuY2U6XG4gICAgICAgICAgICAgIGVuZENhbGxEdG8ucGFydGljaXBhbnRGZWVkYmFjaz8ub3ZlcmFsbEV4cGVyaWVuY2UsXG4gICAgICAgICAgICBpc3N1ZXM6IGVuZENhbGxEdG8ucGFydGljaXBhbnRGZWVkYmFjaz8uaXNzdWVzLFxuICAgICAgICAgICAgcGxhdGZvcm06ICd2aWRlbycsXG4gICAgICAgICAgICBlbmRUaW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBFbWl0IG1lZXRpbmcgY29tcGxldGVkIGV2ZW50XG4gICAgdm9pZCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICBuZXcgTWVldGluZ0NvbXBsZXRlZEV2ZW50KHtcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBjbGllbnRJZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgdGhlcmFwaXN0SWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgIGNvbXBsZXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBhY3R1YWxEdXJhdGlvbjogZW5kQ2FsbER0by5kdXJhdGlvbiB8fCBtZWV0aW5nLmR1cmF0aW9uLFxuICAgICAgICBzY2hlZHVsZWREdXJhdGlvbjogbWVldGluZy5kdXJhdGlvbixcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgVmlkZW8gY2FsbCBlbmRlZCBmb3IgbWVldGluZyAke21lZXRpbmdJZH06ICR7ZW5kQ2FsbER0by5yZWFzb259YCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZWQgbWV0aG9kIHRvIHVzZSBuZXcgRFRPc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlTWVldGluZ1N0YXR1cyhcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1cGRhdGVTdGF0dXNEdG86IFVwZGF0ZU1lZXRpbmdTdGF0dXNEdG8sXG4gICkge1xuICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLmdldE1lZXRpbmdCeUlkKG1lZXRpbmdJZCwgdXNlcklkKTtcblxuICAgIGNvbnN0IHVwZGF0ZWRNZWV0aW5nID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmdJZCB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBzdGF0dXM6IHVwZGF0ZVN0YXR1c0R0by5zdGF0dXMudG9VcHBlckNhc2UoKSBhcyBhbnksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gRW1pdCBhcHByb3ByaWF0ZSBldmVudHMgYmFzZWQgb24gc3RhdHVzXG4gICAgc3dpdGNoICh1cGRhdGVTdGF0dXNEdG8uc3RhdHVzKSB7XG4gICAgICBjYXNlICdjb25maXJtZWQnOlxuICAgICAgICB2b2lkIHRoaXMuZXZlbnRCdXMuZW1pdChcbiAgICAgICAgICBuZXcgTWVldGluZ0NvbmZpcm1lZEV2ZW50KHtcbiAgICAgICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICAgICAgdGhlcmFwaXN0SWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgICAgICBjb25maXJtZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHN0YXJ0VGltZTogbWVldGluZy5zdGFydFRpbWUsXG4gICAgICAgICAgICBkdXJhdGlvbjogbWVldGluZy5kdXJhdGlvbixcbiAgICAgICAgICB9KSxcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjYW5jZWxsZWQnOlxuICAgICAgICB2b2lkIHRoaXMuZXZlbnRCdXMuZW1pdChcbiAgICAgICAgICBuZXcgTWVldGluZ0NhbmNlbGxlZEV2ZW50KHtcbiAgICAgICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICAgICAgdGhlcmFwaXN0SWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgICAgICBjYW5jZWxsZWRCeTogdXNlcklkLFxuICAgICAgICAgICAgY2FuY2VsbGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBjYW5jZWxsYXRpb25SZWFzb246IHVwZGF0ZVN0YXR1c0R0by5yZWFzb24sXG4gICAgICAgICAgICBvcmlnaW5hbFN0YXJ0VGltZTogbWVldGluZy5zdGFydFRpbWUsXG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgIGBNZWV0aW5nICR7bWVldGluZ0lkfSBzdGF0dXMgdXBkYXRlZCB0byAke3VwZGF0ZVN0YXR1c0R0by5zdGF0dXN9YCxcbiAgICApO1xuICAgIHJldHVybiB1cGRhdGVkTWVldGluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVkIG1ldGhvZCB0byB1c2UgbmV3IERUT3NcbiAgICovXG4gIGFzeW5jIHNhdmVNZWV0aW5nU2Vzc2lvbihcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBzZXNzaW9uRGF0YTogU2F2ZU1lZXRpbmdTZXNzaW9uRHRvLFxuICApIHtcbiAgICAvLyBWYWxpZGF0ZSBtZWV0aW5nIGFjY2Vzc1xuICAgIGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmdOb3Rlcy5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBpZDogYHNlc3Npb25fJHttZWV0aW5nSWR9XyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIG5vdGVzOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc2Vzc2lvblR5cGU6ICdSRUdVTEFSX1RIRVJBUFknLFxuICAgICAgICAgIHN0YXJ0VGltZTogc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGE/LnN0YXJ0ZWRBdFxuICAgICAgICAgICAgPyBuZXcgRGF0ZShzZXNzaW9uRGF0YS5zZXNzaW9uRGF0YS5zdGFydGVkQXQpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGVuZFRpbWU6IHNlc3Npb25EYXRhLnNlc3Npb25EYXRhPy5lbmRlZEF0XG4gICAgICAgICAgICA/IG5ldyBEYXRlKHNlc3Npb25EYXRhLnNlc3Npb25EYXRhLmVuZGVkQXQpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGR1cmF0aW9uOiBzZXNzaW9uRGF0YS5zZXNzaW9uRGF0YT8uZHVyYXRpb24gfHwgc2Vzc2lvbkRhdGEuZHVyYXRpb24sXG4gICAgICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICAgICAgICBwbGF0Zm9ybTogJ3ZpZGVvJyxcbiAgICAgICAgICBzZXNzaW9uTm90ZXM6IHNlc3Npb25EYXRhLnNlc3Npb25Ob3RlcyxcbiAgICAgICAgICBjbGllbnRQcm9ncmVzczogc2Vzc2lvbkRhdGEuY2xpZW50UHJvZ3Jlc3MsXG4gICAgICAgICAgZm9sbG93VXBBY3Rpb25zOiBzZXNzaW9uRGF0YS5mb2xsb3dVcEFjdGlvbnMsXG4gICAgICAgICAgcXVhbGl0eTogc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGE/LnF1YWxpdHksXG4gICAgICAgICAgaXNzdWVzOiBzZXNzaW9uRGF0YS5zZXNzaW9uRGF0YT8uaXNzdWVzIHx8IFtdLFxuICAgICAgICB9KSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYFNlc3Npb24gZGF0YSBzYXZlZCBmb3IgbWVldGluZyAke21lZXRpbmdJZH1gKTtcbiAgICByZXR1cm4gc2Vzc2lvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlcidzIGNvbXBsZXRlZCBtZWV0aW5nc1xuICAgKi9cbiAgYXN5bmMgZ2V0Q29tcGxldGVkTWVldGluZ3ModXNlcklkOiBzdHJpbmcsIGxpbWl0ID0gMTApIHtcbiAgICAvLyBGaXJzdCB2YWxpZGF0ZSB0aGF0IHVzZXIgZXhpc3RzXG4gICAgY29uc3QgdXNlckV4aXN0cyA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGNsaWVudDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlckV4aXN0cykge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihgVXNlciBub3QgZm91bmQ6ICR7dXNlcklkfWApO1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIElmIHVzZXIgZXhpc3RzIGJ1dCBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm4gZW1wdHkgbWVldGluZ3NcbiAgICBpZiAoIXVzZXJFeGlzdHMuY2xpZW50ICYmICF1c2VyRXhpc3RzLnRoZXJhcGlzdCkge1xuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgVXNlciAke3VzZXJJZH0gaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuaW5nIGVtcHR5IG1lZXRpbmdzYCxcbiAgICAgICk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIE9SOiBbeyBjbGllbnRJZDogdXNlcklkIH0sIHsgdGhlcmFwaXN0SWQ6IHVzZXJJZCB9XSxcbiAgICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB0aGlzLmdldE1lZXRpbmdJbmNsdWRlT3B0aW9ucygpLFxuICAgICAgb3JkZXJCeTogeyBzdGFydFRpbWU6ICdkZXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHVzZXIncyBjYW5jZWxsZWQgbWVldGluZ3NcbiAgICovXG4gIGFzeW5jIGdldENhbmNlbGxlZE1lZXRpbmdzKHVzZXJJZDogc3RyaW5nLCBsaW1pdCA9IDEwKSB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICBgZ2V0Q2FuY2VsbGVkTWVldGluZ3MgY2FsbGVkIGZvciB1c2VySWQ6ICR7dXNlcklkfSwgbGltaXQ6ICR7bGltaXR9YCxcbiAgICApO1xuXG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYGdldENhbmNlbGxlZE1lZXRpbmdzOiBVc2VyIG5vdCBmb3VuZDogJHt1c2VySWR9YCk7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdXNlciBleGlzdHMgYnV0IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybiBlbXB0eSBtZWV0aW5nc1xuICAgIGlmICghdXNlckV4aXN0cy5jbGllbnQgJiYgIXVzZXJFeGlzdHMudGhlcmFwaXN0KSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBnZXRDYW5jZWxsZWRNZWV0aW5nczogVXNlciAke3VzZXJJZH0gaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuaW5nIGVtcHR5IG1lZXRpbmdzYCxcbiAgICAgICk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICBgZ2V0Q2FuY2VsbGVkTWVldGluZ3M6IFVzZXIgJHt1c2VySWR9IGlzIHZhbGlkIGNsaWVudC90aGVyYXBpc3QsIGZldGNoaW5nIG1lZXRpbmdzYCxcbiAgICApO1xuXG4gICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIE9SOiBbeyBjbGllbnRJZDogdXNlcklkIH0sIHsgdGhlcmFwaXN0SWQ6IHVzZXJJZCB9XSxcbiAgICAgICAgc3RhdHVzOiB7IGluOiBbJ0NBTkNFTExFRCcsICdOT19TSE9XJ10gfSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB0aGlzLmdldE1lZXRpbmdJbmNsdWRlT3B0aW9ucygpLFxuICAgICAgb3JkZXJCeTogeyBzdGFydFRpbWU6ICdkZXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHVzZXIncyBpbi1wcm9ncmVzcyBtZWV0aW5nc1xuICAgKi9cbiAgYXN5bmMgZ2V0SW5Qcm9ncmVzc01lZXRpbmdzKHVzZXJJZDogc3RyaW5nLCBsaW1pdCA9IDEwKSB7XG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFVzZXIgbm90IGZvdW5kOiAke3VzZXJJZH1gKTtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyBJZiB1c2VyIGV4aXN0cyBidXQgaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuIGVtcHR5IG1lZXRpbmdzXG4gICAgaWYgKCF1c2VyRXhpc3RzLmNsaWVudCAmJiAhdXNlckV4aXN0cy50aGVyYXBpc3QpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgYFVzZXIgJHt1c2VySWR9IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybmluZyBlbXB0eSBtZWV0aW5nc2AsXG4gICAgICApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IG1lZXRpbmdzID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICAgIHN0YXR1czogJ0lOX1BST0dSRVNTJyxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB0aGlzLmdldE1lZXRpbmdJbmNsdWRlT3B0aW9ucygpLFxuICAgICAgb3JkZXJCeTogeyBzdGFydFRpbWU6ICdkZXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBtZWV0aW5ncyB3aXRoIGZpbHRlcmluZyBvcHRpb25zXG4gICAqL1xuICBhc3luYyBnZXRBbGxNZWV0aW5ncyhcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBxdWVyeU9wdGlvbnM6IHtcbiAgICAgIHN0YXR1cz86IHN0cmluZztcbiAgICAgIHR5cGU/OiBzdHJpbmc7XG4gICAgICBsaW1pdD86IG51bWJlcjtcbiAgICAgIG9mZnNldD86IG51bWJlcjtcbiAgICAgIGRhdGVGcm9tPzogc3RyaW5nO1xuICAgICAgZGF0ZVRvPzogc3RyaW5nO1xuICAgIH0sXG4gICkge1xuICAgIC8vIEZpcnN0IHZhbGlkYXRlIHRoYXQgdXNlciBleGlzdHNcbiAgICBjb25zdCB1c2VyRXhpc3RzID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1c2VyRXhpc3RzKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGBVc2VyIG5vdCBmb3VuZDogJHt1c2VySWR9YCk7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdXNlciBleGlzdHMgYnV0IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybiBlbXB0eSBtZWV0aW5nc1xuICAgIGlmICghdXNlckV4aXN0cy5jbGllbnQgJiYgIXVzZXJFeGlzdHMudGhlcmFwaXN0KSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBVc2VyICR7dXNlcklkfSBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm5pbmcgZW1wdHkgbWVldGluZ3NgLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCB3aGVyZUNsYXVzZTogYW55ID0ge1xuICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgIH07XG5cbiAgICAvLyBBZGQgc3RhdHVzIGZpbHRlclxuICAgIGlmIChxdWVyeU9wdGlvbnMuc3RhdHVzKSB7XG4gICAgICB3aGVyZUNsYXVzZS5zdGF0dXMgPSBxdWVyeU9wdGlvbnMuc3RhdHVzLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGRhdGUgcmFuZ2UgZmlsdGVyXG4gICAgaWYgKHF1ZXJ5T3B0aW9ucy5kYXRlRnJvbSB8fCBxdWVyeU9wdGlvbnMuZGF0ZVRvKSB7XG4gICAgICB3aGVyZUNsYXVzZS5zdGFydFRpbWUgPSB7fTtcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuZGF0ZUZyb20pIHtcbiAgICAgICAgd2hlcmVDbGF1c2Uuc3RhcnRUaW1lLmd0ZSA9IG5ldyBEYXRlKHF1ZXJ5T3B0aW9ucy5kYXRlRnJvbSk7XG4gICAgICB9XG4gICAgICBpZiAocXVlcnlPcHRpb25zLmRhdGVUbykge1xuICAgICAgICB3aGVyZUNsYXVzZS5zdGFydFRpbWUubHRlID0gbmV3IERhdGUocXVlcnlPcHRpb25zLmRhdGVUbyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgIGluY2x1ZGU6IHRoaXMuZ2V0TWVldGluZ0luY2x1ZGVPcHRpb25zKCksXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogJ2Rlc2MnIH0sXG4gICAgICB0YWtlOiBxdWVyeU9wdGlvbnMubGltaXQgfHwgMjAsXG4gICAgICBza2lwOiBxdWVyeU9wdGlvbnMub2Zmc2V0IHx8IDAsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCB0byBnZXQgY29uc2lzdGVudCBtZWV0aW5nIGluY2x1ZGUgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRNZWV0aW5nSW5jbHVkZU9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNsaWVudDoge1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCB0byB0cmFuc2Zvcm0gbWVldGluZ3MgZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5nczogYW55W10pIHtcbiAgICByZXR1cm4gbWVldGluZ3MubWFwKChtZWV0aW5nKSA9PiAoe1xuICAgICAgaWQ6IG1lZXRpbmcuaWQsXG4gICAgICB0aXRsZTogbWVldGluZy50aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBtZWV0aW5nLmRlc2NyaXB0aW9uLFxuICAgICAgc3RhdHVzOiBtZWV0aW5nLnN0YXR1cyxcbiAgICAgIHN0YXJ0VGltZTogbWVldGluZy5zdGFydFRpbWUsXG4gICAgICBlbmRUaW1lOiBtZWV0aW5nLmVuZFRpbWUsXG4gICAgICBkdXJhdGlvbjogbWVldGluZy5kdXJhdGlvbixcbiAgICAgIG1lZXRpbmdUeXBlOiBtZWV0aW5nLm1lZXRpbmdUeXBlLFxuICAgICAgbWVldGluZ1VybDogbWVldGluZy5tZWV0aW5nVXJsLFxuICAgICAgY2xpZW50OiBtZWV0aW5nLmNsaWVudCxcbiAgICAgIHRoZXJhcGlzdDogbWVldGluZy50aGVyYXBpc3QsXG4gICAgICBjcmVhdGVkQXQ6IG1lZXRpbmcuY3JlYXRlZEF0LFxuICAgICAgdXBkYXRlZEF0OiBtZWV0aW5nLnVwZGF0ZWRBdCxcbiAgICB9KSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==