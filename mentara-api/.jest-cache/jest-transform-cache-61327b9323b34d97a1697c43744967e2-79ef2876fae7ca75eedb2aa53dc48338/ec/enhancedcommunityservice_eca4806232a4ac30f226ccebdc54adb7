2f4b53910599a828594f234fe2f6b623
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var EnhancedCommunityService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.EnhancedCommunityService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const event_emitter_1 = require("@nestjs/event-emitter");
let EnhancedCommunityService = EnhancedCommunityService_1 = class EnhancedCommunityService {
    prisma;
    eventEmitter;
    logger = new common_1.Logger(EnhancedCommunityService_1.name);
    constructor(prisma, eventEmitter) {
        this.prisma = prisma;
        this.eventEmitter = eventEmitter;
    }
    /**
     * Advanced community search with filtering and ranking
     */
    async searchCommunities(filters, userId, page = 1, limit = 20) {
        try {
            const offset = (page - 1) * limit;
            // Build the search query
            const where = {};
            const orderBy = [];
            // Text search
            if (filters.query) {
                where.OR = [
                    { name: { contains: filters.query, mode: 'insensitive' } },
                    { description: { contains: filters.query, mode: 'insensitive' } },
                ];
            }
            // Filter by description/image presence
            if (filters.hasDescription !== undefined) {
                where.description = filters.hasDescription ? { not: '' } : '';
            }
            if (filters.hasImage !== undefined) {
                where.imageUrl = filters.hasImage ? { not: '' } : '';
            }
            // Get communities with member counts and recent activity
            const communities = await this.prisma.community.findMany({
                where,
                include: {
                    _count: {
                        select: {
                            memberships: true,
                        },
                    },
                    memberships: userId
                        ? {
                            where: { userId },
                            select: { id: true },
                        }
                        : false,
                },
                skip: offset,
                take: limit,
            });
            // Apply member count filters and calculate activity
            const filteredCommunities = communities.filter((community) => {
                const memberCount = community._count.memberships;
                if (filters.minMembers && memberCount < filters.minMembers)
                    return false;
                if (filters.maxMembers && memberCount > filters.maxMembers)
                    return false;
                return true;
            });
            // Join requests removed - simplified community system
            const pendingRequests = [];
            // Transform to search results
            const searchResults = filteredCommunities.map((community) => {
                const memberCount = community._count.memberships;
                const postCount = 0; // Posts are in rooms, not direct community relation
                const commentCount = 0; // Comments are in posts in rooms
                const lastActivityAt = null; // Activity tracking simplified
                // Determine membership status
                let membershipStatus = 'none';
                if (userId) {
                    if (community.memberships && community.memberships.length > 0) {
                        membershipStatus = 'member';
                    }
                    else if (pendingRequests.includes(community.id)) {
                        membershipStatus = 'pending';
                    }
                }
                return {
                    id: community.id,
                    name: community.name,
                    slug: community.slug,
                    description: community.description,
                    imageUrl: community.imageUrl,
                    memberCount,
                    recentActivity: {
                        postCount,
                        commentCount,
                        lastActivityAt,
                    },
                    membershipStatus,
                    createdAt: community.createdAt,
                    tags: [], // Could be implemented with a tags system
                };
            });
            // Apply sorting
            this.applySorting(searchResults, filters.sortBy, filters.sortOrder);
            // Calculate facets for filtering UI
            const facets = await this.calculateSearchFacets(where);
            // Get total count for pagination
            const total = await this.prisma.community.count({ where });
            return {
                communities: searchResults,
                total,
                page,
                limit,
                totalPages: Math.ceil(total / limit),
                facets,
            };
        }
        catch (error) {
            this.logger.error(`Error searching communities:`, error);
            throw error;
        }
    }
    /**
     * Get enhanced community details with comprehensive stats
     */
    async getCommunityDetails(communityId, userId) {
        try {
            const community = await this.prisma.community.findUnique({
                where: { id: communityId },
                include: {
                    _count: {
                        select: {
                            memberships: true,
                        },
                    },
                    roomGroups: {
                        include: {
                            rooms: {
                                include: {
                                    posts: {
                                        include: {
                                            user: {
                                                select: {
                                                    id: true,
                                                    firstName: true,
                                                    lastName: true,
                                                    avatarUrl: true,
                                                },
                                            },
                                            _count: {
                                                select: {
                                                    comments: true,
                                                    hearts: true,
                                                },
                                            },
                                        },
                                        orderBy: { createdAt: 'desc' },
                                        take: 5,
                                    },
                                },
                            },
                        },
                    },
                    moderatorCommunities: {
                        include: {
                            moderator: {
                                include: {
                                    user: {
                                        select: {
                                            id: true,
                                            firstName: true,
                                            lastName: true,
                                            avatarUrl: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                    memberships: userId
                        ? {
                            where: { userId },
                            select: { id: true },
                        }
                        : false,
                },
            });
            if (!community) {
                throw new common_1.NotFoundException(`Community ${communityId} not found`);
            }
            // Calculate time ranges
            const now = new Date();
            const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            // Get all posts from this community's rooms for statistics
            const communityRoomIds = community.roomGroups.flatMap((rg) => rg.rooms.map((r) => r.id));
            // Get detailed statistics
            const [totalComments, weeklyPosts, weeklyComments, weeklyMembers, activeMembers, topContributors,] = await Promise.all([
                this.prisma.comment.count({
                    where: {
                        post: { roomId: { in: communityRoomIds } },
                    },
                }),
                this.prisma.post.count({
                    where: {
                        roomId: { in: communityRoomIds },
                        createdAt: { gte: oneWeekAgo },
                    },
                }),
                this.prisma.comment.count({
                    where: {
                        post: { roomId: { in: communityRoomIds } },
                        createdAt: { gte: oneWeekAgo },
                    },
                }),
                this.prisma.membership.count({
                    where: {
                        communityId,
                        joinedAt: { gte: oneWeekAgo },
                    },
                }),
                this.prisma.membership.count({
                    where: {
                        communityId,
                        user: {
                            updatedAt: { gte: oneMonthAgo }, // Use updatedAt as proxy for activity
                        },
                    },
                }),
                this.getTopContributors(communityId, 5),
            ]);
            // Determine membership status and permissions
            let membershipStatus = 'none';
            let userPermissions = {
                canPost: false,
                canComment: false,
                canModerate: false,
            };
            if (userId) {
                const membership = community.memberships?.[0];
                if (membership) {
                    membershipStatus = 'member';
                    // Check if user can moderate based on global role and community moderator assignment
                    const canModerate = await this.checkModerationPermissions(userId, communityId);
                    userPermissions = {
                        canPost: true,
                        canComment: true,
                        canModerate,
                    };
                }
                else {
                    // Join requests removed - users are automatically assigned communities
                    // No pending status since users get immediate membership
                    membershipStatus = 'none';
                }
            }
            return {
                id: community.id,
                name: community.name,
                slug: community.slug,
                description: community.description,
                imageUrl: community.imageUrl,
                createdAt: community.createdAt,
                updatedAt: community.updatedAt,
                memberCount: community._count.memberships,
                stats: {
                    totalPosts: community.roomGroups.reduce((total, rg) => total +
                        rg.rooms.reduce((roomTotal, room) => roomTotal + room.posts.length, 0), 0),
                    totalComments,
                    activeMembers,
                    recentActivity: {
                        postsThisWeek: weeklyPosts,
                        commentsThisWeek: weeklyComments,
                        newMembersThisWeek: weeklyMembers,
                    },
                },
                recentPosts: community.roomGroups
                    .flatMap((rg) => rg.rooms.flatMap((room) => room.posts))
                    .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())
                    .slice(0, 5)
                    .map((post) => ({
                    id: post.id,
                    title: post.title,
                    content: post.content,
                    author: post.user
                        ? {
                            id: post.user.id,
                            firstName: post.user.firstName,
                            lastName: post.user.lastName,
                            avatarUrl: post.user.avatarUrl || undefined,
                        }
                        : {
                            id: 'unknown',
                            firstName: 'Unknown',
                            lastName: 'User',
                            avatarUrl: undefined,
                        },
                    createdAt: post.createdAt,
                    heartCount: post._count.hearts,
                    commentCount: post._count.comments,
                })),
                topContributors,
                moderators: community.moderatorCommunities.map((mc) => ({
                    id: mc.moderator.user.id,
                    firstName: mc.moderator.user.firstName,
                    lastName: mc.moderator.user.lastName,
                    avatarUrl: mc.moderator.user.avatarUrl || undefined,
                    assignedAt: mc.assignedAt,
                })),
                membershipStatus,
                userPermissions,
            };
        }
        catch (error) {
            this.logger.error(`Error getting community details for ${communityId}:`, error);
            throw error;
        }
    }
    /**
     * Get trending communities based on growth and activity
     */
    async getTrendingCommunities(limit = 10, timeframe = 'week') {
        try {
            const now = new Date();
            const timeframeMs = timeframe === 'week'
                ? 7 * 24 * 60 * 60 * 1000
                : 30 * 24 * 60 * 60 * 1000;
            const startDate = new Date(now.getTime() - timeframeMs);
            const previousStartDate = new Date(startDate.getTime() - timeframeMs);
            const communities = await this.prisma.community.findMany({
                include: {
                    _count: {
                        select: { memberships: true },
                    },
                    memberships: {
                        where: {
                            joinedAt: { gte: startDate },
                        },
                        select: { joinedAt: true },
                    },
                    roomGroups: {
                        include: {
                            rooms: {
                                include: {
                                    posts: {
                                        where: {
                                            createdAt: { gte: startDate },
                                        },
                                        include: {
                                            _count: {
                                                select: { comments: true, hearts: true },
                                            },
                                        },
                                    },
                                },
                            },
                        },
                    },
                },
            });
            // Calculate trending data for each community
            const trendingCommunities = await Promise.all(communities.map(async (community) => {
                const allPosts = community.roomGroups.flatMap((rg) => rg.rooms.flatMap((room) => room.posts));
                const trendingData = await this.calculateTrendingData({ ...community, posts: allPosts }, startDate, previousStartDate);
                return {
                    id: community.id,
                    name: community.name,
                    slug: community.slug,
                    description: community.description,
                    imageUrl: community.imageUrl,
                    memberCount: community._count.memberships,
                    recentActivity: {
                        postCount: allPosts.length,
                        commentCount: allPosts.reduce((sum, post) => sum + post._count.comments, 0),
                        lastActivityAt: allPosts.length > 0
                            ? allPosts.reduce((latest, post) => post.createdAt > latest ? post.createdAt : latest, allPosts[0].createdAt)
                            : null,
                    },
                    membershipStatus: 'none',
                    createdAt: community.createdAt,
                    trendingData,
                };
            }));
            // Sort by trending score (combination of growth rate and activity)
            trendingCommunities.sort((a, b) => {
                const scoreA = a.trendingData.growthRate * 0.4 +
                    a.trendingData.activityScore * 0.4 +
                    a.trendingData.engagementRate * 0.2;
                const scoreB = b.trendingData.growthRate * 0.4 +
                    b.trendingData.activityScore * 0.4 +
                    b.trendingData.engagementRate * 0.2;
                return scoreB - scoreA;
            });
            return trendingCommunities.slice(0, limit);
        }
        catch (error) {
            this.logger.error(`Error getting trending communities:`, error);
            throw error;
        }
    }
    /**
     * Get similar communities based on user activity and preferences
     */
    async getSimilarCommunities(communityId, context) {
        try {
            const { userId, excludeJoined = true, maxResults = 5 } = context;
            // Get the reference community
            const refCommunity = await this.prisma.community.findUnique({
                where: { id: communityId },
                include: {
                    memberships: {
                        include: {
                            user: {
                                include: {
                                    memberships: {
                                        include: { community: true },
                                    },
                                },
                            },
                        },
                    },
                },
            });
            if (!refCommunity) {
                throw new common_1.NotFoundException(`Community ${communityId} not found`);
            }
            // Find communities that other members of this community have joined
            const memberCommunities = new Map();
            refCommunity.memberships.forEach((membership) => {
                if (membership.user) {
                    membership.user.memberships.forEach((userMembership) => {
                        if (userMembership.communityId !== communityId) {
                            const count = memberCommunities.get(userMembership.communityId) || 0;
                            memberCommunities.set(userMembership.communityId, count + 1);
                        }
                    });
                }
            });
            // Sort by overlap count and get top communities
            const sortedCommunities = Array.from(memberCommunities.entries())
                .sort((a, b) => b[1] - a[1])
                .slice(0, maxResults * 2); // Get more to filter out joined ones
            // Get community details
            const communityIds = sortedCommunities.map(([id]) => id);
            const communities = await this.prisma.community.findMany({
                where: { id: { in: communityIds } },
                include: {
                    _count: { select: { memberships: true } },
                    roomGroups: {
                        include: {
                            rooms: {
                                include: {
                                    _count: { select: { posts: true } },
                                },
                            },
                        },
                    },
                },
            });
            // Get user's joined communities if excluding them
            let userCommunityIds = [];
            if (excludeJoined && userId) {
                const userMemberships = await this.prisma.membership.findMany({
                    where: { userId },
                    select: { communityId: true },
                });
                userCommunityIds = userMemberships.map((m) => m.communityId);
            }
            // Filter and format results
            const similarCommunities = communities
                .filter((community) => !userCommunityIds.includes(community.id))
                .map((community) => ({
                id: community.id,
                name: community.name,
                slug: community.slug,
                description: community.description,
                imageUrl: community.imageUrl,
                memberCount: community._count.memberships,
                recentActivity: {
                    postCount: community.roomGroups.reduce((total, rg) => total +
                        rg.rooms.reduce((roomTotal, room) => roomTotal + room._count.posts, 0), 0),
                    commentCount: 0, // Could be calculated if needed
                    lastActivityAt: null,
                },
                membershipStatus: 'none',
                createdAt: community.createdAt,
            }))
                .slice(0, maxResults);
            return similarCommunities;
        }
        catch (error) {
            this.logger.error(`Error getting similar communities for ${communityId}:`, error);
            throw error;
        }
    }
    /**
     * Private helper methods
     */
    applySorting(communities, sortBy = 'relevance', sortOrder = 'desc') {
        const ascending = sortOrder === 'asc';
        switch (sortBy) {
            case 'members':
                communities.sort((a, b) => ascending
                    ? a.memberCount - b.memberCount
                    : b.memberCount - a.memberCount);
                break;
            case 'activity':
                communities.sort((a, b) => {
                    const activityA = a.recentActivity.postCount + a.recentActivity.commentCount;
                    const activityB = b.recentActivity.postCount + b.recentActivity.commentCount;
                    return ascending ? activityA - activityB : activityB - activityA;
                });
                break;
            case 'newest':
                communities.sort((a, b) => ascending
                    ? a.createdAt.getTime() - b.createdAt.getTime()
                    : b.createdAt.getTime() - a.createdAt.getTime());
                break;
            case 'alphabetical':
                communities.sort((a, b) => ascending
                    ? a.name.localeCompare(b.name)
                    : b.name.localeCompare(a.name));
                break;
            default: // relevance
                // Default sorting by member count for now
                communities.sort((a, b) => b.memberCount - a.memberCount);
                break;
        }
    }
    async calculateSearchFacets(where) {
        try {
            // Calculate member range distribution
            const memberRanges = [
                { range: '1-10', min: 1, max: 10 },
                { range: '11-50', min: 11, max: 50 },
                { range: '51-100', min: 51, max: 100 },
                { range: '101-500', min: 101, max: 500 },
                { range: '500+', min: 501, max: 999999 },
            ];
            const memberRangeCounts = await Promise.all(memberRanges.map(async (range) => {
                const count = await this.prisma.community.count({
                    where: {
                        ...where,
                        memberships: {
                            _count: {
                                gte: range.min,
                                ...(range.max < 999999 ? { lte: range.max } : {}),
                            },
                        },
                    },
                });
                return { range: range.range, count };
            }));
            return {
                memberRanges: memberRangeCounts,
                commonTags: [], // Could be implemented with a tag system
            };
        }
        catch (error) {
            this.logger.error('Error calculating search facets:', error);
            return {
                memberRanges: [],
                commonTags: [],
            };
        }
    }
    async calculateTrendingData(community, startDate, previousStartDate) {
        try {
            // Calculate growth rate
            const currentMembers = community.memberships.length;
            const previousMembers = await this.prisma.membership.count({
                where: {
                    communityId: community.id,
                    joinedAt: {
                        gte: previousStartDate,
                        lt: startDate,
                    },
                },
            });
            const growthRate = previousMembers > 0
                ? ((currentMembers - previousMembers) / previousMembers) * 100
                : currentMembers > 0
                    ? 100
                    : 0;
            // Calculate activity score
            const totalInteractions = community.posts.reduce((sum, post) => sum + post._count.comments + post._count.hearts, 0);
            const activityScore = Math.min((totalInteractions / Math.max(community._count.memberships, 1)) * 10, 100);
            // Calculate engagement rate
            const totalPosts = community.posts.length;
            const totalComments = community.posts.reduce((sum, post) => sum + post._count.comments, 0);
            const engagementRate = totalPosts > 0 ? (totalComments / totalPosts) * 10 : 0;
            // Calculate retention rate (simplified)
            const retentionRate = Math.min((currentMembers / Math.max(community._count.memberships, 1)) * 100, 100);
            return {
                growthRate: Math.max(0, growthRate),
                activityScore: Math.max(0, activityScore),
                engagementRate: Math.max(0, engagementRate),
                retentionRate: Math.max(0, retentionRate),
            };
        }
        catch (error) {
            this.logger.error('Error calculating trending data:', error);
            return {
                growthRate: 0,
                activityScore: 0,
                engagementRate: 0,
                retentionRate: 0,
            };
        }
    }
    async getTopContributors(communityId, limit) {
        try {
            // Get room IDs for this community
            const community = await this.prisma.community.findUnique({
                where: { id: communityId },
                include: {
                    roomGroups: {
                        include: {
                            rooms: { select: { id: true } },
                        },
                    },
                },
            });
            if (!community)
                return [];
            const roomIds = community.roomGroups.flatMap((rg) => rg.rooms.map((r) => r.id));
            // Get users with their contribution counts
            const contributors = await this.prisma.user.findMany({
                where: {
                    memberships: {
                        some: { communityId },
                    },
                },
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    avatarUrl: true,
                    _count: {
                        select: {
                            posts: {
                                where: { roomId: { in: roomIds } },
                            },
                            comments: {
                                where: {
                                    post: { roomId: { in: roomIds } },
                                },
                            },
                        },
                    },
                },
                take: limit * 2, // Get more to calculate scores
            });
            // Calculate contribution scores and sort
            const scoredContributors = contributors
                .map((contributor) => {
                const postCount = contributor._count.posts;
                const commentCount = contributor._count.comments;
                const contributionScore = postCount * 3 + commentCount * 1; // Posts worth more than comments
                return {
                    id: contributor.id,
                    firstName: contributor.firstName,
                    lastName: contributor.lastName,
                    avatarUrl: contributor.avatarUrl || undefined,
                    contributionScore,
                    postCount: Number(postCount),
                    commentCount: Number(commentCount),
                };
            })
                .filter((contributor) => contributor.contributionScore > 0)
                .sort((a, b) => b.contributionScore - a.contributionScore)
                .slice(0, limit);
            return scoredContributors;
        }
        catch (error) {
            this.logger.error(`Error getting top contributors for community ${communityId}:`, error);
            return [];
        }
    }
    /**
     * Check if user can moderate a specific community
     */
    async checkModerationPermissions(userId, communityId) {
        try {
            // Check if user is a global admin
            const user = await this.prisma.user.findUnique({
                where: { id: userId },
                select: { role: true },
            });
            if (user?.role === 'admin') {
                return true; // Global admins can moderate all communities
            }
            // Check if user is assigned as a moderator for this specific community
            const moderatorCommunity = await this.prisma.moderatorCommunity.findFirst({
                where: {
                    moderatorId: userId,
                    communityId,
                },
            });
            return !!moderatorCommunity;
        }
        catch (error) {
            this.logger.error(`Error checking moderation permissions for user ${userId} in community ${communityId}:`, error);
            return false;
        }
    }
};
exports.EnhancedCommunityService = EnhancedCommunityService;
exports.EnhancedCommunityService = EnhancedCommunityService = EnhancedCommunityService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof event_emitter_1.EventEmitter2 !== "undefined" && event_emitter_1.EventEmitter2) === "function" ? _b : Object])
], EnhancedCommunityService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL3NlcnZpY2VzL2VuaGFuY2VkLWNvbW11bml0eS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBS3dCO0FBQ3hCLG1GQUF1RTtBQUN2RSx5REFBc0Q7QUEyRy9DLElBQU0sd0JBQXdCLGdDQUE5QixNQUFNLHdCQUF3QjtJQUloQjtJQUNBO0lBSkYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLDBCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXBFLFlBQ21CLE1BQXFCLEVBQ3JCLFlBQTJCO1FBRDNCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsaUJBQVksR0FBWixZQUFZLENBQWU7SUFDM0MsQ0FBQztJQUVKOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGlCQUFpQixDQUNyQixPQUErQixFQUMvQixNQUFlLEVBQ2YsSUFBSSxHQUFHLENBQUMsRUFDUixLQUFLLEdBQUcsRUFBRTtRQVlWLElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUVsQyx5QkFBeUI7WUFDekIsTUFBTSxLQUFLLEdBQVEsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sT0FBTyxHQUFRLEVBQUUsQ0FBQztZQUV4QixjQUFjO1lBQ2QsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2xCLEtBQUssQ0FBQyxFQUFFLEdBQUc7b0JBQ1QsRUFBRSxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLEVBQUU7b0JBQzFELEVBQUUsV0FBVyxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxFQUFFO2lCQUNsRSxDQUFDO1lBQ0osQ0FBQztZQUVELHVDQUF1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Q0FBQTtBQTUzQlksNERBQXdCO21DQUF4Qix3QkFBd0I7SUFEcEMsSUFBQSxtQkFBVSxHQUFFO3lEQUtnQixzQ0FBYSxvQkFBYixzQ0FBYSxvREFDUCw2QkFBYSxvQkFBYiw2QkFBYTtHQUxuQyx3QkFBd0IsQ0E0M0JwQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvY29tbXVuaXRpZXMvc2VydmljZXMvZW5oYW5jZWQtY29tbXVuaXR5LnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSW5qZWN0YWJsZSxcbiAgTG9nZ2VyLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlcjIgfSBmcm9tICdAbmVzdGpzL2V2ZW50LWVtaXR0ZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbW11bml0eVNlYXJjaEZpbHRlcnMge1xuICBxdWVyeT86IHN0cmluZztcbiAgdGFncz86IHN0cmluZ1tdO1xuICBtaW5NZW1iZXJzPzogbnVtYmVyO1xuICBtYXhNZW1iZXJzPzogbnVtYmVyO1xuICBzb3J0Qnk/OiAncmVsZXZhbmNlJyB8ICdtZW1iZXJzJyB8ICdhY3Rpdml0eScgfCAnbmV3ZXN0JyB8ICdhbHBoYWJldGljYWwnO1xuICBzb3J0T3JkZXI/OiAnYXNjJyB8ICdkZXNjJztcbiAgaGFzRGVzY3JpcHRpb24/OiBib29sZWFuO1xuICBoYXNJbWFnZT86IGJvb2xlYW47XG4gIG1lbWJlcnNoaXBSZXF1aXJlZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbXVuaXR5U2VhcmNoUmVzdWx0IHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBzbHVnOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGltYWdlVXJsOiBzdHJpbmc7XG4gIG1lbWJlckNvdW50OiBudW1iZXI7XG4gIHJlY2VudEFjdGl2aXR5OiB7XG4gICAgcG9zdENvdW50OiBudW1iZXI7XG4gICAgY29tbWVudENvdW50OiBudW1iZXI7XG4gICAgbGFzdEFjdGl2aXR5QXQ6IERhdGUgfCBudWxsO1xuICB9O1xuICBjb21wYXRpYmlsaXR5Pzoge1xuICAgIHNjb3JlOiBudW1iZXI7XG4gICAgcmVhc29uaW5nOiBzdHJpbmc7XG4gIH07XG4gIG1lbWJlcnNoaXBTdGF0dXM6ICdtZW1iZXInIHwgJ3BlbmRpbmcnIHwgJ25vbmUnO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHRhZ3M/OiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFbmhhbmNlZENvbW11bml0eURldGFpbHMge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHNsdWc6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgaW1hZ2VVcmw6IHN0cmluZztcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG4gIG1lbWJlckNvdW50OiBudW1iZXI7XG4gIHN0YXRzOiB7XG4gICAgdG90YWxQb3N0czogbnVtYmVyO1xuICAgIHRvdGFsQ29tbWVudHM6IG51bWJlcjtcbiAgICBhY3RpdmVNZW1iZXJzOiBudW1iZXI7XG4gICAgcmVjZW50QWN0aXZpdHk6IHtcbiAgICAgIHBvc3RzVGhpc1dlZWs6IG51bWJlcjtcbiAgICAgIGNvbW1lbnRzVGhpc1dlZWs6IG51bWJlcjtcbiAgICAgIG5ld01lbWJlcnNUaGlzV2VlazogbnVtYmVyO1xuICAgIH07XG4gIH07XG4gIHJlY2VudFBvc3RzOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICBhdXRob3I6IHtcbiAgICAgIGlkOiBzdHJpbmc7XG4gICAgICBmaXJzdE5hbWU6IHN0cmluZztcbiAgICAgIGxhc3ROYW1lOiBzdHJpbmc7XG4gICAgICBhdmF0YXJVcmw/OiBzdHJpbmc7XG4gICAgfTtcbiAgICBjcmVhdGVkQXQ6IERhdGU7XG4gICAgaGVhcnRDb3VudDogbnVtYmVyO1xuICAgIGNvbW1lbnRDb3VudDogbnVtYmVyO1xuICB9W107XG4gIHRvcENvbnRyaWJ1dG9yczoge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgZmlyc3ROYW1lOiBzdHJpbmc7XG4gICAgbGFzdE5hbWU6IHN0cmluZztcbiAgICBhdmF0YXJVcmw/OiBzdHJpbmc7XG4gICAgY29udHJpYnV0aW9uU2NvcmU6IG51bWJlcjtcbiAgICBwb3N0Q291bnQ6IG51bWJlcjtcbiAgICBjb21tZW50Q291bnQ6IG51bWJlcjtcbiAgfVtdO1xuICBtb2RlcmF0b3JzOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBmaXJzdE5hbWU6IHN0cmluZztcbiAgICBsYXN0TmFtZTogc3RyaW5nO1xuICAgIGF2YXRhclVybD86IHN0cmluZztcbiAgICBhc3NpZ25lZEF0OiBEYXRlO1xuICB9W107XG4gIG1lbWJlcnNoaXBTdGF0dXM6ICdtZW1iZXInIHwgJ3BlbmRpbmcnIHwgJ25vbmUnO1xuICB1c2VyUGVybWlzc2lvbnM6IHtcbiAgICBjYW5Qb3N0OiBib29sZWFuO1xuICAgIGNhbkNvbW1lbnQ6IGJvb2xlYW47XG4gICAgY2FuTW9kZXJhdGU6IGJvb2xlYW47XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tbXVuaXR5VHJlbmRpbmdEYXRhIHtcbiAgZ3Jvd3RoUmF0ZTogbnVtYmVyOyAvLyBwZXJjZW50YWdlIGdyb3d0aCBpbiBtZW1iZXJzXG4gIGFjdGl2aXR5U2NvcmU6IG51bWJlcjsgLy8gYmFzZWQgb24gcG9zdHMsIGNvbW1lbnRzLCBoZWFydHNcbiAgZW5nYWdlbWVudFJhdGU6IG51bWJlcjsgLy8gY29tbWVudHMgcGVyIHBvc3QgcmF0aW9cbiAgcmV0ZW50aW9uUmF0ZTogbnVtYmVyOyAvLyBtZW1iZXJzIGFjdGl2ZSBpbiBsYXN0IDMwIGRheXNcbn1cblxuaW50ZXJmYWNlIENvbW11bml0eVJlY29tbWVuZGF0aW9uQ29udGV4dCB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBpbmNsdWRlU2ltaWxhcj86IGJvb2xlYW47XG4gIGV4Y2x1ZGVKb2luZWQ/OiBib29sZWFuO1xuICBtYXhSZXN1bHRzPzogbnVtYmVyO1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRW5oYW5jZWRDb21tdW5pdHlTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEVuaGFuY2VkQ29tbXVuaXR5U2VydmljZS5uYW1lKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByaXNtYTogUHJpc21hU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGV2ZW50RW1pdHRlcjogRXZlbnRFbWl0dGVyMixcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBBZHZhbmNlZCBjb21tdW5pdHkgc2VhcmNoIHdpdGggZmlsdGVyaW5nIGFuZCByYW5raW5nXG4gICAqL1xuICBhc3luYyBzZWFyY2hDb21tdW5pdGllcyhcbiAgICBmaWx0ZXJzOiBDb21tdW5pdHlTZWFyY2hGaWx0ZXJzLFxuICAgIHVzZXJJZD86IHN0cmluZyxcbiAgICBwYWdlID0gMSxcbiAgICBsaW1pdCA9IDIwLFxuICApOiBQcm9taXNlPHtcbiAgICBjb21tdW5pdGllczogQ29tbXVuaXR5U2VhcmNoUmVzdWx0W107XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICBwYWdlOiBudW1iZXI7XG4gICAgbGltaXQ6IG51bWJlcjtcbiAgICB0b3RhbFBhZ2VzOiBudW1iZXI7XG4gICAgZmFjZXRzOiB7XG4gICAgICBtZW1iZXJSYW5nZXM6IHsgcmFuZ2U6IHN0cmluZzsgY291bnQ6IG51bWJlciB9W107XG4gICAgICBjb21tb25UYWdzOiB7IHRhZzogc3RyaW5nOyBjb3VudDogbnVtYmVyIH1bXTtcbiAgICB9O1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9mZnNldCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgICAgLy8gQnVpbGQgdGhlIHNlYXJjaCBxdWVyeVxuICAgICAgY29uc3Qgd2hlcmU6IGFueSA9IHt9O1xuICAgICAgY29uc3Qgb3JkZXJCeTogYW55ID0gW107XG5cbiAgICAgIC8vIFRleHQgc2VhcmNoXG4gICAgICBpZiAoZmlsdGVycy5xdWVyeSkge1xuICAgICAgICB3aGVyZS5PUiA9IFtcbiAgICAgICAgICB7IG5hbWU6IHsgY29udGFpbnM6IGZpbHRlcnMucXVlcnksIG1vZGU6ICdpbnNlbnNpdGl2ZScgfSB9LFxuICAgICAgICAgIHsgZGVzY3JpcHRpb246IHsgY29udGFpbnM6IGZpbHRlcnMucXVlcnksIG1vZGU6ICdpbnNlbnNpdGl2ZScgfSB9LFxuICAgICAgICBdO1xuICAgICAgfVxuXG4gICAgICAvLyBGaWx0ZXIgYnkgZGVzY3JpcHRpb24vaW1hZ2UgcHJlc2VuY2VcbiAgICAgIGlmIChmaWx0ZXJzLmhhc0Rlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2hlcmUuZGVzY3JpcHRpb24gPSBmaWx0ZXJzLmhhc0Rlc2NyaXB0aW9uID8geyBub3Q6ICcnIH0gOiAnJztcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXJzLmhhc0ltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgd2hlcmUuaW1hZ2VVcmwgPSBmaWx0ZXJzLmhhc0ltYWdlID8geyBub3Q6ICcnIH0gOiAnJztcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGNvbW11bml0aWVzIHdpdGggbWVtYmVyIGNvdW50cyBhbmQgcmVjZW50IGFjdGl2aXR5XG4gICAgICBjb25zdCBjb21tdW5pdGllcyA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW11bml0eS5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgbWVtYmVyc2hpcHM6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVtYmVyc2hpcHM6IHVzZXJJZFxuICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlIH0sXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIHNraXA6IG9mZnNldCxcbiAgICAgICAgdGFrZTogbGltaXQsXG4gICAgICB9KTtcblxuICAgICAgLy8gQXBwbHkgbWVtYmVyIGNvdW50IGZpbHRlcnMgYW5kIGNhbGN1bGF0ZSBhY3Rpdml0eVxuICAgICAgY29uc3QgZmlsdGVyZWRDb21tdW5pdGllcyA9IGNvbW11bml0aWVzLmZpbHRlcigoY29tbXVuaXR5KSA9PiB7XG4gICAgICAgIGNvbnN0IG1lbWJlckNvdW50ID0gY29tbXVuaXR5Ll9jb3VudC5tZW1iZXJzaGlwcztcblxuICAgICAgICBpZiAoZmlsdGVycy5taW5NZW1iZXJzICYmIG1lbWJlckNvdW50IDwgZmlsdGVycy5taW5NZW1iZXJzKVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGZpbHRlcnMubWF4TWVtYmVycyAmJiBtZW1iZXJDb3VudCA+IGZpbHRlcnMubWF4TWVtYmVycylcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcblxuICAgICAgLy8gSm9pbiByZXF1ZXN0cyByZW1vdmVkIC0gc2ltcGxpZmllZCBjb21tdW5pdHkgc3lzdGVtXG4gICAgICBjb25zdCBwZW5kaW5nUmVxdWVzdHM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgIC8vIFRyYW5zZm9ybSB0byBzZWFyY2ggcmVzdWx0c1xuICAgICAgY29uc3Qgc2VhcmNoUmVzdWx0czogQ29tbXVuaXR5U2VhcmNoUmVzdWx0W10gPSBmaWx0ZXJlZENvbW11bml0aWVzLm1hcChcbiAgICAgICAgKGNvbW11bml0eSkgPT4ge1xuICAgICAgICAgIGNvbnN0IG1lbWJlckNvdW50ID0gY29tbXVuaXR5Ll9jb3VudC5tZW1iZXJzaGlwcztcbiAgICAgICAgICBjb25zdCBwb3N0Q291bnQgPSAwOyAvLyBQb3N0cyBhcmUgaW4gcm9vbXMsIG5vdCBkaXJlY3QgY29tbXVuaXR5IHJlbGF0aW9uXG4gICAgICAgICAgY29uc3QgY29tbWVudENvdW50ID0gMDsgLy8gQ29tbWVudHMgYXJlIGluIHBvc3RzIGluIHJvb21zXG4gICAgICAgICAgY29uc3QgbGFzdEFjdGl2aXR5QXQgPSBudWxsOyAvLyBBY3Rpdml0eSB0cmFja2luZyBzaW1wbGlmaWVkXG5cbiAgICAgICAgICAvLyBEZXRlcm1pbmUgbWVtYmVyc2hpcCBzdGF0dXNcbiAgICAgICAgICBsZXQgbWVtYmVyc2hpcFN0YXR1czogJ21lbWJlcicgfCAncGVuZGluZycgfCAnbm9uZScgPSAnbm9uZSc7XG4gICAgICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICAgICAgaWYgKGNvbW11bml0eS5tZW1iZXJzaGlwcyAmJiBjb21tdW5pdHkubWVtYmVyc2hpcHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBtZW1iZXJzaGlwU3RhdHVzID0gJ21lbWJlcic7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBlbmRpbmdSZXF1ZXN0cy5pbmNsdWRlcyhjb21tdW5pdHkuaWQpKSB7XG4gICAgICAgICAgICAgIG1lbWJlcnNoaXBTdGF0dXMgPSAncGVuZGluZyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBjb21tdW5pdHkuaWQsXG4gICAgICAgICAgICBuYW1lOiBjb21tdW5pdHkubmFtZSxcbiAgICAgICAgICAgIHNsdWc6IGNvbW11bml0eS5zbHVnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGNvbW11bml0eS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGltYWdlVXJsOiBjb21tdW5pdHkuaW1hZ2VVcmwsXG4gICAgICAgICAgICBtZW1iZXJDb3VudCxcbiAgICAgICAgICAgIHJlY2VudEFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIHBvc3RDb3VudCxcbiAgICAgICAgICAgICAgY29tbWVudENvdW50LFxuICAgICAgICAgICAgICBsYXN0QWN0aXZpdHlBdCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZW1iZXJzaGlwU3RhdHVzLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBjb21tdW5pdHkuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdGFnczogW10sIC8vIENvdWxkIGJlIGltcGxlbWVudGVkIHdpdGggYSB0YWdzIHN5c3RlbVxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICAvLyBBcHBseSBzb3J0aW5nXG4gICAgICB0aGlzLmFwcGx5U29ydGluZyhzZWFyY2hSZXN1bHRzLCBmaWx0ZXJzLnNvcnRCeSwgZmlsdGVycy5zb3J0T3JkZXIpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgZmFjZXRzIGZvciBmaWx0ZXJpbmcgVUlcbiAgICAgIGNvbnN0IGZhY2V0cyA9IGF3YWl0IHRoaXMuY2FsY3VsYXRlU2VhcmNoRmFjZXRzKHdoZXJlKTtcblxuICAgICAgLy8gR2V0IHRvdGFsIGNvdW50IGZvciBwYWdpbmF0aW9uXG4gICAgICBjb25zdCB0b3RhbCA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW11bml0eS5jb3VudCh7IHdoZXJlIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb21tdW5pdGllczogc2VhcmNoUmVzdWx0cyxcbiAgICAgICAgdG90YWwsXG4gICAgICAgIHBhZ2UsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICB0b3RhbFBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBsaW1pdCksXG4gICAgICAgIGZhY2V0cyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBzZWFyY2hpbmcgY29tbXVuaXRpZXM6YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlbmhhbmNlZCBjb21tdW5pdHkgZGV0YWlscyB3aXRoIGNvbXByZWhlbnNpdmUgc3RhdHNcbiAgICovXG4gIGFzeW5jIGdldENvbW11bml0eURldGFpbHMoXG4gICAgY29tbXVuaXR5SWQ6IHN0cmluZyxcbiAgICB1c2VySWQ/OiBzdHJpbmcsXG4gICk6IFByb21pc2U8RW5oYW5jZWRDb21tdW5pdHlEZXRhaWxzPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbW11bml0eSA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW11bml0eS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbW11bml0eUlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBtZW1iZXJzaGlwczogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByb29tR3JvdXBzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHJvb21zOiB7XG4gICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgcG9zdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFydHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZTogNSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb2RlcmF0b3JDb21tdW5pdGllczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICBtb2RlcmF0b3I6IHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVtYmVyc2hpcHM6IHVzZXJJZFxuICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlIH0sXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFjb21tdW5pdHkpIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKGBDb21tdW5pdHkgJHtjb21tdW5pdHlJZH0gbm90IGZvdW5kYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB0aW1lIHJhbmdlc1xuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IG9uZVdlZWtBZ28gPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgY29uc3Qgb25lTW9udGhBZ28gPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcblxuICAgICAgLy8gR2V0IGFsbCBwb3N0cyBmcm9tIHRoaXMgY29tbXVuaXR5J3Mgcm9vbXMgZm9yIHN0YXRpc3RpY3NcbiAgICAgIGNvbnN0IGNvbW11bml0eVJvb21JZHMgPSBjb21tdW5pdHkucm9vbUdyb3Vwcy5mbGF0TWFwKChyZykgPT5cbiAgICAgICAgcmcucm9vbXMubWFwKChyKSA9PiByLmlkKSxcbiAgICAgICk7XG5cbiAgICAgIC8vIEdldCBkZXRhaWxlZCBzdGF0aXN0aWNzXG4gICAgICBjb25zdCBbXG4gICAgICAgIHRvdGFsQ29tbWVudHMsXG4gICAgICAgIHdlZWtseVBvc3RzLFxuICAgICAgICB3ZWVrbHlDb21tZW50cyxcbiAgICAgICAgd2Vla2x5TWVtYmVycyxcbiAgICAgICAgYWN0aXZlTWVtYmVycyxcbiAgICAgICAgdG9wQ29udHJpYnV0b3JzLFxuICAgICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5wcmlzbWEuY29tbWVudC5jb3VudCh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHBvc3Q6IHsgcm9vbUlkOiB7IGluOiBjb21tdW5pdHlSb29tSWRzIH0gfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgdGhpcy5wcmlzbWEucG9zdC5jb3VudCh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHJvb21JZDogeyBpbjogY29tbXVuaXR5Um9vbUlkcyB9LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB7IGd0ZTogb25lV2Vla0FnbyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICB0aGlzLnByaXNtYS5jb21tZW50LmNvdW50KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgcG9zdDogeyByb29tSWQ6IHsgaW46IGNvbW11bml0eVJvb21JZHMgfSB9LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB7IGd0ZTogb25lV2Vla0FnbyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICB0aGlzLnByaXNtYS5tZW1iZXJzaGlwLmNvdW50KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgY29tbXVuaXR5SWQsXG4gICAgICAgICAgICBqb2luZWRBdDogeyBndGU6IG9uZVdlZWtBZ28gfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgdGhpcy5wcmlzbWEubWVtYmVyc2hpcC5jb3VudCh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGNvbW11bml0eUlkLFxuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHsgZ3RlOiBvbmVNb250aEFnbyB9LCAvLyBVc2UgdXBkYXRlZEF0IGFzIHByb3h5IGZvciBhY3Rpdml0eVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgdGhpcy5nZXRUb3BDb250cmlidXRvcnMoY29tbXVuaXR5SWQsIDUpLFxuICAgICAgXSk7XG5cbiAgICAgIC8vIERldGVybWluZSBtZW1iZXJzaGlwIHN0YXR1cyBhbmQgcGVybWlzc2lvbnNcbiAgICAgIGxldCBtZW1iZXJzaGlwU3RhdHVzOiAnbWVtYmVyJyB8ICdwZW5kaW5nJyB8ICdub25lJyA9ICdub25lJztcbiAgICAgIGxldCB1c2VyUGVybWlzc2lvbnMgPSB7XG4gICAgICAgIGNhblBvc3Q6IGZhbHNlLFxuICAgICAgICBjYW5Db21tZW50OiBmYWxzZSxcbiAgICAgICAgY2FuTW9kZXJhdGU6IGZhbHNlLFxuICAgICAgfTtcblxuICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICBjb25zdCBtZW1iZXJzaGlwID0gY29tbXVuaXR5Lm1lbWJlcnNoaXBzPy5bMF07XG4gICAgICAgIGlmIChtZW1iZXJzaGlwKSB7XG4gICAgICAgICAgbWVtYmVyc2hpcFN0YXR1cyA9ICdtZW1iZXInO1xuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdXNlciBjYW4gbW9kZXJhdGUgYmFzZWQgb24gZ2xvYmFsIHJvbGUgYW5kIGNvbW11bml0eSBtb2RlcmF0b3IgYXNzaWdubWVudFxuICAgICAgICAgIGNvbnN0IGNhbk1vZGVyYXRlID0gYXdhaXQgdGhpcy5jaGVja01vZGVyYXRpb25QZXJtaXNzaW9ucyh1c2VySWQsIGNvbW11bml0eUlkKTtcblxuICAgICAgICAgIHVzZXJQZXJtaXNzaW9ucyA9IHtcbiAgICAgICAgICAgIGNhblBvc3Q6IHRydWUsXG4gICAgICAgICAgICBjYW5Db21tZW50OiB0cnVlLFxuICAgICAgICAgICAgY2FuTW9kZXJhdGUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBKb2luIHJlcXVlc3RzIHJlbW92ZWQgLSB1c2VycyBhcmUgYXV0b21hdGljYWxseSBhc3NpZ25lZCBjb21tdW5pdGllc1xuICAgICAgICAgIC8vIE5vIHBlbmRpbmcgc3RhdHVzIHNpbmNlIHVzZXJzIGdldCBpbW1lZGlhdGUgbWVtYmVyc2hpcFxuICAgICAgICAgIG1lbWJlcnNoaXBTdGF0dXMgPSAnbm9uZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGNvbW11bml0eS5pZCxcbiAgICAgICAgbmFtZTogY29tbXVuaXR5Lm5hbWUsXG4gICAgICAgIHNsdWc6IGNvbW11bml0eS5zbHVnLFxuICAgICAgICBkZXNjcmlwdGlvbjogY29tbXVuaXR5LmRlc2NyaXB0aW9uLFxuICAgICAgICBpbWFnZVVybDogY29tbXVuaXR5LmltYWdlVXJsLFxuICAgICAgICBjcmVhdGVkQXQ6IGNvbW11bml0eS5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogY29tbXVuaXR5LnVwZGF0ZWRBdCxcbiAgICAgICAgbWVtYmVyQ291bnQ6IGNvbW11bml0eS5fY291bnQubWVtYmVyc2hpcHMsXG4gICAgICAgIHN0YXRzOiB7XG4gICAgICAgICAgdG90YWxQb3N0czogY29tbXVuaXR5LnJvb21Hcm91cHMucmVkdWNlKFxuICAgICAgICAgICAgKHRvdGFsLCByZykgPT5cbiAgICAgICAgICAgICAgdG90YWwgK1xuICAgICAgICAgICAgICByZy5yb29tcy5yZWR1Y2UoXG4gICAgICAgICAgICAgICAgKHJvb21Ub3RhbCwgcm9vbSkgPT4gcm9vbVRvdGFsICsgcm9vbS5wb3N0cy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgKSxcbiAgICAgICAgICB0b3RhbENvbW1lbnRzLFxuICAgICAgICAgIGFjdGl2ZU1lbWJlcnMsXG4gICAgICAgICAgcmVjZW50QWN0aXZpdHk6IHtcbiAgICAgICAgICAgIHBvc3RzVGhpc1dlZWs6IHdlZWtseVBvc3RzLFxuICAgICAgICAgICAgY29tbWVudHNUaGlzV2Vlazogd2Vla2x5Q29tbWVudHMsXG4gICAgICAgICAgICBuZXdNZW1iZXJzVGhpc1dlZWs6IHdlZWtseU1lbWJlcnMsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVjZW50UG9zdHM6IGNvbW11bml0eS5yb29tR3JvdXBzXG4gICAgICAgICAgLmZsYXRNYXAoKHJnKSA9PiByZy5yb29tcy5mbGF0TWFwKChyb29tKSA9PiByb29tLnBvc3RzKSlcbiAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYi5jcmVhdGVkQXQuZ2V0VGltZSgpIC0gYS5jcmVhdGVkQXQuZ2V0VGltZSgpKVxuICAgICAgICAgIC5zbGljZSgwLCA1KVxuICAgICAgICAgIC5tYXAoKHBvc3QpID0+ICh7XG4gICAgICAgICAgICBpZDogcG9zdC5pZCxcbiAgICAgICAgICAgIHRpdGxlOiBwb3N0LnRpdGxlLFxuICAgICAgICAgICAgY29udGVudDogcG9zdC5jb250ZW50LFxuICAgICAgICAgICAgYXV0aG9yOiBwb3N0LnVzZXJcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICBpZDogcG9zdC51c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiBwb3N0LnVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHBvc3QudXNlci5sYXN0TmFtZSxcbiAgICAgICAgICAgICAgICAgIGF2YXRhclVybDogcG9zdC51c2VyLmF2YXRhclVybCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgIGlkOiAndW5rbm93bicsXG4gICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6ICdVbmtub3duJyxcbiAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBwb3N0LmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIGhlYXJ0Q291bnQ6IHBvc3QuX2NvdW50LmhlYXJ0cyxcbiAgICAgICAgICAgIGNvbW1lbnRDb3VudDogcG9zdC5fY291bnQuY29tbWVudHMsXG4gICAgICAgICAgfSkpLFxuICAgICAgICB0b3BDb250cmlidXRvcnMsXG4gICAgICAgIG1vZGVyYXRvcnM6IGNvbW11bml0eS5tb2RlcmF0b3JDb21tdW5pdGllcy5tYXAoKG1jKSA9PiAoe1xuICAgICAgICAgIGlkOiBtYy5tb2RlcmF0b3IudXNlci5pZCxcbiAgICAgICAgICBmaXJzdE5hbWU6IG1jLm1vZGVyYXRvci51c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbWMubW9kZXJhdG9yLnVzZXIubGFzdE5hbWUsXG4gICAgICAgICAgYXZhdGFyVXJsOiBtYy5tb2RlcmF0b3IudXNlci5hdmF0YXJVcmwgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGFzc2lnbmVkQXQ6IG1jLmFzc2lnbmVkQXQsXG4gICAgICAgIH0pKSxcbiAgICAgICAgbWVtYmVyc2hpcFN0YXR1cyxcbiAgICAgICAgdXNlclBlcm1pc3Npb25zLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvciBnZXR0aW5nIGNvbW11bml0eSBkZXRhaWxzIGZvciAke2NvbW11bml0eUlkfTpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRyZW5kaW5nIGNvbW11bml0aWVzIGJhc2VkIG9uIGdyb3d0aCBhbmQgYWN0aXZpdHlcbiAgICovXG4gIGFzeW5jIGdldFRyZW5kaW5nQ29tbXVuaXRpZXMoXG4gICAgbGltaXQgPSAxMCxcbiAgICB0aW1lZnJhbWU6ICd3ZWVrJyB8ICdtb250aCcgPSAnd2VlaycsXG4gICk6IFByb21pc2U8XG4gICAgKENvbW11bml0eVNlYXJjaFJlc3VsdCAmIHsgdHJlbmRpbmdEYXRhOiBDb21tdW5pdHlUcmVuZGluZ0RhdGEgfSlbXVxuICA+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IHRpbWVmcmFtZU1zID1cbiAgICAgICAgdGltZWZyYW1lID09PSAnd2VlaydcbiAgICAgICAgICA/IDcgKiAyNCAqIDYwICogNjAgKiAxMDAwXG4gICAgICAgICAgOiAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XG4gICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gdGltZWZyYW1lTXMpO1xuICAgICAgY29uc3QgcHJldmlvdXNTdGFydERhdGUgPSBuZXcgRGF0ZShzdGFydERhdGUuZ2V0VGltZSgpIC0gdGltZWZyYW1lTXMpO1xuXG4gICAgICBjb25zdCBjb21tdW5pdGllcyA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW11bml0eS5maW5kTWFueSh7XG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBtZW1iZXJzaGlwczogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVtYmVyc2hpcHM6IHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGpvaW5lZEF0OiB7IGd0ZTogc3RhcnREYXRlIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0OiB7IGpvaW5lZEF0OiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByb29tR3JvdXBzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHJvb21zOiB7XG4gICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgcG9zdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHsgZ3RlOiBzdGFydERhdGUgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7IGNvbW1lbnRzOiB0cnVlLCBoZWFydHM6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSB0cmVuZGluZyBkYXRhIGZvciBlYWNoIGNvbW11bml0eVxuICAgICAgY29uc3QgdHJlbmRpbmdDb21tdW5pdGllcyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICBjb21tdW5pdGllcy5tYXAoYXN5bmMgKGNvbW11bml0eSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFsbFBvc3RzID0gY29tbXVuaXR5LnJvb21Hcm91cHMuZmxhdE1hcCgocmcpID0+XG4gICAgICAgICAgICByZy5yb29tcy5mbGF0TWFwKChyb29tKSA9PiByb29tLnBvc3RzKSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgY29uc3QgdHJlbmRpbmdEYXRhID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVUcmVuZGluZ0RhdGEoXG4gICAgICAgICAgICB7IC4uLmNvbW11bml0eSwgcG9zdHM6IGFsbFBvc3RzIH0sXG4gICAgICAgICAgICBzdGFydERhdGUsXG4gICAgICAgICAgICBwcmV2aW91c1N0YXJ0RGF0ZSxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBjb21tdW5pdHkuaWQsXG4gICAgICAgICAgICBuYW1lOiBjb21tdW5pdHkubmFtZSxcbiAgICAgICAgICAgIHNsdWc6IGNvbW11bml0eS5zbHVnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGNvbW11bml0eS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGltYWdlVXJsOiBjb21tdW5pdHkuaW1hZ2VVcmwsXG4gICAgICAgICAgICBtZW1iZXJDb3VudDogY29tbXVuaXR5Ll9jb3VudC5tZW1iZXJzaGlwcyxcbiAgICAgICAgICAgIHJlY2VudEFjdGl2aXR5OiB7XG4gICAgICAgICAgICAgIHBvc3RDb3VudDogYWxsUG9zdHMubGVuZ3RoLFxuICAgICAgICAgICAgICBjb21tZW50Q291bnQ6IGFsbFBvc3RzLnJlZHVjZShcbiAgICAgICAgICAgICAgICAoc3VtLCBwb3N0KSA9PiBzdW0gKyBwb3N0Ll9jb3VudC5jb21tZW50cyxcbiAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICBsYXN0QWN0aXZpdHlBdDpcbiAgICAgICAgICAgICAgICBhbGxQb3N0cy5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgICA/IGFsbFBvc3RzLnJlZHVjZShcbiAgICAgICAgICAgICAgICAgICAgICAobGF0ZXN0LCBwb3N0KSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zdC5jcmVhdGVkQXQgPiBsYXRlc3QgPyBwb3N0LmNyZWF0ZWRBdCA6IGxhdGVzdCxcbiAgICAgICAgICAgICAgICAgICAgICBhbGxQb3N0c1swXS5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZW1iZXJzaGlwU3RhdHVzOiAnbm9uZScgYXMgY29uc3QsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IGNvbW11bml0eS5jcmVhdGVkQXQsXG4gICAgICAgICAgICB0cmVuZGluZ0RhdGEsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSksXG4gICAgICApO1xuXG4gICAgICAvLyBTb3J0IGJ5IHRyZW5kaW5nIHNjb3JlIChjb21iaW5hdGlvbiBvZiBncm93dGggcmF0ZSBhbmQgYWN0aXZpdHkpXG4gICAgICB0cmVuZGluZ0NvbW11bml0aWVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgY29uc3Qgc2NvcmVBID1cbiAgICAgICAgICBhLnRyZW5kaW5nRGF0YS5ncm93dGhSYXRlICogMC40ICtcbiAgICAgICAgICBhLnRyZW5kaW5nRGF0YS5hY3Rpdml0eVNjb3JlICogMC40ICtcbiAgICAgICAgICBhLnRyZW5kaW5nRGF0YS5lbmdhZ2VtZW50UmF0ZSAqIDAuMjtcbiAgICAgICAgY29uc3Qgc2NvcmVCID1cbiAgICAgICAgICBiLnRyZW5kaW5nRGF0YS5ncm93dGhSYXRlICogMC40ICtcbiAgICAgICAgICBiLnRyZW5kaW5nRGF0YS5hY3Rpdml0eVNjb3JlICogMC40ICtcbiAgICAgICAgICBiLnRyZW5kaW5nRGF0YS5lbmdhZ2VtZW50UmF0ZSAqIDAuMjtcbiAgICAgICAgcmV0dXJuIHNjb3JlQiAtIHNjb3JlQTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdHJlbmRpbmdDb21tdW5pdGllcy5zbGljZSgwLCBsaW1pdCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBnZXR0aW5nIHRyZW5kaW5nIGNvbW11bml0aWVzOmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2ltaWxhciBjb21tdW5pdGllcyBiYXNlZCBvbiB1c2VyIGFjdGl2aXR5IGFuZCBwcmVmZXJlbmNlc1xuICAgKi9cbiAgYXN5bmMgZ2V0U2ltaWxhckNvbW11bml0aWVzKFxuICAgIGNvbW11bml0eUlkOiBzdHJpbmcsXG4gICAgY29udGV4dDogQ29tbXVuaXR5UmVjb21tZW5kYXRpb25Db250ZXh0LFxuICApOiBQcm9taXNlPENvbW11bml0eVNlYXJjaFJlc3VsdFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgdXNlcklkLCBleGNsdWRlSm9pbmVkID0gdHJ1ZSwgbWF4UmVzdWx0cyA9IDUgfSA9IGNvbnRleHQ7XG5cbiAgICAgIC8vIEdldCB0aGUgcmVmZXJlbmNlIGNvbW11bml0eVxuICAgICAgY29uc3QgcmVmQ29tbXVuaXR5ID0gYXdhaXQgdGhpcy5wcmlzbWEuY29tbXVuaXR5LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29tbXVuaXR5SWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIG1lbWJlcnNoaXBzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICBtZW1iZXJzaGlwczoge1xuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlOiB7IGNvbW11bml0eTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVmQ29tbXVuaXR5KSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihgQ29tbXVuaXR5ICR7Y29tbXVuaXR5SWR9IG5vdCBmb3VuZGApO1xuICAgICAgfVxuXG4gICAgICAvLyBGaW5kIGNvbW11bml0aWVzIHRoYXQgb3RoZXIgbWVtYmVycyBvZiB0aGlzIGNvbW11bml0eSBoYXZlIGpvaW5lZFxuICAgICAgY29uc3QgbWVtYmVyQ29tbXVuaXRpZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuXG4gICAgICByZWZDb21tdW5pdHkubWVtYmVyc2hpcHMuZm9yRWFjaCgobWVtYmVyc2hpcCkgPT4ge1xuICAgICAgICBpZiAobWVtYmVyc2hpcC51c2VyKSB7XG4gICAgICAgICAgbWVtYmVyc2hpcC51c2VyLm1lbWJlcnNoaXBzLmZvckVhY2goKHVzZXJNZW1iZXJzaGlwKSA9PiB7XG4gICAgICAgICAgICBpZiAodXNlck1lbWJlcnNoaXAuY29tbXVuaXR5SWQgIT09IGNvbW11bml0eUlkKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGNvdW50ID1cbiAgICAgICAgICAgICAgICBtZW1iZXJDb21tdW5pdGllcy5nZXQodXNlck1lbWJlcnNoaXAuY29tbXVuaXR5SWQpIHx8IDA7XG4gICAgICAgICAgICAgIG1lbWJlckNvbW11bml0aWVzLnNldCh1c2VyTWVtYmVyc2hpcC5jb21tdW5pdHlJZCwgY291bnQgKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNvcnQgYnkgb3ZlcmxhcCBjb3VudCBhbmQgZ2V0IHRvcCBjb21tdW5pdGllc1xuICAgICAgY29uc3Qgc29ydGVkQ29tbXVuaXRpZXMgPSBBcnJheS5mcm9tKG1lbWJlckNvbW11bml0aWVzLmVudHJpZXMoKSlcbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IGJbMV0gLSBhWzFdKVxuICAgICAgICAuc2xpY2UoMCwgbWF4UmVzdWx0cyAqIDIpOyAvLyBHZXQgbW9yZSB0byBmaWx0ZXIgb3V0IGpvaW5lZCBvbmVzXG5cbiAgICAgIC8vIEdldCBjb21tdW5pdHkgZGV0YWlsc1xuICAgICAgY29uc3QgY29tbXVuaXR5SWRzID0gc29ydGVkQ29tbXVuaXRpZXMubWFwKChbaWRdKSA9PiBpZCk7XG4gICAgICBjb25zdCBjb21tdW5pdGllcyA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW11bml0eS5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB7IGluOiBjb21tdW5pdHlJZHMgfSB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogeyBtZW1iZXJzaGlwczogdHJ1ZSB9IH0sXG4gICAgICAgICAgcm9vbUdyb3Vwczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICByb29tczoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgIF9jb3VudDogeyBzZWxlY3Q6IHsgcG9zdHM6IHRydWUgfSB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gR2V0IHVzZXIncyBqb2luZWQgY29tbXVuaXRpZXMgaWYgZXhjbHVkaW5nIHRoZW1cbiAgICAgIGxldCB1c2VyQ29tbXVuaXR5SWRzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgaWYgKGV4Y2x1ZGVKb2luZWQgJiYgdXNlcklkKSB7XG4gICAgICAgIGNvbnN0IHVzZXJNZW1iZXJzaGlwcyA9IGF3YWl0IHRoaXMucHJpc21hLm1lbWJlcnNoaXAuZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgICAgICAgIHNlbGVjdDogeyBjb21tdW5pdHlJZDogdHJ1ZSB9LFxuICAgICAgICB9KTtcbiAgICAgICAgdXNlckNvbW11bml0eUlkcyA9IHVzZXJNZW1iZXJzaGlwcy5tYXAoKG0pID0+IG0uY29tbXVuaXR5SWQpO1xuICAgICAgfVxuXG4gICAgICAvLyBGaWx0ZXIgYW5kIGZvcm1hdCByZXN1bHRzXG4gICAgICBjb25zdCBzaW1pbGFyQ29tbXVuaXRpZXMgPSBjb21tdW5pdGllc1xuICAgICAgICAuZmlsdGVyKChjb21tdW5pdHkpID0+ICF1c2VyQ29tbXVuaXR5SWRzLmluY2x1ZGVzKGNvbW11bml0eS5pZCkpXG4gICAgICAgIC5tYXAoKGNvbW11bml0eSkgPT4gKHtcbiAgICAgICAgICBpZDogY29tbXVuaXR5LmlkLFxuICAgICAgICAgIG5hbWU6IGNvbW11bml0eS5uYW1lLFxuICAgICAgICAgIHNsdWc6IGNvbW11bml0eS5zbHVnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBjb21tdW5pdHkuZGVzY3JpcHRpb24sXG4gICAgICAgICAgaW1hZ2VVcmw6IGNvbW11bml0eS5pbWFnZVVybCxcbiAgICAgICAgICBtZW1iZXJDb3VudDogY29tbXVuaXR5Ll9jb3VudC5tZW1iZXJzaGlwcyxcbiAgICAgICAgICByZWNlbnRBY3Rpdml0eToge1xuICAgICAgICAgICAgcG9zdENvdW50OiBjb21tdW5pdHkucm9vbUdyb3Vwcy5yZWR1Y2UoXG4gICAgICAgICAgICAgICh0b3RhbCwgcmcpID0+XG4gICAgICAgICAgICAgICAgdG90YWwgK1xuICAgICAgICAgICAgICAgIHJnLnJvb21zLnJlZHVjZShcbiAgICAgICAgICAgICAgICAgIChyb29tVG90YWwsIHJvb20pID0+IHJvb21Ub3RhbCArIHJvb20uX2NvdW50LnBvc3RzLFxuICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGNvbW1lbnRDb3VudDogMCwgLy8gQ291bGQgYmUgY2FsY3VsYXRlZCBpZiBuZWVkZWRcbiAgICAgICAgICAgIGxhc3RBY3Rpdml0eUF0OiBudWxsLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVtYmVyc2hpcFN0YXR1czogJ25vbmUnIGFzIGNvbnN0LFxuICAgICAgICAgIGNyZWF0ZWRBdDogY29tbXVuaXR5LmNyZWF0ZWRBdCxcbiAgICAgICAgfSkpXG4gICAgICAgIC5zbGljZSgwLCBtYXhSZXN1bHRzKTtcblxuICAgICAgcmV0dXJuIHNpbWlsYXJDb21tdW5pdGllcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvciBnZXR0aW5nIHNpbWlsYXIgY29tbXVuaXRpZXMgZm9yICR7Y29tbXVuaXR5SWR9OmAsXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIGhlbHBlciBtZXRob2RzXG4gICAqL1xuICBwcml2YXRlIGFwcGx5U29ydGluZyhcbiAgICBjb21tdW5pdGllczogQ29tbXVuaXR5U2VhcmNoUmVzdWx0W10sXG4gICAgc29ydEJ5OiBzdHJpbmcgPSAncmVsZXZhbmNlJyxcbiAgICBzb3J0T3JkZXI6IHN0cmluZyA9ICdkZXNjJyxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYXNjZW5kaW5nID0gc29ydE9yZGVyID09PSAnYXNjJztcblxuICAgIHN3aXRjaCAoc29ydEJ5KSB7XG4gICAgICBjYXNlICdtZW1iZXJzJzpcbiAgICAgICAgY29tbXVuaXRpZXMuc29ydCgoYSwgYikgPT5cbiAgICAgICAgICBhc2NlbmRpbmdcbiAgICAgICAgICAgID8gYS5tZW1iZXJDb3VudCAtIGIubWVtYmVyQ291bnRcbiAgICAgICAgICAgIDogYi5tZW1iZXJDb3VudCAtIGEubWVtYmVyQ291bnQsXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdhY3Rpdml0eSc6XG4gICAgICAgIGNvbW11bml0aWVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICBjb25zdCBhY3Rpdml0eUEgPVxuICAgICAgICAgICAgYS5yZWNlbnRBY3Rpdml0eS5wb3N0Q291bnQgKyBhLnJlY2VudEFjdGl2aXR5LmNvbW1lbnRDb3VudDtcbiAgICAgICAgICBjb25zdCBhY3Rpdml0eUIgPVxuICAgICAgICAgICAgYi5yZWNlbnRBY3Rpdml0eS5wb3N0Q291bnQgKyBiLnJlY2VudEFjdGl2aXR5LmNvbW1lbnRDb3VudDtcbiAgICAgICAgICByZXR1cm4gYXNjZW5kaW5nID8gYWN0aXZpdHlBIC0gYWN0aXZpdHlCIDogYWN0aXZpdHlCIC0gYWN0aXZpdHlBO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ25ld2VzdCc6XG4gICAgICAgIGNvbW11bml0aWVzLnNvcnQoKGEsIGIpID0+XG4gICAgICAgICAgYXNjZW5kaW5nXG4gICAgICAgICAgICA/IGEuY3JlYXRlZEF0LmdldFRpbWUoKSAtIGIuY3JlYXRlZEF0LmdldFRpbWUoKVxuICAgICAgICAgICAgOiBiLmNyZWF0ZWRBdC5nZXRUaW1lKCkgLSBhLmNyZWF0ZWRBdC5nZXRUaW1lKCksXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdhbHBoYWJldGljYWwnOlxuICAgICAgICBjb21tdW5pdGllcy5zb3J0KChhLCBiKSA9PlxuICAgICAgICAgIGFzY2VuZGluZ1xuICAgICAgICAgICAgPyBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpXG4gICAgICAgICAgICA6IGIubmFtZS5sb2NhbGVDb21wYXJlKGEubmFtZSksXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OiAvLyByZWxldmFuY2VcbiAgICAgICAgLy8gRGVmYXVsdCBzb3J0aW5nIGJ5IG1lbWJlciBjb3VudCBmb3Igbm93XG4gICAgICAgIGNvbW11bml0aWVzLnNvcnQoKGEsIGIpID0+IGIubWVtYmVyQ291bnQgLSBhLm1lbWJlckNvdW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxjdWxhdGVTZWFyY2hGYWNldHMod2hlcmU6IGFueSk6IFByb21pc2U8e1xuICAgIG1lbWJlclJhbmdlczogeyByYW5nZTogc3RyaW5nOyBjb3VudDogbnVtYmVyIH1bXTtcbiAgICBjb21tb25UYWdzOiB7IHRhZzogc3RyaW5nOyBjb3VudDogbnVtYmVyIH1bXTtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDYWxjdWxhdGUgbWVtYmVyIHJhbmdlIGRpc3RyaWJ1dGlvblxuICAgICAgY29uc3QgbWVtYmVyUmFuZ2VzID0gW1xuICAgICAgICB7IHJhbmdlOiAnMS0xMCcsIG1pbjogMSwgbWF4OiAxMCB9LFxuICAgICAgICB7IHJhbmdlOiAnMTEtNTAnLCBtaW46IDExLCBtYXg6IDUwIH0sXG4gICAgICAgIHsgcmFuZ2U6ICc1MS0xMDAnLCBtaW46IDUxLCBtYXg6IDEwMCB9LFxuICAgICAgICB7IHJhbmdlOiAnMTAxLTUwMCcsIG1pbjogMTAxLCBtYXg6IDUwMCB9LFxuICAgICAgICB7IHJhbmdlOiAnNTAwKycsIG1pbjogNTAxLCBtYXg6IDk5OTk5OSB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbWVtYmVyUmFuZ2VDb3VudHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgbWVtYmVyUmFuZ2VzLm1hcChhc3luYyAocmFuZ2UpID0+IHtcbiAgICAgICAgICBjb25zdCBjb3VudCA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW11bml0eS5jb3VudCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAuLi53aGVyZSxcbiAgICAgICAgICAgICAgbWVtYmVyc2hpcHM6IHtcbiAgICAgICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgICAgIGd0ZTogcmFuZ2UubWluLFxuICAgICAgICAgICAgICAgICAgLi4uKHJhbmdlLm1heCA8IDk5OTk5OSA/IHsgbHRlOiByYW5nZS5tYXggfSA6IHt9KSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4geyByYW5nZTogcmFuZ2UucmFuZ2UsIGNvdW50IH07XG4gICAgICAgIH0pLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVtYmVyUmFuZ2VzOiBtZW1iZXJSYW5nZUNvdW50cyxcbiAgICAgICAgY29tbW9uVGFnczogW10sIC8vIENvdWxkIGJlIGltcGxlbWVudGVkIHdpdGggYSB0YWcgc3lzdGVtXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRXJyb3IgY2FsY3VsYXRpbmcgc2VhcmNoIGZhY2V0czonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZW1iZXJSYW5nZXM6IFtdLFxuICAgICAgICBjb21tb25UYWdzOiBbXSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxjdWxhdGVUcmVuZGluZ0RhdGEoXG4gICAgY29tbXVuaXR5OiBhbnksXG4gICAgc3RhcnREYXRlOiBEYXRlLFxuICAgIHByZXZpb3VzU3RhcnREYXRlOiBEYXRlLFxuICApOiBQcm9taXNlPENvbW11bml0eVRyZW5kaW5nRGF0YT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDYWxjdWxhdGUgZ3Jvd3RoIHJhdGVcbiAgICAgIGNvbnN0IGN1cnJlbnRNZW1iZXJzID0gY29tbXVuaXR5Lm1lbWJlcnNoaXBzLmxlbmd0aDtcbiAgICAgIGNvbnN0IHByZXZpb3VzTWVtYmVycyA9IGF3YWl0IHRoaXMucHJpc21hLm1lbWJlcnNoaXAuY291bnQoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNvbW11bml0eUlkOiBjb21tdW5pdHkuaWQsXG4gICAgICAgICAgam9pbmVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogcHJldmlvdXNTdGFydERhdGUsXG4gICAgICAgICAgICBsdDogc3RhcnREYXRlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZ3Jvd3RoUmF0ZSA9XG4gICAgICAgIHByZXZpb3VzTWVtYmVycyA+IDBcbiAgICAgICAgICA/ICgoY3VycmVudE1lbWJlcnMgLSBwcmV2aW91c01lbWJlcnMpIC8gcHJldmlvdXNNZW1iZXJzKSAqIDEwMFxuICAgICAgICAgIDogY3VycmVudE1lbWJlcnMgPiAwXG4gICAgICAgICAgICA/IDEwMFxuICAgICAgICAgICAgOiAwO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgYWN0aXZpdHkgc2NvcmVcbiAgICAgIGNvbnN0IHRvdGFsSW50ZXJhY3Rpb25zID0gY29tbXVuaXR5LnBvc3RzLnJlZHVjZShcbiAgICAgICAgKHN1bTogbnVtYmVyLCBwb3N0OiBhbnkpID0+XG4gICAgICAgICAgc3VtICsgcG9zdC5fY291bnQuY29tbWVudHMgKyBwb3N0Ll9jb3VudC5oZWFydHMsXG4gICAgICAgIDAsXG4gICAgICApO1xuICAgICAgY29uc3QgYWN0aXZpdHlTY29yZSA9IE1hdGgubWluKFxuICAgICAgICAodG90YWxJbnRlcmFjdGlvbnMgLyBNYXRoLm1heChjb21tdW5pdHkuX2NvdW50Lm1lbWJlcnNoaXBzLCAxKSkgKiAxMCxcbiAgICAgICAgMTAwLFxuICAgICAgKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGVuZ2FnZW1lbnQgcmF0ZVxuICAgICAgY29uc3QgdG90YWxQb3N0cyA9IGNvbW11bml0eS5wb3N0cy5sZW5ndGg7XG4gICAgICBjb25zdCB0b3RhbENvbW1lbnRzID0gY29tbXVuaXR5LnBvc3RzLnJlZHVjZShcbiAgICAgICAgKHN1bTogbnVtYmVyLCBwb3N0OiBhbnkpID0+IHN1bSArIHBvc3QuX2NvdW50LmNvbW1lbnRzLFxuICAgICAgICAwLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGVuZ2FnZW1lbnRSYXRlID1cbiAgICAgICAgdG90YWxQb3N0cyA+IDAgPyAodG90YWxDb21tZW50cyAvIHRvdGFsUG9zdHMpICogMTAgOiAwO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgcmV0ZW50aW9uIHJhdGUgKHNpbXBsaWZpZWQpXG4gICAgICBjb25zdCByZXRlbnRpb25SYXRlID0gTWF0aC5taW4oXG4gICAgICAgIChjdXJyZW50TWVtYmVycyAvIE1hdGgubWF4KGNvbW11bml0eS5fY291bnQubWVtYmVyc2hpcHMsIDEpKSAqIDEwMCxcbiAgICAgICAgMTAwLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ3Jvd3RoUmF0ZTogTWF0aC5tYXgoMCwgZ3Jvd3RoUmF0ZSksXG4gICAgICAgIGFjdGl2aXR5U2NvcmU6IE1hdGgubWF4KDAsIGFjdGl2aXR5U2NvcmUpLFxuICAgICAgICBlbmdhZ2VtZW50UmF0ZTogTWF0aC5tYXgoMCwgZW5nYWdlbWVudFJhdGUpLFxuICAgICAgICByZXRlbnRpb25SYXRlOiBNYXRoLm1heCgwLCByZXRlbnRpb25SYXRlKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdFcnJvciBjYWxjdWxhdGluZyB0cmVuZGluZyBkYXRhOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGdyb3d0aFJhdGU6IDAsXG4gICAgICAgIGFjdGl2aXR5U2NvcmU6IDAsXG4gICAgICAgIGVuZ2FnZW1lbnRSYXRlOiAwLFxuICAgICAgICByZXRlbnRpb25SYXRlOiAwLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFRvcENvbnRyaWJ1dG9ycyhcbiAgICBjb21tdW5pdHlJZDogc3RyaW5nLFxuICAgIGxpbWl0OiBudW1iZXIsXG4gICk6IFByb21pc2U8XG4gICAge1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIGZpcnN0TmFtZTogc3RyaW5nO1xuICAgICAgbGFzdE5hbWU6IHN0cmluZztcbiAgICAgIGF2YXRhclVybD86IHN0cmluZztcbiAgICAgIGNvbnRyaWJ1dGlvblNjb3JlOiBudW1iZXI7XG4gICAgICBwb3N0Q291bnQ6IG51bWJlcjtcbiAgICAgIGNvbW1lbnRDb3VudDogbnVtYmVyO1xuICAgIH1bXVxuICA+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHJvb20gSURzIGZvciB0aGlzIGNvbW11bml0eVxuICAgICAgY29uc3QgY29tbXVuaXR5ID0gYXdhaXQgdGhpcy5wcmlzbWEuY29tbXVuaXR5LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY29tbXVuaXR5SWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHJvb21Hcm91cHM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgcm9vbXM6IHsgc2VsZWN0OiB7IGlkOiB0cnVlIH0gfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWNvbW11bml0eSkgcmV0dXJuIFtdO1xuXG4gICAgICBjb25zdCByb29tSWRzID0gY29tbXVuaXR5LnJvb21Hcm91cHMuZmxhdE1hcCgocmcpID0+XG4gICAgICAgIHJnLnJvb21zLm1hcCgocikgPT4gci5pZCksXG4gICAgICApO1xuXG4gICAgICAvLyBHZXQgdXNlcnMgd2l0aCB0aGVpciBjb250cmlidXRpb24gY291bnRzXG4gICAgICBjb25zdCBjb250cmlidXRvcnMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBtZW1iZXJzaGlwczoge1xuICAgICAgICAgICAgc29tZTogeyBjb21tdW5pdHlJZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgcG9zdHM6IHtcbiAgICAgICAgICAgICAgICB3aGVyZTogeyByb29tSWQ6IHsgaW46IHJvb21JZHMgfSB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjb21tZW50czoge1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICBwb3N0OiB7IHJvb21JZDogeyBpbjogcm9vbUlkcyB9IH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdGFrZTogbGltaXQgKiAyLCAvLyBHZXQgbW9yZSB0byBjYWxjdWxhdGUgc2NvcmVzXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGNvbnRyaWJ1dGlvbiBzY29yZXMgYW5kIHNvcnRcbiAgICAgIGNvbnN0IHNjb3JlZENvbnRyaWJ1dG9ycyA9IGNvbnRyaWJ1dG9yc1xuICAgICAgICAubWFwKChjb250cmlidXRvcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHBvc3RDb3VudCA9IGNvbnRyaWJ1dG9yLl9jb3VudC5wb3N0cztcbiAgICAgICAgICBjb25zdCBjb21tZW50Q291bnQgPSBjb250cmlidXRvci5fY291bnQuY29tbWVudHM7XG4gICAgICAgICAgY29uc3QgY29udHJpYnV0aW9uU2NvcmUgPSBwb3N0Q291bnQgKiAzICsgY29tbWVudENvdW50ICogMTsgLy8gUG9zdHMgd29ydGggbW9yZSB0aGFuIGNvbW1lbnRzXG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IGNvbnRyaWJ1dG9yLmlkLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiBjb250cmlidXRvci5maXJzdE5hbWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogY29udHJpYnV0b3IubGFzdE5hbWUsXG4gICAgICAgICAgICBhdmF0YXJVcmw6IGNvbnRyaWJ1dG9yLmF2YXRhclVybCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICBjb250cmlidXRpb25TY29yZSxcbiAgICAgICAgICAgIHBvc3RDb3VudDogTnVtYmVyKHBvc3RDb3VudCksXG4gICAgICAgICAgICBjb21tZW50Q291bnQ6IE51bWJlcihjb21tZW50Q291bnQpLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICAgIC5maWx0ZXIoKGNvbnRyaWJ1dG9yKSA9PiBjb250cmlidXRvci5jb250cmlidXRpb25TY29yZSA+IDApXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNvbnRyaWJ1dGlvblNjb3JlIC0gYS5jb250cmlidXRpb25TY29yZSlcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KTtcblxuICAgICAgcmV0dXJuIHNjb3JlZENvbnRyaWJ1dG9ycztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvciBnZXR0aW5nIHRvcCBjb250cmlidXRvcnMgZm9yIGNvbW11bml0eSAke2NvbW11bml0eUlkfTpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgY2FuIG1vZGVyYXRlIGEgc3BlY2lmaWMgY29tbXVuaXR5XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrTW9kZXJhdGlvblBlcm1pc3Npb25zKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGNvbW11bml0eUlkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGEgZ2xvYmFsIGFkbWluXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgcm9sZTogdHJ1ZSB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICh1c2VyPy5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiB0cnVlOyAvLyBHbG9iYWwgYWRtaW5zIGNhbiBtb2RlcmF0ZSBhbGwgY29tbXVuaXRpZXNcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhc3NpZ25lZCBhcyBhIG1vZGVyYXRvciBmb3IgdGhpcyBzcGVjaWZpYyBjb21tdW5pdHlcbiAgICAgIGNvbnN0IG1vZGVyYXRvckNvbW11bml0eSA9IGF3YWl0IHRoaXMucHJpc21hLm1vZGVyYXRvckNvbW11bml0eS5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG1vZGVyYXRvcklkOiB1c2VySWQsXG4gICAgICAgICAgY29tbXVuaXR5SWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuICEhbW9kZXJhdG9yQ29tbXVuaXR5O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm9yIGNoZWNraW5nIG1vZGVyYXRpb24gcGVybWlzc2lvbnMgZm9yIHVzZXIgJHt1c2VySWR9IGluIGNvbW11bml0eSAke2NvbW11bml0eUlkfTpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=