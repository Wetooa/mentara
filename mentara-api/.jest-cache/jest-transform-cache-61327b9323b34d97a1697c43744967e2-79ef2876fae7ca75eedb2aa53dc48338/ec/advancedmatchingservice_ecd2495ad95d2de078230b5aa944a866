fad72fc69518df0d2c474ee7f17b3896
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdvancedMatchingService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
let AdvancedMatchingService = class AdvancedMatchingService {
    prisma;
    defaultWeights = {
        conditionMatch: 0.4,
        approachCompatibility: 0.25,
        experienceAndSuccess: 0.2,
        reviewsAndRatings: 0.1,
        availabilityAndLogistics: 0.05,
    };
    severityWeights = {
        // Depression/Anxiety scales
        Minimal: 1,
        Mild: 2,
        Moderate: 3,
        'Moderately Severe': 4,
        Severe: 5,
        'Very Severe': 5,
        Extreme: 5,
        // General severity levels
        Low: 1,
        High: 4,
        Substantial: 4,
        // Clinical thresholds
        Subclinical: 1,
        Clinical: 4,
        Subthreshold: 2,
        // Binary indicators
        Positive: 4,
        Negative: 0,
        None: 0,
    };
    constructor(prisma) {
        this.prisma = prisma;
    }
    async calculateAdvancedMatch(client, therapist, weights = this.defaultWeights) {
        // Build user condition profile
        const userProfile = this.buildUserConditionProfile(client);
        // Calculate individual score components
        const conditionScore = this.calculateConditionMatchScore(userProfile, therapist);
        const approachScore = this.calculateApproachCompatibilityScore(userProfile, therapist);
        const experienceScore = this.calculateExperienceAndSuccessScore(userProfile, therapist);
        const reviewScore = await this.calculateReviewScore(therapist);
        const logisticsScore = this.calculateLogisticsScore(userProfile, therapist);
        // Calculate weighted total score
        const totalScore = Math.round(conditionScore * weights.conditionMatch +
            approachScore * weights.approachCompatibility +
            experienceScore * weights.experienceAndSuccess +
            reviewScore * weights.reviewsAndRatings +
            logisticsScore * weights.availabilityAndLogistics);
        // Build match explanation
        const matchExplanation = this.buildMatchExplanation(userProfile, therapist, conditionScore, approachScore, experienceScore, reviewScore);
        return {
            therapist,
            totalScore,
            breakdown: {
                conditionScore: Math.round(conditionScore),
                approachScore: Math.round(approachScore),
                experienceScore: Math.round(experienceScore),
                reviewScore: Math.round(reviewScore),
                logisticsScore: Math.round(logisticsScore),
            },
            matchExplanation,
        };
    }
    buildUserConditionProfile(client) {
        const severityLevels = client.preAssessment.severityLevels;
        const questionnaires = client.preAssessment.questionnaires;
        // Categorize conditions by severity
        const primaryConditions = [];
        const secondaryConditions = [];
        questionnaires.forEach((condition) => {
            const severity = severityLevels[condition];
            const weight = this.severityWeights[severity] || 1;
            if (weight >= 4) {
                primaryConditions.push({ condition, severity, weight });
            }
            else if (weight >= 2) {
                secondaryConditions.push({ condition, severity, weight });
            }
        });
        // Extract preferences from client preferences
        const preferences = this.parseClientPreferences(client.clientPreferences);
        return {
            primaryConditions,
            secondaryConditions,
            preferredApproaches: preferences.approaches || [],
            sessionPreferences: {
                format: preferences.sessionFormat || ['online', 'in-person'],
                duration: preferences.sessionDuration || [],
                frequency: preferences.sessionFrequency || 'weekly',
            },
            demographics: {
                ageRange: preferences.therapistAge || 'any',
                genderPreference: preferences.therapistGender,
                languagePreference: preferences.languages || ['English'],
            },
            logistics: {
                maxHourlyRate: preferences.maxBudget,
                province: preferences.location,
                insuranceTypes: preferences.insurance || [],
            },
        };
    }
    calculateConditionMatchScore(userProfile, therapist) {
        let score = 0;
        const expertise = therapist.expertise || [];
        const specializations = therapist.illnessSpecializations || [];
        const allTherapistConditions = [...expertise, ...specializations];
        // Primary conditions scoring (higher weight)
        userProfile.primaryConditions.forEach(({ condition, weight }) => {
            if (allTherapistConditions.includes(condition)) {
                score += 30 * (weight / 5); // Scale by severity
            }
        });
        // Secondary conditions scoring (lower weight)
        userProfile.secondaryConditions.forEach(({ condition, weight }) => {
            if (allTherapistConditions.includes(condition)) {
                score += 15 * (weight / 5); // Scale by severity
            }
        });
        // Bonus for specialized expertise depth
        const matchedConditions = [
            ...userProfile.primaryConditions.map((c) => c.condition),
            ...userProfile.secondaryConditions.map((c) => c.condition),
        ].filter((condition) => allTherapistConditions.includes(condition));
        const expertiseDepthBonus = Math.min(matchedConditions.length * 5, 20);
        score += expertiseDepthBonus;
        return Math.min(score, 100); // Cap at 100
    }
    calculateApproachCompatibilityScore(userProfile, therapist) {
        let score = 0;
        const therapistApproaches = therapist.approaches || [];
        const therapistApproachesList = therapist.therapeuticApproachesUsedList || [];
        const allApproaches = [...therapistApproaches, ...therapistApproachesList];
        // If user has preferred approaches, match them
        if (userProfile.preferredApproaches.length > 0) {
            const matchedApproaches = userProfile.preferredApproaches.filter((approach) => allApproaches.includes(approach));
            score =
                (matchedApproaches.length / userProfile.preferredApproaches.length) *
                    100;
        }
        else {
            // If no preference specified, give points for evidence-based approaches
            const evidenceBasedApproaches = [
                'Cognitive Behavioral Therapy (CBT)',
                'Dialectical Behavior Therapy (DBT)',
                'Acceptance and Commitment Therapy (ACT)',
                'Eye Movement Desensitization and Reprocessing (EMDR)',
                'Mindfulness-Based Cognitive Therapy (MBCT)',
            ];
            const evidenceBasedCount = allApproaches.filter((approach) => evidenceBasedApproaches.includes(approach)).length;
            score = Math.min(evidenceBasedCount * 20, 80); // Max 80 for general evidence-based
        }
        // Bonus for comprehensive approach diversity
        const diversityBonus = Math.min(allApproaches.length * 2, 20);
        score += diversityBonus;
        return Math.min(score, 100);
    }
    calculateExperienceAndSuccessScore(userProfile, therapist) {
        let score = 0;
        // Years of experience scoring
        const yearsExperience = this.calculateYearsOfExperience(therapist.practiceStartDate);
        const additionalYears = therapist.yearsOfExperience || 0;
        const totalYears = Math.max(yearsExperience, additionalYears);
        // Experience scoring curve: diminishing returns after 10 years
        if (totalYears <= 5) {
            score += totalYears * 8; // 0-40 points for 0-5 years
        }
        else if (totalYears <= 10) {
            score += 40 + (totalYears - 5) * 6; // 40-70 points for 5-10 years
        }
        else {
            score += 70 + Math.min((totalYears - 10) * 2, 20); // 70-90 points for 10+ years
        }
        // Treatment success rates scoring
        const successRates = therapist.treatmentSuccessRates || {};
        const relevantConditions = [
            ...userProfile.primaryConditions.map((c) => c.condition),
            ...userProfile.secondaryConditions.map((c) => c.condition),
        ];
        let successRateBonus = 0;
        let applicableRates = 0;
        relevantConditions.forEach((condition) => {
            if (successRates[condition] !== undefined) {
                successRateBonus += successRates[condition];
                applicableRates++;
            }
        });
        if (applicableRates > 0) {
            const averageSuccessRate = successRateBonus / applicableRates;
            score += (averageSuccessRate / 100) * 20; // Up to 20 bonus points
        }
        return Math.min(score, 100);
    }
    async calculateReviewScore(therapist) {
        if (!therapist.reviews || therapist.reviews.length === 0) {
            return 50; // Neutral score for new therapists
        }
        const approvedReviews = therapist.reviews.filter((review) => review.status === 'APPROVED');
        if (approvedReviews.length === 0) {
            return 50;
        }
        // Calculate average rating
        const totalRating = approvedReviews.reduce((sum, review) => sum + review.rating, 0);
        const averageRating = totalRating / approvedReviews.length;
        // Convert 1-5 rating to 0-100 score
        let score = ((averageRating - 1) / 4) * 100;
        // Bonus for volume of reviews (credibility factor)
        const volumeBonus = Math.min(approvedReviews.length * 2, 20);
        score += volumeBonus;
        // Penalty for very few reviews
        if (approvedReviews.length < 3) {
            score *= 0.8; // 20% penalty for low review count
        }
        return Math.min(score, 100);
    }
    calculateLogisticsScore(userProfile, therapist) {
        let score = 100; // Start with perfect score, deduct for mismatches
        // Location matching
        if (userProfile.logistics.province &&
            therapist.province !== userProfile.logistics.province) {
            score -= 30; // Significant penalty for location mismatch
        }
        // Budget compatibility
        if (userProfile.logistics.maxHourlyRate &&
            Number(therapist.hourlyRate) > userProfile.logistics.maxHourlyRate) {
            score -= 40; // Major penalty for budget overrun
        }
        // Insurance compatibility
        if (userProfile.logistics.insuranceTypes &&
            userProfile.logistics.insuranceTypes.length > 0) {
            const acceptedTypes = therapist.acceptedInsuranceTypes || [];
            const hasInsuranceMatch = userProfile.logistics.insuranceTypes.some((type) => acceptedTypes.includes(type));
            if (!hasInsuranceMatch && therapist.acceptsInsurance) {
                score -= 20; // Penalty for insurance mismatch
            }
        }
        // Language compatibility
        const therapistLanguages = therapist.languagesOffered || ['English'];
        const hasLanguageMatch = userProfile.demographics.languagePreference.some((lang) => therapistLanguages.includes(lang));
        if (!hasLanguageMatch) {
            score -= 25; // Penalty for language barrier
        }
        return Math.max(score, 0);
    }
    buildMatchExplanation(userProfile, therapist, conditionScore, approachScore, experienceScore, reviewScore) {
        const expertise = therapist.expertise || [];
        const specializations = therapist.illnessSpecializations || [];
        const approaches = [
            ...(therapist.approaches || []),
            ...(therapist.therapeuticApproachesUsedList || []),
        ];
        const primaryMatches = userProfile.primaryConditions
            .map((c) => c.condition)
            .filter((condition) => [...expertise, ...specializations].includes(condition));
        const secondaryMatches = userProfile.secondaryConditions
            .map((c) => c.condition)
            .filter((condition) => [...expertise, ...specializations].includes(condition));
        const approachMatches = userProfile.preferredApproaches.filter((approach) => approaches.includes(approach));
        const experienceYears = this.calculateYearsOfExperience(therapist.practiceStartDate);
        const approvedReviews = therapist.reviews?.filter((r) => r.status === 'APPROVED') || [];
        const averageRating = approvedReviews.length > 0
            ? approvedReviews.reduce((sum, r) => sum + r.rating, 0) /
                approvedReviews.length
            : 0;
        const successRates = therapist.treatmentSuccessRates || {};
        return {
            primaryMatches,
            secondaryMatches,
            approachMatches,
            experienceYears: Math.max(experienceYears, therapist.yearsOfExperience || 0),
            averageRating: Math.round(averageRating * 10) / 10,
            totalReviews: approvedReviews.length,
            successRates,
        };
    }
    parseClientPreferences(preferences) {
        const parsed = {};
        preferences.forEach((pref) => {
            try {
                // Handle JSON string values
                if (typeof pref.value === 'string' && pref.value.startsWith('[')) {
                    parsed[pref.key] = JSON.parse(pref.value);
                }
                else {
                    parsed[pref.key] = pref.value;
                }
            }
            catch {
                parsed[pref.key] = pref.value; // Fallback to raw value
            }
        });
        return parsed;
    }
    calculateYearsOfExperience(startDate) {
        const now = new Date();
        let years = now.getFullYear() - startDate.getFullYear();
        if (now.getMonth() < startDate.getMonth() ||
            (now.getMonth() === startDate.getMonth() &&
                now.getDate() < startDate.getDate())) {
            years--;
        }
        return Math.max(years, 0);
    }
};
exports.AdvancedMatchingService = AdvancedMatchingService;
exports.AdvancedMatchingService = AdvancedMatchingService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object])
], AdvancedMatchingService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9zZXJ2aWNlcy9hZHZhbmNlZC1tYXRjaGluZy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBNEM7QUFDNUMsbUZBQXVFO0FBa0VoRSxJQUFNLHVCQUF1QixHQUE3QixNQUFNLHVCQUF1QjtJQW1DTDtJQWxDWixjQUFjLEdBQW9CO1FBQ2pELGNBQWMsRUFBRSxHQUFHO1FBQ25CLHFCQUFxQixFQUFFLElBQUk7UUFDM0Isb0JBQW9CLEVBQUUsR0FBRztRQUN6QixpQkFBaUIsRUFBRSxHQUFHO1FBQ3RCLHdCQUF3QixFQUFFLElBQUk7S0FDL0IsQ0FBQztJQUVlLGVBQWUsR0FBb0I7UUFDbEQsNEJBQTRCO1FBQzVCLE9BQU8sRUFBRSxDQUFDO1FBQ1YsSUFBSSxFQUFFLENBQUM7UUFDUCxRQUFRLEVBQUUsQ0FBQztRQUNYLG1CQUFtQixFQUFFLENBQUM7UUFDdEIsTUFBTSxFQUFFLENBQUM7UUFDVCxhQUFhLEVBQUUsQ0FBQztRQUNoQixPQUFPLEVBQUUsQ0FBQztRQUVWLDBCQUEwQjtRQUMxQixHQUFHLEVBQUUsQ0FBQztRQUNOLElBQUksRUFBRSxDQUFDO1FBQ1AsV0FBVyxFQUFFLENBQUM7UUFFZCxzQkFBc0I7UUFDdEIsV0FBVyxFQUFFLENBQUM7UUFDZCxRQUFRLEVBQUUsQ0FBQztRQUNYLFlBQVksRUFBRSxDQUFDO1FBRWYsb0JBQW9CO1FBQ3BCLFFBQVEsRUFBRSxDQUFDO1FBQ1gsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLEVBQUUsQ0FBQztLQUNSLENBQUM7SUFFRixZQUE2QixNQUFxQjtRQUFyQixXQUFNLEdBQU4sTUFBTSxDQUFlO0lBQUcsQ0FBQztJQUV0RCxLQUFLLENBQUMsc0JBQXNCLENBQzFCLE1BQTJFLEVBQzNFLFNBQW9ELEVBQ3BELFVBQTJCLElBQUksQ0FBQyxjQUFjO1FBRTlDLCtCQUErQjtRQUMvQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMseUJBQXlCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFM0Qsd0NBQXdDO1FBQ3hDLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyw0QkFBNEIsQ0FDdEQsV0FBVyxFQUNYLFNBQVMsQ0FDVixDQUFDO1FBQ0YsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLG1DQUFtQyxDQUM1RCxXQUFXLEVBQ1gsU0FBUyxDQUNWLENBQUM7UUFDRixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsa0NBQWtDLENBQzdELFdBQVcsRUFDWCxTQUFTLENBQ1YsQ0FBQztRQUNGLE1BQU0sV0FBVyxHQUFHLE1BQU0sSUFBSSxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQy9ELE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFNUUsaUNBQWlDO1FBQ2pDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQzNCLGNBQWMsR0FBRyxPQUFPLENBQUMsY0FBYztZQUNyQyxhQUFhLEdBQUcsT0FBTyxDQUFDLHFCQUFxQjtZQUM3QyxlQUFlLEdBQUcsT0FBTyxDQUFDLG9CQUFvQjtZQUM5QyxXQUFXLEdBQUcsT0FBTyxDQUFDLGlCQUFpQjtZQUN2QyxjQUFjLEdBQUcsT0FBTyxDQUFDLHdCQUF3QixDQUNwRCxDQUFDO1FBRUYsMEJBQTBCO1FBQzFCLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUNqRCxXQUFXLEVBQ1gsU0FBUyxFQUNULGNBQWMsRUFDZCxhQUFhLEVBQ2IsZUFBZSxFQUNmLFdBQVcsQ0FDWixDQUFDO1FBRUYsT0FBTztZQUNMLFNBQVM7WUFDVCxVQUFVO1lBQ1YsU0FBUyxFQUFFO2dCQUNULGNBQWMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQztnQkFDMUMsYUFBYSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDO2dCQUN4QyxlQUFlLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUM7Z0JBQzVDLFdBQVcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztnQkFDcEMsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDO2FBQzNDO1lBQ0QsZ0JBQWdCO1NBQ2pCLENBQUM7SUFDSixDQUFDO0lBRU8seUJBQXlCLENBQy9CLE1BQTJFO1FBRTNFLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsY0FHM0MsQ0FBQztRQUNGLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsY0FBMEIsQ0FBQztRQUV2RSxvQ0FBb0M7UUFDcEMsTUFBTSxpQkFBaUIsR0FJbEIsRUFBRSxDQUFDO1FBQ1IsTUFBTSxtQkFBbUIsR0FJcEIsRUFBRSxDQUFDO1FBRVIsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ25DLE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVuRCxJQUFJLE1BQU0sSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDaEIsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzFELENBQUM7aUJBQU0sSUFBSSxNQUFNLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQ3ZCLG1CQUFtQixDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUM1RCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCw4Q0FBOEM7UUFDOUMsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRTFFLE9BQU87WUFDTCxpQkFBaUI7WUFDakIsbUJBQW1CO1lBQ25CLG1CQUFtQixFQUFFLFdBQVcsQ0FBQyxVQUFVLElBQUksRUFBRTtZQUNqRCxrQkFBa0IsRUFBRTtnQkFDbEIsTUFBTSxFQUFFLFdBQVcsQ0FBQyxhQUFhLElBQUksQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDO2dCQUM1RCxRQUFRLEVBQUUsV0FBVyxDQUFDLGVBQWUsSUFBSSxFQUFFO2dCQUMzQyxTQUFTLEVBQUUsV0FBVyxDQUFDLGdCQUFnQixJQUFJLFFBQVE7YUFDcEQ7WUFDRCxZQUFZLEVBQUU7Z0JBQ1osUUFBUSxFQUFFLFdBQVcsQ0FBQyxZQUFZLElBQUksS0FBSztnQkFDM0MsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLGVBQWU7Z0JBQzdDLGtCQUFrQixFQUFFLFdBQVcsQ0FBQyxTQUFTLElBQUksQ0FBQyxTQUFTLENBQUM7YUFDekQ7WUFDRCxTQUFTLEVBQUU7Z0JBQ1QsYUFBYSxFQUFFLFdBQVcsQ0FBQyxTQUFTO2dCQUNwQyxRQUFRLEVBQUUsV0FBVyxDQUFDLFFBQVE7Z0JBQzlCLGNBQWMsRUFBRSxXQUFXLENBQUMsU0FBUyxJQUFJLEVBQUU7YUFDNUM7U0FDRixDQUFDO0lBQ0osQ0FBQztJQUVPLDRCQUE0QixDQUNsQyxXQUFpQyxFQUNqQyxTQUFvQjtRQUVwQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxNQUFNLFNBQVMsR0FBRyxTQUFTLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQztRQUM1QyxNQUFNLGVBQWUsR0FBRyxTQUFTLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDO1FBQy9ELE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxHQUFHLFNBQVMsRUFBRSxHQUFHLGVBQWUsQ0FBQyxDQUFDO1FBRWxFLDZDQUE2QztRQUM3QyxXQUFXLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRTtZQUM5RCxJQUFJLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUMvQyxLQUFLLElBQUksRUFBRSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsb0JBQW9CO1lBQ2xELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILDhDQUE4QztRQUM5QyxXQUFXLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRTtZQUNoRSxJQUFJLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUMvQyxLQUFLLElBQUksRUFBRSxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsb0JBQW9CO1lBQ2xELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILHdDQUF3QztRQUN4QyxNQUFNLGlCQUFpQixHQUFHO1lBQ3hCLEdBQUcsV0FBVyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUN4RCxHQUFHLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7U0FDM0QsQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBRXBFLE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZFLEtBQUssSUFBSSxtQkFBbUIsQ0FBQztRQUU3QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsYUFBYTtJQUM1QyxDQUFDO0lBRU8sbUNBQW1DLENBQ3pDLFdBQWlDLEVBQ2pDLFNBQW9CO1FBRXBCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNkLE1BQU0sbUJBQW1CLEdBQUcsU0FBUyxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUM7UUFDdkQsTUFBTSx1QkFBdUIsR0FDM0IsU0FBUyxDQUFDLDZCQUE2QixJQUFJLEVBQUUsQ0FBQztRQUNoRCxNQUFNLGFBQWEsR0FBRyxDQUFDLEdBQUcsbUJBQW1CLEVBQUUsR0FBRyx1QkFBdUIsQ0FBQyxDQUFDO1FBRTNFLCtDQUErQztRQUMvQyxJQUFJLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDL0MsTUFBTSxpQkFBaUIsR0FBRyxXQUFXLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUM5RCxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FDL0MsQ0FBQztZQUVGLEtBQUs7Z0JBQ0gsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEdBQUcsV0FBVyxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQztvQkFDbkUsR0FBRyxDQUFDO1FBQ1IsQ0FBQzthQUFNLENBQUM7WUFDTix3RUFBd0U7WUFDeEUsTUFBTSx1QkFBdUIsR0FBRztnQkFDOUIsb0NBQW9DO2dCQUNwQyxvQ0FBb0M7Z0JBQ3BDLHlDQUF5QztnQkFDekMsc0RBQXNEO2dCQUN0RCw0Q0FBNEM7YUFDN0MsQ0FBQztZQUVGLE1BQU0sa0JBQWtCLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQzNELHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FDM0MsQ0FBQyxNQUFNLENBQUM7WUFFVCxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxvQ0FBb0M7UUFDckYsQ0FBQztRQUVELDZDQUE2QztRQUM3QyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzlELEtBQUssSUFBSSxjQUFjLENBQUM7UUFFeEIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRU8sa0NBQWtDLENBQ3hDLFdBQWlDLEVBQ2pDLFNBQW9CO1FBRXBCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztRQUVkLDhCQUE4QjtRQUM5QixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsMEJBQTBCLENBQ3JELFNBQVMsQ0FBQyxpQkFBaUIsQ0FDNUIsQ0FBQztRQUNGLE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxpQkFBaUIsSUFBSSxDQUFDLENBQUM7UUFDekQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFFOUQsK0RBQStEO1FBQy9ELElBQUksVUFBVSxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3BCLEtBQUssSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsNEJBQTRCO1FBQ3ZELENBQUM7YUFBTSxJQUFJLFVBQVUsSUFBSSxFQUFFLEVBQUUsQ0FBQztZQUM1QixLQUFLLElBQUksRUFBRSxHQUFHLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDhCQUE4QjtRQUNwRSxDQUFDO2FBQU0sQ0FBQztZQUNOLEtBQUssSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyw2QkFBNkI7UUFDbEYsQ0FBQztRQUVELGtDQUFrQztRQUNsQyxNQUFNLFlBQVksR0FDZixTQUFTLENBQUMscUJBQWdELElBQUksRUFBRSxDQUFDO1FBQ3BFLE1BQU0sa0JBQWtCLEdBQUc7WUFDekIsR0FBRyxXQUFXLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQ3hELEdBQUcsV0FBVyxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztTQUMzRCxDQUFDO1FBRUYsSUFBSSxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7UUFDekIsSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBRXhCLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQ3ZDLElBQUksWUFBWSxDQUFDLFNBQVMsQ0FBQyxLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUMxQyxnQkFBZ0IsSUFBSSxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzVDLGVBQWUsRUFBRSxDQUFDO1lBQ3BCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksZUFBZSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3hCLE1BQU0sa0JBQWtCLEdBQUcsZ0JBQWdCLEdBQUcsZUFBZSxDQUFDO1lBQzlELEtBQUssSUFBSSxDQUFDLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLHdCQUF3QjtRQUNwRSxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRU8sS0FBSyxDQUFDLG9CQUFvQixDQUNoQyxTQUF5QztRQUV6QyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sSUFBSSxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN6RCxPQUFPLEVBQUUsQ0FBQyxDQUFDLG1DQUFtQztRQUNoRCxDQUFDO1FBRUQsTUFBTSxlQUFlLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQzlDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FDekMsQ0FBQztRQUVGLElBQUksZUFBZSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNqQyxPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUM7UUFFRCwyQkFBMkI7UUFDM0IsTUFBTSxXQUFXLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FDeEMsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFDcEMsQ0FBQyxDQUNGLENBQUM7UUFDRixNQUFNLGFBQWEsR0FBRyxXQUFXLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FBQztRQUUzRCxvQ0FBb0M7UUFDcEMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7UUFFNUMsbURBQW1EO1FBQ25ELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDN0QsS0FBSyxJQUFJLFdBQVcsQ0FBQztRQUVyQiwrQkFBK0I7UUFDL0IsSUFBSSxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQy9CLEtBQUssSUFBSSxHQUFHLENBQUMsQ0FBQyxtQ0FBbUM7UUFDbkQsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVPLHVCQUF1QixDQUM3QixXQUFpQyxFQUNqQyxTQUFvQjtRQUVwQixJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQyxrREFBa0Q7UUFFbkUsb0JBQW9CO1FBQ3BCLElBQ0UsV0FBVyxDQUFDLFNBQVMsQ0FBQyxRQUFRO1lBQzlCLFNBQVMsQ0FBQyxRQUFRLEtBQUssV0FBVyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQ3JELENBQUM7WUFDRCxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsNENBQTRDO1FBQzNELENBQUM7UUFFRCx1QkFBdUI7UUFDdkIsSUFDRSxXQUFXLENBQUMsU0FBUyxDQUFDLGFBQWE7WUFDbkMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFDbEUsQ0FBQztZQUNELEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxtQ0FBbUM7UUFDbEQsQ0FBQztRQUVELDBCQUEwQjtRQUMxQixJQUNFLFdBQVcsQ0FBQyxTQUFTLENBQUMsY0FBYztZQUNwQyxXQUFXLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUMvQyxDQUFDO1lBQ0QsTUFBTSxhQUFhLEdBQUcsU0FBUyxDQUFDLHNCQUFzQixJQUFJLEVBQUUsQ0FBQztZQUM3RCxNQUFNLGlCQUFpQixHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FDakUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQ3ZDLENBQUM7WUFFRixJQUFJLENBQUMsaUJBQWlCLElBQUksU0FBUyxDQUFDLGdCQUFnQixFQUFFLENBQUM7Z0JBQ3JELEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxpQ0FBaUM7WUFDaEQsQ0FBQztRQUNILENBQUM7UUFFRCx5QkFBeUI7UUFDekIsTUFBTSxrQkFBa0IsR0FBRyxTQUFTLENBQUMsZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNyRSxNQUFNLGdCQUFnQixHQUFHLFdBQVcsQ0FBQyxZQUFZLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUN2RSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUM1QyxDQUFDO1FBRUYsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDdEIsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDLCtCQUErQjtRQUM5QyxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRU8scUJBQXFCLENBQzNCLFdBQWlDLEVBQ2pDLFNBQXlDLEVBQ3pDLGNBQXNCLEVBQ3RCLGFBQXFCLEVBQ3JCLGVBQXVCLEVBQ3ZCLFdBQW1CO1FBRW5CLE1BQU0sU0FBUyxHQUFHLFNBQVMsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDO1FBQzVDLE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxzQkFBc0IsSUFBSSxFQUFFLENBQUM7UUFDL0QsTUFBTSxVQUFVLEdBQUc7WUFDakIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDO1lBQy9CLEdBQUcsQ0FBQyxTQUFTLENBQUMsNkJBQTZCLElBQUksRUFBRSxDQUFDO1NBQ25ELENBQUM7UUFFRixNQUFNLGNBQWMsR0FBRyxXQUFXLENBQUMsaUJBQWlCO2FBQ2pELEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQzthQUN2QixNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUNwQixDQUFDLEdBQUcsU0FBUyxFQUFFLEdBQUcsZUFBZSxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUN2RCxDQUFDO1FBRUosTUFBTSxnQkFBZ0IsR0FBRyxXQUFXLENBQUMsbUJBQW1CO2FBQ3JELEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQzthQUN2QixNQUFNLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUNwQixDQUFDLEdBQUcsU0FBUyxFQUFFLEdBQUcsZUFBZSxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUN2RCxDQUFDO1FBRUosTUFBTSxlQUFlLEdBQUcsV0FBVyxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQzFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQzlCLENBQUM7UUFFRixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsMEJBQTBCLENBQ3JELFNBQVMsQ0FBQyxpQkFBaUIsQ0FDNUIsQ0FBQztRQUVGLE1BQU0sZUFBZSxHQUNuQixTQUFTLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbEUsTUFBTSxhQUFhLEdBQ2pCLGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUN4QixDQUFDLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztnQkFDckQsZUFBZSxDQUFDLE1BQU07WUFDeEIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVSLE1BQU0sWUFBWSxHQUNmLFNBQVMsQ0FBQyxxQkFBZ0QsSUFBSSxFQUFFLENBQUM7UUFFcEUsT0FBTztZQUNMLGNBQWM7WUFDZCxnQkFBZ0I7WUFDaEIsZUFBZTtZQUNmLGVBQWUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUN2QixlQUFlLEVBQ2YsU0FBUyxDQUFDLGlCQUFpQixJQUFJLENBQUMsQ0FDakM7WUFDRCxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRTtZQUNsRCxZQUFZLEVBQUUsZUFBZSxDQUFDLE1BQU07WUFDcEMsWUFBWTtTQUNiLENBQUM7SUFDSixDQUFDO0lBRU8sc0JBQXNCLENBQUMsV0FBa0I7UUFDL0MsTUFBTSxNQUFNLEdBQXdCLEVBQUUsQ0FBQztRQUV2QyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDM0IsSUFBSSxDQUFDO2dCQUNILDRCQUE0QjtnQkFDNUIsSUFBSSxPQUFPLElBQUksQ0FBQyxLQUFLLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ2pFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzVDLENBQUM7cUJBQU0sQ0FBQztvQkFDTixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQ2hDLENBQUM7WUFDSCxDQUFDO1lBQUMsTUFBTSxDQUFDO2dCQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLHdCQUF3QjtZQUN6RCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRU8sMEJBQTBCLENBQUMsU0FBZTtRQUNoRCxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3ZCLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxXQUFXLEVBQUUsR0FBRyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFeEQsSUFDRSxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsU0FBUyxDQUFDLFFBQVEsRUFBRTtZQUNyQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxTQUFTLENBQUMsUUFBUSxFQUFFO2dCQUN0QyxHQUFHLENBQUMsT0FBTyxFQUFFLEdBQUcsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQ3RDLENBQUM7WUFDRCxLQUFLLEVBQUUsQ0FBQztRQUNWLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzVCLENBQUM7Q0FDRixDQUFBO0FBemNZLDBEQUF1QjtrQ0FBdkIsdUJBQXVCO0lBRG5DLElBQUEsbUJBQVUsR0FBRTt5REFvQzBCLHNDQUFhLG9CQUFiLHNDQUFhO0dBbkN2Qyx1QkFBdUIsQ0F5Y25DIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy90aGVyYXBpc3Qvc2VydmljZXMvYWR2YW5jZWQtbWF0Y2hpbmcuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IFByZUFzc2Vzc21lbnQsIFRoZXJhcGlzdCwgQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hdGNoaW5nV2VpZ2h0cyB7XG4gIGNvbmRpdGlvbk1hdGNoOiBudW1iZXI7IC8vIDQwJVxuICBhcHByb2FjaENvbXBhdGliaWxpdHk6IG51bWJlcjsgLy8gMjUlXG4gIGV4cGVyaWVuY2VBbmRTdWNjZXNzOiBudW1iZXI7IC8vIDIwJVxuICByZXZpZXdzQW5kUmF0aW5nczogbnVtYmVyOyAvLyAxMCVcbiAgYXZhaWxhYmlsaXR5QW5kTG9naXN0aWNzOiBudW1iZXI7IC8vIDUlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGhlcmFwaXN0U2NvcmUge1xuICB0aGVyYXBpc3Q6IFRoZXJhcGlzdCAmIHsgdXNlcjogYW55IH07XG4gIHRvdGFsU2NvcmU6IG51bWJlcjtcbiAgYnJlYWtkb3duOiB7XG4gICAgY29uZGl0aW9uU2NvcmU6IG51bWJlcjtcbiAgICBhcHByb2FjaFNjb3JlOiBudW1iZXI7XG4gICAgZXhwZXJpZW5jZVNjb3JlOiBudW1iZXI7XG4gICAgcmV2aWV3U2NvcmU6IG51bWJlcjtcbiAgICBsb2dpc3RpY3NTY29yZTogbnVtYmVyO1xuICB9O1xuICBtYXRjaEV4cGxhbmF0aW9uOiB7XG4gICAgcHJpbWFyeU1hdGNoZXM6IHN0cmluZ1tdO1xuICAgIHNlY29uZGFyeU1hdGNoZXM6IHN0cmluZ1tdO1xuICAgIGFwcHJvYWNoTWF0Y2hlczogc3RyaW5nW107XG4gICAgZXhwZXJpZW5jZVllYXJzOiBudW1iZXI7XG4gICAgYXZlcmFnZVJhdGluZzogbnVtYmVyO1xuICAgIHRvdGFsUmV2aWV3czogbnVtYmVyO1xuICAgIHN1Y2Nlc3NSYXRlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXZlcml0eU1hcHBpbmcge1xuICBba2V5OiBzdHJpbmddOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlckNvbmRpdGlvblByb2ZpbGUge1xuICBwcmltYXJ5Q29uZGl0aW9uczogQXJyYXk8e1xuICAgIGNvbmRpdGlvbjogc3RyaW5nO1xuICAgIHNldmVyaXR5OiBzdHJpbmc7XG4gICAgd2VpZ2h0OiBudW1iZXI7XG4gIH0+O1xuICBzZWNvbmRhcnlDb25kaXRpb25zOiBBcnJheTx7XG4gICAgY29uZGl0aW9uOiBzdHJpbmc7XG4gICAgc2V2ZXJpdHk6IHN0cmluZztcbiAgICB3ZWlnaHQ6IG51bWJlcjtcbiAgfT47XG4gIHByZWZlcnJlZEFwcHJvYWNoZXM6IHN0cmluZ1tdO1xuICBzZXNzaW9uUHJlZmVyZW5jZXM6IHtcbiAgICBmb3JtYXQ6IHN0cmluZ1tdOyAvLyBvbmxpbmUsIGluLXBlcnNvbiwgaHlicmlkXG4gICAgZHVyYXRpb246IHN0cmluZ1tdO1xuICAgIGZyZXF1ZW5jeTogc3RyaW5nO1xuICB9O1xuICBkZW1vZ3JhcGhpY3M6IHtcbiAgICBhZ2VSYW5nZTogc3RyaW5nO1xuICAgIGdlbmRlclByZWZlcmVuY2U/OiBzdHJpbmc7XG4gICAgbGFuZ3VhZ2VQcmVmZXJlbmNlOiBzdHJpbmdbXTtcbiAgfTtcbiAgbG9naXN0aWNzOiB7XG4gICAgbWF4SG91cmx5UmF0ZT86IG51bWJlcjtcbiAgICBwcm92aW5jZT86IHN0cmluZztcbiAgICBpbnN1cmFuY2VUeXBlcz86IHN0cmluZ1tdO1xuICB9O1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQWR2YW5jZWRNYXRjaGluZ1NlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGRlZmF1bHRXZWlnaHRzOiBNYXRjaGluZ1dlaWdodHMgPSB7XG4gICAgY29uZGl0aW9uTWF0Y2g6IDAuNCxcbiAgICBhcHByb2FjaENvbXBhdGliaWxpdHk6IDAuMjUsXG4gICAgZXhwZXJpZW5jZUFuZFN1Y2Nlc3M6IDAuMixcbiAgICByZXZpZXdzQW5kUmF0aW5nczogMC4xLFxuICAgIGF2YWlsYWJpbGl0eUFuZExvZ2lzdGljczogMC4wNSxcbiAgfTtcblxuICBwcml2YXRlIHJlYWRvbmx5IHNldmVyaXR5V2VpZ2h0czogU2V2ZXJpdHlNYXBwaW5nID0ge1xuICAgIC8vIERlcHJlc3Npb24vQW54aWV0eSBzY2FsZXNcbiAgICBNaW5pbWFsOiAxLFxuICAgIE1pbGQ6IDIsXG4gICAgTW9kZXJhdGU6IDMsXG4gICAgJ01vZGVyYXRlbHkgU2V2ZXJlJzogNCxcbiAgICBTZXZlcmU6IDUsXG4gICAgJ1ZlcnkgU2V2ZXJlJzogNSxcbiAgICBFeHRyZW1lOiA1LFxuXG4gICAgLy8gR2VuZXJhbCBzZXZlcml0eSBsZXZlbHNcbiAgICBMb3c6IDEsXG4gICAgSGlnaDogNCxcbiAgICBTdWJzdGFudGlhbDogNCxcblxuICAgIC8vIENsaW5pY2FsIHRocmVzaG9sZHNcbiAgICBTdWJjbGluaWNhbDogMSxcbiAgICBDbGluaWNhbDogNCxcbiAgICBTdWJ0aHJlc2hvbGQ6IDIsXG5cbiAgICAvLyBCaW5hcnkgaW5kaWNhdG9yc1xuICAgIFBvc2l0aXZlOiA0LFxuICAgIE5lZ2F0aXZlOiAwLFxuICAgIE5vbmU6IDAsXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UpIHt9XG5cbiAgYXN5bmMgY2FsY3VsYXRlQWR2YW5jZWRNYXRjaChcbiAgICBjbGllbnQ6IENsaWVudCAmIHsgcHJlQXNzZXNzbWVudDogUHJlQXNzZXNzbWVudDsgY2xpZW50UHJlZmVyZW5jZXM6IGFueVtdIH0sXG4gICAgdGhlcmFwaXN0OiBUaGVyYXBpc3QgJiB7IHVzZXI6IGFueTsgcmV2aWV3czogYW55W10gfSxcbiAgICB3ZWlnaHRzOiBNYXRjaGluZ1dlaWdodHMgPSB0aGlzLmRlZmF1bHRXZWlnaHRzLFxuICApOiBQcm9taXNlPFRoZXJhcGlzdFNjb3JlPiB7XG4gICAgLy8gQnVpbGQgdXNlciBjb25kaXRpb24gcHJvZmlsZVxuICAgIGNvbnN0IHVzZXJQcm9maWxlID0gdGhpcy5idWlsZFVzZXJDb25kaXRpb25Qcm9maWxlKGNsaWVudCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgaW5kaXZpZHVhbCBzY29yZSBjb21wb25lbnRzXG4gICAgY29uc3QgY29uZGl0aW9uU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUNvbmRpdGlvbk1hdGNoU2NvcmUoXG4gICAgICB1c2VyUHJvZmlsZSxcbiAgICAgIHRoZXJhcGlzdCxcbiAgICApO1xuICAgIGNvbnN0IGFwcHJvYWNoU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUFwcHJvYWNoQ29tcGF0aWJpbGl0eVNjb3JlKFxuICAgICAgdXNlclByb2ZpbGUsXG4gICAgICB0aGVyYXBpc3QsXG4gICAgKTtcbiAgICBjb25zdCBleHBlcmllbmNlU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUV4cGVyaWVuY2VBbmRTdWNjZXNzU2NvcmUoXG4gICAgICB1c2VyUHJvZmlsZSxcbiAgICAgIHRoZXJhcGlzdCxcbiAgICApO1xuICAgIGNvbnN0IHJldmlld1Njb3JlID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVSZXZpZXdTY29yZSh0aGVyYXBpc3QpO1xuICAgIGNvbnN0IGxvZ2lzdGljc1Njb3JlID0gdGhpcy5jYWxjdWxhdGVMb2dpc3RpY3NTY29yZSh1c2VyUHJvZmlsZSwgdGhlcmFwaXN0KTtcblxuICAgIC8vIENhbGN1bGF0ZSB3ZWlnaHRlZCB0b3RhbCBzY29yZVxuICAgIGNvbnN0IHRvdGFsU2NvcmUgPSBNYXRoLnJvdW5kKFxuICAgICAgY29uZGl0aW9uU2NvcmUgKiB3ZWlnaHRzLmNvbmRpdGlvbk1hdGNoICtcbiAgICAgICAgYXBwcm9hY2hTY29yZSAqIHdlaWdodHMuYXBwcm9hY2hDb21wYXRpYmlsaXR5ICtcbiAgICAgICAgZXhwZXJpZW5jZVNjb3JlICogd2VpZ2h0cy5leHBlcmllbmNlQW5kU3VjY2VzcyArXG4gICAgICAgIHJldmlld1Njb3JlICogd2VpZ2h0cy5yZXZpZXdzQW5kUmF0aW5ncyArXG4gICAgICAgIGxvZ2lzdGljc1Njb3JlICogd2VpZ2h0cy5hdmFpbGFiaWxpdHlBbmRMb2dpc3RpY3MsXG4gICAgKTtcblxuICAgIC8vIEJ1aWxkIG1hdGNoIGV4cGxhbmF0aW9uXG4gICAgY29uc3QgbWF0Y2hFeHBsYW5hdGlvbiA9IHRoaXMuYnVpbGRNYXRjaEV4cGxhbmF0aW9uKFxuICAgICAgdXNlclByb2ZpbGUsXG4gICAgICB0aGVyYXBpc3QsXG4gICAgICBjb25kaXRpb25TY29yZSxcbiAgICAgIGFwcHJvYWNoU2NvcmUsXG4gICAgICBleHBlcmllbmNlU2NvcmUsXG4gICAgICByZXZpZXdTY29yZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRoZXJhcGlzdCxcbiAgICAgIHRvdGFsU2NvcmUsXG4gICAgICBicmVha2Rvd246IHtcbiAgICAgICAgY29uZGl0aW9uU2NvcmU6IE1hdGgucm91bmQoY29uZGl0aW9uU2NvcmUpLFxuICAgICAgICBhcHByb2FjaFNjb3JlOiBNYXRoLnJvdW5kKGFwcHJvYWNoU2NvcmUpLFxuICAgICAgICBleHBlcmllbmNlU2NvcmU6IE1hdGgucm91bmQoZXhwZXJpZW5jZVNjb3JlKSxcbiAgICAgICAgcmV2aWV3U2NvcmU6IE1hdGgucm91bmQocmV2aWV3U2NvcmUpLFxuICAgICAgICBsb2dpc3RpY3NTY29yZTogTWF0aC5yb3VuZChsb2dpc3RpY3NTY29yZSksXG4gICAgICB9LFxuICAgICAgbWF0Y2hFeHBsYW5hdGlvbixcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFVzZXJDb25kaXRpb25Qcm9maWxlKFxuICAgIGNsaWVudDogQ2xpZW50ICYgeyBwcmVBc3Nlc3NtZW50OiBQcmVBc3Nlc3NtZW50OyBjbGllbnRQcmVmZXJlbmNlczogYW55W10gfSxcbiAgKTogVXNlckNvbmRpdGlvblByb2ZpbGUge1xuICAgIGNvbnN0IHNldmVyaXR5TGV2ZWxzID0gY2xpZW50LnByZUFzc2Vzc21lbnQuc2V2ZXJpdHlMZXZlbHMgYXMgUmVjb3JkPFxuICAgICAgc3RyaW5nLFxuICAgICAgc3RyaW5nXG4gICAgPjtcbiAgICBjb25zdCBxdWVzdGlvbm5haXJlcyA9IGNsaWVudC5wcmVBc3Nlc3NtZW50LnF1ZXN0aW9ubmFpcmVzIGFzIHN0cmluZ1tdO1xuXG4gICAgLy8gQ2F0ZWdvcml6ZSBjb25kaXRpb25zIGJ5IHNldmVyaXR5XG4gICAgY29uc3QgcHJpbWFyeUNvbmRpdGlvbnM6IEFycmF5PHtcbiAgICAgIGNvbmRpdGlvbjogc3RyaW5nO1xuICAgICAgc2V2ZXJpdHk6IHN0cmluZztcbiAgICAgIHdlaWdodDogbnVtYmVyO1xuICAgIH0+ID0gW107XG4gICAgY29uc3Qgc2Vjb25kYXJ5Q29uZGl0aW9uczogQXJyYXk8e1xuICAgICAgY29uZGl0aW9uOiBzdHJpbmc7XG4gICAgICBzZXZlcml0eTogc3RyaW5nO1xuICAgICAgd2VpZ2h0OiBudW1iZXI7XG4gICAgfT4gPSBbXTtcblxuICAgIHF1ZXN0aW9ubmFpcmVzLmZvckVhY2goKGNvbmRpdGlvbikgPT4ge1xuICAgICAgY29uc3Qgc2V2ZXJpdHkgPSBzZXZlcml0eUxldmVsc1tjb25kaXRpb25dO1xuICAgICAgY29uc3Qgd2VpZ2h0ID0gdGhpcy5zZXZlcml0eVdlaWdodHNbc2V2ZXJpdHldIHx8IDE7XG5cbiAgICAgIGlmICh3ZWlnaHQgPj0gNCkge1xuICAgICAgICBwcmltYXJ5Q29uZGl0aW9ucy5wdXNoKHsgY29uZGl0aW9uLCBzZXZlcml0eSwgd2VpZ2h0IH0pO1xuICAgICAgfSBlbHNlIGlmICh3ZWlnaHQgPj0gMikge1xuICAgICAgICBzZWNvbmRhcnlDb25kaXRpb25zLnB1c2goeyBjb25kaXRpb24sIHNldmVyaXR5LCB3ZWlnaHQgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBFeHRyYWN0IHByZWZlcmVuY2VzIGZyb20gY2xpZW50IHByZWZlcmVuY2VzXG4gICAgY29uc3QgcHJlZmVyZW5jZXMgPSB0aGlzLnBhcnNlQ2xpZW50UHJlZmVyZW5jZXMoY2xpZW50LmNsaWVudFByZWZlcmVuY2VzKTtcblxuICAgIHJldHVybiB7XG4gICAgICBwcmltYXJ5Q29uZGl0aW9ucyxcbiAgICAgIHNlY29uZGFyeUNvbmRpdGlvbnMsXG4gICAgICBwcmVmZXJyZWRBcHByb2FjaGVzOiBwcmVmZXJlbmNlcy5hcHByb2FjaGVzIHx8IFtdLFxuICAgICAgc2Vzc2lvblByZWZlcmVuY2VzOiB7XG4gICAgICAgIGZvcm1hdDogcHJlZmVyZW5jZXMuc2Vzc2lvbkZvcm1hdCB8fCBbJ29ubGluZScsICdpbi1wZXJzb24nXSxcbiAgICAgICAgZHVyYXRpb246IHByZWZlcmVuY2VzLnNlc3Npb25EdXJhdGlvbiB8fCBbXSxcbiAgICAgICAgZnJlcXVlbmN5OiBwcmVmZXJlbmNlcy5zZXNzaW9uRnJlcXVlbmN5IHx8ICd3ZWVrbHknLFxuICAgICAgfSxcbiAgICAgIGRlbW9ncmFwaGljczoge1xuICAgICAgICBhZ2VSYW5nZTogcHJlZmVyZW5jZXMudGhlcmFwaXN0QWdlIHx8ICdhbnknLFxuICAgICAgICBnZW5kZXJQcmVmZXJlbmNlOiBwcmVmZXJlbmNlcy50aGVyYXBpc3RHZW5kZXIsXG4gICAgICAgIGxhbmd1YWdlUHJlZmVyZW5jZTogcHJlZmVyZW5jZXMubGFuZ3VhZ2VzIHx8IFsnRW5nbGlzaCddLFxuICAgICAgfSxcbiAgICAgIGxvZ2lzdGljczoge1xuICAgICAgICBtYXhIb3VybHlSYXRlOiBwcmVmZXJlbmNlcy5tYXhCdWRnZXQsXG4gICAgICAgIHByb3ZpbmNlOiBwcmVmZXJlbmNlcy5sb2NhdGlvbixcbiAgICAgICAgaW5zdXJhbmNlVHlwZXM6IHByZWZlcmVuY2VzLmluc3VyYW5jZSB8fCBbXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29uZGl0aW9uTWF0Y2hTY29yZShcbiAgICB1c2VyUHJvZmlsZTogVXNlckNvbmRpdGlvblByb2ZpbGUsXG4gICAgdGhlcmFwaXN0OiBUaGVyYXBpc3QsXG4gICk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMDtcbiAgICBjb25zdCBleHBlcnRpc2UgPSB0aGVyYXBpc3QuZXhwZXJ0aXNlIHx8IFtdO1xuICAgIGNvbnN0IHNwZWNpYWxpemF0aW9ucyA9IHRoZXJhcGlzdC5pbGxuZXNzU3BlY2lhbGl6YXRpb25zIHx8IFtdO1xuICAgIGNvbnN0IGFsbFRoZXJhcGlzdENvbmRpdGlvbnMgPSBbLi4uZXhwZXJ0aXNlLCAuLi5zcGVjaWFsaXphdGlvbnNdO1xuXG4gICAgLy8gUHJpbWFyeSBjb25kaXRpb25zIHNjb3JpbmcgKGhpZ2hlciB3ZWlnaHQpXG4gICAgdXNlclByb2ZpbGUucHJpbWFyeUNvbmRpdGlvbnMuZm9yRWFjaCgoeyBjb25kaXRpb24sIHdlaWdodCB9KSA9PiB7XG4gICAgICBpZiAoYWxsVGhlcmFwaXN0Q29uZGl0aW9ucy5pbmNsdWRlcyhjb25kaXRpb24pKSB7XG4gICAgICAgIHNjb3JlICs9IDMwICogKHdlaWdodCAvIDUpOyAvLyBTY2FsZSBieSBzZXZlcml0eVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2Vjb25kYXJ5IGNvbmRpdGlvbnMgc2NvcmluZyAobG93ZXIgd2VpZ2h0KVxuICAgIHVzZXJQcm9maWxlLnNlY29uZGFyeUNvbmRpdGlvbnMuZm9yRWFjaCgoeyBjb25kaXRpb24sIHdlaWdodCB9KSA9PiB7XG4gICAgICBpZiAoYWxsVGhlcmFwaXN0Q29uZGl0aW9ucy5pbmNsdWRlcyhjb25kaXRpb24pKSB7XG4gICAgICAgIHNjb3JlICs9IDE1ICogKHdlaWdodCAvIDUpOyAvLyBTY2FsZSBieSBzZXZlcml0eVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQm9udXMgZm9yIHNwZWNpYWxpemVkIGV4cGVydGlzZSBkZXB0aFxuICAgIGNvbnN0IG1hdGNoZWRDb25kaXRpb25zID0gW1xuICAgICAgLi4udXNlclByb2ZpbGUucHJpbWFyeUNvbmRpdGlvbnMubWFwKChjKSA9PiBjLmNvbmRpdGlvbiksXG4gICAgICAuLi51c2VyUHJvZmlsZS5zZWNvbmRhcnlDb25kaXRpb25zLm1hcCgoYykgPT4gYy5jb25kaXRpb24pLFxuICAgIF0uZmlsdGVyKChjb25kaXRpb24pID0+IGFsbFRoZXJhcGlzdENvbmRpdGlvbnMuaW5jbHVkZXMoY29uZGl0aW9uKSk7XG5cbiAgICBjb25zdCBleHBlcnRpc2VEZXB0aEJvbnVzID0gTWF0aC5taW4obWF0Y2hlZENvbmRpdGlvbnMubGVuZ3RoICogNSwgMjApO1xuICAgIHNjb3JlICs9IGV4cGVydGlzZURlcHRoQm9udXM7XG5cbiAgICByZXR1cm4gTWF0aC5taW4oc2NvcmUsIDEwMCk7IC8vIENhcCBhdCAxMDBcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXBwcm9hY2hDb21wYXRpYmlsaXR5U2NvcmUoXG4gICAgdXNlclByb2ZpbGU6IFVzZXJDb25kaXRpb25Qcm9maWxlLFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0LFxuICApOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDA7XG4gICAgY29uc3QgdGhlcmFwaXN0QXBwcm9hY2hlcyA9IHRoZXJhcGlzdC5hcHByb2FjaGVzIHx8IFtdO1xuICAgIGNvbnN0IHRoZXJhcGlzdEFwcHJvYWNoZXNMaXN0ID1cbiAgICAgIHRoZXJhcGlzdC50aGVyYXBldXRpY0FwcHJvYWNoZXNVc2VkTGlzdCB8fCBbXTtcbiAgICBjb25zdCBhbGxBcHByb2FjaGVzID0gWy4uLnRoZXJhcGlzdEFwcHJvYWNoZXMsIC4uLnRoZXJhcGlzdEFwcHJvYWNoZXNMaXN0XTtcblxuICAgIC8vIElmIHVzZXIgaGFzIHByZWZlcnJlZCBhcHByb2FjaGVzLCBtYXRjaCB0aGVtXG4gICAgaWYgKHVzZXJQcm9maWxlLnByZWZlcnJlZEFwcHJvYWNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgbWF0Y2hlZEFwcHJvYWNoZXMgPSB1c2VyUHJvZmlsZS5wcmVmZXJyZWRBcHByb2FjaGVzLmZpbHRlcihcbiAgICAgICAgKGFwcHJvYWNoKSA9PiBhbGxBcHByb2FjaGVzLmluY2x1ZGVzKGFwcHJvYWNoKSxcbiAgICAgICk7XG5cbiAgICAgIHNjb3JlID1cbiAgICAgICAgKG1hdGNoZWRBcHByb2FjaGVzLmxlbmd0aCAvIHVzZXJQcm9maWxlLnByZWZlcnJlZEFwcHJvYWNoZXMubGVuZ3RoKSAqXG4gICAgICAgIDEwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgbm8gcHJlZmVyZW5jZSBzcGVjaWZpZWQsIGdpdmUgcG9pbnRzIGZvciBldmlkZW5jZS1iYXNlZCBhcHByb2FjaGVzXG4gICAgICBjb25zdCBldmlkZW5jZUJhc2VkQXBwcm9hY2hlcyA9IFtcbiAgICAgICAgJ0NvZ25pdGl2ZSBCZWhhdmlvcmFsIFRoZXJhcHkgKENCVCknLFxuICAgICAgICAnRGlhbGVjdGljYWwgQmVoYXZpb3IgVGhlcmFweSAoREJUKScsXG4gICAgICAgICdBY2NlcHRhbmNlIGFuZCBDb21taXRtZW50IFRoZXJhcHkgKEFDVCknLFxuICAgICAgICAnRXllIE1vdmVtZW50IERlc2Vuc2l0aXphdGlvbiBhbmQgUmVwcm9jZXNzaW5nIChFTURSKScsXG4gICAgICAgICdNaW5kZnVsbmVzcy1CYXNlZCBDb2duaXRpdmUgVGhlcmFweSAoTUJDVCknLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgZXZpZGVuY2VCYXNlZENvdW50ID0gYWxsQXBwcm9hY2hlcy5maWx0ZXIoKGFwcHJvYWNoKSA9PlxuICAgICAgICBldmlkZW5jZUJhc2VkQXBwcm9hY2hlcy5pbmNsdWRlcyhhcHByb2FjaCksXG4gICAgICApLmxlbmd0aDtcblxuICAgICAgc2NvcmUgPSBNYXRoLm1pbihldmlkZW5jZUJhc2VkQ291bnQgKiAyMCwgODApOyAvLyBNYXggODAgZm9yIGdlbmVyYWwgZXZpZGVuY2UtYmFzZWRcbiAgICB9XG5cbiAgICAvLyBCb251cyBmb3IgY29tcHJlaGVuc2l2ZSBhcHByb2FjaCBkaXZlcnNpdHlcbiAgICBjb25zdCBkaXZlcnNpdHlCb251cyA9IE1hdGgubWluKGFsbEFwcHJvYWNoZXMubGVuZ3RoICogMiwgMjApO1xuICAgIHNjb3JlICs9IGRpdmVyc2l0eUJvbnVzO1xuXG4gICAgcmV0dXJuIE1hdGgubWluKHNjb3JlLCAxMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVFeHBlcmllbmNlQW5kU3VjY2Vzc1Njb3JlKFxuICAgIHVzZXJQcm9maWxlOiBVc2VyQ29uZGl0aW9uUHJvZmlsZSxcbiAgICB0aGVyYXBpc3Q6IFRoZXJhcGlzdCxcbiAgKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAwO1xuXG4gICAgLy8gWWVhcnMgb2YgZXhwZXJpZW5jZSBzY29yaW5nXG4gICAgY29uc3QgeWVhcnNFeHBlcmllbmNlID0gdGhpcy5jYWxjdWxhdGVZZWFyc09mRXhwZXJpZW5jZShcbiAgICAgIHRoZXJhcGlzdC5wcmFjdGljZVN0YXJ0RGF0ZSxcbiAgICApO1xuICAgIGNvbnN0IGFkZGl0aW9uYWxZZWFycyA9IHRoZXJhcGlzdC55ZWFyc09mRXhwZXJpZW5jZSB8fCAwO1xuICAgIGNvbnN0IHRvdGFsWWVhcnMgPSBNYXRoLm1heCh5ZWFyc0V4cGVyaWVuY2UsIGFkZGl0aW9uYWxZZWFycyk7XG5cbiAgICAvLyBFeHBlcmllbmNlIHNjb3JpbmcgY3VydmU6IGRpbWluaXNoaW5nIHJldHVybnMgYWZ0ZXIgMTAgeWVhcnNcbiAgICBpZiAodG90YWxZZWFycyA8PSA1KSB7XG4gICAgICBzY29yZSArPSB0b3RhbFllYXJzICogODsgLy8gMC00MCBwb2ludHMgZm9yIDAtNSB5ZWFyc1xuICAgIH0gZWxzZSBpZiAodG90YWxZZWFycyA8PSAxMCkge1xuICAgICAgc2NvcmUgKz0gNDAgKyAodG90YWxZZWFycyAtIDUpICogNjsgLy8gNDAtNzAgcG9pbnRzIGZvciA1LTEwIHllYXJzXG4gICAgfSBlbHNlIHtcbiAgICAgIHNjb3JlICs9IDcwICsgTWF0aC5taW4oKHRvdGFsWWVhcnMgLSAxMCkgKiAyLCAyMCk7IC8vIDcwLTkwIHBvaW50cyBmb3IgMTArIHllYXJzXG4gICAgfVxuXG4gICAgLy8gVHJlYXRtZW50IHN1Y2Nlc3MgcmF0ZXMgc2NvcmluZ1xuICAgIGNvbnN0IHN1Y2Nlc3NSYXRlcyA9XG4gICAgICAodGhlcmFwaXN0LnRyZWF0bWVudFN1Y2Nlc3NSYXRlcyBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSB8fCB7fTtcbiAgICBjb25zdCByZWxldmFudENvbmRpdGlvbnMgPSBbXG4gICAgICAuLi51c2VyUHJvZmlsZS5wcmltYXJ5Q29uZGl0aW9ucy5tYXAoKGMpID0+IGMuY29uZGl0aW9uKSxcbiAgICAgIC4uLnVzZXJQcm9maWxlLnNlY29uZGFyeUNvbmRpdGlvbnMubWFwKChjKSA9PiBjLmNvbmRpdGlvbiksXG4gICAgXTtcblxuICAgIGxldCBzdWNjZXNzUmF0ZUJvbnVzID0gMDtcbiAgICBsZXQgYXBwbGljYWJsZVJhdGVzID0gMDtcblxuICAgIHJlbGV2YW50Q29uZGl0aW9ucy5mb3JFYWNoKChjb25kaXRpb24pID0+IHtcbiAgICAgIGlmIChzdWNjZXNzUmF0ZXNbY29uZGl0aW9uXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHN1Y2Nlc3NSYXRlQm9udXMgKz0gc3VjY2Vzc1JhdGVzW2NvbmRpdGlvbl07XG4gICAgICAgIGFwcGxpY2FibGVSYXRlcysrO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKGFwcGxpY2FibGVSYXRlcyA+IDApIHtcbiAgICAgIGNvbnN0IGF2ZXJhZ2VTdWNjZXNzUmF0ZSA9IHN1Y2Nlc3NSYXRlQm9udXMgLyBhcHBsaWNhYmxlUmF0ZXM7XG4gICAgICBzY29yZSArPSAoYXZlcmFnZVN1Y2Nlc3NSYXRlIC8gMTAwKSAqIDIwOyAvLyBVcCB0byAyMCBib251cyBwb2ludHNcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5taW4oc2NvcmUsIDEwMCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZVJldmlld1Njb3JlKFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0ICYgeyByZXZpZXdzOiBhbnlbXSB9LFxuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGlmICghdGhlcmFwaXN0LnJldmlld3MgfHwgdGhlcmFwaXN0LnJldmlld3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gNTA7IC8vIE5ldXRyYWwgc2NvcmUgZm9yIG5ldyB0aGVyYXBpc3RzXG4gICAgfVxuXG4gICAgY29uc3QgYXBwcm92ZWRSZXZpZXdzID0gdGhlcmFwaXN0LnJldmlld3MuZmlsdGVyKFxuICAgICAgKHJldmlldykgPT4gcmV2aWV3LnN0YXR1cyA9PT0gJ0FQUFJPVkVEJyxcbiAgICApO1xuXG4gICAgaWYgKGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiA1MDtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgYXZlcmFnZSByYXRpbmdcbiAgICBjb25zdCB0b3RhbFJhdGluZyA9IGFwcHJvdmVkUmV2aWV3cy5yZWR1Y2UoXG4gICAgICAoc3VtLCByZXZpZXcpID0+IHN1bSArIHJldmlldy5yYXRpbmcsXG4gICAgICAwLFxuICAgICk7XG4gICAgY29uc3QgYXZlcmFnZVJhdGluZyA9IHRvdGFsUmF0aW5nIC8gYXBwcm92ZWRSZXZpZXdzLmxlbmd0aDtcblxuICAgIC8vIENvbnZlcnQgMS01IHJhdGluZyB0byAwLTEwMCBzY29yZVxuICAgIGxldCBzY29yZSA9ICgoYXZlcmFnZVJhdGluZyAtIDEpIC8gNCkgKiAxMDA7XG5cbiAgICAvLyBCb251cyBmb3Igdm9sdW1lIG9mIHJldmlld3MgKGNyZWRpYmlsaXR5IGZhY3RvcilcbiAgICBjb25zdCB2b2x1bWVCb251cyA9IE1hdGgubWluKGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggKiAyLCAyMCk7XG4gICAgc2NvcmUgKz0gdm9sdW1lQm9udXM7XG5cbiAgICAvLyBQZW5hbHR5IGZvciB2ZXJ5IGZldyByZXZpZXdzXG4gICAgaWYgKGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggPCAzKSB7XG4gICAgICBzY29yZSAqPSAwLjg7IC8vIDIwJSBwZW5hbHR5IGZvciBsb3cgcmV2aWV3IGNvdW50XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWluKHNjb3JlLCAxMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVMb2dpc3RpY3NTY29yZShcbiAgICB1c2VyUHJvZmlsZTogVXNlckNvbmRpdGlvblByb2ZpbGUsXG4gICAgdGhlcmFwaXN0OiBUaGVyYXBpc3QsXG4gICk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMTAwOyAvLyBTdGFydCB3aXRoIHBlcmZlY3Qgc2NvcmUsIGRlZHVjdCBmb3IgbWlzbWF0Y2hlc1xuXG4gICAgLy8gTG9jYXRpb24gbWF0Y2hpbmdcbiAgICBpZiAoXG4gICAgICB1c2VyUHJvZmlsZS5sb2dpc3RpY3MucHJvdmluY2UgJiZcbiAgICAgIHRoZXJhcGlzdC5wcm92aW5jZSAhPT0gdXNlclByb2ZpbGUubG9naXN0aWNzLnByb3ZpbmNlXG4gICAgKSB7XG4gICAgICBzY29yZSAtPSAzMDsgLy8gU2lnbmlmaWNhbnQgcGVuYWx0eSBmb3IgbG9jYXRpb24gbWlzbWF0Y2hcbiAgICB9XG5cbiAgICAvLyBCdWRnZXQgY29tcGF0aWJpbGl0eVxuICAgIGlmIChcbiAgICAgIHVzZXJQcm9maWxlLmxvZ2lzdGljcy5tYXhIb3VybHlSYXRlICYmXG4gICAgICBOdW1iZXIodGhlcmFwaXN0LmhvdXJseVJhdGUpID4gdXNlclByb2ZpbGUubG9naXN0aWNzLm1heEhvdXJseVJhdGVcbiAgICApIHtcbiAgICAgIHNjb3JlIC09IDQwOyAvLyBNYWpvciBwZW5hbHR5IGZvciBidWRnZXQgb3ZlcnJ1blxuICAgIH1cblxuICAgIC8vIEluc3VyYW5jZSBjb21wYXRpYmlsaXR5XG4gICAgaWYgKFxuICAgICAgdXNlclByb2ZpbGUubG9naXN0aWNzLmluc3VyYW5jZVR5cGVzICYmXG4gICAgICB1c2VyUHJvZmlsZS5sb2dpc3RpY3MuaW5zdXJhbmNlVHlwZXMubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgY29uc3QgYWNjZXB0ZWRUeXBlcyA9IHRoZXJhcGlzdC5hY2NlcHRlZEluc3VyYW5jZVR5cGVzIHx8IFtdO1xuICAgICAgY29uc3QgaGFzSW5zdXJhbmNlTWF0Y2ggPSB1c2VyUHJvZmlsZS5sb2dpc3RpY3MuaW5zdXJhbmNlVHlwZXMuc29tZShcbiAgICAgICAgKHR5cGUpID0+IGFjY2VwdGVkVHlwZXMuaW5jbHVkZXModHlwZSksXG4gICAgICApO1xuXG4gICAgICBpZiAoIWhhc0luc3VyYW5jZU1hdGNoICYmIHRoZXJhcGlzdC5hY2NlcHRzSW5zdXJhbmNlKSB7XG4gICAgICAgIHNjb3JlIC09IDIwOyAvLyBQZW5hbHR5IGZvciBpbnN1cmFuY2UgbWlzbWF0Y2hcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBMYW5ndWFnZSBjb21wYXRpYmlsaXR5XG4gICAgY29uc3QgdGhlcmFwaXN0TGFuZ3VhZ2VzID0gdGhlcmFwaXN0Lmxhbmd1YWdlc09mZmVyZWQgfHwgWydFbmdsaXNoJ107XG4gICAgY29uc3QgaGFzTGFuZ3VhZ2VNYXRjaCA9IHVzZXJQcm9maWxlLmRlbW9ncmFwaGljcy5sYW5ndWFnZVByZWZlcmVuY2Uuc29tZShcbiAgICAgIChsYW5nKSA9PiB0aGVyYXBpc3RMYW5ndWFnZXMuaW5jbHVkZXMobGFuZyksXG4gICAgKTtcblxuICAgIGlmICghaGFzTGFuZ3VhZ2VNYXRjaCkge1xuICAgICAgc2NvcmUgLT0gMjU7IC8vIFBlbmFsdHkgZm9yIGxhbmd1YWdlIGJhcnJpZXJcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoc2NvcmUsIDApO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZE1hdGNoRXhwbGFuYXRpb24oXG4gICAgdXNlclByb2ZpbGU6IFVzZXJDb25kaXRpb25Qcm9maWxlLFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0ICYgeyByZXZpZXdzOiBhbnlbXSB9LFxuICAgIGNvbmRpdGlvblNjb3JlOiBudW1iZXIsXG4gICAgYXBwcm9hY2hTY29yZTogbnVtYmVyLFxuICAgIGV4cGVyaWVuY2VTY29yZTogbnVtYmVyLFxuICAgIHJldmlld1Njb3JlOiBudW1iZXIsXG4gICk6IFRoZXJhcGlzdFNjb3JlWydtYXRjaEV4cGxhbmF0aW9uJ10ge1xuICAgIGNvbnN0IGV4cGVydGlzZSA9IHRoZXJhcGlzdC5leHBlcnRpc2UgfHwgW107XG4gICAgY29uc3Qgc3BlY2lhbGl6YXRpb25zID0gdGhlcmFwaXN0LmlsbG5lc3NTcGVjaWFsaXphdGlvbnMgfHwgW107XG4gICAgY29uc3QgYXBwcm9hY2hlcyA9IFtcbiAgICAgIC4uLih0aGVyYXBpc3QuYXBwcm9hY2hlcyB8fCBbXSksXG4gICAgICAuLi4odGhlcmFwaXN0LnRoZXJhcGV1dGljQXBwcm9hY2hlc1VzZWRMaXN0IHx8IFtdKSxcbiAgICBdO1xuXG4gICAgY29uc3QgcHJpbWFyeU1hdGNoZXMgPSB1c2VyUHJvZmlsZS5wcmltYXJ5Q29uZGl0aW9uc1xuICAgICAgLm1hcCgoYykgPT4gYy5jb25kaXRpb24pXG4gICAgICAuZmlsdGVyKChjb25kaXRpb24pID0+XG4gICAgICAgIFsuLi5leHBlcnRpc2UsIC4uLnNwZWNpYWxpemF0aW9uc10uaW5jbHVkZXMoY29uZGl0aW9uKSxcbiAgICAgICk7XG5cbiAgICBjb25zdCBzZWNvbmRhcnlNYXRjaGVzID0gdXNlclByb2ZpbGUuc2Vjb25kYXJ5Q29uZGl0aW9uc1xuICAgICAgLm1hcCgoYykgPT4gYy5jb25kaXRpb24pXG4gICAgICAuZmlsdGVyKChjb25kaXRpb24pID0+XG4gICAgICAgIFsuLi5leHBlcnRpc2UsIC4uLnNwZWNpYWxpemF0aW9uc10uaW5jbHVkZXMoY29uZGl0aW9uKSxcbiAgICAgICk7XG5cbiAgICBjb25zdCBhcHByb2FjaE1hdGNoZXMgPSB1c2VyUHJvZmlsZS5wcmVmZXJyZWRBcHByb2FjaGVzLmZpbHRlcigoYXBwcm9hY2gpID0+XG4gICAgICBhcHByb2FjaGVzLmluY2x1ZGVzKGFwcHJvYWNoKSxcbiAgICApO1xuXG4gICAgY29uc3QgZXhwZXJpZW5jZVllYXJzID0gdGhpcy5jYWxjdWxhdGVZZWFyc09mRXhwZXJpZW5jZShcbiAgICAgIHRoZXJhcGlzdC5wcmFjdGljZVN0YXJ0RGF0ZSxcbiAgICApO1xuXG4gICAgY29uc3QgYXBwcm92ZWRSZXZpZXdzID1cbiAgICAgIHRoZXJhcGlzdC5yZXZpZXdzPy5maWx0ZXIoKHIpID0+IHIuc3RhdHVzID09PSAnQVBQUk9WRUQnKSB8fCBbXTtcbiAgICBjb25zdCBhdmVyYWdlUmF0aW5nID1cbiAgICAgIGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggPiAwXG4gICAgICAgID8gYXBwcm92ZWRSZXZpZXdzLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyByLnJhdGluZywgMCkgL1xuICAgICAgICAgIGFwcHJvdmVkUmV2aWV3cy5sZW5ndGhcbiAgICAgICAgOiAwO1xuXG4gICAgY29uc3Qgc3VjY2Vzc1JhdGVzID1cbiAgICAgICh0aGVyYXBpc3QudHJlYXRtZW50U3VjY2Vzc1JhdGVzIGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pIHx8IHt9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByaW1hcnlNYXRjaGVzLFxuICAgICAgc2Vjb25kYXJ5TWF0Y2hlcyxcbiAgICAgIGFwcHJvYWNoTWF0Y2hlcyxcbiAgICAgIGV4cGVyaWVuY2VZZWFyczogTWF0aC5tYXgoXG4gICAgICAgIGV4cGVyaWVuY2VZZWFycyxcbiAgICAgICAgdGhlcmFwaXN0LnllYXJzT2ZFeHBlcmllbmNlIHx8IDAsXG4gICAgICApLFxuICAgICAgYXZlcmFnZVJhdGluZzogTWF0aC5yb3VuZChhdmVyYWdlUmF0aW5nICogMTApIC8gMTAsXG4gICAgICB0b3RhbFJldmlld3M6IGFwcHJvdmVkUmV2aWV3cy5sZW5ndGgsXG4gICAgICBzdWNjZXNzUmF0ZXMsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VDbGllbnRQcmVmZXJlbmNlcyhwcmVmZXJlbmNlczogYW55W10pOiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHtcbiAgICBjb25zdCBwYXJzZWQ6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcblxuICAgIHByZWZlcmVuY2VzLmZvckVhY2goKHByZWYpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEhhbmRsZSBKU09OIHN0cmluZyB2YWx1ZXNcbiAgICAgICAgaWYgKHR5cGVvZiBwcmVmLnZhbHVlID09PSAnc3RyaW5nJyAmJiBwcmVmLnZhbHVlLnN0YXJ0c1dpdGgoJ1snKSkge1xuICAgICAgICAgIHBhcnNlZFtwcmVmLmtleV0gPSBKU09OLnBhcnNlKHByZWYudmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhcnNlZFtwcmVmLmtleV0gPSBwcmVmLnZhbHVlO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcGFyc2VkW3ByZWYua2V5XSA9IHByZWYudmFsdWU7IC8vIEZhbGxiYWNrIHRvIHJhdyB2YWx1ZVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHBhcnNlZDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlWWVhcnNPZkV4cGVyaWVuY2Uoc3RhcnREYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGxldCB5ZWFycyA9IG5vdy5nZXRGdWxsWWVhcigpIC0gc3RhcnREYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICBpZiAoXG4gICAgICBub3cuZ2V0TW9udGgoKSA8IHN0YXJ0RGF0ZS5nZXRNb250aCgpIHx8XG4gICAgICAobm93LmdldE1vbnRoKCkgPT09IHN0YXJ0RGF0ZS5nZXRNb250aCgpICYmXG4gICAgICAgIG5vdy5nZXREYXRlKCkgPCBzdGFydERhdGUuZ2V0RGF0ZSgpKVxuICAgICkge1xuICAgICAgeWVhcnMtLTtcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoeWVhcnMsIDApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=