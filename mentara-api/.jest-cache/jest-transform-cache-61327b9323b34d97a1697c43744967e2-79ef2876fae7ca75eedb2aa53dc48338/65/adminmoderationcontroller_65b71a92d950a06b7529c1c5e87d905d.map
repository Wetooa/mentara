{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-moderation.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-moderation.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  Post,\n  Body,\n  Param,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  Query,\n  HttpCode,\n} from '@nestjs/common';\nimport { AdminService } from '../admin.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { AdminAuthGuard } from '../../auth/guards/admin-auth.guard';\nimport { AdminOnly } from '../../auth/decorators/admin-only.decorator';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBody,\n  ApiBearerAuth,\n  ApiParam,\n  ApiQuery,\n} from '@nestjs/swagger';\nimport {\n  ModerationService,\n  ModerationContext,\n} from '../../common/services/moderation.service';\n\n@ApiTags('admin-moderation')\n@ApiBearerAuth('JWT-auth')\n@Controller('admin/moderation')\n@UseGuards(JwtAuthGuard, AdminAuthGuard)\nexport class AdminModerationController {\n  private readonly logger = new Logger(AdminModerationController.name);\n\n  constructor(\n    private readonly adminService: AdminService,\n    private readonly moderationService: ModerationService,\n  ) {}\n\n  @Get('flagged')\n  @ApiOperation({\n    summary: 'Retrieve get flagged content',\n\n    description: 'Retrieve get flagged content',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @AdminOnly()\n  async getFlaggedContent(\n    @CurrentUserId() currentUserId: string,\n    @Query('type') type?: string,\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n  ) {\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving flagged content`);\n      const pageNum = page ? parseInt(page) : 1;\n      const limitNum = limit ? parseInt(limit) : 10;\n\n      return await this.adminService.getFlaggedContent({\n        type,\n        page: pageNum,\n        limit: limitNum,\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve flagged content:', error);\n      throw new HttpException(\n        'Failed to retrieve flagged content',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':contentType/:contentId/moderate')\n  @ApiOperation({\n    summary: 'Update moderate content',\n\n    description: 'Update moderate content',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Updated successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @AdminOnly()\n  async moderateContent(\n    @CurrentUserId() currentUserId: string,\n    @Param('contentType') contentType: string,\n    @Param('contentId') contentId: string,\n    @Body()\n    moderationData: { action: 'approve' | 'remove' | 'flag'; reason?: string },\n  ) {\n    try {\n      this.logger.log(\n        `Admin ${currentUserId} moderating ${contentType} ${contentId}`,\n      );\n      return await this.adminService.moderateContent(\n        contentType,\n        contentId,\n        currentUserId,\n        moderationData.action,\n        moderationData.reason,\n      );\n    } catch (error) {\n      this.logger.error('Failed to moderate content:', error);\n      throw new HttpException(\n        'Failed to moderate content',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  // AI Moderation Service Integration\n\n  /**\n   * Get moderation service health status\n   */\n  @Get('service/health')\n  @ApiOperation({\n    summary: 'Retrieve get service health status',\n\n    description: 'Retrieve get service health status',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @AdminOnly()\n  async getServiceHealthStatus() {\n    try {\n      return await this.moderationService.healthCheck();\n    } catch (error) {\n      this.logger.error('Failed to get moderation service health:', error);\n      throw new HttpException(\n        'Failed to get moderation service health',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  /**\n   * Get moderation service statistics\n   */\n  @Get('service/stats')\n  @ApiOperation({\n    summary: 'Retrieve get service stats',\n\n    description: 'Retrieve get service stats',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @AdminOnly()\n  async getServiceStats() {\n    try {\n      return await this.moderationService.getStats();\n    } catch (error) {\n      this.logger.error('Failed to get moderation service stats:', error);\n      throw new HttpException(\n        'Failed to get moderation service stats',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  /**\n   * Test content classification (for admin testing)\n   */\n  @Post('service/test-classify')\n  @ApiOperation({\n    summary: 'Create test classification',\n\n    description: 'Create test classification',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.OK)\n  @AdminOnly()\n  async testClassification(\n    @CurrentUserId() adminId: string,\n    @Body() body: { text: string; context: string },\n  ) {\n    try {\n      const context: ModerationContext = {\n        context: body.context,\n        userId: adminId,\n        userRole: 'admin',\n        timestamp: new Date(),\n      };\n\n      const result = await this.moderationService.classifyContent(\n        body.text,\n        context,\n      );\n\n      return {\n        result,\n        testInfo: {\n          testedBy: adminId,\n          timestamp: new Date(),\n          inputText: body.text,\n          inputContext: body.context,\n        },\n      };\n    } catch (error) {\n      this.logger.error('Failed to test content classification:', error);\n      throw new HttpException(\n        'Failed to test content classification',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  /**\n   * Check if content would trigger crisis intervention\n   */\n  @Post('service/test-crisis')\n  @ApiOperation({\n    summary: 'Create test crisis detection',\n\n    description: 'Create test crisis detection',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.OK)\n  @AdminOnly()\n  async testCrisisDetection(\n    @CurrentUserId() adminId: string,\n    @Body() body: { text: string; context: string },\n  ) {\n    try {\n      const context: ModerationContext = {\n        context: body.context,\n        userId: adminId,\n        userRole: 'admin',\n        timestamp: new Date(),\n      };\n\n      const isCrisis = await this.moderationService.checkCrisisContent(\n        body.text,\n        context,\n      );\n      const fullResult = await this.moderationService.classifyContent(\n        body.text,\n        context,\n      );\n\n      return {\n        isCrisis,\n        crisisLevel: fullResult.crisisLevel,\n        immediateEscalation: fullResult.immediateEscalation,\n        fullResult,\n        testInfo: {\n          testedBy: adminId,\n          timestamp: new Date(),\n          inputText: body.text,\n          inputContext: body.context,\n        },\n      };\n    } catch (error) {\n      this.logger.error('Failed to test crisis detection:', error);\n      throw new HttpException(\n        'Failed to test crisis detection',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  /**\n   * Batch test multiple content items\n   */\n  @Post('service/test-batch')\n  @ApiOperation({\n    summary: 'Create test batch classification',\n\n    description: 'Create test batch classification',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.OK)\n  @AdminOnly()\n  async testBatchClassification(\n    @CurrentUserId() adminId: string,\n    @Body() body: { items: Array<{ text: string; context: string }> },\n  ) {\n    try {\n      const items = body.items.map((item) => ({\n        text: item.text,\n        context: {\n          context: item.context,\n          userId: adminId,\n          userRole: 'admin' as const,\n          timestamp: new Date(),\n        },\n      }));\n\n      const results = await this.moderationService.batchClassify(items);\n\n      return {\n        results,\n        testInfo: {\n          testedBy: adminId,\n          timestamp: new Date(),\n          itemCount: items.length,\n        },\n      };\n    } catch (error) {\n      this.logger.error('Failed to test batch classification:', error);\n      throw new HttpException(\n        'Failed to test batch classification',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"version":3}