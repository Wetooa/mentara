{"version":3,"names":["cov_s2i4vsm0m","actualCoverage","common_1","s","require","prisma_client_provider_1","event_emitter_1","client_1","BillingService","BillingService_1","prisma","eventEmitter","logger","Logger","name","constructor","f","createPaymentMethod","data","log","userId","isDefault","b","paymentMethod","updateMany","where","create","type","cardLast4","cardBrand","emit","paymentMethodId","id","getUserPaymentMethods","findMany","orderBy","createdAt","updatePaymentMethod","findUnique","NotFoundException","update","deletePaymentMethod","otherMethods","count","not","pendingPayments","payment","OR","clientId","therapistId","status","PaymentStatus","PENDING","BadRequestException","delete","success","processSessionPayment","amount","currency","findFirst","meetingId","failureReason","include","client","select","user","firstName","lastName","email","therapist","processPaymentAsync","catch","error","paymentId","Promise","resolve","setTimeout","Math","random","mockPaymentGateway","handlePaymentSuccess","handlePaymentFailure","updatedPayment","COMPLETED","processedAt","Date","platformFeeRate","platformFee","Number","therapistAmount","failureReasons","floor","length","warn","FAILED","failedAt","getPayment","meeting","startTime","endTime","title","getUserPayments","options","role","take","limit","skip","offset","retryPayment","message","getTherapistPaymentStats","startDate","endDate","gte","lte","totalPayments","stats","all","aggregate","_sum","_avg","totalRevenue","averageSessionRate","platformFees","netEarnings","totalSessions","period","getPlatformStats","successfulPayments","failedPayments","revenueStats","platformRevenue","successRate","therapistPayouts","exports","__decorate","Injectable","PrismaService","_a","Object","_b","EventEmitter2"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  BadRequestException,\n  Logger,\n} from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { EventEmitter2 } from '@nestjs/event-emitter';\nimport {\n  PaymentStatus,\n  PaymentMethodType,\n} from '@prisma/client';\n\n/**\n * Educational Billing Service for Mental Health Platform\n * \n * This service provides a simplified, educational payment processing system\n * suitable for a school project. It simulates real payment flows without\n * processing actual money.\n * \n * Features:\n * - Mock payment processing for therapy sessions\n * - Payment method management\n * - Educational payment flows\n * - Realistic payment failures and retries\n */\n@Injectable()\nexport class BillingService {\n  private readonly logger = new Logger(BillingService.name);\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly eventEmitter: EventEmitter2,\n  ) {}\n\n  // ===== PAYMENT METHODS =====\n\n  /**\n   * Create a new payment method for a user\n   */\n  async createPaymentMethod(data: {\n    userId: string;\n    type: PaymentMethodType;\n    cardLast4?: string;\n    cardBrand?: string;\n    isDefault?: boolean;\n  }) {\n    this.logger.log(`Creating payment method for user ${data.userId}`);\n\n    // If this is set as default, unset other default payment methods\n    if (data.isDefault) {\n      await this.prisma.paymentMethod.updateMany({\n        where: { userId: data.userId, isDefault: true },\n        data: { isDefault: false },\n      });\n    }\n\n    const paymentMethod = await this.prisma.paymentMethod.create({\n      data: {\n        userId: data.userId,\n        type: data.type,\n        cardLast4: data.cardLast4,\n        cardBrand: data.cardBrand,\n        isDefault: data.isDefault || false,\n      },\n    });\n\n    this.eventEmitter.emit('payment_method.created', {\n      userId: data.userId,\n      paymentMethodId: paymentMethod.id,\n      type: data.type,\n    });\n\n    return paymentMethod;\n  }\n\n  /**\n   * Get all payment methods for a user\n   */\n  async getUserPaymentMethods(userId: string) {\n    return this.prisma.paymentMethod.findMany({\n      where: { userId },\n      orderBy: [{ isDefault: 'desc' }, { createdAt: 'desc' }],\n    });\n  }\n\n  /**\n   * Update payment method settings\n   */\n  async updatePaymentMethod(\n    id: string,\n    data: { isDefault?: boolean }\n  ) {\n    const paymentMethod = await this.prisma.paymentMethod.findUnique({\n      where: { id },\n    });\n\n    if (!paymentMethod) {\n      throw new NotFoundException(`Payment method ${id} not found`);\n    }\n\n    // If setting as default, unset other defaults for this user\n    if (data.isDefault) {\n      await this.prisma.paymentMethod.updateMany({\n        where: { userId: paymentMethod.userId, isDefault: true },\n        data: { isDefault: false },\n      });\n    }\n\n    return this.prisma.paymentMethod.update({\n      where: { id },\n      data,\n    });\n  }\n\n  /**\n   * Delete (soft delete) a payment method\n   */\n  async deletePaymentMethod(id: string) {\n    const paymentMethod = await this.prisma.paymentMethod.findUnique({\n      where: { id },\n    });\n\n    if (!paymentMethod) {\n      throw new NotFoundException(`Payment method ${id} not found`);\n    }\n\n    // Cannot delete the only payment method if user has pending payments\n    const otherMethods = await this.prisma.paymentMethod.count({\n      where: { \n        userId: paymentMethod.userId,\n        id: { not: id }\n      },\n    });\n\n    const pendingPayments = await this.prisma.payment.count({\n      where: {\n        OR: [\n          { clientId: paymentMethod.userId },\n          { therapistId: paymentMethod.userId }\n        ],\n        status: PaymentStatus.PENDING,\n      },\n    });\n\n    if (otherMethods === 0 && pendingPayments > 0) {\n      throw new BadRequestException(\n        'Cannot delete the only payment method with pending payments'\n      );\n    }\n\n    await this.prisma.paymentMethod.delete({\n      where: { id },\n    });\n\n    this.eventEmitter.emit('payment_method.deleted', {\n      userId: paymentMethod.userId,\n      paymentMethodId: id,\n    });\n\n    return { success: true };\n  }\n\n  // ===== PAYMENT PROCESSING =====\n\n  /**\n   * Process a payment for a therapy session\n   */\n  async processSessionPayment(data: {\n    clientId: string;\n    therapistId: string;\n    meetingId?: string;\n    amount: number;\n    currency?: string;\n    paymentMethodId: string;\n    description?: string;\n  }) {\n    this.logger.log(\n      `Processing session payment: ${data.amount} ${data.currency || 'USD'} from client ${data.clientId} to therapist ${data.therapistId}`\n    );\n\n    // Validate payment method belongs to client\n    const paymentMethod = await this.prisma.paymentMethod.findFirst({\n      where: {\n        id: data.paymentMethodId,\n        userId: data.clientId,\n      },\n    });\n\n    if (!paymentMethod) {\n      throw new BadRequestException('Invalid payment method');\n    }\n\n    // Create payment record\n    const payment = await this.prisma.payment.create({\n      data: {\n        amount: data.amount,\n        currency: data.currency || 'USD',\n        status: PaymentStatus.PENDING,\n        clientId: data.clientId,\n        therapistId: data.therapistId,\n        meetingId: data.meetingId,\n        paymentMethodId: data.paymentMethodId,\n        failureReason: null,\n      },\n      include: {\n        client: {\n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        therapist: {\n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        paymentMethod: true,\n      },\n    });\n\n    // Process payment asynchronously\n    this.processPaymentAsync(payment.id).catch((error) => {\n      this.logger.error(`Failed to process payment ${payment.id}:`, error);\n    });\n\n    return payment;\n  }\n\n  /**\n   * Asynchronously process the payment with mock payment gateway\n   */\n  private async processPaymentAsync(paymentId: string) {\n    // Simulate payment processing delay\n    await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 3000));\n\n    const payment = await this.prisma.payment.findUnique({\n      where: { id: paymentId },\n      include: {\n        client: { \n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        therapist: { \n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        paymentMethod: true,\n      },\n    });\n\n    if (!payment) {\n      this.logger.error(`Payment ${paymentId} not found during processing`);\n      return;\n    }\n\n    // Mock payment processing with realistic success/failure rates\n    const success = this.mockPaymentGateway(payment);\n\n    if (success) {\n      await this.handlePaymentSuccess(payment);\n    } else {\n      await this.handlePaymentFailure(payment);\n    }\n  }\n\n  /**\n   * Mock payment gateway simulation\n   * Returns true for success, false for failure\n   */\n  private mockPaymentGateway(payment: any): boolean {\n    // Simulate different failure scenarios based on card details\n    const cardLast4 = payment.paymentMethod?.cardLast4;\n    \n    // Test card numbers for specific scenarios\n    if (cardLast4) {\n      switch (cardLast4) {\n        case '0002': // Always decline\n          return false;\n        case '0004': // Always decline with insufficient funds\n          return false;\n        case '0008': // Always decline with expired card\n          return false;\n        case '0001': // Always succeed\n          return true;\n        default:\n          // Random success/failure (90% success rate)\n          return Math.random() > 0.1;\n      }\n    }\n\n    // Default: 90% success rate\n    return Math.random() > 0.1;\n  }\n\n  /**\n   * Handle successful payment\n   */\n  private async handlePaymentSuccess(payment: any) {\n    this.logger.log(`Payment ${payment.id} processed successfully`);\n\n    const updatedPayment = await this.prisma.payment.update({\n      where: { id: payment.id },\n      data: {\n        status: PaymentStatus.COMPLETED,\n        processedAt: new Date(),\n      },\n    });\n\n    // Calculate platform fee (e.g., 5% platform commission)\n    const platformFeeRate = 0.05;\n    const platformFee = Number(payment.amount) * platformFeeRate;\n    const therapistAmount = Number(payment.amount) - platformFee;\n\n    // Emit payment success event\n    this.eventEmitter.emit('payment.succeeded', {\n      paymentId: payment.id,\n      clientId: payment.clientId,\n      therapistId: payment.therapistId,\n      amount: Number(payment.amount),\n      currency: payment.currency,\n      platformFee,\n      therapistAmount,\n      meetingId: payment.meetingId,\n    });\n\n    return updatedPayment;\n  }\n\n  /**\n   * Handle failed payment\n   */\n  private async handlePaymentFailure(payment: any) {\n    const failureReasons = [\n      'Insufficient funds',\n      'Card declined',\n      'Expired card',\n      'Invalid card number',\n      'Network error',\n    ];\n\n    const failureReason = failureReasons[Math.floor(Math.random() * failureReasons.length)];\n    \n    this.logger.warn(`Payment ${payment.id} failed: ${failureReason}`);\n\n    const updatedPayment = await this.prisma.payment.update({\n      where: { id: payment.id },\n      data: {\n        status: PaymentStatus.FAILED,\n        failedAt: new Date(),\n        failureReason,\n      },\n    });\n\n    // Emit payment failure event\n    this.eventEmitter.emit('payment.failed', {\n      paymentId: payment.id,\n      clientId: payment.clientId,\n      therapistId: payment.therapistId,\n      amount: Number(payment.amount),\n      currency: payment.currency,\n      failureReason,\n      meetingId: payment.meetingId,\n    });\n\n    return updatedPayment;\n  }\n\n  // ===== PAYMENT QUERIES =====\n\n  /**\n   * Get payment by ID\n   */\n  async getPayment(id: string) {\n    const payment = await this.prisma.payment.findUnique({\n      where: { id },\n      include: {\n        client: {\n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        therapist: {\n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        paymentMethod: true,\n        meeting: {\n          select: { startTime: true, endTime: true, title: true }\n        },\n      },\n    });\n\n    if (!payment) {\n      throw new NotFoundException(`Payment ${id} not found`);\n    }\n\n    return payment;\n  }\n\n  /**\n   * Get payments for a user (as client or therapist)\n   */\n  async getUserPayments(\n    userId: string,\n    options: {\n      role?: 'client' | 'therapist';\n      status?: PaymentStatus;\n      limit?: number;\n      offset?: number;\n    } = {}\n  ) {\n    const where: any = {};\n\n    if (options.role === 'client') {\n      where.clientId = userId;\n    } else if (options.role === 'therapist') {\n      where.therapistId = userId;\n    } else {\n      where.OR = [\n        { clientId: userId },\n        { therapistId: userId },\n      ];\n    }\n\n    if (options.status) {\n      where.status = options.status;\n    }\n\n    return this.prisma.payment.findMany({\n      where,\n      include: {\n        client: {\n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        therapist: {\n          select: { \n            user: {\n              select: { firstName: true, lastName: true, email: true }\n            }\n          }\n        },\n        paymentMethod: true,\n        meeting: {\n          select: { startTime: true, endTime: true, title: true }\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      take: options.limit || 50,\n      skip: options.offset || 0,\n    });\n  }\n\n  /**\n   * Retry a failed payment\n   */\n  async retryPayment(paymentId: string) {\n    const payment = await this.prisma.payment.findUnique({\n      where: { id: paymentId },\n    });\n\n    if (!payment) {\n      throw new NotFoundException(`Payment ${paymentId} not found`);\n    }\n\n    if (payment.status !== PaymentStatus.FAILED) {\n      throw new BadRequestException('Can only retry failed payments');\n    }\n\n    // Reset payment to pending and retry\n    await this.prisma.payment.update({\n      where: { id: paymentId },\n      data: {\n        status: PaymentStatus.PENDING,\n        failureReason: null,\n        failedAt: null,\n      },\n    });\n\n    // Process payment again\n    this.processPaymentAsync(paymentId).catch((error) => {\n      this.logger.error(`Failed to retry payment ${paymentId}:`, error);\n    });\n\n    return { success: true, message: 'Payment retry initiated' };\n  }\n\n  // ===== ANALYTICS & REPORTING =====\n\n  /**\n   * Get payment statistics for therapists\n   */\n  async getTherapistPaymentStats(\n    therapistId: string,\n    startDate?: Date,\n    endDate?: Date\n  ) {\n    const where: any = {\n      therapistId,\n      status: PaymentStatus.COMPLETED,\n    };\n\n    if (startDate) {\n      where.processedAt = { ...where.processedAt, gte: startDate };\n    }\n    if (endDate) {\n      where.processedAt = { ...where.processedAt, lte: endDate };\n    }\n\n    const [totalPayments, stats] = await Promise.all([\n      this.prisma.payment.count({ where }),\n      this.prisma.payment.aggregate({\n        where,\n        _sum: { amount: true },\n        _avg: { amount: true },\n      }),\n    ]);\n\n    const totalRevenue = Number(stats._sum.amount || 0);\n    const averageSessionRate = Number(stats._avg.amount || 0);\n    const platformFeeRate = 0.05;\n    const platformFees = totalRevenue * platformFeeRate;\n    const netEarnings = totalRevenue - platformFees;\n\n    return {\n      totalSessions: totalPayments,\n      totalRevenue,\n      averageSessionRate,\n      platformFees,\n      netEarnings,\n      period: {\n        startDate,\n        endDate,\n      },\n    };\n  }\n\n  /**\n   * Get platform billing statistics (admin only)\n   */\n  async getPlatformStats(startDate?: Date, endDate?: Date) {\n    const where: any = {};\n\n    if (startDate) {\n      where.createdAt = { ...where.createdAt, gte: startDate };\n    }\n    if (endDate) {\n      where.createdAt = { ...where.createdAt, lte: endDate };\n    }\n\n    const [\n      totalPayments,\n      successfulPayments,\n      failedPayments,\n      revenueStats,\n    ] = await Promise.all([\n      this.prisma.payment.count({ where }),\n      this.prisma.payment.count({ \n        where: { ...where, status: PaymentStatus.COMPLETED }\n      }),\n      this.prisma.payment.count({ \n        where: { ...where, status: PaymentStatus.FAILED }\n      }),\n      this.prisma.payment.aggregate({\n        where: { ...where, status: PaymentStatus.COMPLETED },\n        _sum: { amount: true },\n      }),\n    ]);\n\n    const totalRevenue = Number(revenueStats._sum.amount || 0);\n    const platformFeeRate = 0.05;\n    const platformRevenue = totalRevenue * platformFeeRate;\n    const successRate = totalPayments > 0 ? (successfulPayments / totalPayments) * 100 : 0;\n\n    return {\n      totalPayments,\n      successfulPayments,\n      failedPayments,\n      successRate,\n      totalRevenue,\n      platformRevenue,\n      therapistPayouts: totalRevenue - platformRevenue,\n      period: {\n        startDate,\n        endDate,\n      },\n    };\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}