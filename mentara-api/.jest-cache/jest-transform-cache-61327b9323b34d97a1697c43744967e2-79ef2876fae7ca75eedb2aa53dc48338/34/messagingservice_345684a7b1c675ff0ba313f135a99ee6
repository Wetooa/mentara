a80a5dbbfd4948487f27d06542e25da2
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MessagingService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
const event_bus_service_1 = require("../common/events/event-bus.service");
const messaging_events_1 = require("../common/events/messaging-events");
let MessagingService = class MessagingService {
    prisma;
    eventBus;
    constructor(prisma, eventBus) {
        this.prisma = prisma;
        this.eventBus = eventBus;
    }
    // Conversation Management
    async createConversation(userId, createConversationDto) {
        const { participantIds, type = client_1.ConversationType.DIRECT, title, } = createConversationDto;
        // Validate conversation type and participants
        if (type === client_1.ConversationType.DIRECT && participantIds.length !== 1) {
            throw new common_1.BadRequestException('Direct conversations must have exactly one other participant');
        }
        // Check if direct conversation already exists
        if (type === client_1.ConversationType.DIRECT) {
            const existingConversation = await this.findDirectConversation(userId, participantIds[0]);
            if (existingConversation) {
                return existingConversation;
            }
        }
        // Create conversation with participants
        const conversation = await this.prisma.conversation.create({
            data: {
                type,
                title,
                participants: {
                    create: [
                        { userId, role: client_1.ParticipantRole.ADMIN },
                        ...participantIds.map((participantId) => ({
                            userId: participantId,
                            role: client_1.ParticipantRole.MEMBER,
                        })),
                    ],
                },
            },
            include: {
                participants: {
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                                role: true,
                            },
                        },
                    },
                },
                messages: {
                    take: 1,
                    orderBy: { createdAt: 'desc' },
                    include: {
                        sender: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
            },
        });
        // Publish conversation created event
        await this.eventBus.emit(new messaging_events_1.ConversationCreatedEvent({
            conversationId: conversation.id,
            createdBy: userId,
            participantIds: [userId, ...participantIds],
            conversationType: type.toLowerCase(),
            title: title || undefined,
            isPrivate: type === client_1.ConversationType.DIRECT,
        }));
        return conversation;
    }
    async getUserConversations(userId, page = 1, limit = 20) {
        const skip = (page - 1) * limit;
        const conversations = await this.prisma.conversation.findMany({
            where: {
                participants: {
                    some: {
                        userId,
                        isActive: true,
                    },
                },
                isActive: true,
            },
            include: {
                participants: {
                    where: { isActive: true },
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                                role: true,
                            },
                        },
                    },
                },
                messages: {
                    take: 1,
                    orderBy: { createdAt: 'desc' },
                    where: { isDeleted: false },
                    include: {
                        sender: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                _count: {
                    select: {
                        messages: {
                            where: {
                                isDeleted: false,
                                readReceipts: {
                                    none: { userId },
                                },
                            },
                        },
                    },
                },
            },
            orderBy: { lastMessageAt: 'desc' },
            skip,
            take: limit,
        });
        return conversations;
    }
    // Message Management
    async sendMessage(userId, conversationId, sendMessageDto) {
        // Verify user is participant in conversation
        await this.verifyParticipant(userId, conversationId);
        const { content, messageType = client_1.MessageType.TEXT, replyToId, attachmentUrl, attachmentName, attachmentSize, } = sendMessageDto;
        const message = await this.prisma.message.create({
            data: {
                conversationId,
                senderId: userId,
                content,
                messageType,
                replyToId,
                attachmentUrl,
                attachmentName,
                attachmentSize,
            },
            include: {
                sender: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        avatarUrl: true,
                    },
                },
                replyTo: {
                    include: {
                        sender: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                            },
                        },
                    },
                },
                reactions: {
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                            },
                        },
                    },
                },
            },
        });
        // Update conversation lastMessageAt
        await this.prisma.conversation.update({
            where: { id: conversationId },
            data: { lastMessageAt: new Date() },
        });
        // Get conversation participants for event
        const conversation = await this.prisma.conversation.findUnique({
            where: { id: conversationId },
            include: {
                participants: {
                    where: { isActive: true },
                    select: { userId: true },
                },
            },
        });
        const recipientIds = conversation?.participants
            .map((p) => p.userId)
            .filter((id) => id !== userId) || [];
        // Publish message sent event
        await this.eventBus.emit(new messaging_events_1.MessageSentEvent({
            messageId: message.id,
            conversationId,
            senderId: userId,
            content: message.content,
            messageType: message.messageType.toLowerCase(),
            sentAt: message.createdAt,
            recipientIds,
            replyToMessageId: message.replyToId || undefined,
            fileAttachments: message.attachmentUrl
                ? [message.attachmentUrl]
                : undefined,
        }));
        return message;
    }
    async getConversationMessages(userId, conversationId, page = 1, limit = 50) {
        // Verify user is participant in conversation
        await this.verifyParticipant(userId, conversationId);
        const skip = (page - 1) * limit;
        const messages = await this.prisma.message.findMany({
            where: {
                conversationId,
                isDeleted: false,
            },
            include: {
                sender: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        avatarUrl: true,
                    },
                },
                replyTo: {
                    include: {
                        sender: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                            },
                        },
                    },
                },
                reactions: {
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                            },
                        },
                    },
                },
                readReceipts: {
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                            },
                        },
                    },
                },
            },
            orderBy: { createdAt: 'desc' },
            skip,
            take: limit,
        });
        return messages.reverse(); // Return in chronological order
    }
    async updateMessage(userId, messageId, updateMessageDto) {
        const message = await this.prisma.message.findUnique({
            where: { id: messageId },
        });
        if (!message) {
            throw new common_1.NotFoundException('Message not found');
        }
        if (message.senderId !== userId) {
            throw new common_1.ForbiddenException('You can only edit your own messages');
        }
        if (message.isDeleted) {
            throw new common_1.BadRequestException('Cannot edit deleted message');
        }
        const updatedMessage = await this.prisma.message.update({
            where: { id: messageId },
            data: {
                content: updateMessageDto.content,
                isEdited: true,
                editedAt: new Date(),
            },
            include: {
                sender: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        avatarUrl: true,
                    },
                },
                reactions: {
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                            },
                        },
                    },
                },
            },
        });
        return updatedMessage;
    }
    async deleteMessage(userId, messageId) {
        const message = await this.prisma.message.findUnique({
            where: { id: messageId },
        });
        if (!message) {
            throw new common_1.NotFoundException('Message not found');
        }
        if (message.senderId !== userId) {
            throw new common_1.ForbiddenException('You can only delete your own messages');
        }
        await this.prisma.message.update({
            where: { id: messageId },
            data: { isDeleted: true },
        });
        return { success: true };
    }
    // Read Receipts
    async markMessageAsRead(userId, messageId) {
        const message = await this.prisma.message.findUnique({
            where: { id: messageId },
        });
        if (!message) {
            throw new common_1.NotFoundException('Message not found');
        }
        // Don't create read receipt for own messages
        if (message.senderId === userId) {
            return;
        }
        // Verify user is participant in conversation
        await this.verifyParticipant(userId, message.conversationId);
        await this.prisma.messageReadReceipt.upsert({
            where: {
                messageId_userId: {
                    messageId,
                    userId,
                },
            },
            create: {
                messageId,
                userId,
            },
            update: {
                readAt: new Date(),
            },
        });
        // Update participant's lastReadAt
        await this.prisma.conversationParticipant.updateMany({
            where: {
                conversationId: message.conversationId,
                userId,
            },
            data: {
                lastReadAt: new Date(),
            },
        });
        // Publish message read event
        await this.eventBus.emit(new messaging_events_1.MessageReadEvent({
            messageId,
            readBy: userId,
            readAt: new Date(),
            conversationId: message.conversationId,
            messagesSinceLastRead: 1, // Could be enhanced to calculate actual count
        }));
    }
    // Message Reactions
    async addMessageReaction(userId, messageId, emoji) {
        const message = await this.prisma.message.findUnique({
            where: { id: messageId },
        });
        if (!message) {
            throw new common_1.NotFoundException('Message not found');
        }
        // Verify user is participant in conversation
        await this.verifyParticipant(userId, message.conversationId);
        const reaction = await this.prisma.messageReaction.upsert({
            where: {
                messageId_userId_emoji: {
                    messageId,
                    userId,
                    emoji,
                },
            },
            create: {
                messageId,
                userId,
                emoji,
            },
            update: {
                emoji,
            },
            include: {
                user: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                    },
                },
            },
        });
        return reaction;
    }
    async removeMessageReaction(userId, messageId, emoji) {
        await this.prisma.messageReaction.deleteMany({
            where: {
                messageId,
                userId,
                emoji,
            },
        });
        return { success: true };
    }
    // User Blocking
    async blockUser(blockerId, blockedId, reason) {
        if (blockerId === blockedId) {
            throw new common_1.BadRequestException('Cannot block yourself');
        }
        await this.prisma.userBlock.upsert({
            where: {
                blockerId_blockedId: {
                    blockerId,
                    blockedId,
                },
            },
            create: {
                blockerId,
                blockedId,
                reason,
            },
            update: {
                reason,
            },
        });
        return { success: true };
    }
    async unblockUser(blockerId, blockedId) {
        await this.prisma.userBlock.deleteMany({
            where: {
                blockerId,
                blockedId,
            },
        });
        return { success: true };
    }
    // Helper Methods
    async findDirectConversation(user1Id, user2Id) {
        return this.prisma.conversation.findFirst({
            where: {
                type: client_1.ConversationType.DIRECT,
                participants: {
                    every: {
                        userId: { in: [user1Id, user2Id] },
                    },
                },
            },
            include: {
                participants: {
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                                role: true,
                            },
                        },
                    },
                },
            },
        });
    }
    async verifyParticipant(userId, conversationId) {
        const participant = await this.prisma.conversationParticipant.findUnique({
            where: {
                conversationId_userId: {
                    conversationId,
                    userId,
                },
            },
        });
        if (!participant || !participant.isActive) {
            throw new common_1.ForbiddenException('You are not a participant in this conversation');
        }
        return participant;
    }
    // Search Messages
    async searchMessages(userId, query, conversationId, page = 1, limit = 20) {
        const skip = (page - 1) * limit;
        const whereClause = {
            content: {
                contains: query,
                mode: 'insensitive',
            },
            isDeleted: false,
            conversation: {
                participants: {
                    some: {
                        userId,
                        isActive: true,
                    },
                },
            },
        };
        if (conversationId) {
            whereClause.conversationId = conversationId;
        }
        const messages = await this.prisma.message.findMany({
            where: whereClause,
            include: {
                sender: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        avatarUrl: true,
                    },
                },
                conversation: {
                    select: {
                        id: true,
                        type: true,
                        title: true,
                    },
                },
            },
            orderBy: { createdAt: 'desc' },
            skip,
            take: limit,
        });
        return messages;
    }
};
exports.MessagingService = MessagingService;
exports.MessagingService = MessagingService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [prisma_client_provider_1.PrismaService,
        event_bus_service_1.EventBusService])
], MessagingService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9tZXNzYWdpbmcuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwyQ0FLd0I7QUFDeEIsZ0ZBQW9FO0FBTXBFLDJDQUFnRjtBQUNoRiwwRUFBcUU7QUFDckUsd0VBSTJDO0FBR3BDLElBQU0sZ0JBQWdCLEdBQXRCLE1BQU0sZ0JBQWdCO0lBRVI7SUFDQTtJQUZuQixZQUNtQixNQUFxQixFQUNyQixRQUF5QjtRQUR6QixXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3JCLGFBQVEsR0FBUixRQUFRLENBQWlCO0lBQ3pDLENBQUM7SUFFSiwwQkFBMEI7SUFDMUIsS0FBSyxDQUFDLGtCQUFrQixDQUN0QixNQUFjLEVBQ2QscUJBQTRDO1FBRTVDLE1BQU0sRUFDSixjQUFjLEVBQ2QsSUFBSSxHQUFHLHlCQUFnQixDQUFDLE1BQU0sRUFDOUIsS0FBSyxHQUNOLEdBQUcscUJBQXFCLENBQUM7UUFFMUIsOENBQThDO1FBQzlDLElBQUksSUFBSSxLQUFLLHlCQUFnQixDQUFDLE1BQU0sSUFBSSxjQUFjLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3BFLE1BQU0sSUFBSSw0QkFBbUIsQ0FDM0IsOERBQThELENBQy9ELENBQUM7UUFDSixDQUFDO1FBRUQsOENBQThDO1FBQzlDLElBQUksSUFBSSxLQUFLLHlCQUFnQixDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3JDLE1BQU0sb0JBQW9CLEdBQUcsTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQzVELE1BQU0sRUFDTixjQUFjLENBQUMsQ0FBQyxDQUFDLENBQ2xCLENBQUM7WUFDRixJQUFJLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3pCLE9BQU8sb0JBQW9CLENBQUM7WUFDOUIsQ0FBQztRQUNILENBQUM7UUFFRCx3Q0FBd0M7UUFDeEMsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxD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LE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ2xELEtBQUssRUFBRSxXQUFXO1lBQ2xCLE9BQU8sRUFBRTtnQkFDUCxNQUFNLEVBQUU7b0JBQ04sTUFBTSxFQUFFO3dCQUNOLEVBQUUsRUFBRSxJQUFJO3dCQUNSLFNBQVMsRUFBRSxJQUFJO3dCQUNmLFFBQVEsRUFBRSxJQUFJO3dCQUNkLFNBQVMsRUFBRSxJQUFJO3FCQUNoQjtpQkFDRjtnQkFDRCxZQUFZLEVBQUU7b0JBQ1osTUFBTSxFQUFFO3dCQUNOLEVBQUUsRUFBRSxJQUFJO3dCQUNSLElBQUksRUFBRSxJQUFJO3dCQUNWLEtBQUssRUFBRSxJQUFJO3FCQUNaO2lCQUNGO2FBQ0Y7WUFDRCxPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO1lBQzlCLElBQUk7WUFDSixJQUFJLEVBQUUsS0FBSztTQUNaLENBQUMsQ0FBQztRQUVILE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7Q0FDRixDQUFBO0FBbHFCWSw0Q0FBZ0I7MkJBQWhCLGdCQUFnQjtJQUQ1QixJQUFBLG1CQUFVLEdBQUU7cUNBR2dCLHNDQUFhO1FBQ1gsbUNBQWU7R0FIakMsZ0JBQWdCLENBa3FCNUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9tZXNzYWdpbmcuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgRm9yYmlkZGVuRXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHtcbiAgQ3JlYXRlQ29udmVyc2F0aW9uRHRvLFxuICBTZW5kTWVzc2FnZUR0byxcbiAgVXBkYXRlTWVzc2FnZUR0byxcbn0gZnJvbSAnLi9kdG8vbWVzc2FnaW5nLmR0byc7XG5pbXBvcnQgeyBDb252ZXJzYXRpb25UeXBlLCBNZXNzYWdlVHlwZSwgUGFydGljaXBhbnRSb2xlIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHsgRXZlbnRCdXNTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL2V2ZW50cy9ldmVudC1idXMuc2VydmljZSc7XG5pbXBvcnQge1xuICBNZXNzYWdlU2VudEV2ZW50LFxuICBNZXNzYWdlUmVhZEV2ZW50LFxuICBDb252ZXJzYXRpb25DcmVhdGVkRXZlbnQsXG59IGZyb20gJy4uL2NvbW1vbi9ldmVudHMvbWVzc2FnaW5nLWV2ZW50cyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNZXNzYWdpbmdTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBldmVudEJ1czogRXZlbnRCdXNTZXJ2aWNlLFxuICApIHt9XG5cbiAgLy8gQ29udmVyc2F0aW9uIE1hbmFnZW1lbnRcbiAgYXN5bmMgY3JlYXRlQ29udmVyc2F0aW9uKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGNyZWF0ZUNvbnZlcnNhdGlvbkR0bzogQ3JlYXRlQ29udmVyc2F0aW9uRHRvLFxuICApIHtcbiAgICBjb25zdCB7XG4gICAgICBwYXJ0aWNpcGFudElkcyxcbiAgICAgIHR5cGUgPSBDb252ZXJzYXRpb25UeXBlLkRJUkVDVCxcbiAgICAgIHRpdGxlLFxuICAgIH0gPSBjcmVhdGVDb252ZXJzYXRpb25EdG87XG5cbiAgICAvLyBWYWxpZGF0ZSBjb252ZXJzYXRpb24gdHlwZSBhbmQgcGFydGljaXBhbnRzXG4gICAgaWYgKHR5cGUgPT09IENvbnZlcnNhdGlvblR5cGUuRElSRUNUICYmIHBhcnRpY2lwYW50SWRzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICdEaXJlY3QgY29udmVyc2F0aW9ucyBtdXN0IGhhdmUgZXhhY3RseSBvbmUgb3RoZXIgcGFydGljaXBhbnQnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBkaXJlY3QgY29udmVyc2F0aW9uIGFscmVhZHkgZXhpc3RzXG4gICAgaWYgKHR5cGUgPT09IENvbnZlcnNhdGlvblR5cGUuRElSRUNUKSB7XG4gICAgICBjb25zdCBleGlzdGluZ0NvbnZlcnNhdGlvbiA9IGF3YWl0IHRoaXMuZmluZERpcmVjdENvbnZlcnNhdGlvbihcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBwYXJ0aWNpcGFudElkc1swXSxcbiAgICAgICk7XG4gICAgICBpZiAoZXhpc3RpbmdDb252ZXJzYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nQ29udmVyc2F0aW9uO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBjb252ZXJzYXRpb24gd2l0aCBwYXJ0aWNpcGFudHNcbiAgICBjb25zdCBjb252ZXJzYXRpb24gPSBhd2FpdCB0aGlzLnByaXNtYS5jb252ZXJzYXRpb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdHlwZSxcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIHBhcnRpY2lwYW50czoge1xuICAgICAgICAgIGNyZWF0ZTogW1xuICAgICAgICAgICAgeyB1c2VySWQsIHJvbGU6IFBhcnRpY2lwYW50Um9sZS5BRE1JTiB9LFxuICAgICAgICAgICAgLi4ucGFydGljaXBhbnRJZHMubWFwKChwYXJ0aWNpcGFudElkKSA9PiAoe1xuICAgICAgICAgICAgICB1c2VySWQ6IHBhcnRpY2lwYW50SWQsXG4gICAgICAgICAgICAgIHJvbGU6IFBhcnRpY2lwYW50Um9sZS5NRU1CRVIsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHBhcnRpY2lwYW50czoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgIHRha2U6IDEsXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHNlbmRlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFB1Ymxpc2ggY29udmVyc2F0aW9uIGNyZWF0ZWQgZXZlbnRcbiAgICBhd2FpdCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICBuZXcgQ29udmVyc2F0aW9uQ3JlYXRlZEV2ZW50KHtcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbi5pZCxcbiAgICAgICAgY3JlYXRlZEJ5OiB1c2VySWQsXG4gICAgICAgIHBhcnRpY2lwYW50SWRzOiBbdXNlcklkLCAuLi5wYXJ0aWNpcGFudElkc10sXG4gICAgICAgIGNvbnZlcnNhdGlvblR5cGU6IHR5cGUudG9Mb3dlckNhc2UoKSBhc1xuICAgICAgICAgIHwgJ2RpcmVjdCdcbiAgICAgICAgICB8ICdncm91cCdcbiAgICAgICAgICB8ICdzdXBwb3J0J1xuICAgICAgICAgIHwgJ3RoZXJhcHknLFxuICAgICAgICB0aXRsZTogdGl0bGUgfHwgdW5kZWZpbmVkLFxuICAgICAgICBpc1ByaXZhdGU6IHR5cGUgPT09IENvbnZlcnNhdGlvblR5cGUuRElSRUNULFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIHJldHVybiBjb252ZXJzYXRpb247XG4gIH1cblxuICBhc3luYyBnZXRVc2VyQ29udmVyc2F0aW9ucyh1c2VySWQ6IHN0cmluZywgcGFnZSA9IDEsIGxpbWl0ID0gMjApIHtcbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgY29uc3QgY29udmVyc2F0aW9ucyA9IGF3YWl0IHRoaXMucHJpc21hLmNvbnZlcnNhdGlvbi5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBwYXJ0aWNpcGFudHM6IHtcbiAgICAgICAgICBzb21lOiB7XG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHBhcnRpY2lwYW50czoge1xuICAgICAgICAgIHdoZXJlOiB7IGlzQWN0aXZlOiB0cnVlIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgdGFrZTogMSxcbiAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgICAgd2hlcmU6IHsgaXNEZWxldGVkOiBmYWxzZSB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHNlbmRlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgaXNEZWxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZWFkUmVjZWlwdHM6IHtcbiAgICAgICAgICAgICAgICAgIG5vbmU6IHsgdXNlcklkIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBvcmRlckJ5OiB7IGxhc3RNZXNzYWdlQXQ6ICdkZXNjJyB9LFxuICAgICAgc2tpcCxcbiAgICAgIHRha2U6IGxpbWl0LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNvbnZlcnNhdGlvbnM7XG4gIH1cblxuICAvLyBNZXNzYWdlIE1hbmFnZW1lbnRcbiAgYXN5bmMgc2VuZE1lc3NhZ2UoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgY29udmVyc2F0aW9uSWQ6IHN0cmluZyxcbiAgICBzZW5kTWVzc2FnZUR0bzogU2VuZE1lc3NhZ2VEdG8sXG4gICkge1xuICAgIC8vIFZlcmlmeSB1c2VyIGlzIHBhcnRpY2lwYW50IGluIGNvbnZlcnNhdGlvblxuICAgIGF3YWl0IHRoaXMudmVyaWZ5UGFydGljaXBhbnQodXNlcklkLCBjb252ZXJzYXRpb25JZCk7XG5cbiAgICBjb25zdCB7XG4gICAgICBjb250ZW50LFxuICAgICAgbWVzc2FnZVR5cGUgPSBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgcmVwbHlUb0lkLFxuICAgICAgYXR0YWNobWVudFVybCxcbiAgICAgIGF0dGFjaG1lbnROYW1lLFxuICAgICAgYXR0YWNobWVudFNpemUsXG4gICAgfSA9IHNlbmRNZXNzYWdlRHRvO1xuXG4gICAgY29uc3QgbWVzc2FnZSA9IGF3YWl0IHRoaXMucHJpc21hLm1lc3NhZ2UuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY29udmVyc2F0aW9uSWQsXG4gICAgICAgIHNlbmRlcklkOiB1c2VySWQsXG4gICAgICAgIGNvbnRlbnQsXG4gICAgICAgIG1lc3NhZ2VUeXBlLFxuICAgICAgICByZXBseVRvSWQsXG4gICAgICAgIGF0dGFjaG1lbnRVcmwsXG4gICAgICAgIGF0dGFjaG1lbnROYW1lLFxuICAgICAgICBhdHRhY2htZW50U2l6ZSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHNlbmRlcjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICByZXBseVRvOiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgc2VuZGVyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVhY3Rpb25zOiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVXBkYXRlIGNvbnZlcnNhdGlvbiBsYXN0TWVzc2FnZUF0XG4gICAgYXdhaXQgdGhpcy5wcmlzbWEuY29udmVyc2F0aW9uLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogY29udmVyc2F0aW9uSWQgfSxcbiAgICAgIGRhdGE6IHsgbGFzdE1lc3NhZ2VBdDogbmV3IERhdGUoKSB9LFxuICAgIH0pO1xuXG4gICAgLy8gR2V0IGNvbnZlcnNhdGlvbiBwYXJ0aWNpcGFudHMgZm9yIGV2ZW50XG4gICAgY29uc3QgY29udmVyc2F0aW9uID0gYXdhaXQgdGhpcy5wcmlzbWEuY29udmVyc2F0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IGNvbnZlcnNhdGlvbklkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHBhcnRpY2lwYW50czoge1xuICAgICAgICAgIHdoZXJlOiB7IGlzQWN0aXZlOiB0cnVlIH0sXG4gICAgICAgICAgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlY2lwaWVudElkcyA9XG4gICAgICBjb252ZXJzYXRpb24/LnBhcnRpY2lwYW50c1xuICAgICAgICAubWFwKChwKSA9PiBwLnVzZXJJZClcbiAgICAgICAgLmZpbHRlcigoaWQpID0+IGlkICE9PSB1c2VySWQpIHx8IFtdO1xuXG4gICAgLy8gUHVibGlzaCBtZXNzYWdlIHNlbnQgZXZlbnRcbiAgICBhd2FpdCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICBuZXcgTWVzc2FnZVNlbnRFdmVudCh7XG4gICAgICAgIG1lc3NhZ2VJZDogbWVzc2FnZS5pZCxcbiAgICAgICAgY29udmVyc2F0aW9uSWQsXG4gICAgICAgIHNlbmRlcklkOiB1c2VySWQsXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UuY29udGVudCxcbiAgICAgICAgbWVzc2FnZVR5cGU6IG1lc3NhZ2UubWVzc2FnZVR5cGUudG9Mb3dlckNhc2UoKSBhc1xuICAgICAgICAgIHwgJ3RleHQnXG4gICAgICAgICAgfCAnaW1hZ2UnXG4gICAgICAgICAgfCAnZmlsZSdcbiAgICAgICAgICB8ICdhdWRpbydcbiAgICAgICAgICB8ICd2aWRlbydcbiAgICAgICAgICB8ICdzeXN0ZW0nLFxuICAgICAgICBzZW50QXQ6IG1lc3NhZ2UuY3JlYXRlZEF0LFxuICAgICAgICByZWNpcGllbnRJZHMsXG4gICAgICAgIHJlcGx5VG9NZXNzYWdlSWQ6IG1lc3NhZ2UucmVwbHlUb0lkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgZmlsZUF0dGFjaG1lbnRzOiBtZXNzYWdlLmF0dGFjaG1lbnRVcmxcbiAgICAgICAgICA/IFttZXNzYWdlLmF0dGFjaG1lbnRVcmxdXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgcmV0dXJuIG1lc3NhZ2U7XG4gIH1cblxuICBhc3luYyBnZXRDb252ZXJzYXRpb25NZXNzYWdlcyhcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBjb252ZXJzYXRpb25JZDogc3RyaW5nLFxuICAgIHBhZ2UgPSAxLFxuICAgIGxpbWl0ID0gNTAsXG4gICkge1xuICAgIC8vIFZlcmlmeSB1c2VyIGlzIHBhcnRpY2lwYW50IGluIGNvbnZlcnNhdGlvblxuICAgIGF3YWl0IHRoaXMudmVyaWZ5UGFydGljaXBhbnQodXNlcklkLCBjb252ZXJzYXRpb25JZCk7XG5cbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCB0aGlzLnByaXNtYS5tZXNzYWdlLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgICBpc0RlbGV0ZWQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgc2VuZGVyOiB7XG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHJlcGx5VG86IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBzZW5kZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICByZWFjdGlvbnM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVhZFJlY2VpcHRzOiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgc2tpcCxcbiAgICAgIHRha2U6IGxpbWl0LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1lc3NhZ2VzLnJldmVyc2UoKTsgLy8gUmV0dXJuIGluIGNocm9ub2xvZ2ljYWwgb3JkZXJcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZU1lc3NhZ2UoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICAgdXBkYXRlTWVzc2FnZUR0bzogVXBkYXRlTWVzc2FnZUR0byxcbiAgKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGF3YWl0IHRoaXMucHJpc21hLm1lc3NhZ2UuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVzc2FnZUlkIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIW1lc3NhZ2UpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignTWVzc2FnZSBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICBpZiAobWVzc2FnZS5zZW5kZXJJZCAhPT0gdXNlcklkKSB7XG4gICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdZb3UgY2FuIG9ubHkgZWRpdCB5b3VyIG93biBtZXNzYWdlcycpO1xuICAgIH1cblxuICAgIGlmIChtZXNzYWdlLmlzRGVsZXRlZCkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0Nhbm5vdCBlZGl0IGRlbGV0ZWQgbWVzc2FnZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWRNZXNzYWdlID0gYXdhaXQgdGhpcy5wcmlzbWEubWVzc2FnZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lc3NhZ2VJZCB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBjb250ZW50OiB1cGRhdGVNZXNzYWdlRHRvLmNvbnRlbnQsXG4gICAgICAgIGlzRWRpdGVkOiB0cnVlLFxuICAgICAgICBlZGl0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHNlbmRlcjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICByZWFjdGlvbnM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdXBkYXRlZE1lc3NhZ2U7XG4gIH1cblxuICBhc3luYyBkZWxldGVNZXNzYWdlKHVzZXJJZDogc3RyaW5nLCBtZXNzYWdlSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCB0aGlzLnByaXNtYS5tZXNzYWdlLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lc3NhZ2VJZCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFtZXNzYWdlKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ01lc3NhZ2Ugbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgaWYgKG1lc3NhZ2Uuc2VuZGVySWQgIT09IHVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignWW91IGNhbiBvbmx5IGRlbGV0ZSB5b3VyIG93biBtZXNzYWdlcycpO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMucHJpc21hLm1lc3NhZ2UudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBtZXNzYWdlSWQgfSxcbiAgICAgIGRhdGE6IHsgaXNEZWxldGVkOiB0cnVlIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gIH1cblxuICAvLyBSZWFkIFJlY2VpcHRzXG4gIGFzeW5jIG1hcmtNZXNzYWdlQXNSZWFkKHVzZXJJZDogc3RyaW5nLCBtZXNzYWdlSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCB0aGlzLnByaXNtYS5tZXNzYWdlLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lc3NhZ2VJZCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFtZXNzYWdlKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ01lc3NhZ2Ugbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gRG9uJ3QgY3JlYXRlIHJlYWQgcmVjZWlwdCBmb3Igb3duIG1lc3NhZ2VzXG4gICAgaWYgKG1lc3NhZ2Uuc2VuZGVySWQgPT09IHVzZXJJZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSB1c2VyIGlzIHBhcnRpY2lwYW50IGluIGNvbnZlcnNhdGlvblxuICAgIGF3YWl0IHRoaXMudmVyaWZ5UGFydGljaXBhbnQodXNlcklkLCBtZXNzYWdlLmNvbnZlcnNhdGlvbklkKTtcblxuICAgIGF3YWl0IHRoaXMucHJpc21hLm1lc3NhZ2VSZWFkUmVjZWlwdC51cHNlcnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgbWVzc2FnZUlkX3VzZXJJZDoge1xuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgY3JlYXRlOiB7XG4gICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgfSxcbiAgICAgIHVwZGF0ZToge1xuICAgICAgICByZWFkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVXBkYXRlIHBhcnRpY2lwYW50J3MgbGFzdFJlYWRBdFxuICAgIGF3YWl0IHRoaXMucHJpc21hLmNvbnZlcnNhdGlvblBhcnRpY2lwYW50LnVwZGF0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IG1lc3NhZ2UuY29udmVyc2F0aW9uSWQsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGxhc3RSZWFkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gUHVibGlzaCBtZXNzYWdlIHJlYWQgZXZlbnRcbiAgICBhd2FpdCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICBuZXcgTWVzc2FnZVJlYWRFdmVudCh7XG4gICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgcmVhZEJ5OiB1c2VySWQsXG4gICAgICAgIHJlYWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IG1lc3NhZ2UuY29udmVyc2F0aW9uSWQsXG4gICAgICAgIG1lc3NhZ2VzU2luY2VMYXN0UmVhZDogMSwgLy8gQ291bGQgYmUgZW5oYW5jZWQgdG8gY2FsY3VsYXRlIGFjdHVhbCBjb3VudFxuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIC8vIE1lc3NhZ2UgUmVhY3Rpb25zXG4gIGFzeW5jIGFkZE1lc3NhZ2VSZWFjdGlvbih1c2VySWQ6IHN0cmluZywgbWVzc2FnZUlkOiBzdHJpbmcsIGVtb2ppOiBzdHJpbmcpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgdGhpcy5wcmlzbWEubWVzc2FnZS5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBtZXNzYWdlSWQgfSxcbiAgICB9KTtcblxuICAgIGlmICghbWVzc2FnZSkge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZXNzYWdlIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSB1c2VyIGlzIHBhcnRpY2lwYW50IGluIGNvbnZlcnNhdGlvblxuICAgIGF3YWl0IHRoaXMudmVyaWZ5UGFydGljaXBhbnQodXNlcklkLCBtZXNzYWdlLmNvbnZlcnNhdGlvbklkKTtcblxuICAgIGNvbnN0IHJlYWN0aW9uID0gYXdhaXQgdGhpcy5wcmlzbWEubWVzc2FnZVJlYWN0aW9uLnVwc2VydCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBtZXNzYWdlSWRfdXNlcklkX2Vtb2ppOiB7XG4gICAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBlbW9qaSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBjcmVhdGU6IHtcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGVtb2ppLFxuICAgICAgfSxcbiAgICAgIHVwZGF0ZToge1xuICAgICAgICBlbW9qaSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVhY3Rpb247XG4gIH1cblxuICBhc3luYyByZW1vdmVNZXNzYWdlUmVhY3Rpb24oXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICAgZW1vamk6IHN0cmluZyxcbiAgKSB7XG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVzc2FnZVJlYWN0aW9uLmRlbGV0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGVtb2ppLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgfVxuXG4gIC8vIFVzZXIgQmxvY2tpbmdcbiAgYXN5bmMgYmxvY2tVc2VyKGJsb2NrZXJJZDogc3RyaW5nLCBibG9ja2VkSWQ6IHN0cmluZywgcmVhc29uPzogc3RyaW5nKSB7XG4gICAgaWYgKGJsb2NrZXJJZCA9PT0gYmxvY2tlZElkKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignQ2Fubm90IGJsb2NrIHlvdXJzZWxmJyk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEudXNlckJsb2NrLnVwc2VydCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBibG9ja2VySWRfYmxvY2tlZElkOiB7XG4gICAgICAgICAgYmxvY2tlcklkLFxuICAgICAgICAgIGJsb2NrZWRJZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBjcmVhdGU6IHtcbiAgICAgICAgYmxvY2tlcklkLFxuICAgICAgICBibG9ja2VkSWQsXG4gICAgICAgIHJlYXNvbixcbiAgICAgIH0sXG4gICAgICB1cGRhdGU6IHtcbiAgICAgICAgcmVhc29uLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgfVxuXG4gIGFzeW5jIHVuYmxvY2tVc2VyKGJsb2NrZXJJZDogc3RyaW5nLCBibG9ja2VkSWQ6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLnVzZXJCbG9jay5kZWxldGVNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGJsb2NrZXJJZCxcbiAgICAgICAgYmxvY2tlZElkLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgfVxuXG4gIC8vIEhlbHBlciBNZXRob2RzXG4gIHByaXZhdGUgYXN5bmMgZmluZERpcmVjdENvbnZlcnNhdGlvbih1c2VyMUlkOiBzdHJpbmcsIHVzZXIySWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnByaXNtYS5jb252ZXJzYXRpb24uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHR5cGU6IENvbnZlcnNhdGlvblR5cGUuRElSRUNULFxuICAgICAgICBwYXJ0aWNpcGFudHM6IHtcbiAgICAgICAgICBldmVyeToge1xuICAgICAgICAgICAgdXNlcklkOiB7IGluOiBbdXNlcjFJZCwgdXNlcjJJZF0gfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgcGFydGljaXBhbnRzOiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB2ZXJpZnlQYXJ0aWNpcGFudCh1c2VySWQ6IHN0cmluZywgY29udmVyc2F0aW9uSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHBhcnRpY2lwYW50ID0gYXdhaXQgdGhpcy5wcmlzbWEuY29udmVyc2F0aW9uUGFydGljaXBhbnQuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBjb252ZXJzYXRpb25JZF91c2VySWQ6IHtcbiAgICAgICAgICBjb252ZXJzYXRpb25JZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFwYXJ0aWNpcGFudCB8fCAhcGFydGljaXBhbnQuaXNBY3RpdmUpIHtcbiAgICAgIHRocm93IG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oXG4gICAgICAgICdZb3UgYXJlIG5vdCBhIHBhcnRpY2lwYW50IGluIHRoaXMgY29udmVyc2F0aW9uJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnRpY2lwYW50O1xuICB9XG5cbiAgLy8gU2VhcmNoIE1lc3NhZ2VzXG4gIGFzeW5jIHNlYXJjaE1lc3NhZ2VzKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHF1ZXJ5OiBzdHJpbmcsXG4gICAgY29udmVyc2F0aW9uSWQ/OiBzdHJpbmcsXG4gICAgcGFnZSA9IDEsXG4gICAgbGltaXQgPSAyMCxcbiAgKSB7XG4gICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgIGNvbnN0IHdoZXJlQ2xhdXNlOiBhbnkgPSB7XG4gICAgICBjb250ZW50OiB7XG4gICAgICAgIGNvbnRhaW5zOiBxdWVyeSxcbiAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgIH0sXG4gICAgICBpc0RlbGV0ZWQ6IGZhbHNlLFxuICAgICAgY29udmVyc2F0aW9uOiB7XG4gICAgICAgIHBhcnRpY2lwYW50czoge1xuICAgICAgICAgIHNvbWU6IHtcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBpZiAoY29udmVyc2F0aW9uSWQpIHtcbiAgICAgIHdoZXJlQ2xhdXNlLmNvbnZlcnNhdGlvbklkID0gY29udmVyc2F0aW9uSWQ7XG4gICAgfVxuXG4gICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCB0aGlzLnByaXNtYS5tZXNzYWdlLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgc2VuZGVyOiB7XG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnZlcnNhdGlvbjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICBza2lwLFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gbWVzc2FnZXM7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==