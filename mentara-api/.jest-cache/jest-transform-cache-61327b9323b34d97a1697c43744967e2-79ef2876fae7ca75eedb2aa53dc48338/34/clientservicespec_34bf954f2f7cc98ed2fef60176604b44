68c716d4ca951fe592f51b8a98ae8d63
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const client_service_1 = require("./client.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const library_1 = require("@prisma/client/runtime/library");
describe('ClientService', () => {
    let service;
    let prismaService;
    const mockClient = {
        id: 'client-123',
        userId: 'user-123',
        hasSeenTherapistRecommendations: false,
        createdAt: new Date(),
        updatedAt: new Date(),
        user: {
            id: 'user-123',
            email: 'test@example.com',
            firstName: 'John',
            lastName: 'Doe',
            role: 'client',
        },
    };
    const mockTherapist = {
        userId: 'therapist-user-123',
        hourlyRate: 150,
        areasOfExpertise: ['Anxiety', 'Depression'],
        yearsOfExperience: 5,
        province: 'Metro Manila',
        status: 'approved',
        user: {
            id: 'therapist-user-123',
            email: 'therapist@example.com',
            firstName: 'Dr. Jane',
            lastName: 'Smith',
            role: 'therapist',
            title: 'Clinical Psychologist',
            bio: 'Experienced therapist specializing in anxiety and depression.',
            profileImage: 'https://example.com/profile.jpg',
        },
    };
    beforeEach(async () => {
        const mockPrismaService = {
            client: {
                findUnique: jest.fn(),
                update: jest.fn(),
            },
            clientTherapist: {
                findFirst: jest.fn(),
            },
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                client_service_1.ClientService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrismaService,
                },
            ],
        }).compile();
        service = module.get(client_service_1.ClientService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('getProfile', () => {
        it('should return client profile successfully', async () => {
            prismaService.client.findUnique.mockResolvedValue(mockClient);
            const result = await service.getProfile('user-123');
            expect(result).toEqual(mockClient);
            expect(prismaService.client.findUnique).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                include: { user: true },
            });
        });
        it('should throw NotFoundException when client not found', async () => {
            prismaService.client.findUnique.mockResolvedValue(null);
            await expect(service.getProfile('nonexistent-user')).rejects.toThrow(common_1.NotFoundException);
            expect(prismaService.client.findUnique).toHaveBeenCalledWith({
                where: { userId: 'nonexistent-user' },
                include: { user: true },
            });
        });
        it('should throw InternalServerErrorException on database error', async () => {
            const dbError = new library_1.PrismaClientKnownRequestError('Database error', {
                code: 'P2002',
                clientVersion: '4.0.0',
            });
            prismaService.client.findUnique.mockRejectedValue(dbError);
            await expect(service.getProfile('user-123')).rejects.toThrow(common_1.InternalServerErrorException);
        });
        it('should throw InternalServerErrorException on unexpected error', async () => {
            prismaService.client.findUnique.mockRejectedValue(new Error('Unexpected error'));
            await expect(service.getProfile('user-123')).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('updateProfile', () => {
        const updateData = {
            email: 'updated@example.com',
            firstName: 'UpdatedName',
            middleName: 'UpdatedMiddle',
            lastName: 'UpdatedLastName',
            birthDate: '1990-01-01',
            address: '123 Updated St',
            avatarUrl: 'https://example.com/avatar.jpg',
            role: 'client',
            bio: 'Updated bio',
            coverImageUrl: 'https://example.com/cover.jpg',
            isActive: true,
        };
        it('should update client profile successfully', async () => {
            const updatedClient = {
                ...mockClient,
                user: { ...mockClient.user, ...updateData },
            };
            prismaService.client.update.mockResolvedValue(updatedClient);
            const result = await service.updateProfile('user-123', updateData);
            expect(result).toEqual(updatedClient);
            expect(prismaService.client.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: {
                    user: {
                        update: updateData,
                    },
                },
                include: { user: true },
            });
        });
        it('should throw NotFoundException when client not found for update', async () => {
            const dbError = new library_1.PrismaClientKnownRequestError('Record not found', {
                code: 'P2025',
                clientVersion: '4.0.0',
            });
            prismaService.client.update.mockRejectedValue(dbError);
            await expect(service.updateProfile('nonexistent-user', updateData)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw BadRequestException on unique constraint violation', async () => {
            const dbError = new library_1.PrismaClientKnownRequestError('Unique constraint violation', {
                code: 'P2002',
                clientVersion: '4.0.0',
            });
            prismaService.client.update.mockRejectedValue(dbError);
            await expect(service.updateProfile('user-123', updateData)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should throw InternalServerErrorException on other database errors', async () => {
            const dbError = new library_1.PrismaClientKnownRequestError('Other database error', {
                code: 'P2001',
                clientVersion: '4.0.0',
            });
            prismaService.client.update.mockRejectedValue(dbError);
            await expect(service.updateProfile('user-123', updateData)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('needsTherapistRecommendations', () => {
        it('should return true when client has not seen recommendations', async () => {
            prismaService.client.findUnique.mockResolvedValue({
                hasSeenTherapistRecommendations: false,
            });
            const result = await service.needsTherapistRecommendations('user-123');
            expect(result).toBe(true);
            expect(prismaService.client.findUnique).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                select: { hasSeenTherapistRecommendations: true },
            });
        });
        it('should return false when client has seen recommendations', async () => {
            prismaService.client.findUnique.mockResolvedValue({
                hasSeenTherapistRecommendations: true,
            });
            const result = await service.needsTherapistRecommendations('user-123');
            expect(result).toBe(false);
        });
        it('should return true when client not found', async () => {
            prismaService.client.findUnique.mockResolvedValue(null);
            const result = await service.needsTherapistRecommendations('user-123');
            expect(result).toBe(true);
        });
        it('should throw InternalServerErrorException on database error', async () => {
            prismaService.client.findUnique.mockRejectedValue(new Error('Database error'));
            await expect(service.needsTherapistRecommendations('user-123')).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('markTherapistRecommendationsSeen', () => {
        it('should mark recommendations as seen successfully', async () => {
            const updatedClient = {
                ...mockClient,
                hasSeenTherapistRecommendations: true,
            };
            prismaService.client.update.mockResolvedValue(updatedClient);
            await service.markTherapistRecommendationsSeen('user-123');
            expect(prismaService.client.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: { hasSeenTherapistRecommendations: true },
            });
        });
        it('should throw NotFoundException when client not found', async () => {
            const dbError = new library_1.PrismaClientKnownRequestError('Record not found', {
                code: 'P2025',
                clientVersion: '4.0.0',
            });
            prismaService.client.update.mockRejectedValue(dbError);
            await expect(service.markTherapistRecommendationsSeen('nonexistent-user')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw InternalServerErrorException on other errors', async () => {
            prismaService.client.update.mockRejectedValue(new Error('Unexpected error'));
            await expect(service.markTherapistRecommendationsSeen('user-123')).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('getAssignedTherapist', () => {
        it('should return assigned therapist successfully', async () => {
            const mockAssignment = {
                therapist: mockTherapist,
            };
            prismaService.clientTherapist.findFirst.mockResolvedValue(mockAssignment);
            const result = await service.getAssignedTherapist('user-123');
            expect(result).toEqual({
                id: mockTherapist.userId,
                firstName: mockTherapist.user.firstName,
                lastName: mockTherapist.user.lastName,
                title: mockTherapist.user.title,
                specialties: mockTherapist.areasOfExpertise,
                hourlyRate: Number(mockTherapist.hourlyRate),
                experience: mockTherapist.yearsOfExperience,
                province: mockTherapist.province,
                isActive: mockTherapist.status === 'approved',
                bio: mockTherapist.user.bio,
                profileImage: mockTherapist.user.profileImage,
            });
            expect(prismaService.clientTherapist.findFirst).toHaveBeenCalledWith({
                where: {
                    clientId: 'user-123',
                    status: 'active',
                },
                include: {
                    therapist: {
                        include: { user: true },
                    },
                },
                orderBy: { assignedAt: 'desc' },
            });
        });
        it('should return null when no active assignment found', async () => {
            prismaService.clientTherapist.findFirst.mockResolvedValue(null);
            const result = await service.getAssignedTherapist('user-123');
            expect(result).toBeNull();
        });
        it('should return null when assignment has no therapist', async () => {
            prismaService.clientTherapist.findFirst.mockResolvedValue({
                therapist: null,
            });
            const result = await service.getAssignedTherapist('user-123');
            expect(result).toBeNull();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NsaWVudC9jbGllbnQuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDJDQUl3QjtBQUN4QixxREFBaUQ7QUFDakQsZ0ZBQW9FO0FBQ3BFLDREQUErRTtBQUUvRSxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUM3QixJQUFJLE9BQXNCLENBQUM7SUFDM0IsSUFBSSxhQUF5QyxDQUFDO0lBRTlDLE1BQU0sVUFBVSxHQUFHO1FBQ2pCLEVBQUUsRUFBRSxZQUFZO1FBQ2hCLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLCtCQUErQixFQUFFLEtBQUs7UUFDdEMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtRQUNyQixJQUFJLEVBQUU7WUFDSixFQUFFLEVBQUUsVUFBVTtZQUNkLEtBQUssRUFBRSxrQkFBa0I7WUFDekIsU0FBUyxFQUFFLE1BQU07WUFDakIsUUFBUSxFQUFFLEtBQUs7WUFDZixJQUFJLEVBQUUsUUFBUTtTQUNmO0tBQ0YsQ0FBQztJQUVGLE1BQU0sYUFBYSxHQUFHO1FBQ3BCLE1BQU0sRUFBRSxvQkFBb0I7UUFDNUIsVUFBVSxFQUFFLEdBQUc7UUFDZixnQkFBZ0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUM7UUFDM0MsaUJBQWlCLEVBQUUsQ0FBQztRQUNwQixRQUFRLEVBQUUsY0FBYztRQUN4QixNQUFNLEVBQUUsVUFBVTtRQUNsQixJQUFJLEVBQUU7WUFDSixFQUFFLEVBQUUsb0JBQW9CO1lBQ3hCLEtBQUssRUFBRSx1QkFBdUI7WUFDOUIsU0FBUyxFQUFFLFVBQVU7WUFDckIsUUFBUSxFQUFFLE9BQU87WUFDakIsSUFBSSxFQUFFLFdBQVc7WUFDakIsS0FBSyxFQUFFLHVCQUF1QjtZQUM5QixHQUFHLEVBQUUsK0RBQStEO1lBQ3BFLFlBQVksRUFBRSxp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TyxFQUFFO29CQUNQLFNBQVMsRUFBRTt3QkFDVCxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFO3FCQUN4QjtpQkFDRjtnQkFDRCxPQUFPLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFO2FBQ2hDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9EQUFvRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLGFBQWEsQ0FBQyxlQUFlLENBQUMsU0FBdUIsQ0FBQyxpQkFBaUIsQ0FDdEUsSUFBSSxDQUNMLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEUsYUFBYSxDQUFDLGVBQWUsQ0FBQyxTQUF1QixDQUFDLGlCQUFpQixDQUFDO2dCQUN2RSxTQUFTLEVBQUUsSUFBSTthQUNoQixDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9jbGllbnQvY2xpZW50LnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7XG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBDbGllbnRTZXJ2aWNlIH0gZnJvbSAnLi9jbGllbnQuc2VydmljZSc7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50S25vd25SZXF1ZXN0RXJyb3IgfSBmcm9tICdAcHJpc21hL2NsaWVudC9ydW50aW1lL2xpYnJhcnknO1xuXG5kZXNjcmliZSgnQ2xpZW50U2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IENsaWVudFNlcnZpY2U7XG4gIGxldCBwcmlzbWFTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxQcmlzbWFTZXJ2aWNlPjtcblxuICBjb25zdCBtb2NrQ2xpZW50ID0ge1xuICAgIGlkOiAnY2xpZW50LTEyMycsXG4gICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IGZhbHNlLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdXNlcjoge1xuICAgICAgaWQ6ICd1c2VyLTEyMycsXG4gICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgZmlyc3ROYW1lOiAnSm9obicsXG4gICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICByb2xlOiAnY2xpZW50JyxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IG1vY2tUaGVyYXBpc3QgPSB7XG4gICAgdXNlcklkOiAndGhlcmFwaXN0LXVzZXItMTIzJyxcbiAgICBob3VybHlSYXRlOiAxNTAsXG4gICAgYXJlYXNPZkV4cGVydGlzZTogWydBbnhpZXR5JywgJ0RlcHJlc3Npb24nXSxcbiAgICB5ZWFyc09mRXhwZXJpZW5jZTogNSxcbiAgICBwcm92aW5jZTogJ01ldHJvIE1hbmlsYScsXG4gICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgIHVzZXI6IHtcbiAgICAgIGlkOiAndGhlcmFwaXN0LXVzZXItMTIzJyxcbiAgICAgIGVtYWlsOiAndGhlcmFwaXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIGZpcnN0TmFtZTogJ0RyLiBKYW5lJyxcbiAgICAgIGxhc3ROYW1lOiAnU21pdGgnLFxuICAgICAgcm9sZTogJ3RoZXJhcGlzdCcsXG4gICAgICB0aXRsZTogJ0NsaW5pY2FsIFBzeWNob2xvZ2lzdCcsXG4gICAgICBiaW86ICdFeHBlcmllbmNlZCB0aGVyYXBpc3Qgc3BlY2lhbGl6aW5nIGluIGFueGlldHkgYW5kIGRlcHJlc3Npb24uJyxcbiAgICAgIHByb2ZpbGVJbWFnZTogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcHJvZmlsZS5qcGcnLFxuICAgIH0sXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1ByaXNtYVNlcnZpY2UgPSB7XG4gICAgICBjbGllbnQ6IHtcbiAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIH0sXG4gICAgICBjbGllbnRUaGVyYXBpc3Q6IHtcbiAgICAgICAgZmluZEZpcnN0OiBqZXN0LmZuKCksXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIENsaWVudFNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUHJpc21hU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8Q2xpZW50U2VydmljZT4oQ2xpZW50U2VydmljZSk7XG4gICAgcHJpc21hU2VydmljZSA9IG1vZHVsZS5nZXQoUHJpc21hU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQcm9maWxlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNsaWVudCBwcm9maWxlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDbGllbnQsXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFByb2ZpbGUoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NsaWVudCk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5jbGllbnQuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6ICd1c2VyLTEyMycgfSxcbiAgICAgICAgaW5jbHVkZTogeyB1c2VyOiB0cnVlIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBjbGllbnQgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY2xpZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2V0UHJvZmlsZSgnbm9uZXhpc3RlbnQtdXNlcicpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmNsaWVudC5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ25vbmV4aXN0ZW50LXVzZXInIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24gb24gZGF0YWJhc2UgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYkVycm9yID0gbmV3IFByaXNtYUNsaWVudEtub3duUmVxdWVzdEVycm9yKCdEYXRhYmFzZSBlcnJvcicsIHtcbiAgICAgICAgY29kZTogJ1AyMDAyJyxcbiAgICAgICAgY2xpZW50VmVyc2lvbjogJzQuMC4wJyxcbiAgICAgIH0pO1xuICAgICAgKHByaXNtYVNlcnZpY2UuY2xpZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2V0UHJvZmlsZSgndXNlci0xMjMnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiBvbiB1bmV4cGVjdGVkIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY2xpZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdVbmV4cGVjdGVkIGVycm9yJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5nZXRQcm9maWxlKCd1c2VyLTEyMycpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlUHJvZmlsZScsICgpID0+IHtcbiAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgZW1haWw6ICd1cGRhdGVkQGV4YW1wbGUuY29tJyxcbiAgICAgIGZpcnN0TmFtZTogJ1VwZGF0ZWROYW1lJyxcbiAgICAgIG1pZGRsZU5hbWU6ICdVcGRhdGVkTWlkZGxlJyxcbiAgICAgIGxhc3ROYW1lOiAnVXBkYXRlZExhc3ROYW1lJyxcbiAgICAgIGJpcnRoRGF0ZTogJzE5OTAtMDEtMDEnLFxuICAgICAgYWRkcmVzczogJzEyMyBVcGRhdGVkIFN0JyxcbiAgICAgIGF2YXRhclVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vYXZhdGFyLmpwZycsXG4gICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgIGJpbzogJ1VwZGF0ZWQgYmlvJyxcbiAgICAgIGNvdmVySW1hZ2VVcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2NvdmVyLmpwZycsXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgY2xpZW50IHByb2ZpbGUgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlZENsaWVudCA9IHtcbiAgICAgICAgLi4ubW9ja0NsaWVudCxcbiAgICAgICAgdXNlcjogeyAuLi5tb2NrQ2xpZW50LnVzZXIsIC4uLnVwZGF0ZURhdGEgfSxcbiAgICAgIH07XG4gICAgICAocHJpc21hU2VydmljZS5jbGllbnQudXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIHVwZGF0ZWRDbGllbnQsXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwZGF0ZVByb2ZpbGUoJ3VzZXItMTIzJywgdXBkYXRlRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZENsaWVudCk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5jbGllbnQudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVEYXRhLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gY2xpZW50IG5vdCBmb3VuZCBmb3IgdXBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGJFcnJvciA9IG5ldyBQcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvcignUmVjb3JkIG5vdCBmb3VuZCcsIHtcbiAgICAgICAgY29kZTogJ1AyMDI1JyxcbiAgICAgICAgY2xpZW50VmVyc2lvbjogJzQuMC4wJyxcbiAgICAgIH0pO1xuICAgICAgKHByaXNtYVNlcnZpY2UuY2xpZW50LnVwZGF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKGRiRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UudXBkYXRlUHJvZmlsZSgnbm9uZXhpc3RlbnQtdXNlcicsIHVwZGF0ZURhdGEpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIG9uIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRiRXJyb3IgPSBuZXcgUHJpc21hQ2xpZW50S25vd25SZXF1ZXN0RXJyb3IoXG4gICAgICAgICdVbmlxdWUgY29uc3RyYWludCB2aW9sYXRpb24nLFxuICAgICAgICB7XG4gICAgICAgICAgY29kZTogJ1AyMDAyJyxcbiAgICAgICAgICBjbGllbnRWZXJzaW9uOiAnNC4wLjAnLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudC51cGRhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnVwZGF0ZVByb2ZpbGUoJ3VzZXItMTIzJywgdXBkYXRlRGF0YSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiBvbiBvdGhlciBkYXRhYmFzZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYkVycm9yID0gbmV3IFByaXNtYUNsaWVudEtub3duUmVxdWVzdEVycm9yKFxuICAgICAgICAnT3RoZXIgZGF0YWJhc2UgZXJyb3InLFxuICAgICAgICB7XG4gICAgICAgICAgY29kZTogJ1AyMDAxJyxcbiAgICAgICAgICBjbGllbnRWZXJzaW9uOiAnNC4wLjAnLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudC51cGRhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnVwZGF0ZVByb2ZpbGUoJ3VzZXItMTIzJywgdXBkYXRlRGF0YSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ25lZWRzVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgd2hlbiBjbGllbnQgaGFzIG5vdCBzZWVuIHJlY29tbWVuZGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiBmYWxzZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLm5lZWRzVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY2xpZW50LmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIHNlbGVjdDogeyBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gY2xpZW50IGhhcyBzZWVuIHJlY29tbWVuZGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubmVlZHNUaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIGNsaWVudCBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAocHJpc21hU2VydmljZS5jbGllbnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLm5lZWRzVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uIG9uIGRhdGFiYXNlIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY2xpZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLm5lZWRzVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXJrVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zU2VlbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgcmVjb21tZW5kYXRpb25zIGFzIHNlZW4gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlZENsaWVudCA9IHtcbiAgICAgICAgLi4ubW9ja0NsaWVudCxcbiAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogdHJ1ZSxcbiAgICAgIH07XG4gICAgICAocHJpc21hU2VydmljZS5jbGllbnQudXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIHVwZGF0ZWRDbGllbnQsXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLm1hcmtUaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnNTZWVuKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5jbGllbnQudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiB7IGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IHRydWUgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiB3aGVuIGNsaWVudCBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYkVycm9yID0gbmV3IFByaXNtYUNsaWVudEtub3duUmVxdWVzdEVycm9yKCdSZWNvcmQgbm90IGZvdW5kJywge1xuICAgICAgICBjb2RlOiAnUDIwMjUnLFxuICAgICAgICBjbGllbnRWZXJzaW9uOiAnNC4wLjAnLFxuICAgICAgfSk7XG4gICAgICAocHJpc21hU2VydmljZS5jbGllbnQudXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoZGJFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5tYXJrVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zU2Vlbignbm9uZXhpc3RlbnQtdXNlcicpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uIG9uIG90aGVyIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudC51cGRhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdVbmV4cGVjdGVkIGVycm9yJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UubWFya1RoZXJhcGlzdFJlY29tbWVuZGF0aW9uc1NlZW4oJ3VzZXItMTIzJyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEFzc2lnbmVkVGhlcmFwaXN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFzc2lnbmVkIHRoZXJhcGlzdCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQXNzaWdubWVudCA9IHtcbiAgICAgICAgdGhlcmFwaXN0OiBtb2NrVGhlcmFwaXN0LFxuICAgICAgfTtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdC5maW5kRmlyc3QgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0Fzc2lnbm1lbnQsXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldEFzc2lnbmVkVGhlcmFwaXN0KCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgaWQ6IG1vY2tUaGVyYXBpc3QudXNlcklkLFxuICAgICAgICBmaXJzdE5hbWU6IG1vY2tUaGVyYXBpc3QudXNlci5maXJzdE5hbWUsXG4gICAgICAgIGxhc3ROYW1lOiBtb2NrVGhlcmFwaXN0LnVzZXIubGFzdE5hbWUsXG4gICAgICAgIHRpdGxlOiBtb2NrVGhlcmFwaXN0LnVzZXIudGl0bGUsXG4gICAgICAgIHNwZWNpYWx0aWVzOiBtb2NrVGhlcmFwaXN0LmFyZWFzT2ZFeHBlcnRpc2UsXG4gICAgICAgIGhvdXJseVJhdGU6IE51bWJlcihtb2NrVGhlcmFwaXN0LmhvdXJseVJhdGUpLFxuICAgICAgICBleHBlcmllbmNlOiBtb2NrVGhlcmFwaXN0LnllYXJzT2ZFeHBlcmllbmNlLFxuICAgICAgICBwcm92aW5jZTogbW9ja1RoZXJhcGlzdC5wcm92aW5jZSxcbiAgICAgICAgaXNBY3RpdmU6IG1vY2tUaGVyYXBpc3Quc3RhdHVzID09PSAnYXBwcm92ZWQnLFxuICAgICAgICBiaW86IG1vY2tUaGVyYXBpc3QudXNlci5iaW8sXG4gICAgICAgIHByb2ZpbGVJbWFnZTogbW9ja1RoZXJhcGlzdC51c2VyLnByb2ZpbGVJbWFnZSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0LmZpbmRGaXJzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNsaWVudElkOiAndXNlci0xMjMnLFxuICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgYXNzaWduZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBubyBhY3RpdmUgYXNzaWdubWVudCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdC5maW5kRmlyc3QgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbnVsbCxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0QXNzaWduZWRUaGVyYXBpc3QoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gYXNzaWdubWVudCBoYXMgbm8gdGhlcmFwaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0LmZpbmRGaXJzdCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgdGhlcmFwaXN0OiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0QXNzaWduZWRUaGVyYXBpc3QoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=