{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/controllers/enhanced-community.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/controllers/enhanced-community.controller.spec.ts"],"sourcesContent":["/**\n * Comprehensive Test Suite for EnhancedCommunityController\n * Tests advanced community search, discovery, and management features\n */\n\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { HttpException, HttpStatus, ValidationPipe } from '@nestjs/common';\nimport { EnhancedCommunityController } from './enhanced-community.controller';\nimport { EnhancedCommunityService } from '../services/enhanced-community.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { RoleBasedAccessGuard } from '../../auth/guards/role-based-access.guard';\nimport { SecurityGuardTestUtils, RoleBasedTestUtils } from '../../test-utils/auth-testing-helpers';\nimport { MockBuilder, TestDataGenerator, TestAssertions } from '../../test-utils/enhanced-test-helpers';\nimport { TEST_USER_IDS, TEST_EMAILS } from '../../test-utils/index';\n\ndescribe('EnhancedCommunityController', () => {\n  let controller: EnhancedCommunityController;\n  let enhancedCommunityService: EnhancedCommunityService;\n  let module: TestingModule;\n\n  // Mock EnhancedCommunityService\n  const mockEnhancedCommunityService = {\n    searchCommunities: jest.fn(),\n    getCommunityDetails: jest.fn(),\n    getTrendingCommunities: jest.fn(),\n    getSimilarCommunities: jest.fn(),\n    // Prisma mock for direct database access\n    prisma: {\n      membership: {\n        findMany: jest.fn(),\n      },\n      community: {\n        count: jest.fn(),\n      },\n    },\n  };\n\n  // Mock Guards\n  const mockJwtAuthGuard = {\n    canActivate: jest.fn().mockReturnValue(true),\n  };\n\n  const mockRoleBasedAccessGuard = {\n    canActivate: jest.fn().mockReturnValue(true),\n  };\n\n  // Test data\n  const mockUser = {\n    id: TEST_USER_IDS.CLIENT,\n    email: TEST_EMAILS.CLIENT,\n    role: 'client',\n  };\n\n  const mockCommunity = {\n    id: 'community_123456789',\n    name: 'Anxiety Support Group',\n    slug: 'anxiety-support-group',\n    description: 'A supportive community for people dealing with anxiety',\n    memberCount: 1234,\n    isPrivate: false,\n    createdAt: new Date('2024-01-15T10:00:00Z'),\n    recentActivity: {\n      lastPostAt: '2024-02-14T09:30:00Z',\n      postsThisWeek: 23,\n      activeMembers: 456,\n    },\n    membershipStatus: 'none',\n    compatibility: {\n      score: 0.85,\n      reasons: ['Interest in anxiety management', 'Similar community preferences'],\n    },\n  };\n\n  const mockSearchResults = {\n    communities: [mockCommunity],\n    total: 1,\n    page: 1,\n    limit: 20,\n    totalPages: 1,\n    facets: {\n      tags: [\n        { tag: 'anxiety', count: 15 },\n        { tag: 'support', count: 23 },\n        { tag: 'therapy', count: 8 },\n      ],\n      memberCountRanges: [\n        { range: '0-100', count: 5 },\n        { range: '100-500', count: 12 },\n        { range: '500+', count: 8 },\n      ],\n    },\n  };\n\n  const mockCommunityDetails = {\n    ...mockCommunity,\n    stats: {\n      totalPosts: 456,\n      totalComments: 1234,\n      activeMembers: 234,\n      recentActivity: {\n        postsToday: 5,\n        postsThisWeek: 23,\n        postsThisMonth: 89,\n      },\n    },\n    recentPosts: [\n      {\n        id: 'post_123',\n        title: 'Managing Work Anxiety',\n        author: 'Anonymous',\n        createdAt: '2024-02-14T08:30:00Z',\n        likesCount: 15,\n        commentsCount: 8,\n      },\n    ],\n    topContributors: [\n      {\n        id: 'user_456',\n        name: 'Sarah M.',\n        postsCount: 45,\n        helpfulVotes: 123,\n      },\n    ],\n    moderators: [\n      {\n        id: 'mod_789',\n        name: 'Dr. Johnson',\n        role: 'moderator',\n      },\n    ],\n    membershipStatus: 'none',\n    userPermissions: {\n      canPost: false,\n      canComment: false,\n      canModerate: false,\n    },\n  };\n\n  const mockTrendingCommunities = [\n    {\n      ...mockCommunity,\n      trendingData: {\n        growthRate: 15.2,\n        activityScore: 89.5,\n        engagementRate: 72.3,\n        retentionRate: 85.7,\n      },\n    },\n  ];\n\n  const mockSimilarCommunities = [\n    {\n      id: 'community_similar_1',\n      name: 'Depression Support',\n      description: 'Support for those dealing with depression',\n      memberCount: 987,\n      similarityScore: 0.78,\n      commonTags: ['support', 'mental-health'],\n    },\n  ];\n\n  beforeEach(async () => {\n    module = await Test.createTestingModule({\n      controllers: [EnhancedCommunityController],\n      providers: [\n        {\n          provide: EnhancedCommunityService,\n          useValue: mockEnhancedCommunityService,\n        },\n      ],\n    })\n      .overrideGuard(JwtAuthGuard)\n      .useValue(mockJwtAuthGuard)\n      .overrideGuard(RoleBasedAccessGuard)\n      .useValue(mockRoleBasedAccessGuard)\n      .compile();\n\n    controller = module.get<EnhancedCommunityController>(EnhancedCommunityController);\n    enhancedCommunityService = module.get<EnhancedCommunityService>(EnhancedCommunityService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Controller Initialization', () => {\n    it('should be defined', () => {\n      expect(controller).toBeDefined();\n    });\n\n    it('should have enhancedCommunityService injected', () => {\n      expect(enhancedCommunityService).toBeDefined();\n    });\n  });\n\n  describe('Security Guards', () => {\n    it('should be protected by JwtAuthGuard and RoleBasedAccessGuard', () => {\n      const guards = Reflect.getMetadata('__guards__', EnhancedCommunityController);\n      expect(guards).toContain(JwtAuthGuard);\n      expect(guards).toContain(RoleBasedAccessGuard);\n    });\n\n    it('should have proper route decorators', () => {\n      const controllerMetadata = Reflect.getMetadata('path', EnhancedCommunityController);\n      expect(controllerMetadata).toBe('communities/enhanced');\n    });\n\n    it('should allow multiple roles for all endpoints', () => {\n      const allowedRoles = ['client', 'therapist', 'moderator', 'admin'];\n      const methods = ['searchCommunities', 'getCommunityDetails', 'getTrendingCommunities', 'getSimilarCommunities'];\n      \n      methods.forEach(method => {\n        const metadata = Reflect.getMetadata('roles', controller[method]);\n        expect(metadata).toEqual(allowedRoles);\n      });\n    });\n  });\n\n  describe('GET /communities/enhanced/search', () => {\n    const validSearchQuery = {\n      query: 'anxiety',\n      tags: ['support', 'therapy'],\n      minMembers: 100,\n      maxMembers: 2000,\n      sortBy: 'relevance' as const,\n      sortOrder: 'desc' as const,\n      hasDescription: true,\n      hasImage: false,\n      membershipRequired: false,\n      page: 1,\n      limit: 20,\n    };\n\n    it('should search communities successfully', async () => {\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n\n      const result = await controller.searchCommunities(validSearchQuery, mockUser);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual(mockSearchResults);\n      expect(result.message).toContain('successfully');\n      expect(enhancedCommunityService.searchCommunities).toHaveBeenCalledWith(\n        {\n          query: validSearchQuery.query,\n          tags: validSearchQuery.tags,\n          minMembers: validSearchQuery.minMembers,\n          maxMembers: validSearchQuery.maxMembers,\n          sortBy: validSearchQuery.sortBy,\n          sortOrder: validSearchQuery.sortOrder,\n          hasDescription: validSearchQuery.hasDescription,\n          hasImage: validSearchQuery.hasImage,\n          membershipRequired: validSearchQuery.membershipRequired,\n        },\n        mockUser.id,\n        validSearchQuery.page,\n        validSearchQuery.limit\n      );\n    });\n\n    it('should handle empty search query', async () => {\n      const emptyQuery = { page: 1, limit: 20 };\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue({\n        ...mockSearchResults,\n        communities: [],\n        total: 0,\n      });\n\n      const result = await controller.searchCommunities(emptyQuery, mockUser);\n\n      expect(result.success).toBe(true);\n      expect(result.data.communities).toEqual([]);\n      expect(result.data.total).toBe(0);\n    });\n\n    it('should handle service errors', async () => {\n      const serviceError = new Error('Search service unavailable');\n      mockEnhancedCommunityService.searchCommunities.mockRejectedValue(serviceError);\n\n      await expect(\n        controller.searchCommunities(validSearchQuery, mockUser)\n      ).rejects.toThrow(serviceError);\n    });\n\n    it('should validate search facets', async () => {\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n\n      const result = await controller.searchCommunities(validSearchQuery, mockUser);\n\n      expect(result.data.facets).toBeDefined();\n      expect(result.data.facets.tags).toBeDefined();\n      expect(Array.isArray(result.data.facets.tags)).toBe(true);\n      expect(result.data.facets.memberCountRanges).toBeDefined();\n      expect(Array.isArray(result.data.facets.memberCountRanges)).toBe(true);\n    });\n\n    it('should handle different sorting options', async () => {\n      const sortByMembers = { ...validSearchQuery, sortBy: 'members' as const };\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n\n      const result = await controller.searchCommunities(sortByMembers, mockUser);\n\n      expect(result.success).toBe(true);\n      expect(enhancedCommunityService.searchCommunities).toHaveBeenCalledWith(\n        expect.objectContaining({ sortBy: 'members' }),\n        mockUser.id,\n        1,\n        20\n      );\n    });\n  });\n\n  describe('GET /communities/enhanced/:communityId/details', () => {\n    it('should get community details successfully', async () => {\n      mockEnhancedCommunityService.getCommunityDetails.mockResolvedValue(mockCommunityDetails);\n\n      const result = await controller.getCommunityDetails('community_123456789', mockUser);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual(mockCommunityDetails);\n      expect(result.message).toContain('successfully');\n      expect(enhancedCommunityService.getCommunityDetails).toHaveBeenCalledWith(\n        'community_123456789',\n        mockUser.id\n      );\n    });\n\n    it('should handle non-existent community', async () => {\n      const notFoundError = new Error('Community not found');\n      mockEnhancedCommunityService.getCommunityDetails.mockRejectedValue(notFoundError);\n\n      await expect(\n        controller.getCommunityDetails('nonexistent_community', mockUser)\n      ).rejects.toThrow(notFoundError);\n    });\n\n    it('should validate community details structure', async () => {\n      mockEnhancedCommunityService.getCommunityDetails.mockResolvedValue(mockCommunityDetails);\n\n      const result = await controller.getCommunityDetails('community_123456789', mockUser);\n\n      expect(result.data).toHaveProperty('id');\n      expect(result.data).toHaveProperty('name');\n      expect(result.data).toHaveProperty('stats');\n      expect(result.data).toHaveProperty('recentPosts');\n      expect(result.data).toHaveProperty('topContributors');\n      expect(result.data).toHaveProperty('moderators');\n      expect(result.data).toHaveProperty('membershipStatus');\n      expect(result.data).toHaveProperty('userPermissions');\n\n      expect(Array.isArray(result.data.recentPosts)).toBe(true);\n      expect(Array.isArray(result.data.topContributors)).toBe(true);\n      expect(Array.isArray(result.data.moderators)).toBe(true);\n    });\n  });\n\n  describe('GET /communities/enhanced/trending', () => {\n    it('should get trending communities successfully', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n\n      const query = { limit: 10, timeframe: 'week' as const };\n      const result = await controller.getTrendingCommunities(query);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual(mockTrendingCommunities);\n      expect(result.message).toContain('successfully');\n      expect(enhancedCommunityService.getTrendingCommunities).toHaveBeenCalledWith(10, 'week');\n    });\n\n    it('should handle default parameters', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n\n      const result = await controller.getTrendingCommunities({});\n\n      expect(result.success).toBe(true);\n      expect(enhancedCommunityService.getTrendingCommunities).toHaveBeenCalledWith(10, 'week');\n    });\n\n    it('should handle different timeframes', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n\n      const monthQuery = { limit: 15, timeframe: 'month' as const };\n      const result = await controller.getTrendingCommunities(monthQuery);\n\n      expect(result.success).toBe(true);\n      expect(enhancedCommunityService.getTrendingCommunities).toHaveBeenCalledWith(15, 'month');\n    });\n\n    it('should validate trending data structure', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n\n      const result = await controller.getTrendingCommunities({ limit: 5 });\n\n      expect(Array.isArray(result.data)).toBe(true);\n      result.data.forEach(community => {\n        expect(community).toHaveProperty('id');\n        expect(community).toHaveProperty('name');\n        expect(community).toHaveProperty('memberCount');\n        expect(community).toHaveProperty('trendingData');\n        expect(community.trendingData).toHaveProperty('growthRate');\n        expect(community.trendingData).toHaveProperty('activityScore');\n        expect(community.trendingData).toHaveProperty('engagementRate');\n        expect(typeof community.trendingData.growthRate).toBe('number');\n      });\n    });\n  });\n\n  describe('GET /communities/enhanced/:communityId/similar', () => {\n    it('should get similar communities successfully', async () => {\n      mockEnhancedCommunityService.getSimilarCommunities.mockResolvedValue(mockSimilarCommunities);\n\n      const query = { excludeJoined: true, maxResults: 5 };\n      const result = await controller.getSimilarCommunities('community_123456789', query, mockUser);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual(mockSimilarCommunities);\n      expect(result.message).toContain('successfully');\n      expect(enhancedCommunityService.getSimilarCommunities).toHaveBeenCalledWith(\n        'community_123456789',\n        {\n          userId: mockUser.id,\n          excludeJoined: true,\n          maxResults: 5,\n        }\n      );\n    });\n\n    it('should handle default parameters', async () => {\n      mockEnhancedCommunityService.getSimilarCommunities.mockResolvedValue(mockSimilarCommunities);\n\n      const result = await controller.getSimilarCommunities('community_123456789', {}, mockUser);\n\n      expect(result.success).toBe(true);\n      expect(enhancedCommunityService.getSimilarCommunities).toHaveBeenCalledWith(\n        'community_123456789',\n        {\n          userId: mockUser.id,\n          excludeJoined: true,\n          maxResults: 5,\n        }\n      );\n    });\n\n    it('should validate similar communities structure', async () => {\n      mockEnhancedCommunityService.getSimilarCommunities.mockResolvedValue(mockSimilarCommunities);\n\n      const result = await controller.getSimilarCommunities('community_123456789', {}, mockUser);\n\n      expect(Array.isArray(result.data)).toBe(true);\n      result.data.forEach(community => {\n        expect(community).toHaveProperty('id');\n        expect(community).toHaveProperty('name');\n        expect(community).toHaveProperty('memberCount');\n        expect(community).toHaveProperty('similarityScore');\n        expect(typeof community.similarityScore).toBe('number');\n        expect(community.similarityScore).toBeGreaterThanOrEqual(0);\n        expect(community.similarityScore).toBeLessThanOrEqual(1);\n      });\n    });\n  });\n\n  describe('GET /communities/enhanced/discover', () => {\n    it('should discover communities successfully', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n      mockEnhancedCommunityService.prisma.membership.findMany.mockResolvedValue([]);\n\n      const result = await controller.discoverCommunities(mockUser, 10);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual(mockTrendingCommunities);\n      expect(result.message).toContain('successfully');\n    });\n\n    it('should filter out user joined communities', async () => {\n      const userMemberships = [{ communityId: mockCommunity.id }];\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n      mockEnhancedCommunityService.prisma.membership.findMany.mockResolvedValue(userMemberships);\n\n      const result = await controller.discoverCommunities(mockUser, 10);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual([]); // Should be filtered out\n    });\n\n    it('should handle default limit', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n      mockEnhancedCommunityService.prisma.membership.findMany.mockResolvedValue([]);\n\n      const result = await controller.discoverCommunities(mockUser);\n\n      expect(result.success).toBe(true);\n      expect(enhancedCommunityService.getTrendingCommunities).toHaveBeenCalledWith(10, 'week');\n    });\n  });\n\n  describe('GET /communities/enhanced/categories', () => {\n    it('should get community categories successfully', async () => {\n      mockEnhancedCommunityService.prisma.community.count.mockResolvedValue(5);\n\n      const result = await controller.getCommunityCategories();\n\n      expect(result.success).toBe(true);\n      expect(result.message).toContain('successfully');\n      expect(Array.isArray(result.data)).toBe(true);\n      expect(result.data.length).toBeGreaterThan(0);\n    });\n\n    it('should validate categories structure', async () => {\n      mockEnhancedCommunityService.prisma.community.count.mockResolvedValue(3);\n\n      const result = await controller.getCommunityCategories();\n\n      result.data.forEach(category => {\n        expect(category).toHaveProperty('id');\n        expect(category).toHaveProperty('name');\n        expect(category).toHaveProperty('description');\n        expect(category).toHaveProperty('icon');\n        expect(category).toHaveProperty('communityCount');\n        expect(typeof category.communityCount).toBe('number');\n      });\n    });\n\n    it('should include predefined categories', async () => {\n      mockEnhancedCommunityService.prisma.community.count.mockResolvedValue(2);\n\n      const result = await controller.getCommunityCategories();\n\n      const categoryIds = result.data.map(cat => cat.id);\n      expect(categoryIds).toContain('depression');\n      expect(categoryIds).toContain('anxiety');\n      expect(categoryIds).toContain('trauma');\n      expect(categoryIds).toContain('general');\n      expect(categoryIds).toContain('wellness');\n    });\n  });\n\n  describe('GET /communities/enhanced/popular', () => {\n    it('should get popular communities successfully', async () => {\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n\n      const result = await controller.getPopularCommunities(mockUser, 10);\n\n      expect(result.success).toBe(true);\n      expect(result.data).toEqual(mockSearchResults.communities);\n      expect(result.message).toContain('successfully');\n      expect(enhancedCommunityService.searchCommunities).toHaveBeenCalledWith(\n        {\n          sortBy: 'members',\n          sortOrder: 'desc',\n        },\n        mockUser.id,\n        1,\n        10\n      );\n    });\n\n    it('should handle default limit', async () => {\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n\n      const result = await controller.getPopularCommunities(mockUser);\n\n      expect(result.success).toBe(true);\n      expect(enhancedCommunityService.searchCommunities).toHaveBeenCalledWith(\n        expect.any(Object),\n        mockUser.id,\n        1,\n        10\n      );\n    });\n  });\n\n  describe('Response Format Validation', () => {\n    it('should return properly formatted search response', async () => {\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n\n      const result = await controller.searchCommunities({ query: 'test' }, mockUser);\n\n      expect(result).toHaveProperty('success');\n      expect(result).toHaveProperty('data');\n      expect(result).toHaveProperty('message');\n      expect(result.success).toBe(true);\n      expect(result.data).toHaveProperty('communities');\n      expect(result.data).toHaveProperty('total');\n      expect(result.data).toHaveProperty('facets');\n      expect(Array.isArray(result.data.communities)).toBe(true);\n    });\n\n    it('should return properly formatted community details', async () => {\n      mockEnhancedCommunityService.getCommunityDetails.mockResolvedValue(mockCommunityDetails);\n\n      const result = await controller.getCommunityDetails('community_123', mockUser);\n\n      expect(result).toHaveProperty('success');\n      expect(result).toHaveProperty('data');\n      expect(result).toHaveProperty('message');\n      expect(result.data).toHaveProperty('stats');\n      expect(result.data).toHaveProperty('recentPosts');\n      expect(result.data).toHaveProperty('userPermissions');\n    });\n\n    it('should return properly formatted trending communities', async () => {\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n\n      const result = await controller.getTrendingCommunities({});\n\n      expect(result).toHaveProperty('success');\n      expect(result).toHaveProperty('data');\n      expect(result).toHaveProperty('message');\n      expect(Array.isArray(result.data)).toBe(true);\n      result.data.forEach(community => {\n        expect(community).toHaveProperty('trendingData');\n        expect(typeof community.trendingData.growthRate).toBe('number');\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle service unavailable scenarios', async () => {\n      const serviceError = new Error('Enhanced community service unavailable');\n      mockEnhancedCommunityService.searchCommunities.mockRejectedValue(serviceError);\n\n      await expect(\n        controller.searchCommunities({ query: 'test' }, mockUser)\n      ).rejects.toThrow(serviceError);\n    });\n\n    it('should handle database connection errors', async () => {\n      const dbError = new Error('Database connection failed');\n      mockEnhancedCommunityService.getCommunityDetails.mockRejectedValue(dbError);\n\n      await expect(\n        controller.getCommunityDetails('community_123', mockUser)\n      ).rejects.toThrow(dbError);\n    });\n\n    it('should handle invalid community IDs', async () => {\n      const invalidIdError = new Error('Invalid community ID format');\n      mockEnhancedCommunityService.getCommunityDetails.mockRejectedValue(invalidIdError);\n\n      await expect(\n        controller.getCommunityDetails('invalid-id', mockUser)\n      ).rejects.toThrow(invalidIdError);\n    });\n  });\n\n  describe('Integration Tests', () => {\n    it('should handle complete community discovery workflow', async () => {\n      // Search communities\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n      const searchResult = await controller.searchCommunities({ query: 'anxiety' }, mockUser);\n      expect(searchResult.data.communities).toHaveLength(1);\n\n      // Get community details\n      mockEnhancedCommunityService.getCommunityDetails.mockResolvedValue(mockCommunityDetails);\n      const detailsResult = await controller.getCommunityDetails(searchResult.data.communities[0].id, mockUser);\n      expect(detailsResult.data.id).toBe(searchResult.data.communities[0].id);\n\n      // Get similar communities\n      mockEnhancedCommunityService.getSimilarCommunities.mockResolvedValue(mockSimilarCommunities);\n      const similarResult = await controller.getSimilarCommunities(searchResult.data.communities[0].id, {}, mockUser);\n      expect(Array.isArray(similarResult.data)).toBe(true);\n\n      // Get trending communities\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n      const trendingResult = await controller.getTrendingCommunities({});\n      expect(Array.isArray(trendingResult.data)).toBe(true);\n    });\n\n    it('should validate role-based access across all endpoints', async () => {\n      // Mock successful responses\n      mockEnhancedCommunityService.searchCommunities.mockResolvedValue(mockSearchResults);\n      mockEnhancedCommunityService.getCommunityDetails.mockResolvedValue(mockCommunityDetails);\n      mockEnhancedCommunityService.getTrendingCommunities.mockResolvedValue(mockTrendingCommunities);\n      mockEnhancedCommunityService.getSimilarCommunities.mockResolvedValue(mockSimilarCommunities);\n      mockEnhancedCommunityService.prisma.membership.findMany.mockResolvedValue([]);\n      mockEnhancedCommunityService.prisma.community.count.mockResolvedValue(5);\n\n      // All endpoints should be accessible for all allowed roles\n      const endpoints = [\n        () => controller.searchCommunities({}, mockUser),\n        () => controller.getCommunityDetails('community_123', mockUser),\n        () => controller.getTrendingCommunities({}),\n        () => controller.getSimilarCommunities('community_123', {}, mockUser),\n        () => controller.discoverCommunities(mockUser),\n        () => controller.getCommunityCategories(),\n        () => controller.getPopularCommunities(mockUser),\n      ];\n\n      for (const endpoint of endpoints) {\n        await expect(endpoint()).resolves.toBeDefined();\n      }\n    });\n  });\n});"],"version":3}