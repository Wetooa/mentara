226d98f5bbe788073691926818f874d6
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EmailService = void 0;
const common_1 = require("@nestjs/common");
let EmailService = class EmailService {
    /**
     * Send therapist application status notification
     * This is a placeholder that will trigger the client-side EmailJS service
     * In a production environment, you might want to use a server-side email service
     *
     * @param data Email notification data
     * @returns Promise with operation result
     */
    sendTherapistApplicationNotification(data) {
        try {
            console.log('Email notification requested:', {
                recipient: data.to,
                status: data.status,
                hasCredentials: !!data.credentials,
            });
            // For now, we'll just log the email data
            // In production, you would integrate with:
            // - SendGrid
            // - AWS SES
            // - Nodemailer with SMTP
            // - Or trigger a webhook to the frontend to send via EmailJS
            const emailContent = this.generateEmailContent(data);
            console.log('Generated email content:', emailContent);
            // TODO: Implement actual email sending
            // For now, return success to indicate the notification was "queued"
            return {
                success: true,
                message: `Email notification queued for ${data.to}`,
            };
        }
        catch (error) {
            console.error('Failed to send email notification:', error);
            return {
                success: false,
                message: error instanceof Error
                    ? error.message
                    : 'Failed to send notification',
            };
        }
    }
    /**
     * Generate email content based on application status
     * @param data Email notification data
     * @returns Formatted email content
     */
    generateEmailContent(data) {
        const { name, status, adminNotes, credentials } = data;
        const baseContent = {
            subject: `Mentara Therapist Application ${status === 'approved' ? 'Approved' : 'Update'}`,
            greeting: `Dear ${name},`,
            companySignature: 'Best regards,\nThe Mentara Team\nsupport@mentara.com',
        };
        if (status === 'approved') {
            return {
                ...baseContent,
                body: [
                    'Congratulations! Your therapist application has been approved.',
                    '',
                    'You can now start providing therapy services through the Mentara platform.',
                    '',
                    ...(credentials
                        ? [
                            'Your account credentials:',
                            `Email: ${credentials.email}`,
                            `Temporary Password: ${credentials.password}`,
                            '',
                            'Please log in and change your password immediately.',
                            'You can access your therapist dashboard at: https://mentara.com/therapist',
                            '',
                        ]
                        : []),
                    ...(adminNotes
                        ? ['Additional notes from our team:', adminNotes, '']
                        : []),
                    'Welcome to the Mentara therapist network!',
                ].join('\n'),
            };
        }
        else {
            return {
                ...baseContent,
                body: [
                    'Thank you for your interest in joining the Mentara therapist network.',
                    '',
                    'After careful review, we have decided not to approve your application at this time.',
                    '',
                    ...(adminNotes
                        ? ['Feedback from our review team:', adminNotes, '']
                        : []),
                    'We encourage you to address any concerns mentioned above and reapply in the future.',
                    '',
                    "If you have any questions, please don't hesitate to contact our support team.",
                ].join('\n'),
            };
        }
    }
    /**
     * Send welcome email to new therapists
     * @param therapistEmail Therapist email address
     * @param therapistName Therapist name
     * @param credentials Login credentials
     * @returns Promise with operation result
     */
    async sendTherapistWelcomeEmail(therapistEmail, therapistName, credentials) {
        return this.sendTherapistApplicationNotification({
            to: therapistEmail,
            name: therapistName,
            status: 'approved',
            credentials,
        });
    }
    /**
     * Send rejection email to therapist applicants
     * @param therapistEmail Therapist email address
     * @param therapistName Therapist name
     * @param reason Optional rejection reason
     * @returns Promise with operation result
     */
    async sendTherapistRejectionEmail(therapistEmail, therapistName, reason) {
        return this.sendTherapistApplicationNotification({
            to: therapistEmail,
            name: therapistName,
            status: 'rejected',
            adminNotes: reason,
        });
    }
    /**
     * Test email service configuration
     * @returns Promise with test result
     */
    testConfiguration() {
        try {
            console.log('Testing email service configuration...');
            // Test email generation
            const testData = {
                to: 'test@example.com',
                name: 'Test Therapist',
                status: 'approved',
                credentials: {
                    email: 'test@example.com',
                    password: 'temp123',
                },
            };
            const content = this.generateEmailContent(testData);
            console.log('Test email content generated successfully:', content);
            return {
                success: true,
                message: 'Email service configuration test passed',
            };
        }
        catch (error) {
            console.error('Email service test failed:', error);
            return {
                success: false,
                message: error instanceof Error ? error.message : 'Test failed',
            };
        }
    }
};
exports.EmailService = EmailService;
exports.EmailService = EmailService = __decorate([
    (0, common_1.Injectable)()
], EmailService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3NlcnZpY2VzL2VtYWlsLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsMkNBQTRDO0FBY3JDLElBQU0sWUFBWSxHQUFsQixNQUFNLFlBQVk7SUFDdkI7Ozs7Ozs7T0FPRztJQUNILG9DQUFvQyxDQUFDLElBQTJCO1FBSTlELElBQUksQ0FBQztZQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLEVBQUU7Z0JBQzNDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRTtnQkFDbEIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO2dCQUNuQixjQUFjLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO2FBQ25DLENBQUMsQ0FBQztZQUVILHlDQUF5QztZQUN6QywyQ0FBMkM7WUFDM0MsYUFBYTtZQUNiLFlBQVk7WUFDWix5QkFBeUI7WUFDekIsNkRBQTZEO1lBRTdELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVyRCxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixFQUFFLFlBQVksQ0FBQyxDQUFDO1lBRXRELHVDQUF1QztZQUN2QyxvRUFBb0U7WUFDcEUsT0FBTztnQkFDTCxPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUsaUNBQWlDLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDcEQsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMzRCxPQUFPO2dCQUNMLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFDTCxLQUFLLFlBQVksS0FBSztvQkFDcEIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPO29CQUNmLENBQUMsQ0FBQyw2QkFBNkI7YUFDcEMsQ0FBQztRQUNKLENBQUM7SUFD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QixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BELE9BQU8sQ0FBQyxHQUFHLENBQUMsNENBQTRDLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFbkUsT0FBTztnQkFDTCxPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUseUNBQXlDO2FBQ25ELENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDbkQsT0FBTztnQkFDTCxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsYUFBYTthQUNoRSxDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7Q0FDRixDQUFBO0FBckxZLG9DQUFZO3VCQUFaLFlBQVk7SUFEeEIsSUFBQSxtQkFBVSxHQUFFO0dBQ0EsWUFBWSxDQXFMeEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3NlcnZpY2VzL2VtYWlsLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcblxuZXhwb3J0IGludGVyZmFjZSBFbWFpbE5vdGlmaWNhdGlvbkRhdGEge1xuICB0bzogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHN0YXR1czogJ2FwcHJvdmVkJyB8ICdyZWplY3RlZCc7XG4gIGFkbWluTm90ZXM/OiBzdHJpbmc7XG4gIGNyZWRlbnRpYWxzPzoge1xuICAgIGVtYWlsOiBzdHJpbmc7XG4gICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgfTtcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEVtYWlsU2VydmljZSB7XG4gIC8qKlxuICAgKiBTZW5kIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiBzdGF0dXMgbm90aWZpY2F0aW9uXG4gICAqIFRoaXMgaXMgYSBwbGFjZWhvbGRlciB0aGF0IHdpbGwgdHJpZ2dlciB0aGUgY2xpZW50LXNpZGUgRW1haWxKUyBzZXJ2aWNlXG4gICAqIEluIGEgcHJvZHVjdGlvbiBlbnZpcm9ubWVudCwgeW91IG1pZ2h0IHdhbnQgdG8gdXNlIGEgc2VydmVyLXNpZGUgZW1haWwgc2VydmljZVxuICAgKlxuICAgKiBAcGFyYW0gZGF0YSBFbWFpbCBub3RpZmljYXRpb24gZGF0YVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgc2VuZFRoZXJhcGlzdEFwcGxpY2F0aW9uTm90aWZpY2F0aW9uKGRhdGE6IEVtYWlsTm90aWZpY2F0aW9uRGF0YSk6IHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgfSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdFbWFpbCBub3RpZmljYXRpb24gcmVxdWVzdGVkOicsIHtcbiAgICAgICAgcmVjaXBpZW50OiBkYXRhLnRvLFxuICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzLFxuICAgICAgICBoYXNDcmVkZW50aWFsczogISFkYXRhLmNyZWRlbnRpYWxzLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEZvciBub3csIHdlJ2xsIGp1c3QgbG9nIHRoZSBlbWFpbCBkYXRhXG4gICAgICAvLyBJbiBwcm9kdWN0aW9uLCB5b3Ugd291bGQgaW50ZWdyYXRlIHdpdGg6XG4gICAgICAvLyAtIFNlbmRHcmlkXG4gICAgICAvLyAtIEFXUyBTRVNcbiAgICAgIC8vIC0gTm9kZW1haWxlciB3aXRoIFNNVFBcbiAgICAgIC8vIC0gT3IgdHJpZ2dlciBhIHdlYmhvb2sgdG8gdGhlIGZyb250ZW5kIHRvIHNlbmQgdmlhIEVtYWlsSlNcblxuICAgICAgY29uc3QgZW1haWxDb250ZW50ID0gdGhpcy5nZW5lcmF0ZUVtYWlsQ29udGVudChkYXRhKTtcblxuICAgICAgY29uc29sZS5sb2coJ0dlbmVyYXRlZCBlbWFpbCBjb250ZW50OicsIGVtYWlsQ29udGVudCk7XG5cbiAgICAgIC8vIFRPRE86IEltcGxlbWVudCBhY3R1YWwgZW1haWwgc2VuZGluZ1xuICAgICAgLy8gRm9yIG5vdywgcmV0dXJuIHN1Y2Nlc3MgdG8gaW5kaWNhdGUgdGhlIG5vdGlmaWNhdGlvbiB3YXMgXCJxdWV1ZWRcIlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYEVtYWlsIG5vdGlmaWNhdGlvbiBxdWV1ZWQgZm9yICR7ZGF0YS50b31gLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNlbmQgZW1haWwgbm90aWZpY2F0aW9uOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgOiAnRmFpbGVkIHRvIHNlbmQgbm90aWZpY2F0aW9uJyxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGVtYWlsIGNvbnRlbnQgYmFzZWQgb24gYXBwbGljYXRpb24gc3RhdHVzXG4gICAqIEBwYXJhbSBkYXRhIEVtYWlsIG5vdGlmaWNhdGlvbiBkYXRhXG4gICAqIEByZXR1cm5zIEZvcm1hdHRlZCBlbWFpbCBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlRW1haWxDb250ZW50KGRhdGE6IEVtYWlsTm90aWZpY2F0aW9uRGF0YSkge1xuICAgIGNvbnN0IHsgbmFtZSwgc3RhdHVzLCBhZG1pbk5vdGVzLCBjcmVkZW50aWFscyB9ID0gZGF0YTtcblxuICAgIGNvbnN0IGJhc2VDb250ZW50ID0ge1xuICAgICAgc3ViamVjdDogYE1lbnRhcmEgVGhlcmFwaXN0IEFwcGxpY2F0aW9uICR7c3RhdHVzID09PSAnYXBwcm92ZWQnID8gJ0FwcHJvdmVkJyA6ICdVcGRhdGUnfWAsXG4gICAgICBncmVldGluZzogYERlYXIgJHtuYW1lfSxgLFxuICAgICAgY29tcGFueVNpZ25hdHVyZTogJ0Jlc3QgcmVnYXJkcyxcXG5UaGUgTWVudGFyYSBUZWFtXFxuc3VwcG9ydEBtZW50YXJhLmNvbScsXG4gICAgfTtcblxuICAgIGlmIChzdGF0dXMgPT09ICdhcHByb3ZlZCcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmJhc2VDb250ZW50LFxuICAgICAgICBib2R5OiBbXG4gICAgICAgICAgJ0NvbmdyYXR1bGF0aW9ucyEgWW91ciB0aGVyYXBpc3QgYXBwbGljYXRpb24gaGFzIGJlZW4gYXBwcm92ZWQuJyxcbiAgICAgICAgICAnJyxcbiAgICAgICAgICAnWW91IGNhbiBub3cgc3RhcnQgcHJvdmlkaW5nIHRoZXJhcHkgc2VydmljZXMgdGhyb3VnaCB0aGUgTWVudGFyYSBwbGF0Zm9ybS4nLFxuICAgICAgICAgICcnLFxuICAgICAgICAgIC4uLihjcmVkZW50aWFsc1xuICAgICAgICAgICAgPyBbXG4gICAgICAgICAgICAgICAgJ1lvdXIgYWNjb3VudCBjcmVkZW50aWFsczonLFxuICAgICAgICAgICAgICAgIGBFbWFpbDogJHtjcmVkZW50aWFscy5lbWFpbH1gLFxuICAgICAgICAgICAgICAgIGBUZW1wb3JhcnkgUGFzc3dvcmQ6ICR7Y3JlZGVudGlhbHMucGFzc3dvcmR9YCxcbiAgICAgICAgICAgICAgICAnJyxcbiAgICAgICAgICAgICAgICAnUGxlYXNlIGxvZyBpbiBhbmQgY2hhbmdlIHlvdXIgcGFzc3dvcmQgaW1tZWRpYXRlbHkuJyxcbiAgICAgICAgICAgICAgICAnWW91IGNhbiBhY2Nlc3MgeW91ciB0aGVyYXBpc3QgZGFzaGJvYXJkIGF0OiBodHRwczovL21lbnRhcmEuY29tL3RoZXJhcGlzdCcsXG4gICAgICAgICAgICAgICAgJycsXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIDogW10pLFxuICAgICAgICAgIC4uLihhZG1pbk5vdGVzXG4gICAgICAgICAgICA/IFsnQWRkaXRpb25hbCBub3RlcyBmcm9tIG91ciB0ZWFtOicsIGFkbWluTm90ZXMsICcnXVxuICAgICAgICAgICAgOiBbXSksXG4gICAgICAgICAgJ1dlbGNvbWUgdG8gdGhlIE1lbnRhcmEgdGhlcmFwaXN0IG5ldHdvcmshJyxcbiAgICAgICAgXS5qb2luKCdcXG4nKSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmJhc2VDb250ZW50LFxuICAgICAgICBib2R5OiBbXG4gICAgICAgICAgJ1RoYW5rIHlvdSBmb3IgeW91ciBpbnRlcmVzdCBpbiBqb2luaW5nIHRoZSBNZW50YXJhIHRoZXJhcGlzdCBuZXR3b3JrLicsXG4gICAgICAgICAgJycsXG4gICAgICAgICAgJ0FmdGVyIGNhcmVmdWwgcmV2aWV3LCB3ZSBoYXZlIGRlY2lkZWQgbm90IHRvIGFwcHJvdmUgeW91ciBhcHBsaWNhdGlvbiBhdCB0aGlzIHRpbWUuJyxcbiAgICAgICAgICAnJyxcbiAgICAgICAgICAuLi4oYWRtaW5Ob3Rlc1xuICAgICAgICAgICAgPyBbJ0ZlZWRiYWNrIGZyb20gb3VyIHJldmlldyB0ZWFtOicsIGFkbWluTm90ZXMsICcnXVxuICAgICAgICAgICAgOiBbXSksXG4gICAgICAgICAgJ1dlIGVuY291cmFnZSB5b3UgdG8gYWRkcmVzcyBhbnkgY29uY2VybnMgbWVudGlvbmVkIGFib3ZlIGFuZCByZWFwcGx5IGluIHRoZSBmdXR1cmUuJyxcbiAgICAgICAgICAnJyxcbiAgICAgICAgICBcIklmIHlvdSBoYXZlIGFueSBxdWVzdGlvbnMsIHBsZWFzZSBkb24ndCBoZXNpdGF0ZSB0byBjb250YWN0IG91ciBzdXBwb3J0IHRlYW0uXCIsXG4gICAgICAgIF0uam9pbignXFxuJyksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHdlbGNvbWUgZW1haWwgdG8gbmV3IHRoZXJhcGlzdHNcbiAgICogQHBhcmFtIHRoZXJhcGlzdEVtYWlsIFRoZXJhcGlzdCBlbWFpbCBhZGRyZXNzXG4gICAqIEBwYXJhbSB0aGVyYXBpc3ROYW1lIFRoZXJhcGlzdCBuYW1lXG4gICAqIEBwYXJhbSBjcmVkZW50aWFscyBMb2dpbiBjcmVkZW50aWFsc1xuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFRoZXJhcGlzdFdlbGNvbWVFbWFpbChcbiAgICB0aGVyYXBpc3RFbWFpbDogc3RyaW5nLFxuICAgIHRoZXJhcGlzdE5hbWU6IHN0cmluZyxcbiAgICBjcmVkZW50aWFsczogeyBlbWFpbDogc3RyaW5nOyBwYXNzd29yZDogc3RyaW5nIH0sXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHJldHVybiB0aGlzLnNlbmRUaGVyYXBpc3RBcHBsaWNhdGlvbk5vdGlmaWNhdGlvbih7XG4gICAgICB0bzogdGhlcmFwaXN0RW1haWwsXG4gICAgICBuYW1lOiB0aGVyYXBpc3ROYW1lLFxuICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgY3JlZGVudGlhbHMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCByZWplY3Rpb24gZW1haWwgdG8gdGhlcmFwaXN0IGFwcGxpY2FudHNcbiAgICogQHBhcmFtIHRoZXJhcGlzdEVtYWlsIFRoZXJhcGlzdCBlbWFpbCBhZGRyZXNzXG4gICAqIEBwYXJhbSB0aGVyYXBpc3ROYW1lIFRoZXJhcGlzdCBuYW1lXG4gICAqIEBwYXJhbSByZWFzb24gT3B0aW9uYWwgcmVqZWN0aW9uIHJlYXNvblxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFRoZXJhcGlzdFJlamVjdGlvbkVtYWlsKFxuICAgIHRoZXJhcGlzdEVtYWlsOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0TmFtZTogc3RyaW5nLFxuICAgIHJlYXNvbj86IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc2VuZFRoZXJhcGlzdEFwcGxpY2F0aW9uTm90aWZpY2F0aW9uKHtcbiAgICAgIHRvOiB0aGVyYXBpc3RFbWFpbCxcbiAgICAgIG5hbWU6IHRoZXJhcGlzdE5hbWUsXG4gICAgICBzdGF0dXM6ICdyZWplY3RlZCcsXG4gICAgICBhZG1pbk5vdGVzOiByZWFzb24sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBlbWFpbCBzZXJ2aWNlIGNvbmZpZ3VyYXRpb25cbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHRlc3QgcmVzdWx0XG4gICAqL1xuICB0ZXN0Q29uZmlndXJhdGlvbigpOiB7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1Rlc3RpbmcgZW1haWwgc2VydmljZSBjb25maWd1cmF0aW9uLi4uJyk7XG5cbiAgICAgIC8vIFRlc3QgZW1haWwgZ2VuZXJhdGlvblxuICAgICAgY29uc3QgdGVzdERhdGE6IEVtYWlsTm90aWZpY2F0aW9uRGF0YSA9IHtcbiAgICAgICAgdG86ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgbmFtZTogJ1Rlc3QgVGhlcmFwaXN0JyxcbiAgICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgICAgcGFzc3dvcmQ6ICd0ZW1wMTIzJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmdlbmVyYXRlRW1haWxDb250ZW50KHRlc3REYXRhKTtcbiAgICAgIGNvbnNvbGUubG9nKCdUZXN0IGVtYWlsIGNvbnRlbnQgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseTonLCBjb250ZW50KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ0VtYWlsIHNlcnZpY2UgY29uZmlndXJhdGlvbiB0ZXN0IHBhc3NlZCcsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFbWFpbCBzZXJ2aWNlIHRlc3QgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdUZXN0IGZhaWxlZCcsXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9