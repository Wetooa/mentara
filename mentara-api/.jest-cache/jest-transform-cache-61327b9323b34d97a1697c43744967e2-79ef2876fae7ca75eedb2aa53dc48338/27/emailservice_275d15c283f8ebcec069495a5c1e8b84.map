{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/services/email.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/services/email.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\n\nexport interface EmailNotificationData {\n  to: string;\n  name: string;\n  status: 'approved' | 'rejected';\n  adminNotes?: string;\n  credentials?: {\n    email: string;\n    password: string;\n  };\n}\n\n@Injectable()\nexport class EmailService {\n  /**\n   * Send therapist application status notification\n   * This is a placeholder that will trigger the client-side EmailJS service\n   * In a production environment, you might want to use a server-side email service\n   *\n   * @param data Email notification data\n   * @returns Promise with operation result\n   */\n  sendTherapistApplicationNotification(data: EmailNotificationData): {\n    success: boolean;\n    message: string;\n  } {\n    try {\n      console.log('Email notification requested:', {\n        recipient: data.to,\n        status: data.status,\n        hasCredentials: !!data.credentials,\n      });\n\n      // For now, we'll just log the email data\n      // In production, you would integrate with:\n      // - SendGrid\n      // - AWS SES\n      // - Nodemailer with SMTP\n      // - Or trigger a webhook to the frontend to send via EmailJS\n\n      const emailContent = this.generateEmailContent(data);\n\n      console.log('Generated email content:', emailContent);\n\n      // TODO: Implement actual email sending\n      // For now, return success to indicate the notification was \"queued\"\n      return {\n        success: true,\n        message: `Email notification queued for ${data.to}`,\n      };\n    } catch (error) {\n      console.error('Failed to send email notification:', error);\n      return {\n        success: false,\n        message:\n          error instanceof Error\n            ? error.message\n            : 'Failed to send notification',\n      };\n    }\n  }\n\n  /**\n   * Generate email content based on application status\n   * @param data Email notification data\n   * @returns Formatted email content\n   */\n  private generateEmailContent(data: EmailNotificationData) {\n    const { name, status, adminNotes, credentials } = data;\n\n    const baseContent = {\n      subject: `Mentara Therapist Application ${status === 'approved' ? 'Approved' : 'Update'}`,\n      greeting: `Dear ${name},`,\n      companySignature: 'Best regards,\\nThe Mentara Team\\nsupport@mentara.com',\n    };\n\n    if (status === 'approved') {\n      return {\n        ...baseContent,\n        body: [\n          'Congratulations! Your therapist application has been approved.',\n          '',\n          'You can now start providing therapy services through the Mentara platform.',\n          '',\n          ...(credentials\n            ? [\n                'Your account credentials:',\n                `Email: ${credentials.email}`,\n                `Temporary Password: ${credentials.password}`,\n                '',\n                'Please log in and change your password immediately.',\n                'You can access your therapist dashboard at: https://mentara.com/therapist',\n                '',\n              ]\n            : []),\n          ...(adminNotes\n            ? ['Additional notes from our team:', adminNotes, '']\n            : []),\n          'Welcome to the Mentara therapist network!',\n        ].join('\\n'),\n      };\n    } else {\n      return {\n        ...baseContent,\n        body: [\n          'Thank you for your interest in joining the Mentara therapist network.',\n          '',\n          'After careful review, we have decided not to approve your application at this time.',\n          '',\n          ...(adminNotes\n            ? ['Feedback from our review team:', adminNotes, '']\n            : []),\n          'We encourage you to address any concerns mentioned above and reapply in the future.',\n          '',\n          \"If you have any questions, please don't hesitate to contact our support team.\",\n        ].join('\\n'),\n      };\n    }\n  }\n\n  /**\n   * Send welcome email to new therapists\n   * @param therapistEmail Therapist email address\n   * @param therapistName Therapist name\n   * @param credentials Login credentials\n   * @returns Promise with operation result\n   */\n  async sendTherapistWelcomeEmail(\n    therapistEmail: string,\n    therapistName: string,\n    credentials: { email: string; password: string },\n  ): Promise<{ success: boolean; message: string }> {\n    return this.sendTherapistApplicationNotification({\n      to: therapistEmail,\n      name: therapistName,\n      status: 'approved',\n      credentials,\n    });\n  }\n\n  /**\n   * Send rejection email to therapist applicants\n   * @param therapistEmail Therapist email address\n   * @param therapistName Therapist name\n   * @param reason Optional rejection reason\n   * @returns Promise with operation result\n   */\n  async sendTherapistRejectionEmail(\n    therapistEmail: string,\n    therapistName: string,\n    reason?: string,\n  ): Promise<{ success: boolean; message: string }> {\n    return this.sendTherapistApplicationNotification({\n      to: therapistEmail,\n      name: therapistName,\n      status: 'rejected',\n      adminNotes: reason,\n    });\n  }\n\n  /**\n   * Test email service configuration\n   * @returns Promise with test result\n   */\n  testConfiguration(): { success: boolean; message: string } {\n    try {\n      console.log('Testing email service configuration...');\n\n      // Test email generation\n      const testData: EmailNotificationData = {\n        to: 'test@example.com',\n        name: 'Test Therapist',\n        status: 'approved',\n        credentials: {\n          email: 'test@example.com',\n          password: 'temp123',\n        },\n      };\n\n      const content = this.generateEmailContent(testData);\n      console.log('Test email content generated successfully:', content);\n\n      return {\n        success: true,\n        message: 'Email service configuration test passed',\n      };\n    } catch (error) {\n      console.error('Email service test failed:', error);\n      return {\n        success: false,\n        message: error instanceof Error ? error.message : 'Test failed',\n      };\n    }\n  }\n}\n"],"version":3}