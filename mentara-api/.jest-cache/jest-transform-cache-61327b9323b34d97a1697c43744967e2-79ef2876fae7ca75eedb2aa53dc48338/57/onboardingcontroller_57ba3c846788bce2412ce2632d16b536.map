{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/onboarding/onboarding.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/onboarding/onboarding.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Param,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { OnboardingService, OnboardingStatus } from './onboarding.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../auth/decorators/current-user-role.decorator';\n\n@Controller('onboarding')\n@UseGuards(JwtAuthGuard)\nexport class OnboardingController {\n  private readonly logger = new Logger(OnboardingController.name);\n\n  constructor(private readonly onboardingService: OnboardingService) {}\n\n  @Get('status')\n  async getMyOnboardingStatus(\n    @CurrentUserId() userId: string,\n  ): Promise<OnboardingStatus> {\n    try {\n      return await this.onboardingService.getOnboardingStatus(userId);\n    } catch (error) {\n      this.logger.error(\n        `Failed to get onboarding status for user ${userId}:`,\n        error,\n      );\n      throw new HttpException(\n        'Failed to retrieve onboarding status',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Get('status/:userId')\n  async getUserOnboardingStatus(\n    @Param('userId') userId: string,\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<OnboardingStatus> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      return await this.onboardingService.getOnboardingStatus(userId);\n    } catch (error) {\n      this.logger.error(\n        `Failed to get onboarding status for user ${userId}:`,\n        error,\n      );\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      throw new HttpException(\n        'Failed to retrieve onboarding status',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Post('complete-step/:stepName')\n  async completeStep(\n    @CurrentUserId() userId: string,\n    @Param('stepName') stepName: string,\n  ): Promise<OnboardingStatus> {\n    try {\n      return await this.onboardingService.markStepCompleted(userId, stepName);\n    } catch (error) {\n      this.logger.error(\n        `Failed to complete step ${stepName} for user ${userId}:`,\n        error,\n      );\n      throw new HttpException(\n        'Failed to complete onboarding step',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Get('validate')\n  async validateOnboarding(@CurrentUserId() userId: string) {\n    try {\n      return await this.onboardingService.validateOnboardingCompleteness(\n        userId,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Failed to validate onboarding for user ${userId}:`,\n        error,\n      );\n      throw new HttpException(\n        'Failed to validate onboarding completeness',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Get('insights')\n  async getOnboardingInsights(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      return await this.onboardingService.getOnboardingInsights();\n    } catch (error) {\n      this.logger.error('Failed to get onboarding insights:', error);\n      throw new HttpException(\n        'Failed to retrieve onboarding insights',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"version":3}