083ce2a6fc37a1c7776b53f34e9189cd
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var OnboardingController_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.OnboardingController = void 0;
const common_1 = require("@nestjs/common");
const onboarding_service_1 = require("./onboarding.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../auth/decorators/current-user-id.decorator");
const current_user_role_decorator_1 = require("../auth/decorators/current-user-role.decorator");
let OnboardingController = OnboardingController_1 = class OnboardingController {
    onboardingService;
    logger = new common_1.Logger(OnboardingController_1.name);
    constructor(onboardingService) {
        this.onboardingService = onboardingService;
    }
    async getMyOnboardingStatus(userId) {
        try {
            return await this.onboardingService.getOnboardingStatus(userId);
        }
        catch (error) {
            this.logger.error(`Failed to get onboarding status for user ${userId}:`, error);
            throw new common_1.HttpException('Failed to retrieve onboarding status', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getUserOnboardingStatus(userId, currentUserId, role) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Admin access required');
        }
        try {
            return await this.onboardingService.getOnboardingStatus(userId);
        }
        catch (error) {
            this.logger.error(`Failed to get onboarding status for user ${userId}:`, error);
            if (error instanceof common_1.HttpException) {
                throw error;
            }
            throw new common_1.HttpException('Failed to retrieve onboarding status', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async completeStep(userId, stepName) {
        try {
            return await this.onboardingService.markStepCompleted(userId, stepName);
        }
        catch (error) {
            this.logger.error(`Failed to complete step ${stepName} for user ${userId}:`, error);
            throw new common_1.HttpException('Failed to complete onboarding step', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async validateOnboarding(userId) {
        try {
            return await this.onboardingService.validateOnboardingCompleteness(userId);
        }
        catch (error) {
            this.logger.error(`Failed to validate onboarding for user ${userId}:`, error);
            throw new common_1.HttpException('Failed to validate onboarding completeness', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async getOnboardingInsights(currentUserId, role) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Admin access required');
        }
        try {
            return await this.onboardingService.getOnboardingInsights();
        }
        catch (error) {
            this.logger.error('Failed to get onboarding insights:', error);
            throw new common_1.HttpException('Failed to retrieve onboarding insights', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
};
exports.OnboardingController = OnboardingController;
__decorate([
    (0, common_1.Get)('status'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_b = typeof Promise !== "undefined" && Promise) === "function" ? _b : Object)
], OnboardingController.prototype, "getMyOnboardingStatus", null);
__decorate([
    (0, common_1.Get)('status/:userId'),
    __param(0, (0, common_1.Param)('userId')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, String]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], OnboardingController.prototype, "getUserOnboardingStatus", null);
__decorate([
    (0, common_1.Post)('complete-step/:stepName'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('stepName')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], OnboardingController.prototype, "completeStep", null);
__decorate([
    (0, common_1.Get)('validate'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], OnboardingController.prototype, "validateOnboarding", null);
__decorate([
    (0, common_1.Get)('insights'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], OnboardingController.prototype, "getOnboardingInsights", null);
exports.OnboardingController = OnboardingController = OnboardingController_1 = __decorate([
    (0, common_1.Controller)('onboarding'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof onboarding_service_1.OnboardingService !== "undefined" && onboarding_service_1.OnboardingService) === "function" ? _a : Object])
], OnboardingController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL29uYm9hcmRpbmcvb25ib2FyZGluZy5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBVXdCO0FBQ3hCLDZEQUEyRTtBQUMzRSxrRUFBNkQ7QUFDN0QsNEZBQTZFO0FBQzdFLGdHQUFpRjtBQUkxRSxJQUFNLG9CQUFvQiw0QkFBMUIsTUFBTSxvQkFBb0I7SUFHRjtJQUZaLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxzQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVoRSxZQUE2QixpQkFBb0M7UUFBcEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtJQUFHLENBQUM7SUFHL0QsQUFBTixLQUFLLENBQUMscUJBQXFCLENBQ1IsTUFBYztRQUUvQixJQUFJLENBQUM7WUFDSCxPQUFPLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xFLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2YsNENBQTRDLE1BQU0sR0FBRyxFQUNyRCxLQUFLLENBQ04sQ0FBQztZQUNGLE1BQU0sSUFBSSxzQkFBYSxDQUNyQixzQ0FBc0MsRUFDdEMsbUJBQVUsQ0FBQyxxQkFBcUIsQ0FDakMsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBR0ssQUFBTixLQUFLLENBQUMsdUJBQXVCLENBQ1YsTUFBYyxFQUNkLGFBQXFCLEVBQ25CLElBQVk7UUFFL0IsSUFBSSxJQUFJLEtBQUssT0FBTyxFQUFFLENBQUM7WUFDckIsTUFBTSxJQUFJLDJCQUFrQixDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUNELElBQUksQ0FBQztZQUNILE9BQU8sTUFBTSxJQUFJLENBQUMsaUJBQWlCLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFD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VSxXQUFBLElBQUEseUNBQWEsR0FBRSxDQUFBOzs7OzhEQWV4QztBQUdLO0lBREwsSUFBQSxZQUFHLEVBQUMsVUFBVSxDQUFDO0lBRWIsV0FBQSxJQUFBLHlDQUFhLEdBQUUsQ0FBQTtJQUNmLFdBQUEsSUFBQSw2Q0FBZSxHQUFFLENBQUE7Ozs7aUVBY25COytCQXZHVSxvQkFBb0I7SUFGaEMsSUFBQSxtQkFBVSxFQUFDLFlBQVksQ0FBQztJQUN4QixJQUFBLGtCQUFTLEVBQUMsNkJBQVksQ0FBQzt5REFJMEIsc0NBQWlCLG9CQUFqQixzQ0FBaUI7R0FIdEQsb0JBQW9CLENBd0doQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvb25ib2FyZGluZy9vbmJvYXJkaW5nLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29udHJvbGxlcixcbiAgR2V0LFxuICBQb3N0LFxuICBQYXJhbSxcbiAgVXNlR3VhcmRzLFxuICBIdHRwRXhjZXB0aW9uLFxuICBIdHRwU3RhdHVzLFxuICBMb2dnZXIsXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgT25ib2FyZGluZ1NlcnZpY2UsIE9uYm9hcmRpbmdTdGF0dXMgfSBmcm9tICcuL29uYm9hcmRpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBDdXJyZW50VXNlcklkIH0gZnJvbSAnLi4vYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1pZC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJSb2xlIH0gZnJvbSAnLi4vYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1yb2xlLmRlY29yYXRvcic7XG5cbkBDb250cm9sbGVyKCdvbmJvYXJkaW5nJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIE9uYm9hcmRpbmdDb250cm9sbGVyIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKE9uYm9hcmRpbmdDb250cm9sbGVyLm5hbWUpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgb25ib2FyZGluZ1NlcnZpY2U6IE9uYm9hcmRpbmdTZXJ2aWNlKSB7fVxuXG4gIEBHZXQoJ3N0YXR1cycpXG4gIGFzeW5jIGdldE15T25ib2FyZGluZ1N0YXR1cyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPE9uYm9hcmRpbmdTdGF0dXM+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMub25ib2FyZGluZ1NlcnZpY2UuZ2V0T25ib2FyZGluZ1N0YXR1cyh1c2VySWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byBnZXQgb25ib2FyZGluZyBzdGF0dXMgZm9yIHVzZXIgJHt1c2VySWR9OmAsXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAnRmFpbGVkIHRvIHJldHJpZXZlIG9uYm9hcmRpbmcgc3RhdHVzJyxcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ3N0YXR1cy86dXNlcklkJylcbiAgYXN5bmMgZ2V0VXNlck9uYm9hcmRpbmdTdGF0dXMoXG4gICAgQFBhcmFtKCd1c2VySWQnKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJJZCgpIGN1cnJlbnRVc2VySWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJSb2xlKCkgcm9sZTogc3RyaW5nLFxuICApOiBQcm9taXNlPE9uYm9hcmRpbmdTdGF0dXM+IHtcbiAgICBpZiAocm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5vbmJvYXJkaW5nU2VydmljZS5nZXRPbmJvYXJkaW5nU3RhdHVzKHVzZXJJZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIGdldCBvbmJvYXJkaW5nIHN0YXR1cyBmb3IgdXNlciAke3VzZXJJZH06YCxcbiAgICAgICAgZXJyb3IsXG4gICAgICApO1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgSHR0cEV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAnRmFpbGVkIHRvIHJldHJpZXZlIG9uYm9hcmRpbmcgc3RhdHVzJyxcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBQb3N0KCdjb21wbGV0ZS1zdGVwLzpzdGVwTmFtZScpXG4gIGFzeW5jIGNvbXBsZXRlU3RlcChcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBQYXJhbSgnc3RlcE5hbWUnKSBzdGVwTmFtZTogc3RyaW5nLFxuICApOiBQcm9taXNlPE9uYm9hcmRpbmdTdGF0dXM+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMub25ib2FyZGluZ1NlcnZpY2UubWFya1N0ZXBDb21wbGV0ZWQodXNlcklkLCBzdGVwTmFtZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIGNvbXBsZXRlIHN0ZXAgJHtzdGVwTmFtZX0gZm9yIHVzZXIgJHt1c2VySWR9OmAsXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAnRmFpbGVkIHRvIGNvbXBsZXRlIG9uYm9hcmRpbmcgc3RlcCcsXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAR2V0KCd2YWxpZGF0ZScpXG4gIGFzeW5jIHZhbGlkYXRlT25ib2FyZGluZyhAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLm9uYm9hcmRpbmdTZXJ2aWNlLnZhbGlkYXRlT25ib2FyZGluZ0NvbXBsZXRlbmVzcyhcbiAgICAgICAgdXNlcklkLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gdmFsaWRhdGUgb25ib2FyZGluZyBmb3IgdXNlciAke3VzZXJJZH06YCxcbiAgICAgICAgZXJyb3IsXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgICdGYWlsZWQgdG8gdmFsaWRhdGUgb25ib2FyZGluZyBjb21wbGV0ZW5lc3MnLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnaW5zaWdodHMnKVxuICBhc3luYyBnZXRPbmJvYXJkaW5nSW5zaWdodHMoXG4gICAgQEN1cnJlbnRVc2VySWQoKSBjdXJyZW50VXNlcklkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VyUm9sZSgpIHJvbGU6IHN0cmluZyxcbiAgKSB7XG4gICAgaWYgKHJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHRocm93IG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMub25ib2FyZGluZ1NlcnZpY2UuZ2V0T25ib2FyZGluZ0luc2lnaHRzKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IG9uYm9hcmRpbmcgaW5zaWdodHM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgICdGYWlsZWQgdG8gcmV0cmlldmUgb25ib2FyZGluZyBpbnNpZ2h0cycsXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==