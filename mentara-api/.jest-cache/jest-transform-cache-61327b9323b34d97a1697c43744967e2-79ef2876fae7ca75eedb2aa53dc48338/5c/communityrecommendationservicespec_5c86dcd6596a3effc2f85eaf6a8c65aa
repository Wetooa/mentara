4dc0eacf4ad2c264355afee830161fef
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const community_recommendation_service_1 = require("./community-recommendation.service");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const community_matching_service_1 = require("./community-matching.service");
describe('CommunityRecommendationService', () => {
    let service;
    let prismaService;
    let communityMatchingService;
    let loggerSpy;
    // Mock data
    const mockUser = {
        id: 'user-123',
        firstName: 'John',
        lastName: 'Doe',
        email: 'john.doe@example.com',
        isActive: true,
        memberships: [
            { communityId: 'community-existing-1' },
            { communityId: 'community-existing-2' },
        ],
        createdAt: new Date('2024-01-01'),
        updatedAt: new Date('2024-01-01'),
    };
    const mockUserWithoutMemberships = {
        ...mockUser,
        memberships: [],
    };
    const mockCommunities = [
        {
            id: 'community-123',
            name: 'Depression Support Network',
            slug: 'depression-support',
            description: 'A supportive community for depression',
            imageUrl: 'depression.jpg',
            _count: { memberships: 25 },
            createdAt: new Date('2024-01-01'),
            updatedAt: new Date('2024-01-01'),
        },
        {
            id: 'community-456',
            name: 'Anxiety Warriors',
            slug: 'anxiety-warriors',
            description: 'A supportive community for anxiety',
            imageUrl: 'anxiety.jpg',
            _count: { memberships: 45 },
            createdAt: new Date('2024-01-01'),
            updatedAt: new Date('2024-01-01'),
        },
        {
            id: 'community-789',
            name: 'PTSD Support Network',
            slug: 'ptsd-support',
            description: 'A supportive community for PTSD',
            imageUrl: 'ptsd.jpg',
            _count: { memberships: 15 },
            createdAt: new Date('2024-01-01'),
            updatedAt: new Date('2024-01-01'),
        },
        {
            id: 'community-small',
            name: 'Small Support Group',
            slug: 'small-support',
            description: 'A small intimate support group',
            imageUrl: 'small.jpg',
            _count: { memberships: 8 }, // Small community
            createdAt: new Date('2024-01-01'),
            updatedAt: new Date('2024-01-01'),
        },
    ];
    const mockLargeCommunity = {
        id: 'community-large',
        name: 'Large Community',
        slug: 'large-community',
        description: 'A large community',
        imageUrl: 'large.jpg',
        _count: { memberships: 150 }, // Large community
        createdAt: new Date('2024-01-01'),
        updatedAt: new Date('2024-01-01'),
    };
    beforeEach(async () => {
        const mockPrismaService = {
            user: {
                findUnique: jest.fn(),
            },
            community: {
                findMany: jest.fn(),
                findUnique: jest.fn(),
            },
        };
        const mockCommunityMatchingService = {
            calculateCompatibilityScore: jest.fn(),
            getRecommendationsForUser: jest.fn(),
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                community_recommendation_service_1.CommunityRecommendationService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrismaService,
                },
                {
                    provide: community_matching_service_1.CommunityMatchingService,
                    useValue: mockCommunityMatchingService,
                },
            ],
        }).compile();
        service = module.get(community_recommendation_service_1.CommunityRecommendationService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        communityMatchingService = module.get(community_matching_service_1.CommunityMatchingService);
        // Setup logger spies
        loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log').mockImplementation();
        jest.spyOn(common_1.Logger.prototype, 'warn').mockImplementation();
        jest.spyOn(common_1.Logger.prototype, 'error').mockImplementation();
        // Mock Math.random for consistent testing
        jest.spyOn(Math, 'random').mockReturnValue(0.7); // Will result in base score of 0.76
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.restoreAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('getUserRecommendations', () => {
        beforeEach(() => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
        });
        it('should return recommendations for user with existing memberships', async () => {
            const result = await service.getUserRecommendations('user-123');
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: { id: 'user-123' },
                include: {
                    memberships: {
                        select: { communityId: true },
                    },
                },
            });
            expect(prismaService.community.findMany).toHaveBeenCalledWith({
                where: {
                    id: { notIn: ['community-existing-1', 'community-existing-2'] },
                },
                include: {
                    _count: {
                        select: { memberships: true },
                    },
                },
            });
            expect(result).toBeInstanceOf(Array);
            expect(result.length).toBeGreaterThan(0);
            expect(result.length).toBeLessThanOrEqual(10);
            // Verify recommendation structure
            const recommendation = result[0];
            expect(recommendation).toHaveProperty('id');
            expect(recommendation).toHaveProperty('name');
            expect(recommendation).toHaveProperty('slug');
            expect(recommendation).toHaveProperty('description');
            expect(recommendation).toHaveProperty('imageUrl');
            expect(recommendation).toHaveProperty('memberCount');
            expect(recommendation).toHaveProperty('compatibilityScore');
            expect(recommendation).toHaveProperty('score');
            expect(recommendation).toHaveProperty('reason');
            expect(recommendation).toHaveProperty('status');
            expect(recommendation).toHaveProperty('createdAt');
            expect(recommendation).toHaveProperty('updatedAt');
            // Verify score is alias for compatibilityScore
            expect(recommendation.score).toBe(recommendation.compatibilityScore);
            expect(recommendation.status).toBe('pending');
        });
        it('should return recommendations for user without existing memberships', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUserWithoutMemberships);
            const result = await service.getUserRecommendations('user-123');
            expect(prismaService.community.findMany).toHaveBeenCalledWith({
                where: {
                    id: { notIn: [] },
                },
                include: {
                    _count: {
                        select: { memberships: true },
                    },
                },
            });
            expect(result).toBeInstanceOf(Array);
            expect(result.length).toBeGreaterThan(0);
        });
        it('should filter out communities with low compatibility scores', async () => {
            // Mock low random value to test filtering
            jest.spyOn(Math, 'random').mockReturnValue(0.1); // Will result in base score of 0.28
            const result = await service.getUserRecommendations('user-123');
            // Should filter out recommendations with score <= 0.3
            result.forEach(recommendation => {
                expect(recommendation.compatibilityScore).toBeGreaterThan(0.3);
            });
        });
        it('should sort recommendations by compatibility score in descending order', async () => {
            // Mock varying scores
            jest.spyOn(Math, 'random')
                .mockReturnValueOnce(0.8) // 0.84 + size bonus
                .mockReturnValueOnce(0.5) // 0.6 + size bonus
                .mockReturnValueOnce(0.3) // 0.44 + size bonus
                .mockReturnValueOnce(0.7); // 0.76 + size bonus
            const result = await service.getUserRecommendations('user-123');
            // Should be sorted by score (highest first)
            for (let i = 1; i < result.length; i++) {
                expect(result[i - 1].compatibilityScore).toBeGreaterThanOrEqual(result[i].compatibilityScore);
            }
        });
        it('should limit results to top 10 recommendations', async () => {
            // Mock many communities
            const manyCommunities = Array.from({ length: 15 }, (_, i) => ({
                id: `community-${i}`,
                name: `Community ${i}`,
                slug: `community-${i}`,
                description: `Description ${i}`,
                imageUrl: `image-${i}.jpg`,
                _count: { memberships: 20 },
                createdAt: new Date('2024-01-01'),
                updatedAt: new Date('2024-01-01'),
            }));
            prismaService.community.findMany.mockResolvedValue(manyCommunities);
            const result = await service.getUserRecommendations('user-123');
            expect(result.length).toBeLessThanOrEqual(10);
        });
        it('should apply size bonus for small communities', async () => {
            // Test with communities of different sizes
            const communitiesWithSizes = [
                { ...mockCommunities[0], _count: { memberships: 8 } }, // Small - should get bonus
                { ...mockCommunities[1], _count: { memberships: 50 } }, // Large - no bonus
            ];
            prismaService.community.findMany.mockResolvedValue(communitiesWithSizes);
            // Mock consistent base score
            jest.spyOn(Math, 'random').mockReturnValue(0.6); // Base score 0.68
            const result = await service.getUserRecommendations('user-123');
            // Small community should have higher score due to size bonus
            const smallCommunityRec = result.find(r => r.memberCount === 8);
            const largeCommunityRec = result.find(r => r.memberCount === 50);
            if (smallCommunityRec && largeCommunityRec) {
                expect(smallCommunityRec.compatibilityScore).toBeGreaterThan(largeCommunityRec.compatibilityScore);
            }
        });
        it('should throw NotFoundException for non-existent user', async () => {
            prismaService.user.findUnique.mockResolvedValue(null);
            await expect(service.getUserRecommendations('non-existent-user')).rejects.toThrow(new common_1.NotFoundException('User non-existent-user not found'));
        });
        it('should handle database errors gracefully', async () => {
            prismaService.user.findUnique.mockRejectedValue(new Error('Database error'));
            const errorSpy = jest.spyOn(common_1.Logger.prototype, 'error').mockImplementation();
            const result = await service.getUserRecommendations('user-123');
            expect(result).toEqual([]);
            expect(errorSpy).toHaveBeenCalledWith(expect.stringContaining('Error getting recommendations for user user-123'), expect.any(Error));
        });
        it('should handle empty communities list', async () => {
            prismaService.community.findMany.mockResolvedValue([]);
            const result = await service.getUserRecommendations('user-123');
            expect(result).toEqual([]);
        });
        it('should handle communities with missing count data', async () => {
            const communitiesWithoutCount = [
                {
                    ...mockCommunities[0],
                    _count: { memberships: undefined },
                },
            ];
            prismaService.community.findMany.mockResolvedValue(communitiesWithoutCount);
            const result = await service.getUserRecommendations('user-123');
            // Should handle gracefully without crashing
            expect(result).toBeInstanceOf(Array);
        });
        it('should set appropriate timestamps for recommendations', async () => {
            const beforeCall = new Date();
            const result = await service.getUserRecommendations('user-123');
            const afterCall = new Date();
            if (result.length > 0) {
                const recommendation = result[0];
                expect(recommendation.createdAt).toBeInstanceOf(Date);
                expect(recommendation.updatedAt).toBeInstanceOf(Date);
                expect(recommendation.createdAt.getTime()).toBeGreaterThanOrEqual(beforeCall.getTime());
                expect(recommendation.createdAt.getTime()).toBeLessThanOrEqual(afterCall.getTime());
            }
        });
    });
    describe('calculateCompatibilityScore', () => {
        beforeEach(() => {
            jest.spyOn(Math, 'random').mockReturnValue(0.6); // Base score 0.68
        });
        it('should calculate base compatibility score', async () => {
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            const score = await calculateCompatibilityScore([], mockCommunities[0]);
            expect(score).toBeCloseTo(0.78, 2); // 0.68 + 0.1 (size bonus)
            expect(score).toBeGreaterThanOrEqual(0.2);
            expect(score).toBeLessThanOrEqual(1.0);
        });
        it('should apply size bonus for small communities', async () => {
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            const smallCommunityScore = await calculateCompatibilityScore([], mockCommunities[3]); // 8 members
            const largeCommunityScore = await calculateCompatibilityScore([], mockLargeCommunity); // 150 members
            expect(smallCommunityScore).toBeGreaterThan(largeCommunityScore);
            expect(smallCommunityScore - largeCommunityScore).toBeCloseTo(0.1, 2); // Size bonus difference
        });
        it('should cap maximum score at 1.0', async () => {
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            // Mock very high random value
            jest.spyOn(Math, 'random').mockReturnValue(0.95); // Base score 0.96 + 0.1 = 1.06
            const score = await calculateCompatibilityScore([], mockCommunities[3]); // Small community
            expect(score).toBe(1.0); // Should be capped at 1.0
        });
        it('should handle communities without member count', async () => {
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            const communityWithoutCount = {
                ...mockCommunities[0],
                _count: { memberships: undefined },
            };
            const score = await calculateCompatibilityScore([], communityWithoutCount);
            expect(score).toBeGreaterThanOrEqual(0.2);
            expect(score).toBeLessThanOrEqual(1.0);
        });
        it('should provide consistent scores for same community', async () => {
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            // Mock consistent random value
            jest.spyOn(Math, 'random').mockReturnValue(0.5);
            const score1 = await calculateCompatibilityScore([], mockCommunities[0]);
            const score2 = await calculateCompatibilityScore([], mockCommunities[0]);
            expect(score1).toBe(score2);
        });
    });
    describe('generateRecommendationReason', () => {
        it('should generate appropriate reason for excellent match', () => {
            const generateRecommendationReason = service.generateRecommendationReason.bind(service);
            const reason = generateRecommendationReason(0.85);
            expect(reason).toBe('Excellent match based on your assessment responses');
        });
        it('should generate appropriate reason for good compatibility', () => {
            const generateRecommendationReason = service.generateRecommendationReason.bind(service);
            const reason = generateRecommendationReason(0.65);
            expect(reason).toBe('Good compatibility with your interests');
        });
        it('should generate appropriate reason for potential good fit', () => {
            const generateRecommendationReason = service.generateRecommendationReason.bind(service);
            const reason = generateRecommendationReason(0.45);
            expect(reason).toBe('Potential good fit for your needs');
        });
        it('should generate appropriate reason for moderate compatibility', () => {
            const generateRecommendationReason = service.generateRecommendationReason.bind(service);
            const reason = generateRecommendationReason(0.35);
            expect(reason).toBe('Moderate compatibility');
        });
        it('should handle edge case scores', () => {
            const generateRecommendationReason = service.generateRecommendationReason.bind(service);
            expect(generateRecommendationReason(0.8)).toBe('Excellent match based on your assessment responses');
            expect(generateRecommendationReason(0.6)).toBe('Good compatibility with your interests');
            expect(generateRecommendationReason(0.4)).toBe('Potential good fit for your needs');
            expect(generateRecommendationReason(0.0)).toBe('Moderate compatibility');
            expect(generateRecommendationReason(1.0)).toBe('Excellent match based on your assessment responses');
        });
    });
    describe('generateRecommendationsForUser', () => {
        it('should log generation message', async () => {
            await service.generateRecommendationsForUser('user-123');
            expect(loggerSpy).toHaveBeenCalledWith('Generated recommendations for user user-123 (calculated on-demand)');
        });
        it('should log generation message with force flag', async () => {
            await service.generateRecommendationsForUser('user-123', true);
            expect(loggerSpy).toHaveBeenCalledWith('Generated recommendations for user user-123 (calculated on-demand)');
        });
        it('should handle different user IDs', async () => {
            await service.generateRecommendationsForUser('user-456');
            expect(loggerSpy).toHaveBeenCalledWith('Generated recommendations for user user-456 (calculated on-demand)');
        });
        it('should not throw errors', async () => {
            await expect(service.generateRecommendationsForUser('user-123')).resolves.not.toThrow();
        });
    });
    describe('getRecommendationById', () => {
        it('should return null for any recommendation ID', async () => {
            const result = await service.getRecommendationById('recommendation-123');
            expect(result).toBeNull();
        });
        it('should return null for different recommendation IDs', async () => {
            const result1 = await service.getRecommendationById('rec-1');
            const result2 = await service.getRecommendationById('rec-2');
            const result3 = await service.getRecommendationById('');
            expect(result1).toBeNull();
            expect(result2).toBeNull();
            expect(result3).toBeNull();
        });
        it('should handle long recommendation IDs', async () => {
            const longId = 'a'.repeat(1000);
            const result = await service.getRecommendationById(longId);
            expect(result).toBeNull();
        });
    });
    describe('handleRecommendationInteraction', () => {
        const mockInteractionData = {
            recommendationId: 'rec-123',
            action: 'accept',
            userId: 'user-123',
        };
        it('should log interaction for accept action', async () => {
            await service.handleRecommendationInteraction(mockInteractionData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 accepted recommendation rec-123');
        });
        it('should log interaction for reject action', async () => {
            const rejectData = { ...mockInteractionData, action: 'reject' };
            await service.handleRecommendationInteraction(rejectData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 rejected recommendation rec-123');
        });
        it('should log interaction for view action', async () => {
            const viewData = { ...mockInteractionData, action: 'view' };
            await service.handleRecommendationInteraction(viewData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 viewed recommendation rec-123');
        });
        it('should handle custom actions', async () => {
            const customData = { ...mockInteractionData, action: 'bookmark' };
            await service.handleRecommendationInteraction(customData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 bookmarked recommendation rec-123');
        });
        it('should handle different user IDs', async () => {
            const differentUserData = { ...mockInteractionData, userId: 'user-456' };
            await service.handleRecommendationInteraction(differentUserData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-456 accepted recommendation rec-123');
        });
        it('should handle different recommendation IDs', async () => {
            const differentRecData = { ...mockInteractionData, recommendationId: 'rec-456' };
            await service.handleRecommendationInteraction(differentRecData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 accepted recommendation rec-456');
        });
        it('should not throw errors', async () => {
            await expect(service.handleRecommendationInteraction(mockInteractionData)).resolves.not.toThrow();
        });
        it('should handle empty action strings', async () => {
            const emptyActionData = { ...mockInteractionData, action: '' };
            await service.handleRecommendationInteraction(emptyActionData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 ed recommendation rec-123');
        });
        it('should handle special characters in actions', async () => {
            const specialActionData = { ...mockInteractionData, action: 'action-with-dashes_and_underscores' };
            await service.handleRecommendationInteraction(specialActionData);
            expect(loggerSpy).toHaveBeenCalledWith('User user-123 action-with-dashes_and_underscoresed recommendation rec-123');
        });
    });
    describe('getRecommendationStats', () => {
        it('should return default stats structure', async () => {
            const result = await service.getRecommendationStats();
            expect(result).toEqual({
                totalRecommendations: 0,
                acceptedRecommendations: 0,
                rejectedRecommendations: 0,
                pendingRecommendations: 0,
                averageCompatibilityScore: 0,
                topCommunities: [],
            });
        });
        it('should return consistent stats structure on multiple calls', async () => {
            const result1 = await service.getRecommendationStats();
            const result2 = await service.getRecommendationStats();
            expect(result1).toEqual(result2);
        });
        it('should have all required properties', async () => {
            const result = await service.getRecommendationStats();
            expect(result).toHaveProperty('totalRecommendations');
            expect(result).toHaveProperty('acceptedRecommendations');
            expect(result).toHaveProperty('rejectedRecommendations');
            expect(result).toHaveProperty('pendingRecommendations');
            expect(result).toHaveProperty('averageCompatibilityScore');
            expect(result).toHaveProperty('topCommunities');
            expect(typeof result.totalRecommendations).toBe('number');
            expect(typeof result.acceptedRecommendations).toBe('number');
            expect(typeof result.rejectedRecommendations).toBe('number');
            expect(typeof result.pendingRecommendations).toBe('number');
            expect(typeof result.averageCompatibilityScore).toBe('number');
            expect(Array.isArray(result.topCommunities)).toBe(true);
        });
        it('should not throw errors', async () => {
            await expect(service.getRecommendationStats()).resolves.not.toThrow();
        });
    });
    describe('edge cases and error handling', () => {
        it('should handle user with null memberships', async () => {
            const userWithNullMemberships = {
                ...mockUser,
                memberships: null,
            };
            prismaService.user.findUnique.mockResolvedValue(userWithNullMemberships);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
            await expect(service.getUserRecommendations('user-123')).rejects.toThrow();
        });
        it('should handle communities with null member counts', async () => {
            const communitiesWithNullCounts = [
                {
                    ...mockCommunities[0],
                    _count: null,
                },
            ];
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(communitiesWithNullCounts);
            const result = await service.getUserRecommendations('user-123');
            expect(result).toBeInstanceOf(Array);
        });
        it('should handle very large numbers of communities efficiently', async () => {
            const largeCommunityList = Array.from({ length: 1000 }, (_, i) => ({
                id: `community-${i}`,
                name: `Community ${i}`,
                slug: `community-${i}`,
                description: `Description ${i}`,
                imageUrl: `image-${i}.jpg`,
                _count: { memberships: i % 100 }, // Varying sizes
                createdAt: new Date('2024-01-01'),
                updatedAt: new Date('2024-01-01'),
            }));
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(largeCommunityList);
            const startTime = Date.now();
            const result = await service.getUserRecommendations('user-123');
            const endTime = Date.now();
            expect(result.length).toBeLessThanOrEqual(10);
            expect(endTime - startTime).toBeLessThan(5000); // Should complete within 5 seconds
        });
        it('should handle concurrent user recommendation requests', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
            const promises = [
                service.getUserRecommendations('user-123'),
                service.getUserRecommendations('user-123'),
                service.getUserRecommendations('user-123'),
            ];
            const results = await Promise.all(promises);
            expect(results).toHaveLength(3);
            results.forEach(result => {
                expect(result).toBeInstanceOf(Array);
            });
        });
        it('should handle database timeout errors', async () => {
            const timeoutError = new Error('Connection timeout');
            prismaService.user.findUnique.mockRejectedValue(timeoutError);
            const errorSpy = jest.spyOn(common_1.Logger.prototype, 'error').mockImplementation();
            const result = await service.getUserRecommendations('user-123');
            expect(result).toEqual([]);
            expect(errorSpy).toHaveBeenCalledWith(expect.stringContaining('Error getting recommendations for user user-123'), timeoutError);
        });
        it('should handle malformed community data gracefully', async () => {
            const malformedCommunities = [
                {
                    // Missing required fields
                    id: 'community-malformed',
                    // name: missing
                    // slug: missing
                    description: 'Description',
                    _count: { memberships: 10 },
                },
            ];
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(malformedCommunities);
            const result = await service.getUserRecommendations('user-123');
            // Should handle gracefully without crashing
            expect(result).toBeInstanceOf(Array);
        });
        it('should maintain score precision', async () => {
            // Test with specific random values to check precision
            jest.spyOn(Math, 'random').mockReturnValue(0.123456789);
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            const score = await calculateCompatibilityScore([], mockCommunities[0]);
            expect(score).toBeCloseTo(0.32876, 5); // High precision check
        });
        it('should handle edge case scores in reason generation', async () => {
            const generateRecommendationReason = service.generateRecommendationReason.bind(service);
            // Test boundary values
            expect(generateRecommendationReason(0.800000001)).toBe('Excellent match based on your assessment responses');
            expect(generateRecommendationReason(0.799999999)).toBe('Good compatibility with your interests');
            expect(generateRecommendationReason(0.600000001)).toBe('Good compatibility with your interests');
            expect(generateRecommendationReason(0.599999999)).toBe('Potential good fit for your needs');
            expect(generateRecommendationReason(0.400000001)).toBe('Potential good fit for your needs');
            expect(generateRecommendationReason(0.399999999)).toBe('Moderate compatibility');
        });
        it('should handle negative scores gracefully', async () => {
            jest.spyOn(Math, 'random').mockReturnValue(-0.5); // Negative random (shouldn't happen but test anyway)
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            const score = await calculateCompatibilityScore([], mockCommunities[0]);
            expect(score).toBeGreaterThanOrEqual(0); // Should still be non-negative
        });
        it('should handle infinity and NaN in calculations', async () => {
            const communityWithInfiniteMembers = {
                ...mockCommunities[0],
                _count: { memberships: Infinity },
            };
            const calculateCompatibilityScore = service.calculateCompatibilityScore.bind(service);
            const score = await calculateCompatibilityScore([], communityWithInfiniteMembers);
            expect(score).toBeFinite();
            expect(score).not.toBeNaN();
        });
    });
    describe('recommendation data integrity', () => {
        it('should ensure all recommendations have required fields', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
            const result = await service.getUserRecommendations('user-123');
            result.forEach(recommendation => {
                expect(recommendation.id).toBeDefined();
                expect(recommendation.name).toBeDefined();
                expect(recommendation.slug).toBeDefined();
                expect(recommendation.description).toBeDefined();
                expect(recommendation.imageUrl).toBeDefined();
                expect(recommendation.memberCount).toBeDefined();
                expect(recommendation.compatibilityScore).toBeDefined();
                expect(recommendation.score).toBeDefined();
                expect(recommendation.reason).toBeDefined();
                expect(recommendation.status).toBeDefined();
                expect(recommendation.createdAt).toBeDefined();
                expect(recommendation.updatedAt).toBeDefined();
                expect(typeof recommendation.id).toBe('string');
                expect(typeof recommendation.name).toBe('string');
                expect(typeof recommendation.slug).toBe('string');
                expect(typeof recommendation.description).toBe('string');
                expect(typeof recommendation.imageUrl).toBe('string');
                expect(typeof recommendation.memberCount).toBe('number');
                expect(typeof recommendation.compatibilityScore).toBe('number');
                expect(typeof recommendation.score).toBe('number');
                expect(typeof recommendation.reason).toBe('string');
                expect(typeof recommendation.status).toBe('string');
                expect(recommendation.createdAt).toBeInstanceOf(Date);
                expect(recommendation.updatedAt).toBeInstanceOf(Date);
            });
        });
        it('should ensure score fields are in valid range', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
            const result = await service.getUserRecommendations('user-123');
            result.forEach(recommendation => {
                expect(recommendation.compatibilityScore).toBeGreaterThanOrEqual(0);
                expect(recommendation.compatibilityScore).toBeLessThanOrEqual(1);
                expect(recommendation.score).toBeGreaterThanOrEqual(0);
                expect(recommendation.score).toBeLessThanOrEqual(1);
                expect(recommendation.memberCount).toBeGreaterThanOrEqual(0);
            });
        });
        it('should ensure consistency between score fields', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
            const result = await service.getUserRecommendations('user-123');
            result.forEach(recommendation => {
                expect(recommendation.score).toBe(recommendation.compatibilityScore);
            });
        });
        it('should ensure status field is always set correctly', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            prismaService.community.findMany.mockResolvedValue(mockCommunities);
            const result = await service.getUserRecommendations('user-123');
            result.forEach(recommendation => {
                expect(recommendation.status).toBe('pending');
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL3NlcnZpY2VzL2NvbW11bml0eS1yZWNvbW1lbmRhdGlvbi5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQTJEO0FBQzNELHlGQUFvRjtBQUNwRixtRkFBdUU7QUFDdkUsNkVBQXdFO0FBRXhFLFFBQVEsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7SUFDOUMsSUFBSSxPQUF1QyxDQUFDO0lBQzVDLElBQUksYUFBeUMsQ0FBQztJQUM5QyxJQUFJLHdCQUErRCxDQUFDO0lBQ3BFLElBQUksU0FBMkIsQ0FBQztJQUVoQyxZQUFZO0lBQ1osTUFBTSxRQUFRLEdBQUc7UUFDZixFQUFFLEVBQUUsVUFBVTtRQUNkLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLFFBQVEsRUFBRSxLQUFLO1FBQ2YsS0FBSyxFQUFFLHNCQUFzQjtRQUM3QixRQUFRLEVBQUUsSUFBSTtRQUNkLFdBQVcsRUFBRTtZQUNYLEVBQUUsV0FBVyxFQUFFLHNCQUFzQixFQUFFO1lBQ3ZDLEVBQUUsV0FBVyxFQUFFLHNCQUFzQixFQUFFO1NBQ3hDO1FBQ0QsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztRQUNqQyxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO0tBQ2xDLENBQUM7SUFFRixNQUFNLDBCQUEwQixHQUFHO1FBQ2pDLEdBQUcsUUFBUTtRQUNYLFdBQVcsRUFBRSxFQUFFO0tBQ2hCLENBQUM7SUFFRixNQUFNLGVBQWUsR0FBRztRQUN0QjtZQUNFLEVBQUUsRUFBRSxlQUFlO1lBQ25CLElBQUksRUFBRSw0QkFBNEI7WUFDbEMsSUFBSSxFQUFFLG9CQUFvQjtZQUMxQixXQUFXLEVBQUUsdUNBQXVDO1lBQ3BELFFBQVEsRUFBRSxnQkFBZ0I7WUFDMUIsTUFBTSxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRTtZ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QUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9jb21tdW5pdGllcy9zZXJ2aWNlcy9jb21tdW5pdHktcmVjb21tZW5kYXRpb24uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgTG9nZ2VyLCBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IENvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZSB9IGZyb20gJy4vY29tbXVuaXR5LXJlY29tbWVuZGF0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IENvbW11bml0eU1hdGNoaW5nU2VydmljZSB9IGZyb20gJy4vY29tbXVuaXR5LW1hdGNoaW5nLnNlcnZpY2UnO1xuXG5kZXNjcmliZSgnQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlO1xuICBsZXQgcHJpc21hU2VydmljZTogamVzdC5Nb2NrZWQ8UHJpc21hU2VydmljZT47XG4gIGxldCBjb21tdW5pdHlNYXRjaGluZ1NlcnZpY2U6IGplc3QuTW9ja2VkPENvbW11bml0eU1hdGNoaW5nU2VydmljZT47XG4gIGxldCBsb2dnZXJTcHk6IGplc3QuU3B5SW5zdGFuY2U7XG5cbiAgLy8gTW9jayBkYXRhXG4gIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgIGlkOiAndXNlci0xMjMnLFxuICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICBlbWFpbDogJ2pvaG4uZG9lQGV4YW1wbGUuY29tJyxcbiAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICBtZW1iZXJzaGlwczogW1xuICAgICAgeyBjb21tdW5pdHlJZDogJ2NvbW11bml0eS1leGlzdGluZy0xJyB9LFxuICAgICAgeyBjb21tdW5pdHlJZDogJ2NvbW11bml0eS1leGlzdGluZy0yJyB9LFxuICAgIF0sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgfTtcblxuICBjb25zdCBtb2NrVXNlcldpdGhvdXRNZW1iZXJzaGlwcyA9IHtcbiAgICAuLi5tb2NrVXNlcixcbiAgICBtZW1iZXJzaGlwczogW10sXG4gIH07XG5cbiAgY29uc3QgbW9ja0NvbW11bml0aWVzID0gW1xuICAgIHtcbiAgICAgIGlkOiAnY29tbXVuaXR5LTEyMycsXG4gICAgICBuYW1lOiAnRGVwcmVzc2lvbiBTdXBwb3J0IE5ldHdvcmsnLFxuICAgICAgc2x1ZzogJ2RlcHJlc3Npb24tc3VwcG9ydCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ0Egc3VwcG9ydGl2ZSBjb21tdW5pdHkgZm9yIGRlcHJlc3Npb24nLFxuICAgICAgaW1hZ2VVcmw6ICdkZXByZXNzaW9uLmpwZycsXG4gICAgICBfY291bnQ6IHsgbWVtYmVyc2hpcHM6IDI1IH0sXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogJ2NvbW11bml0eS00NTYnLFxuICAgICAgbmFtZTogJ0FueGlldHkgV2FycmlvcnMnLFxuICAgICAgc2x1ZzogJ2FueGlldHktd2FycmlvcnMnLFxuICAgICAgZGVzY3JpcHRpb246ICdBIHN1cHBvcnRpdmUgY29tbXVuaXR5IGZvciBhbnhpZXR5JyxcbiAgICAgIGltYWdlVXJsOiAnYW54aWV0eS5qcGcnLFxuICAgICAgX2NvdW50OiB7IG1lbWJlcnNoaXBzOiA0NSB9LFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6ICdjb21tdW5pdHktNzg5JyxcbiAgICAgIG5hbWU6ICdQVFNEIFN1cHBvcnQgTmV0d29yaycsXG4gICAgICBzbHVnOiAncHRzZC1zdXBwb3J0JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQSBzdXBwb3J0aXZlIGNvbW11bml0eSBmb3IgUFRTRCcsXG4gICAgICBpbWFnZVVybDogJ3B0c2QuanBnJyxcbiAgICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogMTUgfSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAnY29tbXVuaXR5LXNtYWxsJyxcbiAgICAgIG5hbWU6ICdTbWFsbCBTdXBwb3J0IEdyb3VwJyxcbiAgICAgIHNsdWc6ICdzbWFsbC1zdXBwb3J0JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQSBzbWFsbCBpbnRpbWF0ZSBzdXBwb3J0IGdyb3VwJyxcbiAgICAgIGltYWdlVXJsOiAnc21hbGwuanBnJyxcbiAgICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogOCB9LCAvLyBTbWFsbCBjb21tdW5pdHlcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICB9LFxuICBdO1xuXG4gIGNvbnN0IG1vY2tMYXJnZUNvbW11bml0eSA9IHtcbiAgICBpZDogJ2NvbW11bml0eS1sYXJnZScsXG4gICAgbmFtZTogJ0xhcmdlIENvbW11bml0eScsXG4gICAgc2x1ZzogJ2xhcmdlLWNvbW11bml0eScsXG4gICAgZGVzY3JpcHRpb246ICdBIGxhcmdlIGNvbW11bml0eScsXG4gICAgaW1hZ2VVcmw6ICdsYXJnZS5qcGcnLFxuICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogMTUwIH0sIC8vIExhcmdlIGNvbW11bml0eVxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1ByaXNtYVNlcnZpY2UgPSB7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICAgIH0sXG4gICAgICBjb21tdW5pdHk6IHtcbiAgICAgICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja0NvbW11bml0eU1hdGNoaW5nU2VydmljZSA9IHtcbiAgICAgIGNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZTogamVzdC5mbigpLFxuICAgICAgZ2V0UmVjb21tZW5kYXRpb25zRm9yVXNlcjogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIENvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFByaXNtYVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQcmlzbWFTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ29tbXVuaXR5TWF0Y2hpbmdTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29tbXVuaXR5TWF0Y2hpbmdTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2U+KENvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZSk7XG4gICAgcHJpc21hU2VydmljZSA9IG1vZHVsZS5nZXQoUHJpc21hU2VydmljZSk7XG4gICAgY29tbXVuaXR5TWF0Y2hpbmdTZXJ2aWNlID0gbW9kdWxlLmdldChDb21tdW5pdHlNYXRjaGluZ1NlcnZpY2UpO1xuXG4gICAgLy8gU2V0dXAgbG9nZ2VyIHNwaWVzXG4gICAgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnd2FybicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICAgIGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAvLyBNb2NrIE1hdGgucmFuZG9tIGZvciBjb25zaXN0ZW50IHRlc3RpbmdcbiAgICBqZXN0LnNweU9uKE1hdGgsICdyYW5kb20nKS5tb2NrUmV0dXJuVmFsdWUoMC43KTsgLy8gV2lsbCByZXN1bHQgaW4gYmFzZSBzY29yZSBvZiAwLjc2XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXNlclJlY29tbWVuZGF0aW9ucycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdGllcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgd2l0aCBleGlzdGluZyBtZW1iZXJzaGlwcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBtZW1iZXJzaGlwczoge1xuICAgICAgICAgICAgc2VsZWN0OiB7IGNvbW11bml0eUlkOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogeyBub3RJbjogWydjb21tdW5pdHktZXhpc3RpbmctMScsICdjb21tdW5pdHktZXhpc3RpbmctMiddIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIHNlbGVjdDogeyBtZW1iZXJzaGlwczogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKDEwKTtcblxuICAgICAgLy8gVmVyaWZ5IHJlY29tbWVuZGF0aW9uIHN0cnVjdHVyZVxuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb24gPSByZXN1bHRbMF07XG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb24pLnRvSGF2ZVByb3BlcnR5KCdpZCcpO1xuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgnbmFtZScpO1xuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgnc2x1ZycpO1xuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgnZGVzY3JpcHRpb24nKTtcbiAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbikudG9IYXZlUHJvcGVydHkoJ2ltYWdlVXJsJyk7XG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb24pLnRvSGF2ZVByb3BlcnR5KCdtZW1iZXJDb3VudCcpO1xuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgnY29tcGF0aWJpbGl0eVNjb3JlJyk7XG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb24pLnRvSGF2ZVByb3BlcnR5KCdzY29yZScpO1xuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgncmVhc29uJyk7XG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb24pLnRvSGF2ZVByb3BlcnR5KCdzdGF0dXMnKTtcbiAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbikudG9IYXZlUHJvcGVydHkoJ2NyZWF0ZWRBdCcpO1xuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgndXBkYXRlZEF0Jyk7XG5cbiAgICAgIC8vIFZlcmlmeSBzY29yZSBpcyBhbGlhcyBmb3IgY29tcGF0aWJpbGl0eVNjb3JlXG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uc2NvcmUpLnRvQmUocmVjb21tZW5kYXRpb24uY29tcGF0aWJpbGl0eVNjb3JlKTtcbiAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5zdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlY29tbWVuZGF0aW9ucyBmb3IgdXNlciB3aXRob3V0IGV4aXN0aW5nIG1lbWJlcnNoaXBzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXJXaXRob3V0TWVtYmVyc2hpcHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmNvbW11bml0eS5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGlkOiB7IG5vdEluOiBbXSB9LFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHsgbWVtYmVyc2hpcHM6IHRydWUgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBvdXQgY29tbXVuaXRpZXMgd2l0aCBsb3cgY29tcGF0aWJpbGl0eSBzY29yZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGxvdyByYW5kb20gdmFsdWUgdG8gdGVzdCBmaWx0ZXJpbmdcbiAgICAgIGplc3Quc3B5T24oTWF0aCwgJ3JhbmRvbScpLm1vY2tSZXR1cm5WYWx1ZSgwLjEpOyAvLyBXaWxsIHJlc3VsdCBpbiBiYXNlIHNjb3JlIG9mIDAuMjhcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICAvLyBTaG91bGQgZmlsdGVyIG91dCByZWNvbW1lbmRhdGlvbnMgd2l0aCBzY29yZSA8PSAwLjNcbiAgICAgIHJlc3VsdC5mb3JFYWNoKHJlY29tbWVuZGF0aW9uID0+IHtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLmNvbXBhdGliaWxpdHlTY29yZSkudG9CZUdyZWF0ZXJUaGFuKDAuMyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc29ydCByZWNvbW1lbmRhdGlvbnMgYnkgY29tcGF0aWJpbGl0eSBzY29yZSBpbiBkZXNjZW5kaW5nIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayB2YXJ5aW5nIHNjb3Jlc1xuICAgICAgamVzdC5zcHlPbihNYXRoLCAncmFuZG9tJylcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoMC44KSAvLyAwLjg0ICsgc2l6ZSBib251c1xuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSgwLjUpIC8vIDAuNiArIHNpemUgYm9udXNcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoMC4zKSAvLyAwLjQ0ICsgc2l6ZSBib251c1xuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSgwLjcpOyAvLyAwLjc2ICsgc2l6ZSBib251c1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIC8vIFNob3VsZCBiZSBzb3J0ZWQgYnkgc2NvcmUgKGhpZ2hlc3QgZmlyc3QpXG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykge1xuICAgICAgICBleHBlY3QocmVzdWx0W2ktMV0uY29tcGF0aWJpbGl0eVNjb3JlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKHJlc3VsdFtpXS5jb21wYXRpYmlsaXR5U2NvcmUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsaW1pdCByZXN1bHRzIHRvIHRvcCAxMCByZWNvbW1lbmRhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIG1hbnkgY29tbXVuaXRpZXNcbiAgICAgIGNvbnN0IG1hbnlDb21tdW5pdGllcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDE1IH0sIChfLCBpKSA9PiAoe1xuICAgICAgICBpZDogYGNvbW11bml0eS0ke2l9YCxcbiAgICAgICAgbmFtZTogYENvbW11bml0eSAke2l9YCxcbiAgICAgICAgc2x1ZzogYGNvbW11bml0eS0ke2l9YCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBEZXNjcmlwdGlvbiAke2l9YCxcbiAgICAgICAgaW1hZ2VVcmw6IGBpbWFnZS0ke2l9LmpwZ2AsXG4gICAgICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogMjAgfSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgICB9KSk7XG5cbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1hbnlDb21tdW5pdGllcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhcHBseSBzaXplIGJvbnVzIGZvciBzbWFsbCBjb21tdW5pdGllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3Qgd2l0aCBjb21tdW5pdGllcyBvZiBkaWZmZXJlbnQgc2l6ZXNcbiAgICAgIGNvbnN0IGNvbW11bml0aWVzV2l0aFNpemVzID0gW1xuICAgICAgICB7IC4uLm1vY2tDb21tdW5pdGllc1swXSwgX2NvdW50OiB7IG1lbWJlcnNoaXBzOiA4IH0gfSwgLy8gU21hbGwgLSBzaG91bGQgZ2V0IGJvbnVzXG4gICAgICAgIHsgLi4ubW9ja0NvbW11bml0aWVzWzFdLCBfY291bnQ6IHsgbWVtYmVyc2hpcHM6IDUwIH0gfSwgLy8gTGFyZ2UgLSBubyBib251c1xuICAgICAgXTtcbiAgICAgIFxuICAgICAgcHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoY29tbXVuaXRpZXNXaXRoU2l6ZXMpO1xuXG4gICAgICAvLyBNb2NrIGNvbnNpc3RlbnQgYmFzZSBzY29yZVxuICAgICAgamVzdC5zcHlPbihNYXRoLCAncmFuZG9tJykubW9ja1JldHVyblZhbHVlKDAuNik7IC8vIEJhc2Ugc2NvcmUgMC42OFxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIC8vIFNtYWxsIGNvbW11bml0eSBzaG91bGQgaGF2ZSBoaWdoZXIgc2NvcmUgZHVlIHRvIHNpemUgYm9udXNcbiAgICAgIGNvbnN0IHNtYWxsQ29tbXVuaXR5UmVjID0gcmVzdWx0LmZpbmQociA9PiByLm1lbWJlckNvdW50ID09PSA4KTtcbiAgICAgIGNvbnN0IGxhcmdlQ29tbXVuaXR5UmVjID0gcmVzdWx0LmZpbmQociA9PiByLm1lbWJlckNvdW50ID09PSA1MCk7XG5cbiAgICAgIGlmIChzbWFsbENvbW11bml0eVJlYyAmJiBsYXJnZUNvbW11bml0eVJlYykge1xuICAgICAgICBleHBlY3Qoc21hbGxDb21tdW5pdHlSZWMuY29tcGF0aWJpbGl0eVNjb3JlKS50b0JlR3JlYXRlclRoYW4obGFyZ2VDb21tdW5pdHlSZWMuY29tcGF0aWJpbGl0eVNjb3JlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gZm9yIG5vbi1leGlzdGVudCB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ25vbi1leGlzdGVudC11c2VyJykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdVc2VyIG5vbi1leGlzdGVudC11c2VyIG5vdCBmb3VuZCcpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0RhdGFiYXNlIGVycm9yJykpO1xuXG4gICAgICBjb25zdCBlcnJvclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QoZXJyb3JTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnRXJyb3IgZ2V0dGluZyByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgdXNlci0xMjMnKSxcbiAgICAgICAgZXhwZWN0LmFueShFcnJvcilcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBjb21tdW5pdGllcyBsaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tbXVuaXRpZXMgd2l0aCBtaXNzaW5nIGNvdW50IGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb21tdW5pdGllc1dpdGhvdXRDb3VudCA9IFtcbiAgICAgICAge1xuICAgICAgICAgIC4uLm1vY2tDb21tdW5pdGllc1swXSxcbiAgICAgICAgICBfY291bnQ6IHsgbWVtYmVyc2hpcHM6IHVuZGVmaW5lZCB9LFxuICAgICAgICB9LFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgcHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoY29tbXVuaXRpZXNXaXRob3V0Q291bnQgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICAvLyBTaG91bGQgaGFuZGxlIGdyYWNlZnVsbHkgd2l0aG91dCBjcmFzaGluZ1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZXQgYXBwcm9wcmlhdGUgdGltZXN0YW1wcyBmb3IgcmVjb21tZW5kYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYmVmb3JlQ2FsbCA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG4gICAgICBjb25zdCBhZnRlckNhbGwgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgcmVjb21tZW5kYXRpb24gPSByZXN1bHRbMF07XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5jcmVhdGVkQXQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24udXBkYXRlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLmNyZWF0ZWRBdC5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoYmVmb3JlQ2FsbC5nZXRUaW1lKCkpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uY3JlYXRlZEF0LmdldFRpbWUoKSkudG9CZUxlc3NUaGFuT3JFcXVhbChhZnRlckNhbGwuZ2V0VGltZSgpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oTWF0aCwgJ3JhbmRvbScpLm1vY2tSZXR1cm5WYWx1ZSgwLjYpOyAvLyBCYXNlIHNjb3JlIDAuNjhcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGJhc2UgY29tcGF0aWJpbGl0eSBzY29yZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZSA9IChzZXJ2aWNlIGFzIGFueSkuY2FsY3VsYXRlQ29tcGF0aWJpbGl0eVNjb3JlLmJpbmQoc2VydmljZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNjb3JlID0gYXdhaXQgY2FsY3VsYXRlQ29tcGF0aWJpbGl0eVNjb3JlKFtdLCBtb2NrQ29tbXVuaXRpZXNbMF0pO1xuXG4gICAgICBleHBlY3Qoc2NvcmUpLnRvQmVDbG9zZVRvKDAuNzgsIDIpOyAvLyAwLjY4ICsgMC4xIChzaXplIGJvbnVzKVxuICAgICAgZXhwZWN0KHNjb3JlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDAuMik7XG4gICAgICBleHBlY3Qoc2NvcmUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMS4wKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXBwbHkgc2l6ZSBib251cyBmb3Igc21hbGwgY29tbXVuaXRpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUgPSAoc2VydmljZSBhcyBhbnkpLmNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZS5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICBjb25zdCBzbWFsbENvbW11bml0eVNjb3JlID0gYXdhaXQgY2FsY3VsYXRlQ29tcGF0aWJpbGl0eVNjb3JlKFtdLCBtb2NrQ29tbXVuaXRpZXNbM10pOyAvLyA4IG1lbWJlcnNcbiAgICAgIGNvbnN0IGxhcmdlQ29tbXVuaXR5U2NvcmUgPSBhd2FpdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUoW10sIG1vY2tMYXJnZUNvbW11bml0eSk7IC8vIDE1MCBtZW1iZXJzXG5cbiAgICAgIGV4cGVjdChzbWFsbENvbW11bml0eVNjb3JlKS50b0JlR3JlYXRlclRoYW4obGFyZ2VDb21tdW5pdHlTY29yZSk7XG4gICAgICBleHBlY3Qoc21hbGxDb21tdW5pdHlTY29yZSAtIGxhcmdlQ29tbXVuaXR5U2NvcmUpLnRvQmVDbG9zZVRvKDAuMSwgMik7IC8vIFNpemUgYm9udXMgZGlmZmVyZW5jZVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYXAgbWF4aW11bSBzY29yZSBhdCAxLjAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUgPSAoc2VydmljZSBhcyBhbnkpLmNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZS5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICAvLyBNb2NrIHZlcnkgaGlnaCByYW5kb20gdmFsdWVcbiAgICAgIGplc3Quc3B5T24oTWF0aCwgJ3JhbmRvbScpLm1vY2tSZXR1cm5WYWx1ZSgwLjk1KTsgLy8gQmFzZSBzY29yZSAwLjk2ICsgMC4xID0gMS4wNlxuXG4gICAgICBjb25zdCBzY29yZSA9IGF3YWl0IGNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZShbXSwgbW9ja0NvbW11bml0aWVzWzNdKTsgLy8gU21hbGwgY29tbXVuaXR5XG5cbiAgICAgIGV4cGVjdChzY29yZSkudG9CZSgxLjApOyAvLyBTaG91bGQgYmUgY2FwcGVkIGF0IDEuMFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tbXVuaXRpZXMgd2l0aG91dCBtZW1iZXIgY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUgPSAoc2VydmljZSBhcyBhbnkpLmNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZS5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICBjb25zdCBjb21tdW5pdHlXaXRob3V0Q291bnQgPSB7XG4gICAgICAgIC4uLm1vY2tDb21tdW5pdGllc1swXSxcbiAgICAgICAgX2NvdW50OiB7IG1lbWJlcnNoaXBzOiB1bmRlZmluZWQgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNjb3JlID0gYXdhaXQgY2FsY3VsYXRlQ29tcGF0aWJpbGl0eVNjb3JlKFtdLCBjb21tdW5pdHlXaXRob3V0Q291bnQpO1xuXG4gICAgICBleHBlY3Qoc2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMC4yKTtcbiAgICAgIGV4cGVjdChzY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbCgxLjApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGNvbnNpc3RlbnQgc2NvcmVzIGZvciBzYW1lIGNvbW11bml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZSA9IChzZXJ2aWNlIGFzIGFueSkuY2FsY3VsYXRlQ29tcGF0aWJpbGl0eVNjb3JlLmJpbmQoc2VydmljZSk7XG4gICAgICBcbiAgICAgIC8vIE1vY2sgY29uc2lzdGVudCByYW5kb20gdmFsdWVcbiAgICAgIGplc3Quc3B5T24oTWF0aCwgJ3JhbmRvbScpLm1vY2tSZXR1cm5WYWx1ZSgwLjUpO1xuXG4gICAgICBjb25zdCBzY29yZTEgPSBhd2FpdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUoW10sIG1vY2tDb21tdW5pdGllc1swXSk7XG4gICAgICBjb25zdCBzY29yZTIgPSBhd2FpdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUoW10sIG1vY2tDb21tdW5pdGllc1swXSk7XG5cbiAgICAgIGV4cGVjdChzY29yZTEpLnRvQmUoc2NvcmUyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBhcHByb3ByaWF0ZSByZWFzb24gZm9yIGV4Y2VsbGVudCBtYXRjaCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24gPSAoc2VydmljZSBhcyBhbnkpLmdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24uYmluZChzZXJ2aWNlKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVhc29uID0gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbigwLjg1KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlYXNvbikudG9CZSgnRXhjZWxsZW50IG1hdGNoIGJhc2VkIG9uIHlvdXIgYXNzZXNzbWVudCByZXNwb25zZXMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgYXBwcm9wcmlhdGUgcmVhc29uIGZvciBnb29kIGNvbXBhdGliaWxpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBnZW5lcmF0ZVJlY29tbWVuZGF0aW9uUmVhc29uID0gKHNlcnZpY2UgYXMgYW55KS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uUmVhc29uLmJpbmQoc2VydmljZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlYXNvbiA9IGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC42NSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZWFzb24pLnRvQmUoJ0dvb2QgY29tcGF0aWJpbGl0eSB3aXRoIHlvdXIgaW50ZXJlc3RzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGFwcHJvcHJpYXRlIHJlYXNvbiBmb3IgcG90ZW50aWFsIGdvb2QgZml0JywgKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbiA9IChzZXJ2aWNlIGFzIGFueSkuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbi5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICBjb25zdCByZWFzb24gPSBnZW5lcmF0ZVJlY29tbWVuZGF0aW9uUmVhc29uKDAuNDUpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVhc29uKS50b0JlKCdQb3RlbnRpYWwgZ29vZCBmaXQgZm9yIHlvdXIgbmVlZHMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgYXBwcm9wcmlhdGUgcmVhc29uIGZvciBtb2RlcmF0ZSBjb21wYXRpYmlsaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbiA9IChzZXJ2aWNlIGFzIGFueSkuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbi5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICBjb25zdCByZWFzb24gPSBnZW5lcmF0ZVJlY29tbWVuZGF0aW9uUmVhc29uKDAuMzUpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVhc29uKS50b0JlKCdNb2RlcmF0ZSBjb21wYXRpYmlsaXR5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlZGdlIGNhc2Ugc2NvcmVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbiA9IChzZXJ2aWNlIGFzIGFueSkuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbi5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICBleHBlY3QoZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbigwLjgpKS50b0JlKCdFeGNlbGxlbnQgbWF0Y2ggYmFzZWQgb24geW91ciBhc3Nlc3NtZW50IHJlc3BvbnNlcycpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC42KSkudG9CZSgnR29vZCBjb21wYXRpYmlsaXR5IHdpdGggeW91ciBpbnRlcmVzdHMnKTtcbiAgICAgIGV4cGVjdChnZW5lcmF0ZVJlY29tbWVuZGF0aW9uUmVhc29uKDAuNCkpLnRvQmUoJ1BvdGVudGlhbCBnb29kIGZpdCBmb3IgeW91ciBuZWVkcycpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC4wKSkudG9CZSgnTW9kZXJhdGUgY29tcGF0aWJpbGl0eScpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMS4wKSkudG9CZSgnRXhjZWxsZW50IG1hdGNoIGJhc2VkIG9uIHlvdXIgYXNzZXNzbWVudCByZXNwb25zZXMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyBnZW5lcmF0aW9uIG1lc3NhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlcigndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdHZW5lcmF0ZWQgcmVjb21tZW5kYXRpb25zIGZvciB1c2VyIHVzZXItMTIzIChjYWxjdWxhdGVkIG9uLWRlbWFuZCknXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgZ2VuZXJhdGlvbiBtZXNzYWdlIHdpdGggZm9yY2UgZmxhZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyKCd1c2VyLTEyMycsIHRydWUpO1xuXG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0dlbmVyYXRlZCByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgdXNlci0xMjMgKGNhbGN1bGF0ZWQgb24tZGVtYW5kKSdcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkaWZmZXJlbnQgdXNlciBJRHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlcigndXNlci00NTYnKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdHZW5lcmF0ZWQgcmVjb21tZW5kYXRpb25zIGZvciB1c2VyIHVzZXItNDU2IChjYWxjdWxhdGVkIG9uLWRlbWFuZCknXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgdGhyb3cgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyKCd1c2VyLTEyMycpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UmVjb21tZW5kYXRpb25CeUlkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIGFueSByZWNvbW1lbmRhdGlvbiBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0UmVjb21tZW5kYXRpb25CeUlkKCdyZWNvbW1lbmRhdGlvbi0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIGRpZmZlcmVudCByZWNvbW1lbmRhdGlvbiBJRHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQxID0gYXdhaXQgc2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQoJ3JlYy0xJyk7XG4gICAgICBjb25zdCByZXN1bHQyID0gYXdhaXQgc2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQoJ3JlYy0yJyk7XG4gICAgICBjb25zdCByZXN1bHQzID0gYXdhaXQgc2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQoJycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0MSkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQyKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdDMpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsb25nIHJlY29tbWVuZGF0aW9uIElEcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxvbmdJZCA9ICdhJy5yZXBlYXQoMTAwMCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uQnlJZChsb25nSWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBtb2NrSW50ZXJhY3Rpb25EYXRhID0ge1xuICAgICAgcmVjb21tZW5kYXRpb25JZDogJ3JlYy0xMjMnLFxuICAgICAgYWN0aW9uOiAnYWNjZXB0JyxcbiAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgaW50ZXJhY3Rpb24gZm9yIGFjY2VwdCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24obW9ja0ludGVyYWN0aW9uRGF0YSk7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnVXNlciB1c2VyLTEyMyBhY2NlcHRlZCByZWNvbW1lbmRhdGlvbiByZWMtMTIzJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGludGVyYWN0aW9uIGZvciByZWplY3QgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVqZWN0RGF0YSA9IHsgLi4ubW9ja0ludGVyYWN0aW9uRGF0YSwgYWN0aW9uOiAncmVqZWN0JyB9O1xuICAgICAgXG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24ocmVqZWN0RGF0YSk7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnVXNlciB1c2VyLTEyMyByZWplY3RlZCByZWNvbW1lbmRhdGlvbiByZWMtMTIzJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGludGVyYWN0aW9uIGZvciB2aWV3IGFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZpZXdEYXRhID0geyAuLi5tb2NrSW50ZXJhY3Rpb25EYXRhLCBhY3Rpb246ICd2aWV3JyB9O1xuICAgICAgXG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24odmlld0RhdGEpO1xuXG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ1VzZXIgdXNlci0xMjMgdmlld2VkIHJlY29tbWVuZGF0aW9uIHJlYy0xMjMnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY3VzdG9tIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjdXN0b21EYXRhID0geyAuLi5tb2NrSW50ZXJhY3Rpb25EYXRhLCBhY3Rpb246ICdib29rbWFyaycgfTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKGN1c3RvbURhdGEpO1xuXG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ1VzZXIgdXNlci0xMjMgYm9va21hcmtlZCByZWNvbW1lbmRhdGlvbiByZWMtMTIzJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRpZmZlcmVudCB1c2VyIElEcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRpZmZlcmVudFVzZXJEYXRhID0geyAuLi5tb2NrSW50ZXJhY3Rpb25EYXRhLCB1c2VySWQ6ICd1c2VyLTQ1NicgfTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKGRpZmZlcmVudFVzZXJEYXRhKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdVc2VyIHVzZXItNDU2IGFjY2VwdGVkIHJlY29tbWVuZGF0aW9uIHJlYy0xMjMnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlmZmVyZW50IHJlY29tbWVuZGF0aW9uIElEcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRpZmZlcmVudFJlY0RhdGEgPSB7IC4uLm1vY2tJbnRlcmFjdGlvbkRhdGEsIHJlY29tbWVuZGF0aW9uSWQ6ICdyZWMtNDU2JyB9O1xuICAgICAgXG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24oZGlmZmVyZW50UmVjRGF0YSk7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnVXNlciB1c2VyLTEyMyBhY2NlcHRlZCByZWNvbW1lbmRhdGlvbiByZWMtNDU2J1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHRocm93IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKG1vY2tJbnRlcmFjdGlvbkRhdGEpXG4gICAgICApLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBhY3Rpb24gc3RyaW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtcHR5QWN0aW9uRGF0YSA9IHsgLi4ubW9ja0ludGVyYWN0aW9uRGF0YSwgYWN0aW9uOiAnJyB9O1xuICAgICAgXG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24oZW1wdHlBY3Rpb25EYXRhKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdVc2VyIHVzZXItMTIzIGVkIHJlY29tbWVuZGF0aW9uIHJlYy0xMjMnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzcGVjaWFsQWN0aW9uRGF0YSA9IHsgLi4ubW9ja0ludGVyYWN0aW9uRGF0YSwgYWN0aW9uOiAnYWN0aW9uLXdpdGgtZGFzaGVzX2FuZF91bmRlcnNjb3JlcycgfTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKHNwZWNpYWxBY3Rpb25EYXRhKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdVc2VyIHVzZXItMTIzIGFjdGlvbi13aXRoLWRhc2hlc19hbmRfdW5kZXJzY29yZXNlZCByZWNvbW1lbmRhdGlvbiByZWMtMTIzJ1xuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFJlY29tbWVuZGF0aW9uU3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBzdGF0cyBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zOiAwLFxuICAgICAgICBhY2NlcHRlZFJlY29tbWVuZGF0aW9uczogMCxcbiAgICAgICAgcmVqZWN0ZWRSZWNvbW1lbmRhdGlvbnM6IDAsXG4gICAgICAgIHBlbmRpbmdSZWNvbW1lbmRhdGlvbnM6IDAsXG4gICAgICAgIGF2ZXJhZ2VDb21wYXRpYmlsaXR5U2NvcmU6IDAsXG4gICAgICAgIHRvcENvbW11bml0aWVzOiBbXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29uc2lzdGVudCBzdGF0cyBzdHJ1Y3R1cmUgb24gbXVsdGlwbGUgY2FsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQxID0gYXdhaXQgc2VydmljZS5nZXRSZWNvbW1lbmRhdGlvblN0YXRzKCk7XG4gICAgICBjb25zdCByZXN1bHQyID0gYXdhaXQgc2VydmljZS5nZXRSZWNvbW1lbmRhdGlvblN0YXRzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQxKS50b0VxdWFsKHJlc3VsdDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGFsbCByZXF1aXJlZCBwcm9wZXJ0aWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRSZWNvbW1lbmRhdGlvblN0YXRzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbFJlY29tbWVuZGF0aW9ucycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2FjY2VwdGVkUmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmVqZWN0ZWRSZWNvbW1lbmRhdGlvbnMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdwZW5kaW5nUmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnYXZlcmFnZUNvbXBhdGliaWxpdHlTY29yZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3RvcENvbW11bml0aWVzJyk7XG5cbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnRvdGFsUmVjb21tZW5kYXRpb25zKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmFjY2VwdGVkUmVjb21tZW5kYXRpb25zKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnJlamVjdGVkUmVjb21tZW5kYXRpb25zKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnBlbmRpbmdSZWNvbW1lbmRhdGlvbnMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuYXZlcmFnZUNvbXBhdGliaWxpdHlTY29yZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQudG9wQ29tbXVuaXRpZXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgdGhyb3cgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2V0UmVjb21tZW5kYXRpb25TdGF0cygpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZWRnZSBjYXNlcyBhbmQgZXJyb3IgaGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdXNlciB3aXRoIG51bGwgbWVtYmVyc2hpcHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyV2l0aE51bGxNZW1iZXJzaGlwcyA9IHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIG1lbWJlcnNoaXBzOiBudWxsLFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUodXNlcldpdGhOdWxsTWVtYmVyc2hpcHMgYXMgYW55KTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdGllcyk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJykpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tbXVuaXRpZXMgd2l0aCBudWxsIG1lbWJlciBjb3VudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb21tdW5pdGllc1dpdGhOdWxsQ291bnRzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgLi4ubW9ja0NvbW11bml0aWVzWzBdLFxuICAgICAgICAgIF9jb3VudDogbnVsbCxcbiAgICAgICAgfSxcbiAgICAgIF07XG4gICAgICBcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKGNvbW11bml0aWVzV2l0aE51bGxDb3VudHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihBcnJheSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2ZXJ5IGxhcmdlIG51bWJlcnMgb2YgY29tbXVuaXRpZXMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsYXJnZUNvbW11bml0eUxpc3QgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAwIH0sIChfLCBpKSA9PiAoe1xuICAgICAgICBpZDogYGNvbW11bml0eS0ke2l9YCxcbiAgICAgICAgbmFtZTogYENvbW11bml0eSAke2l9YCxcbiAgICAgICAgc2x1ZzogYGNvbW11bml0eS0ke2l9YCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBEZXNjcmlwdGlvbiAke2l9YCxcbiAgICAgICAgaW1hZ2VVcmw6IGBpbWFnZS0ke2l9LmpwZ2AsXG4gICAgICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogaSAlIDEwMCB9LCAvLyBWYXJ5aW5nIHNpemVzXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgfSkpO1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNvbW11bml0eS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShsYXJnZUNvbW11bml0eUxpc3QpO1xuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKDEwKTtcbiAgICAgIGV4cGVjdChlbmRUaW1lIC0gc3RhcnRUaW1lKS50b0JlTGVzc1RoYW4oNTAwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gNSBzZWNvbmRzXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHVzZXIgcmVjb21tZW5kYXRpb24gcmVxdWVzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNvbW11bml0eS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXRpZXMpO1xuXG4gICAgICBjb25zdCBwcm9taXNlcyA9IFtcbiAgICAgICAgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpLFxuICAgICAgICBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyksXG4gICAgICAgIHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSB0aW1lb3V0IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRpbWVvdXRFcnJvciA9IG5ldyBFcnJvcignQ29ubmVjdGlvbiB0aW1lb3V0Jyk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVqZWN0ZWRWYWx1ZSh0aW1lb3V0RXJyb3IpO1xuXG4gICAgICBjb25zdCBlcnJvclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QoZXJyb3JTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnRXJyb3IgZ2V0dGluZyByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgdXNlci0xMjMnKSxcbiAgICAgICAgdGltZW91dEVycm9yXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIGNvbW11bml0eSBkYXRhIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWxmb3JtZWRDb21tdW5pdGllcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIC8vIE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXG4gICAgICAgICAgaWQ6ICdjb21tdW5pdHktbWFsZm9ybWVkJyxcbiAgICAgICAgICAvLyBuYW1lOiBtaXNzaW5nXG4gICAgICAgICAgLy8gc2x1ZzogbWlzc2luZ1xuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRGVzY3JpcHRpb24nLFxuICAgICAgICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogMTAgfSxcbiAgICAgICAgfSxcbiAgICAgIF07XG4gICAgICBcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1hbGZvcm1lZENvbW11bml0aWVzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKTtcblxuICAgICAgLy8gU2hvdWxkIGhhbmRsZSBncmFjZWZ1bGx5IHdpdGhvdXQgY3Jhc2hpbmdcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gc2NvcmUgcHJlY2lzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB3aXRoIHNwZWNpZmljIHJhbmRvbSB2YWx1ZXMgdG8gY2hlY2sgcHJlY2lzaW9uXG4gICAgICBqZXN0LnNweU9uKE1hdGgsICdyYW5kb20nKS5tb2NrUmV0dXJuVmFsdWUoMC4xMjM0NTY3ODkpO1xuICAgICAgXG4gICAgICBjb25zdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUgPSAoc2VydmljZSBhcyBhbnkpLmNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZS5iaW5kKHNlcnZpY2UpO1xuICAgICAgY29uc3Qgc2NvcmUgPSBhd2FpdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUoW10sIG1vY2tDb21tdW5pdGllc1swXSk7XG5cbiAgICAgIGV4cGVjdChzY29yZSkudG9CZUNsb3NlVG8oMC4zMjg3NiwgNSk7IC8vIEhpZ2ggcHJlY2lzaW9uIGNoZWNrXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlZGdlIGNhc2Ugc2NvcmVzIGluIHJlYXNvbiBnZW5lcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbiA9IChzZXJ2aWNlIGFzIGFueSkuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbi5iaW5kKHNlcnZpY2UpO1xuICAgICAgXG4gICAgICAvLyBUZXN0IGJvdW5kYXJ5IHZhbHVlc1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC44MDAwMDAwMDEpKS50b0JlKCdFeGNlbGxlbnQgbWF0Y2ggYmFzZWQgb24geW91ciBhc3Nlc3NtZW50IHJlc3BvbnNlcycpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC43OTk5OTk5OTkpKS50b0JlKCdHb29kIGNvbXBhdGliaWxpdHkgd2l0aCB5b3VyIGludGVyZXN0cycpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC42MDAwMDAwMDEpKS50b0JlKCdHb29kIGNvbXBhdGliaWxpdHkgd2l0aCB5b3VyIGludGVyZXN0cycpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVjb21tZW5kYXRpb25SZWFzb24oMC41OTk5OTk5OTkpKS50b0JlKCdQb3RlbnRpYWwgZ29vZCBmaXQgZm9yIHlvdXIgbmVlZHMnKTtcbiAgICAgIGV4cGVjdChnZW5lcmF0ZVJlY29tbWVuZGF0aW9uUmVhc29uKDAuNDAwMDAwMDAxKSkudG9CZSgnUG90ZW50aWFsIGdvb2QgZml0IGZvciB5b3VyIG5lZWRzJyk7XG4gICAgICBleHBlY3QoZ2VuZXJhdGVSZWNvbW1lbmRhdGlvblJlYXNvbigwLjM5OTk5OTk5OSkpLnRvQmUoJ01vZGVyYXRlIGNvbXBhdGliaWxpdHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lZ2F0aXZlIHNjb3JlcyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihNYXRoLCAncmFuZG9tJykubW9ja1JldHVyblZhbHVlKC0wLjUpOyAvLyBOZWdhdGl2ZSByYW5kb20gKHNob3VsZG4ndCBoYXBwZW4gYnV0IHRlc3QgYW55d2F5KVxuICAgICAgXG4gICAgICBjb25zdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUgPSAoc2VydmljZSBhcyBhbnkpLmNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZS5iaW5kKHNlcnZpY2UpO1xuICAgICAgY29uc3Qgc2NvcmUgPSBhd2FpdCBjYWxjdWxhdGVDb21wYXRpYmlsaXR5U2NvcmUoW10sIG1vY2tDb21tdW5pdGllc1swXSk7XG5cbiAgICAgIGV4cGVjdChzY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTsgLy8gU2hvdWxkIHN0aWxsIGJlIG5vbi1uZWdhdGl2ZVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW5maW5pdHkgYW5kIE5hTiBpbiBjYWxjdWxhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb21tdW5pdHlXaXRoSW5maW5pdGVNZW1iZXJzID0ge1xuICAgICAgICAuLi5tb2NrQ29tbXVuaXRpZXNbMF0sXG4gICAgICAgIF9jb3VudDogeyBtZW1iZXJzaGlwczogSW5maW5pdHkgfSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IGNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZSA9IChzZXJ2aWNlIGFzIGFueSkuY2FsY3VsYXRlQ29tcGF0aWJpbGl0eVNjb3JlLmJpbmQoc2VydmljZSk7XG4gICAgICBjb25zdCBzY29yZSA9IGF3YWl0IGNhbGN1bGF0ZUNvbXBhdGliaWxpdHlTY29yZShbXSwgY29tbXVuaXR5V2l0aEluZmluaXRlTWVtYmVycyk7XG5cbiAgICAgIGV4cGVjdChzY29yZSkudG9CZUZpbml0ZSgpO1xuICAgICAgZXhwZWN0KHNjb3JlKS5ub3QudG9CZU5hTigpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVjb21tZW5kYXRpb24gZGF0YSBpbnRlZ3JpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbnN1cmUgYWxsIHJlY29tbWVuZGF0aW9ucyBoYXZlIHJlcXVpcmVkIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdGllcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucygndXNlci0xMjMnKTtcblxuICAgICAgcmVzdWx0LmZvckVhY2gocmVjb21tZW5kYXRpb24gPT4ge1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uaWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5uYW1lKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uc2x1ZykudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLmRlc2NyaXB0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uaW1hZ2VVcmwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5tZW1iZXJDb3VudCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLmNvbXBhdGliaWxpdHlTY29yZSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLnNjb3JlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24ucmVhc29uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uc3RhdHVzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uY3JlYXRlZEF0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24udXBkYXRlZEF0KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgICAgIGV4cGVjdCh0eXBlb2YgcmVjb21tZW5kYXRpb24uaWQpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICBleHBlY3QodHlwZW9mIHJlY29tbWVuZGF0aW9uLm5hbWUpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICBleHBlY3QodHlwZW9mIHJlY29tbWVuZGF0aW9uLnNsdWcpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICBleHBlY3QodHlwZW9mIHJlY29tbWVuZGF0aW9uLmRlc2NyaXB0aW9uKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiByZWNvbW1lbmRhdGlvbi5pbWFnZVVybCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgcmVjb21tZW5kYXRpb24ubWVtYmVyQ291bnQpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QodHlwZW9mIHJlY29tbWVuZGF0aW9uLmNvbXBhdGliaWxpdHlTY29yZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgcmVjb21tZW5kYXRpb24uc2NvcmUpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QodHlwZW9mIHJlY29tbWVuZGF0aW9uLnJlYXNvbikudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgcmVjb21tZW5kYXRpb24uc3RhdHVzKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLmNyZWF0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi51cGRhdGVkQXQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVuc3VyZSBzY29yZSBmaWVsZHMgYXJlIGluIHZhbGlkIHJhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgcHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbW11bml0aWVzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICByZXN1bHQuZm9yRWFjaChyZWNvbW1lbmRhdGlvbiA9PiB7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5jb21wYXRpYmlsaXR5U2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5jb21wYXRpYmlsaXR5U2NvcmUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMSk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5zY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLnNjb3JlKS50b0JlTGVzc1RoYW5PckVxdWFsKDEpO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24ubWVtYmVyQ291bnQpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5zdXJlIGNvbnNpc3RlbmN5IGJldHdlZW4gc2NvcmUgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgcHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbW11bml0aWVzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKCd1c2VyLTEyMycpO1xuXG4gICAgICByZXN1bHQuZm9yRWFjaChyZWNvbW1lbmRhdGlvbiA9PiB7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5zY29yZSkudG9CZShyZWNvbW1lbmRhdGlvbi5jb21wYXRpYmlsaXR5U2NvcmUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVuc3VyZSBzdGF0dXMgZmllbGQgaXMgYWx3YXlzIHNldCBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNvbW11bml0eS5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXRpZXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMoJ3VzZXItMTIzJyk7XG5cbiAgICAgIHJlc3VsdC5mb3JFYWNoKHJlY29tbWVuZGF0aW9uID0+IHtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLnN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9