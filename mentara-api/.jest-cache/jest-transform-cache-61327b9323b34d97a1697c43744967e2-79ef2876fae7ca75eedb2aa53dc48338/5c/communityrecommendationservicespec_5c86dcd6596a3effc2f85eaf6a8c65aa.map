{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/community-recommendation.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/community-recommendation.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { Logger, NotFoundException } from '@nestjs/common';\nimport { CommunityRecommendationService } from './community-recommendation.service';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { CommunityMatchingService } from './community-matching.service';\n\ndescribe('CommunityRecommendationService', () => {\n  let service: CommunityRecommendationService;\n  let prismaService: jest.Mocked<PrismaService>;\n  let communityMatchingService: jest.Mocked<CommunityMatchingService>;\n  let loggerSpy: jest.SpyInstance;\n\n  // Mock data\n  const mockUser = {\n    id: 'user-123',\n    firstName: 'John',\n    lastName: 'Doe',\n    email: 'john.doe@example.com',\n    isActive: true,\n    memberships: [\n      { communityId: 'community-existing-1' },\n      { communityId: 'community-existing-2' },\n    ],\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockUserWithoutMemberships = {\n    ...mockUser,\n    memberships: [],\n  };\n\n  const mockCommunities = [\n    {\n      id: 'community-123',\n      name: 'Depression Support Network',\n      slug: 'depression-support',\n      description: 'A supportive community for depression',\n      imageUrl: 'depression.jpg',\n      _count: { memberships: 25 },\n      createdAt: new Date('2024-01-01'),\n      updatedAt: new Date('2024-01-01'),\n    },\n    {\n      id: 'community-456',\n      name: 'Anxiety Warriors',\n      slug: 'anxiety-warriors',\n      description: 'A supportive community for anxiety',\n      imageUrl: 'anxiety.jpg',\n      _count: { memberships: 45 },\n      createdAt: new Date('2024-01-01'),\n      updatedAt: new Date('2024-01-01'),\n    },\n    {\n      id: 'community-789',\n      name: 'PTSD Support Network',\n      slug: 'ptsd-support',\n      description: 'A supportive community for PTSD',\n      imageUrl: 'ptsd.jpg',\n      _count: { memberships: 15 },\n      createdAt: new Date('2024-01-01'),\n      updatedAt: new Date('2024-01-01'),\n    },\n    {\n      id: 'community-small',\n      name: 'Small Support Group',\n      slug: 'small-support',\n      description: 'A small intimate support group',\n      imageUrl: 'small.jpg',\n      _count: { memberships: 8 }, // Small community\n      createdAt: new Date('2024-01-01'),\n      updatedAt: new Date('2024-01-01'),\n    },\n  ];\n\n  const mockLargeCommunity = {\n    id: 'community-large',\n    name: 'Large Community',\n    slug: 'large-community',\n    description: 'A large community',\n    imageUrl: 'large.jpg',\n    _count: { memberships: 150 }, // Large community\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  beforeEach(async () => {\n    const mockPrismaService = {\n      user: {\n        findUnique: jest.fn(),\n      },\n      community: {\n        findMany: jest.fn(),\n        findUnique: jest.fn(),\n      },\n    };\n\n    const mockCommunityMatchingService = {\n      calculateCompatibilityScore: jest.fn(),\n      getRecommendationsForUser: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        CommunityRecommendationService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n        {\n          provide: CommunityMatchingService,\n          useValue: mockCommunityMatchingService,\n        },\n      ],\n    }).compile();\n\n    service = module.get<CommunityRecommendationService>(CommunityRecommendationService);\n    prismaService = module.get(PrismaService);\n    communityMatchingService = module.get(CommunityMatchingService);\n\n    // Setup logger spies\n    loggerSpy = jest.spyOn(Logger.prototype, 'log').mockImplementation();\n    jest.spyOn(Logger.prototype, 'warn').mockImplementation();\n    jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n    // Mock Math.random for consistent testing\n    jest.spyOn(Math, 'random').mockReturnValue(0.7); // Will result in base score of 0.76\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    jest.restoreAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('getUserRecommendations', () => {\n    beforeEach(() => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n    });\n\n    it('should return recommendations for user with existing memberships', async () => {\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(prismaService.user.findUnique).toHaveBeenCalledWith({\n        where: { id: 'user-123' },\n        include: {\n          memberships: {\n            select: { communityId: true },\n          },\n        },\n      });\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        where: {\n          id: { notIn: ['community-existing-1', 'community-existing-2'] },\n        },\n        include: {\n          _count: {\n            select: { memberships: true },\n          },\n        },\n      });\n\n      expect(result).toBeInstanceOf(Array);\n      expect(result.length).toBeGreaterThan(0);\n      expect(result.length).toBeLessThanOrEqual(10);\n\n      // Verify recommendation structure\n      const recommendation = result[0];\n      expect(recommendation).toHaveProperty('id');\n      expect(recommendation).toHaveProperty('name');\n      expect(recommendation).toHaveProperty('slug');\n      expect(recommendation).toHaveProperty('description');\n      expect(recommendation).toHaveProperty('imageUrl');\n      expect(recommendation).toHaveProperty('memberCount');\n      expect(recommendation).toHaveProperty('compatibilityScore');\n      expect(recommendation).toHaveProperty('score');\n      expect(recommendation).toHaveProperty('reason');\n      expect(recommendation).toHaveProperty('status');\n      expect(recommendation).toHaveProperty('createdAt');\n      expect(recommendation).toHaveProperty('updatedAt');\n\n      // Verify score is alias for compatibilityScore\n      expect(recommendation.score).toBe(recommendation.compatibilityScore);\n      expect(recommendation.status).toBe('pending');\n    });\n\n    it('should return recommendations for user without existing memberships', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUserWithoutMemberships);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        where: {\n          id: { notIn: [] },\n        },\n        include: {\n          _count: {\n            select: { memberships: true },\n          },\n        },\n      });\n\n      expect(result).toBeInstanceOf(Array);\n      expect(result.length).toBeGreaterThan(0);\n    });\n\n    it('should filter out communities with low compatibility scores', async () => {\n      // Mock low random value to test filtering\n      jest.spyOn(Math, 'random').mockReturnValue(0.1); // Will result in base score of 0.28\n\n      const result = await service.getUserRecommendations('user-123');\n\n      // Should filter out recommendations with score <= 0.3\n      result.forEach(recommendation => {\n        expect(recommendation.compatibilityScore).toBeGreaterThan(0.3);\n      });\n    });\n\n    it('should sort recommendations by compatibility score in descending order', async () => {\n      // Mock varying scores\n      jest.spyOn(Math, 'random')\n        .mockReturnValueOnce(0.8) // 0.84 + size bonus\n        .mockReturnValueOnce(0.5) // 0.6 + size bonus\n        .mockReturnValueOnce(0.3) // 0.44 + size bonus\n        .mockReturnValueOnce(0.7); // 0.76 + size bonus\n\n      const result = await service.getUserRecommendations('user-123');\n\n      // Should be sorted by score (highest first)\n      for (let i = 1; i < result.length; i++) {\n        expect(result[i-1].compatibilityScore).toBeGreaterThanOrEqual(result[i].compatibilityScore);\n      }\n    });\n\n    it('should limit results to top 10 recommendations', async () => {\n      // Mock many communities\n      const manyCommunities = Array.from({ length: 15 }, (_, i) => ({\n        id: `community-${i}`,\n        name: `Community ${i}`,\n        slug: `community-${i}`,\n        description: `Description ${i}`,\n        imageUrl: `image-${i}.jpg`,\n        _count: { memberships: 20 },\n        createdAt: new Date('2024-01-01'),\n        updatedAt: new Date('2024-01-01'),\n      }));\n\n      prismaService.community.findMany.mockResolvedValue(manyCommunities);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(result.length).toBeLessThanOrEqual(10);\n    });\n\n    it('should apply size bonus for small communities', async () => {\n      // Test with communities of different sizes\n      const communitiesWithSizes = [\n        { ...mockCommunities[0], _count: { memberships: 8 } }, // Small - should get bonus\n        { ...mockCommunities[1], _count: { memberships: 50 } }, // Large - no bonus\n      ];\n      \n      prismaService.community.findMany.mockResolvedValue(communitiesWithSizes);\n\n      // Mock consistent base score\n      jest.spyOn(Math, 'random').mockReturnValue(0.6); // Base score 0.68\n\n      const result = await service.getUserRecommendations('user-123');\n\n      // Small community should have higher score due to size bonus\n      const smallCommunityRec = result.find(r => r.memberCount === 8);\n      const largeCommunityRec = result.find(r => r.memberCount === 50);\n\n      if (smallCommunityRec && largeCommunityRec) {\n        expect(smallCommunityRec.compatibilityScore).toBeGreaterThan(largeCommunityRec.compatibilityScore);\n      }\n    });\n\n    it('should throw NotFoundException for non-existent user', async () => {\n      prismaService.user.findUnique.mockResolvedValue(null);\n\n      await expect(service.getUserRecommendations('non-existent-user')).rejects.toThrow(\n        new NotFoundException('User non-existent-user not found')\n      );\n    });\n\n    it('should handle database errors gracefully', async () => {\n      prismaService.user.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(result).toEqual([]);\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting recommendations for user user-123'),\n        expect.any(Error)\n      );\n    });\n\n    it('should handle empty communities list', async () => {\n      prismaService.community.findMany.mockResolvedValue([]);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(result).toEqual([]);\n    });\n\n    it('should handle communities with missing count data', async () => {\n      const communitiesWithoutCount = [\n        {\n          ...mockCommunities[0],\n          _count: { memberships: undefined },\n        },\n      ];\n      \n      prismaService.community.findMany.mockResolvedValue(communitiesWithoutCount as any);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      // Should handle gracefully without crashing\n      expect(result).toBeInstanceOf(Array);\n    });\n\n    it('should set appropriate timestamps for recommendations', async () => {\n      const beforeCall = new Date();\n      const result = await service.getUserRecommendations('user-123');\n      const afterCall = new Date();\n\n      if (result.length > 0) {\n        const recommendation = result[0];\n        expect(recommendation.createdAt).toBeInstanceOf(Date);\n        expect(recommendation.updatedAt).toBeInstanceOf(Date);\n        expect(recommendation.createdAt.getTime()).toBeGreaterThanOrEqual(beforeCall.getTime());\n        expect(recommendation.createdAt.getTime()).toBeLessThanOrEqual(afterCall.getTime());\n      }\n    });\n  });\n\n  describe('calculateCompatibilityScore', () => {\n    beforeEach(() => {\n      jest.spyOn(Math, 'random').mockReturnValue(0.6); // Base score 0.68\n    });\n\n    it('should calculate base compatibility score', async () => {\n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      \n      const score = await calculateCompatibilityScore([], mockCommunities[0]);\n\n      expect(score).toBeCloseTo(0.78, 2); // 0.68 + 0.1 (size bonus)\n      expect(score).toBeGreaterThanOrEqual(0.2);\n      expect(score).toBeLessThanOrEqual(1.0);\n    });\n\n    it('should apply size bonus for small communities', async () => {\n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      \n      const smallCommunityScore = await calculateCompatibilityScore([], mockCommunities[3]); // 8 members\n      const largeCommunityScore = await calculateCompatibilityScore([], mockLargeCommunity); // 150 members\n\n      expect(smallCommunityScore).toBeGreaterThan(largeCommunityScore);\n      expect(smallCommunityScore - largeCommunityScore).toBeCloseTo(0.1, 2); // Size bonus difference\n    });\n\n    it('should cap maximum score at 1.0', async () => {\n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      \n      // Mock very high random value\n      jest.spyOn(Math, 'random').mockReturnValue(0.95); // Base score 0.96 + 0.1 = 1.06\n\n      const score = await calculateCompatibilityScore([], mockCommunities[3]); // Small community\n\n      expect(score).toBe(1.0); // Should be capped at 1.0\n    });\n\n    it('should handle communities without member count', async () => {\n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      \n      const communityWithoutCount = {\n        ...mockCommunities[0],\n        _count: { memberships: undefined },\n      };\n\n      const score = await calculateCompatibilityScore([], communityWithoutCount);\n\n      expect(score).toBeGreaterThanOrEqual(0.2);\n      expect(score).toBeLessThanOrEqual(1.0);\n    });\n\n    it('should provide consistent scores for same community', async () => {\n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      \n      // Mock consistent random value\n      jest.spyOn(Math, 'random').mockReturnValue(0.5);\n\n      const score1 = await calculateCompatibilityScore([], mockCommunities[0]);\n      const score2 = await calculateCompatibilityScore([], mockCommunities[0]);\n\n      expect(score1).toBe(score2);\n    });\n  });\n\n  describe('generateRecommendationReason', () => {\n    it('should generate appropriate reason for excellent match', () => {\n      const generateRecommendationReason = (service as any).generateRecommendationReason.bind(service);\n      \n      const reason = generateRecommendationReason(0.85);\n      \n      expect(reason).toBe('Excellent match based on your assessment responses');\n    });\n\n    it('should generate appropriate reason for good compatibility', () => {\n      const generateRecommendationReason = (service as any).generateRecommendationReason.bind(service);\n      \n      const reason = generateRecommendationReason(0.65);\n      \n      expect(reason).toBe('Good compatibility with your interests');\n    });\n\n    it('should generate appropriate reason for potential good fit', () => {\n      const generateRecommendationReason = (service as any).generateRecommendationReason.bind(service);\n      \n      const reason = generateRecommendationReason(0.45);\n      \n      expect(reason).toBe('Potential good fit for your needs');\n    });\n\n    it('should generate appropriate reason for moderate compatibility', () => {\n      const generateRecommendationReason = (service as any).generateRecommendationReason.bind(service);\n      \n      const reason = generateRecommendationReason(0.35);\n      \n      expect(reason).toBe('Moderate compatibility');\n    });\n\n    it('should handle edge case scores', () => {\n      const generateRecommendationReason = (service as any).generateRecommendationReason.bind(service);\n      \n      expect(generateRecommendationReason(0.8)).toBe('Excellent match based on your assessment responses');\n      expect(generateRecommendationReason(0.6)).toBe('Good compatibility with your interests');\n      expect(generateRecommendationReason(0.4)).toBe('Potential good fit for your needs');\n      expect(generateRecommendationReason(0.0)).toBe('Moderate compatibility');\n      expect(generateRecommendationReason(1.0)).toBe('Excellent match based on your assessment responses');\n    });\n  });\n\n  describe('generateRecommendationsForUser', () => {\n    it('should log generation message', async () => {\n      await service.generateRecommendationsForUser('user-123');\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'Generated recommendations for user user-123 (calculated on-demand)'\n      );\n    });\n\n    it('should log generation message with force flag', async () => {\n      await service.generateRecommendationsForUser('user-123', true);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'Generated recommendations for user user-123 (calculated on-demand)'\n      );\n    });\n\n    it('should handle different user IDs', async () => {\n      await service.generateRecommendationsForUser('user-456');\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'Generated recommendations for user user-456 (calculated on-demand)'\n      );\n    });\n\n    it('should not throw errors', async () => {\n      await expect(service.generateRecommendationsForUser('user-123')).resolves.not.toThrow();\n    });\n  });\n\n  describe('getRecommendationById', () => {\n    it('should return null for any recommendation ID', async () => {\n      const result = await service.getRecommendationById('recommendation-123');\n\n      expect(result).toBeNull();\n    });\n\n    it('should return null for different recommendation IDs', async () => {\n      const result1 = await service.getRecommendationById('rec-1');\n      const result2 = await service.getRecommendationById('rec-2');\n      const result3 = await service.getRecommendationById('');\n\n      expect(result1).toBeNull();\n      expect(result2).toBeNull();\n      expect(result3).toBeNull();\n    });\n\n    it('should handle long recommendation IDs', async () => {\n      const longId = 'a'.repeat(1000);\n      const result = await service.getRecommendationById(longId);\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('handleRecommendationInteraction', () => {\n    const mockInteractionData = {\n      recommendationId: 'rec-123',\n      action: 'accept',\n      userId: 'user-123',\n    };\n\n    it('should log interaction for accept action', async () => {\n      await service.handleRecommendationInteraction(mockInteractionData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 accepted recommendation rec-123'\n      );\n    });\n\n    it('should log interaction for reject action', async () => {\n      const rejectData = { ...mockInteractionData, action: 'reject' };\n      \n      await service.handleRecommendationInteraction(rejectData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 rejected recommendation rec-123'\n      );\n    });\n\n    it('should log interaction for view action', async () => {\n      const viewData = { ...mockInteractionData, action: 'view' };\n      \n      await service.handleRecommendationInteraction(viewData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 viewed recommendation rec-123'\n      );\n    });\n\n    it('should handle custom actions', async () => {\n      const customData = { ...mockInteractionData, action: 'bookmark' };\n      \n      await service.handleRecommendationInteraction(customData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 bookmarked recommendation rec-123'\n      );\n    });\n\n    it('should handle different user IDs', async () => {\n      const differentUserData = { ...mockInteractionData, userId: 'user-456' };\n      \n      await service.handleRecommendationInteraction(differentUserData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-456 accepted recommendation rec-123'\n      );\n    });\n\n    it('should handle different recommendation IDs', async () => {\n      const differentRecData = { ...mockInteractionData, recommendationId: 'rec-456' };\n      \n      await service.handleRecommendationInteraction(differentRecData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 accepted recommendation rec-456'\n      );\n    });\n\n    it('should not throw errors', async () => {\n      await expect(\n        service.handleRecommendationInteraction(mockInteractionData)\n      ).resolves.not.toThrow();\n    });\n\n    it('should handle empty action strings', async () => {\n      const emptyActionData = { ...mockInteractionData, action: '' };\n      \n      await service.handleRecommendationInteraction(emptyActionData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 ed recommendation rec-123'\n      );\n    });\n\n    it('should handle special characters in actions', async () => {\n      const specialActionData = { ...mockInteractionData, action: 'action-with-dashes_and_underscores' };\n      \n      await service.handleRecommendationInteraction(specialActionData);\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'User user-123 action-with-dashes_and_underscoresed recommendation rec-123'\n      );\n    });\n  });\n\n  describe('getRecommendationStats', () => {\n    it('should return default stats structure', async () => {\n      const result = await service.getRecommendationStats();\n\n      expect(result).toEqual({\n        totalRecommendations: 0,\n        acceptedRecommendations: 0,\n        rejectedRecommendations: 0,\n        pendingRecommendations: 0,\n        averageCompatibilityScore: 0,\n        topCommunities: [],\n      });\n    });\n\n    it('should return consistent stats structure on multiple calls', async () => {\n      const result1 = await service.getRecommendationStats();\n      const result2 = await service.getRecommendationStats();\n\n      expect(result1).toEqual(result2);\n    });\n\n    it('should have all required properties', async () => {\n      const result = await service.getRecommendationStats();\n\n      expect(result).toHaveProperty('totalRecommendations');\n      expect(result).toHaveProperty('acceptedRecommendations');\n      expect(result).toHaveProperty('rejectedRecommendations');\n      expect(result).toHaveProperty('pendingRecommendations');\n      expect(result).toHaveProperty('averageCompatibilityScore');\n      expect(result).toHaveProperty('topCommunities');\n\n      expect(typeof result.totalRecommendations).toBe('number');\n      expect(typeof result.acceptedRecommendations).toBe('number');\n      expect(typeof result.rejectedRecommendations).toBe('number');\n      expect(typeof result.pendingRecommendations).toBe('number');\n      expect(typeof result.averageCompatibilityScore).toBe('number');\n      expect(Array.isArray(result.topCommunities)).toBe(true);\n    });\n\n    it('should not throw errors', async () => {\n      await expect(service.getRecommendationStats()).resolves.not.toThrow();\n    });\n  });\n\n  describe('edge cases and error handling', () => {\n    it('should handle user with null memberships', async () => {\n      const userWithNullMemberships = {\n        ...mockUser,\n        memberships: null,\n      };\n      \n      prismaService.user.findUnique.mockResolvedValue(userWithNullMemberships as any);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n\n      await expect(service.getUserRecommendations('user-123')).rejects.toThrow();\n    });\n\n    it('should handle communities with null member counts', async () => {\n      const communitiesWithNullCounts = [\n        {\n          ...mockCommunities[0],\n          _count: null,\n        },\n      ];\n      \n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(communitiesWithNullCounts as any);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(result).toBeInstanceOf(Array);\n    });\n\n    it('should handle very large numbers of communities efficiently', async () => {\n      const largeCommunityList = Array.from({ length: 1000 }, (_, i) => ({\n        id: `community-${i}`,\n        name: `Community ${i}`,\n        slug: `community-${i}`,\n        description: `Description ${i}`,\n        imageUrl: `image-${i}.jpg`,\n        _count: { memberships: i % 100 }, // Varying sizes\n        createdAt: new Date('2024-01-01'),\n        updatedAt: new Date('2024-01-01'),\n      }));\n\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(largeCommunityList);\n\n      const startTime = Date.now();\n      const result = await service.getUserRecommendations('user-123');\n      const endTime = Date.now();\n\n      expect(result.length).toBeLessThanOrEqual(10);\n      expect(endTime - startTime).toBeLessThan(5000); // Should complete within 5 seconds\n    });\n\n    it('should handle concurrent user recommendation requests', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n\n      const promises = [\n        service.getUserRecommendations('user-123'),\n        service.getUserRecommendations('user-123'),\n        service.getUserRecommendations('user-123'),\n      ];\n\n      const results = await Promise.all(promises);\n\n      expect(results).toHaveLength(3);\n      results.forEach(result => {\n        expect(result).toBeInstanceOf(Array);\n      });\n    });\n\n    it('should handle database timeout errors', async () => {\n      const timeoutError = new Error('Connection timeout');\n      prismaService.user.findUnique.mockRejectedValue(timeoutError);\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      const result = await service.getUserRecommendations('user-123');\n\n      expect(result).toEqual([]);\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting recommendations for user user-123'),\n        timeoutError\n      );\n    });\n\n    it('should handle malformed community data gracefully', async () => {\n      const malformedCommunities = [\n        {\n          // Missing required fields\n          id: 'community-malformed',\n          // name: missing\n          // slug: missing\n          description: 'Description',\n          _count: { memberships: 10 },\n        },\n      ];\n      \n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(malformedCommunities as any);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      // Should handle gracefully without crashing\n      expect(result).toBeInstanceOf(Array);\n    });\n\n    it('should maintain score precision', async () => {\n      // Test with specific random values to check precision\n      jest.spyOn(Math, 'random').mockReturnValue(0.123456789);\n      \n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      const score = await calculateCompatibilityScore([], mockCommunities[0]);\n\n      expect(score).toBeCloseTo(0.32876, 5); // High precision check\n    });\n\n    it('should handle edge case scores in reason generation', async () => {\n      const generateRecommendationReason = (service as any).generateRecommendationReason.bind(service);\n      \n      // Test boundary values\n      expect(generateRecommendationReason(0.800000001)).toBe('Excellent match based on your assessment responses');\n      expect(generateRecommendationReason(0.799999999)).toBe('Good compatibility with your interests');\n      expect(generateRecommendationReason(0.600000001)).toBe('Good compatibility with your interests');\n      expect(generateRecommendationReason(0.599999999)).toBe('Potential good fit for your needs');\n      expect(generateRecommendationReason(0.400000001)).toBe('Potential good fit for your needs');\n      expect(generateRecommendationReason(0.399999999)).toBe('Moderate compatibility');\n    });\n\n    it('should handle negative scores gracefully', async () => {\n      jest.spyOn(Math, 'random').mockReturnValue(-0.5); // Negative random (shouldn't happen but test anyway)\n      \n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      const score = await calculateCompatibilityScore([], mockCommunities[0]);\n\n      expect(score).toBeGreaterThanOrEqual(0); // Should still be non-negative\n    });\n\n    it('should handle infinity and NaN in calculations', async () => {\n      const communityWithInfiniteMembers = {\n        ...mockCommunities[0],\n        _count: { memberships: Infinity },\n      };\n      \n      const calculateCompatibilityScore = (service as any).calculateCompatibilityScore.bind(service);\n      const score = await calculateCompatibilityScore([], communityWithInfiniteMembers);\n\n      expect(score).toBeFinite();\n      expect(score).not.toBeNaN();\n    });\n  });\n\n  describe('recommendation data integrity', () => {\n    it('should ensure all recommendations have required fields', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      result.forEach(recommendation => {\n        expect(recommendation.id).toBeDefined();\n        expect(recommendation.name).toBeDefined();\n        expect(recommendation.slug).toBeDefined();\n        expect(recommendation.description).toBeDefined();\n        expect(recommendation.imageUrl).toBeDefined();\n        expect(recommendation.memberCount).toBeDefined();\n        expect(recommendation.compatibilityScore).toBeDefined();\n        expect(recommendation.score).toBeDefined();\n        expect(recommendation.reason).toBeDefined();\n        expect(recommendation.status).toBeDefined();\n        expect(recommendation.createdAt).toBeDefined();\n        expect(recommendation.updatedAt).toBeDefined();\n\n        expect(typeof recommendation.id).toBe('string');\n        expect(typeof recommendation.name).toBe('string');\n        expect(typeof recommendation.slug).toBe('string');\n        expect(typeof recommendation.description).toBe('string');\n        expect(typeof recommendation.imageUrl).toBe('string');\n        expect(typeof recommendation.memberCount).toBe('number');\n        expect(typeof recommendation.compatibilityScore).toBe('number');\n        expect(typeof recommendation.score).toBe('number');\n        expect(typeof recommendation.reason).toBe('string');\n        expect(typeof recommendation.status).toBe('string');\n        expect(recommendation.createdAt).toBeInstanceOf(Date);\n        expect(recommendation.updatedAt).toBeInstanceOf(Date);\n      });\n    });\n\n    it('should ensure score fields are in valid range', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      result.forEach(recommendation => {\n        expect(recommendation.compatibilityScore).toBeGreaterThanOrEqual(0);\n        expect(recommendation.compatibilityScore).toBeLessThanOrEqual(1);\n        expect(recommendation.score).toBeGreaterThanOrEqual(0);\n        expect(recommendation.score).toBeLessThanOrEqual(1);\n        expect(recommendation.memberCount).toBeGreaterThanOrEqual(0);\n      });\n    });\n\n    it('should ensure consistency between score fields', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      result.forEach(recommendation => {\n        expect(recommendation.score).toBe(recommendation.compatibilityScore);\n      });\n    });\n\n    it('should ensure status field is always set correctly', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n\n      const result = await service.getUserRecommendations('user-123');\n\n      result.forEach(recommendation => {\n        expect(recommendation.status).toBe('pending');\n      });\n    });\n  });\n});"],"version":3}