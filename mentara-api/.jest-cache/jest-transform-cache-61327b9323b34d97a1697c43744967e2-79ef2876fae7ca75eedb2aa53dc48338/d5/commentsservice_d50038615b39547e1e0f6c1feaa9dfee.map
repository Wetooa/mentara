{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/comments/comments.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/comments/comments.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  ForbiddenException,\n  InternalServerErrorException,\n} from '@nestjs/common';\nimport { EventEmitter2 } from '@nestjs/event-emitter';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { Comment, Prisma, User } from '@prisma/client';\nimport type { CommentCreateInputDto, CommentUpdateInputDto } from './types';\nimport { CommentAddedEvent } from '../common/events/social-events';\n\n// Define local response type to match actual unified comment structure\ninterface CommentResponse {\n  id: string;\n  createdAt: Date;\n  updatedAt: Date;\n  postId: string;\n  userId: string;\n  content: string;\n  parentId: string | null; // For nested comments\n  attachmentUrls: string[];\n  attachmentNames: string[];\n  attachmentSizes: number[];\n  user?: any;\n  hearts?: number; // Heart count\n  children?: CommentResponse[]; // Nested comments\n  heartCount?: number;\n  childrenCount?: number; // Renamed from replyCount\n  isHearted?: boolean;\n}\n\n@Injectable()\nexport class CommentsService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly eventEmitter: EventEmitter2,\n  ) {}\n\n  async findUserById(id: string): Promise<User | null> {\n    try {\n      return await this.prisma.user.findUnique({ where: { id } });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findAll(userId?: string): Promise<Comment[]> {\n    try {\n      return await this.prisma.comment.findMany({\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          post: {\n            select: {\n              id: true,\n              title: true,\n            },\n          },\n          children: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n              _count: {\n                select: {\n                  children: true,\n                  hearts: true,\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n          hearts: userId\n            ? {\n                where: {\n                  userId,\n                },\n              }\n            : false,\n          _count: {\n            select: {\n              children: true,\n              hearts: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findOne(id: string): Promise<CommentResponse> {\n    try {\n      const comment = await this.prisma.comment.findUnique({\n        where: { id },\n        include: {\n          user: true,\n          children: {\n            include: {\n              user: true,\n              _count: {\n                select: {\n                  children: true,\n                  hearts: true,\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n          hearts: true,\n          _count: {\n            select: {\n              children: true,\n              hearts: true,\n            },\n          },\n        },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      return {\n        ...comment,\n        hearts: comment.hearts.length, // Count hearts instead of returning array\n        childrenCount: comment._count.children,\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findByPostId(postId: string, userId?: string): Promise<Comment[]> {\n    try {\n      return await this.prisma.comment.findMany({\n        where: {\n          postId,\n          parentId: null, // Only get top-level comments, children are included via nested include\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          children: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n              children: {\n                include: {\n                  user: {\n                    select: {\n                      id: true,\n                      firstName: true,\n                      lastName: true,\n                      avatarUrl: true,\n                    },\n                  },\n                  _count: {\n                    select: {\n                      children: true,\n                      hearts: true,\n                    },\n                  },\n                },\n                orderBy: {\n                  createdAt: 'asc',\n                },\n              },\n              _count: {\n                select: {\n                  children: true,\n                  hearts: true,\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n          hearts: userId\n            ? {\n                where: {\n                  userId,\n                },\n              }\n            : false,\n          _count: {\n            select: {\n              children: true,\n              hearts: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async create(\n    data: CommentCreateInputDto,\n    userId: string,\n    attachmentUrls: string[] = [],\n    attachmentNames: string[] = [],\n    attachmentSizes: number[] = [],\n  ): Promise<CommentResponse> {\n    try {\n      const comment = await this.prisma.comment.create({\n        data: {\n          userId,\n          postId: data.postId,\n          content: data.content,\n          parentId: data.parentId || null, // Support nested comments via parentId\n          attachmentUrls,\n          attachmentNames,\n          attachmentSizes,\n        },\n        include: {\n          user: true,\n          hearts: true,\n          children: {\n            include: {\n              user: true,\n              _count: {\n                select: {\n                  children: true,\n                  hearts: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              children: true,\n              hearts: true,\n            },\n          },\n        },\n      });\n\n      // Validate comment data before emitting event\n      if (!comment.id || !comment.postId || !comment.userId || !comment.content) {\n        throw new InternalServerErrorException('Comment creation failed: missing required fields');\n      }\n\n      // Emit CommentAddedEvent for notifications\n      await this.eventEmitter.emitAsync(\n        'CommentAddedEvent',\n        new CommentAddedEvent({\n          commentId: comment.id,\n          postId: comment.postId,\n          authorId: comment.userId,\n          content: comment.content,\n          parentCommentId: comment.parentId || undefined,\n          isAnonymous: false, // Add if available in schema\n          depth: comment.parentId ? 1 : 0, // Depth based on parent existence\n        }),\n      );\n\n      return {\n        ...comment,\n        hearts: comment.hearts.length, // Count hearts instead of returning array\n        childrenCount: comment._count.children,\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async update(\n    id: string,\n    data: CommentUpdateInputDto,\n    userId: string,\n  ): Promise<CommentResponse> {\n    try {\n      const comment = await this.prisma.comment.findUnique({\n        where: { id },\n        select: { userId: true },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      if (comment.userId !== userId) {\n        throw new ForbiddenException('You can only edit your own comments');\n      }\n\n      const updatedComment = await this.prisma.comment.update({\n        where: { id, userId },\n        data: {\n          content: data.content,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          hearts: true,\n        },\n      });\n\n      return {\n        ...updatedComment,\n        hearts: updatedComment.hearts.length,\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async remove(id: string, userId: string): Promise<Comment> {\n    try {\n      const comment = await this.prisma.comment.findUnique({\n        where: { id },\n        select: { userId: true },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      if (comment.userId !== userId) {\n        throw new ForbiddenException('You can only delete your own comments');\n      }\n\n      return await this.prisma.comment.delete({\n        where: { id },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findByUserId(userId: string): Promise<Comment[]> {\n    try {\n      return await this.prisma.comment.findMany({\n        where: {\n          userId,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          post: {\n            select: {\n              id: true,\n              title: true,\n            },\n          },\n          children: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n              _count: {\n                select: {\n                  children: true,\n                  hearts: true,\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n          _count: {\n            select: {\n              children: true,\n              hearts: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Heart functionality\n  async heartComment(\n    commentId: string,\n    userId: string,\n  ): Promise<{ hearted: boolean }> {\n    try {\n      const existingHeart = await this.prisma.commentHeart.findUnique({\n        where: {\n          commentId_userId: {\n            commentId,\n            userId,\n          },\n        },\n      });\n\n      if (existingHeart) {\n        // Remove heart\n        await this.prisma.commentHeart.delete({\n          where: {\n            commentId_userId: {\n              commentId,\n              userId,\n            },\n          },\n        });\n\n        return { hearted: false };\n      } else {\n        // Add heart\n        await this.prisma.commentHeart.create({\n          data: {\n            commentId,\n            userId,\n          },\n        });\n\n        return { hearted: true };\n      }\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async isCommentHeartedByUser(\n    commentId: string,\n    userId: string,\n  ): Promise<boolean> {\n    try {\n      const heart = await this.prisma.commentHeart.findUnique({\n        where: {\n          commentId_userId: {\n            commentId,\n            userId,\n          },\n        },\n      });\n\n      return !!heart;\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Reply functionality is now unified into the Comment system via parentId\n  // All nested comments are handled through the create() method with parentId\n  // Heart functionality works for all comment levels through heartComment()\n\n  // File attachments are now handled directly with attachment arrays\n  // No separate file attachment models needed\n\n  /**\n   * Report a comment for inappropriate content\n   */\n  async reportComment(\n    commentId: string,\n    reporterId: string,\n    reason: string,\n    content?: string,\n  ): Promise<string> {\n    try {\n      // Verify comment exists\n      const comment = await this.prisma.comment.findUnique({\n        where: { id: commentId },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      // Check if user already reported this comment\n      const existingReport = await this.prisma.report.findFirst({\n        where: {\n          commentId,\n          reporterId,\n        },\n      });\n\n      if (existingReport) {\n        throw new ForbiddenException('You have already reported this comment');\n      }\n\n      // Create the report\n      const report = await this.prisma.report.create({\n        data: {\n          commentId,\n          reporterId,\n          reason,\n          content,\n          status: 'PENDING',\n        },\n      });\n\n      return report.id;\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n}\n"],"version":3}