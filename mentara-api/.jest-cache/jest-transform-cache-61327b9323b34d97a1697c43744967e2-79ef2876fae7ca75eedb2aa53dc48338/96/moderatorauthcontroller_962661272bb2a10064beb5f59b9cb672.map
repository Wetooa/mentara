{"version":3,"names":["common_1","cov_1t1eo2y7zy","s","require","throttler_1","jwt_auth_guard_1","current_user_id_decorator_1","current_user_role_decorator_1","zod_validation_pipe_1","validation_1","moderator_auth_service_1","ModeratorAuthController","moderatorAuthService","constructor","f","createModeratorAccount","currentUserRole","registerDto","b","ForbiddenException","result","email","password","firstName","lastName","permissions","assignedCommunities","user","id","role","emailVerified","message","getProfile","userId","getModeratorProfile","getPermissions","getModeratorPermissions","getAssignedCommunities","getDashboardStats","getModeratorDashboardStats","exports","__decorate","Post","UseGuards","JwtAuthGuard","Throttle","default","limit","ttl","HttpCode","HttpStatus","CREATED","__param","CurrentUserRole","Body","ZodValidationPipe","RegisterModeratorDtoSchema","Get","CurrentUserId","Controller","ModeratorAuthService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/moderator-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  Post,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Req,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../decorators/current-user-role.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterModeratorDto,\n  LoginDto,\n} from '../types';\n\n// Import validation schemas from local validation\nimport {\n  RegisterModeratorDtoSchema,\n  LoginDtoSchema,\n} from '../validation';\nimport { ModeratorAuthService } from '../services/moderator-auth.service';\nimport { Request } from 'express';\n\n@Controller('auth/moderator')\nexport class ModeratorAuthController {\n  constructor(private readonly moderatorAuthService: ModeratorAuthService) {}\n\n  @Post('create-account')\n  @UseGuards(JwtAuthGuard)\n  @Throttle({ default: { limit: 5, ttl: 600000 } }) // 5 moderator creations per 10 minutes\n  @HttpCode(HttpStatus.CREATED)\n  async createModeratorAccount(\n    @CurrentUserRole() currentUserRole: string,\n    @Body(new ZodValidationPipe(RegisterModeratorDtoSchema))\n    registerDto: RegisterModeratorDto,\n  ) {\n    // Only admins can create moderators\n    if (currentUserRole !== 'admin') {\n      throw new ForbiddenException('Only admins can create moderator accounts');\n    }\n\n    const result = await this.moderatorAuthService.createModeratorAccount(\n      registerDto.email,\n      registerDto.password,\n      registerDto.firstName,\n      registerDto.lastName,\n      (registerDto as any).permissions || [],\n      (registerDto as any).assignedCommunities || [],\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName,\n        lastName: result.user.lastName,\n        role: result.user.role,\n        emailVerified: result.user.emailVerified,\n      },\n      message: result.message,\n    };\n  }\n\n  // REMOVED: Duplicate login route - use universal /auth/login instead\n  // This was redundant with AuthController.login() which handles all roles\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getModeratorProfile(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('permissions')\n  async getPermissions(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getModeratorPermissions(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('assigned-communities')\n  async getAssignedCommunities(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getAssignedCommunities(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('dashboard-stats')\n  async getDashboardStats(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getModeratorDashboardStats(userId);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}