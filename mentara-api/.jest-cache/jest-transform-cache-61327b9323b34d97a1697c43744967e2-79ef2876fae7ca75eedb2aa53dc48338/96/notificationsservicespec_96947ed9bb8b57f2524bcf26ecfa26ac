7dd4cfe1c0b03016f80719915ae7b6ed
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const event_emitter_1 = require("@nestjs/event-emitter");
const notifications_service_1 = require("./notifications.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
const test_utils_1 = require("../test-utils");
describe('NotificationsService', () => {
    let service;
    let prismaService;
    let eventEmitter;
    let mockWebSocketServer;
    beforeEach(async () => {
        const mockPrisma = (0, test_utils_1.createMockPrismaService)();
        const mockEventEmitter = {
            emit: jest.fn(),
        };
        mockWebSocketServer = {
            to: jest.fn(() => ({
                emit: jest.fn(),
            })),
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                notifications_service_1.NotificationsService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrisma,
                },
                {
                    provide: event_emitter_1.EventEmitter2,
                    useValue: mockEventEmitter,
                },
            ],
        }).compile();
        service = module.get(notifications_service_1.NotificationsService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        eventEmitter = module.get(event_emitter_1.EventEmitter2);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('onModuleInit', () => {
        it('should log initialization message', () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            service.onModuleInit();
            expect(loggerSpy).toHaveBeenCalledWith('NotificationsService initialized with real-time capabilities');
        });
    });
    describe('setWebSocketServer', () => {
        it('should set WebSocket server and log configuration', () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            service.setWebSocketServer(mockWebSocketServer);
            expect(loggerSpy).toHaveBeenCalledWith('WebSocket server configured for real-time notifications');
        });
    });
    describe('create', () => {
        const mockNotificationData = {
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            title: 'Test Notification',
            message: 'This is a test notification',
            type: client_1.NotificationType.MESSAGE_RECEIVED,
            priority: client_1.NotificationPriority.NORMAL,
            actionUrl: '/messages/123',
            data: { messageId: '123' },
        };
        const mockCreatedNotification = {
            id: 'notification-1',
            ...mockNotificationData,
            createdAt: new Date(),
            isRead: false,
            readAt: null,
            scheduledFor: null,
            sentAt: null,
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                email: 'john@example.com',
            },
        };
        beforeEach(() => {
            prismaService.notification.create.mockResolvedValue(mockCreatedNotification);
            service.setWebSocketServer(mockWebSocketServer);
        });
        it('should create notification successfully', async () => {
            const result = await service.create(mockNotificationData);
            expect(result).toEqual(mockCreatedNotification);
            expect(prismaService.notification.create).toHaveBeenCalledWith({
                data: {
                    ...mockNotificationData,
                    priority: client_1.NotificationPriority.NORMAL,
                },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                            email: true,
                        },
                    },
                },
            });
        });
        it('should set default priority when not provided', async () => {
            const dataWithoutPriority = {
                ...mockNotificationData,
                priority: undefined,
            };
            await service.create(dataWithoutPriority);
            expect(prismaService.notification.create).toHaveBeenCalledWith({
                data: {
                    ...dataWithoutPriority,
                    priority: client_1.NotificationPriority.NORMAL,
                },
                include: expect.any(Object),
            });
        });
        it('should deliver notification immediately when not scheduled', async () => {
            const deliverSpy = jest.spyOn(service, 'deliverNotification');
            await service.create(mockNotificationData);
            expect(deliverSpy).toHaveBeenCalledWith(mockCreatedNotification, {
                realTime: true,
                email: false,
                push: false,
                scheduled: false,
            });
        });
        it('should not deliver notification when scheduled', async () => {
            const deliverSpy = jest.spyOn(service, 'deliverNotification');
            const scheduledData = {
                ...mockNotificationData,
                scheduledFor: new Date(Date.now() + 60000),
            };
            await service.create(scheduledData);
            expect(deliverSpy).not.toHaveBeenCalled();
        });
        it('should use custom delivery options', async () => {
            const deliverSpy = jest.spyOn(service, 'deliverNotification');
            const customOptions = {
                realTime: true,
                email: true,
                push: true,
                scheduled: false,
            };
            await service.create(mockNotificationData, customOptions);
            expect(deliverSpy).toHaveBeenCalledWith(mockCreatedNotification, customOptions);
        });
    });
    describe('findAll', () => {
        const mockNotifications = [
            {
                id: 'notification-1',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Test Notification 1',
                message: 'Message 1',
                type: client_1.NotificationType.MESSAGE_RECEIVED,
                priority: client_1.NotificationPriority.HIGH,
                isRead: false,
                createdAt: new Date(),
            },
            {
                id: 'notification-2',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Test Notification 2',
                message: 'Message 2',
                type: client_1.NotificationType.APPOINTMENT_REMINDER,
                priority: client_1.NotificationPriority.NORMAL,
                isRead: true,
                createdAt: new Date(),
            },
        ];
        beforeEach(() => {
            prismaService.notification.findMany.mockResolvedValue(mockNotifications);
        });
        it('should return all notifications for user', async () => {
            const result = await service.findAll(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockNotifications);
            expect(prismaService.notification.findMany).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],
                take: 50,
            });
        });
        it('should filter by read status', async () => {
            await service.findAll(test_utils_1.TEST_USER_IDS.CLIENT, false);
            expect(prismaService.notification.findMany).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT, isRead: false },
                orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],
                take: 50,
            });
        });
        it('should filter by type', async () => {
            await service.findAll(test_utils_1.TEST_USER_IDS.CLIENT, undefined, client_1.NotificationType.MESSAGE_RECEIVED);
            expect(prismaService.notification.findMany).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT, type: client_1.NotificationType.MESSAGE_RECEIVED },
                orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],
                take: 50,
            });
        });
        it('should filter by priority', async () => {
            await service.findAll(test_utils_1.TEST_USER_IDS.CLIENT, undefined, undefined, client_1.NotificationPriority.HIGH);
            expect(prismaService.notification.findMany).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT, priority: client_1.NotificationPriority.HIGH },
                orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],
                take: 50,
            });
        });
        it('should filter by multiple criteria', async () => {
            await service.findAll(test_utils_1.TEST_USER_IDS.CLIENT, true, client_1.NotificationType.MESSAGE_RECEIVED, client_1.NotificationPriority.HIGH);
            expect(prismaService.notification.findMany).toHaveBeenCalledWith({
                where: {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    isRead: true,
                    type: client_1.NotificationType.MESSAGE_RECEIVED,
                    priority: client_1.NotificationPriority.HIGH,
                },
                orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],
                take: 50,
            });
        });
    });
    describe('findOne', () => {
        const mockNotification = {
            id: 'notification-1',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            title: 'Test Notification',
            message: 'Test message',
            type: client_1.NotificationType.MESSAGE_RECEIVED,
            priority: client_1.NotificationPriority.NORMAL,
            isRead: false,
            createdAt: new Date(),
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                email: 'john@example.com',
            },
        };
        it('should return notification by ID', async () => {
            prismaService.notification.findUnique.mockResolvedValue(mockNotification);
            const result = await service.findOne('notification-1');
            expect(result).toEqual(mockNotification);
            expect(prismaService.notification.findUnique).toHaveBeenCalledWith({
                where: { id: 'notification-1' },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                            email: true,
                        },
                    },
                },
            });
        });
        it('should return null when notification not found', async () => {
            prismaService.notification.findUnique.mockResolvedValue(null);
            const result = await service.findOne('non-existent');
            expect(result).toBeNull();
        });
    });
    describe('markAsRead', () => {
        const mockNotification = {
            id: 'notification-1',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            isRead: false,
            createdAt: new Date(),
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                email: 'john@example.com',
            },
        };
        it('should mark notification as read', async () => {
            jest.spyOn(service, 'findOne').mockResolvedValue(mockNotification);
            const updatedNotification = { ...mockNotification, isRead: true, readAt: new Date() };
            prismaService.notification.update.mockResolvedValue(updatedNotification);
            const result = await service.markAsRead('notification-1');
            expect(result).toEqual(updatedNotification);
            expect(prismaService.notification.update).toHaveBeenCalledWith({
                where: { id: 'notification-1' },
                data: {
                    isRead: true,
                    readAt: expect.any(Date),
                },
            });
        });
        it('should throw NotFoundException when notification not found', async () => {
            jest.spyOn(service, 'findOne').mockResolvedValue(null);
            await expect(service.markAsRead('non-existent')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('markAllAsRead', () => {
        it('should mark all unread notifications as read', async () => {
            prismaService.notification.updateMany.mockResolvedValue({ count: 5 });
            const result = await service.markAllAsRead(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual({ count: 5 });
            expect(prismaService.notification.updateMany).toHaveBeenCalledWith({
                where: {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    isRead: false,
                },
                data: {
                    isRead: true,
                    readAt: expect.any(Date),
                },
            });
        });
    });
    describe('delete', () => {
        const mockNotification = {
            id: 'notification-1',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            isRead: false,
            createdAt: new Date(),
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                email: 'john@example.com',
            },
        };
        it('should delete notification', async () => {
            jest.spyOn(service, 'findOne').mockResolvedValue(mockNotification);
            prismaService.notification.delete.mockResolvedValue(mockNotification);
            const result = await service.delete('notification-1');
            expect(result).toEqual(mockNotification);
            expect(prismaService.notification.delete).toHaveBeenCalledWith({
                where: { id: 'notification-1' },
            });
        });
        it('should throw NotFoundException when notification not found', async () => {
            jest.spyOn(service, 'findOne').mockResolvedValue(null);
            await expect(service.delete('non-existent')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('getUnreadCount', () => {
        it('should return unread notification count', async () => {
            prismaService.notification.count.mockResolvedValue(3);
            const result = await service.getUnreadCount(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toBe(3);
            expect(prismaService.notification.count).toHaveBeenCalledWith({
                where: {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    isRead: false,
                },
            });
        });
    });
    describe('getNotificationSettings', () => {
        const mockSettings = {
            id: 'settings-1',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            emailAppointmentReminders: true,
            emailNewMessages: true,
            pushNewMessages: true,
            quietHoursEnabled: false,
        };
        it('should return existing notification settings', async () => {
            prismaService.notificationSettings.findUnique.mockResolvedValue(mockSettings);
            const result = await service.getNotificationSettings(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockSettings);
            expect(prismaService.notificationSettings.findUnique).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
            });
        });
        it('should create default settings when none exist', async () => {
            prismaService.notificationSettings.findUnique.mockResolvedValue(null);
            prismaService.notificationSettings.create.mockResolvedValue(mockSettings);
            const result = await service.getNotificationSettings(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockSettings);
            expect(prismaService.notificationSettings.create).toHaveBeenCalledWith({
                data: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
            });
        });
    });
    describe('updateNotificationSettings', () => {
        const updateData = {
            emailAppointmentReminders: false,
            pushNewMessages: true,
            quietHoursEnabled: true,
            quietHoursStart: '22:00',
            quietHoursEnd: '08:00',
        };
        it('should update notification settings', async () => {
            const updatedSettings = { ...updateData, userId: test_utils_1.TEST_USER_IDS.CLIENT };
            prismaService.notificationSettings.upsert.mockResolvedValue(updatedSettings);
            const result = await service.updateNotificationSettings(test_utils_1.TEST_USER_IDS.CLIENT, updateData);
            expect(result).toEqual(updatedSettings);
            expect(prismaService.notificationSettings.upsert).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                update: updateData,
                create: {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    ...updateData,
                },
            });
        });
    });
    describe('Real-time Notification Delivery', () => {
        beforeEach(() => {
            service.setWebSocketServer(mockWebSocketServer);
            prismaService.notification.count.mockResolvedValue(5);
        });
        it('should deliver real-time notification via WebSocket', async () => {
            const notification = {
                id: 'notification-1',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Test Notification',
                message: 'Test message',
                type: client_1.NotificationType.MESSAGE_RECEIVED,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/messages/123',
                data: { messageId: '123' },
                createdAt: new Date(),
                isRead: false,
                user: { id: test_utils_1.TEST_USER_IDS.CLIENT },
            };
            await service['deliverRealTimeNotification'](notification);
            expect(mockWebSocketServer.to).toHaveBeenCalledWith(`user:${test_utils_1.TEST_USER_IDS.CLIENT}`);
            expect(mockWebSocketServer.to().emit).toHaveBeenCalledWith('notification', {
                id: 'notification-1',
                title: 'Test Notification',
                message: 'Test message',
                type: client_1.NotificationType.MESSAGE_RECEIVED,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/messages/123',
                data: { messageId: '123' },
                createdAt: notification.createdAt,
                isRead: false,
            });
            expect(mockWebSocketServer.to().emit).toHaveBeenCalledWith('unreadCount', { count: 5 });
        });
        it('should warn when WebSocket server not configured', async () => {
            service.setWebSocketServer(null);
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'warn');
            await service['deliverRealTimeNotification']({});
            expect(loggerSpy).toHaveBeenCalledWith('WebSocket server not configured for real-time notifications');
        });
        it('should handle real-time delivery errors', async () => {
            const error = new Error('WebSocket error');
            mockWebSocketServer.to.mockImplementation(() => {
                throw error;
            });
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            await service['deliverRealTimeNotification']({});
            expect(loggerSpy).toHaveBeenCalledWith('Error delivering real-time notification:', error);
        });
    });
    describe('Email and Push Notifications', () => {
        it('should log email notification queued', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            const notification = { userId: test_utils_1.TEST_USER_IDS.CLIENT, user: {} };
            await service['deliverEmailNotification'](notification);
            expect(loggerSpy).toHaveBeenCalledWith(`Email notification queued for user ${test_utils_1.TEST_USER_IDS.CLIENT}`);
        });
        it('should log push notification queued', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            const notification = { userId: test_utils_1.TEST_USER_IDS.CLIENT, user: {} };
            await service['deliverPushNotification'](notification);
            expect(loggerSpy).toHaveBeenCalledWith(`Push notification queued for user ${test_utils_1.TEST_USER_IDS.CLIENT}`);
        });
    });
    describe('Batch Operations', () => {
        it('should create batch notifications', async () => {
            const notifications = [
                {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    title: 'Notification 1',
                    message: 'Message 1',
                    type: client_1.NotificationType.MESSAGE_RECEIVED,
                },
                {
                    userId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    title: 'Notification 2',
                    message: 'Message 2',
                    type: client_1.NotificationType.APPOINTMENT_REMINDER,
                },
            ];
            jest.spyOn(service, 'create').mockResolvedValue({});
            const result = await service.createBatch(notifications);
            expect(result).toHaveLength(2);
            expect(service.create).toHaveBeenCalledTimes(2);
            expect(service.create).toHaveBeenCalledWith(notifications[0], undefined);
            expect(service.create).toHaveBeenCalledWith(notifications[1], undefined);
        });
        it('should send notifications to community', async () => {
            const members = [
                { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                { userId: test_utils_1.TEST_USER_IDS.THERAPIST },
            ];
            prismaService.membership.findMany.mockResolvedValue(members);
            jest.spyOn(service, 'createBatch').mockResolvedValue([]);
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            const notification = {
                title: 'Community Notification',
                message: 'Community message',
                type: client_1.NotificationType.COMMUNITY_POST,
            };
            await service.sendToCommunity('community-1', notification);
            expect(prismaService.membership.findMany).toHaveBeenCalledWith({
                where: { communityId: 'community-1' },
                select: { userId: true },
            });
            expect(service.createBatch).toHaveBeenCalledWith([
                { ...notification, userId: test_utils_1.TEST_USER_IDS.CLIENT },
                { ...notification, userId: test_utils_1.TEST_USER_IDS.THERAPIST },
            ], undefined);
            expect(loggerSpy).toHaveBeenCalledWith('Sent notifications to 2 community members');
        });
        it('should handle community notification errors', async () => {
            const error = new Error('Database error');
            prismaService.membership.findMany.mockRejectedValue(error);
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            await service.sendToCommunity('community-1', {});
            expect(loggerSpy).toHaveBeenCalledWith('Error sending notifications to community community-1:', error);
        });
    });
    describe('Event Listeners', () => {
        beforeEach(() => {
            jest.spyOn(service, 'create').mockResolvedValue({});
        });
        it('should handle recommendations generated event', async () => {
            const payload = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                recommendationCount: 5,
                timestamp: new Date(),
            };
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            await service.handleRecommendationsGenerated(payload);
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'New Community Recommendations',
                message: "We've found 5 new communities that might interest you based on your assessment results.",
                type: client_1.NotificationType.COMMUNITY_RECOMMENDATION,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/communities/recommendations',
                data: {
                    recommendationCount: 5,
                    generatedAt: payload.timestamp,
                },
            }, {
                realTime: true,
                email: false,
                push: true,
            });
            expect(loggerSpy).toHaveBeenCalledWith(`Community recommendation notification sent to user ${test_utils_1.TEST_USER_IDS.CLIENT}`);
        });
        it('should handle recommendation interaction event (accept)', async () => {
            const payload = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                communityId: 'community-1',
                communityName: 'Test Community',
                action: 'accept',
                compatibilityScore: 85,
                timestamp: new Date(),
            };
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            await service.handleRecommendationInteraction(payload);
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Welcome to Test Community!',
                message: "You've successfully joined Test Community. Start exploring and connecting with the community.",
                type: client_1.NotificationType.COMMUNITY_JOINED,
                priority: client_1.NotificationPriority.HIGH,
                actionUrl: '/communities/community-1',
                data: {
                    communityId: 'community-1',
                    communityName: 'Test Community',
                    compatibilityScore: 85,
                    joinMethod: 'recommendation_accepted',
                },
            }, {
                realTime: true,
                email: false,
                push: true,
            });
            expect(loggerSpy).toHaveBeenCalledWith(`Community join notification sent to user ${test_utils_1.TEST_USER_IDS.CLIENT}`);
        });
        it('should not handle recommendation interaction event (reject)', async () => {
            const payload = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                communityId: 'community-1',
                communityName: 'Test Community',
                action: 'reject',
                compatibilityScore: 85,
                timestamp: new Date(),
            };
            await service.handleRecommendationInteraction(payload);
            expect(service.create).not.toHaveBeenCalled();
        });
        it('should handle member joined event', async () => {
            const payload = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                communityId: 'community-1',
                joinMethod: 'direct',
                timestamp: new Date(),
            };
            const mockCommunity = {
                name: 'Test Community',
                _count: { memberships: 50 },
            };
            prismaService.community.findUnique.mockResolvedValue(mockCommunity);
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            await service.handleMemberJoined(payload);
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Welcome to Test Community!',
                message: "You're now part of a community with 50 members. Start exploring and connecting!",
                type: client_1.NotificationType.COMMUNITY_WELCOME,
                priority: client_1.NotificationPriority.HIGH,
                actionUrl: '/communities/community-1',
                data: {
                    communityId: 'community-1',
                    communityName: 'Test Community',
                    memberCount: 50,
                    joinMethod: 'direct',
                },
            }, {
                realTime: true,
                email: false,
                push: true,
            });
            expect(loggerSpy).toHaveBeenCalledWith(`Community welcome notification sent to user ${test_utils_1.TEST_USER_IDS.CLIENT}`);
        });
        it('should handle recommendations refreshed event', async () => {
            const payload = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                timestamp: new Date(),
            };
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            await service.handleRecommendationsRefreshed(payload);
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Community Recommendations Updated',
                message: 'Your community recommendations have been updated based on your latest assessment results.',
                type: client_1.NotificationType.RECOMMENDATIONS_UPDATED,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/communities/recommendations',
                data: {
                    refreshedAt: payload.timestamp,
                    reason: 'assessment_change',
                },
            }, {
                realTime: true,
                email: false,
                push: false,
            });
            expect(loggerSpy).toHaveBeenCalledWith(`Recommendations refreshed notification sent to user ${test_utils_1.TEST_USER_IDS.CLIENT}`);
        });
        it('should handle event errors gracefully', async () => {
            const error = new Error('Notification creation failed');
            jest.spyOn(service, 'create').mockRejectedValue(error);
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            await service.handleRecommendationsGenerated({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                recommendationCount: 5,
                timestamp: new Date(),
            });
            expect(loggerSpy).toHaveBeenCalledWith('Error handling recommendations generated event:', error);
        });
    });
    describe('Specialized Notification Methods', () => {
        beforeEach(() => {
            jest.spyOn(service, 'create').mockResolvedValue({});
        });
        it('should create appointment reminder notification', async () => {
            const appointmentTime = new Date();
            await service.createAppointmentReminder(test_utils_1.TEST_USER_IDS.CLIENT, 'appointment-1', appointmentTime, 'Dr. Smith');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Upcoming Appointment',
                message: 'You have an appointment with Dr. Smith in 1 hour.',
                type: client_1.NotificationType.APPOINTMENT_REMINDER,
                priority: client_1.NotificationPriority.HIGH,
                actionUrl: '/appointments/appointment-1',
                data: { appointmentId: 'appointment-1', appointmentTime },
            });
        });
        it('should create message notification', async () => {
            await service.createMessageNotification(test_utils_1.TEST_USER_IDS.CLIENT, test_utils_1.TEST_USER_IDS.THERAPIST, 'Dr. Smith', 'conversation-1');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'New Message',
                message: 'You have a new message from Dr. Smith.',
                type: client_1.NotificationType.MESSAGE_RECEIVED,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/messages/conversation-1',
                data: { senderId: test_utils_1.TEST_USER_IDS.THERAPIST, conversationId: 'conversation-1' },
            });
        });
        it('should create worksheet assigned notification', async () => {
            await service.createWorksheetAssignedNotification(test_utils_1.TEST_USER_IDS.CLIENT, 'worksheet-1', 'Anxiety Management', 'Dr. Smith');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'New Worksheet Assigned',
                message: 'Dr. Smith has assigned you a new worksheet: "Anxiety Management".',
                type: client_1.NotificationType.WORKSHEET_ASSIGNED,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/worksheets/worksheet-1',
                data: { worksheetId: 'worksheet-1' },
            });
        });
        it('should create therapist application approved notification', async () => {
            await service.createTherapistApplicationNotification(test_utils_1.TEST_USER_IDS.THERAPIST, 'approved');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.THERAPIST,
                title: 'Application Approved',
                message: 'Congratulations! Your therapist application has been approved.',
                type: client_1.NotificationType.THERAPIST_APPROVED,
                priority: client_1.NotificationPriority.HIGH,
                actionUrl: '/therapist/application',
                data: { status: 'approved' },
            });
        });
        it('should create therapist application rejected notification', async () => {
            await service.createTherapistApplicationNotification(test_utils_1.TEST_USER_IDS.THERAPIST, 'rejected');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.THERAPIST,
                title: 'Application Update',
                message: 'Your therapist application has been reviewed. Please check your application status.',
                type: client_1.NotificationType.THERAPIST_REJECTED,
                priority: client_1.NotificationPriority.HIGH,
                actionUrl: '/therapist/application',
                data: { status: 'rejected' },
            });
        });
        it('should create client request notification', async () => {
            await service.createClientRequestNotification(test_utils_1.TEST_USER_IDS.THERAPIST, test_utils_1.TEST_USER_IDS.CLIENT, 'John Doe', 'I need help with anxiety', 'HIGH');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.THERAPIST,
                title: 'New Client Request (High)',
                message: 'John Doe has sent you a therapy request. "I need help with anxiety"',
                type: 'CLIENT_REQUEST_RECEIVED',
                priority: 'HIGH',
                actionUrl: '/therapist/requests',
                data: {
                    clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                    clientName: 'John Doe',
                    requestType: 'therapy_request',
                    priority: 'HIGH',
                    hasMessage: true,
                },
            });
        });
        it('should create request accepted notification', async () => {
            await service.createRequestAcceptedNotification(test_utils_1.TEST_USER_IDS.CLIENT, test_utils_1.TEST_USER_IDS.THERAPIST, 'Dr. Smith', 'Looking forward to working with you');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Therapist Request Accepted! ðŸŽ‰',
                message: 'Great news! Dr. Smith has accepted your therapy request. "Looking forward to working with you"',
                type: 'THERAPIST_REQUEST_ACCEPTED',
                priority: 'HIGH',
                actionUrl: `/client/therapists/${test_utils_1.TEST_USER_IDS.THERAPIST}`,
                data: {
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    therapistName: 'Dr. Smith',
                    responseMessage: 'Looking forward to working with you',
                    schedulingInfo: undefined,
                    nextStep: 'schedule_session',
                },
            });
        });
        it('should create new recommendations notification', async () => {
            await service.createNewRecommendationsNotification(test_utils_1.TEST_USER_IDS.CLIENT, 3, 'new_therapists');
            expect(service.create).toHaveBeenCalledWith({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'New Therapist Recommendations Available',
                message: "We've found 3 new therapist matches for you with newly approved therapists. Check them out!",
                type: 'NEW_RECOMMENDATIONS',
                priority: 'NORMAL',
                actionUrl: '/client/therapists/recommendations',
                data: {
                    therapistCount: 3,
                    updateReason: 'new_therapists',
                    recommendationType: 'updated_matches',
                },
            });
        });
    });
    describe('Scheduled Notifications', () => {
        it('should send scheduled notifications', async () => {
            const now = new Date();
            const scheduledNotifications = [
                {
                    id: 'notification-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    title: 'Scheduled Notification',
                    message: 'This is a scheduled notification',
                    scheduledFor: new Date(now.getTime() - 1000),
                    sentAt: null,
                },
                {
                    id: 'notification-2',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    title: 'Another Scheduled Notification',
                    message: 'This is another scheduled notification',
                    scheduledFor: new Date(now.getTime() - 2000),
                    sentAt: null,
                },
            ];
            prismaService.notification.findMany.mockResolvedValue(scheduledNotifications);
            prismaService.notification.update.mockResolvedValue({});
            const result = await service.sendScheduledNotifications();
            expect(result).toEqual({ sent: 2 });
            expect(prismaService.notification.findMany).toHaveBeenCalledWith({
                where: {
                    scheduledFor: {
                        lte: expect.any(Date),
                    },
                    sentAt: null,
                },
            });
            expect(prismaService.notification.update).toHaveBeenCalledTimes(2);
        });
    });
    describe('Delivery Error Handling', () => {
        beforeEach(() => {
            service.setWebSocketServer(mockWebSocketServer);
        });
        it('should handle delivery errors gracefully', async () => {
            const error = new Error('Delivery failed');
            jest.spyOn(service, 'deliverRealTimeNotification').mockRejectedValue(error);
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            const notification = {
                id: 'notification-1',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                user: { id: test_utils_1.TEST_USER_IDS.CLIENT },
            };
            await service['deliverNotification'](notification, { realTime: true });
            expect(loggerSpy).toHaveBeenCalledWith('Error delivering notification notification-1:', error);
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete notification flow', async () => {
            service.setWebSocketServer(mockWebSocketServer);
            const notificationData = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                title: 'Integration Test',
                message: 'This is an integration test',
                type: client_1.NotificationType.MESSAGE_RECEIVED,
                priority: client_1.NotificationPriority.NORMAL,
            };
            const createdNotification = {
                id: 'notification-1',
                ...notificationData,
                createdAt: new Date(),
                isRead: false,
                user: {
                    id: test_utils_1.TEST_USER_IDS.CLIENT,
                    firstName: 'John',
                    lastName: 'Doe',
                    email: 'john@example.com',
                },
            };
            prismaService.notification.create.mockResolvedValue(createdNotification);
            prismaService.notification.count.mockResolvedValue(1);
            const result = await service.create(notificationData);
            // Verify notification was created
            expect(result).toEqual(createdNotification);
            expect(prismaService.notification.create).toHaveBeenCalled();
            // Verify WebSocket delivery was attempted
            expect(mockWebSocketServer.to).toHaveBeenCalledWith(`user:${test_utils_1.TEST_USER_IDS.CLIENT}`);
            expect(mockWebSocketServer.to().emit).toHaveBeenCalledWith('notification', expect.any(Object));
            expect(mockWebSocketServer.to().emit).toHaveBeenCalledWith('unreadCount', { count: 1 });
        });
        it('should handle event-driven notifications', async () => {
            jest.spyOn(service, 'create').mockResolvedValue({});
            const payload = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                recommendationCount: 3,
                timestamp: new Date(),
            };
            await service.handleRecommendationsGenerated(payload);
            expect(service.create).toHaveBeenCalledWith(expect.objectContaining({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                type: client_1.NotificationType.COMMUNITY_RECOMMENDATION,
            }), expect.objectContaining({
                realTime: true,
                push: true,
            }));
        });
        it('should handle batch community notifications', async () => {
            const members = [
                { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                { userId: test_utils_1.TEST_USER_IDS.THERAPIST },
                { userId: test_utils_1.TEST_USER_IDS.ADMIN },
            ];
            prismaService.membership.findMany.mockResolvedValue(members);
            jest.spyOn(service, 'create').mockResolvedValue({});
            const notification = {
                title: 'Community Update',
                message: 'New community guidelines are available',
                type: client_1.NotificationType.COMMUNITY_POST,
            };
            await service.sendToCommunity('community-1', notification);
            expect(service.create).toHaveBeenCalledTimes(3);
            expect(service.create).toHaveBeenCalledWith({ ...notification, userId: test_utils_1.TEST_USER_IDS.CLIENT }, undefined);
            expect(service.create).toHaveBeenCalledWith({ ...notification, userId: test_utils_1.TEST_USER_IDS.THERAPIST }, undefined);
            expect(service.create).toHaveBeenCalledWith({ ...notification, userId: test_utils_1.TEST_USER_IDS.ADMIN }, undefined);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9ucy5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQTJEO0FBQzNELHlEQUFzRDtBQUN0RCxtRUFBK0Q7QUFDL0QsZ0ZBQW9FO0FBQ3BFLDJDQUF3RTtBQUN4RSw4Q0FBdUU7QUFFdkUsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxJQUFJLE9BQTZCLENBQUM7SUFDbEMsSUFBSSxhQUF5QyxDQUFDO0lBQzlDLElBQUksWUFBd0MsQ0FBQztJQUM3QyxJQUFJLG1CQUFxQyxDQUFDO0lBRTFDLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLFVBQVUsR0FBRyxJQUFBLG9DQUF1QixHQUFFLENBQUM7UUFDN0MsTUFBTSxnQkFBZ0IsR0FBRztZQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNoQixDQUFDO1FBRUYsbUJBQW1CLEdBQUc7WUFDcEIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDaEIsQ0FBQyxDQUFDO1NBQ0osQ0FBQztRQUVGLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1QsNENBQW9CO2dCQUNwQjtvQkFDRSxPQUFPLEVBQUUsc0NBQWE7b0JBQ3RCLFFBQVEsRUFBRSxVQUFVO2lCQUNyQjtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsNkJBQWE7b0JBQ3RCLFFBQVEsRUFBRSxnQkFBZ0I7aUJBQzNCO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBdUIsNENBQW9CLENB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QU0sQ0FBQyxDQUFDLG9CQUFvQixDQUN6QyxFQUFFLEdBQUcsWUFBWSxFQUFFLE1BQU0sRUFBRSwwQkFBYSxDQUFDLEtBQUssRUFBRSxFQUNoRCxTQUFTLENBQ1YsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbm90aWZpY2F0aW9ucy9ub3RpZmljYXRpb25zLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IE5vdEZvdW5kRXhjZXB0aW9uLCBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIyIH0gZnJvbSAnQG5lc3Rqcy9ldmVudC1lbWl0dGVyJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi9ub3RpZmljYXRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblR5cGUsIE5vdGlmaWNhdGlvblByaW9yaXR5IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHsgY3JlYXRlTW9ja1ByaXNtYVNlcnZpY2UsIFRFU1RfVVNFUl9JRFMgfSBmcm9tICcuLi90ZXN0LXV0aWxzJztcblxuZGVzY3JpYmUoJ05vdGlmaWNhdGlvbnNTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogTm90aWZpY2F0aW9uc1NlcnZpY2U7XG4gIGxldCBwcmlzbWFTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxQcmlzbWFTZXJ2aWNlPjtcbiAgbGV0IGV2ZW50RW1pdHRlcjogamVzdC5Nb2NrZWQ8RXZlbnRFbWl0dGVyMj47XG4gIGxldCBtb2NrV2ViU29ja2V0U2VydmVyOiBqZXN0Lk1vY2tlZDxhbnk+O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tQcmlzbWEgPSBjcmVhdGVNb2NrUHJpc21hU2VydmljZSgpO1xuICAgIGNvbnN0IG1vY2tFdmVudEVtaXR0ZXIgPSB7XG4gICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIG1vY2tXZWJTb2NrZXRTZXJ2ZXIgPSB7XG4gICAgICB0bzogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgICB9KSksXG4gICAgfTtcblxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgTm90aWZpY2F0aW9uc1NlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUHJpc21hLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogRXZlbnRFbWl0dGVyMixcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0V2ZW50RW1pdHRlcixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8Tm90aWZpY2F0aW9uc1NlcnZpY2U+KE5vdGlmaWNhdGlvbnNTZXJ2aWNlKTtcbiAgICBwcmlzbWFTZXJ2aWNlID0gbW9kdWxlLmdldChQcmlzbWFTZXJ2aWNlKTtcbiAgICBldmVudEVtaXR0ZXIgPSBtb2R1bGUuZ2V0KEV2ZW50RW1pdHRlcjIpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdvbk1vZHVsZUluaXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBsb2cgaW5pdGlhbGl6YXRpb24gbWVzc2FnZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuICAgICAgXG4gICAgICBzZXJ2aWNlLm9uTW9kdWxlSW5pdCgpO1xuICAgICAgXG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ05vdGlmaWNhdGlvbnNTZXJ2aWNlIGluaXRpYWxpemVkIHdpdGggcmVhbC10aW1lIGNhcGFiaWxpdGllcydcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZXRXZWJTb2NrZXRTZXJ2ZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgV2ViU29ja2V0IHNlcnZlciBhbmQgbG9nIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcbiAgICAgIFxuICAgICAgc2VydmljZS5zZXRXZWJTb2NrZXRTZXJ2ZXIobW9ja1dlYlNvY2tldFNlcnZlcik7XG4gICAgICBcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnV2ViU29ja2V0IHNlcnZlciBjb25maWd1cmVkIGZvciByZWFsLXRpbWUgbm90aWZpY2F0aW9ucydcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGUnLCAoKSA9PiB7XG4gICAgY29uc3QgbW9ja05vdGlmaWNhdGlvbkRhdGEgPSB7XG4gICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgdGl0bGU6ICdUZXN0IE5vdGlmaWNhdGlvbicsXG4gICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhIHRlc3Qgbm90aWZpY2F0aW9uJyxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCxcbiAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICBhY3Rpb25Vcmw6ICcvbWVzc2FnZXMvMTIzJyxcbiAgICAgIGRhdGE6IHsgbWVzc2FnZUlkOiAnMTIzJyB9LFxuICAgIH07XG5cbiAgICBjb25zdCBtb2NrQ3JlYXRlZE5vdGlmaWNhdGlvbiA9IHtcbiAgICAgIGlkOiAnbm90aWZpY2F0aW9uLTEnLFxuICAgICAgLi4ubW9ja05vdGlmaWNhdGlvbkRhdGEsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgcmVhZEF0OiBudWxsLFxuICAgICAgc2NoZWR1bGVkRm9yOiBudWxsLFxuICAgICAgc2VudEF0OiBudWxsLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgIGVtYWlsOiAnam9obkBleGFtcGxlLmNvbScsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ3JlYXRlZE5vdGlmaWNhdGlvbik7XG4gICAgICBzZXJ2aWNlLnNldFdlYlNvY2tldFNlcnZlcihtb2NrV2ViU29ja2V0U2VydmVyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5vdGlmaWNhdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShtb2NrTm90aWZpY2F0aW9uRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NyZWF0ZWROb3RpZmljYXRpb24pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgLi4ubW9ja05vdGlmaWNhdGlvbkRhdGEsXG4gICAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5Lk5PUk1BTCxcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2V0IGRlZmF1bHQgcHJpb3JpdHkgd2hlbiBub3QgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhV2l0aG91dFByaW9yaXR5ID0ge1xuICAgICAgICAuLi5tb2NrTm90aWZpY2F0aW9uRGF0YSxcbiAgICAgICAgcHJpb3JpdHk6IHVuZGVmaW5lZCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlKGRhdGFXaXRob3V0UHJpb3JpdHkpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5ub3RpZmljYXRpb24uY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi5kYXRhV2l0aG91dFByaW9yaXR5LFxuICAgICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxpdmVyIG5vdGlmaWNhdGlvbiBpbW1lZGlhdGVseSB3aGVuIG5vdCBzY2hlZHVsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZWxpdmVyU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2RlbGl2ZXJOb3RpZmljYXRpb24nKTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5jcmVhdGUobW9ja05vdGlmaWNhdGlvbkRhdGEpO1xuXG4gICAgICBleHBlY3QoZGVsaXZlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja0NyZWF0ZWROb3RpZmljYXRpb24sIHtcbiAgICAgICAgcmVhbFRpbWU6IHRydWUsXG4gICAgICAgIGVtYWlsOiBmYWxzZSxcbiAgICAgICAgcHVzaDogZmFsc2UsXG4gICAgICAgIHNjaGVkdWxlZDogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGRlbGl2ZXIgbm90aWZpY2F0aW9uIHdoZW4gc2NoZWR1bGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGVsaXZlclNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdkZWxpdmVyTm90aWZpY2F0aW9uJyk7XG4gICAgICBjb25zdCBzY2hlZHVsZWREYXRhID0ge1xuICAgICAgICAuLi5tb2NrTm90aWZpY2F0aW9uRGF0YSxcbiAgICAgICAgc2NoZWR1bGVkRm9yOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNjAwMDApLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5jcmVhdGUoc2NoZWR1bGVkRGF0YSk7XG5cbiAgICAgIGV4cGVjdChkZWxpdmVyU3B5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgY3VzdG9tIGRlbGl2ZXJ5IG9wdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZWxpdmVyU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgJ2RlbGl2ZXJOb3RpZmljYXRpb24nKTtcbiAgICAgIGNvbnN0IGN1c3RvbU9wdGlvbnMgPSB7XG4gICAgICAgIHJlYWxUaW1lOiB0cnVlLFxuICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgcHVzaDogdHJ1ZSxcbiAgICAgICAgc2NoZWR1bGVkOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlKG1vY2tOb3RpZmljYXRpb25EYXRhLCBjdXN0b21PcHRpb25zKTtcblxuICAgICAgZXhwZWN0KGRlbGl2ZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDcmVhdGVkTm90aWZpY2F0aW9uLCBjdXN0b21PcHRpb25zKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XG4gICAgY29uc3QgbW9ja05vdGlmaWNhdGlvbnMgPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnbm90aWZpY2F0aW9uLTEnLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB0aXRsZTogJ1Rlc3QgTm90aWZpY2F0aW9uIDEnLFxuICAgICAgICBtZXNzYWdlOiAnTWVzc2FnZSAxJyxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5NRVNTQUdFX1JFQ0VJVkVELFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgICAgaXNSZWFkOiBmYWxzZSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaWQ6ICdub3RpZmljYXRpb24tMicsXG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHRpdGxlOiAnVGVzdCBOb3RpZmljYXRpb24gMicsXG4gICAgICAgIG1lc3NhZ2U6ICdNZXNzYWdlIDInLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkFQUE9JTlRNRU5UX1JFTUlOREVSLFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMLFxuICAgICAgICBpc1JlYWQ6IHRydWUsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5ub3RpZmljYXRpb24uZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja05vdGlmaWNhdGlvbnMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYWxsIG5vdGlmaWNhdGlvbnMgZm9yIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tOb3RpZmljYXRpb25zKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgIG9yZGVyQnk6IFt7IHByaW9yaXR5OiAnZGVzYycgfSwgeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XSxcbiAgICAgICAgdGFrZTogNTAsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIGJ5IHJlYWQgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2VydmljZS5maW5kQWxsKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBmYWxzZSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBpc1JlYWQ6IGZhbHNlIH0sXG4gICAgICAgIG9yZGVyQnk6IFt7IHByaW9yaXR5OiAnZGVzYycgfSwgeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XSxcbiAgICAgICAgdGFrZTogNTAsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIGJ5IHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHVuZGVmaW5lZCwgTm90aWZpY2F0aW9uVHlwZS5NRVNTQUdFX1JFQ0VJVkVEKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCB9LFxuICAgICAgICBvcmRlckJ5OiBbeyBwcmlvcml0eTogJ2Rlc2MnIH0sIHsgY3JlYXRlZEF0OiAnZGVzYycgfV0sXG4gICAgICAgIHRha2U6IDUwLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBieSBwcmlvcml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuZmluZEFsbChURVNUX1VTRVJfSURTLkNMSUVOVCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0gpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5ub3RpZmljYXRpb24uZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCwgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0ggfSxcbiAgICAgICAgb3JkZXJCeTogW3sgcHJpb3JpdHk6ICdkZXNjJyB9LCB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1dLFxuICAgICAgICB0YWtlOiA1MCxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgbXVsdGlwbGUgY3JpdGVyaWEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHRydWUsIE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCwgTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgaXNSZWFkOiB0cnVlLFxuICAgICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCxcbiAgICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXJCeTogW3sgcHJpb3JpdHk6ICdkZXNjJyB9LCB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1dLFxuICAgICAgICB0YWtlOiA1MCxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZE9uZScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrTm90aWZpY2F0aW9uID0ge1xuICAgICAgaWQ6ICdub3RpZmljYXRpb24tMScsXG4gICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgdGl0bGU6ICdUZXN0IE5vdGlmaWNhdGlvbicsXG4gICAgICBtZXNzYWdlOiAnVGVzdCBtZXNzYWdlJyxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCxcbiAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgIGVtYWlsOiAnam9obkBleGFtcGxlLmNvbScsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBub3RpZmljYXRpb24gYnkgSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tOb3RpZmljYXRpb24pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJ25vdGlmaWNhdGlvbi0xJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja05vdGlmaWNhdGlvbik7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5ub3RpZmljYXRpb24uZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ25vdGlmaWNhdGlvbi0xJyB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCB3aGVuIG5vdGlmaWNhdGlvbiBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJ25vbi1leGlzdGVudCcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWFya0FzUmVhZCcsICgpID0+IHtcbiAgICBjb25zdCBtb2NrTm90aWZpY2F0aW9uID0ge1xuICAgICAgaWQ6ICdub3RpZmljYXRpb24tMScsXG4gICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgaXNSZWFkOiBmYWxzZSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgICBlbWFpbDogJ2pvaG5AZXhhbXBsZS5jb20nLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBtYXJrIG5vdGlmaWNhdGlvbiBhcyByZWFkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnZmluZE9uZScpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tOb3RpZmljYXRpb24pO1xuICAgICAgY29uc3QgdXBkYXRlZE5vdGlmaWNhdGlvbiA9IHsgLi4ubW9ja05vdGlmaWNhdGlvbiwgaXNSZWFkOiB0cnVlLCByZWFkQXQ6IG5ldyBEYXRlKCkgfTtcbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkTm90aWZpY2F0aW9uKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5tYXJrQXNSZWFkKCdub3RpZmljYXRpb24tMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWROb3RpZmljYXRpb24pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ25vdGlmaWNhdGlvbi0xJyB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNSZWFkOiB0cnVlLFxuICAgICAgICAgIHJlYWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiB3aGVuIG5vdGlmaWNhdGlvbiBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kT25lJykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLm1hcmtBc1JlYWQoJ25vbi1leGlzdGVudCcpKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWFya0FsbEFzUmVhZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgYWxsIHVucmVhZCBub3RpZmljYXRpb25zIGFzIHJlYWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi51cGRhdGVNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKHsgY291bnQ6IDUgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubWFya0FsbEFzUmVhZChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBjb3VudDogNSB9KTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi51cGRhdGVNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaXNSZWFkOiB0cnVlLFxuICAgICAgICAgIHJlYWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGVsZXRlJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tOb3RpZmljYXRpb24gPSB7XG4gICAgICBpZDogJ25vdGlmaWNhdGlvbi0xJyxcbiAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgIGVtYWlsOiAnam9obkBleGFtcGxlLmNvbScsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBub3RpZmljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kT25lJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja05vdGlmaWNhdGlvbik7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5kZWxldGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja05vdGlmaWNhdGlvbik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZGVsZXRlKCdub3RpZmljYXRpb24tMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tOb3RpZmljYXRpb24pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ25vdGlmaWNhdGlvbi0xJyB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gbm90aWZpY2F0aW9uIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2ZpbmRPbmUnKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZGVsZXRlKCdub24tZXhpc3RlbnQnKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFVucmVhZENvdW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVucmVhZCBub3RpZmljYXRpb24gY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVbnJlYWRDb3VudChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMyk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5ub3RpZmljYXRpb24uY291bnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIGlzUmVhZDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE5vdGlmaWNhdGlvblNldHRpbmdzJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tTZXR0aW5ncyA9IHtcbiAgICAgIGlkOiAnc2V0dGluZ3MtMScsXG4gICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgZW1haWxBcHBvaW50bWVudFJlbWluZGVyczogdHJ1ZSxcbiAgICAgIGVtYWlsTmV3TWVzc2FnZXM6IHRydWUsXG4gICAgICBwdXNoTmV3TWVzc2FnZXM6IHRydWUsXG4gICAgICBxdWlldEhvdXJzRW5hYmxlZDogZmFsc2UsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGV4aXN0aW5nIG5vdGlmaWNhdGlvbiBzZXR0aW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uU2V0dGluZ3MuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU2V0dGluZ3MpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldE5vdGlmaWNhdGlvblNldHRpbmdzKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU2V0dGluZ3MpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uU2V0dGluZ3MuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGRlZmF1bHQgc2V0dGluZ3Mgd2hlbiBub25lIGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5ub3RpZmljYXRpb25TZXR0aW5ncy5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgcHJpc21hU2VydmljZS5ub3RpZmljYXRpb25TZXR0aW5ncy5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NldHRpbmdzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXROb3RpZmljYXRpb25TZXR0aW5ncyhURVNUX1VTRVJfSURTLkNMSUVOVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1NldHRpbmdzKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvblNldHRpbmdzLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MnLCAoKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgIGVtYWlsQXBwb2ludG1lbnRSZW1pbmRlcnM6IGZhbHNlLFxuICAgICAgcHVzaE5ld01lc3NhZ2VzOiB0cnVlLFxuICAgICAgcXVpZXRIb3Vyc0VuYWJsZWQ6IHRydWUsXG4gICAgICBxdWlldEhvdXJzU3RhcnQ6ICcyMjowMCcsXG4gICAgICBxdWlldEhvdXJzRW5kOiAnMDg6MDAnLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBub3RpZmljYXRpb24gc2V0dGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVkU2V0dGluZ3MgPSB7IC4uLnVwZGF0ZURhdGEsIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfTtcbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uU2V0dGluZ3MudXBzZXJ0Lm1vY2tSZXNvbHZlZFZhbHVlKHVwZGF0ZWRTZXR0aW5ncyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHVwZGF0ZURhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRTZXR0aW5ncyk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5ub3RpZmljYXRpb25TZXR0aW5ncy51cHNlcnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCB9LFxuICAgICAgICB1cGRhdGU6IHVwZGF0ZURhdGEsXG4gICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgLi4udXBkYXRlRGF0YSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVhbC10aW1lIE5vdGlmaWNhdGlvbiBEZWxpdmVyeScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHNlcnZpY2Uuc2V0V2ViU29ja2V0U2VydmVyKG1vY2tXZWJTb2NrZXRTZXJ2ZXIpO1xuICAgICAgcHJpc21hU2VydmljZS5ub3RpZmljYXRpb24uY291bnQubW9ja1Jlc29sdmVkVmFsdWUoNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGl2ZXIgcmVhbC10aW1lIG5vdGlmaWNhdGlvbiB2aWEgV2ViU29ja2V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0ge1xuICAgICAgICBpZDogJ25vdGlmaWNhdGlvbi0xJyxcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgdGl0bGU6ICdUZXN0IE5vdGlmaWNhdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdUZXN0IG1lc3NhZ2UnLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLk1FU1NBR0VfUkVDRUlWRUQsXG4gICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICAgIGFjdGlvblVybDogJy9tZXNzYWdlcy8xMjMnLFxuICAgICAgICBkYXRhOiB7IG1lc3NhZ2VJZDogJzEyMycgfSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgICB1c2VyOiB7IGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCB9LFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZVsnZGVsaXZlclJlYWxUaW1lTm90aWZpY2F0aW9uJ10obm90aWZpY2F0aW9uKTtcblxuICAgICAgZXhwZWN0KG1vY2tXZWJTb2NrZXRTZXJ2ZXIudG8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGB1c2VyOiR7VEVTVF9VU0VSX0lEUy5DTElFTlR9YCk7XG4gICAgICBleHBlY3QobW9ja1dlYlNvY2tldFNlcnZlci50bygpLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdub3RpZmljYXRpb24nLCB7XG4gICAgICAgIGlkOiAnbm90aWZpY2F0aW9uLTEnLFxuICAgICAgICB0aXRsZTogJ1Rlc3QgTm90aWZpY2F0aW9uJyxcbiAgICAgICAgbWVzc2FnZTogJ1Rlc3QgbWVzc2FnZScsXG4gICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCxcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5Lk5PUk1BTCxcbiAgICAgICAgYWN0aW9uVXJsOiAnL21lc3NhZ2VzLzEyMycsXG4gICAgICAgIGRhdGE6IHsgbWVzc2FnZUlkOiAnMTIzJyB9LFxuICAgICAgICBjcmVhdGVkQXQ6IG5vdGlmaWNhdGlvbi5jcmVhdGVkQXQsXG4gICAgICAgIGlzUmVhZDogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrV2ViU29ja2V0U2VydmVyLnRvKCkuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VucmVhZENvdW50JywgeyBjb3VudDogNSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd2FybiB3aGVuIFdlYlNvY2tldCBzZXJ2ZXIgbm90IGNvbmZpZ3VyZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXJ2aWNlLnNldFdlYlNvY2tldFNlcnZlcihudWxsKTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ3dhcm4nKTtcblxuICAgICAgYXdhaXQgc2VydmljZVsnZGVsaXZlclJlYWxUaW1lTm90aWZpY2F0aW9uJ10oe30gYXMgYW55KTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdXZWJTb2NrZXQgc2VydmVyIG5vdCBjb25maWd1cmVkIGZvciByZWFsLXRpbWUgbm90aWZpY2F0aW9ucydcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZWFsLXRpbWUgZGVsaXZlcnkgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1dlYlNvY2tldCBlcnJvcicpO1xuICAgICAgbW9ja1dlYlNvY2tldFNlcnZlci50by5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcblxuICAgICAgYXdhaXQgc2VydmljZVsnZGVsaXZlclJlYWxUaW1lTm90aWZpY2F0aW9uJ10oe30gYXMgYW55KTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdFcnJvciBkZWxpdmVyaW5nIHJlYWwtdGltZSBub3RpZmljYXRpb246JyxcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFbWFpbCBhbmQgUHVzaCBOb3RpZmljYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbG9nIGVtYWlsIG5vdGlmaWNhdGlvbiBxdWV1ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCwgdXNlcjoge30gfSBhcyBhbnk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2VbJ2RlbGl2ZXJFbWFpbE5vdGlmaWNhdGlvbiddKG5vdGlmaWNhdGlvbik7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBgRW1haWwgbm90aWZpY2F0aW9uIHF1ZXVlZCBmb3IgdXNlciAke1RFU1RfVVNFUl9JRFMuQ0xJRU5UfWBcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBwdXNoIG5vdGlmaWNhdGlvbiBxdWV1ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCwgdXNlcjoge30gfSBhcyBhbnk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2VbJ2RlbGl2ZXJQdXNoTm90aWZpY2F0aW9uJ10obm90aWZpY2F0aW9uKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGBQdXNoIG5vdGlmaWNhdGlvbiBxdWV1ZWQgZm9yIHVzZXIgJHtURVNUX1VTRVJfSURTLkNMSUVOVH1gXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQmF0Y2ggT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBiYXRjaCBub3RpZmljYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgdGl0bGU6ICdOb3RpZmljYXRpb24gMScsXG4gICAgICAgICAgbWVzc2FnZTogJ01lc3NhZ2UgMScsXG4gICAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5NRVNTQUdFX1JFQ0VJVkVELFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgICB0aXRsZTogJ05vdGlmaWNhdGlvbiAyJyxcbiAgICAgICAgICBtZXNzYWdlOiAnTWVzc2FnZSAyJyxcbiAgICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkFQUE9JTlRNRU5UX1JFTUlOREVSLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnY3JlYXRlJykubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGVCYXRjaChub3RpZmljYXRpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG5vdGlmaWNhdGlvbnNbMF0sIHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG5vdGlmaWNhdGlvbnNbMV0sIHVuZGVmaW5lZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgbm90aWZpY2F0aW9ucyB0byBjb21tdW5pdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtZW1iZXJzID0gW1xuICAgICAgICB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfSxcbiAgICAgICAgeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUIH0sXG4gICAgICBdO1xuICAgICAgcHJpc21hU2VydmljZS5tZW1iZXJzaGlwLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1lbWJlcnMpO1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnY3JlYXRlQmF0Y2gnKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0ge1xuICAgICAgICB0aXRsZTogJ0NvbW11bml0eSBOb3RpZmljYXRpb24nLFxuICAgICAgICBtZXNzYWdlOiAnQ29tbXVuaXR5IG1lc3NhZ2UnLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9QT1NULFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zZW5kVG9Db21tdW5pdHkoJ2NvbW11bml0eS0xJywgbm90aWZpY2F0aW9uKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubWVtYmVyc2hpcC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBjb21tdW5pdHlJZDogJ2NvbW11bml0eS0xJyB9LFxuICAgICAgICBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZUJhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbXG4gICAgICAgIHsgLi4ubm90aWZpY2F0aW9uLCB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgIHsgLi4ubm90aWZpY2F0aW9uLCB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUIH0sXG4gICAgICBdLCB1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdTZW50IG5vdGlmaWNhdGlvbnMgdG8gMiBjb21tdW5pdHkgbWVtYmVycydcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21tdW5pdHkgbm90aWZpY2F0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpO1xuICAgICAgcHJpc21hU2VydmljZS5tZW1iZXJzaGlwLmZpbmRNYW55Lm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2Vycm9yJyk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2VuZFRvQ29tbXVuaXR5KCdjb21tdW5pdHktMScsIHt9IGFzIGFueSk7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnRXJyb3Igc2VuZGluZyBub3RpZmljYXRpb25zIHRvIGNvbW11bml0eSBjb21tdW5pdHktMTonLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0V2ZW50IExpc3RlbmVycycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2NyZWF0ZScpLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZWNvbW1lbmRhdGlvbnMgZ2VuZXJhdGVkIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgcmVjb21tZW5kYXRpb25Db3VudDogNSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uc0dlbmVyYXRlZChwYXlsb2FkKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHRpdGxlOiAnTmV3IENvbW11bml0eSBSZWNvbW1lbmRhdGlvbnMnLFxuICAgICAgICBtZXNzYWdlOiBcIldlJ3ZlIGZvdW5kIDUgbmV3IGNvbW11bml0aWVzIHRoYXQgbWlnaHQgaW50ZXJlc3QgeW91IGJhc2VkIG9uIHlvdXIgYXNzZXNzbWVudCByZXN1bHRzLlwiLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9SRUNPTU1FTkRBVElPTixcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5Lk5PUk1BTCxcbiAgICAgICAgYWN0aW9uVXJsOiAnL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucycsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbkNvdW50OiA1LFxuICAgICAgICAgIGdlbmVyYXRlZEF0OiBwYXlsb2FkLnRpbWVzdGFtcCxcbiAgICAgICAgfSxcbiAgICAgIH0sIHtcbiAgICAgICAgcmVhbFRpbWU6IHRydWUsXG4gICAgICAgIGVtYWlsOiBmYWxzZSxcbiAgICAgICAgcHVzaDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGBDb21tdW5pdHkgcmVjb21tZW5kYXRpb24gbm90aWZpY2F0aW9uIHNlbnQgdG8gdXNlciAke1RFU1RfVVNFUl9JRFMuQ0xJRU5UfWBcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZWNvbW1lbmRhdGlvbiBpbnRlcmFjdGlvbiBldmVudCAoYWNjZXB0KScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNvbW11bml0eUlkOiAnY29tbXVuaXR5LTEnLFxuICAgICAgICBjb21tdW5pdHlOYW1lOiAnVGVzdCBDb21tdW5pdHknLFxuICAgICAgICBhY3Rpb246ICdhY2NlcHQnIGFzIGNvbnN0LFxuICAgICAgICBjb21wYXRpYmlsaXR5U2NvcmU6IDg1LFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnbG9nJyk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbihwYXlsb2FkKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHRpdGxlOiAnV2VsY29tZSB0byBUZXN0IENvbW11bml0eSEnLFxuICAgICAgICBtZXNzYWdlOiBcIllvdSd2ZSBzdWNjZXNzZnVsbHkgam9pbmVkIFRlc3QgQ29tbXVuaXR5LiBTdGFydCBleHBsb3JpbmcgYW5kIGNvbm5lY3Rpbmcgd2l0aCB0aGUgY29tbXVuaXR5LlwiLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9KT0lORUQsXG4gICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5ISUdILFxuICAgICAgICBhY3Rpb25Vcmw6ICcvY29tbXVuaXRpZXMvY29tbXVuaXR5LTEnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgY29tbXVuaXR5SWQ6ICdjb21tdW5pdHktMScsXG4gICAgICAgICAgY29tbXVuaXR5TmFtZTogJ1Rlc3QgQ29tbXVuaXR5JyxcbiAgICAgICAgICBjb21wYXRpYmlsaXR5U2NvcmU6IDg1LFxuICAgICAgICAgIGpvaW5NZXRob2Q6ICdyZWNvbW1lbmRhdGlvbl9hY2NlcHRlZCcsXG4gICAgICAgIH0sXG4gICAgICB9LCB7XG4gICAgICAgIHJlYWxUaW1lOiB0cnVlLFxuICAgICAgICBlbWFpbDogZmFsc2UsXG4gICAgICAgIHB1c2g6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBgQ29tbXVuaXR5IGpvaW4gbm90aWZpY2F0aW9uIHNlbnQgdG8gdXNlciAke1RFU1RfVVNFUl9JRFMuQ0xJRU5UfWBcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBoYW5kbGUgcmVjb21tZW5kYXRpb24gaW50ZXJhY3Rpb24gZXZlbnQgKHJlamVjdCknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBjb21tdW5pdHlJZDogJ2NvbW11bml0eS0xJyxcbiAgICAgICAgY29tbXVuaXR5TmFtZTogJ1Rlc3QgQ29tbXVuaXR5JyxcbiAgICAgICAgYWN0aW9uOiAncmVqZWN0JyBhcyBjb25zdCxcbiAgICAgICAgY29tcGF0aWJpbGl0eVNjb3JlOiA4NSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKHBheWxvYWQpO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtZW1iZXIgam9pbmVkIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgY29tbXVuaXR5SWQ6ICdjb21tdW5pdHktMScsXG4gICAgICAgIGpvaW5NZXRob2Q6ICdkaXJlY3QnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja0NvbW11bml0eSA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgQ29tbXVuaXR5JyxcbiAgICAgICAgX2NvdW50OiB7IG1lbWJlcnNoaXBzOiA1MCB9LFxuICAgICAgfTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY29tbXVuaXR5LmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbW11bml0eSk7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5oYW5kbGVNZW1iZXJKb2luZWQocGF5bG9hZCk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB0aXRsZTogJ1dlbGNvbWUgdG8gVGVzdCBDb21tdW5pdHkhJyxcbiAgICAgICAgbWVzc2FnZTogXCJZb3UncmUgbm93IHBhcnQgb2YgYSBjb21tdW5pdHkgd2l0aCA1MCBtZW1iZXJzLiBTdGFydCBleHBsb3JpbmcgYW5kIGNvbm5lY3RpbmchXCIsXG4gICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuQ09NTVVOSVRZX1dFTENPTUUsXG4gICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5ISUdILFxuICAgICAgICBhY3Rpb25Vcmw6ICcvY29tbXVuaXRpZXMvY29tbXVuaXR5LTEnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgY29tbXVuaXR5SWQ6ICdjb21tdW5pdHktMScsXG4gICAgICAgICAgY29tbXVuaXR5TmFtZTogJ1Rlc3QgQ29tbXVuaXR5JyxcbiAgICAgICAgICBtZW1iZXJDb3VudDogNTAsXG4gICAgICAgICAgam9pbk1ldGhvZDogJ2RpcmVjdCcsXG4gICAgICAgIH0sXG4gICAgICB9LCB7XG4gICAgICAgIHJlYWxUaW1lOiB0cnVlLFxuICAgICAgICBlbWFpbDogZmFsc2UsXG4gICAgICAgIHB1c2g6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBgQ29tbXVuaXR5IHdlbGNvbWUgbm90aWZpY2F0aW9uIHNlbnQgdG8gdXNlciAke1RFU1RfVVNFUl9JRFMuQ0xJRU5UfWBcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uc1JlZnJlc2hlZChwYXlsb2FkKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHRpdGxlOiAnQ29tbXVuaXR5IFJlY29tbWVuZGF0aW9ucyBVcGRhdGVkJyxcbiAgICAgICAgbWVzc2FnZTogJ1lvdXIgY29tbXVuaXR5IHJlY29tbWVuZGF0aW9ucyBoYXZlIGJlZW4gdXBkYXRlZCBiYXNlZCBvbiB5b3VyIGxhdGVzdCBhc3Nlc3NtZW50IHJlc3VsdHMuJyxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5SRUNPTU1FTkRBVElPTlNfVVBEQVRFRCxcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5Lk5PUk1BTCxcbiAgICAgICAgYWN0aW9uVXJsOiAnL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucycsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICByZWZyZXNoZWRBdDogcGF5bG9hZC50aW1lc3RhbXAsXG4gICAgICAgICAgcmVhc29uOiAnYXNzZXNzbWVudF9jaGFuZ2UnLFxuICAgICAgICB9LFxuICAgICAgfSwge1xuICAgICAgICByZWFsVGltZTogdHJ1ZSxcbiAgICAgICAgZW1haWw6IGZhbHNlLFxuICAgICAgICBwdXNoOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGBSZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIG5vdGlmaWNhdGlvbiBzZW50IHRvIHVzZXIgJHtURVNUX1VTRVJfSURTLkNMSUVOVH1gXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZXZlbnQgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignTm90aWZpY2F0aW9uIGNyZWF0aW9uIGZhaWxlZCcpO1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnY3JlYXRlJykubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbnNHZW5lcmF0ZWQoe1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICByZWNvbW1lbmRhdGlvbkNvdW50OiA1LFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdFcnJvciBoYW5kbGluZyByZWNvbW1lbmRhdGlvbnMgZ2VuZXJhdGVkIGV2ZW50OicsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3BlY2lhbGl6ZWQgTm90aWZpY2F0aW9uIE1ldGhvZHMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdjcmVhdGUnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYXBwb2ludG1lbnQgcmVtaW5kZXIgbm90aWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXBwb2ludG1lbnRUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5jcmVhdGVBcHBvaW50bWVudFJlbWluZGVyKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2FwcG9pbnRtZW50LTEnLFxuICAgICAgICBhcHBvaW50bWVudFRpbWUsXG4gICAgICAgICdEci4gU21pdGgnXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgdGl0bGU6ICdVcGNvbWluZyBBcHBvaW50bWVudCcsXG4gICAgICAgIG1lc3NhZ2U6ICdZb3UgaGF2ZSBhbiBhcHBvaW50bWVudCB3aXRoIERyLiBTbWl0aCBpbiAxIGhvdXIuJyxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5BUFBPSU5UTUVOVF9SRU1JTkRFUixcbiAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0gsXG4gICAgICAgIGFjdGlvblVybDogJy9hcHBvaW50bWVudHMvYXBwb2ludG1lbnQtMScsXG4gICAgICAgIGRhdGE6IHsgYXBwb2ludG1lbnRJZDogJ2FwcG9pbnRtZW50LTEnLCBhcHBvaW50bWVudFRpbWUgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgbWVzc2FnZSBub3RpZmljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmNyZWF0ZU1lc3NhZ2VOb3RpZmljYXRpb24oXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ0RyLiBTbWl0aCcsXG4gICAgICAgICdjb252ZXJzYXRpb24tMSdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB0aXRsZTogJ05ldyBNZXNzYWdlJyxcbiAgICAgICAgbWVzc2FnZTogJ1lvdSBoYXZlIGEgbmV3IG1lc3NhZ2UgZnJvbSBEci4gU21pdGguJyxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5NRVNTQUdFX1JFQ0VJVkVELFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMLFxuICAgICAgICBhY3Rpb25Vcmw6ICcvbWVzc2FnZXMvY29udmVyc2F0aW9uLTEnLFxuICAgICAgICBkYXRhOiB7IHNlbmRlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgY29udmVyc2F0aW9uSWQ6ICdjb252ZXJzYXRpb24tMScgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgd29ya3NoZWV0IGFzc2lnbmVkIG5vdGlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlV29ya3NoZWV0QXNzaWduZWROb3RpZmljYXRpb24oXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAnd29ya3NoZWV0LTEnLFxuICAgICAgICAnQW54aWV0eSBNYW5hZ2VtZW50JyxcbiAgICAgICAgJ0RyLiBTbWl0aCdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB0aXRsZTogJ05ldyBXb3Jrc2hlZXQgQXNzaWduZWQnLFxuICAgICAgICBtZXNzYWdlOiAnRHIuIFNtaXRoIGhhcyBhc3NpZ25lZCB5b3UgYSBuZXcgd29ya3NoZWV0OiBcIkFueGlldHkgTWFuYWdlbWVudFwiLicsXG4gICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuV09SS1NIRUVUX0FTU0lHTkVELFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMLFxuICAgICAgICBhY3Rpb25Vcmw6ICcvd29ya3NoZWV0cy93b3Jrc2hlZXQtMScsXG4gICAgICAgIGRhdGE6IHsgd29ya3NoZWV0SWQ6ICd3b3Jrc2hlZXQtMScgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdGhlcmFwaXN0IGFwcGxpY2F0aW9uIGFwcHJvdmVkIG5vdGlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlVGhlcmFwaXN0QXBwbGljYXRpb25Ob3RpZmljYXRpb24oVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsICdhcHByb3ZlZCcpO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgdGl0bGU6ICdBcHBsaWNhdGlvbiBBcHByb3ZlZCcsXG4gICAgICAgIG1lc3NhZ2U6ICdDb25ncmF0dWxhdGlvbnMhIFlvdXIgdGhlcmFwaXN0IGFwcGxpY2F0aW9uIGhhcyBiZWVuIGFwcHJvdmVkLicsXG4gICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuVEhFUkFQSVNUX0FQUFJPVkVELFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgICAgYWN0aW9uVXJsOiAnL3RoZXJhcGlzdC9hcHBsaWNhdGlvbicsXG4gICAgICAgIGRhdGE6IHsgc3RhdHVzOiAnYXBwcm92ZWQnIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiByZWplY3RlZCBub3RpZmljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmNyZWF0ZVRoZXJhcGlzdEFwcGxpY2F0aW9uTm90aWZpY2F0aW9uKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCAncmVqZWN0ZWQnKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgIHRpdGxlOiAnQXBwbGljYXRpb24gVXBkYXRlJyxcbiAgICAgICAgbWVzc2FnZTogJ1lvdXIgdGhlcmFwaXN0IGFwcGxpY2F0aW9uIGhhcyBiZWVuIHJldmlld2VkLiBQbGVhc2UgY2hlY2sgeW91ciBhcHBsaWNhdGlvbiBzdGF0dXMuJyxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5USEVSQVBJU1RfUkVKRUNURUQsXG4gICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5ISUdILFxuICAgICAgICBhY3Rpb25Vcmw6ICcvdGhlcmFwaXN0L2FwcGxpY2F0aW9uJyxcbiAgICAgICAgZGF0YTogeyBzdGF0dXM6ICdyZWplY3RlZCcgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgY2xpZW50IHJlcXVlc3Qgbm90aWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2VydmljZS5jcmVhdGVDbGllbnRSZXF1ZXN0Tm90aWZpY2F0aW9uKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICdKb2huIERvZScsXG4gICAgICAgICdJIG5lZWQgaGVscCB3aXRoIGFueGlldHknLFxuICAgICAgICAnSElHSCdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICB0aXRsZTogJ05ldyBDbGllbnQgUmVxdWVzdCAoSGlnaCknLFxuICAgICAgICBtZXNzYWdlOiAnSm9obiBEb2UgaGFzIHNlbnQgeW91IGEgdGhlcmFweSByZXF1ZXN0LiBcIkkgbmVlZCBoZWxwIHdpdGggYW54aWV0eVwiJyxcbiAgICAgICAgdHlwZTogJ0NMSUVOVF9SRVFVRVNUX1JFQ0VJVkVEJyxcbiAgICAgICAgcHJpb3JpdHk6ICdISUdIJyxcbiAgICAgICAgYWN0aW9uVXJsOiAnL3RoZXJhcGlzdC9yZXF1ZXN0cycsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBjbGllbnRJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgY2xpZW50TmFtZTogJ0pvaG4gRG9lJyxcbiAgICAgICAgICByZXF1ZXN0VHlwZTogJ3RoZXJhcHlfcmVxdWVzdCcsXG4gICAgICAgICAgcHJpb3JpdHk6ICdISUdIJyxcbiAgICAgICAgICBoYXNNZXNzYWdlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSByZXF1ZXN0IGFjY2VwdGVkIG5vdGlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlUmVxdWVzdEFjY2VwdGVkTm90aWZpY2F0aW9uKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICdEci4gU21pdGgnLFxuICAgICAgICAnTG9va2luZyBmb3J3YXJkIHRvIHdvcmtpbmcgd2l0aCB5b3UnXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgdGl0bGU6ICdUaGVyYXBpc3QgUmVxdWVzdCBBY2NlcHRlZCEg8J+OiScsXG4gICAgICAgIG1lc3NhZ2U6ICdHcmVhdCBuZXdzISBEci4gU21pdGggaGFzIGFjY2VwdGVkIHlvdXIgdGhlcmFweSByZXF1ZXN0LiBcIkxvb2tpbmcgZm9yd2FyZCB0byB3b3JraW5nIHdpdGggeW91XCInLFxuICAgICAgICB0eXBlOiAnVEhFUkFQSVNUX1JFUVVFU1RfQUNDRVBURUQnLFxuICAgICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgICBhY3Rpb25Vcmw6IGAvY2xpZW50L3RoZXJhcGlzdHMvJHtURVNUX1VTRVJfSURTLlRIRVJBUElTVH1gLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAgIHRoZXJhcGlzdE5hbWU6ICdEci4gU21pdGgnLFxuICAgICAgICAgIHJlc3BvbnNlTWVzc2FnZTogJ0xvb2tpbmcgZm9yd2FyZCB0byB3b3JraW5nIHdpdGggeW91JyxcbiAgICAgICAgICBzY2hlZHVsaW5nSW5mbzogdW5kZWZpbmVkLFxuICAgICAgICAgIG5leHRTdGVwOiAnc2NoZWR1bGVfc2Vzc2lvbicsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5ldyByZWNvbW1lbmRhdGlvbnMgbm90aWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2VydmljZS5jcmVhdGVOZXdSZWNvbW1lbmRhdGlvbnNOb3RpZmljYXRpb24oXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAzLFxuICAgICAgICAnbmV3X3RoZXJhcGlzdHMnXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgdGl0bGU6ICdOZXcgVGhlcmFwaXN0IFJlY29tbWVuZGF0aW9ucyBBdmFpbGFibGUnLFxuICAgICAgICBtZXNzYWdlOiBcIldlJ3ZlIGZvdW5kIDMgbmV3IHRoZXJhcGlzdCBtYXRjaGVzIGZvciB5b3Ugd2l0aCBuZXdseSBhcHByb3ZlZCB0aGVyYXBpc3RzLiBDaGVjayB0aGVtIG91dCFcIixcbiAgICAgICAgdHlwZTogJ05FV19SRUNPTU1FTkRBVElPTlMnLFxuICAgICAgICBwcmlvcml0eTogJ05PUk1BTCcsXG4gICAgICAgIGFjdGlvblVybDogJy9jbGllbnQvdGhlcmFwaXN0cy9yZWNvbW1lbmRhdGlvbnMnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdGhlcmFwaXN0Q291bnQ6IDMsXG4gICAgICAgICAgdXBkYXRlUmVhc29uOiAnbmV3X3RoZXJhcGlzdHMnLFxuICAgICAgICAgIHJlY29tbWVuZGF0aW9uVHlwZTogJ3VwZGF0ZWRfbWF0Y2hlcycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NjaGVkdWxlZCBOb3RpZmljYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCBzY2hlZHVsZWQgbm90aWZpY2F0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBzY2hlZHVsZWROb3RpZmljYXRpb25zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdub3RpZmljYXRpb24tMScsXG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICB0aXRsZTogJ1NjaGVkdWxlZCBOb3RpZmljYXRpb24nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGlzIGEgc2NoZWR1bGVkIG5vdGlmaWNhdGlvbicsXG4gICAgICAgICAgc2NoZWR1bGVkRm9yOiBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gMTAwMCksXG4gICAgICAgICAgc2VudEF0OiBudWxsLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdub3RpZmljYXRpb24tMicsXG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICB0aXRsZTogJ0Fub3RoZXIgU2NoZWR1bGVkIE5vdGlmaWNhdGlvbicsXG4gICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaXMgYW5vdGhlciBzY2hlZHVsZWQgbm90aWZpY2F0aW9uJyxcbiAgICAgICAgICBzY2hlZHVsZWRGb3I6IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSAyMDAwKSxcbiAgICAgICAgICBzZW50QXQ6IG51bGwsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShzY2hlZHVsZWROb3RpZmljYXRpb25zKTtcbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnNlbmRTY2hlZHVsZWROb3RpZmljYXRpb25zKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBzZW50OiAyIH0pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgc2NoZWR1bGVkRm9yOiB7XG4gICAgICAgICAgICBsdGU6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW50QXQ6IG51bGwsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RlbGl2ZXJ5IEVycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgc2VydmljZS5zZXRXZWJTb2NrZXRTZXJ2ZXIobW9ja1dlYlNvY2tldFNlcnZlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkZWxpdmVyeSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEZWxpdmVyeSBmYWlsZWQnKTtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdkZWxpdmVyUmVhbFRpbWVOb3RpZmljYXRpb24nKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdlcnJvcicpO1xuXG4gICAgICBjb25zdCBub3RpZmljYXRpb24gPSB7XG4gICAgICAgIGlkOiAnbm90aWZpY2F0aW9uLTEnLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB1c2VyOiB7IGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCB9LFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZVsnZGVsaXZlck5vdGlmaWNhdGlvbiddKG5vdGlmaWNhdGlvbiBhcyBhbnksIHsgcmVhbFRpbWU6IHRydWUgfSk7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnRXJyb3IgZGVsaXZlcmluZyBub3RpZmljYXRpb24gbm90aWZpY2F0aW9uLTE6JyxcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBub3RpZmljYXRpb24gZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIHNlcnZpY2Uuc2V0V2ViU29ja2V0U2VydmVyKG1vY2tXZWJTb2NrZXRTZXJ2ZXIpO1xuICAgICAgXG4gICAgICBjb25zdCBub3RpZmljYXRpb25EYXRhID0ge1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB0aXRsZTogJ0ludGVncmF0aW9uIFRlc3QnLFxuICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhbiBpbnRlZ3JhdGlvbiB0ZXN0JyxcbiAgICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5NRVNTQUdFX1JFQ0VJVkVELFxuICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY3JlYXRlZE5vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgaWQ6ICdub3RpZmljYXRpb24tMScsXG4gICAgICAgIC4uLm5vdGlmaWNhdGlvbkRhdGEsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgaXNSZWFkOiBmYWxzZSxcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgICAgZW1haWw6ICdqb2huQGV4YW1wbGUuY29tJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShjcmVhdGVkTm90aWZpY2F0aW9uKTtcbiAgICAgIHByaXNtYVNlcnZpY2Uubm90aWZpY2F0aW9uLmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDEpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShub3RpZmljYXRpb25EYXRhKTtcblxuICAgICAgLy8gVmVyaWZ5IG5vdGlmaWNhdGlvbiB3YXMgY3JlYXRlZFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChjcmVhdGVkTm90aWZpY2F0aW9uKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm5vdGlmaWNhdGlvbi5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgLy8gVmVyaWZ5IFdlYlNvY2tldCBkZWxpdmVyeSB3YXMgYXR0ZW1wdGVkXG4gICAgICBleHBlY3QobW9ja1dlYlNvY2tldFNlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoYHVzZXI6JHtURVNUX1VTRVJfSURTLkNMSUVOVH1gKTtcbiAgICAgIGV4cGVjdChtb2NrV2ViU29ja2V0U2VydmVyLnRvKCkuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ25vdGlmaWNhdGlvbicsIGV4cGVjdC5hbnkoT2JqZWN0KSk7XG4gICAgICBleHBlY3QobW9ja1dlYlNvY2tldFNlcnZlci50bygpLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1bnJlYWRDb3VudCcsIHsgY291bnQ6IDEgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBldmVudC1kcml2ZW4gbm90aWZpY2F0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2NyZWF0ZScpLm1vY2tSZXNvbHZlZFZhbHVlKHt9IGFzIGFueSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHJlY29tbWVuZGF0aW9uQ291bnQ6IDMsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuaGFuZGxlUmVjb21tZW5kYXRpb25zR2VuZXJhdGVkKHBheWxvYWQpO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9SRUNPTU1FTkRBVElPTixcbiAgICAgICAgfSksXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICByZWFsVGltZTogdHJ1ZSxcbiAgICAgICAgICBwdXNoOiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGJhdGNoIGNvbW11bml0eSBub3RpZmljYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWVtYmVycyA9IFtcbiAgICAgICAgeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgIHsgdXNlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCB9LFxuICAgICAgICB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5BRE1JTiB9LFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgcHJpc21hU2VydmljZS5tZW1iZXJzaGlwLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1lbWJlcnMpO1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnY3JlYXRlJykubW9ja1Jlc29sdmVkVmFsdWUoe30gYXMgYW55KTtcblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0ge1xuICAgICAgICB0aXRsZTogJ0NvbW11bml0eSBVcGRhdGUnLFxuICAgICAgICBtZXNzYWdlOiAnTmV3IGNvbW11bml0eSBndWlkZWxpbmVzIGFyZSBhdmFpbGFibGUnLFxuICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9QT1NULFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zZW5kVG9Db21tdW5pdHkoJ2NvbW11bml0eS0xJywgbm90aWZpY2F0aW9uKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IC4uLm5vdGlmaWNhdGlvbiwgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCB9LFxuICAgICAgICB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IC4uLm5vdGlmaWNhdGlvbiwgdXNlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCB9LFxuICAgICAgICB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IC4uLm5vdGlmaWNhdGlvbiwgdXNlcklkOiBURVNUX1VTRVJfSURTLkFETUlOIH0sXG4gICAgICAgIHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=