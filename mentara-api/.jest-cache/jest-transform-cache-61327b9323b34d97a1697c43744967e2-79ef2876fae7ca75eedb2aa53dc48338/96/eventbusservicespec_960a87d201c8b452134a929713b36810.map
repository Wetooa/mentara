{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/events/event-bus.service.spec.ts","mappings":";;AAAA,6CAAsD;AACtD,yDAAsD;AACtD,2DAAsD;AACtD,gFAG6C;AAE7C,yBAAyB;AACzB,MAAM,eAAgB,SAAQ,wCAAiC;IAC7D,YACE,WAAmB,EACnB,IAAsB,EACtB,WAA0B,EAAE;QAE5B,KAAK,CAAC,WAAW,EAAE,eAAe,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;IACtD,CAAC;CACF;AAED,QAAQ,CAAC,iBAAiB,EAAE,GAAG,EAAE;IAC/B,IAAI,OAAwB,CAAC;IAC7B,IAAI,YAAwC,CAAC;IAE7C,UAAU,CAAC,KAAK,IAAI,EAAE;QACpB,MAAM,gBAAgB,GAAG;YACvB,SAAS,EAAE,IAAI,CAAC,EAAE,EAAE;YACpB,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE;YACb,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE;YACd,UAAU,EAAE,IAAI,CAAC,EAAE,EAAE;YACrB,aAAa,EAAE,IAAI,CAAC,EAAE,EAAE;YACxB,kBAAkB,EAAE,IAAI,CAAC,EAAE,EAAE;SAC9B,CAAC;QAEF,MAAM,MAAM,GAAkB,MAAM,cAAI,CAAC,mBAAmB,CAAC;YAC3D,SAAS,EAAE;gBACT,mCAAe;gBACf;oBACE,OAAO,EAAE,6BAAa;oBACtB,QAAQ,EAAE,gBAAgB;iBAC3B;aACF;SACF,CAAC,CAAC,OAAO,EAAE,CAAC;QAEb,OAAO,GAAG,MAAM,CAAC,GAAG,CAAkB,mCAAe,CAAC,CAAC;QACvD,YAAY,GAAG,MAAM,CAAC,GAAG,CAAC,6BAAa,CAAC,CAAC;QAEzC,0BAA0B;QAC1B,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC,kBAAkB,EAAE,CAAC;QAC5D,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC,kBAAkB,EAAE,CAAC;QAC5D,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,KAAK,CAAC,CAAC,kBAAkB,EAAE,CAAC;QAC1D,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,CAAC,CAAC,kBAAkB,EAAE,CAAC;IAC7D,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,MAAM,EAAE,GAAG,EAAE;QACpB,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,UAAU;YACV,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,aAAa,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YACvE,YAAY,CAAC,SAAS,CAAC,iBAAiB,CAAC,EAAS,CAAC,CAAC;YAEpD,MAAM;YACN,MAAM,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAE9B,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,oBAAoB,CACjD,iBAAiB,EACjB,SAAS,CACV,CAAC;YACF,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,oBAAoB,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;YACpE,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,oBAAoB,CACjD,iBAAiB,EACjB,SAAS,CACV,CAAC;YAEF,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,iCAAiC,EACjC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,OAAO,EAAE,SAAS,CAAC,OAAO;gBAC1B,WAAW,EAAE,SAAS,CAAC,WAAW;gBAClC,aAAa,EAAE,SAAS,CAAC,aAAa;gBACtC,aAAa,EAAE,SAAS,CAAC,QAAQ,CAAC,aAAa;aAChD,CAAC,CACH,CAAC;YACF,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,6CAA6C,CAC9C,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;YACzC,UAAU;YACV,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,aAAa,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YACvE,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC,CAAC;YACvC,YAAY,CAAC,SAAS,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YAEhD,eAAe;YACf,MAAM,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;YAErE,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,uCAAuC,EACvC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,OAAO,EAAE,SAAS,CAAC,OAAO;gBAC1B,KAAK,EAAE,aAAa;gBACpB,KAAK,EAAE,KAAK,CAAC,KAAK;aACnB,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,WAAW,EAAE,GAAG,EAAE;QACzB,EAAE,CAAC,iDAAiD,EAAE,GAAG,EAAE;YACzD,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAE1B,MAAM;YACN,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YAEtC,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC,oBAAoB,CAC1C,SAAS,EACT,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CACrB,CAAC;YACF,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,iCAAiC,EACjC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,WAAW,EAAE,OAAO,CAAC,IAAI;gBACzB,OAAO,EAAE,EAAE;aACZ,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,GAAG,EAAE;YAClD,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAC1B,MAAM,OAAO,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;YAEjC,MAAM;YACN,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;YAE/C,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC,oBAAoB,CAC1C,SAAS,EACT,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CACrB,CAAC;YACF,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,iCAAiC,EACjC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,WAAW,EAAE,OAAO,CAAC,IAAI;gBACzB,OAAO;aACR,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2CAA2C,EAAE,KAAK,IAAI,EAAE;YACzD,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACvD,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,aAAa,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YAEvE,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YAEtC,6DAA6D;YAC7D,MAAM,cAAc,GAAG,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAExD,MAAM;YAEN,MAAM,cAAc,CAAC,SAAS,CAAC,CAAC;YAEhC,SAAS;YACT,MAAM,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;YAChD,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,iCAAiC,EACjC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,OAAO,EAAE,SAAS,CAAC,OAAO;gBAC1B,WAAW,EAAE,OAAO,CAAC,IAAI;aAC1B,CAAC,CACH,CAAC;YACF,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,6CAA6C,EAC7C,MAAM,CAAC,gBAAgB,CAAC;gBACtB,OAAO,EAAE,SAAS,CAAC,OAAO;gBAC1B,WAAW,EAAE,OAAO,CAAC,IAAI;aAC1B,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;YACrD,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;YACnD,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,aAAa,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;YAEvE,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YAEtC,6DAA6D;YAC7D,MAAM,cAAc,GAAG,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAExD,eAAe;YACf,MAAM,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;YAE1E,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,uCAAuC,EACvC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,OAAO,EAAE,SAAS,CAAC,OAAO;gBAC1B,WAAW,EAAE,OAAO,CAAC,IAAI;gBACzB,KAAK,EAAE,gBAAgB;gBACvB,KAAK,EAAE,KAAK,CAAC,KAAK;aACnB,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,aAAa,EAAE,GAAG,EAAE;QAC3B,EAAE,CAAC,gCAAgC,EAAE,GAAG,EAAE;YACxC,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAE1B,MAAM;YACN,OAAO,CAAC,WAAW,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YAExC,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,oBAAoB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YAClE,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,qCAAqC,EACrC,MAAM,CAAC,gBAAgB,CAAC;gBACtB,WAAW,EAAE,OAAO,CAAC,IAAI;aAC1B,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;QACpC,EAAE,CAAC,sCAAsC,EAAE,GAAG,EAAE;YAC9C,UAAU;YACV,MAAM,aAAa,GAAG,MAAM,CAAC;YAC7B,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAC1B,MAAM,OAAO,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;YAEhC,8BAA8B;YAC9B,MAAM,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;YAEtD,MAAM;YACN,OAAO,CAAC,oBAAoB,CAAC,aAAa,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;YAE9D,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,CAAC,oBAAoB,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;QACxE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,8CAA8C,EAAE,GAAG,EAAE;YACtD,UAAU;YACV,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;YAC1B,MAAM,OAAO,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;YAEhC,8BAA8B;YAC9B,MAAM,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;YAEtD,MAAM;YACN,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;YAEzC,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,CAAC,oBAAoB,CAAC,GAAG,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;QACnE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;QAC7B,EAAE,CAAC,gCAAgC,EAAE,GAAG,EAAE;YACxC,UAAU;YACV,MAAM,UAAU,GAAG,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAClD,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,UAAiB,CAAC,CAAC;YAC3D,YAAY,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC,SAAS,EAAE,EAAE;gBAC1D,OAAO,SAAS,KAAK,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACxC,CAAC,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,KAAK,GAAG,OAAO,CAAC,aAAa,EAAE,CAAC;YAEtC,SAAS;YACT,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC;gBACpB,cAAc,EAAE,CAAC,EAAE,YAAY;gBAC/B,UAAU,EAAE,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC;aAC3C,CAAC,CAAC;YACH,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,gBAAgB,EAAE,CAAC;YACnD,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC9D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8CAA8C,EAAE,GAAG,EAAE;YACtD,UAAU;YACV,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;YAE5C,MAAM;YACN,MAAM,KAAK,GAAG,OAAO,CAAC,aAAa,EAAE,CAAC;YAEtC,SAAS;YACT,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC;gBACpB,cAAc,EAAE,CAAC;gBACjB,UAAU,EAAE,EAAE;aACf,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;QAC5B,EAAE,CAAC,yCAAyC,EAAE,GAAG,EAAE;YACjD,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,YAAY,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAE9C,MAAM;YACN,MAAM,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;YAE/C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1B,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;QACrE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6CAA6C,EAAE,GAAG,EAAE;YACrD,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAC9B,YAAY,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAE9C,MAAM;YACN,MAAM,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;YAE/C,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC3B,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;QACrE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,EAAE,CAAC,qDAAqD,EAAE,GAAG,EAAE;YAC7D,UAAU;YACV,MAAM,SAAS,GAAG,WAAW,CAAC;YAE9B,MAAM;YACN,OAAO,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;YAEtC,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;YACxE,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,6CAA6C,CAC9C,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0DAA0D,EAAE,GAAG,EAAE;YAClE,MAAM;YACN,OAAO,CAAC,kBAAkB,EAAE,CAAC;YAE7B,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,kBAAkB,CAAC,CAAC,oBAAoB,EAAE,CAAC;YAC/D,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,8BAA8B,CAC/B,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;YACjD,UAAU;YACV,MAAM,OAAO,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACvD,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,aAAa,EAAE;gBACnD,IAAI,EAAE,kBAAkB;aACzB,CAAC,CAAC;YAEH,YAAY,CAAC,SAAS,CAAC,iBAAiB,CAAC,EAAS,CAAC,CAAC;YAEpD,MAAM;YACN,OAAO,CAAC,SAAS,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC;YAC9C,MAAM,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAE9B,SAAS;YACT,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC,oBAAoB,CAC1C,iBAAiB,EACjB,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CACrB,CAAC;YACF,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YACxD,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,oBAAoB,CAClD,MAAM,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,EACzC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CACnB,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wCAAwC,EAAE,GAAG,EAAE;YAChD,UAAU;YACV,MAAM,QAAQ,GAAG;gBACf,MAAM,EAAE,UAAU;gBAClB,SAAS,EAAE,aAAa;gBACxB,aAAa,EAAE,UAAU;aAC1B,CAAC;YACF,MAAM,SAAS,GAAG,IAAI,eAAe,CACnC,aAAa,EACb,EAAE,IAAI,EAAE,eAAe,EAAE,EACzB,QAAQ,CACT,CAAC;YAEF,MAAM;YACN,MAAM,aAAa,GAAG,SAAS,CAAC,QAAQ,CAAC;YAEzC,SAAS;YACT,MAAM,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC9C,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACpD,MAAM,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,mDAAmD;QACxG,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/events/event-bus.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { EventEmitter2 } from '@nestjs/event-emitter';\nimport { EventBusService } from './event-bus.service';\nimport {\n  BaseDomainEvent,\n  EventMetadata,\n} from './interfaces/domain-event.interface';\n\n// Mock event for testing\nclass TestDomainEvent extends BaseDomainEvent<{ test: string }> {\n  constructor(\n    aggregateId: string,\n    data: { test: string },\n    metadata: EventMetadata = {},\n  ) {\n    super(aggregateId, 'TestAggregate', data, metadata);\n  }\n}\n\ndescribe('EventBusService', () => {\n  let service: EventBusService;\n  let eventEmitter: jest.Mocked<EventEmitter2>;\n\n  beforeEach(async () => {\n    const mockEventEmitter = {\n      emitAsync: jest.fn(),\n      on: jest.fn(),\n      off: jest.fn(),\n      eventNames: jest.fn(),\n      listenerCount: jest.fn(),\n      removeAllListeners: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        EventBusService,\n        {\n          provide: EventEmitter2,\n          useValue: mockEventEmitter,\n        },\n      ],\n    }).compile();\n\n    service = module.get<EventBusService>(EventBusService);\n    eventEmitter = module.get(EventEmitter2);\n\n    // Mock the logger methods\n    jest.spyOn(service['logger'], 'debug').mockImplementation();\n    jest.spyOn(service['logger'], 'error').mockImplementation();\n    jest.spyOn(service['logger'], 'log').mockImplementation();\n    jest.spyOn(service['logger'], 'warn').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('emit', () => {\n    it('should emit event successfully', async () => {\n      // Arrange\n      const testEvent = new TestDomainEvent('aggregate-1', { test: 'data' });\n      eventEmitter.emitAsync.mockResolvedValue([] as any);\n\n      // Act\n      await service.emit(testEvent);\n\n      // Assert\n      expect(eventEmitter.emitAsync).toHaveBeenCalledTimes(3);\n      expect(eventEmitter.emitAsync).toHaveBeenCalledWith(\n        'TestDomainEvent',\n        testEvent,\n      );\n      expect(eventEmitter.emitAsync).toHaveBeenCalledWith('*', testEvent);\n      expect(eventEmitter.emitAsync).toHaveBeenCalledWith(\n        'TestAggregate.*',\n        testEvent,\n      );\n\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Emitting event: TestDomainEvent',\n        expect.objectContaining({\n          eventId: testEvent.eventId,\n          aggregateId: testEvent.aggregateId,\n          aggregateType: testEvent.aggregateType,\n          correlationId: testEvent.metadata.correlationId,\n        }),\n      );\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Event emitted successfully: TestDomainEvent',\n      );\n    });\n\n    it('should handle emit errors', async () => {\n      // Arrange\n      const testEvent = new TestDomainEvent('aggregate-1', { test: 'data' });\n      const error = new Error('Emit failed');\n      eventEmitter.emitAsync.mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(service.emit(testEvent)).rejects.toThrow('Emit failed');\n\n      expect(service['logger'].error).toHaveBeenCalledWith(\n        'Failed to emit event: TestDomainEvent',\n        expect.objectContaining({\n          eventId: testEvent.eventId,\n          error: 'Emit failed',\n          stack: error.stack,\n        }),\n      );\n    });\n  });\n\n  describe('subscribe', () => {\n    it('should subscribe to events with default options', () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      const handler = jest.fn();\n\n      // Act\n      service.subscribe(eventType, handler);\n\n      // Assert\n      expect(eventEmitter.on).toHaveBeenCalledWith(\n        eventType,\n        expect.any(Function),\n      );\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Subscribing to event: TestEvent',\n        expect.objectContaining({\n          handlerName: handler.name,\n          options: {},\n        }),\n      );\n    });\n\n    it('should subscribe with async=false option', () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      const handler = jest.fn();\n      const options = { async: false };\n\n      // Act\n      service.subscribe(eventType, handler, options);\n\n      // Assert\n      expect(eventEmitter.on).toHaveBeenCalledWith(\n        eventType,\n        expect.any(Function),\n      );\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Subscribing to event: TestEvent',\n        expect.objectContaining({\n          handlerName: handler.name,\n          options,\n        }),\n      );\n    });\n\n    it('should handle successful event processing', async () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      const handler = jest.fn().mockResolvedValue(undefined);\n      const testEvent = new TestDomainEvent('aggregate-1', { test: 'data' });\n\n      service.subscribe(eventType, handler);\n\n      // Get the wrapped handler that was passed to eventEmitter.on\n      const wrappedHandler = eventEmitter.on.mock.calls[0][1];\n\n      // Act\n\n      await wrappedHandler(testEvent);\n\n      // Assert\n      expect(handler).toHaveBeenCalledWith(testEvent);\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Handling event: TestDomainEvent',\n        expect.objectContaining({\n          eventId: testEvent.eventId,\n          handlerName: handler.name,\n        }),\n      );\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Event handled successfully: TestDomainEvent',\n        expect.objectContaining({\n          eventId: testEvent.eventId,\n          handlerName: handler.name,\n        }),\n      );\n    });\n\n    it('should handle event processing errors', async () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      const error = new Error('Handler failed');\n      const handler = jest.fn().mockRejectedValue(error);\n      const testEvent = new TestDomainEvent('aggregate-1', { test: 'data' });\n\n      service.subscribe(eventType, handler);\n\n      // Get the wrapped handler that was passed to eventEmitter.on\n      const wrappedHandler = eventEmitter.on.mock.calls[0][1];\n\n      // Act & Assert\n      await expect(wrappedHandler(testEvent)).rejects.toThrow('Handler failed');\n\n      expect(service['logger'].error).toHaveBeenCalledWith(\n        'Event handler failed: TestDomainEvent',\n        expect.objectContaining({\n          eventId: testEvent.eventId,\n          handlerName: handler.name,\n          error: 'Handler failed',\n          stack: error.stack,\n        }),\n      );\n    });\n  });\n\n  describe('unsubscribe', () => {\n    it('should unsubscribe from events', () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      const handler = jest.fn();\n\n      // Act\n      service.unsubscribe(eventType, handler);\n\n      // Assert\n      expect(eventEmitter.off).toHaveBeenCalledWith(eventType, handler);\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Unsubscribing from event: TestEvent',\n        expect.objectContaining({\n          handlerName: handler.name,\n        }),\n      );\n    });\n  });\n\n  describe('subscribeToAggregate', () => {\n    it('should subscribe to aggregate events', () => {\n      // Arrange\n      const aggregateType = 'User';\n      const handler = jest.fn();\n      const options = { async: true };\n\n      // Spy on the subscribe method\n      const subscribeSpy = jest.spyOn(service, 'subscribe');\n\n      // Act\n      service.subscribeToAggregate(aggregateType, handler, options);\n\n      // Assert\n      expect(subscribeSpy).toHaveBeenCalledWith('User.*', handler, options);\n    });\n  });\n\n  describe('subscribeToAll', () => {\n    it('should subscribe to all events with wildcard', () => {\n      // Arrange\n      const handler = jest.fn();\n      const options = { async: true };\n\n      // Spy on the subscribe method\n      const subscribeSpy = jest.spyOn(service, 'subscribe');\n\n      // Act\n      service.subscribeToAll(handler, options);\n\n      // Assert\n      expect(subscribeSpy).toHaveBeenCalledWith('*', handler, options);\n    });\n  });\n\n  describe('getEventStats', () => {\n    it('should return event statistics', () => {\n      // Arrange\n      const eventNames = ['event1', 'event2', 'event3'];\n      eventEmitter.eventNames.mockReturnValue(eventNames as any);\n      eventEmitter.listenerCount.mockImplementation((eventName) => {\n        return eventName === 'event1' ? 2 : 1;\n      });\n\n      // Act\n      const stats = service.getEventStats();\n\n      // Assert\n      expect(stats).toEqual({\n        totalListeners: 4, // 2 + 1 + 1\n        eventTypes: ['event1', 'event2', 'event3'],\n      });\n      expect(eventEmitter.eventNames).toHaveBeenCalled();\n      expect(eventEmitter.listenerCount).toHaveBeenCalledTimes(3);\n    });\n\n    it('should return zero statistics when no events', () => {\n      // Arrange\n      eventEmitter.eventNames.mockReturnValue([]);\n\n      // Act\n      const stats = service.getEventStats();\n\n      // Assert\n      expect(stats).toEqual({\n        totalListeners: 0,\n        eventTypes: [],\n      });\n    });\n  });\n\n  describe('hasListeners', () => {\n    it('should return true when listeners exist', () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      eventEmitter.listenerCount.mockReturnValue(2);\n\n      // Act\n      const result = service.hasListeners(eventType);\n\n      // Assert\n      expect(result).toBe(true);\n      expect(eventEmitter.listenerCount).toHaveBeenCalledWith(eventType);\n    });\n\n    it('should return false when no listeners exist', () => {\n      // Arrange\n      const eventType = 'TestEvent';\n      eventEmitter.listenerCount.mockReturnValue(0);\n\n      // Act\n      const result = service.hasListeners(eventType);\n\n      // Assert\n      expect(result).toBe(false);\n      expect(eventEmitter.listenerCount).toHaveBeenCalledWith(eventType);\n    });\n  });\n\n  describe('removeAllListeners', () => {\n    it('should remove all listeners for specific event type', () => {\n      // Arrange\n      const eventType = 'TestEvent';\n\n      // Act\n      service.removeAllListeners(eventType);\n\n      // Assert\n      expect(eventEmitter.removeAllListeners).toHaveBeenCalledWith(eventType);\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Removing all listeners for event: TestEvent',\n      );\n    });\n\n    it('should remove all listeners when no event type specified', () => {\n      // Act\n      service.removeAllListeners();\n\n      // Assert\n      expect(eventEmitter.removeAllListeners).toHaveBeenCalledWith();\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        'Removing all event listeners',\n      );\n    });\n  });\n\n  describe('Integration Tests', () => {\n    it('should handle complete event flow', async () => {\n      // Arrange\n      const handler = jest.fn().mockResolvedValue(undefined);\n      const testEvent = new TestDomainEvent('aggregate-1', {\n        test: 'integration-test',\n      });\n\n      eventEmitter.emitAsync.mockResolvedValue([] as any);\n\n      // Act\n      service.subscribe('TestDomainEvent', handler);\n      await service.emit(testEvent);\n\n      // Assert\n      expect(eventEmitter.on).toHaveBeenCalledWith(\n        'TestDomainEvent',\n        expect.any(Function),\n      );\n      expect(eventEmitter.emitAsync).toHaveBeenCalledTimes(3);\n      expect(service['logger'].debug).toHaveBeenCalledWith(\n        expect.stringContaining('Emitting event'),\n        expect.any(Object),\n      );\n    });\n\n    it('should handle event metadata correctly', () => {\n      // Arrange\n      const metadata = {\n        userId: 'user-123',\n        sessionId: 'session-456',\n        correlationId: 'corr-789',\n      };\n      const testEvent = new TestDomainEvent(\n        'aggregate-1',\n        { test: 'metadata-test' },\n        metadata,\n      );\n\n      // Act\n      const eventMetadata = testEvent.metadata;\n\n      // Assert\n      expect(eventMetadata.userId).toBe('user-123');\n      expect(eventMetadata.sessionId).toBe('session-456');\n      expect(eventMetadata.correlationId).toBeDefined(); // Should have generated or preserved correlationId\n    });\n  });\n});\n"],"version":3}