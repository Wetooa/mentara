1d01c6b742bf82e4f8f5dd874bcb4f27
"use strict";
/**
 * Authentication Testing Helpers for Security Guards
 * Specialized utilities for testing the new CommunityAccessGuard and role-based access control
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CommunityAccessGuardTestUtils = exports.RoleBasedTestUtils = exports.SecurityGuardTestUtils = exports.MockBuilder = exports.TEST_COMMENT_IDS = exports.TEST_POST_IDS = exports.TEST_ROOM_IDS = exports.TEST_ROOM_GROUP_IDS = exports.TEST_COMMUNITY_IDS = void 0;
const core_1 = require("@nestjs/core");
const index_1 = require("./index");
const enhanced_test_helpers_1 = require("./enhanced-test-helpers");
Object.defineProperty(exports, "MockBuilder", { enumerable: true, get: function () { return enhanced_test_helpers_1.MockBuilder; } });
// Community and Room Test Data
exports.TEST_COMMUNITY_IDS = {
    ANXIETY_SUPPORT: 'community-anxiety-123',
    DEPRESSION_HELP: 'community-depression-456',
    GENERAL_WELLNESS: 'community-wellness-789',
    PRIVATE_THERAPY: 'community-private-101',
};
exports.TEST_ROOM_GROUP_IDS = {
    ANXIETY_GENERAL: 'room-group-anxiety-general-123',
    DEPRESSION_GENERAL: 'room-group-depression-general-456',
    WELLNESS_GENERAL: 'room-group-wellness-general-789',
    PRIVATE_SESSIONS: 'room-group-private-sessions-101',
};
exports.TEST_ROOM_IDS = {
    ANXIETY_CHAT: 'room-anxiety-chat-123',
    ANXIETY_RESOURCES: 'room-anxiety-resources-456',
    DEPRESSION_CHAT: 'room-depression-chat-789',
    DEPRESSION_MODS_ONLY: 'room-depression-mods-101',
    WELLNESS_GENERAL: 'room-wellness-general-112',
    PRIVATE_ROOM: 'room-private-113',
};
exports.TEST_POST_IDS = {
    ANXIETY_POST: 'post-anxiety-123',
    DEPRESSION_POST: 'post-depression-456',
    WELLNESS_POST: 'post-wellness-789',
    PRIVATE_POST: 'post-private-101',
};
exports.TEST_COMMENT_IDS = {
    ANXIETY_COMMENT: 'comment-anxiety-123',
    DEPRESSION_COMMENT: 'comment-depression-456',
    WELLNESS_COMMENT: 'comment-wellness-789',
    PRIVATE_COMMENT: 'comment-private-101',
};
/**
 * Security Guard Testing Utilities
 */
class SecurityGuardTestUtils {
    /**
     * Creates a mock ExecutionContext for guard testing
     */
    static createMockExecutionContext(request, handler = {}, controllerClass = {}) {
        return {
            switchToHttp: () => ({
                getRequest: () => request,
                getResponse: () => ({}),
                getNext: () => jest.fn(),
            }),
            getHandler: () => handler,
            getClass: () => controllerClass,
            getArgs: () => [request, {}, jest.fn()],
            getArgByIndex: (index) => [request, {}, jest.fn()][index],
            switchToRpc: () => ({
                getContext: () => ({}),
                getData: () => ({}),
            }),
            switchToWs: () => ({
                getClient: () => ({}),
                getData: () => ({}),
                getPattern: () => ({}),
            }),
            getType: () => 'http',
        };
    }
    /**
     * Creates a mock Reflector for metadata testing
     */
    static createMockReflector(metadata = {}) {
        const reflector = new core_1.Reflector();
        reflector.getAllAndOverride = jest.fn((key, targets) => {
            return metadata[key] || false;
        });
        return reflector;
    }
    /**
     * Creates a mock request with community/room context
     */
    static createMockRequestWithCommunityContext(userId, options = {}) {
        const { communityId, roomId, postId, commentId, path = '/test', method = 'GET', body = {}, params = {}, } = options;
        return {
            userId,
            user: { userId },
            method,
            path,
            body: {
                ...body,
                ...(communityId && { communityId }),
                ...(roomId && { roomId }),
                ...(postId && { postId }),
            },
            params: {
                ...params,
                ...(communityId && { communityId }),
                ...(roomId && { roomId }),
                ...(postId && { id: postId }),
                ...(commentId && { id: commentId }),
            },
        };
    }
    /**
     * Creates comprehensive mock data for community hierarchy
     */
    static createMockCommunityData() {
        return {
            // Community with members
            community: {
                id: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                name: 'Anxiety Support',
                description: 'Community for anxiety support',
                slug: 'anxiety-support',
                isPrivate: false,
                roomGroups: [
                    {
                        id: exports.TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,
                        name: 'General',
                        order: 1,
                        communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                        rooms: [
                            {
                                id: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                                name: 'General Chat',
                                order: 1,
                                postingRole: 'member',
                                roomGroupId: exports.TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,
                            },
                            {
                                id: exports.TEST_ROOM_IDS.ANXIETY_RESOURCES,
                                name: 'Resources',
                                order: 2,
                                postingRole: 'moderator',
                                roomGroupId: exports.TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,
                            },
                        ],
                    },
                ],
                memberships: [
                    {
                        id: 'membership-1',
                        userId: index_1.TEST_USER_IDS.CLIENT,
                        communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                        role: 'member',
                        joinedAt: new Date(),
                    },
                    {
                        id: 'membership-2',
                        userId: index_1.TEST_USER_IDS.THERAPIST,
                        communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                        role: 'moderator',
                        joinedAt: new Date(),
                    },
                    {
                        id: 'membership-3',
                        userId: index_1.TEST_USER_IDS.ADMIN,
                        communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                        role: 'admin',
                        joinedAt: new Date(),
                    },
                ],
            },
            // Room data
            room: {
                id: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                name: 'General Chat',
                postingRole: 'member',
                roomGroup: {
                    id: exports.TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,
                    community: {
                        id: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                        memberships: [
                            {
                                userId: index_1.TEST_USER_IDS.CLIENT,
                                role: 'member',
                            },
                        ],
                    },
                },
            },
            // Post data
            post: {
                id: exports.TEST_POST_IDS.ANXIETY_POST,
                title: 'Test Post',
                content: 'Test content',
                roomId: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                room: {
                    id: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                    postingRole: 'member',
                    roomGroup: {
                        community: {
                            id: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                            memberships: [
                                {
                                    userId: index_1.TEST_USER_IDS.CLIENT,
                                    role: 'member',
                                },
                            ],
                        },
                    },
                },
            },
            // Comment data
            comment: {
                id: exports.TEST_COMMENT_IDS.ANXIETY_COMMENT,
                content: 'Test comment',
                post: {
                    roomId: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                },
            },
            // Memberships
            membership: {
                id: 'membership-client',
                userId: index_1.TEST_USER_IDS.CLIENT,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                role: 'member',
            },
            membershipModerator: {
                id: 'membership-moderator',
                userId: index_1.TEST_USER_IDS.THERAPIST,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                role: 'moderator',
            },
            membershipAdmin: {
                id: 'membership-admin',
                userId: index_1.TEST_USER_IDS.ADMIN,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                role: 'admin',
            },
        };
    }
    /**
     * Creates a mock Prisma service with community access control data
     */
    static createMockPrismaWithCommunityData() {
        const prismaService = (0, index_1.createMockPrismaService)();
        // Add missing room model to the mock
        prismaService.room = {
            findUnique: jest.fn(),
            findMany: jest.fn(),
            create: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
        };
        const mockData = this.createMockCommunityData();
        // Setup community findUnique mock
        prismaService.community.findUnique.mockImplementation(({ where }) => {
            if (where.id === exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {
                return Promise.resolve(mockData.community);
            }
            return Promise.resolve(null);
        });
        // Setup room findUnique mock
        prismaService.room.findUnique.mockImplementation(({ where, include }) => {
            if (where.id === exports.TEST_ROOM_IDS.ANXIETY_CHAT) {
                return Promise.resolve(mockData.room);
            }
            return Promise.resolve(null);
        });
        // Setup post findUnique mock
        prismaService.post.findUnique.mockImplementation(({ where, include }) => {
            if (where.id === exports.TEST_POST_IDS.ANXIETY_POST) {
                return Promise.resolve(mockData.post);
            }
            return Promise.resolve(null);
        });
        // Setup comment findUnique mock
        prismaService.comment.findUnique.mockImplementation(({ where, include }) => {
            if (where.id === exports.TEST_COMMENT_IDS.ANXIETY_COMMENT) {
                return Promise.resolve(mockData.comment);
            }
            return Promise.resolve(null);
        });
        // Setup membership findFirst mock
        prismaService.membership.findFirst.mockImplementation(({ where }) => {
            if (where.userId === index_1.TEST_USER_IDS.CLIENT && where.communityId === exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {
                return Promise.resolve(mockData.membership);
            }
            if (where.userId === index_1.TEST_USER_IDS.THERAPIST && where.communityId === exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {
                return Promise.resolve(mockData.membershipModerator);
            }
            if (where.userId === index_1.TEST_USER_IDS.ADMIN && where.communityId === exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {
                return Promise.resolve(mockData.membershipAdmin);
            }
            return Promise.resolve(null);
        });
        return prismaService;
    }
    /**
     * Creates test scenarios for various access control situations
     */
    static createAccessControlTestScenarios() {
        return {
            // Valid access scenarios
            clientMemberAccess: {
                userId: index_1.TEST_USER_IDS.CLIENT,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                expectedRole: 'member',
                shouldHaveAccess: true,
                canPost: true, // Member can post in member room
            },
            therapistModeratorAccess: {
                userId: index_1.TEST_USER_IDS.THERAPIST,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: exports.TEST_ROOM_IDS.ANXIETY_RESOURCES,
                expectedRole: 'moderator',
                shouldHaveAccess: true,
                canPost: true, // Moderator can post in moderator room
            },
            adminFullAccess: {
                userId: index_1.TEST_USER_IDS.ADMIN,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: exports.TEST_ROOM_IDS.ANXIETY_RESOURCES,
                expectedRole: 'admin',
                shouldHaveAccess: true,
                canPost: true, // Admin can post anywhere
            },
            // Invalid access scenarios
            nonMemberAccess: {
                userId: 'non-member-user-123',
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: exports.TEST_ROOM_IDS.ANXIETY_CHAT,
                expectedRole: null,
                shouldHaveAccess: false,
                canPost: false,
            },
            memberInModeratorRoom: {
                userId: index_1.TEST_USER_IDS.CLIENT,
                communityId: exports.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: exports.TEST_ROOM_IDS.ANXIETY_RESOURCES,
                expectedRole: 'member',
                shouldHaveAccess: true, // Can access to read
                canPost: false, // But cannot post in moderator room
            },
        };
    }
    /**
     * Creates a mock request for testing specific guard scenarios
     */
    static createGuardTestRequest(scenario, options = {}) {
        const { method = 'GET', path = '/test', postId, commentId } = options;
        return this.createMockRequestWithCommunityContext(scenario.userId, {
            communityId: scenario.communityId,
            roomId: scenario.roomId,
            postId,
            commentId,
            method,
            path,
        });
    }
}
exports.SecurityGuardTestUtils = SecurityGuardTestUtils;
/**
 * Role-based Testing Utilities
 */
class RoleBasedTestUtils {
    /**
     * Tests a function with different user roles
     */
    static async testWithRoles(testFunction, expectedResults) {
        const roles = [
            { userId: index_1.TEST_USER_IDS.CLIENT, role: 'client' },
            { userId: index_1.TEST_USER_IDS.THERAPIST, role: 'therapist' },
            { userId: index_1.TEST_USER_IDS.ADMIN, role: 'admin' },
            { userId: index_1.TEST_USER_IDS.MODERATOR, role: 'moderator' },
        ];
        for (const { userId, role } of roles) {
            const result = await testFunction(userId, role);
            const expected = expectedResults[role];
            if (expected !== undefined) {
                expect(result).toEqual(expected);
            }
        }
    }
    /**
     * Tests authorization with different permission levels
     */
    static async testAuthorizationLevels(testFunction, minimumRole) {
        const roleHierarchy = {
            member: 0,
            moderator: 1,
            admin: 2,
        };
        const tests = [
            { userId: index_1.TEST_USER_IDS.CLIENT, role: 'member', level: 0 },
            { userId: index_1.TEST_USER_IDS.THERAPIST, role: 'moderator', level: 1 },
            { userId: index_1.TEST_USER_IDS.ADMIN, role: 'admin', level: 2 },
        ];
        const minimumLevel = roleHierarchy[minimumRole];
        for (const { userId, role, level } of tests) {
            const result = await testFunction(userId, role);
            const shouldHaveAccess = level >= minimumLevel;
            expect(result).toBe(shouldHaveAccess);
        }
    }
    /**
     * Creates mock authentication contexts for different roles
     */
    static createRoleAuthContexts() {
        return {
            client: enhanced_test_helpers_1.MockBuilder.createAuthContext('client', index_1.TEST_USER_IDS.CLIENT),
            therapist: enhanced_test_helpers_1.MockBuilder.createAuthContext('therapist', index_1.TEST_USER_IDS.THERAPIST),
            admin: enhanced_test_helpers_1.MockBuilder.createAuthContext('admin', index_1.TEST_USER_IDS.ADMIN),
            moderator: enhanced_test_helpers_1.MockBuilder.createAuthContext('moderator', index_1.TEST_USER_IDS.MODERATOR),
        };
    }
}
exports.RoleBasedTestUtils = RoleBasedTestUtils;
/**
 * Community Access Guard Test Utilities
 */
class CommunityAccessGuardTestUtils {
    /**
     * Creates a comprehensive test suite for the CommunityAccessGuard
     */
    static createGuardTestSuite() {
        return {
            // Test community membership validation
            testCommunityMembership: async (guard, scenario) => {
                const request = SecurityGuardTestUtils.createGuardTestRequest(scenario);
                const context = SecurityGuardTestUtils.createMockExecutionContext(request);
                const reflector = SecurityGuardTestUtils.createMockReflector({
                    require_community_membership: true,
                });
                guard.reflector = reflector;
                guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();
                if (scenario.shouldHaveAccess) {
                    await expect(guard.canActivate(context)).resolves.toBe(true);
                }
                else {
                    await expect(guard.canActivate(context)).rejects.toThrow();
                }
            },
            // Test room access validation
            testRoomAccess: async (guard, scenario) => {
                const request = SecurityGuardTestUtils.createGuardTestRequest(scenario);
                const context = SecurityGuardTestUtils.createMockExecutionContext(request);
                const reflector = SecurityGuardTestUtils.createMockReflector({
                    require_room_access: true,
                });
                guard.reflector = reflector;
                guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();
                if (scenario.shouldHaveAccess) {
                    await expect(guard.canActivate(context)).resolves.toBe(true);
                }
                else {
                    await expect(guard.canActivate(context)).rejects.toThrow();
                }
            },
            // Test posting permission validation
            testPostingPermission: async (guard, scenario) => {
                const request = SecurityGuardTestUtils.createGuardTestRequest(scenario, {
                    method: 'POST',
                    path: '/posts',
                });
                const context = SecurityGuardTestUtils.createMockExecutionContext(request);
                const reflector = SecurityGuardTestUtils.createMockReflector({
                    require_posting_role: true,
                });
                guard.reflector = reflector;
                guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();
                if (scenario.canPost) {
                    await expect(guard.canActivate(context)).resolves.toBe(true);
                }
                else {
                    await expect(guard.canActivate(context)).rejects.toThrow();
                }
            },
            // Test moderator permission validation
            testModeratorPermission: async (guard, scenario) => {
                const request = SecurityGuardTestUtils.createGuardTestRequest(scenario);
                const context = SecurityGuardTestUtils.createMockExecutionContext(request);
                const reflector = SecurityGuardTestUtils.createMockReflector({
                    require_community_moderator: true,
                });
                guard.reflector = reflector;
                guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();
                const isModerator = scenario.expectedRole === 'moderator' || scenario.expectedRole === 'admin';
                if (isModerator) {
                    await expect(guard.canActivate(context)).resolves.toBe(true);
                }
                else {
                    await expect(guard.canActivate(context)).rejects.toThrow();
                }
            },
        };
    }
}
exports.CommunityAccessGuardTestUtils = CommunityAccessGuardTestUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvYXV0aC10ZXN0aW5nLWhlbHBlcnMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBR0gsdUNBQXlDO0FBQ3pDLG1DQUFpRTtBQUNqRSxtRUFBc0Q7QUE4akJwRCw0RkE5akJPLG1DQUFXLE9BOGpCUDtBQTVqQmIsK0JBQStCO0FBQ2xCLFFBQUEsa0JBQWtCLEdBQUc7SUFDaEMsZUFBZSxFQUFFLHVCQUF1QjtJQUN4QyxlQUFlLEVBQUUsMEJBQTBCO0lBQzNDLGdCQUFnQixFQUFFLHdCQUF3QjtJQUMxQyxlQUFlLEVBQUUsdUJBQXVCO0NBQ3pDLENBQUM7QUFFVyxRQUFBLG1CQUFtQixHQUFHO0lBQ2pDLGVBQWUsRUFBRSxnQ0FBZ0M7SUFDakQsa0JBQWtCLEVBQUUsbUNBQW1DO0lBQ3ZELGdCQUFnQixFQUFFLGlDQUFpQztJQUNuRCxnQkFBZ0IsRUFBRSxpQ0FBaUM7Q0FDcEQsQ0FBQztBQUVXLFFBQUEsYUFBYSxHQUFHO0lBQzNCLFlBQVksRUFBRSx1QkFBdUI7SUFDckMsaUJBQWlCLEVBQUUsNEJBQTRCO0lBQy9DLGVBQWUsRUFBRSwwQkFBMEI7SUFDM0Msb0JBQW9CLEVBQUUsMEJBQTBCO0lBQ2hELGdCQUFnQixFQUFFLDJCQUEyQjtJQUM3QyxZQUFZLEVBQUUsa0JBQWtCO0NBQ2pDLENBQUM7QUFFVyxRQUFBLGFBQWEsR0FBRztJQUMzQixZQUFZLEVBQUUsa0JBQWtCO0lBQ2hDLGVBQWUsRUFBRSxxQkFBcUI7SUFDdEMsYUFBYSxFQUFFLG1CQUFtQjtJQUNsQyxZQUFZLEVBQUUsa0JBQWtCO0NBQ2pDLENBQUM7QUFFVyxRQUFBLGdCQUFnQixHQUFHO0lBQzlCLGVBQWUsRUFBRSxxQkFBcUI7SUFDdEMsa0JBQWtCLEVBQUUsd0JBQXdCO0lBQzVDLGdCQUFnQixFQUFFLHNCQUFzQjtJQUN4QyxlQUFlLEVBQUUscUJBQXFCO0NBQ3ZDLENBQUM7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QUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDN0QsQ0FBQztZQUNILENBQUM7WUFFRCx1Q0FBdUM7WUFDdkMsdUJBQXVCLEVBQUUsS0FBSyxFQUFFLEtBQVUsRUFBRSxRQUFhLEVBQUUsRUFBRTtnQkFDM0QsTUFBTSxPQUFPLEdBQUcsc0JBQXNCLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3hFLE1BQU0sT0FBTyxHQUFHLHNCQUFzQixDQUFDLDBCQUEwQixDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMzRSxNQUFNLFNBQVMsR0FBRyxzQkFBc0IsQ0FBQyxtQkFBbUIsQ0FBQztvQkFDM0QsMkJBQTJCLEVBQUUsSUFBSTtpQkFDbEMsQ0FBQyxDQUFDO2dCQUVILEtBQUssQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO2dCQUM1QixLQUFLLENBQUMsTUFBTSxHQUFHLHNCQUFzQixDQUFDLGlDQUFpQyxFQUFFLENBQUM7Z0JBRTFFLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxZQUFZLEtBQUssV0FBVyxJQUFJLFFBQVEsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDO2dCQUUvRixJQUFJLFdBQVcsRUFBRSxDQUFDO29CQUNoQixNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDL0QsQ0FBQztxQkFBTSxDQUFDO29CQUNOLE1BQU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQzdELENBQUM7WUFDSCxDQUFDO1NBQ0YsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQU9DLHNFQUE2QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEF1dGhlbnRpY2F0aW9uIFRlc3RpbmcgSGVscGVycyBmb3IgU2VjdXJpdHkgR3VhcmRzXG4gKiBTcGVjaWFsaXplZCB1dGlsaXRpZXMgZm9yIHRlc3RpbmcgdGhlIG5ldyBDb21tdW5pdHlBY2Nlc3NHdWFyZCBhbmQgcm9sZS1iYXNlZCBhY2Nlc3MgY29udHJvbFxuICovXG5cbmltcG9ydCB7IEV4ZWN1dGlvbkNvbnRleHQgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBSZWZsZWN0b3IgfSBmcm9tICdAbmVzdGpzL2NvcmUnO1xuaW1wb3J0IHsgY3JlYXRlTW9ja1ByaXNtYVNlcnZpY2UsIFRFU1RfVVNFUl9JRFMgfSBmcm9tICcuL2luZGV4JztcbmltcG9ydCB7IE1vY2tCdWlsZGVyIH0gZnJvbSAnLi9lbmhhbmNlZC10ZXN0LWhlbHBlcnMnO1xuXG4vLyBDb21tdW5pdHkgYW5kIFJvb20gVGVzdCBEYXRhXG5leHBvcnQgY29uc3QgVEVTVF9DT01NVU5JVFlfSURTID0ge1xuICBBTlhJRVRZX1NVUFBPUlQ6ICdjb21tdW5pdHktYW54aWV0eS0xMjMnLFxuICBERVBSRVNTSU9OX0hFTFA6ICdjb21tdW5pdHktZGVwcmVzc2lvbi00NTYnLFxuICBHRU5FUkFMX1dFTExORVNTOiAnY29tbXVuaXR5LXdlbGxuZXNzLTc4OScsXG4gIFBSSVZBVEVfVEhFUkFQWTogJ2NvbW11bml0eS1wcml2YXRlLTEwMScsXG59O1xuXG5leHBvcnQgY29uc3QgVEVTVF9ST09NX0dST1VQX0lEUyA9IHtcbiAgQU5YSUVUWV9HRU5FUkFMOiAncm9vbS1ncm91cC1hbnhpZXR5LWdlbmVyYWwtMTIzJyxcbiAgREVQUkVTU0lPTl9HRU5FUkFMOiAncm9vbS1ncm91cC1kZXByZXNzaW9uLWdlbmVyYWwtNDU2JyxcbiAgV0VMTE5FU1NfR0VORVJBTDogJ3Jvb20tZ3JvdXAtd2VsbG5lc3MtZ2VuZXJhbC03ODknLFxuICBQUklWQVRFX1NFU1NJT05TOiAncm9vbS1ncm91cC1wcml2YXRlLXNlc3Npb25zLTEwMScsXG59O1xuXG5leHBvcnQgY29uc3QgVEVTVF9ST09NX0lEUyA9IHtcbiAgQU5YSUVUWV9DSEFUOiAncm9vbS1hbnhpZXR5LWNoYXQtMTIzJyxcbiAgQU5YSUVUWV9SRVNPVVJDRVM6ICdyb29tLWFueGlldHktcmVzb3VyY2VzLTQ1NicsXG4gIERFUFJFU1NJT05fQ0hBVDogJ3Jvb20tZGVwcmVzc2lvbi1jaGF0LTc4OScsXG4gIERFUFJFU1NJT05fTU9EU19PTkxZOiAncm9vbS1kZXByZXNzaW9uLW1vZHMtMTAxJyxcbiAgV0VMTE5FU1NfR0VORVJBTDogJ3Jvb20td2VsbG5lc3MtZ2VuZXJhbC0xMTInLFxuICBQUklWQVRFX1JPT006ICdyb29tLXByaXZhdGUtMTEzJyxcbn07XG5cbmV4cG9ydCBjb25zdCBURVNUX1BPU1RfSURTID0ge1xuICBBTlhJRVRZX1BPU1Q6ICdwb3N0LWFueGlldHktMTIzJyxcbiAgREVQUkVTU0lPTl9QT1NUOiAncG9zdC1kZXByZXNzaW9uLTQ1NicsXG4gIFdFTExORVNTX1BPU1Q6ICdwb3N0LXdlbGxuZXNzLTc4OScsXG4gIFBSSVZBVEVfUE9TVDogJ3Bvc3QtcHJpdmF0ZS0xMDEnLFxufTtcblxuZXhwb3J0IGNvbnN0IFRFU1RfQ09NTUVOVF9JRFMgPSB7XG4gIEFOWElFVFlfQ09NTUVOVDogJ2NvbW1lbnQtYW54aWV0eS0xMjMnLFxuICBERVBSRVNTSU9OX0NPTU1FTlQ6ICdjb21tZW50LWRlcHJlc3Npb24tNDU2JyxcbiAgV0VMTE5FU1NfQ09NTUVOVDogJ2NvbW1lbnQtd2VsbG5lc3MtNzg5JyxcbiAgUFJJVkFURV9DT01NRU5UOiAnY29tbWVudC1wcml2YXRlLTEwMScsXG59O1xuXG4vKipcbiAqIFNlY3VyaXR5IEd1YXJkIFRlc3RpbmcgVXRpbGl0aWVzXG4gKi9cbmNsYXNzIFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMge1xuICAvKipcbiAgICogQ3JlYXRlcyBhIG1vY2sgRXhlY3V0aW9uQ29udGV4dCBmb3IgZ3VhcmQgdGVzdGluZ1xuICAgKi9cbiAgc3RhdGljIGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KFxuICAgIHJlcXVlc3Q6IGFueSxcbiAgICBoYW5kbGVyOiBhbnkgPSB7fSxcbiAgICBjb250cm9sbGVyQ2xhc3M6IGFueSA9IHt9LFxuICApOiBFeGVjdXRpb25Db250ZXh0IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3dpdGNoVG9IdHRwOiAoKSA9PiAoe1xuICAgICAgICBnZXRSZXF1ZXN0OiAoKSA9PiByZXF1ZXN0LFxuICAgICAgICBnZXRSZXNwb25zZTogKCkgPT4gKHt9IGFzIGFueSksXG4gICAgICAgIGdldE5leHQ6ICgpID0+IGplc3QuZm4oKSBhcyBhbnksXG4gICAgICB9KSxcbiAgICAgIGdldEhhbmRsZXI6ICgpID0+IGhhbmRsZXIsXG4gICAgICBnZXRDbGFzczogKCkgPT4gY29udHJvbGxlckNsYXNzLFxuICAgICAgZ2V0QXJnczogKCkgPT4gW3JlcXVlc3QsIHt9LCBqZXN0LmZuKCldIGFzIGFueSxcbiAgICAgIGdldEFyZ0J5SW5kZXg6IChpbmRleDogbnVtYmVyKSA9PiBbcmVxdWVzdCwge30sIGplc3QuZm4oKV1baW5kZXhdIGFzIGFueSxcbiAgICAgIHN3aXRjaFRvUnBjOiAoKSA9PiAoe1xuICAgICAgICBnZXRDb250ZXh0OiAoKSA9PiAoe30gYXMgYW55KSxcbiAgICAgICAgZ2V0RGF0YTogKCkgPT4gKHt9IGFzIGFueSksXG4gICAgICB9KSxcbiAgICAgIHN3aXRjaFRvV3M6ICgpID0+ICh7XG4gICAgICAgIGdldENsaWVudDogKCkgPT4gKHt9IGFzIGFueSksXG4gICAgICAgIGdldERhdGE6ICgpID0+ICh7fSBhcyBhbnkpLFxuICAgICAgICBnZXRQYXR0ZXJuOiAoKSA9PiAoe30gYXMgYW55KSxcbiAgICAgIH0pLFxuICAgICAgZ2V0VHlwZTogKCkgPT4gJ2h0dHAnIGFzIGFueSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBtb2NrIFJlZmxlY3RvciBmb3IgbWV0YWRhdGEgdGVzdGluZ1xuICAgKi9cbiAgc3RhdGljIGNyZWF0ZU1vY2tSZWZsZWN0b3IobWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSk6IFJlZmxlY3RvciB7XG4gICAgY29uc3QgcmVmbGVjdG9yID0gbmV3IFJlZmxlY3RvcigpO1xuICAgIHJlZmxlY3Rvci5nZXRBbGxBbmRPdmVycmlkZSA9IGplc3QuZm4oKGtleSwgdGFyZ2V0cykgPT4ge1xuICAgICAgcmV0dXJuIG1ldGFkYXRhW2tleSBhcyBzdHJpbmddIHx8IGZhbHNlO1xuICAgIH0pO1xuICAgIHJldHVybiByZWZsZWN0b3I7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG1vY2sgcmVxdWVzdCB3aXRoIGNvbW11bml0eS9yb29tIGNvbnRleHRcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVNb2NrUmVxdWVzdFdpdGhDb21tdW5pdHlDb250ZXh0KFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGNvbW11bml0eUlkPzogc3RyaW5nO1xuICAgICAgcm9vbUlkPzogc3RyaW5nO1xuICAgICAgcG9zdElkPzogc3RyaW5nO1xuICAgICAgY29tbWVudElkPzogc3RyaW5nO1xuICAgICAgcGF0aD86IHN0cmluZztcbiAgICAgIG1ldGhvZD86IHN0cmluZztcbiAgICAgIGJvZHk/OiBhbnk7XG4gICAgICBwYXJhbXM/OiBhbnk7XG4gICAgfSA9IHt9LFxuICApIHtcbiAgICBjb25zdCB7XG4gICAgICBjb21tdW5pdHlJZCxcbiAgICAgIHJvb21JZCxcbiAgICAgIHBvc3RJZCxcbiAgICAgIGNvbW1lbnRJZCxcbiAgICAgIHBhdGggPSAnL3Rlc3QnLFxuICAgICAgbWV0aG9kID0gJ0dFVCcsXG4gICAgICBib2R5ID0ge30sXG4gICAgICBwYXJhbXMgPSB7fSxcbiAgICB9ID0gb3B0aW9ucztcblxuICAgIHJldHVybiB7XG4gICAgICB1c2VySWQsXG4gICAgICB1c2VyOiB7IHVzZXJJZCB9LFxuICAgICAgbWV0aG9kLFxuICAgICAgcGF0aCxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgLi4uYm9keSxcbiAgICAgICAgLi4uKGNvbW11bml0eUlkICYmIHsgY29tbXVuaXR5SWQgfSksXG4gICAgICAgIC4uLihyb29tSWQgJiYgeyByb29tSWQgfSksXG4gICAgICAgIC4uLihwb3N0SWQgJiYgeyBwb3N0SWQgfSksXG4gICAgICB9LFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgLi4uKGNvbW11bml0eUlkICYmIHsgY29tbXVuaXR5SWQgfSksXG4gICAgICAgIC4uLihyb29tSWQgJiYgeyByb29tSWQgfSksXG4gICAgICAgIC4uLihwb3N0SWQgJiYgeyBpZDogcG9zdElkIH0pLFxuICAgICAgICAuLi4oY29tbWVudElkICYmIHsgaWQ6IGNvbW1lbnRJZCB9KSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGNvbXByZWhlbnNpdmUgbW9jayBkYXRhIGZvciBjb21tdW5pdHkgaGllcmFyY2h5XG4gICAqL1xuICBzdGF0aWMgY3JlYXRlTW9ja0NvbW11bml0eURhdGEoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIENvbW11bml0eSB3aXRoIG1lbWJlcnNcbiAgICAgIGNvbW11bml0eToge1xuICAgICAgICBpZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgbmFtZTogJ0FueGlldHkgU3VwcG9ydCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ29tbXVuaXR5IGZvciBhbnhpZXR5IHN1cHBvcnQnLFxuICAgICAgICBzbHVnOiAnYW54aWV0eS1zdXBwb3J0JyxcbiAgICAgICAgaXNQcml2YXRlOiBmYWxzZSxcbiAgICAgICAgcm9vbUdyb3VwczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiBURVNUX1JPT01fR1JPVVBfSURTLkFOWElFVFlfR0VORVJBTCxcbiAgICAgICAgICAgIG5hbWU6ICdHZW5lcmFsJyxcbiAgICAgICAgICAgIG9yZGVyOiAxLFxuICAgICAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgICAgICByb29tczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQ6IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9DSEFULFxuICAgICAgICAgICAgICAgIG5hbWU6ICdHZW5lcmFsIENoYXQnLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAxLFxuICAgICAgICAgICAgICAgIHBvc3RpbmdSb2xlOiAnbWVtYmVyJyxcbiAgICAgICAgICAgICAgICByb29tR3JvdXBJZDogVEVTVF9ST09NX0dST1VQX0lEUy5BTlhJRVRZX0dFTkVSQUwsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX1JFU09VUkNFUyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnUmVzb3VyY2VzJyxcbiAgICAgICAgICAgICAgICBvcmRlcjogMixcbiAgICAgICAgICAgICAgICBwb3N0aW5nUm9sZTogJ21vZGVyYXRvcicsXG4gICAgICAgICAgICAgICAgcm9vbUdyb3VwSWQ6IFRFU1RfUk9PTV9HUk9VUF9JRFMuQU5YSUVUWV9HRU5FUkFMLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBtZW1iZXJzaGlwczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnbWVtYmVyc2hpcC0xJyxcbiAgICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgICAgIHJvbGU6ICdtZW1iZXInLFxuICAgICAgICAgICAgam9pbmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ21lbWJlcnNoaXAtMicsXG4gICAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgICAgICByb2xlOiAnbW9kZXJhdG9yJyxcbiAgICAgICAgICAgIGpvaW5lZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdtZW1iZXJzaGlwLTMnLFxuICAgICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgICAgICAgam9pbmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIFJvb20gZGF0YVxuICAgICAgcm9vbToge1xuICAgICAgICBpZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX0NIQVQsXG4gICAgICAgIG5hbWU6ICdHZW5lcmFsIENoYXQnLFxuICAgICAgICBwb3N0aW5nUm9sZTogJ21lbWJlcicsXG4gICAgICAgIHJvb21Hcm91cDoge1xuICAgICAgICAgIGlkOiBURVNUX1JPT01fR1JPVVBfSURTLkFOWElFVFlfR0VORVJBTCxcbiAgICAgICAgICBjb21tdW5pdHk6IHtcbiAgICAgICAgICAgIGlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICAgICAgbWVtYmVyc2hpcHM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ21lbWJlcicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuXG4gICAgICAvLyBQb3N0IGRhdGFcbiAgICAgIHBvc3Q6IHtcbiAgICAgICAgaWQ6IFRFU1RfUE9TVF9JRFMuQU5YSUVUWV9QT1NULFxuICAgICAgICB0aXRsZTogJ1Rlc3QgUG9zdCcsXG4gICAgICAgIGNvbnRlbnQ6ICdUZXN0IGNvbnRlbnQnLFxuICAgICAgICByb29tSWQ6IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9DSEFULFxuICAgICAgICByb29tOiB7XG4gICAgICAgICAgaWQ6IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9DSEFULFxuICAgICAgICAgIHBvc3RpbmdSb2xlOiAnbWVtYmVyJyxcbiAgICAgICAgICByb29tR3JvdXA6IHtcbiAgICAgICAgICAgIGNvbW11bml0eToge1xuICAgICAgICAgICAgICBpZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgICAgICAgbWVtYmVyc2hpcHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgICAgICAgcm9sZTogJ21lbWJlcicsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIENvbW1lbnQgZGF0YVxuICAgICAgY29tbWVudDoge1xuICAgICAgICBpZDogVEVTVF9DT01NRU5UX0lEUy5BTlhJRVRZX0NPTU1FTlQsXG4gICAgICAgIGNvbnRlbnQ6ICdUZXN0IGNvbW1lbnQnLFxuICAgICAgICBwb3N0OiB7XG4gICAgICAgICAgcm9vbUlkOiBURVNUX1JPT01fSURTLkFOWElFVFlfQ0hBVCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIE1lbWJlcnNoaXBzXG4gICAgICBtZW1iZXJzaGlwOiB7XG4gICAgICAgIGlkOiAnbWVtYmVyc2hpcC1jbGllbnQnLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgcm9sZTogJ21lbWJlcicsXG4gICAgICB9LFxuXG4gICAgICBtZW1iZXJzaGlwTW9kZXJhdG9yOiB7XG4gICAgICAgIGlkOiAnbWVtYmVyc2hpcC1tb2RlcmF0b3InLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgcm9sZTogJ21vZGVyYXRvcicsXG4gICAgICB9LFxuXG4gICAgICBtZW1iZXJzaGlwQWRtaW46IHtcbiAgICAgICAgaWQ6ICdtZW1iZXJzaGlwLWFkbWluJyxcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbW9jayBQcmlzbWEgc2VydmljZSB3aXRoIGNvbW11bml0eSBhY2Nlc3MgY29udHJvbCBkYXRhXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlTW9ja1ByaXNtYVdpdGhDb21tdW5pdHlEYXRhKCkge1xuICAgIGNvbnN0IHByaXNtYVNlcnZpY2UgPSBjcmVhdGVNb2NrUHJpc21hU2VydmljZSgpO1xuICAgIC8vIEFkZCBtaXNzaW5nIHJvb20gbW9kZWwgdG8gdGhlIG1vY2tcbiAgICAocHJpc21hU2VydmljZSBhcyBhbnkpLnJvb20gPSB7XG4gICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgIH07XG4gICAgY29uc3QgbW9ja0RhdGEgPSB0aGlzLmNyZWF0ZU1vY2tDb21tdW5pdHlEYXRhKCk7XG5cbiAgICAvLyBTZXR1cCBjb21tdW5pdHkgZmluZFVuaXF1ZSBtb2NrXG4gICAgcHJpc21hU2VydmljZS5jb21tdW5pdHkuZmluZFVuaXF1ZS5tb2NrSW1wbGVtZW50YXRpb24oKHsgd2hlcmUgfSkgPT4ge1xuICAgICAgaWYgKHdoZXJlLmlkID09PSBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobW9ja0RhdGEuY29tbXVuaXR5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfSk7XG5cbiAgICAvLyBTZXR1cCByb29tIGZpbmRVbmlxdWUgbW9ja1xuICAgIChwcmlzbWFTZXJ2aWNlIGFzIGFueSkucm9vbS5maW5kVW5pcXVlLm1vY2tJbXBsZW1lbnRhdGlvbigoeyB3aGVyZSwgaW5jbHVkZSB9KSA9PiB7XG4gICAgICBpZiAod2hlcmUuaWQgPT09IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9DSEFUKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobW9ja0RhdGEucm9vbSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH0pO1xuXG4gICAgLy8gU2V0dXAgcG9zdCBmaW5kVW5pcXVlIG1vY2tcbiAgICBwcmlzbWFTZXJ2aWNlLnBvc3QuZmluZFVuaXF1ZS5tb2NrSW1wbGVtZW50YXRpb24oKHsgd2hlcmUsIGluY2x1ZGUgfSkgPT4ge1xuICAgICAgaWYgKHdoZXJlLmlkID09PSBURVNUX1BPU1RfSURTLkFOWElFVFlfUE9TVCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG1vY2tEYXRhLnBvc3QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9KTtcblxuICAgIC8vIFNldHVwIGNvbW1lbnQgZmluZFVuaXF1ZSBtb2NrXG4gICAgcHJpc21hU2VydmljZS5jb21tZW50LmZpbmRVbmlxdWUubW9ja0ltcGxlbWVudGF0aW9uKCh7IHdoZXJlLCBpbmNsdWRlIH0pID0+IHtcbiAgICAgIGlmICh3aGVyZS5pZCA9PT0gVEVTVF9DT01NRU5UX0lEUy5BTlhJRVRZX0NPTU1FTlQpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtb2NrRGF0YS5jb21tZW50KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfSk7XG5cbiAgICAvLyBTZXR1cCBtZW1iZXJzaGlwIGZpbmRGaXJzdCBtb2NrXG4gICAgcHJpc21hU2VydmljZS5tZW1iZXJzaGlwLmZpbmRGaXJzdC5tb2NrSW1wbGVtZW50YXRpb24oKHsgd2hlcmUgfSkgPT4ge1xuICAgICAgaWYgKHdoZXJlLnVzZXJJZCA9PT0gVEVTVF9VU0VSX0lEUy5DTElFTlQgJiYgd2hlcmUuY29tbXVuaXR5SWQgPT09IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtb2NrRGF0YS5tZW1iZXJzaGlwKTtcbiAgICAgIH1cbiAgICAgIGlmICh3aGVyZS51c2VySWQgPT09IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUICYmIHdoZXJlLmNvbW11bml0eUlkID09PSBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobW9ja0RhdGEubWVtYmVyc2hpcE1vZGVyYXRvcik7XG4gICAgICB9XG4gICAgICBpZiAod2hlcmUudXNlcklkID09PSBURVNUX1VTRVJfSURTLkFETUlOICYmIHdoZXJlLmNvbW11bml0eUlkID09PSBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobW9ja0RhdGEubWVtYmVyc2hpcEFkbWluKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcHJpc21hU2VydmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRlc3Qgc2NlbmFyaW9zIGZvciB2YXJpb3VzIGFjY2VzcyBjb250cm9sIHNpdHVhdGlvbnNcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVBY2Nlc3NDb250cm9sVGVzdFNjZW5hcmlvcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gVmFsaWQgYWNjZXNzIHNjZW5hcmlvc1xuICAgICAgY2xpZW50TWVtYmVyQWNjZXNzOiB7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNvbW11bml0eUlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICByb29tSWQ6IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9DSEFULFxuICAgICAgICBleHBlY3RlZFJvbGU6ICdtZW1iZXInLFxuICAgICAgICBzaG91bGRIYXZlQWNjZXNzOiB0cnVlLFxuICAgICAgICBjYW5Qb3N0OiB0cnVlLCAvLyBNZW1iZXIgY2FuIHBvc3QgaW4gbWVtYmVyIHJvb21cbiAgICAgIH0sXG5cbiAgICAgIHRoZXJhcGlzdE1vZGVyYXRvckFjY2Vzczoge1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgcm9vbUlkOiBURVNUX1JPT01fSURTLkFOWElFVFlfUkVTT1VSQ0VTLFxuICAgICAgICBleHBlY3RlZFJvbGU6ICdtb2RlcmF0b3InLFxuICAgICAgICBzaG91bGRIYXZlQWNjZXNzOiB0cnVlLFxuICAgICAgICBjYW5Qb3N0OiB0cnVlLCAvLyBNb2RlcmF0b3IgY2FuIHBvc3QgaW4gbW9kZXJhdG9yIHJvb21cbiAgICAgIH0sXG5cbiAgICAgIGFkbWluRnVsbEFjY2Vzczoge1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgIGNvbW11bml0eUlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICByb29tSWQ6IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9SRVNPVVJDRVMsXG4gICAgICAgIGV4cGVjdGVkUm9sZTogJ2FkbWluJyxcbiAgICAgICAgc2hvdWxkSGF2ZUFjY2VzczogdHJ1ZSxcbiAgICAgICAgY2FuUG9zdDogdHJ1ZSwgLy8gQWRtaW4gY2FuIHBvc3QgYW55d2hlcmVcbiAgICAgIH0sXG5cbiAgICAgIC8vIEludmFsaWQgYWNjZXNzIHNjZW5hcmlvc1xuICAgICAgbm9uTWVtYmVyQWNjZXNzOiB7XG4gICAgICAgIHVzZXJJZDogJ25vbi1tZW1iZXItdXNlci0xMjMnLFxuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgICAgcm9vbUlkOiBURVNUX1JPT01fSURTLkFOWElFVFlfQ0hBVCxcbiAgICAgICAgZXhwZWN0ZWRSb2xlOiBudWxsLFxuICAgICAgICBzaG91bGRIYXZlQWNjZXNzOiBmYWxzZSxcbiAgICAgICAgY2FuUG9zdDogZmFsc2UsXG4gICAgICB9LFxuXG4gICAgICBtZW1iZXJJbk1vZGVyYXRvclJvb206IHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgIHJvb21JZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX1JFU09VUkNFUyxcbiAgICAgICAgZXhwZWN0ZWRSb2xlOiAnbWVtYmVyJyxcbiAgICAgICAgc2hvdWxkSGF2ZUFjY2VzczogdHJ1ZSwgLy8gQ2FuIGFjY2VzcyB0byByZWFkXG4gICAgICAgIGNhblBvc3Q6IGZhbHNlLCAvLyBCdXQgY2Fubm90IHBvc3QgaW4gbW9kZXJhdG9yIHJvb21cbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbW9jayByZXF1ZXN0IGZvciB0ZXN0aW5nIHNwZWNpZmljIGd1YXJkIHNjZW5hcmlvc1xuICAgKi9cbiAgc3RhdGljIGNyZWF0ZUd1YXJkVGVzdFJlcXVlc3QoXG4gICAgc2NlbmFyaW86IFJldHVyblR5cGU8dHlwZW9mIFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlQWNjZXNzQ29udHJvbFRlc3RTY2VuYXJpb3M+W2tleW9mIFJldHVyblR5cGU8dHlwZW9mIFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlQWNjZXNzQ29udHJvbFRlc3RTY2VuYXJpb3M+XSxcbiAgICBvcHRpb25zOiB7XG4gICAgICBtZXRob2Q/OiBzdHJpbmc7XG4gICAgICBwYXRoPzogc3RyaW5nO1xuICAgICAgcG9zdElkPzogc3RyaW5nO1xuICAgICAgY29tbWVudElkPzogc3RyaW5nO1xuICAgIH0gPSB7fSxcbiAgKSB7XG4gICAgY29uc3QgeyBtZXRob2QgPSAnR0VUJywgcGF0aCA9ICcvdGVzdCcsIHBvc3RJZCwgY29tbWVudElkIH0gPSBvcHRpb25zO1xuXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChzY2VuYXJpby51c2VySWQsIHtcbiAgICAgIGNvbW11bml0eUlkOiBzY2VuYXJpby5jb21tdW5pdHlJZCxcbiAgICAgIHJvb21JZDogc2NlbmFyaW8ucm9vbUlkLFxuICAgICAgcG9zdElkLFxuICAgICAgY29tbWVudElkLFxuICAgICAgbWV0aG9kLFxuICAgICAgcGF0aCxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIFJvbGUtYmFzZWQgVGVzdGluZyBVdGlsaXRpZXNcbiAqL1xuY2xhc3MgUm9sZUJhc2VkVGVzdFV0aWxzIHtcbiAgLyoqXG4gICAqIFRlc3RzIGEgZnVuY3Rpb24gd2l0aCBkaWZmZXJlbnQgdXNlciByb2xlc1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIHRlc3RXaXRoUm9sZXMoXG4gICAgdGVzdEZ1bmN0aW9uOiAodXNlcklkOiBzdHJpbmcsIHJvbGU6IHN0cmluZykgPT4gUHJvbWlzZTxhbnk+LFxuICAgIGV4cGVjdGVkUmVzdWx0czogUmVjb3JkPHN0cmluZywgYW55PixcbiAgKSB7XG4gICAgY29uc3Qgcm9sZXMgPSBbXG4gICAgICB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsIHJvbGU6ICdjbGllbnQnIH0sXG4gICAgICB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIHJvbGU6ICd0aGVyYXBpc3QnIH0sXG4gICAgICB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5BRE1JTiwgcm9sZTogJ2FkbWluJyB9LFxuICAgICAgeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SLCByb2xlOiAnbW9kZXJhdG9yJyB9LFxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHsgdXNlcklkLCByb2xlIH0gb2Ygcm9sZXMpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlc3RGdW5jdGlvbih1c2VySWQsIHJvbGUpO1xuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBleHBlY3RlZFJlc3VsdHNbcm9sZV07XG4gICAgICBcbiAgICAgIGlmIChleHBlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0cyBhdXRob3JpemF0aW9uIHdpdGggZGlmZmVyZW50IHBlcm1pc3Npb24gbGV2ZWxzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgdGVzdEF1dGhvcml6YXRpb25MZXZlbHMoXG4gICAgdGVzdEZ1bmN0aW9uOiAodXNlcklkOiBzdHJpbmcsIHJvbGU6IHN0cmluZykgPT4gUHJvbWlzZTxib29sZWFuPixcbiAgICBtaW5pbXVtUm9sZTogJ21lbWJlcicgfCAnbW9kZXJhdG9yJyB8ICdhZG1pbicsXG4gICkge1xuICAgIGNvbnN0IHJvbGVIaWVyYXJjaHkgPSB7XG4gICAgICBtZW1iZXI6IDAsXG4gICAgICBtb2RlcmF0b3I6IDEsXG4gICAgICBhZG1pbjogMixcbiAgICB9O1xuXG4gICAgY29uc3QgdGVzdHMgPSBbXG4gICAgICB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsIHJvbGU6ICdtZW1iZXInLCBsZXZlbDogMCB9LFxuICAgICAgeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCByb2xlOiAnbW9kZXJhdG9yJywgbGV2ZWw6IDEgfSxcbiAgICAgIHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkFETUlOLCByb2xlOiAnYWRtaW4nLCBsZXZlbDogMiB9LFxuICAgIF07XG5cbiAgICBjb25zdCBtaW5pbXVtTGV2ZWwgPSByb2xlSGllcmFyY2h5W21pbmltdW1Sb2xlXTtcblxuICAgIGZvciAoY29uc3QgeyB1c2VySWQsIHJvbGUsIGxldmVsIH0gb2YgdGVzdHMpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlc3RGdW5jdGlvbih1c2VySWQsIHJvbGUpO1xuICAgICAgY29uc3Qgc2hvdWxkSGF2ZUFjY2VzcyA9IGxldmVsID49IG1pbmltdW1MZXZlbDtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShzaG91bGRIYXZlQWNjZXNzKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBtb2NrIGF1dGhlbnRpY2F0aW9uIGNvbnRleHRzIGZvciBkaWZmZXJlbnQgcm9sZXNcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVSb2xlQXV0aENvbnRleHRzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjbGllbnQ6IE1vY2tCdWlsZGVyLmNyZWF0ZUF1dGhDb250ZXh0KCdjbGllbnQnLCBURVNUX1VTRVJfSURTLkNMSUVOVCksXG4gICAgICB0aGVyYXBpc3Q6IE1vY2tCdWlsZGVyLmNyZWF0ZUF1dGhDb250ZXh0KCd0aGVyYXBpc3QnLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCksXG4gICAgICBhZG1pbjogTW9ja0J1aWxkZXIuY3JlYXRlQXV0aENvbnRleHQoJ2FkbWluJywgVEVTVF9VU0VSX0lEUy5BRE1JTiksXG4gICAgICBtb2RlcmF0b3I6IE1vY2tCdWlsZGVyLmNyZWF0ZUF1dGhDb250ZXh0KCdtb2RlcmF0b3InLCBURVNUX1VTRVJfSURTLk1PREVSQVRPUiksXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENvbW11bml0eSBBY2Nlc3MgR3VhcmQgVGVzdCBVdGlsaXRpZXNcbiAqL1xuY2xhc3MgQ29tbXVuaXR5QWNjZXNzR3VhcmRUZXN0VXRpbHMge1xuICAvKipcbiAgICogQ3JlYXRlcyBhIGNvbXByZWhlbnNpdmUgdGVzdCBzdWl0ZSBmb3IgdGhlIENvbW11bml0eUFjY2Vzc0d1YXJkXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlR3VhcmRUZXN0U3VpdGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIFRlc3QgY29tbXVuaXR5IG1lbWJlcnNoaXAgdmFsaWRhdGlvblxuICAgICAgdGVzdENvbW11bml0eU1lbWJlcnNoaXA6IGFzeW5jIChndWFyZDogYW55LCBzY2VuYXJpbzogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZUd1YXJkVGVzdFJlcXVlc3Qoc2NlbmFyaW8pO1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcbiAgICAgICAgY29uc3QgcmVmbGVjdG9yID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrUmVmbGVjdG9yKHtcbiAgICAgICAgICByZXF1aXJlX2NvbW11bml0eV9tZW1iZXJzaGlwOiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgICBndWFyZC5yZWZsZWN0b3IgPSByZWZsZWN0b3I7XG4gICAgICAgIGd1YXJkLnByaXNtYSA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1ByaXNtYVdpdGhDb21tdW5pdHlEYXRhKCk7XG5cbiAgICAgICAgaWYgKHNjZW5hcmlvLnNob3VsZEhhdmVBY2Nlc3MpIHtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlc29sdmVzLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgZXhwZWN0KGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgLy8gVGVzdCByb29tIGFjY2VzcyB2YWxpZGF0aW9uXG4gICAgICB0ZXN0Um9vbUFjY2VzczogYXN5bmMgKGd1YXJkOiBhbnksIHNjZW5hcmlvOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlR3VhcmRUZXN0UmVxdWVzdChzY2VuYXJpbyk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICBjb25zdCByZWZsZWN0b3IgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZWZsZWN0b3Ioe1xuICAgICAgICAgIHJlcXVpcmVfcm9vbV9hY2Nlc3M6IHRydWUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGd1YXJkLnJlZmxlY3RvciA9IHJlZmxlY3RvcjtcbiAgICAgICAgZ3VhcmQucHJpc21hID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrUHJpc21hV2l0aENvbW11bml0eURhdGEoKTtcblxuICAgICAgICBpZiAoc2NlbmFyaW8uc2hvdWxkSGF2ZUFjY2Vzcykge1xuICAgICAgICAgIGF3YWl0IGV4cGVjdChndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KSkucmVzb2x2ZXMudG9CZSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICAvLyBUZXN0IHBvc3RpbmcgcGVybWlzc2lvbiB2YWxpZGF0aW9uXG4gICAgICB0ZXN0UG9zdGluZ1Blcm1pc3Npb246IGFzeW5jIChndWFyZDogYW55LCBzY2VuYXJpbzogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZUd1YXJkVGVzdFJlcXVlc3Qoc2NlbmFyaW8sIHtcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBwYXRoOiAnL3Bvc3RzJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICBjb25zdCByZWZsZWN0b3IgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZWZsZWN0b3Ioe1xuICAgICAgICAgIHJlcXVpcmVfcG9zdGluZ19yb2xlOiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgICBndWFyZC5yZWZsZWN0b3IgPSByZWZsZWN0b3I7XG4gICAgICAgIGd1YXJkLnByaXNtYSA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1ByaXNtYVdpdGhDb21tdW5pdHlEYXRhKCk7XG5cbiAgICAgICAgaWYgKHNjZW5hcmlvLmNhblBvc3QpIHtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlc29sdmVzLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgZXhwZWN0KGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgLy8gVGVzdCBtb2RlcmF0b3IgcGVybWlzc2lvbiB2YWxpZGF0aW9uXG4gICAgICB0ZXN0TW9kZXJhdG9yUGVybWlzc2lvbjogYXN5bmMgKGd1YXJkOiBhbnksIHNjZW5hcmlvOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlR3VhcmRUZXN0UmVxdWVzdChzY2VuYXJpbyk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuICAgICAgICBjb25zdCByZWZsZWN0b3IgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZWZsZWN0b3Ioe1xuICAgICAgICAgIHJlcXVpcmVfY29tbXVuaXR5X21vZGVyYXRvcjogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZ3VhcmQucmVmbGVjdG9yID0gcmVmbGVjdG9yO1xuICAgICAgICBndWFyZC5wcmlzbWEgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tQcmlzbWFXaXRoQ29tbXVuaXR5RGF0YSgpO1xuXG4gICAgICAgIGNvbnN0IGlzTW9kZXJhdG9yID0gc2NlbmFyaW8uZXhwZWN0ZWRSb2xlID09PSAnbW9kZXJhdG9yJyB8fCBzY2VuYXJpby5leHBlY3RlZFJvbGUgPT09ICdhZG1pbic7XG4gICAgICAgIFxuICAgICAgICBpZiAoaXNNb2RlcmF0b3IpIHtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlc29sdmVzLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgZXhwZWN0KGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8vIEV4cG9ydCBhbGwgdXRpbGl0aWVzXG5leHBvcnQge1xuICBNb2NrQnVpbGRlcixcbiAgU2VjdXJpdHlHdWFyZFRlc3RVdGlscyxcbiAgUm9sZUJhc2VkVGVzdFV0aWxzLFxuICBDb21tdW5pdHlBY2Nlc3NHdWFyZFRlc3RVdGlscyxcbn07Il0sInZlcnNpb24iOjN9