{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/auth-testing-helpers.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/auth-testing-helpers.ts"],"sourcesContent":["/**\n * Authentication Testing Helpers for Security Guards\n * Specialized utilities for testing the new CommunityAccessGuard and role-based access control\n */\n\nimport { ExecutionContext } from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { createMockPrismaService, TEST_USER_IDS } from './index';\nimport { MockBuilder } from './enhanced-test-helpers';\n\n// Community and Room Test Data\nexport const TEST_COMMUNITY_IDS = {\n  ANXIETY_SUPPORT: 'community-anxiety-123',\n  DEPRESSION_HELP: 'community-depression-456',\n  GENERAL_WELLNESS: 'community-wellness-789',\n  PRIVATE_THERAPY: 'community-private-101',\n};\n\nexport const TEST_ROOM_GROUP_IDS = {\n  ANXIETY_GENERAL: 'room-group-anxiety-general-123',\n  DEPRESSION_GENERAL: 'room-group-depression-general-456',\n  WELLNESS_GENERAL: 'room-group-wellness-general-789',\n  PRIVATE_SESSIONS: 'room-group-private-sessions-101',\n};\n\nexport const TEST_ROOM_IDS = {\n  ANXIETY_CHAT: 'room-anxiety-chat-123',\n  ANXIETY_RESOURCES: 'room-anxiety-resources-456',\n  DEPRESSION_CHAT: 'room-depression-chat-789',\n  DEPRESSION_MODS_ONLY: 'room-depression-mods-101',\n  WELLNESS_GENERAL: 'room-wellness-general-112',\n  PRIVATE_ROOM: 'room-private-113',\n};\n\nexport const TEST_POST_IDS = {\n  ANXIETY_POST: 'post-anxiety-123',\n  DEPRESSION_POST: 'post-depression-456',\n  WELLNESS_POST: 'post-wellness-789',\n  PRIVATE_POST: 'post-private-101',\n};\n\nexport const TEST_COMMENT_IDS = {\n  ANXIETY_COMMENT: 'comment-anxiety-123',\n  DEPRESSION_COMMENT: 'comment-depression-456',\n  WELLNESS_COMMENT: 'comment-wellness-789',\n  PRIVATE_COMMENT: 'comment-private-101',\n};\n\n/**\n * Security Guard Testing Utilities\n */\nclass SecurityGuardTestUtils {\n  /**\n   * Creates a mock ExecutionContext for guard testing\n   */\n  static createMockExecutionContext(\n    request: any,\n    handler: any = {},\n    controllerClass: any = {},\n  ): ExecutionContext {\n    return {\n      switchToHttp: () => ({\n        getRequest: () => request,\n        getResponse: () => ({} as any),\n        getNext: () => jest.fn() as any,\n      }),\n      getHandler: () => handler,\n      getClass: () => controllerClass,\n      getArgs: () => [request, {}, jest.fn()] as any,\n      getArgByIndex: (index: number) => [request, {}, jest.fn()][index] as any,\n      switchToRpc: () => ({\n        getContext: () => ({} as any),\n        getData: () => ({} as any),\n      }),\n      switchToWs: () => ({\n        getClient: () => ({} as any),\n        getData: () => ({} as any),\n        getPattern: () => ({} as any),\n      }),\n      getType: () => 'http' as any,\n    };\n  }\n\n  /**\n   * Creates a mock Reflector for metadata testing\n   */\n  static createMockReflector(metadata: Record<string, any> = {}): Reflector {\n    const reflector = new Reflector();\n    reflector.getAllAndOverride = jest.fn((key, targets) => {\n      return metadata[key as string] || false;\n    });\n    return reflector;\n  }\n\n  /**\n   * Creates a mock request with community/room context\n   */\n  static createMockRequestWithCommunityContext(\n    userId: string,\n    options: {\n      communityId?: string;\n      roomId?: string;\n      postId?: string;\n      commentId?: string;\n      path?: string;\n      method?: string;\n      body?: any;\n      params?: any;\n    } = {},\n  ) {\n    const {\n      communityId,\n      roomId,\n      postId,\n      commentId,\n      path = '/test',\n      method = 'GET',\n      body = {},\n      params = {},\n    } = options;\n\n    return {\n      userId,\n      user: { userId },\n      method,\n      path,\n      body: {\n        ...body,\n        ...(communityId && { communityId }),\n        ...(roomId && { roomId }),\n        ...(postId && { postId }),\n      },\n      params: {\n        ...params,\n        ...(communityId && { communityId }),\n        ...(roomId && { roomId }),\n        ...(postId && { id: postId }),\n        ...(commentId && { id: commentId }),\n      },\n    };\n  }\n\n  /**\n   * Creates comprehensive mock data for community hierarchy\n   */\n  static createMockCommunityData() {\n    return {\n      // Community with members\n      community: {\n        id: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        name: 'Anxiety Support',\n        description: 'Community for anxiety support',\n        slug: 'anxiety-support',\n        isPrivate: false,\n        roomGroups: [\n          {\n            id: TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,\n            name: 'General',\n            order: 1,\n            communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n            rooms: [\n              {\n                id: TEST_ROOM_IDS.ANXIETY_CHAT,\n                name: 'General Chat',\n                order: 1,\n                postingRole: 'member',\n                roomGroupId: TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,\n              },\n              {\n                id: TEST_ROOM_IDS.ANXIETY_RESOURCES,\n                name: 'Resources',\n                order: 2,\n                postingRole: 'moderator',\n                roomGroupId: TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,\n              },\n            ],\n          },\n        ],\n        memberships: [\n          {\n            id: 'membership-1',\n            userId: TEST_USER_IDS.CLIENT,\n            communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n            role: 'member',\n            joinedAt: new Date(),\n          },\n          {\n            id: 'membership-2',\n            userId: TEST_USER_IDS.THERAPIST,\n            communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n            role: 'moderator',\n            joinedAt: new Date(),\n          },\n          {\n            id: 'membership-3',\n            userId: TEST_USER_IDS.ADMIN,\n            communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n            role: 'admin',\n            joinedAt: new Date(),\n          },\n        ],\n      },\n\n      // Room data\n      room: {\n        id: TEST_ROOM_IDS.ANXIETY_CHAT,\n        name: 'General Chat',\n        postingRole: 'member',\n        roomGroup: {\n          id: TEST_ROOM_GROUP_IDS.ANXIETY_GENERAL,\n          community: {\n            id: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n            memberships: [\n              {\n                userId: TEST_USER_IDS.CLIENT,\n                role: 'member',\n              },\n            ],\n          },\n        },\n      },\n\n      // Post data\n      post: {\n        id: TEST_POST_IDS.ANXIETY_POST,\n        title: 'Test Post',\n        content: 'Test content',\n        roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n        room: {\n          id: TEST_ROOM_IDS.ANXIETY_CHAT,\n          postingRole: 'member',\n          roomGroup: {\n            community: {\n              id: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n              memberships: [\n                {\n                  userId: TEST_USER_IDS.CLIENT,\n                  role: 'member',\n                },\n              ],\n            },\n          },\n        },\n      },\n\n      // Comment data\n      comment: {\n        id: TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        content: 'Test comment',\n        post: {\n          roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n        },\n      },\n\n      // Memberships\n      membership: {\n        id: 'membership-client',\n        userId: TEST_USER_IDS.CLIENT,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        role: 'member',\n      },\n\n      membershipModerator: {\n        id: 'membership-moderator',\n        userId: TEST_USER_IDS.THERAPIST,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        role: 'moderator',\n      },\n\n      membershipAdmin: {\n        id: 'membership-admin',\n        userId: TEST_USER_IDS.ADMIN,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        role: 'admin',\n      },\n    };\n  }\n\n  /**\n   * Creates a mock Prisma service with community access control data\n   */\n  static createMockPrismaWithCommunityData() {\n    const prismaService = createMockPrismaService();\n    // Add missing room model to the mock\n    (prismaService as any).room = {\n      findUnique: jest.fn(),\n      findMany: jest.fn(),\n      create: jest.fn(),\n      update: jest.fn(),\n      delete: jest.fn(),\n    };\n    const mockData = this.createMockCommunityData();\n\n    // Setup community findUnique mock\n    prismaService.community.findUnique.mockImplementation(({ where }) => {\n      if (where.id === TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {\n        return Promise.resolve(mockData.community);\n      }\n      return Promise.resolve(null);\n    });\n\n    // Setup room findUnique mock\n    (prismaService as any).room.findUnique.mockImplementation(({ where, include }) => {\n      if (where.id === TEST_ROOM_IDS.ANXIETY_CHAT) {\n        return Promise.resolve(mockData.room);\n      }\n      return Promise.resolve(null);\n    });\n\n    // Setup post findUnique mock\n    prismaService.post.findUnique.mockImplementation(({ where, include }) => {\n      if (where.id === TEST_POST_IDS.ANXIETY_POST) {\n        return Promise.resolve(mockData.post);\n      }\n      return Promise.resolve(null);\n    });\n\n    // Setup comment findUnique mock\n    prismaService.comment.findUnique.mockImplementation(({ where, include }) => {\n      if (where.id === TEST_COMMENT_IDS.ANXIETY_COMMENT) {\n        return Promise.resolve(mockData.comment);\n      }\n      return Promise.resolve(null);\n    });\n\n    // Setup membership findFirst mock\n    prismaService.membership.findFirst.mockImplementation(({ where }) => {\n      if (where.userId === TEST_USER_IDS.CLIENT && where.communityId === TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {\n        return Promise.resolve(mockData.membership);\n      }\n      if (where.userId === TEST_USER_IDS.THERAPIST && where.communityId === TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {\n        return Promise.resolve(mockData.membershipModerator);\n      }\n      if (where.userId === TEST_USER_IDS.ADMIN && where.communityId === TEST_COMMUNITY_IDS.ANXIETY_SUPPORT) {\n        return Promise.resolve(mockData.membershipAdmin);\n      }\n      return Promise.resolve(null);\n    });\n\n    return prismaService;\n  }\n\n  /**\n   * Creates test scenarios for various access control situations\n   */\n  static createAccessControlTestScenarios() {\n    return {\n      // Valid access scenarios\n      clientMemberAccess: {\n        userId: TEST_USER_IDS.CLIENT,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n        expectedRole: 'member',\n        shouldHaveAccess: true,\n        canPost: true, // Member can post in member room\n      },\n\n      therapistModeratorAccess: {\n        userId: TEST_USER_IDS.THERAPIST,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_RESOURCES,\n        expectedRole: 'moderator',\n        shouldHaveAccess: true,\n        canPost: true, // Moderator can post in moderator room\n      },\n\n      adminFullAccess: {\n        userId: TEST_USER_IDS.ADMIN,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_RESOURCES,\n        expectedRole: 'admin',\n        shouldHaveAccess: true,\n        canPost: true, // Admin can post anywhere\n      },\n\n      // Invalid access scenarios\n      nonMemberAccess: {\n        userId: 'non-member-user-123',\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n        expectedRole: null,\n        shouldHaveAccess: false,\n        canPost: false,\n      },\n\n      memberInModeratorRoom: {\n        userId: TEST_USER_IDS.CLIENT,\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_RESOURCES,\n        expectedRole: 'member',\n        shouldHaveAccess: true, // Can access to read\n        canPost: false, // But cannot post in moderator room\n      },\n    };\n  }\n\n  /**\n   * Creates a mock request for testing specific guard scenarios\n   */\n  static createGuardTestRequest(\n    scenario: ReturnType<typeof SecurityGuardTestUtils.createAccessControlTestScenarios>[keyof ReturnType<typeof SecurityGuardTestUtils.createAccessControlTestScenarios>],\n    options: {\n      method?: string;\n      path?: string;\n      postId?: string;\n      commentId?: string;\n    } = {},\n  ) {\n    const { method = 'GET', path = '/test', postId, commentId } = options;\n\n    return this.createMockRequestWithCommunityContext(scenario.userId, {\n      communityId: scenario.communityId,\n      roomId: scenario.roomId,\n      postId,\n      commentId,\n      method,\n      path,\n    });\n  }\n}\n\n/**\n * Role-based Testing Utilities\n */\nclass RoleBasedTestUtils {\n  /**\n   * Tests a function with different user roles\n   */\n  static async testWithRoles(\n    testFunction: (userId: string, role: string) => Promise<any>,\n    expectedResults: Record<string, any>,\n  ) {\n    const roles = [\n      { userId: TEST_USER_IDS.CLIENT, role: 'client' },\n      { userId: TEST_USER_IDS.THERAPIST, role: 'therapist' },\n      { userId: TEST_USER_IDS.ADMIN, role: 'admin' },\n      { userId: TEST_USER_IDS.MODERATOR, role: 'moderator' },\n    ];\n\n    for (const { userId, role } of roles) {\n      const result = await testFunction(userId, role);\n      const expected = expectedResults[role];\n      \n      if (expected !== undefined) {\n        expect(result).toEqual(expected);\n      }\n    }\n  }\n\n  /**\n   * Tests authorization with different permission levels\n   */\n  static async testAuthorizationLevels(\n    testFunction: (userId: string, role: string) => Promise<boolean>,\n    minimumRole: 'member' | 'moderator' | 'admin',\n  ) {\n    const roleHierarchy = {\n      member: 0,\n      moderator: 1,\n      admin: 2,\n    };\n\n    const tests = [\n      { userId: TEST_USER_IDS.CLIENT, role: 'member', level: 0 },\n      { userId: TEST_USER_IDS.THERAPIST, role: 'moderator', level: 1 },\n      { userId: TEST_USER_IDS.ADMIN, role: 'admin', level: 2 },\n    ];\n\n    const minimumLevel = roleHierarchy[minimumRole];\n\n    for (const { userId, role, level } of tests) {\n      const result = await testFunction(userId, role);\n      const shouldHaveAccess = level >= minimumLevel;\n      \n      expect(result).toBe(shouldHaveAccess);\n    }\n  }\n\n  /**\n   * Creates mock authentication contexts for different roles\n   */\n  static createRoleAuthContexts() {\n    return {\n      client: MockBuilder.createAuthContext('client', TEST_USER_IDS.CLIENT),\n      therapist: MockBuilder.createAuthContext('therapist', TEST_USER_IDS.THERAPIST),\n      admin: MockBuilder.createAuthContext('admin', TEST_USER_IDS.ADMIN),\n      moderator: MockBuilder.createAuthContext('moderator', TEST_USER_IDS.MODERATOR),\n    };\n  }\n}\n\n/**\n * Community Access Guard Test Utilities\n */\nclass CommunityAccessGuardTestUtils {\n  /**\n   * Creates a comprehensive test suite for the CommunityAccessGuard\n   */\n  static createGuardTestSuite() {\n    return {\n      // Test community membership validation\n      testCommunityMembership: async (guard: any, scenario: any) => {\n        const request = SecurityGuardTestUtils.createGuardTestRequest(scenario);\n        const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n        const reflector = SecurityGuardTestUtils.createMockReflector({\n          require_community_membership: true,\n        });\n\n        guard.reflector = reflector;\n        guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();\n\n        if (scenario.shouldHaveAccess) {\n          await expect(guard.canActivate(context)).resolves.toBe(true);\n        } else {\n          await expect(guard.canActivate(context)).rejects.toThrow();\n        }\n      },\n\n      // Test room access validation\n      testRoomAccess: async (guard: any, scenario: any) => {\n        const request = SecurityGuardTestUtils.createGuardTestRequest(scenario);\n        const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n        const reflector = SecurityGuardTestUtils.createMockReflector({\n          require_room_access: true,\n        });\n\n        guard.reflector = reflector;\n        guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();\n\n        if (scenario.shouldHaveAccess) {\n          await expect(guard.canActivate(context)).resolves.toBe(true);\n        } else {\n          await expect(guard.canActivate(context)).rejects.toThrow();\n        }\n      },\n\n      // Test posting permission validation\n      testPostingPermission: async (guard: any, scenario: any) => {\n        const request = SecurityGuardTestUtils.createGuardTestRequest(scenario, {\n          method: 'POST',\n          path: '/posts',\n        });\n        const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n        const reflector = SecurityGuardTestUtils.createMockReflector({\n          require_posting_role: true,\n        });\n\n        guard.reflector = reflector;\n        guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();\n\n        if (scenario.canPost) {\n          await expect(guard.canActivate(context)).resolves.toBe(true);\n        } else {\n          await expect(guard.canActivate(context)).rejects.toThrow();\n        }\n      },\n\n      // Test moderator permission validation\n      testModeratorPermission: async (guard: any, scenario: any) => {\n        const request = SecurityGuardTestUtils.createGuardTestRequest(scenario);\n        const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n        const reflector = SecurityGuardTestUtils.createMockReflector({\n          require_community_moderator: true,\n        });\n\n        guard.reflector = reflector;\n        guard.prisma = SecurityGuardTestUtils.createMockPrismaWithCommunityData();\n\n        const isModerator = scenario.expectedRole === 'moderator' || scenario.expectedRole === 'admin';\n        \n        if (isModerator) {\n          await expect(guard.canActivate(context)).resolves.toBe(true);\n        } else {\n          await expect(guard.canActivate(context)).rejects.toThrow();\n        }\n      },\n    };\n  }\n}\n\n// Export all utilities\nexport {\n  MockBuilder,\n  SecurityGuardTestUtils,\n  RoleBasedTestUtils,\n  CommunityAccessGuardTestUtils,\n};"],"version":3}