{"version":3,"names":["common_1","cov_12dkp8tnhp","s","require","admin_service_1","jwt_auth_guard_1","current_user_id_decorator_1","current_user_role_decorator_1","zod_validation_pipe_1","admin_schemas_1","AdminUserController","AdminUserController_1","adminService","logger","Logger","name","constructor","f","getAllUsers","currentUserId","role","query","b","ForbiddenException","log","page","limit","search","status","sortBy","sortOrder","error","HttpException","HttpStatus","INTERNAL_SERVER_ERROR","getUser","userId","user","NOT_FOUND","suspendUser","suspensionData","reason","duration","unsuspendUser","exports","__decorate","Get","__param","CurrentUserId","CurrentUserRole","Query","ZodValidationPipe","AdminUserQuerySchema","Param","Put","Body","Controller","UseGuards","JwtAuthGuard","AdminService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-user.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  Query,\n  Param,\n  Body,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { AdminService } from '../admin.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../../auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\nimport { AdminUserQuerySchema } from '../validation/admin.schemas';\nimport type { AdminUserQuery } from '../types';\n\n@Controller('admin/users')\n@UseGuards(JwtAuthGuard)\nexport class AdminUserController {\n  private readonly logger = new Logger(AdminUserController.name);\n\n  constructor(private readonly adminService: AdminService) {}\n\n  @Get()\n  async getAllUsers(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Query(new ZodValidationPipe(AdminUserQuerySchema)) query: AdminUserQuery,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving users`);\n\n      return await this.adminService.getAllUsers({\n        role: query.role,\n        page: query.page || 1,\n        limit: query.limit || 10,\n        search: query.search,\n        status: query.status,\n        sortBy: query.sortBy,\n        sortOrder: query.sortOrder,\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve users:', error);\n      throw new HttpException(\n        'Failed to retrieve users',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Get(':id')\n  async getUser(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('id') userId: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving user ${userId}`);\n      const user = await this.adminService.getUser(userId);\n\n      if (!user) {\n        throw new HttpException('User not found', HttpStatus.NOT_FOUND);\n      }\n\n      return user;\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      this.logger.error('Failed to retrieve user:', error);\n      throw new HttpException(\n        'Failed to retrieve user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':id/suspend')\n  async suspendUser(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('id') userId: string,\n    @Body() suspensionData: { reason: string; duration?: number },\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} suspending user ${userId}`);\n      return await this.adminService.suspendUser(\n        userId,\n        currentUserId,\n        suspensionData.reason,\n        suspensionData.duration,\n      );\n    } catch (error) {\n      this.logger.error('Failed to suspend user:', error);\n      throw new HttpException(\n        'Failed to suspend user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':id/unsuspend')\n  async unsuspendUser(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('id') userId: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} unsuspending user ${userId}`);\n      return await this.adminService.unsuspendUser(userId, currentUserId);\n    } catch (error) {\n      this.logger.error('Failed to unsuspend user:', error);\n      throw new HttpException(\n        'Failed to unsuspend user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}