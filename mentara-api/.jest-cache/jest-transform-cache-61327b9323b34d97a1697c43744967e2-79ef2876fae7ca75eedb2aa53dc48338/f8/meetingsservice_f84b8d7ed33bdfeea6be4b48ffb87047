5e24ccdfbf88371899f3a05b9e2611d8
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var MeetingsService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingsService = void 0;
const common_1 = require("@nestjs/common");
const jwt_1 = require("@nestjs/jwt");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const event_bus_service_1 = require("../common/events/event-bus.service");
const booking_events_1 = require("../common/events/booking-events");
let MeetingsService = MeetingsService_1 = class MeetingsService {
    prisma;
    eventBus;
    jwtService;
    logger = new common_1.Logger(MeetingsService_1.name);
    constructor(prisma, eventBus, jwtService) {
        this.prisma = prisma;
        this.eventBus = eventBus;
        this.jwtService = jwtService;
    }
    /**
     * Get meeting details with access validation
     */
    async getMeetingById(meetingId, userId) {
        this.logger.debug(`getMeetingById called with meetingId: ${meetingId}, userId: ${userId}`);
        const meeting = await this.prisma.meeting.findFirst({
            where: {
                id: meetingId,
                OR: [{ clientId: userId }, { therapistId: userId }],
            },
            include: {
                client: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                email: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                therapist: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                email: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
            },
        });
        if (!meeting) {
            throw new common_1.NotFoundException('Meeting not found or access denied');
        }
        return meeting;
    }
    /**
     * Get user's upcoming meetings
     */
    async getUpcomingMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        // This follows REST API best practices: return 200 with empty array rather than 404
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return {
                meetings: [],
                total: 0,
            };
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: { in: ['SCHEDULED', 'CONFIRMED'] },
                startTime: { gte: new Date() },
            },
            include: {
                client: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                therapist: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
            },
            orderBy: { startTime: 'asc' },
            take: limit,
        });
        this.logger.log(`Found ${meetings.length} upcoming meetings for user ${userId}`);
        return {
            meetings,
            total: meetings.length,
        };
    }
    /**
     * Generate meeting room URL/token (for integration with video platforms)
     */
    async generateMeetingRoom(meetingId, userId) {
        await this.getMeetingById(meetingId, userId);
        // In a real implementation, this would integrate with video platforms like:
        // - Zoom SDK
        // - WebRTC/Jitsi
        // - Twilio Video
        // - Agora
        const roomUrl = `${process.env.FRONTEND_URL}/meeting/${meetingId}`;
        const roomToken = this.generateRoomToken(meetingId, userId, 'host');
        // Update meeting with room URL
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: { meetingUrl: roomUrl },
        });
        return {
            roomUrl,
            roomToken,
            meetingId,
            expires: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours
        };
    }
    /**
     * Validate meeting access for WebSocket connections
     */
    async validateMeetingAccess(meetingId, userId) {
        try {
            const meeting = await this.prisma.meeting.findFirst({
                where: {
                    id: meetingId,
                    OR: [{ clientId: userId }, { therapistId: userId }],
                    status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },
                },
            });
            return !!meeting;
        }
        catch (error) {
            this.logger.error('Failed to validate meeting access:', error);
            return false;
        }
    }
    /**
     * Get meeting analytics for therapists
     */
    async getMeetingAnalytics(therapistId, dateRange) {
        const whereClause = {
            therapistId,
            status: 'COMPLETED',
        };
        if (dateRange) {
            whereClause.startTime = {
                gte: dateRange.start,
                lte: dateRange.end,
            };
        }
        const meetings = await this.prisma.meeting.findMany({
            where: whereClause,
            include: {
                meetingNotes: true,
            },
        });
        const analytics = {
            totalMeetings: meetings.length,
            totalDuration: meetings.reduce((sum, m) => sum + m.duration, 0),
            averageDuration: meetings.length > 0
                ? meetings.reduce((sum, m) => sum + m.duration, 0) / meetings.length
                : 0,
            meetingsByType: {
                video: meetings.filter((m) => m.meetingType === 'video').length,
                audio: meetings.filter((m) => m.meetingType === 'audio').length,
                chat: meetings.filter((m) => m.meetingType === 'chat').length,
            },
            completionRate: (meetings.filter((m) => m.status === 'COMPLETED').length /
                meetings.length) *
                100,
        };
        return analytics;
    }
    /**
     * Generate secure room access token using JWT
     */
    generateRoomToken(meetingId, userId, role) {
        const payload = {
            sub: userId,
            meetingId,
            role: role || 'participant',
            type: 'meeting_access',
            iat: Math.floor(Date.now() / 1000),
        };
        // Generate JWT with 24-hour expiration for meeting tokens
        return this.jwtService.sign(payload, {
            expiresIn: '24h',
            issuer: 'mentara-meetings',
            subject: userId,
        });
    }
    /**
     * Validate and decode room access token
     */
    validateRoomToken(token) {
        try {
            const decoded = this.jwtService.verify(token, {
                issuer: 'mentara-meetings',
            });
            if (decoded.type !== 'meeting_access') {
                return null;
            }
            return {
                userId: decoded.sub,
                meetingId: decoded.meetingId,
                role: decoded.role,
            };
        }
        catch (error) {
            this.logger.warn(`Invalid room token: ${error instanceof Error ? error.message : String(error)}`);
            return null;
        }
    }
    /**
     * Handle emergency meeting termination
     */
    async emergencyTerminateMeeting(meetingId, reason, terminatedBy) {
        const meeting = await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'CANCELLED',
            },
        });
        // Add emergency termination note
        await this.prisma.meetingNotes.create({
            data: {
                id: `note_${Date.now()}`,
                meetingId,
                notes: `Emergency termination: ${reason}. Terminated by: ${terminatedBy}`,
            },
        });
        void this.eventBus.emit(new booking_events_1.MeetingEmergencyTerminatedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            terminatedBy,
            terminatedAt: new Date(),
            reason,
        }));
        this.logger.warn(`Emergency termination of meeting ${meetingId}: ${reason}`);
        return meeting;
    }
    // ===== VIDEO CALL INTEGRATION METHODS =====
    /**
     * Create a video room for a meeting
     */
    async createVideoRoom(meetingId, userId, createRoomDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        if (meeting.status !== 'SCHEDULED' && meeting.status !== 'CONFIRMED') {
            throw new common_1.BadRequestException('Meeting must be scheduled or confirmed to create video room');
        }
        // Update meeting status to IN_PROGRESS
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: { status: 'IN_PROGRESS' },
        });
        // Generate video room data (in production, integrate with actual video service like Twilio/Zoom)
        const roomId = `room_${meetingId}_${Date.now()}`;
        const accessToken = this.generateRoomToken(meetingId, userId, 'host');
        const participantToken = this.generateRoomToken(meetingId, userId, 'participant');
        const videoRoomResponse = {
            roomId,
            meetingId,
            joinUrl: `https://video.mentara.app/room/${roomId}`,
            roomUrl: `https://video.mentara.app/room/${roomId}`, // Replace with actual video service URL
            accessToken,
            participantToken,
            roomConfig: {
                maxParticipants: createRoomDto.maxParticipants,
                enableRecording: createRoomDto.enableRecording,
                enableChat: createRoomDto.enableChat,
                recordingActive: false,
            },
            participants: [],
            roomSettings: {
                maxParticipants: createRoomDto.maxParticipants || 2,
                recordingEnabled: createRoomDto.recordingEnabled || false,
                screenShareEnabled: createRoomDto.screenShareEnabled || true,
                chatEnabled: createRoomDto.chatEnabled || true,
                waitingRoomEnabled: createRoomDto.waitingRoomEnabled || false,
            },
            expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours
            participantCount: 1,
            status: 'waiting',
            createdAt: new Date().toISOString(),
        };
        // Emit meeting started event
        void this.eventBus.emit(new booking_events_1.MeetingStartedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            startedAt: new Date(),
            actualStartTime: new Date(),
            scheduledStartTime: meeting.startTime,
        }));
        this.logger.log(`Video room created for meeting ${meetingId}`);
        return videoRoomResponse;
    }
    /**
     * Join an existing video room
     */
    async joinVideoRoom(meetingId, userId, joinRoomDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        if (meeting.status !== 'IN_PROGRESS') {
            throw new common_1.BadRequestException('Meeting must be in progress to join video room');
        }
        // Generate participant credentials
        const roomId = `room_${meetingId}_${Date.now()}`;
        const accessToken = this.generateRoomToken(meetingId, userId, joinRoomDto.role);
        const participantToken = this.generateRoomToken(meetingId, userId, joinRoomDto.role);
        const videoRoomResponse = {
            roomId,
            meetingId,
            joinUrl: `https://video.mentara.app/room/${roomId}`,
            roomUrl: `https://video.mentara.app/room/${roomId}`,
            accessToken,
            participantToken,
            roomConfig: {
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
                recordingActive: false,
            },
            participants: [],
            roomSettings: {
                maxParticipants: 2,
                recordingEnabled: false,
                screenShareEnabled: true,
                chatEnabled: true,
                waitingRoomEnabled: false,
            },
            expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(),
            participantCount: 2,
            status: 'active',
            createdAt: new Date().toISOString(),
        };
        this.logger.log(`User ${userId} joined video room for meeting ${meetingId}`);
        return videoRoomResponse;
    }
    /**
     * Get video call status
     */
    async getVideoCallStatus(meetingId, userId) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        // Mock video call status (in production, fetch from actual video service)
        const videoCallStatus = {
            meetingId,
            roomId: `room_${meetingId}`,
            isActive: meeting.status === 'IN_PROGRESS',
            participantCount: 2, // Client + Therapist
            status: meeting.status === 'IN_PROGRESS' ? 'active' : 'waiting',
            participants: [
                {
                    userId: meeting.clientId,
                    id: meeting.clientId,
                    name: 'Client', // In production, fetch actual user names
                    role: 'client',
                    joinedAt: meeting.startTime.toISOString(),
                    isHost: false,
                    audioEnabled: true,
                    videoEnabled: true,
                    connectionStatus: 'connected',
                },
                {
                    userId: meeting.therapistId,
                    id: meeting.therapistId,
                    name: 'Therapist',
                    role: 'therapist',
                    joinedAt: meeting.startTime.toISOString(),
                    isHost: true,
                    audioEnabled: true,
                    videoEnabled: true,
                    connectionStatus: 'connected',
                },
            ],
            startedAt: meeting.startTime.toISOString(),
            endedAt: meeting.status === 'COMPLETED'
                ? new Date(meeting.startTime.getTime() + meeting.duration * 60000).toISOString()
                : undefined,
            duration: meeting.status === 'COMPLETED' ? meeting.duration : undefined,
        };
        return videoCallStatus;
    }
    /**
     * End video call
     */
    async endVideoCall(meetingId, userId, endCallDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        // Update meeting status to completed
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'COMPLETED',
            },
        });
        // Save session summary if provided
        if (endCallDto.duration || endCallDto.reason || endCallDto.participantFeedback) {
            await this.prisma.meetingNotes.create({
                data: {
                    id: `notes_${meetingId}_${Date.now()}`,
                    meetingId,
                    notes: JSON.stringify({
                        sessionType: 'REGULAR_THERAPY',
                        duration: endCallDto.duration,
                        endReason: endCallDto.reason,
                        audioQuality: endCallDto.participantFeedback?.audioQuality,
                        videoQuality: endCallDto.participantFeedback?.videoQuality,
                        overallExperience: endCallDto.participantFeedback?.overallExperience,
                        issues: endCallDto.participantFeedback?.issues,
                        platform: 'video',
                        endTime: new Date().toISOString(),
                    }),
                },
            });
        }
        // Emit meeting completed event
        void this.eventBus.emit(new booking_events_1.MeetingCompletedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            completedAt: new Date(),
            actualDuration: endCallDto.duration || meeting.duration,
            scheduledDuration: meeting.duration,
        }));
        this.logger.log(`Video call ended for meeting ${meetingId}: ${endCallDto.reason}`);
    }
    /**
     * Updated method to use new DTOs
     */
    async updateMeetingStatus(meetingId, userId, updateStatusDto) {
        const meeting = await this.getMeetingById(meetingId, userId);
        const updatedMeeting = await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: updateStatusDto.status.toUpperCase(),
            },
        });
        // Emit appropriate events based on status
        switch (updateStatusDto.status) {
            case 'confirmed':
                void this.eventBus.emit(new booking_events_1.MeetingConfirmedEvent({
                    meetingId,
                    clientId: meeting.clientId,
                    therapistId: meeting.therapistId,
                    confirmedAt: new Date(),
                    startTime: meeting.startTime,
                    duration: meeting.duration,
                }));
                break;
            case 'cancelled':
                void this.eventBus.emit(new booking_events_1.MeetingCancelledEvent({
                    meetingId,
                    clientId: meeting.clientId,
                    therapistId: meeting.therapistId,
                    cancelledBy: userId,
                    cancelledAt: new Date(),
                    cancellationReason: updateStatusDto.reason,
                    originalStartTime: meeting.startTime,
                }));
                break;
        }
        this.logger.log(`Meeting ${meetingId} status updated to ${updateStatusDto.status}`);
        return updatedMeeting;
    }
    /**
     * Updated method to use new DTOs
     */
    async saveMeetingSession(meetingId, userId, sessionData) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        const session = await this.prisma.meetingNotes.create({
            data: {
                id: `session_${meetingId}_${Date.now()}`,
                meetingId,
                notes: JSON.stringify({
                    sessionType: 'REGULAR_THERAPY',
                    startTime: sessionData.sessionData?.startedAt ? new Date(sessionData.sessionData.startedAt).toISOString() : new Date().toISOString(),
                    endTime: sessionData.sessionData?.endedAt ? new Date(sessionData.sessionData.endedAt).toISOString() : new Date().toISOString(),
                    duration: sessionData.sessionData?.duration || sessionData.duration,
                    status: 'COMPLETED',
                    platform: 'video',
                    sessionNotes: sessionData.sessionNotes,
                    clientProgress: sessionData.clientProgress,
                    followUpActions: sessionData.followUpActions,
                    quality: sessionData.sessionData?.quality,
                    issues: sessionData.sessionData?.issues || [],
                }),
            },
        });
        this.logger.log(`Session data saved for meeting ${meetingId}`);
        return session;
    }
    /**
     * Get user's completed meetings
     */
    async getCompletedMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: 'COMPLETED',
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get user's cancelled meetings
     */
    async getCancelledMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: { in: ['CANCELLED', 'NO_SHOW'] },
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get user's in-progress meetings
     */
    async getInProgressMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: 'IN_PROGRESS',
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get all meetings with filtering options
     */
    async getAllMeetings(userId, queryOptions) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const whereClause = {
            OR: [{ clientId: userId }, { therapistId: userId }],
        };
        // Add status filter
        if (queryOptions.status) {
            whereClause.status = queryOptions.status.toUpperCase();
        }
        // Add date range filter
        if (queryOptions.dateFrom || queryOptions.dateTo) {
            whereClause.startTime = {};
            if (queryOptions.dateFrom) {
                whereClause.startTime.gte = new Date(queryOptions.dateFrom);
            }
            if (queryOptions.dateTo) {
                whereClause.startTime.lte = new Date(queryOptions.dateTo);
            }
        }
        const meetings = await this.prisma.meeting.findMany({
            where: whereClause,
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: queryOptions.limit || 20,
            skip: queryOptions.offset || 0,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Helper method to get consistent meeting include options
     */
    getMeetingIncludeOptions() {
        return {
            client: {
                include: {
                    user: {
                        select: {
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                },
            },
            therapist: {
                include: {
                    user: {
                        select: {
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                },
            },
        };
    }
    /**
     * Helper method to transform meetings data
     */
    transformMeetings(meetings) {
        return meetings.map(meeting => ({
            id: meeting.id,
            title: meeting.title,
            description: meeting.description,
            status: meeting.status,
            startTime: meeting.startTime,
            endTime: meeting.endTime,
            duration: meeting.duration,
            meetingType: meeting.meetingType,
            meetingUrl: meeting.meetingUrl,
            client: meeting.client,
            therapist: meeting.therapist,
            createdAt: meeting.createdAt,
            updatedAt: meeting.updatedAt,
        }));
    }
};
exports.MeetingsService = MeetingsService;
exports.MeetingsService = MeetingsService = MeetingsService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof event_bus_service_1.EventBusService !== "undefined" && event_bus_service_1.EventBusService) === "function" ? _b : Object, typeof (_c = typeof jwt_1.JwtService !== "undefined" && jwt_1.JwtService) === "function" ? _c : Object])
], MeetingsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FNd0I7QUFDeEIscUNBQXlDO0FBQ3pDLGdGQUFvRTtBQUNwRSwwRUFBcUU7QUFDckUsb0VBTXlDO0FBNEJsQyxJQUFNLGVBQWUsdUJBQXJCLE1BQU0sZUFBZTtJQUlQO0lBQ0E7SUFDQTtJQUxGLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxpQkFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNELFlBQ21CLE1BQXFCLEVBQ3JCLFFBQXlCLEVBQ3pCLFVBQXNCO1FBRnRCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUN0QyxDQUFDO0lBRUo7O09BRUc7SUFDSCxLQUFLLENBQUMsY0FBYyxDQUFDLFNBQWlCLEVBQUUsTUFBYztRQUNwRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyx5Q0FBeUMsU0FBUyxhQUFhLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDM0YsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7WUFDbEQsS0FBSyxFQUFFO2dCQUNMLEVBQUUsRUFBRSxTQUFTO2dCQUNiLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxDQUFDO2FBQ3BEO1lBQ0QsT0FBTyxFQUFFO2dCQUNQLE1BQU0sRUFBRTtvQkFDTixPQUFPLEVBQUU7d0JBQ1AsSUFBSSxFQUFFOzRCQUNKLE1BQU0sRUFBRTtnQ0FDTixTQUFTLEVBQUUsSUFBSTtnQ0FDZixRQUFRLEVBQUUsSUFBSTtnQ0FDZCxLQUFLLEVBQUUsSUFBSTtnQ0FDWCxTQUFTLEVBQUUs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QUFpQixDQUFDLFFBQWU7UUFDdkMsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5QixFQUFFLEVBQUUsT0FBTyxDQUFDLEVBQUU7WUFDZCxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7WUFDcEIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO1lBQ2hDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtZQUN0QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7WUFDNUIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPO1lBQ3hCLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtZQUMxQixXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVc7WUFDaEMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO1lBQzlCLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtZQUN0QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7WUFDNUIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1lBQzVCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztTQUM3QixDQUFDLENBQUMsQ0FBQztJQUNOLENBQUM7Q0FDRixDQUFBO0FBLzJCWSwwQ0FBZTswQkFBZixlQUFlO0lBRDNCLElBQUEsbUJBQVUsR0FBRTt5REFLZ0Isc0NBQWEsb0JBQWIsc0NBQWEsb0RBQ1gsbUNBQWUsb0JBQWYsbUNBQWUsb0RBQ2IsZ0JBQVUsb0JBQVYsZ0JBQVU7R0FOOUIsZUFBZSxDQSsyQjNCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9tZWV0aW5ncy9tZWV0aW5ncy5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEluamVjdGFibGUsXG4gIExvZ2dlcixcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgSnd0U2VydmljZSB9IGZyb20gJ0BuZXN0anMvand0JztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBFdmVudEJ1c1NlcnZpY2UgfSBmcm9tICcuLi9jb21tb24vZXZlbnRzL2V2ZW50LWJ1cy5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIE1lZXRpbmdDb25maXJtZWRFdmVudCxcbiAgTWVldGluZ1N0YXJ0ZWRFdmVudCxcbiAgTWVldGluZ0NvbXBsZXRlZEV2ZW50LFxuICBNZWV0aW5nQ2FuY2VsbGVkRXZlbnQsXG4gIE1lZXRpbmdFbWVyZ2VuY3lUZXJtaW5hdGVkRXZlbnQsXG59IGZyb20gJy4uL2NvbW1vbi9ldmVudHMvYm9va2luZy1ldmVudHMnO1xuaW1wb3J0IHR5cGUge1xuICBDcmVhdGVWaWRlb1Jvb21EdG8sXG4gIEpvaW5WaWRlb1Jvb21EdG8sXG4gIEVuZFZpZGVvQ2FsbER0byxcbiAgVmlkZW9Sb29tUmVzcG9uc2UsXG4gIFZpZGVvQ2FsbFN0YXR1cyxcbiAgVXBkYXRlTWVldGluZ1N0YXR1c0R0byxcbiAgU2F2ZU1lZXRpbmdTZXNzaW9uRHRvLFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGludGVyZmFjZSBNZWV0aW5nU2Vzc2lvbkRhdGEge1xuICBtZWV0aW5nSWQ6IHN0cmluZztcbiAgc3RhcnRUaW1lOiBEYXRlO1xuICBlbmRUaW1lPzogRGF0ZTtcbiAgcGFydGljaXBhbnRDb3VudDogbnVtYmVyO1xuICBkdXJhdGlvbjogbnVtYmVyOyAvLyBhY3R1YWwgZHVyYXRpb24gaW4gbWludXRlc1xuICByZWNvcmRpbmdVcmw/OiBzdHJpbmc7XG4gIGNoYXRNZXNzYWdlcz86IGFueVtdO1xuICB0ZWNoSXNzdWVzPzogc3RyaW5nW107XG4gIHF1YWxpdHk/OiB7XG4gICAgdmlkZW9RdWFsaXR5OiAncG9vcicgfCAnZmFpcicgfCAnZ29vZCcgfCAnZXhjZWxsZW50JztcbiAgICBhdWRpb1F1YWxpdHk6ICdwb29yJyB8ICdmYWlyJyB8ICdnb29kJyB8ICdleGNlbGxlbnQnO1xuICAgIGNvbm5lY3Rpb25TdGFiaWxpdHk6ICdwb29yJyB8ICdmYWlyJyB8ICdnb29kJyB8ICdleGNlbGxlbnQnO1xuICB9O1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTWVldGluZ3NTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKE1lZXRpbmdzU2VydmljZS5uYW1lKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByaXNtYTogUHJpc21hU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGV2ZW50QnVzOiBFdmVudEJ1c1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBqd3RTZXJ2aWNlOiBKd3RTZXJ2aWNlLFxuICApIHt9XG5cbiAgLyoqXG4gICAqIEdldCBtZWV0aW5nIGRldGFpbHMgd2l0aCBhY2Nlc3MgdmFsaWRhdGlvblxuICAgKi9cbiAgYXN5bmMgZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYGdldE1lZXRpbmdCeUlkIGNhbGxlZCB3aXRoIG1lZXRpbmdJZDogJHttZWV0aW5nSWR9LCB1c2VySWQ6ICR7dXNlcklkfWApO1xuICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogbWVldGluZ0lkLFxuICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRoZXJhcGlzdDoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIW1lZXRpbmcpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignTWVldGluZyBub3QgZm91bmQgb3IgYWNjZXNzIGRlbmllZCcpO1xuICAgIH1cblxuICAgIHJldHVybiBtZWV0aW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB1c2VyJ3MgdXBjb21pbmcgbWVldGluZ3NcbiAgICovXG4gIGFzeW5jIGdldFVwY29taW5nTWVldGluZ3ModXNlcklkOiBzdHJpbmcsIGxpbWl0ID0gMTApIHtcbiAgICAvLyBGaXJzdCB2YWxpZGF0ZSB0aGF0IHVzZXIgZXhpc3RzXG4gICAgY29uc3QgdXNlckV4aXN0cyA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGNsaWVudDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlckV4aXN0cykge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihgVXNlciBub3QgZm91bmQ6ICR7dXNlcklkfWApO1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIElmIHVzZXIgZXhpc3RzIGJ1dCBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm4gZW1wdHkgbWVldGluZ3NcbiAgICAvLyBUaGlzIGZvbGxvd3MgUkVTVCBBUEkgYmVzdCBwcmFjdGljZXM6IHJldHVybiAyMDAgd2l0aCBlbXB0eSBhcnJheSByYXRoZXIgdGhhbiA0MDRcbiAgICBpZiAoIXVzZXJFeGlzdHMuY2xpZW50ICYmICF1c2VyRXhpc3RzLnRoZXJhcGlzdCkge1xuICAgICAgdGhpcy5sb2dnZXIubG9nKGBVc2VyICR7dXNlcklkfSBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm5pbmcgZW1wdHkgbWVldGluZ3NgKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lZXRpbmdzOiBbXSxcbiAgICAgICAgdG90YWw6IDAsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IG1lZXRpbmdzID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICAgIHN0YXR1czogeyBpbjogWydTQ0hFRFVMRUQnLCAnQ09ORklSTUVEJ10gfSxcbiAgICAgICAgc3RhcnRUaW1lOiB7IGd0ZTogbmV3IERhdGUoKSB9LFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgb3JkZXJCeTogeyBzdGFydFRpbWU6ICdhc2MnIH0sXG4gICAgICB0YWtlOiBsaW1pdCxcbiAgICB9KTtcblxuICAgIHRoaXMubG9nZ2VyLmxvZyhgRm91bmQgJHttZWV0aW5ncy5sZW5ndGh9IHVwY29taW5nIG1lZXRpbmdzIGZvciB1c2VyICR7dXNlcklkfWApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG1lZXRpbmdzLFxuICAgICAgdG90YWw6IG1lZXRpbmdzLmxlbmd0aCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIG1lZXRpbmcgcm9vbSBVUkwvdG9rZW4gKGZvciBpbnRlZ3JhdGlvbiB3aXRoIHZpZGVvIHBsYXRmb3JtcylcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlTWVldGluZ1Jvb20obWVldGluZ0lkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgaW50ZWdyYXRlIHdpdGggdmlkZW8gcGxhdGZvcm1zIGxpa2U6XG4gICAgLy8gLSBab29tIFNES1xuICAgIC8vIC0gV2ViUlRDL0ppdHNpXG4gICAgLy8gLSBUd2lsaW8gVmlkZW9cbiAgICAvLyAtIEFnb3JhXG5cbiAgICBjb25zdCByb29tVXJsID0gYCR7cHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMfS9tZWV0aW5nLyR7bWVldGluZ0lkfWA7XG4gICAgY29uc3Qgcm9vbVRva2VuID0gdGhpcy5nZW5lcmF0ZVJvb21Ub2tlbihtZWV0aW5nSWQsIHVzZXJJZCwgJ2hvc3QnKTtcblxuICAgIC8vIFVwZGF0ZSBtZWV0aW5nIHdpdGggcm9vbSBVUkxcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7IG1lZXRpbmdVcmw6IHJvb21VcmwgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICByb29tVXJsLFxuICAgICAgcm9vbVRva2VuLFxuICAgICAgbWVldGluZ0lkLFxuICAgICAgZXhwaXJlczogbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAyNCBob3Vyc1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgbWVldGluZyBhY2Nlc3MgZm9yIFdlYlNvY2tldCBjb25uZWN0aW9uc1xuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVNZWV0aW5nQWNjZXNzKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogbWVldGluZ0lkLFxuICAgICAgICAgIE9SOiBbeyBjbGllbnRJZDogdXNlcklkIH0sIHsgdGhlcmFwaXN0SWQ6IHVzZXJJZCB9XSxcbiAgICAgICAgICBzdGF0dXM6IHsgaW46IFsnU0NIRURVTEVEJywgJ0NPTkZJUk1FRCcsICdJTl9QUk9HUkVTUyddIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuICEhbWVldGluZztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB2YWxpZGF0ZSBtZWV0aW5nIGFjY2VzczonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtZWV0aW5nIGFuYWx5dGljcyBmb3IgdGhlcmFwaXN0c1xuICAgKi9cbiAgYXN5bmMgZ2V0TWVldGluZ0FuYWx5dGljcyhcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIGRhdGVSYW5nZT86IHsgc3RhcnQ6IERhdGU7IGVuZDogRGF0ZSB9LFxuICApIHtcbiAgICBjb25zdCB3aGVyZUNsYXVzZTogYW55ID0ge1xuICAgICAgdGhlcmFwaXN0SWQsXG4gICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgIH07XG5cbiAgICBpZiAoZGF0ZVJhbmdlKSB7XG4gICAgICB3aGVyZUNsYXVzZS5zdGFydFRpbWUgPSB7XG4gICAgICAgIGd0ZTogZGF0ZVJhbmdlLnN0YXJ0LFxuICAgICAgICBsdGU6IGRhdGVSYW5nZS5lbmQsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IG1lZXRpbmdzID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICB3aGVyZTogd2hlcmVDbGF1c2UsXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIG1lZXRpbmdOb3RlczogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBhbmFseXRpY3MgPSB7XG4gICAgICB0b3RhbE1lZXRpbmdzOiBtZWV0aW5ncy5sZW5ndGgsXG4gICAgICB0b3RhbER1cmF0aW9uOiBtZWV0aW5ncy5yZWR1Y2UoKHN1bSwgbSkgPT4gc3VtICsgbS5kdXJhdGlvbiwgMCksXG4gICAgICBhdmVyYWdlRHVyYXRpb246XG4gICAgICAgIG1lZXRpbmdzLmxlbmd0aCA+IDBcbiAgICAgICAgICA/IG1lZXRpbmdzLnJlZHVjZSgoc3VtLCBtKSA9PiBzdW0gKyBtLmR1cmF0aW9uLCAwKSAvIG1lZXRpbmdzLmxlbmd0aFxuICAgICAgICAgIDogMCxcbiAgICAgIG1lZXRpbmdzQnlUeXBlOiB7XG4gICAgICAgIHZpZGVvOiBtZWV0aW5ncy5maWx0ZXIoKG0pID0+IG0ubWVldGluZ1R5cGUgPT09ICd2aWRlbycpLmxlbmd0aCxcbiAgICAgICAgYXVkaW86IG1lZXRpbmdzLmZpbHRlcigobSkgPT4gbS5tZWV0aW5nVHlwZSA9PT0gJ2F1ZGlvJykubGVuZ3RoLFxuICAgICAgICBjaGF0OiBtZWV0aW5ncy5maWx0ZXIoKG0pID0+IG0ubWVldGluZ1R5cGUgPT09ICdjaGF0JykubGVuZ3RoLFxuICAgICAgfSxcbiAgICAgIGNvbXBsZXRpb25SYXRlOlxuICAgICAgICAobWVldGluZ3MuZmlsdGVyKChtKSA9PiBtLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcpLmxlbmd0aCAvXG4gICAgICAgICAgbWVldGluZ3MubGVuZ3RoKSAqXG4gICAgICAgIDEwMCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGFuYWx5dGljcztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBzZWN1cmUgcm9vbSBhY2Nlc3MgdG9rZW4gdXNpbmcgSldUXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlUm9vbVRva2VuKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHJvbGU/OiBzdHJpbmcsXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgIHN1YjogdXNlcklkLFxuICAgICAgbWVldGluZ0lkLFxuICAgICAgcm9sZTogcm9sZSB8fCAncGFydGljaXBhbnQnLFxuICAgICAgdHlwZTogJ21lZXRpbmdfYWNjZXNzJyxcbiAgICAgIGlhdDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgfTtcblxuICAgIC8vIEdlbmVyYXRlIEpXVCB3aXRoIDI0LWhvdXIgZXhwaXJhdGlvbiBmb3IgbWVldGluZyB0b2tlbnNcbiAgICByZXR1cm4gdGhpcy5qd3RTZXJ2aWNlLnNpZ24ocGF5bG9hZCwge1xuICAgICAgZXhwaXJlc0luOiAnMjRoJyxcbiAgICAgIGlzc3VlcjogJ21lbnRhcmEtbWVldGluZ3MnLFxuICAgICAgc3ViamVjdDogdXNlcklkLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGFuZCBkZWNvZGUgcm9vbSBhY2Nlc3MgdG9rZW5cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVSb29tVG9rZW4oXG4gICAgdG9rZW46IHN0cmluZyxcbiAgKTogeyB1c2VySWQ6IHN0cmluZzsgbWVldGluZ0lkOiBzdHJpbmc7IHJvbGU6IHN0cmluZyB9IHwgbnVsbCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRlY29kZWQgPSB0aGlzLmp3dFNlcnZpY2UudmVyaWZ5KHRva2VuLCB7XG4gICAgICAgIGlzc3VlcjogJ21lbnRhcmEtbWVldGluZ3MnLFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChkZWNvZGVkLnR5cGUgIT09ICdtZWV0aW5nX2FjY2VzcycpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXJJZDogZGVjb2RlZC5zdWIsXG4gICAgICAgIG1lZXRpbmdJZDogZGVjb2RlZC5tZWV0aW5nSWQsXG4gICAgICAgIHJvbGU6IGRlY29kZWQucm9sZSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgIGBJbnZhbGlkIHJvb20gdG9rZW46ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXG4gICAgICApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBlbWVyZ2VuY3kgbWVldGluZyB0ZXJtaW5hdGlvblxuICAgKi9cbiAgYXN5bmMgZW1lcmdlbmN5VGVybWluYXRlTWVldGluZyhcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICByZWFzb246IHN0cmluZyxcbiAgICB0ZXJtaW5hdGVkQnk6IHN0cmluZyxcbiAgKSB7XG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBtZWV0aW5nSWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3RhdHVzOiAnQ0FOQ0VMTEVEJyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBBZGQgZW1lcmdlbmN5IHRlcm1pbmF0aW9uIG5vdGVcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nTm90ZXMuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaWQ6IGBub3RlXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIG5vdGVzOiBgRW1lcmdlbmN5IHRlcm1pbmF0aW9uOiAke3JlYXNvbn0uIFRlcm1pbmF0ZWQgYnk6ICR7dGVybWluYXRlZEJ5fWAsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdm9pZCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICBuZXcgTWVldGluZ0VtZXJnZW5jeVRlcm1pbmF0ZWRFdmVudCh7XG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgY2xpZW50SWQ6IG1lZXRpbmcuY2xpZW50SWQsXG4gICAgICAgIHRoZXJhcGlzdElkOiBtZWV0aW5nLnRoZXJhcGlzdElkLFxuICAgICAgICB0ZXJtaW5hdGVkQnksXG4gICAgICAgIHRlcm1pbmF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgcmVhc29uLFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICBgRW1lcmdlbmN5IHRlcm1pbmF0aW9uIG9mIG1lZXRpbmcgJHttZWV0aW5nSWR9OiAke3JlYXNvbn1gLFxuICAgICk7XG4gICAgcmV0dXJuIG1lZXRpbmc7XG4gIH1cblxuICAvLyA9PT09PSBWSURFTyBDQUxMIElOVEVHUkFUSU9OIE1FVEhPRFMgPT09PT1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgdmlkZW8gcm9vbSBmb3IgYSBtZWV0aW5nXG4gICAqL1xuICBhc3luYyBjcmVhdGVWaWRlb1Jvb20oXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgY3JlYXRlUm9vbUR0bzogQ3JlYXRlVmlkZW9Sb29tRHRvLFxuICApOiBQcm9taXNlPFZpZGVvUm9vbVJlc3BvbnNlPiB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICBpZiAobWVldGluZy5zdGF0dXMgIT09ICdTQ0hFRFVMRUQnICYmIG1lZXRpbmcuc3RhdHVzICE9PSAnQ09ORklSTUVEJykge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICdNZWV0aW5nIG11c3QgYmUgc2NoZWR1bGVkIG9yIGNvbmZpcm1lZCB0byBjcmVhdGUgdmlkZW8gcm9vbScsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBtZWV0aW5nIHN0YXR1cyB0byBJTl9QUk9HUkVTU1xuICAgIGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBtZWV0aW5nSWQgfSxcbiAgICAgIGRhdGE6IHsgc3RhdHVzOiAnSU5fUFJPR1JFU1MnIH0sXG4gICAgfSk7XG5cbiAgICAvLyBHZW5lcmF0ZSB2aWRlbyByb29tIGRhdGEgKGluIHByb2R1Y3Rpb24sIGludGVncmF0ZSB3aXRoIGFjdHVhbCB2aWRlbyBzZXJ2aWNlIGxpa2UgVHdpbGlvL1pvb20pXG4gICAgY29uc3Qgcm9vbUlkID0gYHJvb21fJHttZWV0aW5nSWR9XyR7RGF0ZS5ub3coKX1gO1xuICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdGhpcy5nZW5lcmF0ZVJvb21Ub2tlbihtZWV0aW5nSWQsIHVzZXJJZCwgJ2hvc3QnKTtcbiAgICBjb25zdCBwYXJ0aWNpcGFudFRva2VuID0gdGhpcy5nZW5lcmF0ZVJvb21Ub2tlbihcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgICdwYXJ0aWNpcGFudCcsXG4gICAgKTtcblxuICAgIGNvbnN0IHZpZGVvUm9vbVJlc3BvbnNlOiBWaWRlb1Jvb21SZXNwb25zZSA9IHtcbiAgICAgIHJvb21JZCxcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIGpvaW5Vcmw6IGBodHRwczovL3ZpZGVvLm1lbnRhcmEuYXBwL3Jvb20vJHtyb29tSWR9YCxcbiAgICAgIHJvb21Vcmw6IGBodHRwczovL3ZpZGVvLm1lbnRhcmEuYXBwL3Jvb20vJHtyb29tSWR9YCwgLy8gUmVwbGFjZSB3aXRoIGFjdHVhbCB2aWRlbyBzZXJ2aWNlIFVSTFxuICAgICAgYWNjZXNzVG9rZW4sXG4gICAgICBwYXJ0aWNpcGFudFRva2VuLFxuICAgICAgcm9vbUNvbmZpZzoge1xuICAgICAgICBtYXhQYXJ0aWNpcGFudHM6IGNyZWF0ZVJvb21EdG8ubWF4UGFydGljaXBhbnRzLFxuICAgICAgICBlbmFibGVSZWNvcmRpbmc6IGNyZWF0ZVJvb21EdG8uZW5hYmxlUmVjb3JkaW5nLFxuICAgICAgICBlbmFibGVDaGF0OiBjcmVhdGVSb29tRHRvLmVuYWJsZUNoYXQsXG4gICAgICAgIHJlY29yZGluZ0FjdGl2ZTogZmFsc2UsXG4gICAgICB9LFxuICAgICAgcGFydGljaXBhbnRzOiBbXSxcbiAgICAgIHJvb21TZXR0aW5nczoge1xuICAgICAgICBtYXhQYXJ0aWNpcGFudHM6IGNyZWF0ZVJvb21EdG8ubWF4UGFydGljaXBhbnRzIHx8IDIsXG4gICAgICAgIHJlY29yZGluZ0VuYWJsZWQ6IGNyZWF0ZVJvb21EdG8ucmVjb3JkaW5nRW5hYmxlZCB8fCBmYWxzZSxcbiAgICAgICAgc2NyZWVuU2hhcmVFbmFibGVkOiBjcmVhdGVSb29tRHRvLnNjcmVlblNoYXJlRW5hYmxlZCB8fCB0cnVlLFxuICAgICAgICBjaGF0RW5hYmxlZDogY3JlYXRlUm9vbUR0by5jaGF0RW5hYmxlZCB8fCB0cnVlLFxuICAgICAgICB3YWl0aW5nUm9vbUVuYWJsZWQ6IGNyZWF0ZVJvb21EdG8ud2FpdGluZ1Jvb21FbmFibGVkIHx8IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKSwgLy8gNCBob3Vyc1xuICAgICAgcGFydGljaXBhbnRDb3VudDogMSxcbiAgICAgIHN0YXR1czogJ3dhaXRpbmcnLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcblxuICAgIC8vIEVtaXQgbWVldGluZyBzdGFydGVkIGV2ZW50XG4gICAgdm9pZCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICBuZXcgTWVldGluZ1N0YXJ0ZWRFdmVudCh7XG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgY2xpZW50SWQ6IG1lZXRpbmcuY2xpZW50SWQsXG4gICAgICAgIHRoZXJhcGlzdElkOiBtZWV0aW5nLnRoZXJhcGlzdElkLFxuICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGFjdHVhbFN0YXJ0VGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgc2NoZWR1bGVkU3RhcnRUaW1lOiBtZWV0aW5nLnN0YXJ0VGltZSxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYFZpZGVvIHJvb20gY3JlYXRlZCBmb3IgbWVldGluZyAke21lZXRpbmdJZH1gKTtcbiAgICByZXR1cm4gdmlkZW9Sb29tUmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogSm9pbiBhbiBleGlzdGluZyB2aWRlbyByb29tXG4gICAqL1xuICBhc3luYyBqb2luVmlkZW9Sb29tKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGpvaW5Sb29tRHRvOiBKb2luVmlkZW9Sb29tRHRvLFxuICApOiBQcm9taXNlPFZpZGVvUm9vbVJlc3BvbnNlPiB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICBpZiAobWVldGluZy5zdGF0dXMgIT09ICdJTl9QUk9HUkVTUycpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICAnTWVldGluZyBtdXN0IGJlIGluIHByb2dyZXNzIHRvIGpvaW4gdmlkZW8gcm9vbScsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIHBhcnRpY2lwYW50IGNyZWRlbnRpYWxzXG4gICAgY29uc3Qgcm9vbUlkID0gYHJvb21fJHttZWV0aW5nSWR9XyR7RGF0ZS5ub3coKX1gO1xuICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdGhpcy5nZW5lcmF0ZVJvb21Ub2tlbihcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGpvaW5Sb29tRHRvLnJvbGUsXG4gICAgKTtcbiAgICBjb25zdCBwYXJ0aWNpcGFudFRva2VuID0gdGhpcy5nZW5lcmF0ZVJvb21Ub2tlbihcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGpvaW5Sb29tRHRvLnJvbGUsXG4gICAgKTtcblxuICAgIGNvbnN0IHZpZGVvUm9vbVJlc3BvbnNlOiBWaWRlb1Jvb21SZXNwb25zZSA9IHtcbiAgICAgIHJvb21JZCxcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIGpvaW5Vcmw6IGBodHRwczovL3ZpZGVvLm1lbnRhcmEuYXBwL3Jvb20vJHtyb29tSWR9YCxcbiAgICAgIHJvb21Vcmw6IGBodHRwczovL3ZpZGVvLm1lbnRhcmEuYXBwL3Jvb20vJHtyb29tSWR9YCxcbiAgICAgIGFjY2Vzc1Rva2VuLFxuICAgICAgcGFydGljaXBhbnRUb2tlbixcbiAgICAgIHJvb21Db25maWc6IHtcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiAyLFxuICAgICAgICBlbmFibGVSZWNvcmRpbmc6IGZhbHNlLFxuICAgICAgICBlbmFibGVDaGF0OiB0cnVlLFxuICAgICAgICByZWNvcmRpbmdBY3RpdmU6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIHBhcnRpY2lwYW50czogW10sXG4gICAgICByb29tU2V0dGluZ3M6IHtcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiAyLFxuICAgICAgICByZWNvcmRpbmdFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgc2NyZWVuU2hhcmVFbmFibGVkOiB0cnVlLFxuICAgICAgICBjaGF0RW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgd2FpdGluZ1Jvb21FbmFibGVkOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBwYXJ0aWNpcGFudENvdW50OiAyLFxuICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgVXNlciAke3VzZXJJZH0gam9pbmVkIHZpZGVvIHJvb20gZm9yIG1lZXRpbmcgJHttZWV0aW5nSWR9YCxcbiAgICApO1xuICAgIHJldHVybiB2aWRlb1Jvb21SZXNwb25zZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdmlkZW8gY2FsbCBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGdldFZpZGVvQ2FsbFN0YXR1cyhcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxWaWRlb0NhbGxTdGF0dXM+IHtcbiAgICAvLyBWYWxpZGF0ZSBtZWV0aW5nIGFjY2Vzc1xuICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLmdldE1lZXRpbmdCeUlkKG1lZXRpbmdJZCwgdXNlcklkKTtcblxuICAgIC8vIE1vY2sgdmlkZW8gY2FsbCBzdGF0dXMgKGluIHByb2R1Y3Rpb24sIGZldGNoIGZyb20gYWN0dWFsIHZpZGVvIHNlcnZpY2UpXG4gICAgY29uc3QgdmlkZW9DYWxsU3RhdHVzOiBWaWRlb0NhbGxTdGF0dXMgPSB7XG4gICAgICBtZWV0aW5nSWQsXG4gICAgICByb29tSWQ6IGByb29tXyR7bWVldGluZ0lkfWAsXG4gICAgICBpc0FjdGl2ZTogbWVldGluZy5zdGF0dXMgPT09ICdJTl9QUk9HUkVTUycsXG4gICAgICBwYXJ0aWNpcGFudENvdW50OiAyLCAvLyBDbGllbnQgKyBUaGVyYXBpc3RcbiAgICAgIHN0YXR1czogbWVldGluZy5zdGF0dXMgPT09ICdJTl9QUk9HUkVTUycgPyAnYWN0aXZlJyA6ICd3YWl0aW5nJyxcbiAgICAgIHBhcnRpY2lwYW50czogW1xuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICAgIGlkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICAgIG5hbWU6ICdDbGllbnQnLCAvLyBJbiBwcm9kdWN0aW9uLCBmZXRjaCBhY3R1YWwgdXNlciBuYW1lc1xuICAgICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICAgIGpvaW5lZEF0OiBtZWV0aW5nLnN0YXJ0VGltZS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGlzSG9zdDogZmFsc2UsXG4gICAgICAgICAgYXVkaW9FbmFibGVkOiB0cnVlLFxuICAgICAgICAgIHZpZGVvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICBjb25uZWN0aW9uU3RhdHVzOiAnY29ubmVjdGVkJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgICBpZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgICBuYW1lOiAnVGhlcmFwaXN0JyxcbiAgICAgICAgICByb2xlOiAndGhlcmFwaXN0JyxcbiAgICAgICAgICBqb2luZWRBdDogbWVldGluZy5zdGFydFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBpc0hvc3Q6IHRydWUsXG4gICAgICAgICAgYXVkaW9FbmFibGVkOiB0cnVlLFxuICAgICAgICAgIHZpZGVvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICBjb25uZWN0aW9uU3RhdHVzOiAnY29ubmVjdGVkJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBzdGFydGVkQXQ6IG1lZXRpbmcuc3RhcnRUaW1lLnRvSVNPU3RyaW5nKCksXG4gICAgICBlbmRlZEF0OlxuICAgICAgICBtZWV0aW5nLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCdcbiAgICAgICAgICA/IG5ldyBEYXRlKFxuICAgICAgICAgICAgICBtZWV0aW5nLnN0YXJ0VGltZS5nZXRUaW1lKCkgKyBtZWV0aW5nLmR1cmF0aW9uICogNjAwMDAsXG4gICAgICAgICAgICApLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIGR1cmF0aW9uOiBtZWV0aW5nLnN0YXR1cyA9PT0gJ0NPTVBMRVRFRCcgPyBtZWV0aW5nLmR1cmF0aW9uIDogdW5kZWZpbmVkLFxuICAgIH07XG5cbiAgICByZXR1cm4gdmlkZW9DYWxsU3RhdHVzO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuZCB2aWRlbyBjYWxsXG4gICAqL1xuICBhc3luYyBlbmRWaWRlb0NhbGwoXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgZW5kQ2FsbER0bzogRW5kVmlkZW9DYWxsRHRvLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBWYWxpZGF0ZSBtZWV0aW5nIGFjY2Vzc1xuICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLmdldE1lZXRpbmdCeUlkKG1lZXRpbmdJZCwgdXNlcklkKTtcblxuICAgIC8vIFVwZGF0ZSBtZWV0aW5nIHN0YXR1cyB0byBjb21wbGV0ZWRcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gU2F2ZSBzZXNzaW9uIHN1bW1hcnkgaWYgcHJvdmlkZWRcbiAgICBpZiAoZW5kQ2FsbER0by5kdXJhdGlvbiB8fCBlbmRDYWxsRHRvLnJlYXNvbiB8fCBlbmRDYWxsRHRvLnBhcnRpY2lwYW50RmVlZGJhY2spIHtcbiAgICAgIGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmdOb3Rlcy5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6IGBub3Rlc18ke21lZXRpbmdJZH1fJHtEYXRlLm5vdygpfWAsXG4gICAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICAgIG5vdGVzOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBzZXNzaW9uVHlwZTogJ1JFR1VMQVJfVEhFUkFQWScsXG4gICAgICAgICAgICBkdXJhdGlvbjogZW5kQ2FsbER0by5kdXJhdGlvbixcbiAgICAgICAgICAgIGVuZFJlYXNvbjogZW5kQ2FsbER0by5yZWFzb24sXG4gICAgICAgICAgICBhdWRpb1F1YWxpdHk6IGVuZENhbGxEdG8ucGFydGljaXBhbnRGZWVkYmFjaz8uYXVkaW9RdWFsaXR5LFxuICAgICAgICAgICAgdmlkZW9RdWFsaXR5OiBlbmRDYWxsRHRvLnBhcnRpY2lwYW50RmVlZGJhY2s/LnZpZGVvUXVhbGl0eSxcbiAgICAgICAgICAgIG92ZXJhbGxFeHBlcmllbmNlOiBlbmRDYWxsRHRvLnBhcnRpY2lwYW50RmVlZGJhY2s/Lm92ZXJhbGxFeHBlcmllbmNlLFxuICAgICAgICAgICAgaXNzdWVzOiBlbmRDYWxsRHRvLnBhcnRpY2lwYW50RmVlZGJhY2s/Lmlzc3VlcyxcbiAgICAgICAgICAgIHBsYXRmb3JtOiAndmlkZW8nLFxuICAgICAgICAgICAgZW5kVGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRW1pdCBtZWV0aW5nIGNvbXBsZXRlZCBldmVudFxuICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgbmV3IE1lZXRpbmdDb21wbGV0ZWRFdmVudCh7XG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgY2xpZW50SWQ6IG1lZXRpbmcuY2xpZW50SWQsXG4gICAgICAgIHRoZXJhcGlzdElkOiBtZWV0aW5nLnRoZXJhcGlzdElkLFxuICAgICAgICBjb21wbGV0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgYWN0dWFsRHVyYXRpb246IGVuZENhbGxEdG8uZHVyYXRpb24gfHwgbWVldGluZy5kdXJhdGlvbixcbiAgICAgICAgc2NoZWR1bGVkRHVyYXRpb246IG1lZXRpbmcuZHVyYXRpb24sXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFZpZGVvIGNhbGwgZW5kZWQgZm9yIG1lZXRpbmcgJHttZWV0aW5nSWR9OiAke2VuZENhbGxEdG8ucmVhc29ufWAsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVkIG1ldGhvZCB0byB1c2UgbmV3IERUT3NcbiAgICovXG4gIGFzeW5jIHVwZGF0ZU1lZXRpbmdTdGF0dXMoXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXBkYXRlU3RhdHVzRHRvOiBVcGRhdGVNZWV0aW5nU3RhdHVzRHRvLFxuICApIHtcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICBjb25zdCB1cGRhdGVkTWVldGluZyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBtZWV0aW5nSWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3RhdHVzOiB1cGRhdGVTdGF0dXNEdG8uc3RhdHVzLnRvVXBwZXJDYXNlKCkgYXMgYW55LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIEVtaXQgYXBwcm9wcmlhdGUgZXZlbnRzIGJhc2VkIG9uIHN0YXR1c1xuICAgIHN3aXRjaCAodXBkYXRlU3RhdHVzRHRvLnN0YXR1cykge1xuICAgICAgY2FzZSAnY29uZmlybWVkJzpcbiAgICAgICAgdm9pZCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICAgICAgbmV3IE1lZXRpbmdDb25maXJtZWRFdmVudCh7XG4gICAgICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgICAgICBjbGllbnRJZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgICAgIHRoZXJhcGlzdElkOiBtZWV0aW5nLnRoZXJhcGlzdElkLFxuICAgICAgICAgICAgY29uZmlybWVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBzdGFydFRpbWU6IG1lZXRpbmcuc3RhcnRUaW1lLFxuICAgICAgICAgICAgZHVyYXRpb246IG1lZXRpbmcuZHVyYXRpb24sXG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnY2FuY2VsbGVkJzpcbiAgICAgICAgdm9pZCB0aGlzLmV2ZW50QnVzLmVtaXQoXG4gICAgICAgICAgbmV3IE1lZXRpbmdDYW5jZWxsZWRFdmVudCh7XG4gICAgICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgICAgICBjbGllbnRJZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgICAgIHRoZXJhcGlzdElkOiBtZWV0aW5nLnRoZXJhcGlzdElkLFxuICAgICAgICAgICAgY2FuY2VsbGVkQnk6IHVzZXJJZCxcbiAgICAgICAgICAgIGNhbmNlbGxlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgY2FuY2VsbGF0aW9uUmVhc29uOiB1cGRhdGVTdGF0dXNEdG8ucmVhc29uLFxuICAgICAgICAgICAgb3JpZ2luYWxTdGFydFRpbWU6IG1lZXRpbmcuc3RhcnRUaW1lLFxuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgTWVldGluZyAke21lZXRpbmdJZH0gc3RhdHVzIHVwZGF0ZWQgdG8gJHt1cGRhdGVTdGF0dXNEdG8uc3RhdHVzfWAsXG4gICAgKTtcbiAgICByZXR1cm4gdXBkYXRlZE1lZXRpbmc7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlZCBtZXRob2QgdG8gdXNlIG5ldyBEVE9zXG4gICAqL1xuICBhc3luYyBzYXZlTWVldGluZ1Nlc3Npb24oXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgc2Vzc2lvbkRhdGE6IFNhdmVNZWV0aW5nU2Vzc2lvbkR0byxcbiAgKSB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZ05vdGVzLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBgc2Vzc2lvbl8ke21lZXRpbmdJZH1fJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgbm90ZXM6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBzZXNzaW9uVHlwZTogJ1JFR1VMQVJfVEhFUkFQWScsXG4gICAgICAgICAgc3RhcnRUaW1lOiBzZXNzaW9uRGF0YS5zZXNzaW9uRGF0YT8uc3RhcnRlZEF0ID8gbmV3IERhdGUoc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGEuc3RhcnRlZEF0KS50b0lTT1N0cmluZygpIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGVuZFRpbWU6IHNlc3Npb25EYXRhLnNlc3Npb25EYXRhPy5lbmRlZEF0ID8gbmV3IERhdGUoc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGEuZW5kZWRBdCkudG9JU09TdHJpbmcoKSA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBkdXJhdGlvbjogc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGE/LmR1cmF0aW9uIHx8IHNlc3Npb25EYXRhLmR1cmF0aW9uLFxuICAgICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgICAgcGxhdGZvcm06ICd2aWRlbycsXG4gICAgICAgICAgc2Vzc2lvbk5vdGVzOiBzZXNzaW9uRGF0YS5zZXNzaW9uTm90ZXMsXG4gICAgICAgICAgY2xpZW50UHJvZ3Jlc3M6IHNlc3Npb25EYXRhLmNsaWVudFByb2dyZXNzLFxuICAgICAgICAgIGZvbGxvd1VwQWN0aW9uczogc2Vzc2lvbkRhdGEuZm9sbG93VXBBY3Rpb25zLFxuICAgICAgICAgIHF1YWxpdHk6IHNlc3Npb25EYXRhLnNlc3Npb25EYXRhPy5xdWFsaXR5LFxuICAgICAgICAgIGlzc3Vlczogc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGE/Lmlzc3VlcyB8fCBbXSxcbiAgICAgICAgfSksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBTZXNzaW9uIGRhdGEgc2F2ZWQgZm9yIG1lZXRpbmcgJHttZWV0aW5nSWR9YCk7XG4gICAgcmV0dXJuIHNlc3Npb247XG4gIH1cblxuICAvKipcbiAgICogR2V0IHVzZXIncyBjb21wbGV0ZWQgbWVldGluZ3NcbiAgICovXG4gIGFzeW5jIGdldENvbXBsZXRlZE1lZXRpbmdzKHVzZXJJZDogc3RyaW5nLCBsaW1pdCA9IDEwKSB7XG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFVzZXIgbm90IGZvdW5kOiAke3VzZXJJZH1gKTtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyBJZiB1c2VyIGV4aXN0cyBidXQgaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuIGVtcHR5IG1lZXRpbmdzXG4gICAgaWYgKCF1c2VyRXhpc3RzLmNsaWVudCAmJiAhdXNlckV4aXN0cy50aGVyYXBpc3QpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgVXNlciAke3VzZXJJZH0gaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuaW5nIGVtcHR5IG1lZXRpbmdzYCk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IG1lZXRpbmdzID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICB9LFxuICAgICAgaW5jbHVkZTogdGhpcy5nZXRNZWV0aW5nSW5jbHVkZU9wdGlvbnMoKSxcbiAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiAnZGVzYycgfSxcbiAgICAgIHRha2U6IGxpbWl0LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtTWVldGluZ3MobWVldGluZ3MpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB1c2VyJ3MgY2FuY2VsbGVkIG1lZXRpbmdzXG4gICAqL1xuICBhc3luYyBnZXRDYW5jZWxsZWRNZWV0aW5ncyh1c2VySWQ6IHN0cmluZywgbGltaXQgPSAxMCkge1xuICAgIC8vIEZpcnN0IHZhbGlkYXRlIHRoYXQgdXNlciBleGlzdHNcbiAgICBjb25zdCB1c2VyRXhpc3RzID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1c2VyRXhpc3RzKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGBVc2VyIG5vdCBmb3VuZDogJHt1c2VySWR9YCk7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdXNlciBleGlzdHMgYnV0IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybiBlbXB0eSBtZWV0aW5nc1xuICAgIGlmICghdXNlckV4aXN0cy5jbGllbnQgJiYgIXVzZXJFeGlzdHMudGhlcmFwaXN0KSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYFVzZXIgJHt1c2VySWR9IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybmluZyBlbXB0eSBtZWV0aW5nc2ApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgICBzdGF0dXM6IHsgaW46IFsnQ0FOQ0VMTEVEJywgJ05PX1NIT1cnXSB9LFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHRoaXMuZ2V0TWVldGluZ0luY2x1ZGVPcHRpb25zKCksXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogJ2Rlc2MnIH0sXG4gICAgICB0YWtlOiBsaW1pdCxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybU1lZXRpbmdzKG1lZXRpbmdzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlcidzIGluLXByb2dyZXNzIG1lZXRpbmdzXG4gICAqL1xuICBhc3luYyBnZXRJblByb2dyZXNzTWVldGluZ3ModXNlcklkOiBzdHJpbmcsIGxpbWl0ID0gMTApIHtcbiAgICAvLyBGaXJzdCB2YWxpZGF0ZSB0aGF0IHVzZXIgZXhpc3RzXG4gICAgY29uc3QgdXNlckV4aXN0cyA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGNsaWVudDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlckV4aXN0cykge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihgVXNlciBub3QgZm91bmQ6ICR7dXNlcklkfWApO1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIElmIHVzZXIgZXhpc3RzIGJ1dCBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm4gZW1wdHkgbWVldGluZ3NcbiAgICBpZiAoIXVzZXJFeGlzdHMuY2xpZW50ICYmICF1c2VyRXhpc3RzLnRoZXJhcGlzdCkge1xuICAgICAgdGhpcy5sb2dnZXIubG9nKGBVc2VyICR7dXNlcklkfSBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm5pbmcgZW1wdHkgbWVldGluZ3NgKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIE9SOiBbeyBjbGllbnRJZDogdXNlcklkIH0sIHsgdGhlcmFwaXN0SWQ6IHVzZXJJZCB9XSxcbiAgICAgICAgc3RhdHVzOiAnSU5fUFJPR1JFU1MnLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHRoaXMuZ2V0TWVldGluZ0luY2x1ZGVPcHRpb25zKCksXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogJ2Rlc2MnIH0sXG4gICAgICB0YWtlOiBsaW1pdCxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybU1lZXRpbmdzKG1lZXRpbmdzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIG1lZXRpbmdzIHdpdGggZmlsdGVyaW5nIG9wdGlvbnNcbiAgICovXG4gIGFzeW5jIGdldEFsbE1lZXRpbmdzKHVzZXJJZDogc3RyaW5nLCBxdWVyeU9wdGlvbnM6IHtcbiAgICBzdGF0dXM/OiBzdHJpbmc7XG4gICAgdHlwZT86IHN0cmluZztcbiAgICBsaW1pdD86IG51bWJlcjtcbiAgICBvZmZzZXQ/OiBudW1iZXI7XG4gICAgZGF0ZUZyb20/OiBzdHJpbmc7XG4gICAgZGF0ZVRvPzogc3RyaW5nO1xuICB9KSB7XG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFVzZXIgbm90IGZvdW5kOiAke3VzZXJJZH1gKTtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyBJZiB1c2VyIGV4aXN0cyBidXQgaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuIGVtcHR5IG1lZXRpbmdzXG4gICAgaWYgKCF1c2VyRXhpc3RzLmNsaWVudCAmJiAhdXNlckV4aXN0cy50aGVyYXBpc3QpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgVXNlciAke3VzZXJJZH0gaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuaW5nIGVtcHR5IG1lZXRpbmdzYCk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHdoZXJlQ2xhdXNlOiBhbnkgPSB7XG4gICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgfTtcblxuICAgIC8vIEFkZCBzdGF0dXMgZmlsdGVyXG4gICAgaWYgKHF1ZXJ5T3B0aW9ucy5zdGF0dXMpIHtcbiAgICAgIHdoZXJlQ2xhdXNlLnN0YXR1cyA9IHF1ZXJ5T3B0aW9ucy5zdGF0dXMudG9VcHBlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgZGF0ZSByYW5nZSBmaWx0ZXJcbiAgICBpZiAocXVlcnlPcHRpb25zLmRhdGVGcm9tIHx8IHF1ZXJ5T3B0aW9ucy5kYXRlVG8pIHtcbiAgICAgIHdoZXJlQ2xhdXNlLnN0YXJ0VGltZSA9IHt9O1xuICAgICAgaWYgKHF1ZXJ5T3B0aW9ucy5kYXRlRnJvbSkge1xuICAgICAgICB3aGVyZUNsYXVzZS5zdGFydFRpbWUuZ3RlID0gbmV3IERhdGUocXVlcnlPcHRpb25zLmRhdGVGcm9tKTtcbiAgICAgIH1cbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuZGF0ZVRvKSB7XG4gICAgICAgIHdoZXJlQ2xhdXNlLnN0YXJ0VGltZS5sdGUgPSBuZXcgRGF0ZShxdWVyeU9wdGlvbnMuZGF0ZVRvKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgaW5jbHVkZTogdGhpcy5nZXRNZWV0aW5nSW5jbHVkZU9wdGlvbnMoKSxcbiAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiAnZGVzYycgfSxcbiAgICAgIHRha2U6IHF1ZXJ5T3B0aW9ucy5saW1pdCB8fCAyMCxcbiAgICAgIHNraXA6IHF1ZXJ5T3B0aW9ucy5vZmZzZXQgfHwgMCxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybU1lZXRpbmdzKG1lZXRpbmdzKTtcbiAgfVxuXG5cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCB0byBnZXQgY29uc2lzdGVudCBtZWV0aW5nIGluY2x1ZGUgb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRNZWV0aW5nSW5jbHVkZU9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNsaWVudDoge1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCB0byB0cmFuc2Zvcm0gbWVldGluZ3MgZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5nczogYW55W10pIHtcbiAgICByZXR1cm4gbWVldGluZ3MubWFwKG1lZXRpbmcgPT4gKHtcbiAgICAgIGlkOiBtZWV0aW5nLmlkLFxuICAgICAgdGl0bGU6IG1lZXRpbmcudGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbjogbWVldGluZy5kZXNjcmlwdGlvbixcbiAgICAgIHN0YXR1czogbWVldGluZy5zdGF0dXMsXG4gICAgICBzdGFydFRpbWU6IG1lZXRpbmcuc3RhcnRUaW1lLFxuICAgICAgZW5kVGltZTogbWVldGluZy5lbmRUaW1lLFxuICAgICAgZHVyYXRpb246IG1lZXRpbmcuZHVyYXRpb24sXG4gICAgICBtZWV0aW5nVHlwZTogbWVldGluZy5tZWV0aW5nVHlwZSxcbiAgICAgIG1lZXRpbmdVcmw6IG1lZXRpbmcubWVldGluZ1VybCxcbiAgICAgIGNsaWVudDogbWVldGluZy5jbGllbnQsXG4gICAgICB0aGVyYXBpc3Q6IG1lZXRpbmcudGhlcmFwaXN0LFxuICAgICAgY3JlYXRlZEF0OiBtZWV0aW5nLmNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogbWVldGluZy51cGRhdGVkQXQsXG4gICAgfSkpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=