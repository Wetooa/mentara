eab52d5bae303de3e4b824daacedd46f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModerationAccess = exports.AssessmentAccess = exports.TherapySessionAccess = exports.TherapistOrResourceOwner = exports.AdminOrResourceOwner = exports.AllowResourceOwner = exports.RESOURCE_OWNER_KEY = exports.RequirePermissions = exports.PERMISSIONS_KEY = exports.TherapistOrAdmin = exports.ModeratorOrAdmin = exports.ClientOnly = exports.TherapistOnly = exports.ModeratorOnly = exports.AdminOnly = exports.Roles = exports.ROLES_KEY = void 0;
const common_1 = require("@nestjs/common");
// Role-based decorators
exports.ROLES_KEY = 'roles';
const Roles = (...roles) => (0, common_1.SetMetadata)(exports.ROLES_KEY, roles);
exports.Roles = Roles;
// Specific role decorators for convenience
const AdminOnly = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['admin']);
exports.AdminOnly = AdminOnly;
const ModeratorOnly = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['moderator']);
exports.ModeratorOnly = ModeratorOnly;
const TherapistOnly = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['therapist']);
exports.TherapistOnly = TherapistOnly;
const ClientOnly = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['client']);
exports.ClientOnly = ClientOnly;
// Combined role decorators
const ModeratorOrAdmin = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['moderator', 'admin']);
exports.ModeratorOrAdmin = ModeratorOrAdmin;
const TherapistOrAdmin = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['therapist', 'admin']);
exports.TherapistOrAdmin = TherapistOrAdmin;
// Permission-based decorators
exports.PERMISSIONS_KEY = 'permissions';
const RequirePermissions = (...permissions) => (0, common_1.SetMetadata)(exports.PERMISSIONS_KEY, permissions);
exports.RequirePermissions = RequirePermissions;
// Resource ownership decorator
exports.RESOURCE_OWNER_KEY = 'resource_owner';
const AllowResourceOwner = (paramName = 'id') => (0, common_1.SetMetadata)(exports.RESOURCE_OWNER_KEY, paramName);
exports.AllowResourceOwner = AllowResourceOwner;
// Combined decorators for common scenarios
const AdminOrResourceOwner = (paramName = 'id') => (target, propertyKey, descriptor) => {
    (0, common_1.SetMetadata)(exports.ROLES_KEY, ['admin'])(target, propertyKey, descriptor);
    (0, common_1.SetMetadata)(exports.RESOURCE_OWNER_KEY, paramName)(target, propertyKey, descriptor);
};
exports.AdminOrResourceOwner = AdminOrResourceOwner;
const TherapistOrResourceOwner = (paramName = 'id') => (target, propertyKey, descriptor) => {
    (0, common_1.SetMetadata)(exports.ROLES_KEY, ['therapist', 'admin'])(target, propertyKey, descriptor);
    (0, common_1.SetMetadata)(exports.RESOURCE_OWNER_KEY, paramName)(target, propertyKey, descriptor);
};
exports.TherapistOrResourceOwner = TherapistOrResourceOwner;
// Therapy session access (therapist assigned to client or admin)
const TherapySessionAccess = () => (0, exports.RequirePermissions)('sessions:read:own', 'sessions:read:all');
exports.TherapySessionAccess = TherapySessionAccess;
// Assessment access (client's own assessments, assigned therapist, or admin)
const AssessmentAccess = () => (0, exports.RequirePermissions)('assessments:read:own', 'assessments:read:assigned', 'assessments:read:all');
exports.AssessmentAccess = AssessmentAccess;
// Moderation access (moderators and admins)
const ModerationAccess = () => (0, exports.RequirePermissions)('posts:moderate', 'communities:moderate', 'messages:moderate');
exports.ModerationAccess = ModerationAccess;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvZGVjb3JhdG9ycy9yb2xlcy5kZWNvcmF0b3IudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQTZDO0FBRTdDLHdCQUF3QjtBQUNYLFFBQUEsU0FBUyxHQUFHLE9BQU8sQ0FBQztBQUMxQixNQUFNLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBZSxFQUFFLEVBQUUsQ0FBQyxJQUFBLG9CQUFXLEVBQUMsaUJBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUE5RCxRQUFBLEtBQUssU0FBeUQ7QUFFM0UsMkNBQTJDO0FBQ3BDLE1BQU0sU0FBUyxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUEsb0JBQVcsRUFBQyxpQkFBUyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUFwRCxRQUFBLFNBQVMsYUFBMkM7QUFDMUQsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO0FBQTVELFFBQUEsYUFBYSxpQkFBK0M7QUFDbEUsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO0FBQTVELFFBQUEsYUFBYSxpQkFBK0M7QUFDbEUsTUFBTSxVQUFVLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQXRELFFBQUEsVUFBVSxjQUE0QztBQUVuRSwyQkFBMkI7QUFDcEIsTUFBTSxnQkFBZ0IsR0FBRyxHQUFHLEVBQUUsQ0FDbkMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQURwQyxRQUFBLGdCQUFnQixvQkFDb0I7QUFDMUMsTUFBTSxnQkFBZ0IsR0FBRyxHQUFHLEVBQUUsQ0FDbkMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQURwQyxRQUFBLGdCQUFnQixvQkFDb0I7QUFFakQsOEJBQThCO0FBQ2pCLFFBQUEsZUFBZSxHQUFHLGFBQWEsQ0FBQztBQUN0QyxNQUFNLGtCQUFrQixHQUFHLENBQUMsR0FBRyxXQUFxQixFQUFFLEVBQUUsQ0FDN0QsSUFBQSxvQkFBVyxFQUFDLHVCQUFlLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFEL0IsUUFBQSxrQkFBa0Isc0JBQ2E7QUFFNUMsK0JBQStCO0FBQ2xCLFFBQUEsa0JBQWtCLEdBQUcsZ0JBQWdCLENBQUM7QUFDNUMsTUFBTSxrQkFBa0IsR0FBRyxDQUFDLFlBQW9CLElBQUksRUFBRSxFQUFFLENBQzdELElBQUEsb0JBQVcsRUFBQywwQkFBa0IsRUFBRSxTQUFTLENBQUMsQ0FBQztBQURoQyxRQUFBLGtCQUFrQixzQkFDYztBQUU3QywyQ0FBMkM7QUFDcEMsTUFBTSxvQkFBb0IsR0FDL0IsQ0FBQyxZQUFvQixJQUFJLEVBQUUsRUFBRSxDQUM3QixDQUFDLE1BQVcsRUFBRSxXQUFtQixFQUFFLFVBQThCLEVBQUUsRUFBRTtJQUNuRSxJQUFBLG9CQUFXLEVBQUMsaUJBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNuRSxJQUFBLG9CQUFXLEVBQUMsMEJBQWtCLEVBQUUsU0FBUyxDQUFDLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUM5RSxDQUFDLENBQUM7QUFMUyxRQUFBLG9CQUFvQix3QkFLN0I7QUFFRyxNQUFNLHdCQUF3QixHQUNuQyxDQUFDLFlBQW9CLElBQUksRUFBRSxFQUFFLENBQzdCLENBQUMsTUFBVyxFQUFFLFdBQW1CLEVBQUUsVUFBOEIsRUFBRSxFQUFFO0lBQ25FLElBQUEsb0JBQVcsRUFBQyxpQkFBUyxFQUFFLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQzVDLE1BQU0sRUFDTixXQUFXLEVBQ1gsVUFBVSxDQUNYLENBQUM7SUFDRixJQUFBLG9CQUFXLEVBQUMsMEJBQWtCLEVBQUUsU0FBUyxDQUFDLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUM5RSxDQUFDLENBQUM7QUFUUyxRQUFBLHdCQUF3Qiw0QkFTakM7QUFFSixpRUFBaUU7QUFDMUQsTUFBTSxvQkFBb0IsR0FBRyxHQUFHLEVBQUUsQ0FDdkMsSUFBQSwwQkFBa0IsRUFBQyxtQkFBbUIsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0FBRGxELFFBQUEsb0JBQW9CLHdCQUM4QjtBQUUvRCw2RUFBNkU7QUFDdEUsTUFBTSxnQkFBZ0IsR0FBRyxHQUFHLEVBQUUsQ0FDbkMsSUFBQSwwQkFBa0IsRUFDaEIsc0JBQXNCLEVBQ3RCLDJCQUEyQixFQUMzQixzQkFBc0IsQ0FDdkIsQ0FBQztBQUxTLFFBQUEsZ0JBQWdCLG9CQUt6QjtBQUVKLDRDQUE0QztBQUNyQyxNQUFNLGdCQUFnQixHQUFHLEdBQUcsRUFBRSxDQUNuQyxJQUFBLDBCQUFrQixFQUNoQixnQkFBZ0IsRUFDaEIsc0JBQXNCLEVBQ3RCLG1CQUFtQixDQUNwQixDQUFDO0FBTFMsUUFBQSxnQkFBZ0Isb0JBS3pCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9hdXRoL2RlY29yYXRvcnMvcm9sZXMuZGVjb3JhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNldE1ldGFkYXRhIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuXG4vLyBSb2xlLWJhc2VkIGRlY29yYXRvcnNcbmV4cG9ydCBjb25zdCBST0xFU19LRVkgPSAncm9sZXMnO1xuZXhwb3J0IGNvbnN0IFJvbGVzID0gKC4uLnJvbGVzOiBzdHJpbmdbXSkgPT4gU2V0TWV0YWRhdGEoUk9MRVNfS0VZLCByb2xlcyk7XG5cbi8vIFNwZWNpZmljIHJvbGUgZGVjb3JhdG9ycyBmb3IgY29udmVuaWVuY2VcbmV4cG9ydCBjb25zdCBBZG1pbk9ubHkgPSAoKSA9PiBTZXRNZXRhZGF0YShST0xFU19LRVksIFsnYWRtaW4nXSk7XG5leHBvcnQgY29uc3QgTW9kZXJhdG9yT25seSA9ICgpID0+IFNldE1ldGFkYXRhKFJPTEVTX0tFWSwgWydtb2RlcmF0b3InXSk7XG5leHBvcnQgY29uc3QgVGhlcmFwaXN0T25seSA9ICgpID0+IFNldE1ldGFkYXRhKFJPTEVTX0tFWSwgWyd0aGVyYXBpc3QnXSk7XG5leHBvcnQgY29uc3QgQ2xpZW50T25seSA9ICgpID0+IFNldE1ldGFkYXRhKFJPTEVTX0tFWSwgWydjbGllbnQnXSk7XG5cbi8vIENvbWJpbmVkIHJvbGUgZGVjb3JhdG9yc1xuZXhwb3J0IGNvbnN0IE1vZGVyYXRvck9yQWRtaW4gPSAoKSA9PlxuICBTZXRNZXRhZGF0YShST0xFU19LRVksIFsnbW9kZXJhdG9yJywgJ2FkbWluJ10pO1xuZXhwb3J0IGNvbnN0IFRoZXJhcGlzdE9yQWRtaW4gPSAoKSA9PlxuICBTZXRNZXRhZGF0YShST0xFU19LRVksIFsndGhlcmFwaXN0JywgJ2FkbWluJ10pO1xuXG4vLyBQZXJtaXNzaW9uLWJhc2VkIGRlY29yYXRvcnNcbmV4cG9ydCBjb25zdCBQRVJNSVNTSU9OU19LRVkgPSAncGVybWlzc2lvbnMnO1xuZXhwb3J0IGNvbnN0IFJlcXVpcmVQZXJtaXNzaW9ucyA9ICguLi5wZXJtaXNzaW9uczogc3RyaW5nW10pID0+XG4gIFNldE1ldGFkYXRhKFBFUk1JU1NJT05TX0tFWSwgcGVybWlzc2lvbnMpO1xuXG4vLyBSZXNvdXJjZSBvd25lcnNoaXAgZGVjb3JhdG9yXG5leHBvcnQgY29uc3QgUkVTT1VSQ0VfT1dORVJfS0VZID0gJ3Jlc291cmNlX293bmVyJztcbmV4cG9ydCBjb25zdCBBbGxvd1Jlc291cmNlT3duZXIgPSAocGFyYW1OYW1lOiBzdHJpbmcgPSAnaWQnKSA9PlxuICBTZXRNZXRhZGF0YShSRVNPVVJDRV9PV05FUl9LRVksIHBhcmFtTmFtZSk7XG5cbi8vIENvbWJpbmVkIGRlY29yYXRvcnMgZm9yIGNvbW1vbiBzY2VuYXJpb3NcbmV4cG9ydCBjb25zdCBBZG1pbk9yUmVzb3VyY2VPd25lciA9XG4gIChwYXJhbU5hbWU6IHN0cmluZyA9ICdpZCcpID0+XG4gICh0YXJnZXQ6IGFueSwgcHJvcGVydHlLZXk6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSA9PiB7XG4gICAgU2V0TWV0YWRhdGEoUk9MRVNfS0VZLCBbJ2FkbWluJ10pKHRhcmdldCwgcHJvcGVydHlLZXksIGRlc2NyaXB0b3IpO1xuICAgIFNldE1ldGFkYXRhKFJFU09VUkNFX09XTkVSX0tFWSwgcGFyYW1OYW1lKSh0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKTtcbiAgfTtcblxuZXhwb3J0IGNvbnN0IFRoZXJhcGlzdE9yUmVzb3VyY2VPd25lciA9XG4gIChwYXJhbU5hbWU6IHN0cmluZyA9ICdpZCcpID0+XG4gICh0YXJnZXQ6IGFueSwgcHJvcGVydHlLZXk6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSA9PiB7XG4gICAgU2V0TWV0YWRhdGEoUk9MRVNfS0VZLCBbJ3RoZXJhcGlzdCcsICdhZG1pbiddKShcbiAgICAgIHRhcmdldCxcbiAgICAgIHByb3BlcnR5S2V5LFxuICAgICAgZGVzY3JpcHRvcixcbiAgICApO1xuICAgIFNldE1ldGFkYXRhKFJFU09VUkNFX09XTkVSX0tFWSwgcGFyYW1OYW1lKSh0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKTtcbiAgfTtcblxuLy8gVGhlcmFweSBzZXNzaW9uIGFjY2VzcyAodGhlcmFwaXN0IGFzc2lnbmVkIHRvIGNsaWVudCBvciBhZG1pbilcbmV4cG9ydCBjb25zdCBUaGVyYXB5U2Vzc2lvbkFjY2VzcyA9ICgpID0+XG4gIFJlcXVpcmVQZXJtaXNzaW9ucygnc2Vzc2lvbnM6cmVhZDpvd24nLCAnc2Vzc2lvbnM6cmVhZDphbGwnKTtcblxuLy8gQXNzZXNzbWVudCBhY2Nlc3MgKGNsaWVudCdzIG93biBhc3Nlc3NtZW50cywgYXNzaWduZWQgdGhlcmFwaXN0LCBvciBhZG1pbilcbmV4cG9ydCBjb25zdCBBc3Nlc3NtZW50QWNjZXNzID0gKCkgPT5cbiAgUmVxdWlyZVBlcm1pc3Npb25zKFxuICAgICdhc3Nlc3NtZW50czpyZWFkOm93bicsXG4gICAgJ2Fzc2Vzc21lbnRzOnJlYWQ6YXNzaWduZWQnLFxuICAgICdhc3Nlc3NtZW50czpyZWFkOmFsbCcsXG4gICk7XG5cbi8vIE1vZGVyYXRpb24gYWNjZXNzIChtb2RlcmF0b3JzIGFuZCBhZG1pbnMpXG5leHBvcnQgY29uc3QgTW9kZXJhdGlvbkFjY2VzcyA9ICgpID0+XG4gIFJlcXVpcmVQZXJtaXNzaW9ucyhcbiAgICAncG9zdHM6bW9kZXJhdGUnLFxuICAgICdjb21tdW5pdGllczptb2RlcmF0ZScsXG4gICAgJ21lc3NhZ2VzOm1vZGVyYXRlJyxcbiAgKTtcbiJdLCJ2ZXJzaW9uIjozfQ==