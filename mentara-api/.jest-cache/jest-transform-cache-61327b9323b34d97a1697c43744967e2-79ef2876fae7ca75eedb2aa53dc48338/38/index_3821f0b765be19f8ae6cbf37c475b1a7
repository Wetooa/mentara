c5d171eba8ef3dbc6773206b31f3c268
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.waitForCondition = exports.expectToThrowAsync = exports.delay = exports.TEST_EMAILS = exports.TEST_USER_IDS = exports.createMockClerkClient = exports.createMockAuthGuard = exports.createMockEventBus = exports.createMockPrismaService = exports.TestDataFactory = exports.DatabaseTestSetup = void 0;
var database_test_setup_1 = require("./database-test.setup");
Object.defineProperty(exports, "DatabaseTestSetup", { enumerable: true, get: function () { return database_test_setup_1.DatabaseTestSetup; } });
var test_data_factory_1 = require("./test-data.factory");
Object.defineProperty(exports, "TestDataFactory", { enumerable: true, get: function () { return test_data_factory_1.TestDataFactory; } });
// Mock utilities
const createMockPrismaModel = () => ({
    findUnique: jest.fn().mockResolvedValue(null),
    findMany: jest.fn().mockResolvedValue([]),
    create: jest.fn().mockResolvedValue({}),
    update: jest.fn().mockResolvedValue({}),
    updateMany: jest.fn().mockResolvedValue({ count: 0 }),
    delete: jest.fn().mockResolvedValue({}),
    deleteMany: jest.fn().mockResolvedValue({ count: 0 }),
    findFirst: jest.fn().mockResolvedValue(null),
    count: jest.fn().mockResolvedValue(0),
    groupBy: jest.fn().mockResolvedValue([]),
    aggregate: jest
        .fn()
        .mockResolvedValue({ _sum: {}, _avg: {}, _count: {}, _max: {}, _min: {} }),
    upsert: jest.fn().mockResolvedValue({}),
    createMany: jest.fn().mockResolvedValue({ count: 0 }),
});
const createMockPrismaService = () => ({
    user: createMockPrismaModel(),
    client: createMockPrismaModel(),
    therapist: createMockPrismaModel(),
    community: createMockPrismaModel(),
    post: createMockPrismaModel(),
    comment: createMockPrismaModel(),
    reply: createMockPrismaModel(),
    commentHeart: createMockPrismaModel(),
    replyHeart: createMockPrismaModel(),
    fileAttachment: createMockPrismaModel(),
    meeting: createMockPrismaModel(),
    preAssessment: createMockPrismaModel(),
    membership: createMockPrismaModel(),
    clientTherapist: createMockPrismaModel(),
    therapistAvailability: createMockPrismaModel(),
    // Audit and System models
    auditLog: createMockPrismaModel(),
    systemEvent: createMockPrismaModel(),
    dataChangeLog: createMockPrismaModel(),
    // Billing models
    subscription: createMockPrismaModel(),
    subscriptionPlan: createMockPrismaModel(),
    paymentMethod: createMockPrismaModel(),
    payment: createMockPrismaModel(),
    invoice: createMockPrismaModel(),
    discount: createMockPrismaModel(),
    discountRedemption: createMockPrismaModel(),
    usageRecord: createMockPrismaModel(),
    // Messaging models
    conversation: createMockPrismaModel(),
    conversationParticipant: createMockPrismaModel(),
    message: createMockPrismaModel(),
    messageReadReceipt: createMockPrismaModel(),
    messageReaction: createMockPrismaModel(),
    userBlock: createMockPrismaModel(),
    // Additional models that might be needed
    worksheetType: createMockPrismaModel(),
    worksheet: createMockPrismaModel(),
    worksheetSubmission: createMockPrismaModel(),
    session: createMockPrismaModel(),
    review: createMockPrismaModel(),
    notification: createMockPrismaModel(),
    file: createMockPrismaModel(),
    admin: createMockPrismaModel(),
    moderator: createMockPrismaModel(),
    $disconnect: jest.fn(),
    $connect: jest.fn(),
    $executeRawUnsafe: jest.fn(),
    $transaction: jest.fn(),
});
exports.createMockPrismaService = createMockPrismaService;
// Event Bus Mocks
const createMockEventBus = () => ({
    emit: jest.fn(),
    subscribe: jest.fn(),
    unsubscribe: jest.fn(),
    subscribeToAggregate: jest.fn(),
    subscribeToAll: jest.fn(),
    getEventStats: jest.fn(),
    hasListeners: jest.fn(),
    removeAllListeners: jest.fn(),
});
exports.createMockEventBus = createMockEventBus;
// Auth Mocks
const createMockAuthGuard = () => ({
    canActivate: jest.fn().mockReturnValue(true),
});
exports.createMockAuthGuard = createMockAuthGuard;
const createMockClerkClient = () => ({
    users: {
        getUser: jest.fn(),
        updateUser: jest.fn(),
        deleteUser: jest.fn(),
    },
});
exports.createMockClerkClient = createMockClerkClient;
// Common test constants
exports.TEST_USER_IDS = {
    CLIENT: 'test-client-123',
    THERAPIST: 'test-therapist-456',
    ADMIN: 'test-admin-789',
    MODERATOR: 'test-moderator-101',
};
exports.TEST_EMAILS = {
    CLIENT: 'test-client@example.com',
    THERAPIST: 'test-therapist@example.com',
    ADMIN: 'test-admin@example.com',
    MODERATOR: 'test-moderator@example.com',
};
// Helper functions for tests
const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
exports.delay = delay;
const expectToThrowAsync = async (asyncFn, expectedError) => {
    let error = null;
    try {
        await asyncFn();
    }
    catch (e) {
        error = e;
    }
    expect(error).toBeInstanceOf(expectedError);
};
exports.expectToThrowAsync = expectToThrowAsync;
const waitForCondition = async (condition, timeoutMs = 5000, intervalMs = 100) => {
    const startTime = Date.now();
    while (!condition()) {
        if (Date.now() - startTime > timeoutMs) {
            throw new Error(`Condition not met within ${timeoutMs}ms`);
        }
        await (0, exports.delay)(intervalMs);
    }
};
exports.waitForCondition = waitForCondition;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkRBQTBEO0FBQWpELHdIQUFBLGlCQUFpQixPQUFBO0FBQzFCLHlEQUFzRDtBQUE3QyxvSEFBQSxlQUFlLE9BQUE7QUFFeEIsaUJBQWlCO0FBQ2pCLE1BQU0scUJBQXFCLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztJQUM3QyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQztJQUN6QyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQztJQUN2QyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQztJQUN2QyxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDO0lBQ3JELE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDO0lBQ3ZDLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUM7SUFDckQsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7SUFDNUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7SUFDckMsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENB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QUEsZ0JBQWdCLG9CQVkzQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdGVzdC11dGlscy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgeyBEYXRhYmFzZVRlc3RTZXR1cCB9IGZyb20gJy4vZGF0YWJhc2UtdGVzdC5zZXR1cCc7XG5leHBvcnQgeyBUZXN0RGF0YUZhY3RvcnkgfSBmcm9tICcuL3Rlc3QtZGF0YS5mYWN0b3J5JztcblxuLy8gTW9jayB1dGlsaXRpZXNcbmNvbnN0IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCA9ICgpID0+ICh7XG4gIGZpbmRVbmlxdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSxcbiAgZmluZE1hbnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KSxcbiAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxuICB1cGRhdGVNYW55OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBjb3VudDogMCB9KSxcbiAgZGVsZXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxuICBkZWxldGVNYW55OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBjb3VudDogMCB9KSxcbiAgZmluZEZpcnN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCksXG4gIGNvdW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoMCksXG4gIGdyb3VwQnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gIGFnZ3JlZ2F0ZTogamVzdFxuICAgIC5mbigpXG4gICAgLm1vY2tSZXNvbHZlZFZhbHVlKHsgX3N1bToge30sIF9hdmc6IHt9LCBfY291bnQ6IHt9LCBfbWF4OiB7fSwgX21pbjoge30gfSksXG4gIHVwc2VydDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KSxcbiAgY3JlYXRlTWFueTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgY291bnQ6IDAgfSksXG59KTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlID0gKCkgPT4gKHtcbiAgdXNlcjogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIGNsaWVudDogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIHRoZXJhcGlzdDogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIGNvbW11bml0eTogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIHBvc3Q6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBjb21tZW50OiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgcmVwbHk6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBjb21tZW50SGVhcnQ6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICByZXBseUhlYXJ0OiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgZmlsZUF0dGFjaG1lbnQ6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBtZWV0aW5nOiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgcHJlQXNzZXNzbWVudDogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIG1lbWJlcnNoaXA6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBjbGllbnRUaGVyYXBpc3Q6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICB0aGVyYXBpc3RBdmFpbGFiaWxpdHk6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICAvLyBBdWRpdCBhbmQgU3lzdGVtIG1vZGVsc1xuICBhdWRpdExvZzogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIHN5c3RlbUV2ZW50OiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgZGF0YUNoYW5nZUxvZzogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIC8vIEJpbGxpbmcgbW9kZWxzXG4gIHN1YnNjcmlwdGlvbjogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIHN1YnNjcmlwdGlvblBsYW46IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBwYXltZW50TWV0aG9kOiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgcGF5bWVudDogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIGludm9pY2U6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBkaXNjb3VudDogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIGRpc2NvdW50UmVkZW1wdGlvbjogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIHVzYWdlUmVjb3JkOiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgLy8gTWVzc2FnaW5nIG1vZGVsc1xuICBjb252ZXJzYXRpb246IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBjb252ZXJzYXRpb25QYXJ0aWNpcGFudDogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIG1lc3NhZ2U6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBtZXNzYWdlUmVhZFJlY2VpcHQ6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBtZXNzYWdlUmVhY3Rpb246IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICB1c2VyQmxvY2s6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICAvLyBBZGRpdGlvbmFsIG1vZGVscyB0aGF0IG1pZ2h0IGJlIG5lZWRlZFxuICB3b3Jrc2hlZXRUeXBlOiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgd29ya3NoZWV0OiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgd29ya3NoZWV0U3VibWlzc2lvbjogY3JlYXRlTW9ja1ByaXNtYU1vZGVsKCksXG4gIHNlc3Npb246IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICByZXZpZXc6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBub3RpZmljYXRpb246IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBmaWxlOiBjcmVhdGVNb2NrUHJpc21hTW9kZWwoKSxcbiAgYWRtaW46IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICBtb2RlcmF0b3I6IGNyZWF0ZU1vY2tQcmlzbWFNb2RlbCgpLFxuICAkZGlzY29ubmVjdDogamVzdC5mbigpLFxuICAkY29ubmVjdDogamVzdC5mbigpLFxuICAkZXhlY3V0ZVJhd1Vuc2FmZTogamVzdC5mbigpLFxuICAkdHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbn0pO1xuXG4vLyBFdmVudCBCdXMgTW9ja3NcbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrRXZlbnRCdXMgPSAoKSA9PiAoe1xuICBlbWl0OiBqZXN0LmZuKCksXG4gIHN1YnNjcmliZTogamVzdC5mbigpLFxuICB1bnN1YnNjcmliZTogamVzdC5mbigpLFxuICBzdWJzY3JpYmVUb0FnZ3JlZ2F0ZTogamVzdC5mbigpLFxuICBzdWJzY3JpYmVUb0FsbDogamVzdC5mbigpLFxuICBnZXRFdmVudFN0YXRzOiBqZXN0LmZuKCksXG4gIGhhc0xpc3RlbmVyczogamVzdC5mbigpLFxuICByZW1vdmVBbGxMaXN0ZW5lcnM6IGplc3QuZm4oKSxcbn0pO1xuXG4vLyBBdXRoIE1vY2tzXG5leHBvcnQgY29uc3QgY3JlYXRlTW9ja0F1dGhHdWFyZCA9ICgpID0+ICh7XG4gIGNhbkFjdGl2YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrQ2xlcmtDbGllbnQgPSAoKSA9PiAoe1xuICB1c2Vyczoge1xuICAgIGdldFVzZXI6IGplc3QuZm4oKSxcbiAgICB1cGRhdGVVc2VyOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlVXNlcjogamVzdC5mbigpLFxuICB9LFxufSk7XG5cbi8vIENvbW1vbiB0ZXN0IGNvbnN0YW50c1xuZXhwb3J0IGNvbnN0IFRFU1RfVVNFUl9JRFMgPSB7XG4gIENMSUVOVDogJ3Rlc3QtY2xpZW50LTEyMycsXG4gIFRIRVJBUElTVDogJ3Rlc3QtdGhlcmFwaXN0LTQ1NicsXG4gIEFETUlOOiAndGVzdC1hZG1pbi03ODknLFxuICBNT0RFUkFUT1I6ICd0ZXN0LW1vZGVyYXRvci0xMDEnLFxufTtcblxuZXhwb3J0IGNvbnN0IFRFU1RfRU1BSUxTID0ge1xuICBDTElFTlQ6ICd0ZXN0LWNsaWVudEBleGFtcGxlLmNvbScsXG4gIFRIRVJBUElTVDogJ3Rlc3QtdGhlcmFwaXN0QGV4YW1wbGUuY29tJyxcbiAgQURNSU46ICd0ZXN0LWFkbWluQGV4YW1wbGUuY29tJyxcbiAgTU9ERVJBVE9SOiAndGVzdC1tb2RlcmF0b3JAZXhhbXBsZS5jb20nLFxufTtcblxuLy8gSGVscGVyIGZ1bmN0aW9ucyBmb3IgdGVzdHNcbmV4cG9ydCBjb25zdCBkZWxheSA9IChtczogbnVtYmVyKSA9PlxuICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuXG5leHBvcnQgY29uc3QgZXhwZWN0VG9UaHJvd0FzeW5jID0gYXN5bmMgKFxuICBhc3luY0ZuOiAoKSA9PiBQcm9taXNlPGFueT4sXG4gIGV4cGVjdGVkRXJyb3I6IGFueSxcbikgPT4ge1xuICBsZXQgZXJyb3I6IGFueSA9IG51bGw7XG4gIHRyeSB7XG4gICAgYXdhaXQgYXN5bmNGbigpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgZXJyb3IgPSBlO1xuICB9XG4gIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoZXhwZWN0ZWRFcnJvcik7XG59O1xuXG5leHBvcnQgY29uc3Qgd2FpdEZvckNvbmRpdGlvbiA9IGFzeW5jIChcbiAgY29uZGl0aW9uOiAoKSA9PiBib29sZWFuLFxuICB0aW1lb3V0TXM6IG51bWJlciA9IDUwMDAsXG4gIGludGVydmFsTXM6IG51bWJlciA9IDEwMCxcbik6IFByb21pc2U8dm9pZD4gPT4ge1xuICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICB3aGlsZSAoIWNvbmRpdGlvbigpKSB7XG4gICAgaWYgKERhdGUubm93KCkgLSBzdGFydFRpbWUgPiB0aW1lb3V0TXMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ29uZGl0aW9uIG5vdCBtZXQgd2l0aGluICR7dGltZW91dE1zfW1zYCk7XG4gICAgfVxuICAgIGF3YWl0IGRlbGF5KGludGVydmFsTXMpO1xuICB9XG59O1xuIl0sInZlcnNpb24iOjN9