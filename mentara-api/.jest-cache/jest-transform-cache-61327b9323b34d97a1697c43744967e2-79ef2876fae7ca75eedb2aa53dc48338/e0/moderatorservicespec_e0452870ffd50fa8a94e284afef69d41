3ae391e8076a8d57d1db8fa28f864164
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const moderator_service_1 = require("./moderator.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
describe('ModeratorService', () => {
    let service;
    let prismaService;
    // Mock data structures
    const mockDate = new Date('2024-01-15T10:00:00Z');
    const mockModerator = {
        id: 'moderator-123',
        userId: 'user-123',
        permissions: ['MODERATE_CONTENT', 'MANAGE_REPORTS'],
        level: 'moderator',
        isActive: true,
        createdAt: mockDate,
        updatedAt: mockDate,
    };
    const mockModeratorList = [
        mockModerator,
        {
            ...mockModerator,
            id: 'moderator-124',
            userId: 'user-124',
            permissions: ['MODERATE_CONTENT'],
            level: 'junior_moderator',
        },
        {
            ...mockModerator,
            id: 'moderator-125',
            userId: 'user-125',
            permissions: ['MODERATE_CONTENT', 'MANAGE_REPORTS', 'ESCALATE_ISSUES'],
            level: 'senior_moderator',
            isActive: false,
        },
    ];
    const mockCreateModeratorData = {
        userId: 'user-126',
        permissions: ['MODERATE_CONTENT'],
        level: 'moderator',
        isActive: true,
    };
    const mockUpdateModeratorData = {
        permissions: ['MODERATE_CONTENT', 'MANAGE_REPORTS', 'ESCALATE_ISSUES'],
        level: 'senior_moderator',
        isActive: true,
    };
    beforeEach(async () => {
        const mockPrismaService = {
            moderator: {
                findMany: jest.fn(),
                findUnique: jest.fn(),
                create: jest.fn(),
                update: jest.fn(),
                delete: jest.fn(),
            },
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                moderator_service_1.ModeratorService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrismaService,
                },
            ],
        }).compile();
        service = module.get(moderator_service_1.ModeratorService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        // Mock Date constructor for consistent testing
        jest.useFakeTimers();
        jest.setSystemTime(mockDate);
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.useRealTimers();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('findAll', () => {
        beforeEach(() => {
            prismaService.moderator.findMany.mockResolvedValue(mockModeratorList);
        });
        it('should return all moderators', async () => {
            const result = await service.findAll();
            expect(prismaService.moderator.findMany).toHaveBeenCalledWith();
            expect(result).toEqual(mockModeratorList);
            expect(result).toHaveLength(3);
        });
        it('should return empty array when no moderators exist', async () => {
            prismaService.moderator.findMany.mockResolvedValue([]);
            const result = await service.findAll();
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle database errors', async () => {
            const databaseError = new Error('Database connection failed');
            prismaService.moderator.findMany.mockRejectedValue(databaseError);
            await expect(service.findAll()).rejects.toThrow('Database connection failed');
        });
        it('should handle large number of moderators efficiently', async () => {
            const largeModeratorsArray = Array.from({ length: 1000 }, (_, i) => ({
                ...mockModerator,
                id: `moderator-${i}`,
                userId: `user-${i}`,
            }));
            prismaService.moderator.findMany.mockResolvedValue(largeModeratorsArray);
            const startTime = Date.now();
            const result = await service.findAll();
            const endTime = Date.now();
            expect(result).toHaveLength(1000);
            expect(endTime - startTime).toBeLessThan(100); // Should be fast
        });
        it('should handle null and undefined values in moderator data', async () => {
            const moderatorsWithNulls = [
                {
                    ...mockModerator,
                    permissions: null,
                    level: undefined,
                },
            ];
            prismaService.moderator.findMany.mockResolvedValue(moderatorsWithNulls);
            const result = await service.findAll();
            expect(result).toEqual(moderatorsWithNulls);
        });
        it('should maintain data structure integrity', async () => {
            const result = await service.findAll();
            result.forEach(moderator => {
                expect(moderator).toHaveProperty('id');
                expect(moderator).toHaveProperty('userId');
                expect(moderator).toHaveProperty('permissions');
                expect(moderator).toHaveProperty('level');
                expect(moderator).toHaveProperty('isActive');
                expect(moderator).toHaveProperty('createdAt');
                expect(moderator).toHaveProperty('updatedAt');
            });
        });
        it('should handle concurrent findAll requests', async () => {
            const promises = Array.from({ length: 10 }, () => service.findAll());
            const results = await Promise.all(promises);
            expect(results).toHaveLength(10);
            results.forEach(result => {
                expect(result).toEqual(mockModeratorList);
            });
            expect(prismaService.moderator.findMany).toHaveBeenCalledTimes(10);
        });
    });
    describe('findOne', () => {
        beforeEach(() => {
            prismaService.moderator.findUnique.mockResolvedValue(mockModerator);
        });
        it('should return moderator by userId', async () => {
            const result = await service.findOne('user-123');
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
            });
            expect(result).toEqual(mockModerator);
        });
        it('should return null for non-existent moderator', async () => {
            prismaService.moderator.findUnique.mockResolvedValue(null);
            const result = await service.findOne('non-existent-user');
            expect(result).toBeNull();
        });
        it('should handle database errors', async () => {
            const databaseError = new Error('Database connection failed');
            prismaService.moderator.findUnique.mockRejectedValue(databaseError);
            await expect(service.findOne('user-123')).rejects.toThrow('Database connection failed');
        });
        it('should handle empty string userId', async () => {
            await service.findOne('');
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: '' },
            });
        });
        it('should handle null and undefined userId', async () => {
            await service.findOne(null);
            await service.findOne(undefined);
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: null },
            });
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: undefined },
            });
        });
        it('should handle special characters in userId', async () => {
            const specialUserId = 'user-123@domain.com#$%';
            await service.findOne(specialUserId);
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: specialUserId },
            });
        });
        it('should handle Unicode characters in userId', async () => {
            const unicodeUserId = 'user-æµ‹è¯•-ðŸ”’-âˆ†âˆ‘Â©';
            await service.findOne(unicodeUserId);
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: unicodeUserId },
            });
        });
        it('should handle very long userId strings', async () => {
            const longUserId = 'user-' + 'a'.repeat(1000);
            await service.findOne(longUserId);
            expect(prismaService.moderator.findUnique).toHaveBeenCalledWith({
                where: { userId: longUserId },
            });
        });
        it('should handle concurrent findOne requests for same user', async () => {
            const promises = Array.from({ length: 5 }, () => service.findOne('user-123'));
            const results = await Promise.all(promises);
            results.forEach(result => {
                expect(result).toEqual(mockModerator);
            });
            expect(prismaService.moderator.findUnique).toHaveBeenCalledTimes(5);
        });
        it('should handle concurrent findOne requests for different users', async () => {
            prismaService.moderator.findUnique
                .mockResolvedValueOnce(mockModerator)
                .mockResolvedValueOnce({ ...mockModerator, userId: 'user-124' })
                .mockResolvedValueOnce({ ...mockModerator, userId: 'user-125' });
            const promises = [
                service.findOne('user-123'),
                service.findOne('user-124'),
                service.findOne('user-125'),
            ];
            const results = await Promise.all(promises);
            expect(results[0].userId).toBe('user-123');
            expect(results[1].userId).toBe('user-124');
            expect(results[2].userId).toBe('user-125');
        });
    });
    describe('create', () => {
        beforeEach(() => {
            prismaService.moderator.create.mockResolvedValue({
                ...mockModerator,
                ...mockCreateModeratorData,
                id: 'moderator-126',
            });
        });
        it('should create moderator successfully', async () => {
            const result = await service.create(mockCreateModeratorData);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: mockCreateModeratorData,
            });
            expect(result).toEqual({
                ...mockModerator,
                ...mockCreateModeratorData,
                id: 'moderator-126',
            });
        });
        it('should handle minimal create data', async () => {
            const minimalData = {
                userId: 'user-minimal',
            };
            await service.create(minimalData);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: minimalData,
            });
        });
        it('should handle complex permissions array', async () => {
            const complexData = {
                userId: 'user-complex',
                permissions: [
                    'MODERATE_CONTENT',
                    'MANAGE_REPORTS',
                    'ESCALATE_ISSUES',
                    'BAN_USERS',
                    'REVIEW_APPEALS',
                    'MODERATE_THERAPY_SESSIONS',
                    'ACCESS_ANALYTICS',
                ],
                level: 'senior_moderator',
                isActive: true,
            };
            await service.create(complexData);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: complexData,
            });
        });
        it('should handle create with null values', async () => {
            const dataWithNulls = {
                userId: 'user-nulls',
                permissions: null,
                level: null,
                isActive: null,
            };
            await service.create(dataWithNulls);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: dataWithNulls,
            });
        });
        it('should handle create with undefined values', async () => {
            const dataWithUndefined = {
                userId: 'user-undefined',
                permissions: undefined,
                level: undefined,
                isActive: undefined,
            };
            await service.create(dataWithUndefined);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: dataWithUndefined,
            });
        });
        it('should handle database constraint violations', async () => {
            const constraintError = new Error('Unique constraint violation');
            constraintError.name = 'P2002';
            prismaService.moderator.create.mockRejectedValue(constraintError);
            await expect(service.create(mockCreateModeratorData)).rejects.toThrow('Unique constraint violation');
        });
        it('should handle foreign key constraint violations', async () => {
            const foreignKeyError = new Error('Foreign key constraint violation');
            foreignKeyError.name = 'P2003';
            prismaService.moderator.create.mockRejectedValue(foreignKeyError);
            await expect(service.create(mockCreateModeratorData)).rejects.toThrow('Foreign key constraint violation');
        });
        it('should handle database timeout errors', async () => {
            const timeoutError = new Error('Connection timeout');
            timeoutError.name = 'TimeoutError';
            prismaService.moderator.create.mockRejectedValue(timeoutError);
            await expect(service.create(mockCreateModeratorData)).rejects.toThrow('Connection timeout');
        });
        it('should handle very large permissions array', async () => {
            const largePermissions = Array.from({ length: 1000 }, (_, i) => `PERMISSION_${i}`);
            const dataWithLargePermissions = {
                userId: 'user-large-permissions',
                permissions: largePermissions,
            };
            await service.create(dataWithLargePermissions);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: dataWithLargePermissions,
            });
        });
        it('should handle concurrent create operations', async () => {
            const createPromises = Array.from({ length: 10 }, (_, i) => {
                const data = {
                    userId: `user-concurrent-${i}`,
                    permissions: ['MODERATE_CONTENT'],
                };
                prismaService.moderator.create.mockResolvedValueOnce({
                    ...mockModerator,
                    id: `moderator-concurrent-${i}`,
                    userId: `user-concurrent-${i}`,
                });
                return service.create(data);
            });
            const results = await Promise.all(createPromises);
            expect(results).toHaveLength(10);
            expect(prismaService.moderator.create).toHaveBeenCalledTimes(10);
        });
    });
    describe('update', () => {
        beforeEach(() => {
            prismaService.moderator.update.mockResolvedValue({
                ...mockModerator,
                ...mockUpdateModeratorData,
            });
        });
        it('should update moderator successfully', async () => {
            const result = await service.update('user-123', mockUpdateModeratorData);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: mockUpdateModeratorData,
            });
            expect(result).toEqual({
                ...mockModerator,
                ...mockUpdateModeratorData,
            });
        });
        it('should handle partial updates', async () => {
            const partialUpdate = {
                isActive: false,
            };
            await service.update('user-123', partialUpdate);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: partialUpdate,
            });
        });
        it('should handle empty update data', async () => {
            const emptyUpdate = {};
            await service.update('user-123', emptyUpdate);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: emptyUpdate,
            });
        });
        it('should handle permission level changes', async () => {
            const levelChange = {
                level: 'senior_moderator',
                permissions: [
                    'MODERATE_CONTENT',
                    'MANAGE_REPORTS',
                    'ESCALATE_ISSUES',
                    'BAN_USERS',
                    'ACCESS_ANALYTICS',
                ],
            };
            await service.update('user-123', levelChange);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: levelChange,
            });
        });
        it('should handle permission removal', async () => {
            const permissionRemoval = {
                permissions: ['MODERATE_CONTENT'], // Reduced permissions
            };
            await service.update('user-123', permissionRemoval);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: permissionRemoval,
            });
        });
        it('should handle moderator deactivation', async () => {
            const deactivation = {
                isActive: false,
            };
            await service.update('user-123', deactivation);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: deactivation,
            });
        });
        it('should handle non-existent moderator updates', async () => {
            const notFoundError = new Error('Record not found');
            notFoundError.name = 'P2025';
            prismaService.moderator.update.mockRejectedValue(notFoundError);
            await expect(service.update('non-existent-user', mockUpdateModeratorData)).rejects.toThrow('Record not found');
        });
        it('should handle null and undefined in update data', async () => {
            const updateWithNulls = {
                permissions: null,
                level: null,
                isActive: null,
            };
            await service.update('user-123', updateWithNulls);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: updateWithNulls,
            });
        });
        it('should handle concurrent updates on same moderator', async () => {
            const update1 = { isActive: false };
            const update2 = { level: 'senior_moderator' };
            prismaService.moderator.update
                .mockResolvedValueOnce({ ...mockModerator, isActive: false })
                .mockRejectedValueOnce(new Error('Record being updated'));
            const promises = [
                service.update('user-123', update1),
                service.update('user-123', update2),
            ];
            const results = await Promise.allSettled(promises);
            expect(results[0].status).toBe('fulfilled');
            expect(results[1].status).toBe('rejected');
        });
        it('should handle complex permission updates', async () => {
            const complexUpdate = {
                permissions: [
                    'MODERATE_CONTENT',
                    'MANAGE_REPORTS',
                    'ESCALATE_ISSUES',
                    'BAN_USERS',
                    'REVIEW_APPEALS',
                    'MODERATE_THERAPY_SESSIONS',
                    'ACCESS_ANALYTICS',
                    'CONFIGURE_MODERATION_RULES',
                    'MANAGE_MODERATOR_ACCOUNTS',
                    'EMERGENCY_INTERVENTIONS',
                ],
                level: 'admin_moderator',
                isActive: true,
            };
            await service.update('user-123', complexUpdate);
            expect(prismaService.moderator.update).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
                data: complexUpdate,
            });
        });
    });
    describe('remove', () => {
        beforeEach(() => {
            prismaService.moderator.delete.mockResolvedValue(mockModerator);
        });
        it('should remove moderator successfully', async () => {
            const result = await service.remove('user-123');
            expect(prismaService.moderator.delete).toHaveBeenCalledWith({
                where: { userId: 'user-123' },
            });
            expect(result).toEqual(mockModerator);
        });
        it('should handle removal of non-existent moderator', async () => {
            const notFoundError = new Error('Record not found');
            notFoundError.name = 'P2025';
            prismaService.moderator.delete.mockRejectedValue(notFoundError);
            await expect(service.remove('non-existent-user')).rejects.toThrow('Record not found');
        });
        it('should handle foreign key constraint violations on delete', async () => {
            const foreignKeyError = new Error('Foreign key constraint violation');
            foreignKeyError.name = 'P2003';
            prismaService.moderator.delete.mockRejectedValue(foreignKeyError);
            await expect(service.remove('user-123')).rejects.toThrow('Foreign key constraint violation');
        });
        it('should handle database connection errors', async () => {
            const connectionError = new Error('Database connection failed');
            prismaService.moderator.delete.mockRejectedValue(connectionError);
            await expect(service.remove('user-123')).rejects.toThrow('Database connection failed');
        });
        it('should handle empty string userId', async () => {
            await service.remove('');
            expect(prismaService.moderator.delete).toHaveBeenCalledWith({
                where: { userId: '' },
            });
        });
        it('should handle null and undefined userId', async () => {
            await service.remove(null);
            await service.remove(undefined);
            expect(prismaService.moderator.delete).toHaveBeenCalledWith({
                where: { userId: null },
            });
            expect(prismaService.moderator.delete).toHaveBeenCalledWith({
                where: { userId: undefined },
            });
        });
        it('should handle concurrent deletion attempts', async () => {
            prismaService.moderator.delete
                .mockResolvedValueOnce(mockModerator)
                .mockRejectedValueOnce(new Error('Record not found'));
            const promises = [
                service.remove('user-123'),
                service.remove('user-123'),
            ];
            const results = await Promise.allSettled(promises);
            expect(results[0].status).toBe('fulfilled');
            expect(results[1].status).toBe('rejected');
        });
        it('should handle bulk deletion operations', async () => {
            const deletePromises = Array.from({ length: 50 }, (_, i) => {
                const userId = `user-bulk-${i}`;
                prismaService.moderator.delete.mockResolvedValueOnce({
                    ...mockModerator,
                    userId,
                });
                return service.remove(userId);
            });
            const results = await Promise.all(deletePromises);
            expect(results).toHaveLength(50);
            expect(prismaService.moderator.delete).toHaveBeenCalledTimes(50);
        });
        it('should handle transaction isolation during deletion', async () => {
            // Simulate transaction isolation behavior
            let deletionCount = 0;
            prismaService.moderator.delete.mockImplementation(() => {
                deletionCount++;
                if (deletionCount > 1) {
                    throw new Error('Record already deleted');
                }
                return Promise.resolve(mockModerator);
            });
            const promises = [
                service.remove('user-isolated'),
                service.remove('user-isolated'),
            ];
            const results = await Promise.allSettled(promises);
            expect(results[0].status).toBe('fulfilled');
            expect(results[1].status).toBe('rejected');
        });
    });
    describe('Edge Cases and Error Handling', () => {
        it('should handle malformed moderator data gracefully', async () => {
            const malformedData = {
                id: 123, // Number instead of string
                userId: null,
                permissions: 'not_an_array',
                level: { invalid: 'object' },
                isActive: 'not_boolean',
                createdAt: 'invalid_date',
            };
            prismaService.moderator.findMany.mockResolvedValue([malformedData]);
            const result = await service.findAll();
            expect(result).toEqual([malformedData]);
        });
        it('should handle extremely large datasets efficiently', async () => {
            const largeDataset = Array.from({ length: 10000 }, (_, i) => ({
                ...mockModerator,
                id: `moderator-${i}`,
                userId: `user-${i}`,
            }));
            prismaService.moderator.findMany.mockResolvedValue(largeDataset);
            const startTime = Date.now();
            const result = await service.findAll();
            const endTime = Date.now();
            expect(result).toHaveLength(10000);
            expect(endTime - startTime).toBeLessThan(1000); // Should complete within 1 second
        });
        it('should handle memory pressure gracefully', async () => {
            // Simulate memory-intensive operation
            const memoryIntensiveData = Array.from({ length: 1000 }, (_, i) => ({
                ...mockModerator,
                id: `moderator-${i}`,
                userId: `user-${i}`,
                permissions: Array.from({ length: 100 }, (_, j) => `PERMISSION_${i}_${j}`),
                metadata: {
                    largeData: 'x'.repeat(10000), // 10KB per record
                },
            }));
            prismaService.moderator.findMany.mockResolvedValue(memoryIntensiveData);
            const result = await service.findAll();
            expect(result).toHaveLength(1000);
            expect(Array.isArray(result)).toBe(true);
        });
        it('should handle network interruptions during operations', async () => {
            const networkError = new Error('ECONNRESET');
            networkError.name = 'NetworkError';
            prismaService.moderator.findMany.mockRejectedValue(networkError);
            await expect(service.findAll()).rejects.toThrow('ECONNRESET');
        });
        it('should handle database lock timeouts', async () => {
            const lockTimeoutError = new Error('Lock wait timeout exceeded');
            lockTimeoutError.name = 'LockTimeoutError';
            prismaService.moderator.update.mockRejectedValue(lockTimeoutError);
            await expect(service.update('user-123', mockUpdateModeratorData)).rejects.toThrow('Lock wait timeout exceeded');
        });
        it('should maintain data consistency under concurrent operations', async () => {
            const concurrentOperations = [
                service.findOne('user-123'),
                service.update('user-123', { isActive: false }),
                service.findOne('user-123'),
                service.remove('user-123'),
            ];
            prismaService.moderator.findUnique.mockResolvedValue(mockModerator);
            prismaService.moderator.update.mockResolvedValue({
                ...mockModerator,
                isActive: false,
            });
            prismaService.moderator.delete.mockResolvedValue(mockModerator);
            const results = await Promise.allSettled(concurrentOperations);
            expect(results[0].status).toBe('fulfilled');
            expect(results[1].status).toBe('fulfilled');
            expect(results[2].status).toBe('fulfilled');
            expect(results[3].status).toBe('fulfilled');
        });
    });
    describe('Performance and Scalability', () => {
        it('should handle high-throughput operations efficiently', async () => {
            const operationCount = 1000;
            const operations = Array.from({ length: operationCount }, (_, i) => {
                if (i % 4 === 0)
                    return service.findAll();
                if (i % 4 === 1)
                    return service.findOne(`user-${i}`);
                if (i % 4 === 2)
                    return service.create({ userId: `user-new-${i}` });
                return service.update(`user-${i}`, { isActive: i % 2 === 0 });
            });
            // Mock all responses
            prismaService.moderator.findMany.mockResolvedValue(mockModeratorList);
            prismaService.moderator.findUnique.mockResolvedValue(mockModerator);
            prismaService.moderator.create.mockResolvedValue(mockModerator);
            prismaService.moderator.update.mockResolvedValue(mockModerator);
            const startTime = Date.now();
            const results = await Promise.all(operations);
            const endTime = Date.now();
            expect(results).toHaveLength(operationCount);
            expect(endTime - startTime).toBeLessThan(5000); // Should complete within 5 seconds
        });
        it('should handle batch operations efficiently', async () => {
            const batchSize = 100;
            const batches = Array.from({ length: 10 }, (_, batchIndex) => Array.from({ length: batchSize }, (_, i) => {
                const userId = `batch-${batchIndex}-user-${i}`;
                prismaService.moderator.create.mockResolvedValueOnce({
                    ...mockModerator,
                    userId,
                });
                return service.create({ userId });
            }));
            const startTime = Date.now();
            for (const batch of batches) {
                await Promise.all(batch);
            }
            const endTime = Date.now();
            expect(endTime - startTime).toBeLessThan(3000); // Should complete within 3 seconds
            expect(prismaService.moderator.create).toHaveBeenCalledTimes(1000);
        });
        it('should optimize memory usage for large result sets', async () => {
            const largeResultSet = Array.from({ length: 50000 }, (_, i) => ({
                ...mockModerator,
                id: `moderator-${i}`,
                userId: `user-${i}`,
            }));
            prismaService.moderator.findMany.mockResolvedValue(largeResultSet);
            const initialMemory = process.memoryUsage().heapUsed;
            const result = await service.findAll();
            const finalMemory = process.memoryUsage().heapUsed;
            expect(result).toHaveLength(50000);
            // Memory increase should be reasonable (less than 100MB for this test)
            const memoryIncrease = finalMemory - initialMemory;
            expect(memoryIncrease).toBeLessThan(100 * 1024 * 1024);
        });
    });
    describe('Data Integrity and Validation', () => {
        it('should preserve data types throughout operations', async () => {
            const typedModerator = {
                id: 'string-id',
                userId: 'string-userId',
                permissions: ['array', 'of', 'strings'],
                level: 'string-level',
                isActive: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            prismaService.moderator.findUnique.mockResolvedValue(typedModerator);
            const result = await service.findOne('string-userId');
            expect(typeof result.id).toBe('string');
            expect(typeof result.userId).toBe('string');
            expect(Array.isArray(result.permissions)).toBe(true);
            expect(typeof result.level).toBe('string');
            expect(typeof result.isActive).toBe('boolean');
            expect(result.createdAt).toBeInstanceOf(Date);
            expect(result.updatedAt).toBeInstanceOf(Date);
        });
        it('should maintain referential integrity', async () => {
            const createData = {
                userId: 'valid-user-123',
                permissions: ['MODERATE_CONTENT'],
            };
            prismaService.moderator.create.mockResolvedValue({
                ...mockModerator,
                userId: 'valid-user-123',
            });
            const result = await service.create(createData);
            expect(result.userId).toBe('valid-user-123');
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: createData,
            });
        });
        it('should validate business logic consistency', async () => {
            const businessLogicUpdate = {
                level: 'senior_moderator',
                permissions: ['MODERATE_CONTENT', 'MANAGE_REPORTS', 'ESCALATE_ISSUES'],
                isActive: true,
            };
            prismaService.moderator.update.mockResolvedValue({
                ...mockModerator,
                ...businessLogicUpdate,
            });
            const result = await service.update('user-123', businessLogicUpdate);
            expect(result.level).toBe('senior_moderator');
            expect(result.permissions).toContain('ESCALATE_ISSUES');
            expect(result.isActive).toBe(true);
        });
        it('should handle edge cases in data validation', async () => {
            const edgeCaseData = {
                userId: '',
                permissions: [],
                level: '',
                isActive: false,
            };
            await service.create(edgeCaseData);
            expect(prismaService.moderator.create).toHaveBeenCalledWith({
                data: edgeCaseData,
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21vZGVyYXRvci9tb2RlcmF0b3Iuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDJEQUF1RDtBQUN2RCxnRkFBb0U7QUFHcEUsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLE9BQXlCLENBQUM7SUFDOUIsSUFBSSxhQUF5QyxDQUFDO0lBRTlDLHVCQUF1QjtJQUN2QixNQUFNLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBRWxELE1BQU0sYUFBYSxHQUFHO1FBQ3BCLEVBQUUsRUFBRSxlQUFlO1FBQ25CLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFdBQVcsRUFBRSxDQUFDLGtCQUFrQixFQUFFLGdCQUFnQixDQUFDO1FBQ25ELEtBQUssRUFBRSxXQUFXO1FBQ2xCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsU0FBUyxFQUFFLFFBQVE7UUFDbkIsU0FBUyxFQUFFLFFBQVE7S0FDcEIsQ0FBQztJQUVGLE1BQU0saUJBQWlCLEdBQUc7UUFDeEIsYUFBYTtRQUNiO1lBQ0UsR0FBRyxhQUFhO1lBQ2hCLEVBQUUsRUFBRSxlQUFlO1lBQ25CLE1BQU0sRUFBRSxVQUFVO1lBQ2xCLFdBQVcsRUFBRSxDQUFDLGtCQUFrQixDQUFDO1lBQ2pDLEtBQUssRUFBRSxrQkFBa0I7U0FDMUI7UUFDRDtZQUNFLEdBQUcsYUFBYTtZQUNoQixFQUFFLEVBQUUsZUFBZTtZQUNuQixNQUFNLEVBQUUsVUFBVTtZQUNsQixXQUFXLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQztZQUN0RSxLQUFLLEVBQUUsa0JBQWtCO1lBQ3pCLFFBQVEsRUFBRSxLQUFLO1NBQ2hCO0tBQ0YsQ0FBQztJQUVGLE1BQU0sdUJBQXVCLEdBQWdDO1FBQzNELE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFdBQVcs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LENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQzFELElBQUksRUFBRSxZQUFZO2FBQ25CLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbW9kZXJhdG9yL21vZGVyYXRvci5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBNb2RlcmF0b3JTZXJ2aWNlIH0gZnJvbSAnLi9tb2RlcmF0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHsgUHJpc21hIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG5kZXNjcmliZSgnTW9kZXJhdG9yU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IE1vZGVyYXRvclNlcnZpY2U7XG4gIGxldCBwcmlzbWFTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxQcmlzbWFTZXJ2aWNlPjtcblxuICAvLyBNb2NrIGRhdGEgc3RydWN0dXJlc1xuICBjb25zdCBtb2NrRGF0ZSA9IG5ldyBEYXRlKCcyMDI0LTAxLTE1VDEwOjAwOjAwWicpO1xuXG4gIGNvbnN0IG1vY2tNb2RlcmF0b3IgPSB7XG4gICAgaWQ6ICdtb2RlcmF0b3ItMTIzJyxcbiAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgcGVybWlzc2lvbnM6IFsnTU9ERVJBVEVfQ09OVEVOVCcsICdNQU5BR0VfUkVQT1JUUyddLFxuICAgIGxldmVsOiAnbW9kZXJhdG9yJyxcbiAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICBjcmVhdGVkQXQ6IG1vY2tEYXRlLFxuICAgIHVwZGF0ZWRBdDogbW9ja0RhdGUsXG4gIH07XG5cbiAgY29uc3QgbW9ja01vZGVyYXRvckxpc3QgPSBbXG4gICAgbW9ja01vZGVyYXRvcixcbiAgICB7XG4gICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgaWQ6ICdtb2RlcmF0b3ItMTI0JyxcbiAgICAgIHVzZXJJZDogJ3VzZXItMTI0JyxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ01PREVSQVRFX0NPTlRFTlQnXSxcbiAgICAgIGxldmVsOiAnanVuaW9yX21vZGVyYXRvcicsXG4gICAgfSxcbiAgICB7XG4gICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgaWQ6ICdtb2RlcmF0b3ItMTI1JyxcbiAgICAgIHVzZXJJZDogJ3VzZXItMTI1JyxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ01PREVSQVRFX0NPTlRFTlQnLCAnTUFOQUdFX1JFUE9SVFMnLCAnRVNDQUxBVEVfSVNTVUVTJ10sXG4gICAgICBsZXZlbDogJ3Nlbmlvcl9tb2RlcmF0b3InLFxuICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgIH0sXG4gIF07XG5cbiAgY29uc3QgbW9ja0NyZWF0ZU1vZGVyYXRvckRhdGE6IFByaXNtYS5Nb2RlcmF0b3JDcmVhdGVJbnB1dCA9IHtcbiAgICB1c2VySWQ6ICd1c2VyLTEyNicsXG4gICAgcGVybWlzc2lvbnM6IFsnTU9ERVJBVEVfQ09OVEVOVCddLFxuICAgIGxldmVsOiAnbW9kZXJhdG9yJyxcbiAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgfTtcblxuICBjb25zdCBtb2NrVXBkYXRlTW9kZXJhdG9yRGF0YTogUHJpc21hLk1vZGVyYXRvclVwZGF0ZUlucHV0ID0ge1xuICAgIHBlcm1pc3Npb25zOiBbJ01PREVSQVRFX0NPTlRFTlQnLCAnTUFOQUdFX1JFUE9SVFMnLCAnRVNDQUxBVEVfSVNTVUVTJ10sXG4gICAgbGV2ZWw6ICdzZW5pb3JfbW9kZXJhdG9yJyxcbiAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrUHJpc21hU2VydmljZSA9IHtcbiAgICAgIG1vZGVyYXRvcjoge1xuICAgICAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIE1vZGVyYXRvclNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUHJpc21hU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8TW9kZXJhdG9yU2VydmljZT4oTW9kZXJhdG9yU2VydmljZSk7XG4gICAgcHJpc21hU2VydmljZSA9IG1vZHVsZS5nZXQoUHJpc21hU2VydmljZSk7XG5cbiAgICAvLyBNb2NrIERhdGUgY29uc3RydWN0b3IgZm9yIGNvbnNpc3RlbnQgdGVzdGluZ1xuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuICAgIGplc3Quc2V0U3lzdGVtVGltZShtb2NrRGF0ZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgamVzdC51c2VSZWFsVGltZXJzKCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICBleHBlY3Qoc2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yTGlzdCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgbW9kZXJhdG9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEFsbCgpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNb2RlcmF0b3JMaXN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IHdoZW4gbm8gbW9kZXJhdG9ycyBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQWxsKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YWJhc2VFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRNYW55Lm1vY2tSZWplY3RlZFZhbHVlKGRhdGFiYXNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIG51bWJlciBvZiBtb2RlcmF0b3JzIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGFyZ2VNb2RlcmF0b3JzQXJyYXkgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAwIH0sIChfLCBpKSA9PiAoe1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICBpZDogYG1vZGVyYXRvci0ke2l9YCxcbiAgICAgICAgdXNlcklkOiBgdXNlci0ke2l9YCxcbiAgICAgIH0pKTtcblxuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobGFyZ2VNb2RlcmF0b3JzQXJyYXkpO1xuXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQWxsKCk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEwMDApO1xuICAgICAgZXhwZWN0KGVuZFRpbWUgLSBzdGFydFRpbWUpLnRvQmVMZXNzVGhhbigxMDApOyAvLyBTaG91bGQgYmUgZmFzdFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCBhbmQgdW5kZWZpbmVkIHZhbHVlcyBpbiBtb2RlcmF0b3IgZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vZGVyYXRvcnNXaXRoTnVsbHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICAgIHBlcm1pc3Npb25zOiBudWxsLFxuICAgICAgICAgIGxldmVsOiB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2RlcmF0b3JzV2l0aE51bGxzIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEFsbCgpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vZGVyYXRvcnNXaXRoTnVsbHMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBkYXRhIHN0cnVjdHVyZSBpbnRlZ3JpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoKTtcblxuICAgICAgcmVzdWx0LmZvckVhY2gobW9kZXJhdG9yID0+IHtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ2lkJyk7XG4gICAgICAgIGV4cGVjdChtb2RlcmF0b3IpLnRvSGF2ZVByb3BlcnR5KCd1c2VySWQnKTtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ3Blcm1pc3Npb25zJyk7XG4gICAgICAgIGV4cGVjdChtb2RlcmF0b3IpLnRvSGF2ZVByb3BlcnR5KCdsZXZlbCcpO1xuICAgICAgICBleHBlY3QobW9kZXJhdG9yKS50b0hhdmVQcm9wZXJ0eSgnaXNBY3RpdmUnKTtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ2NyZWF0ZWRBdCcpO1xuICAgICAgICBleHBlY3QobW9kZXJhdG9yKS50b0hhdmVQcm9wZXJ0eSgndXBkYXRlZEF0Jyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgZmluZEFsbCByZXF1ZXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKCkgPT4gc2VydmljZS5maW5kQWxsKCkpO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDEwKTtcbiAgICAgIHJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNb2RlcmF0b3JMaXN0KTtcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZE9uZScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBtb2RlcmF0b3IgYnkgdXNlcklkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kT25lKCd1c2VyLTEyMycpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6ICd1c2VyLTEyMycgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTW9kZXJhdG9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCBtb2RlcmF0b3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJ25vbi1leGlzdGVudC11c2VyJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhYmFzZUVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZS5tb2NrUmVqZWN0ZWRWYWx1ZShkYXRhYmFzZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZmluZE9uZSgndXNlci0xMjMnKSkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5nIHVzZXJJZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuZmluZE9uZSgnJyk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJycgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCBhbmQgdW5kZWZpbmVkIHVzZXJJZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UuZmluZE9uZShudWxsIGFzIGFueSk7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUodW5kZWZpbmVkIGFzIGFueSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogbnVsbCB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHVuZGVmaW5lZCB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gdXNlcklkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3BlY2lhbFVzZXJJZCA9ICd1c2VyLTEyM0Bkb21haW4uY29tIyQlJztcblxuICAgICAgYXdhaXQgc2VydmljZS5maW5kT25lKHNwZWNpYWxVc2VySWQpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHNwZWNpYWxVc2VySWQgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgVW5pY29kZSBjaGFyYWN0ZXJzIGluIHVzZXJJZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVuaWNvZGVVc2VySWQgPSAndXNlci3mtYvor5Ut8J+Uki3iiIbiiJHCqSc7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuZmluZE9uZSh1bmljb2RlVXNlcklkKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiB1bmljb2RlVXNlcklkIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZlcnkgbG9uZyB1c2VySWQgc3RyaW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxvbmdVc2VySWQgPSAndXNlci0nICsgJ2EnLnJlcGVhdCgxMDAwKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5maW5kT25lKGxvbmdVc2VySWQpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IGxvbmdVc2VySWQgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBmaW5kT25lIHJlcXVlc3RzIGZvciBzYW1lIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUgfSwgKCkgPT4gc2VydmljZS5maW5kT25lKCd1c2VyLTEyMycpKTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcblxuICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01vZGVyYXRvcik7XG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoNSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IGZpbmRPbmUgcmVxdWVzdHMgZm9yIGRpZmZlcmVudCB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRVbmlxdWVcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrTW9kZXJhdG9yKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgLi4ubW9ja01vZGVyYXRvciwgdXNlcklkOiAndXNlci0xMjQnIH0pXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyAuLi5tb2NrTW9kZXJhdG9yLCB1c2VySWQ6ICd1c2VyLTEyNScgfSk7XG5cbiAgICAgIGNvbnN0IHByb21pc2VzID0gW1xuICAgICAgICBzZXJ2aWNlLmZpbmRPbmUoJ3VzZXItMTIzJyksXG4gICAgICAgIHNlcnZpY2UuZmluZE9uZSgndXNlci0xMjQnKSxcbiAgICAgICAgc2VydmljZS5maW5kT25lKCd1c2VyLTEyNScpLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0udXNlcklkKS50b0JlKCd1c2VyLTEyMycpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMV0udXNlcklkKS50b0JlKCd1c2VyLTEyNCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0udXNlcklkKS50b0JlKCd1c2VyLTEyNScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja01vZGVyYXRvcixcbiAgICAgICAgLi4ubW9ja0NyZWF0ZU1vZGVyYXRvckRhdGEsXG4gICAgICAgIGlkOiAnbW9kZXJhdG9yLTEyNicsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG1vZGVyYXRvciBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShtb2NrQ3JlYXRlTW9kZXJhdG9yRGF0YSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YTogbW9ja0NyZWF0ZU1vZGVyYXRvckRhdGEsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICAuLi5tb2NrQ3JlYXRlTW9kZXJhdG9yRGF0YSxcbiAgICAgICAgaWQ6ICdtb2RlcmF0b3ItMTI2JyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWluaW1hbCBjcmVhdGUgZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1pbmltYWxEYXRhOiBQcmlzbWEuTW9kZXJhdG9yQ3JlYXRlSW5wdXQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItbWluaW1hbCcsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShtaW5pbWFsRGF0YSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YTogbWluaW1hbERhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXggcGVybWlzc2lvbnMgYXJyYXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV4RGF0YTogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLWNvbXBsZXgnLFxuICAgICAgICBwZXJtaXNzaW9uczogW1xuICAgICAgICAgICdNT0RFUkFURV9DT05URU5UJyxcbiAgICAgICAgICAnTUFOQUdFX1JFUE9SVFMnLFxuICAgICAgICAgICdFU0NBTEFURV9JU1NVRVMnLFxuICAgICAgICAgICdCQU5fVVNFUlMnLFxuICAgICAgICAgICdSRVZJRVdfQVBQRUFMUycsXG4gICAgICAgICAgJ01PREVSQVRFX1RIRVJBUFlfU0VTU0lPTlMnLFxuICAgICAgICAgICdBQ0NFU1NfQU5BTFlUSUNTJyxcbiAgICAgICAgXSxcbiAgICAgICAgbGV2ZWw6ICdzZW5pb3JfbW9kZXJhdG9yJyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShjb21wbGV4RGF0YSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YTogY29tcGxleERhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNyZWF0ZSB3aXRoIG51bGwgdmFsdWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YVdpdGhOdWxsczogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLW51bGxzJyxcbiAgICAgICAgcGVybWlzc2lvbnM6IG51bGwsXG4gICAgICAgIGxldmVsOiBudWxsLFxuICAgICAgICBpc0FjdGl2ZTogbnVsbCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlKGRhdGFXaXRoTnVsbHMpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IGRhdGFXaXRoTnVsbHMsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNyZWF0ZSB3aXRoIHVuZGVmaW5lZCB2YWx1ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhV2l0aFVuZGVmaW5lZDogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLXVuZGVmaW5lZCcsXG4gICAgICAgIHBlcm1pc3Npb25zOiB1bmRlZmluZWQsXG4gICAgICAgIGxldmVsOiB1bmRlZmluZWQsXG4gICAgICAgIGlzQWN0aXZlOiB1bmRlZmluZWQsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShkYXRhV2l0aFVuZGVmaW5lZCk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YTogZGF0YVdpdGhVbmRlZmluZWQsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGNvbnN0cmFpbnQgdmlvbGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnN0cmFpbnRFcnJvciA9IG5ldyBFcnJvcignVW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uJyk7XG4gICAgICBjb25zdHJhaW50RXJyb3IubmFtZSA9ICdQMjAwMic7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWUoY29uc3RyYWludEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKG1vY2tDcmVhdGVNb2RlcmF0b3JEYXRhKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnVW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9uJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnQgdmlvbGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZvcmVpZ25LZXlFcnJvciA9IG5ldyBFcnJvcignRm9yZWlnbiBrZXkgY29uc3RyYWludCB2aW9sYXRpb24nKTtcbiAgICAgIGZvcmVpZ25LZXlFcnJvci5uYW1lID0gJ1AyMDAzJztcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmNyZWF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShmb3JlaWduS2V5RXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5jcmVhdGUobW9ja0NyZWF0ZU1vZGVyYXRvckRhdGEpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdGb3JlaWduIGtleSBjb25zdHJhaW50IHZpb2xhdGlvbidcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSB0aW1lb3V0IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRpbWVvdXRFcnJvciA9IG5ldyBFcnJvcignQ29ubmVjdGlvbiB0aW1lb3V0Jyk7XG4gICAgICB0aW1lb3V0RXJyb3IubmFtZSA9ICdUaW1lb3V0RXJyb3InO1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuY3JlYXRlLm1vY2tSZWplY3RlZFZhbHVlKHRpbWVvdXRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNyZWF0ZShtb2NrQ3JlYXRlTW9kZXJhdG9yRGF0YSkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ0Nvbm5lY3Rpb24gdGltZW91dCdcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2ZXJ5IGxhcmdlIHBlcm1pc3Npb25zIGFycmF5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGFyZ2VQZXJtaXNzaW9ucyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDEwMDAgfSwgKF8sIGkpID0+IGBQRVJNSVNTSU9OXyR7aX1gKTtcbiAgICAgIGNvbnN0IGRhdGFXaXRoTGFyZ2VQZXJtaXNzaW9uczogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyLWxhcmdlLXBlcm1pc3Npb25zJyxcbiAgICAgICAgcGVybWlzc2lvbnM6IGxhcmdlUGVybWlzc2lvbnMsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShkYXRhV2l0aExhcmdlUGVybWlzc2lvbnMpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IGRhdGFXaXRoTGFyZ2VQZXJtaXNzaW9ucyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBjcmVhdGUgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZVByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+IHtcbiAgICAgICAgY29uc3QgZGF0YTogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgICAgIHVzZXJJZDogYHVzZXItY29uY3VycmVudC0ke2l9YCxcbiAgICAgICAgICBwZXJtaXNzaW9uczogWydNT0RFUkFURV9DT05URU5UJ10sXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICAgIGlkOiBgbW9kZXJhdG9yLWNvbmN1cnJlbnQtJHtpfWAsXG4gICAgICAgICAgdXNlcklkOiBgdXNlci1jb25jdXJyZW50LSR7aX1gLFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gc2VydmljZS5jcmVhdGUoZGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKGNyZWF0ZVByb21pc2VzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aCgxMCk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja01vZGVyYXRvcixcbiAgICAgICAgLi4ubW9ja1VwZGF0ZU1vZGVyYXRvckRhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIG1vZGVyYXRvciBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwZGF0ZSgndXNlci0xMjMnLCBtb2NrVXBkYXRlTW9kZXJhdG9yRGF0YSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGRhdGE6IG1vY2tVcGRhdGVNb2RlcmF0b3JEYXRhLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgLi4ubW9ja01vZGVyYXRvcixcbiAgICAgICAgLi4ubW9ja1VwZGF0ZU1vZGVyYXRvckRhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhcnRpYWwgdXBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcnRpYWxVcGRhdGU6IFByaXNtYS5Nb2RlcmF0b3JVcGRhdGVJbnB1dCA9IHtcbiAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS51cGRhdGUoJ3VzZXItMTIzJywgcGFydGlhbFVwZGF0ZSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGRhdGE6IHBhcnRpYWxVcGRhdGUsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHVwZGF0ZSBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW1wdHlVcGRhdGU6IFByaXNtYS5Nb2RlcmF0b3JVcGRhdGVJbnB1dCA9IHt9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnVwZGF0ZSgndXNlci0xMjMnLCBlbXB0eVVwZGF0ZSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGRhdGE6IGVtcHR5VXBkYXRlLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwZXJtaXNzaW9uIGxldmVsIGNoYW5nZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsZXZlbENoYW5nZTogUHJpc21hLk1vZGVyYXRvclVwZGF0ZUlucHV0ID0ge1xuICAgICAgICBsZXZlbDogJ3Nlbmlvcl9tb2RlcmF0b3InLFxuICAgICAgICBwZXJtaXNzaW9uczogW1xuICAgICAgICAgICdNT0RFUkFURV9DT05URU5UJyxcbiAgICAgICAgICAnTUFOQUdFX1JFUE9SVFMnLFxuICAgICAgICAgICdFU0NBTEFURV9JU1NVRVMnLFxuICAgICAgICAgICdCQU5fVVNFUlMnLFxuICAgICAgICAgICdBQ0NFU1NfQU5BTFlUSUNTJyxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UudXBkYXRlKCd1c2VyLTEyMycsIGxldmVsQ2hhbmdlKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6ICd1c2VyLTEyMycgfSxcbiAgICAgICAgZGF0YTogbGV2ZWxDaGFuZ2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBlcm1pc3Npb24gcmVtb3ZhbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25SZW1vdmFsOiBQcmlzbWEuTW9kZXJhdG9yVXBkYXRlSW5wdXQgPSB7XG4gICAgICAgIHBlcm1pc3Npb25zOiBbJ01PREVSQVRFX0NPTlRFTlQnXSwgLy8gUmVkdWNlZCBwZXJtaXNzaW9uc1xuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS51cGRhdGUoJ3VzZXItMTIzJywgcGVybWlzc2lvblJlbW92YWwpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiBwZXJtaXNzaW9uUmVtb3ZhbCxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbW9kZXJhdG9yIGRlYWN0aXZhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlYWN0aXZhdGlvbjogUHJpc21hLk1vZGVyYXRvclVwZGF0ZUlucHV0ID0ge1xuICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnVwZGF0ZSgndXNlci0xMjMnLCBkZWFjdGl2YXRpb24pO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiBkZWFjdGl2YXRpb24sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1leGlzdGVudCBtb2RlcmF0b3IgdXBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdEZvdW5kRXJyb3IgPSBuZXcgRXJyb3IoJ1JlY29yZCBub3QgZm91bmQnKTtcbiAgICAgIG5vdEZvdW5kRXJyb3IubmFtZSA9ICdQMjAyNSc7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci51cGRhdGUubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS51cGRhdGUoJ25vbi1leGlzdGVudC11c2VyJywgbW9ja1VwZGF0ZU1vZGVyYXRvckRhdGEpXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnUmVjb3JkIG5vdCBmb3VuZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCBhbmQgdW5kZWZpbmVkIGluIHVwZGF0ZSBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlV2l0aE51bGxzOiBQcmlzbWEuTW9kZXJhdG9yVXBkYXRlSW5wdXQgPSB7XG4gICAgICAgIHBlcm1pc3Npb25zOiBudWxsLFxuICAgICAgICBsZXZlbDogbnVsbCxcbiAgICAgICAgaXNBY3RpdmU6IG51bGwsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnVwZGF0ZSgndXNlci0xMjMnLCB1cGRhdGVXaXRoTnVsbHMpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiB1cGRhdGVXaXRoTnVsbHMsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgdXBkYXRlcyBvbiBzYW1lIG1vZGVyYXRvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZTE6IFByaXNtYS5Nb2RlcmF0b3JVcGRhdGVJbnB1dCA9IHsgaXNBY3RpdmU6IGZhbHNlIH07XG4gICAgICBjb25zdCB1cGRhdGUyOiBQcmlzbWEuTW9kZXJhdG9yVXBkYXRlSW5wdXQgPSB7IGxldmVsOiAnc2VuaW9yX21vZGVyYXRvcicgfTtcblxuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IudXBkYXRlXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyAuLi5tb2NrTW9kZXJhdG9yLCBpc0FjdGl2ZTogZmFsc2UgfSlcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ1JlY29yZCBiZWluZyB1cGRhdGVkJykpO1xuXG4gICAgICBjb25zdCBwcm9taXNlcyA9IFtcbiAgICAgICAgc2VydmljZS51cGRhdGUoJ3VzZXItMTIzJywgdXBkYXRlMSksXG4gICAgICAgIHNlcnZpY2UudXBkYXRlKCd1c2VyLTEyMycsIHVwZGF0ZTIpLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwcm9taXNlcyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdLnN0YXR1cykudG9CZSgnZnVsZmlsbGVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0c1sxXS5zdGF0dXMpLnRvQmUoJ3JlamVjdGVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV4IHBlcm1pc3Npb24gdXBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbXBsZXhVcGRhdGU6IFByaXNtYS5Nb2RlcmF0b3JVcGRhdGVJbnB1dCA9IHtcbiAgICAgICAgcGVybWlzc2lvbnM6IFtcbiAgICAgICAgICAnTU9ERVJBVEVfQ09OVEVOVCcsXG4gICAgICAgICAgJ01BTkFHRV9SRVBPUlRTJyxcbiAgICAgICAgICAnRVNDQUxBVEVfSVNTVUVTJyxcbiAgICAgICAgICAnQkFOX1VTRVJTJyxcbiAgICAgICAgICAnUkVWSUVXX0FQUEVBTFMnLFxuICAgICAgICAgICdNT0RFUkFURV9USEVSQVBZX1NFU1NJT05TJyxcbiAgICAgICAgICAnQUNDRVNTX0FOQUxZVElDUycsXG4gICAgICAgICAgJ0NPTkZJR1VSRV9NT0RFUkFUSU9OX1JVTEVTJyxcbiAgICAgICAgICAnTUFOQUdFX01PREVSQVRPUl9BQ0NPVU5UUycsXG4gICAgICAgICAgJ0VNRVJHRU5DWV9JTlRFUlZFTlRJT05TJyxcbiAgICAgICAgXSxcbiAgICAgICAgbGV2ZWw6ICdhZG1pbl9tb2RlcmF0b3InLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UudXBkYXRlKCd1c2VyLTEyMycsIGNvbXBsZXhVcGRhdGUpO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiBjb21wbGV4VXBkYXRlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZW1vdmUnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5kZWxldGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBtb2RlcmF0b3Igc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5yZW1vdmUoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiAndXNlci0xMjMnIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01vZGVyYXRvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZW1vdmFsIG9mIG5vbi1leGlzdGVudCBtb2RlcmF0b3InLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdSZWNvcmQgbm90IGZvdW5kJyk7XG4gICAgICBub3RGb3VuZEVycm9yLm5hbWUgPSAnUDIwMjUnO1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZGVsZXRlLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yZW1vdmUoJ25vbi1leGlzdGVudC11c2VyJykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ1JlY29yZCBub3QgZm91bmQnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZm9yZWlnbiBrZXkgY29uc3RyYWludCB2aW9sYXRpb25zIG9uIGRlbGV0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZvcmVpZ25LZXlFcnJvciA9IG5ldyBFcnJvcignRm9yZWlnbiBrZXkgY29uc3RyYWludCB2aW9sYXRpb24nKTtcbiAgICAgIGZvcmVpZ25LZXlFcnJvci5uYW1lID0gJ1AyMDAzJztcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmRlbGV0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShmb3JlaWduS2V5RXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yZW1vdmUoJ3VzZXItMTIzJykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ0ZvcmVpZ24ga2V5IGNvbnN0cmFpbnQgdmlvbGF0aW9uJ1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29ubmVjdGlvbkVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZGVsZXRlLm1vY2tSZWplY3RlZFZhbHVlKGNvbm5lY3Rpb25FcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnJlbW92ZSgndXNlci0xMjMnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5nIHVzZXJJZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlcnZpY2UucmVtb3ZlKCcnKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6ICcnIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgYW5kIHVuZGVmaW5lZCB1c2VySWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXJ2aWNlLnJlbW92ZShudWxsIGFzIGFueSk7XG4gICAgICBhd2FpdCBzZXJ2aWNlLnJlbW92ZSh1bmRlZmluZWQgYXMgYW55KTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IG51bGwgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHVuZGVmaW5lZCB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IGRlbGV0aW9uIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZGVsZXRlXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja01vZGVyYXRvcilcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ1JlY29yZCBub3QgZm91bmQnKSk7XG5cbiAgICAgIGNvbnN0IHByb21pc2VzID0gW1xuICAgICAgICBzZXJ2aWNlLnJlbW92ZSgndXNlci0xMjMnKSxcbiAgICAgICAgc2VydmljZS5yZW1vdmUoJ3VzZXItMTIzJyksXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHByb21pc2VzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0uc3RhdHVzKS50b0JlKCdmdWxmaWxsZWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdLnN0YXR1cykudG9CZSgncmVqZWN0ZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGJ1bGsgZGVsZXRpb24gb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbGV0ZVByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNTAgfSwgKF8sIGkpID0+IHtcbiAgICAgICAgY29uc3QgdXNlcklkID0gYHVzZXItYnVsay0ke2l9YDtcbiAgICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgLi4ubW9ja01vZGVyYXRvcixcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2VydmljZS5yZW1vdmUodXNlcklkKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDUwKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcyg1MCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0cmFuc2FjdGlvbiBpc29sYXRpb24gZHVyaW5nIGRlbGV0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxhdGUgdHJhbnNhY3Rpb24gaXNvbGF0aW9uIGJlaGF2aW9yXG4gICAgICBsZXQgZGVsZXRpb25Db3VudCA9IDA7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5kZWxldGUubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgZGVsZXRpb25Db3VudCsrO1xuICAgICAgICBpZiAoZGVsZXRpb25Db3VudCA+IDEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlY29yZCBhbHJlYWR5IGRlbGV0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG1vY2tNb2RlcmF0b3IpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHByb21pc2VzID0gW1xuICAgICAgICBzZXJ2aWNlLnJlbW92ZSgndXNlci1pc29sYXRlZCcpLFxuICAgICAgICBzZXJ2aWNlLnJlbW92ZSgndXNlci1pc29sYXRlZCcpLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwcm9taXNlcyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRzWzBdLnN0YXR1cykudG9CZSgnZnVsZmlsbGVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0c1sxXS5zdGF0dXMpLnRvQmUoJ3JlamVjdGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzIGFuZCBFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgbW9kZXJhdG9yIGRhdGEgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1hbGZvcm1lZERhdGEgPSB7XG4gICAgICAgIGlkOiAxMjMsIC8vIE51bWJlciBpbnN0ZWFkIG9mIHN0cmluZ1xuICAgICAgICB1c2VySWQ6IG51bGwsXG4gICAgICAgIHBlcm1pc3Npb25zOiAnbm90X2FuX2FycmF5JyxcbiAgICAgICAgbGV2ZWw6IHsgaW52YWxpZDogJ29iamVjdCcgfSxcbiAgICAgICAgaXNBY3RpdmU6ICdub3RfYm9vbGVhbicsXG4gICAgICAgIGNyZWF0ZWRBdDogJ2ludmFsaWRfZGF0ZScsXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbbWFsZm9ybWVkRGF0YV0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQWxsKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW21hbGZvcm1lZERhdGFdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGV4dHJlbWVseSBsYXJnZSBkYXRhc2V0cyBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxhcmdlRGF0YXNldCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDEwMDAwIH0sIChfLCBpKSA9PiAoe1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICBpZDogYG1vZGVyYXRvci0ke2l9YCxcbiAgICAgICAgdXNlcklkOiBgdXNlci0ke2l9YCxcbiAgICAgIH0pKTtcblxuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobGFyZ2VEYXRhc2V0KTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEFsbCgpO1xuICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxMDAwMCk7XG4gICAgICBleHBlY3QoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9CZUxlc3NUaGFuKDEwMDApOyAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIDEgc2Vjb25kXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtZW1vcnkgcHJlc3N1cmUgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIG1lbW9yeS1pbnRlbnNpdmUgb3BlcmF0aW9uXG4gICAgICBjb25zdCBtZW1vcnlJbnRlbnNpdmVEYXRhID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAwMCB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgLi4ubW9ja01vZGVyYXRvcixcbiAgICAgICAgaWQ6IGBtb2RlcmF0b3ItJHtpfWAsXG4gICAgICAgIHVzZXJJZDogYHVzZXItJHtpfWAsXG4gICAgICAgIHBlcm1pc3Npb25zOiBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAgfSwgKF8sIGopID0+IGBQRVJNSVNTSU9OXyR7aX1fJHtqfWApLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIGxhcmdlRGF0YTogJ3gnLnJlcGVhdCgxMDAwMCksIC8vIDEwS0IgcGVyIHJlY29yZFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtZW1vcnlJbnRlbnNpdmVEYXRhIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEFsbCgpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMTAwMCk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmV0d29yayBpbnRlcnJ1cHRpb25zIGR1cmluZyBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmV0d29ya0Vycm9yID0gbmV3IEVycm9yKCdFQ09OTlJFU0VUJyk7XG4gICAgICBuZXR3b3JrRXJyb3IubmFtZSA9ICdOZXR3b3JrRXJyb3InO1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5maW5kTWFueS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXR3b3JrRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdygnRUNPTk5SRVNFVCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgbG9jayB0aW1lb3V0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxvY2tUaW1lb3V0RXJyb3IgPSBuZXcgRXJyb3IoJ0xvY2sgd2FpdCB0aW1lb3V0IGV4Y2VlZGVkJyk7XG4gICAgICBsb2NrVGltZW91dEVycm9yLm5hbWUgPSAnTG9ja1RpbWVvdXRFcnJvcic7XG5cbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLnVwZGF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShsb2NrVGltZW91dEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnVwZGF0ZSgndXNlci0xMjMnLCBtb2NrVXBkYXRlTW9kZXJhdG9yRGF0YSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdMb2NrIHdhaXQgdGltZW91dCBleGNlZWRlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBkYXRhIGNvbnNpc3RlbmN5IHVuZGVyIGNvbmN1cnJlbnQgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmN1cnJlbnRPcGVyYXRpb25zID0gW1xuICAgICAgICBzZXJ2aWNlLmZpbmRPbmUoJ3VzZXItMTIzJyksXG4gICAgICAgIHNlcnZpY2UudXBkYXRlKCd1c2VyLTEyMycsIHsgaXNBY3RpdmU6IGZhbHNlIH0pLFxuICAgICAgICBzZXJ2aWNlLmZpbmRPbmUoJ3VzZXItMTIzJyksXG4gICAgICAgIHNlcnZpY2UucmVtb3ZlKCd1c2VyLTEyMycpLFxuICAgICAgXTtcblxuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yKTtcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0b3IpO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKGNvbmN1cnJlbnRPcGVyYXRpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0uc3RhdHVzKS50b0JlKCdmdWxmaWxsZWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdLnN0YXR1cykudG9CZSgnZnVsZmlsbGVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0c1syXS5zdGF0dXMpLnRvQmUoJ2Z1bGZpbGxlZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbM10uc3RhdHVzKS50b0JlKCdmdWxmaWxsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIGFuZCBTY2FsYWJpbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBoaWdoLXRocm91Z2hwdXQgb3BlcmF0aW9ucyBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbkNvdW50ID0gMTAwMDtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBvcGVyYXRpb25Db3VudCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBpZiAoaSAlIDQgPT09IDApIHJldHVybiBzZXJ2aWNlLmZpbmRBbGwoKTtcbiAgICAgICAgaWYgKGkgJSA0ID09PSAxKSByZXR1cm4gc2VydmljZS5maW5kT25lKGB1c2VyLSR7aX1gKTtcbiAgICAgICAgaWYgKGkgJSA0ID09PSAyKSByZXR1cm4gc2VydmljZS5jcmVhdGUoeyB1c2VySWQ6IGB1c2VyLW5ldy0ke2l9YCB9KTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2UudXBkYXRlKGB1c2VyLSR7aX1gLCB7IGlzQWN0aXZlOiBpICUgMiA9PT0gMCB9KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBNb2NrIGFsbCByZXNwb25zZXNcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0b3JMaXN0KTtcbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG5cbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwob3BlcmF0aW9ucyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aChvcGVyYXRpb25Db3VudCk7XG4gICAgICBleHBlY3QoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9CZUxlc3NUaGFuKDUwMDApOyAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIDUgc2Vjb25kc1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmF0Y2ggb3BlcmF0aW9ucyBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJhdGNoU2l6ZSA9IDEwMDtcbiAgICAgIGNvbnN0IGJhdGNoZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9LCAoXywgYmF0Y2hJbmRleCkgPT5cbiAgICAgICAgQXJyYXkuZnJvbSh7IGxlbmd0aDogYmF0Y2hTaXplIH0sIChfLCBpKSA9PiB7XG4gICAgICAgICAgY29uc3QgdXNlcklkID0gYGJhdGNoLSR7YmF0Y2hJbmRleH0tdXNlci0ke2l9YDtcbiAgICAgICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHNlcnZpY2UuY3JlYXRlKHsgdXNlcklkIH0pO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBiYXRjaCBvZiBiYXRjaGVzKSB7XG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKGJhdGNoKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgIGV4cGVjdChlbmRUaW1lIC0gc3RhcnRUaW1lKS50b0JlTGVzc1RoYW4oMzAwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gMyBzZWNvbmRzXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5tb2RlcmF0b3IuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMTAwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG9wdGltaXplIG1lbW9yeSB1c2FnZSBmb3IgbGFyZ2UgcmVzdWx0IHNldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsYXJnZVJlc3VsdFNldCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUwMDAwIH0sIChfLCBpKSA9PiAoe1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICBpZDogYG1vZGVyYXRvci0ke2l9YCxcbiAgICAgICAgdXNlcklkOiBgdXNlci0ke2l9YCxcbiAgICAgIH0pKTtcblxuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobGFyZ2VSZXN1bHRTZXQpO1xuXG4gICAgICBjb25zdCBpbml0aWFsTWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpLmhlYXBVc2VkO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQWxsKCk7XG4gICAgICBjb25zdCBmaW5hbE1lbW9yeSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDUwMDAwKTtcbiAgICAgIFxuICAgICAgLy8gTWVtb3J5IGluY3JlYXNlIHNob3VsZCBiZSByZWFzb25hYmxlIChsZXNzIHRoYW4gMTAwTUIgZm9yIHRoaXMgdGVzdClcbiAgICAgIGNvbnN0IG1lbW9yeUluY3JlYXNlID0gZmluYWxNZW1vcnkgLSBpbml0aWFsTWVtb3J5O1xuICAgICAgZXhwZWN0KG1lbW9yeUluY3JlYXNlKS50b0JlTGVzc1RoYW4oMTAwICogMTAyNCAqIDEwMjQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YSBJbnRlZ3JpdHkgYW5kIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBkYXRhIHR5cGVzIHRocm91Z2hvdXQgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHR5cGVkTW9kZXJhdG9yID0ge1xuICAgICAgICBpZDogJ3N0cmluZy1pZCcsXG4gICAgICAgIHVzZXJJZDogJ3N0cmluZy11c2VySWQnLFxuICAgICAgICBwZXJtaXNzaW9uczogWydhcnJheScsICdvZicsICdzdHJpbmdzJ10sXG4gICAgICAgIGxldmVsOiAnc3RyaW5nLWxldmVsJyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS5tb2RlcmF0b3IuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0eXBlZE1vZGVyYXRvcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZE9uZSgnc3RyaW5nLXVzZXJJZCcpO1xuXG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5pZCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC51c2VySWQpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LnBlcm1pc3Npb25zKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmxldmVsKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmlzQWN0aXZlKS50b0JlKCdib29sZWFuJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNyZWF0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnVwZGF0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1haW50YWluIHJlZmVyZW50aWFsIGludGVncml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZURhdGE6IFByaXNtYS5Nb2RlcmF0b3JDcmVhdGVJbnB1dCA9IHtcbiAgICAgICAgdXNlcklkOiAndmFsaWQtdXNlci0xMjMnLFxuICAgICAgICBwZXJtaXNzaW9uczogWydNT0RFUkFURV9DT05URU5UJ10sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICB1c2VySWQ6ICd2YWxpZC11c2VyLTEyMycsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGUoY3JlYXRlRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcklkKS50b0JlKCd2YWxpZC11c2VyLTEyMycpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiBjcmVhdGVEYXRhLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGJ1c2luZXNzIGxvZ2ljIGNvbnNpc3RlbmN5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYnVzaW5lc3NMb2dpY1VwZGF0ZTogUHJpc21hLk1vZGVyYXRvclVwZGF0ZUlucHV0ID0ge1xuICAgICAgICBsZXZlbDogJ3Nlbmlvcl9tb2RlcmF0b3InLFxuICAgICAgICBwZXJtaXNzaW9uczogWydNT0RFUkFURV9DT05URU5UJywgJ01BTkFHRV9SRVBPUlRTJywgJ0VTQ0FMQVRFX0lTU1VFUyddLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIHByaXNtYVNlcnZpY2UubW9kZXJhdG9yLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgIC4uLmJ1c2luZXNzTG9naWNVcGRhdGUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGRhdGUoJ3VzZXItMTIzJywgYnVzaW5lc3NMb2dpY1VwZGF0ZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubGV2ZWwpLnRvQmUoJ3Nlbmlvcl9tb2RlcmF0b3InKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGVybWlzc2lvbnMpLnRvQ29udGFpbignRVNDQUxBVEVfSVNTVUVTJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmlzQWN0aXZlKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZWRnZSBjYXNlcyBpbiBkYXRhIHZhbGlkYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlZGdlQ2FzZURhdGE6IFByaXNtYS5Nb2RlcmF0b3JDcmVhdGVJbnB1dCA9IHtcbiAgICAgICAgdXNlcklkOiAnJyxcbiAgICAgICAgcGVybWlzc2lvbnM6IFtdLFxuICAgICAgICBsZXZlbDogJycsXG4gICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlKGVkZ2VDYXNlRGF0YSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLm1vZGVyYXRvci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YTogZWRnZUNhc2VEYXRhLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9