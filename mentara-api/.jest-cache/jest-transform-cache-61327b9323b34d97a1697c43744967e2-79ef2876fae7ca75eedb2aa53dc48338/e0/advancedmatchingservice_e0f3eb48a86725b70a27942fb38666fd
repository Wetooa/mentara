e1a5c0030fa116268d4df77be1e066f3
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdvancedMatchingService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
let AdvancedMatchingService = class AdvancedMatchingService {
    prisma;
    defaultWeights = {
        conditionMatch: 0.4,
        approachCompatibility: 0.25,
        experienceAndSuccess: 0.2,
        reviewsAndRatings: 0.1,
        availabilityAndLogistics: 0.05,
    };
    severityWeights = {
        // Depression/Anxiety scales
        Minimal: 1,
        Mild: 2,
        Moderate: 3,
        'Moderately Severe': 4,
        Severe: 5,
        'Very Severe': 5,
        Extreme: 5,
        // General severity levels
        Low: 1,
        High: 4,
        Substantial: 4,
        // Clinical thresholds
        Subclinical: 1,
        Clinical: 4,
        Subthreshold: 2,
        // Binary indicators
        Positive: 4,
        Negative: 0,
        None: 0,
    };
    constructor(prisma) {
        this.prisma = prisma;
    }
    async calculateAdvancedMatch(client, therapist, weights = this.defaultWeights) {
        // Input validation to prevent runtime errors
        if (!client?.preAssessment) {
            throw new Error('Client must have a valid pre-assessment');
        }
        // Client preferences functionality removed - not supported in current schema
        if (!therapist?.user) {
            throw new Error('Therapist must have valid user information');
        }
        // Build user condition profile
        const userProfile = this.buildUserConditionProfile(client);
        // Calculate individual score components
        const conditionScore = this.calculateConditionMatchScore(userProfile, therapist);
        const approachScore = this.calculateApproachCompatibilityScore(userProfile, therapist);
        const experienceScore = this.calculateExperienceAndSuccessScore(userProfile, therapist);
        const reviewScore = await this.calculateReviewScore(therapist);
        const logisticsScore = this.calculateLogisticsScore(userProfile, therapist);
        // Calculate weighted total score
        const totalScore = Math.round(conditionScore * weights.conditionMatch +
            approachScore * weights.approachCompatibility +
            experienceScore * weights.experienceAndSuccess +
            reviewScore * weights.reviewsAndRatings +
            logisticsScore * weights.availabilityAndLogistics);
        // Build match explanation
        const matchExplanation = this.buildMatchExplanation(userProfile, therapist, conditionScore, approachScore, experienceScore, reviewScore);
        return {
            therapist,
            totalScore,
            breakdown: {
                conditionScore: Math.round(conditionScore),
                approachScore: Math.round(approachScore),
                experienceScore: Math.round(experienceScore),
                reviewScore: Math.round(reviewScore),
                logisticsScore: Math.round(logisticsScore),
            },
            matchExplanation,
        };
    }
    buildUserConditionProfile(client) {
        // Extract data from the answers JSON field
        const answers = client.preAssessment.answers;
        const severityLevels = answers?.severityLevels;
        const questionnaires = answers?.questionnaires;
        // Categorize conditions by severity
        const primaryConditions = [];
        const secondaryConditions = [];
        if (questionnaires && severityLevels) {
            questionnaires.forEach((condition) => {
                const severity = severityLevels[condition];
                const weight = this.severityWeights[severity] || 1;
                if (weight >= 4) {
                    primaryConditions.push({ condition, severity, weight });
                }
                else if (weight >= 2) {
                    secondaryConditions.push({ condition, severity, weight });
                }
            });
        }
        // Client preferences removed - using defaults
        return {
            primaryConditions,
            secondaryConditions,
            preferredApproaches: [],
            sessionPreferences: {
                format: ['online', 'in-person'],
                duration: [],
                frequency: 'weekly',
            },
            demographics: {
                ageRange: 'any',
                genderPreference: undefined,
                languagePreference: ['English'],
            },
            logistics: {
                maxHourlyRate: undefined,
                province: undefined,
                insuranceTypes: [],
            },
        };
    }
    /**
     * Calculates how well a therapist's expertise matches the client's mental health conditions.
     *
     * Scoring Logic:
     * - Primary conditions (severe, clinical): 30 points base, scaled by severity weight (1-5)
     * - Secondary conditions (moderate): 15 points base, scaled by severity weight
     * - Expertise depth bonus: 5 points per matched condition, max 20 bonus points
     * - Total score capped at 100 points
     *
     * @param userProfile Client's condition profile with severity weights
     * @param therapist Therapist with expertise and specialization arrays
     * @returns Score from 0-100 indicating condition match quality
     */
    calculateConditionMatchScore(userProfile, therapist) {
        let score = 0;
        const expertise = therapist.expertise || [];
        const specializations = therapist.illnessSpecializations || [];
        const allTherapistConditions = [...expertise, ...specializations];
        // Primary conditions scoring: most critical conditions get highest weight
        // Base score of 30 points, multiplied by severity ratio (weight/5)
        // Example: Severe depression (weight=5) = 30 * (5/5) = 30 points
        // Example: Moderate anxiety (weight=3) = 30 * (3/5) = 18 points
        userProfile.primaryConditions.forEach(({ condition, weight }) => {
            if (allTherapistConditions.includes(condition)) {
                score += 30 * (weight / 5); // Scale by severity (1-5 range)
            }
        });
        // Secondary conditions scoring: less critical but still important
        // Base score of 15 points, also scaled by severity
        userProfile.secondaryConditions.forEach(({ condition, weight }) => {
            if (allTherapistConditions.includes(condition)) {
                score += 15 * (weight / 5); // Scale by severity (1-5 range)
            }
        });
        // Expertise depth bonus: reward therapists who match multiple conditions
        // This indicates broader competency in the client's problem areas
        const matchedConditions = [
            ...userProfile.primaryConditions.map((c) => c.condition),
            ...userProfile.secondaryConditions.map((c) => c.condition),
        ].filter((condition) => allTherapistConditions.includes(condition));
        // 5 points per matched condition, capped at 20 to prevent overweighting
        const expertiseDepthBonus = Math.min(matchedConditions.length * 5, 20);
        score += expertiseDepthBonus;
        // Cap final score at 100 to maintain consistent scoring scale
        return Math.min(score, 100);
    }
    calculateApproachCompatibilityScore(userProfile, therapist) {
        let score = 0;
        const therapistApproaches = therapist.approaches || [];
        const therapistApproachesList = therapist.therapeuticApproachesUsedList || [];
        const allApproaches = [...therapistApproaches, ...therapistApproachesList];
        // If user has preferred approaches, match them
        if (userProfile.preferredApproaches.length > 0) {
            const matchedApproaches = userProfile.preferredApproaches.filter((approach) => allApproaches.includes(approach));
            score =
                (matchedApproaches.length / userProfile.preferredApproaches.length) *
                    100;
        }
        else {
            // If no preference specified, give points for evidence-based approaches
            const evidenceBasedApproaches = [
                'Cognitive Behavioral Therapy (CBT)',
                'Dialectical Behavior Therapy (DBT)',
                'Acceptance and Commitment Therapy (ACT)',
                'Eye Movement Desensitization and Reprocessing (EMDR)',
                'Mindfulness-Based Cognitive Therapy (MBCT)',
            ];
            const evidenceBasedCount = allApproaches.filter((approach) => evidenceBasedApproaches.includes(approach)).length;
            score = Math.min(evidenceBasedCount * 20, 80); // Max 80 for general evidence-based
        }
        // Bonus for comprehensive approach diversity
        const diversityBonus = Math.min(allApproaches.length * 2, 20);
        score += diversityBonus;
        return Math.min(score, 100);
    }
    /**
     * Calculates therapist experience and success rate score using a diminishing returns curve.
     *
     * Experience Scoring (70-90 points):
     * - Years 0-5: 8 points per year (0-40 points) - new therapist learning curve
     * - Years 5-10: 6 points per year (40-70 points) - experienced but still growing
     * - Years 10+: 2 points per year (70-90 points, max 20 bonus) - diminishing returns
     *
     * Success Rate Bonus (0-20 points):
     * - Based on therapist's documented success rates for client's specific conditions
     * - Averages success rates across all relevant conditions
     * - Scales linearly: 80% success rate = 16 bonus points
     *
     * @param userProfile Client's condition profile
     * @param therapist Therapist with experience and success rate data
     * @returns Score from 0-100 indicating experience quality
     */
    calculateExperienceAndSuccessScore(userProfile, therapist) {
        let score = 0;
        // Calculate total years of experience from multiple sources
        const yearsExperience = this.calculateYearsOfExperience(therapist.practiceStartDate);
        const additionalYears = therapist.yearsOfExperience || 0;
        const totalYears = Math.max(yearsExperience, additionalYears);
        // Experience scoring with diminishing returns curve
        // Reflects that experience gains are most valuable early in career
        if (totalYears <= 5) {
            // New therapists: high learning curve, significant improvement per year
            score += totalYears * 8; // 0-40 points for 0-5 years
        }
        else if (totalYears <= 10) {
            // Experienced therapists: still gaining skills but at slower rate
            score += 40 + (totalYears - 5) * 6; // 40-70 points for 5-10 years
        }
        else {
            // Senior therapists: diminishing returns, max practical benefit around 15-20 years
            score += 70 + Math.min((totalYears - 10) * 2, 20); // 70-90 points for 10+ years
        }
        // Treatment success rates bonus: reward documented effectiveness
        // Only considers success rates for conditions relevant to this specific client
        const successRates = therapist.treatmentSuccessRates || {};
        const relevantConditions = [
            ...userProfile.primaryConditions.map((c) => c.condition),
            ...userProfile.secondaryConditions.map((c) => c.condition),
        ];
        let successRateBonus = 0;
        let applicableRates = 0;
        // Calculate average success rate across all relevant conditions
        relevantConditions.forEach((condition) => {
            if (successRates[condition] !== undefined) {
                successRateBonus += successRates[condition];
                applicableRates++;
            }
        });
        if (applicableRates > 0) {
            const averageSuccessRate = successRateBonus / applicableRates;
            // Convert percentage to points: 100% success = 20 points, 50% = 10 points
            score += (averageSuccessRate / 100) * 20; // Up to 20 bonus points
        }
        return Math.min(score, 100);
    }
    async calculateReviewScore(therapist) {
        if (!therapist.reviews || therapist.reviews.length === 0) {
            return 50; // Neutral score for new therapists
        }
        const approvedReviews = therapist.reviews || [];
        if (approvedReviews.length === 0) {
            return 50;
        }
        // Calculate average rating
        const totalRating = approvedReviews.reduce((sum, review) => sum + review.rating, 0);
        const averageRating = totalRating / approvedReviews.length;
        // Convert 1-5 rating to 0-100 score
        let score = ((averageRating - 1) / 4) * 100;
        // Bonus for volume of reviews (credibility factor)
        const volumeBonus = Math.min(approvedReviews.length * 2, 20);
        score += volumeBonus;
        // Penalty for very few reviews
        if (approvedReviews.length < 3) {
            score *= 0.8; // 20% penalty for low review count
        }
        return Math.min(score, 100);
    }
    calculateLogisticsScore(userProfile, therapist) {
        let score = 100; // Start with perfect score, deduct for mismatches
        // Location matching
        if (userProfile.logistics.province &&
            therapist.province !== userProfile.logistics.province) {
            score -= 30; // Significant penalty for location mismatch
        }
        // Budget compatibility
        if (userProfile.logistics.maxHourlyRate &&
            Number(therapist.hourlyRate) > userProfile.logistics.maxHourlyRate) {
            score -= 40; // Major penalty for budget overrun
        }
        // Insurance compatibility
        if (userProfile.logistics.insuranceTypes &&
            userProfile.logistics.insuranceTypes.length > 0) {
            const acceptedTypes = therapist.acceptedInsuranceTypes || [];
            const hasInsuranceMatch = userProfile.logistics.insuranceTypes.some((type) => acceptedTypes.includes(type));
            if (!hasInsuranceMatch && therapist.acceptsInsurance) {
                score -= 20; // Penalty for insurance mismatch
            }
        }
        // Language compatibility
        const therapistLanguages = therapist.languagesOffered || ['English'];
        const hasLanguageMatch = userProfile.demographics.languagePreference.some((lang) => therapistLanguages.includes(lang));
        if (!hasLanguageMatch) {
            score -= 25; // Penalty for language barrier
        }
        return Math.max(score, 0);
    }
    buildMatchExplanation(userProfile, therapist, conditionScore, approachScore, experienceScore, reviewScore) {
        const expertise = therapist.expertise || [];
        const specializations = therapist.illnessSpecializations || [];
        const approaches = [
            ...(therapist.approaches || []),
            ...(therapist.therapeuticApproachesUsedList || []),
        ];
        const primaryMatches = userProfile.primaryConditions
            .map((c) => c.condition)
            .filter((condition) => [...expertise, ...specializations].includes(condition));
        const secondaryMatches = userProfile.secondaryConditions
            .map((c) => c.condition)
            .filter((condition) => [...expertise, ...specializations].includes(condition));
        const approachMatches = userProfile.preferredApproaches.filter((approach) => approaches.includes(approach));
        const experienceYears = this.calculateYearsOfExperience(therapist.practiceStartDate);
        const approvedReviews = therapist.reviews || [];
        const averageRating = approvedReviews.length > 0
            ? approvedReviews.reduce((sum, r) => sum + r.rating, 0) /
                approvedReviews.length
            : 0;
        const successRates = therapist.treatmentSuccessRates || {};
        return {
            primaryMatches,
            secondaryMatches,
            approachMatches,
            experienceYears: Math.max(experienceYears, therapist.yearsOfExperience || 0),
            averageRating: Math.round(averageRating * 10) / 10,
            totalReviews: approvedReviews.length,
            successRates,
        };
    }
    calculateYearsOfExperience(startDate) {
        const now = new Date();
        let years = now.getFullYear() - startDate.getFullYear();
        if (now.getMonth() < startDate.getMonth() ||
            (now.getMonth() === startDate.getMonth() &&
                now.getDate() < startDate.getDate())) {
            years--;
        }
        return Math.max(years, 0);
    }
};
exports.AdvancedMatchingService = AdvancedMatchingService;
exports.AdvancedMatchingService = AdvancedMatchingService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object])
], AdvancedMatchingService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9zZXJ2aWNlcy9hZHZhbmNlZC1tYXRjaGluZy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBNEM7QUFDNUMsbUZBQXVFO0FBMEZoRSxJQUFNLHVCQUF1QixHQUE3QixNQUFNLHVCQUF1QjtJQW1DTDtJQWxDWixjQUFjLEdBQW9CO1FBQ2pELGNBQWMsRUFBRSxHQUFHO1FBQ25CLHFCQUFxQixFQUFFLElBQUk7UUFDM0Isb0JBQW9CLEVBQUUsR0FBRztRQUN6QixpQkFBaUIsRUFBRSxHQUFHO1FBQ3RCLHdCQUF3QixFQUFFLElBQUk7S0FDL0IsQ0FBQztJQUVlLGVBQWUsR0FBb0I7UUFDbEQsNEJBQTRCO1FBQzVCLE9BQU8sRUFBRSxDQUFDO1FBQ1YsSUFBSSxFQUFFLENBQUM7UUFDUCxRQUFRLEVBQUUsQ0FBQztRQUNYLG1CQUFtQixFQUFFLENBQUM7UUFDdEIsTUFBTSxFQUFFLENBQUM7UUFDVCxhQUFhLEVBQUUsQ0FBQztRQUNoQixPQUFPLEVBQUUsQ0FBQztRQUVWLDBCQUEwQjtRQUMxQixHQUFHLEVBQUUsQ0FBQztRQUNOLElBQUksRUFBRSxDQUFDO1FBQ1AsV0FBVyxFQUFFLENBQUM7UUFFZCxzQkFBc0I7UUFDdEIsV0FBVyxFQUFFLENBQUM7UUFDZCxRQUFRLEVBQUUsQ0FBQztRQUNYLFlBQVksRUFBRSxDQUFDO1FBRWYsb0JBQW9CO1FBQ3BCLFFBQVEsRUFBRSxDQUFDO1FBQ1gsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLEVBQUUsQ0FBQztLQUNSLENBQUM7SUFFRixZQUE2QixNQUFxQjtRQUFyQixXQUFNLEdBQU4sTUFBTSxDQUFlO0lBQUcsQ0FBQztJQUV0RCxLQUFLLENBQUMsc0JBQXNCLENBQzFCLE1BQXlCLEVBQ3pCLFNBQStCLEVBQy9CLFVBQTJCLElBQUksQ0FBQyxjQUFjO1FBRTlDLDZDQUE2QztRQUM3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LFdBQVcsRUFBRSxHQUFHLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUV4RCxJQUNFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsR0FBRyxTQUFTLENBQUMsUUFBUSxFQUFFO1lBQ3JDLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxLQUFLLFNBQVMsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3RDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUMsRUFDdEMsQ0FBQztZQUNELEtBQUssRUFBRSxDQUFDO1FBQ1YsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztDQUNGLENBQUE7QUE1ZVksMERBQXVCO2tDQUF2Qix1QkFBdUI7SUFEbkMsSUFBQSxtQkFBVSxHQUFFO3lEQW9DMEIsc0NBQWEsb0JBQWIsc0NBQWE7R0FuQ3ZDLHVCQUF1QixDQTRlbkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9zZXJ2aWNlcy9hZHZhbmNlZC1tYXRjaGluZy5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHtcbiAgUHJlQXNzZXNzbWVudCxcbiAgVGhlcmFwaXN0LFxuICBDbGllbnQsXG4gIFVzZXIsXG4gIFJldmlldyxcbn0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBUeXBlIGRlZmluaXRpb25zIGZvciBtYXRjaGluZyBzZXJ2aWNlXG5leHBvcnQgdHlwZSBVc2VyRm9yTWF0Y2hpbmcgPSBQaWNrPFxuICBVc2VyLFxuICAnZmlyc3ROYW1lJyB8ICdsYXN0TmFtZScgfCAnYXZhdGFyVXJsJ1xuPjtcblxuZXhwb3J0IHR5cGUgUmV2aWV3Rm9yTWF0Y2hpbmcgPSBQaWNrPFJldmlldywgJ3JhdGluZyc+O1xuXG5leHBvcnQgdHlwZSBDbGllbnRGb3JNYXRjaGluZyA9IENsaWVudCAmIHtcbiAgcHJlQXNzZXNzbWVudDogUHJlQXNzZXNzbWVudDtcbiAgdXNlcjogVXNlckZvck1hdGNoaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgVGhlcmFwaXN0Rm9yTWF0Y2hpbmcgPSBUaGVyYXBpc3QgJiB7XG4gIHVzZXI6IFVzZXJGb3JNYXRjaGluZztcbiAgcmV2aWV3czogUmV2aWV3Rm9yTWF0Y2hpbmdbXTtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWF0Y2hpbmdXZWlnaHRzIHtcbiAgY29uZGl0aW9uTWF0Y2g6IG51bWJlcjsgLy8gNDAlXG4gIGFwcHJvYWNoQ29tcGF0aWJpbGl0eTogbnVtYmVyOyAvLyAyNSVcbiAgZXhwZXJpZW5jZUFuZFN1Y2Nlc3M6IG51bWJlcjsgLy8gMjAlXG4gIHJldmlld3NBbmRSYXRpbmdzOiBudW1iZXI7IC8vIDEwJVxuICBhdmFpbGFiaWxpdHlBbmRMb2dpc3RpY3M6IG51bWJlcjsgLy8gNSVcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUaGVyYXBpc3RTY29yZSB7XG4gIHRoZXJhcGlzdDogVGhlcmFwaXN0Rm9yTWF0Y2hpbmc7XG4gIHRvdGFsU2NvcmU6IG51bWJlcjtcbiAgYnJlYWtkb3duOiB7XG4gICAgY29uZGl0aW9uU2NvcmU6IG51bWJlcjtcbiAgICBhcHByb2FjaFNjb3JlOiBudW1iZXI7XG4gICAgZXhwZXJpZW5jZVNjb3JlOiBudW1iZXI7XG4gICAgcmV2aWV3U2NvcmU6IG51bWJlcjtcbiAgICBsb2dpc3RpY3NTY29yZTogbnVtYmVyO1xuICB9O1xuICBtYXRjaEV4cGxhbmF0aW9uOiB7XG4gICAgcHJpbWFyeU1hdGNoZXM6IHN0cmluZ1tdO1xuICAgIHNlY29uZGFyeU1hdGNoZXM6IHN0cmluZ1tdO1xuICAgIGFwcHJvYWNoTWF0Y2hlczogc3RyaW5nW107XG4gICAgZXhwZXJpZW5jZVllYXJzOiBudW1iZXI7XG4gICAgYXZlcmFnZVJhdGluZzogbnVtYmVyO1xuICAgIHRvdGFsUmV2aWV3czogbnVtYmVyO1xuICAgIHN1Y2Nlc3NSYXRlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXZlcml0eU1hcHBpbmcge1xuICBba2V5OiBzdHJpbmddOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlckNvbmRpdGlvblByb2ZpbGUge1xuICBwcmltYXJ5Q29uZGl0aW9uczogQXJyYXk8e1xuICAgIGNvbmRpdGlvbjogc3RyaW5nO1xuICAgIHNldmVyaXR5OiBzdHJpbmc7XG4gICAgd2VpZ2h0OiBudW1iZXI7XG4gIH0+O1xuICBzZWNvbmRhcnlDb25kaXRpb25zOiBBcnJheTx7XG4gICAgY29uZGl0aW9uOiBzdHJpbmc7XG4gICAgc2V2ZXJpdHk6IHN0cmluZztcbiAgICB3ZWlnaHQ6IG51bWJlcjtcbiAgfT47XG4gIHByZWZlcnJlZEFwcHJvYWNoZXM6IHN0cmluZ1tdO1xuICBzZXNzaW9uUHJlZmVyZW5jZXM6IHtcbiAgICBmb3JtYXQ6IHN0cmluZ1tdOyAvLyBvbmxpbmUsIGluLXBlcnNvbiwgaHlicmlkXG4gICAgZHVyYXRpb246IHN0cmluZ1tdO1xuICAgIGZyZXF1ZW5jeTogc3RyaW5nO1xuICB9O1xuICBkZW1vZ3JhcGhpY3M6IHtcbiAgICBhZ2VSYW5nZTogc3RyaW5nO1xuICAgIGdlbmRlclByZWZlcmVuY2U/OiBzdHJpbmc7XG4gICAgbGFuZ3VhZ2VQcmVmZXJlbmNlOiBzdHJpbmdbXTtcbiAgfTtcbiAgbG9naXN0aWNzOiB7XG4gICAgbWF4SG91cmx5UmF0ZT86IG51bWJlcjtcbiAgICBwcm92aW5jZT86IHN0cmluZztcbiAgICBpbnN1cmFuY2VUeXBlcz86IHN0cmluZ1tdO1xuICB9O1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQWR2YW5jZWRNYXRjaGluZ1NlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGRlZmF1bHRXZWlnaHRzOiBNYXRjaGluZ1dlaWdodHMgPSB7XG4gICAgY29uZGl0aW9uTWF0Y2g6IDAuNCxcbiAgICBhcHByb2FjaENvbXBhdGliaWxpdHk6IDAuMjUsXG4gICAgZXhwZXJpZW5jZUFuZFN1Y2Nlc3M6IDAuMixcbiAgICByZXZpZXdzQW5kUmF0aW5nczogMC4xLFxuICAgIGF2YWlsYWJpbGl0eUFuZExvZ2lzdGljczogMC4wNSxcbiAgfTtcblxuICBwcml2YXRlIHJlYWRvbmx5IHNldmVyaXR5V2VpZ2h0czogU2V2ZXJpdHlNYXBwaW5nID0ge1xuICAgIC8vIERlcHJlc3Npb24vQW54aWV0eSBzY2FsZXNcbiAgICBNaW5pbWFsOiAxLFxuICAgIE1pbGQ6IDIsXG4gICAgTW9kZXJhdGU6IDMsXG4gICAgJ01vZGVyYXRlbHkgU2V2ZXJlJzogNCxcbiAgICBTZXZlcmU6IDUsXG4gICAgJ1ZlcnkgU2V2ZXJlJzogNSxcbiAgICBFeHRyZW1lOiA1LFxuXG4gICAgLy8gR2VuZXJhbCBzZXZlcml0eSBsZXZlbHNcbiAgICBMb3c6IDEsXG4gICAgSGlnaDogNCxcbiAgICBTdWJzdGFudGlhbDogNCxcblxuICAgIC8vIENsaW5pY2FsIHRocmVzaG9sZHNcbiAgICBTdWJjbGluaWNhbDogMSxcbiAgICBDbGluaWNhbDogNCxcbiAgICBTdWJ0aHJlc2hvbGQ6IDIsXG5cbiAgICAvLyBCaW5hcnkgaW5kaWNhdG9yc1xuICAgIFBvc2l0aXZlOiA0LFxuICAgIE5lZ2F0aXZlOiAwLFxuICAgIE5vbmU6IDAsXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UpIHt9XG5cbiAgYXN5bmMgY2FsY3VsYXRlQWR2YW5jZWRNYXRjaChcbiAgICBjbGllbnQ6IENsaWVudEZvck1hdGNoaW5nLFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0Rm9yTWF0Y2hpbmcsXG4gICAgd2VpZ2h0czogTWF0Y2hpbmdXZWlnaHRzID0gdGhpcy5kZWZhdWx0V2VpZ2h0cyxcbiAgKTogUHJvbWlzZTxUaGVyYXBpc3RTY29yZT4ge1xuICAgIC8vIElucHV0IHZhbGlkYXRpb24gdG8gcHJldmVudCBydW50aW1lIGVycm9yc1xuICAgIGlmICghY2xpZW50Py5wcmVBc3Nlc3NtZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NsaWVudCBtdXN0IGhhdmUgYSB2YWxpZCBwcmUtYXNzZXNzbWVudCcpO1xuICAgIH1cblxuICAgIC8vIENsaWVudCBwcmVmZXJlbmNlcyBmdW5jdGlvbmFsaXR5IHJlbW92ZWQgLSBub3Qgc3VwcG9ydGVkIGluIGN1cnJlbnQgc2NoZW1hXG5cbiAgICBpZiAoIXRoZXJhcGlzdD8udXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyYXBpc3QgbXVzdCBoYXZlIHZhbGlkIHVzZXIgaW5mb3JtYXRpb24nKTtcbiAgICB9XG4gICAgLy8gQnVpbGQgdXNlciBjb25kaXRpb24gcHJvZmlsZVxuICAgIGNvbnN0IHVzZXJQcm9maWxlID0gdGhpcy5idWlsZFVzZXJDb25kaXRpb25Qcm9maWxlKGNsaWVudCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgaW5kaXZpZHVhbCBzY29yZSBjb21wb25lbnRzXG4gICAgY29uc3QgY29uZGl0aW9uU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUNvbmRpdGlvbk1hdGNoU2NvcmUoXG4gICAgICB1c2VyUHJvZmlsZSxcbiAgICAgIHRoZXJhcGlzdCxcbiAgICApO1xuICAgIGNvbnN0IGFwcHJvYWNoU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUFwcHJvYWNoQ29tcGF0aWJpbGl0eVNjb3JlKFxuICAgICAgdXNlclByb2ZpbGUsXG4gICAgICB0aGVyYXBpc3QsXG4gICAgKTtcbiAgICBjb25zdCBleHBlcmllbmNlU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUV4cGVyaWVuY2VBbmRTdWNjZXNzU2NvcmUoXG4gICAgICB1c2VyUHJvZmlsZSxcbiAgICAgIHRoZXJhcGlzdCxcbiAgICApO1xuICAgIGNvbnN0IHJldmlld1Njb3JlID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVSZXZpZXdTY29yZSh0aGVyYXBpc3QpO1xuICAgIGNvbnN0IGxvZ2lzdGljc1Njb3JlID0gdGhpcy5jYWxjdWxhdGVMb2dpc3RpY3NTY29yZSh1c2VyUHJvZmlsZSwgdGhlcmFwaXN0KTtcblxuICAgIC8vIENhbGN1bGF0ZSB3ZWlnaHRlZCB0b3RhbCBzY29yZVxuICAgIGNvbnN0IHRvdGFsU2NvcmUgPSBNYXRoLnJvdW5kKFxuICAgICAgY29uZGl0aW9uU2NvcmUgKiB3ZWlnaHRzLmNvbmRpdGlvbk1hdGNoICtcbiAgICAgICAgYXBwcm9hY2hTY29yZSAqIHdlaWdodHMuYXBwcm9hY2hDb21wYXRpYmlsaXR5ICtcbiAgICAgICAgZXhwZXJpZW5jZVNjb3JlICogd2VpZ2h0cy5leHBlcmllbmNlQW5kU3VjY2VzcyArXG4gICAgICAgIHJldmlld1Njb3JlICogd2VpZ2h0cy5yZXZpZXdzQW5kUmF0aW5ncyArXG4gICAgICAgIGxvZ2lzdGljc1Njb3JlICogd2VpZ2h0cy5hdmFpbGFiaWxpdHlBbmRMb2dpc3RpY3MsXG4gICAgKTtcblxuICAgIC8vIEJ1aWxkIG1hdGNoIGV4cGxhbmF0aW9uXG4gICAgY29uc3QgbWF0Y2hFeHBsYW5hdGlvbiA9IHRoaXMuYnVpbGRNYXRjaEV4cGxhbmF0aW9uKFxuICAgICAgdXNlclByb2ZpbGUsXG4gICAgICB0aGVyYXBpc3QsXG4gICAgICBjb25kaXRpb25TY29yZSxcbiAgICAgIGFwcHJvYWNoU2NvcmUsXG4gICAgICBleHBlcmllbmNlU2NvcmUsXG4gICAgICByZXZpZXdTY29yZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRoZXJhcGlzdCxcbiAgICAgIHRvdGFsU2NvcmUsXG4gICAgICBicmVha2Rvd246IHtcbiAgICAgICAgY29uZGl0aW9uU2NvcmU6IE1hdGgucm91bmQoY29uZGl0aW9uU2NvcmUpLFxuICAgICAgICBhcHByb2FjaFNjb3JlOiBNYXRoLnJvdW5kKGFwcHJvYWNoU2NvcmUpLFxuICAgICAgICBleHBlcmllbmNlU2NvcmU6IE1hdGgucm91bmQoZXhwZXJpZW5jZVNjb3JlKSxcbiAgICAgICAgcmV2aWV3U2NvcmU6IE1hdGgucm91bmQocmV2aWV3U2NvcmUpLFxuICAgICAgICBsb2dpc3RpY3NTY29yZTogTWF0aC5yb3VuZChsb2dpc3RpY3NTY29yZSksXG4gICAgICB9LFxuICAgICAgbWF0Y2hFeHBsYW5hdGlvbixcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFVzZXJDb25kaXRpb25Qcm9maWxlKFxuICAgIGNsaWVudDogQ2xpZW50Rm9yTWF0Y2hpbmcsXG4gICk6IFVzZXJDb25kaXRpb25Qcm9maWxlIHtcbiAgICAvLyBFeHRyYWN0IGRhdGEgZnJvbSB0aGUgYW5zd2VycyBKU09OIGZpZWxkXG4gICAgY29uc3QgYW5zd2VycyA9IGNsaWVudC5wcmVBc3Nlc3NtZW50LmFuc3dlcnMgYXMgYW55O1xuICAgIGNvbnN0IHNldmVyaXR5TGV2ZWxzID0gYW5zd2Vycz8uc2V2ZXJpdHlMZXZlbHMgYXMgUmVjb3JkPFxuICAgICAgc3RyaW5nLFxuICAgICAgc3RyaW5nXG4gICAgPjtcbiAgICBjb25zdCBxdWVzdGlvbm5haXJlcyA9IGFuc3dlcnM/LnF1ZXN0aW9ubmFpcmVzIGFzIHN0cmluZ1tdO1xuXG4gICAgLy8gQ2F0ZWdvcml6ZSBjb25kaXRpb25zIGJ5IHNldmVyaXR5XG4gICAgY29uc3QgcHJpbWFyeUNvbmRpdGlvbnM6IEFycmF5PHtcbiAgICAgIGNvbmRpdGlvbjogc3RyaW5nO1xuICAgICAgc2V2ZXJpdHk6IHN0cmluZztcbiAgICAgIHdlaWdodDogbnVtYmVyO1xuICAgIH0+ID0gW107XG4gICAgY29uc3Qgc2Vjb25kYXJ5Q29uZGl0aW9uczogQXJyYXk8e1xuICAgICAgY29uZGl0aW9uOiBzdHJpbmc7XG4gICAgICBzZXZlcml0eTogc3RyaW5nO1xuICAgICAgd2VpZ2h0OiBudW1iZXI7XG4gICAgfT4gPSBbXTtcblxuICAgIGlmIChxdWVzdGlvbm5haXJlcyAmJiBzZXZlcml0eUxldmVscykge1xuICAgICAgcXVlc3Rpb25uYWlyZXMuZm9yRWFjaCgoY29uZGl0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IHNldmVyaXR5ID0gc2V2ZXJpdHlMZXZlbHNbY29uZGl0aW9uXTtcbiAgICAgICAgY29uc3Qgd2VpZ2h0ID0gdGhpcy5zZXZlcml0eVdlaWdodHNbc2V2ZXJpdHldIHx8IDE7XG5cbiAgICAgICAgaWYgKHdlaWdodCA+PSA0KSB7XG4gICAgICAgICAgcHJpbWFyeUNvbmRpdGlvbnMucHVzaCh7IGNvbmRpdGlvbiwgc2V2ZXJpdHksIHdlaWdodCB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh3ZWlnaHQgPj0gMikge1xuICAgICAgICAgIHNlY29uZGFyeUNvbmRpdGlvbnMucHVzaCh7IGNvbmRpdGlvbiwgc2V2ZXJpdHksIHdlaWdodCB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2xpZW50IHByZWZlcmVuY2VzIHJlbW92ZWQgLSB1c2luZyBkZWZhdWx0c1xuICAgIHJldHVybiB7XG4gICAgICBwcmltYXJ5Q29uZGl0aW9ucyxcbiAgICAgIHNlY29uZGFyeUNvbmRpdGlvbnMsXG4gICAgICBwcmVmZXJyZWRBcHByb2FjaGVzOiBbXSxcbiAgICAgIHNlc3Npb25QcmVmZXJlbmNlczoge1xuICAgICAgICBmb3JtYXQ6IFsnb25saW5lJywgJ2luLXBlcnNvbiddLFxuICAgICAgICBkdXJhdGlvbjogW10sXG4gICAgICAgIGZyZXF1ZW5jeTogJ3dlZWtseScsXG4gICAgICB9LFxuICAgICAgZGVtb2dyYXBoaWNzOiB7XG4gICAgICAgIGFnZVJhbmdlOiAnYW55JyxcbiAgICAgICAgZ2VuZGVyUHJlZmVyZW5jZTogdW5kZWZpbmVkLFxuICAgICAgICBsYW5ndWFnZVByZWZlcmVuY2U6IFsnRW5nbGlzaCddLFxuICAgICAgfSxcbiAgICAgIGxvZ2lzdGljczoge1xuICAgICAgICBtYXhIb3VybHlSYXRlOiB1bmRlZmluZWQsXG4gICAgICAgIHByb3ZpbmNlOiB1bmRlZmluZWQsXG4gICAgICAgIGluc3VyYW5jZVR5cGVzOiBbXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGVzIGhvdyB3ZWxsIGEgdGhlcmFwaXN0J3MgZXhwZXJ0aXNlIG1hdGNoZXMgdGhlIGNsaWVudCdzIG1lbnRhbCBoZWFsdGggY29uZGl0aW9ucy5cbiAgICpcbiAgICogU2NvcmluZyBMb2dpYzpcbiAgICogLSBQcmltYXJ5IGNvbmRpdGlvbnMgKHNldmVyZSwgY2xpbmljYWwpOiAzMCBwb2ludHMgYmFzZSwgc2NhbGVkIGJ5IHNldmVyaXR5IHdlaWdodCAoMS01KVxuICAgKiAtIFNlY29uZGFyeSBjb25kaXRpb25zIChtb2RlcmF0ZSk6IDE1IHBvaW50cyBiYXNlLCBzY2FsZWQgYnkgc2V2ZXJpdHkgd2VpZ2h0XG4gICAqIC0gRXhwZXJ0aXNlIGRlcHRoIGJvbnVzOiA1IHBvaW50cyBwZXIgbWF0Y2hlZCBjb25kaXRpb24sIG1heCAyMCBib251cyBwb2ludHNcbiAgICogLSBUb3RhbCBzY29yZSBjYXBwZWQgYXQgMTAwIHBvaW50c1xuICAgKlxuICAgKiBAcGFyYW0gdXNlclByb2ZpbGUgQ2xpZW50J3MgY29uZGl0aW9uIHByb2ZpbGUgd2l0aCBzZXZlcml0eSB3ZWlnaHRzXG4gICAqIEBwYXJhbSB0aGVyYXBpc3QgVGhlcmFwaXN0IHdpdGggZXhwZXJ0aXNlIGFuZCBzcGVjaWFsaXphdGlvbiBhcnJheXNcbiAgICogQHJldHVybnMgU2NvcmUgZnJvbSAwLTEwMCBpbmRpY2F0aW5nIGNvbmRpdGlvbiBtYXRjaCBxdWFsaXR5XG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUNvbmRpdGlvbk1hdGNoU2NvcmUoXG4gICAgdXNlclByb2ZpbGU6IFVzZXJDb25kaXRpb25Qcm9maWxlLFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0LFxuICApOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDA7XG4gICAgY29uc3QgZXhwZXJ0aXNlID0gdGhlcmFwaXN0LmV4cGVydGlzZSB8fCBbXTtcbiAgICBjb25zdCBzcGVjaWFsaXphdGlvbnMgPSB0aGVyYXBpc3QuaWxsbmVzc1NwZWNpYWxpemF0aW9ucyB8fCBbXTtcbiAgICBjb25zdCBhbGxUaGVyYXBpc3RDb25kaXRpb25zID0gWy4uLmV4cGVydGlzZSwgLi4uc3BlY2lhbGl6YXRpb25zXTtcblxuICAgIC8vIFByaW1hcnkgY29uZGl0aW9ucyBzY29yaW5nOiBtb3N0IGNyaXRpY2FsIGNvbmRpdGlvbnMgZ2V0IGhpZ2hlc3Qgd2VpZ2h0XG4gICAgLy8gQmFzZSBzY29yZSBvZiAzMCBwb2ludHMsIG11bHRpcGxpZWQgYnkgc2V2ZXJpdHkgcmF0aW8gKHdlaWdodC81KVxuICAgIC8vIEV4YW1wbGU6IFNldmVyZSBkZXByZXNzaW9uICh3ZWlnaHQ9NSkgPSAzMCAqICg1LzUpID0gMzAgcG9pbnRzXG4gICAgLy8gRXhhbXBsZTogTW9kZXJhdGUgYW54aWV0eSAod2VpZ2h0PTMpID0gMzAgKiAoMy81KSA9IDE4IHBvaW50c1xuICAgIHVzZXJQcm9maWxlLnByaW1hcnlDb25kaXRpb25zLmZvckVhY2goKHsgY29uZGl0aW9uLCB3ZWlnaHQgfSkgPT4ge1xuICAgICAgaWYgKGFsbFRoZXJhcGlzdENvbmRpdGlvbnMuaW5jbHVkZXMoY29uZGl0aW9uKSkge1xuICAgICAgICBzY29yZSArPSAzMCAqICh3ZWlnaHQgLyA1KTsgLy8gU2NhbGUgYnkgc2V2ZXJpdHkgKDEtNSByYW5nZSlcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFNlY29uZGFyeSBjb25kaXRpb25zIHNjb3Jpbmc6IGxlc3MgY3JpdGljYWwgYnV0IHN0aWxsIGltcG9ydGFudFxuICAgIC8vIEJhc2Ugc2NvcmUgb2YgMTUgcG9pbnRzLCBhbHNvIHNjYWxlZCBieSBzZXZlcml0eVxuICAgIHVzZXJQcm9maWxlLnNlY29uZGFyeUNvbmRpdGlvbnMuZm9yRWFjaCgoeyBjb25kaXRpb24sIHdlaWdodCB9KSA9PiB7XG4gICAgICBpZiAoYWxsVGhlcmFwaXN0Q29uZGl0aW9ucy5pbmNsdWRlcyhjb25kaXRpb24pKSB7XG4gICAgICAgIHNjb3JlICs9IDE1ICogKHdlaWdodCAvIDUpOyAvLyBTY2FsZSBieSBzZXZlcml0eSAoMS01IHJhbmdlKVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gRXhwZXJ0aXNlIGRlcHRoIGJvbnVzOiByZXdhcmQgdGhlcmFwaXN0cyB3aG8gbWF0Y2ggbXVsdGlwbGUgY29uZGl0aW9uc1xuICAgIC8vIFRoaXMgaW5kaWNhdGVzIGJyb2FkZXIgY29tcGV0ZW5jeSBpbiB0aGUgY2xpZW50J3MgcHJvYmxlbSBhcmVhc1xuICAgIGNvbnN0IG1hdGNoZWRDb25kaXRpb25zID0gW1xuICAgICAgLi4udXNlclByb2ZpbGUucHJpbWFyeUNvbmRpdGlvbnMubWFwKChjKSA9PiBjLmNvbmRpdGlvbiksXG4gICAgICAuLi51c2VyUHJvZmlsZS5zZWNvbmRhcnlDb25kaXRpb25zLm1hcCgoYykgPT4gYy5jb25kaXRpb24pLFxuICAgIF0uZmlsdGVyKChjb25kaXRpb24pID0+IGFsbFRoZXJhcGlzdENvbmRpdGlvbnMuaW5jbHVkZXMoY29uZGl0aW9uKSk7XG5cbiAgICAvLyA1IHBvaW50cyBwZXIgbWF0Y2hlZCBjb25kaXRpb24sIGNhcHBlZCBhdCAyMCB0byBwcmV2ZW50IG92ZXJ3ZWlnaHRpbmdcbiAgICBjb25zdCBleHBlcnRpc2VEZXB0aEJvbnVzID0gTWF0aC5taW4obWF0Y2hlZENvbmRpdGlvbnMubGVuZ3RoICogNSwgMjApO1xuICAgIHNjb3JlICs9IGV4cGVydGlzZURlcHRoQm9udXM7XG5cbiAgICAvLyBDYXAgZmluYWwgc2NvcmUgYXQgMTAwIHRvIG1haW50YWluIGNvbnNpc3RlbnQgc2NvcmluZyBzY2FsZVxuICAgIHJldHVybiBNYXRoLm1pbihzY29yZSwgMTAwKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXBwcm9hY2hDb21wYXRpYmlsaXR5U2NvcmUoXG4gICAgdXNlclByb2ZpbGU6IFVzZXJDb25kaXRpb25Qcm9maWxlLFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0LFxuICApOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDA7XG4gICAgY29uc3QgdGhlcmFwaXN0QXBwcm9hY2hlcyA9IHRoZXJhcGlzdC5hcHByb2FjaGVzIHx8IFtdO1xuICAgIGNvbnN0IHRoZXJhcGlzdEFwcHJvYWNoZXNMaXN0ID1cbiAgICAgIHRoZXJhcGlzdC50aGVyYXBldXRpY0FwcHJvYWNoZXNVc2VkTGlzdCB8fCBbXTtcbiAgICBjb25zdCBhbGxBcHByb2FjaGVzID0gWy4uLnRoZXJhcGlzdEFwcHJvYWNoZXMsIC4uLnRoZXJhcGlzdEFwcHJvYWNoZXNMaXN0XTtcblxuICAgIC8vIElmIHVzZXIgaGFzIHByZWZlcnJlZCBhcHByb2FjaGVzLCBtYXRjaCB0aGVtXG4gICAgaWYgKHVzZXJQcm9maWxlLnByZWZlcnJlZEFwcHJvYWNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgbWF0Y2hlZEFwcHJvYWNoZXMgPSB1c2VyUHJvZmlsZS5wcmVmZXJyZWRBcHByb2FjaGVzLmZpbHRlcihcbiAgICAgICAgKGFwcHJvYWNoKSA9PiBhbGxBcHByb2FjaGVzLmluY2x1ZGVzKGFwcHJvYWNoKSxcbiAgICAgICk7XG5cbiAgICAgIHNjb3JlID1cbiAgICAgICAgKG1hdGNoZWRBcHByb2FjaGVzLmxlbmd0aCAvIHVzZXJQcm9maWxlLnByZWZlcnJlZEFwcHJvYWNoZXMubGVuZ3RoKSAqXG4gICAgICAgIDEwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgbm8gcHJlZmVyZW5jZSBzcGVjaWZpZWQsIGdpdmUgcG9pbnRzIGZvciBldmlkZW5jZS1iYXNlZCBhcHByb2FjaGVzXG4gICAgICBjb25zdCBldmlkZW5jZUJhc2VkQXBwcm9hY2hlcyA9IFtcbiAgICAgICAgJ0NvZ25pdGl2ZSBCZWhhdmlvcmFsIFRoZXJhcHkgKENCVCknLFxuICAgICAgICAnRGlhbGVjdGljYWwgQmVoYXZpb3IgVGhlcmFweSAoREJUKScsXG4gICAgICAgICdBY2NlcHRhbmNlIGFuZCBDb21taXRtZW50IFRoZXJhcHkgKEFDVCknLFxuICAgICAgICAnRXllIE1vdmVtZW50IERlc2Vuc2l0aXphdGlvbiBhbmQgUmVwcm9jZXNzaW5nIChFTURSKScsXG4gICAgICAgICdNaW5kZnVsbmVzcy1CYXNlZCBDb2duaXRpdmUgVGhlcmFweSAoTUJDVCknLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgZXZpZGVuY2VCYXNlZENvdW50ID0gYWxsQXBwcm9hY2hlcy5maWx0ZXIoKGFwcHJvYWNoKSA9PlxuICAgICAgICBldmlkZW5jZUJhc2VkQXBwcm9hY2hlcy5pbmNsdWRlcyhhcHByb2FjaCksXG4gICAgICApLmxlbmd0aDtcblxuICAgICAgc2NvcmUgPSBNYXRoLm1pbihldmlkZW5jZUJhc2VkQ291bnQgKiAyMCwgODApOyAvLyBNYXggODAgZm9yIGdlbmVyYWwgZXZpZGVuY2UtYmFzZWRcbiAgICB9XG5cbiAgICAvLyBCb251cyBmb3IgY29tcHJlaGVuc2l2ZSBhcHByb2FjaCBkaXZlcnNpdHlcbiAgICBjb25zdCBkaXZlcnNpdHlCb251cyA9IE1hdGgubWluKGFsbEFwcHJvYWNoZXMubGVuZ3RoICogMiwgMjApO1xuICAgIHNjb3JlICs9IGRpdmVyc2l0eUJvbnVzO1xuXG4gICAgcmV0dXJuIE1hdGgubWluKHNjb3JlLCAxMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZXMgdGhlcmFwaXN0IGV4cGVyaWVuY2UgYW5kIHN1Y2Nlc3MgcmF0ZSBzY29yZSB1c2luZyBhIGRpbWluaXNoaW5nIHJldHVybnMgY3VydmUuXG4gICAqXG4gICAqIEV4cGVyaWVuY2UgU2NvcmluZyAoNzAtOTAgcG9pbnRzKTpcbiAgICogLSBZZWFycyAwLTU6IDggcG9pbnRzIHBlciB5ZWFyICgwLTQwIHBvaW50cykgLSBuZXcgdGhlcmFwaXN0IGxlYXJuaW5nIGN1cnZlXG4gICAqIC0gWWVhcnMgNS0xMDogNiBwb2ludHMgcGVyIHllYXIgKDQwLTcwIHBvaW50cykgLSBleHBlcmllbmNlZCBidXQgc3RpbGwgZ3Jvd2luZ1xuICAgKiAtIFllYXJzIDEwKzogMiBwb2ludHMgcGVyIHllYXIgKDcwLTkwIHBvaW50cywgbWF4IDIwIGJvbnVzKSAtIGRpbWluaXNoaW5nIHJldHVybnNcbiAgICpcbiAgICogU3VjY2VzcyBSYXRlIEJvbnVzICgwLTIwIHBvaW50cyk6XG4gICAqIC0gQmFzZWQgb24gdGhlcmFwaXN0J3MgZG9jdW1lbnRlZCBzdWNjZXNzIHJhdGVzIGZvciBjbGllbnQncyBzcGVjaWZpYyBjb25kaXRpb25zXG4gICAqIC0gQXZlcmFnZXMgc3VjY2VzcyByYXRlcyBhY3Jvc3MgYWxsIHJlbGV2YW50IGNvbmRpdGlvbnNcbiAgICogLSBTY2FsZXMgbGluZWFybHk6IDgwJSBzdWNjZXNzIHJhdGUgPSAxNiBib251cyBwb2ludHNcbiAgICpcbiAgICogQHBhcmFtIHVzZXJQcm9maWxlIENsaWVudCdzIGNvbmRpdGlvbiBwcm9maWxlXG4gICAqIEBwYXJhbSB0aGVyYXBpc3QgVGhlcmFwaXN0IHdpdGggZXhwZXJpZW5jZSBhbmQgc3VjY2VzcyByYXRlIGRhdGFcbiAgICogQHJldHVybnMgU2NvcmUgZnJvbSAwLTEwMCBpbmRpY2F0aW5nIGV4cGVyaWVuY2UgcXVhbGl0eVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVFeHBlcmllbmNlQW5kU3VjY2Vzc1Njb3JlKFxuICAgIHVzZXJQcm9maWxlOiBVc2VyQ29uZGl0aW9uUHJvZmlsZSxcbiAgICB0aGVyYXBpc3Q6IFRoZXJhcGlzdCxcbiAgKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAwO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHllYXJzIG9mIGV4cGVyaWVuY2UgZnJvbSBtdWx0aXBsZSBzb3VyY2VzXG4gICAgY29uc3QgeWVhcnNFeHBlcmllbmNlID0gdGhpcy5jYWxjdWxhdGVZZWFyc09mRXhwZXJpZW5jZShcbiAgICAgIHRoZXJhcGlzdC5wcmFjdGljZVN0YXJ0RGF0ZSxcbiAgICApO1xuICAgIGNvbnN0IGFkZGl0aW9uYWxZZWFycyA9IHRoZXJhcGlzdC55ZWFyc09mRXhwZXJpZW5jZSB8fCAwO1xuICAgIGNvbnN0IHRvdGFsWWVhcnMgPSBNYXRoLm1heCh5ZWFyc0V4cGVyaWVuY2UsIGFkZGl0aW9uYWxZZWFycyk7XG5cbiAgICAvLyBFeHBlcmllbmNlIHNjb3Jpbmcgd2l0aCBkaW1pbmlzaGluZyByZXR1cm5zIGN1cnZlXG4gICAgLy8gUmVmbGVjdHMgdGhhdCBleHBlcmllbmNlIGdhaW5zIGFyZSBtb3N0IHZhbHVhYmxlIGVhcmx5IGluIGNhcmVlclxuICAgIGlmICh0b3RhbFllYXJzIDw9IDUpIHtcbiAgICAgIC8vIE5ldyB0aGVyYXBpc3RzOiBoaWdoIGxlYXJuaW5nIGN1cnZlLCBzaWduaWZpY2FudCBpbXByb3ZlbWVudCBwZXIgeWVhclxuICAgICAgc2NvcmUgKz0gdG90YWxZZWFycyAqIDg7IC8vIDAtNDAgcG9pbnRzIGZvciAwLTUgeWVhcnNcbiAgICB9IGVsc2UgaWYgKHRvdGFsWWVhcnMgPD0gMTApIHtcbiAgICAgIC8vIEV4cGVyaWVuY2VkIHRoZXJhcGlzdHM6IHN0aWxsIGdhaW5pbmcgc2tpbGxzIGJ1dCBhdCBzbG93ZXIgcmF0ZVxuICAgICAgc2NvcmUgKz0gNDAgKyAodG90YWxZZWFycyAtIDUpICogNjsgLy8gNDAtNzAgcG9pbnRzIGZvciA1LTEwIHllYXJzXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNlbmlvciB0aGVyYXBpc3RzOiBkaW1pbmlzaGluZyByZXR1cm5zLCBtYXggcHJhY3RpY2FsIGJlbmVmaXQgYXJvdW5kIDE1LTIwIHllYXJzXG4gICAgICBzY29yZSArPSA3MCArIE1hdGgubWluKCh0b3RhbFllYXJzIC0gMTApICogMiwgMjApOyAvLyA3MC05MCBwb2ludHMgZm9yIDEwKyB5ZWFyc1xuICAgIH1cblxuICAgIC8vIFRyZWF0bWVudCBzdWNjZXNzIHJhdGVzIGJvbnVzOiByZXdhcmQgZG9jdW1lbnRlZCBlZmZlY3RpdmVuZXNzXG4gICAgLy8gT25seSBjb25zaWRlcnMgc3VjY2VzcyByYXRlcyBmb3IgY29uZGl0aW9ucyByZWxldmFudCB0byB0aGlzIHNwZWNpZmljIGNsaWVudFxuICAgIGNvbnN0IHN1Y2Nlc3NSYXRlcyA9XG4gICAgICAodGhlcmFwaXN0LnRyZWF0bWVudFN1Y2Nlc3NSYXRlcyBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KSB8fCB7fTtcbiAgICBjb25zdCByZWxldmFudENvbmRpdGlvbnMgPSBbXG4gICAgICAuLi51c2VyUHJvZmlsZS5wcmltYXJ5Q29uZGl0aW9ucy5tYXAoKGMpID0+IGMuY29uZGl0aW9uKSxcbiAgICAgIC4uLnVzZXJQcm9maWxlLnNlY29uZGFyeUNvbmRpdGlvbnMubWFwKChjKSA9PiBjLmNvbmRpdGlvbiksXG4gICAgXTtcblxuICAgIGxldCBzdWNjZXNzUmF0ZUJvbnVzID0gMDtcbiAgICBsZXQgYXBwbGljYWJsZVJhdGVzID0gMDtcblxuICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIHN1Y2Nlc3MgcmF0ZSBhY3Jvc3MgYWxsIHJlbGV2YW50IGNvbmRpdGlvbnNcbiAgICByZWxldmFudENvbmRpdGlvbnMuZm9yRWFjaCgoY29uZGl0aW9uKSA9PiB7XG4gICAgICBpZiAoc3VjY2Vzc1JhdGVzW2NvbmRpdGlvbl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzdWNjZXNzUmF0ZUJvbnVzICs9IHN1Y2Nlc3NSYXRlc1tjb25kaXRpb25dO1xuICAgICAgICBhcHBsaWNhYmxlUmF0ZXMrKztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChhcHBsaWNhYmxlUmF0ZXMgPiAwKSB7XG4gICAgICBjb25zdCBhdmVyYWdlU3VjY2Vzc1JhdGUgPSBzdWNjZXNzUmF0ZUJvbnVzIC8gYXBwbGljYWJsZVJhdGVzO1xuICAgICAgLy8gQ29udmVydCBwZXJjZW50YWdlIHRvIHBvaW50czogMTAwJSBzdWNjZXNzID0gMjAgcG9pbnRzLCA1MCUgPSAxMCBwb2ludHNcbiAgICAgIHNjb3JlICs9IChhdmVyYWdlU3VjY2Vzc1JhdGUgLyAxMDApICogMjA7IC8vIFVwIHRvIDIwIGJvbnVzIHBvaW50c1xuICAgIH1cblxuICAgIHJldHVybiBNYXRoLm1pbihzY29yZSwgMTAwKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlUmV2aWV3U2NvcmUoXG4gICAgdGhlcmFwaXN0OiBUaGVyYXBpc3RGb3JNYXRjaGluZyxcbiAgKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBpZiAoIXRoZXJhcGlzdC5yZXZpZXdzIHx8IHRoZXJhcGlzdC5yZXZpZXdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIDUwOyAvLyBOZXV0cmFsIHNjb3JlIGZvciBuZXcgdGhlcmFwaXN0c1xuICAgIH1cblxuICAgIGNvbnN0IGFwcHJvdmVkUmV2aWV3cyA9IHRoZXJhcGlzdC5yZXZpZXdzIHx8IFtdO1xuXG4gICAgaWYgKGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiA1MDtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgYXZlcmFnZSByYXRpbmdcbiAgICBjb25zdCB0b3RhbFJhdGluZyA9IGFwcHJvdmVkUmV2aWV3cy5yZWR1Y2UoXG4gICAgICAoc3VtLCByZXZpZXcpID0+IHN1bSArIHJldmlldy5yYXRpbmcsXG4gICAgICAwLFxuICAgICk7XG4gICAgY29uc3QgYXZlcmFnZVJhdGluZyA9IHRvdGFsUmF0aW5nIC8gYXBwcm92ZWRSZXZpZXdzLmxlbmd0aDtcblxuICAgIC8vIENvbnZlcnQgMS01IHJhdGluZyB0byAwLTEwMCBzY29yZVxuICAgIGxldCBzY29yZSA9ICgoYXZlcmFnZVJhdGluZyAtIDEpIC8gNCkgKiAxMDA7XG5cbiAgICAvLyBCb251cyBmb3Igdm9sdW1lIG9mIHJldmlld3MgKGNyZWRpYmlsaXR5IGZhY3RvcilcbiAgICBjb25zdCB2b2x1bWVCb251cyA9IE1hdGgubWluKGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggKiAyLCAyMCk7XG4gICAgc2NvcmUgKz0gdm9sdW1lQm9udXM7XG5cbiAgICAvLyBQZW5hbHR5IGZvciB2ZXJ5IGZldyByZXZpZXdzXG4gICAgaWYgKGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggPCAzKSB7XG4gICAgICBzY29yZSAqPSAwLjg7IC8vIDIwJSBwZW5hbHR5IGZvciBsb3cgcmV2aWV3IGNvdW50XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWluKHNjb3JlLCAxMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVMb2dpc3RpY3NTY29yZShcbiAgICB1c2VyUHJvZmlsZTogVXNlckNvbmRpdGlvblByb2ZpbGUsXG4gICAgdGhlcmFwaXN0OiBUaGVyYXBpc3QsXG4gICk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMTAwOyAvLyBTdGFydCB3aXRoIHBlcmZlY3Qgc2NvcmUsIGRlZHVjdCBmb3IgbWlzbWF0Y2hlc1xuXG4gICAgLy8gTG9jYXRpb24gbWF0Y2hpbmdcbiAgICBpZiAoXG4gICAgICB1c2VyUHJvZmlsZS5sb2dpc3RpY3MucHJvdmluY2UgJiZcbiAgICAgIHRoZXJhcGlzdC5wcm92aW5jZSAhPT0gdXNlclByb2ZpbGUubG9naXN0aWNzLnByb3ZpbmNlXG4gICAgKSB7XG4gICAgICBzY29yZSAtPSAzMDsgLy8gU2lnbmlmaWNhbnQgcGVuYWx0eSBmb3IgbG9jYXRpb24gbWlzbWF0Y2hcbiAgICB9XG5cbiAgICAvLyBCdWRnZXQgY29tcGF0aWJpbGl0eVxuICAgIGlmIChcbiAgICAgIHVzZXJQcm9maWxlLmxvZ2lzdGljcy5tYXhIb3VybHlSYXRlICYmXG4gICAgICBOdW1iZXIodGhlcmFwaXN0LmhvdXJseVJhdGUpID4gdXNlclByb2ZpbGUubG9naXN0aWNzLm1heEhvdXJseVJhdGVcbiAgICApIHtcbiAgICAgIHNjb3JlIC09IDQwOyAvLyBNYWpvciBwZW5hbHR5IGZvciBidWRnZXQgb3ZlcnJ1blxuICAgIH1cblxuICAgIC8vIEluc3VyYW5jZSBjb21wYXRpYmlsaXR5XG4gICAgaWYgKFxuICAgICAgdXNlclByb2ZpbGUubG9naXN0aWNzLmluc3VyYW5jZVR5cGVzICYmXG4gICAgICB1c2VyUHJvZmlsZS5sb2dpc3RpY3MuaW5zdXJhbmNlVHlwZXMubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgY29uc3QgYWNjZXB0ZWRUeXBlcyA9IHRoZXJhcGlzdC5hY2NlcHRlZEluc3VyYW5jZVR5cGVzIHx8IFtdO1xuICAgICAgY29uc3QgaGFzSW5zdXJhbmNlTWF0Y2ggPSB1c2VyUHJvZmlsZS5sb2dpc3RpY3MuaW5zdXJhbmNlVHlwZXMuc29tZShcbiAgICAgICAgKHR5cGUpID0+IGFjY2VwdGVkVHlwZXMuaW5jbHVkZXModHlwZSksXG4gICAgICApO1xuXG4gICAgICBpZiAoIWhhc0luc3VyYW5jZU1hdGNoICYmIHRoZXJhcGlzdC5hY2NlcHRzSW5zdXJhbmNlKSB7XG4gICAgICAgIHNjb3JlIC09IDIwOyAvLyBQZW5hbHR5IGZvciBpbnN1cmFuY2UgbWlzbWF0Y2hcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBMYW5ndWFnZSBjb21wYXRpYmlsaXR5XG4gICAgY29uc3QgdGhlcmFwaXN0TGFuZ3VhZ2VzID0gdGhlcmFwaXN0Lmxhbmd1YWdlc09mZmVyZWQgfHwgWydFbmdsaXNoJ107XG4gICAgY29uc3QgaGFzTGFuZ3VhZ2VNYXRjaCA9IHVzZXJQcm9maWxlLmRlbW9ncmFwaGljcy5sYW5ndWFnZVByZWZlcmVuY2Uuc29tZShcbiAgICAgIChsYW5nKSA9PiB0aGVyYXBpc3RMYW5ndWFnZXMuaW5jbHVkZXMobGFuZyksXG4gICAgKTtcblxuICAgIGlmICghaGFzTGFuZ3VhZ2VNYXRjaCkge1xuICAgICAgc2NvcmUgLT0gMjU7IC8vIFBlbmFsdHkgZm9yIGxhbmd1YWdlIGJhcnJpZXJcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoc2NvcmUsIDApO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZE1hdGNoRXhwbGFuYXRpb24oXG4gICAgdXNlclByb2ZpbGU6IFVzZXJDb25kaXRpb25Qcm9maWxlLFxuICAgIHRoZXJhcGlzdDogVGhlcmFwaXN0Rm9yTWF0Y2hpbmcsXG4gICAgY29uZGl0aW9uU2NvcmU6IG51bWJlcixcbiAgICBhcHByb2FjaFNjb3JlOiBudW1iZXIsXG4gICAgZXhwZXJpZW5jZVNjb3JlOiBudW1iZXIsXG4gICAgcmV2aWV3U2NvcmU6IG51bWJlcixcbiAgKTogVGhlcmFwaXN0U2NvcmVbJ21hdGNoRXhwbGFuYXRpb24nXSB7XG4gICAgY29uc3QgZXhwZXJ0aXNlID0gdGhlcmFwaXN0LmV4cGVydGlzZSB8fCBbXTtcbiAgICBjb25zdCBzcGVjaWFsaXphdGlvbnMgPSB0aGVyYXBpc3QuaWxsbmVzc1NwZWNpYWxpemF0aW9ucyB8fCBbXTtcbiAgICBjb25zdCBhcHByb2FjaGVzID0gW1xuICAgICAgLi4uKHRoZXJhcGlzdC5hcHByb2FjaGVzIHx8IFtdKSxcbiAgICAgIC4uLih0aGVyYXBpc3QudGhlcmFwZXV0aWNBcHByb2FjaGVzVXNlZExpc3QgfHwgW10pLFxuICAgIF07XG5cbiAgICBjb25zdCBwcmltYXJ5TWF0Y2hlcyA9IHVzZXJQcm9maWxlLnByaW1hcnlDb25kaXRpb25zXG4gICAgICAubWFwKChjKSA9PiBjLmNvbmRpdGlvbilcbiAgICAgIC5maWx0ZXIoKGNvbmRpdGlvbikgPT5cbiAgICAgICAgWy4uLmV4cGVydGlzZSwgLi4uc3BlY2lhbGl6YXRpb25zXS5pbmNsdWRlcyhjb25kaXRpb24pLFxuICAgICAgKTtcblxuICAgIGNvbnN0IHNlY29uZGFyeU1hdGNoZXMgPSB1c2VyUHJvZmlsZS5zZWNvbmRhcnlDb25kaXRpb25zXG4gICAgICAubWFwKChjKSA9PiBjLmNvbmRpdGlvbilcbiAgICAgIC5maWx0ZXIoKGNvbmRpdGlvbikgPT5cbiAgICAgICAgWy4uLmV4cGVydGlzZSwgLi4uc3BlY2lhbGl6YXRpb25zXS5pbmNsdWRlcyhjb25kaXRpb24pLFxuICAgICAgKTtcblxuICAgIGNvbnN0IGFwcHJvYWNoTWF0Y2hlcyA9IHVzZXJQcm9maWxlLnByZWZlcnJlZEFwcHJvYWNoZXMuZmlsdGVyKChhcHByb2FjaCkgPT5cbiAgICAgIGFwcHJvYWNoZXMuaW5jbHVkZXMoYXBwcm9hY2gpLFxuICAgICk7XG5cbiAgICBjb25zdCBleHBlcmllbmNlWWVhcnMgPSB0aGlzLmNhbGN1bGF0ZVllYXJzT2ZFeHBlcmllbmNlKFxuICAgICAgdGhlcmFwaXN0LnByYWN0aWNlU3RhcnREYXRlLFxuICAgICk7XG5cbiAgICBjb25zdCBhcHByb3ZlZFJldmlld3MgPSB0aGVyYXBpc3QucmV2aWV3cyB8fCBbXTtcbiAgICBjb25zdCBhdmVyYWdlUmF0aW5nID1cbiAgICAgIGFwcHJvdmVkUmV2aWV3cy5sZW5ndGggPiAwXG4gICAgICAgID8gYXBwcm92ZWRSZXZpZXdzLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyByLnJhdGluZywgMCkgL1xuICAgICAgICAgIGFwcHJvdmVkUmV2aWV3cy5sZW5ndGhcbiAgICAgICAgOiAwO1xuXG4gICAgY29uc3Qgc3VjY2Vzc1JhdGVzID1cbiAgICAgICh0aGVyYXBpc3QudHJlYXRtZW50U3VjY2Vzc1JhdGVzIGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pIHx8IHt9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByaW1hcnlNYXRjaGVzLFxuICAgICAgc2Vjb25kYXJ5TWF0Y2hlcyxcbiAgICAgIGFwcHJvYWNoTWF0Y2hlcyxcbiAgICAgIGV4cGVyaWVuY2VZZWFyczogTWF0aC5tYXgoXG4gICAgICAgIGV4cGVyaWVuY2VZZWFycyxcbiAgICAgICAgdGhlcmFwaXN0LnllYXJzT2ZFeHBlcmllbmNlIHx8IDAsXG4gICAgICApLFxuICAgICAgYXZlcmFnZVJhdGluZzogTWF0aC5yb3VuZChhdmVyYWdlUmF0aW5nICogMTApIC8gMTAsXG4gICAgICB0b3RhbFJldmlld3M6IGFwcHJvdmVkUmV2aWV3cy5sZW5ndGgsXG4gICAgICBzdWNjZXNzUmF0ZXMsXG4gICAgfTtcbiAgfVxuXG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVZZWFyc09mRXhwZXJpZW5jZShzdGFydERhdGU6IERhdGUpOiBudW1iZXIge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IHllYXJzID0gbm93LmdldEZ1bGxZZWFyKCkgLSBzdGFydERhdGUuZ2V0RnVsbFllYXIoKTtcblxuICAgIGlmIChcbiAgICAgIG5vdy5nZXRNb250aCgpIDwgc3RhcnREYXRlLmdldE1vbnRoKCkgfHxcbiAgICAgIChub3cuZ2V0TW9udGgoKSA9PT0gc3RhcnREYXRlLmdldE1vbnRoKCkgJiZcbiAgICAgICAgbm93LmdldERhdGUoKSA8IHN0YXJ0RGF0ZS5nZXREYXRlKCkpXG4gICAgKSB7XG4gICAgICB5ZWFycy0tO1xuICAgIH1cblxuICAgIHJldHVybiBNYXRoLm1heCh5ZWFycywgMCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==