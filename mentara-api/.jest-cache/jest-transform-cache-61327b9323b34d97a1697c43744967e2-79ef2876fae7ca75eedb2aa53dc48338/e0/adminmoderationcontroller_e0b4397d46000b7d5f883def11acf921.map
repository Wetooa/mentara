{"version":3,"names":["common_1","cov_29vxmxqsah","s","require","admin_service_1","jwt_auth_guard_1","current_user_id_decorator_1","current_user_role_decorator_1","AdminModerationController","AdminModerationController_1","adminService","logger","Logger","name","constructor","f","getFlaggedContent","currentUserId","role","type","page","limit","b","ForbiddenException","log","pageNum","parseInt","limitNum","error","HttpException","HttpStatus","INTERNAL_SERVER_ERROR","moderateContent","contentType","contentId","moderationData","action","reason","exports","__decorate","Get","__param","CurrentUserId","CurrentUserRole","Query","Put","Param","Body","Controller","UseGuards","JwtAuthGuard","AdminService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-moderation.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  Body,\n  Param,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  Query,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { AdminService } from '../admin.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../../auth/decorators/current-user-role.decorator';\n\n@Controller('admin/moderation')\n@UseGuards(JwtAuthGuard)\nexport class AdminModerationController {\n  private readonly logger = new Logger(AdminModerationController.name);\n\n  constructor(private readonly adminService: AdminService) {}\n\n  @Get('flagged')\n  async getFlaggedContent(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Query('type') type?: string,\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving flagged content`);\n      const pageNum = page ? parseInt(page) : 1;\n      const limitNum = limit ? parseInt(limit) : 10;\n\n      return await this.adminService.getFlaggedContent({\n        type,\n        page: pageNum,\n        limit: limitNum,\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve flagged content:', error);\n      throw new HttpException(\n        'Failed to retrieve flagged content',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':contentType/:contentId/moderate')\n  async moderateContent(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('contentType') contentType: string,\n    @Param('contentId') contentId: string,\n    @Body()\n    moderationData: { action: 'approve' | 'remove' | 'flag'; reason?: string },\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(\n        `Admin ${currentUserId} moderating ${contentType} ${contentId}`,\n      );\n      return await this.adminService.moderateContent(\n        contentType,\n        contentId,\n        currentUserId,\n        moderationData.action,\n        moderationData.reason,\n      );\n    } catch (error) {\n      this.logger.error('Failed to moderate content:', error);\n      throw new HttpException(\n        'Failed to moderate content',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}