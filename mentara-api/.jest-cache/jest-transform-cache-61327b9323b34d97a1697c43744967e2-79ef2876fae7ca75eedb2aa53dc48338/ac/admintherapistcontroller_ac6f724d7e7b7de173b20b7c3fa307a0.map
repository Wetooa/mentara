{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-therapist.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-therapist.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Param,\n  Body,\n  Query,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Logger,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../../auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\nimport {\n  ApproveTherapistDtoSchema,\n  RejectTherapistDtoSchema,\n  UpdateTherapistStatusDtoSchema,\n  TherapistFiltersDtoSchema,\n} from '../validation/admin.schemas';\nimport type {\n  ApproveTherapistDto,\n  RejectTherapistDto,\n  UpdateTherapistStatusDto,\n  PendingTherapistFiltersDto,\n  TherapistApplicationDetailsResponse,\n  TherapistActionResponse,\n  TherapistApplicationMetricsResponse,\n  TherapistListResponse,\n} from '../types';\nimport { AdminTherapistService } from '../services/admin-therapist.service';\nimport { AdminResponseTransformer } from '../transformers/admin-response.transformer';\n\n@Controller('admin/therapists')\n@UseGuards(JwtAuthGuard)\nexport class AdminTherapistController {\n  private readonly logger = new Logger(AdminTherapistController.name);\n\n  constructor(private readonly adminTherapistService: AdminTherapistService) {}\n\n  @Get('pending')\n  @HttpCode(HttpStatus.OK)\n  async getPendingApplications(\n    @Query(new ZodValidationPipe(TherapistFiltersDtoSchema))\n    filters: PendingTherapistFiltersDto,\n    @CurrentUserId() adminId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<TherapistListResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(`Admin ${adminId} fetching pending therapist applications`);\n    const serviceResponse =\n      await this.adminTherapistService.getPendingApplications(filters);\n    return AdminResponseTransformer.transformTherapistList(serviceResponse);\n  }\n\n  @Get('applications')\n  @HttpCode(HttpStatus.OK)\n  async getAllApplications(\n    @Query(new ZodValidationPipe(TherapistFiltersDtoSchema))\n    filters: PendingTherapistFiltersDto,\n    @CurrentUserId() adminId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<TherapistListResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(`Admin ${adminId} fetching all therapist applications`);\n    const serviceResponse =\n      await this.adminTherapistService.getApplications(filters);\n    return AdminResponseTransformer.transformTherapistList(serviceResponse);\n  }\n\n  @Get(':id/details')\n  @HttpCode(HttpStatus.OK)\n  async getApplicationDetails(\n    @Param('id') therapistId: string,\n    @CurrentUserId() adminId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<TherapistApplicationDetailsResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(\n      `Admin ${adminId} viewing therapist application ${therapistId}`,\n    );\n    const serviceResponse =\n      await this.adminTherapistService.getApplicationDetails(therapistId);\n    return AdminResponseTransformer.transformApplicationDetails(\n      serviceResponse,\n    );\n  }\n\n  @Post(':id/approve')\n  @HttpCode(HttpStatus.OK)\n  async approveTherapist(\n    @Param('id') therapistId: string,\n    @Body(new ZodValidationPipe(ApproveTherapistDtoSchema))\n    approvalDto: ApproveTherapistDto,\n    @CurrentUserId() adminId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<TherapistActionResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(`Admin ${adminId} approving therapist ${therapistId}`);\n    const serviceResponse = await this.adminTherapistService.approveTherapist(\n      therapistId,\n      adminId,\n      approvalDto,\n    );\n    return AdminResponseTransformer.transformActionResponse(\n      serviceResponse,\n      therapistId,\n    );\n  }\n\n  @Post(':id/reject')\n  @HttpCode(HttpStatus.OK)\n  async rejectTherapist(\n    @Param('id') therapistId: string,\n    @Body(new ZodValidationPipe(RejectTherapistDtoSchema))\n    rejectionDto: RejectTherapistDto,\n    @CurrentUserId() adminId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<TherapistActionResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(`Admin ${adminId} rejecting therapist ${therapistId}`);\n    const serviceResponse = await this.adminTherapistService.rejectTherapist(\n      therapistId,\n      adminId,\n      rejectionDto,\n    );\n    return AdminResponseTransformer.transformActionResponse(\n      serviceResponse,\n      therapistId,\n    );\n  }\n\n  @Put(':id/status')\n  @HttpCode(HttpStatus.OK)\n  async updateTherapistStatus(\n    @Param('id') therapistId: string,\n    @Body(new ZodValidationPipe(UpdateTherapistStatusDtoSchema))\n    statusDto: UpdateTherapistStatusDto,\n    @CurrentUserId() adminId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<TherapistActionResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(\n      `Admin ${adminId} updating therapist ${therapistId} status to ${statusDto.status}`,\n    );\n    const serviceResponse =\n      await this.adminTherapistService.updateTherapistStatus(\n        therapistId,\n        adminId,\n        statusDto,\n      );\n    return AdminResponseTransformer.transformActionResponse(\n      serviceResponse,\n      therapistId,\n    );\n  }\n\n  @Get('metrics')\n  @HttpCode(HttpStatus.OK)\n  async getTherapistApplicationMetrics(\n    @Query('startDate') startDate?: string,\n    @Query('endDate') endDate?: string,\n    @CurrentUserId() adminId?: string,\n    @CurrentUserRole() role?: string,\n  ): Promise<TherapistApplicationMetricsResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    this.logger.log(`Admin ${adminId} fetching therapist application metrics`);\n    const serviceResponse =\n      await this.adminTherapistService.getTherapistApplicationMetrics(\n        startDate,\n        endDate,\n      );\n    return AdminResponseTransformer.transformApplicationMetrics(\n      serviceResponse,\n    );\n  }\n}\n"],"version":3}