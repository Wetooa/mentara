{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/meetings/meetings.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/meetings/meetings.service.ts"],"sourcesContent":["import {\n  Injectable,\n  Logger,\n  NotFoundException,\n  ForbiddenException,\n  BadRequestException,\n} from '@nestjs/common';\nimport { JwtService } from '@nestjs/jwt';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { EventBusService } from '../common/events/event-bus.service';\nimport {\n  MeetingConfirmedEvent,\n  MeetingStartedEvent,\n  MeetingCompletedEvent,\n  MeetingCancelledEvent,\n  MeetingEmergencyTerminatedEvent,\n} from '../common/events/booking-events';\nimport {\n  CreateVideoRoomDto,\n  JoinVideoRoomDto,\n  EndVideoCallDto,\n  VideoRoomResponse,\n  VideoCallStatus,\n  UpdateMeetingStatusDto,\n  SaveMeetingSessionDto,\n} from 'mentara-commons';\n\nexport interface MeetingSessionData {\n  meetingId: string;\n  startTime: Date;\n  endTime?: Date;\n  participantCount: number;\n  duration: number; // actual duration in minutes\n  recordingUrl?: string;\n  chatMessages?: any[];\n  techIssues?: string[];\n  quality?: {\n    videoQuality: 'poor' | 'fair' | 'good' | 'excellent';\n    audioQuality: 'poor' | 'fair' | 'good' | 'excellent';\n    connectionStability: 'poor' | 'fair' | 'good' | 'excellent';\n  };\n}\n\n@Injectable()\nexport class MeetingsService {\n  private readonly logger = new Logger(MeetingsService.name);\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly eventBus: EventBusService,\n    private readonly jwtService: JwtService,\n  ) {}\n\n  /**\n   * Get meeting details with access validation\n   */\n  async getMeetingById(meetingId: string, userId: string) {\n    const meeting = await this.prisma.meeting.findFirst({\n      where: {\n        id: meetingId,\n        OR: [{ clientId: userId }, { therapistId: userId }],\n      },\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                firstName: true,\n                lastName: true,\n                email: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                firstName: true,\n                lastName: true,\n                email: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!meeting) {\n      throw new NotFoundException('Meeting not found or access denied');\n    }\n\n    return meeting;\n  }\n\n  /**\n   * Get user's upcoming meetings\n   */\n  async getUpcomingMeetings(userId: string, limit = 10) {\n    const meetings = await this.prisma.meeting.findMany({\n      where: {\n        OR: [{ clientId: userId }, { therapistId: userId }],\n        status: { in: ['SCHEDULED', 'CONFIRMED'] },\n        startTime: { gte: new Date() },\n      },\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n      },\n      orderBy: { startTime: 'asc' },\n      take: limit,\n    });\n\n    return meetings;\n  }\n\n  /**\n   * Generate meeting room URL/token (for integration with video platforms)\n   */\n  async generateMeetingRoom(meetingId: string, userId: string) {\n    await this.getMeetingById(meetingId, userId);\n\n    // In a real implementation, this would integrate with video platforms like:\n    // - Zoom SDK\n    // - WebRTC/Jitsi\n    // - Twilio Video\n    // - Agora\n\n    const roomUrl = `${process.env.FRONTEND_URL}/meeting/${meetingId}`;\n    const roomToken = this.generateRoomToken(meetingId, userId, 'host');\n\n    // Update meeting with room URL\n    await this.prisma.meeting.update({\n      where: { id: meetingId },\n      data: { meetingUrl: roomUrl },\n    });\n\n    return {\n      roomUrl,\n      roomToken,\n      meetingId,\n      expires: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours\n    };\n  }\n\n  /**\n   * Validate meeting access for WebSocket connections\n   */\n  async validateMeetingAccess(\n    meetingId: string,\n    userId: string,\n  ): Promise<boolean> {\n    try {\n      const meeting = await this.prisma.meeting.findFirst({\n        where: {\n          id: meetingId,\n          OR: [{ clientId: userId }, { therapistId: userId }],\n          status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },\n        },\n      });\n\n      return !!meeting;\n    } catch (error) {\n      this.logger.error('Failed to validate meeting access:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get meeting analytics for therapists\n   */\n  async getMeetingAnalytics(\n    therapistId: string,\n    dateRange?: { start: Date; end: Date },\n  ) {\n    const whereClause: any = {\n      therapistId,\n      status: 'COMPLETED',\n    };\n\n    if (dateRange) {\n      whereClause.startTime = {\n        gte: dateRange.start,\n        lte: dateRange.end,\n      };\n    }\n\n    const meetings = await this.prisma.meeting.findMany({\n      where: whereClause,\n      include: {\n        sessionLogs: true,\n      },\n    });\n\n    const analytics = {\n      totalMeetings: meetings.length,\n      totalDuration: meetings.reduce((sum, m) => sum + m.duration, 0),\n      averageDuration:\n        meetings.length > 0\n          ? meetings.reduce((sum, m) => sum + m.duration, 0) / meetings.length\n          : 0,\n      meetingsByType: {\n        video: meetings.filter((m) => m.meetingType === 'video').length,\n        audio: meetings.filter((m) => m.meetingType === 'audio').length,\n        chat: meetings.filter((m) => m.meetingType === 'chat').length,\n      },\n      completionRate:\n        (meetings.filter((m) => m.status === 'COMPLETED').length /\n          meetings.length) *\n        100,\n    };\n\n    return analytics;\n  }\n\n  /**\n   * Generate secure room access token using JWT\n   */\n  private generateRoomToken(\n    meetingId: string,\n    userId: string,\n    role?: string,\n  ): string {\n    const payload = {\n      sub: userId,\n      meetingId,\n      role: role || 'participant',\n      type: 'meeting_access',\n      iat: Math.floor(Date.now() / 1000),\n    };\n\n    // Generate JWT with 24-hour expiration for meeting tokens\n    return this.jwtService.sign(payload, {\n      expiresIn: '24h',\n      issuer: 'mentara-meetings',\n      subject: userId,\n    });\n  }\n\n  /**\n   * Validate and decode room access token\n   */\n  private validateRoomToken(\n    token: string,\n  ): { userId: string; meetingId: string; role: string } | null {\n    try {\n      const decoded = this.jwtService.verify(token, {\n        issuer: 'mentara-meetings',\n      });\n\n      if (decoded.type !== 'meeting_access') {\n        return null;\n      }\n\n      return {\n        userId: decoded.sub,\n        meetingId: decoded.meetingId,\n        role: decoded.role,\n      };\n    } catch (error) {\n      this.logger.warn(\n        `Invalid room token: ${error instanceof Error ? error.message : String(error)}`,\n      );\n      return null;\n    }\n  }\n\n  /**\n   * Handle emergency meeting termination\n   */\n  async emergencyTerminateMeeting(\n    meetingId: string,\n    reason: string,\n    terminatedBy: string,\n  ) {\n    const meeting = await this.prisma.meeting.update({\n      where: { id: meetingId },\n      data: {\n        status: 'CANCELLED',\n      },\n    });\n\n    // Add emergency termination note\n    await this.prisma.meetingNotes.create({\n      data: {\n        id: `note_${Date.now()}`,\n        meetingId,\n        notes: `Emergency termination: ${reason}. Terminated by: ${terminatedBy}`,\n      },\n    });\n\n    void this.eventBus.emit(\n      new MeetingEmergencyTerminatedEvent({\n        meetingId,\n        clientId: meeting.clientId,\n        therapistId: meeting.therapistId,\n        terminatedBy,\n        terminatedAt: new Date(),\n        reason,\n      }),\n    );\n\n    this.logger.warn(\n      `Emergency termination of meeting ${meetingId}: ${reason}`,\n    );\n    return meeting;\n  }\n\n  // ===== VIDEO CALL INTEGRATION METHODS =====\n\n  /**\n   * Create a video room for a meeting\n   */\n  async createVideoRoom(\n    meetingId: string,\n    userId: string,\n    createRoomDto: CreateVideoRoomDto,\n  ): Promise<VideoRoomResponse> {\n    // Validate meeting access\n    const meeting = await this.getMeetingById(meetingId, userId);\n\n    if (meeting.status !== 'SCHEDULED' && meeting.status !== 'CONFIRMED') {\n      throw new BadRequestException(\n        'Meeting must be scheduled or confirmed to create video room',\n      );\n    }\n\n    // Update meeting status to IN_PROGRESS\n    await this.prisma.meeting.update({\n      where: { id: meetingId },\n      data: { status: 'IN_PROGRESS' },\n    });\n\n    // Generate video room data (in production, integrate with actual video service like Twilio/Zoom)\n    const roomId = `room_${meetingId}_${Date.now()}`;\n    const accessToken = this.generateRoomToken(meetingId, userId, 'host');\n    const participantToken = this.generateRoomToken(\n      meetingId,\n      userId,\n      'participant',\n    );\n\n    const videoRoomResponse: VideoRoomResponse = {\n      roomId,\n      roomUrl: `https://video.mentara.app/room/${roomId}`, // Replace with actual video service URL\n      accessToken,\n      participantToken,\n      roomConfig: {\n        maxParticipants: createRoomDto.maxParticipants,\n        enableRecording: createRoomDto.enableRecording,\n        enableChat: createRoomDto.enableChat,\n        recordingActive: false,\n      },\n      expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours\n      participantCount: 1,\n      status: 'waiting',\n    };\n\n    // Emit meeting started event\n    void this.eventBus.emit(\n      new MeetingStartedEvent({\n        meetingId,\n        clientId: meeting.clientId,\n        therapistId: meeting.therapistId,\n        startedAt: new Date(),\n        actualStartTime: new Date(),\n        scheduledStartTime: meeting.startTime,\n      }),\n    );\n\n    this.logger.log(`Video room created for meeting ${meetingId}`);\n    return videoRoomResponse;\n  }\n\n  /**\n   * Join an existing video room\n   */\n  async joinVideoRoom(\n    meetingId: string,\n    userId: string,\n    joinRoomDto: JoinVideoRoomDto,\n  ): Promise<VideoRoomResponse> {\n    // Validate meeting access\n    const meeting = await this.getMeetingById(meetingId, userId);\n\n    if (meeting.status !== 'IN_PROGRESS') {\n      throw new BadRequestException(\n        'Meeting must be in progress to join video room',\n      );\n    }\n\n    // Generate participant credentials\n    const roomId = `room_${meetingId}_${Date.now()}`;\n    const accessToken = this.generateRoomToken(\n      meetingId,\n      userId,\n      joinRoomDto.role,\n    );\n    const participantToken = this.generateRoomToken(\n      meetingId,\n      userId,\n      joinRoomDto.role,\n    );\n\n    const videoRoomResponse: VideoRoomResponse = {\n      roomId,\n      roomUrl: `https://video.mentara.app/room/${roomId}`,\n      accessToken,\n      participantToken,\n      roomConfig: {\n        maxParticipants: 2,\n        enableRecording: false,\n        enableChat: true,\n        recordingActive: false,\n      },\n      expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(),\n      participantCount: 2,\n      status: 'active',\n    };\n\n    this.logger.log(\n      `User ${userId} joined video room for meeting ${meetingId}`,\n    );\n    return videoRoomResponse;\n  }\n\n  /**\n   * Get video call status\n   */\n  async getVideoCallStatus(\n    meetingId: string,\n    userId: string,\n  ): Promise<VideoCallStatus> {\n    // Validate meeting access\n    const meeting = await this.getMeetingById(meetingId, userId);\n\n    // Mock video call status (in production, fetch from actual video service)\n    const videoCallStatus: VideoCallStatus = {\n      meetingId,\n      roomId: `room_${meetingId}`,\n      status: meeting.status === 'IN_PROGRESS' ? 'active' : 'waiting',\n      participants: [\n        {\n          id: meeting.clientId,\n          name: 'Client', // In production, fetch actual user names\n          role: 'client',\n          joinedAt: meeting.startTime.toISOString(),\n          connectionStatus: 'connected',\n        },\n        {\n          id: meeting.therapistId,\n          name: 'Therapist',\n          role: 'therapist',\n          joinedAt: meeting.startTime.toISOString(),\n          connectionStatus: 'connected',\n        },\n      ],\n      startedAt: meeting.startTime.toISOString(),\n      endedAt:\n        meeting.status === 'COMPLETED'\n          ? new Date(\n              meeting.startTime.getTime() + meeting.duration * 60000,\n            ).toISOString()\n          : undefined,\n      duration: meeting.status === 'COMPLETED' ? meeting.duration : undefined,\n    };\n\n    return videoCallStatus;\n  }\n\n  /**\n   * End video call\n   */\n  async endVideoCall(\n    meetingId: string,\n    userId: string,\n    endCallDto: EndVideoCallDto,\n  ): Promise<void> {\n    // Validate meeting access\n    const meeting = await this.getMeetingById(meetingId, userId);\n\n    // Update meeting status to completed\n    await this.prisma.meeting.update({\n      where: { id: meetingId },\n      data: {\n        status: 'COMPLETED',\n      },\n    });\n\n    // Save session summary if provided\n    if (endCallDto.sessionSummary) {\n      await this.prisma.sessionLog.create({\n        data: {\n          meetingId,\n          clientId: meeting.clientId,\n          therapistId: meeting.therapistId,\n          sessionType: 'REGULAR_THERAPY',\n          startTime: meeting.startTime,\n          endTime: new Date(),\n          duration: endCallDto.sessionSummary.duration,\n          status: 'COMPLETED',\n          platform: 'video',\n          notes: JSON.stringify({\n            endReason: endCallDto.endReason,\n            connectionQuality: endCallDto.sessionSummary.connectionQuality,\n            technicalIssues: endCallDto.sessionSummary.technicalIssues,\n            nextSteps: endCallDto.nextSteps,\n          }),\n        },\n      });\n    }\n\n    // Emit meeting completed event\n    void this.eventBus.emit(\n      new MeetingCompletedEvent({\n        meetingId,\n        clientId: meeting.clientId,\n        therapistId: meeting.therapistId,\n        completedAt: new Date(),\n        actualDuration: endCallDto.sessionSummary?.duration || meeting.duration,\n        scheduledDuration: meeting.duration,\n      }),\n    );\n\n    this.logger.log(\n      `Video call ended for meeting ${meetingId}: ${endCallDto.endReason}`,\n    );\n  }\n\n  /**\n   * Updated method to use new DTOs\n   */\n  async updateMeetingStatus(\n    meetingId: string,\n    userId: string,\n    updateStatusDto: UpdateMeetingStatusDto,\n  ) {\n    const meeting = await this.getMeetingById(meetingId, userId);\n\n    const updatedMeeting = await this.prisma.meeting.update({\n      where: { id: meetingId },\n      data: {\n        status: updateStatusDto.status.toUpperCase() as any,\n      },\n    });\n\n    // Emit appropriate events based on status\n    switch (updateStatusDto.status) {\n      case 'confirmed':\n        void this.eventBus.emit(\n          new MeetingConfirmedEvent({\n            meetingId,\n            clientId: meeting.clientId,\n            therapistId: meeting.therapistId,\n            confirmedAt: new Date(),\n            startTime: meeting.startTime,\n            duration: meeting.duration,\n          }),\n        );\n        break;\n      case 'cancelled':\n        void this.eventBus.emit(\n          new MeetingCancelledEvent({\n            meetingId,\n            clientId: meeting.clientId,\n            therapistId: meeting.therapistId,\n            cancelledBy: userId,\n            cancelledAt: new Date(),\n            cancellationReason: updateStatusDto.reason,\n            originalStartTime: meeting.startTime,\n          }),\n        );\n        break;\n    }\n\n    this.logger.log(\n      `Meeting ${meetingId} status updated to ${updateStatusDto.status}`,\n    );\n    return updatedMeeting;\n  }\n\n  /**\n   * Updated method to use new DTOs\n   */\n  async saveMeetingSession(\n    meetingId: string,\n    userId: string,\n    sessionData: SaveMeetingSessionDto,\n  ) {\n    // Validate meeting access\n    const meeting = await this.getMeetingById(meetingId, userId);\n\n    const session = await this.prisma.sessionLog.create({\n      data: {\n        meetingId,\n        clientId: meeting.clientId,\n        therapistId: meeting.therapistId,\n        sessionType: 'REGULAR_THERAPY',\n        startTime: new Date(sessionData.sessionData.startedAt),\n        endTime: new Date(sessionData.sessionData.endedAt),\n        duration: sessionData.sessionData.duration,\n        status: 'COMPLETED',\n        platform: 'video',\n        notes: JSON.stringify({\n          sessionNotes: sessionData.sessionNotes,\n          clientProgress: sessionData.clientProgress,\n          followUpActions: sessionData.followUpActions,\n          quality: sessionData.sessionData.quality,\n          issues: sessionData.sessionData.issues,\n        }),\n      },\n    });\n\n    this.logger.log(`Session data saved for meeting ${meetingId}`);\n    return session;\n  }\n}\n"],"version":3}