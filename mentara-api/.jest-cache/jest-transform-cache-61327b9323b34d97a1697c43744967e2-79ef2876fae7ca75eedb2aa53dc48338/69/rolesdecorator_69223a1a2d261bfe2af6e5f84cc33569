bf34961c76590191f46dcc2285038053
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModerationAccess = exports.AssessmentAccess = exports.TherapySessionAccess = exports.TherapistOrResourceOwner = exports.AdminOrResourceOwner = exports.AllowResourceOwner = exports.RESOURCE_OWNER_KEY = exports.RequirePermissions = exports.PERMISSIONS_KEY = exports.ClientOnly = exports.TherapistOrAdmin = exports.ModeratorOrAdmin = exports.AdminOnly = exports.Roles = exports.ROLES_KEY = void 0;
const common_1 = require("@nestjs/common");
// Role-based decorators
exports.ROLES_KEY = 'roles';
const Roles = (...roles) => (0, common_1.SetMetadata)(exports.ROLES_KEY, roles);
exports.Roles = Roles;
// Specific role decorators for convenience
const AdminOnly = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['admin']);
exports.AdminOnly = AdminOnly;
const ModeratorOrAdmin = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['moderator', 'admin']);
exports.ModeratorOrAdmin = ModeratorOrAdmin;
const TherapistOrAdmin = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['therapist', 'admin']);
exports.TherapistOrAdmin = TherapistOrAdmin;
const ClientOnly = () => (0, common_1.SetMetadata)(exports.ROLES_KEY, ['client']);
exports.ClientOnly = ClientOnly;
// Permission-based decorators
exports.PERMISSIONS_KEY = 'permissions';
const RequirePermissions = (...permissions) => (0, common_1.SetMetadata)(exports.PERMISSIONS_KEY, permissions);
exports.RequirePermissions = RequirePermissions;
// Resource ownership decorator
exports.RESOURCE_OWNER_KEY = 'resource_owner';
const AllowResourceOwner = (paramName = 'id') => (0, common_1.SetMetadata)(exports.RESOURCE_OWNER_KEY, paramName);
exports.AllowResourceOwner = AllowResourceOwner;
// Combined decorators for common scenarios
const AdminOrResourceOwner = (paramName = 'id') => (target, propertyKey, descriptor) => {
    (0, common_1.SetMetadata)(exports.ROLES_KEY, ['admin'])(target, propertyKey, descriptor);
    (0, common_1.SetMetadata)(exports.RESOURCE_OWNER_KEY, paramName)(target, propertyKey, descriptor);
};
exports.AdminOrResourceOwner = AdminOrResourceOwner;
const TherapistOrResourceOwner = (paramName = 'id') => (target, propertyKey, descriptor) => {
    (0, common_1.SetMetadata)(exports.ROLES_KEY, ['therapist', 'admin'])(target, propertyKey, descriptor);
    (0, common_1.SetMetadata)(exports.RESOURCE_OWNER_KEY, paramName)(target, propertyKey, descriptor);
};
exports.TherapistOrResourceOwner = TherapistOrResourceOwner;
// Therapy session access (therapist assigned to client or admin)
const TherapySessionAccess = () => (0, exports.RequirePermissions)('sessions:read:own', 'sessions:read:all');
exports.TherapySessionAccess = TherapySessionAccess;
// Assessment access (client's own assessments, assigned therapist, or admin)
const AssessmentAccess = () => (0, exports.RequirePermissions)('assessments:read:own', 'assessments:read:assigned', 'assessments:read:all');
exports.AssessmentAccess = AssessmentAccess;
// Moderation access (moderators and admins)
const ModerationAccess = () => (0, exports.RequirePermissions)('posts:moderate', 'communities:moderate', 'messages:moderate');
exports.ModerationAccess = ModerationAccess;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvZGVjb3JhdG9ycy9yb2xlcy5kZWNvcmF0b3IudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMkNBQTZDO0FBRTdDLHdCQUF3QjtBQUNYLFFBQUEsU0FBUyxHQUFHLE9BQU8sQ0FBQztBQUMxQixNQUFNLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBZSxFQUFFLEVBQUUsQ0FBQyxJQUFBLG9CQUFXLEVBQUMsaUJBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUE5RCxRQUFBLEtBQUssU0FBeUQ7QUFFM0UsMkNBQTJDO0FBQ3BDLE1BQU0sU0FBUyxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUEsb0JBQVcsRUFBQyxpQkFBUyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUFwRCxRQUFBLFNBQVMsYUFBMkM7QUFDMUQsTUFBTSxnQkFBZ0IsR0FBRyxHQUFHLEVBQUUsQ0FDbkMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQURwQyxRQUFBLGdCQUFnQixvQkFDb0I7QUFDMUMsTUFBTSxnQkFBZ0IsR0FBRyxHQUFHLEVBQUUsQ0FDbkMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQURwQyxRQUFBLGdCQUFnQixvQkFDb0I7QUFDMUMsTUFBTSxVQUFVLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQXRELFFBQUEsVUFBVSxjQUE0QztBQUVuRSw4QkFBOEI7QUFDakIsUUFBQSxlQUFlLEdBQUcsYUFBYSxDQUFDO0FBQ3RDLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxHQUFHLFdBQXFCLEVBQUUsRUFBRSxDQUM3RCxJQUFBLG9CQUFXLEVBQUMsdUJBQWUsRUFBRSxXQUFXLENBQUMsQ0FBQztBQUQvQixRQUFBLGtCQUFrQixzQkFDYTtBQUU1QywrQkFBK0I7QUFDbEIsUUFBQSxrQkFBa0IsR0FBRyxnQkFBZ0IsQ0FBQztBQUM1QyxNQUFNLGtCQUFrQixHQUFHLENBQUMsWUFBb0IsSUFBSSxFQUFFLEVBQUUsQ0FDN0QsSUFBQSxvQkFBVyxFQUFDLDBCQUFrQixFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBRGhDLFFBQUEsa0JBQWtCLHNCQUNjO0FBRTdDLDJDQUEyQztBQUNwQyxNQUFNLG9CQUFvQixHQUMvQixDQUFDLFlBQW9CLElBQUksRUFBRSxFQUFFLENBQzdCLENBQUMsTUFBVyxFQUFFLFdBQW1CLEVBQUUsVUFBOEIsRUFBRSxFQUFFO0lBQ25FLElBQUEsb0JBQVcsRUFBQyxpQkFBUyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ25FLElBQUEsb0JBQVcsRUFBQywwQkFBa0IsRUFBRSxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQzlFLENBQUMsQ0FBQztBQUxTLFFBQUEsb0JBQW9CLHdCQUs3QjtBQUVHLE1BQU0sd0JBQXdCLEdBQ25DLENBQUMsWUFBb0IsSUFBSSxFQUFFLEVBQUUsQ0FDN0IsQ0FBQyxNQUFXLEVBQUUsV0FBbUIsRUFBRSxVQUE4QixFQUFFLEVBQUU7SUFDbkUsSUFBQSxvQkFBVyxFQUFDLGlCQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FDNUMsTUFBTSxFQUNOLFdBQVcsRUFDWCxVQUFVLENBQ1gsQ0FBQztJQUNGLElBQUEsb0JBQVcsRUFBQywwQkFBa0IsRUFBRSxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQzlFLENBQUMsQ0FBQztBQVRTLFFBQUEsd0JBQXdCLDRCQVNqQztBQUVKLGlFQUFpRTtBQUMxRCxNQUFNLG9CQUFvQixHQUFHLEdBQUcsRUFBRSxDQUN2QyxJQUFBLDBCQUFrQixFQUFDLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLENBQUM7QUFEbEQsUUFBQSxvQkFBb0Isd0JBQzhCO0FBRS9ELDZFQUE2RTtBQUN0RSxNQUFNLGdCQUFnQixHQUFHLEdBQUcsRUFBRSxDQUNuQyxJQUFBLDBCQUFrQixFQUNoQixzQkFBc0IsRUFDdEIsMkJBQTJCLEVBQzNCLHNCQUFzQixDQUN2QixDQUFDO0FBTFMsUUFBQSxnQkFBZ0Isb0JBS3pCO0FBRUosNENBQTRDO0FBQ3JDLE1BQU0sZ0JBQWdCLEdBQUcsR0FBRyxFQUFFLENBQ25DLElBQUEsMEJBQWtCLEVBQ2hCLGdCQUFnQixFQUNoQixzQkFBc0IsRUFDdEIsbUJBQW1CLENBQ3BCLENBQUM7QUFMUyxRQUFBLGdCQUFnQixvQkFLekIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvZGVjb3JhdG9ycy9yb2xlcy5kZWNvcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2V0TWV0YWRhdGEgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5cbi8vIFJvbGUtYmFzZWQgZGVjb3JhdG9yc1xuZXhwb3J0IGNvbnN0IFJPTEVTX0tFWSA9ICdyb2xlcyc7XG5leHBvcnQgY29uc3QgUm9sZXMgPSAoLi4ucm9sZXM6IHN0cmluZ1tdKSA9PiBTZXRNZXRhZGF0YShST0xFU19LRVksIHJvbGVzKTtcblxuLy8gU3BlY2lmaWMgcm9sZSBkZWNvcmF0b3JzIGZvciBjb252ZW5pZW5jZVxuZXhwb3J0IGNvbnN0IEFkbWluT25seSA9ICgpID0+IFNldE1ldGFkYXRhKFJPTEVTX0tFWSwgWydhZG1pbiddKTtcbmV4cG9ydCBjb25zdCBNb2RlcmF0b3JPckFkbWluID0gKCkgPT5cbiAgU2V0TWV0YWRhdGEoUk9MRVNfS0VZLCBbJ21vZGVyYXRvcicsICdhZG1pbiddKTtcbmV4cG9ydCBjb25zdCBUaGVyYXBpc3RPckFkbWluID0gKCkgPT5cbiAgU2V0TWV0YWRhdGEoUk9MRVNfS0VZLCBbJ3RoZXJhcGlzdCcsICdhZG1pbiddKTtcbmV4cG9ydCBjb25zdCBDbGllbnRPbmx5ID0gKCkgPT4gU2V0TWV0YWRhdGEoUk9MRVNfS0VZLCBbJ2NsaWVudCddKTtcblxuLy8gUGVybWlzc2lvbi1iYXNlZCBkZWNvcmF0b3JzXG5leHBvcnQgY29uc3QgUEVSTUlTU0lPTlNfS0VZID0gJ3Blcm1pc3Npb25zJztcbmV4cG9ydCBjb25zdCBSZXF1aXJlUGVybWlzc2lvbnMgPSAoLi4ucGVybWlzc2lvbnM6IHN0cmluZ1tdKSA9PlxuICBTZXRNZXRhZGF0YShQRVJNSVNTSU9OU19LRVksIHBlcm1pc3Npb25zKTtcblxuLy8gUmVzb3VyY2Ugb3duZXJzaGlwIGRlY29yYXRvclxuZXhwb3J0IGNvbnN0IFJFU09VUkNFX09XTkVSX0tFWSA9ICdyZXNvdXJjZV9vd25lcic7XG5leHBvcnQgY29uc3QgQWxsb3dSZXNvdXJjZU93bmVyID0gKHBhcmFtTmFtZTogc3RyaW5nID0gJ2lkJykgPT5cbiAgU2V0TWV0YWRhdGEoUkVTT1VSQ0VfT1dORVJfS0VZLCBwYXJhbU5hbWUpO1xuXG4vLyBDb21iaW5lZCBkZWNvcmF0b3JzIGZvciBjb21tb24gc2NlbmFyaW9zXG5leHBvcnQgY29uc3QgQWRtaW5PclJlc291cmNlT3duZXIgPVxuICAocGFyYW1OYW1lOiBzdHJpbmcgPSAnaWQnKSA9PlxuICAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikgPT4ge1xuICAgIFNldE1ldGFkYXRhKFJPTEVTX0tFWSwgWydhZG1pbiddKSh0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKTtcbiAgICBTZXRNZXRhZGF0YShSRVNPVVJDRV9PV05FUl9LRVksIHBhcmFtTmFtZSkodGFyZ2V0LCBwcm9wZXJ0eUtleSwgZGVzY3JpcHRvcik7XG4gIH07XG5cbmV4cG9ydCBjb25zdCBUaGVyYXBpc3RPclJlc291cmNlT3duZXIgPVxuICAocGFyYW1OYW1lOiBzdHJpbmcgPSAnaWQnKSA9PlxuICAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikgPT4ge1xuICAgIFNldE1ldGFkYXRhKFJPTEVTX0tFWSwgWyd0aGVyYXBpc3QnLCAnYWRtaW4nXSkoXG4gICAgICB0YXJnZXQsXG4gICAgICBwcm9wZXJ0eUtleSxcbiAgICAgIGRlc2NyaXB0b3IsXG4gICAgKTtcbiAgICBTZXRNZXRhZGF0YShSRVNPVVJDRV9PV05FUl9LRVksIHBhcmFtTmFtZSkodGFyZ2V0LCBwcm9wZXJ0eUtleSwgZGVzY3JpcHRvcik7XG4gIH07XG5cbi8vIFRoZXJhcHkgc2Vzc2lvbiBhY2Nlc3MgKHRoZXJhcGlzdCBhc3NpZ25lZCB0byBjbGllbnQgb3IgYWRtaW4pXG5leHBvcnQgY29uc3QgVGhlcmFweVNlc3Npb25BY2Nlc3MgPSAoKSA9PlxuICBSZXF1aXJlUGVybWlzc2lvbnMoJ3Nlc3Npb25zOnJlYWQ6b3duJywgJ3Nlc3Npb25zOnJlYWQ6YWxsJyk7XG5cbi8vIEFzc2Vzc21lbnQgYWNjZXNzIChjbGllbnQncyBvd24gYXNzZXNzbWVudHMsIGFzc2lnbmVkIHRoZXJhcGlzdCwgb3IgYWRtaW4pXG5leHBvcnQgY29uc3QgQXNzZXNzbWVudEFjY2VzcyA9ICgpID0+XG4gIFJlcXVpcmVQZXJtaXNzaW9ucyhcbiAgICAnYXNzZXNzbWVudHM6cmVhZDpvd24nLFxuICAgICdhc3Nlc3NtZW50czpyZWFkOmFzc2lnbmVkJyxcbiAgICAnYXNzZXNzbWVudHM6cmVhZDphbGwnLFxuICApO1xuXG4vLyBNb2RlcmF0aW9uIGFjY2VzcyAobW9kZXJhdG9ycyBhbmQgYWRtaW5zKVxuZXhwb3J0IGNvbnN0IE1vZGVyYXRpb25BY2Nlc3MgPSAoKSA9PlxuICBSZXF1aXJlUGVybWlzc2lvbnMoXG4gICAgJ3Bvc3RzOm1vZGVyYXRlJyxcbiAgICAnY29tbXVuaXRpZXM6bW9kZXJhdGUnLFxuICAgICdtZXNzYWdlczptb2RlcmF0ZScsXG4gICk7XG4iXSwidmVyc2lvbiI6M30=