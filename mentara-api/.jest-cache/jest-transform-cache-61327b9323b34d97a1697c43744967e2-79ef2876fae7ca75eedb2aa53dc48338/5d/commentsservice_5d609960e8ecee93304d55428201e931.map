{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/comments/comments.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/comments/comments.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  ForbiddenException,\n  InternalServerErrorException,\n} from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { Comment, Prisma, User, Reply } from '@prisma/client';\nimport { CommentCreateInputDto, CommentUpdateInputDto } from 'mentara-commons';\n\n// Define local response type to match actual return structure\ninterface CommentResponse {\n  id: string;\n  createdAt: Date;\n  updatedAt: Date;\n  postId: string;\n  userId: string;\n  content: string;\n  parentId: string | null;\n  attachmentUrls: string[];\n  attachmentNames: string[];\n  attachmentSizes: number[];\n  user?: any;\n  hearts?: number; // This is the count, not an array\n  files?: any[];\n  heartCount?: number;\n  replyCount?: number;\n  isHearted?: boolean;\n}\n\n@Injectable()\nexport class CommentsService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  async findUserById(id: string): Promise<User | null> {\n    try {\n      return await this.prisma.user.findUnique({ where: { id } });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findAll(userId?: string): Promise<Comment[]> {\n    try {\n      return await this.prisma.comment.findMany({\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          post: {\n            select: {\n              id: true,\n              title: true,\n            },\n          },\n          replies: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n          hearts: userId\n            ? {\n                where: {\n                  userId,\n                },\n              }\n            : false,\n          _count: {\n            select: {\n              replies: true,\n              hearts: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findOne(id: string): Promise<CommentResponse> {\n    try {\n      const comment = await this.prisma.comment.findUnique({\n        where: { id },\n        include: {\n          user: true,\n          replies: {\n            include: {\n              user: true,\n            },\n          },\n          hearts: true,\n        },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      return {\n        ...comment,\n        hearts: comment.hearts.length, // Count hearts instead of returning array\n        files: [], // No longer using centralized file system\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findByPostId(postId: string, userId?: string): Promise<Comment[]> {\n    try {\n      return await this.prisma.comment.findMany({\n        where: {\n          postId,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          replies: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n          },\n          hearts: userId\n            ? {\n                where: {\n                  userId,\n                },\n              }\n            : false,\n          _count: {\n            select: {\n              replies: true,\n              hearts: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async create(\n    data: CommentCreateInputDto,\n    userId: string,\n    attachmentUrls: string[] = [],\n    attachmentNames: string[] = [],\n    attachmentSizes: number[] = [],\n  ): Promise<CommentResponse> {\n    try {\n      const comment = await this.prisma.comment.create({\n        data: {\n          userId,\n          postId: data.postId,\n          content: data.content,\n          attachmentUrls,\n          attachmentNames,\n          attachmentSizes,\n        },\n        include: {\n          user: true,\n          hearts: true,\n        },\n      });\n\n      return {\n        ...comment,\n        hearts: comment.hearts.length, // Count hearts instead of returning array\n        files: [], // No longer using centralized file system\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async update(\n    id: string,\n    data: CommentUpdateInputDto,\n    userId: string,\n  ): Promise<CommentResponse> {\n    try {\n      const comment = await this.prisma.comment.findUnique({\n        where: { id },\n        select: { userId: true },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      if (comment.userId !== userId) {\n        throw new ForbiddenException('You can only edit your own comments');\n      }\n\n      const updatedComment = await this.prisma.comment.update({\n        where: { id, userId },\n        data: {\n          content: data.content,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          hearts: true,\n        },\n      });\n\n      return {\n        ...updatedComment,\n        hearts: updatedComment.hearts.length,\n        files: [], // No longer using centralized file system\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async remove(id: string, userId: string): Promise<Comment> {\n    try {\n      const comment = await this.prisma.comment.findUnique({\n        where: { id },\n        select: { userId: true },\n      });\n\n      if (!comment) {\n        throw new NotFoundException('Comment not found');\n      }\n\n      if (comment.userId !== userId) {\n        throw new ForbiddenException('You can only delete your own comments');\n      }\n\n      return await this.prisma.comment.delete({\n        where: { id },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findByUserId(userId: string): Promise<Comment[]> {\n    try {\n      return await this.prisma.comment.findMany({\n        where: {\n          userId,\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          post: {\n            select: {\n              id: true,\n              title: true,\n            },\n          },\n          replies: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              replies: true,\n              hearts: true,\n            },\n          },\n        },\n        orderBy: {\n          createdAt: 'desc',\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Heart functionality\n  async heartComment(\n    commentId: string,\n    userId: string,\n  ): Promise<{ hearted: boolean }> {\n    try {\n      const existingHeart = await this.prisma.commentHeart.findUnique({\n        where: {\n          commentId_userId: {\n            commentId,\n            userId,\n          },\n        },\n      });\n\n      if (existingHeart) {\n        // Remove heart\n        await this.prisma.commentHeart.delete({\n          where: {\n            commentId_userId: {\n              commentId,\n              userId,\n            },\n          },\n        });\n\n        return { hearted: false };\n      } else {\n        // Add heart\n        await this.prisma.commentHeart.create({\n          data: {\n            commentId,\n            userId,\n          },\n        });\n\n        return { hearted: true };\n      }\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async isCommentHeartedByUser(\n    commentId: string,\n    userId: string,\n  ): Promise<boolean> {\n    try {\n      const heart = await this.prisma.commentHeart.findUnique({\n        where: {\n          commentId_userId: {\n            commentId,\n            userId,\n          },\n        },\n      });\n\n      return !!heart;\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Add reply creation\n  async createReply(data: Prisma.ReplyCreateInput): Promise<Reply> {\n    try {\n      return await this.prisma.reply.create({\n        data,\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          comment: true,\n          hearts: true,\n        },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Fetch replies for a comment, with heart info/count\n  async findRepliesByCommentId(\n    commentId: string,\n    userId?: string,\n  ): Promise<any[]> {\n    try {\n      return await this.prisma.reply.findMany({\n        where: { commentId },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          hearts: userId\n            ? {\n                where: { userId },\n              }\n            : true,\n          _count: {\n            select: { hearts: true },\n          },\n        },\n        orderBy: { createdAt: 'asc' },\n      });\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Heart/unheart a reply\n  async heartReply(\n    replyId: string,\n    userId: string,\n  ): Promise<{ hearted: boolean }> {\n    try {\n      const existingHeart = await this.prisma.replyHeart.findUnique({\n        where: {\n          replyId_userId: {\n            replyId,\n            userId,\n          },\n        },\n      });\n\n      if (existingHeart) {\n        // Remove heart\n        await this.prisma.replyHeart.delete({\n          where: {\n            replyId_userId: {\n              replyId,\n              userId,\n            },\n          },\n        });\n        return { hearted: false };\n      } else {\n        // Add heart\n        await this.prisma.replyHeart.create({\n          data: {\n            replyId,\n            userId,\n          },\n        });\n        return { hearted: true };\n      }\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // Check if a reply is hearted by a user\n  async isReplyHeartedByUser(\n    replyId: string,\n    userId: string,\n  ): Promise<boolean> {\n    try {\n      const heart = await this.prisma.replyHeart.findUnique({\n        where: {\n          replyId_userId: {\n            replyId,\n            userId,\n          },\n        },\n      });\n      return !!heart;\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  // File attachments are now handled directly with attachment arrays\n  // No separate file attachment models needed\n}\n"],"version":3}