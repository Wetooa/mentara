{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/notifications/notifications.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/notifications/notifications.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  Logger,\n  OnModuleInit,\n} from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { EventEmitter2, OnEvent } from '@nestjs/event-emitter';\nimport { Server } from 'socket.io';\nimport {\n  Notification,\n  NotificationType,\n  NotificationPriority,\n} from '@prisma/client';\nimport { MessagingGateway } from '../messaging/messaging.gateway';\nimport { MessageSentEvent } from '../common/events/messaging-events';\nimport { PostCreatedEvent, CommentAddedEvent } from '../common/events/social-events';\n\ninterface WebSocketServer {\n  to(room: string): {\n    emit(event: string, data: any): void;\n  };\n}\n\ninterface NotificationDeliveryOptions {\n  realTime?: boolean;\n  email?: boolean;\n  push?: boolean;\n  scheduled?: boolean;\n  priority?: NotificationPriority;\n}\n\ninterface NotificationTemplate {\n  title: string;\n  message: string;\n  type: NotificationType;\n  priority: NotificationPriority;\n  actionUrl?: string;\n  data?: any;\n}\n\n@Injectable()\nexport class NotificationsService implements OnModuleInit {\n  private readonly logger = new Logger(NotificationsService.name);\n  private webSocketServer: WebSocketServer | null = null;\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly eventEmitter: EventEmitter2,\n    private readonly messagingGateway: MessagingGateway,\n  ) {}\n\n  onModuleInit() {\n    // Configure WebSocket server for real-time notifications\n    // Use a slight delay to ensure MessagingGateway is fully initialized\n    setTimeout(() => {\n      this.setWebSocketServer(this.messagingGateway.server);\n    }, 1000);\n    \n    this.logger.log(\n      'NotificationsService initialized with real-time capabilities',\n    );\n  }\n\n  /**\n   * Set WebSocket server instance for real-time notifications\n   */\n  setWebSocketServer(server: WebSocketServer) {\n    this.webSocketServer = server;\n    this.logger.log('WebSocket server configured for real-time notifications');\n  }\n\n  async create(\n    data: {\n      userId: string;\n      title: string;\n      message: string;\n      type: NotificationType;\n      priority?: NotificationPriority;\n      data?: any;\n      actionUrl?: string;\n    },\n    deliveryOptions?: NotificationDeliveryOptions,\n  ): Promise<Notification> {\n    const notification = await this.prisma.notification.create({\n      data: {\n        ...data,\n        priority: data.priority || NotificationPriority.NORMAL,\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            email: true,\n          },\n        },\n      },\n    });\n\n    // Default delivery options\n    const options = {\n      realTime: true,\n      email: false,\n      push: false,\n      scheduled: false,\n      ...deliveryOptions,\n    };\n\n    // Deliver notification immediately since scheduling is not supported\n    await this.deliverNotification(notification, options);\n\n    return notification;\n  }\n\n  async findAll(\n    userId: string,\n    isRead?: boolean,\n    type?: NotificationType,\n    priority?: NotificationPriority,\n  ): Promise<Notification[]> {\n    const where: any = { userId };\n\n    if (isRead !== undefined) where.isRead = isRead;\n    if (type) where.type = type;\n    if (priority) where.priority = priority;\n\n    return this.prisma.notification.findMany({\n      where,\n      orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],\n      take: 50, // Limit to recent notifications\n    });\n  }\n\n  async findOne(id: string): Promise<Notification | null> {\n    return this.prisma.notification.findUnique({\n      where: { id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            email: true,\n          },\n        },\n      },\n    });\n  }\n\n  async markAsRead(id: string): Promise<Notification> {\n    const notification = await this.findOne(id);\n    if (!notification) {\n      throw new NotFoundException(`Notification with ID ${id} not found`);\n    }\n\n    return this.prisma.notification.update({\n      where: { id },\n      data: {\n        isRead: true,\n        readAt: new Date(),\n      },\n    });\n  }\n\n  async markAllAsRead(userId: string): Promise<{ count: number }> {\n    const result = await this.prisma.notification.updateMany({\n      where: {\n        userId,\n        isRead: false,\n      },\n      data: {\n        isRead: true,\n        readAt: new Date(),\n      },\n    });\n\n    return { count: result.count };\n  }\n\n  async delete(id: string): Promise<Notification> {\n    const notification = await this.findOne(id);\n    if (!notification) {\n      throw new NotFoundException(`Notification with ID ${id} not found`);\n    }\n\n    return this.prisma.notification.delete({\n      where: { id },\n    });\n  }\n\n  async getUnreadCount(userId: string): Promise<number> {\n    return this.prisma.notification.count({\n      where: {\n        userId,\n        isRead: false,\n      },\n    });\n  }\n\n  async getNotificationSettings(userId: string) {\n    // Return default notification settings since notificationSettings model doesn't exist\n    // This provides a consistent interface while using in-memory defaults\n    return {\n      id: `default-${userId}`,\n      userId,\n      emailAppointmentReminders: true,\n      emailNewMessages: true,\n      emailWorksheetUpdates: true,\n      emailSystemUpdates: false,\n      emailMarketing: false,\n      pushAppointmentReminders: true,\n      pushNewMessages: true,\n      pushWorksheetUpdates: true,\n      pushSystemUpdates: false,\n      inAppMessages: true,\n      inAppUpdates: true,\n      quietHoursEnabled: false,\n      quietHoursStart: '22:00',\n      quietHoursEnd: '08:00',\n      quietHoursTimezone: 'UTC',\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n  }\n\n  async updateNotificationSettings(\n    userId: string,\n    data: {\n      emailAppointmentReminders?: boolean;\n      emailNewMessages?: boolean;\n      emailWorksheetUpdates?: boolean;\n      emailSystemUpdates?: boolean;\n      emailMarketing?: boolean;\n      pushAppointmentReminders?: boolean;\n      pushNewMessages?: boolean;\n      pushWorksheetUpdates?: boolean;\n      pushSystemUpdates?: boolean;\n      inAppMessages?: boolean;\n      inAppUpdates?: boolean;\n      quietHoursEnabled?: boolean;\n      quietHoursStart?: string;\n      quietHoursEnd?: string;\n      quietHoursTimezone?: string;\n    },\n  ) {\n    // Return updated default settings since notificationSettings model doesn't exist\n    // This provides a consistent interface while using in-memory defaults\n    const currentSettings = await this.getNotificationSettings(userId);\n    \n    return {\n      ...currentSettings,\n      ...data,\n      updatedAt: new Date(),\n    };\n  }\n\n  /**\n   * Deliver notification through configured channels\n   */\n  private async deliverNotification(\n    notification: Notification & { user: any },\n    options: NotificationDeliveryOptions,\n  ): Promise<void> {\n    try {\n      // Real-time WebSocket delivery\n      if (options.realTime && this.webSocketServer) {\n        await this.deliverRealTimeNotification(notification);\n      }\n\n      // Email delivery (if configured)\n      if (options.email) {\n        await this.deliverEmailNotification(notification);\n      }\n\n      // Push notification delivery (if configured)\n      if (options.push) {\n        await this.deliverPushNotification(notification);\n      }\n    } catch (error) {\n      this.logger.error(\n        `Error delivering notification ${notification.id}:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Deliver real-time notification via WebSocket\n   */\n  private async deliverRealTimeNotification(\n    notification: Notification & { user: any },\n  ): Promise<void> {\n    if (!this.webSocketServer) {\n      this.logger.warn(\n        'WebSocket server not configured for real-time notifications',\n      );\n      return;\n    }\n\n    try {\n      // Send to user's personal room\n      this.webSocketServer\n        .to(`user:${notification.userId}`)\n        .emit('notification', {\n          id: notification.id,\n          title: notification.title,\n          message: notification.message,\n          type: notification.type,\n          priority: notification.priority,\n          actionUrl: notification.actionUrl,\n          data: notification.data,\n          createdAt: notification.createdAt,\n          isRead: false,\n        });\n\n      // Send unread count update\n      const unreadCount = await this.getUnreadCount(notification.userId);\n      this.webSocketServer\n        .to(`user:${notification.userId}`)\n        .emit('unreadCount', {\n          count: unreadCount,\n        });\n\n      this.logger.log(\n        `Real-time notification delivered to user ${notification.userId}`,\n      );\n    } catch (error) {\n      this.logger.error(`Error delivering real-time notification:`, error);\n    }\n  }\n\n  /**\n   * Deliver email notification (placeholder for email service integration)\n   */\n  private async deliverEmailNotification(\n    notification: Notification & { user: any },\n  ): Promise<void> {\n    // TODO: Integrate with email service (SendGrid, AWS SES, etc.)\n    this.logger.log(\n      `Email notification queued for user ${notification.userId}`,\n    );\n  }\n\n  /**\n   * Deliver push notification (placeholder for push service integration)\n   */\n  private async deliverPushNotification(\n    notification: Notification & { user: any },\n  ): Promise<void> {\n    // TODO: Integrate with push notification service (FCM, APNS, etc.)\n    this.logger.log(`Push notification queued for user ${notification.userId}`);\n  }\n\n  /**\n   * Batch create notifications with optimized delivery\n   */\n  async createBatch(\n    notifications: Array<{\n      userId: string;\n      title: string;\n      message: string;\n      type: NotificationType;\n      priority?: NotificationPriority;\n      data?: any;\n      actionUrl?: string;\n    }>,\n    deliveryOptions?: NotificationDeliveryOptions,\n  ): Promise<Notification[]> {\n    const createdNotifications: Notification[] = [];\n\n    // Create notifications in batches for better performance\n    for (const notificationData of notifications) {\n      const notification = await this.create(notificationData, deliveryOptions);\n      createdNotifications.push(notification);\n    }\n\n    return createdNotifications;\n  }\n\n  /**\n   * Send notification to all users in a community\n   */\n  async sendToCommunity(\n    communityId: string,\n    notification: Omit<Parameters<typeof this.create>[0], 'userId'>,\n    deliveryOptions?: NotificationDeliveryOptions,\n  ): Promise<void> {\n    try {\n      // Get all community members\n      const members = await this.prisma.membership.findMany({\n        where: { communityId },\n        select: { userId: true },\n      });\n\n      // Create notifications for all members (filter out null userIds)\n      const notifications = members\n        .filter((member) => member.userId !== null)\n        .map((member) => ({\n          ...notification,\n          userId: member.userId!,\n        }));\n\n      await this.createBatch(notifications, deliveryOptions);\n\n      this.logger.log(\n        `Sent notifications to ${members.length} community members`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error sending notifications to community ${communityId}:`,\n        error,\n      );\n    }\n  }\n\n  // ===== EVENT LISTENERS FOR COMMUNITY RECOMMENDATION SYSTEM =====\n\n  /**\n   * Handle community recommendation generated events\n   */\n  @OnEvent('community.recommendations.generated')\n  async handleRecommendationsGenerated(payload: {\n    userId: string;\n    recommendationCount: number;\n    timestamp: Date;\n  }) {\n    try {\n      await this.create(\n        {\n          userId: payload.userId,\n          title: 'New Community Recommendations',\n          message: `We've found ${payload.recommendationCount} new communities that might interest you based on your assessment results.`,\n          type: NotificationType.COMMUNITY_RECOMMENDATION,\n          priority: NotificationPriority.NORMAL,\n          actionUrl: '/communities/recommendations',\n          data: {\n            recommendationCount: payload.recommendationCount,\n            generatedAt: payload.timestamp,\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: true,\n        },\n      );\n\n      this.logger.log(\n        `Community recommendation notification sent to user ${payload.userId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling recommendations generated event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle community recommendation interaction events\n   */\n  @OnEvent('community.recommendation.interaction')\n  async handleRecommendationInteraction(payload: {\n    userId: string;\n    communityId: string;\n    communityName: string;\n    action: 'accept' | 'reject';\n    compatibilityScore: number;\n    timestamp: Date;\n  }) {\n    try {\n      if (payload.action === 'accept') {\n        await this.create(\n          {\n            userId: payload.userId,\n            title: `Welcome to ${payload.communityName}!`,\n            message: `You've successfully joined ${payload.communityName}. Start exploring and connecting with the community.`,\n            type: NotificationType.COMMUNITY_JOINED,\n            priority: NotificationPriority.HIGH,\n            actionUrl: `/communities/${payload.communityId}`,\n            data: {\n              communityId: payload.communityId,\n              communityName: payload.communityName,\n              compatibilityScore: payload.compatibilityScore,\n              joinMethod: 'recommendation_accepted',\n            },\n          },\n          {\n            realTime: true,\n            email: false,\n            push: true,\n          },\n        );\n\n        this.logger.log(\n          `Community join notification sent to user ${payload.userId}`,\n        );\n      }\n    } catch (error) {\n      this.logger.error(\n        `Error handling recommendation interaction event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle community member joined events\n   */\n  @OnEvent('community.member.joined')\n  async handleMemberJoined(payload: {\n    userId: string;\n    communityId: string;\n    joinMethod: string;\n    timestamp: Date;\n  }) {\n    try {\n      // Get community details\n      const community = await this.prisma.community.findUnique({\n        where: { id: payload.communityId },\n        select: { name: true, _count: { select: { memberships: true } } },\n      });\n\n      if (!community) return;\n\n      // Send welcome notification to the new member\n      await this.create(\n        {\n          userId: payload.userId,\n          title: `Welcome to ${community.name}!`,\n          message: `You're now part of a community with ${community._count.memberships} members. Start exploring and connecting!`,\n          type: NotificationType.COMMUNITY_WELCOME,\n          priority: NotificationPriority.HIGH,\n          actionUrl: `/communities/${payload.communityId}`,\n          data: {\n            communityId: payload.communityId,\n            communityName: community.name,\n            memberCount: community._count.memberships,\n            joinMethod: payload.joinMethod,\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: true,\n        },\n      );\n\n      this.logger.log(\n        `Community welcome notification sent to user ${payload.userId}`,\n      );\n    } catch (error) {\n      this.logger.error(`Error handling member joined event:`, error);\n    }\n  }\n\n  /**\n   * Handle recommendations refreshed events\n   */\n  @OnEvent('community.recommendations.refreshed')\n  async handleRecommendationsRefreshed(payload: {\n    userId: string;\n    timestamp: Date;\n  }) {\n    try {\n      await this.create(\n        {\n          userId: payload.userId,\n          title: 'Community Recommendations Updated',\n          message:\n            'Your community recommendations have been updated based on your latest assessment results.',\n          type: NotificationType.RECOMMENDATIONS_UPDATED,\n          priority: NotificationPriority.NORMAL,\n          actionUrl: '/communities/recommendations',\n          data: {\n            refreshedAt: payload.timestamp,\n            reason: 'assessment_change',\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: false,\n        },\n      );\n\n      this.logger.log(\n        `Recommendations refreshed notification sent to user ${payload.userId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling recommendations refreshed event:`,\n        error,\n      );\n    }\n  }\n\n  // ===== MESSAGING EVENT LISTENERS =====\n\n  /**\n   * Handle message sent events to create MESSAGE_RECEIVED notifications\n   */\n  @OnEvent('MessageSentEvent')\n  async handleMessageSent(event: MessageSentEvent) {\n    try {\n      const { \n        senderId, \n        conversationId, \n        content, \n        recipientIds \n      } = event.eventData;\n\n      // Get sender details\n      const sender = await this.prisma.user.findUnique({\n        where: { id: senderId },\n        select: { firstName: true, lastName: true },\n      });\n\n      if (!sender) {\n        this.logger.warn(`Sender not found for message notification: ${senderId}`);\n        return;\n      }\n\n      const senderName = `${sender.firstName} ${sender.lastName}`;\n\n      // Create notifications for each recipient\n      for (const recipientId of recipientIds) {\n        await this.create(\n          {\n            userId: recipientId,\n            title: 'New Message',\n            message: `You have a new message from ${senderName}.`,\n            type: NotificationType.MESSAGE_RECEIVED,\n            priority: NotificationPriority.NORMAL,\n            actionUrl: `/messages/${conversationId}`,\n            data: {\n              senderId,\n              conversationId,\n              messagePreview: content.substring(0, 100) + (content.length > 100 ? '...' : ''),\n              senderName,\n            },\n          },\n          {\n            realTime: true,\n            email: false,\n            push: true,\n          },\n        );\n      }\n\n      this.logger.log(\n        `Message notifications sent to ${recipientIds.length} recipients for conversation ${conversationId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling message sent event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle post created events to create COMMUNITY_POST notifications for community members\n   */\n  @OnEvent('PostCreatedEvent')\n  async handlePostCreated(event: PostCreatedEvent) {\n    try {\n      const { \n        postId, \n        authorId, \n        communityId, \n        title, \n        content, \n        isAnonymous \n      } = event.eventData;\n\n      // Skip notifications for anonymous posts or posts without community\n      if (isAnonymous || !communityId) {\n        return;\n      }\n\n      // Get post author details\n      const author = await this.prisma.user.findUnique({\n        where: { id: authorId },\n        select: { firstName: true, lastName: true },\n      });\n\n      // Get community details and members\n      const community = await this.prisma.community.findUnique({\n        where: { id: communityId },\n        select: {\n          name: true,\n          memberships: {\n            where: {\n              userId: { not: authorId }, // Don't notify the author\n            },\n            select: { userId: true },\n          },\n        },\n      });\n\n      if (!author || !community) {\n        this.logger.warn(`Author or community not found for post notification: ${postId}`);\n        return;\n      }\n\n      const authorName = `${author.firstName} ${author.lastName}`;\n\n      // Create notifications for community members\n      const notifications = community.memberships\n        .filter((member) => member.userId !== null)\n        .map((member) => ({\n          userId: member.userId!,\n          title: `New Post in ${community.name}`,\n          message: `${authorName} posted: \"${title || content.substring(0, 50)}${content.length > 50 ? '...' : ''}\"`,\n          type: NotificationType.COMMUNITY_POST,\n          priority: NotificationPriority.LOW,\n          actionUrl: `/communities/posts/${postId}`,\n          data: {\n            postId,\n            authorId,\n            authorName,\n            communityId,\n            communityName: community.name,\n            postTitle: title,\n          },\n        }));\n\n      await this.createBatch(notifications, {\n        realTime: true,\n        email: false,\n        push: false,\n      });\n\n      this.logger.log(\n        `Post notification sent to ${notifications.length} community members for post ${postId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling post created event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle comment added events to create COMMUNITY_REPLY notifications for post author and parent comment author\n   */\n  @OnEvent('CommentAddedEvent')\n  async handleCommentAdded(event: CommentAddedEvent) {\n    try {\n      const { \n        commentId, \n        postId, \n        authorId, \n        content, \n        parentCommentId \n      } = event.eventData;\n\n      // Validate required event data\n      if (!authorId) {\n        this.logger.error(`Missing authorId in CommentAddedEvent for comment ${commentId}`, {\n          commentId,\n          postId,\n          eventData: event.eventData\n        });\n        return;\n      }\n\n      if (!commentId || !postId || !content) {\n        this.logger.error(`Missing required data in CommentAddedEvent`, {\n          commentId,\n          postId,\n          authorId,\n          hasContent: !!content,\n          eventData: event.eventData\n        });\n        return;\n      }\n\n      // Get comment author details\n      const author = await this.prisma.user.findUnique({\n        where: { id: authorId },\n        select: { firstName: true, lastName: true },\n      });\n\n      // Get post details and author\n      const post = await this.prisma.post.findUnique({\n        where: { id: postId },\n        select: {\n          title: true,\n          userId: true,\n          user: {\n            select: { firstName: true, lastName: true },\n          },\n        },\n      });\n\n      if (!author || !post) {\n        this.logger.warn(`Author or post not found for comment notification: ${commentId}`, {\n          authorFound: !!author,\n          postFound: !!post,\n          authorId,\n          postId,\n          commentId\n        });\n        return;\n      }\n\n      const authorName = `${author.firstName} ${author.lastName}`;\n      const recipients = new Set<string>();\n\n      // Notify post author (if not the commenter)\n      if (post.userId !== authorId) {\n        recipients.add(post.userId);\n      }\n\n      // If this is a reply to another comment, notify the parent comment author\n      if (parentCommentId) {\n        const parentComment = await this.prisma.comment.findUnique({\n          where: { id: parentCommentId },\n          select: { userId: true },\n        });\n\n        if (parentComment && parentComment.userId !== authorId && parentComment.userId !== post.userId) {\n          recipients.add(parentComment.userId);\n        }\n      }\n\n      // Create notifications for all recipients\n      const notifications = Array.from(recipients).map((recipientId) => ({\n        userId: recipientId,\n        title: parentCommentId ? 'New Reply to Your Comment' : 'New Comment on Your Post',\n        message: `${authorName} ${parentCommentId ? 'replied to your comment' : 'commented on your post'}: \"${content.substring(0, 100)}${content.length > 100 ? '...' : ''}\"`,\n        type: NotificationType.COMMUNITY_REPLY,\n        priority: NotificationPriority.NORMAL,\n        actionUrl: `/communities/posts/${postId}#comment-${commentId}`,\n        data: {\n          commentId,\n          postId,\n          authorId,\n          authorName,\n          parentCommentId,\n          postTitle: post.title,\n        },\n      }));\n\n      if (notifications.length > 0) {\n        await this.createBatch(notifications, {\n          realTime: true,\n          email: false,\n          push: true,\n        });\n\n        this.logger.log(\n          `Comment notifications sent to ${notifications.length} users for comment ${commentId}`,\n        );\n      }\n    } catch (error) {\n      this.logger.error(\n        `Error handling comment added event:`,\n        error,\n      );\n    }\n  }\n\n  // Helper methods for creating specific notification types\n\n  async createAppointmentReminder(\n    userId: string,\n    appointmentId: string,\n    appointmentTime: Date,\n    therapistName: string,\n  ) {\n    return this.create({\n      userId,\n      title: 'Upcoming Appointment',\n      message: `You have an appointment with ${therapistName} in 1 hour.`,\n      type: NotificationType.APPOINTMENT_REMINDER,\n      priority: NotificationPriority.HIGH,\n      actionUrl: `/appointments/${appointmentId}`,\n      data: { appointmentId, appointmentTime },\n    });\n  }\n\n  async createMessageNotification(\n    userId: string,\n    senderId: string,\n    senderName: string,\n    conversationId: string,\n  ) {\n    return this.create({\n      userId,\n      title: 'New Message',\n      message: `You have a new message from ${senderName}.`,\n      type: NotificationType.MESSAGE_RECEIVED,\n      priority: NotificationPriority.NORMAL,\n      actionUrl: `/messages/${conversationId}`,\n      data: { senderId, conversationId },\n    });\n  }\n\n  async createWorksheetAssignedNotification(\n    userId: string,\n    worksheetId: string,\n    worksheetTitle: string,\n    therapistName: string,\n  ) {\n    return this.create({\n      userId,\n      title: 'New Worksheet Assigned',\n      message: `${therapistName} has assigned you a new worksheet: \"${worksheetTitle}\".`,\n      type: NotificationType.WORKSHEET_ASSIGNED,\n      priority: NotificationPriority.NORMAL,\n      actionUrl: `/worksheets/${worksheetId}`,\n      data: { worksheetId },\n    });\n  }\n\n  async createTherapistApplicationNotification(\n    userId: string,\n    status: 'approved' | 'rejected',\n  ) {\n    const title =\n      status === 'approved' ? 'Application Approved' : 'Application Update';\n    const message =\n      status === 'approved'\n        ? 'Congratulations! Your therapist application has been approved.'\n        : 'Your therapist application has been reviewed. Please check your application status.';\n\n    return this.create({\n      userId,\n      title,\n      message,\n      type:\n        status === 'approved'\n          ? NotificationType.THERAPIST_APPROVED\n          : NotificationType.THERAPIST_REJECTED,\n      priority: NotificationPriority.HIGH,\n      actionUrl: '/therapist/application',\n      data: { status },\n    });\n  }\n\n  async createReviewRequestNotification(\n    userId: string,\n    therapistId: string,\n    therapistName: string,\n    sessionId: string,\n  ) {\n    return this.create({\n      userId,\n      title: 'Review Request',\n      message: `Please leave a review for your session with ${therapistName}.`,\n      type: NotificationType.REVIEW_REQUEST,\n      priority: NotificationPriority.NORMAL,\n      actionUrl: `/therapists/${therapistId}/review?session=${sessionId}`,\n      data: { therapistId, sessionId },\n    });\n  }\n\n  async createCommunityPostNotification(\n    userId: string,\n    postId: string,\n    communityName: string,\n    authorName: string,\n  ) {\n    return this.create({\n      userId,\n      title: 'New Community Post',\n      message: `${authorName} posted in ${communityName}.`,\n      type: NotificationType.COMMUNITY_POST,\n      priority: NotificationPriority.LOW,\n      actionUrl: `/communities/posts/${postId}`,\n      data: { postId, communityName },\n    });\n  }\n\n  // ===== THERAPIST MATCHING SYSTEM NOTIFICATIONS =====\n\n  async createClientRequestNotification(\n    therapistId: string,\n    clientId: string,\n    clientName: string,\n    requestMessage?: string,\n    priority: 'LOW' | 'NORMAL' | 'HIGH' | 'URGENT' = 'NORMAL',\n  ) {\n    const notificationPriority =\n      priority === 'HIGH' || priority === 'URGENT' ? 'HIGH' : 'NORMAL';\n\n    return this.create({\n      userId: therapistId,\n      title: `New Client Request ${priority === 'URGENT' ? '(Urgent)' : ''}`,\n      message: `${clientName} has sent you a therapy request.${requestMessage ? ` \"${requestMessage.substring(0, 100)}${requestMessage.length > 100 ? '...' : ''}\"` : ''}`,\n      type: 'CLIENT_REQUEST_RECEIVED',\n      priority: notificationPriority,\n      actionUrl: `/therapist/requests`,\n      data: {\n        clientId,\n        clientName,\n        requestType: 'therapy_request',\n        priority,\n        hasMessage: !!requestMessage,\n      },\n    });\n  }\n\n  async createRequestAcceptedNotification(\n    clientId: string,\n    therapistId: string,\n    therapistName: string,\n    responseMessage?: string,\n    schedulingInfo?: string,\n  ) {\n    return this.create({\n      userId: clientId,\n      title: 'Therapist Request Accepted! ',\n      message: `Great news! ${therapistName} has accepted your therapy request.${responseMessage ? ` \"${responseMessage}\"` : ''}`,\n      type: 'THERAPIST_REQUEST_ACCEPTED',\n      priority: 'HIGH',\n      actionUrl: `/client/therapists/${therapistId}`,\n      data: {\n        therapistId,\n        therapistName,\n        responseMessage,\n        schedulingInfo,\n        nextStep: 'schedule_session',\n      },\n    });\n  }\n\n  async createRequestDeclinedNotification(\n    clientId: string,\n    therapistId: string,\n    therapistName: string,\n    responseMessage?: string,\n  ) {\n    return this.create({\n      userId: clientId,\n      title: 'Therapist Request Update',\n      message: `${therapistName} has responded to your therapy request.${responseMessage ? ` \"${responseMessage}\"` : ''} Don't worry - we can help you find other great matches!`,\n      type: 'THERAPIST_REQUEST_DECLINED',\n      priority: 'NORMAL',\n      actionUrl: '/client/therapists/browse',\n      data: {\n        therapistId,\n        therapistName,\n        responseMessage,\n        nextStep: 'browse_alternatives',\n      },\n    });\n  }\n\n  async createRequestCancelledNotification(\n    therapistId: string,\n    clientName: string,\n    reason?: string,\n  ) {\n    return this.create({\n      userId: therapistId,\n      title: 'Client Request Cancelled',\n      message: `${clientName} has cancelled their therapy request.${reason ? ` Reason: ${reason}` : ''}`,\n      type: 'CLIENT_REQUEST_CANCELLED',\n      priority: 'NORMAL',\n      actionUrl: '/therapist/requests',\n      data: {\n        clientName,\n        reason,\n        actionType: 'cancellation',\n      },\n    });\n  }\n\n  async createAdminTherapistApprovalNotification(\n    therapistId: string,\n    approvalMessage?: string,\n  ) {\n    return this.create({\n      userId: therapistId,\n      title: 'Application Approved! Welcome to Mentara ',\n      message: `Congratulations! Your therapist application has been approved. You can now start receiving client requests.${approvalMessage ? ` Message from our team: \"${approvalMessage}\"` : ''}`,\n      type: 'THERAPIST_APPROVED',\n      priority: 'HIGH',\n      actionUrl: '/therapist/dashboard',\n      data: {\n        approvalMessage,\n        nextSteps: [\n          'complete_profile',\n          'set_availability',\n          'review_guidelines',\n        ],\n        welcomeFlow: true,\n      },\n    });\n  }\n\n  async createAdminTherapistRejectionNotification(\n    therapistId: string,\n    rejectionReason: string,\n    rejectionMessage: string,\n    allowReapplication: boolean,\n  ) {\n    return this.create({\n      userId: therapistId,\n      title: 'Application Status Update',\n      message: `Your therapist application has been reviewed. ${rejectionMessage}`,\n      type: 'THERAPIST_REJECTED',\n      priority: 'HIGH',\n      actionUrl: allowReapplication\n        ? '/therapist/reapply'\n        : '/therapist/application-status',\n      data: {\n        rejectionReason,\n        rejectionMessage,\n        allowReapplication,\n        nextStep: allowReapplication ? 'reapply' : 'contact_support',\n      },\n    });\n  }\n\n  async createNewRecommendationsNotification(\n    clientId: string,\n    therapistCount: number,\n    updateReason:\n      | 'profile_update'\n      | 'new_therapists'\n      | 'algorithm_improvement' = 'new_therapists',\n  ) {\n    const reasonMessages = {\n      profile_update: 'based on your updated preferences',\n      new_therapists: 'with newly approved therapists',\n      algorithm_improvement: 'with improved matching',\n    };\n\n    return this.create({\n      userId: clientId,\n      title: 'New Therapist Recommendations Available',\n      message: `We've found ${therapistCount} new therapist matches for you ${reasonMessages[updateReason]}. Check them out!`,\n      type: 'NEW_RECOMMENDATIONS',\n      priority: 'NORMAL',\n      actionUrl: '/client/therapists/recommendations',\n      data: {\n        therapistCount,\n        updateReason,\n        recommendationType: 'updated_matches',\n      },\n    });\n  }\n\n  async createMatchingSystemUpdateNotification(\n    userId: string,\n    updateType: 'algorithm_improvement' | 'feature_release' | 'maintenance',\n    updateMessage: string,\n  ) {\n    const titles = {\n      algorithm_improvement: 'Better Matching Available',\n      feature_release: 'New Feature Available',\n      maintenance: 'System Update Complete',\n    };\n\n    const priorities = {\n      algorithm_improvement: 'NORMAL',\n      feature_release: 'NORMAL',\n      maintenance: 'LOW',\n    } as const;\n\n    return this.create({\n      userId,\n      title: titles[updateType],\n      message: updateMessage,\n      type: 'SYSTEM_UPDATE',\n      priority: priorities[updateType],\n      actionUrl: '/dashboard',\n      data: {\n        updateType,\n        systemUpdate: true,\n      },\n    });\n  }\n\n  async createRelationshipEstablishedNotification(\n    clientId: string,\n    therapistId: string,\n    therapistName: string,\n  ) {\n    return this.create({\n      userId: clientId,\n      title: 'Welcome to Your Therapy Journey! ',\n      message: `You're now connected with ${therapistName}. Your therapy relationship has officially begun. Take the first step by scheduling your initial session.`,\n      type: 'RELATIONSHIP_ESTABLISHED',\n      priority: 'HIGH',\n      actionUrl: `/client/therapists/${therapistId}/schedule`,\n      data: {\n        therapistId,\n        therapistName,\n        relationshipStatus: 'active',\n        nextStep: 'schedule_first_session',\n      },\n    });\n  }\n\n  async createTherapistRequestReminderNotification(\n    therapistId: string,\n    pendingRequestCount: number,\n  ) {\n    return this.create({\n      userId: therapistId,\n      title: `${pendingRequestCount} Pending Client Request${pendingRequestCount > 1 ? 's' : ''}`,\n      message: `You have ${pendingRequestCount} client request${pendingRequestCount > 1 ? 's' : ''} waiting for your response. Clients appreciate timely responses!`,\n      type: 'REQUEST_REMINDER',\n      priority: pendingRequestCount > 3 ? 'HIGH' : 'NORMAL',\n      actionUrl: '/therapist/requests/pending',\n      data: {\n        pendingRequestCount,\n        reminderType: 'pending_requests',\n        urgency: pendingRequestCount > 3 ? 'high' : 'normal',\n      },\n    });\n  }\n\n  async createProfileCompletionReminderNotification(\n    userId: string,\n    userType: 'client' | 'therapist',\n    missingFields: string[],\n  ) {\n    const actionUrls = {\n      client: '/client/profile',\n      therapist: '/therapist/profile',\n    };\n\n    return this.create({\n      userId,\n      title: 'Complete Your Profile for Better Matches',\n      message: `Complete your profile to get better therapist recommendations. Missing: ${missingFields.slice(0, 3).join(', ')}${missingFields.length > 3 ? '...' : ''}`,\n      type: 'PROFILE_COMPLETION',\n      priority: 'LOW',\n      actionUrl: actionUrls[userType],\n      data: {\n        missingFields,\n        userType,\n        profileCompleteness: Math.max(0, 100 - missingFields.length * 10),\n      },\n    });\n  }\n\n  async sendScheduledNotifications() {\n    // Since scheduledFor and sentAt fields don't exist in the Notification model,\n    // this method returns a stub response. In a real implementation with these fields,\n    // this would process and send scheduled notifications.\n    this.logger.log('Scheduled notifications check completed (no scheduled fields available)');\n    \n    return { sent: 0 };\n  }\n\n  // ===== BOOKING & APPOINTMENT EVENT LISTENERS =====\n\n  /**\n   * Handle appointment booked events\n   */\n  @OnEvent('AppointmentBookedEvent')\n  async handleAppointmentBooked(event: any) {\n    try {\n      const { data } = event;\n      \n      // Get therapist and client details\n      const [therapist, client] = await Promise.all([\n        this.prisma.user.findUnique({\n          where: { id: data.therapistId },\n          select: { firstName: true, lastName: true },\n        }),\n        this.prisma.user.findUnique({\n          where: { id: data.clientId },\n          select: { firstName: true, lastName: true },\n        }),\n      ]);\n\n      if (!therapist || !client) return;\n\n      // Notify client about successful booking\n      await this.create(\n        {\n          userId: data.clientId,\n          title: 'Session Booked Successfully!',\n          message: `Your ${data.meetingType} session with ${therapist.firstName} ${therapist.lastName} has been scheduled for ${new Date(data.startTime).toLocaleDateString()} at ${new Date(data.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}.`,\n          type: NotificationType.APPOINTMENT_CONFIRMED,\n          priority: NotificationPriority.HIGH,\n          actionUrl: `/client/meetings/${data.appointmentId}`,\n          data: {\n            appointmentId: data.appointmentId,\n            therapistId: data.therapistId,\n            startTime: data.startTime,\n            duration: data.duration,\n            meetingType: data.meetingType,\n          },\n        },\n        {\n          realTime: true,\n          email: true,\n          push: true,\n        },\n      );\n\n      // Notify therapist about new booking\n      await this.create(\n        {\n          userId: data.therapistId,\n          title: 'New Session Booked',\n          message: `${client.firstName} ${client.lastName} has booked a ${data.duration}-minute ${data.meetingType} session with you on ${new Date(data.startTime).toLocaleDateString()} at ${new Date(data.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}.`,\n          type: NotificationType.APPOINTMENT_CONFIRMED,\n          priority: NotificationPriority.HIGH,\n          actionUrl: `/therapist/meetings/${data.appointmentId}`,\n          data: {\n            appointmentId: data.appointmentId,\n            clientId: data.clientId,\n            startTime: data.startTime,\n            duration: data.duration,\n            meetingType: data.meetingType,\n          },\n        },\n        {\n          realTime: true,\n          email: true,\n          push: true,\n        },\n      );\n\n      this.logger.log(\n        `Appointment booked notifications sent for appointment ${data.appointmentId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling appointment booked event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle appointment cancelled events\n   */\n  @OnEvent('AppointmentCancelledEvent')\n  async handleAppointmentCancelled(event: any) {\n    try {\n      const { data } = event;\n      \n      // Get therapist and client details\n      const [therapist, client] = await Promise.all([\n        this.prisma.user.findUnique({\n          where: { id: data.therapistId },\n          select: { firstName: true, lastName: true },\n        }),\n        this.prisma.user.findUnique({\n          where: { id: data.clientId },\n          select: { firstName: true, lastName: true },\n        }),\n      ]);\n\n      if (!therapist || !client) return;\n\n      const isCancelledByClient = data.cancelledBy === data.clientId;\n\n      // Notify the other party about the cancellation\n      const notifyUserId = isCancelledByClient ? data.therapistId : data.clientId;\n      const cancellerName = isCancelledByClient \n        ? `${client.firstName} ${client.lastName}`\n        : `${therapist.firstName} ${therapist.lastName}`;\n      \n      await this.create(\n        {\n          userId: notifyUserId,\n          title: 'Session Cancelled',\n          message: `Your session scheduled for ${new Date(data.originalStartTime).toLocaleDateString()} at ${new Date(data.originalStartTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} has been cancelled by ${cancellerName}. ${data.cancellationReason}`,\n          type: NotificationType.APPOINTMENT_CANCELLED,\n          priority: NotificationPriority.HIGH,\n          actionUrl: isCancelledByClient ? '/therapist/schedule' : '/client/booking',\n          data: {\n            appointmentId: data.appointmentId,\n            cancelledBy: data.cancelledBy,\n            cancellationReason: data.cancellationReason,\n            originalStartTime: data.originalStartTime,\n          },\n        },\n        {\n          realTime: true,\n          email: true,\n          push: true,\n        },\n      );\n\n      // Notify the canceller with confirmation\n      await this.create(\n        {\n          userId: data.cancelledBy,\n          title: 'Session Cancellation Confirmed',\n          message: `Your session with ${isCancelledByClient ? therapist.firstName + ' ' + therapist.lastName : client.firstName + ' ' + client.lastName} scheduled for ${new Date(data.originalStartTime).toLocaleDateString()} has been successfully cancelled.`,\n          type: NotificationType.APPOINTMENT_CANCELLED,\n          priority: NotificationPriority.NORMAL,\n          actionUrl: isCancelledByClient ? '/client/booking' : '/therapist/schedule',\n          data: {\n            appointmentId: data.appointmentId,\n            originalStartTime: data.originalStartTime,\n            refundProcessed: true,\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: false,\n        },\n      );\n\n      this.logger.log(\n        `Appointment cancellation notifications sent for appointment ${data.appointmentId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling appointment cancelled event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle appointment rescheduled events\n   */\n  @OnEvent('AppointmentRescheduledEvent')\n  async handleAppointmentRescheduled(event: any) {\n    try {\n      const { data } = event;\n      \n      // Get therapist and client details\n      const [therapist, client] = await Promise.all([\n        this.prisma.user.findUnique({\n          where: { id: data.therapistId },\n          select: { firstName: true, lastName: true },\n        }),\n        this.prisma.user.findUnique({\n          where: { id: data.clientId },\n          select: { firstName: true, lastName: true },\n        }),\n      ]);\n\n      if (!therapist || !client) return;\n\n      const isRescheduledByClient = data.rescheduledBy === data.clientId;\n      \n      // Notify the other party about the reschedule\n      const notifyUserId = isRescheduledByClient ? data.therapistId : data.clientId;\n      const reschedulerName = isRescheduledByClient \n        ? `${client.firstName} ${client.lastName}`\n        : `${therapist.firstName} ${therapist.lastName}`;\n      \n      await this.create(\n        {\n          userId: notifyUserId,\n          title: 'Session Rescheduled',\n          message: `${reschedulerName} has rescheduled your session. New time: ${new Date(data.newStartTime).toLocaleDateString()} at ${new Date(data.newStartTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} (previously ${new Date(data.originalStartTime).toLocaleDateString()} at ${new Date(data.originalStartTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}).`,\n          type: NotificationType.APPOINTMENT_RESCHEDULED,\n          priority: NotificationPriority.HIGH,\n          actionUrl: `/client/meetings/${data.appointmentId}`,\n          data: {\n            appointmentId: data.appointmentId,\n            rescheduledBy: data.rescheduledBy,\n            originalStartTime: data.originalStartTime,\n            newStartTime: data.newStartTime,\n            rescheduleReason: data.rescheduleReason,\n          },\n        },\n        {\n          realTime: true,\n          email: true,\n          push: true,\n        },\n      );\n\n      // Notify the rescheduler with confirmation\n      await this.create(\n        {\n          userId: data.rescheduledBy,\n          title: 'Session Reschedule Confirmed',\n          message: `Your session has been successfully rescheduled to ${new Date(data.newStartTime).toLocaleDateString()} at ${new Date(data.newStartTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}.`,\n          type: NotificationType.APPOINTMENT_RESCHEDULED,\n          priority: NotificationPriority.NORMAL,\n          actionUrl: `/client/meetings/${data.appointmentId}`,\n          data: {\n            appointmentId: data.appointmentId,\n            originalStartTime: data.originalStartTime,\n            newStartTime: data.newStartTime,\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: false,\n        },\n      );\n\n      this.logger.log(\n        `Appointment rescheduled notifications sent for appointment ${data.appointmentId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling appointment rescheduled event:`,\n        error,\n      );\n    }\n  }\n\n  /**\n   * Handle appointment completed events\n   */\n  @OnEvent('AppointmentCompletedEvent')\n  async handleAppointmentCompleted(event: any) {\n    try {\n      const { data } = event;\n      \n      // Get therapist and client details\n      const [therapist, client] = await Promise.all([\n        this.prisma.user.findUnique({\n          where: { id: data.therapistId },\n          select: { firstName: true, lastName: true },\n        }),\n        this.prisma.user.findUnique({\n          where: { id: data.clientId },\n          select: { firstName: true, lastName: true },\n        }),\n      ]);\n\n      if (!therapist || !client) return;\n\n      // Notify client about session completion and review request\n      await this.create(\n        {\n          userId: data.clientId,\n          title: 'Session Completed - Share Your Feedback',\n          message: `Your session with ${therapist.firstName} ${therapist.lastName} has been completed. How was your experience? Your feedback helps us improve our services.`,\n          type: NotificationType.REVIEW_REQUEST,\n          priority: NotificationPriority.NORMAL,\n          actionUrl: `/client/therapists/${data.therapistId}/review?session=${data.appointmentId}`,\n          data: {\n            appointmentId: data.appointmentId,\n            therapistId: data.therapistId,\n            completedAt: data.completedAt,\n            duration: data.duration,\n            attendanceStatus: data.attendanceStatus,\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: true,\n        },\n      );\n\n      // Notify therapist about session completion\n      await this.create(\n        {\n          userId: data.therapistId,\n          title: 'Session Completed',\n          message: `Your session with ${client.firstName} ${client.lastName} has been marked as completed. Duration: ${data.duration} minutes.`,\n          type: NotificationType.APPOINTMENT_CONFIRMED,\n          priority: NotificationPriority.NORMAL,\n          actionUrl: `/therapist/sessions/${data.appointmentId}`,\n          data: {\n            appointmentId: data.appointmentId,\n            clientId: data.clientId,\n            completedAt: data.completedAt,\n            duration: data.duration,\n            attendanceStatus: data.attendanceStatus,\n            sessionNotes: data.sessionNotes,\n          },\n        },\n        {\n          realTime: true,\n          email: false,\n          push: false,\n        },\n      );\n\n      this.logger.log(\n        `Appointment completed notifications sent for appointment ${data.appointmentId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Error handling appointment completed event:`,\n        error,\n      );\n    }\n  }\n}\n"],"version":3}