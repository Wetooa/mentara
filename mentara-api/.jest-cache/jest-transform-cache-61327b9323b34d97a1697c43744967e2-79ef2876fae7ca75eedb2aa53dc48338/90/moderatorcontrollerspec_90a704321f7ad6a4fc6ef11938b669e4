b7d482e8689c2f8b6cdd67e573abe370
"use strict";
/**
 * Comprehensive Test Suite for ModeratorController
 * Tests moderator CRUD operations and management functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const moderator_controller_1 = require("./moderator.controller");
const moderator_service_1 = require("./moderator.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const enhanced_test_helpers_1 = require("../test-utils/enhanced-test-helpers");
const index_1 = require("../test-utils/index");
describe('ModeratorController', () => {
    let controller;
    let moderatorService;
    let module;
    // Mock ModeratorService
    const mockModeratorService = {
        findAll: jest.fn(),
        findOne: jest.fn(),
        create: jest.fn(),
        update: jest.fn(),
        remove: jest.fn(),
    };
    // Mock JwtAuthGuard
    const mockJwtAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    // Test data
    const mockModerator = {
        id: 'moderator_123456789',
        userId: index_1.TEST_USER_IDS.MODERATOR,
        role: 'content_moderator',
        permissions: ['view_posts', 'moderate_posts', 'delete_posts', 'ban_users'],
        assignedCommunities: ['community_1', 'community_2'],
        moderationLevel: 2,
        isActive: true,
        specializations: ['mental-health', 'crisis-intervention'],
        languages: ['english', 'spanish'],
        timezone: 'America/New_York',
        workingHours: {
            monday: { start: '09:00', end: '17:00' },
            tuesday: { start: '09:00', end: '17:00' },
            wednesday: { start: '09:00', end: '17:00' },
            thursday: { start: '09:00', end: '17:00' },
            friday: { start: '09:00', end: '17:00' },
        },
        metrics: {
            totalActions: 245,
            postsModerated: 189,
            usersWarned: 32,
            usersBanned: 8,
            communitiesManaged: 2,
            averageResponseTime: 18.5, // minutes
        },
        createdAt: new Date('2024-01-15T00:00:00Z'),
        updatedAt: new Date('2024-02-14T10:00:00Z'),
    };
    const mockModeratorsList = [
        mockModerator,
        {
            ...mockModerator,
            id: 'moderator_987654321',
            userId: 'user_moderator_2',
            role: 'senior_moderator',
            moderationLevel: 3,
            assignedCommunities: ['community_3', 'community_4', 'community_5'],
            specializations: ['eating-disorders', 'addiction'],
            metrics: {
                totalActions: 456,
                postsModerated: 334,
                usersWarned: 78,
                usersBanned: 23,
                communitiesManaged: 3,
                averageResponseTime: 12.3,
            },
        },
    ];
    beforeEach(async () => {
        module = await testing_1.Test.createTestingModule({
            controllers: [moderator_controller_1.ModeratorController],
            providers: [
                {
                    provide: moderator_service_1.ModeratorService,
                    useValue: mockModeratorService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .compile();
        controller = module.get(moderator_controller_1.ModeratorController);
        moderatorService = module.get(moderator_service_1.ModeratorService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Controller Initialization', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have moderatorService injected', () => {
            expect(moderatorService).toBeDefined();
        });
    });
    describe('Security Guards', () => {
        it('should be protected by JwtAuthGuard', () => {
            const guards = Reflect.getMetadata('__guards__', moderator_controller_1.ModeratorController);
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
        });
        it('should have proper route decorators', () => {
            const controllerMetadata = Reflect.getMetadata('path', moderator_controller_1.ModeratorController);
            expect(controllerMetadata).toBe('moderator');
        });
    });
    describe('GET /moderator', () => {
        it('should get all moderators successfully', async () => {
            mockModeratorService.findAll.mockResolvedValue(mockModeratorsList);
            const result = await controller.findAll();
            expect(result).toEqual(mockModeratorsList);
            expect(result).toHaveLength(2);
            expect(moderatorService.findAll).toHaveBeenCalledWith();
        });
        it('should handle empty moderators list', async () => {
            mockModeratorService.findAll.mockResolvedValue([]);
            const result = await controller.findAll();
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database connection failed');
            mockModeratorService.findAll.mockRejectedValue(serviceError);
            await expect(controller.findAll()).rejects.toThrow(common_1.HttpException);
            await expect(controller.findAll()).rejects.toThrow('Failed to fetch moderators');
        });
        it('should return moderators with all required fields', async () => {
            mockModeratorService.findAll.mockResolvedValue(mockModeratorsList);
            const result = await controller.findAll();
            result.forEach((moderator) => {
                expect(moderator).toHaveProperty('id');
                expect(moderator).toHaveProperty('userId');
                expect(moderator).toHaveProperty('role');
                expect(moderator).toHaveProperty('permissions');
                expect(moderator).toHaveProperty('assignedCommunities');
                expect(moderator).toHaveProperty('moderationLevel');
                expect(moderator).toHaveProperty('isActive');
                expect(moderator).toHaveProperty('metrics');
                expect(Array.isArray(moderator.permissions)).toBe(true);
                expect(Array.isArray(moderator.assignedCommunities)).toBe(true);
                expect(typeof moderator.moderationLevel).toBe('number');
                expect(typeof moderator.isActive).toBe('boolean');
            });
        });
        it('should handle different moderator roles', async () => {
            const diverseModeratorsList = [
                { ...mockModerator, role: 'content_moderator' },
                { ...mockModerator, id: 'mod_2', role: 'senior_moderator' },
                { ...mockModerator, id: 'mod_3', role: 'community_manager' },
                { ...mockModerator, id: 'mod_4', role: 'crisis_moderator' },
            ];
            mockModeratorService.findAll.mockResolvedValue(diverseModeratorsList);
            const result = await controller.findAll();
            const roles = result.map(mod => mod.role);
            expect(roles).toContain('content_moderator');
            expect(roles).toContain('senior_moderator');
            expect(roles).toContain('community_manager');
            expect(roles).toContain('crisis_moderator');
        });
    });
    describe('GET /moderator/:id', () => {
        const moderatorId = 'moderator_123456789';
        it('should get moderator by id successfully', async () => {
            mockModeratorService.findOne.mockResolvedValue(mockModerator);
            const result = await controller.findOne(moderatorId);
            expect(result).toEqual(mockModerator);
            expect(moderatorService.findOne).toHaveBeenCalledWith(moderatorId);
        });
        it('should handle moderator not found', async () => {
            mockModeratorService.findOne.mockResolvedValue(null);
            await expect(controller.findOne('non-existent-id')).rejects.toThrow(common_1.HttpException);
            await expect(controller.findOne('non-existent-id')).rejects.toThrow('Moderator not found');
        });
        it('should return complete moderator details', async () => {
            const detailedModerator = {
                ...mockModerator,
                recentActions: [
                    {
                        id: 'action_1',
                        type: 'post_moderation',
                        target: 'post_123',
                        action: 'approved',
                        timestamp: new Date(),
                        reason: 'Content appropriate',
                    },
                    {
                        id: 'action_2',
                        type: 'user_warning',
                        target: 'user_456',
                        action: 'warned',
                        timestamp: new Date(),
                        reason: 'Inappropriate language',
                    },
                ],
                managedCommunities: [
                    {
                        id: 'community_1',
                        name: 'Anxiety Support',
                        memberCount: 1250,
                        activeIssues: 3,
                    },
                    {
                        id: 'community_2',
                        name: 'Depression Recovery',
                        memberCount: 890,
                        activeIssues: 1,
                    },
                ],
            };
            mockModeratorService.findOne.mockResolvedValue(detailedModerator);
            const result = await controller.findOne(moderatorId);
            expect(result.recentActions).toBeDefined();
            expect(result.managedCommunities).toBeDefined();
            expect(Array.isArray(result.recentActions)).toBe(true);
            expect(Array.isArray(result.managedCommunities)).toBe(true);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database query failed');
            mockModeratorService.findOne.mockRejectedValue(serviceError);
            await expect(controller.findOne(moderatorId)).rejects.toThrow(common_1.HttpException);
            await expect(controller.findOne(moderatorId)).rejects.toThrow('Failed to fetch moderator');
        });
        it('should preserve HttpExceptions from service layer', async () => {
            const httpException = new common_1.HttpException('Access denied', common_1.HttpStatus.FORBIDDEN);
            mockModeratorService.findOne.mockRejectedValue(httpException);
            await expect(controller.findOne(moderatorId)).rejects.toThrow(httpException);
        });
    });
    describe('POST /moderator', () => {
        const createModeratorDto = {
            userId: 'new_moderator_user_id',
            role: 'content_moderator',
            permissions: ['view_posts', 'moderate_posts'],
            assignedCommunities: ['community_1'],
            moderationLevel: 1,
            isActive: true,
            specializations: ['anxiety'],
            languages: ['english'],
            timezone: 'America/New_York',
            workingHours: {
                monday: { start: '09:00', end: '17:00' },
                tuesday: { start: '09:00', end: '17:00' },
                wednesday: { start: '09:00', end: '17:00' },
                thursday: { start: '09:00', end: '17:00' },
                friday: { start: '09:00', end: '17:00' },
            },
        };
        it('should create moderator successfully', async () => {
            const createdModerator = {
                ...mockModerator,
                ...createModeratorDto,
                id: 'new_moderator_123456789',
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            mockModeratorService.create.mockResolvedValue(createdModerator);
            const result = await controller.create(createModeratorDto);
            expect(result).toEqual(createdModerator);
            expect(result.userId).toBe(createModeratorDto.userId);
            expect(result.role).toBe(createModeratorDto.role);
            expect(moderatorService.create).toHaveBeenCalledWith(createModeratorDto);
        });
        it('should handle different moderator roles creation', async () => {
            const roles = ['content_moderator', 'senior_moderator', 'community_manager', 'crisis_moderator'];
            for (const role of roles) {
                const dto = { ...createModeratorDto, role };
                const createdModerator = {
                    ...mockModerator,
                    ...dto,
                    id: `moderator_${role}_123`,
                };
                mockModeratorService.create.mockResolvedValue(createdModerator);
                const result = await controller.create(dto);
                expect(result.role).toBe(role);
            }
        });
        it('should handle different moderation levels', async () => {
            const levels = [1, 2, 3, 4, 5];
            for (const level of levels) {
                const dto = { ...createModeratorDto, moderationLevel: level };
                const createdModerator = {
                    ...mockModerator,
                    ...dto,
                    id: `moderator_level_${level}`,
                };
                mockModeratorService.create.mockResolvedValue(createdModerator);
                const result = await controller.create(dto);
                expect(result.moderationLevel).toBe(level);
            }
        });
        it('should handle various permission combinations', async () => {
            const permissionSets = [
                ['view_posts'],
                ['view_posts', 'moderate_posts'],
                ['view_posts', 'moderate_posts', 'delete_posts'],
                ['view_posts', 'moderate_posts', 'delete_posts', 'ban_users'],
                ['view_posts', 'moderate_posts', 'manage_communities'],
            ];
            for (const permissions of permissionSets) {
                const dto = { ...createModeratorDto, permissions };
                const createdModerator = {
                    ...mockModerator,
                    ...dto,
                    id: `moderator_perm_${permissions.length}`,
                };
                mockModeratorService.create.mockResolvedValue(createdModerator);
                const result = await controller.create(dto);
                expect(result.permissions).toEqual(permissions);
            }
        });
        it('should handle creation with multiple specializations', async () => {
            const specializations = [
                ['anxiety'],
                ['anxiety', 'depression'],
                ['anxiety', 'depression', 'trauma'],
                ['mental-health', 'crisis-intervention', 'eating-disorders'],
            ];
            for (const specs of specializations) {
                const dto = { ...createModeratorDto, specializations: specs };
                const createdModerator = {
                    ...mockModerator,
                    ...dto,
                    id: `moderator_spec_${specs.length}`,
                };
                mockModeratorService.create.mockResolvedValue(createdModerator);
                const result = await controller.create(dto);
                expect(result.specializations).toEqual(specs);
            }
        });
        it('should handle creation errors', async () => {
            const creationError = new Error('User already has moderator role');
            mockModeratorService.create.mockRejectedValue(creationError);
            await expect(controller.create(createModeratorDto)).rejects.toThrow(common_1.HttpException);
            await expect(controller.create(createModeratorDto)).rejects.toThrow('Failed to create moderator');
        });
        it('should handle validation errors', async () => {
            const validationError = new Error('Invalid permission level');
            mockModeratorService.create.mockRejectedValue(validationError);
            await expect(controller.create(createModeratorDto)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('PUT /moderator/:id', () => {
        const moderatorId = 'moderator_123456789';
        const updateModeratorDto = {
            role: 'senior_moderator',
            permissions: ['view_posts', 'moderate_posts', 'delete_posts', 'ban_users'],
            moderationLevel: 3,
            assignedCommunities: ['community_1', 'community_2', 'community_3'],
            specializations: ['anxiety', 'depression', 'trauma'],
        };
        it('should update moderator successfully', async () => {
            const updatedModerator = {
                ...mockModerator,
                ...updateModeratorDto,
                updatedAt: new Date(),
            };
            mockModeratorService.update.mockResolvedValue(updatedModerator);
            const result = await controller.update(moderatorId, updateModeratorDto);
            expect(result).toEqual(updatedModerator);
            expect(result.role).toBe(updateModeratorDto.role);
            expect(result.moderationLevel).toBe(updateModeratorDto.moderationLevel);
            expect(moderatorService.update).toHaveBeenCalledWith(moderatorId, updateModeratorDto);
        });
        it('should handle partial updates', async () => {
            const partialUpdate = { moderationLevel: 4 };
            const partiallyUpdatedModerator = {
                ...mockModerator,
                moderationLevel: 4,
                updatedAt: new Date(),
            };
            mockModeratorService.update.mockResolvedValue(partiallyUpdatedModerator);
            const result = await controller.update(moderatorId, partialUpdate);
            expect(result.moderationLevel).toBe(4);
            expect(result.role).toBe(mockModerator.role); // unchanged
        });
        it('should handle role promotion updates', async () => {
            const promotionUpdates = [
                { role: 'senior_moderator', moderationLevel: 3 },
                { role: 'community_manager', moderationLevel: 4 },
                { role: 'crisis_moderator', moderationLevel: 5 },
            ];
            for (const promotion of promotionUpdates) {
                const promotedModerator = {
                    ...mockModerator,
                    ...promotion,
                    updatedAt: new Date(),
                };
                mockModeratorService.update.mockResolvedValue(promotedModerator);
                const result = await controller.update(moderatorId, promotion);
                expect(result.role).toBe(promotion.role);
                expect(result.moderationLevel).toBe(promotion.moderationLevel);
            }
        });
        it('should handle permission updates', async () => {
            const permissionUpdates = [
                { permissions: ['view_posts'] },
                { permissions: ['view_posts', 'moderate_posts'] },
                { permissions: ['view_posts', 'moderate_posts', 'delete_posts'] },
                { permissions: ['view_posts', 'moderate_posts', 'delete_posts', 'ban_users', 'manage_communities'] },
            ];
            for (const permUpdate of permissionUpdates) {
                const updatedModerator = {
                    ...mockModerator,
                    ...permUpdate,
                    updatedAt: new Date(),
                };
                mockModeratorService.update.mockResolvedValue(updatedModerator);
                const result = await controller.update(moderatorId, permUpdate);
                expect(result.permissions).toEqual(permUpdate.permissions);
            }
        });
        it('should handle moderator not found', async () => {
            const notFoundError = new Error('Moderator not found');
            mockModeratorService.update.mockRejectedValue(notFoundError);
            await expect(controller.update('non-existent-id', updateModeratorDto)).rejects.toThrow(common_1.HttpException);
            await expect(controller.update('non-existent-id', updateModeratorDto)).rejects.toThrow('Failed to update moderator');
        });
        it('should handle active status changes', async () => {
            const statusChanges = [
                { isActive: false }, // deactivate
                { isActive: true }, // reactivate
            ];
            for (const statusChange of statusChanges) {
                const statusUpdatedModerator = {
                    ...mockModerator,
                    ...statusChange,
                    updatedAt: new Date(),
                };
                mockModeratorService.update.mockResolvedValue(statusUpdatedModerator);
                const result = await controller.update(moderatorId, statusChange);
                expect(result.isActive).toBe(statusChange.isActive);
            }
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database update failed');
            mockModeratorService.update.mockRejectedValue(serviceError);
            await expect(controller.update(moderatorId, updateModeratorDto)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('DELETE /moderator/:id', () => {
        const moderatorId = 'moderator_123456789';
        it('should delete moderator successfully', async () => {
            mockModeratorService.remove.mockResolvedValue(mockModerator);
            const result = await controller.remove(moderatorId);
            expect(result).toEqual(mockModerator);
            expect(moderatorService.remove).toHaveBeenCalledWith(moderatorId);
        });
        it('should handle moderator not found', async () => {
            const notFoundError = new Error('Moderator not found');
            mockModeratorService.remove.mockRejectedValue(notFoundError);
            await expect(controller.remove('non-existent-id')).rejects.toThrow(common_1.HttpException);
            await expect(controller.remove('non-existent-id')).rejects.toThrow('Failed to delete moderator');
        });
        it('should handle deletion with active assignments', async () => {
            const activeAssignmentError = new Error('Cannot delete moderator with active assignments');
            mockModeratorService.remove.mockRejectedValue(activeAssignmentError);
            await expect(controller.remove(moderatorId)).rejects.toThrow(common_1.HttpException);
        });
        it('should return deleted moderator data', async () => {
            const deletedModerator = {
                ...mockModerator,
                isActive: false,
                deletedAt: new Date(),
            };
            mockModeratorService.remove.mockResolvedValue(deletedModerator);
            const result = await controller.remove(moderatorId);
            expect(result).toEqual(deletedModerator);
            expect(result.id).toBe(moderatorId);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database transaction failed');
            mockModeratorService.remove.mockRejectedValue(serviceError);
            await expect(controller.remove(moderatorId)).rejects.toThrow(common_1.HttpException);
            await expect(controller.remove(moderatorId)).rejects.toThrow('Failed to delete moderator');
        });
    });
    describe('Error Handling', () => {
        it('should handle service unavailable scenarios', async () => {
            const serviceError = new Error('Service temporarily unavailable');
            mockModeratorService.findAll.mockRejectedValue(serviceError);
            await expect(controller.findAll()).rejects.toThrow(common_1.HttpException);
        });
        it('should handle database connection errors', async () => {
            const dbError = new Error('Database connection failed');
            mockModeratorService.findOne.mockRejectedValue(dbError);
            await expect(controller.findOne('moderator_123')).rejects.toThrow(common_1.HttpException);
        });
        it('should handle validation errors', async () => {
            const validationError = new Error('Invalid moderator data');
            mockModeratorService.create.mockRejectedValue(validationError);
            await expect(controller.create({})).rejects.toThrow(common_1.HttpException);
        });
        it('should provide meaningful error messages', async () => {
            const specificError = new Error('User is already a moderator');
            mockModeratorService.create.mockRejectedValue(specificError);
            try {
                await controller.create({});
            }
            catch (error) {
                expect(error).toBeInstanceOf(common_1.HttpException);
                expect(error.message).toContain('Failed to create moderator');
                expect(error.message).toContain('User is already a moderator');
            }
        });
    });
    describe('Response Format Validation', () => {
        it('should return properly formatted moderator list response', async () => {
            mockModeratorService.findAll.mockResolvedValue(mockModeratorsList);
            const result = await controller.findAll();
            expect(Array.isArray(result)).toBe(true);
            result.forEach((moderator) => {
                enhanced_test_helpers_1.TestAssertions.expectValidEntity(moderator, ['id', 'userId', 'role', 'permissions']);
                expect(typeof moderator.moderationLevel).toBe('number');
                expect(typeof moderator.isActive).toBe('boolean');
                expect(Array.isArray(moderator.permissions)).toBe(true);
                expect(Array.isArray(moderator.assignedCommunities)).toBe(true);
            });
        });
        it('should return properly formatted single moderator response', async () => {
            mockModeratorService.findOne.mockResolvedValue(mockModerator);
            const result = await controller.findOne('moderator_123');
            enhanced_test_helpers_1.TestAssertions.expectValidEntity(result, ['id', 'userId', 'role', 'permissions']);
            expect(result.createdAt).toBeInstanceOf(Date);
            expect(result.updatedAt).toBeInstanceOf(Date);
            expect(result.metrics).toBeDefined();
            expect(typeof result.metrics.totalActions).toBe('number');
            expect(typeof result.metrics.averageResponseTime).toBe('number');
        });
        it('should validate moderator permissions format', async () => {
            mockModeratorService.findOne.mockResolvedValue(mockModerator);
            const result = await controller.findOne('moderator_123');
            expect(Array.isArray(result.permissions)).toBe(true);
            result.permissions.forEach((permission) => {
                expect(typeof permission).toBe('string');
                expect(permission.length).toBeGreaterThan(0);
            });
        });
        it('should validate moderator metrics format', async () => {
            mockModeratorService.findOne.mockResolvedValue(mockModerator);
            const result = await controller.findOne('moderator_123');
            expect(result.metrics).toBeDefined();
            expect(typeof result.metrics.totalActions).toBe('number');
            expect(typeof result.metrics.postsModerated).toBe('number');
            expect(typeof result.metrics.usersWarned).toBe('number');
            expect(typeof result.metrics.usersBanned).toBe('number');
            expect(typeof result.metrics.averageResponseTime).toBe('number');
            expect(result.metrics.totalActions).toBeGreaterThanOrEqual(0);
            expect(result.metrics.averageResponseTime).toBeGreaterThanOrEqual(0);
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete moderator lifecycle', async () => {
            // Create moderator
            const createDto = {
                userId: 'new_user_123',
                role: 'content_moderator',
                permissions: ['view_posts', 'moderate_posts'],
                assignedCommunities: ['community_1'],
                moderationLevel: 1,
                isActive: true,
                specializations: ['anxiety'],
                languages: ['english'],
                timezone: 'America/New_York',
            };
            const createdModerator = { ...mockModerator, ...createDto, id: 'new_moderator_123' };
            mockModeratorService.create.mockResolvedValue(createdModerator);
            const createResult = await controller.create(createDto);
            expect(createResult.role).toBe('content_moderator');
            // Update moderator (promotion)
            const updateDto = { role: 'senior_moderator', moderationLevel: 3 };
            const updatedModerator = { ...createdModerator, ...updateDto };
            mockModeratorService.update.mockResolvedValue(updatedModerator);
            const updateResult = await controller.update(createdModerator.id, updateDto);
            expect(updateResult.role).toBe('senior_moderator');
            expect(updateResult.moderationLevel).toBe(3);
            // Get moderator details
            mockModeratorService.findOne.mockResolvedValue(updatedModerator);
            const getResult = await controller.findOne(createdModerator.id);
            expect(getResult).toEqual(updatedModerator);
            // Remove moderator
            mockModeratorService.remove.mockResolvedValue(updatedModerator);
            const removeResult = await controller.remove(createdModerator.id);
            expect(removeResult).toEqual(updatedModerator);
        });
        it('should handle moderator permission progression', async () => {
            // Start with basic permissions
            const basicModerator = {
                ...mockModerator,
                permissions: ['view_posts'],
                moderationLevel: 1,
            };
            mockModeratorService.findOne.mockResolvedValue(basicModerator);
            const basic = await controller.findOne('moderator_123');
            expect(basic.permissions).toEqual(['view_posts']);
            // Upgrade to moderate permissions
            const moderateUpdate = { permissions: ['view_posts', 'moderate_posts'] };
            const moderateModerator = { ...basicModerator, ...moderateUpdate };
            mockModeratorService.update.mockResolvedValue(moderateModerator);
            const moderate = await controller.update('moderator_123', moderateUpdate);
            expect(moderate.permissions).toContain('moderate_posts');
            // Upgrade to full permissions
            const fullUpdate = { permissions: ['view_posts', 'moderate_posts', 'delete_posts', 'ban_users'] };
            const fullModerator = { ...moderateModerator, ...fullUpdate };
            mockModeratorService.update.mockResolvedValue(fullModerator);
            const full = await controller.update('moderator_123', fullUpdate);
            expect(full.permissions).toContain('ban_users');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21vZGVyYXRvci9tb2RlcmF0b3IuY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsNkNBQXNEO0FBQ3RELDJDQUF1SDtBQUN2SCxpRUFBNkQ7QUFDN0QsMkRBQXVEO0FBQ3ZELGtFQUE2RDtBQUc3RCwrRUFBcUc7QUFDckcsK0NBQWlFO0FBRWpFLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxVQUErQixDQUFDO0lBQ3BDLElBQUksZ0JBQWtDLENBQUM7SUFDdkMsSUFBSSxNQUFxQixDQUFDO0lBRTFCLHdCQUF3QjtJQUN4QixNQUFNLG9CQUFvQixHQUFHO1FBQzNCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2xCLENBQUM7SUFFRixvQkFBb0I7SUFDcEIsTUFBTSxnQkFBZ0IsR0FBRztRQUN2QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7S0FDN0MsQ0FBQztJQUVGLFlBQVk7SUFDWixNQUFNLGFBQWEsR0FBYztRQUMvQixFQUFFLEVBQUUscUJBQXFCO1FBQ3pCLE1BQU0sRUFBRSxxQkFBYSxDQUFDLFNBQVM7UUFDL0IsSUFBSSxFQUFFLG1CQUFtQjtRQUN6QixXQUFXLEVBQUUsQ0FBQyxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLFdBQVcsQ0FBQztRQUMxRSxtQkFBbUIsRUFBRSxDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUM7UUFDbkQsZUFBZSxFQUFFLENBQUM7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ZUFBZSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbW9kZXJhdG9yL21vZGVyYXRvci5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21wcmVoZW5zaXZlIFRlc3QgU3VpdGUgZm9yIE1vZGVyYXRvckNvbnRyb2xsZXJcbiAqIFRlc3RzIG1vZGVyYXRvciBDUlVEIG9wZXJhdGlvbnMgYW5kIG1hbmFnZW1lbnQgZnVuY3Rpb25hbGl0eVxuICovXG5cbmltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQmFkUmVxdWVzdEV4Y2VwdGlvbiwgTm90Rm91bmRFeGNlcHRpb24sIEZvcmJpZGRlbkV4Y2VwdGlvbiwgSHR0cEV4Y2VwdGlvbiwgSHR0cFN0YXR1cyB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IE1vZGVyYXRvckNvbnRyb2xsZXIgfSBmcm9tICcuL21vZGVyYXRvci5jb250cm9sbGVyJztcbmltcG9ydCB7IE1vZGVyYXRvclNlcnZpY2UgfSBmcm9tICcuL21vZGVyYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IE1vZGVyYXRvciwgUHJpc21hIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHsgU2VjdXJpdHlHdWFyZFRlc3RVdGlscywgUm9sZUJhc2VkVGVzdFV0aWxzIH0gZnJvbSAnLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQgeyBNb2NrQnVpbGRlciwgVGVzdERhdGFHZW5lcmF0b3IsIFRlc3RBc3NlcnRpb25zIH0gZnJvbSAnLi4vdGVzdC11dGlscy9lbmhhbmNlZC10ZXN0LWhlbHBlcnMnO1xuaW1wb3J0IHsgVEVTVF9VU0VSX0lEUywgVEVTVF9FTUFJTFMgfSBmcm9tICcuLi90ZXN0LXV0aWxzL2luZGV4JztcblxuZGVzY3JpYmUoJ01vZGVyYXRvckNvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBNb2RlcmF0b3JDb250cm9sbGVyO1xuICBsZXQgbW9kZXJhdG9yU2VydmljZTogTW9kZXJhdG9yU2VydmljZTtcbiAgbGV0IG1vZHVsZTogVGVzdGluZ01vZHVsZTtcblxuICAvLyBNb2NrIE1vZGVyYXRvclNlcnZpY2VcbiAgY29uc3QgbW9ja01vZGVyYXRvclNlcnZpY2UgPSB7XG4gICAgZmluZEFsbDogamVzdC5mbigpLFxuICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICByZW1vdmU6IGplc3QuZm4oKSxcbiAgfTtcblxuICAvLyBNb2NrIEp3dEF1dGhHdWFyZFxuICBjb25zdCBtb2NrSnd0QXV0aEd1YXJkID0ge1xuICAgIGNhbkFjdGl2YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICB9O1xuXG4gIC8vIFRlc3QgZGF0YVxuICBjb25zdCBtb2NrTW9kZXJhdG9yOiBNb2RlcmF0b3IgPSB7XG4gICAgaWQ6ICdtb2RlcmF0b3JfMTIzNDU2Nzg5JyxcbiAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SLFxuICAgIHJvbGU6ICdjb250ZW50X21vZGVyYXRvcicsXG4gICAgcGVybWlzc2lvbnM6IFsndmlld19wb3N0cycsICdtb2RlcmF0ZV9wb3N0cycsICdkZWxldGVfcG9zdHMnLCAnYmFuX3VzZXJzJ10sXG4gICAgYXNzaWduZWRDb21tdW5pdGllczogWydjb21tdW5pdHlfMScsICdjb21tdW5pdHlfMiddLFxuICAgIG1vZGVyYXRpb25MZXZlbDogMixcbiAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICBzcGVjaWFsaXphdGlvbnM6IFsnbWVudGFsLWhlYWx0aCcsICdjcmlzaXMtaW50ZXJ2ZW50aW9uJ10sXG4gICAgbGFuZ3VhZ2VzOiBbJ2VuZ2xpc2gnLCAnc3BhbmlzaCddLFxuICAgIHRpbWV6b25lOiAnQW1lcmljYS9OZXdfWW9yaycsXG4gICAgd29ya2luZ0hvdXJzOiB7XG4gICAgICBtb25kYXk6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE3OjAwJyB9LFxuICAgICAgdHVlc2RheTogeyBzdGFydDogJzA5OjAwJywgZW5kOiAnMTc6MDAnIH0sXG4gICAgICB3ZWRuZXNkYXk6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE3OjAwJyB9LFxuICAgICAgdGh1cnNkYXk6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE3OjAwJyB9LFxuICAgICAgZnJpZGF5OiB7IHN0YXJ0OiAnMDk6MDAnLCBlbmQ6ICcxNzowMCcgfSxcbiAgICB9LFxuICAgIG1ldHJpY3M6IHtcbiAgICAgIHRvdGFsQWN0aW9uczogMjQ1LFxuICAgICAgcG9zdHNNb2RlcmF0ZWQ6IDE4OSxcbiAgICAgIHVzZXJzV2FybmVkOiAzMixcbiAgICAgIHVzZXJzQmFubmVkOiA4LFxuICAgICAgY29tbXVuaXRpZXNNYW5hZ2VkOiAyLFxuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogMTguNSwgLy8gbWludXRlc1xuICAgIH0sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0xNVQwMDowMDowMFonKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAyLTE0VDEwOjAwOjAwWicpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tNb2RlcmF0b3JzTGlzdDogTW9kZXJhdG9yW10gPSBbXG4gICAgbW9ja01vZGVyYXRvcixcbiAgICB7XG4gICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgaWQ6ICdtb2RlcmF0b3JfOTg3NjU0MzIxJyxcbiAgICAgIHVzZXJJZDogJ3VzZXJfbW9kZXJhdG9yXzInLFxuICAgICAgcm9sZTogJ3Nlbmlvcl9tb2RlcmF0b3InLFxuICAgICAgbW9kZXJhdGlvbkxldmVsOiAzLFxuICAgICAgYXNzaWduZWRDb21tdW5pdGllczogWydjb21tdW5pdHlfMycsICdjb21tdW5pdHlfNCcsICdjb21tdW5pdHlfNSddLFxuICAgICAgc3BlY2lhbGl6YXRpb25zOiBbJ2VhdGluZy1kaXNvcmRlcnMnLCAnYWRkaWN0aW9uJ10sXG4gICAgICBtZXRyaWNzOiB7XG4gICAgICAgIHRvdGFsQWN0aW9uczogNDU2LFxuICAgICAgICBwb3N0c01vZGVyYXRlZDogMzM0LFxuICAgICAgICB1c2Vyc1dhcm5lZDogNzgsXG4gICAgICAgIHVzZXJzQmFubmVkOiAyMyxcbiAgICAgICAgY29tbXVuaXRpZXNNYW5hZ2VkOiAzLFxuICAgICAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiAxMi4zLFxuICAgICAgfSxcbiAgICB9LFxuICBdO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIG1vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW01vZGVyYXRvckNvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBNb2RlcmF0b3JTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrTW9kZXJhdG9yU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgICAgIC5vdmVycmlkZUd1YXJkKEp3dEF1dGhHdWFyZClcbiAgICAgIC51c2VWYWx1ZShtb2NrSnd0QXV0aEd1YXJkKVxuICAgICAgLmNvbXBpbGUoKTtcblxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PE1vZGVyYXRvckNvbnRyb2xsZXI+KE1vZGVyYXRvckNvbnRyb2xsZXIpO1xuICAgIG1vZGVyYXRvclNlcnZpY2UgPSBtb2R1bGUuZ2V0PE1vZGVyYXRvclNlcnZpY2U+KE1vZGVyYXRvclNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29udHJvbGxlciBJbml0aWFsaXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY29udHJvbGxlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBtb2RlcmF0b3JTZXJ2aWNlIGluamVjdGVkJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KG1vZGVyYXRvclNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBHdWFyZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBiZSBwcm90ZWN0ZWQgYnkgSnd0QXV0aEd1YXJkJywgKCkgPT4ge1xuICAgICAgY29uc3QgZ3VhcmRzID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnX19ndWFyZHNfXycsIE1vZGVyYXRvckNvbnRyb2xsZXIpO1xuICAgICAgZXhwZWN0KGd1YXJkcykudG9Db250YWluKEp3dEF1dGhHdWFyZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgcHJvcGVyIHJvdXRlIGRlY29yYXRvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250cm9sbGVyTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdwYXRoJywgTW9kZXJhdG9yQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoY29udHJvbGxlck1ldGFkYXRhKS50b0JlKCdtb2RlcmF0b3InKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvbW9kZXJhdG9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGFsbCBtb2RlcmF0b3JzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcnNMaXN0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01vZGVyYXRvcnNMaXN0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JTZXJ2aWNlLmZpbmRBbGwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBtb2RlcmF0b3JzIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5maW5kQWxsLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5maW5kQWxsLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRBbGwoKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZmluZEFsbCgpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBmZXRjaCBtb2RlcmF0b3JzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBtb2RlcmF0b3JzIHdpdGggYWxsIHJlcXVpcmVkIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcnNMaXN0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKCk7XG5cbiAgICAgIHJlc3VsdC5mb3JFYWNoKChtb2RlcmF0b3IpID0+IHtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ2lkJyk7XG4gICAgICAgIGV4cGVjdChtb2RlcmF0b3IpLnRvSGF2ZVByb3BlcnR5KCd1c2VySWQnKTtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ3JvbGUnKTtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ3Blcm1pc3Npb25zJyk7XG4gICAgICAgIGV4cGVjdChtb2RlcmF0b3IpLnRvSGF2ZVByb3BlcnR5KCdhc3NpZ25lZENvbW11bml0aWVzJyk7XG4gICAgICAgIGV4cGVjdChtb2RlcmF0b3IpLnRvSGF2ZVByb3BlcnR5KCdtb2RlcmF0aW9uTGV2ZWwnKTtcbiAgICAgICAgZXhwZWN0KG1vZGVyYXRvcikudG9IYXZlUHJvcGVydHkoJ2lzQWN0aXZlJyk7XG4gICAgICAgIGV4cGVjdChtb2RlcmF0b3IpLnRvSGF2ZVByb3BlcnR5KCdtZXRyaWNzJyk7XG4gICAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KG1vZGVyYXRvci5wZXJtaXNzaW9ucykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KG1vZGVyYXRvci5hc3NpZ25lZENvbW11bml0aWVzKSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBtb2RlcmF0b3IubW9kZXJhdGlvbkxldmVsKS50b0JlKCdudW1iZXInKTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBtb2RlcmF0b3IuaXNBY3RpdmUpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlmZmVyZW50IG1vZGVyYXRvciByb2xlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRpdmVyc2VNb2RlcmF0b3JzTGlzdCA9IFtcbiAgICAgICAgeyAuLi5tb2NrTW9kZXJhdG9yLCByb2xlOiAnY29udGVudF9tb2RlcmF0b3InIH0sXG4gICAgICAgIHsgLi4ubW9ja01vZGVyYXRvciwgaWQ6ICdtb2RfMicsIHJvbGU6ICdzZW5pb3JfbW9kZXJhdG9yJyB9LFxuICAgICAgICB7IC4uLm1vY2tNb2RlcmF0b3IsIGlkOiAnbW9kXzMnLCByb2xlOiAnY29tbXVuaXR5X21hbmFnZXInIH0sXG4gICAgICAgIHsgLi4ubW9ja01vZGVyYXRvciwgaWQ6ICdtb2RfNCcsIHJvbGU6ICdjcmlzaXNfbW9kZXJhdG9yJyB9LFxuICAgICAgXTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUoZGl2ZXJzZU1vZGVyYXRvcnNMaXN0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKCk7XG5cbiAgICAgIGNvbnN0IHJvbGVzID0gcmVzdWx0Lm1hcChtb2QgPT4gbW9kLnJvbGUpO1xuICAgICAgZXhwZWN0KHJvbGVzKS50b0NvbnRhaW4oJ2NvbnRlbnRfbW9kZXJhdG9yJyk7XG4gICAgICBleHBlY3Qocm9sZXMpLnRvQ29udGFpbignc2VuaW9yX21vZGVyYXRvcicpO1xuICAgICAgZXhwZWN0KHJvbGVzKS50b0NvbnRhaW4oJ2NvbW11bml0eV9tYW5hZ2VyJyk7XG4gICAgICBleHBlY3Qocm9sZXMpLnRvQ29udGFpbignY3Jpc2lzX21vZGVyYXRvcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9tb2RlcmF0b3IvOmlkJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vZGVyYXRvcklkID0gJ21vZGVyYXRvcl8xMjM0NTY3ODknO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgbW9kZXJhdG9yIGJ5IGlkIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZE9uZShtb2RlcmF0b3JJZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01vZGVyYXRvcik7XG4gICAgICBleHBlY3QobW9kZXJhdG9yU2VydmljZS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2RlcmF0b3JJZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2RlcmF0b3Igbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZmluZE9uZSgnbm9uLWV4aXN0ZW50LWlkJykpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRPbmUoJ25vbi1leGlzdGVudC1pZCcpKS5yZWplY3RzLnRvVGhyb3coJ01vZGVyYXRvciBub3QgZm91bmQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbXBsZXRlIG1vZGVyYXRvciBkZXRhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGV0YWlsZWRNb2RlcmF0b3IgPSB7XG4gICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgIHJlY2VudEFjdGlvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ2FjdGlvbl8xJyxcbiAgICAgICAgICAgIHR5cGU6ICdwb3N0X21vZGVyYXRpb24nLFxuICAgICAgICAgICAgdGFyZ2V0OiAncG9zdF8xMjMnLFxuICAgICAgICAgICAgYWN0aW9uOiAnYXBwcm92ZWQnLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgcmVhc29uOiAnQ29udGVudCBhcHByb3ByaWF0ZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJ2FjdGlvbl8yJyxcbiAgICAgICAgICAgIHR5cGU6ICd1c2VyX3dhcm5pbmcnLFxuICAgICAgICAgICAgdGFyZ2V0OiAndXNlcl80NTYnLFxuICAgICAgICAgICAgYWN0aW9uOiAnd2FybmVkJyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHJlYXNvbjogJ0luYXBwcm9wcmlhdGUgbGFuZ3VhZ2UnLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIG1hbmFnZWRDb21tdW5pdGllczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnY29tbXVuaXR5XzEnLFxuICAgICAgICAgICAgbmFtZTogJ0FueGlldHkgU3VwcG9ydCcsXG4gICAgICAgICAgICBtZW1iZXJDb3VudDogMTI1MCxcbiAgICAgICAgICAgIGFjdGl2ZUlzc3VlczogMyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnY29tbXVuaXR5XzInLFxuICAgICAgICAgICAgbmFtZTogJ0RlcHJlc3Npb24gUmVjb3ZlcnknLFxuICAgICAgICAgICAgbWVtYmVyQ291bnQ6IDg5MCxcbiAgICAgICAgICAgIGFjdGl2ZUlzc3VlczogMSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoZGV0YWlsZWRNb2RlcmF0b3IpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUobW9kZXJhdG9ySWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJlY2VudEFjdGlvbnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1hbmFnZWRDb21tdW5pdGllcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdC5yZWNlbnRBY3Rpb25zKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdC5tYW5hZ2VkQ29tbXVuaXRpZXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIHF1ZXJ5IGZhaWxlZCcpO1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuZmluZE9uZS5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kT25lKG1vZGVyYXRvcklkKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZmluZE9uZShtb2RlcmF0b3JJZCkpLnJlamVjdHMudG9UaHJvdygnRmFpbGVkIHRvIGZldGNoIG1vZGVyYXRvcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBIdHRwRXhjZXB0aW9ucyBmcm9tIHNlcnZpY2UgbGF5ZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBodHRwRXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oJ0FjY2VzcyBkZW5pZWQnLCBIdHRwU3RhdHVzLkZPUkJJRERFTik7XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5maW5kT25lLm1vY2tSZWplY3RlZFZhbHVlKGh0dHBFeGNlcHRpb24pO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kT25lKG1vZGVyYXRvcklkKSkucmVqZWN0cy50b1Rocm93KGh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUE9TVCAvbW9kZXJhdG9yJywgKCkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZU1vZGVyYXRvckR0bzogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgdXNlcklkOiAnbmV3X21vZGVyYXRvcl91c2VyX2lkJyxcbiAgICAgIHJvbGU6ICdjb250ZW50X21vZGVyYXRvcicsXG4gICAgICBwZXJtaXNzaW9uczogWyd2aWV3X3Bvc3RzJywgJ21vZGVyYXRlX3Bvc3RzJ10sXG4gICAgICBhc3NpZ25lZENvbW11bml0aWVzOiBbJ2NvbW11bml0eV8xJ10sXG4gICAgICBtb2RlcmF0aW9uTGV2ZWw6IDEsXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIHNwZWNpYWxpemF0aW9uczogWydhbnhpZXR5J10sXG4gICAgICBsYW5ndWFnZXM6IFsnZW5nbGlzaCddLFxuICAgICAgdGltZXpvbmU6ICdBbWVyaWNhL05ld19Zb3JrJyxcbiAgICAgIHdvcmtpbmdIb3Vyczoge1xuICAgICAgICBtb25kYXk6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE3OjAwJyB9LFxuICAgICAgICB0dWVzZGF5OiB7IHN0YXJ0OiAnMDk6MDAnLCBlbmQ6ICcxNzowMCcgfSxcbiAgICAgICAgd2VkbmVzZGF5OiB7IHN0YXJ0OiAnMDk6MDAnLCBlbmQ6ICcxNzowMCcgfSxcbiAgICAgICAgdGh1cnNkYXk6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE3OjAwJyB9LFxuICAgICAgICBmcmlkYXk6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE3OjAwJyB9LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgbW9kZXJhdG9yIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZWRNb2RlcmF0b3IgPSB7XG4gICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgIC4uLmNyZWF0ZU1vZGVyYXRvckR0byxcbiAgICAgICAgaWQ6ICduZXdfbW9kZXJhdG9yXzEyMzQ1Njc4OScsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShjcmVhdGVkTW9kZXJhdG9yKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGUoY3JlYXRlTW9kZXJhdG9yRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChjcmVhdGVkTW9kZXJhdG9yKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcklkKS50b0JlKGNyZWF0ZU1vZGVyYXRvckR0by51c2VySWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yb2xlKS50b0JlKGNyZWF0ZU1vZGVyYXRvckR0by5yb2xlKTtcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY3JlYXRlTW9kZXJhdG9yRHRvKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRpZmZlcmVudCBtb2RlcmF0b3Igcm9sZXMgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByb2xlcyA9IFsnY29udGVudF9tb2RlcmF0b3InLCAnc2VuaW9yX21vZGVyYXRvcicsICdjb21tdW5pdHlfbWFuYWdlcicsICdjcmlzaXNfbW9kZXJhdG9yJ107XG4gICAgICBcbiAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiByb2xlcykge1xuICAgICAgICBjb25zdCBkdG8gPSB7IC4uLmNyZWF0ZU1vZGVyYXRvckR0bywgcm9sZSB9O1xuICAgICAgICBjb25zdCBjcmVhdGVkTW9kZXJhdG9yID0ge1xuICAgICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgICAgLi4uZHRvLFxuICAgICAgICAgIGlkOiBgbW9kZXJhdG9yXyR7cm9sZX1fMTIzYCxcbiAgICAgICAgfTtcbiAgICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKGNyZWF0ZWRNb2RlcmF0b3IpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlKGR0byk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yb2xlKS50b0JlKHJvbGUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlmZmVyZW50IG1vZGVyYXRpb24gbGV2ZWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGV2ZWxzID0gWzEsIDIsIDMsIDQsIDVdO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGxldmVsIG9mIGxldmVscykge1xuICAgICAgICBjb25zdCBkdG8gPSB7IC4uLmNyZWF0ZU1vZGVyYXRvckR0bywgbW9kZXJhdGlvbkxldmVsOiBsZXZlbCB9O1xuICAgICAgICBjb25zdCBjcmVhdGVkTW9kZXJhdG9yID0ge1xuICAgICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgICAgLi4uZHRvLFxuICAgICAgICAgIGlkOiBgbW9kZXJhdG9yX2xldmVsXyR7bGV2ZWx9YCxcbiAgICAgICAgfTtcbiAgICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKGNyZWF0ZWRNb2RlcmF0b3IpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlKGR0byk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5tb2RlcmF0aW9uTGV2ZWwpLnRvQmUobGV2ZWwpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmFyaW91cyBwZXJtaXNzaW9uIGNvbWJpbmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25TZXRzID0gW1xuICAgICAgICBbJ3ZpZXdfcG9zdHMnXSxcbiAgICAgICAgWyd2aWV3X3Bvc3RzJywgJ21vZGVyYXRlX3Bvc3RzJ10sXG4gICAgICAgIFsndmlld19wb3N0cycsICdtb2RlcmF0ZV9wb3N0cycsICdkZWxldGVfcG9zdHMnXSxcbiAgICAgICAgWyd2aWV3X3Bvc3RzJywgJ21vZGVyYXRlX3Bvc3RzJywgJ2RlbGV0ZV9wb3N0cycsICdiYW5fdXNlcnMnXSxcbiAgICAgICAgWyd2aWV3X3Bvc3RzJywgJ21vZGVyYXRlX3Bvc3RzJywgJ21hbmFnZV9jb21tdW5pdGllcyddLFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBwZXJtaXNzaW9ucyBvZiBwZXJtaXNzaW9uU2V0cykge1xuICAgICAgICBjb25zdCBkdG8gPSB7IC4uLmNyZWF0ZU1vZGVyYXRvckR0bywgcGVybWlzc2lvbnMgfTtcbiAgICAgICAgY29uc3QgY3JlYXRlZE1vZGVyYXRvciA9IHtcbiAgICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICAgIC4uLmR0byxcbiAgICAgICAgICBpZDogYG1vZGVyYXRvcl9wZXJtXyR7cGVybWlzc2lvbnMubGVuZ3RofWAsXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShjcmVhdGVkTW9kZXJhdG9yKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShkdG8pO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQucGVybWlzc2lvbnMpLnRvRXF1YWwocGVybWlzc2lvbnMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY3JlYXRpb24gd2l0aCBtdWx0aXBsZSBzcGVjaWFsaXphdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzcGVjaWFsaXphdGlvbnMgPSBbXG4gICAgICAgIFsnYW54aWV0eSddLFxuICAgICAgICBbJ2FueGlldHknLCAnZGVwcmVzc2lvbiddLFxuICAgICAgICBbJ2FueGlldHknLCAnZGVwcmVzc2lvbicsICd0cmF1bWEnXSxcbiAgICAgICAgWydtZW50YWwtaGVhbHRoJywgJ2NyaXNpcy1pbnRlcnZlbnRpb24nLCAnZWF0aW5nLWRpc29yZGVycyddLFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBzcGVjcyBvZiBzcGVjaWFsaXphdGlvbnMpIHtcbiAgICAgICAgY29uc3QgZHRvID0geyAuLi5jcmVhdGVNb2RlcmF0b3JEdG8sIHNwZWNpYWxpemF0aW9uczogc3BlY3MgfTtcbiAgICAgICAgY29uc3QgY3JlYXRlZE1vZGVyYXRvciA9IHtcbiAgICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICAgIC4uLmR0byxcbiAgICAgICAgICBpZDogYG1vZGVyYXRvcl9zcGVjXyR7c3BlY3MubGVuZ3RofWAsXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShjcmVhdGVkTW9kZXJhdG9yKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShkdG8pO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3BlY2lhbGl6YXRpb25zKS50b0VxdWFsKHNwZWNzKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNyZWF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0aW9uRXJyb3IgPSBuZXcgRXJyb3IoJ1VzZXIgYWxyZWFkeSBoYXMgbW9kZXJhdG9yIHJvbGUnKTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShjcmVhdGlvbkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlKGNyZWF0ZU1vZGVyYXRvckR0bykpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZShjcmVhdGVNb2RlcmF0b3JEdG8pKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBjcmVhdGUgbW9kZXJhdG9yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2YWxpZGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBFcnJvcignSW52YWxpZCBwZXJtaXNzaW9uIGxldmVsJyk7XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWUodmFsaWRhdGlvbkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlKGNyZWF0ZU1vZGVyYXRvckR0bykpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BVVCAvbW9kZXJhdG9yLzppZCcsICgpID0+IHtcbiAgICBjb25zdCBtb2RlcmF0b3JJZCA9ICdtb2RlcmF0b3JfMTIzNDU2Nzg5JztcbiAgICBjb25zdCB1cGRhdGVNb2RlcmF0b3JEdG86IFByaXNtYS5Nb2RlcmF0b3JVcGRhdGVJbnB1dCA9IHtcbiAgICAgIHJvbGU6ICdzZW5pb3JfbW9kZXJhdG9yJyxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ3ZpZXdfcG9zdHMnLCAnbW9kZXJhdGVfcG9zdHMnLCAnZGVsZXRlX3Bvc3RzJywgJ2Jhbl91c2VycyddLFxuICAgICAgbW9kZXJhdGlvbkxldmVsOiAzLFxuICAgICAgYXNzaWduZWRDb21tdW5pdGllczogWydjb21tdW5pdHlfMScsICdjb21tdW5pdHlfMicsICdjb21tdW5pdHlfMyddLFxuICAgICAgc3BlY2lhbGl6YXRpb25zOiBbJ2FueGlldHknLCAnZGVwcmVzc2lvbicsICd0cmF1bWEnXSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgbW9kZXJhdG9yIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWRNb2RlcmF0b3IgPSB7XG4gICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgIC4uLnVwZGF0ZU1vZGVyYXRvckR0byxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkTW9kZXJhdG9yKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGUobW9kZXJhdG9ySWQsIHVwZGF0ZU1vZGVyYXRvckR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZE1vZGVyYXRvcik7XG4gICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUodXBkYXRlTW9kZXJhdG9yRHRvLnJvbGUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tb2RlcmF0aW9uTGV2ZWwpLnRvQmUodXBkYXRlTW9kZXJhdG9yRHRvLm1vZGVyYXRpb25MZXZlbCk7XG4gICAgICBleHBlY3QobW9kZXJhdG9yU2VydmljZS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vZGVyYXRvcklkLCB1cGRhdGVNb2RlcmF0b3JEdG8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGFydGlhbCB1cGRhdGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFydGlhbFVwZGF0ZSA9IHsgbW9kZXJhdGlvbkxldmVsOiA0IH07XG4gICAgICBjb25zdCBwYXJ0aWFsbHlVcGRhdGVkTW9kZXJhdG9yID0ge1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICBtb2RlcmF0aW9uTGV2ZWw6IDQsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUocGFydGlhbGx5VXBkYXRlZE1vZGVyYXRvcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlKG1vZGVyYXRvcklkLCBwYXJ0aWFsVXBkYXRlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5tb2RlcmF0aW9uTGV2ZWwpLnRvQmUoNCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUobW9ja01vZGVyYXRvci5yb2xlKTsgLy8gdW5jaGFuZ2VkXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByb2xlIHByb21vdGlvbiB1cGRhdGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvbW90aW9uVXBkYXRlcyA9IFtcbiAgICAgICAgeyByb2xlOiAnc2VuaW9yX21vZGVyYXRvcicsIG1vZGVyYXRpb25MZXZlbDogMyB9LFxuICAgICAgICB7IHJvbGU6ICdjb21tdW5pdHlfbWFuYWdlcicsIG1vZGVyYXRpb25MZXZlbDogNCB9LFxuICAgICAgICB7IHJvbGU6ICdjcmlzaXNfbW9kZXJhdG9yJywgbW9kZXJhdGlvbkxldmVsOiA1IH0sXG4gICAgICBdO1xuXG4gICAgICBmb3IgKGNvbnN0IHByb21vdGlvbiBvZiBwcm9tb3Rpb25VcGRhdGVzKSB7XG4gICAgICAgIGNvbnN0IHByb21vdGVkTW9kZXJhdG9yID0ge1xuICAgICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgICAgLi4ucHJvbW90aW9uLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfTtcbiAgICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHByb21vdGVkTW9kZXJhdG9yKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZShtb2RlcmF0b3JJZCwgcHJvbW90aW9uKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUocHJvbW90aW9uLnJvbGUpO1xuICAgICAgICBleHBlY3QocmVzdWx0Lm1vZGVyYXRpb25MZXZlbCkudG9CZShwcm9tb3Rpb24ubW9kZXJhdGlvbkxldmVsKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBlcm1pc3Npb24gdXBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25VcGRhdGVzID0gW1xuICAgICAgICB7IHBlcm1pc3Npb25zOiBbJ3ZpZXdfcG9zdHMnXSB9LFxuICAgICAgICB7IHBlcm1pc3Npb25zOiBbJ3ZpZXdfcG9zdHMnLCAnbW9kZXJhdGVfcG9zdHMnXSB9LFxuICAgICAgICB7IHBlcm1pc3Npb25zOiBbJ3ZpZXdfcG9zdHMnLCAnbW9kZXJhdGVfcG9zdHMnLCAnZGVsZXRlX3Bvc3RzJ10gfSxcbiAgICAgICAgeyBwZXJtaXNzaW9uczogWyd2aWV3X3Bvc3RzJywgJ21vZGVyYXRlX3Bvc3RzJywgJ2RlbGV0ZV9wb3N0cycsICdiYW5fdXNlcnMnLCAnbWFuYWdlX2NvbW11bml0aWVzJ10gfSxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgcGVybVVwZGF0ZSBvZiBwZXJtaXNzaW9uVXBkYXRlcykge1xuICAgICAgICBjb25zdCB1cGRhdGVkTW9kZXJhdG9yID0ge1xuICAgICAgICAgIC4uLm1vY2tNb2RlcmF0b3IsXG4gICAgICAgICAgLi4ucGVybVVwZGF0ZSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkTW9kZXJhdG9yKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZShtb2RlcmF0b3JJZCwgcGVybVVwZGF0ZSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5wZXJtaXNzaW9ucykudG9FcXVhbChwZXJtVXBkYXRlLnBlcm1pc3Npb25zKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1vZGVyYXRvciBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdNb2RlcmF0b3Igbm90IGZvdW5kJyk7XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS51cGRhdGUubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLnVwZGF0ZSgnbm9uLWV4aXN0ZW50LWlkJywgdXBkYXRlTW9kZXJhdG9yRHRvKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIudXBkYXRlKCdub24tZXhpc3RlbnQtaWQnLCB1cGRhdGVNb2RlcmF0b3JEdG8pKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byB1cGRhdGUgbW9kZXJhdG9yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhY3RpdmUgc3RhdHVzIGNoYW5nZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0dXNDaGFuZ2VzID0gW1xuICAgICAgICB7IGlzQWN0aXZlOiBmYWxzZSB9LCAvLyBkZWFjdGl2YXRlXG4gICAgICAgIHsgaXNBY3RpdmU6IHRydWUgfSwgIC8vIHJlYWN0aXZhdGVcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3Qgc3RhdHVzQ2hhbmdlIG9mIHN0YXR1c0NoYW5nZXMpIHtcbiAgICAgICAgY29uc3Qgc3RhdHVzVXBkYXRlZE1vZGVyYXRvciA9IHtcbiAgICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICAgIC4uLnN0YXR1c0NoYW5nZSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShzdGF0dXNVcGRhdGVkTW9kZXJhdG9yKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZShtb2RlcmF0b3JJZCwgc3RhdHVzQ2hhbmdlKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmlzQWN0aXZlKS50b0JlKHN0YXR1c0NoYW5nZS5pc0FjdGl2ZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgdXBkYXRlIGZhaWxlZCcpO1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UudXBkYXRlLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLnVwZGF0ZShtb2RlcmF0b3JJZCwgdXBkYXRlTW9kZXJhdG9yRHRvKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnREVMRVRFIC9tb2RlcmF0b3IvOmlkJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vZGVyYXRvcklkID0gJ21vZGVyYXRvcl8xMjM0NTY3ODknO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgbW9kZXJhdG9yIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnJlbW92ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZW1vdmUobW9kZXJhdG9ySWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNb2RlcmF0b3IpO1xuICAgICAgZXhwZWN0KG1vZGVyYXRvclNlcnZpY2UucmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2RlcmF0b3JJZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2RlcmF0b3Igbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignTW9kZXJhdG9yIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UucmVtb3ZlLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZW1vdmUoJ25vbi1leGlzdGVudC1pZCcpKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZW1vdmUoJ25vbi1leGlzdGVudC1pZCcpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBkZWxldGUgbW9kZXJhdG9yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkZWxldGlvbiB3aXRoIGFjdGl2ZSBhc3NpZ25tZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFjdGl2ZUFzc2lnbm1lbnRFcnJvciA9IG5ldyBFcnJvcignQ2Fubm90IGRlbGV0ZSBtb2RlcmF0b3Igd2l0aCBhY3RpdmUgYXNzaWdubWVudHMnKTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnJlbW92ZS5tb2NrUmVqZWN0ZWRWYWx1ZShhY3RpdmVBc3NpZ25tZW50RXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZW1vdmUobW9kZXJhdG9ySWQpKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBkZWxldGVkIG1vZGVyYXRvciBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGVsZXRlZE1vZGVyYXRvciA9IHtcbiAgICAgICAgLi4ubW9ja01vZGVyYXRvcixcbiAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgICBkZWxldGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UucmVtb3ZlLm1vY2tSZXNvbHZlZFZhbHVlKGRlbGV0ZWRNb2RlcmF0b3IpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlbW92ZShtb2RlcmF0b3JJZCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZGVsZXRlZE1vZGVyYXRvcik7XG4gICAgICBleHBlY3QocmVzdWx0LmlkKS50b0JlKG1vZGVyYXRvcklkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSB0cmFuc2FjdGlvbiBmYWlsZWQnKTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnJlbW92ZS5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZW1vdmUobW9kZXJhdG9ySWQpKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZW1vdmUobW9kZXJhdG9ySWQpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBkZWxldGUgbW9kZXJhdG9yJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIHVuYXZhaWxhYmxlIHNjZW5hcmlvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignU2VydmljZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZScpO1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuZmluZEFsbC5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGJFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRPbmUubW9ja1JlamVjdGVkVmFsdWUoZGJFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRPbmUoJ21vZGVyYXRvcl8xMjMnKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3IgPSBuZXcgRXJyb3IoJ0ludmFsaWQgbW9kZXJhdG9yIGRhdGEnKTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZSh2YWxpZGF0aW9uRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5jcmVhdGUoe30gYXMgYW55KSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIG1lYW5pbmdmdWwgZXJyb3IgbWVzc2FnZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzcGVjaWZpY0Vycm9yID0gbmV3IEVycm9yKCdVc2VyIGlzIGFscmVhZHkgYSBtb2RlcmF0b3InKTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShzcGVjaWZpY0Vycm9yKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgY29udHJvbGxlci5jcmVhdGUoe30gYXMgYW55KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoSHR0cEV4Y2VwdGlvbik7XG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ0ZhaWxlZCB0byBjcmVhdGUgbW9kZXJhdG9yJyk7XG4gICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ1VzZXIgaXMgYWxyZWFkeSBhIG1vZGVyYXRvcicpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzcG9uc2UgRm9ybWF0IFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIG1vZGVyYXRvciBsaXN0IHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuZmluZEFsbC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yc0xpc3QpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRBbGwoKTtcblxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICAgIHJlc3VsdC5mb3JFYWNoKChtb2RlcmF0b3IpID0+IHtcbiAgICAgICAgVGVzdEFzc2VydGlvbnMuZXhwZWN0VmFsaWRFbnRpdHkobW9kZXJhdG9yLCBbJ2lkJywgJ3VzZXJJZCcsICdyb2xlJywgJ3Blcm1pc3Npb25zJ10pO1xuICAgICAgICBleHBlY3QodHlwZW9mIG1vZGVyYXRvci5tb2RlcmF0aW9uTGV2ZWwpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QodHlwZW9mIG1vZGVyYXRvci5pc0FjdGl2ZSkudG9CZSgnYm9vbGVhbicpO1xuICAgICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShtb2RlcmF0b3IucGVybWlzc2lvbnMpKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShtb2RlcmF0b3IuYXNzaWduZWRDb21tdW5pdGllcykpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3Blcmx5IGZvcm1hdHRlZCBzaW5nbGUgbW9kZXJhdG9yIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kT25lKCdtb2RlcmF0b3JfMTIzJyk7XG5cbiAgICAgIFRlc3RBc3NlcnRpb25zLmV4cGVjdFZhbGlkRW50aXR5KHJlc3VsdCwgWydpZCcsICd1c2VySWQnLCAncm9sZScsICdwZXJtaXNzaW9ucyddKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3JlYXRlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXBkYXRlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0Lm1ldHJpY3MudG90YWxBY3Rpb25zKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0Lm1ldHJpY3MuYXZlcmFnZVJlc3BvbnNlVGltZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG1vZGVyYXRvciBwZXJtaXNzaW9ucyBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0b3IpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUoJ21vZGVyYXRvcl8xMjMnKTtcblxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LnBlcm1pc3Npb25zKSkudG9CZSh0cnVlKTtcbiAgICAgIHJlc3VsdC5wZXJtaXNzaW9ucy5mb3JFYWNoKChwZXJtaXNzaW9uKSA9PiB7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgcGVybWlzc2lvbikudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIGV4cGVjdChwZXJtaXNzaW9uLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG1vZGVyYXRvciBtZXRyaWNzIGZvcm1hdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRvcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZE9uZSgnbW9kZXJhdG9yXzEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lm1ldHJpY3MpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5tZXRyaWNzLnRvdGFsQWN0aW9ucykudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5tZXRyaWNzLnBvc3RzTW9kZXJhdGVkKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0Lm1ldHJpY3MudXNlcnNXYXJuZWQpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQubWV0cmljcy51c2Vyc0Jhbm5lZCkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5tZXRyaWNzLmF2ZXJhZ2VSZXNwb25zZVRpbWUpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRyaWNzLnRvdGFsQWN0aW9ucykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcy5hdmVyYWdlUmVzcG9uc2VUaW1lKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgbW9kZXJhdG9yIGxpZmVjeWNsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBtb2RlcmF0b3JcbiAgICAgIGNvbnN0IGNyZWF0ZUR0bzogUHJpc21hLk1vZGVyYXRvckNyZWF0ZUlucHV0ID0ge1xuICAgICAgICB1c2VySWQ6ICduZXdfdXNlcl8xMjMnLFxuICAgICAgICByb2xlOiAnY29udGVudF9tb2RlcmF0b3InLFxuICAgICAgICBwZXJtaXNzaW9uczogWyd2aWV3X3Bvc3RzJywgJ21vZGVyYXRlX3Bvc3RzJ10sXG4gICAgICAgIGFzc2lnbmVkQ29tbXVuaXRpZXM6IFsnY29tbXVuaXR5XzEnXSxcbiAgICAgICAgbW9kZXJhdGlvbkxldmVsOiAxLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgc3BlY2lhbGl6YXRpb25zOiBbJ2FueGlldHknXSxcbiAgICAgICAgbGFuZ3VhZ2VzOiBbJ2VuZ2xpc2gnXSxcbiAgICAgICAgdGltZXpvbmU6ICdBbWVyaWNhL05ld19Zb3JrJyxcbiAgICAgIH07XG4gICAgICBjb25zdCBjcmVhdGVkTW9kZXJhdG9yID0geyAuLi5tb2NrTW9kZXJhdG9yLCAuLi5jcmVhdGVEdG8sIGlkOiAnbmV3X21vZGVyYXRvcl8xMjMnIH07XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoY3JlYXRlZE1vZGVyYXRvcik7XG4gICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShjcmVhdGVEdG8pO1xuICAgICAgZXhwZWN0KGNyZWF0ZVJlc3VsdC5yb2xlKS50b0JlKCdjb250ZW50X21vZGVyYXRvcicpO1xuXG4gICAgICAvLyBVcGRhdGUgbW9kZXJhdG9yIChwcm9tb3Rpb24pXG4gICAgICBjb25zdCB1cGRhdGVEdG8gPSB7IHJvbGU6ICdzZW5pb3JfbW9kZXJhdG9yJywgbW9kZXJhdGlvbkxldmVsOiAzIH07XG4gICAgICBjb25zdCB1cGRhdGVkTW9kZXJhdG9yID0geyAuLi5jcmVhdGVkTW9kZXJhdG9yLCAuLi51cGRhdGVEdG8gfTtcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkTW9kZXJhdG9yKTtcbiAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlKGNyZWF0ZWRNb2RlcmF0b3IuaWQsIHVwZGF0ZUR0byk7XG4gICAgICBleHBlY3QodXBkYXRlUmVzdWx0LnJvbGUpLnRvQmUoJ3Nlbmlvcl9tb2RlcmF0b3InKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVSZXN1bHQubW9kZXJhdGlvbkxldmVsKS50b0JlKDMpO1xuXG4gICAgICAvLyBHZXQgbW9kZXJhdG9yIGRldGFpbHNcbiAgICAgIG1vY2tNb2RlcmF0b3JTZXJ2aWNlLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZE1vZGVyYXRvcik7XG4gICAgICBjb25zdCBnZXRSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUoY3JlYXRlZE1vZGVyYXRvci5pZCk7XG4gICAgICBleHBlY3QoZ2V0UmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRNb2RlcmF0b3IpO1xuXG4gICAgICAvLyBSZW1vdmUgbW9kZXJhdG9yXG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5yZW1vdmUubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZE1vZGVyYXRvcik7XG4gICAgICBjb25zdCByZW1vdmVSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlbW92ZShjcmVhdGVkTW9kZXJhdG9yLmlkKTtcbiAgICAgIGV4cGVjdChyZW1vdmVSZXN1bHQpLnRvRXF1YWwodXBkYXRlZE1vZGVyYXRvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2RlcmF0b3IgcGVybWlzc2lvbiBwcm9ncmVzc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFN0YXJ0IHdpdGggYmFzaWMgcGVybWlzc2lvbnNcbiAgICAgIGNvbnN0IGJhc2ljTW9kZXJhdG9yID0ge1xuICAgICAgICAuLi5tb2NrTW9kZXJhdG9yLFxuICAgICAgICBwZXJtaXNzaW9uczogWyd2aWV3X3Bvc3RzJ10sXG4gICAgICAgIG1vZGVyYXRpb25MZXZlbDogMSxcbiAgICAgIH07XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKGJhc2ljTW9kZXJhdG9yKTtcbiAgICAgIGNvbnN0IGJhc2ljID0gYXdhaXQgY29udHJvbGxlci5maW5kT25lKCdtb2RlcmF0b3JfMTIzJyk7XG4gICAgICBleHBlY3QoYmFzaWMucGVybWlzc2lvbnMpLnRvRXF1YWwoWyd2aWV3X3Bvc3RzJ10pO1xuXG4gICAgICAvLyBVcGdyYWRlIHRvIG1vZGVyYXRlIHBlcm1pc3Npb25zXG4gICAgICBjb25zdCBtb2RlcmF0ZVVwZGF0ZSA9IHsgcGVybWlzc2lvbnM6IFsndmlld19wb3N0cycsICdtb2RlcmF0ZV9wb3N0cyddIH07XG4gICAgICBjb25zdCBtb2RlcmF0ZU1vZGVyYXRvciA9IHsgLi4uYmFzaWNNb2RlcmF0b3IsIC4uLm1vZGVyYXRlVXBkYXRlIH07XG4gICAgICBtb2NrTW9kZXJhdG9yU2VydmljZS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9kZXJhdGVNb2RlcmF0b3IpO1xuICAgICAgY29uc3QgbW9kZXJhdGUgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZSgnbW9kZXJhdG9yXzEyMycsIG1vZGVyYXRlVXBkYXRlKTtcbiAgICAgIGV4cGVjdChtb2RlcmF0ZS5wZXJtaXNzaW9ucykudG9Db250YWluKCdtb2RlcmF0ZV9wb3N0cycpO1xuXG4gICAgICAvLyBVcGdyYWRlIHRvIGZ1bGwgcGVybWlzc2lvbnNcbiAgICAgIGNvbnN0IGZ1bGxVcGRhdGUgPSB7IHBlcm1pc3Npb25zOiBbJ3ZpZXdfcG9zdHMnLCAnbW9kZXJhdGVfcG9zdHMnLCAnZGVsZXRlX3Bvc3RzJywgJ2Jhbl91c2VycyddIH07XG4gICAgICBjb25zdCBmdWxsTW9kZXJhdG9yID0geyAuLi5tb2RlcmF0ZU1vZGVyYXRvciwgLi4uZnVsbFVwZGF0ZSB9O1xuICAgICAgbW9ja01vZGVyYXRvclNlcnZpY2UudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKGZ1bGxNb2RlcmF0b3IpO1xuICAgICAgY29uc3QgZnVsbCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlKCdtb2RlcmF0b3JfMTIzJywgZnVsbFVwZGF0ZSk7XG4gICAgICBleHBlY3QoZnVsbC5wZXJtaXNzaW9ucykudG9Db250YWluKCdiYW5fdXNlcnMnKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=