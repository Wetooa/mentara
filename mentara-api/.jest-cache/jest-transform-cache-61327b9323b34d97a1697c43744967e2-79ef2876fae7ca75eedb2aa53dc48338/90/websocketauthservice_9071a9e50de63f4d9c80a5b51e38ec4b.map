{"version":3,"names":["cov_2k6qv57p20","actualCoverage","common_1","s","require","jwt_1","prisma_client_provider_1","WebSocketAuthService","WebSocketAuthService_1","jwtService","prisma","logger","Logger","name","connectionAttempts","Map","authenticatedConnections","MAX_ATTEMPTS_PER_MINUTE","MAX_CONNECTIONS_PER_USER","constructor","f","setInterval","cleanupConnectionTracking","authenticateSocket","socket","clientIp","getClientIp","checkRateLimit","b","warn","recordConnectionAttempt","token","extractToken","id","payload","verify","algorithms","sub","email","tokenAge","Date","now","iat","existingConnections","getUserConnectionCount","user","findUnique","where","deactivatedAt","isActive","select","role","emailVerified","lockoutUntil","failedLoginCount","authenticatedUser","userId","lastAuthenticated","connectionCount","set","log","error","Error","message","authHeader","handshake","headers","authorization","startsWith","substring","trim","length","authToken","auth","queryToken","query","cookies","cookie","sessionCookie","extractCookieValue","escapedName","replace","match","RegExp","decodeURIComponent","validateToken","cleanupConnection","socketId","delete","address","conn","remoteAddress","ipAddress","attempts","get","oneMinuteAgo","recentAttempts","filter","attempt","timestamp","success","has","push","oneHourAgo","Array","from","values","ip","entries","debug","getConnectionStats","totalConnections","size","uniqueUsers","Set","map","trackedIps","maxConnectionsPerUser","maxAttemptsPerMinute","exports","__decorate","Injectable","JwtService","_a","Object","_b","PrismaService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/services/websocket-auth.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { JwtService } from '@nestjs/jwt';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { Socket } from 'socket.io';\nimport { WsException } from '@nestjs/websockets';\n\nexport interface AuthenticatedUser {\n  userId: string;\n  role?: string;\n  lastAuthenticated?: Date;\n  connectionCount?: number;\n}\n\ninterface ConnectionAttempt {\n  timestamp: Date;\n  success: boolean;\n  ipAddress?: string;\n}\n\n@Injectable()\nexport class WebSocketAuthService {\n  private readonly logger = new Logger(WebSocketAuthService.name);\n  private readonly connectionAttempts = new Map<string, ConnectionAttempt[]>();\n  private readonly authenticatedConnections = new Map<\n    string,\n    AuthenticatedUser\n  >();\n  private readonly MAX_ATTEMPTS_PER_MINUTE = 10;\n  private readonly MAX_CONNECTIONS_PER_USER = 5;\n\n  constructor(\n    private readonly jwtService: JwtService,\n    private readonly prisma: PrismaService,\n  ) {\n    // Clean up connection tracking every 5 minutes\n    setInterval(() => this.cleanupConnectionTracking(), 5 * 60 * 1000);\n  }\n\n  async authenticateSocket(socket: Socket): Promise<AuthenticatedUser | null> {\n    const clientIp = this.getClientIp(socket);\n\n    try {\n      // Rate limiting check\n      if (!this.checkRateLimit(clientIp)) {\n        this.logger.warn(`Rate limit exceeded for IP ${clientIp}`);\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      // Extract token from various sources\n      const token = this.extractToken(socket);\n\n      if (!token) {\n        this.logger.warn(`Socket ${socket.id} connected without valid token`);\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      // Verify JWT token with additional security checks\n      const payload = this.jwtService.verify(token, {\n        algorithms: ['HS256'], // Restrict to specific algorithm\n      });\n\n      if (!payload.sub || !payload.email) {\n        this.logger.warn(`Socket ${socket.id} has invalid token payload`);\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      // Check for token freshness (prevent replay attacks)\n      const tokenAge = Date.now() / 1000 - payload.iat;\n      if (tokenAge > 24 * 60 * 60) {\n        // 24 hours\n        this.logger.warn(`Socket ${socket.id} using stale token`);\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      // Check connection limit per user\n      const existingConnections = this.getUserConnectionCount(payload.sub);\n      if (existingConnections >= this.MAX_CONNECTIONS_PER_USER) {\n        this.logger.warn(\n          `User ${payload.sub} exceeded connection limit (${existingConnections})`,\n        );\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      // Validate user exists in database and is not deactivated\n      const user = await this.prisma.user.findUnique({\n        where: {\n          id: payload.sub,\n          deactivatedAt: null,\n          isActive: true,\n        },\n        select: {\n          id: true,\n          role: true,\n          emailVerified: true,\n          lockoutUntil: true,\n          failedLoginCount: true,\n        },\n      });\n\n      if (!user) {\n        this.logger.warn(`Socket ${socket.id} user not found or deactivated`);\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      // Check if user account is locked\n      if (user.lockoutUntil && user.lockoutUntil > new Date()) {\n        this.logger.warn(\n          `Socket ${socket.id} user account is locked until ${user.lockoutUntil}`,\n        );\n        this.recordConnectionAttempt(clientIp, false);\n        return null;\n      }\n\n      const authenticatedUser: AuthenticatedUser = {\n        userId: user.id,\n        role: user.role,\n        lastAuthenticated: new Date(),\n        connectionCount: existingConnections + 1,\n      };\n\n      // Track successful authentication\n      this.authenticatedConnections.set(socket.id, authenticatedUser);\n      this.recordConnectionAttempt(clientIp, true);\n\n      this.logger.log(\n        `Socket ${socket.id} authenticated as user ${user.id} with role ${user.role} (${authenticatedUser.connectionCount} connections)`,\n      );\n\n      return authenticatedUser;\n    } catch (error) {\n      this.logger.error(\n        `Socket ${socket.id} authentication failed:`,\n        error instanceof Error ? error.message : error,\n      );\n      this.recordConnectionAttempt(clientIp, false);\n      return null;\n    }\n  }\n\n  private extractToken(socket: Socket): string | null {\n    // Try different token sources in order of preference\n\n    // 1. Authorization header (Bearer token)\n    const authHeader = socket.handshake.headers.authorization;\n    if (\n      authHeader &&\n      typeof authHeader === 'string' &&\n      authHeader.startsWith('Bearer ')\n    ) {\n      const token = authHeader.substring(7).trim();\n      return token.length > 0 ? token : null;\n    }\n\n    // 2. Auth object in handshake\n    const authToken = socket.handshake.auth?.token;\n    if (authToken && typeof authToken === 'string') {\n      return authToken;\n    }\n\n    // 3. Query parameter\n    const queryToken = socket.handshake.query?.token;\n    if (queryToken && typeof queryToken === 'string') {\n      return queryToken;\n    }\n\n    // 4. Cookie (for browser connections)\n    const cookies = socket.handshake.headers.cookie;\n    if (cookies) {\n      const sessionCookie = this.extractCookieValue(cookies, '__session');\n      if (sessionCookie) {\n        return sessionCookie;\n      }\n    }\n\n    return null;\n  }\n\n  private extractCookieValue(cookies: string, name: string): string | null {\n    try {\n      // Escape special regex characters in cookie name\n      const escapedName = name.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n      const match = cookies.match(new RegExp(`(^| )${escapedName}=([^;]+)`));\n      if (match && match[2]) {\n        return decodeURIComponent(match[2]);\n      }\n      return null;\n    } catch (error) {\n      this.logger.warn(`Failed to extract cookie value for ${name}:`, error);\n      return null;\n    }\n  }\n\n  async validateToken(token: string): Promise<boolean> {\n    try {\n      // Simply verify if the JWT token is valid\n      const payload = this.jwtService.verify(token);\n\n      // Additional validation: check if user still exists and is active\n      const user = await this.prisma.user.findUnique({\n        where: {\n          id: payload.sub,\n          deactivatedAt: null,\n        },\n        select: { id: true },\n      });\n\n      return !!user;\n    } catch (error) {\n      this.logger.warn('Token validation failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Clean up connection tracking when socket disconnects\n   */\n  cleanupConnection(socketId: string): void {\n    this.authenticatedConnections.delete(socketId);\n  }\n\n  /**\n   * Get client IP address from socket\n   */\n  private getClientIp(socket: Socket): string {\n    return (\n      (socket.handshake.headers['x-forwarded-for'] as string) ||\n      (socket.handshake.headers['x-real-ip'] as string) ||\n      socket.handshake.address ||\n      socket.conn.remoteAddress ||\n      'unknown'\n    );\n  }\n\n  /**\n   * Check rate limiting for connection attempts\n   */\n  private checkRateLimit(ipAddress: string): boolean {\n    const attempts = this.connectionAttempts.get(ipAddress) || [];\n    const oneMinuteAgo = new Date(Date.now() - 60 * 1000);\n\n    // Filter to attempts in the last minute\n    const recentAttempts = attempts.filter(\n      (attempt) => attempt.timestamp > oneMinuteAgo,\n    );\n\n    return recentAttempts.length < this.MAX_ATTEMPTS_PER_MINUTE;\n  }\n\n  /**\n   * Record connection attempt for rate limiting\n   */\n  private recordConnectionAttempt(ipAddress: string, success: boolean): void {\n    if (!this.connectionAttempts.has(ipAddress)) {\n      this.connectionAttempts.set(ipAddress, []);\n    }\n\n    const attempts = this.connectionAttempts.get(ipAddress)!;\n    attempts.push({\n      timestamp: new Date(),\n      success,\n      ipAddress,\n    });\n\n    // Keep only recent attempts\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n    const recentAttempts = attempts.filter(\n      (attempt) => attempt.timestamp > oneHourAgo,\n    );\n    this.connectionAttempts.set(ipAddress, recentAttempts);\n  }\n\n  /**\n   * Get current connection count for a user\n   */\n  private getUserConnectionCount(userId: string): number {\n    return Array.from(this.authenticatedConnections.values()).filter(\n      (user) => user.userId === userId,\n    ).length;\n  }\n\n  /**\n   * Clean up old connection tracking data\n   */\n  private cleanupConnectionTracking(): void {\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\n\n    // Clean up connection attempts\n    for (const [ip, attempts] of this.connectionAttempts.entries()) {\n      const recentAttempts = attempts.filter(\n        (attempt) => attempt.timestamp > oneHourAgo,\n      );\n      if (recentAttempts.length === 0) {\n        this.connectionAttempts.delete(ip);\n      } else {\n        this.connectionAttempts.set(ip, recentAttempts);\n      }\n    }\n\n    this.logger.debug('Cleaned up connection tracking data');\n  }\n\n  /**\n   * Get connection statistics for monitoring\n   */\n  getConnectionStats() {\n    return {\n      totalConnections: this.authenticatedConnections.size,\n      uniqueUsers: new Set(\n        Array.from(this.authenticatedConnections.values()).map(\n          (user) => user.userId,\n        ),\n      ).size,\n      trackedIps: this.connectionAttempts.size,\n      maxConnectionsPerUser: this.MAX_CONNECTIONS_PER_USER,\n      maxAttemptsPerMinute: this.MAX_ATTEMPTS_PER_MINUTE,\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}