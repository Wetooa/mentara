acd7091ccc331083ed5208baa4714c26
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationsController = void 0;
const common_1 = require("@nestjs/common");
const notifications_service_1 = require("./notifications.service");
const jwt_auth_guard_1 = require("src/auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("src/auth/decorators/current-user-id.decorator");
const zod_validation_pipe_1 = require("src/common/pipes/zod-validation.pipe");
const notification_schemas_1 = require("./validation/notification.schemas");
let NotificationsController = class NotificationsController {
    notificationsService;
    constructor(notificationsService) {
        this.notificationsService = notificationsService;
    }
    create(body, userId) {
        return this.notificationsService.create({
            ...body,
            userId,
        });
    }
    findAll(userId, query) {
        return this.notificationsService.findAll(userId, query.isRead, query.type, query.priority);
    }
    getUnreadCount(userId) {
        return this.notificationsService.getUnreadCount(userId);
    }
    getNotificationSettings(userId) {
        return this.notificationsService.getNotificationSettings(userId);
    }
    updateNotificationSettings(body, userId) {
        return this.notificationsService.updateNotificationSettings(userId, body);
    }
    findOne(id) {
        return this.notificationsService.findOne(id);
    }
    markAsRead(id) {
        return this.notificationsService.markAsRead(id);
    }
    markAllAsRead(userId) {
        return this.notificationsService.markAllAsRead(userId);
    }
    remove(id) {
        return this.notificationsService.delete(id);
    }
    // Helper endpoints for creating specific notification types
    createAppointmentReminder(body, userId) {
        return this.notificationsService.createAppointmentReminder(userId, body.appointmentId, new Date(body.appointmentTime), body.therapistName);
    }
    createMessageNotification(body, userId) {
        return this.notificationsService.createMessageNotification(userId, body.senderId, body.senderName, body.conversationId);
    }
    createWorksheetAssignedNotification(body, userId) {
        return this.notificationsService.createWorksheetAssignedNotification(userId, body.worksheetId, body.worksheetTitle, body.therapistName);
    }
    createTherapistApplicationNotification(body, userId) {
        return this.notificationsService.createTherapistApplicationNotification(userId, body.status);
    }
    createReviewRequestNotification(body, userId) {
        return this.notificationsService.createReviewRequestNotification(userId, body.therapistId, body.therapistName, body.sessionId);
    }
    createCommunityPostNotification(body, userId) {
        return this.notificationsService.createCommunityPostNotification(userId, body.postId, body.communityName, body.authorName);
    }
};
exports.NotificationsController = NotificationsController;
__decorate([
    (0, common_1.Post)(),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "create", null);
__decorate([
    (0, common_1.Get)(),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(notification_schemas_1.NotificationQuerySchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)('unread-count'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "getUnreadCount", null);
__decorate([
    (0, common_1.Get)('settings'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "getNotificationSettings", null);
__decorate([
    (0, common_1.Patch)('settings'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "updateNotificationSettings", null);
__decorate([
    (0, common_1.Get)(':id'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "findOne", null);
__decorate([
    (0, common_1.Patch)(':id/read'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "markAsRead", null);
__decorate([
    (0, common_1.Patch)('mark-all-read'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "markAllAsRead", null);
__decorate([
    (0, common_1.Delete)(':id'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)('appointment-reminder'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createAppointmentReminder", null);
__decorate([
    (0, common_1.Post)('message-notification'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createMessageNotification", null);
__decorate([
    (0, common_1.Post)('worksheet-assigned'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createWorksheetAssignedNotification", null);
__decorate([
    (0, common_1.Post)('therapist-application'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createTherapistApplicationNotification", null);
__decorate([
    (0, common_1.Post)('review-request'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createReviewRequestNotification", null);
__decorate([
    (0, common_1.Post)('community-post'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createCommunityPostNotification", null);
exports.NotificationsController = NotificationsController = __decorate([
    (0, common_1.Controller)('notifications'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof notifications_service_1.NotificationsService !== "undefined" && notifications_service_1.NotificationsService) === "function" ? _a : Object])
], NotificationsController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9ucy5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FVd0I7QUFDeEIsbUVBQStEO0FBQy9ELG1FQUE4RDtBQUM5RCw2RkFBOEU7QUFDOUUsOEVBQXlFO0FBQ3pFLDRFQUE0RTtBQU1yRSxJQUFNLHVCQUF1QixHQUE3QixNQUFNLHVCQUF1QjtJQUNMO0lBQTdCLFlBQTZCLG9CQUEwQztRQUExQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO0lBQUcsQ0FBQztJQUczRSxNQUFNLENBRUosSUFPQyxFQUNnQixNQUFjO1FBRS9CLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQztZQUN0QyxHQUFHLElBQUk7WUFDUCxNQUFNO1NBQ1AsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUdELE9BQU8sQ0FDWSxNQUFjLEVBRS9CLEtBQXdCO1FBRXhCLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FDdEMsTUFBTSxFQUNOLEtBQUssQ0FBQyxNQUFNLEVBQ1osS0FBSyxDQUFDLElBQUksRUFDVixLQUFLLENBQUMsUUFBUSxDQUNmLENBQUM7SUFDSixDQUFDO0lBR0QsY0FBYyxDQUFrQixNQUFjO1FBQzVDLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBR0QsdUJBQXVCLENBQWtCLE1BQWM7UUFDckQsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkUsQ0FBQztJQUdELDBCQUEwQixDQUV4QixJQWdCQyxFQUNnQixNQUFjO1FBRS9CLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLDBCQUEwQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM1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QTtJQU1OLFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7Ozs7OEVBUWpCO0FBR0Q7SUFEQyxJQUFBLGFBQUksRUFBQyxnQkFBZ0IsQ0FBQztJQUVwQixXQUFBLElBQUEsYUFBSSxHQUFFLENBQUE7SUFNTixXQUFBLElBQUEseUNBQWEsR0FBRSxDQUFBOzs7OzhFQVFqQjtrQ0FuTVUsdUJBQXVCO0lBRm5DLElBQUEsbUJBQVUsRUFBQyxlQUFlLENBQUM7SUFDM0IsSUFBQSxrQkFBUyxFQUFDLDZCQUFZLENBQUM7eURBRTZCLDRDQUFvQixvQkFBcEIsNENBQW9CO0dBRDVELHVCQUF1QixDQW9NbkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9ucy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUG9zdCxcbiAgQm9keSxcbiAgUGF0Y2gsXG4gIFBhcmFtLFxuICBEZWxldGUsXG4gIFF1ZXJ5LFxuICBVc2VHdWFyZHMsXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi9ub3RpZmljYXRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnc3JjL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEN1cnJlbnRVc2VySWQgfSBmcm9tICdzcmMvYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1pZC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICdzcmMvY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uUXVlcnlTY2hlbWEgfSBmcm9tICcuL3ZhbGlkYXRpb24vbm90aWZpY2F0aW9uLnNjaGVtYXMnO1xuaW1wb3J0IHR5cGUgeyBOb3RpZmljYXRpb25RdWVyeSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uVHlwZSwgTm90aWZpY2F0aW9uUHJpb3JpdHkgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbkBDb250cm9sbGVyKCdub3RpZmljYXRpb25zJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvbnNDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBub3RpZmljYXRpb25zU2VydmljZTogTm90aWZpY2F0aW9uc1NlcnZpY2UpIHt9XG5cbiAgQFBvc3QoKVxuICBjcmVhdGUoXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlO1xuICAgICAgcHJpb3JpdHk/OiBOb3RpZmljYXRpb25Qcmlvcml0eTtcbiAgICAgIGRhdGE/OiBhbnk7XG4gICAgICBhY3Rpb25Vcmw/OiBzdHJpbmc7XG4gICAgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUoe1xuICAgICAgLi4uYm9keSxcbiAgICAgIHVzZXJJZCxcbiAgICB9KTtcbiAgfVxuXG4gIEBHZXQoKVxuICBmaW5kQWxsKFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShOb3RpZmljYXRpb25RdWVyeVNjaGVtYSkpXG4gICAgcXVlcnk6IE5vdGlmaWNhdGlvblF1ZXJ5LFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5maW5kQWxsKFxuICAgICAgdXNlcklkLFxuICAgICAgcXVlcnkuaXNSZWFkLFxuICAgICAgcXVlcnkudHlwZSxcbiAgICAgIHF1ZXJ5LnByaW9yaXR5LFxuICAgICk7XG4gIH1cblxuICBAR2V0KCd1bnJlYWQtY291bnQnKVxuICBnZXRVbnJlYWRDb3VudChAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuZ2V0VW5yZWFkQ291bnQodXNlcklkKTtcbiAgfVxuXG4gIEBHZXQoJ3NldHRpbmdzJylcbiAgZ2V0Tm90aWZpY2F0aW9uU2V0dGluZ3MoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmdldE5vdGlmaWNhdGlvblNldHRpbmdzKHVzZXJJZCk7XG4gIH1cblxuICBAUGF0Y2goJ3NldHRpbmdzJylcbiAgdXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MoXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIGVtYWlsQXBwb2ludG1lbnRSZW1pbmRlcnM/OiBib29sZWFuO1xuICAgICAgZW1haWxOZXdNZXNzYWdlcz86IGJvb2xlYW47XG4gICAgICBlbWFpbFdvcmtzaGVldFVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgZW1haWxTeXN0ZW1VcGRhdGVzPzogYm9vbGVhbjtcbiAgICAgIGVtYWlsTWFya2V0aW5nPzogYm9vbGVhbjtcbiAgICAgIHB1c2hBcHBvaW50bWVudFJlbWluZGVycz86IGJvb2xlYW47XG4gICAgICBwdXNoTmV3TWVzc2FnZXM/OiBib29sZWFuO1xuICAgICAgcHVzaFdvcmtzaGVldFVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgcHVzaFN5c3RlbVVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgaW5BcHBNZXNzYWdlcz86IGJvb2xlYW47XG4gICAgICBpbkFwcFVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgcXVpZXRIb3Vyc0VuYWJsZWQ/OiBib29sZWFuO1xuICAgICAgcXVpZXRIb3Vyc1N0YXJ0Pzogc3RyaW5nO1xuICAgICAgcXVpZXRIb3Vyc0VuZD86IHN0cmluZztcbiAgICAgIHF1aWV0SG91cnNUaW1lem9uZT86IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLnVwZGF0ZU5vdGlmaWNhdGlvblNldHRpbmdzKHVzZXJJZCwgYm9keSk7XG4gIH1cblxuICBAR2V0KCc6aWQnKVxuICBmaW5kT25lKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuZmluZE9uZShpZCk7XG4gIH1cblxuICBAUGF0Y2goJzppZC9yZWFkJylcbiAgbWFya0FzUmVhZChAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLm1hcmtBc1JlYWQoaWQpO1xuICB9XG5cbiAgQFBhdGNoKCdtYXJrLWFsbC1yZWFkJylcbiAgbWFya0FsbEFzUmVhZChAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UubWFya0FsbEFzUmVhZCh1c2VySWQpO1xuICB9XG5cbiAgQERlbGV0ZSgnOmlkJylcbiAgcmVtb3ZlKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuZGVsZXRlKGlkKTtcbiAgfVxuXG4gIC8vIEhlbHBlciBlbmRwb2ludHMgZm9yIGNyZWF0aW5nIHNwZWNpZmljIG5vdGlmaWNhdGlvbiB0eXBlc1xuXG4gIEBQb3N0KCdhcHBvaW50bWVudC1yZW1pbmRlcicpXG4gIGNyZWF0ZUFwcG9pbnRtZW50UmVtaW5kZXIoXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIGFwcG9pbnRtZW50SWQ6IHN0cmluZztcbiAgICAgIGFwcG9pbnRtZW50VGltZTogc3RyaW5nO1xuICAgICAgdGhlcmFwaXN0TmFtZTogc3RyaW5nO1xuICAgIH0sXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuY3JlYXRlQXBwb2ludG1lbnRSZW1pbmRlcihcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJvZHkuYXBwb2ludG1lbnRJZCxcbiAgICAgIG5ldyBEYXRlKGJvZHkuYXBwb2ludG1lbnRUaW1lKSxcbiAgICAgIGJvZHkudGhlcmFwaXN0TmFtZSxcbiAgICApO1xuICB9XG5cbiAgQFBvc3QoJ21lc3NhZ2Utbm90aWZpY2F0aW9uJylcbiAgY3JlYXRlTWVzc2FnZU5vdGlmaWNhdGlvbihcbiAgICBAQm9keSgpXG4gICAgYm9keToge1xuICAgICAgc2VuZGVySWQ6IHN0cmluZztcbiAgICAgIHNlbmRlck5hbWU6IHN0cmluZztcbiAgICAgIGNvbnZlcnNhdGlvbklkOiBzdHJpbmc7XG4gICAgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGVNZXNzYWdlTm90aWZpY2F0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgYm9keS5zZW5kZXJJZCxcbiAgICAgIGJvZHkuc2VuZGVyTmFtZSxcbiAgICAgIGJvZHkuY29udmVyc2F0aW9uSWQsXG4gICAgKTtcbiAgfVxuXG4gIEBQb3N0KCd3b3Jrc2hlZXQtYXNzaWduZWQnKVxuICBjcmVhdGVXb3Jrc2hlZXRBc3NpZ25lZE5vdGlmaWNhdGlvbihcbiAgICBAQm9keSgpXG4gICAgYm9keToge1xuICAgICAgd29ya3NoZWV0SWQ6IHN0cmluZztcbiAgICAgIHdvcmtzaGVldFRpdGxlOiBzdHJpbmc7XG4gICAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmc7XG4gICAgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGVXb3Jrc2hlZXRBc3NpZ25lZE5vdGlmaWNhdGlvbihcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJvZHkud29ya3NoZWV0SWQsXG4gICAgICBib2R5LndvcmtzaGVldFRpdGxlLFxuICAgICAgYm9keS50aGVyYXBpc3ROYW1lLFxuICAgICk7XG4gIH1cblxuICBAUG9zdCgndGhlcmFwaXN0LWFwcGxpY2F0aW9uJylcbiAgY3JlYXRlVGhlcmFwaXN0QXBwbGljYXRpb25Ob3RpZmljYXRpb24oXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIHN0YXR1czogJ2FwcHJvdmVkJyB8ICdyZWplY3RlZCc7XG4gICAgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGVUaGVyYXBpc3RBcHBsaWNhdGlvbk5vdGlmaWNhdGlvbihcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJvZHkuc3RhdHVzLFxuICAgICk7XG4gIH1cblxuICBAUG9zdCgncmV2aWV3LXJlcXVlc3QnKVxuICBjcmVhdGVSZXZpZXdSZXF1ZXN0Tm90aWZpY2F0aW9uKFxuICAgIEBCb2R5KClcbiAgICBib2R5OiB7XG4gICAgICB0aGVyYXBpc3RJZDogc3RyaW5nO1xuICAgICAgdGhlcmFwaXN0TmFtZTogc3RyaW5nO1xuICAgICAgc2Vzc2lvbklkOiBzdHJpbmc7XG4gICAgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGVSZXZpZXdSZXF1ZXN0Tm90aWZpY2F0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgYm9keS50aGVyYXBpc3RJZCxcbiAgICAgIGJvZHkudGhlcmFwaXN0TmFtZSxcbiAgICAgIGJvZHkuc2Vzc2lvbklkLFxuICAgICk7XG4gIH1cblxuICBAUG9zdCgnY29tbXVuaXR5LXBvc3QnKVxuICBjcmVhdGVDb21tdW5pdHlQb3N0Tm90aWZpY2F0aW9uKFxuICAgIEBCb2R5KClcbiAgICBib2R5OiB7XG4gICAgICBwb3N0SWQ6IHN0cmluZztcbiAgICAgIGNvbW11bml0eU5hbWU6IHN0cmluZztcbiAgICAgIGF1dGhvck5hbWU6IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZUNvbW11bml0eVBvc3ROb3RpZmljYXRpb24oXG4gICAgICB1c2VySWQsXG4gICAgICBib2R5LnBvc3RJZCxcbiAgICAgIGJvZHkuY29tbXVuaXR5TmFtZSxcbiAgICAgIGJvZHkuYXV0aG9yTmFtZSxcbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=