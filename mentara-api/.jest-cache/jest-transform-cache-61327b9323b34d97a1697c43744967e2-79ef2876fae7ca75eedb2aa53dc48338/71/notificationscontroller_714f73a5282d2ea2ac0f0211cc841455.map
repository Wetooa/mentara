{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/notifications/notifications.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/notifications/notifications.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Body,\n  Patch,\n  Param,\n  Delete,\n  Query,\n  UseGuards,\n} from '@nestjs/common';\nimport { NotificationsService } from './notifications.service';\nimport { JwtAuthGuard } from 'src/auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from 'src/auth/decorators/current-user-id.decorator';\nimport { ZodValidationPipe } from 'src/common/pipes/zod-validation.pipe';\nimport { NotificationQuerySchema } from './validation/notification.schemas';\nimport type { NotificationQuery } from './types';\nimport { NotificationType, NotificationPriority } from '@prisma/client';\n\n@Controller('notifications')\n@UseGuards(JwtAuthGuard)\nexport class NotificationsController {\n  constructor(private readonly notificationsService: NotificationsService) {}\n\n  @Post()\n  create(\n    @Body()\n    body: {\n      title: string;\n      message: string;\n      type: NotificationType;\n      priority?: NotificationPriority;\n      data?: any;\n      actionUrl?: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.create({\n      ...body,\n      userId,\n    });\n  }\n\n  @Get()\n  findAll(\n    @CurrentUserId() userId: string,\n    @Query(new ZodValidationPipe(NotificationQuerySchema))\n    query: NotificationQuery,\n  ) {\n    return this.notificationsService.findAll(\n      userId,\n      query.isRead,\n      query.type,\n      query.priority,\n    );\n  }\n\n  @Get('unread-count')\n  getUnreadCount(@CurrentUserId() userId: string) {\n    return this.notificationsService.getUnreadCount(userId);\n  }\n\n  @Get('settings')\n  getNotificationSettings(@CurrentUserId() userId: string) {\n    return this.notificationsService.getNotificationSettings(userId);\n  }\n\n  @Patch('settings')\n  updateNotificationSettings(\n    @Body()\n    body: {\n      emailAppointmentReminders?: boolean;\n      emailNewMessages?: boolean;\n      emailWorksheetUpdates?: boolean;\n      emailSystemUpdates?: boolean;\n      emailMarketing?: boolean;\n      pushAppointmentReminders?: boolean;\n      pushNewMessages?: boolean;\n      pushWorksheetUpdates?: boolean;\n      pushSystemUpdates?: boolean;\n      inAppMessages?: boolean;\n      inAppUpdates?: boolean;\n      quietHoursEnabled?: boolean;\n      quietHoursStart?: string;\n      quietHoursEnd?: string;\n      quietHoursTimezone?: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.updateNotificationSettings(userId, body);\n  }\n\n  @Get(':id')\n  findOne(@Param('id') id: string) {\n    return this.notificationsService.findOne(id);\n  }\n\n  @Patch(':id/read')\n  markAsRead(@Param('id') id: string) {\n    return this.notificationsService.markAsRead(id);\n  }\n\n  @Patch('mark-all-read')\n  markAllAsRead(@CurrentUserId() userId: string) {\n    return this.notificationsService.markAllAsRead(userId);\n  }\n\n  @Delete(':id')\n  remove(@Param('id') id: string) {\n    return this.notificationsService.delete(id);\n  }\n\n  // Helper endpoints for creating specific notification types\n\n  @Post('appointment-reminder')\n  createAppointmentReminder(\n    @Body()\n    body: {\n      appointmentId: string;\n      appointmentTime: string;\n      therapistName: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.createAppointmentReminder(\n      userId,\n      body.appointmentId,\n      new Date(body.appointmentTime),\n      body.therapistName,\n    );\n  }\n\n  @Post('message-notification')\n  createMessageNotification(\n    @Body()\n    body: {\n      senderId: string;\n      senderName: string;\n      conversationId: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.createMessageNotification(\n      userId,\n      body.senderId,\n      body.senderName,\n      body.conversationId,\n    );\n  }\n\n  @Post('worksheet-assigned')\n  createWorksheetAssignedNotification(\n    @Body()\n    body: {\n      worksheetId: string;\n      worksheetTitle: string;\n      therapistName: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.createWorksheetAssignedNotification(\n      userId,\n      body.worksheetId,\n      body.worksheetTitle,\n      body.therapistName,\n    );\n  }\n\n  @Post('therapist-application')\n  createTherapistApplicationNotification(\n    @Body()\n    body: {\n      status: 'approved' | 'rejected';\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.createTherapistApplicationNotification(\n      userId,\n      body.status,\n    );\n  }\n\n  @Post('review-request')\n  createReviewRequestNotification(\n    @Body()\n    body: {\n      therapistId: string;\n      therapistName: string;\n      sessionId: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.createReviewRequestNotification(\n      userId,\n      body.therapistId,\n      body.therapistName,\n      body.sessionId,\n    );\n  }\n\n  @Post('community-post')\n  createCommunityPostNotification(\n    @Body()\n    body: {\n      postId: string;\n      communityName: string;\n      authorName: string;\n    },\n    @CurrentUserId() userId: string,\n  ) {\n    return this.notificationsService.createCommunityPostNotification(\n      userId,\n      body.postId,\n      body.communityName,\n      body.authorName,\n    );\n  }\n}\n"],"version":3}