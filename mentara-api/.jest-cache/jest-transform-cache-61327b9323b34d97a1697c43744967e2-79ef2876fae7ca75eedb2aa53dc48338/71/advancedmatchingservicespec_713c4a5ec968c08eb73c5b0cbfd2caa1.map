{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/services/advanced-matching.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/services/advanced-matching.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { AdvancedMatchingService } from './advanced-matching.service';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport {\n  AdvancedMatchingService,\n  ClientForMatching,\n  TherapistForMatching,\n  MatchingWeights,\n  UserConditionProfile,\n  TherapistScore,\n} from './advanced-matching.service';\n\ndescribe('AdvancedMatchingService', () => {\n  let service: AdvancedMatchingService;\n  let prismaService: jest.Mocked<PrismaService>;\n\n  const mockClient: ClientForMatching = {\n    id: 'client-123',\n    userId: 'user-123',\n    hasSeenTherapistRecommendations: false,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    preAssessment: {\n      id: 'assessment-123',\n      userId: 'user-123',\n      severityLevels: {\n        'Depression': 'Severe',\n        'Anxiety': 'Moderate',\n        'PTSD': 'Mild',\n      },\n      questionnaires: ['Depression', 'Anxiety', 'PTSD'],\n      totalScore: 85,\n      completedAt: new Date(),\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    },\n    clientPreferences: [\n      {\n        id: 'pref-1',\n        userId: 'user-123',\n        key: 'approaches',\n        value: '[\"Cognitive Behavioral Therapy (CBT)\", \"Mindfulness-Based Cognitive Therapy (MBCT)\"]',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      },\n      {\n        id: 'pref-2',\n        userId: 'user-123',\n        key: 'maxBudget',\n        value: '2000',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      },\n      {\n        id: 'pref-3',\n        userId: 'user-123',\n        key: 'province',\n        value: 'Metro Manila',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      },\n      {\n        id: 'pref-4',\n        userId: 'user-123',\n        key: 'therapistGender',\n        value: 'Female',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      },\n    ],\n    user: {\n      firstName: 'John',\n      lastName: 'Doe',\n      avatarUrl: 'https://example.com/avatar.jpg',\n    },\n  };\n\n  const mockTherapist: TherapistForMatching = {\n    id: 'therapist-123',\n    userId: 'therapist-user-123',\n    status: 'approved',\n    mobile: '+1234567890',\n    province: 'Metro Manila',\n    providerType: 'Licensed Psychologist',\n    professionalLicenseType: 'Clinical Psychology',\n    isPRCLicensed: 'Yes',\n    prcLicenseNumber: 'PRC123456',\n    expirationDateOfLicense: new Date('2025-12-31'),\n    practiceStartDate: new Date('2015-01-01'),\n    sessionLength: '60 minutes',\n    hourlyRate: 1800,\n    providedOnlineTherapyBefore: true,\n    comfortableUsingVideoConferencing: true,\n    compliesWithDataPrivacyAct: true,\n    willingToAbideByPlatformGuidelines: true,\n    expertise: ['Depression', 'Anxiety', 'Trauma'],\n    illnessSpecializations: ['PTSD', 'Panic Disorder'],\n    approaches: ['Cognitive Behavioral Therapy (CBT)'],\n    therapeuticApproachesUsedList: ['Mindfulness-Based Cognitive Therapy (MBCT)'],\n    treatmentSuccessRates: {\n      'Depression': 85,\n      'Anxiety': 90,\n      'PTSD': 78,\n    },\n    yearsOfExperience: 8,\n    languagesOffered: ['English', 'Filipino'],\n    acceptsInsurance: true,\n    acceptedInsuranceTypes: ['PhilHealth', 'HMO'],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    user: {\n      firstName: 'Dr. Jane',\n      lastName: 'Smith',\n      avatarUrl: 'https://example.com/therapist-avatar.jpg',\n    },\n    reviews: [\n      {\n        rating: 5,\n        status: 'APPROVED',\n      },\n      {\n        rating: 4,\n        status: 'APPROVED',\n      },\n      {\n        rating: 5,\n        status: 'APPROVED',\n      },\n    ],\n  };\n\n  const mockCustomWeights: MatchingWeights = {\n    conditionMatch: 0.5,\n    approachCompatibility: 0.2,\n    experienceAndSuccess: 0.15,\n    reviewsAndRatings: 0.1,\n    availabilityAndLogistics: 0.05,\n  };\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        AdvancedMatchingService,\n        {\n          provide: PrismaService,\n          useValue: {\n            // Mock PrismaService methods if needed\n          },\n        },\n      ],\n    }).compile();\n\n    service = module.get<AdvancedMatchingService>(AdvancedMatchingService);\n    prismaService = module.get(PrismaService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('calculateAdvancedMatch', () => {\n    it('should calculate comprehensive match score successfully', async () => {\n      const result = await service.calculateAdvancedMatch(mockClient, mockTherapist);\n\n      expect(result).toEqual({\n        therapist: mockTherapist,\n        totalScore: expect.any(Number),\n        breakdown: {\n          conditionScore: expect.any(Number),\n          approachScore: expect.any(Number),\n          experienceScore: expect.any(Number),\n          reviewScore: expect.any(Number),\n          logisticsScore: expect.any(Number),\n        },\n        matchExplanation: {\n          primaryMatches: expect.any(Array),\n          secondaryMatches: expect.any(Array),\n          approachMatches: expect.any(Array),\n          experienceYears: expect.any(Number),\n          averageRating: expect.any(Number),\n          totalReviews: expect.any(Number),\n          successRates: expect.any(Object),\n        },\n      });\n\n      expect(result.totalScore).toBeGreaterThan(0);\n      expect(result.totalScore).toBeLessThanOrEqual(100);\n    });\n\n    it('should use custom weights when provided', async () => {\n      const result = await service.calculateAdvancedMatch(\n        mockClient,\n        mockTherapist,\n        mockCustomWeights,\n      );\n\n      expect(result.totalScore).toBeGreaterThan(0);\n      expect(result.breakdown.conditionScore).toBeGreaterThan(0);\n    });\n\n    it('should throw error for client without pre-assessment', async () => {\n      const clientWithoutAssessment = {\n        ...mockClient,\n        preAssessment: null,\n      };\n\n      await expect(\n        service.calculateAdvancedMatch(clientWithoutAssessment, mockTherapist),\n      ).rejects.toThrow('Client must have a valid pre-assessment');\n    });\n\n    it('should throw error for client without preferences', async () => {\n      const clientWithoutPreferences = {\n        ...mockClient,\n        clientPreferences: null,\n      };\n\n      await expect(\n        service.calculateAdvancedMatch(clientWithoutPreferences, mockTherapist),\n      ).rejects.toThrow('Client preferences are required for matching');\n    });\n\n    it('should throw error for therapist without user information', async () => {\n      const therapistWithoutUser = {\n        ...mockTherapist,\n        user: null,\n      };\n\n      await expect(\n        service.calculateAdvancedMatch(mockClient, therapistWithoutUser),\n      ).rejects.toThrow('Therapist must have valid user information');\n    });\n\n    it('should handle missing optional therapist fields gracefully', async () => {\n      const therapistWithMissingFields = {\n        ...mockTherapist,\n        expertise: undefined,\n        illnessSpecializations: undefined,\n        approaches: undefined,\n        therapeuticApproachesUsedList: undefined,\n        treatmentSuccessRates: undefined,\n        yearsOfExperience: undefined,\n        languagesOffered: undefined,\n        acceptedInsuranceTypes: undefined,\n      };\n\n      const result = await service.calculateAdvancedMatch(\n        mockClient,\n        therapistWithMissingFields,\n      );\n\n      expect(result.totalScore).toBeGreaterThanOrEqual(0);\n      expect(result.breakdown.conditionScore).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('buildUserConditionProfile', () => {\n    it('should build comprehensive user profile with primary and secondary conditions', () => {\n      const profile = (service as any).buildUserConditionProfile(mockClient);\n\n      expect(profile).toEqual({\n        primaryConditions: expect.any(Array),\n        secondaryConditions: expect.any(Array),\n        preferredApproaches: expect.any(Array),\n        sessionPreferences: expect.any(Object),\n        demographics: expect.any(Object),\n        logistics: expect.any(Object),\n      });\n\n      // Check that severe depression is in primary conditions\n      const severePrimaryConditions = profile.primaryConditions.filter(\n        (c) => c.condition === 'Depression' && c.severity === 'Severe',\n      );\n      expect(severePrimaryConditions).toHaveLength(1);\n\n      // Check that moderate anxiety is in secondary conditions\n      const moderateSecondaryConditions = profile.secondaryConditions.filter(\n        (c) => c.condition === 'Anxiety' && c.severity === 'Moderate',\n      );\n      expect(moderateSecondaryConditions).toHaveLength(1);\n    });\n\n    it('should parse client preferences correctly', () => {\n      const profile = (service as any).buildUserConditionProfile(mockClient);\n\n      expect(profile.preferredApproaches).toContain('Cognitive Behavioral Therapy (CBT)');\n      expect(profile.preferredApproaches).toContain('Mindfulness-Based Cognitive Therapy (MBCT)');\n      expect(profile.logistics.maxHourlyRate).toBe(2000);\n      expect(profile.logistics.province).toBe('Metro Manila');\n      expect(profile.demographics.genderPreference).toBe('Female');\n    });\n\n    it('should handle missing or invalid preference values', () => {\n      const clientWithInvalidPrefs = {\n        ...mockClient,\n        clientPreferences: [\n          {\n            id: 'pref-1',\n            userId: 'user-123',\n            key: 'approaches',\n            value: 'invalid-json[',\n            createdAt: new Date(),\n            updatedAt: new Date(),\n          },\n        ],\n      };\n\n      const profile = (service as any).buildUserConditionProfile(clientWithInvalidPrefs);\n\n      expect(profile.preferredApproaches).toEqual([]);\n    });\n  });\n\n  describe('calculateConditionMatchScore', () => {\n    it('should score primary conditions higher than secondary conditions', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [\n          { condition: 'Anxiety', severity: 'Moderate', weight: 3 },\n        ],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const score = (service as any).calculateConditionMatchScore(\n        userProfile,\n        mockTherapist,\n      );\n\n      expect(score).toBeGreaterThan(0);\n      expect(score).toBeLessThanOrEqual(100);\n    });\n\n    it('should return 0 for therapist with no matching conditions', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Eating Disorders', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const therapistWithNoMatch = {\n        ...mockTherapist,\n        expertise: ['Substance Abuse'],\n        illnessSpecializations: ['Addiction'],\n      };\n\n      const score = (service as any).calculateConditionMatchScore(\n        userProfile,\n        therapistWithNoMatch,\n      );\n\n      expect(score).toBe(0);\n    });\n\n    it('should apply expertise depth bonus for multiple matched conditions', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n          { condition: 'Anxiety', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [\n          { condition: 'PTSD', severity: 'Moderate', weight: 3 },\n        ],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const score = (service as any).calculateConditionMatchScore(\n        userProfile,\n        mockTherapist,\n      );\n\n      // Should get bonus for matching multiple conditions\n      expect(score).toBeGreaterThan(50);\n    });\n\n    it('should cap score at 100', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n          { condition: 'Anxiety', severity: 'Severe', weight: 5 },\n          { condition: 'PTSD', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const score = (service as any).calculateConditionMatchScore(\n        userProfile,\n        mockTherapist,\n      );\n\n      expect(score).toBeLessThanOrEqual(100);\n    });\n  });\n\n  describe('calculateApproachCompatibilityScore', () => {\n    it('should give perfect score for exact approach matches', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: ['Cognitive Behavioral Therapy (CBT)', 'Mindfulness-Based Cognitive Therapy (MBCT)'],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const score = (service as any).calculateApproachCompatibilityScore(\n        userProfile,\n        mockTherapist,\n      );\n\n      expect(score).toBeGreaterThan(90); // Should be high for exact matches\n    });\n\n    it('should give evidence-based score when no preferences specified', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const score = (service as any).calculateApproachCompatibilityScore(\n        userProfile,\n        mockTherapist,\n      );\n\n      expect(score).toBeGreaterThan(0);\n      expect(score).toBeLessThanOrEqual(100);\n    });\n\n    it('should give diversity bonus for multiple approaches', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const therapistWithManyApproaches = {\n        ...mockTherapist,\n        approaches: ['CBT', 'DBT', 'ACT', 'EMDR'],\n        therapeuticApproachesUsedList: ['Mindfulness', 'Psychodynamic'],\n      };\n\n      const score = (service as any).calculateApproachCompatibilityScore(\n        userProfile,\n        therapistWithManyApproaches,\n      );\n\n      expect(score).toBeGreaterThan(40); // Should get diversity bonus\n    });\n\n    it('should handle missing approach data gracefully', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: ['CBT'],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const therapistWithNoApproaches = {\n        ...mockTherapist,\n        approaches: undefined,\n        therapeuticApproachesUsedList: undefined,\n      };\n\n      const score = (service as any).calculateApproachCompatibilityScore(\n        userProfile,\n        therapistWithNoApproaches,\n      );\n\n      expect(score).toBe(0);\n    });\n  });\n\n  describe('calculateExperienceAndSuccessScore', () => {\n    it('should calculate experience score with diminishing returns', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      // Test new therapist (0-5 years)\n      const newTherapist = {\n        ...mockTherapist,\n        practiceStartDate: new Date(Date.now() - 2 * 365 * 24 * 60 * 60 * 1000), // 2 years ago\n        yearsOfExperience: 2,\n      };\n\n      const newScore = (service as any).calculateExperienceAndSuccessScore(\n        userProfile,\n        newTherapist,\n      );\n\n      // Test experienced therapist (5-10 years)\n      const experiencedTherapist = {\n        ...mockTherapist,\n        practiceStartDate: new Date(Date.now() - 7 * 365 * 24 * 60 * 60 * 1000), // 7 years ago\n        yearsOfExperience: 7,\n      };\n\n      const experiencedScore = (service as any).calculateExperienceAndSuccessScore(\n        userProfile,\n        experiencedTherapist,\n      );\n\n      // Test senior therapist (10+ years)\n      const seniorTherapist = {\n        ...mockTherapist,\n        practiceStartDate: new Date(Date.now() - 15 * 365 * 24 * 60 * 60 * 1000), // 15 years ago\n        yearsOfExperience: 15,\n      };\n\n      const seniorScore = (service as any).calculateExperienceAndSuccessScore(\n        userProfile,\n        seniorTherapist,\n      );\n\n      expect(newScore).toBeGreaterThan(0);\n      expect(experiencedScore).toBeGreaterThan(newScore);\n      expect(seniorScore).toBeGreaterThan(experiencedScore);\n      expect(seniorScore).toBeLessThanOrEqual(100);\n    });\n\n    it('should include success rate bonus for relevant conditions', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const therapistWithHighSuccess = {\n        ...mockTherapist,\n        treatmentSuccessRates: { 'Depression': 95 },\n      };\n\n      const therapistWithLowSuccess = {\n        ...mockTherapist,\n        treatmentSuccessRates: { 'Depression': 60 },\n      };\n\n      const highScore = (service as any).calculateExperienceAndSuccessScore(\n        userProfile,\n        therapistWithHighSuccess,\n      );\n\n      const lowScore = (service as any).calculateExperienceAndSuccessScore(\n        userProfile,\n        therapistWithLowSuccess,\n      );\n\n      expect(highScore).toBeGreaterThan(lowScore);\n    });\n\n    it('should handle missing success rate data', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const therapistWithoutSuccess = {\n        ...mockTherapist,\n        treatmentSuccessRates: undefined,\n      };\n\n      const score = (service as any).calculateExperienceAndSuccessScore(\n        userProfile,\n        therapistWithoutSuccess,\n      );\n\n      expect(score).toBeGreaterThan(0);\n    });\n  });\n\n  describe('calculateReviewScore', () => {\n    it('should calculate score based on average rating and volume', async () => {\n      const score = await (service as any).calculateReviewScore(mockTherapist);\n\n      expect(score).toBeGreaterThan(0);\n      expect(score).toBeLessThanOrEqual(100);\n    });\n\n    it('should return neutral score for therapist with no reviews', async () => {\n      const therapistWithoutReviews = {\n        ...mockTherapist,\n        reviews: [],\n      };\n\n      const score = await (service as any).calculateReviewScore(therapistWithoutReviews);\n\n      expect(score).toBe(50);\n    });\n\n    it('should only count approved reviews', async () => {\n      const therapistWithMixedReviews = {\n        ...mockTherapist,\n        reviews: [\n          { rating: 5, status: 'APPROVED' },\n          { rating: 1, status: 'PENDING' },\n          { rating: 1, status: 'REJECTED' },\n        ],\n      };\n\n      const score = await (service as any).calculateReviewScore(therapistWithMixedReviews);\n\n      expect(score).toBeGreaterThan(50); // Should only count the approved 5-star review\n    });\n\n    it('should apply volume bonus for many reviews', async () => {\n      const therapistWithManyReviews = {\n        ...mockTherapist,\n        reviews: Array(20).fill({ rating: 4, status: 'APPROVED' }),\n      };\n\n      const manyReviewsScore = await (service as any).calculateReviewScore(therapistWithManyReviews);\n      const fewReviewsScore = await (service as any).calculateReviewScore(mockTherapist);\n\n      expect(manyReviewsScore).toBeGreaterThan(fewReviewsScore);\n    });\n\n    it('should apply penalty for very few reviews', async () => {\n      const therapistWithFewReviews = {\n        ...mockTherapist,\n        reviews: [{ rating: 5, status: 'APPROVED' }],\n      };\n\n      const score = await (service as any).calculateReviewScore(therapistWithFewReviews);\n\n      expect(score).toBeLessThan(100); // Should be penalized for low count\n    });\n  });\n\n  describe('calculateLogisticsScore', () => {\n    it('should give perfect score for all logistics matches', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {\n          maxHourlyRate: 2000,\n          province: 'Metro Manila',\n          insuranceTypes: ['PhilHealth'],\n        },\n      };\n\n      const score = (service as any).calculateLogisticsScore(userProfile, mockTherapist);\n\n      expect(score).toBe(100);\n    });\n\n    it('should penalize location mismatch', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {\n          province: 'Cebu',\n        },\n      };\n\n      const score = (service as any).calculateLogisticsScore(userProfile, mockTherapist);\n\n      expect(score).toBe(70); // 100 - 30 for location mismatch\n    });\n\n    it('should penalize budget overrun', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {\n          maxHourlyRate: 1000, // Lower than therapist rate of 1800\n        },\n      };\n\n      const score = (service as any).calculateLogisticsScore(userProfile, mockTherapist);\n\n      expect(score).toBe(60); // 100 - 40 for budget overrun\n    });\n\n    it('should penalize insurance mismatch', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {\n          insuranceTypes: ['MediCard'], // Not accepted by therapist\n        },\n      };\n\n      const score = (service as any).calculateLogisticsScore(userProfile, mockTherapist);\n\n      expect(score).toBe(80); // 100 - 20 for insurance mismatch\n    });\n\n    it('should penalize language barrier', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['Spanish'] },\n        logistics: {},\n      };\n\n      const score = (service as any).calculateLogisticsScore(userProfile, mockTherapist);\n\n      expect(score).toBe(75); // 100 - 25 for language barrier\n    });\n\n    it('should not go below 0', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['Spanish'] },\n        logistics: {\n          maxHourlyRate: 1000,\n          province: 'Cebu',\n          insuranceTypes: ['MediCard'],\n        },\n      };\n\n      const score = (service as any).calculateLogisticsScore(userProfile, mockTherapist);\n\n      expect(score).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('buildMatchExplanation', () => {\n    it('should build comprehensive match explanation', () => {\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [\n          { condition: 'Depression', severity: 'Severe', weight: 5 },\n        ],\n        secondaryConditions: [\n          { condition: 'Anxiety', severity: 'Moderate', weight: 3 },\n        ],\n        preferredApproaches: ['Cognitive Behavioral Therapy (CBT)'],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const explanation = (service as any).buildMatchExplanation(\n        userProfile,\n        mockTherapist,\n        80,\n        90,\n        75,\n        85,\n      );\n\n      expect(explanation).toEqual({\n        primaryMatches: expect.arrayContaining(['Depression']),\n        secondaryMatches: expect.arrayContaining(['Anxiety']),\n        approachMatches: expect.arrayContaining(['Cognitive Behavioral Therapy (CBT)']),\n        experienceYears: expect.any(Number),\n        averageRating: expect.any(Number),\n        totalReviews: expect.any(Number),\n        successRates: expect.any(Object),\n      });\n\n      expect(explanation.experienceYears).toBeGreaterThan(0);\n      expect(explanation.averageRating).toBeGreaterThan(0);\n      expect(explanation.totalReviews).toBeGreaterThan(0);\n    });\n\n    it('should handle therapist with no reviews', () => {\n      const therapistWithoutReviews = {\n        ...mockTherapist,\n        reviews: [],\n      };\n\n      const userProfile: UserConditionProfile = {\n        primaryConditions: [],\n        secondaryConditions: [],\n        preferredApproaches: [],\n        sessionPreferences: { format: [], duration: [], frequency: 'weekly' },\n        demographics: { ageRange: 'any', languagePreference: ['English'] },\n        logistics: {},\n      };\n\n      const explanation = (service as any).buildMatchExplanation(\n        userProfile,\n        therapistWithoutReviews,\n        80,\n        90,\n        75,\n        85,\n      );\n\n      expect(explanation.averageRating).toBe(0);\n      expect(explanation.totalReviews).toBe(0);\n    });\n  });\n\n  describe('parseClientPreferences', () => {\n    it('should parse JSON array preferences correctly', () => {\n      const preferences = [\n        {\n          id: 'pref-1',\n          userId: 'user-123',\n          key: 'approaches',\n          value: '[\"CBT\", \"DBT\"]',\n          createdAt: new Date(),\n          updatedAt: new Date(),\n        },\n      ];\n\n      const parsed = (service as any).parseClientPreferences(preferences);\n\n      expect(parsed.approaches).toEqual(['CBT', 'DBT']);\n    });\n\n    it('should handle non-JSON string values', () => {\n      const preferences = [\n        {\n          id: 'pref-1',\n          userId: 'user-123',\n          key: 'maxBudget',\n          value: '2000',\n          createdAt: new Date(),\n          updatedAt: new Date(),\n        },\n      ];\n\n      const parsed = (service as any).parseClientPreferences(preferences);\n\n      expect(parsed.maxBudget).toBe('2000');\n    });\n\n    it('should handle malformed JSON gracefully', () => {\n      const preferences = [\n        {\n          id: 'pref-1',\n          userId: 'user-123',\n          key: 'approaches',\n          value: 'invalid-json[',\n          createdAt: new Date(),\n          updatedAt: new Date(),\n        },\n      ];\n\n      const parsed = (service as any).parseClientPreferences(preferences);\n\n      expect(parsed.approaches).toBe('invalid-json[');\n    });\n  });\n\n  describe('calculateYearsOfExperience', () => {\n    it('should calculate years correctly for past dates', () => {\n      const fiveYearsAgo = new Date(Date.now() - 5 * 365 * 24 * 60 * 60 * 1000);\n      const years = (service as any).calculateYearsOfExperience(fiveYearsAgo);\n\n      expect(years).toBe(5);\n    });\n\n    it('should handle recent start dates', () => {\n      const sixMonthsAgo = new Date(Date.now() - 6 * 30 * 24 * 60 * 60 * 1000);\n      const years = (service as any).calculateYearsOfExperience(sixMonthsAgo);\n\n      expect(years).toBe(0);\n    });\n\n    it('should handle anniversary dates correctly', () => {\n      const oneYearAgo = new Date();\n      oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);\n      const years = (service as any).calculateYearsOfExperience(oneYearAgo);\n\n      expect(years).toBe(1);\n    });\n\n    it('should not return negative years', () => {\n      const futureDate = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000);\n      const years = (service as any).calculateYearsOfExperience(futureDate);\n\n      expect(years).toBe(0);\n    });\n  });\n\n  describe('integration tests', () => {\n    it('should handle complete matching workflow with edge cases', async () => {\n      // Client with minimal data\n      const minimalClient = {\n        ...mockClient,\n        clientPreferences: [],\n        preAssessment: {\n          ...mockClient.preAssessment,\n          severityLevels: {},\n          questionnaires: [],\n        },\n      };\n\n      // Therapist with minimal data\n      const minimalTherapist = {\n        ...mockTherapist,\n        expertise: [],\n        illnessSpecializations: [],\n        approaches: [],\n        therapeuticApproachesUsedList: [],\n        reviews: [],\n        treatmentSuccessRates: {},\n      };\n\n      const result = await service.calculateAdvancedMatch(minimalClient, minimalTherapist);\n\n      expect(result.totalScore).toBeGreaterThanOrEqual(0);\n      expect(result.breakdown).toBeDefined();\n      expect(result.matchExplanation).toBeDefined();\n    });\n\n    it('should produce different scores for different therapists', async () => {\n      const therapist1 = {\n        ...mockTherapist,\n        expertise: ['Depression'],\n        reviews: [{ rating: 5, status: 'APPROVED' }],\n      };\n\n      const therapist2 = {\n        ...mockTherapist,\n        expertise: ['Anxiety'],\n        reviews: [{ rating: 3, status: 'APPROVED' }],\n      };\n\n      const result1 = await service.calculateAdvancedMatch(mockClient, therapist1);\n      const result2 = await service.calculateAdvancedMatch(mockClient, therapist2);\n\n      expect(result1.totalScore).not.toBe(result2.totalScore);\n    });\n  });\n});"],"version":3}