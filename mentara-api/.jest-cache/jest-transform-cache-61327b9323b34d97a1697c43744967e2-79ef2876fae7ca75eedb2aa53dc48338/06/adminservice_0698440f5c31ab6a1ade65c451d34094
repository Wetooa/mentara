b970367decefc3da99bfbddf1f93c6a5
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var AdminService_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdminService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
let AdminService = AdminService_1 = class AdminService {
    prisma;
    logger = new common_1.Logger(AdminService_1.name);
    constructor(prisma) {
        this.prisma = prisma;
    }
    async findAll() {
        try {
            const admins = await this.prisma.admin.findMany({
                orderBy: { createdAt: 'desc' },
            });
            return admins.map((admin) => ({
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            }));
        }
        catch (error) {
            this.logger.error('Failed to retrieve admins:', error);
            throw error;
        }
    }
    async findOne(id) {
        try {
            const admin = await this.prisma.admin.findUnique({
                where: { userId: id },
            });
            if (!admin) {
                return null;
            }
            return {
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            };
        }
        catch (error) {
            this.logger.error(`Failed to retrieve admin ${id}:`, error);
            throw error;
        }
    }
    async create(data) {
        try {
            // First check if user exists
            const userExists = await this.prisma.user.findUnique({
                where: { id: data.userId },
            });
            if (!userExists) {
                throw new common_1.NotFoundException(`User with ID ${data.userId} not found`);
            }
            // Check if admin already exists
            const existingAdmin = await this.prisma.admin.findUnique({
                where: { userId: data.userId },
            });
            if (existingAdmin) {
                throw new common_1.ConflictException(`User ${data.userId} is already an admin`);
            }
            const admin = await this.prisma.admin.create({
                data: {
                    userId: data.userId,
                    permissions: data.permissions,
                    adminLevel: data.adminLevel ?? 'admin',
                },
            });
            this.logger.log(`Created admin for user ${data.userId}`);
            return {
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            };
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.ConflictException) {
                throw error;
            }
            if (error instanceof client_1.Prisma.PrismaClientKnownRequestError) {
                if (error.code === 'P2002') {
                    throw new common_1.ConflictException(`User ${data.userId} is already an admin`);
                }
                if (error.code === 'P2003') {
                    throw new common_1.NotFoundException(`User with ID ${data.userId} not found`);
                }
            }
            this.logger.error('Failed to create admin:', error);
            throw error;
        }
    }
    async update(id, data) {
        try {
            const admin = await this.prisma.admin.update({
                where: { userId: id },
                data: {
                    permissions: data.permissions,
                    adminLevel: data.adminLevel,
                },
            });
            this.logger.log(`Updated admin ${id}`);
            return {
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            };
        }
        catch (error) {
            if (error instanceof client_1.Prisma.PrismaClientKnownRequestError) {
                if (error.code === 'P2025') {
                    throw new common_1.NotFoundException(`Admin with ID ${id} not found`);
                }
            }
            this.logger.error(`Failed to update admin ${id}:`, error);
            throw error;
        }
    }
    async remove(id) {
        try {
            await this.prisma.admin.delete({ where: { userId: id } });
            this.logger.log(`Deleted admin ${id}`);
        }
        catch (error) {
            if (error instanceof client_1.Prisma.PrismaClientKnownRequestError) {
                if (error.code === 'P2025') {
                    throw new common_1.NotFoundException(`Admin with ID ${id} not found`);
                }
            }
            this.logger.error(`Failed to delete admin ${id}:`, error);
            throw error;
        }
    }
    // ===== THERAPIST APPLICATION MANAGEMENT =====
    async getAllTherapistApplications(params) {
        try {
            const { status, page, limit } = params;
            const skip = (page - 1) * limit;
            const where = {};
            if (status) {
                where.status = status;
            }
            const [applications, totalCount] = await Promise.all([
                this.prisma.therapist.findMany({
                    where,
                    skip,
                    take: limit,
                    orderBy: { submissionDate: 'desc' },
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                email: true,
                                createdAt: true,
                            },
                        },
                        processedByAdmin: {
                            include: {
                                user: {
                                    select: {
                                        firstName: true,
                                        lastName: true,
                                    },
                                },
                            },
                        },
                    },
                }),
                this.prisma.therapist.count({ where }),
            ]);
            return {
                applications,
                totalCount,
                page,
                totalPages: Math.ceil(totalCount / limit),
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve therapist applications:', error);
            throw error;
        }
    }
    async getTherapistApplication(applicationId) {
        try {
            return await this.prisma.therapist.findUnique({
                where: { userId: applicationId },
                include: {
                    user: true,
                    processedByAdmin: {
                        include: {
                            user: {
                                select: {
                                    firstName: true,
                                    lastName: true,
                                },
                            },
                        },
                    },
                },
            });
        }
        catch (error) {
            this.logger.error('Failed to retrieve therapist application:', error);
            throw error;
        }
    }
    async approveTherapistApplication(applicationId, adminId, notes) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // Update therapist status
                const therapist = await tx.therapist.update({
                    where: { userId: applicationId },
                    data: {
                        status: 'approved',
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                    },
                });
                // Update user role
                await tx.user.update({
                    where: { id: applicationId },
                    data: { role: 'therapist' },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'APPROVE_THERAPIST_APPLICATION',
                        entity: 'therapist',
                        entityId: applicationId,
                        metadata: {
                            applicationId,
                            notes,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, therapist };
            });
        }
        catch (error) {
            this.logger.error('Failed to approve therapist application:', error);
            throw error;
        }
    }
    async rejectTherapistApplication(applicationId, adminId, reason, notes) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // Update therapist status
                const therapist = await tx.therapist.update({
                    where: { userId: applicationId },
                    data: {
                        status: 'rejected',
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                    },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'REJECT_THERAPIST_APPLICATION',
                        entity: 'therapist',
                        entityId: applicationId,
                        metadata: {
                            applicationId,
                            reason,
                            notes,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, therapist, reason };
            });
        }
        catch (error) {
            this.logger.error('Failed to reject therapist application:', error);
            throw error;
        }
    }
    // ===== USER MANAGEMENT =====
    async getAllUsers(params) {
        try {
            const { role, page, limit, search, status, sortBy, sortOrder } = params;
            const skip = (page - 1) * limit;
            const where = {};
            if (role) {
                where.role = role;
            }
            if (search) {
                where.OR = [
                    { firstName: { contains: search, mode: 'insensitive' } },
                    { lastName: { contains: search, mode: 'insensitive' } },
                    { email: { contains: search, mode: 'insensitive' } },
                ];
            }
            if (status) {
                if (status === 'active') {
                    where.isActive = true;
                }
                else if (status === 'inactive') {
                    where.isActive = false;
                }
                else if (status === 'suspended') {
                    where.suspendedAt = { not: null };
                }
            }
            // Build orderBy clause
            const orderBy = {};
            if (sortBy &&
                ['createdAt', 'firstName', 'lastName', 'email', 'role'].includes(sortBy)) {
                orderBy[sortBy] = sortOrder === 'asc' ? 'asc' : 'desc';
            }
            else {
                orderBy.createdAt = 'desc';
            }
            const [users, totalCount] = await Promise.all([
                this.prisma.user.findMany({
                    where,
                    skip,
                    take: limit,
                    orderBy,
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        email: true,
                        role: true,
                        isActive: true,
                        isVerified: true,
                        createdAt: true,
                        lastLoginAt: true,
                        suspendedAt: true,
                        suspensionReason: true,
                    },
                }),
                this.prisma.user.count({ where }),
            ]);
            return {
                users,
                totalCount,
                page,
                totalPages: Math.ceil(totalCount / limit),
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve users:', error);
            throw error;
        }
    }
    async getUser(userId) {
        try {
            return await this.prisma.user.findUnique({
                where: { id: userId },
                include: {
                    client: true,
                    therapist: true,
                    admin: true,
                    moderator: true,
                },
            });
        }
        catch (error) {
            this.logger.error('Failed to retrieve user:', error);
            throw error;
        }
    }
    async suspendUser(userId, adminId, reason, duration) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                const suspensionEnd = duration
                    ? new Date(Date.now() + duration * 24 * 60 * 60 * 1000)
                    : null;
                const user = await tx.user.update({
                    where: { id: userId },
                    data: {
                        suspendedAt: new Date(),
                        suspendedBy: adminId,
                        suspensionReason: reason,
                        isActive: false,
                    },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'SUSPEND_USER',
                        entity: 'user',
                        entityId: userId,
                        metadata: {
                            userId,
                            reason,
                            duration,
                            suspensionEnd: suspensionEnd?.toISOString(),
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, user };
            });
        }
        catch (error) {
            this.logger.error('Failed to suspend user:', error);
            throw error;
        }
    }
    async unsuspendUser(userId, adminId) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                const user = await tx.user.update({
                    where: { id: userId },
                    data: {
                        suspendedAt: null,
                        suspendedBy: null,
                        suspensionReason: null,
                        isActive: true,
                    },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'UNSUSPEND_USER',
                        entity: 'user',
                        entityId: userId,
                        metadata: {
                            userId,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, user };
            });
        }
        catch (error) {
            this.logger.error('Failed to unsuspend user:', error);
            throw error;
        }
    }
    // ===== PLATFORM ANALYTICS =====
    async getPlatformOverview() {
        try {
            const [totalUsers, totalClients, totalTherapists, pendingApplications, totalCommunities, totalPosts, totalSessions,] = await Promise.all([
                this.prisma.user.count(),
                this.prisma.client.count(),
                this.prisma.therapist.count({ where: { status: 'approved' } }),
                this.prisma.therapist.count({ where: { status: 'pending' } }),
                this.prisma.community.count(),
                this.prisma.post.count(),
                this.prisma.meeting.count(),
            ]);
            const recentActivity = await this.prisma.user.findMany({
                take: 10,
                orderBy: { createdAt: 'desc' },
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    role: true,
                    createdAt: true,
                },
            });
            return {
                overview: {
                    totalUsers,
                    totalClients,
                    totalTherapists,
                    pendingApplications,
                    totalCommunities,
                    totalPosts,
                    totalSessions,
                },
                recentActivity,
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve platform overview:', error);
            throw error;
        }
    }
    async getMatchingPerformance(startDate, endDate) {
        try {
            const start = startDate
                ? new Date(startDate)
                : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const end = endDate ? new Date(endDate) : new Date();
            const matchingMetrics = await this.prisma.matchHistory.findMany({
                where: {
                    createdAt: {
                        gte: start,
                        lte: end,
                    },
                },
            });
            const totalRecommendations = matchingMetrics.length;
            const successfulMatches = matchingMetrics.filter((m) => m.becameClient).length;
            const viewedRecommendations = matchingMetrics.filter((m) => m.wasViewed).length;
            const contactedTherapists = matchingMetrics.filter((m) => m.wasContacted).length;
            const averageMatchScore = totalRecommendations > 0
                ? matchingMetrics.reduce((sum, m) => sum + m.totalScore, 0) /
                    totalRecommendations
                : 0;
            const conversionRate = totalRecommendations > 0
                ? (successfulMatches / totalRecommendations) * 100
                : 0;
            const clickThroughRate = totalRecommendations > 0
                ? (viewedRecommendations / totalRecommendations) * 100
                : 0;
            return {
                period: { start, end },
                metrics: {
                    totalRecommendations,
                    successfulMatches,
                    viewedRecommendations,
                    contactedTherapists,
                    averageMatchScore,
                    conversionRate,
                    clickThroughRate,
                },
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve matching performance:', error);
            throw error;
        }
    }
    // ===== CONTENT MODERATION =====
    async getFlaggedContent(params) {
        try {
            const { type, page, limit } = params;
            const skip = (page - 1) * limit;
            // For now, we'll consider posts and comments that might need moderation
            // In a real system, you'd have a flagging mechanism
            const flaggedPosts = await this.prisma.post.findMany({
                where: {
                // Add conditions for flagged content
                // For now, let's get recent posts that might need review
                },
                skip,
                take: type === 'comment' ? 0 : limit,
                orderBy: { createdAt: 'desc' },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                        },
                    },
                    room: {
                        select: {
                            name: true,
                            roomGroup: {
                                select: {
                                    community: {
                                        select: {
                                            name: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                },
            });
            const flaggedComments = await this.prisma.comment.findMany({
                where: {
                // Add conditions for flagged content
                },
                skip: type === 'post' ? 0 : skip,
                take: type === 'post' ? 0 : limit,
                orderBy: { createdAt: 'desc' },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                        },
                    },
                    post: {
                        select: {
                            title: true,
                        },
                    },
                },
            });
            return {
                posts: flaggedPosts,
                comments: flaggedComments,
                page,
                totalItems: flaggedPosts.length + flaggedComments.length,
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve flagged content:', error);
            throw error;
        }
    }
    async moderateContent(contentType, contentId, adminId, action, reason) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                let moderatedContent;
                if (contentType === 'post') {
                    if (action === 'remove') {
                        moderatedContent = await tx.post.delete({
                            where: { id: contentId },
                        });
                    }
                    else {
                        // For approve/flag, we could add moderation status fields
                        moderatedContent = await tx.post.findUnique({
                            where: { id: contentId },
                        });
                    }
                }
                else if (contentType === 'comment') {
                    if (action === 'remove') {
                        moderatedContent = await tx.comment.delete({
                            where: { id: contentId },
                        });
                    }
                    else {
                        moderatedContent = await tx.comment.findUnique({
                            where: { id: contentId },
                        });
                    }
                }
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: contentType === 'post' ? 'MODERATE_POST' : 'MODERATE_COMMENT',
                        entity: contentType,
                        entityId: contentId,
                        metadata: {
                            contentId,
                            contentType,
                            moderationAction: action,
                            reason,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, action, moderatedContent };
            });
        }
        catch (error) {
            this.logger.error('Failed to moderate content:', error);
            throw error;
        }
    }
};
exports.AdminService = AdminService;
exports.AdminService = AdminService = AdminService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object])
], AdminService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2FkbWluL2FkbWluLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FLd0I7QUFDeEIsZ0ZBQW9FO0FBTXBFLDJDQUF3QztBQUdqQyxJQUFNLFlBQVksb0JBQWxCLE1BQU0sWUFBWTtJQUdIO0lBRkgsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGNBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUV4RCxZQUFvQixNQUFxQjtRQUFyQixXQUFNLEdBQU4sTUFBTSxDQUFlO0lBQUcsQ0FBQztJQUU3QyxLQUFLLENBQUMsT0FBTztRQUNYLElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUM5QyxPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO2FBQy9CLENBQUMsQ0FBQztZQUVILE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDNUIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO2dCQUNwQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7Z0JBQzlCLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtnQkFDNUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUMxQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7YUFDM0IsQ0FBQyxDQUFDLENBQUM7UUFDTixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLDRCQUE0QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZELE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRCxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQVU7UUFDdEIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxL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bmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9hZG1pbi9hZG1pbi5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEluamVjdGFibGUsXG4gIExvZ2dlcixcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIENvbmZsaWN0RXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHtcbiAgdHlwZSBDcmVhdGVBZG1pbkR0byxcbiAgdHlwZSBVcGRhdGVBZG1pbkR0byxcbiAgdHlwZSBBZG1pblJlc3BvbnNlRHRvLFxufSBmcm9tICdtZW50YXJhLWNvbW1vbnMnO1xuaW1wb3J0IHsgUHJpc21hIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQWRtaW5TZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEFkbWluU2VydmljZS5uYW1lKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHByaXNtYTogUHJpc21hU2VydmljZSkge31cblxuICBhc3luYyBmaW5kQWxsKCk6IFByb21pc2U8QWRtaW5SZXNwb25zZUR0b1tdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFkbWlucyA9IGF3YWl0IHRoaXMucHJpc21hLmFkbWluLmZpbmRNYW55KHtcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBhZG1pbnMubWFwKChhZG1pbikgPT4gKHtcbiAgICAgICAgdXNlcklkOiBhZG1pbi51c2VySWQsXG4gICAgICAgIHBlcm1pc3Npb25zOiBhZG1pbi5wZXJtaXNzaW9ucyxcbiAgICAgICAgYWRtaW5MZXZlbDogYWRtaW4uYWRtaW5MZXZlbCxcbiAgICAgICAgY3JlYXRlZEF0OiBhZG1pbi5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogYWRtaW4udXBkYXRlZEF0LFxuICAgICAgfSkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIGFkbWluczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaW5kT25lKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFkbWluUmVzcG9uc2VEdG8gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFkbWluID0gYXdhaXQgdGhpcy5wcmlzbWEuYWRtaW4uZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogaWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWFkbWluKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IGFkbWluLnVzZXJJZCxcbiAgICAgICAgcGVybWlzc2lvbnM6IGFkbWluLnBlcm1pc3Npb25zLFxuICAgICAgICBhZG1pbkxldmVsOiBhZG1pbi5hZG1pbkxldmVsLFxuICAgICAgICBjcmVhdGVkQXQ6IGFkbWluLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiBhZG1pbi51cGRhdGVkQXQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHJldHJpZXZlIGFkbWluICR7aWR9OmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZShkYXRhOiBDcmVhdGVBZG1pbkR0byk6IFByb21pc2U8QWRtaW5SZXNwb25zZUR0bz4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBGaXJzdCBjaGVjayBpZiB1c2VyIGV4aXN0c1xuICAgICAgY29uc3QgdXNlckV4aXN0cyA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBkYXRhLnVzZXJJZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdXNlckV4aXN0cykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oYFVzZXIgd2l0aCBJRCAke2RhdGEudXNlcklkfSBub3QgZm91bmRgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgYWRtaW4gYWxyZWFkeSBleGlzdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nQWRtaW4gPSBhd2FpdCB0aGlzLnByaXNtYS5hZG1pbi5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBkYXRhLnVzZXJJZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChleGlzdGluZ0FkbWluKSB7XG4gICAgICAgIHRocm93IG5ldyBDb25mbGljdEV4Y2VwdGlvbihgVXNlciAke2RhdGEudXNlcklkfSBpcyBhbHJlYWR5IGFuIGFkbWluYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFkbWluID0gYXdhaXQgdGhpcy5wcmlzbWEuYWRtaW4uY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVzZXJJZDogZGF0YS51c2VySWQsXG4gICAgICAgICAgcGVybWlzc2lvbnM6IGRhdGEucGVybWlzc2lvbnMsXG4gICAgICAgICAgYWRtaW5MZXZlbDogZGF0YS5hZG1pbkxldmVsID8/ICdhZG1pbicsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKGBDcmVhdGVkIGFkbWluIGZvciB1c2VyICR7ZGF0YS51c2VySWR9YCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXJJZDogYWRtaW4udXNlcklkLFxuICAgICAgICBwZXJtaXNzaW9uczogYWRtaW4ucGVybWlzc2lvbnMsXG4gICAgICAgIGFkbWluTGV2ZWw6IGFkbWluLmFkbWluTGV2ZWwsXG4gICAgICAgIGNyZWF0ZWRBdDogYWRtaW4uY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IGFkbWluLnVwZGF0ZWRBdCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbiB8fFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIENvbmZsaWN0RXhjZXB0aW9uXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFByaXNtYS5QcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1AyMDAyJykge1xuICAgICAgICAgIHRocm93IG5ldyBDb25mbGljdEV4Y2VwdGlvbihcbiAgICAgICAgICAgIGBVc2VyICR7ZGF0YS51c2VySWR9IGlzIGFscmVhZHkgYW4gYWRtaW5gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQMjAwMycpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oYFVzZXIgd2l0aCBJRCAke2RhdGEudXNlcklkfSBub3QgZm91bmRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgZGF0YTogVXBkYXRlQWRtaW5EdG8pOiBQcm9taXNlPEFkbWluUmVzcG9uc2VEdG8+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYWRtaW4gPSBhd2FpdCB0aGlzLnByaXNtYS5hZG1pbi51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IGlkIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwZXJtaXNzaW9uczogZGF0YS5wZXJtaXNzaW9ucyxcbiAgICAgICAgICBhZG1pbkxldmVsOiBkYXRhLmFkbWluTGV2ZWwsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKGBVcGRhdGVkIGFkbWluICR7aWR9YCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXJJZDogYWRtaW4udXNlcklkLFxuICAgICAgICBwZXJtaXNzaW9uczogYWRtaW4ucGVybWlzc2lvbnMsXG4gICAgICAgIGFkbWluTGV2ZWw6IGFkbWluLmFkbWluTGV2ZWwsXG4gICAgICAgIGNyZWF0ZWRBdDogYWRtaW4uY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IGFkbWluLnVwZGF0ZWRBdCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFByaXNtYS5QcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1AyMDI1Jykge1xuICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihgQWRtaW4gd2l0aCBJRCAke2lkfSBub3QgZm91bmRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHVwZGF0ZSBhZG1pbiAke2lkfTpgLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyByZW1vdmUoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5hZG1pbi5kZWxldGUoeyB3aGVyZTogeyB1c2VySWQ6IGlkIH0gfSk7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYERlbGV0ZWQgYWRtaW4gJHtpZH1gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgUHJpc21hLlByaXNtYUNsaWVudEtub3duUmVxdWVzdEVycm9yKSB7XG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUDIwMjUnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKGBBZG1pbiB3aXRoIElEICR7aWR9IG5vdCBmb3VuZGApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gZGVsZXRlIGFkbWluICR7aWR9OmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09IFRIRVJBUElTVCBBUFBMSUNBVElPTiBNQU5BR0VNRU5UID09PT09XG5cbiAgYXN5bmMgZ2V0QWxsVGhlcmFwaXN0QXBwbGljYXRpb25zKHBhcmFtczoge1xuICAgIHN0YXR1cz86IHN0cmluZztcbiAgICBwYWdlOiBudW1iZXI7XG4gICAgbGltaXQ6IG51bWJlcjtcbiAgfSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHN0YXR1cywgcGFnZSwgbGltaXQgfSA9IHBhcmFtcztcbiAgICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7fTtcbiAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgd2hlcmUuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbYXBwbGljYXRpb25zLCB0b3RhbENvdW50XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmZpbmRNYW55KHtcbiAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICBza2lwLFxuICAgICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICAgIG9yZGVyQnk6IHsgc3VibWlzc2lvbkRhdGU6ICdkZXNjJyB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9jZXNzZWRCeUFkbWluOiB7XG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHRoaXMucHJpc21hLnRoZXJhcGlzdC5jb3VudCh7IHdoZXJlIH0pLFxuICAgICAgXSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcGxpY2F0aW9ucyxcbiAgICAgICAgdG90YWxDb3VudCxcbiAgICAgICAgcGFnZSxcbiAgICAgICAgdG90YWxQYWdlczogTWF0aC5jZWlsKHRvdGFsQ291bnQgLyBsaW1pdCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHRoZXJhcGlzdCBhcHBsaWNhdGlvbnM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VGhlcmFwaXN0QXBwbGljYXRpb24oYXBwbGljYXRpb25JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogYXBwbGljYXRpb25JZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICBwcm9jZXNzZWRCeUFkbWluOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSB0aGVyYXBpc3QgYXBwbGljYXRpb246JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYXBwcm92ZVRoZXJhcGlzdEFwcGxpY2F0aW9uKFxuICAgIGFwcGxpY2F0aW9uSWQ6IHN0cmluZyxcbiAgICBhZG1pbklkOiBzdHJpbmcsXG4gICAgbm90ZXM/OiBzdHJpbmcsXG4gICkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAvLyBVcGRhdGUgdGhlcmFwaXN0IHN0YXR1c1xuICAgICAgICBjb25zdCB0aGVyYXBpc3QgPSBhd2FpdCB0eC50aGVyYXBpc3QudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IGFwcGxpY2F0aW9uSWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzdGF0dXM6ICdhcHByb3ZlZCcsXG4gICAgICAgICAgICBwcm9jZXNzZWRCeUFkbWluSWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBwcm9jZXNzaW5nRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBVcGRhdGUgdXNlciByb2xlXG4gICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogYXBwbGljYXRpb25JZCB9LFxuICAgICAgICAgIGRhdGE6IHsgcm9sZTogJ3RoZXJhcGlzdCcgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZ1xuICAgICAgICBhd2FpdCB0eC5hdWRpdExvZy5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogYWRtaW5JZCxcbiAgICAgICAgICAgIGFjdGlvbjogJ0FQUFJPVkVfVEhFUkFQSVNUX0FQUExJQ0FUSU9OJyxcbiAgICAgICAgICAgIGVudGl0eTogJ3RoZXJhcGlzdCcsXG4gICAgICAgICAgICBlbnRpdHlJZDogYXBwbGljYXRpb25JZCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIGFwcGxpY2F0aW9uSWQsXG4gICAgICAgICAgICAgIG5vdGVzLFxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdGhlcmFwaXN0IH07XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBhcHByb3ZlIHRoZXJhcGlzdCBhcHBsaWNhdGlvbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyByZWplY3RUaGVyYXBpc3RBcHBsaWNhdGlvbihcbiAgICBhcHBsaWNhdGlvbklkOiBzdHJpbmcsXG4gICAgYWRtaW5JZDogc3RyaW5nLFxuICAgIHJlYXNvbjogc3RyaW5nLFxuICAgIG5vdGVzPzogc3RyaW5nLFxuICApIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gVXBkYXRlIHRoZXJhcGlzdCBzdGF0dXNcbiAgICAgICAgY29uc3QgdGhlcmFwaXN0ID0gYXdhaXQgdHgudGhlcmFwaXN0LnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBhcHBsaWNhdGlvbklkIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgc3RhdHVzOiAncmVqZWN0ZWQnLFxuICAgICAgICAgICAgcHJvY2Vzc2VkQnlBZG1pbklkOiBhZG1pbklkLFxuICAgICAgICAgICAgcHJvY2Vzc2luZ0RhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZ1xuICAgICAgICBhd2FpdCB0eC5hdWRpdExvZy5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogYWRtaW5JZCxcbiAgICAgICAgICAgIGFjdGlvbjogJ1JFSkVDVF9USEVSQVBJU1RfQVBQTElDQVRJT04nLFxuICAgICAgICAgICAgZW50aXR5OiAndGhlcmFwaXN0JyxcbiAgICAgICAgICAgIGVudGl0eUlkOiBhcHBsaWNhdGlvbklkLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgYXBwbGljYXRpb25JZCxcbiAgICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgICBub3RlcyxcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHRoZXJhcGlzdCwgcmVhc29uIH07XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZWplY3QgdGhlcmFwaXN0IGFwcGxpY2F0aW9uOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09IFVTRVIgTUFOQUdFTUVOVCA9PT09PVxuXG4gIGFzeW5jIGdldEFsbFVzZXJzKHBhcmFtczoge1xuICAgIHJvbGU/OiBzdHJpbmc7XG4gICAgcGFnZTogbnVtYmVyO1xuICAgIGxpbWl0OiBudW1iZXI7XG4gICAgc2VhcmNoPzogc3RyaW5nO1xuICAgIHN0YXR1cz86IHN0cmluZztcbiAgICBzb3J0Qnk/OiBzdHJpbmc7XG4gICAgc29ydE9yZGVyPzogc3RyaW5nO1xuICB9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgcm9sZSwgcGFnZSwgbGltaXQsIHNlYXJjaCwgc3RhdHVzLCBzb3J0QnksIHNvcnRPcmRlciB9ID0gcGFyYW1zO1xuICAgICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgICAgY29uc3Qgd2hlcmU6IGFueSA9IHt9O1xuICAgICAgaWYgKHJvbGUpIHtcbiAgICAgICAgd2hlcmUucm9sZSA9IHJvbGU7XG4gICAgICB9XG4gICAgICBpZiAoc2VhcmNoKSB7XG4gICAgICAgIHdoZXJlLk9SID0gW1xuICAgICAgICAgIHsgZmlyc3ROYW1lOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6ICdpbnNlbnNpdGl2ZScgfSB9LFxuICAgICAgICAgIHsgbGFzdE5hbWU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogJ2luc2Vuc2l0aXZlJyB9IH0sXG4gICAgICAgICAgeyBlbWFpbDogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiAnaW5zZW5zaXRpdmUnIH0gfSxcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ2FjdGl2ZScpIHtcbiAgICAgICAgICB3aGVyZS5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSAnaW5hY3RpdmUnKSB7XG4gICAgICAgICAgd2hlcmUuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdzdXNwZW5kZWQnKSB7XG4gICAgICAgICAgd2hlcmUuc3VzcGVuZGVkQXQgPSB7IG5vdDogbnVsbCB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1aWxkIG9yZGVyQnkgY2xhdXNlXG4gICAgICBjb25zdCBvcmRlckJ5OiBhbnkgPSB7fTtcbiAgICAgIGlmIChcbiAgICAgICAgc29ydEJ5ICYmXG4gICAgICAgIFsnY3JlYXRlZEF0JywgJ2ZpcnN0TmFtZScsICdsYXN0TmFtZScsICdlbWFpbCcsICdyb2xlJ10uaW5jbHVkZXMoc29ydEJ5KVxuICAgICAgKSB7XG4gICAgICAgIG9yZGVyQnlbc29ydEJ5XSA9IHNvcnRPcmRlciA9PT0gJ2FzYycgPyAnYXNjJyA6ICdkZXNjJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9yZGVyQnkuY3JlYXRlZEF0ID0gJ2Rlc2MnO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbdXNlcnMsIHRvdGFsQ291bnRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICB0aGlzLnByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICBza2lwLFxuICAgICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICAgIG9yZGVyQnksXG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgICBpc1ZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgbGFzdExvZ2luQXQ6IHRydWUsXG4gICAgICAgICAgICBzdXNwZW5kZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgIHN1c3BlbnNpb25SZWFzb246IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHRoaXMucHJpc21hLnVzZXIuY291bnQoeyB3aGVyZSB9KSxcbiAgICAgIF0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VycyxcbiAgICAgICAgdG90YWxDb3VudCxcbiAgICAgICAgcGFnZSxcbiAgICAgICAgdG90YWxQYWdlczogTWF0aC5jZWlsKHRvdGFsQ291bnQgLyBsaW1pdCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHVzZXJzOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFVzZXIodXNlcklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGNsaWVudDogdHJ1ZSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IHRydWUsXG4gICAgICAgICAgYWRtaW46IHRydWUsXG4gICAgICAgICAgbW9kZXJhdG9yOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgdXNlcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdXNwZW5kVXNlcihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBhZG1pbklkOiBzdHJpbmcsXG4gICAgcmVhc29uOiBzdHJpbmcsXG4gICAgZHVyYXRpb24/OiBudW1iZXIsXG4gICkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICBjb25zdCBzdXNwZW5zaW9uRW5kID0gZHVyYXRpb25cbiAgICAgICAgICA/IG5ldyBEYXRlKERhdGUubm93KCkgKyBkdXJhdGlvbiAqIDI0ICogNjAgKiA2MCAqIDEwMDApXG4gICAgICAgICAgOiBudWxsO1xuXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN1c3BlbmRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgc3VzcGVuZGVkQnk6IGFkbWluSWQsXG4gICAgICAgICAgICBzdXNwZW5zaW9uUmVhc29uOiByZWFzb24sXG4gICAgICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZ1xuICAgICAgICBhd2FpdCB0eC5hdWRpdExvZy5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogYWRtaW5JZCxcbiAgICAgICAgICAgIGFjdGlvbjogJ1NVU1BFTkRfVVNFUicsXG4gICAgICAgICAgICBlbnRpdHk6ICd1c2VyJyxcbiAgICAgICAgICAgIGVudGl0eUlkOiB1c2VySWQsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICAgIHN1c3BlbnNpb25FbmQ6IHN1c3BlbnNpb25FbmQ/LnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1c2VyIH07XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBzdXNwZW5kIHVzZXI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdW5zdXNwZW5kVXNlcih1c2VySWQ6IHN0cmluZywgYWRtaW5JZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN1c3BlbmRlZEF0OiBudWxsLFxuICAgICAgICAgICAgc3VzcGVuZGVkQnk6IG51bGwsXG4gICAgICAgICAgICBzdXNwZW5zaW9uUmVhc29uOiBudWxsLFxuICAgICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZ1xuICAgICAgICBhd2FpdCB0eC5hdWRpdExvZy5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogYWRtaW5JZCxcbiAgICAgICAgICAgIGFjdGlvbjogJ1VOU1VTUEVORF9VU0VSJyxcbiAgICAgICAgICAgIGVudGl0eTogJ3VzZXInLFxuICAgICAgICAgICAgZW50aXR5SWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVzZXIgfTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHVuc3VzcGVuZCB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09IFBMQVRGT1JNIEFOQUxZVElDUyA9PT09PVxuXG4gIGFzeW5jIGdldFBsYXRmb3JtT3ZlcnZpZXcoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IFtcbiAgICAgICAgdG90YWxVc2VycyxcbiAgICAgICAgdG90YWxDbGllbnRzLFxuICAgICAgICB0b3RhbFRoZXJhcGlzdHMsXG4gICAgICAgIHBlbmRpbmdBcHBsaWNhdGlvbnMsXG4gICAgICAgIHRvdGFsQ29tbXVuaXRpZXMsXG4gICAgICAgIHRvdGFsUG9zdHMsXG4gICAgICAgIHRvdGFsU2Vzc2lvbnMsXG4gICAgICBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICB0aGlzLnByaXNtYS51c2VyLmNvdW50KCksXG4gICAgICAgIHRoaXMucHJpc21hLmNsaWVudC5jb3VudCgpLFxuICAgICAgICB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoeyB3aGVyZTogeyBzdGF0dXM6ICdhcHByb3ZlZCcgfSB9KSxcbiAgICAgICAgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmNvdW50KHsgd2hlcmU6IHsgc3RhdHVzOiAncGVuZGluZycgfSB9KSxcbiAgICAgICAgdGhpcy5wcmlzbWEuY29tbXVuaXR5LmNvdW50KCksXG4gICAgICAgIHRoaXMucHJpc21hLnBvc3QuY291bnQoKSxcbiAgICAgICAgdGhpcy5wcmlzbWEubWVldGluZy5jb3VudCgpLFxuICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IHJlY2VudEFjdGl2aXR5ID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgICAgIHRha2U6IDEwLFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBvdmVydmlldzoge1xuICAgICAgICAgIHRvdGFsVXNlcnMsXG4gICAgICAgICAgdG90YWxDbGllbnRzLFxuICAgICAgICAgIHRvdGFsVGhlcmFwaXN0cyxcbiAgICAgICAgICBwZW5kaW5nQXBwbGljYXRpb25zLFxuICAgICAgICAgIHRvdGFsQ29tbXVuaXRpZXMsXG4gICAgICAgICAgdG90YWxQb3N0cyxcbiAgICAgICAgICB0b3RhbFNlc3Npb25zLFxuICAgICAgICB9LFxuICAgICAgICByZWNlbnRBY3Rpdml0eSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgcGxhdGZvcm0gb3ZlcnZpZXc6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0TWF0Y2hpbmdQZXJmb3JtYW5jZShzdGFydERhdGU/OiBzdHJpbmcsIGVuZERhdGU/OiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnQgPSBzdGFydERhdGVcbiAgICAgICAgPyBuZXcgRGF0ZShzdGFydERhdGUpXG4gICAgICAgIDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBjb25zdCBlbmQgPSBlbmREYXRlID8gbmV3IERhdGUoZW5kRGF0ZSkgOiBuZXcgRGF0ZSgpO1xuXG4gICAgICBjb25zdCBtYXRjaGluZ01ldHJpY3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgZ3RlOiBzdGFydCxcbiAgICAgICAgICAgIGx0ZTogZW5kLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdG90YWxSZWNvbW1lbmRhdGlvbnMgPSBtYXRjaGluZ01ldHJpY3MubGVuZ3RoO1xuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bE1hdGNoZXMgPSBtYXRjaGluZ01ldHJpY3MuZmlsdGVyKFxuICAgICAgICAobSkgPT4gbS5iZWNhbWVDbGllbnQsXG4gICAgICApLmxlbmd0aDtcbiAgICAgIGNvbnN0IHZpZXdlZFJlY29tbWVuZGF0aW9ucyA9IG1hdGNoaW5nTWV0cmljcy5maWx0ZXIoXG4gICAgICAgIChtKSA9PiBtLndhc1ZpZXdlZCxcbiAgICAgICkubGVuZ3RoO1xuICAgICAgY29uc3QgY29udGFjdGVkVGhlcmFwaXN0cyA9IG1hdGNoaW5nTWV0cmljcy5maWx0ZXIoXG4gICAgICAgIChtKSA9PiBtLndhc0NvbnRhY3RlZCxcbiAgICAgICkubGVuZ3RoO1xuXG4gICAgICBjb25zdCBhdmVyYWdlTWF0Y2hTY29yZSA9XG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zID4gMFxuICAgICAgICAgID8gbWF0Y2hpbmdNZXRyaWNzLnJlZHVjZSgoc3VtLCBtKSA9PiBzdW0gKyBtLnRvdGFsU2NvcmUsIDApIC9cbiAgICAgICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zXG4gICAgICAgICAgOiAwO1xuXG4gICAgICBjb25zdCBjb252ZXJzaW9uUmF0ZSA9XG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zID4gMFxuICAgICAgICAgID8gKHN1Y2Nlc3NmdWxNYXRjaGVzIC8gdG90YWxSZWNvbW1lbmRhdGlvbnMpICogMTAwXG4gICAgICAgICAgOiAwO1xuXG4gICAgICBjb25zdCBjbGlja1Rocm91Z2hSYXRlID1cbiAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnMgPiAwXG4gICAgICAgICAgPyAodmlld2VkUmVjb21tZW5kYXRpb25zIC8gdG90YWxSZWNvbW1lbmRhdGlvbnMpICogMTAwXG4gICAgICAgICAgOiAwO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwZXJpb2Q6IHsgc3RhcnQsIGVuZCB9LFxuICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnMsXG4gICAgICAgICAgc3VjY2Vzc2Z1bE1hdGNoZXMsXG4gICAgICAgICAgdmlld2VkUmVjb21tZW5kYXRpb25zLFxuICAgICAgICAgIGNvbnRhY3RlZFRoZXJhcGlzdHMsXG4gICAgICAgICAgYXZlcmFnZU1hdGNoU2NvcmUsXG4gICAgICAgICAgY29udmVyc2lvblJhdGUsXG4gICAgICAgICAgY2xpY2tUaHJvdWdoUmF0ZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgbWF0Y2hpbmcgcGVyZm9ybWFuY2U6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT0gQ09OVEVOVCBNT0RFUkFUSU9OID09PT09XG5cbiAgYXN5bmMgZ2V0RmxhZ2dlZENvbnRlbnQocGFyYW1zOiB7XG4gICAgdHlwZT86IHN0cmluZztcbiAgICBwYWdlOiBudW1iZXI7XG4gICAgbGltaXQ6IG51bWJlcjtcbiAgfSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHR5cGUsIHBhZ2UsIGxpbWl0IH0gPSBwYXJhbXM7XG4gICAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgICAvLyBGb3Igbm93LCB3ZSdsbCBjb25zaWRlciBwb3N0cyBhbmQgY29tbWVudHMgdGhhdCBtaWdodCBuZWVkIG1vZGVyYXRpb25cbiAgICAgIC8vIEluIGEgcmVhbCBzeXN0ZW0sIHlvdSdkIGhhdmUgYSBmbGFnZ2luZyBtZWNoYW5pc21cbiAgICAgIGNvbnN0IGZsYWdnZWRQb3N0cyA9IGF3YWl0IHRoaXMucHJpc21hLnBvc3QuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIC8vIEFkZCBjb25kaXRpb25zIGZvciBmbGFnZ2VkIGNvbnRlbnRcbiAgICAgICAgICAvLyBGb3Igbm93LCBsZXQncyBnZXQgcmVjZW50IHBvc3RzIHRoYXQgbWlnaHQgbmVlZCByZXZpZXdcbiAgICAgICAgfSxcbiAgICAgICAgc2tpcCxcbiAgICAgICAgdGFrZTogdHlwZSA9PT0gJ2NvbW1lbnQnID8gMCA6IGxpbWl0LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcm9vbToge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIHJvb21Hcm91cDoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgY29tbXVuaXR5OiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZmxhZ2dlZENvbW1lbnRzID0gYXdhaXQgdGhpcy5wcmlzbWEuY29tbWVudC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgLy8gQWRkIGNvbmRpdGlvbnMgZm9yIGZsYWdnZWQgY29udGVudFxuICAgICAgICB9LFxuICAgICAgICBza2lwOiB0eXBlID09PSAncG9zdCcgPyAwIDogc2tpcCxcbiAgICAgICAgdGFrZTogdHlwZSA9PT0gJ3Bvc3QnID8gMCA6IGxpbWl0LFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9zdDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHRpdGxlOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvc3RzOiBmbGFnZ2VkUG9zdHMsXG4gICAgICAgIGNvbW1lbnRzOiBmbGFnZ2VkQ29tbWVudHMsXG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHRvdGFsSXRlbXM6IGZsYWdnZWRQb3N0cy5sZW5ndGggKyBmbGFnZ2VkQ29tbWVudHMubGVuZ3RoLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBmbGFnZ2VkIGNvbnRlbnQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbW9kZXJhdGVDb250ZW50KFxuICAgIGNvbnRlbnRUeXBlOiBzdHJpbmcsXG4gICAgY29udGVudElkOiBzdHJpbmcsXG4gICAgYWRtaW5JZDogc3RyaW5nLFxuICAgIGFjdGlvbjogJ2FwcHJvdmUnIHwgJ3JlbW92ZScgfCAnZmxhZycsXG4gICAgcmVhc29uPzogc3RyaW5nLFxuICApIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgbGV0IG1vZGVyYXRlZENvbnRlbnQ7XG5cbiAgICAgICAgaWYgKGNvbnRlbnRUeXBlID09PSAncG9zdCcpIHtcbiAgICAgICAgICBpZiAoYWN0aW9uID09PSAncmVtb3ZlJykge1xuICAgICAgICAgICAgbW9kZXJhdGVkQ29udGVudCA9IGF3YWl0IHR4LnBvc3QuZGVsZXRlKHtcbiAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlbnRJZCB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEZvciBhcHByb3ZlL2ZsYWcsIHdlIGNvdWxkIGFkZCBtb2RlcmF0aW9uIHN0YXR1cyBmaWVsZHNcbiAgICAgICAgICAgIG1vZGVyYXRlZENvbnRlbnQgPSBhd2FpdCB0eC5wb3N0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVudElkIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoY29udGVudFR5cGUgPT09ICdjb21tZW50Jykge1xuICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICBtb2RlcmF0ZWRDb250ZW50ID0gYXdhaXQgdHguY29tbWVudC5kZWxldGUoe1xuICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVudElkIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbW9kZXJhdGVkQ29udGVudCA9IGF3YWl0IHR4LmNvbW1lbnQuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZW50SWQgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2dcbiAgICAgICAgYXdhaXQgdHguYXVkaXRMb2cuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBhY3Rpb246XG4gICAgICAgICAgICAgIGNvbnRlbnRUeXBlID09PSAncG9zdCcgPyAnTU9ERVJBVEVfUE9TVCcgOiAnTU9ERVJBVEVfQ09NTUVOVCcsXG4gICAgICAgICAgICBlbnRpdHk6IGNvbnRlbnRUeXBlLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGNvbnRlbnRJZCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIGNvbnRlbnRJZCxcbiAgICAgICAgICAgICAgY29udGVudFR5cGUsXG4gICAgICAgICAgICAgIG1vZGVyYXRpb25BY3Rpb246IGFjdGlvbixcbiAgICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWN0aW9uLCBtb2RlcmF0ZWRDb250ZW50IH07XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBtb2RlcmF0ZSBjb250ZW50OicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9