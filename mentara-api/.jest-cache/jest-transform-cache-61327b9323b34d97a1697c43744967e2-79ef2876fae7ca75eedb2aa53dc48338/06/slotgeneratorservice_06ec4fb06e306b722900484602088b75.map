{"version":3,"names":["cov_1u696nzcak","actualCoverage","common_1","s","require","prisma_client_provider_1","SlotGeneratorService","prisma","defaultConfig","slotInterval","maxAdvanceBooking","minAdvanceBooking","constructor","f","getDurations","id","name","duration","generateAvailableSlots","therapistId","date","config","b","finalConfig","targetDate","Date","dayOfWeek","getDay","validateBookingDate","availability","getTherapistAvailability","length","existingBookings","getExistingBookings","allSlots","avail","slots","generateSlotsForAvailabilityWindow","push","sort","a","startTime","getTime","now","maxDate","minDate","BadRequestException","therapistAvailability","findMany","where","toString","isAvailable","orderBy","startOfDay","setHours","endOfDay","meeting","gte","lte","status","in","durations","createDateTime","endTime","currentTime","slotEnd","hasConflictWithBookings","availableDurations","getAvailableDurations","toISOString","timeString","hours","minutes","split","map","Number","dateTime","slotStart","bookings","some","booking","bookingEnd","hasTimeOverlap","availabilityEnd","filter","durationEnd","start1","end1","start2","end2","isSlotAvailable","findFirst","availStart","availEnd","exports","__decorate","Injectable","PrismaService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/services/slot-generator.service.ts"],"sourcesContent":["import { Injectable, BadRequestException } from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\n\nexport interface TimeSlot {\n  startTime: string;\n  availableDurations: {\n    id: string;\n    name: string;\n    duration: number;\n  }[];\n}\n\nexport interface SlotGenerationConfig {\n  slotInterval: number; // minutes\n  maxAdvanceBooking: number; // days\n  minAdvanceBooking: number; // hours\n}\n\n@Injectable()\nexport class SlotGeneratorService {\n  private readonly defaultConfig: SlotGenerationConfig = {\n    slotInterval: 30,\n    maxAdvanceBooking: 90,\n    minAdvanceBooking: 2,\n  };\n\n  constructor(private readonly prisma: PrismaService) {}\n\n  private getDurations() {\n    return [\n      { id: '30', name: '30 minutes', duration: 30 },\n      { id: '60', name: '60 minutes', duration: 60 },\n      { id: '90', name: '90 minutes', duration: 90 },\n      { id: '120', name: '120 minutes', duration: 120 },\n    ];\n  }\n\n  /**\n   * Generate available time slots for a therapist on a specific date\n   */\n  async generateAvailableSlots(\n    therapistId: string,\n    date: string,\n    config: Partial<SlotGenerationConfig> = {},\n  ): Promise<TimeSlot[]> {\n    const finalConfig = { ...this.defaultConfig, ...config };\n    const targetDate = new Date(date);\n    const dayOfWeek = targetDate.getDay();\n\n    // Validate date is within booking window\n    this.validateBookingDate(targetDate, finalConfig);\n\n    // Get therapist availability for this day\n    const availability = await this.getTherapistAvailability(\n      therapistId,\n      dayOfWeek,\n    );\n    if (availability.length === 0) {\n      return [];\n    }\n\n    // Get existing bookings for this date\n    const existingBookings = await this.getExistingBookings(\n      therapistId,\n      targetDate,\n    );\n\n    // Generate slots for each availability window\n    const allSlots: TimeSlot[] = [];\n    for (const avail of availability) {\n      const slots = this.generateSlotsForAvailabilityWindow(\n        targetDate,\n        avail,\n        existingBookings,\n        finalConfig,\n      );\n      allSlots.push(...slots);\n    }\n\n    return allSlots.sort(\n      (a, b) =>\n        new Date(a.startTime).getTime() - new Date(b.startTime).getTime(),\n    );\n  }\n\n  private validateBookingDate(date: Date, config: SlotGenerationConfig): void {\n    const now = new Date();\n    const maxDate = new Date(\n      now.getTime() + config.maxAdvanceBooking * 24 * 60 * 60 * 1000,\n    );\n    const minDate = new Date(\n      now.getTime() + config.minAdvanceBooking * 60 * 60 * 1000,\n    );\n\n    if (date < minDate) {\n      throw new BadRequestException(\n        `Bookings must be made at least ${config.minAdvanceBooking} hours in advance`,\n      );\n    }\n\n    if (date > maxDate) {\n      throw new BadRequestException(\n        `Bookings can only be made up to ${config.maxAdvanceBooking} days in advance`,\n      );\n    }\n  }\n\n  private async getTherapistAvailability(\n    therapistId: string,\n    dayOfWeek: number,\n  ) {\n    return this.prisma.therapistAvailability.findMany({\n      where: {\n        therapistId,\n        dayOfWeek: dayOfWeek.toString(),\n        isAvailable: true,\n      },\n      orderBy: { startTime: 'asc' },\n    });\n  }\n\n  private async getExistingBookings(therapistId: string, date: Date) {\n    const startOfDay = new Date(date);\n    startOfDay.setHours(0, 0, 0, 0);\n    const endOfDay = new Date(date);\n    endOfDay.setHours(23, 59, 59, 999);\n\n    return this.prisma.meeting.findMany({\n      where: {\n        therapistId,\n        startTime: { gte: startOfDay, lte: endOfDay },\n        status: { in: ['SCHEDULED', 'CONFIRMED'] },\n      },\n      orderBy: { startTime: 'asc' },\n    });\n  }\n\n  private generateSlotsForAvailabilityWindow(\n    date: Date,\n    availability: any,\n    existingBookings: any[],\n    config: SlotGenerationConfig,\n  ): TimeSlot[] {\n    const slots: TimeSlot[] = [];\n    const durations = this.getDurations();\n\n    const startTime = this.createDateTime(date, availability.startTime);\n    const endTime = this.createDateTime(date, availability.endTime);\n\n    let currentTime = new Date(startTime);\n\n    while (currentTime < endTime) {\n      const slotEnd = new Date(\n        currentTime.getTime() + config.slotInterval * 60000,\n      );\n\n      if (slotEnd <= endTime) {\n        // Check if this slot conflicts with existing bookings\n        if (\n          !this.hasConflictWithBookings(currentTime, slotEnd, existingBookings)\n        ) {\n          // Find which durations fit in this slot\n          const availableDurations = this.getAvailableDurations(\n            currentTime,\n            endTime,\n            existingBookings,\n            durations,\n          );\n\n          if (availableDurations.length > 0) {\n            slots.push({\n              startTime: currentTime.toISOString(),\n              availableDurations,\n            });\n          }\n        }\n      }\n\n      currentTime = new Date(\n        currentTime.getTime() + config.slotInterval * 60000,\n      );\n    }\n\n    return slots;\n  }\n\n  private createDateTime(date: Date, timeString: string): Date {\n    const [hours, minutes] = timeString.split(':').map(Number);\n    const dateTime = new Date(date);\n    dateTime.setHours(hours, minutes, 0, 0);\n    return dateTime;\n  }\n\n  private hasConflictWithBookings(\n    slotStart: Date,\n    slotEnd: Date,\n    bookings: any[],\n  ): boolean {\n    return bookings.some((booking) => {\n      const bookingEnd = new Date(\n        booking.startTime.getTime() + booking.duration * 60000,\n      );\n      return this.hasTimeOverlap(\n        slotStart,\n        slotEnd,\n        booking.startTime,\n        bookingEnd,\n      );\n    });\n  }\n\n  private getAvailableDurations(\n    slotStart: Date,\n    availabilityEnd: Date,\n    existingBookings: any[],\n    durations: any[],\n  ) {\n    return durations.filter((duration) => {\n      const durationEnd = new Date(\n        slotStart.getTime() + duration.duration * 60000,\n      );\n\n      // Check if duration fits within availability window\n      if (durationEnd > availabilityEnd) {\n        return false;\n      }\n\n      // Check if duration conflicts with existing bookings\n      return !this.hasConflictWithBookings(\n        slotStart,\n        durationEnd,\n        existingBookings,\n      );\n    });\n  }\n\n  private hasTimeOverlap(\n    start1: Date,\n    end1: Date,\n    start2: Date,\n    end2: Date,\n  ): boolean {\n    return start1 < end2 && end1 > start2;\n  }\n\n  /**\n   * Check if a specific time slot is available\n   */\n  async isSlotAvailable(\n    therapistId: string,\n    startTime: Date,\n    duration: number,\n  ): Promise<boolean> {\n    const endTime = new Date(startTime.getTime() + duration * 60000);\n    const dayOfWeek = startTime.getDay();\n\n    // Check therapist availability\n    const availability = await this.prisma.therapistAvailability.findFirst({\n      where: {\n        therapistId,\n        dayOfWeek: dayOfWeek.toString(),\n        isAvailable: true,\n      },\n    });\n\n    if (!availability) {\n      return false;\n    }\n\n    // Check if time fits within availability window\n    const availStart = this.createDateTime(startTime, availability.startTime);\n    const availEnd = this.createDateTime(startTime, availability.endTime);\n\n    if (startTime < availStart || endTime > availEnd) {\n      return false;\n    }\n\n    // Check for conflicts with existing bookings\n    const existingBookings = await this.getExistingBookings(\n      therapistId,\n      startTime,\n    );\n\n    return !this.hasConflictWithBookings(startTime, endTime, existingBookings);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAmBa;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAnBb,MAAAE,QAAA;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAC,wBAAA;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,QAAAC,OAAA;AAAuE;AAAAJ,cAAA,GAAAG,CAAA;AAkBhE,IAAMG,oBAAoB,GAA1B,MAAMA,oBAAoB;EAOFC,MAAA;EANZC,aAAa;EAAA;EAAA,CAAAR,cAAA,GAAAG,CAAA,QAAyB;IACrDM,YAAY,EAAE,EAAE;IAChBC,iBAAiB,EAAE,EAAE;IACrBC,iBAAiB,EAAE;GACpB;EAEDC,YAA6BL,MAAqB;IAAA;IAAAP,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAG,CAAA;IAArB,KAAAI,MAAM,GAANA,MAAM;EAAkB;EAE7CO,YAAYA,CAAA;IAAA;IAAAd,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAG,CAAA;IAClB,OAAO,CACL;MAAEY,EAAE,EAAE,IAAI;MAAEC,IAAI,EAAE,YAAY;MAAEC,QAAQ,EAAE;IAAE,CAAE,EAC9C;MAAEF,EAAE,EAAE,IAAI;MAAEC,IAAI,EAAE,YAAY;MAAEC,QAAQ,EAAE;IAAE,CAAE,EAC9C;MAAEF,EAAE,EAAE,IAAI;MAAEC,IAAI,EAAE,YAAY;MAAEC,QAAQ,EAAE;IAAE,CAAE,EAC9C;MAAEF,EAAE,EAAE,KAAK;MAAEC,IAAI,EAAE,aAAa;MAAEC,QAAQ,EAAE;IAAG,CAAE,CAClD;EACH;EAEA;;;EAGA,MAAMC,sBAAsBA,CAC1BC,WAAmB,EACnBC,IAAY,EACZC,MAAA;EAAA;EAAA,CAAArB,cAAA,GAAAsB,CAAA,WAAwC,EAAE;IAAA;IAAAtB,cAAA,GAAAa,CAAA;IAE1C,MAAMU,WAAW;IAAA;IAAA,CAAAvB,cAAA,GAAAG,CAAA,QAAG;MAAE,GAAG,IAAI,CAACK,aAAa;MAAE,GAAGa;IAAM,CAAE;IACxD,MAAMG,UAAU;IAAA;IAAA,CAAAxB,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAACL,IAAI,CAAC;IACjC,MAAMM,SAAS;IAAA;IAAA,CAAA1B,cAAA,GAAAG,CAAA,QAAGqB,UAAU,CAACG,MAAM,EAAE;IAErC;IAAA;IAAA3B,cAAA,GAAAG,CAAA;IACA,IAAI,CAACyB,mBAAmB,CAACJ,UAAU,EAAED,WAAW,CAAC;IAEjD;IACA,MAAMM,YAAY;IAAA;IAAA,CAAA7B,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAAC2B,wBAAwB,CACtDX,WAAW,EACXO,SAAS,CACV;IAAC;IAAA1B,cAAA,GAAAG,CAAA;IACF,IAAI0B,YAAY,CAACE,MAAM,KAAK,CAAC,EAAE;MAAA;MAAA/B,cAAA,GAAAsB,CAAA;MAAAtB,cAAA,GAAAG,CAAA;MAC7B,OAAO,EAAE;IACX,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAsB,CAAA;IAAA;IAED;IACA,MAAMU,gBAAgB;IAAA;IAAA,CAAAhC,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAAC8B,mBAAmB,CACrDd,WAAW,EACXK,UAAU,CACX;IAED;IACA,MAAMU,QAAQ;IAAA;IAAA,CAAAlC,cAAA,GAAAG,CAAA,QAAe,EAAE;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAChC,KAAK,MAAMgC,KAAK,IAAIN,YAAY,EAAE;MAChC,MAAMO,KAAK;MAAA;MAAA,CAAApC,cAAA,GAAAG,CAAA,QAAG,IAAI,CAACkC,kCAAkC,CACnDb,UAAU,EACVW,KAAK,EACLH,gBAAgB,EAChBT,WAAW,CACZ;MAAC;MAAAvB,cAAA,GAAAG,CAAA;MACF+B,QAAQ,CAACI,IAAI,CAAC,GAAGF,KAAK,CAAC;IACzB;IAAC;IAAApC,cAAA,GAAAG,CAAA;IAED,OAAO+B,QAAQ,CAACK,IAAI,CAClB,CAACC,CAAC,EAAElB,CAAC,KACH;MAAA;MAAAtB,cAAA,GAAAa,CAAA;MAAAb,cAAA,GAAAG,CAAA;MAAA,WAAIsB,IAAI,CAACe,CAAC,CAACC,SAAS,CAAC,CAACC,OAAO,EAAE,GAAG,IAAIjB,IAAI,CAACH,CAAC,CAACmB,SAAS,CAAC,CAACC,OAAO,EAAE;IAAF,CAAE,CACpE;EACH;EAEQd,mBAAmBA,CAACR,IAAU,EAAEC,MAA4B;IAAA;IAAArB,cAAA,GAAAa,CAAA;IAClE,MAAM8B,GAAG;IAAA;IAAA,CAAA3C,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,EAAE;IACtB,MAAMmB,OAAO;IAAA;IAAA,CAAA5C,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CACtBkB,GAAG,CAACD,OAAO,EAAE,GAAGrB,MAAM,CAACX,iBAAiB,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAC/D;IACD,MAAMmC,OAAO;IAAA;IAAA,CAAA7C,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CACtBkB,GAAG,CAACD,OAAO,EAAE,GAAGrB,MAAM,CAACV,iBAAiB,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAC1D;IAAC;IAAAX,cAAA,GAAAG,CAAA;IAEF,IAAIiB,IAAI,GAAGyB,OAAO,EAAE;MAAA;MAAA7C,cAAA,GAAAsB,CAAA;MAAAtB,cAAA,GAAAG,CAAA;MAClB,MAAM,IAAID,QAAA,CAAA4C,mBAAmB,CAC3B,kCAAkCzB,MAAM,CAACV,iBAAiB,mBAAmB,CAC9E;IACH,CAAC;IAAA;IAAA;MAAAX,cAAA,GAAAsB,CAAA;IAAA;IAAAtB,cAAA,GAAAG,CAAA;IAED,IAAIiB,IAAI,GAAGwB,OAAO,EAAE;MAAA;MAAA5C,cAAA,GAAAsB,CAAA;MAAAtB,cAAA,GAAAG,CAAA;MAClB,MAAM,IAAID,QAAA,CAAA4C,mBAAmB,CAC3B,mCAAmCzB,MAAM,CAACX,iBAAiB,kBAAkB,CAC9E;IACH,CAAC;IAAA;IAAA;MAAAV,cAAA,GAAAsB,CAAA;IAAA;EACH;EAEQ,MAAMQ,wBAAwBA,CACpCX,WAAmB,EACnBO,SAAiB;IAAA;IAAA1B,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAG,CAAA;IAEjB,OAAO,IAAI,CAACI,MAAM,CAACwC,qBAAqB,CAACC,QAAQ,CAAC;MAChDC,KAAK,EAAE;QACL9B,WAAW;QACXO,SAAS,EAAEA,SAAS,CAACwB,QAAQ,EAAE;QAC/BC,WAAW,EAAE;OACd;MACDC,OAAO,EAAE;QAAEX,SAAS,EAAE;MAAK;KAC5B,CAAC;EACJ;EAEQ,MAAMR,mBAAmBA,CAACd,WAAmB,EAAEC,IAAU;IAAA;IAAApB,cAAA,GAAAa,CAAA;IAC/D,MAAMwC,UAAU;IAAA;IAAA,CAAArD,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAACL,IAAI,CAAC;IAAC;IAAApB,cAAA,GAAAG,CAAA;IAClCkD,UAAU,CAACC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IAC/B,MAAMC,QAAQ;IAAA;IAAA,CAAAvD,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAACL,IAAI,CAAC;IAAC;IAAApB,cAAA,GAAAG,CAAA;IAChCoD,QAAQ,CAACD,QAAQ,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC;IAAC;IAAAtD,cAAA,GAAAG,CAAA;IAEnC,OAAO,IAAI,CAACI,MAAM,CAACiD,OAAO,CAACR,QAAQ,CAAC;MAClCC,KAAK,EAAE;QACL9B,WAAW;QACXsB,SAAS,EAAE;UAAEgB,GAAG,EAAEJ,UAAU;UAAEK,GAAG,EAAEH;QAAQ,CAAE;QAC7CI,MAAM,EAAE;UAAEC,EAAE,EAAE,CAAC,WAAW,EAAE,WAAW;QAAC;OACzC;MACDR,OAAO,EAAE;QAAEX,SAAS,EAAE;MAAK;KAC5B,CAAC;EACJ;EAEQJ,kCAAkCA,CACxCjB,IAAU,EACVS,YAAiB,EACjBG,gBAAuB,EACvBX,MAA4B;IAAA;IAAArB,cAAA,GAAAa,CAAA;IAE5B,MAAMuB,KAAK;IAAA;IAAA,CAAApC,cAAA,GAAAG,CAAA,QAAe,EAAE;IAC5B,MAAM0D,SAAS;IAAA;IAAA,CAAA7D,cAAA,GAAAG,CAAA,QAAG,IAAI,CAACW,YAAY,EAAE;IAErC,MAAM2B,SAAS;IAAA;IAAA,CAAAzC,cAAA,GAAAG,CAAA,QAAG,IAAI,CAAC2D,cAAc,CAAC1C,IAAI,EAAES,YAAY,CAACY,SAAS,CAAC;IACnE,MAAMsB,OAAO;IAAA;IAAA,CAAA/D,cAAA,GAAAG,CAAA,QAAG,IAAI,CAAC2D,cAAc,CAAC1C,IAAI,EAAES,YAAY,CAACkC,OAAO,CAAC;IAE/D,IAAIC,WAAW;IAAA;IAAA,CAAAhE,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAACgB,SAAS,CAAC;IAAC;IAAAzC,cAAA,GAAAG,CAAA;IAEtC,OAAO6D,WAAW,GAAGD,OAAO,EAAE;MAC5B,MAAME,OAAO;MAAA;MAAA,CAAAjE,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CACtBuC,WAAW,CAACtB,OAAO,EAAE,GAAGrB,MAAM,CAACZ,YAAY,GAAG,KAAK,CACpD;MAAC;MAAAT,cAAA,GAAAG,CAAA;MAEF,IAAI8D,OAAO,IAAIF,OAAO,EAAE;QAAA;QAAA/D,cAAA,GAAAsB,CAAA;QAAAtB,cAAA,GAAAG,CAAA;QACtB;QACA,IACE,CAAC,IAAI,CAAC+D,uBAAuB,CAACF,WAAW,EAAEC,OAAO,EAAEjC,gBAAgB,CAAC,EACrE;UAAA;UAAAhC,cAAA,GAAAsB,CAAA;UACA;UACA,MAAM6C,kBAAkB;UAAA;UAAA,CAAAnE,cAAA,GAAAG,CAAA,QAAG,IAAI,CAACiE,qBAAqB,CACnDJ,WAAW,EACXD,OAAO,EACP/B,gBAAgB,EAChB6B,SAAS,CACV;UAAC;UAAA7D,cAAA,GAAAG,CAAA;UAEF,IAAIgE,kBAAkB,CAACpC,MAAM,GAAG,CAAC,EAAE;YAAA;YAAA/B,cAAA,GAAAsB,CAAA;YAAAtB,cAAA,GAAAG,CAAA;YACjCiC,KAAK,CAACE,IAAI,CAAC;cACTG,SAAS,EAAEuB,WAAW,CAACK,WAAW,EAAE;cACpCF;aACD,CAAC;UACJ,CAAC;UAAA;UAAA;YAAAnE,cAAA,GAAAsB,CAAA;UAAA;QACH,CAAC;QAAA;QAAA;UAAAtB,cAAA,GAAAsB,CAAA;QAAA;MACH,CAAC;MAAA;MAAA;QAAAtB,cAAA,GAAAsB,CAAA;MAAA;MAAAtB,cAAA,GAAAG,CAAA;MAED6D,WAAW,GAAG,IAAIvC,IAAI,CACpBuC,WAAW,CAACtB,OAAO,EAAE,GAAGrB,MAAM,CAACZ,YAAY,GAAG,KAAK,CACpD;IACH;IAAC;IAAAT,cAAA,GAAAG,CAAA;IAED,OAAOiC,KAAK;EACd;EAEQ0B,cAAcA,CAAC1C,IAAU,EAAEkD,UAAkB;IAAA;IAAAtE,cAAA,GAAAa,CAAA;IACnD,MAAM,CAAC0D,KAAK,EAAEC,OAAO,CAAC;IAAA;IAAA,CAAAxE,cAAA,GAAAG,CAAA,QAAGmE,UAAU,CAACG,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAACC,MAAM,CAAC;IAC1D,MAAMC,QAAQ;IAAA;IAAA,CAAA5E,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAACL,IAAI,CAAC;IAAC;IAAApB,cAAA,GAAAG,CAAA;IAChCyE,QAAQ,CAACtB,QAAQ,CAACiB,KAAK,EAAEC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC;IAAC;IAAAxE,cAAA,GAAAG,CAAA;IACxC,OAAOyE,QAAQ;EACjB;EAEQV,uBAAuBA,CAC7BW,SAAe,EACfZ,OAAa,EACba,QAAe;IAAA;IAAA9E,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAG,CAAA;IAEf,OAAO2E,QAAQ,CAACC,IAAI,CAAEC,OAAO,IAAI;MAAA;MAAAhF,cAAA,GAAAa,CAAA;MAC/B,MAAMoE,UAAU;MAAA;MAAA,CAAAjF,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CACzBuD,OAAO,CAACvC,SAAS,CAACC,OAAO,EAAE,GAAGsC,OAAO,CAAC/D,QAAQ,GAAG,KAAK,CACvD;MAAC;MAAAjB,cAAA,GAAAG,CAAA;MACF,OAAO,IAAI,CAAC+E,cAAc,CACxBL,SAAS,EACTZ,OAAO,EACPe,OAAO,CAACvC,SAAS,EACjBwC,UAAU,CACX;IACH,CAAC,CAAC;EACJ;EAEQb,qBAAqBA,CAC3BS,SAAe,EACfM,eAAqB,EACrBnD,gBAAuB,EACvB6B,SAAgB;IAAA;IAAA7D,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAG,CAAA;IAEhB,OAAO0D,SAAS,CAACuB,MAAM,CAAEnE,QAAQ,IAAI;MAAA;MAAAjB,cAAA,GAAAa,CAAA;MACnC,MAAMwE,WAAW;MAAA;MAAA,CAAArF,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAC1BoD,SAAS,CAACnC,OAAO,EAAE,GAAGzB,QAAQ,CAACA,QAAQ,GAAG,KAAK,CAChD;MAED;MAAA;MAAAjB,cAAA,GAAAG,CAAA;MACA,IAAIkF,WAAW,GAAGF,eAAe,EAAE;QAAA;QAAAnF,cAAA,GAAAsB,CAAA;QAAAtB,cAAA,GAAAG,CAAA;QACjC,OAAO,KAAK;MACd,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAsB,CAAA;MAAA;MAED;MAAAtB,cAAA,GAAAG,CAAA;MACA,OAAO,CAAC,IAAI,CAAC+D,uBAAuB,CAClCW,SAAS,EACTQ,WAAW,EACXrD,gBAAgB,CACjB;IACH,CAAC,CAAC;EACJ;EAEQkD,cAAcA,CACpBI,MAAY,EACZC,IAAU,EACVC,MAAY,EACZC,IAAU;IAAA;IAAAzF,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAG,CAAA;IAEV,OAAO,2BAAAH,cAAA,GAAAsB,CAAA,WAAAgE,MAAM,GAAGG,IAAI;IAAA;IAAA,CAAAzF,cAAA,GAAAsB,CAAA,WAAIiE,IAAI,GAAGC,MAAM;EACvC;EAEA;;;EAGA,MAAME,eAAeA,CACnBvE,WAAmB,EACnBsB,SAAe,EACfxB,QAAgB;IAAA;IAAAjB,cAAA,GAAAa,CAAA;IAEhB,MAAMkD,OAAO;IAAA;IAAA,CAAA/D,cAAA,GAAAG,CAAA,QAAG,IAAIsB,IAAI,CAACgB,SAAS,CAACC,OAAO,EAAE,GAAGzB,QAAQ,GAAG,KAAK,CAAC;IAChE,MAAMS,SAAS;IAAA;IAAA,CAAA1B,cAAA,GAAAG,CAAA,QAAGsC,SAAS,CAACd,MAAM,EAAE;IAEpC;IACA,MAAME,YAAY;IAAA;IAAA,CAAA7B,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACI,MAAM,CAACwC,qBAAqB,CAAC4C,SAAS,CAAC;MACrE1C,KAAK,EAAE;QACL9B,WAAW;QACXO,SAAS,EAAEA,SAAS,CAACwB,QAAQ,EAAE;QAC/BC,WAAW,EAAE;;KAEhB,CAAC;IAAC;IAAAnD,cAAA,GAAAG,CAAA;IAEH,IAAI,CAAC0B,YAAY,EAAE;MAAA;MAAA7B,cAAA,GAAAsB,CAAA;MAAAtB,cAAA,GAAAG,CAAA;MACjB,OAAO,KAAK;IACd,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAsB,CAAA;IAAA;IAED;IACA,MAAMsE,UAAU;IAAA;IAAA,CAAA5F,cAAA,GAAAG,CAAA,QAAG,IAAI,CAAC2D,cAAc,CAACrB,SAAS,EAAEZ,YAAY,CAACY,SAAS,CAAC;IACzE,MAAMoD,QAAQ;IAAA;IAAA,CAAA7F,cAAA,GAAAG,CAAA,QAAG,IAAI,CAAC2D,cAAc,CAACrB,SAAS,EAAEZ,YAAY,CAACkC,OAAO,CAAC;IAAC;IAAA/D,cAAA,GAAAG,CAAA;IAEtE;IAAI;IAAA,CAAAH,cAAA,GAAAsB,CAAA,WAAAmB,SAAS,GAAGmD,UAAU;IAAA;IAAA,CAAA5F,cAAA,GAAAsB,CAAA,WAAIyC,OAAO,GAAG8B,QAAQ,GAAE;MAAA;MAAA7F,cAAA,GAAAsB,CAAA;MAAAtB,cAAA,GAAAG,CAAA;MAChD,OAAO,KAAK;IACd,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAsB,CAAA;IAAA;IAED;IACA,MAAMU,gBAAgB;IAAA;IAAA,CAAAhC,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAAC8B,mBAAmB,CACrDd,WAAW,EACXsB,SAAS,CACV;IAAC;IAAAzC,cAAA,GAAAG,CAAA;IAEF,OAAO,CAAC,IAAI,CAAC+D,uBAAuB,CAACzB,SAAS,EAAEsB,OAAO,EAAE/B,gBAAgB,CAAC;EAC5E;CACD;AAAA;AAAAhC,cAAA,GAAAG,CAAA;AA1QY2F,OAAA,CAAAxF,oBAAA,GAAAA,oBAAA;AAAoB;AAAAN,cAAA,GAAAG,CAAA;+BAApBG,oBAAoB,GAAAyF,UAAA,EADhC,IAAA7F,QAAA,CAAA8F,UAAU,GAAE,E;;qCAQ0B3F,wBAAA,CAAA4F,aAAa;AAAA;AAAA,CAAAjG,cAAA,GAAAsB,CAAA,WAAbjB,wBAAA,CAAA4F,aAAa;AAAA;AAAA,CAAAjG,cAAA,GAAAsB,CAAA,WAAA4E,EAAA;AAAA;AAAA,CAAAlG,cAAA,GAAAsB,CAAA,WAAA6E,MAAA,I,EAPvC7F,oBAAoB,CA0QhC","ignoreList":[]}