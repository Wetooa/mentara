afc1e7827e1f35a0775d41a65163c4b0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const websocket_auth_service_1 = require("./websocket-auth.service");
const jwt_1 = require("@nestjs/jwt");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const common_1 = require("@nestjs/common");
describe('WebSocketAuthService', () => {
    let service;
    let jwtService;
    let prismaService;
    let mockSocket;
    const mockUser = {
        id: 'user-123',
        role: 'client',
        emailVerified: true,
        lockoutUntil: null,
        failedLoginCount: 0,
    };
    const mockJwtPayload = {
        sub: 'user-123',
        email: 'user@example.com',
        iat: Math.floor(Date.now() / 1000) - 3600, // 1 hour ago
        exp: Math.floor(Date.now() / 1000) + 3600, // 1 hour from now
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                websocket_auth_service_1.WebSocketAuthService,
                {
                    provide: jwt_1.JwtService,
                    useValue: {
                        verify: jest.fn(),
                    },
                },
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: {
                        user: {
                            findUnique: jest.fn(),
                        },
                    },
                },
            ],
        }).compile();
        service = module.get(websocket_auth_service_1.WebSocketAuthService);
        jwtService = module.get(jwt_1.JwtService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        // Mock socket with default properties
        mockSocket = {
            id: 'socket-123',
            handshake: {
                headers: {
                    authorization: 'Bearer valid-token',
                },
                auth: {},
                query: {},
                address: '127.0.0.1',
            },
            conn: {
                remoteAddress: '127.0.0.1',
            },
        };
        // Clear any existing intervals
        jest.clearAllTimers();
        jest.useFakeTimers();
    });
    afterEach(() => {
        jest.clearAllMocks();
        jest.clearAllTimers();
        jest.useRealTimers();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('authenticateSocket', () => {
        beforeEach(() => {
            jwtService.verify.mockReturnValue(mockJwtPayload);
            prismaService.user.findUnique.mockResolvedValue(mockUser);
        });
        it('should authenticate socket successfully', async () => {
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toEqual({
                userId: 'user-123',
                role: 'client',
                lastAuthenticated: expect.any(Date),
                connectionCount: 1,
            });
            expect(jwtService.verify).toHaveBeenCalledWith('valid-token', {
                algorithms: ['HS256'],
            });
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: {
                    id: 'user-123',
                    deactivatedAt: null,
                    isActive: true,
                },
                select: {
                    id: true,
                    role: true,
                    emailVerified: true,
                    lockoutUntil: true,
                    failedLoginCount: true,
                },
            });
        });
        it('should return null when no token is provided', async () => {
            mockSocket.handshake.headers = {};
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(jwtService.verify).not.toHaveBeenCalled();
        });
        it('should return null when token verification fails', async () => {
            jwtService.verify.mockImplementation(() => {
                throw new Error('Invalid token');
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(prismaService.user.findUnique).not.toHaveBeenCalled();
        });
        it('should return null when token payload is invalid', async () => {
            jwtService.verify.mockReturnValue({
                sub: null,
                email: null,
                iat: Date.now() / 1000,
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(prismaService.user.findUnique).not.toHaveBeenCalled();
        });
        it('should return null when token is stale', async () => {
            jwtService.verify.mockReturnValue({
                sub: 'user-123',
                email: 'user@example.com',
                iat: Math.floor(Date.now() / 1000) - 25 * 60 * 60, // 25 hours ago
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(prismaService.user.findUnique).not.toHaveBeenCalled();
        });
        it('should return null when user is not found', async () => {
            prismaService.user.findUnique.mockResolvedValue(null);
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
        });
        it('should return null when user account is locked', async () => {
            const lockedUser = {
                ...mockUser,
                lockoutUntil: new Date(Date.now() + 60 * 60 * 1000), // 1 hour from now
            };
            prismaService.user.findUnique.mockResolvedValue(lockedUser);
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
        });
        it('should allow connection when lockout period has expired', async () => {
            const unlockedUser = {
                ...mockUser,
                lockoutUntil: new Date(Date.now() - 60 * 60 * 1000), // 1 hour ago
            };
            prismaService.user.findUnique.mockResolvedValue(unlockedUser);
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toEqual({
                userId: 'user-123',
                role: 'client',
                lastAuthenticated: expect.any(Date),
                connectionCount: 1,
            });
        });
        it('should return null when connection limit is exceeded', async () => {
            // First, create max allowed connections
            const maxConnections = 5;
            for (let i = 0; i < maxConnections; i++) {
                const socketId = `socket-${i}`;
                await service.authenticateSocket({
                    ...mockSocket,
                    id: socketId,
                });
            }
            // Try to create one more connection (should fail)
            const result = await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-overflow',
            });
            expect(result).toBeNull();
        });
        it('should handle database errors gracefully', async () => {
            prismaService.user.findUnique.mockRejectedValue(new Error('Database error'));
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
        });
        it('should log successful authentication', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            await service.authenticateSocket(mockSocket);
            expect(loggerSpy).toHaveBeenCalledWith('Socket socket-123 authenticated as user user-123 with role client (1 connections)');
        });
        it('should log authentication failures', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'warn');
            mockSocket.handshake.headers = {}; // No token
            await service.authenticateSocket(mockSocket);
            expect(loggerSpy).toHaveBeenCalledWith('Socket socket-123 connected without valid token');
        });
    });
    describe('Token Extraction', () => {
        it('should extract token from Authorization header', async () => {
            mockSocket.handshake.headers = {
                authorization: 'Bearer test-token',
            };
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('test-token', {
                algorithms: ['HS256'],
            });
        });
        it('should extract token from auth object', async () => {
            mockSocket.handshake.headers = {};
            mockSocket.handshake.auth = { token: 'auth-token' };
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('auth-token', {
                algorithms: ['HS256'],
            });
        });
        it('should extract token from query parameters', async () => {
            mockSocket.handshake.headers = {};
            mockSocket.handshake.auth = {};
            mockSocket.handshake.query = { token: 'query-token' };
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('query-token', {
                algorithms: ['HS256'],
            });
        });
        it('should extract token from cookies', async () => {
            mockSocket.handshake.headers = {
                cookie: '__session=cookie-token; other=value',
            };
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('cookie-token', {
                algorithms: ['HS256'],
            });
        });
        it('should handle malformed Authorization header', async () => {
            mockSocket.handshake.headers = {
                authorization: 'Invalid header format',
            };
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(jwtService.verify).not.toHaveBeenCalled();
        });
        it('should handle empty Bearer token', async () => {
            mockSocket.handshake.headers = {
                authorization: 'Bearer ',
            };
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(jwtService.verify).not.toHaveBeenCalled();
        });
        it('should handle complex cookie parsing', async () => {
            mockSocket.handshake.headers = {
                cookie: 'first=value1; __session=session-token; last=value2; __session=duplicate',
            };
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('session-token', {
                algorithms: ['HS256'],
            });
        });
        it('should handle URL encoded cookies', async () => {
            mockSocket.handshake.headers = {
                cookie: '__session=encoded%20token%20value',
            };
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('encoded token value', {
                algorithms: ['HS256'],
            });
        });
        it('should handle cookie parsing errors gracefully', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'warn');
            mockSocket.handshake.headers = {
                cookie: '__session=%invalid%encoding',
            };
            // Mock decodeURIComponent to throw an error
            const originalDecodeURIComponent = global.decodeURIComponent;
            global.decodeURIComponent = jest.fn(() => {
                throw new Error('Invalid encoding');
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(loggerSpy).toHaveBeenCalledWith('Failed to extract cookie value for __session:', expect.any(Error));
            // Restore original function
            global.decodeURIComponent = originalDecodeURIComponent;
        });
    });
    describe('Rate Limiting', () => {
        it('should allow connections within rate limit', async () => {
            const ipAddress = '192.168.1.1';
            mockSocket.handshake.headers = {
                'x-forwarded-for': ipAddress,
                authorization: 'Bearer valid-token',
            };
            // Make 5 connections (within limit of 10)
            for (let i = 0; i < 5; i++) {
                await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                });
            }
            // Should still allow connection
            const result = await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-final',
            });
            expect(result).toEqual({
                userId: 'user-123',
                role: 'client',
                lastAuthenticated: expect.any(Date),
                connectionCount: 6,
            });
        });
        it('should block connections exceeding rate limit', async () => {
            const ipAddress = '192.168.1.2';
            mockSocket.handshake.headers = {
                'x-forwarded-for': ipAddress,
                authorization: 'Bearer valid-token',
            };
            // Make 10 failed connections (at the limit)
            jwtService.verify.mockImplementation(() => {
                throw new Error('Invalid token');
            });
            for (let i = 0; i < 10; i++) {
                await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                });
            }
            // Reset JWT service to return valid token
            jwtService.verify.mockReturnValue(mockJwtPayload);
            // Should be blocked due to rate limit
            const result = await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-blocked',
            });
            expect(result).toBeNull();
        });
        it('should reset rate limit after time window', async () => {
            const ipAddress = '192.168.1.3';
            mockSocket.handshake.headers = {
                'x-forwarded-for': ipAddress,
                authorization: 'Bearer valid-token',
            };
            // Make 10 failed connections to hit rate limit
            jwtService.verify.mockImplementation(() => {
                throw new Error('Invalid token');
            });
            for (let i = 0; i < 10; i++) {
                await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                });
            }
            // Advance time by 1 minute and 1 second
            jest.advanceTimersByTime(61 * 1000);
            // Reset JWT service
            jwtService.verify.mockReturnValue(mockJwtPayload);
            // Should now allow connection
            const result = await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-after-reset',
            });
            expect(result).toEqual({
                userId: 'user-123',
                role: 'client',
                lastAuthenticated: expect.any(Date),
                connectionCount: 1,
            });
        });
        it('should extract IP from various headers', async () => {
            const testCases = [
                { header: 'x-forwarded-for', value: '203.0.113.195' },
                { header: 'x-real-ip', value: '203.0.113.196' },
            ];
            for (const testCase of testCases) {
                mockSocket.handshake.headers = {
                    [testCase.header]: testCase.value,
                    authorization: 'Bearer valid-token',
                };
                await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${testCase.header}`,
                });
                // Should use the IP from header
                expect(jwtService.verify).toHaveBeenCalled();
            }
        });
        it('should use fallback IP when headers are not available', async () => {
            mockSocket.handshake.headers = {
                authorization: 'Bearer valid-token',
            };
            mockSocket.handshake.address = '10.0.0.1';
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalled();
        });
        it('should handle unknown IP addresses', async () => {
            mockSocket.handshake.headers = {
                authorization: 'Bearer valid-token',
            };
            mockSocket.handshake.address = undefined;
            mockSocket.conn.remoteAddress = undefined;
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalled();
        });
    });
    describe('validateToken', () => {
        it('should validate a valid token', async () => {
            jwtService.verify.mockReturnValue(mockJwtPayload);
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            const result = await service.validateToken('valid-token');
            expect(result).toBe(true);
            expect(jwtService.verify).toHaveBeenCalledWith('valid-token');
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: {
                    id: 'user-123',
                    deactivatedAt: null,
                },
                select: { id: true },
            });
        });
        it('should reject invalid token', async () => {
            jwtService.verify.mockImplementation(() => {
                throw new Error('Invalid token');
            });
            const result = await service.validateToken('invalid-token');
            expect(result).toBe(false);
            expect(prismaService.user.findUnique).not.toHaveBeenCalled();
        });
        it('should reject token for non-existent user', async () => {
            jwtService.verify.mockReturnValue(mockJwtPayload);
            prismaService.user.findUnique.mockResolvedValue(null);
            const result = await service.validateToken('valid-token');
            expect(result).toBe(false);
        });
        it('should log validation warnings', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'warn');
            jwtService.verify.mockImplementation(() => {
                throw new Error('Token expired');
            });
            await service.validateToken('expired-token');
            expect(loggerSpy).toHaveBeenCalledWith('Token validation failed:', expect.any(Error));
        });
    });
    describe('Connection Management', () => {
        it('should track multiple connections per user', async () => {
            // Create multiple connections for the same user
            for (let i = 0; i < 3; i++) {
                const result = await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                });
                expect(result?.connectionCount).toBe(i + 1);
            }
        });
        it('should clean up connection when socket disconnects', async () => {
            const socketId = 'socket-cleanup';
            await service.authenticateSocket({
                ...mockSocket,
                id: socketId,
            });
            service.cleanupConnection(socketId);
            // Create another connection, should reset count
            const result = await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-new',
            });
            expect(result?.connectionCount).toBe(1);
        });
        it('should handle cleanup of non-existent connection', () => {
            // Should not throw error
            expect(() => service.cleanupConnection('non-existent')).not.toThrow();
        });
    });
    describe('Connection Statistics', () => {
        it('should return accurate connection statistics', async () => {
            // Create connections for different users
            for (let i = 0; i < 3; i++) {
                jwtService.verify.mockReturnValue({
                    ...mockJwtPayload,
                    sub: `user-${i}`,
                });
                prismaService.user.findUnique.mockResolvedValue({
                    ...mockUser,
                    id: `user-${i}`,
                });
                await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                });
            }
            const stats = service.getConnectionStats();
            expect(stats).toEqual({
                totalConnections: 3,
                uniqueUsers: 3,
                trackedIps: 1, // All connections from same IP
                maxConnectionsPerUser: 5,
                maxAttemptsPerMinute: 10,
            });
        });
        it('should count unique users correctly', async () => {
            // Create multiple connections for same user
            for (let i = 0; i < 3; i++) {
                await service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                });
            }
            const stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(3);
            expect(stats.uniqueUsers).toBe(1);
        });
    });
    describe('Cleanup and Maintenance', () => {
        it('should clean up connection tracking periodically', () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
            // Trigger the cleanup interval
            jest.advanceTimersByTime(5 * 60 * 1000); // 5 minutes
            expect(loggerSpy).toHaveBeenCalledWith('Cleaned up connection tracking data');
        });
        it('should remove old connection attempts during cleanup', async () => {
            const ipAddress = '192.168.1.100';
            mockSocket.handshake.headers = {
                'x-forwarded-for': ipAddress,
                authorization: 'Bearer invalid-token',
            };
            // Create some failed attempts
            jwtService.verify.mockImplementation(() => {
                throw new Error('Invalid token');
            });
            await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-old',
            });
            // Advance time by more than 1 hour
            jest.advanceTimersByTime(61 * 60 * 1000);
            // Trigger cleanup
            jest.advanceTimersByTime(5 * 60 * 1000);
            // Reset JWT service
            jwtService.verify.mockReturnValue(mockJwtPayload);
            // Should not be rate limited anymore
            const result = await service.authenticateSocket({
                ...mockSocket,
                id: 'socket-new',
            });
            expect(result).toEqual({
                userId: 'user-123',
                role: 'client',
                lastAuthenticated: expect.any(Date),
                connectionCount: 1,
            });
        });
    });
    describe('Error Handling and Edge Cases', () => {
        it('should handle JWT verification errors gracefully', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            jwtService.verify.mockImplementation(() => {
                throw new Error('Token parsing failed');
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(loggerSpy).toHaveBeenCalledWith('Socket socket-123 authentication failed:', 'Token parsing failed');
        });
        it('should handle non-Error exceptions', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            jwtService.verify.mockImplementation(() => {
                throw 'String error';
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(loggerSpy).toHaveBeenCalledWith('Socket socket-123 authentication failed:', 'String error');
        });
        it('should handle missing socket properties', async () => {
            const malformedSocket = {
                id: 'socket-malformed',
                handshake: {
                    headers: {},
                    auth: {},
                    query: {},
                },
            };
            const result = await service.authenticateSocket(malformedSocket);
            expect(result).toBeNull();
        });
        it('should handle arrays in token sources', async () => {
            mockSocket.handshake.query = { token: ['token1', 'token2'] };
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
            expect(jwtService.verify).not.toHaveBeenCalled();
        });
    });
    describe('Security Features', () => {
        it('should enforce algorithm restriction', async () => {
            await service.authenticateSocket(mockSocket);
            expect(jwtService.verify).toHaveBeenCalledWith('valid-token', {
                algorithms: ['HS256'],
            });
        });
        it('should check for required payload fields', async () => {
            jwtService.verify.mockReturnValue({
                sub: 'user-123',
                // Missing email field
                iat: Date.now() / 1000,
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
        });
        it('should validate token freshness', async () => {
            jwtService.verify.mockReturnValue({
                sub: 'user-123',
                email: 'user@example.com',
                iat: Math.floor(Date.now() / 1000) - 25 * 60 * 60, // 25 hours ago
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
        });
        it('should check user active status', async () => {
            prismaService.user.findUnique.mockResolvedValue({
                ...mockUser,
                deactivatedAt: new Date(),
            });
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toBeNull();
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete authentication flow', async () => {
            const result = await service.authenticateSocket(mockSocket);
            expect(result).toEqual({
                userId: 'user-123',
                role: 'client',
                lastAuthenticated: expect.any(Date),
                connectionCount: 1,
            });
            const stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            expect(stats.uniqueUsers).toBe(1);
            service.cleanupConnection('socket-123');
            const statsAfterCleanup = service.getConnectionStats();
            expect(statsAfterCleanup.totalConnections).toBe(0);
        });
        it('should handle multiple concurrent authentication attempts', async () => {
            const promises = [];
            for (let i = 0; i < 3; i++) {
                promises.push(service.authenticateSocket({
                    ...mockSocket,
                    id: `socket-${i}`,
                }));
            }
            const results = await Promise.all(promises);
            expect(results.every(result => result !== null)).toBe(true);
            expect(results.map(r => r?.connectionCount)).toEqual([1, 2, 3]);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9zZXJ2aWNlcy93ZWJzb2NrZXQtYXV0aC5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQscUVBQW1GO0FBQ25GLHFDQUF5QztBQUN6QyxtRkFBdUU7QUFFdkUsMkNBQXdDO0FBRXhDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsSUFBSSxPQUE2QixDQUFDO0lBQ2xDLElBQUksVUFBbUMsQ0FBQztJQUN4QyxJQUFJLGFBQXlDLENBQUM7SUFDOUMsSUFBSSxVQUEyQixDQUFDO0lBRWhDLE1BQU0sUUFBUSxHQUFHO1FBQ2YsRUFBRSxFQUFFLFVBQVU7UUFDZCxJQUFJLEVBQUUsUUFBUTtRQUNkLGFBQWEsRUFBRSxJQUFJO1FBQ25CLFlBQVksRUFBRSxJQUFJO1FBQ2xCLGdCQUFnQixFQUFFLENBQUM7S0FDcEIsQ0FBQztJQUVGLE1BQU0sY0FBYyxHQUFHO1FBQ3JCLEdBQUcsRUFBRSxVQUFVO1FBQ2YsS0FBSyxFQUFFLGtCQUFrQjtRQUN6QixHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsSUFBSSxFQUFFLGFBQWE7UUFDeEQsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksRUFBRSxrQkFBa0I7S0FDOUQsQ0FBQztJQUVGLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFO2dCQUNULDZDQUFvQjtnQkFDcEI7b0JBQ0UsT0FBTyxFQUFFLGdCQUFVO29CQUNuQixRQUFRLEVBQUU7d0JBQ1IsTUFBTSxFQUFFLElBQUksQ0FBQyxF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QUMsQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9zZXJ2aWNlcy93ZWJzb2NrZXQtYXV0aC5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBXZWJTb2NrZXRBdXRoU2VydmljZSwgQXV0aGVudGljYXRlZFVzZXIgfSBmcm9tICcuL3dlYnNvY2tldC1hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgSnd0U2VydmljZSB9IGZyb20gJ0BuZXN0anMvand0JztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi8uLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBTb2NrZXQgfSBmcm9tICdzb2NrZXQuaW8nO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuXG5kZXNjcmliZSgnV2ViU29ja2V0QXV0aFNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBXZWJTb2NrZXRBdXRoU2VydmljZTtcbiAgbGV0IGp3dFNlcnZpY2U6IGplc3QuTW9ja2VkPEp3dFNlcnZpY2U+O1xuICBsZXQgcHJpc21hU2VydmljZTogamVzdC5Nb2NrZWQ8UHJpc21hU2VydmljZT47XG4gIGxldCBtb2NrU29ja2V0OiBQYXJ0aWFsPFNvY2tldD47XG5cbiAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgaWQ6ICd1c2VyLTEyMycsXG4gICAgcm9sZTogJ2NsaWVudCcsXG4gICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICBsb2Nrb3V0VW50aWw6IG51bGwsXG4gICAgZmFpbGVkTG9naW5Db3VudDogMCxcbiAgfTtcblxuICBjb25zdCBtb2NrSnd0UGF5bG9hZCA9IHtcbiAgICBzdWI6ICd1c2VyLTEyMycsXG4gICAgZW1haWw6ICd1c2VyQGV4YW1wbGUuY29tJyxcbiAgICBpYXQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gMzYwMCwgLy8gMSBob3VyIGFnb1xuICAgIGV4cDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyAzNjAwLCAvLyAxIGhvdXIgZnJvbSBub3dcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIFdlYlNvY2tldEF1dGhTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogSnd0U2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZToge1xuICAgICAgICAgICAgdmVyaWZ5OiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFByaXNtYVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxXZWJTb2NrZXRBdXRoU2VydmljZT4oV2ViU29ja2V0QXV0aFNlcnZpY2UpO1xuICAgIGp3dFNlcnZpY2UgPSBtb2R1bGUuZ2V0KEp3dFNlcnZpY2UpO1xuICAgIHByaXNtYVNlcnZpY2UgPSBtb2R1bGUuZ2V0KFByaXNtYVNlcnZpY2UpO1xuXG4gICAgLy8gTW9jayBzb2NrZXQgd2l0aCBkZWZhdWx0IHByb3BlcnRpZXNcbiAgICBtb2NrU29ja2V0ID0ge1xuICAgICAgaWQ6ICdzb2NrZXQtMTIzJyxcbiAgICAgIGhhbmRzaGFrZToge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgYXV0aG9yaXphdGlvbjogJ0JlYXJlciB2YWxpZC10b2tlbicsXG4gICAgICAgIH0sXG4gICAgICAgIGF1dGg6IHt9LFxuICAgICAgICBxdWVyeToge30sXG4gICAgICAgIGFkZHJlc3M6ICcxMjcuMC4wLjEnLFxuICAgICAgfSxcbiAgICAgIGNvbm46IHtcbiAgICAgICAgcmVtb3RlQWRkcmVzczogJzEyNy4wLjAuMScsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgaW50ZXJ2YWxzXG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXV0aGVudGljYXRlU29ja2V0JywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja1JldHVyblZhbHVlKG1vY2tKd3RQYXlsb2FkKTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXV0aGVudGljYXRlIHNvY2tldCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICBsYXN0QXV0aGVudGljYXRlZDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgY29ubmVjdGlvbkNvdW50OiAxLFxuICAgICAgfSk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd2YWxpZC10b2tlbicsIHtcbiAgICAgICAgYWxnb3JpdGhtczogWydIUzI1NiddLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBkZWFjdGl2YXRlZEF0OiBudWxsLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgbG9ja291dFVudGlsOiB0cnVlLFxuICAgICAgICAgIGZhaWxlZExvZ2luQ291bnQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBubyB0b2tlbiBpcyBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge307XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiB0b2tlbiB2ZXJpZmljYXRpb24gZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBqd3RTZXJ2aWNlLnZlcmlmeS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdG9rZW4nKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gdG9rZW4gcGF5bG9hZCBpcyBpbnZhbGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc3ViOiBudWxsLFxuICAgICAgICBlbWFpbDogbnVsbCxcbiAgICAgICAgaWF0OiBEYXRlLm5vdygpIC8gMTAwMCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gdG9rZW4gaXMgc3RhbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBqd3RTZXJ2aWNlLnZlcmlmeS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzdWI6ICd1c2VyLTEyMycsXG4gICAgICAgIGVtYWlsOiAndXNlckBleGFtcGxlLmNvbScsXG4gICAgICAgIGlhdDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgLSAyNSAqIDYwICogNjAsIC8vIDI1IGhvdXJzIGFnb1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiB1c2VyIGlzIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gdXNlciBhY2NvdW50IGlzIGxvY2tlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxvY2tlZFVzZXIgPSB7XG4gICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICBsb2Nrb3V0VW50aWw6IG5ldyBEYXRlKERhdGUubm93KCkgKyA2MCAqIDYwICogMTAwMCksIC8vIDEgaG91ciBmcm9tIG5vd1xuICAgICAgfTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKGxvY2tlZFVzZXIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGNvbm5lY3Rpb24gd2hlbiBsb2Nrb3V0IHBlcmlvZCBoYXMgZXhwaXJlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVubG9ja2VkVXNlciA9IHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGxvY2tvdXRVbnRpbDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDYwICogNjAgKiAxMDAwKSwgLy8gMSBob3VyIGFnb1xuICAgICAgfTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKHVubG9ja2VkVXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIGxhc3RBdXRoZW50aWNhdGVkOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICBjb25uZWN0aW9uQ291bnQ6IDEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBjb25uZWN0aW9uIGxpbWl0IGlzIGV4Y2VlZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QsIGNyZWF0ZSBtYXggYWxsb3dlZCBjb25uZWN0aW9uc1xuICAgICAgY29uc3QgbWF4Q29ubmVjdGlvbnMgPSA1O1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhDb25uZWN0aW9uczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHNvY2tldElkID0gYHNvY2tldC0ke2l9YDtcbiAgICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgICAgaWQ6IHNvY2tldElkLFxuICAgICAgICB9IGFzIFNvY2tldCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRyeSB0byBjcmVhdGUgb25lIG1vcmUgY29ubmVjdGlvbiAoc2hvdWxkIGZhaWwpXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldCh7XG4gICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgIGlkOiAnc29ja2V0LW92ZXJmbG93JyxcbiAgICAgIH0gYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQobW9ja1NvY2tldCBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnU29ja2V0IHNvY2tldC0xMjMgYXV0aGVudGljYXRlZCBhcyB1c2VyIHVzZXItMTIzIHdpdGggcm9sZSBjbGllbnQgKDEgY29ubmVjdGlvbnMpJyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBhdXRoZW50aWNhdGlvbiBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ3dhcm4nKTtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge307IC8vIE5vIHRva2VuXG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdTb2NrZXQgc29ja2V0LTEyMyBjb25uZWN0ZWQgd2l0aG91dCB2YWxpZCB0b2tlbicsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVG9rZW4gRXh0cmFjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgdG9rZW4gZnJvbSBBdXRob3JpemF0aW9uIGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge1xuICAgICAgICBhdXRob3JpemF0aW9uOiAnQmVhcmVyIHRlc3QtdG9rZW4nLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQobW9ja1NvY2tldCBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0LXRva2VuJywge1xuICAgICAgICBhbGdvcml0aG1zOiBbJ0hTMjU2J10sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB0b2tlbiBmcm9tIGF1dGggb2JqZWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NvY2tldC5oYW5kc2hha2UhLmhlYWRlcnMgPSB7fTtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5hdXRoID0geyB0b2tlbjogJ2F1dGgtdG9rZW4nIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYXV0aC10b2tlbicsIHtcbiAgICAgICAgYWxnb3JpdGhtczogWydIUzI1NiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgdG9rZW4gZnJvbSBxdWVyeSBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NvY2tldC5oYW5kc2hha2UhLmhlYWRlcnMgPSB7fTtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5hdXRoID0ge307XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEucXVlcnkgPSB7IHRva2VuOiAncXVlcnktdG9rZW4nIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncXVlcnktdG9rZW4nLCB7XG4gICAgICAgIGFsZ29yaXRobXM6IFsnSFMyNTYnXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IHRva2VuIGZyb20gY29va2llcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge1xuICAgICAgICBjb29raWU6ICdfX3Nlc3Npb249Y29va2llLXRva2VuOyBvdGhlcj12YWx1ZScsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2Nvb2tpZS10b2tlbicsIHtcbiAgICAgICAgYWxnb3JpdGhtczogWydIUzI1NiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgQXV0aG9yaXphdGlvbiBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEuaGVhZGVycyA9IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogJ0ludmFsaWQgaGVhZGVyIGZvcm1hdCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBCZWFyZXIgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEuaGVhZGVycyA9IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogJ0JlYXJlciAnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQobW9ja1NvY2tldCBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBjb29raWUgcGFyc2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge1xuICAgICAgICBjb29raWU6ICdmaXJzdD12YWx1ZTE7IF9fc2Vzc2lvbj1zZXNzaW9uLXRva2VuOyBsYXN0PXZhbHVlMjsgX19zZXNzaW9uPWR1cGxpY2F0ZScsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Nlc3Npb24tdG9rZW4nLCB7XG4gICAgICAgIGFsZ29yaXRobXM6IFsnSFMyNTYnXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgVVJMIGVuY29kZWQgY29va2llcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge1xuICAgICAgICBjb29raWU6ICdfX3Nlc3Npb249ZW5jb2RlZCUyMHRva2VuJTIwdmFsdWUnLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQobW9ja1NvY2tldCBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdlbmNvZGVkIHRva2VuIHZhbHVlJywge1xuICAgICAgICBhbGdvcml0aG1zOiBbJ0hTMjU2J10sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvb2tpZSBwYXJzaW5nIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnd2FybicpO1xuICAgICAgbW9ja1NvY2tldC5oYW5kc2hha2UhLmhlYWRlcnMgPSB7XG4gICAgICAgIGNvb2tpZTogJ19fc2Vzc2lvbj0laW52YWxpZCVlbmNvZGluZycsXG4gICAgICB9O1xuXG4gICAgICAvLyBNb2NrIGRlY29kZVVSSUNvbXBvbmVudCB0byB0aHJvdyBhbiBlcnJvclxuICAgICAgY29uc3Qgb3JpZ2luYWxEZWNvZGVVUklDb21wb25lbnQgPSBnbG9iYWwuZGVjb2RlVVJJQ29tcG9uZW50O1xuICAgICAgZ2xvYmFsLmRlY29kZVVSSUNvbXBvbmVudCA9IGplc3QuZm4oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5jb2RpbmcnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0ZhaWxlZCB0byBleHRyYWN0IGNvb2tpZSB2YWx1ZSBmb3IgX19zZXNzaW9uOicsXG4gICAgICAgIGV4cGVjdC5hbnkoRXJyb3IpLFxuICAgICAgKTtcblxuICAgICAgLy8gUmVzdG9yZSBvcmlnaW5hbCBmdW5jdGlvblxuICAgICAgZ2xvYmFsLmRlY29kZVVSSUNvbXBvbmVudCA9IG9yaWdpbmFsRGVjb2RlVVJJQ29tcG9uZW50O1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmF0ZSBMaW1pdGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGNvbm5lY3Rpb25zIHdpdGhpbiByYXRlIGxpbWl0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXBBZGRyZXNzID0gJzE5Mi4xNjguMS4xJztcbiAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge1xuICAgICAgICAneC1mb3J3YXJkZWQtZm9yJzogaXBBZGRyZXNzLFxuICAgICAgICBhdXRob3JpemF0aW9uOiAnQmVhcmVyIHZhbGlkLXRva2VuJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIE1ha2UgNSBjb25uZWN0aW9ucyAod2l0aGluIGxpbWl0IG9mIDEwKVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgICAgaWQ6IGBzb2NrZXQtJHtpfWAsXG4gICAgICAgIH0gYXMgU29ja2V0KTtcbiAgICAgIH1cblxuICAgICAgLy8gU2hvdWxkIHN0aWxsIGFsbG93IGNvbm5lY3Rpb25cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KHtcbiAgICAgICAgLi4ubW9ja1NvY2tldCxcbiAgICAgICAgaWQ6ICdzb2NrZXQtZmluYWwnLFxuICAgICAgfSBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgbGFzdEF1dGhlbnRpY2F0ZWQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIGNvbm5lY3Rpb25Db3VudDogNixcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBibG9jayBjb25uZWN0aW9ucyBleGNlZWRpbmcgcmF0ZSBsaW1pdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGlwQWRkcmVzcyA9ICcxOTIuMTY4LjEuMic7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEuaGVhZGVycyA9IHtcbiAgICAgICAgJ3gtZm9yd2FyZGVkLWZvcic6IGlwQWRkcmVzcyxcbiAgICAgICAgYXV0aG9yaXphdGlvbjogJ0JlYXJlciB2YWxpZC10b2tlbicsXG4gICAgICB9O1xuXG4gICAgICAvLyBNYWtlIDEwIGZhaWxlZCBjb25uZWN0aW9ucyAoYXQgdGhlIGxpbWl0KVxuICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRva2VuJyk7XG4gICAgICB9KTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgIGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KHtcbiAgICAgICAgICAuLi5tb2NrU29ja2V0LFxuICAgICAgICAgIGlkOiBgc29ja2V0LSR7aX1gLFxuICAgICAgICB9IGFzIFNvY2tldCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2V0IEpXVCBzZXJ2aWNlIHRvIHJldHVybiB2YWxpZCB0b2tlblxuICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja1JldHVyblZhbHVlKG1vY2tKd3RQYXlsb2FkKTtcblxuICAgICAgLy8gU2hvdWxkIGJlIGJsb2NrZWQgZHVlIHRvIHJhdGUgbGltaXRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KHtcbiAgICAgICAgLi4ubW9ja1NvY2tldCxcbiAgICAgICAgaWQ6ICdzb2NrZXQtYmxvY2tlZCcsXG4gICAgICB9IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc2V0IHJhdGUgbGltaXQgYWZ0ZXIgdGltZSB3aW5kb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpcEFkZHJlc3MgPSAnMTkyLjE2OC4xLjMnO1xuICAgICAgbW9ja1NvY2tldC5oYW5kc2hha2UhLmhlYWRlcnMgPSB7XG4gICAgICAgICd4LWZvcndhcmRlZC1mb3InOiBpcEFkZHJlc3MsXG4gICAgICAgIGF1dGhvcml6YXRpb246ICdCZWFyZXIgdmFsaWQtdG9rZW4nLFxuICAgICAgfTtcblxuICAgICAgLy8gTWFrZSAxMCBmYWlsZWQgY29ubmVjdGlvbnMgdG8gaGl0IHJhdGUgbGltaXRcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpO1xuICAgICAgfSk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldCh7XG4gICAgICAgICAgLi4ubW9ja1NvY2tldCxcbiAgICAgICAgICBpZDogYHNvY2tldC0ke2l9YCxcbiAgICAgICAgfSBhcyBTb2NrZXQpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZHZhbmNlIHRpbWUgYnkgMSBtaW51dGUgYW5kIDEgc2Vjb25kXG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoNjEgKiAxMDAwKTtcblxuICAgICAgLy8gUmVzZXQgSldUIHNlcnZpY2VcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrSnd0UGF5bG9hZCk7XG5cbiAgICAgIC8vIFNob3VsZCBub3cgYWxsb3cgY29ubmVjdGlvblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAuLi5tb2NrU29ja2V0LFxuICAgICAgICBpZDogJ3NvY2tldC1hZnRlci1yZXNldCcsXG4gICAgICB9IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICBsYXN0QXV0aGVudGljYXRlZDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgY29ubmVjdGlvbkNvdW50OiAxLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgSVAgZnJvbSB2YXJpb3VzIGhlYWRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0Q2FzZXMgPSBbXG4gICAgICAgIHsgaGVhZGVyOiAneC1mb3J3YXJkZWQtZm9yJywgdmFsdWU6ICcyMDMuMC4xMTMuMTk1JyB9LFxuICAgICAgICB7IGhlYWRlcjogJ3gtcmVhbC1pcCcsIHZhbHVlOiAnMjAzLjAuMTEzLjE5NicgfSxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGVzdENhc2Ugb2YgdGVzdENhc2VzKSB7XG4gICAgICAgIG1vY2tTb2NrZXQuaGFuZHNoYWtlIS5oZWFkZXJzID0ge1xuICAgICAgICAgIFt0ZXN0Q2FzZS5oZWFkZXJdOiB0ZXN0Q2FzZS52YWx1ZSxcbiAgICAgICAgICBhdXRob3JpemF0aW9uOiAnQmVhcmVyIHZhbGlkLXRva2VuJyxcbiAgICAgICAgfTtcblxuICAgICAgICBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldCh7XG4gICAgICAgICAgLi4ubW9ja1NvY2tldCxcbiAgICAgICAgICBpZDogYHNvY2tldC0ke3Rlc3RDYXNlLmhlYWRlcn1gLFxuICAgICAgICB9IGFzIFNvY2tldCk7XG5cbiAgICAgICAgLy8gU2hvdWxkIHVzZSB0aGUgSVAgZnJvbSBoZWFkZXJcbiAgICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBmYWxsYmFjayBJUCB3aGVuIGhlYWRlcnMgYXJlIG5vdCBhdmFpbGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEuaGVhZGVycyA9IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogJ0JlYXJlciB2YWxpZC10b2tlbicsXG4gICAgICB9O1xuICAgICAgbW9ja1NvY2tldC5oYW5kc2hha2UhLmFkZHJlc3MgPSAnMTAuMC4wLjEnO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5rbm93biBJUCBhZGRyZXNzZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEuaGVhZGVycyA9IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogJ0JlYXJlciB2YWxpZC10b2tlbicsXG4gICAgICB9O1xuICAgICAgbW9ja1NvY2tldC5oYW5kc2hha2UhLmFkZHJlc3MgPSB1bmRlZmluZWQ7XG4gICAgICBtb2NrU29ja2V0LmNvbm4hLnJlbW90ZUFkZHJlc3MgPSB1bmRlZmluZWQ7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZVRva2VuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYSB2YWxpZCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrSnd0UGF5bG9hZCk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmFsaWRhdGVUb2tlbigndmFsaWQtdG9rZW4nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3ZhbGlkLXRva2VuJyk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBkZWFjdGl2YXRlZEF0OiBudWxsLFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmFsaWRhdGVUb2tlbignaW52YWxpZC10b2tlbicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IHRva2VuIGZvciBub24tZXhpc3RlbnQgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrSnd0UGF5bG9hZCk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZVRva2VuKCd2YWxpZC10b2tlbicpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIHZhbGlkYXRpb24gd2FybmluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICd3YXJuJyk7XG4gICAgICBqd3RTZXJ2aWNlLnZlcmlmeS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rva2VuIGV4cGlyZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnZhbGlkYXRlVG9rZW4oJ2V4cGlyZWQtdG9rZW4nKTtcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdUb2tlbiB2YWxpZGF0aW9uIGZhaWxlZDonLFxuICAgICAgICBleHBlY3QuYW55KEVycm9yKSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25uZWN0aW9uIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBtdWx0aXBsZSBjb25uZWN0aW9ucyBwZXIgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBtdWx0aXBsZSBjb25uZWN0aW9ucyBmb3IgdGhlIHNhbWUgdXNlclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgICAgaWQ6IGBzb2NrZXQtJHtpfWAsXG4gICAgICAgIH0gYXMgU29ja2V0KTtcblxuICAgICAgICBleHBlY3QocmVzdWx0Py5jb25uZWN0aW9uQ291bnQpLnRvQmUoaSArIDEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjbGVhbiB1cCBjb25uZWN0aW9uIHdoZW4gc29ja2V0IGRpc2Nvbm5lY3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc29ja2V0SWQgPSAnc29ja2V0LWNsZWFudXAnO1xuICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAuLi5tb2NrU29ja2V0LFxuICAgICAgICBpZDogc29ja2V0SWQsXG4gICAgICB9IGFzIFNvY2tldCk7XG5cbiAgICAgIHNlcnZpY2UuY2xlYW51cENvbm5lY3Rpb24oc29ja2V0SWQpO1xuXG4gICAgICAvLyBDcmVhdGUgYW5vdGhlciBjb25uZWN0aW9uLCBzaG91bGQgcmVzZXQgY291bnRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KHtcbiAgICAgICAgLi4ubW9ja1NvY2tldCxcbiAgICAgICAgaWQ6ICdzb2NrZXQtbmV3JyxcbiAgICAgIH0gYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdD8uY29ubmVjdGlvbkNvdW50KS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2xlYW51cCBvZiBub24tZXhpc3RlbnQgY29ubmVjdGlvbicsICgpID0+IHtcbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3cgZXJyb3JcbiAgICAgIGV4cGVjdCgoKSA9PiBzZXJ2aWNlLmNsZWFudXBDb25uZWN0aW9uKCdub24tZXhpc3RlbnQnKSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Nvbm5lY3Rpb24gU3RhdGlzdGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhY2N1cmF0ZSBjb25uZWN0aW9uIHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgY29ubmVjdGlvbnMgZm9yIGRpZmZlcmVudCB1c2Vyc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAuLi5tb2NrSnd0UGF5bG9hZCxcbiAgICAgICAgICBzdWI6IGB1c2VyLSR7aX1gLFxuICAgICAgICB9KTtcbiAgICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIC4uLm1vY2tVc2VyLFxuICAgICAgICAgIGlkOiBgdXNlci0ke2l9YCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgICAgaWQ6IGBzb2NrZXQtJHtpfWAsXG4gICAgICAgIH0gYXMgU29ja2V0KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuXG4gICAgICBleHBlY3Qoc3RhdHMpLnRvRXF1YWwoe1xuICAgICAgICB0b3RhbENvbm5lY3Rpb25zOiAzLFxuICAgICAgICB1bmlxdWVVc2VyczogMyxcbiAgICAgICAgdHJhY2tlZElwczogMSwgLy8gQWxsIGNvbm5lY3Rpb25zIGZyb20gc2FtZSBJUFxuICAgICAgICBtYXhDb25uZWN0aW9uc1BlclVzZXI6IDUsXG4gICAgICAgIG1heEF0dGVtcHRzUGVyTWludXRlOiAxMCxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb3VudCB1bmlxdWUgdXNlcnMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIG11bHRpcGxlIGNvbm5lY3Rpb25zIGZvciBzYW1lIHVzZXJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgICAgIGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KHtcbiAgICAgICAgICAuLi5tb2NrU29ja2V0LFxuICAgICAgICAgIGlkOiBgc29ja2V0LSR7aX1gLFxuICAgICAgICB9IGFzIFNvY2tldCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcblxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3Qoc3RhdHMudW5pcXVlVXNlcnMpLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDbGVhbnVwIGFuZCBNYWludGVuYW5jZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNsZWFuIHVwIGNvbm5lY3Rpb24gdHJhY2tpbmcgcGVyaW9kaWNhbGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZGVidWcnKTtcblxuICAgICAgLy8gVHJpZ2dlciB0aGUgY2xlYW51cCBpbnRlcnZhbFxuICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDUgKiA2MCAqIDEwMDApOyAvLyA1IG1pbnV0ZXNcblxuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdDbGVhbmVkIHVwIGNvbm5lY3Rpb24gdHJhY2tpbmcgZGF0YScsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgb2xkIGNvbm5lY3Rpb24gYXR0ZW1wdHMgZHVyaW5nIGNsZWFudXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpcEFkZHJlc3MgPSAnMTkyLjE2OC4xLjEwMCc7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEuaGVhZGVycyA9IHtcbiAgICAgICAgJ3gtZm9yd2FyZGVkLWZvcic6IGlwQWRkcmVzcyxcbiAgICAgICAgYXV0aG9yaXphdGlvbjogJ0JlYXJlciBpbnZhbGlkLXRva2VuJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIENyZWF0ZSBzb21lIGZhaWxlZCBhdHRlbXB0c1xuICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRva2VuJyk7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQoe1xuICAgICAgICAuLi5tb2NrU29ja2V0LFxuICAgICAgICBpZDogJ3NvY2tldC1vbGQnLFxuICAgICAgfSBhcyBTb2NrZXQpO1xuXG4gICAgICAvLyBBZHZhbmNlIHRpbWUgYnkgbW9yZSB0aGFuIDEgaG91clxuICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDYxICogNjAgKiAxMDAwKTtcblxuICAgICAgLy8gVHJpZ2dlciBjbGVhbnVwXG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoNSAqIDYwICogMTAwMCk7XG5cbiAgICAgIC8vIFJlc2V0IEpXVCBzZXJ2aWNlXG4gICAgICBqd3RTZXJ2aWNlLnZlcmlmeS5tb2NrUmV0dXJuVmFsdWUobW9ja0p3dFBheWxvYWQpO1xuXG4gICAgICAvLyBTaG91bGQgbm90IGJlIHJhdGUgbGltaXRlZCBhbnltb3JlXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldCh7XG4gICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgIGlkOiAnc29ja2V0LW5ldycsXG4gICAgICB9IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICBsYXN0QXV0aGVudGljYXRlZDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgY29ubmVjdGlvbkNvdW50OiAxLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZyBhbmQgRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBKV1QgdmVyaWZpY2F0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVG9rZW4gcGFyc2luZyBmYWlsZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ1NvY2tldCBzb2NrZXQtMTIzIGF1dGhlbnRpY2F0aW9uIGZhaWxlZDonLFxuICAgICAgICAnVG9rZW4gcGFyc2luZyBmYWlsZWQnLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1FcnJvciBleGNlcHRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93ICdTdHJpbmcgZXJyb3InO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnU29ja2V0IHNvY2tldC0xMjMgYXV0aGVudGljYXRpb24gZmFpbGVkOicsXG4gICAgICAgICdTdHJpbmcgZXJyb3InLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3Npbmcgc29ja2V0IHByb3BlcnRpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWxmb3JtZWRTb2NrZXQgPSB7XG4gICAgICAgIGlkOiAnc29ja2V0LW1hbGZvcm1lZCcsXG4gICAgICAgIGhhbmRzaGFrZToge1xuICAgICAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgICAgIGF1dGg6IHt9LFxuICAgICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgfSxcbiAgICAgIH0gYXMgU29ja2V0O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtYWxmb3JtZWRTb2NrZXQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXJyYXlzIGluIHRva2VuIHNvdXJjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU29ja2V0LmhhbmRzaGFrZSEucXVlcnkgPSB7IHRva2VuOiBbJ3Rva2VuMScsICd0b2tlbjInXSB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBGZWF0dXJlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgYWxnb3JpdGhtIHJlc3RyaWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQobW9ja1NvY2tldCBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd2YWxpZC10b2tlbicsIHtcbiAgICAgICAgYWxnb3JpdGhtczogWydIUzI1NiddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoZWNrIGZvciByZXF1aXJlZCBwYXlsb2FkIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGp3dFNlcnZpY2UudmVyaWZ5Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHN1YjogJ3VzZXItMTIzJyxcbiAgICAgICAgLy8gTWlzc2luZyBlbWFpbCBmaWVsZFxuICAgICAgICBpYXQ6IERhdGUubm93KCkgLyAxMDAwLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdG9rZW4gZnJlc2huZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgand0U2VydmljZS52ZXJpZnkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc3ViOiAndXNlci0xMjMnLFxuICAgICAgICBlbWFpbDogJ3VzZXJAZXhhbXBsZS5jb20nLFxuICAgICAgICBpYXQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gMjUgKiA2MCAqIDYwLCAvLyAyNSBob3VycyBhZ29cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmF1dGhlbnRpY2F0ZVNvY2tldChtb2NrU29ja2V0IGFzIFNvY2tldCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoZWNrIHVzZXIgYWN0aXZlIHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1VzZXIsXG4gICAgICAgIGRlYWN0aXZhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdXRoZW50aWNhdGVTb2NrZXQobW9ja1NvY2tldCBhcyBTb2NrZXQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgYXV0aGVudGljYXRpb24gZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KG1vY2tTb2NrZXQgYXMgU29ja2V0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIGxhc3RBdXRoZW50aWNhdGVkOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICBjb25uZWN0aW9uQ291bnQ6IDEsXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMudW5pcXVlVXNlcnMpLnRvQmUoMSk7XG5cbiAgICAgIHNlcnZpY2UuY2xlYW51cENvbm5lY3Rpb24oJ3NvY2tldC0xMjMnKTtcbiAgICAgIGNvbnN0IHN0YXRzQWZ0ZXJDbGVhbnVwID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0c0FmdGVyQ2xlYW51cC50b3RhbENvbm5lY3Rpb25zKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbXVsdGlwbGUgY29uY3VycmVudCBhdXRoZW50aWNhdGlvbiBhdHRlbXB0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICAgIHNlcnZpY2UuYXV0aGVudGljYXRlU29ja2V0KHtcbiAgICAgICAgICAgIC4uLm1vY2tTb2NrZXQsXG4gICAgICAgICAgICBpZDogYHNvY2tldC0ke2l9YCxcbiAgICAgICAgICB9IGFzIFNvY2tldCksXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRzLmV2ZXJ5KHJlc3VsdCA9PiByZXN1bHQgIT09IG51bGwpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdHMubWFwKHIgPT4gcj8uY29ubmVjdGlvbkNvdW50KSkudG9FcXVhbChbMSwgMiwgM10pO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==