380b9012a9f189841f6eb9da189e0a6b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const messaging_controller_1 = require("./messaging.controller");
const messaging_service_1 = require("./messaging.service");
const test_utils_1 = require("../test-utils");
const enhanced_test_helpers_1 = require("../test-utils/enhanced-test-helpers");
describe('MessagingController', () => {
    let controller;
    let messagingService;
    const mockMessagingService = {
        createConversation: jest.fn(),
        getUserConversations: jest.fn(),
        getConversationMessages: jest.fn(),
        sendMessage: jest.fn(),
        updateMessage: jest.fn(),
        deleteMessage: jest.fn(),
        markMessageAsRead: jest.fn(),
        addMessageReaction: jest.fn(),
        removeMessageReaction: jest.fn(),
        blockUser: jest.fn(),
        unblockUser: jest.fn(),
        searchMessages: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [messaging_controller_1.MessagingController],
            providers: [
                { provide: messaging_service_1.MessagingService, useValue: mockMessagingService },
            ],
        }).compile();
        controller = module.get(messaging_controller_1.MessagingController);
        messagingService = module.get(messaging_service_1.MessagingService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('createConversation', () => {
        const createConversationDto = {
            participantIds: [test_utils_1.TEST_USER_IDS.THERAPIST],
            type: 'DIRECT',
            title: 'Therapy Session Chat',
        };
        it('should create a new conversation', async () => {
            const mockConversation = {
                id: 'conversation-123',
                ...createConversationDto,
                createdBy: test_utils_1.TEST_USER_IDS.CLIENT,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            messagingService.createConversation.mockResolvedValue(mockConversation);
            const result = await controller.createConversation(test_utils_1.TEST_USER_IDS.CLIENT, createConversationDto);
            expect(messagingService.createConversation).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, createConversationDto);
            expect(result).toEqual(mockConversation);
        });
        it('should handle conversation creation errors', async () => {
            messagingService.createConversation.mockRejectedValue(new common_1.BadRequestException('Invalid participant IDs'));
            await expect(controller.createConversation(test_utils_1.TEST_USER_IDS.CLIENT, createConversationDto)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('getUserConversations', () => {
        it('should return user conversations with default pagination', async () => {
            const mockConversations = [
                {
                    id: 'conv-1',
                    title: 'Therapy Chat',
                    lastMessage: enhanced_test_helpers_1.TestDataGenerator.createMessage(),
                    participants: [test_utils_1.TEST_USER_IDS.CLIENT, test_utils_1.TEST_USER_IDS.THERAPIST],
                },
                {
                    id: 'conv-2',
                    title: 'Support Group',
                    lastMessage: enhanced_test_helpers_1.TestDataGenerator.createMessage(),
                    participants: [test_utils_1.TEST_USER_IDS.CLIENT, test_utils_1.TEST_USER_IDS.MODERATOR],
                },
            ];
            messagingService.getUserConversations.mockResolvedValue(mockConversations);
            const result = await controller.getUserConversations(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(messagingService.getUserConversations).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, 1, // default page
            20);
            expect(result).toEqual(mockConversations);
        });
        it('should handle custom pagination parameters', async () => {
            const mockConversations = [];
            messagingService.getUserConversations.mockResolvedValue(mockConversations);
            await controller.getUserConversations(test_utils_1.TEST_USER_IDS.CLIENT, '2', // page
            '10');
            expect(messagingService.getUserConversations).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, 2, 10);
        });
        it('should handle invalid pagination parameters gracefully', async () => {
            const mockConversations = [];
            messagingService.getUserConversations.mockResolvedValue(mockConversations);
            await controller.getUserConversations(test_utils_1.TEST_USER_IDS.CLIENT, 'invalid', // should default to 1
            'invalid');
            expect(messagingService.getUserConversations).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, 1, // NaN becomes 1
            20);
        });
    });
    describe('getConversationMessages', () => {
        const conversationId = 'conversation-123';
        it('should return conversation messages', async () => {
            const mockMessages = [
                enhanced_test_helpers_1.TestDataGenerator.createMessage({ conversationId }),
                enhanced_test_helpers_1.TestDataGenerator.createMessage({ conversationId }),
            ];
            messagingService.getConversationMessages.mockResolvedValue(mockMessages);
            const result = await controller.getConversationMessages(test_utils_1.TEST_USER_IDS.CLIENT, conversationId);
            expect(messagingService.getConversationMessages).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, conversationId, 1, // default page
            50);
            expect(result).toEqual(mockMessages);
        });
        it('should handle unauthorized access to conversation', async () => {
            messagingService.getConversationMessages.mockRejectedValue(new common_1.ForbiddenException('Not a participant in this conversation'));
            await expect(controller.getConversationMessages(test_utils_1.TEST_USER_IDS.CLIENT, conversationId)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('sendMessage', () => {
        const conversationId = 'conversation-123';
        const sendMessageDto = {
            content: 'Hello, how are you feeling today?',
            messageType: 'TEXT',
        };
        it('should send a message successfully', async () => {
            const mockMessage = {
                id: 'message-123',
                ...sendMessageDto,
                senderId: test_utils_1.TEST_USER_IDS.CLIENT,
                conversationId,
                createdAt: new Date(),
                isEdited: false,
                isDeleted: false,
            };
            messagingService.sendMessage.mockResolvedValue(mockMessage);
            const result = await controller.sendMessage(test_utils_1.TEST_USER_IDS.CLIENT, conversationId, sendMessageDto);
            expect(messagingService.sendMessage).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, conversationId, sendMessageDto);
            expect(result).toEqual(mockMessage);
        });
        it('should handle empty message content', async () => {
            const emptyMessageDto = {
                content: '',
                messageType: 'TEXT',
            };
            messagingService.sendMessage.mockRejectedValue(new common_1.BadRequestException('Message content cannot be empty'));
            await expect(controller.sendMessage(test_utils_1.TEST_USER_IDS.CLIENT, conversationId, emptyMessageDto)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('updateMessage', () => {
        const messageId = 'message-123';
        const updateMessageDto = {
            content: 'Updated message content',
        };
        it('should update message successfully', async () => {
            const mockUpdatedMessage = {
                id: messageId,
                content: updateMessageDto.content,
                senderId: test_utils_1.TEST_USER_IDS.CLIENT,
                isEdited: true,
                updatedAt: new Date(),
            };
            messagingService.updateMessage.mockResolvedValue(mockUpdatedMessage);
            const result = await controller.updateMessage(test_utils_1.TEST_USER_IDS.CLIENT, messageId, updateMessageDto);
            expect(messagingService.updateMessage).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, messageId, updateMessageDto);
            expect(result).toEqual(mockUpdatedMessage);
        });
        it('should handle unauthorized message update', async () => {
            messagingService.updateMessage.mockRejectedValue(new common_1.ForbiddenException('Cannot edit message from another user'));
            await expect(controller.updateMessage(test_utils_1.TEST_USER_IDS.CLIENT, messageId, updateMessageDto)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('deleteMessage', () => {
        const messageId = 'message-123';
        it('should delete message successfully', async () => {
            messagingService.deleteMessage.mockResolvedValue({ success: true });
            const result = await controller.deleteMessage(test_utils_1.TEST_USER_IDS.CLIENT, messageId);
            expect(messagingService.deleteMessage).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, messageId);
            expect(result).toEqual({ success: true });
        });
        it('should handle message not found', async () => {
            messagingService.deleteMessage.mockRejectedValue(new common_1.NotFoundException('Message not found'));
            await expect(controller.deleteMessage(test_utils_1.TEST_USER_IDS.CLIENT, messageId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('markMessageAsRead', () => {
        const messageId = 'message-123';
        it('should mark message as read', async () => {
            const mockReadReceipt = {
                id: 'receipt-123',
                messageId,
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                readAt: new Date(),
            };
            messagingService.markMessageAsRead.mockResolvedValue(mockReadReceipt);
            const result = await controller.markMessageAsRead(test_utils_1.TEST_USER_IDS.CLIENT, messageId);
            expect(messagingService.markMessageAsRead).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, messageId);
            expect(result).toEqual(mockReadReceipt);
        });
    });
    describe('addMessageReaction', () => {
        const messageId = 'message-123';
        const addReactionDto = { emoji: '❤️' };
        it('should add reaction to message', async () => {
            const mockReaction = {
                id: 'reaction-123',
                messageId,
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                emoji: addReactionDto.emoji,
                createdAt: new Date(),
            };
            messagingService.addMessageReaction.mockResolvedValue(mockReaction);
            const result = await controller.addMessageReaction(test_utils_1.TEST_USER_IDS.CLIENT, messageId, addReactionDto);
            expect(messagingService.addMessageReaction).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, messageId, addReactionDto.emoji);
            expect(result).toEqual(mockReaction);
        });
        it('should handle duplicate reactions', async () => {
            messagingService.addMessageReaction.mockRejectedValue(new common_1.BadRequestException('Reaction already exists'));
            await expect(controller.addMessageReaction(test_utils_1.TEST_USER_IDS.CLIENT, messageId, addReactionDto)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('removeMessageReaction', () => {
        const messageId = 'message-123';
        const emoji = '❤️';
        it('should remove reaction from message', async () => {
            messagingService.removeMessageReaction.mockResolvedValue({ success: true });
            const result = await controller.removeMessageReaction(test_utils_1.TEST_USER_IDS.CLIENT, messageId, emoji);
            expect(messagingService.removeMessageReaction).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, messageId, emoji);
            expect(result).toEqual({ success: true });
        });
    });
    describe('blockUser', () => {
        const blockUserDto = {
            userId: test_utils_1.TEST_USER_IDS.THERAPIST,
            reason: 'Inappropriate behavior',
        };
        it('should block user successfully', async () => {
            const mockBlock = {
                id: 'block-123',
                blockerId: test_utils_1.TEST_USER_IDS.CLIENT,
                blockedId: blockUserDto.userId,
                reason: blockUserDto.reason,
                createdAt: new Date(),
            };
            messagingService.blockUser.mockResolvedValue(mockBlock);
            const result = await controller.blockUser(test_utils_1.TEST_USER_IDS.CLIENT, blockUserDto);
            expect(messagingService.blockUser).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, blockUserDto.userId, blockUserDto.reason);
            expect(result).toEqual(mockBlock);
        });
        it('should handle self-blocking attempt', async () => {
            const selfBlockDto = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                reason: 'Self-block attempt',
            };
            messagingService.blockUser.mockRejectedValue(new common_1.BadRequestException('Cannot block yourself'));
            await expect(controller.blockUser(test_utils_1.TEST_USER_IDS.CLIENT, selfBlockDto)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('unblockUser', () => {
        const blockedUserId = test_utils_1.TEST_USER_IDS.THERAPIST;
        it('should unblock user successfully', async () => {
            messagingService.unblockUser.mockResolvedValue({ success: true });
            const result = await controller.unblockUser(test_utils_1.TEST_USER_IDS.CLIENT, blockedUserId);
            expect(messagingService.unblockUser).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, blockedUserId);
            expect(result).toEqual({ success: true });
        });
        it('should handle unblocking non-blocked user', async () => {
            messagingService.unblockUser.mockRejectedValue(new common_1.NotFoundException('User is not blocked'));
            await expect(controller.unblockUser(test_utils_1.TEST_USER_IDS.CLIENT, blockedUserId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('searchMessages', () => {
        const searchDto = {
            query: 'therapy session',
            conversationId: 'conversation-123',
            page: '1',
            limit: '10',
        };
        it('should search messages successfully', async () => {
            const mockSearchResults = {
                messages: [
                    enhanced_test_helpers_1.TestDataGenerator.createMessage({
                        content: 'Our next therapy session is scheduled',
                    }),
                ],
                total: 1,
                page: 1,
                limit: 10,
            };
            messagingService.searchMessages.mockResolvedValue(mockSearchResults);
            const result = await controller.searchMessages(test_utils_1.TEST_USER_IDS.CLIENT, searchDto);
            expect(messagingService.searchMessages).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, searchDto.query, searchDto.conversationId, 1, 10);
            expect(result).toEqual(mockSearchResults);
        });
        it('should handle search with minimal parameters', async () => {
            const minimalSearchDto = {
                query: 'hello',
            };
            const mockSearchResults = {
                messages: [],
                total: 0,
                page: 1,
                limit: 20,
            };
            messagingService.searchMessages.mockResolvedValue(mockSearchResults);
            const result = await controller.searchMessages(test_utils_1.TEST_USER_IDS.CLIENT, minimalSearchDto);
            expect(messagingService.searchMessages).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, 'hello', undefined, 1, // default page
            20);
            expect(result).toEqual(mockSearchResults);
        });
        it('should handle empty search query', async () => {
            const emptySearchDto = {
                query: '',
            };
            messagingService.searchMessages.mockRejectedValue(new common_1.BadRequestException('Search query cannot be empty'));
            await expect(controller.searchMessages(test_utils_1.TEST_USER_IDS.CLIENT, emptySearchDto)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('messaging flow integration', () => {
        it('should handle complete conversation workflow', async () => {
            // 1. Create conversation
            const createConversationDto = {
                participantIds: [test_utils_1.TEST_USER_IDS.THERAPIST],
                type: 'DIRECT',
                title: 'Therapy Session',
            };
            const mockConversation = {
                id: 'conversation-123',
                ...createConversationDto,
            };
            messagingService.createConversation.mockResolvedValue(mockConversation);
            // 2. Send message
            const sendMessageDto = {
                content: 'Hello, looking forward to our session',
                messageType: 'TEXT',
            };
            const mockMessage = {
                id: 'message-123',
                ...sendMessageDto,
                conversationId: mockConversation.id,
            };
            messagingService.sendMessage.mockResolvedValue(mockMessage);
            // 3. Mark as read
            const mockReadReceipt = {
                id: 'receipt-123',
                messageId: mockMessage.id,
                userId: test_utils_1.TEST_USER_IDS.THERAPIST,
            };
            messagingService.markMessageAsRead.mockResolvedValue(mockReadReceipt);
            // Execute workflow
            const conversation = await controller.createConversation(test_utils_1.TEST_USER_IDS.CLIENT, createConversationDto);
            const message = await controller.sendMessage(test_utils_1.TEST_USER_IDS.CLIENT, conversation.id, sendMessageDto);
            const readReceipt = await controller.markMessageAsRead(test_utils_1.TEST_USER_IDS.THERAPIST, message.id);
            expect(conversation).toEqual(mockConversation);
            expect(message).toEqual(mockMessage);
            expect(readReceipt).toEqual(mockReadReceipt);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9tZXNzYWdpbmcuY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDJDQUt3QjtBQUN4QixpRUFBNkQ7QUFDN0QsMkRBQXVEO0FBQ3ZELDhDQUd1QjtBQUN2QiwrRUFJNkM7QUFFN0MsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxJQUFJLFVBQStCLENBQUM7SUFDcEMsSUFBSSxnQkFBK0MsQ0FBQztJQUVwRCxNQUFNLG9CQUFvQixHQUFHO1FBQzNCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDN0Isb0JBQW9CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUMvQix1QkFBdUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xDLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3RCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDNUIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM3QixxQkFBcUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3BCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3RCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQzFCLENBQUM7SUFFRixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFdBQVcsRUFBRSxDQUFDLDBDQUFtQixDQUFDO1lBQ2xDLFNBQVMsRUFBRTtnQkFDVCxFQUFF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LEVBQUUsRUFBRSxhQUFhO2dCQUNqQixTQUFTLEVBQUUsV0FBVyxDQUFDLEVBQUU7Z0JBQ3pCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLFNBQVM7YUFDaEMsQ0FBQztZQUNGLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUNsRCxlQUFzQixDQUN2QixDQUFDO1lBRUYsbUJBQW1CO1lBQ25CLE1BQU0sWUFBWSxHQUFHLE1BQU0sVUFBVSxDQUFDLGtCQUFrQixDQUN0RCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIscUJBQXFCLENBQ3RCLENBQUM7WUFDRixNQUFNLE9BQU8sR0FBRyxNQUFNLFVBQVUsQ0FBQyxXQUFXLENBQzFDLDBCQUFhLENBQUMsTUFBTSxFQUNwQixZQUFZLENBQUMsRUFBRSxFQUNmLGNBQWMsQ0FDZixDQUFDO1lBQ0YsTUFBTSxXQUFXLEdBQUcsTUFBTSxVQUFVLENBQUMsaUJBQWlCLENBQ3BELDBCQUFhLENBQUMsU0FBUyxFQUN2QixPQUFPLENBQUMsRUFBRSxDQUNYLENBQUM7WUFFRixNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDL0MsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbWVzc2FnaW5nL21lc3NhZ2luZy5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQge1xuICBIdHRwU3RhdHVzLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBGb3JiaWRkZW5FeGNlcHRpb24sXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBNZXNzYWdpbmdDb250cm9sbGVyIH0gZnJvbSAnLi9tZXNzYWdpbmcuY29udHJvbGxlcic7XG5pbXBvcnQgeyBNZXNzYWdpbmdTZXJ2aWNlIH0gZnJvbSAnLi9tZXNzYWdpbmcuc2VydmljZSc7XG5pbXBvcnQge1xuICBjcmVhdGVNb2NrUHJpc21hU2VydmljZSxcbiAgVEVTVF9VU0VSX0lEUyxcbn0gZnJvbSAnLi4vdGVzdC11dGlscyc7XG5pbXBvcnQge1xuICBNb2NrQnVpbGRlcixcbiAgVGVzdERhdGFHZW5lcmF0b3IsXG4gIFRlc3RBc3NlcnRpb25zLFxufSBmcm9tICcuLi90ZXN0LXV0aWxzL2VuaGFuY2VkLXRlc3QtaGVscGVycyc7XG5cbmRlc2NyaWJlKCdNZXNzYWdpbmdDb250cm9sbGVyJywgKCkgPT4ge1xuICBsZXQgY29udHJvbGxlcjogTWVzc2FnaW5nQ29udHJvbGxlcjtcbiAgbGV0IG1lc3NhZ2luZ1NlcnZpY2U6IGplc3QuTW9ja2VkPE1lc3NhZ2luZ1NlcnZpY2U+O1xuXG4gIGNvbnN0IG1vY2tNZXNzYWdpbmdTZXJ2aWNlID0ge1xuICAgIGNyZWF0ZUNvbnZlcnNhdGlvbjogamVzdC5mbigpLFxuICAgIGdldFVzZXJDb252ZXJzYXRpb25zOiBqZXN0LmZuKCksXG4gICAgZ2V0Q29udmVyc2F0aW9uTWVzc2FnZXM6IGplc3QuZm4oKSxcbiAgICBzZW5kTWVzc2FnZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZU1lc3NhZ2U6IGplc3QuZm4oKSxcbiAgICBkZWxldGVNZXNzYWdlOiBqZXN0LmZuKCksXG4gICAgbWFya01lc3NhZ2VBc1JlYWQ6IGplc3QuZm4oKSxcbiAgICBhZGRNZXNzYWdlUmVhY3Rpb246IGplc3QuZm4oKSxcbiAgICByZW1vdmVNZXNzYWdlUmVhY3Rpb246IGplc3QuZm4oKSxcbiAgICBibG9ja1VzZXI6IGplc3QuZm4oKSxcbiAgICB1bmJsb2NrVXNlcjogamVzdC5mbigpLFxuICAgIHNlYXJjaE1lc3NhZ2VzOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGNvbnRyb2xsZXJzOiBbTWVzc2FnaW5nQ29udHJvbGxlcl0sXG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgeyBwcm92aWRlOiBNZXNzYWdpbmdTZXJ2aWNlLCB1c2VWYWx1ZTogbW9ja01lc3NhZ2luZ1NlcnZpY2UgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8TWVzc2FnaW5nQ29udHJvbGxlcj4oTWVzc2FnaW5nQ29udHJvbGxlcik7XG4gICAgbWVzc2FnaW5nU2VydmljZSA9IG1vZHVsZS5nZXQoTWVzc2FnaW5nU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVDb252ZXJzYXRpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlQ29udmVyc2F0aW9uRHRvID0ge1xuICAgICAgcGFydGljaXBhbnRJZHM6IFtURVNUX1VTRVJfSURTLlRIRVJBUElTVF0sXG4gICAgICB0eXBlOiAnRElSRUNUJyBhcyBjb25zdCxcbiAgICAgIHRpdGxlOiAnVGhlcmFweSBTZXNzaW9uIENoYXQnLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyBjb252ZXJzYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ29udmVyc2F0aW9uID0ge1xuICAgICAgICBpZDogJ2NvbnZlcnNhdGlvbi0xMjMnLFxuICAgICAgICAuLi5jcmVhdGVDb252ZXJzYXRpb25EdG8sXG4gICAgICAgIGNyZWF0ZWRCeTogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbWVzc2FnaW5nU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24ubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDb252ZXJzYXRpb24gYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVDb252ZXJzYXRpb24oXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBjcmVhdGVDb252ZXJzYXRpb25EdG8sXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWVzc2FnaW5nU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgY3JlYXRlQ29udmVyc2F0aW9uRHRvLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NvbnZlcnNhdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb252ZXJzYXRpb24gY3JlYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbWVzc2FnaW5nU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24ubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdJbnZhbGlkIHBhcnRpY2lwYW50IElEcycpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZUNvbnZlcnNhdGlvbihcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBjcmVhdGVDb252ZXJzYXRpb25EdG8sXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFVzZXJDb252ZXJzYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVzZXIgY29udmVyc2F0aW9ucyB3aXRoIGRlZmF1bHQgcGFnaW5hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDb252ZXJzYXRpb25zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdjb252LTEnLFxuICAgICAgICAgIHRpdGxlOiAnVGhlcmFweSBDaGF0JyxcbiAgICAgICAgICBsYXN0TWVzc2FnZTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVzc2FnZSgpLFxuICAgICAgICAgIHBhcnRpY2lwYW50czogW1RFU1RfVVNFUl9JRFMuQ0xJRU5ULCBURVNUX1VTRVJfSURTLlRIRVJBUElTVF0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2NvbnYtMicsXG4gICAgICAgICAgdGl0bGU6ICdTdXBwb3J0IEdyb3VwJyxcbiAgICAgICAgICBsYXN0TWVzc2FnZTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVzc2FnZSgpLFxuICAgICAgICAgIHBhcnRpY2lwYW50czogW1RFU1RfVVNFUl9JRFMuQ0xJRU5ULCBURVNUX1VTRVJfSURTLk1PREVSQVRPUl0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLmdldFVzZXJDb252ZXJzYXRpb25zLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrQ29udmVyc2F0aW9ucyBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVzZXJDb252ZXJzYXRpb25zKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KG1lc3NhZ2luZ1NlcnZpY2UuZ2V0VXNlckNvbnZlcnNhdGlvbnMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgMSwgLy8gZGVmYXVsdCBwYWdlXG4gICAgICAgIDIwLCAvLyBkZWZhdWx0IGxpbWl0XG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ29udmVyc2F0aW9ucyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjdXN0b20gcGFnaW5hdGlvbiBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NvbnZlcnNhdGlvbnMgPSBbXTtcbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2UuZ2V0VXNlckNvbnZlcnNhdGlvbnMubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDb252ZXJzYXRpb25zIGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlckNvbnZlcnNhdGlvbnMoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAnMicsIC8vIHBhZ2VcbiAgICAgICAgJzEwJywgLy8gbGltaXRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXNzYWdpbmdTZXJ2aWNlLmdldFVzZXJDb252ZXJzYXRpb25zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIDIsXG4gICAgICAgIDEwLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgcGFnaW5hdGlvbiBwYXJhbWV0ZXJzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ29udmVyc2F0aW9ucyA9IFtdO1xuICAgICAgbWVzc2FnaW5nU2VydmljZS5nZXRVc2VyQ29udmVyc2F0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0NvbnZlcnNhdGlvbnMgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgY29udHJvbGxlci5nZXRVc2VyQ29udmVyc2F0aW9ucyhcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICdpbnZhbGlkJywgLy8gc2hvdWxkIGRlZmF1bHQgdG8gMVxuICAgICAgICAnaW52YWxpZCcsIC8vIHNob3VsZCBkZWZhdWx0IHRvIDIwXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWVzc2FnaW5nU2VydmljZS5nZXRVc2VyQ29udmVyc2F0aW9ucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAxLCAvLyBOYU4gYmVjb21lcyAxXG4gICAgICAgIDIwLCAvLyBOYU4gYmVjb21lcyAyMFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldENvbnZlcnNhdGlvbk1lc3NhZ2VzJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbnZlcnNhdGlvbklkID0gJ2NvbnZlcnNhdGlvbi0xMjMnO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29udmVyc2F0aW9uIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja01lc3NhZ2VzID0gW1xuICAgICAgICBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVNZXNzYWdlKHsgY29udmVyc2F0aW9uSWQgfSksXG4gICAgICAgIFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZU1lc3NhZ2UoeyBjb252ZXJzYXRpb25JZCB9KSxcbiAgICAgIF07XG5cbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2UuZ2V0Q29udmVyc2F0aW9uTWVzc2FnZXMubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tNZXNzYWdlcyBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldENvbnZlcnNhdGlvbk1lc3NhZ2VzKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgY29udmVyc2F0aW9uSWQsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWVzc2FnaW5nU2VydmljZS5nZXRDb252ZXJzYXRpb25NZXNzYWdlcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBjb252ZXJzYXRpb25JZCxcbiAgICAgICAgMSwgLy8gZGVmYXVsdCBwYWdlXG4gICAgICAgIDUwLCAvLyBkZWZhdWx0IGxpbWl0IGZvciBtZXNzYWdlc1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01lc3NhZ2VzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gY29udmVyc2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbWVzc2FnaW5nU2VydmljZS5nZXRDb252ZXJzYXRpb25NZXNzYWdlcy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignTm90IGEgcGFydGljaXBhbnQgaW4gdGhpcyBjb252ZXJzYXRpb24nKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRDb252ZXJzYXRpb25NZXNzYWdlcyhcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZCxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZW5kTWVzc2FnZScsICgpID0+IHtcbiAgICBjb25zdCBjb252ZXJzYXRpb25JZCA9ICdjb252ZXJzYXRpb24tMTIzJztcbiAgICBjb25zdCBzZW5kTWVzc2FnZUR0byA9IHtcbiAgICAgIGNvbnRlbnQ6ICdIZWxsbywgaG93IGFyZSB5b3UgZmVlbGluZyB0b2RheT8nLFxuICAgICAgbWVzc2FnZVR5cGU6ICdURVhUJyBhcyBjb25zdCxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBzZW5kIGEgbWVzc2FnZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTWVzc2FnZSA9IHtcbiAgICAgICAgaWQ6ICdtZXNzYWdlLTEyMycsXG4gICAgICAgIC4uLnNlbmRNZXNzYWdlRHRvLFxuICAgICAgICBzZW5kZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGlzRWRpdGVkOiBmYWxzZSxcbiAgICAgICAgaXNEZWxldGVkOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2Uuc2VuZE1lc3NhZ2UubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lc3NhZ2UgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5zZW5kTWVzc2FnZShcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgICBzZW5kTWVzc2FnZUR0byxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXNzYWdpbmdTZXJ2aWNlLnNlbmRNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgICBzZW5kTWVzc2FnZUR0byxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNZXNzYWdlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IG1lc3NhZ2UgY29udGVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtcHR5TWVzc2FnZUR0byA9IHtcbiAgICAgICAgY29udGVudDogJycsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiAnVEVYVCcgYXMgY29uc3QsXG4gICAgICB9O1xuXG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLnNlbmRNZXNzYWdlLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignTWVzc2FnZSBjb250ZW50IGNhbm5vdCBiZSBlbXB0eScpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLnNlbmRNZXNzYWdlKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgIGVtcHR5TWVzc2FnZUR0byxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlTWVzc2FnZScsICgpID0+IHtcbiAgICBjb25zdCBtZXNzYWdlSWQgPSAnbWVzc2FnZS0xMjMnO1xuICAgIGNvbnN0IHVwZGF0ZU1lc3NhZ2VEdG8gPSB7XG4gICAgICBjb250ZW50OiAnVXBkYXRlZCBtZXNzYWdlIGNvbnRlbnQnLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBtZXNzYWdlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGVkTWVzc2FnZSA9IHtcbiAgICAgICAgaWQ6IG1lc3NhZ2VJZCxcbiAgICAgICAgY29udGVudDogdXBkYXRlTWVzc2FnZUR0by5jb250ZW50LFxuICAgICAgICBzZW5kZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGlzRWRpdGVkOiB0cnVlLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLnVwZGF0ZU1lc3NhZ2UubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tVcGRhdGVkTWVzc2FnZSBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZU1lc3NhZ2UoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgIHVwZGF0ZU1lc3NhZ2VEdG8sXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWVzc2FnaW5nU2VydmljZS51cGRhdGVNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgdXBkYXRlTWVzc2FnZUR0byxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVcGRhdGVkTWVzc2FnZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmF1dGhvcml6ZWQgbWVzc2FnZSB1cGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLnVwZGF0ZU1lc3NhZ2UubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ0Nhbm5vdCBlZGl0IG1lc3NhZ2UgZnJvbSBhbm90aGVyIHVzZXInKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci51cGRhdGVNZXNzYWdlKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgICB1cGRhdGVNZXNzYWdlRHRvLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZU1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZUlkID0gJ21lc3NhZ2UtMTIzJztcblxuICAgIGl0KCdzaG91bGQgZGVsZXRlIG1lc3NhZ2Ugc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbWVzc2FnaW5nU2VydmljZS5kZWxldGVNZXNzYWdlLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZGVsZXRlTWVzc2FnZShcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXNzYWdpbmdTZXJ2aWNlLmRlbGV0ZU1lc3NhZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBzdWNjZXNzOiB0cnVlIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWVzc2FnZSBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLmRlbGV0ZU1lc3NhZ2UubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignTWVzc2FnZSBub3QgZm91bmQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5kZWxldGVNZXNzYWdlKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBtZXNzYWdlSWQpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWFya01lc3NhZ2VBc1JlYWQnLCAoKSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZUlkID0gJ21lc3NhZ2UtMTIzJztcblxuICAgIGl0KCdzaG91bGQgbWFyayBtZXNzYWdlIGFzIHJlYWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVhZFJlY2VpcHQgPSB7XG4gICAgICAgIGlkOiAncmVjZWlwdC0xMjMnLFxuICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHJlYWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2UubWFya01lc3NhZ2VBc1JlYWQubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tSZWFkUmVjZWlwdCBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLm1hcmtNZXNzYWdlQXNSZWFkKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1lc3NhZ2luZ1NlcnZpY2UubWFya01lc3NhZ2VBc1JlYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1JlYWRSZWNlaXB0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FkZE1lc3NhZ2VSZWFjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBtZXNzYWdlSWQgPSAnbWVzc2FnZS0xMjMnO1xuICAgIGNvbnN0IGFkZFJlYWN0aW9uRHRvID0geyBlbW9qaTogJ+KdpO+4jycgfTtcblxuICAgIGl0KCdzaG91bGQgYWRkIHJlYWN0aW9uIHRvIG1lc3NhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVhY3Rpb24gPSB7XG4gICAgICAgIGlkOiAncmVhY3Rpb24tMTIzJyxcbiAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBlbW9qaTogYWRkUmVhY3Rpb25EdG8uZW1vamksXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2UuYWRkTWVzc2FnZVJlYWN0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrUmVhY3Rpb24gYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5hZGRNZXNzYWdlUmVhY3Rpb24oXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgIGFkZFJlYWN0aW9uRHRvLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1lc3NhZ2luZ1NlcnZpY2UuYWRkTWVzc2FnZVJlYWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgYWRkUmVhY3Rpb25EdG8uZW1vamksXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVhY3Rpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZHVwbGljYXRlIHJlYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2UuYWRkTWVzc2FnZVJlYWN0aW9uLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignUmVhY3Rpb24gYWxyZWFkeSBleGlzdHMnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5hZGRNZXNzYWdlUmVhY3Rpb24oXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgbWVzc2FnZUlkLFxuICAgICAgICAgIGFkZFJlYWN0aW9uRHRvLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZW1vdmVNZXNzYWdlUmVhY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZUlkID0gJ21lc3NhZ2UtMTIzJztcbiAgICBjb25zdCBlbW9qaSA9ICfinaTvuI8nO1xuXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgcmVhY3Rpb24gZnJvbSBtZXNzYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbWVzc2FnaW5nU2VydmljZS5yZW1vdmVNZXNzYWdlUmVhY3Rpb24ubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZW1vdmVNZXNzYWdlUmVhY3Rpb24oXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBtZXNzYWdlSWQsXG4gICAgICAgIGVtb2ppLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1lc3NhZ2luZ1NlcnZpY2UucmVtb3ZlTWVzc2FnZVJlYWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIG1lc3NhZ2VJZCxcbiAgICAgICAgZW1vamksXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdibG9ja1VzZXInLCAoKSA9PiB7XG4gICAgY29uc3QgYmxvY2tVc2VyRHRvID0ge1xuICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgIHJlYXNvbjogJ0luYXBwcm9wcmlhdGUgYmVoYXZpb3InLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGJsb2NrIHVzZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0Jsb2NrID0ge1xuICAgICAgICBpZDogJ2Jsb2NrLTEyMycsXG4gICAgICAgIGJsb2NrZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGJsb2NrZWRJZDogYmxvY2tVc2VyRHRvLnVzZXJJZCxcbiAgICAgICAgcmVhc29uOiBibG9ja1VzZXJEdG8ucmVhc29uLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLmJsb2NrVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQmxvY2sgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5ibG9ja1VzZXIoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBibG9ja1VzZXJEdG8sXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobWVzc2FnaW5nU2VydmljZS5ibG9ja1VzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgYmxvY2tVc2VyRHRvLnVzZXJJZCxcbiAgICAgICAgYmxvY2tVc2VyRHRvLnJlYXNvbixcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tCbG9jayk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZWxmLWJsb2NraW5nIGF0dGVtcHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZWxmQmxvY2tEdG8gPSB7XG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHJlYXNvbjogJ1NlbGYtYmxvY2sgYXR0ZW1wdCcsXG4gICAgICB9O1xuXG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLmJsb2NrVXNlci5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0Nhbm5vdCBibG9jayB5b3Vyc2VsZicpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmJsb2NrVXNlcihURVNUX1VTRVJfSURTLkNMSUVOVCwgc2VsZkJsb2NrRHRvKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndW5ibG9ja1VzZXInLCAoKSA9PiB7XG4gICAgY29uc3QgYmxvY2tlZFVzZXJJZCA9IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUO1xuXG4gICAgaXQoJ3Nob3VsZCB1bmJsb2NrIHVzZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbWVzc2FnaW5nU2VydmljZS51bmJsb2NrVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVuYmxvY2tVc2VyKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgYmxvY2tlZFVzZXJJZCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXNzYWdpbmdTZXJ2aWNlLnVuYmxvY2tVc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGJsb2NrZWRVc2VySWQsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmJsb2NraW5nIG5vbi1ibG9ja2VkIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtZXNzYWdpbmdTZXJ2aWNlLnVuYmxvY2tVc2VyLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgaXMgbm90IGJsb2NrZWQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci51bmJsb2NrVXNlcihURVNUX1VTRVJfSURTLkNMSUVOVCwgYmxvY2tlZFVzZXJJZCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZWFyY2hNZXNzYWdlcycsICgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hEdG8gPSB7XG4gICAgICBxdWVyeTogJ3RoZXJhcHkgc2Vzc2lvbicsXG4gICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnZlcnNhdGlvbi0xMjMnLFxuICAgICAgcGFnZTogJzEnLFxuICAgICAgbGltaXQ6ICcxMCcsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgc2VhcmNoIG1lc3NhZ2VzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTZWFyY2hSZXN1bHRzID0ge1xuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZU1lc3NhZ2Uoe1xuICAgICAgICAgICAgY29udGVudDogJ091ciBuZXh0IHRoZXJhcHkgc2Vzc2lvbiBpcyBzY2hlZHVsZWQnLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgICB0b3RhbDogMSxcbiAgICAgICAgcGFnZTogMSxcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgfTtcblxuICAgICAgbWVzc2FnaW5nU2VydmljZS5zZWFyY2hNZXNzYWdlcy5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja1NlYXJjaFJlc3VsdHMgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5zZWFyY2hNZXNzYWdlcyhcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHNlYXJjaER0byxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXNzYWdpbmdTZXJ2aWNlLnNlYXJjaE1lc3NhZ2VzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHNlYXJjaER0by5xdWVyeSxcbiAgICAgICAgc2VhcmNoRHRvLmNvbnZlcnNhdGlvbklkLFxuICAgICAgICAxLFxuICAgICAgICAxMCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tTZWFyY2hSZXN1bHRzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlYXJjaCB3aXRoIG1pbmltYWwgcGFyYW1ldGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1pbmltYWxTZWFyY2hEdG8gPSB7XG4gICAgICAgIHF1ZXJ5OiAnaGVsbG8nLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1NlYXJjaFJlc3VsdHMgPSB7XG4gICAgICAgIG1lc3NhZ2VzOiBbXSxcbiAgICAgICAgdG90YWw6IDAsXG4gICAgICAgIHBhZ2U6IDEsXG4gICAgICAgIGxpbWl0OiAyMCxcbiAgICAgIH07XG5cbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2Uuc2VhcmNoTWVzc2FnZXMubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tTZWFyY2hSZXN1bHRzIGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuc2VhcmNoTWVzc2FnZXMoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBtaW5pbWFsU2VhcmNoRHRvIGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtZXNzYWdpbmdTZXJ2aWNlLnNlYXJjaE1lc3NhZ2VzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICdoZWxsbycsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgMSwgLy8gZGVmYXVsdCBwYWdlXG4gICAgICAgIDIwLCAvLyBkZWZhdWx0IGxpbWl0XG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU2VhcmNoUmVzdWx0cyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBzZWFyY2ggcXVlcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbXB0eVNlYXJjaER0byA9IHtcbiAgICAgICAgcXVlcnk6ICcnLFxuICAgICAgfTtcblxuICAgICAgbWVzc2FnaW5nU2VydmljZS5zZWFyY2hNZXNzYWdlcy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1NlYXJjaCBxdWVyeSBjYW5ub3QgYmUgZW1wdHknKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5zZWFyY2hNZXNzYWdlcyhURVNUX1VTRVJfSURTLkNMSUVOVCwgZW1wdHlTZWFyY2hEdG8gYXMgYW55KSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWVzc2FnaW5nIGZsb3cgaW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgY29udmVyc2F0aW9uIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gMS4gQ3JlYXRlIGNvbnZlcnNhdGlvblxuICAgICAgY29uc3QgY3JlYXRlQ29udmVyc2F0aW9uRHRvID0ge1xuICAgICAgICBwYXJ0aWNpcGFudElkczogW1RFU1RfVVNFUl9JRFMuVEhFUkFQSVNUXSxcbiAgICAgICAgdHlwZTogJ0RJUkVDVCcgYXMgY29uc3QsXG4gICAgICAgIHRpdGxlOiAnVGhlcmFweSBTZXNzaW9uJyxcbiAgICAgIH07XG4gICAgICBjb25zdCBtb2NrQ29udmVyc2F0aW9uID0ge1xuICAgICAgICBpZDogJ2NvbnZlcnNhdGlvbi0xMjMnLFxuICAgICAgICAuLi5jcmVhdGVDb252ZXJzYXRpb25EdG8sXG4gICAgICB9O1xuICAgICAgbWVzc2FnaW5nU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24ubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDb252ZXJzYXRpb24gYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gMi4gU2VuZCBtZXNzYWdlXG4gICAgICBjb25zdCBzZW5kTWVzc2FnZUR0byA9IHtcbiAgICAgICAgY29udGVudDogJ0hlbGxvLCBsb29raW5nIGZvcndhcmQgdG8gb3VyIHNlc3Npb24nLFxuICAgICAgICBtZXNzYWdlVHlwZTogJ1RFWFQnIGFzIGNvbnN0LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IG1vY2tNZXNzYWdlID0ge1xuICAgICAgICBpZDogJ21lc3NhZ2UtMTIzJyxcbiAgICAgICAgLi4uc2VuZE1lc3NhZ2VEdG8sXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBtb2NrQ29udmVyc2F0aW9uLmlkLFxuICAgICAgfTtcbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2Uuc2VuZE1lc3NhZ2UubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lc3NhZ2UgYXMgYW55KTtcblxuICAgICAgLy8gMy4gTWFyayBhcyByZWFkXG4gICAgICBjb25zdCBtb2NrUmVhZFJlY2VpcHQgPSB7XG4gICAgICAgIGlkOiAncmVjZWlwdC0xMjMnLFxuICAgICAgICBtZXNzYWdlSWQ6IG1vY2tNZXNzYWdlLmlkLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgfTtcbiAgICAgIG1lc3NhZ2luZ1NlcnZpY2UubWFya01lc3NhZ2VBc1JlYWQubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tSZWFkUmVjZWlwdCBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICAvLyBFeGVjdXRlIHdvcmtmbG93XG4gICAgICBjb25zdCBjb252ZXJzYXRpb24gPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZUNvbnZlcnNhdGlvbihcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNyZWF0ZUNvbnZlcnNhdGlvbkR0byxcbiAgICAgICk7XG4gICAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgY29udHJvbGxlci5zZW5kTWVzc2FnZShcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGNvbnZlcnNhdGlvbi5pZCxcbiAgICAgICAgc2VuZE1lc3NhZ2VEdG8sXG4gICAgICApO1xuICAgICAgY29uc3QgcmVhZFJlY2VpcHQgPSBhd2FpdCBjb250cm9sbGVyLm1hcmtNZXNzYWdlQXNSZWFkKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgbWVzc2FnZS5pZCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChjb252ZXJzYXRpb24pLnRvRXF1YWwobW9ja0NvbnZlcnNhdGlvbik7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9FcXVhbChtb2NrTWVzc2FnZSk7XG4gICAgICBleHBlY3QocmVhZFJlY2VpcHQpLnRvRXF1YWwobW9ja1JlYWRSZWNlaXB0KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==