{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport {\n  HttpStatus,\n  BadRequestException,\n  ForbiddenException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { MessagingController } from './messaging.controller';\nimport { MessagingService } from './messaging.service';\nimport {\n  createMockPrismaService,\n  TEST_USER_IDS,\n} from '../test-utils';\nimport {\n  MockBuilder,\n  TestDataGenerator,\n  TestAssertions,\n} from '../test-utils/enhanced-test-helpers';\n\ndescribe('MessagingController', () => {\n  let controller: MessagingController;\n  let messagingService: jest.Mocked<MessagingService>;\n\n  const mockMessagingService = {\n    createConversation: jest.fn(),\n    getUserConversations: jest.fn(),\n    getConversationMessages: jest.fn(),\n    sendMessage: jest.fn(),\n    updateMessage: jest.fn(),\n    deleteMessage: jest.fn(),\n    markMessageAsRead: jest.fn(),\n    addMessageReaction: jest.fn(),\n    removeMessageReaction: jest.fn(),\n    blockUser: jest.fn(),\n    unblockUser: jest.fn(),\n    searchMessages: jest.fn(),\n  };\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      controllers: [MessagingController],\n      providers: [\n        { provide: MessagingService, useValue: mockMessagingService },\n      ],\n    }).compile();\n\n    controller = module.get<MessagingController>(MessagingController);\n    messagingService = module.get(MessagingService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('createConversation', () => {\n    const createConversationDto = {\n      participantIds: [TEST_USER_IDS.THERAPIST],\n      type: 'DIRECT' as const,\n      title: 'Therapy Session Chat',\n    };\n\n    it('should create a new conversation', async () => {\n      const mockConversation = {\n        id: 'conversation-123',\n        ...createConversationDto,\n        createdBy: TEST_USER_IDS.CLIENT,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n\n      messagingService.createConversation.mockResolvedValue(\n        mockConversation as any,\n      );\n\n      const result = await controller.createConversation(\n        TEST_USER_IDS.CLIENT,\n        createConversationDto,\n      );\n\n      expect(messagingService.createConversation).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        createConversationDto,\n      );\n      expect(result).toEqual(mockConversation);\n    });\n\n    it('should handle conversation creation errors', async () => {\n      messagingService.createConversation.mockRejectedValue(\n        new BadRequestException('Invalid participant IDs'),\n      );\n\n      await expect(\n        controller.createConversation(\n          TEST_USER_IDS.CLIENT,\n          createConversationDto,\n        ),\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('getUserConversations', () => {\n    it('should return user conversations with default pagination', async () => {\n      const mockConversations = [\n        {\n          id: 'conv-1',\n          title: 'Therapy Chat',\n          lastMessage: TestDataGenerator.createMessage(),\n          participants: [TEST_USER_IDS.CLIENT, TEST_USER_IDS.THERAPIST],\n        },\n        {\n          id: 'conv-2',\n          title: 'Support Group',\n          lastMessage: TestDataGenerator.createMessage(),\n          participants: [TEST_USER_IDS.CLIENT, TEST_USER_IDS.MODERATOR],\n        },\n      ];\n\n      messagingService.getUserConversations.mockResolvedValue(\n        mockConversations as any,\n      );\n\n      const result = await controller.getUserConversations(TEST_USER_IDS.CLIENT);\n\n      expect(messagingService.getUserConversations).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        1, // default page\n        20, // default limit\n      );\n      expect(result).toEqual(mockConversations);\n    });\n\n    it('should handle custom pagination parameters', async () => {\n      const mockConversations = [];\n      messagingService.getUserConversations.mockResolvedValue(\n        mockConversations as any,\n      );\n\n      await controller.getUserConversations(\n        TEST_USER_IDS.CLIENT,\n        '2', // page\n        '10', // limit\n      );\n\n      expect(messagingService.getUserConversations).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        2,\n        10,\n      );\n    });\n\n    it('should handle invalid pagination parameters gracefully', async () => {\n      const mockConversations = [];\n      messagingService.getUserConversations.mockResolvedValue(\n        mockConversations as any,\n      );\n\n      await controller.getUserConversations(\n        TEST_USER_IDS.CLIENT,\n        'invalid', // should default to 1\n        'invalid', // should default to 20\n      );\n\n      expect(messagingService.getUserConversations).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        1, // NaN becomes 1\n        20, // NaN becomes 20\n      );\n    });\n  });\n\n  describe('getConversationMessages', () => {\n    const conversationId = 'conversation-123';\n\n    it('should return conversation messages', async () => {\n      const mockMessages = [\n        TestDataGenerator.createMessage({ conversationId }),\n        TestDataGenerator.createMessage({ conversationId }),\n      ];\n\n      messagingService.getConversationMessages.mockResolvedValue(\n        mockMessages as any,\n      );\n\n      const result = await controller.getConversationMessages(\n        TEST_USER_IDS.CLIENT,\n        conversationId,\n      );\n\n      expect(messagingService.getConversationMessages).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        conversationId,\n        1, // default page\n        50, // default limit for messages\n      );\n      expect(result).toEqual(mockMessages);\n    });\n\n    it('should handle unauthorized access to conversation', async () => {\n      messagingService.getConversationMessages.mockRejectedValue(\n        new ForbiddenException('Not a participant in this conversation'),\n      );\n\n      await expect(\n        controller.getConversationMessages(\n          TEST_USER_IDS.CLIENT,\n          conversationId,\n        ),\n      ).rejects.toThrow(ForbiddenException);\n    });\n  });\n\n  describe('sendMessage', () => {\n    const conversationId = 'conversation-123';\n    const sendMessageDto = {\n      content: 'Hello, how are you feeling today?',\n      messageType: 'TEXT' as const,\n    };\n\n    it('should send a message successfully', async () => {\n      const mockMessage = {\n        id: 'message-123',\n        ...sendMessageDto,\n        senderId: TEST_USER_IDS.CLIENT,\n        conversationId,\n        createdAt: new Date(),\n        isEdited: false,\n        isDeleted: false,\n      };\n\n      messagingService.sendMessage.mockResolvedValue(mockMessage as any);\n\n      const result = await controller.sendMessage(\n        TEST_USER_IDS.CLIENT,\n        conversationId,\n        sendMessageDto,\n      );\n\n      expect(messagingService.sendMessage).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        conversationId,\n        sendMessageDto,\n      );\n      expect(result).toEqual(mockMessage);\n    });\n\n    it('should handle empty message content', async () => {\n      const emptyMessageDto = {\n        content: '',\n        messageType: 'TEXT' as const,\n      };\n\n      messagingService.sendMessage.mockRejectedValue(\n        new BadRequestException('Message content cannot be empty'),\n      );\n\n      await expect(\n        controller.sendMessage(\n          TEST_USER_IDS.CLIENT,\n          conversationId,\n          emptyMessageDto,\n        ),\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('updateMessage', () => {\n    const messageId = 'message-123';\n    const updateMessageDto = {\n      content: 'Updated message content',\n    };\n\n    it('should update message successfully', async () => {\n      const mockUpdatedMessage = {\n        id: messageId,\n        content: updateMessageDto.content,\n        senderId: TEST_USER_IDS.CLIENT,\n        isEdited: true,\n        updatedAt: new Date(),\n      };\n\n      messagingService.updateMessage.mockResolvedValue(\n        mockUpdatedMessage as any,\n      );\n\n      const result = await controller.updateMessage(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n        updateMessageDto,\n      );\n\n      expect(messagingService.updateMessage).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n        updateMessageDto,\n      );\n      expect(result).toEqual(mockUpdatedMessage);\n    });\n\n    it('should handle unauthorized message update', async () => {\n      messagingService.updateMessage.mockRejectedValue(\n        new ForbiddenException('Cannot edit message from another user'),\n      );\n\n      await expect(\n        controller.updateMessage(\n          TEST_USER_IDS.CLIENT,\n          messageId,\n          updateMessageDto,\n        ),\n      ).rejects.toThrow(ForbiddenException);\n    });\n  });\n\n  describe('deleteMessage', () => {\n    const messageId = 'message-123';\n\n    it('should delete message successfully', async () => {\n      messagingService.deleteMessage.mockResolvedValue({ success: true } as any);\n\n      const result = await controller.deleteMessage(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n      );\n\n      expect(messagingService.deleteMessage).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n      );\n      expect(result).toEqual({ success: true });\n    });\n\n    it('should handle message not found', async () => {\n      messagingService.deleteMessage.mockRejectedValue(\n        new NotFoundException('Message not found'),\n      );\n\n      await expect(\n        controller.deleteMessage(TEST_USER_IDS.CLIENT, messageId),\n      ).rejects.toThrow(NotFoundException);\n    });\n  });\n\n  describe('markMessageAsRead', () => {\n    const messageId = 'message-123';\n\n    it('should mark message as read', async () => {\n      const mockReadReceipt = {\n        id: 'receipt-123',\n        messageId,\n        userId: TEST_USER_IDS.CLIENT,\n        readAt: new Date(),\n      };\n\n      messagingService.markMessageAsRead.mockResolvedValue(\n        mockReadReceipt as any,\n      );\n\n      const result = await controller.markMessageAsRead(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n      );\n\n      expect(messagingService.markMessageAsRead).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n      );\n      expect(result).toEqual(mockReadReceipt);\n    });\n  });\n\n  describe('addMessageReaction', () => {\n    const messageId = 'message-123';\n    const addReactionDto = { emoji: '❤️' };\n\n    it('should add reaction to message', async () => {\n      const mockReaction = {\n        id: 'reaction-123',\n        messageId,\n        userId: TEST_USER_IDS.CLIENT,\n        emoji: addReactionDto.emoji,\n        createdAt: new Date(),\n      };\n\n      messagingService.addMessageReaction.mockResolvedValue(\n        mockReaction as any,\n      );\n\n      const result = await controller.addMessageReaction(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n        addReactionDto,\n      );\n\n      expect(messagingService.addMessageReaction).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n        addReactionDto.emoji,\n      );\n      expect(result).toEqual(mockReaction);\n    });\n\n    it('should handle duplicate reactions', async () => {\n      messagingService.addMessageReaction.mockRejectedValue(\n        new BadRequestException('Reaction already exists'),\n      );\n\n      await expect(\n        controller.addMessageReaction(\n          TEST_USER_IDS.CLIENT,\n          messageId,\n          addReactionDto,\n        ),\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('removeMessageReaction', () => {\n    const messageId = 'message-123';\n    const emoji = '❤️';\n\n    it('should remove reaction from message', async () => {\n      messagingService.removeMessageReaction.mockResolvedValue({ success: true } as any);\n\n      const result = await controller.removeMessageReaction(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n        emoji,\n      );\n\n      expect(messagingService.removeMessageReaction).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        messageId,\n        emoji,\n      );\n      expect(result).toEqual({ success: true });\n    });\n  });\n\n  describe('blockUser', () => {\n    const blockUserDto = {\n      userId: TEST_USER_IDS.THERAPIST,\n      reason: 'Inappropriate behavior',\n    };\n\n    it('should block user successfully', async () => {\n      const mockBlock = {\n        id: 'block-123',\n        blockerId: TEST_USER_IDS.CLIENT,\n        blockedId: blockUserDto.userId,\n        reason: blockUserDto.reason,\n        createdAt: new Date(),\n      };\n\n      messagingService.blockUser.mockResolvedValue(mockBlock as any);\n\n      const result = await controller.blockUser(\n        TEST_USER_IDS.CLIENT,\n        blockUserDto,\n      );\n\n      expect(messagingService.blockUser).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        blockUserDto.userId,\n        blockUserDto.reason,\n      );\n      expect(result).toEqual(mockBlock);\n    });\n\n    it('should handle self-blocking attempt', async () => {\n      const selfBlockDto = {\n        userId: TEST_USER_IDS.CLIENT,\n        reason: 'Self-block attempt',\n      };\n\n      messagingService.blockUser.mockRejectedValue(\n        new BadRequestException('Cannot block yourself'),\n      );\n\n      await expect(\n        controller.blockUser(TEST_USER_IDS.CLIENT, selfBlockDto),\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('unblockUser', () => {\n    const blockedUserId = TEST_USER_IDS.THERAPIST;\n\n    it('should unblock user successfully', async () => {\n      messagingService.unblockUser.mockResolvedValue({ success: true } as any);\n\n      const result = await controller.unblockUser(\n        TEST_USER_IDS.CLIENT,\n        blockedUserId,\n      );\n\n      expect(messagingService.unblockUser).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        blockedUserId,\n      );\n      expect(result).toEqual({ success: true });\n    });\n\n    it('should handle unblocking non-blocked user', async () => {\n      messagingService.unblockUser.mockRejectedValue(\n        new NotFoundException('User is not blocked'),\n      );\n\n      await expect(\n        controller.unblockUser(TEST_USER_IDS.CLIENT, blockedUserId),\n      ).rejects.toThrow(NotFoundException);\n    });\n  });\n\n  describe('searchMessages', () => {\n    const searchDto = {\n      query: 'therapy session',\n      conversationId: 'conversation-123',\n      page: '1',\n      limit: '10',\n    };\n\n    it('should search messages successfully', async () => {\n      const mockSearchResults = {\n        messages: [\n          TestDataGenerator.createMessage({\n            content: 'Our next therapy session is scheduled',\n          }),\n        ],\n        total: 1,\n        page: 1,\n        limit: 10,\n      };\n\n      messagingService.searchMessages.mockResolvedValue(\n        mockSearchResults as any,\n      );\n\n      const result = await controller.searchMessages(\n        TEST_USER_IDS.CLIENT,\n        searchDto,\n      );\n\n      expect(messagingService.searchMessages).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        searchDto.query,\n        searchDto.conversationId,\n        1,\n        10,\n      );\n      expect(result).toEqual(mockSearchResults);\n    });\n\n    it('should handle search with minimal parameters', async () => {\n      const minimalSearchDto = {\n        query: 'hello',\n      };\n\n      const mockSearchResults = {\n        messages: [],\n        total: 0,\n        page: 1,\n        limit: 20,\n      };\n\n      messagingService.searchMessages.mockResolvedValue(\n        mockSearchResults as any,\n      );\n\n      const result = await controller.searchMessages(\n        TEST_USER_IDS.CLIENT,\n        minimalSearchDto as any,\n      );\n\n      expect(messagingService.searchMessages).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        'hello',\n        undefined,\n        1, // default page\n        20, // default limit\n      );\n      expect(result).toEqual(mockSearchResults);\n    });\n\n    it('should handle empty search query', async () => {\n      const emptySearchDto = {\n        query: '',\n      };\n\n      messagingService.searchMessages.mockRejectedValue(\n        new BadRequestException('Search query cannot be empty'),\n      );\n\n      await expect(\n        controller.searchMessages(TEST_USER_IDS.CLIENT, emptySearchDto as any),\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('messaging flow integration', () => {\n    it('should handle complete conversation workflow', async () => {\n      // 1. Create conversation\n      const createConversationDto = {\n        participantIds: [TEST_USER_IDS.THERAPIST],\n        type: 'DIRECT' as const,\n        title: 'Therapy Session',\n      };\n      const mockConversation = {\n        id: 'conversation-123',\n        ...createConversationDto,\n      };\n      messagingService.createConversation.mockResolvedValue(\n        mockConversation as any,\n      );\n\n      // 2. Send message\n      const sendMessageDto = {\n        content: 'Hello, looking forward to our session',\n        messageType: 'TEXT' as const,\n      };\n      const mockMessage = {\n        id: 'message-123',\n        ...sendMessageDto,\n        conversationId: mockConversation.id,\n      };\n      messagingService.sendMessage.mockResolvedValue(mockMessage as any);\n\n      // 3. Mark as read\n      const mockReadReceipt = {\n        id: 'receipt-123',\n        messageId: mockMessage.id,\n        userId: TEST_USER_IDS.THERAPIST,\n      };\n      messagingService.markMessageAsRead.mockResolvedValue(\n        mockReadReceipt as any,\n      );\n\n      // Execute workflow\n      const conversation = await controller.createConversation(\n        TEST_USER_IDS.CLIENT,\n        createConversationDto,\n      );\n      const message = await controller.sendMessage(\n        TEST_USER_IDS.CLIENT,\n        conversation.id,\n        sendMessageDto,\n      );\n      const readReceipt = await controller.markMessageAsRead(\n        TEST_USER_IDS.THERAPIST,\n        message.id,\n      );\n\n      expect(conversation).toEqual(mockConversation);\n      expect(message).toEqual(mockMessage);\n      expect(readReceipt).toEqual(mockReadReceipt);\n    });\n  });\n});\n"],"version":3}