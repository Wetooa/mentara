{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/sessions/sessions.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/sessions/sessions.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  BadRequestException,\n} from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport {\n  SessionLog,\n  SessionStatus,\n  SessionType,\n  ActivityType,\n  UserActionType,\n} from '@prisma/client';\n\n@Injectable()\nexport class SessionsService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  async createSessionLog(data: {\n    clientId: string;\n    therapistId?: string;\n    sessionType: SessionType;\n    meetingId?: string;\n    platform?: string;\n    startTime?: Date;\n  }): Promise<SessionLog> {\n    return this.prisma.sessionLog.create({\n      data: {\n        ...data,\n        startTime: data.startTime || new Date(),\n        status: SessionStatus.IN_PROGRESS,\n      },\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n      },\n    });\n  }\n\n  async findAllSessions(\n    clientId?: string,\n    therapistId?: string,\n    status?: SessionStatus,\n    sessionType?: SessionType,\n  ): Promise<SessionLog[]> {\n    const where: any = {};\n\n    if (clientId) where.clientId = clientId;\n    if (therapistId) where.therapistId = therapistId;\n    if (status) where.status = status;\n    if (sessionType) where.sessionType = sessionType;\n\n    return this.prisma.sessionLog.findMany({\n      where,\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        activities: true,\n      },\n      orderBy: { startTime: 'desc' },\n    });\n  }\n\n  async findSession(id: string): Promise<SessionLog | null> {\n    return this.prisma.sessionLog.findUnique({\n      where: { id },\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        activities: {\n          orderBy: { timestamp: 'asc' },\n        },\n        meeting: true,\n      },\n    });\n  }\n\n  async updateSession(\n    id: string,\n    data: Partial<SessionLog>,\n  ): Promise<SessionLog> {\n    const session = await this.findSession(id);\n    if (!session) {\n      throw new NotFoundException(`Session with ID ${id} not found`);\n    }\n\n    return this.prisma.sessionLog.update({\n      where: { id },\n      data,\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n      },\n    });\n  }\n\n  async endSession(\n    id: string,\n    notes?: string,\n    quality?: number,\n  ): Promise<SessionLog> {\n    const session = await this.findSession(id);\n    if (!session) {\n      throw new NotFoundException(`Session with ID ${id} not found`);\n    }\n\n    if (session.status !== SessionStatus.IN_PROGRESS) {\n      throw new BadRequestException('Session is not in progress');\n    }\n\n    const endTime = new Date();\n    const duration = Math.floor(\n      (endTime.getTime() - session.startTime.getTime()) / 60000,\n    ); // minutes\n\n    return this.updateSession(id, {\n      endTime,\n      duration,\n      status: SessionStatus.COMPLETED,\n      notes,\n      quality,\n    });\n  }\n\n  async addSessionActivity(\n    sessionId: string,\n    activityType: ActivityType,\n    description?: string,\n    duration?: number,\n    metadata?: any,\n  ) {\n    const session = await this.findSession(sessionId);\n    if (!session) {\n      throw new NotFoundException(`Session with ID ${sessionId} not found`);\n    }\n\n    return this.prisma.sessionActivity.create({\n      data: {\n        sessionId,\n        activityType,\n        description,\n        duration,\n        metadata,\n      },\n    });\n  }\n\n  async getSessionActivities(sessionId: string) {\n    return this.prisma.sessionActivity.findMany({\n      where: { sessionId },\n      orderBy: { timestamp: 'asc' },\n    });\n  }\n\n  async logUserActivity(\n    userId: string,\n    action: UserActionType,\n    page?: string,\n    component?: string,\n    metadata?: any,\n    sessionId?: string,\n    deviceInfo?: any,\n  ) {\n    return this.prisma.userActivity.create({\n      data: {\n        userId,\n        action,\n        page,\n        component,\n        metadata,\n        sessionId,\n        deviceInfo,\n      },\n    });\n  }\n\n  async getUserActivities(\n    userId: string,\n    action?: UserActionType,\n    startDate?: Date,\n    endDate?: Date,\n  ) {\n    const where: any = { userId };\n\n    if (action) where.action = action;\n    if (startDate) where.timestamp = { ...where.timestamp, gte: startDate };\n    if (endDate) where.timestamp = { ...where.timestamp, lte: endDate };\n\n    return this.prisma.userActivity.findMany({\n      where,\n      orderBy: { timestamp: 'desc' },\n      take: 100, // Limit to recent activities\n    });\n  }\n\n  async createTherapyProgress(data: {\n    clientId: string;\n    therapistId: string;\n    progressScore: number;\n    improvementAreas?: string[];\n    concernAreas?: string[];\n    goalsSet?: any;\n    goalsAchieved?: any;\n    nextMilestones?: any;\n    moodScore?: number;\n    anxietyScore?: number;\n    depressionScore?: number;\n    functionalScore?: number;\n    therapistNotes?: string;\n    clientFeedback?: string;\n    recommendations?: string[];\n  }) {\n    return this.prisma.therapyProgress.create({\n      data,\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n      },\n    });\n  }\n\n  async getTherapyProgress(\n    clientId?: string,\n    therapistId?: string,\n    startDate?: Date,\n    endDate?: Date,\n  ) {\n    const where: any = {};\n\n    if (clientId) where.clientId = clientId;\n    if (therapistId) where.therapistId = therapistId;\n    if (startDate)\n      where.assessmentDate = { ...where.assessmentDate, gte: startDate };\n    if (endDate)\n      where.assessmentDate = { ...where.assessmentDate, lte: endDate };\n\n    return this.prisma.therapyProgress.findMany({\n      where,\n      include: {\n        client: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n        therapist: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n        },\n      },\n      orderBy: { assessmentDate: 'desc' },\n    });\n  }\n\n  async getSessionStatistics(clientId?: string, therapistId?: string) {\n    const where: any = {};\n    if (clientId) where.clientId = clientId;\n    if (therapistId) where.therapistId = therapistId;\n\n    const [totalSessions, completedSessions, averageDuration, sessionsByType] =\n      await Promise.all([\n        this.prisma.sessionLog.count({ where }),\n        this.prisma.sessionLog.count({\n          where: { ...where, status: SessionStatus.COMPLETED },\n        }),\n        this.prisma.sessionLog.aggregate({\n          where: { ...where, status: SessionStatus.COMPLETED },\n          _avg: { duration: true },\n        }),\n        this.prisma.sessionLog.groupBy({\n          by: ['sessionType'],\n          where,\n          _count: { sessionType: true },\n        }),\n      ]);\n\n    return {\n      totalSessions,\n      completedSessions,\n      averageDuration: averageDuration._avg.duration || 0,\n      sessionsByType,\n      completionRate:\n        totalSessions > 0 ? (completedSessions / totalSessions) * 100 : 0,\n    };\n  }\n}\n"],"version":3}