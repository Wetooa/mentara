{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.controller.spec.ts"],"sourcesContent":["/**\n * Comprehensive Test Suite for BillingController\n * Tests all billing endpoints including subscriptions, payments, invoices, and discounts\n */\n\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { UnauthorizedException } from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { BillingController } from './billing.controller';\nimport { BillingService } from './billing.service';\nimport { SecurityGuardTestUtils, RoleBasedTestUtils } from '../test-utils/auth-testing-helpers';\nimport { MockBuilder, TestDataGenerator, TestAssertions } from '../test-utils/enhanced-test-helpers';\nimport { TEST_USER_IDS, TEST_EMAILS } from '../test-utils/index';\n\ndescribe('BillingController', () => {\n  let controller: BillingController;\n  let billingService: BillingService;\n  let module: TestingModule;\n\n  // Mock BillingService\n  const mockBillingService = {\n    createSubscription: jest.fn(),\n    findUserSubscription: jest.fn(),\n    updateSubscription: jest.fn(),\n    cancelSubscription: jest.fn(),\n    changeSubscriptionPlan: jest.fn(),\n    pauseSubscription: jest.fn(),\n    resumeSubscription: jest.fn(),\n    scheduleSubscriptionCancellation: jest.fn(),\n    reactivateSubscription: jest.fn(),\n    applyDiscountToSubscription: jest.fn(),\n    processSubscriptionRenewal: jest.fn(),\n    getSubscriptionUsageAnalytics: jest.fn(),\n    findAllPlans: jest.fn(),\n    createSubscriptionPlan: jest.fn(),\n    updatePlan: jest.fn(),\n    createPaymentMethod: jest.fn(),\n    findUserPaymentMethods: jest.fn(),\n    updatePaymentMethod: jest.fn(),\n    deletePaymentMethod: jest.fn(),\n    createPayment: jest.fn(),\n    findPayments: jest.fn(),\n    updatePaymentStatus: jest.fn(),\n    createInvoice: jest.fn(),\n    findInvoices: jest.fn(),\n    markInvoiceAsPaid: jest.fn(),\n    createDiscount: jest.fn(),\n    validateDiscount: jest.fn(),\n    redeemDiscount: jest.fn(),\n    recordUsage: jest.fn(),\n    getUsageRecords: jest.fn(),\n    getBillingStatistics: jest.fn(),\n  };\n\n  // Mock JwtAuthGuard\n  const mockJwtAuthGuard = {\n    canActivate: jest.fn().mockReturnValue(true),\n  };\n\n  // Test data\n  const mockSubscription = {\n    id: 'sub_123456789',\n    userId: TEST_USER_IDS.CLIENT,\n    planId: 'plan_basic_monthly',\n    status: 'active',\n    currentPeriodStart: new Date(),\n    currentPeriodEnd: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockPlan = {\n    id: 'plan_basic_monthly',\n    name: 'Basic Monthly',\n    description: 'Basic plan with monthly billing',\n    amount: 29.99,\n    currency: 'USD',\n    interval: 'month',\n    intervalCount: 1,\n    isActive: true,\n    features: ['therapy_sessions', 'basic_support'],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockPaymentMethod = {\n    id: 'pm_123456789',\n    userId: TEST_USER_IDS.CLIENT,\n    type: 'card',\n    isDefault: true,\n    last4: '4242',\n    brand: 'visa',\n    expiryMonth: 12,\n    expiryYear: 2025,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockPayment = {\n    id: 'pay_123456789',\n    subscriptionId: 'sub_123456789',\n    amount: 29.99,\n    currency: 'USD',\n    status: 'succeeded',\n    paymentMethodId: 'pm_123456789',\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockInvoice = {\n    id: 'inv_123456789',\n    subscriptionId: 'sub_123456789',\n    amount: 29.99,\n    currency: 'USD',\n    status: 'paid',\n    dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockDiscount = {\n    id: 'disc_123456789',\n    code: 'SAVE20',\n    type: 'percentage',\n    value: 20,\n    isActive: true,\n    usageLimit: 100,\n    usageCount: 0,\n    validFrom: new Date(),\n    validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  beforeEach(async () => {\n    module = await Test.createTestingModule({\n      controllers: [BillingController],\n      providers: [\n        {\n          provide: BillingService,\n          useValue: mockBillingService,\n        },\n      ],\n    })\n      .overrideGuard(JwtAuthGuard)\n      .useValue(mockJwtAuthGuard)\n      .compile();\n\n    controller = module.get<BillingController>(BillingController);\n    billingService = module.get<BillingService>(BillingService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Controller Initialization', () => {\n    it('should be defined', () => {\n      expect(controller).toBeDefined();\n    });\n\n    it('should have billingService injected', () => {\n      expect(billingService).toBeDefined();\n    });\n  });\n\n  describe('Security Guards', () => {\n    it('should be protected by JwtAuthGuard', () => {\n      const guards = Reflect.getMetadata('__guards__', BillingController);\n      expect(guards).toContain(JwtAuthGuard);\n    });\n\n    it('should have proper route decorators', () => {\n      const controllerMetadata = Reflect.getMetadata('path', BillingController);\n      expect(controllerMetadata).toBe('billing');\n    });\n  });\n\n  describe('Subscription Management', () => {\n    describe('POST /billing/subscriptions', () => {\n      const createSubscriptionDto = {\n        planId: 'plan_basic_monthly',\n        paymentMethodId: 'pm_123456789',\n        trialStart: '2024-01-01T00:00:00.000Z',\n        trialEnd: '2024-01-14T23:59:59.999Z',\n      };\n\n      it('should create subscription successfully', async () => {\n        mockBillingService.createSubscription.mockResolvedValue(mockSubscription);\n\n        const result = await controller.createSubscription(\n          createSubscriptionDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(mockSubscription);\n        expect(billingService.createSubscription).toHaveBeenCalledWith({\n          ...createSubscriptionDto,\n          userId: TEST_USER_IDS.CLIENT,\n          trialStart: new Date(createSubscriptionDto.trialStart),\n          trialEnd: new Date(createSubscriptionDto.trialEnd),\n        });\n      });\n\n      it('should handle subscription creation without trial dates', async () => {\n        const basicDto = {\n          planId: 'plan_basic_monthly',\n          paymentMethodId: 'pm_123456789',\n        };\n        mockBillingService.createSubscription.mockResolvedValue(mockSubscription);\n\n        const result = await controller.createSubscription(\n          basicDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(mockSubscription);\n        expect(billingService.createSubscription).toHaveBeenCalledWith({\n          ...basicDto,\n          userId: TEST_USER_IDS.CLIENT,\n          trialStart: undefined,\n          trialEnd: undefined,\n        });\n      });\n\n      it('should handle service errors', async () => {\n        const serviceError = new Error('Payment method not found');\n        mockBillingService.createSubscription.mockRejectedValue(serviceError);\n\n        await expect(\n          controller.createSubscription(createSubscriptionDto, TEST_USER_IDS.CLIENT)\n        ).rejects.toThrow(serviceError);\n      });\n    });\n\n    describe('GET /billing/subscriptions/me', () => {\n      it('should get user subscription successfully', async () => {\n        mockBillingService.findUserSubscription.mockResolvedValue(mockSubscription);\n\n        const result = await controller.getMySubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result).toEqual(mockSubscription);\n        expect(billingService.findUserSubscription).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      });\n\n      it('should handle subscription not found', async () => {\n        mockBillingService.findUserSubscription.mockResolvedValue(null);\n\n        const result = await controller.getMySubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result).toBeNull();\n      });\n    });\n\n    describe('PATCH /billing/subscriptions/me', () => {\n      const updateDto = {\n        billingCycle: 'monthly' as const,\n        autoRenew: true,\n      };\n\n      it('should update subscription successfully', async () => {\n        const updatedSubscription = { ...mockSubscription, ...updateDto };\n        mockBillingService.updateSubscription.mockResolvedValue(updatedSubscription);\n\n        const result = await controller.updateMySubscription(\n          updateDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(updatedSubscription);\n        expect(billingService.updateSubscription).toHaveBeenCalledWith(\n          TEST_USER_IDS.CLIENT,\n          updateDto\n        );\n      });\n    });\n\n    describe('POST /billing/subscriptions/me/cancel', () => {\n      const cancelDto = {\n        reason: 'No longer needed',\n        cancelAtPeriodEnd: true,\n      };\n\n      it('should cancel subscription successfully', async () => {\n        const cancelledSubscription = { ...mockSubscription, status: 'canceled' };\n        mockBillingService.cancelSubscription.mockResolvedValue(cancelledSubscription);\n\n        const result = await controller.cancelMySubscription(\n          cancelDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(cancelledSubscription);\n        expect(billingService.cancelSubscription).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      });\n    });\n\n    describe('POST /billing/subscriptions/me/change-plan', () => {\n      const changePlanDto = {\n        newPlanId: 'plan_premium_monthly',\n        billingCycle: 'monthly' as const,\n        prorationBehavior: 'always_invoice' as const,\n        effectiveDate: '2024-01-01T00:00:00.000Z',\n      };\n\n      it('should change subscription plan successfully', async () => {\n        const updatedSubscription = { ...mockSubscription, planId: changePlanDto.newPlanId };\n        mockBillingService.changeSubscriptionPlan.mockResolvedValue(updatedSubscription);\n\n        const result = await controller.changeMySubscriptionPlan(\n          changePlanDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(updatedSubscription);\n        expect(billingService.changeSubscriptionPlan).toHaveBeenCalledWith(\n          TEST_USER_IDS.CLIENT,\n          changePlanDto.newPlanId,\n          {\n            billingCycle: changePlanDto.billingCycle,\n            prorationBehavior: changePlanDto.prorationBehavior,\n            effectiveDate: new Date(changePlanDto.effectiveDate),\n          }\n        );\n      });\n    });\n\n    describe('POST /billing/subscriptions/me/pause', () => {\n      const pauseDto = {\n        pauseUntil: '2024-02-01T00:00:00.000Z',\n        reason: 'Temporary break',\n      };\n\n      it('should pause subscription successfully', async () => {\n        const pausedSubscription = { ...mockSubscription, status: 'paused' };\n        mockBillingService.pauseSubscription.mockResolvedValue(pausedSubscription);\n\n        const result = await controller.pauseMySubscription(\n          pauseDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(pausedSubscription);\n        expect(billingService.pauseSubscription).toHaveBeenCalledWith(\n          TEST_USER_IDS.CLIENT,\n          {\n            pauseUntil: new Date(pauseDto.pauseUntil),\n            reason: pauseDto.reason,\n          }\n        );\n      });\n    });\n\n    describe('POST /billing/subscriptions/me/resume', () => {\n      it('should resume subscription successfully', async () => {\n        const resumedSubscription = { ...mockSubscription, status: 'active' };\n        mockBillingService.resumeSubscription.mockResolvedValue(resumedSubscription);\n\n        const result = await controller.resumeMySubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result).toEqual(resumedSubscription);\n        expect(billingService.resumeSubscription).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      });\n    });\n  });\n\n  describe('Plan Management', () => {\n    describe('GET /billing/plans', () => {\n      it('should get all active plans by default', async () => {\n        const mockPlans = [mockPlan];\n        mockBillingService.findAllPlans.mockResolvedValue(mockPlans);\n\n        const result = await controller.getAllPlans({});\n\n        expect(result).toEqual(mockPlans);\n        expect(billingService.findAllPlans).toHaveBeenCalledWith(true);\n      });\n\n      it('should get all plans including inactive when specified', async () => {\n        const mockPlans = [mockPlan, { ...mockPlan, isActive: false }];\n        mockBillingService.findAllPlans.mockResolvedValue(mockPlans);\n\n        const result = await controller.getAllPlans({ isActive: false });\n\n        expect(result).toEqual(mockPlans);\n        expect(billingService.findAllPlans).toHaveBeenCalledWith(false);\n      });\n    });\n\n    describe('POST /billing/plans', () => {\n      const createPlanDto = {\n        name: 'Premium Monthly',\n        description: 'Premium plan with monthly billing',\n        amount: 99.99,\n        currency: 'USD',\n        interval: 'month' as const,\n        intervalCount: 1,\n        features: ['unlimited_sessions', 'priority_support'],\n      };\n\n      it('should create plan as admin', async () => {\n        mockBillingService.createSubscriptionPlan.mockResolvedValue(mockPlan);\n\n        const result = await controller.createPlan(createPlanDto, 'admin');\n\n        expect(result).toEqual(mockPlan);\n        expect(billingService.createSubscriptionPlan).toHaveBeenCalledWith(createPlanDto);\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.createPlan(createPlanDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n\n    describe('PATCH /billing/plans/:id', () => {\n      const updatePlanDto = {\n        name: 'Updated Premium Monthly',\n        amount: 79.99,\n      };\n\n      it('should update plan as admin', async () => {\n        const updatedPlan = { ...mockPlan, ...updatePlanDto };\n        mockBillingService.updatePlan.mockResolvedValue(updatedPlan);\n\n        const result = await controller.updatePlan('plan_123', updatePlanDto, 'admin');\n\n        expect(result).toEqual(updatedPlan);\n        expect(billingService.updatePlan).toHaveBeenCalledWith('plan_123', updatePlanDto);\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.updatePlan('plan_123', updatePlanDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n  });\n\n  describe('Payment Method Management', () => {\n    describe('POST /billing/payment-methods', () => {\n      const createPaymentMethodDto = {\n        type: 'card' as const,\n        cardToken: 'tok_visa',\n        isDefault: true,\n      };\n\n      it('should create payment method successfully', async () => {\n        mockBillingService.createPaymentMethod.mockResolvedValue(mockPaymentMethod);\n\n        const result = await controller.createPaymentMethod(\n          createPaymentMethodDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(mockPaymentMethod);\n        expect(billingService.createPaymentMethod).toHaveBeenCalledWith({\n          ...createPaymentMethodDto,\n          userId: TEST_USER_IDS.CLIENT,\n        });\n      });\n    });\n\n    describe('GET /billing/payment-methods', () => {\n      it('should get user payment methods', async () => {\n        const mockPaymentMethods = [mockPaymentMethod];\n        mockBillingService.findUserPaymentMethods.mockResolvedValue(mockPaymentMethods);\n\n        const result = await controller.getMyPaymentMethods(TEST_USER_IDS.CLIENT);\n\n        expect(result).toEqual(mockPaymentMethods);\n        expect(billingService.findUserPaymentMethods).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      });\n    });\n\n    describe('PATCH /billing/payment-methods/:id', () => {\n      const updatePaymentMethodDto = {\n        isDefault: false,\n        expiryMonth: 6,\n        expiryYear: 2026,\n      };\n\n      it('should update payment method successfully', async () => {\n        const updatedPaymentMethod = { ...mockPaymentMethod, ...updatePaymentMethodDto };\n        mockBillingService.updatePaymentMethod.mockResolvedValue(updatedPaymentMethod);\n\n        const result = await controller.updatePaymentMethod('pm_123', updatePaymentMethodDto);\n\n        expect(result).toEqual(updatedPaymentMethod);\n        expect(billingService.updatePaymentMethod).toHaveBeenCalledWith(\n          'pm_123',\n          updatePaymentMethodDto\n        );\n      });\n    });\n\n    describe('DELETE /billing/payment-methods/:id', () => {\n      it('should delete payment method successfully', async () => {\n        mockBillingService.deletePaymentMethod.mockResolvedValue({ success: true });\n\n        const result = await controller.deletePaymentMethod('pm_123');\n\n        expect(result).toEqual({ success: true });\n        expect(billingService.deletePaymentMethod).toHaveBeenCalledWith('pm_123');\n      });\n    });\n  });\n\n  describe('Payment Management', () => {\n    describe('POST /billing/payments', () => {\n      const createPaymentDto = {\n        subscriptionId: 'sub_123456789',\n        amount: 29.99,\n        currency: 'USD',\n        paymentMethodId: 'pm_123456789',\n      };\n\n      it('should create payment successfully', async () => {\n        mockBillingService.createPayment.mockResolvedValue(mockPayment);\n\n        const result = await controller.createPayment(createPaymentDto);\n\n        expect(result).toEqual(mockPayment);\n        expect(billingService.createPayment).toHaveBeenCalledWith(createPaymentDto);\n      });\n    });\n\n    describe('GET /billing/payments', () => {\n      const paymentsQuery = {\n        subscriptionId: 'sub_123456789',\n        status: 'succeeded' as const,\n        startDate: '2024-01-01T00:00:00.000Z',\n        endDate: '2024-01-31T23:59:59.999Z',\n      };\n\n      it('should get payments as admin', async () => {\n        const mockPayments = [mockPayment];\n        mockBillingService.findPayments.mockResolvedValue(mockPayments);\n\n        const result = await controller.getPayments('admin', paymentsQuery);\n\n        expect(result).toEqual(mockPayments);\n        expect(billingService.findPayments).toHaveBeenCalledWith(\n          paymentsQuery.subscriptionId,\n          paymentsQuery.status,\n          new Date(paymentsQuery.startDate),\n          new Date(paymentsQuery.endDate)\n        );\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.getPayments('client', paymentsQuery)\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n\n    describe('PATCH /billing/payments/:id/status', () => {\n      const updateStatusDto = {\n        status: 'succeeded' as const,\n        metadata: { processor: 'stripe' },\n      };\n\n      it('should update payment status as admin', async () => {\n        const updatedPayment = { ...mockPayment, ...updateStatusDto };\n        mockBillingService.updatePaymentStatus.mockResolvedValue(updatedPayment);\n\n        const result = await controller.updatePaymentStatus(\n          'pay_123',\n          updateStatusDto,\n          'admin'\n        );\n\n        expect(result).toEqual(updatedPayment);\n        expect(billingService.updatePaymentStatus).toHaveBeenCalledWith(\n          'pay_123',\n          updateStatusDto.status,\n          updateStatusDto.metadata\n        );\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.updatePaymentStatus('pay_123', updateStatusDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n  });\n\n  describe('Invoice Management', () => {\n    describe('POST /billing/invoices', () => {\n      const createInvoiceDto = {\n        subscriptionId: 'sub_123456789',\n        amount: 29.99,\n        currency: 'USD',\n        dueDate: '2024-02-01T00:00:00.000Z',\n        description: 'Monthly subscription fee',\n      };\n\n      it('should create invoice as admin', async () => {\n        mockBillingService.createInvoice.mockResolvedValue(mockInvoice);\n\n        const result = await controller.createInvoice(createInvoiceDto, 'admin');\n\n        expect(result).toEqual(mockInvoice);\n        expect(billingService.createInvoice).toHaveBeenCalledWith({\n          ...createInvoiceDto,\n          dueDate: new Date(createInvoiceDto.dueDate),\n        });\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.createInvoice(createInvoiceDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n\n    describe('GET /billing/invoices', () => {\n      const invoicesQuery = {\n        subscriptionId: 'sub_123456789',\n        status: 'paid' as const,\n      };\n\n      it('should get invoices successfully', async () => {\n        const mockInvoices = [mockInvoice];\n        mockBillingService.findInvoices.mockResolvedValue(mockInvoices);\n\n        const result = await controller.getInvoices(\n          'admin',\n          TEST_USER_IDS.CLIENT,\n          invoicesQuery\n        );\n\n        expect(result).toEqual(mockInvoices);\n        expect(billingService.findInvoices).toHaveBeenCalledWith(\n          invoicesQuery.subscriptionId,\n          invoicesQuery.status\n        );\n      });\n    });\n\n    describe('POST /billing/invoices/:id/pay', () => {\n      const markPaidDto = {\n        paymentId: 'pay_123456789',\n        paidAt: '2024-01-15T12:00:00.000Z',\n      };\n\n      it('should mark invoice as paid as admin', async () => {\n        const paidInvoice = { ...mockInvoice, status: 'paid' };\n        mockBillingService.markInvoiceAsPaid.mockResolvedValue(paidInvoice);\n\n        const result = await controller.markInvoiceAsPaid('inv_123', markPaidDto, 'admin');\n\n        expect(result).toEqual(paidInvoice);\n        expect(billingService.markInvoiceAsPaid).toHaveBeenCalledWith('inv_123');\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.markInvoiceAsPaid('inv_123', markPaidDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n  });\n\n  describe('Discount Management', () => {\n    describe('POST /billing/discounts', () => {\n      const createDiscountDto = {\n        code: 'SAVE30',\n        type: 'percentage' as const,\n        value: 30,\n        usageLimit: 50,\n        validFrom: '2024-01-01T00:00:00.000Z',\n        validUntil: '2024-12-31T23:59:59.999Z',\n      };\n\n      it('should create discount as admin', async () => {\n        mockBillingService.createDiscount.mockResolvedValue(mockDiscount);\n\n        const result = await controller.createDiscount(createDiscountDto, 'admin');\n\n        expect(result).toEqual(mockDiscount);\n        expect(billingService.createDiscount).toHaveBeenCalledWith({\n          ...createDiscountDto,\n          validFrom: new Date(createDiscountDto.validFrom),\n          validUntil: new Date(createDiscountDto.validUntil),\n        });\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.createDiscount(createDiscountDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n\n    describe('POST /billing/discounts/validate', () => {\n      const validateDto = {\n        code: 'SAVE20',\n        amount: 29.99,\n      };\n\n      it('should validate discount successfully', async () => {\n        const validationResult = {\n          isValid: true,\n          discount: mockDiscount,\n          discountAmount: 5.99,\n        };\n        mockBillingService.validateDiscount.mockResolvedValue(validationResult);\n\n        const result = await controller.validateDiscount(validateDto, TEST_USER_IDS.CLIENT);\n\n        expect(result).toEqual(validationResult);\n        expect(billingService.validateDiscount).toHaveBeenCalledWith(\n          validateDto.code,\n          TEST_USER_IDS.CLIENT,\n          validateDto.amount\n        );\n      });\n    });\n\n    describe('POST /billing/discounts/:id/redeem', () => {\n      const redeemDto = {\n        amountSaved: 5.99,\n      };\n\n      it('should redeem discount successfully', async () => {\n        const redeemResult = {\n          success: true,\n          discount: mockDiscount,\n          amountSaved: redeemDto.amountSaved,\n        };\n        mockBillingService.redeemDiscount.mockResolvedValue(redeemResult);\n\n        const result = await controller.redeemDiscount(\n          'disc_123',\n          redeemDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(redeemResult);\n        expect(billingService.redeemDiscount).toHaveBeenCalledWith(\n          'disc_123',\n          TEST_USER_IDS.CLIENT,\n          redeemDto.amountSaved\n        );\n      });\n    });\n  });\n\n  describe('Usage Tracking', () => {\n    describe('POST /billing/usage', () => {\n      const recordUsageDto = {\n        subscriptionId: 'sub_123456789',\n        feature: 'therapy_sessions',\n        quantity: 1,\n        usageDate: '2024-01-15T14:30:00.000Z',\n      };\n\n      it('should record usage as admin', async () => {\n        const usageRecord = {\n          id: 'usage_123456789',\n          ...recordUsageDto,\n          usageDate: new Date(recordUsageDto.usageDate),\n        };\n        mockBillingService.recordUsage.mockResolvedValue(usageRecord);\n\n        const result = await controller.recordUsage(recordUsageDto, 'admin');\n\n        expect(result).toEqual(usageRecord);\n        expect(billingService.recordUsage).toHaveBeenCalledWith({\n          ...recordUsageDto,\n          usageDate: new Date(recordUsageDto.usageDate),\n        });\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.recordUsage(recordUsageDto, 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n\n    describe('GET /billing/usage/:subscriptionId', () => {\n      const usageQuery = {\n        feature: 'therapy_sessions',\n        startDate: '2024-01-01T00:00:00.000Z',\n        endDate: '2024-01-31T23:59:59.999Z',\n      };\n\n      it('should get usage records for admin', async () => {\n        const mockUsageRecords = [\n          {\n            id: 'usage_123456789',\n            subscriptionId: 'sub_123456789',\n            feature: 'therapy_sessions',\n            quantity: 5,\n            usageDate: new Date(),\n          },\n        ];\n        mockBillingService.getUsageRecords.mockResolvedValue(mockUsageRecords);\n\n        const result = await controller.getUsageRecords(\n          'sub_123456789',\n          'admin',\n          usageQuery\n        );\n\n        expect(result).toEqual(mockUsageRecords);\n        expect(billingService.getUsageRecords).toHaveBeenCalledWith(\n          'sub_123456789',\n          usageQuery.feature,\n          new Date(usageQuery.startDate),\n          new Date(usageQuery.endDate)\n        );\n      });\n    });\n  });\n\n  describe('Statistics', () => {\n    describe('GET /billing/statistics', () => {\n      const statsQuery = {\n        startDate: '2024-01-01T00:00:00.000Z',\n        endDate: '2024-01-31T23:59:59.999Z',\n      };\n\n      it('should get billing statistics as admin', async () => {\n        const mockStatistics = {\n          totalRevenue: 15000.00,\n          activeSubscriptions: 120,\n          cancelledSubscriptions: 15,\n          averageRevenuePer: 125.00,\n          monthlyGrowthRate: 8.5,\n        };\n        mockBillingService.getBillingStatistics.mockResolvedValue(mockStatistics);\n\n        const result = await controller.getBillingStatistics('admin', statsQuery);\n\n        expect(result).toEqual(mockStatistics);\n        expect(billingService.getBillingStatistics).toHaveBeenCalledWith(\n          new Date(statsQuery.startDate),\n          new Date(statsQuery.endDate)\n        );\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.getBillingStatistics('client', statsQuery)\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n  });\n\n  describe('Advanced Subscription Features', () => {\n    describe('POST /billing/subscriptions/me/apply-discount', () => {\n      const applyDiscountDto = {\n        discountCode: 'SAVE20',\n      };\n\n      it('should apply discount to subscription successfully', async () => {\n        const updatedSubscription = { ...mockSubscription, discountApplied: true };\n        mockBillingService.applyDiscountToSubscription.mockResolvedValue(updatedSubscription);\n\n        const result = await controller.applyDiscountToMySubscription(\n          applyDiscountDto,\n          TEST_USER_IDS.CLIENT\n        );\n\n        expect(result).toEqual(updatedSubscription);\n        expect(billingService.applyDiscountToSubscription).toHaveBeenCalledWith(\n          TEST_USER_IDS.CLIENT,\n          applyDiscountDto.discountCode\n        );\n      });\n    });\n\n    describe('POST /billing/subscriptions/:id/renew', () => {\n      it('should process subscription renewal as admin', async () => {\n        const renewedSubscription = { ...mockSubscription, renewedAt: new Date() };\n        mockBillingService.processSubscriptionRenewal.mockResolvedValue(renewedSubscription);\n\n        const result = await controller.processSubscriptionRenewal('sub_123456789', 'admin');\n\n        expect(result).toEqual(renewedSubscription);\n        expect(billingService.processSubscriptionRenewal).toHaveBeenCalledWith('sub_123456789');\n      });\n\n      it('should throw unauthorized error for non-admin users', async () => {\n        await expect(\n          controller.processSubscriptionRenewal('sub_123456789', 'client')\n        ).rejects.toThrow(UnauthorizedException);\n      });\n    });\n\n    describe('GET /billing/subscriptions/:id/usage-analytics', () => {\n      const analyticsQuery = {\n        startDate: '2024-01-01T00:00:00.000Z',\n        endDate: '2024-01-31T23:59:59.999Z',\n      };\n\n      it('should get subscription usage analytics', async () => {\n        const mockAnalytics = {\n          totalUsage: 25,\n          featureBreakdown: {\n            therapy_sessions: 20,\n            support_tickets: 5,\n          },\n          utilizationRate: 83.3,\n        };\n        mockBillingService.getSubscriptionUsageAnalytics.mockResolvedValue(mockAnalytics);\n\n        const result = await controller.getSubscriptionUsageAnalytics(\n          'sub_123456789',\n          'admin',\n          TEST_USER_IDS.CLIENT,\n          analyticsQuery\n        );\n\n        expect(result).toEqual(mockAnalytics);\n        expect(billingService.getSubscriptionUsageAnalytics).toHaveBeenCalledWith(\n          'sub_123456789',\n          new Date(analyticsQuery.startDate),\n          new Date(analyticsQuery.endDate)\n        );\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle service unavailable scenarios', async () => {\n      const serviceError = new Error('Service temporarily unavailable');\n      mockBillingService.findUserSubscription.mockRejectedValue(serviceError);\n\n      await expect(\n        controller.getMySubscription(TEST_USER_IDS.CLIENT)\n      ).rejects.toThrow(serviceError);\n    });\n\n    it('should handle payment processing failures', async () => {\n      const paymentError = new Error('Payment processing failed');\n      mockBillingService.createPayment.mockRejectedValue(paymentError);\n\n      await expect(\n        controller.createPayment({\n          subscriptionId: 'sub_123456789',\n          amount: 29.99,\n          currency: 'USD',\n          paymentMethodId: 'pm_123456789',\n        })\n      ).rejects.toThrow(paymentError);\n    });\n\n    it('should handle invalid discount codes', async () => {\n      const invalidDiscountError = new Error('Invalid discount code');\n      mockBillingService.validateDiscount.mockRejectedValue(invalidDiscountError);\n\n      await expect(\n        controller.validateDiscount({ code: 'INVALID', amount: 29.99 }, TEST_USER_IDS.CLIENT)\n      ).rejects.toThrow(invalidDiscountError);\n    });\n\n    it('should handle subscription limits exceeded', async () => {\n      const limitError = new Error('Subscription limit exceeded');\n      mockBillingService.createSubscription.mockRejectedValue(limitError);\n\n      await expect(\n        controller.createSubscription(\n          { planId: 'plan_basic_monthly', paymentMethodId: 'pm_123456789' },\n          TEST_USER_IDS.CLIENT\n        )\n      ).rejects.toThrow(limitError);\n    });\n  });\n\n  describe('Response Format Validation', () => {\n    it('should return properly formatted subscription response', async () => {\n      mockBillingService.findUserSubscription.mockResolvedValue(mockSubscription);\n\n      const result = await controller.getMySubscription(TEST_USER_IDS.CLIENT);\n\n      TestAssertions.expectValidEntity(result, ['id', 'userId', 'planId', 'status']);\n      expect(result.id).toBe(mockSubscription.id);\n      expect(result.userId).toBe(TEST_USER_IDS.CLIENT);\n    });\n\n    it('should return properly formatted payment method response', async () => {\n      const mockPaymentMethods = [mockPaymentMethod];\n      mockBillingService.findUserPaymentMethods.mockResolvedValue(mockPaymentMethods);\n\n      const result = await controller.getMyPaymentMethods(TEST_USER_IDS.CLIENT);\n\n      expect(Array.isArray(result)).toBe(true);\n      if (result.length > 0) {\n        TestAssertions.expectValidEntity(result[0], ['id', 'userId', 'type', 'isDefault']);\n      }\n    });\n\n    it('should return properly formatted billing statistics', async () => {\n      const mockStats = {\n        totalRevenue: 15000.00,\n        activeSubscriptions: 120,\n        cancelledSubscriptions: 15,\n        averageRevenuePer: 125.00,\n        monthlyGrowthRate: 8.5,\n      };\n      mockBillingService.getBillingStatistics.mockResolvedValue(mockStats);\n\n      const result = await controller.getBillingStatistics('admin', {});\n\n      expect(typeof result.totalRevenue).toBe('number');\n      expect(typeof result.activeSubscriptions).toBe('number');\n      expect(typeof result.monthlyGrowthRate).toBe('number');\n    });\n  });\n});"],"version":3}