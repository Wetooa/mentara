{"version":3,"names":["cov_11odpxvptv","actualCoverage","common_1","s","require","prisma_client_provider_1","UserRole","f","b","exports","RoleUtils","prisma","constructor","getUserRole","clerkId","user","findUnique","where","id","select","role","error","console","Error","message","isUserAdmin","ADMIN","isUserTherapist","THERAPIST","isUserModerator","MODERATOR","isUserRegularUser","USER","getRolePermissions","canAccessAdminPanel","canManageUsers","canManageTherapists","canModerateContent","canCreateWorksheets","canAssignWorksheets","getUserPermissions","requireRole","requiredRole","userRole","roleHierarchy","__decorate","Injectable","PrismaService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/utils/role-utils.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\n\nexport enum UserRole {\n  USER = 'user',\n  THERAPIST = 'therapist',\n  ADMIN = 'admin',\n  MODERATOR = 'moderator',\n}\n\nexport interface RolePermissions {\n  canAccessAdminPanel: boolean;\n  canManageUsers: boolean;\n  canManageTherapists: boolean;\n  canModerateContent: boolean;\n  canCreateWorksheets: boolean;\n  canAssignWorksheets: boolean;\n}\n\n@Injectable()\nexport class RoleUtils {\n  constructor(private prisma: PrismaService) {}\n\n  async getUserRole(clerkId: string): Promise<UserRole | null> {\n    try {\n      const user = await this.prisma.user.findUnique({\n        where: { id: clerkId },\n        select: { role: true },\n      });\n      return (user?.role as UserRole) || null;\n    } catch (error) {\n      console.error(\n        'Error getting user role:',\n        error instanceof Error ? error.message : error,\n      );\n      return null;\n    }\n  }\n\n  async isUserAdmin(clerkId: string): Promise<boolean> {\n    const role = await this.getUserRole(clerkId);\n    return role === UserRole.ADMIN;\n  }\n\n  async isUserTherapist(clerkId: string): Promise<boolean> {\n    const role = await this.getUserRole(clerkId);\n    return role === UserRole.THERAPIST;\n  }\n\n  async isUserModerator(clerkId: string): Promise<boolean> {\n    const role = await this.getUserRole(clerkId);\n    return role === UserRole.MODERATOR;\n  }\n\n  async isUserRegularUser(clerkId: string): Promise<boolean> {\n    const role = await this.getUserRole(clerkId);\n    return role === UserRole.USER;\n  }\n\n  getRolePermissions(role: UserRole): RolePermissions {\n    switch (role) {\n      case UserRole.ADMIN:\n        return {\n          canAccessAdminPanel: true,\n          canManageUsers: true,\n          canManageTherapists: true,\n          canModerateContent: true,\n          canCreateWorksheets: true,\n          canAssignWorksheets: true,\n        };\n      case UserRole.MODERATOR:\n        return {\n          canAccessAdminPanel: false,\n          canManageUsers: false,\n          canManageTherapists: false,\n          canModerateContent: true,\n          canCreateWorksheets: false,\n          canAssignWorksheets: false,\n        };\n      case UserRole.THERAPIST:\n        return {\n          canAccessAdminPanel: false,\n          canManageUsers: false,\n          canManageTherapists: false,\n          canModerateContent: false,\n          canCreateWorksheets: true,\n          canAssignWorksheets: true,\n        };\n      case UserRole.USER:\n      default:\n        return {\n          canAccessAdminPanel: false,\n          canManageUsers: false,\n          canManageTherapists: false,\n          canModerateContent: false,\n          canCreateWorksheets: false,\n          canAssignWorksheets: false,\n        };\n    }\n  }\n\n  async getUserPermissions(clerkId: string): Promise<RolePermissions> {\n    const role = await this.getUserRole(clerkId);\n    return this.getRolePermissions(role || UserRole.USER);\n  }\n\n  async requireRole(clerkId: string, requiredRole: UserRole): Promise<boolean> {\n    const userRole = await this.getUserRole(clerkId);\n    if (!userRole) return false;\n\n    const roleHierarchy = {\n      [UserRole.USER]: 1,\n      [UserRole.THERAPIST]: 2,\n      [UserRole.MODERATOR]: 3,\n      [UserRole.ADMIN]: 4,\n    };\n\n    return roleHierarchy[userRole] >= roleHierarchy[requiredRole];\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}