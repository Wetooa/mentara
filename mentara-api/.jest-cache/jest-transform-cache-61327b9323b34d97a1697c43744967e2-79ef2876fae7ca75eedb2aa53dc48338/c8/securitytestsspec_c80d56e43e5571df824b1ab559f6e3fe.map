{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/security/security-tests.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/security/security-tests.spec.ts"],"sourcesContent":["/**\n * Security Testing Specification\n *\n * Comprehensive security tests for authentication, authorization,\n * input validation, and vulnerability assessment.\n */\n\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { INestApplication } from '@nestjs/common';\nimport { AppModule } from '../../app.module';\nimport { PrismaService } from '../../database/prisma.service';\nimport {\n  SecurityTestingSuite,\n  SecurityScanReport,\n} from './security-testing.suite';\nimport { createMockClerkClient, createMockAuthGuard } from '../index';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ndescribe('Security Testing Suite', () => {\n  let app: INestApplication;\n  let prisma: PrismaService;\n  let securitySuite: SecurityTestingSuite;\n\n  beforeAll(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [AppModule],\n    })\n      .overrideProvider('ClerkClient')\n      .useValue(createMockClerkClient())\n      .overrideGuard('AuthGuard')\n      .useValue(createMockAuthGuard())\n      .compile();\n\n    app = moduleFixture.createNestApplication();\n    prisma = app.get<PrismaService>(PrismaService);\n\n    await app.init();\n\n    securitySuite = new SecurityTestingSuite(app);\n  });\n\n  afterAll(async () => {\n    await prisma.$disconnect();\n    await app.close();\n  });\n\n  beforeEach(async () => {\n    // Clean database before each test\n    await prisma.$transaction([\n      prisma.preAssessment.deleteMany(),\n      prisma.client.deleteMany(),\n      prisma.therapist.deleteMany(),\n      prisma.user.deleteMany(),\n    ]);\n  });\n\n  describe('Comprehensive Security Scan', () => {\n    it('should run complete security vulnerability assessment', async () => {\n      console.log('ðŸ”’ Starting comprehensive security scan...');\n\n      const report: SecurityScanReport = await securitySuite.runSecurityScan();\n\n      // Save detailed security report\n      await saveSecurityReport(\n        'comprehensive-security-scan.json',\n        JSON.stringify(report, null, 2),\n      );\n\n      // Basic security assertions\n      expect(report.summary.totalTests).toBeGreaterThan(0);\n      expect(report.summary.criticalIssues).toBe(0); // No critical vulnerabilities allowed\n      expect(report.summary.highIssues).toBeLessThanOrEqual(2); // Maximum 2 high-risk issues\n\n      // Compliance checks\n      expect(report.complianceStatus.hipaa).toBe(true);\n      expect(report.complianceStatus.owasp).toBe(true);\n\n      console.log(`Security Scan Results:\n        Total Tests: ${report.summary.totalTests}\n        Passed: ${report.summary.passed}\n        Failed: ${report.summary.failed}\n        Critical Issues: ${report.summary.criticalIssues}\n        High Issues: ${report.summary.highIssues}\n        Medium Issues: ${report.summary.mediumIssues}\n        Low Issues: ${report.summary.lowIssues}\n        \n        Compliance Status:\n        HIPAA: ${report.complianceStatus.hipaa ? 'âœ…' : 'âŒ'}\n        OWASP: ${report.complianceStatus.owasp ? 'âœ…' : 'âŒ'}\n        GDPR: ${report.complianceStatus.gdpr ? 'âœ…' : 'âŒ'}`);\n\n      // Generate executive summary\n      await generateExecutiveSummary(report);\n    }, 300000); // 5 minute timeout for comprehensive scan\n  });\n\n  describe('Authentication Security', () => {\n    it('should properly validate JWT tokens', async () => {\n      console.log('ðŸ” Testing JWT token validation...');\n\n      // This will be covered in the comprehensive scan, but we can also test individually\n      const results = securitySuite.getResults();\n      const authTests = results.filter((r) =>\n        r.vulnerability.includes('Authentication'),\n      );\n\n      authTests.forEach((test) => {\n        if (test.severity === 'CRITICAL' || test.severity === 'HIGH') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n\n    it('should enforce proper session management', async () => {\n      console.log('ðŸª Testing session security...');\n\n      const results = securitySuite.getResults();\n      const sessionTests = results.filter((r) =>\n        r.vulnerability.includes('Session'),\n      );\n\n      sessionTests.forEach((test) => {\n        if (test.severity === 'HIGH' || test.severity === 'CRITICAL') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n  });\n\n  describe('Input Validation Security', () => {\n    it('should prevent SQL injection attacks', async () => {\n      console.log('ðŸ’‰ Testing SQL injection prevention...');\n\n      const results = securitySuite.getResults();\n      const sqlTests = results.filter(\n        (r) => r.vulnerability === 'SQL Injection',\n      );\n\n      // All SQL injection tests should pass\n      sqlTests.forEach((test) => {\n        expect(test.passed).toBe(true);\n      });\n    });\n\n    it('should prevent XSS attacks', async () => {\n      console.log('ðŸ”º Testing XSS prevention...');\n\n      const results = securitySuite.getResults();\n      const xssTests = results.filter(\n        (r) => r.vulnerability === 'Cross-Site Scripting',\n      );\n\n      // All XSS tests should pass\n      xssTests.forEach((test) => {\n        expect(test.passed).toBe(true);\n      });\n    });\n\n    it('should validate all input fields properly', async () => {\n      console.log('âœ… Testing input validation...');\n\n      const results = securitySuite.getResults();\n      const validationTests = results.filter(\n        (r) => r.vulnerability === 'Input Validation',\n      );\n\n      // Most input validation tests should pass (allowing for some edge cases)\n      const passedValidationTests = validationTests.filter(\n        (t) => t.passed,\n      ).length;\n      const totalValidationTests = validationTests.length;\n\n      if (totalValidationTests > 0) {\n        const passRate = passedValidationTests / totalValidationTests;\n        expect(passRate).toBeGreaterThan(0.8); // 80% pass rate minimum\n      }\n    });\n  });\n\n  describe('Data Protection & Privacy', () => {\n    it('should protect sensitive health data (HIPAA compliance)', async () => {\n      console.log('ðŸ¥ Testing HIPAA compliance...');\n\n      const results = securitySuite.getResults();\n      const healthDataTests = results.filter((r) =>\n        r.vulnerability.includes('Health Data'),\n      );\n\n      // All health data protection tests must pass\n      healthDataTests.forEach((test) => {\n        expect(test.passed).toBe(true);\n      });\n    });\n\n    it('should prevent sensitive data exposure', async () => {\n      console.log('ðŸ”“ Testing data exposure prevention...');\n\n      const results = securitySuite.getResults();\n      const dataExposureTests = results.filter((r) =>\n        r.vulnerability.includes('Data Exposure'),\n      );\n\n      // Critical and high-severity data exposure tests must pass\n      dataExposureTests.forEach((test) => {\n        if (test.severity === 'CRITICAL' || test.severity === 'HIGH') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n\n    it('should implement proper data minimization', async () => {\n      console.log('ðŸ“Š Testing data minimization...');\n\n      const results = securitySuite.getResults();\n      const minimizationTests = results.filter(\n        (r) => r.vulnerability === 'Data Minimization',\n      );\n\n      minimizationTests.forEach((test) => {\n        if (test.severity === 'MEDIUM' || test.severity === 'HIGH') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n  });\n\n  describe('Authorization & Access Control', () => {\n    it('should enforce role-based access control', async () => {\n      console.log('ðŸ‘® Testing role-based access control...');\n\n      const results = securitySuite.getResults();\n      const authzTests = results.filter(\n        (r) =>\n          r.vulnerability.includes('Privilege') ||\n          r.vulnerability.includes('Access Control'),\n      );\n\n      // All privilege escalation tests must pass\n      authzTests.forEach((test) => {\n        if (test.severity === 'CRITICAL' || test.severity === 'HIGH') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n\n    it('should prevent unauthorized data access', async () => {\n      console.log('ðŸš« Testing unauthorized access prevention...');\n\n      const results = securitySuite.getResults();\n      const unauthorizedTests = results.filter((r) =>\n        r.vulnerability.includes('Unauthorized'),\n      );\n\n      unauthorizedTests.forEach((test) => {\n        expect(test.passed).toBe(true);\n      });\n    });\n  });\n\n  describe('Security Headers & Configuration', () => {\n    it('should implement proper security headers', async () => {\n      console.log('ðŸ›¡ï¸ Testing security headers...');\n\n      const results = securitySuite.getResults();\n      const headerTests = results.filter(\n        (r) => r.vulnerability === 'Security Headers',\n      );\n\n      // Security headers should be implemented\n      headerTests.forEach((test) => {\n        // Allow some flexibility for security headers (not all may be required)\n        if (test.severity === 'HIGH' || test.severity === 'CRITICAL') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n  });\n\n  describe('DoS Protection & Rate Limiting', () => {\n    it('should implement rate limiting protection', async () => {\n      console.log('ðŸš¦ Testing rate limiting...');\n\n      const results = securitySuite.getResults();\n      const rateLimitTests = results.filter(\n        (r) => r.vulnerability === 'DoS Protection',\n      );\n\n      rateLimitTests.forEach((test) => {\n        if (test.severity === 'MEDIUM' || test.severity === 'HIGH') {\n          expect(test.passed).toBe(true);\n        }\n      });\n    });\n  });\n\n  describe('Security Regression Testing', () => {\n    it('should not introduce new security vulnerabilities', async () => {\n      console.log('ðŸ”„ Running regression security tests...');\n\n      const results = securitySuite.getResults();\n\n      // Critical and high-severity issues should not exist\n      const criticalIssues = results.filter(\n        (r) => !r.passed && r.severity === 'CRITICAL',\n      );\n      const highIssues = results.filter(\n        (r) => !r.passed && r.severity === 'HIGH',\n      );\n\n      expect(criticalIssues.length).toBe(0);\n      expect(highIssues.length).toBeLessThanOrEqual(2); // Maximum 2 high-risk issues\n\n      if (criticalIssues.length > 0) {\n        console.error('âŒ Critical security issues found:');\n        criticalIssues.forEach((issue) => {\n          console.error(`   ${issue.testName}: ${issue.details}`);\n        });\n      }\n\n      if (highIssues.length > 0) {\n        console.warn('âš ï¸ High-risk security issues found:');\n        highIssues.forEach((issue) => {\n          console.warn(`   ${issue.testName}: ${issue.details}`);\n        });\n      }\n    });\n  });\n});\n\n// Helper Functions\n\nasync function saveSecurityReport(\n  filename: string,\n  content: string,\n): Promise<void> {\n  const reportsDir = path.join(__dirname, '../../../test-reports/security');\n\n  // Create directory if it doesn't exist\n  await fs.promises.mkdir(reportsDir, { recursive: true });\n\n  const filePath = path.join(reportsDir, filename);\n  await fs.promises.writeFile(filePath, content, 'utf8');\n\n  console.log(`ðŸ”’ Security report saved to: ${filePath}`);\n}\n\nasync function generateExecutiveSummary(\n  report: SecurityScanReport,\n): Promise<void> {\n  const summary = `\nEXECUTIVE SECURITY SUMMARY\n=========================\n\nDate: ${new Date().toISOString()}\nApplication: Mentara Mental Health Platform\n\nOVERALL SECURITY POSTURE: ${report.summary.criticalIssues === 0 && report.summary.highIssues <= 2 ? 'ACCEPTABLE' : 'NEEDS ATTENTION'}\n\nSecurity Test Results:\n- Total Security Tests: ${report.summary.totalTests}\n- Tests Passed: ${report.summary.passed} (${((report.summary.passed / report.summary.totalTests) * 100).toFixed(1)}%)\n- Tests Failed: ${report.summary.failed}\n\nVulnerability Breakdown:\n- Critical Issues: ${report.summary.criticalIssues} âš ï¸\n- High-Risk Issues: ${report.summary.highIssues} âš ï¸\n- Medium-Risk Issues: ${report.summary.mediumIssues}\n- Low-Risk Issues: ${report.summary.lowIssues}\n\nCompliance Status:\n- HIPAA Compliance: ${report.complianceStatus.hipaa ? 'COMPLIANT âœ…' : 'NON-COMPLIANT âŒ'}\n- OWASP Standards: ${report.complianceStatus.owasp ? 'COMPLIANT âœ…' : 'NON-COMPLIANT âŒ'}\n- GDPR Compliance: ${report.complianceStatus.gdpr ? 'COMPLIANT âœ…' : 'NON-COMPLIANT âŒ'}\n\nImmediate Actions Required:\n${report.summary.criticalIssues > 0 ? 'ðŸš¨ URGENT: Address critical security vulnerabilities before deployment' : 'âœ… No critical vulnerabilities found'}\n${report.summary.highIssues > 2 ? 'âš ï¸ HIGH PRIORITY: Reduce high-risk vulnerabilities to acceptable levels' : 'âœ… High-risk vulnerabilities within acceptable limits'}\n\nRecommendations:\n${report.recommendations.map((rec) => `â€¢ ${rec}`).join('\\n')}\n\nNext Security Review: Recommended within 30 days or before next major release.\n\n---\nThis summary is generated automatically from comprehensive security testing.\nFor detailed technical findings, refer to the full security report.\n`;\n\n  await saveSecurityReport('executive-security-summary.txt', summary);\n}\n"],"version":3}