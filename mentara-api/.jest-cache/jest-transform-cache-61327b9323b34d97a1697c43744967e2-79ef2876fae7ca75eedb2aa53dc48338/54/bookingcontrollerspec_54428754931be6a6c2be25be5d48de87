c32176b2565b429b9a9d82770a3eccf3
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const booking_controller_1 = require("./booking.controller");
const booking_service_1 = require("./booking.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
const test_utils_1 = require("../test-utils");
const enhanced_test_helpers_1 = require("../test-utils/enhanced-test-helpers");
describe('BookingController', () => {
    let controller;
    let bookingService;
    const mockBookingService = {
        createMeeting: jest.fn(),
        getMeetings: jest.fn(),
        getMeeting: jest.fn(),
        updateMeeting: jest.fn(),
        cancelMeeting: jest.fn(),
        createAvailability: jest.fn(),
        getAvailability: jest.fn(),
        updateAvailability: jest.fn(),
        deleteAvailability: jest.fn(),
        getDurations: jest.fn(),
        getAvailableSlots: jest.fn(),
        checkMeetingAvailability: jest.fn(),
    };
    beforeEach(async () => {
        const mockPrisma = (0, test_utils_1.createMockPrismaService)();
        const module = await testing_1.Test.createTestingModule({
            controllers: [booking_controller_1.BookingController],
            providers: [
                {
                    provide: booking_service_1.BookingService,
                    useValue: mockBookingService,
                },
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrisma,
                },
            ],
        }).compile();
        controller = module.get(booking_controller_1.BookingController);
        bookingService = module.get(booking_service_1.BookingService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('basic functionality', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have bookingService injected', () => {
            expect(bookingService).toBeDefined();
        });
    });
    describe('createMeeting', () => {
        const createMeetingDto = {
            therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
            startTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), // Tomorrow
            duration: 60,
            meetingType: 'video',
            title: 'Initial consultation',
        };
        it('should allow clients to create meetings', async () => {
            const mockMeeting = {
                id: 'meeting-123',
                ...createMeetingDto,
                clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                status: client_1.MeetingStatus.SCHEDULED,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            bookingService.createMeeting.mockResolvedValue(mockMeeting);
            const result = await controller.createMeeting(createMeetingDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(bookingService.createMeeting).toHaveBeenCalledWith(createMeetingDto, test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockMeeting);
        });
        it('should reject non-client users from creating meetings', async () => {
            await expect(controller.createMeeting(createMeetingDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist')).rejects.toThrow(common_1.ForbiddenException);
            expect(bookingService.createMeeting).not.toHaveBeenCalled();
        });
        it('should reject admin users from creating meetings', async () => {
            await expect(controller.createMeeting(createMeetingDto, test_utils_1.TEST_USER_IDS.ADMIN, 'admin')).rejects.toThrow(common_1.ForbiddenException);
            expect(bookingService.createMeeting).not.toHaveBeenCalled();
        });
        it('should handle booking service errors', async () => {
            bookingService.createMeeting.mockRejectedValue(new common_1.BadRequestException('Therapist not available at this time'));
            await expect(controller.createMeeting(createMeetingDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle scheduling conflicts', async () => {
            bookingService.createMeeting.mockRejectedValue(new common_1.BadRequestException('Time slot not available'));
            await expect(controller.createMeeting(createMeetingDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
            expect(bookingService.createMeeting).toHaveBeenCalledWith(createMeetingDto, test_utils_1.TEST_USER_IDS.CLIENT);
        });
        it('should handle invalid therapist', async () => {
            const invalidMeetingData = {
                ...createMeetingDto,
                therapistId: 'invalid-therapist-id',
            };
            bookingService.createMeeting.mockRejectedValue(new common_1.NotFoundException('Therapist not found'));
            await expect(controller.createMeeting(invalidMeetingData, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should validate meeting duration', async () => {
            const invalidDurationData = {
                ...createMeetingDto,
                duration: 0,
            };
            bookingService.createMeeting.mockRejectedValue(new common_1.BadRequestException('Invalid meeting duration'));
            await expect(controller.createMeeting(invalidDurationData, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('getMeetings', () => {
        it('should return meetings for client users', async () => {
            const mockMeetings = [
                enhanced_test_helpers_1.TestDataGenerator.createMeeting({
                    clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    status: 'SCHEDULED',
                }),
                enhanced_test_helpers_1.TestDataGenerator.createMeeting({
                    clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    status: 'COMPLETED',
                }),
            ];
            bookingService.getMeetings.mockResolvedValue(mockMeetings);
            const result = await controller.getMeetings(test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(bookingService.getMeetings).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(result).toEqual(mockMeetings);
            expect(result).toHaveLength(2);
        });
        it('should return meetings for therapist users', async () => {
            const mockMeetings = [
                enhanced_test_helpers_1.TestDataGenerator.createMeeting({
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    status: 'SCHEDULED',
                }),
                enhanced_test_helpers_1.TestDataGenerator.createMeeting({
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    status: 'IN_PROGRESS',
                }),
            ];
            bookingService.getMeetings.mockResolvedValue(mockMeetings);
            const result = await controller.getMeetings(test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.getMeetings).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(result).toEqual(mockMeetings);
        });
        it('should return empty array when no meetings exist', async () => {
            bookingService.getMeetings.mockResolvedValue([]);
            const result = await controller.getMeetings(test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle admin role appropriately', async () => {
            const mockAdminMeetings = [
                enhanced_test_helpers_1.TestDataGenerator.createMeeting({ status: 'SCHEDULED' }),
            ];
            bookingService.getMeetings.mockResolvedValue(mockAdminMeetings);
            const result = await controller.getMeetings(test_utils_1.TEST_USER_IDS.ADMIN, 'admin');
            expect(bookingService.getMeetings).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.ADMIN, 'admin');
            expect(result).toEqual(mockAdminMeetings);
        });
    });
    describe('getMeeting', () => {
        const meetingId = 'meeting-123';
        const mockMeeting = {
            id: meetingId,
            clientId: test_utils_1.TEST_USER_IDS.CLIENT,
            therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
            startTime: new Date('2024-12-01T10:00:00Z'),
            duration: 60,
            status: client_1.MeetingStatus.SCHEDULED,
            meetingType: 'video',
            createdAt: new Date(),
            updatedAt: new Date(),
        };
        it('should return meeting for authorized client', async () => {
            bookingService.getMeeting.mockResolvedValue(mockMeeting);
            const result = await controller.getMeeting(meetingId, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(bookingService.getMeeting).toHaveBeenCalledWith(meetingId, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(result).toEqual(mockMeeting);
        });
        it('should return meeting for authorized therapist', async () => {
            bookingService.getMeeting.mockResolvedValue(mockMeeting);
            const result = await controller.getMeeting(meetingId, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.getMeeting).toHaveBeenCalledWith(meetingId, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(result).toEqual(mockMeeting);
        });
        it('should handle meeting not found', async () => {
            bookingService.getMeeting.mockRejectedValue(new common_1.NotFoundException('Meeting not found'));
            await expect(controller.getMeeting('invalid-meeting-id', test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should handle unauthorized access', async () => {
            bookingService.getMeeting.mockRejectedValue(new common_1.ForbiddenException('Access denied'));
            await expect(controller.getMeeting(meetingId, 'unauthorized-user', 'client')).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('updateMeeting', () => {
        const meetingId = 'meeting-123';
        const updateData = {
            startTime: '2024-12-01T14:00:00Z',
            title: 'Updated meeting',
            therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
            duration: 60,
        };
        it('should successfully update meeting', async () => {
            const updatedMeeting = {
                id: meetingId,
                clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                ...updateData,
                duration: 60,
                status: client_1.MeetingStatus.SCHEDULED,
                meetingType: 'video',
                updatedAt: new Date(),
            };
            bookingService.updateMeeting.mockResolvedValue(updatedMeeting);
            const result = await controller.updateMeeting(meetingId, updateData, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(bookingService.updateMeeting).toHaveBeenCalledWith(meetingId, updateData, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(result).toEqual(updatedMeeting);
        });
        it('should handle invalid meeting update', async () => {
            bookingService.updateMeeting.mockRejectedValue(new common_1.BadRequestException('Cannot update past meeting'));
            await expect(controller.updateMeeting(meetingId, updateData, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle unauthorized update', async () => {
            bookingService.updateMeeting.mockRejectedValue(new common_1.ForbiddenException('Only meeting participants can update'));
            await expect(controller.updateMeeting(meetingId, updateData, 'unauthorized-user', 'client')).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should allow therapists to update meetings', async () => {
            const therapistUpdate = {
                startTime: '2024-12-01T15:00:00Z',
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                duration: 60,
                title: 'Therapist updated meeting',
            };
            const mockUpdatedMeeting = {
                id: meetingId,
                ...therapistUpdate,
            };
            bookingService.updateMeeting.mockResolvedValue(mockUpdatedMeeting);
            const result = await controller.updateMeeting(meetingId, therapistUpdate, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(result).toEqual(mockUpdatedMeeting);
        });
    });
    describe('cancelMeeting', () => {
        const meetingId = 'meeting-123';
        it('should successfully cancel meeting', async () => {
            const cancelledMeeting = {
                id: meetingId,
                clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                status: client_1.MeetingStatus.CANCELLED,
                cancelledAt: new Date(),
                cancellationReason: 'Client request',
                updatedAt: new Date(),
            };
            bookingService.cancelMeeting.mockResolvedValue(cancelledMeeting);
            const result = await controller.cancelMeeting(meetingId, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(bookingService.cancelMeeting).toHaveBeenCalledWith(meetingId, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(result).toEqual(cancelledMeeting);
        });
        it('should handle cancellation of already cancelled meeting', async () => {
            bookingService.cancelMeeting.mockRejectedValue(new common_1.BadRequestException('Meeting already cancelled'));
            await expect(controller.cancelMeeting(meetingId, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle unauthorized cancellation', async () => {
            bookingService.cancelMeeting.mockRejectedValue(new common_1.ForbiddenException('Access denied'));
            await expect(controller.cancelMeeting(meetingId, 'unauthorized-user', 'client')).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should allow therapists to cancel meetings', async () => {
            const mockTherapistCancellation = {
                id: meetingId,
                status: 'CANCELLED',
                cancelledBy: test_utils_1.TEST_USER_IDS.THERAPIST,
                cancellationReason: 'Emergency',
            };
            bookingService.cancelMeeting.mockResolvedValue(mockTherapistCancellation);
            const result = await controller.cancelMeeting(meetingId, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(result).toEqual(mockTherapistCancellation);
        });
    });
    describe('createAvailability (Therapist Only)', () => {
        const createAvailabilityDto = {
            dayOfWeek: 1, // Monday
            startTime: '09:00',
            endTime: '17:00',
            isAvailable: true,
        };
        it('should allow therapists to create availability', async () => {
            const mockAvailability = {
                id: 'availability-123',
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                ...createAvailabilityDto,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            bookingService.createAvailability.mockResolvedValue(mockAvailability);
            const result = await controller.createAvailability(createAvailabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.createAvailability).toHaveBeenCalledWith(createAvailabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockAvailability);
        });
        it('should reject non-therapist users from creating availability', async () => {
            await expect(controller.createAvailability(createAvailabilityDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            expect(bookingService.createAvailability).not.toHaveBeenCalled();
        });
        it('should reject admin users from creating availability', async () => {
            await expect(controller.createAvailability(createAvailabilityDto, test_utils_1.TEST_USER_IDS.ADMIN, 'admin')).rejects.toThrow(common_1.UnauthorizedException);
            expect(bookingService.createAvailability).not.toHaveBeenCalled();
        });
        it('should handle availability creation errors', async () => {
            bookingService.createAvailability.mockRejectedValue(new common_1.BadRequestException('Invalid time range'));
            await expect(controller.createAvailability(createAvailabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist')).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('getAvailability (Therapist Only)', () => {
        it('should allow therapists to view their availability', async () => {
            const mockAvailabilities = [
                {
                    id: 'availability-1',
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    dayOfWeek: 1,
                    startTime: '09:00',
                    endTime: '12:00',
                    isAvailable: true,
                },
                {
                    id: 'availability-2',
                    therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                    dayOfWeek: 1,
                    startTime: '14:00',
                    endTime: '17:00',
                    isAvailable: true,
                },
            ];
            bookingService.getAvailability.mockResolvedValue(mockAvailabilities);
            const result = await controller.getAvailability(test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.getAvailability).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockAvailabilities);
            expect(result).toHaveLength(2);
        });
        it('should reject non-therapist users from viewing availability', async () => {
            await expect(controller.getAvailability(test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            expect(bookingService.getAvailability).not.toHaveBeenCalled();
        });
        it('should return empty array for therapist with no availability', async () => {
            bookingService.getAvailability.mockResolvedValue([]);
            const result = await controller.getAvailability(test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
    });
    describe('updateAvailability (Therapist Only)', () => {
        const availabilityId = 'availability-123';
        const updateAvailabilityDto = {
            dayOfWeek: 1,
            startTime: '10:00',
            endTime: '16:00',
        };
        it('should allow therapists to update their availability', async () => {
            const mockUpdatedAvailability = {
                id: availabilityId,
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                ...updateAvailabilityDto,
                updatedAt: new Date(),
            };
            bookingService.updateAvailability.mockResolvedValue(mockUpdatedAvailability);
            const result = await controller.updateAvailability(availabilityId, updateAvailabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.updateAvailability).toHaveBeenCalledWith(availabilityId, updateAvailabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockUpdatedAvailability);
        });
        it('should reject non-therapist users from updating availability', async () => {
            await expect(controller.updateAvailability(availabilityId, updateAvailabilityDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            expect(bookingService.updateAvailability).not.toHaveBeenCalled();
        });
        it('should handle availability not found', async () => {
            bookingService.updateAvailability.mockRejectedValue(new common_1.NotFoundException('Availability not found'));
            await expect(controller.updateAvailability('non-existent-availability', updateAvailabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('deleteAvailability (Therapist Only)', () => {
        const availabilityId = 'availability-123';
        it('should allow therapists to delete their availability', async () => {
            const mockDeletedAvailability = {
                id: availabilityId,
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                deleted: true,
            };
            bookingService.deleteAvailability.mockResolvedValue(mockDeletedAvailability);
            const result = await controller.deleteAvailability(availabilityId, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.deleteAvailability).toHaveBeenCalledWith(availabilityId, test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockDeletedAvailability);
        });
        it('should reject non-therapist users from deleting availability', async () => {
            await expect(controller.deleteAvailability(availabilityId, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            expect(bookingService.deleteAvailability).not.toHaveBeenCalled();
        });
        it('should handle deletion of non-existent availability', async () => {
            bookingService.deleteAvailability.mockRejectedValue(new common_1.NotFoundException('Availability not found'));
            await expect(controller.deleteAvailability('non-existent-availability', test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('getDurations (Public)', () => {
        it('should return available session durations', async () => {
            const mockDurations = [
                { value: 30, label: '30 minutes' },
                { value: 45, label: '45 minutes' },
                { value: 60, label: '1 hour' },
                { value: 90, label: '1.5 hours' },
            ];
            bookingService.getDurations.mockReturnValue(mockDurations);
            const result = controller.getDurations();
            expect(bookingService.getDurations).toHaveBeenCalled();
            expect(result).toEqual(mockDurations);
            expect(result).toHaveLength(4);
        });
        it('should handle empty durations', async () => {
            bookingService.getDurations.mockReturnValue([]);
            const result = controller.getDurations();
            expect(result).toEqual([]);
        });
    });
    describe('getAvailableSlots (Public)', () => {
        const therapistId = test_utils_1.TEST_USER_IDS.THERAPIST;
        const date = '2024-12-15';
        it('should return available time slots for a therapist on a specific date', async () => {
            const mockSlots = [
                {
                    startTime: '09:00',
                    endTime: '10:00',
                    duration: 60,
                    available: true,
                },
                {
                    startTime: '10:00',
                    endTime: '11:00',
                    duration: 60,
                    available: true,
                },
                {
                    startTime: '14:00',
                    endTime: '15:00',
                    duration: 60,
                    available: true,
                },
            ];
            bookingService.getAvailableSlots.mockResolvedValue(mockSlots);
            const result = await controller.getAvailableSlots(therapistId, date);
            expect(bookingService.getAvailableSlots).toHaveBeenCalledWith(therapistId, date);
            expect(result).toEqual(mockSlots);
            expect(result).toHaveLength(3);
        });
        it('should return empty array when no slots available', async () => {
            bookingService.getAvailableSlots.mockResolvedValue([]);
            const result = await controller.getAvailableSlots(therapistId, date);
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle invalid therapist ID', async () => {
            bookingService.getAvailableSlots.mockRejectedValue(new common_1.NotFoundException('Therapist not found'));
            await expect(controller.getAvailableSlots('invalid-therapist-id', date)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should handle invalid date format', async () => {
            bookingService.getAvailableSlots.mockRejectedValue(new common_1.BadRequestException('Invalid date format'));
            await expect(controller.getAvailableSlots(therapistId, 'invalid-date')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle past dates appropriately', async () => {
            const pastDate = '2020-01-01';
            bookingService.getAvailableSlots.mockRejectedValue(new common_1.BadRequestException('Cannot get slots for past dates'));
            await expect(controller.getAvailableSlots(therapistId, pastDate)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('Role-Based Access Control Integration', () => {
        it('should enforce role restrictions across all endpoints', async () => {
            // Test client restrictions
            await expect(controller.createAvailability({}, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            await expect(controller.getAvailability(test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            // Test therapist restrictions
            await expect(controller.createMeeting({}, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist')).rejects.toThrow(common_1.ForbiddenException);
            // Verify no service calls were made
            expect(bookingService.createAvailability).not.toHaveBeenCalled();
            expect(bookingService.getAvailability).not.toHaveBeenCalled();
            expect(bookingService.createMeeting).not.toHaveBeenCalled();
        });
        it('should allow appropriate role access to shared endpoints', async () => {
            const mockMeetings = [enhanced_test_helpers_1.TestDataGenerator.createMeeting()];
            bookingService.getMeetings.mockResolvedValue(mockMeetings);
            // Both client and therapist should access getMeetings
            await controller.getMeetings(test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            await controller.getMeetings(test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(bookingService.getMeetings).toHaveBeenCalledTimes(2);
        });
        it('should handle moderator and admin roles appropriately', async () => {
            const mockMeetings = [enhanced_test_helpers_1.TestDataGenerator.createMeeting()];
            bookingService.getMeetings.mockResolvedValue(mockMeetings);
            // Admin should be able to view meetings
            await controller.getMeetings(test_utils_1.TEST_USER_IDS.ADMIN, 'admin');
            // But admin cannot create meetings
            await expect(controller.createMeeting({}, test_utils_1.TEST_USER_IDS.ADMIN, 'admin')).rejects.toThrow(common_1.ForbiddenException);
            expect(bookingService.getMeetings).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.ADMIN, 'admin');
        });
    });
    describe('Error Handling and Edge Cases', () => {
        it('should handle service errors gracefully', async () => {
            bookingService.createMeeting.mockRejectedValue(new Error('Database connection failed'));
            await expect(controller.createMeeting({}, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow('Database connection failed');
        });
        it('should pass through HTTP exceptions', async () => {
            const notFoundError = new common_1.NotFoundException('Resource not found');
            bookingService.getMeeting.mockRejectedValue(notFoundError);
            await expect(controller.getMeeting('meeting-1', test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should handle malformed request data', async () => {
            const malformedMeetingDto = {
                therapistId: null,
                startTime: 'invalid-date',
                duration: -1,
            };
            bookingService.createMeeting.mockRejectedValue(new common_1.BadRequestException('Invalid meeting data'));
            await expect(controller.createMeeting(malformedMeetingDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle concurrent booking requests', async () => {
            const concurrentBookingDto = {
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                startTime: new Date().toISOString(),
                duration: 60,
                meetingType: 'video',
            };
            // Simulate conflict
            bookingService.createMeeting.mockRejectedValue(new common_1.BadRequestException('Time slot no longer available'));
            await expect(controller.createMeeting(concurrentBookingDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle database connection issues gracefully', async () => {
            bookingService.getMeetings.mockRejectedValue(new Error('Database connection failed'));
            await expect(controller.getMeetings(test_utils_1.TEST_USER_IDS.CLIENT, 'client')).rejects.toThrow('Database connection failed');
        });
    });
    describe('Integration Workflow Tests', () => {
        it('should handle complete booking workflow', async () => {
            // 1. Get available slots
            const mockSlots = [
                { startTime: '10:00', endTime: '11:00', available: true },
            ];
            bookingService.getAvailableSlots.mockResolvedValue(mockSlots);
            // 2. Create meeting
            const meetingDto = {
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                startTime: '2024-12-15T10:00:00Z',
                duration: 60,
                meetingType: 'video',
            };
            const mockMeeting = {
                id: 'meeting-workflow',
                ...meetingDto,
                clientId: test_utils_1.TEST_USER_IDS.CLIENT,
                status: 'SCHEDULED',
            };
            bookingService.createMeeting.mockResolvedValue(mockMeeting);
            // 3. Get meetings to verify
            bookingService.getMeetings.mockResolvedValue([mockMeeting]);
            // Execute workflow
            const slotsResult = await controller.getAvailableSlots(test_utils_1.TEST_USER_IDS.THERAPIST, '2024-12-15');
            const meetingResult = await controller.createMeeting(meetingDto, test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            const meetingsResult = await controller.getMeetings(test_utils_1.TEST_USER_IDS.CLIENT, 'client');
            expect(slotsResult).toHaveLength(1);
            expect(meetingResult.status).toBe('SCHEDULED');
            expect(meetingsResult).toHaveLength(1);
        });
        it('should handle therapist availability management workflow', async () => {
            // 1. Create availability
            const availabilityDto = {
                dayOfWeek: 1,
                startTime: '09:00',
                endTime: '17:00',
                isAvailable: true,
            };
            const mockAvailability = {
                id: 'availability-workflow',
                therapistId: test_utils_1.TEST_USER_IDS.THERAPIST,
                ...availabilityDto,
            };
            bookingService.createAvailability.mockResolvedValue(mockAvailability);
            // 2. Get availability to verify
            bookingService.getAvailability.mockResolvedValue([
                mockAvailability,
            ]);
            // 3. Update availability
            const updateDto = {
                dayOfWeek: 1,
                startTime: '09:00',
                endTime: '16:00'
            };
            const mockUpdatedAvailability = {
                ...mockAvailability,
                ...updateDto,
            };
            bookingService.updateAvailability.mockResolvedValue(mockUpdatedAvailability);
            // Execute workflow
            const createResult = await controller.createAvailability(availabilityDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            const getResult = await controller.getAvailability(test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            const updateResult = await controller.updateAvailability(mockAvailability.id, updateDto, test_utils_1.TEST_USER_IDS.THERAPIST, 'therapist');
            expect(createResult.isAvailable).toBe(true);
            expect(getResult).toHaveLength(1);
            expect(updateResult.endTime).toBe('16:00');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2Jvb2tpbmcvYm9va2luZy5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBTXdCO0FBQ3hCLDZEQUF5RDtBQUN6RCx1REFBbUQ7QUFDbkQsZ0ZBQW9FO0FBQ3BFLDJDQUErQztBQUMvQyw4Q0FHdUI7QUFDdkIsK0VBRzZDO0FBRTdDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxVQUE2QixDQUFDO0lBQ2xDLElBQUksY0FBMkMsQ0FBQztJQUVoRCxNQUFNLGtCQUFrQixHQUFHO1FBQ3pCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3RCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3JCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDN0IsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDMUIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM3QixrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzdCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3ZCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDNUIsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQyxDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sVUFBVSxHQUFHLElBQUEsb0NBQXVCLEdBQUUsQ0FBQztRQUU3QyxNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENB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QU8sQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYm9va2luZy9ib29raW5nLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7XG4gIEh0dHBTdGF0dXMsXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgVW5hdXRob3JpemVkRXhjZXB0aW9uLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQm9va2luZ0NvbnRyb2xsZXIgfSBmcm9tICcuL2Jvb2tpbmcuY29udHJvbGxlcic7XG5pbXBvcnQgeyBCb29raW5nU2VydmljZSB9IGZyb20gJy4vYm9va2luZy5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBNZWV0aW5nU3RhdHVzIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHtcbiAgY3JlYXRlTW9ja1ByaXNtYVNlcnZpY2UsXG4gIFRFU1RfVVNFUl9JRFMsXG59IGZyb20gJy4uL3Rlc3QtdXRpbHMnO1xuaW1wb3J0IHtcbiAgVGVzdERhdGFHZW5lcmF0b3IsXG4gIFRlc3RBc3NlcnRpb25zLFxufSBmcm9tICcuLi90ZXN0LXV0aWxzL2VuaGFuY2VkLXRlc3QtaGVscGVycyc7XG5cbmRlc2NyaWJlKCdCb29raW5nQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IEJvb2tpbmdDb250cm9sbGVyO1xuICBsZXQgYm9va2luZ1NlcnZpY2U6IGplc3QuTW9ja2VkPEJvb2tpbmdTZXJ2aWNlPjtcblxuICBjb25zdCBtb2NrQm9va2luZ1NlcnZpY2UgPSB7XG4gICAgY3JlYXRlTWVldGluZzogamVzdC5mbigpLFxuICAgIGdldE1lZXRpbmdzOiBqZXN0LmZuKCksXG4gICAgZ2V0TWVldGluZzogamVzdC5mbigpLFxuICAgIHVwZGF0ZU1lZXRpbmc6IGplc3QuZm4oKSxcbiAgICBjYW5jZWxNZWV0aW5nOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlQXZhaWxhYmlsaXR5OiBqZXN0LmZuKCksXG4gICAgZ2V0QXZhaWxhYmlsaXR5OiBqZXN0LmZuKCksXG4gICAgdXBkYXRlQXZhaWxhYmlsaXR5OiBqZXN0LmZuKCksXG4gICAgZGVsZXRlQXZhaWxhYmlsaXR5OiBqZXN0LmZuKCksXG4gICAgZ2V0RHVyYXRpb25zOiBqZXN0LmZuKCksXG4gICAgZ2V0QXZhaWxhYmxlU2xvdHM6IGplc3QuZm4oKSxcbiAgICBjaGVja01lZXRpbmdBdmFpbGFiaWxpdHk6IGplc3QuZm4oKSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrUHJpc21hID0gY3JlYXRlTW9ja1ByaXNtYVNlcnZpY2UoKTtcblxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW0Jvb2tpbmdDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQm9va2luZ1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tCb29raW5nU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFByaXNtYVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQcmlzbWEsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PEJvb2tpbmdDb250cm9sbGVyPihCb29raW5nQ29udHJvbGxlcik7XG4gICAgYm9va2luZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0KEJvb2tpbmdTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Jhc2ljIGZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbnRyb2xsZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgYm9va2luZ1NlcnZpY2UgaW5qZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVNZWV0aW5nJywgKCkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZU1lZXRpbmdEdG8gPSB7XG4gICAgICB0aGVyYXBpc3RJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLCAvLyBUb21vcnJvd1xuICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICB0aXRsZTogJ0luaXRpYWwgY29uc3VsdGF0aW9uJyxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBjbGllbnRzIHRvIGNyZWF0ZSBtZWV0aW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tNZWV0aW5nID0ge1xuICAgICAgICBpZDogJ21lZXRpbmctMTIzJyxcbiAgICAgICAgLi4uY3JlYXRlTWVldGluZ0R0byxcbiAgICAgICAgY2xpZW50SWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBzdGF0dXM6IE1lZXRpbmdTdGF0dXMuU0NIRURVTEVELFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmNyZWF0ZU1lZXRpbmcubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lZXRpbmcgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVNZWV0aW5nKFxuICAgICAgICBjcmVhdGVNZWV0aW5nRHRvLFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2NsaWVudCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuY3JlYXRlTWVldGluZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGNyZWF0ZU1lZXRpbmdEdG8sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja01lZXRpbmcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3Qgbm9uLWNsaWVudCB1c2VycyBmcm9tIGNyZWF0aW5nIG1lZXRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZU1lZXRpbmcoXG4gICAgICAgICAgY3JlYXRlTWVldGluZ0R0byxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5jcmVhdGVNZWV0aW5nKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgYWRtaW4gdXNlcnMgZnJvbSBjcmVhdGluZyBtZWV0aW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVNZWV0aW5nKFxuICAgICAgICAgIGNyZWF0ZU1lZXRpbmdEdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICAgICAnYWRtaW4nLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmNyZWF0ZU1lZXRpbmcpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBib29raW5nIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYm9va2luZ1NlcnZpY2UuY3JlYXRlTWVldGluZy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1RoZXJhcGlzdCBub3QgYXZhaWxhYmxlIGF0IHRoaXMgdGltZScpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZU1lZXRpbmcoXG4gICAgICAgICAgY3JlYXRlTWVldGluZ0R0byxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2NoZWR1bGluZyBjb25mbGljdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBib29raW5nU2VydmljZS5jcmVhdGVNZWV0aW5nLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignVGltZSBzbG90IG5vdCBhdmFpbGFibGUnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVNZWV0aW5nKGNyZWF0ZU1lZXRpbmdEdG8sIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAnY2xpZW50JyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmNyZWF0ZU1lZXRpbmcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjcmVhdGVNZWV0aW5nRHRvLFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIHRoZXJhcGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRNZWV0aW5nRGF0YSA9IHtcbiAgICAgICAgLi4uY3JlYXRlTWVldGluZ0R0byxcbiAgICAgICAgdGhlcmFwaXN0SWQ6ICdpbnZhbGlkLXRoZXJhcGlzdC1pZCcsXG4gICAgICB9O1xuXG4gICAgICBib29raW5nU2VydmljZS5jcmVhdGVNZWV0aW5nLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1RoZXJhcGlzdCBub3QgZm91bmQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVNZWV0aW5nKFxuICAgICAgICAgIGludmFsaWRNZWV0aW5nRGF0YSxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgbWVldGluZyBkdXJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWREdXJhdGlvbkRhdGEgPSB7XG4gICAgICAgIC4uLmNyZWF0ZU1lZXRpbmdEdG8sXG4gICAgICAgIGR1cmF0aW9uOiAwLFxuICAgICAgfTtcblxuICAgICAgYm9va2luZ1NlcnZpY2UuY3JlYXRlTWVldGluZy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ludmFsaWQgbWVldGluZyBkdXJhdGlvbicpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZU1lZXRpbmcoXG4gICAgICAgICAgaW52YWxpZER1cmF0aW9uRGF0YSxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0TWVldGluZ3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbWVldGluZ3MgZm9yIGNsaWVudCB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tNZWV0aW5ncyA9IFtcbiAgICAgICAgVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVldGluZyh7XG4gICAgICAgICAgY2xpZW50SWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHRoZXJhcGlzdElkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgICBzdGF0dXM6ICdTQ0hFRFVMRUQnLFxuICAgICAgICB9KSxcbiAgICAgICAgVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVldGluZyh7XG4gICAgICAgICAgY2xpZW50SWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHRoZXJhcGlzdElkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgICB9KSxcbiAgICAgIF07XG5cbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5ncyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE1lZXRpbmdzKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2NsaWVudCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuZ2V0TWVldGluZ3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2NsaWVudCcsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTWVldGluZ3MpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbWVldGluZ3MgZm9yIHRoZXJhcGlzdCB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tNZWV0aW5ncyA9IFtcbiAgICAgICAgVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVldGluZyh7XG4gICAgICAgICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAgIHN0YXR1czogJ1NDSEVEVUxFRCcsXG4gICAgICAgIH0pLFxuICAgICAgICBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVNZWV0aW5nKHtcbiAgICAgICAgICB0aGVyYXBpc3RJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICAgc3RhdHVzOiAnSU5fUFJPR1JFU1MnLFxuICAgICAgICB9KSxcbiAgICAgIF07XG5cbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5ncyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE1lZXRpbmdzKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuZ2V0TWVldGluZ3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTWVldGluZ3MpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgd2hlbiBubyBtZWV0aW5ncyBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRNZWV0aW5ncyhcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICdjbGllbnQnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhZG1pbiByb2xlIGFwcHJvcHJpYXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQWRtaW5NZWV0aW5ncyA9IFtcbiAgICAgICAgVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVldGluZyh7IHN0YXR1czogJ1NDSEVEVUxFRCcgfSksXG4gICAgICBdO1xuXG4gICAgICBib29raW5nU2VydmljZS5nZXRNZWV0aW5ncy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQWRtaW5NZWV0aW5ncyBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE1lZXRpbmdzKFxuICAgICAgICBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICAnYWRtaW4nLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICAgJ2FkbWluJyxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tBZG1pbk1lZXRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE1lZXRpbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgbWVldGluZ0lkID0gJ21lZXRpbmctMTIzJztcbiAgICBjb25zdCBtb2NrTWVldGluZyA9IHtcbiAgICAgIGlkOiBtZWV0aW5nSWQsXG4gICAgICBjbGllbnRJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICB0aGVyYXBpc3RJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDI0LTEyLTAxVDEwOjAwOjAwWicpLFxuICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgc3RhdHVzOiBNZWV0aW5nU3RhdHVzLlNDSEVEVUxFRCxcbiAgICAgIG1lZXRpbmdUeXBlOiAndmlkZW8nLFxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBtZWV0aW5nIGZvciBhdXRob3JpemVkIGNsaWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmcubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lZXRpbmcgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRNZWV0aW5nKFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAnY2xpZW50JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5nZXRNZWV0aW5nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2NsaWVudCcsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTWVldGluZyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBtZWV0aW5nIGZvciBhdXRob3JpemVkIHRoZXJhcGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmcubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lZXRpbmcgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRNZWV0aW5nKFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5nZXRNZWV0aW5nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTWVldGluZyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtZWV0aW5nIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmcubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignTWVldGluZyBub3QgZm91bmQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRNZWV0aW5nKFxuICAgICAgICAgICdpbnZhbGlkLW1lZXRpbmctaWQnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICdjbGllbnQnLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5hdXRob3JpemVkIGFjY2VzcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmcubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ0FjY2VzcyBkZW5pZWQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRNZWV0aW5nKG1lZXRpbmdJZCwgJ3VuYXV0aG9yaXplZC11c2VyJywgJ2NsaWVudCcpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZU1lZXRpbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgbWVldGluZ0lkID0gJ21lZXRpbmctMTIzJztcbiAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgc3RhcnRUaW1lOiAnMjAyNC0xMi0wMVQxNDowMDowMFonLFxuICAgICAgdGl0bGU6ICdVcGRhdGVkIG1lZXRpbmcnLFxuICAgICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgZHVyYXRpb246IDYwLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSB1cGRhdGUgbWVldGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWRNZWV0aW5nID0ge1xuICAgICAgICBpZDogbWVldGluZ0lkLFxuICAgICAgICBjbGllbnRJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIC4uLnVwZGF0ZURhdGEsXG4gICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgc3RhdHVzOiBNZWV0aW5nU3RhdHVzLlNDSEVEVUxFRCxcbiAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGJvb2tpbmdTZXJ2aWNlLnVwZGF0ZU1lZXRpbmcubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZE1lZXRpbmcgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVNZWV0aW5nKFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIHVwZGF0ZURhdGEgYXMgYW55LFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2NsaWVudCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UudXBkYXRlTWVldGluZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgdXBkYXRlRGF0YSxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICdjbGllbnQnLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZE1lZXRpbmcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBtZWV0aW5nIHVwZGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLnVwZGF0ZU1lZXRpbmcubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdDYW5ub3QgdXBkYXRlIHBhc3QgbWVldGluZycpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLnVwZGF0ZU1lZXRpbmcoXG4gICAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICAgIHVwZGF0ZURhdGEgYXMgYW55LFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICdjbGllbnQnLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmF1dGhvcml6ZWQgdXBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYm9va2luZ1NlcnZpY2UudXBkYXRlTWVldGluZy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignT25seSBtZWV0aW5nIHBhcnRpY2lwYW50cyBjYW4gdXBkYXRlJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIudXBkYXRlTWVldGluZyhcbiAgICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgICAgdXBkYXRlRGF0YSBhcyBhbnksXG4gICAgICAgICAgJ3VuYXV0aG9yaXplZC11c2VyJyxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHRoZXJhcGlzdHMgdG8gdXBkYXRlIG1lZXRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGhlcmFwaXN0VXBkYXRlID0ge1xuICAgICAgICBzdGFydFRpbWU6ICcyMDI0LTEyLTAxVDE1OjAwOjAwWicsXG4gICAgICAgIHRoZXJhcGlzdElkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgICB0aXRsZTogJ1RoZXJhcGlzdCB1cGRhdGVkIG1lZXRpbmcnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1VwZGF0ZWRNZWV0aW5nID0ge1xuICAgICAgICBpZDogbWVldGluZ0lkLFxuICAgICAgICAuLi50aGVyYXBpc3RVcGRhdGUsXG4gICAgICB9O1xuXG4gICAgICBib29raW5nU2VydmljZS51cGRhdGVNZWV0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrVXBkYXRlZE1lZXRpbmcgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVNZWV0aW5nKFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIHRoZXJhcGlzdFVwZGF0ZSxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICd0aGVyYXBpc3QnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXBkYXRlZE1lZXRpbmcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2FuY2VsTWVldGluZycsICgpID0+IHtcbiAgICBjb25zdCBtZWV0aW5nSWQgPSAnbWVldGluZy0xMjMnO1xuXG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgY2FuY2VsIG1lZXRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYW5jZWxsZWRNZWV0aW5nID0ge1xuICAgICAgICBpZDogbWVldGluZ0lkLFxuICAgICAgICBjbGllbnRJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHRoZXJhcGlzdElkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgc3RhdHVzOiBNZWV0aW5nU3RhdHVzLkNBTkNFTExFRCxcbiAgICAgICAgY2FuY2VsbGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogJ0NsaWVudCByZXF1ZXN0JyxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgYm9va2luZ1NlcnZpY2UuY2FuY2VsTWVldGluZy5tb2NrUmVzb2x2ZWRWYWx1ZShjYW5jZWxsZWRNZWV0aW5nIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY2FuY2VsTWVldGluZyhcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgJ2NsaWVudCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuY2FuY2VsTWVldGluZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICdjbGllbnQnLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoY2FuY2VsbGVkTWVldGluZyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjYW5jZWxsYXRpb24gb2YgYWxyZWFkeSBjYW5jZWxsZWQgbWVldGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmNhbmNlbE1lZXRpbmcubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdNZWV0aW5nIGFscmVhZHkgY2FuY2VsbGVkJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY2FuY2VsTWVldGluZyhtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAnY2xpZW50JyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuYXV0aG9yaXplZCBjYW5jZWxsYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBib29raW5nU2VydmljZS5jYW5jZWxNZWV0aW5nLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdBY2Nlc3MgZGVuaWVkJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY2FuY2VsTWVldGluZyhtZWV0aW5nSWQsICd1bmF1dGhvcml6ZWQtdXNlcicsICdjbGllbnQnKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHRoZXJhcGlzdHMgdG8gY2FuY2VsIG1lZXRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RoZXJhcGlzdENhbmNlbGxhdGlvbiA9IHtcbiAgICAgICAgaWQ6IG1lZXRpbmdJZCxcbiAgICAgICAgc3RhdHVzOiAnQ0FOQ0VMTEVEJyxcbiAgICAgICAgY2FuY2VsbGVkQnk6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBjYW5jZWxsYXRpb25SZWFzb246ICdFbWVyZ2VuY3knLFxuICAgICAgfTtcblxuICAgICAgYm9va2luZ1NlcnZpY2UuY2FuY2VsTWVldGluZy5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja1RoZXJhcGlzdENhbmNlbGxhdGlvbiBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNhbmNlbE1lZXRpbmcoXG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICd0aGVyYXBpc3QnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVGhlcmFwaXN0Q2FuY2VsbGF0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZUF2YWlsYWJpbGl0eSAoVGhlcmFwaXN0IE9ubHkpJywgKCkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZUF2YWlsYWJpbGl0eUR0byA9IHtcbiAgICAgIGRheU9mV2VlazogMSwgLy8gTW9uZGF5XG4gICAgICBzdGFydFRpbWU6ICcwOTowMCcsXG4gICAgICBlbmRUaW1lOiAnMTc6MDAnLFxuICAgICAgaXNBdmFpbGFibGU6IHRydWUsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdGhlcmFwaXN0cyB0byBjcmVhdGUgYXZhaWxhYmlsaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0F2YWlsYWJpbGl0eSA9IHtcbiAgICAgICAgaWQ6ICdhdmFpbGFiaWxpdHktMTIzJyxcbiAgICAgICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAuLi5jcmVhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgYm9va2luZ1NlcnZpY2UuY3JlYXRlQXZhaWxhYmlsaXR5Lm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrQXZhaWxhYmlsaXR5IGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlQXZhaWxhYmlsaXR5KFxuICAgICAgICBjcmVhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5jcmVhdGVBdmFpbGFiaWxpdHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjcmVhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0F2YWlsYWJpbGl0eSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBub24tdGhlcmFwaXN0IHVzZXJzIGZyb20gY3JlYXRpbmcgYXZhaWxhYmlsaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZUF2YWlsYWJpbGl0eShcbiAgICAgICAgICBjcmVhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgJ2NsaWVudCcsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuY3JlYXRlQXZhaWxhYmlsaXR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgYWRtaW4gdXNlcnMgZnJvbSBjcmVhdGluZyBhdmFpbGFiaWxpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlQXZhaWxhYmlsaXR5KFxuICAgICAgICAgIGNyZWF0ZUF2YWlsYWJpbGl0eUR0byxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICAgICdhZG1pbicsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuY3JlYXRlQXZhaWxhYmlsaXR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXZhaWxhYmlsaXR5IGNyZWF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmNyZWF0ZUF2YWlsYWJpbGl0eS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ludmFsaWQgdGltZSByYW5nZScpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZUF2YWlsYWJpbGl0eShcbiAgICAgICAgICBjcmVhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEF2YWlsYWJpbGl0eSAoVGhlcmFwaXN0IE9ubHkpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWxsb3cgdGhlcmFwaXN0cyB0byB2aWV3IHRoZWlyIGF2YWlsYWJpbGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tBdmFpbGFiaWxpdGllcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnYXZhaWxhYmlsaXR5LTEnLFxuICAgICAgICAgIHRoZXJhcGlzdElkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgICBkYXlPZldlZWs6IDEsXG4gICAgICAgICAgc3RhcnRUaW1lOiAnMDk6MDAnLFxuICAgICAgICAgIGVuZFRpbWU6ICcxMjowMCcsXG4gICAgICAgICAgaXNBdmFpbGFibGU6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ2F2YWlsYWJpbGl0eS0yJyxcbiAgICAgICAgICB0aGVyYXBpc3RJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICAgZGF5T2ZXZWVrOiAxLFxuICAgICAgICAgIHN0YXJ0VGltZTogJzE0OjAwJyxcbiAgICAgICAgICBlbmRUaW1lOiAnMTc6MDAnLFxuICAgICAgICAgIGlzQXZhaWxhYmxlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgYm9va2luZ1NlcnZpY2UuZ2V0QXZhaWxhYmlsaXR5Lm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrQXZhaWxhYmlsaXRpZXMgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBdmFpbGFiaWxpdHkoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5nZXRBdmFpbGFiaWxpdHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tBdmFpbGFiaWxpdGllcyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBub24tdGhlcmFwaXN0IHVzZXJzIGZyb20gdmlld2luZyBhdmFpbGFiaWxpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0QXZhaWxhYmlsaXR5KFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAnY2xpZW50JyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pO1xuXG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuZ2V0QXZhaWxhYmlsaXR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgZm9yIHRoZXJhcGlzdCB3aXRoIG5vIGF2YWlsYWJpbGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldEF2YWlsYWJpbGl0eS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QXZhaWxhYmlsaXR5KFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZUF2YWlsYWJpbGl0eSAoVGhlcmFwaXN0IE9ubHkpJywgKCkgPT4ge1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eUlkID0gJ2F2YWlsYWJpbGl0eS0xMjMnO1xuICAgIGNvbnN0IHVwZGF0ZUF2YWlsYWJpbGl0eUR0byA9IHtcbiAgICAgIGRheU9mV2VlazogMSxcbiAgICAgIHN0YXJ0VGltZTogJzEwOjAwJyxcbiAgICAgIGVuZFRpbWU6ICcxNjowMCcsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdGhlcmFwaXN0cyB0byB1cGRhdGUgdGhlaXIgYXZhaWxhYmlsaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VwZGF0ZWRBdmFpbGFiaWxpdHkgPSB7XG4gICAgICAgIGlkOiBhdmFpbGFiaWxpdHlJZCxcbiAgICAgICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAuLi51cGRhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGJvb2tpbmdTZXJ2aWNlLnVwZGF0ZUF2YWlsYWJpbGl0eS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja1VwZGF0ZWRBdmFpbGFiaWxpdHkgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVBdmFpbGFiaWxpdHkoXG4gICAgICAgIGF2YWlsYWJpbGl0eUlkLFxuICAgICAgICB1cGRhdGVBdmFpbGFiaWxpdHlEdG8sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS51cGRhdGVBdmFpbGFiaWxpdHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBhdmFpbGFiaWxpdHlJZCxcbiAgICAgICAgdXBkYXRlQXZhaWxhYmlsaXR5RHRvLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVcGRhdGVkQXZhaWxhYmlsaXR5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5vbi10aGVyYXBpc3QgdXNlcnMgZnJvbSB1cGRhdGluZyBhdmFpbGFiaWxpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIudXBkYXRlQXZhaWxhYmlsaXR5KFxuICAgICAgICAgIGF2YWlsYWJpbGl0eUlkLFxuICAgICAgICAgIHVwZGF0ZUF2YWlsYWJpbGl0eUR0byxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEV4Y2VwdGlvbik7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS51cGRhdGVBdmFpbGFiaWxpdHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhdmFpbGFiaWxpdHkgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYm9va2luZ1NlcnZpY2UudXBkYXRlQXZhaWxhYmlsaXR5Lm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0F2YWlsYWJpbGl0eSBub3QgZm91bmQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci51cGRhdGVBdmFpbGFiaWxpdHkoXG4gICAgICAgICAgJ25vbi1leGlzdGVudC1hdmFpbGFiaWxpdHknLFxuICAgICAgICAgIHVwZGF0ZUF2YWlsYWJpbGl0eUR0byxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZUF2YWlsYWJpbGl0eSAoVGhlcmFwaXN0IE9ubHkpJywgKCkgPT4ge1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eUlkID0gJ2F2YWlsYWJpbGl0eS0xMjMnO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyB0aGVyYXBpc3RzIHRvIGRlbGV0ZSB0aGVpciBhdmFpbGFiaWxpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRGVsZXRlZEF2YWlsYWJpbGl0eSA9IHtcbiAgICAgICAgaWQ6IGF2YWlsYWJpbGl0eUlkLFxuICAgICAgICB0aGVyYXBpc3RJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgIGRlbGV0ZWQ6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBib29raW5nU2VydmljZS5kZWxldGVBdmFpbGFiaWxpdHkubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tEZWxldGVkQXZhaWxhYmlsaXR5IGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZGVsZXRlQXZhaWxhYmlsaXR5KFxuICAgICAgICBhdmFpbGFiaWxpdHlJZCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICd0aGVyYXBpc3QnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmRlbGV0ZUF2YWlsYWJpbGl0eSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGF2YWlsYWJpbGl0eUlkLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tEZWxldGVkQXZhaWxhYmlsaXR5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5vbi10aGVyYXBpc3QgdXNlcnMgZnJvbSBkZWxldGluZyBhdmFpbGFiaWxpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZGVsZXRlQXZhaWxhYmlsaXR5KFxuICAgICAgICAgIGF2YWlsYWJpbGl0eUlkLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICdjbGllbnQnLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmRlbGV0ZUF2YWlsYWJpbGl0eSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbGV0aW9uIG9mIG5vbi1leGlzdGVudCBhdmFpbGFiaWxpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBib29raW5nU2VydmljZS5kZWxldGVBdmFpbGFiaWxpdHkubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQXZhaWxhYmlsaXR5IG5vdCBmb3VuZCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmRlbGV0ZUF2YWlsYWJpbGl0eShcbiAgICAgICAgICAnbm9uLWV4aXN0ZW50LWF2YWlsYWJpbGl0eScsXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXREdXJhdGlvbnMgKFB1YmxpYyknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYXZhaWxhYmxlIHNlc3Npb24gZHVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0R1cmF0aW9ucyA9IFtcbiAgICAgICAgeyB2YWx1ZTogMzAsIGxhYmVsOiAnMzAgbWludXRlcycgfSxcbiAgICAgICAgeyB2YWx1ZTogNDUsIGxhYmVsOiAnNDUgbWludXRlcycgfSxcbiAgICAgICAgeyB2YWx1ZTogNjAsIGxhYmVsOiAnMSBob3VyJyB9LFxuICAgICAgICB7IHZhbHVlOiA5MCwgbGFiZWw6ICcxLjUgaG91cnMnIH0sXG4gICAgICBdO1xuXG4gICAgICBib29raW5nU2VydmljZS5nZXREdXJhdGlvbnMubW9ja1JldHVyblZhbHVlKG1vY2tEdXJhdGlvbnMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gY29udHJvbGxlci5nZXREdXJhdGlvbnMoKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmdldER1cmF0aW9ucykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRHVyYXRpb25zKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCg0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGR1cmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldER1cmF0aW9ucy5tb2NrUmV0dXJuVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjb250cm9sbGVyLmdldER1cmF0aW9ucygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEF2YWlsYWJsZVNsb3RzIChQdWJsaWMpJywgKCkgPT4ge1xuICAgIGNvbnN0IHRoZXJhcGlzdElkID0gVEVTVF9VU0VSX0lEUy5USEVSQVBJU1Q7XG4gICAgY29uc3QgZGF0ZSA9ICcyMDI0LTEyLTE1JztcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGF2YWlsYWJsZSB0aW1lIHNsb3RzIGZvciBhIHRoZXJhcGlzdCBvbiBhIHNwZWNpZmljIGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrU2xvdHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBzdGFydFRpbWU6ICcwOTowMCcsXG4gICAgICAgICAgZW5kVGltZTogJzEwOjAwJyxcbiAgICAgICAgICBkdXJhdGlvbjogNjAsXG4gICAgICAgICAgYXZhaWxhYmxlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgc3RhcnRUaW1lOiAnMTA6MDAnLFxuICAgICAgICAgIGVuZFRpbWU6ICcxMTowMCcsXG4gICAgICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgICAgIGF2YWlsYWJsZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXJ0VGltZTogJzE0OjAwJyxcbiAgICAgICAgICBlbmRUaW1lOiAnMTU6MDAnLFxuICAgICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgICBhdmFpbGFibGU6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBib29raW5nU2VydmljZS5nZXRBdmFpbGFibGVTbG90cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU2xvdHMgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBdmFpbGFibGVTbG90cyh0aGVyYXBpc3RJZCwgZGF0ZSk7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5nZXRBdmFpbGFibGVTbG90cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHRoZXJhcGlzdElkLFxuICAgICAgICBkYXRlLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Nsb3RzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IHdoZW4gbm8gc2xvdHMgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYm9va2luZ1NlcnZpY2UuZ2V0QXZhaWxhYmxlU2xvdHMubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldEF2YWlsYWJsZVNsb3RzKHRoZXJhcGlzdElkLCBkYXRlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIHRoZXJhcGlzdCBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldEF2YWlsYWJsZVNsb3RzLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1RoZXJhcGlzdCBub3QgZm91bmQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRBdmFpbGFibGVTbG90cygnaW52YWxpZC10aGVyYXBpc3QtaWQnLCBkYXRlKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZGF0ZSBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBib29raW5nU2VydmljZS5nZXRBdmFpbGFibGVTbG90cy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ludmFsaWQgZGF0ZSBmb3JtYXQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRBdmFpbGFibGVTbG90cyh0aGVyYXBpc3RJZCwgJ2ludmFsaWQtZGF0ZScpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYXN0IGRhdGVzIGFwcHJvcHJpYXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXN0RGF0ZSA9ICcyMDIwLTAxLTAxJztcblxuICAgICAgYm9va2luZ1NlcnZpY2UuZ2V0QXZhaWxhYmxlU2xvdHMubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdDYW5ub3QgZ2V0IHNsb3RzIGZvciBwYXN0IGRhdGVzJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0QXZhaWxhYmxlU2xvdHModGhlcmFwaXN0SWQsIHBhc3REYXRlKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUm9sZS1CYXNlZCBBY2Nlc3MgQ29udHJvbCBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2Ugcm9sZSByZXN0cmljdGlvbnMgYWNyb3NzIGFsbCBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGNsaWVudCByZXN0cmljdGlvbnNcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVBdmFpbGFiaWxpdHkoXG4gICAgICAgICAge30gYXMgYW55LFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICdjbGllbnQnLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldEF2YWlsYWJpbGl0eShURVNUX1VTRVJfSURTLkNMSUVOVCwgJ2NsaWVudCcpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcblxuICAgICAgLy8gVGVzdCB0aGVyYXBpc3QgcmVzdHJpY3Rpb25zXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlTWVldGluZyh7fSBhcyBhbnksIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCAndGhlcmFwaXN0JyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuXG4gICAgICAvLyBWZXJpZnkgbm8gc2VydmljZSBjYWxscyB3ZXJlIG1hZGVcbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5jcmVhdGVBdmFpbGFiaWxpdHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QoYm9va2luZ1NlcnZpY2UuZ2V0QXZhaWxhYmlsaXR5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmNyZWF0ZU1lZXRpbmcpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFwcHJvcHJpYXRlIHJvbGUgYWNjZXNzIHRvIHNoYXJlZCBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTWVldGluZ3MgPSBbVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVldGluZygpXTtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5ncyBhcyBhbnkpO1xuXG4gICAgICAvLyBCb3RoIGNsaWVudCBhbmQgdGhlcmFwaXN0IHNob3VsZCBhY2Nlc3MgZ2V0TWVldGluZ3NcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZ2V0TWVldGluZ3MoVEVTVF9VU0VSX0lEUy5DTElFTlQsICdjbGllbnQnKTtcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZ2V0TWVldGluZ3MoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsICd0aGVyYXBpc3QnKTtcblxuICAgICAgZXhwZWN0KGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2RlcmF0b3IgYW5kIGFkbWluIHJvbGVzIGFwcHJvcHJpYXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTWVldGluZ3MgPSBbVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlTWVldGluZygpXTtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5ncyBhcyBhbnkpO1xuXG4gICAgICAvLyBBZG1pbiBzaG91bGQgYmUgYWJsZSB0byB2aWV3IG1lZXRpbmdzXG4gICAgICBhd2FpdCBjb250cm9sbGVyLmdldE1lZXRpbmdzKFRFU1RfVVNFUl9JRFMuQURNSU4sICdhZG1pbicpO1xuXG4gICAgICAvLyBCdXQgYWRtaW4gY2Fubm90IGNyZWF0ZSBtZWV0aW5nc1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZU1lZXRpbmcoe30gYXMgYW55LCBURVNUX1VTRVJfSURTLkFETUlOLCAnYWRtaW4nKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG5cbiAgICAgIGV4cGVjdChib29raW5nU2VydmljZS5nZXRNZWV0aW5ncykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgICdhZG1pbicsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcgYW5kIEVkZ2UgQ2FzZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmNyZWF0ZU1lZXRpbmcubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVNZWV0aW5nKHt9IGFzIGFueSwgVEVTVF9VU0VSX0lEUy5DTElFTlQsICdjbGllbnQnKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXNzIHRocm91Z2ggSFRUUCBleGNlcHRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignUmVzb3VyY2Ugbm90IGZvdW5kJyk7XG4gICAgICBib29raW5nU2VydmljZS5nZXRNZWV0aW5nLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0TWVldGluZygnbWVldGluZy0xJywgVEVTVF9VU0VSX0lEUy5DTElFTlQsICdjbGllbnQnKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1hbGZvcm1lZCByZXF1ZXN0IGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWxmb3JtZWRNZWV0aW5nRHRvID0ge1xuICAgICAgICB0aGVyYXBpc3RJZDogbnVsbCxcbiAgICAgICAgc3RhcnRUaW1lOiAnaW52YWxpZC1kYXRlJyxcbiAgICAgICAgZHVyYXRpb246IC0xLFxuICAgICAgfTtcblxuICAgICAgYm9va2luZ1NlcnZpY2UuY3JlYXRlTWVldGluZy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ludmFsaWQgbWVldGluZyBkYXRhJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlTWVldGluZyhcbiAgICAgICAgICBtYWxmb3JtZWRNZWV0aW5nRHRvIGFzIGFueSxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBib29raW5nIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29uY3VycmVudEJvb2tpbmdEdG8gPSB7XG4gICAgICAgIHRoZXJhcGlzdElkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICB9O1xuXG4gICAgICAvLyBTaW11bGF0ZSBjb25mbGljdFxuICAgICAgYm9va2luZ1NlcnZpY2UuY3JlYXRlTWVldGluZy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1RpbWUgc2xvdCBubyBsb25nZXIgYXZhaWxhYmxlJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlTWVldGluZyhcbiAgICAgICAgICBjb25jdXJyZW50Qm9va2luZ0R0byxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgY29ubmVjdGlvbiBpc3N1ZXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0TWVldGluZ3MoVEVTVF9VU0VSX0lEUy5DTElFTlQsICdjbGllbnQnKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gV29ya2Zsb3cgVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgYm9va2luZyB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIDEuIEdldCBhdmFpbGFibGUgc2xvdHNcbiAgICAgIGNvbnN0IG1vY2tTbG90cyA9IFtcbiAgICAgICAgeyBzdGFydFRpbWU6ICcxMDowMCcsIGVuZFRpbWU6ICcxMTowMCcsIGF2YWlsYWJsZTogdHJ1ZSB9LFxuICAgICAgXTtcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldEF2YWlsYWJsZVNsb3RzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTbG90cyBhcyBhbnkpO1xuXG4gICAgICAvLyAyLiBDcmVhdGUgbWVldGluZ1xuICAgICAgY29uc3QgbWVldGluZ0R0byA9IHtcbiAgICAgICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBzdGFydFRpbWU6ICcyMDI0LTEyLTE1VDEwOjAwOjAwWicsXG4gICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja01lZXRpbmcgPSB7XG4gICAgICAgIGlkOiAnbWVldGluZy13b3JrZmxvdycsXG4gICAgICAgIC4uLm1lZXRpbmdEdG8sXG4gICAgICAgIGNsaWVudElkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgc3RhdHVzOiAnU0NIRURVTEVEJyxcbiAgICAgIH07XG4gICAgICBib29raW5nU2VydmljZS5jcmVhdGVNZWV0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5nIGFzIGFueSk7XG5cbiAgICAgIC8vIDMuIEdldCBtZWV0aW5ncyB0byB2ZXJpZnlcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrTWVldGluZ10gYXMgYW55KTtcblxuICAgICAgLy8gRXhlY3V0ZSB3b3JrZmxvd1xuICAgICAgY29uc3Qgc2xvdHNSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldEF2YWlsYWJsZVNsb3RzKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJzIwMjQtMTItMTUnLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IG1lZXRpbmdSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZU1lZXRpbmcoXG4gICAgICAgIG1lZXRpbmdEdG8sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAnY2xpZW50JyxcbiAgICAgICk7XG4gICAgICBjb25zdCBtZWV0aW5nc1Jlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0TWVldGluZ3MoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAnY2xpZW50JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChzbG90c1Jlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KG1lZXRpbmdSZXN1bHQuc3RhdHVzKS50b0JlKCdTQ0hFRFVMRUQnKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1Jlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdGhlcmFwaXN0IGF2YWlsYWJpbGl0eSBtYW5hZ2VtZW50IHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gMS4gQ3JlYXRlIGF2YWlsYWJpbGl0eVxuICAgICAgY29uc3QgYXZhaWxhYmlsaXR5RHRvID0ge1xuICAgICAgICBkYXlPZldlZWs6IDEsXG4gICAgICAgIHN0YXJ0VGltZTogJzA5OjAwJyxcbiAgICAgICAgZW5kVGltZTogJzE3OjAwJyxcbiAgICAgICAgaXNBdmFpbGFibGU6IHRydWUsXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja0F2YWlsYWJpbGl0eSA9IHtcbiAgICAgICAgaWQ6ICdhdmFpbGFiaWxpdHktd29ya2Zsb3cnLFxuICAgICAgICB0aGVyYXBpc3RJZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgIC4uLmF2YWlsYWJpbGl0eUR0byxcbiAgICAgIH07XG4gICAgICBib29raW5nU2VydmljZS5jcmVhdGVBdmFpbGFiaWxpdHkubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tBdmFpbGFiaWxpdHkgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gMi4gR2V0IGF2YWlsYWJpbGl0eSB0byB2ZXJpZnlcbiAgICAgIGJvb2tpbmdTZXJ2aWNlLmdldEF2YWlsYWJpbGl0eS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIG1vY2tBdmFpbGFiaWxpdHksXG4gICAgICBdIGFzIGFueSk7XG5cbiAgICAgIC8vIDMuIFVwZGF0ZSBhdmFpbGFiaWxpdHlcbiAgICAgIGNvbnN0IHVwZGF0ZUR0byA9IHsgXG4gICAgICAgIGRheU9mV2VlazogMSxcbiAgICAgICAgc3RhcnRUaW1lOiAnMDk6MDAnLFxuICAgICAgICBlbmRUaW1lOiAnMTY6MDAnIFxuICAgICAgfTtcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGVkQXZhaWxhYmlsaXR5ID0ge1xuICAgICAgICAuLi5tb2NrQXZhaWxhYmlsaXR5LFxuICAgICAgICAuLi51cGRhdGVEdG8sXG4gICAgICB9O1xuICAgICAgYm9va2luZ1NlcnZpY2UudXBkYXRlQXZhaWxhYmlsaXR5Lm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrVXBkYXRlZEF2YWlsYWJpbGl0eSBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICAvLyBFeGVjdXRlIHdvcmtmbG93XG4gICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZUF2YWlsYWJpbGl0eShcbiAgICAgICAgYXZhaWxhYmlsaXR5RHRvLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICApO1xuICAgICAgY29uc3QgZ2V0UmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBdmFpbGFiaWxpdHkoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAndGhlcmFwaXN0JyxcbiAgICAgICk7XG4gICAgICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZUF2YWlsYWJpbGl0eShcbiAgICAgICAgbW9ja0F2YWlsYWJpbGl0eS5pZCxcbiAgICAgICAgdXBkYXRlRHRvLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoY3JlYXRlUmVzdWx0LmlzQXZhaWxhYmxlKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGdldFJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHVwZGF0ZVJlc3VsdC5lbmRUaW1lKS50b0JlKCcxNjowMCcpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==