{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/dashboard/dashboard.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/dashboard/dashboard.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  InternalServerErrorException,\n} from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { MessagingService } from '../messaging/messaging.service';\n\n@Injectable()\nexport class DashboardService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly messagingService: MessagingService,\n  ) {}\n\n  async getClientDashboardData(userId: string) {\n    try {\n      const client = await this.prisma.client.findUnique({\n        where: { userId },\n        include: {\n          user: true,\n          assignedTherapists: {\n            include: {\n              therapist: {\n                include: { user: true },\n              },\n            },\n          },\n          meetings: {\n            where: { status: { in: ['SCHEDULED', 'CONFIRMED'] } },\n            orderBy: { startTime: 'asc' },\n            take: 5,\n            include: {\n              therapist: {\n                include: { user: true },\n              },\n            },\n          },\n          worksheets: {\n            where: { status: { in: ['ASSIGNED', 'OVERDUE'] } },\n            orderBy: { dueDate: 'asc' },\n            take: 5,\n            include: {\n              therapist: {\n                include: { user: true },\n              },\n            },\n          },\n          preAssessment: true,\n        },\n      });\n\n      if (!client) {\n        throw new NotFoundException(`Client not found for userId: ${userId}`);\n      }\n\n      // Validate that client has user relationship\n      if (!client.user) {\n        throw new InternalServerErrorException(\n          `Client found but user relationship is missing for userId: ${userId}`,\n        );\n      }\n\n      const completedMeetingsCount = await this.prisma.meeting.count({\n        where: { clientId: userId, status: 'COMPLETED' },\n      });\n\n      const completedWorksheetsCount = await this.prisma.worksheet.count({\n        where: { clientId: userId, status: { in: ['SUBMITTED', 'REVIEWED'] } },\n      });\n\n      const recentPosts = await this.prisma.post.findMany({\n        where: { userId: userId },\n        orderBy: { createdAt: 'desc' },\n        take: 3,\n        include: {\n          room: {\n            include: {\n              roomGroup: {\n                include: {\n                  community: true,\n                },\n              },\n            },\n          },\n          _count: {\n            select: { hearts: true, comments: true },\n          },\n        },\n      });\n\n      // Ensure conversations exist between client and assigned therapists\n      for (const assignment of client.assignedTherapists) {\n        const therapistId = assignment.therapist.userId;\n        try {\n          // Check if conversation already exists\n          const existingConversations = await this.messagingService.getUserConversations(userId, 1, 100);\n          const hasConversationWithTherapist = existingConversations.some(conv => \n            conv.participants?.some(p => p.userId === therapistId)\n          );\n\n          if (!hasConversationWithTherapist) {\n            // Auto-create conversation if it doesn't exist\n            await this.messagingService.createConversation(userId, {\n              participantIds: [therapistId],\n              type: 'direct',\n              title: `Therapy Session with ${assignment.therapist.user.firstName} ${assignment.therapist.user.lastName}`,\n            });\n            console.log(`‚úÖ Auto-created missing conversation between client ${userId} and therapist ${therapistId}`);\n          }\n        } catch (error) {\n          // Log but don't fail dashboard load if conversation creation fails\n          console.warn(`‚ö†Ô∏è Failed to ensure conversation exists between client ${userId} and therapist ${therapistId}:`, error);\n        }\n      }\n\n      const responseData = {\n        client,\n        stats: {\n          completedMeetings: completedMeetingsCount,\n          completedWorksheets: completedWorksheetsCount,\n          upcomingMeetings: client.meetings.length,\n          pendingWorksheets: client.worksheets.length,\n        },\n        upcomingMeetings: client.meetings,\n        pendingWorksheets: client.worksheets,\n        assignedTherapists: client.assignedTherapists.map((ct) => ct.therapist),\n        recentActivity: recentPosts,\n        hasPreAssessment: !!client.preAssessment,\n      };\n\n      return responseData;\n    } catch (error) {\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        `Failed to get user dashboard data: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async getTherapistDashboardData(userId: string) {\n    console.log(`üîç [DashboardService] Getting therapist dashboard data for userId: ${userId}`);\n    \n    try {\n      // First, verify the user exists and check their role\n      const user = await this.prisma.user.findUnique({\n        where: { id: userId },\n        select: {\n          id: true,\n          email: true,\n          firstName: true,\n          lastName: true,\n          role: true,\n          isActive: true,\n          createdAt: true,\n        },\n      });\n\n      if (!user) {\n        console.error(`‚ùå [DashboardService] User not found: ${userId}`);\n        throw new NotFoundException(`User not found: ${userId}`);\n      }\n\n      console.log(`üìã [DashboardService] User found: ${user.email} (${user.firstName} ${user.lastName}), role: ${user.role}, active: ${user.isActive}`);\n\n      if (user.role !== 'therapist') {\n        console.error(`‚ùå [DashboardService] User ${user.email} has role '${user.role}', expected 'therapist'`);\n        throw new NotFoundException(`User ${user.email} does not have therapist role. Current role: ${user.role}`);\n      }\n\n      if (!user.isActive) {\n        console.error(`‚ùå [DashboardService] User ${user.email} is not active`);\n        throw new NotFoundException(`User ${user.email} is not active`);\n      }\n\n      // Now attempt to find the therapist record\n      console.log(`üîç [DashboardService] Looking for Therapist record for userId: ${userId}`);\n      \n      const therapist = await this.prisma.therapist.findUnique({\n        where: { userId },\n        include: {\n          user: true,\n          assignedClients: {\n            include: {\n              client: {\n                include: { user: true },\n              },\n            },\n          },\n          meetings: {\n            where: { status: { in: ['SCHEDULED', 'CONFIRMED'] } },\n            orderBy: { startTime: 'asc' },\n            take: 10,\n            include: {\n              client: {\n                include: { user: true },\n              },\n            },\n          },\n          worksheets: {\n            where: { status: { in: ['ASSIGNED', 'OVERDUE'] } },\n            orderBy: { dueDate: 'asc' },\n            take: 10,\n            include: {\n              client: {\n                include: { user: true },\n              },\n            },\n          },\n        },\n      });\n\n      if (!therapist) {\n        console.error(`‚ùå [DashboardService] Therapist record not found for user: ${user.email} (${userId})`);\n        console.error(`‚ùå [DashboardService] User has role 'therapist' but missing Therapist table record`);\n        \n        // Additional diagnostic information\n        const allTherapistRecords = await this.prisma.therapist.count();\n        console.log(`üìä [DashboardService] Total Therapist records in database: ${allTherapistRecords}`);\n        \n        throw new NotFoundException(\n          `Therapist record not found for user ${user.email} (${userId}). ` +\n          `User has role 'therapist' but is missing corresponding Therapist table record. ` +\n          `This indicates a data consistency issue that needs to be resolved.`\n        );\n      }\n\n      console.log(`‚úÖ [DashboardService] Therapist record found: ${therapist.user.email}, status: ${therapist.status}`);\n\n      // Validate therapist status\n      if (therapist.status !== 'APPROVED') {\n        console.warn(`‚ö†Ô∏è [DashboardService] Therapist ${therapist.user.email} has status: ${therapist.status}`);\n      }\n\n      const completedMeetingsCount = await this.prisma.meeting.count({\n        where: { therapistId: userId, status: 'COMPLETED' },\n      });\n\n      const totalClientsCount = await this.prisma.clientTherapist.count({\n        where: { therapistId: userId },\n      });\n\n      const pendingWorksheetsCount = await this.prisma.worksheet.count({\n        where: { therapistId: userId, status: { in: ['ASSIGNED', 'OVERDUE'] } },\n      });\n\n      // Get recent completed meetings (replacing session logs)\n      const recentSessions = await this.prisma.meeting.findMany({\n        where: {\n          therapistId: userId,\n          status: 'COMPLETED',\n        },\n        orderBy: { startTime: 'desc' },\n        take: 5,\n        include: {\n          client: {\n            include: { user: true },\n          },\n          meetingNotes: {\n            orderBy: { createdAt: 'desc' },\n            take: 1,\n          },\n        },\n      });\n\n      console.log(`üìä [DashboardService] Dashboard stats for ${therapist.user.email}: clients=${totalClientsCount}, completed_meetings=${completedMeetingsCount}, pending_worksheets=${pendingWorksheetsCount}`);\n\n      const dashboardData = {\n        therapist: {\n          ...therapist,\n          // Map database fields to frontend-expected fields\n          specialties: therapist.areasOfExpertise || [],\n        },\n        stats: {\n          totalClients: totalClientsCount,\n          completedMeetings: completedMeetingsCount,\n          upcomingMeetings: therapist.meetings.length,\n          pendingWorksheets: pendingWorksheetsCount,\n        },\n        upcomingMeetings: therapist.meetings,\n        assignedClients: therapist.assignedClients.map((ct) => ct.client),\n        pendingWorksheets: therapist.worksheets,\n        recentSessions,\n      };\n\n      console.log(`‚úÖ [DashboardService] Successfully retrieved dashboard data for ${therapist.user.email}`);\n      return dashboardData;\n\n    } catch (error) {\n      if (error instanceof NotFoundException) {\n        // Re-throw NotFoundException with our enhanced error messages\n        throw error;\n      }\n      \n      console.error(`‚ùå [DashboardService] Unexpected error getting therapist dashboard data for userId ${userId}:`, error);\n      throw new InternalServerErrorException(\n        `Failed to get therapist dashboard data for user ${userId}: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async getAdminDashboardData() {\n    try {\n      const totalUsers = await this.prisma.user.count();\n      const totalClients = await this.prisma.client.count();\n      const totalTherapists = await this.prisma.therapist.count();\n      const pendingTherapists = await this.prisma.therapist.count({\n        where: { status: 'PENDING' },\n      });\n      const totalMeetings = await this.prisma.meeting.count();\n      const completedMeetings = await this.prisma.meeting.count({\n        where: { status: 'COMPLETED' },\n      });\n      const totalCommunities = await this.prisma.community.count();\n      const totalPosts = await this.prisma.post.count();\n\n      // Recent activity\n      const recentUsers = await this.prisma.user.findMany({\n        orderBy: { createdAt: 'desc' },\n        take: 10,\n        include: {\n          client: true,\n          therapist: true,\n        },\n      });\n\n      const recentTherapistApplications = await this.prisma.therapist.findMany({\n        where: { status: 'PENDING' },\n        orderBy: { createdAt: 'desc' },\n        take: 10,\n        include: { user: true },\n      });\n\n      return {\n        stats: {\n          totalUsers,\n          totalClients,\n          totalTherapists,\n          pendingTherapists,\n          totalMeetings,\n          completedMeetings,\n          totalCommunities,\n          totalPosts,\n        },\n        recentUsers,\n        pendingApplications: recentTherapistApplications,\n      };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to get admin dashboard data: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async getModeratorDashboardData(userId: string) {\n    try {\n      // Get moderator record\n      const moderator = await this.prisma.user.findUnique({\n        where: { id: userId },\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n          role: true,\n        },\n      });\n\n      if (!moderator || moderator.role !== 'moderator') {\n        throw new NotFoundException('Moderator not found');\n      }\n\n      // Get pending reports/content for moderation\n      const pendingReports = await this.prisma.post.count({\n        where: {\n          reports: { some: { status: 'PENDING' } },\n        },\n      });\n\n      const pendingContent = await this.prisma.comment.count({\n        where: {\n          reports: { some: { status: 'PENDING' } },\n        },\n      });\n\n      const resolvedToday = await this.prisma.report.count({\n        where: {\n          status: { in: ['REVIEWED', 'DISMISSED'] },\n          updatedAt: {\n            gte: new Date(new Date().setHours(0, 0, 0, 0)),\n          },\n        },\n      });\n\n      const flaggedUsers = await this.prisma.user.count({\n        where: {\n          OR: [\n            { isActive: false },\n            {\n              // Add any user flagging criteria here\n              client: {\n                meetings: {\n                  some: { status: 'CANCELLED' },\n                },\n              },\n            },\n          ],\n        },\n      });\n\n      // Get recent flagged content for review\n      const recentFlaggedPosts = await this.prisma.post.findMany({\n        where: {\n          reports: { some: { status: 'PENDING' } },\n        },\n        orderBy: { updatedAt: 'desc' },\n        take: 10,\n        include: {\n          user: { select: { firstName: true, lastName: true, email: true } },\n          room: {\n            include: {\n              roomGroup: {\n                include: { community: true },\n              },\n            },\n          },\n          _count: { select: { hearts: true, comments: true } },\n        },\n      });\n\n      const recentFlaggedComments = await this.prisma.comment.findMany({\n        where: {\n          reports: { some: { status: 'PENDING' } },\n        },\n        orderBy: { updatedAt: 'desc' },\n        take: 10,\n        include: {\n          user: { select: { firstName: true, lastName: true, email: true } },\n          post: {\n            select: { title: true, id: true },\n          },\n        },\n      });\n\n      // Community stats\n      const totalCommunities = await this.prisma.community.count();\n\n      return {\n        moderator,\n        stats: {\n          pendingReports,\n          pendingContent,\n          resolvedToday,\n          flaggedUsers,\n          systemAlerts: 0, // Placeholder for system alerts\n        },\n        communityStats: {\n          totalCommunities,\n        },\n        flaggedContent: {\n          posts: recentFlaggedPosts,\n          comments: recentFlaggedComments,\n        },\n        recentActivity: {\n          moderationActions: [], // Placeholder for moderation action history\n        },\n      };\n    } catch (error) {\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        `Failed to get moderator dashboard data: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n}\n"],"version":3}