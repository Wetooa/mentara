{"version":3,"names":["cov_1bpfjlv9e0","actualCoverage","common_1","s","require","config_1","axios_1","class_validator_1","AiPredictionInputDto","inputs","__decorate","IsArray","ArrayMinSize","message","ArrayMaxSize","IsNumber","each","Min","Max","AiServiceClient","AiServiceClient_1","configService","logger","Logger","name","axiosInstance","maxRetries","timeoutMs","baseURL","requestCount","maxRequestsPerMinute","lastResetTime","Date","now","constructor","f","b","get","default","create","timeout","headers","interceptors","request","use","config","debug","url","error","Promise","reject","Error","String","response","status","validateInput","flatAnswers","inputDto","errors","validateSync","length","warn","map","e","toString","isRateLimited","sanitizeInput","value","Number","isFinite","Math","max","min","round","predict","startTime","success","sanitizedInput","result","makeRequestWithRetry","responseTime","log","predictions","getErrorMessage","attempt","post","data","isRetryableError","delay","pow","resolve","setTimeout","AxiosError","code","healthCheck","getServiceInfo","exports","Injectable","ConfigService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/services/ai-service.client.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport axios, { AxiosInstance, AxiosError } from 'axios';\nimport {\n  IsArray,\n  IsNumber,\n  validateSync,\n  Min,\n  Max,\n  ArrayMinSize,\n  ArrayMaxSize,\n} from 'class-validator';\n\n// DTO for AI service input validation\nclass AiPredictionInputDto {\n  @IsArray()\n  @ArrayMinSize(201, { message: 'Input array must contain exactly 201 values' })\n  @ArrayMaxSize(201, { message: 'Input array must contain exactly 201 values' })\n  @IsNumber({}, { each: true, message: 'All values must be numbers' })\n  @Min(0, { each: true, message: 'All values must be non-negative' })\n  @Max(10, { each: true, message: 'All values must be 10 or less' })\n  inputs!: number[];\n}\n\nexport interface AiPredictionResult {\n  success: boolean;\n  predictions?: Record<string, boolean>;\n  error?: string;\n  responseTime?: number;\n}\n\n@Injectable()\nexport class AiServiceClient {\n  private readonly logger = new Logger(AiServiceClient.name);\n  private readonly axiosInstance: AxiosInstance;\n  private readonly maxRetries: number = 3;\n  private readonly timeoutMs: number = 30000; // 30 seconds\n  private readonly baseURL: string;\n  private requestCount = 0;\n  private readonly maxRequestsPerMinute = 60; // Rate limiting\n  private lastResetTime = Date.now();\n\n  constructor(private readonly configService: ConfigService) {\n    // Get AI service URL from environment with fallback\n    this.baseURL =\n      this.configService.get<string>('AI_SERVICE_URL') ||\n      'http://localhost:5000';\n\n    this.axiosInstance = axios.create({\n      baseURL: this.baseURL,\n      timeout: this.timeoutMs,\n      headers: {\n        'Content-Type': 'application/json',\n        'User-Agent': 'Mentara-API/1.0',\n      },\n    });\n\n    // Add request interceptor for logging\n    this.axiosInstance.interceptors.request.use(\n      (config) => {\n        this.logger.debug(`Making AI service request to ${config.url}`);\n        return config;\n      },\n      (error) => {\n        this.logger.error('AI service request interceptor error:', error);\n        return Promise.reject(new Error(String(error)));\n      },\n    );\n\n    // Add response interceptor for logging\n    this.axiosInstance.interceptors.response.use(\n      (response) => {\n        this.logger.debug(`AI service response received: ${response.status}`);\n        return response;\n      },\n      (error) => {\n        this.logger.error(\n          'AI service response error:',\n          error?.response?.status || error.message,\n        );\n        return Promise.reject(new Error(String(error)));\n      },\n    );\n  }\n\n  private validateInput(flatAnswers: number[]): boolean {\n    const inputDto = new AiPredictionInputDto();\n    inputDto.inputs = flatAnswers;\n\n    const errors = validateSync(inputDto);\n\n    if (errors.length > 0) {\n      this.logger.warn(\n        'AI service input validation failed:',\n        errors.map((e) => e.toString()),\n      );\n      return false;\n    }\n\n    return true;\n  }\n\n  private isRateLimited(): boolean {\n    const now = Date.now();\n\n    // Reset counter every minute\n    if (now - this.lastResetTime > 60000) {\n      this.requestCount = 0;\n      this.lastResetTime = now;\n    }\n\n    if (this.requestCount >= this.maxRequestsPerMinute) {\n      this.logger.warn('AI service rate limit exceeded');\n      return true;\n    }\n\n    this.requestCount++;\n    return false;\n  }\n\n  private sanitizeInput(flatAnswers: number[]): number[] {\n    // Sanitize input values to prevent injection attacks\n    return flatAnswers.map((value) => {\n      // Ensure value is a finite number\n      if (!Number.isFinite(value)) {\n        this.logger.warn(`Invalid value detected: ${value}, replacing with 0`);\n        return 0;\n      }\n\n      // Clamp values to expected range\n      return Math.max(0, Math.min(10, Math.round(value * 100) / 100)); // Round to 2 decimal places\n    });\n  }\n\n  async predict(flatAnswers: number[]): Promise<AiPredictionResult> {\n    const startTime = Date.now();\n\n    try {\n      // Rate limiting check\n      if (this.isRateLimited()) {\n        return {\n          success: false,\n          error: 'Rate limit exceeded. Please try again later.',\n        };\n      }\n\n      // Input validation\n      if (!this.validateInput(flatAnswers)) {\n        return {\n          success: false,\n          error: 'Invalid input data for AI prediction',\n        };\n      }\n\n      // Sanitize input\n      const sanitizedInput = this.sanitizeInput(flatAnswers);\n\n      // Make the prediction with retry logic\n      const result = await this.makeRequestWithRetry(sanitizedInput);\n\n      const responseTime = Date.now() - startTime;\n      this.logger.log(`AI prediction completed in ${responseTime}ms`);\n\n      return {\n        success: true,\n        predictions: result,\n        responseTime,\n      };\n    } catch (error) {\n      const responseTime = Date.now() - startTime;\n      this.logger.error(`AI prediction failed after ${responseTime}ms:`, error);\n\n      return {\n        success: false,\n        error: this.getErrorMessage(error),\n        responseTime,\n      };\n    }\n  }\n\n  private async makeRequestWithRetry(\n    sanitizedInput: number[],\n    attempt: number = 1,\n  ): Promise<Record<string, boolean>> {\n    try {\n      const response = await this.axiosInstance.post('/predict', {\n        inputs: sanitizedInput,\n      });\n\n      // Validate response structure\n      if (!response.data || typeof response.data !== 'object') {\n        throw new Error('Invalid response format from AI service');\n      }\n\n      return response.data as Record<string, boolean>;\n    } catch (error) {\n      if (attempt < this.maxRetries && this.isRetryableError(error)) {\n        this.logger.warn(\n          `AI service request failed (attempt ${attempt}/${this.maxRetries}), retrying...`,\n        );\n\n        // Exponential backoff\n        const delay = Math.min(1000 * Math.pow(2, attempt - 1), 5000);\n        await new Promise((resolve) => setTimeout(resolve, delay));\n\n        return this.makeRequestWithRetry(sanitizedInput, attempt + 1);\n      }\n\n      throw error;\n    }\n  }\n\n  private isRetryableError(error: unknown): boolean {\n    if (error instanceof AxiosError) {\n      // Retry on network errors, timeouts, and 5xx server errors\n      return (\n        !error.response ||\n        error.response.status >= 500 ||\n        error.code === 'ECONNRESET' ||\n        error.code === 'ETIMEDOUT'\n      );\n    }\n    return false;\n  }\n\n  private getErrorMessage(error: unknown): string {\n    if (error instanceof AxiosError) {\n      if (error.code === 'ECONNREFUSED') {\n        return 'AI service is currently unavailable';\n      }\n      if (error.code === 'ETIMEDOUT') {\n        return 'AI service request timed out';\n      }\n      if (error.response?.status === 400) {\n        return 'Invalid request to AI service';\n      }\n      if (error.response?.status === 429) {\n        return 'AI service rate limit exceeded';\n      }\n      if (error.response?.status && error.response.status >= 500) {\n        return 'AI service internal error';\n      }\n    }\n\n    return 'Unknown error occurred while contacting AI service';\n  }\n\n  async healthCheck(): Promise<boolean> {\n    try {\n      const response = await this.axiosInstance.get('/health', {\n        timeout: 5000,\n      });\n      return response.status === 200;\n    } catch (error) {\n      this.logger.warn('AI service health check failed:', error);\n      return false;\n    }\n  }\n\n  getServiceInfo(): { baseURL: string; timeout: number; maxRetries: number } {\n    return {\n      baseURL: this.baseURL,\n      timeout: this.timeoutMs,\n      maxRetries: this.maxRetries,\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IACA;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AADA,MAAAE,QAAA;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAC,QAAA;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAE,OAAA;AAAA;AAAA,CAAAN,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAG,iBAAA;AAAA;AAAA,CAAAP,cAAA,GAAAG,CAAA,QAAAC,OAAA;AAUA;AACA,MAAMI,oBAAoB;EAOxBC,MAAM;;AACP;AAAAT,cAAA,GAAAG,CAAA;AADCO,UAAA,EANC,IAAAH,iBAAA,CAAAI,OAAO,GAAE,EACT,IAAAJ,iBAAA,CAAAK,YAAY,EAAC,GAAG,EAAE;EAAEC,OAAO,EAAE;AAA6C,CAAE,CAAC,EAC7E,IAAAN,iBAAA,CAAAO,YAAY,EAAC,GAAG,EAAE;EAAED,OAAO,EAAE;AAA6C,CAAE,CAAC,EAC7E,IAAAN,iBAAA,CAAAQ,QAAQ,EAAC,EAAE,EAAE;EAAEC,IAAI,EAAE,IAAI;EAAEH,OAAO,EAAE;AAA4B,CAAE,CAAC,EACnE,IAAAN,iBAAA,CAAAU,GAAG,EAAC,CAAC,EAAE;EAAED,IAAI,EAAE,IAAI;EAAEH,OAAO,EAAE;AAAiC,CAAE,CAAC,EAClE,IAAAN,iBAAA,CAAAW,GAAG,EAAC,EAAE,EAAE;EAAEF,IAAI,EAAE,IAAI;EAAEH,OAAO,EAAE;AAA+B,CAAE,CAAC,E,oFAChD;AAWb,IAAMM,eAAe;AAAA;AAAA,CAAAnB,cAAA,GAAAG,CAAA,QAAAiB,iBAAA,GAArB,MAAMD,eAAe;EAUGE,aAAA;EATZC,MAAM;EAAA;EAAA,CAAAtB,cAAA,GAAAG,CAAA,QAAG,IAAID,QAAA,CAAAqB,MAAM,CAACH,iBAAe,CAACI,IAAI,CAAC;EACzCC,aAAa;EACbC,UAAU;EAAA;EAAA,CAAA1B,cAAA,GAAAG,CAAA,QAAW,CAAC;EACtBwB,SAAS;EAAA;EAAA,CAAA3B,cAAA,GAAAG,CAAA,QAAW,KAAK,EAAC,CAAC;EAC3ByB,OAAO;EAChBC,YAAY;EAAA;EAAA,CAAA7B,cAAA,GAAAG,CAAA,QAAG,CAAC;EACP2B,oBAAoB;EAAA;EAAA,CAAA9B,cAAA,GAAAG,CAAA,QAAG,EAAE,EAAC,CAAC;EACpC4B,aAAa;EAAA;EAAA,CAAA/B,cAAA,GAAAG,CAAA,QAAG6B,IAAI,CAACC,GAAG,EAAE;EAElCC,YAA6Bb,aAA4B;IAAA;IAAArB,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IAA5B,KAAAkB,aAAa,GAAbA,aAAa;IACxC;IAAA;IAAArB,cAAA,GAAAG,CAAA;IACA,IAAI,CAACyB,OAAO;IACV;IAAA,CAAA5B,cAAA,GAAAoC,CAAA,eAAI,CAACf,aAAa,CAACgB,GAAG,CAAS,gBAAgB,CAAC;IAAA;IAAA,CAAArC,cAAA,GAAAoC,CAAA,WAChD,uBAAuB;IAAC;IAAApC,cAAA,GAAAG,CAAA;IAE1B,IAAI,CAACsB,aAAa,GAAGnB,OAAA,CAAAgC,OAAK,CAACC,MAAM,CAAC;MAChCX,OAAO,EAAE,IAAI,CAACA,OAAO;MACrBY,OAAO,EAAE,IAAI,CAACb,SAAS;MACvBc,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,YAAY,EAAE;;KAEjB,CAAC;IAEF;IAAA;IAAAzC,cAAA,GAAAG,CAAA;IACA,IAAI,CAACsB,aAAa,CAACiB,YAAY,CAACC,OAAO,CAACC,GAAG,CACxCC,MAAM,IAAI;MAAA;MAAA7C,cAAA,GAAAmC,CAAA;MAAAnC,cAAA,GAAAG,CAAA;MACT,IAAI,CAACmB,MAAM,CAACwB,KAAK,CAAC,gCAAgCD,MAAM,CAACE,GAAG,EAAE,CAAC;MAAC;MAAA/C,cAAA,GAAAG,CAAA;MAChE,OAAO0C,MAAM;IACf,CAAC,EACAG,KAAK,IAAI;MAAA;MAAAhD,cAAA,GAAAmC,CAAA;MAAAnC,cAAA,GAAAG,CAAA;MACR,IAAI,CAACmB,MAAM,CAAC0B,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;MAAC;MAAAhD,cAAA,GAAAG,CAAA;MAClE,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIC,KAAK,CAACC,MAAM,CAACJ,KAAK,CAAC,CAAC,CAAC;IACjD,CAAC,CACF;IAED;IAAA;IAAAhD,cAAA,GAAAG,CAAA;IACA,IAAI,CAACsB,aAAa,CAACiB,YAAY,CAACW,QAAQ,CAACT,GAAG,CACzCS,QAAQ,IAAI;MAAA;MAAArD,cAAA,GAAAmC,CAAA;MAAAnC,cAAA,GAAAG,CAAA;MACX,IAAI,CAACmB,MAAM,CAACwB,KAAK,CAAC,iCAAiCO,QAAQ,CAACC,MAAM,EAAE,CAAC;MAAC;MAAAtD,cAAA,GAAAG,CAAA;MACtE,OAAOkD,QAAQ;IACjB,CAAC,EACAL,KAAK,IAAI;MAAA;MAAAhD,cAAA,GAAAmC,CAAA;MAAAnC,cAAA,GAAAG,CAAA;MACR,IAAI,CAACmB,MAAM,CAAC0B,KAAK,CACf,4BAA4B;MAC5B;MAAA,CAAAhD,cAAA,GAAAoC,CAAA,WAAAY,KAAK,EAAEK,QAAQ,EAAEC,MAAM;MAAA;MAAA,CAAAtD,cAAA,GAAAoC,CAAA,WAAIY,KAAK,CAACnC,OAAO,EACzC;MAAC;MAAAb,cAAA,GAAAG,CAAA;MACF,OAAO8C,OAAO,CAACC,MAAM,CAAC,IAAIC,KAAK,CAACC,MAAM,CAACJ,KAAK,CAAC,CAAC,CAAC;IACjD,CAAC,CACF;EACH;EAEQO,aAAaA,CAACC,WAAqB;IAAA;IAAAxD,cAAA,GAAAmC,CAAA;IACzC,MAAMsB,QAAQ;IAAA;IAAA,CAAAzD,cAAA,GAAAG,CAAA,QAAG,IAAIK,oBAAoB,EAAE;IAAC;IAAAR,cAAA,GAAAG,CAAA;IAC5CsD,QAAQ,CAAChD,MAAM,GAAG+C,WAAW;IAE7B,MAAME,MAAM;IAAA;IAAA,CAAA1D,cAAA,GAAAG,CAAA,QAAG,IAAAI,iBAAA,CAAAoD,YAAY,EAACF,QAAQ,CAAC;IAAC;IAAAzD,cAAA,GAAAG,CAAA;IAEtC,IAAIuD,MAAM,CAACE,MAAM,GAAG,CAAC,EAAE;MAAA;MAAA5D,cAAA,GAAAoC,CAAA;MAAApC,cAAA,GAAAG,CAAA;MACrB,IAAI,CAACmB,MAAM,CAACuC,IAAI,CACd,qCAAqC,EACrCH,MAAM,CAACI,GAAG,CAAEC,CAAC,IAAK;QAAA;QAAA/D,cAAA,GAAAmC,CAAA;QAAAnC,cAAA,GAAAG,CAAA;QAAA,OAAA4D,CAAC,CAACC,QAAQ,EAAE;MAAF,CAAE,CAAC,CAChC;MAAC;MAAAhE,cAAA,GAAAG,CAAA;MACF,OAAO,KAAK;IACd,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAoC,CAAA;IAAA;IAAApC,cAAA,GAAAG,CAAA;IAED,OAAO,IAAI;EACb;EAEQ8D,aAAaA,CAAA;IAAA;IAAAjE,cAAA,GAAAmC,CAAA;IACnB,MAAMF,GAAG;IAAA;IAAA,CAAAjC,cAAA,GAAAG,CAAA,QAAG6B,IAAI,CAACC,GAAG,EAAE;IAEtB;IAAA;IAAAjC,cAAA,GAAAG,CAAA;IACA,IAAI8B,GAAG,GAAG,IAAI,CAACF,aAAa,GAAG,KAAK,EAAE;MAAA;MAAA/B,cAAA,GAAAoC,CAAA;MAAApC,cAAA,GAAAG,CAAA;MACpC,IAAI,CAAC0B,YAAY,GAAG,CAAC;MAAC;MAAA7B,cAAA,GAAAG,CAAA;MACtB,IAAI,CAAC4B,aAAa,GAAGE,GAAG;IAC1B,CAAC;IAAA;IAAA;MAAAjC,cAAA,GAAAoC,CAAA;IAAA;IAAApC,cAAA,GAAAG,CAAA;IAED,IAAI,IAAI,CAAC0B,YAAY,IAAI,IAAI,CAACC,oBAAoB,EAAE;MAAA;MAAA9B,cAAA,GAAAoC,CAAA;MAAApC,cAAA,GAAAG,CAAA;MAClD,IAAI,CAACmB,MAAM,CAACuC,IAAI,CAAC,gCAAgC,CAAC;MAAC;MAAA7D,cAAA,GAAAG,CAAA;MACnD,OAAO,IAAI;IACb,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAoC,CAAA;IAAA;IAAApC,cAAA,GAAAG,CAAA;IAED,IAAI,CAAC0B,YAAY,EAAE;IAAC;IAAA7B,cAAA,GAAAG,CAAA;IACpB,OAAO,KAAK;EACd;EAEQ+D,aAAaA,CAACV,WAAqB;IAAA;IAAAxD,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IACzC;IACA,OAAOqD,WAAW,CAACM,GAAG,CAAEK,KAAK,IAAI;MAAA;MAAAnE,cAAA,GAAAmC,CAAA;MAAAnC,cAAA,GAAAG,CAAA;MAC/B;MACA,IAAI,CAACiE,MAAM,CAACC,QAAQ,CAACF,KAAK,CAAC,EAAE;QAAA;QAAAnE,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QAC3B,IAAI,CAACmB,MAAM,CAACuC,IAAI,CAAC,2BAA2BM,KAAK,oBAAoB,CAAC;QAAC;QAAAnE,cAAA,GAAAG,CAAA;QACvE,OAAO,CAAC;MACV,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAoC,CAAA;MAAA;MAED;MAAApC,cAAA,GAAAG,CAAA;MACA,OAAOmE,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,EAAE,EAAEF,IAAI,CAACG,KAAK,CAACN,KAAK,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;IACnE,CAAC,CAAC;EACJ;EAEA,MAAMO,OAAOA,CAAClB,WAAqB;IAAA;IAAAxD,cAAA,GAAAmC,CAAA;IACjC,MAAMwC,SAAS;IAAA;IAAA,CAAA3E,cAAA,GAAAG,CAAA,QAAG6B,IAAI,CAACC,GAAG,EAAE;IAAC;IAAAjC,cAAA,GAAAG,CAAA;IAE7B,IAAI;MAAA;MAAAH,cAAA,GAAAG,CAAA;MACF;MACA,IAAI,IAAI,CAAC8D,aAAa,EAAE,EAAE;QAAA;QAAAjE,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QACxB,OAAO;UACLyE,OAAO,EAAE,KAAK;UACd5B,KAAK,EAAE;SACR;MACH,CAAC;MAAA;MAAA;QAAAhD,cAAA,GAAAoC,CAAA;MAAA;MAED;MAAApC,cAAA,GAAAG,CAAA;MACA,IAAI,CAAC,IAAI,CAACoD,aAAa,CAACC,WAAW,CAAC,EAAE;QAAA;QAAAxD,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QACpC,OAAO;UACLyE,OAAO,EAAE,KAAK;UACd5B,KAAK,EAAE;SACR;MACH,CAAC;MAAA;MAAA;QAAAhD,cAAA,GAAAoC,CAAA;MAAA;MAED;MACA,MAAMyC,cAAc;MAAA;MAAA,CAAA7E,cAAA,GAAAG,CAAA,QAAG,IAAI,CAAC+D,aAAa,CAACV,WAAW,CAAC;MAEtD;MACA,MAAMsB,MAAM;MAAA;MAAA,CAAA9E,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAAC4E,oBAAoB,CAACF,cAAc,CAAC;MAE9D,MAAMG,YAAY;MAAA;MAAA,CAAAhF,cAAA,GAAAG,CAAA,QAAG6B,IAAI,CAACC,GAAG,EAAE,GAAG0C,SAAS;MAAC;MAAA3E,cAAA,GAAAG,CAAA;MAC5C,IAAI,CAACmB,MAAM,CAAC2D,GAAG,CAAC,8BAA8BD,YAAY,IAAI,CAAC;MAAC;MAAAhF,cAAA,GAAAG,CAAA;MAEhE,OAAO;QACLyE,OAAO,EAAE,IAAI;QACbM,WAAW,EAAEJ,MAAM;QACnBE;OACD;IACH,CAAC,CAAC,OAAOhC,KAAK,EAAE;MACd,MAAMgC,YAAY;MAAA;MAAA,CAAAhF,cAAA,GAAAG,CAAA,QAAG6B,IAAI,CAACC,GAAG,EAAE,GAAG0C,SAAS;MAAC;MAAA3E,cAAA,GAAAG,CAAA;MAC5C,IAAI,CAACmB,MAAM,CAAC0B,KAAK,CAAC,8BAA8BgC,YAAY,KAAK,EAAEhC,KAAK,CAAC;MAAC;MAAAhD,cAAA,GAAAG,CAAA;MAE1E,OAAO;QACLyE,OAAO,EAAE,KAAK;QACd5B,KAAK,EAAE,IAAI,CAACmC,eAAe,CAACnC,KAAK,CAAC;QAClCgC;OACD;IACH;EACF;EAEQ,MAAMD,oBAAoBA,CAChCF,cAAwB,EACxBO,OAAA;EAAA;EAAA,CAAApF,cAAA,GAAAoC,CAAA,WAAkB,CAAC;IAAA;IAAApC,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IAEnB,IAAI;MACF,MAAMkD,QAAQ;MAAA;MAAA,CAAArD,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACsB,aAAa,CAAC4D,IAAI,CAAC,UAAU,EAAE;QACzD5E,MAAM,EAAEoE;OACT,CAAC;MAEF;MAAA;MAAA7E,cAAA,GAAAG,CAAA;MACA;MAAI;MAAA,CAAAH,cAAA,GAAAoC,CAAA,YAACiB,QAAQ,CAACiC,IAAI;MAAA;MAAA,CAAAtF,cAAA,GAAAoC,CAAA,WAAI,OAAOiB,QAAQ,CAACiC,IAAI,KAAK,QAAQ,GAAE;QAAA;QAAAtF,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QACvD,MAAM,IAAIgD,KAAK,CAAC,yCAAyC,CAAC;MAC5D,CAAC;MAAA;MAAA;QAAAnD,cAAA,GAAAoC,CAAA;MAAA;MAAApC,cAAA,GAAAG,CAAA;MAED,OAAOkD,QAAQ,CAACiC,IAA+B;IACjD,CAAC,CAAC,OAAOtC,KAAK,EAAE;MAAA;MAAAhD,cAAA,GAAAG,CAAA;MACd;MAAI;MAAA,CAAAH,cAAA,GAAAoC,CAAA,WAAAgD,OAAO,GAAG,IAAI,CAAC1D,UAAU;MAAA;MAAA,CAAA1B,cAAA,GAAAoC,CAAA,WAAI,IAAI,CAACmD,gBAAgB,CAACvC,KAAK,CAAC,GAAE;QAAA;QAAAhD,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QAC7D,IAAI,CAACmB,MAAM,CAACuC,IAAI,CACd,sCAAsCuB,OAAO,IAAI,IAAI,CAAC1D,UAAU,gBAAgB,CACjF;QAED;QACA,MAAM8D,KAAK;QAAA;QAAA,CAAAxF,cAAA,GAAAG,CAAA,QAAGmE,IAAI,CAACE,GAAG,CAAC,IAAI,GAAGF,IAAI,CAACmB,GAAG,CAAC,CAAC,EAAEL,OAAO,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC;QAAC;QAAApF,cAAA,GAAAG,CAAA;QAC9D,MAAM,IAAI8C,OAAO,CAAEyC,OAAO,IAAK;UAAA;UAAA1F,cAAA,GAAAmC,CAAA;UAAAnC,cAAA,GAAAG,CAAA;UAAA,OAAAwF,UAAU,CAACD,OAAO,EAAEF,KAAK,CAAC;QAAD,CAAC,CAAC;QAAC;QAAAxF,cAAA,GAAAG,CAAA;QAE3D,OAAO,IAAI,CAAC4E,oBAAoB,CAACF,cAAc,EAAEO,OAAO,GAAG,CAAC,CAAC;MAC/D,CAAC;MAAA;MAAA;QAAApF,cAAA,GAAAoC,CAAA;MAAA;MAAApC,cAAA,GAAAG,CAAA;MAED,MAAM6C,KAAK;IACb;EACF;EAEQuC,gBAAgBA,CAACvC,KAAc;IAAA;IAAAhD,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IACrC,IAAI6C,KAAK,YAAY1C,OAAA,CAAAsF,UAAU,EAAE;MAAA;MAAA5F,cAAA,GAAAoC,CAAA;MAAApC,cAAA,GAAAG,CAAA;MAC/B;MACA,OACE,2BAAAH,cAAA,GAAAoC,CAAA,YAACY,KAAK,CAACK,QAAQ;MAAA;MAAA,CAAArD,cAAA,GAAAoC,CAAA,WACfY,KAAK,CAACK,QAAQ,CAACC,MAAM,IAAI,GAAG;MAAA;MAAA,CAAAtD,cAAA,GAAAoC,CAAA,WAC5BY,KAAK,CAAC6C,IAAI,KAAK,YAAY;MAAA;MAAA,CAAA7F,cAAA,GAAAoC,CAAA,WAC3BY,KAAK,CAAC6C,IAAI,KAAK,WAAW;IAE9B,CAAC;IAAA;IAAA;MAAA7F,cAAA,GAAAoC,CAAA;IAAA;IAAApC,cAAA,GAAAG,CAAA;IACD,OAAO,KAAK;EACd;EAEQgF,eAAeA,CAACnC,KAAc;IAAA;IAAAhD,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IACpC,IAAI6C,KAAK,YAAY1C,OAAA,CAAAsF,UAAU,EAAE;MAAA;MAAA5F,cAAA,GAAAoC,CAAA;MAAApC,cAAA,GAAAG,CAAA;MAC/B,IAAI6C,KAAK,CAAC6C,IAAI,KAAK,cAAc,EAAE;QAAA;QAAA7F,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QACjC,OAAO,qCAAqC;MAC9C,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAoC,CAAA;MAAA;MAAApC,cAAA,GAAAG,CAAA;MACD,IAAI6C,KAAK,CAAC6C,IAAI,KAAK,WAAW,EAAE;QAAA;QAAA7F,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QAC9B,OAAO,8BAA8B;MACvC,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAoC,CAAA;MAAA;MAAApC,cAAA,GAAAG,CAAA;MACD,IAAI6C,KAAK,CAACK,QAAQ,EAAEC,MAAM,KAAK,GAAG,EAAE;QAAA;QAAAtD,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QAClC,OAAO,+BAA+B;MACxC,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAoC,CAAA;MAAA;MAAApC,cAAA,GAAAG,CAAA;MACD,IAAI6C,KAAK,CAACK,QAAQ,EAAEC,MAAM,KAAK,GAAG,EAAE;QAAA;QAAAtD,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QAClC,OAAO,gCAAgC;MACzC,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAoC,CAAA;MAAA;MAAApC,cAAA,GAAAG,CAAA;MACD;MAAI;MAAA,CAAAH,cAAA,GAAAoC,CAAA,WAAAY,KAAK,CAACK,QAAQ,EAAEC,MAAM;MAAA;MAAA,CAAAtD,cAAA,GAAAoC,CAAA,WAAIY,KAAK,CAACK,QAAQ,CAACC,MAAM,IAAI,GAAG,GAAE;QAAA;QAAAtD,cAAA,GAAAoC,CAAA;QAAApC,cAAA,GAAAG,CAAA;QAC1D,OAAO,2BAA2B;MACpC,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAoC,CAAA;MAAA;IACH,CAAC;IAAA;IAAA;MAAApC,cAAA,GAAAoC,CAAA;IAAA;IAAApC,cAAA,GAAAG,CAAA;IAED,OAAO,oDAAoD;EAC7D;EAEA,MAAM2F,WAAWA,CAAA;IAAA;IAAA9F,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IACf,IAAI;MACF,MAAMkD,QAAQ;MAAA;MAAA,CAAArD,cAAA,GAAAG,CAAA,SAAG,MAAM,IAAI,CAACsB,aAAa,CAACY,GAAG,CAAC,SAAS,EAAE;QACvDG,OAAO,EAAE;OACV,CAAC;MAAC;MAAAxC,cAAA,GAAAG,CAAA;MACH,OAAOkD,QAAQ,CAACC,MAAM,KAAK,GAAG;IAChC,CAAC,CAAC,OAAON,KAAK,EAAE;MAAA;MAAAhD,cAAA,GAAAG,CAAA;MACd,IAAI,CAACmB,MAAM,CAACuC,IAAI,CAAC,iCAAiC,EAAEb,KAAK,CAAC;MAAC;MAAAhD,cAAA,GAAAG,CAAA;MAC3D,OAAO,KAAK;IACd;EACF;EAEA4F,cAAcA,CAAA;IAAA;IAAA/F,cAAA,GAAAmC,CAAA;IAAAnC,cAAA,GAAAG,CAAA;IACZ,OAAO;MACLyB,OAAO,EAAE,IAAI,CAACA,OAAO;MACrBY,OAAO,EAAE,IAAI,CAACb,SAAS;MACvBD,UAAU,EAAE,IAAI,CAACA;KAClB;EACH;CACD;AAAA;AAAA1B,cAAA,GAAAG,CAAA;AA1OY6F,OAAA,CAAA7E,eAAA,GAAAA,eAAA;AAAe;AAAAnB,cAAA,GAAAG,CAAA;0BAAfgB,eAAe,GAAAC,iBAAA,GAAAV,UAAA,EAD3B,IAAAR,QAAA,CAAA+F,UAAU,GAAE,E;;qCAWiC5F,QAAA,CAAA6F,aAAa;AAAA;AAAA,CAAAlG,cAAA,GAAAoC,CAAA,WAAb/B,QAAA,CAAA6F,aAAa;AAAA;AAAA,CAAAlG,cAAA,GAAAoC,CAAA,WAAA+D,EAAA;AAAA;AAAA,CAAAnG,cAAA,GAAAoC,CAAA,WAAAgE,MAAA,I,EAV9CjF,eAAe,CA0O3B","ignoreList":[]}