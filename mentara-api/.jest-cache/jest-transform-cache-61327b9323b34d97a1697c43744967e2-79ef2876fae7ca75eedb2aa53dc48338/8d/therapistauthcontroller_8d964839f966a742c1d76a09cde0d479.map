{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/therapist-auth.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/therapist-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  Post,\n  Put,\n  Param,\n  Query,\n  UseInterceptors,\n  UploadedFiles,\n  BadRequestException,\n  NotFoundException,\n  ForbiddenException,\n  InternalServerErrorException,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Req,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { Throttle } from '@nestjs/throttler';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBody,\n  ApiBearerAuth,\n  ApiUnauthorizedResponse,\n  ApiForbiddenResponse,\n  ApiTooManyRequestsResponse,\n  ApiBadRequestResponse,\n  ApiNotFoundResponse,\n  ApiInternalServerErrorResponse,\n  ApiConsumes,\n  ApiParam,\n  ApiQuery,\n} from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../decorators/current-user-role.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\nimport { ValidatedBody } from '../../common/decorators/validate-body.decorator';\nimport {\n  RegisterTherapistDtoSchema,\n  LoginDtoSchema,\n  TherapistApplicationCreateDtoSchema,\n  type RegisterTherapistDto,\n  type LoginDto,\n  type TherapistApplicationCreateDto,\n} from 'mentara-commons';\nimport { TherapistAuthService } from '../services/therapist-auth.service';\nimport { SupabaseStorageService } from '../../common/services/supabase-storage.service';\nimport { Request } from 'express';\n\nimport {\n  TherapistApplicationResponse,\n  ApplicationStatusUpdateDto,\n} from '../../therapist/interfaces/therapist-application.interfaces';\n\n@ApiTags('therapist-auth')\n@ApiBearerAuth('JWT-auth')\n@Controller('auth/therapist')\nexport class TherapistAuthController {\n  constructor(\n    private readonly therapistAuthService: TherapistAuthService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  @Public()\n  @ApiOperation({\n    summary: 'Register new therapist account',\n    description:\n      'Create a new therapist account. Initial registration before application approval.',\n  })\n  @ApiBody({\n    type: 'object',\n    description: 'Therapist registration data',\n    schema: {\n      type: 'object',\n      required: ['email', 'password', 'firstName', 'lastName'],\n      properties: {\n        email: {\n          type: 'string',\n          format: 'email',\n          example: 'therapist@example.com',\n        },\n        password: { type: 'string', minLength: 8, example: 'SecurePass123!' },\n        firstName: { type: 'string', example: 'Dr. Sarah' },\n        lastName: { type: 'string', example: 'Johnson' },\n      },\n    },\n  })\n  @ApiResponse({\n    status: 201,\n    description: 'Therapist account created successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        user: {\n          type: 'object',\n          properties: {\n            id: { type: 'string' },\n            email: { type: 'string' },\n            firstName: { type: 'string' },\n            lastName: { type: 'string' },\n            role: { type: 'string' },\n            emailVerified: { type: 'boolean' },\n          },\n        },\n        accessToken: { type: 'string' },\n        refreshToken: { type: 'string' },\n        expiresIn: { type: 'number' },\n        message: { type: 'string' },\n      },\n    },\n  })\n  @ApiBadRequestResponse({\n    description: 'Invalid registration data or email already exists',\n  })\n  @ApiTooManyRequestsResponse({ description: 'Too many registration attempts' })\n  @Throttle({ default: { limit: 3, ttl: 600000 } }) // 3 therapist registrations per 10 minutes\n  @Post('register')\n  @HttpCode(HttpStatus.CREATED)\n  async register(\n    @Body(new ZodValidationPipe(RegisterTherapistDtoSchema))\n    registerDto: RegisterTherapistDto,\n  ) {\n    const result = await this.therapistAuthService.registerTherapist(\n      registerDto.email,\n      registerDto.password,\n      registerDto.firstName,\n      registerDto.lastName,\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName,\n        lastName: result.user.lastName,\n        role: result.user.role,\n        emailVerified: result.user.emailVerified,\n      },\n      accessToken: result.tokens.accessToken,\n      refreshToken: result.tokens.refreshToken,\n      expiresIn: result.tokens.expiresIn,\n      message: result.message,\n    };\n  }\n\n  @Public()\n  @ApiOperation({\n    summary: 'Therapist login',\n    description: 'Authenticate therapist user and return access tokens',\n  })\n  @ApiBody({\n    type: 'object',\n    description: 'Therapist login credentials',\n    schema: {\n      type: 'object',\n      required: ['email', 'password'],\n      properties: {\n        email: {\n          type: 'string',\n          format: 'email',\n          example: 'therapist@example.com',\n        },\n        password: { type: 'string', example: 'SecurePass123!' },\n      },\n    },\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Login successful',\n    schema: {\n      type: 'object',\n      properties: {\n        user: {\n          type: 'object',\n          properties: {\n            id: { type: 'string' },\n            email: { type: 'string' },\n            firstName: { type: 'string' },\n            lastName: { type: 'string' },\n            role: { type: 'string' },\n            emailVerified: { type: 'boolean' },\n          },\n        },\n        accessToken: { type: 'string' },\n        refreshToken: { type: 'string' },\n        expiresIn: { type: 'number' },\n      },\n    },\n  })\n  @ApiUnauthorizedResponse({ description: 'Invalid credentials' })\n  @ApiTooManyRequestsResponse({ description: 'Too many login attempts' })\n  @Throttle({ default: { limit: 10, ttl: 300000 } }) // 10 login attempts per 5 minutes\n  @Post('login')\n  @HttpCode(HttpStatus.OK)\n  async login(\n    @Body(new ZodValidationPipe(LoginDtoSchema)) loginDto: LoginDto,\n    @Req() req: Request,\n  ) {\n    const ipAddress = req.ip;\n    const userAgent = req.get('User-Agent');\n\n    const result = await this.therapistAuthService.loginTherapist(\n      loginDto.email,\n      loginDto.password,\n      ipAddress,\n      userAgent,\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName,\n        lastName: result.user.lastName,\n        role: result.user.role,\n        emailVerified: result.user.emailVerified,\n      },\n      accessToken: result.tokens.accessToken,\n      refreshToken: result.tokens.refreshToken,\n      expiresIn: result.tokens.expiresIn,\n    };\n  }\n\n  @Public()\n  @ApiOperation({\n    summary: 'Submit therapist application with documents',\n    description:\n      'Submit a complete therapist application including required documents and certifications. Supports multiple file uploads.',\n  })\n  @ApiConsumes('multipart/form-data')\n  @ApiBody({\n    description: 'Therapist application with supporting documents',\n    schema: {\n      type: 'object',\n      properties: {\n        applicationDataJson: {\n          type: 'string',\n          description: 'JSON string containing application data',\n          example: JSON.stringify({\n            email: 'therapist@example.com',\n            firstName: 'Dr. Sarah',\n            lastName: 'Johnson',\n            licenseNumber: 'LIC123456',\n            specializations: ['anxiety', 'depression'],\n            education: 'PhD in Psychology',\n            experience: '5 years',\n          }),\n        },\n        fileTypes: {\n          type: 'string',\n          description: 'JSON string mapping file indices to types',\n          example: JSON.stringify({ '0': 'license', '1': 'diploma' }),\n        },\n        files: {\n          type: 'array',\n          items: {\n            type: 'string',\n            format: 'binary',\n          },\n          description: 'Supporting documents (PDF, DOC, DOCX, JPG, PNG)',\n        },\n      },\n    },\n  })\n  @ApiResponse({\n    status: 201,\n    description: 'Application submitted successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        message: { type: 'string' },\n        applicationId: { type: 'string' },\n        uploadedFiles: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              fileName: { type: 'string' },\n              url: { type: 'string' },\n            },\n          },\n        },\n      },\n    },\n  })\n  @ApiBadRequestResponse({\n    description: 'Invalid application data or file format',\n  })\n  @ApiInternalServerErrorResponse({\n    description: 'Failed to process application',\n  })\n  @Post('apply-with-documents')\n  @UseInterceptors(\n    FilesInterceptor('files', 10, {\n      limits: { fileSize: 10 * 1024 * 1024 }, // 10MB limit per file\n      fileFilter: (req, file, callback) => {\n        const allowedMimeTypes = [\n          'application/pdf',\n          'image/jpeg',\n          'image/png',\n          'image/jpg',\n          'application/msword',\n          'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        ];\n\n        if (allowedMimeTypes.includes(file.mimetype)) {\n          callback(null, true);\n        } else {\n          callback(new BadRequestException('Invalid file type'), false);\n        }\n      },\n    }),\n  )\n  async applyWithDocuments(\n    @Body('applicationDataJson') applicationDataJson: string,\n    @Body('fileTypes') fileTypes: string,\n    @UploadedFiles() files: Express.Multer.File[],\n  ): Promise<{\n    success: boolean;\n    message: string;\n    applicationId: string;\n    uploadedFiles: Array<{ id: string; fileName: string; url: string }>;\n  }> {\n    try {\n      // Parse application data from form\n      let applicationData: TherapistApplicationCreateDto;\n      try {\n        if (!applicationDataJson) {\n          throw new BadRequestException(\n            'Application data is missing. Please ensure the form is submitted correctly.',\n          );\n        }\n\n        if (typeof applicationDataJson !== 'string') {\n          console.error(\n            'Expected string but received:',\n            typeof applicationDataJson,\n            applicationDataJson,\n          );\n          throw new BadRequestException(\n            'Application data must be a JSON string.',\n          );\n        }\n\n        applicationData = JSON.parse(applicationDataJson);\n      } catch (error) {\n        console.error('JSON parsing error:', error);\n        console.error('Raw applicationDataJson:', applicationDataJson);\n        throw new BadRequestException(\n          'Invalid application data format. Please check that all form fields are filled correctly.',\n        );\n      }\n\n      // For public applications, create a temporary user ID\n      const tempUserId = `temp_${Date.now()}_${applicationData.email.replace('@', '_at_')}`;\n      const applicationWithUserId = { ...applicationData, userId: tempUserId };\n\n      // Parse file type mappings\n      let fileTypeMap: Record<string, string> = {};\n      if (fileTypes) {\n        try {\n          fileTypeMap = JSON.parse(fileTypes);\n        } catch {\n          console.warn('Invalid fileTypes JSON, proceeding without mapping');\n        }\n      }\n\n      // Use consolidated service method to create application and upload documents in one transaction\n      const result =\n        await this.therapistAuthService.createApplicationWithDocuments(\n          applicationWithUserId,\n          files || [],\n          fileTypeMap,\n        );\n\n      return {\n        success: true,\n        message: 'Application submitted successfully with documents',\n        applicationId: result.application.userId,\n        uploadedFiles: result.uploadedFiles,\n      };\n    } catch (error) {\n      console.error('Error submitting application with documents:', error);\n\n      if (error instanceof BadRequestException) {\n        throw error;\n      }\n\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n\n      // Enhanced error handling with specific error types\n      const errorMessage =\n        error instanceof Error ? error.message : String(error);\n\n      if (errorMessage.includes('email already exists')) {\n        throw new BadRequestException(\n          'An application with this email address already exists. Please check your email or contact support.',\n        );\n      }\n\n      if (errorMessage.includes('file upload')) {\n        throw new BadRequestException(\n          'One or more files failed to upload. Please check file formats and sizes.',\n        );\n      }\n\n      if (errorMessage.includes('validation')) {\n        throw new BadRequestException(\n          'Application data validation failed. Please check all required fields.',\n        );\n      }\n\n      throw new InternalServerErrorException(\n        'Failed to submit application with documents. Please try again or contact support.',\n      );\n    }\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @ApiOperation({\n    summary: 'Get therapist profile',\n    description:\n      'Retrieve the authenticated therapist user profile information',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Therapist profile retrieved successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        id: { type: 'string' },\n        email: { type: 'string' },\n        firstName: { type: 'string' },\n        lastName: { type: 'string' },\n        role: { type: 'string' },\n        licenseNumber: { type: 'string' },\n        specializations: { type: 'array', items: { type: 'string' } },\n        approvalStatus: { type: 'string' },\n        profileComplete: { type: 'boolean' },\n        createdAt: { type: 'string', format: 'date-time' },\n      },\n    },\n  })\n  @ApiUnauthorizedResponse({\n    description: 'Invalid or missing authentication token',\n  })\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string) {\n    return this.therapistAuthService.getTherapistProfile(userId);\n  }\n\n  // Admin-only endpoints for managing therapist applications\n  @Get('applications')\n  @ApiOperation({\n    summary: 'Get all therapist applications (Admin only)',\n    description:\n      'Retrieve all therapist applications with optional filtering and pagination. Admin access required.',\n  })\n  @ApiQuery({\n    name: 'status',\n    required: false,\n    description: 'Filter by application status',\n  })\n  @ApiQuery({\n    name: 'page',\n    required: false,\n    description: 'Page number for pagination',\n  })\n  @ApiQuery({\n    name: 'limit',\n    required: false,\n    description: 'Number of items per page',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Applications retrieved successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        applications: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              email: { type: 'string' },\n              firstName: { type: 'string' },\n              lastName: { type: 'string' },\n              status: { type: 'string' },\n              submittedAt: { type: 'string', format: 'date-time' },\n            },\n          },\n        },\n        totalCount: { type: 'number' },\n        page: { type: 'number' },\n        totalPages: { type: 'number' },\n      },\n    },\n  })\n  @ApiUnauthorizedResponse({\n    description: 'Invalid or missing authentication token',\n  })\n  @ApiForbiddenResponse({ description: 'Admin access required' })\n  @ApiInternalServerErrorResponse({\n    description: 'Failed to fetch applications',\n  })\n  @UseGuards(JwtAuthGuard)\n  async getAllApplications(\n    @CurrentUserRole() role: string,\n    @Query('status') status?: string,\n    @Query('page') page?: number,\n    @Query('limit') limit?: number,\n  ): Promise<{\n    applications: TherapistApplicationResponse[];\n    totalCount: number;\n    page: number;\n    totalPages: number;\n  }> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      const pageNum = page ? Math.max(1, page) : 1;\n      const limitNum = limit ? Math.min(Math.max(1, limit), 100) : 10;\n\n      const result = await this.therapistAuthService.getAllApplications({\n        status,\n        page: pageNum,\n        limit: limitNum,\n      });\n\n      return result;\n    } catch (error) {\n      console.error('Error fetching applications:', error);\n      throw new InternalServerErrorException('Failed to fetch applications');\n    }\n  }\n\n  @Get('applications/:id')\n  @ApiOperation({\n    summary: 'Get therapist application by ID (Admin only)',\n    description:\n      'Retrieve detailed information about a specific therapist application. Admin access required.',\n  })\n  @ApiParam({ name: 'id', description: 'Application ID' })\n  @ApiResponse({\n    status: 200,\n    description: 'Application retrieved successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        id: { type: 'string' },\n        email: { type: 'string' },\n        firstName: { type: 'string' },\n        lastName: { type: 'string' },\n        licenseNumber: { type: 'string' },\n        specializations: { type: 'array', items: { type: 'string' } },\n        education: { type: 'string' },\n        experience: { type: 'string' },\n        status: { type: 'string' },\n        submittedAt: { type: 'string', format: 'date-time' },\n        reviewedAt: { type: 'string', format: 'date-time', nullable: true },\n      },\n    },\n  })\n  @ApiUnauthorizedResponse({\n    description: 'Invalid or missing authentication token',\n  })\n  @ApiForbiddenResponse({ description: 'Admin access required' })\n  @ApiNotFoundResponse({ description: 'Application not found' })\n  @ApiInternalServerErrorResponse({\n    description: 'Failed to fetch application',\n  })\n  @UseGuards(JwtAuthGuard)\n  async getApplicationById(\n    @CurrentUserRole() role: string,\n    @Param('id') id: string,\n  ): Promise<TherapistApplicationResponse> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      const application =\n        await this.therapistAuthService.getApplicationById(id);\n\n      if (!application) {\n        throw new NotFoundException('Application not found');\n      }\n\n      return application;\n    } catch (error) {\n      console.error('Error fetching application:', error);\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n      throw new InternalServerErrorException('Failed to fetch application');\n    }\n  }\n\n  @Put('applications/:id/status')\n  @ApiOperation({\n    summary: 'Update therapist application status (Admin only)',\n    description:\n      'Update the status of a therapist application (approve, reject, etc.). Admin access required.',\n  })\n  @ApiParam({ name: 'id', description: 'Application ID' })\n  @ApiBody({\n    description: 'Status update data',\n    schema: {\n      type: 'object',\n      required: ['status'],\n      properties: {\n        status: {\n          type: 'string',\n          enum: ['approved', 'rejected', 'pending'],\n          example: 'approved',\n        },\n        notes: {\n          type: 'string',\n          description: 'Optional notes about the decision',\n        },\n        reviewerComments: {\n          type: 'string',\n          description: 'Comments from the reviewing admin',\n        },\n      },\n    },\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Application status updated successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        message: { type: 'string' },\n        credentials: {\n          type: 'object',\n          properties: {\n            email: { type: 'string' },\n            password: { type: 'string' },\n          },\n          description: 'Generated credentials for approved applications',\n        },\n      },\n    },\n  })\n  @ApiUnauthorizedResponse({\n    description: 'Invalid or missing authentication token',\n  })\n  @ApiForbiddenResponse({ description: 'Admin access required' })\n  @ApiNotFoundResponse({ description: 'Application not found' })\n  @ApiInternalServerErrorResponse({\n    description: 'Failed to update application status',\n  })\n  @UseGuards(JwtAuthGuard)\n  async updateApplicationStatus(\n    @CurrentUserRole() role: string,\n    @Param('id') id: string,\n    @Body() updateData: ApplicationStatusUpdateDto,\n  ): Promise<{\n    success: boolean;\n    message: string;\n    credentials?: { email: string; password: string };\n  }> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      const result = await this.therapistAuthService.updateApplicationStatus(\n        id,\n        updateData,\n      );\n\n      return result;\n    } catch (error) {\n      console.error('Error updating application status:', error);\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        'Failed to update application status',\n      );\n    }\n  }\n\n  @Get('applications/:id/files')\n  @ApiOperation({\n    summary: 'Get therapist application files (Admin only)',\n    description:\n      'Retrieve all uploaded files for a specific therapist application. Admin access required.',\n  })\n  @ApiParam({ name: 'id', description: 'Application ID' })\n  @ApiResponse({\n    status: 200,\n    description: 'Application files retrieved successfully',\n    schema: {\n      type: 'array',\n      items: {\n        type: 'object',\n        properties: {\n          id: { type: 'string' },\n          fileName: { type: 'string' },\n          fileUrl: { type: 'string' },\n          uploadedAt: { type: 'string', format: 'date-time' },\n        },\n      },\n    },\n  })\n  @ApiUnauthorizedResponse({\n    description: 'Invalid or missing authentication token',\n  })\n  @ApiForbiddenResponse({ description: 'Admin access required' })\n  @ApiNotFoundResponse({ description: 'Application or files not found' })\n  @ApiInternalServerErrorResponse({\n    description: 'Failed to fetch application files',\n  })\n  @UseGuards(JwtAuthGuard)\n  async getApplicationFiles(\n    @CurrentUserRole() role: string,\n    @Param('id') applicationId: string,\n  ): Promise<\n    Array<{\n      id: string;\n      fileName: string;\n      fileUrl: string;\n      uploadedAt: string;\n    }>\n  > {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      const files =\n        await this.therapistAuthService.getApplicationFiles(applicationId);\n      return files;\n    } catch (error) {\n      console.error('Error fetching application files:', error);\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        'Failed to fetch application files',\n      );\n    }\n  }\n}\n"],"version":3}