{"version":3,"names":["common_1","cov_nsua4mkom","s","require","jwt_auth_guard_1","current_user_id_decorator_1","zod_validation_pipe_1","validation_1","profile_service_1","ProfileController","ProfileController_1","profileService","logger","Logger","name","constructor","f","getPublicProfile","params","currentUserId","log","id","error","HttpException","Error","b","message","HttpStatus","INTERNAL_SERVER_ERROR","updateOwnProfile","profileData","updateProfile","exports","__decorate","Get","HttpCode","OK","__param","Param","ZodValidationPipe","UserIdParamSchema","CurrentUserId","Put","Body","Controller","UseGuards","JwtAuthGuard","ProfileService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/users/profile.controller.ts"],"sourcesContent":["import { Controller, Get, Put, Param, Body, HttpCode, HttpStatus, UseGuards, ForbiddenException, HttpException, Logger } from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport { UserIdParamSchema } from './validation';\nimport type { UserIdParam } from './types';\nimport { ProfileService } from './profile.service';\n\n/**\n * Public profile controller for viewing user/therapist profiles\n */\n@Controller('profile')\n@UseGuards(JwtAuthGuard)\nexport class ProfileController {\n  private readonly logger = new Logger(ProfileController.name);\n\n  constructor(\n    private readonly profileService: ProfileService,\n  ) {}\n\n  /**\n   * Get public profile by user ID\n   * Anyone can view public profiles\n   */\n  @Get(':id')\n  @HttpCode(HttpStatus.OK)\n  async getPublicProfile(\n    @Param(new ZodValidationPipe(UserIdParamSchema)) params: UserIdParam,\n    @CurrentUserId() currentUserId: string,\n  ) {\n    try {\n      this.logger.log(`User ${currentUserId} viewing profile ${params.id}`);\n      return await this.profileService.getPublicProfile(params.id, currentUserId);\n    } catch (error) {\n      this.logger.error(`Failed to fetch profile ${params.id}:`, error);\n      throw new HttpException(\n        `Failed to fetch profile: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  /**\n   * Update own profile\n   * Users can only update their own profile\n   */\n  @Put()\n  @HttpCode(HttpStatus.OK)\n  async updateOwnProfile(\n    @CurrentUserId() currentUserId: string,\n    @Body() profileData: any, // TODO: Add proper DTO validation\n  ) {\n    try {\n      this.logger.log(`User ${currentUserId} updating their profile`);\n      return await this.profileService.updateProfile(currentUserId, profileData);\n    } catch (error) {\n      this.logger.error(`Failed to update profile for user ${currentUserId}:`, error);\n      throw new HttpException(\n        `Failed to update profile: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}