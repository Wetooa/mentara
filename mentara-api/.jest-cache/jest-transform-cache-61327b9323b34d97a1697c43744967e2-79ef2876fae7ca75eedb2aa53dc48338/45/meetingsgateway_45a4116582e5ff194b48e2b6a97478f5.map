{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/meetings/meetings.gateway.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/meetings/meetings.gateway.ts"],"sourcesContent":["import {\n  WebSocketGateway,\n  WebSocketServer,\n  SubscribeMessage,\n  MessageBody,\n  ConnectedSocket,\n  OnGatewayConnection,\n  OnGatewayDisconnect,\n  OnGatewayInit,\n} from '@nestjs/websockets';\nimport { Server, Socket } from 'socket.io';\nimport { Logger, Injectable } from '@nestjs/common';\nimport { WebSocketAuthService } from '../messaging/services/websocket-auth.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { EventBusService } from '../common/events/event-bus.service';\n\ninterface MeetingRoom {\n  meetingId: string;\n  participants: Map<string, ParticipantInfo>;\n  startTime: Date;\n  status: 'waiting' | 'active' | 'ended';\n  hostId?: string;\n}\n\ninterface ParticipantInfo {\n  userId: string;\n  socketId: string;\n  role: 'therapist' | 'client';\n  joinedAt: Date;\n  isReady: boolean;\n  mediaStatus: {\n    video: boolean;\n    audio: boolean;\n    screen: boolean;\n  };\n}\n\ninterface JoinMeetingData {\n  meetingId: string;\n  mediaPreferences?: {\n    video: boolean;\n    audio: boolean;\n  };\n}\n\ninterface MediaToggleData {\n  meetingId: string;\n  mediaType: 'video' | 'audio' | 'screen';\n  enabled: boolean;\n}\n\ninterface ChatMessageData {\n  meetingId: string;\n  message: string;\n  timestamp: Date;\n}\n\ninterface MeetingControlData {\n  meetingId: string;\n  action: 'start' | 'end' | 'pause' | 'record';\n}\n\n@Injectable()\n@WebSocketGateway({\n  namespace: '/meetings',\n  cors: {\n    origin: [\n      process.env.FRONTEND_URL || 'http://localhost:3000',\n      'http://localhost:3000',  // Explicit fallback\n      'http://127.0.0.1:3000',  // Alternative localhost\n    ],\n    methods: ['GET', 'POST'],\n    credentials: true,\n    allowedHeaders: ['authorization', 'content-type'],\n  },\n})\nexport class MeetingsGateway\n  implements OnGatewayInit, OnGatewayConnection, OnGatewayDisconnect\n{\n  @WebSocketServer()\n  server!: Server;\n\n  private readonly logger = new Logger(MeetingsGateway.name);\n  private meetings = new Map<string, MeetingRoom>();\n  private userToSocket = new Map<string, string>();\n  private socketToUser = new Map<string, string>();\n\n  constructor(\n    private readonly websocketAuth: WebSocketAuthService,\n    private readonly prisma: PrismaService,\n    private readonly eventBus: EventBusService,\n  ) {}\n\n  afterInit() {\n    this.logger.log('Meetings WebSocket Gateway initialized');\n  }\n\n  async handleConnection(client: Socket) {\n    try {\n      const user = await this.websocketAuth.authenticateSocket(client);\n      if (!user) {\n        client.disconnect();\n        return;\n      }\n\n      this.userToSocket.set(user.userId, client.id);\n      this.socketToUser.set(client.id, user.userId);\n\n      this.logger.log(`User ${user.userId} connected to meetings gateway`);\n\n      // Send user their active meetings\n      await this.sendActiveMeetings(client, user.userId);\n    } catch (error) {\n      this.logger.error('Connection failed:', error);\n      client.disconnect();\n    }\n  }\n\n  async handleDisconnect(client: Socket) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    // Remove user from all meetings\n    for (const [meetingId, meeting] of this.meetings.entries()) {\n      if (meeting.participants.has(userId)) {\n        await this.leaveMeeting(client, { meetingId });\n      }\n    }\n\n    this.userToSocket.delete(userId);\n    this.socketToUser.delete(client.id);\n\n    this.logger.log(`User ${userId} disconnected from meetings gateway`);\n  }\n\n  @SubscribeMessage('join-meeting')\n  async joinMeeting(\n    @ConnectedSocket() client: Socket,\n    @MessageBody() data: JoinMeetingData,\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    try {\n      // Validate meeting exists and user has access\n      const meeting = await this.prisma.meeting.findFirst({\n        where: {\n          id: data.meetingId,\n          OR: [{ clientId: userId }, { therapistId: userId }],\n          status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },\n        },\n        include: {\n          client: {\n            include: { user: true },\n          },\n          therapist: {\n            include: { user: true },\n          },\n        },\n      });\n\n      if (!meeting) {\n        client.emit('meeting-error', {\n          error: 'Meeting not found or access denied',\n        });\n        return;\n      }\n\n      // Determine user role\n      const role = meeting.therapistId === userId ? 'therapist' : 'client';\n\n      // Create or get meeting room\n      let meetingRoom = this.meetings.get(data.meetingId);\n      if (!meetingRoom) {\n        meetingRoom = {\n          meetingId: data.meetingId,\n          participants: new Map(),\n          startTime: new Date(),\n          status: 'waiting',\n          hostId: meeting.therapistId, // Therapist is typically the host\n        };\n        this.meetings.set(data.meetingId, meetingRoom);\n      }\n\n      // Add participant\n      const participant: ParticipantInfo = {\n        userId,\n        socketId: client.id,\n        role,\n        joinedAt: new Date(),\n        isReady: false,\n        mediaStatus: {\n          video: data.mediaPreferences?.video ?? false,\n          audio: data.mediaPreferences?.audio ?? true,\n          screen: false,\n        },\n      };\n\n      meetingRoom.participants.set(userId, participant);\n\n      // Join socket room\n      void client.join(data.meetingId);\n\n      // Notify other participants\n      void client.to(data.meetingId).emit('participant-joined', {\n        participant: {\n          userId,\n          role,\n          mediaStatus: participant.mediaStatus,\n        },\n      });\n\n      // Send current meeting state to joining user\n      client.emit('meeting-joined', {\n        meetingId: data.meetingId,\n        meeting: {\n          id: meeting.id,\n          title: meeting.title,\n          startTime: meeting.startTime,\n          duration: meeting.duration,\n          status: meetingRoom.status,\n        },\n        participants: Array.from(meetingRoom.participants.values()).map(\n          (p) => ({\n            userId: p.userId,\n            role: p.role,\n            mediaStatus: p.mediaStatus,\n            isReady: p.isReady,\n          }),\n        ),\n        isHost: userId === meetingRoom.hostId,\n      });\n\n      // Update meeting status if first participant\n      if (meetingRoom.participants.size === 1) {\n        await this.prisma.meeting.update({\n          where: { id: data.meetingId },\n          data: { status: 'IN_PROGRESS' },\n        });\n      }\n\n      this.logger.log(`User ${userId} joined meeting ${data.meetingId}`);\n    } catch (error) {\n      this.logger.error('Failed to join meeting:', error);\n      client.emit('meeting-error', {\n        error: 'Failed to join meeting',\n      });\n    }\n  }\n\n  @SubscribeMessage('leave-meeting')\n  async leaveMeeting(\n    @ConnectedSocket() client: Socket,\n    @MessageBody() data: { meetingId: string },\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    const meetingRoom = this.meetings.get(data.meetingId);\n    if (!meetingRoom) return;\n\n    // Remove participant\n    meetingRoom.participants.delete(userId);\n    void client.leave(data.meetingId);\n\n    // Notify other participants\n    void client.to(data.meetingId).emit('participant-left', {\n      userId,\n    });\n\n    // If no participants left, end meeting\n    if (meetingRoom.participants.size === 0) {\n      await this.endMeeting(data.meetingId);\n    }\n\n    this.logger.log(`User ${userId} left meeting ${data.meetingId}`);\n  }\n\n  @SubscribeMessage('toggle-media')\n  async toggleMedia(\n    @ConnectedSocket() client: Socket,\n    @MessageBody() data: MediaToggleData,\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    const meetingRoom = this.meetings.get(data.meetingId);\n    if (!meetingRoom) return;\n\n    const participant = meetingRoom.participants.get(userId);\n    if (!participant) return;\n\n    // Update media status\n    participant.mediaStatus[data.mediaType] = data.enabled;\n\n    // Notify other participants\n    client.to(data.meetingId).emit('participant-media-changed', {\n      userId,\n      mediaType: data.mediaType,\n      enabled: data.enabled,\n    });\n\n    this.logger.log(\n      `User ${userId} toggled ${data.mediaType} to ${data.enabled} in meeting ${data.meetingId}`,\n    );\n  }\n\n  @SubscribeMessage('participant-ready')\n  async participantReady(\n    @ConnectedSocket() client: Socket,\n    @MessageBody() data: { meetingId: string },\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    const meetingRoom = this.meetings.get(data.meetingId);\n    if (!meetingRoom) return;\n\n    const participant = meetingRoom.participants.get(userId);\n    if (!participant) return;\n\n    participant.isReady = true;\n\n    // Notify other participants\n    client.to(data.meetingId).emit('participant-ready', {\n      userId,\n    });\n\n    // Check if all participants are ready\n    const allReady = Array.from(meetingRoom.participants.values()).every(\n      (p) => p.isReady,\n    );\n\n    if (allReady && meetingRoom.status === 'waiting') {\n      meetingRoom.status = 'active';\n      this.server.to(data.meetingId).emit('meeting-started', {\n        meetingId: data.meetingId,\n      });\n    }\n  }\n\n  @SubscribeMessage('chat-message')\n  async sendChatMessage(\n    @ConnectedSocket() client: Socket,\n    @MessageBody() data: ChatMessageData,\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    const meetingRoom = this.meetings.get(data.meetingId);\n    if (!meetingRoom || !meetingRoom.participants.has(userId)) return;\n\n    const participant = meetingRoom.participants.get(userId);\n    if (!participant) return;\n\n    // Broadcast message to all participants\n    this.server.to(data.meetingId).emit('chat-message', {\n      senderId: userId,\n      senderRole: participant.role,\n      message: data.message,\n      timestamp: new Date(),\n    });\n  }\n\n  @SubscribeMessage('meeting-control')\n  async meetingControl(\n    @ConnectedSocket() client: Socket,\n    @MessageBody() data: MeetingControlData,\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    const meetingRoom = this.meetings.get(data.meetingId);\n    if (!meetingRoom) return;\n\n    // Only host can control meeting\n    if (userId !== meetingRoom.hostId) {\n      client.emit('meeting-error', {\n        error: 'Only the host can control the meeting',\n      });\n      return;\n    }\n\n    switch (data.action) {\n      case 'start':\n        meetingRoom.status = 'active';\n        this.server.to(data.meetingId).emit('meeting-started', {\n          meetingId: data.meetingId,\n        });\n        break;\n\n      case 'end':\n        await this.endMeeting(data.meetingId);\n        break;\n\n      case 'record':\n        // Recording functionality would be implemented here\n        this.server.to(data.meetingId).emit('recording-started', {\n          meetingId: data.meetingId,\n        });\n        break;\n    }\n  }\n\n  @SubscribeMessage('webrtc-signal')\n  async handleWebRTCSignal(\n    @ConnectedSocket() client: Socket,\n    @MessageBody()\n    data: {\n      meetingId: string;\n      targetUserId: string;\n      signal: any;\n      type: 'offer' | 'answer' | 'ice-candidate';\n    },\n  ) {\n    const userId = this.socketToUser.get(client.id);\n    if (!userId) return;\n\n    const targetSocketId = this.userToSocket.get(data.targetUserId);\n    if (!targetSocketId) return;\n\n    // Forward WebRTC signal to target user\n    this.server.to(targetSocketId).emit('webrtc-signal', {\n      fromUserId: userId,\n      signal: data.signal,\n      type: data.type,\n    });\n  }\n\n  private async endMeeting(meetingId: string) {\n    const meetingRoom = this.meetings.get(meetingId);\n    if (!meetingRoom) return;\n\n    meetingRoom.status = 'ended';\n\n    // Notify all participants\n    this.server.to(meetingId).emit('meeting-ended', {\n      meetingId,\n      endTime: new Date(),\n    });\n\n    // Update database\n    await this.prisma.meeting.update({\n      where: { id: meetingId },\n      data: {\n        status: 'COMPLETED',\n        // Add end time or actual duration if needed\n      },\n    });\n\n    // Remove all participants from room\n    for (const participant of meetingRoom.participants.values()) {\n      const socket = this.server.sockets.sockets.get(participant.socketId);\n      void socket?.leave(meetingId);\n    }\n\n    // Clean up meeting room\n    this.meetings.delete(meetingId);\n\n    this.logger.log(`Meeting ${meetingId} ended`);\n  }\n\n  private async sendActiveMeetings(client: Socket, userId: string) {\n    try {\n      const activeMeetings = await this.prisma.meeting.findMany({\n        where: {\n          OR: [{ clientId: userId }, { therapistId: userId }],\n          status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },\n          startTime: {\n            gte: new Date(Date.now() - 24 * 60 * 60 * 1000), // Last 24 hours\n            lte: new Date(Date.now() + 60 * 60 * 1000), // Next 1 hour\n          },\n        },\n        include: {\n          client: {\n            include: { user: { select: { firstName: true, lastName: true } } },\n          },\n          therapist: {\n            include: { user: { select: { firstName: true, lastName: true } } },\n          },\n        },\n      });\n\n      client.emit('active-meetings', {\n        meetings: activeMeetings.map((meeting) => ({\n          id: meeting.id,\n          title: meeting.title,\n          startTime: meeting.startTime,\n          duration: meeting.duration,\n          status: meeting.status,\n          isActive: this.meetings.has(meeting.id),\n          participantCount:\n            this.meetings.get(meeting.id)?.participants.size || 0,\n        })),\n      });\n    } catch (error) {\n      this.logger.error('Failed to send active meetings:', error);\n    }\n  }\n}\n"],"version":3}