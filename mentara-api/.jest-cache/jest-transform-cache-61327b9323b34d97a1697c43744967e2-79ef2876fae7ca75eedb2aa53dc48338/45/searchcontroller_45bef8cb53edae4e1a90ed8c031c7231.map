{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.controller.ts"],"sourcesContent":["import { Controller, Get, Query, UseGuards } from '@nestjs/common';\nimport { SearchService } from './search.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBody,\n  ApiBearerAuth,\n  ApiParam,\n  ApiQuery,\n} from '@nestjs/swagger';\nimport {\n  SearchTherapistsQueryDtoSchema,\n  SearchPostsQueryDtoSchema,\n  SearchCommunitiesQueryDtoSchema,\n  SearchUsersQueryDtoSchema,\n  GlobalSearchQueryDtoSchema,\n  type SearchTherapistsQueryDto,\n  type SearchPostsQueryDto,\n  type SearchCommunitiesQueryDto,\n  type SearchUsersQueryDto,\n  type GlobalSearchQueryDto,\n} from 'mentara-commons';\n\n@ApiTags('search')\n@ApiBearerAuth('JWT-auth')\n@Controller('search')\n@UseGuards(JwtAuthGuard)\nexport class SearchController {\n  constructor(private readonly searchService: SearchService) {}\n\n  @Get('therapists')\n  @ApiOperation({\n    summary: 'Search therapists',\n    description:\n      'Search for therapists with advanced filtering options including location, specialties, price range, and more',\n  })\n  @ApiQuery({\n    name: 'query',\n    required: false,\n    description: 'Search query string',\n  })\n  @ApiQuery({\n    name: 'location',\n    required: false,\n    description: 'Filter by location',\n  })\n  @ApiQuery({\n    name: 'specialties',\n    required: false,\n    description: 'Filter by specializations (comma-separated)',\n  })\n  @ApiQuery({\n    name: 'priceRange',\n    required: false,\n    description: 'Price range filter',\n  })\n  @ApiQuery({\n    name: 'experienceYears',\n    required: false,\n    description: 'Minimum years of experience',\n  })\n  @ApiQuery({ name: 'rating', required: false, description: 'Minimum rating' })\n  @ApiQuery({\n    name: 'gender',\n    required: false,\n    description: 'Filter by gender',\n  })\n  @ApiQuery({\n    name: 'languages',\n    required: false,\n    description: 'Filter by languages spoken',\n  })\n  @ApiQuery({\n    name: 'availability',\n    required: false,\n    description: 'Filter by availability',\n  })\n  @ApiQuery({\n    name: 'verifiedOnly',\n    required: false,\n    description: 'Show only verified therapists',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Therapists found successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        therapists: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              firstName: { type: 'string' },\n              lastName: { type: 'string' },\n              specializations: { type: 'array', items: { type: 'string' } },\n              location: { type: 'string' },\n              hourlyRate: { type: 'number' },\n              rating: { type: 'number' },\n              experienceYears: { type: 'number' },\n              verified: { type: 'boolean' },\n            },\n          },\n        },\n        totalCount: { type: 'number' },\n        filters: { type: 'object' },\n      },\n    },\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  searchTherapists(\n    @Query(new ZodValidationPipe(SearchTherapistsQueryDtoSchema))\n    query: SearchTherapistsQueryDto,\n  ) {\n    return this.searchService.searchTherapists(query.query || '', {\n      location: query.location,\n      specialties: query.specialties,\n      priceRange: query.priceRange,\n      experienceYears: query.experienceYears,\n      rating: query.rating,\n      gender: query.gender,\n      languages: query.languages,\n      availability: query.availability,\n      verifiedOnly: query.verifiedOnly,\n      // Map maxHourlyRate from priceRange.max for backward compatibility\n      maxHourlyRate: query.priceRange?.max,\n    });\n  }\n\n  @Get('posts')\n  @ApiOperation({\n    summary: 'Search posts',\n    description:\n      'Search for posts within communities with optional community filtering',\n  })\n  @ApiQuery({\n    name: 'query',\n    required: true,\n    description: 'Search query string',\n  })\n  @ApiQuery({\n    name: 'communityId',\n    required: false,\n    description: 'Filter by specific community ID',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Posts found successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        posts: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              title: { type: 'string' },\n              content: { type: 'string' },\n              authorId: { type: 'string' },\n              communityId: { type: 'string' },\n              createdAt: { type: 'string', format: 'date-time' },\n              likesCount: { type: 'number' },\n              commentsCount: { type: 'number' },\n            },\n          },\n        },\n        totalCount: { type: 'number' },\n      },\n    },\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  searchPosts(\n    @Query(new ZodValidationPipe(SearchPostsQueryDtoSchema))\n    query: SearchPostsQueryDto,\n  ) {\n    return this.searchService.searchPosts(query.query, query.communityId);\n  }\n\n  @Get('communities')\n  @ApiOperation({\n    summary: 'Search communities',\n    description: 'Search for communities by name or description',\n  })\n  @ApiQuery({\n    name: 'query',\n    required: true,\n    description: 'Search query string',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Communities found successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        communities: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              name: { type: 'string' },\n              description: { type: 'string' },\n              memberCount: { type: 'number' },\n              isPrivate: { type: 'boolean' },\n              createdAt: { type: 'string', format: 'date-time' },\n            },\n          },\n        },\n        totalCount: { type: 'number' },\n      },\n    },\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  searchCommunities(\n    @Query(new ZodValidationPipe(SearchCommunitiesQueryDtoSchema))\n    query: SearchCommunitiesQueryDto,\n  ) {\n    return this.searchService.searchCommunities(query.query);\n  }\n\n  @Get('users')\n  @ApiOperation({\n    summary: 'Search users',\n    description:\n      'Search for users by name or email with optional role filtering',\n  })\n  @ApiQuery({\n    name: 'query',\n    required: true,\n    description: 'Search query string',\n  })\n  @ApiQuery({\n    name: 'role',\n    required: false,\n    description: 'Filter by user role (client, therapist, admin, moderator)',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Users found successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        users: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              id: { type: 'string' },\n              firstName: { type: 'string' },\n              lastName: { type: 'string' },\n              email: { type: 'string' },\n              role: { type: 'string' },\n              isActive: { type: 'boolean' },\n              createdAt: { type: 'string', format: 'date-time' },\n            },\n          },\n        },\n        totalCount: { type: 'number' },\n      },\n    },\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  searchUsers(\n    @Query(new ZodValidationPipe(SearchUsersQueryDtoSchema))\n    query: SearchUsersQueryDto,\n  ) {\n    return this.searchService.searchUsers(query.query, query.role);\n  }\n\n  @Get('global')\n  @ApiOperation({\n    summary: 'Global search',\n    description:\n      'Search across multiple entity types (users, therapists, posts, communities) in a single query',\n  })\n  @ApiQuery({\n    name: 'query',\n    required: true,\n    description: 'Search query string',\n  })\n  @ApiQuery({\n    name: 'types',\n    required: false,\n    description:\n      'Entity types to search (users, therapists, posts, communities)',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Global search results',\n    schema: {\n      type: 'object',\n      properties: {\n        results: {\n          type: 'object',\n          properties: {\n            users: {\n              type: 'array',\n              items: { type: 'object' },\n            },\n            therapists: {\n              type: 'array',\n              items: { type: 'object' },\n            },\n            posts: {\n              type: 'array',\n              items: { type: 'object' },\n            },\n            communities: {\n              type: 'array',\n              items: { type: 'object' },\n            },\n          },\n        },\n        totalCount: { type: 'number' },\n        query: { type: 'string' },\n        searchTypes: { type: 'array', items: { type: 'string' } },\n      },\n    },\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  globalSearch(\n    @Query(new ZodValidationPipe(GlobalSearchQueryDtoSchema))\n    query: GlobalSearchQueryDto,\n  ) {\n    // Filter out unsupported types like 'worksheets'\n    const supportedTypes = query.types?.filter((type) =>\n      ['users', 'therapists', 'posts', 'communities'].includes(type),\n    ) as ('users' | 'therapists' | 'posts' | 'communities')[] | undefined;\n\n    return this.searchService.globalSearch(query.query, supportedTypes);\n  }\n}\n"],"version":3}