24cb573e25d363fc9a088539e8ce0d73
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var MeetingsGateway_1;
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingsGateway = void 0;
const websockets_1 = require("@nestjs/websockets");
const socket_io_1 = require("socket.io");
const common_1 = require("@nestjs/common");
const websocket_auth_service_1 = require("../messaging/services/websocket-auth.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const event_bus_service_1 = require("../common/events/event-bus.service");
let MeetingsGateway = MeetingsGateway_1 = class MeetingsGateway {
    websocketAuth;
    prisma;
    eventBus;
    server;
    logger = new common_1.Logger(MeetingsGateway_1.name);
    meetings = new Map();
    userToSocket = new Map();
    socketToUser = new Map();
    constructor(websocketAuth, prisma, eventBus) {
        this.websocketAuth = websocketAuth;
        this.prisma = prisma;
        this.eventBus = eventBus;
    }
    afterInit() {
        this.logger.log('Meetings WebSocket Gateway initialized');
    }
    async handleConnection(client) {
        try {
            const user = await this.websocketAuth.authenticateSocket(client);
            if (!user) {
                client.disconnect();
                return;
            }
            this.userToSocket.set(user.userId, client.id);
            this.socketToUser.set(client.id, user.userId);
            this.logger.log(`User ${user.userId} connected to meetings gateway`);
            // Send user their active meetings
            await this.sendActiveMeetings(client, user.userId);
        }
        catch (error) {
            this.logger.error('Connection failed:', error);
            client.disconnect();
        }
    }
    async handleDisconnect(client) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        // Remove user from all meetings
        for (const [meetingId, meeting] of this.meetings.entries()) {
            if (meeting.participants.has(userId)) {
                await this.leaveMeeting(client, { meetingId });
            }
        }
        this.userToSocket.delete(userId);
        this.socketToUser.delete(client.id);
        this.logger.log(`User ${userId} disconnected from meetings gateway`);
    }
    async joinMeeting(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        try {
            // Validate meeting exists and user has access
            const meeting = await this.prisma.meeting.findFirst({
                where: {
                    id: data.meetingId,
                    OR: [{ clientId: userId }, { therapistId: userId }],
                    status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },
                },
                include: {
                    client: {
                        include: { user: true },
                    },
                    therapist: {
                        include: { user: true },
                    },
                },
            });
            if (!meeting) {
                client.emit('meeting-error', {
                    error: 'Meeting not found or access denied',
                });
                return;
            }
            // Determine user role
            const role = meeting.therapistId === userId ? 'therapist' : 'client';
            // Create or get meeting room
            let meetingRoom = this.meetings.get(data.meetingId);
            if (!meetingRoom) {
                meetingRoom = {
                    meetingId: data.meetingId,
                    participants: new Map(),
                    startTime: new Date(),
                    status: 'waiting',
                    hostId: meeting.therapistId, // Therapist is typically the host
                };
                this.meetings.set(data.meetingId, meetingRoom);
            }
            // Add participant
            const participant = {
                userId,
                socketId: client.id,
                role,
                joinedAt: new Date(),
                isReady: false,
                mediaStatus: {
                    video: data.mediaPreferences?.video ?? false,
                    audio: data.mediaPreferences?.audio ?? true,
                    screen: false,
                },
            };
            meetingRoom.participants.set(userId, participant);
            // Join socket room
            void client.join(data.meetingId);
            // Notify other participants
            void client.to(data.meetingId).emit('participant-joined', {
                participant: {
                    userId,
                    role,
                    mediaStatus: participant.mediaStatus,
                },
            });
            // Send current meeting state to joining user
            client.emit('meeting-joined', {
                meetingId: data.meetingId,
                meeting: {
                    id: meeting.id,
                    title: meeting.title,
                    startTime: meeting.startTime,
                    duration: meeting.duration,
                    status: meetingRoom.status,
                },
                participants: Array.from(meetingRoom.participants.values()).map((p) => ({
                    userId: p.userId,
                    role: p.role,
                    mediaStatus: p.mediaStatus,
                    isReady: p.isReady,
                })),
                isHost: userId === meetingRoom.hostId,
            });
            // Update meeting status if first participant
            if (meetingRoom.participants.size === 1) {
                await this.prisma.meeting.update({
                    where: { id: data.meetingId },
                    data: { status: 'IN_PROGRESS' },
                });
            }
            this.logger.log(`User ${userId} joined meeting ${data.meetingId}`);
        }
        catch (error) {
            this.logger.error('Failed to join meeting:', error);
            client.emit('meeting-error', {
                error: 'Failed to join meeting',
            });
        }
    }
    async leaveMeeting(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        const meetingRoom = this.meetings.get(data.meetingId);
        if (!meetingRoom)
            return;
        // Remove participant
        meetingRoom.participants.delete(userId);
        void client.leave(data.meetingId);
        // Notify other participants
        void client.to(data.meetingId).emit('participant-left', {
            userId,
        });
        // If no participants left, end meeting
        if (meetingRoom.participants.size === 0) {
            await this.endMeeting(data.meetingId);
        }
        this.logger.log(`User ${userId} left meeting ${data.meetingId}`);
    }
    async toggleMedia(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        const meetingRoom = this.meetings.get(data.meetingId);
        if (!meetingRoom)
            return;
        const participant = meetingRoom.participants.get(userId);
        if (!participant)
            return;
        // Update media status
        participant.mediaStatus[data.mediaType] = data.enabled;
        // Notify other participants
        client.to(data.meetingId).emit('participant-media-changed', {
            userId,
            mediaType: data.mediaType,
            enabled: data.enabled,
        });
        this.logger.log(`User ${userId} toggled ${data.mediaType} to ${data.enabled} in meeting ${data.meetingId}`);
    }
    async participantReady(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        const meetingRoom = this.meetings.get(data.meetingId);
        if (!meetingRoom)
            return;
        const participant = meetingRoom.participants.get(userId);
        if (!participant)
            return;
        participant.isReady = true;
        // Notify other participants
        client.to(data.meetingId).emit('participant-ready', {
            userId,
        });
        // Check if all participants are ready
        const allReady = Array.from(meetingRoom.participants.values()).every((p) => p.isReady);
        if (allReady && meetingRoom.status === 'waiting') {
            meetingRoom.status = 'active';
            this.server.to(data.meetingId).emit('meeting-started', {
                meetingId: data.meetingId,
            });
        }
    }
    async sendChatMessage(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        const meetingRoom = this.meetings.get(data.meetingId);
        if (!meetingRoom || !meetingRoom.participants.has(userId))
            return;
        const participant = meetingRoom.participants.get(userId);
        if (!participant)
            return;
        // Broadcast message to all participants
        this.server.to(data.meetingId).emit('chat-message', {
            senderId: userId,
            senderRole: participant.role,
            message: data.message,
            timestamp: new Date(),
        });
    }
    async meetingControl(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        const meetingRoom = this.meetings.get(data.meetingId);
        if (!meetingRoom)
            return;
        // Only host can control meeting
        if (userId !== meetingRoom.hostId) {
            client.emit('meeting-error', {
                error: 'Only the host can control the meeting',
            });
            return;
        }
        switch (data.action) {
            case 'start':
                meetingRoom.status = 'active';
                this.server.to(data.meetingId).emit('meeting-started', {
                    meetingId: data.meetingId,
                });
                break;
            case 'end':
                await this.endMeeting(data.meetingId);
                break;
            case 'record':
                // Recording functionality would be implemented here
                this.server.to(data.meetingId).emit('recording-started', {
                    meetingId: data.meetingId,
                });
                break;
        }
    }
    async handleWebRTCSignal(client, data) {
        const userId = this.socketToUser.get(client.id);
        if (!userId)
            return;
        const targetSocketId = this.userToSocket.get(data.targetUserId);
        if (!targetSocketId)
            return;
        // Forward WebRTC signal to target user
        this.server.to(targetSocketId).emit('webrtc-signal', {
            fromUserId: userId,
            signal: data.signal,
            type: data.type,
        });
    }
    async endMeeting(meetingId) {
        const meetingRoom = this.meetings.get(meetingId);
        if (!meetingRoom)
            return;
        meetingRoom.status = 'ended';
        // Notify all participants
        this.server.to(meetingId).emit('meeting-ended', {
            meetingId,
            endTime: new Date(),
        });
        // Update database
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'COMPLETED',
                // Add end time or actual duration if needed
            },
        });
        // Remove all participants from room
        for (const participant of meetingRoom.participants.values()) {
            const socket = this.server.sockets.sockets.get(participant.socketId);
            void socket?.leave(meetingId);
        }
        // Clean up meeting room
        this.meetings.delete(meetingId);
        this.logger.log(`Meeting ${meetingId} ended`);
    }
    async sendActiveMeetings(client, userId) {
        try {
            const activeMeetings = await this.prisma.meeting.findMany({
                where: {
                    OR: [{ clientId: userId }, { therapistId: userId }],
                    status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },
                    startTime: {
                        gte: new Date(Date.now() - 24 * 60 * 60 * 1000), // Last 24 hours
                        lte: new Date(Date.now() + 60 * 60 * 1000), // Next 1 hour
                    },
                },
                include: {
                    client: {
                        include: { user: { select: { firstName: true, lastName: true } } },
                    },
                    therapist: {
                        include: { user: { select: { firstName: true, lastName: true } } },
                    },
                },
            });
            client.emit('active-meetings', {
                meetings: activeMeetings.map((meeting) => ({
                    id: meeting.id,
                    title: meeting.title,
                    startTime: meeting.startTime,
                    duration: meeting.duration,
                    status: meeting.status,
                    isActive: this.meetings.has(meeting.id),
                    participantCount: this.meetings.get(meeting.id)?.participants.size || 0,
                })),
            });
        }
        catch (error) {
            this.logger.error('Failed to send active meetings:', error);
        }
    }
};
exports.MeetingsGateway = MeetingsGateway;
__decorate([
    (0, websockets_1.WebSocketServer)(),
    __metadata("design:type", typeof (_d = typeof socket_io_1.Server !== "undefined" && socket_io_1.Server) === "function" ? _d : Object)
], MeetingsGateway.prototype, "server", void 0);
__decorate([
    (0, websockets_1.SubscribeMessage)('join-meeting'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _e : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "joinMeeting", null);
__decorate([
    (0, websockets_1.SubscribeMessage)('leave-meeting'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _f : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "leaveMeeting", null);
__decorate([
    (0, websockets_1.SubscribeMessage)('toggle-media'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_g = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _g : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "toggleMedia", null);
__decorate([
    (0, websockets_1.SubscribeMessage)('participant-ready'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _h : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "participantReady", null);
__decorate([
    (0, websockets_1.SubscribeMessage)('chat-message'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _j : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "sendChatMessage", null);
__decorate([
    (0, websockets_1.SubscribeMessage)('meeting-control'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _k : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "meetingControl", null);
__decorate([
    (0, websockets_1.SubscribeMessage)('webrtc-signal'),
    __param(0, (0, websockets_1.ConnectedSocket)()),
    __param(1, (0, websockets_1.MessageBody)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof socket_io_1.Socket !== "undefined" && socket_io_1.Socket) === "function" ? _l : Object, Object]),
    __metadata("design:returntype", Promise)
], MeetingsGateway.prototype, "handleWebRTCSignal", null);
exports.MeetingsGateway = MeetingsGateway = MeetingsGateway_1 = __decorate([
    (0, common_1.Injectable)(),
    (0, websockets_1.WebSocketGateway)({
        namespace: '/meetings',
        cors: {
            origin: [
                process.env.FRONTEND_URL || 'http://localhost:3000',
                'http://localhost:3000', // Explicit fallback
                'http://127.0.0.1:3000', // Alternative localhost
            ],
            methods: ['GET', 'POST'],
            credentials: true,
            allowedHeaders: ['authorization', 'content-type'],
        },
    }),
    __metadata("design:paramtypes", [typeof (_a = typeof websocket_auth_service_1.WebSocketAuthService !== "undefined" && websocket_auth_service_1.WebSocketAuthService) === "function" ? _a : Object, typeof (_b = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _b : Object, typeof (_c = typeof event_bus_service_1.EventBusService !== "undefined" && event_bus_service_1.EventBusService) === "function" ? _c : Object])
], MeetingsGateway);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLmdhdGV3YXkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxtREFTNEI7QUFDNUIseUNBQTJDO0FBQzNDLDJDQUFvRDtBQUNwRCx5RkFBb0Y7QUFDcEYsZ0ZBQW9FO0FBQ3BFLDBFQUFxRTtBQThEOUQsSUFBTSxlQUFlLHVCQUFyQixNQUFNLGVBQWU7SUFZUDtJQUNBO0lBQ0E7SUFWbkIsTUFBTSxDQUFVO0lBRUMsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGlCQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkQsUUFBUSxHQUFHLElBQUksR0FBRyxFQUF1QixDQUFDO0lBQzFDLFlBQVksR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztJQUN6QyxZQUFZLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7SUFFakQsWUFDbUIsYUFBbUMsRUFDbkMsTUFBcUIsRUFDckIsUUFBeUI7UUFGekIsa0JBQWEsR0FBYixhQUFhLENBQXNCO1FBQ25DLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7SUFDekMsQ0FBQztJQUVKLFNBQVM7UUFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFRCxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBYztRQUNuQyxJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNWLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDcEIsT0FBTztZQUNULENBQUM7WUFFRCxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxF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O1lBQ0osTUFBTSxFQUFFO2dCQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxJQUFJLHVCQUF1QjtnQkFDbkQsdUJBQXVCLEVBQUcsb0JBQW9CO2dCQUM5Qyx1QkFBdUIsRUFBRyx3QkFBd0I7YUFDbkQ7WUFDRCxPQUFPLEVBQUUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDO1lBQ3hCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLGNBQWMsRUFBRSxDQUFDLGVBQWUsRUFBRSxjQUFjLENBQUM7U0FDbEQ7S0FDRixDQUFDO3lEQWFrQyw2Q0FBb0Isb0JBQXBCLDZDQUFvQixvREFDM0Isc0NBQWEsb0JBQWIsc0NBQWEsb0RBQ1gsbUNBQWUsb0JBQWYsbUNBQWU7R0FkakMsZUFBZSxDQXVhM0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLmdhdGV3YXkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgV2ViU29ja2V0R2F0ZXdheSxcbiAgV2ViU29ja2V0U2VydmVyLFxuICBTdWJzY3JpYmVNZXNzYWdlLFxuICBNZXNzYWdlQm9keSxcbiAgQ29ubmVjdGVkU29ja2V0LFxuICBPbkdhdGV3YXlDb25uZWN0aW9uLFxuICBPbkdhdGV3YXlEaXNjb25uZWN0LFxuICBPbkdhdGV3YXlJbml0LFxufSBmcm9tICdAbmVzdGpzL3dlYnNvY2tldHMnO1xuaW1wb3J0IHsgU2VydmVyLCBTb2NrZXQgfSBmcm9tICdzb2NrZXQuaW8nO1xuaW1wb3J0IHsgTG9nZ2VyLCBJbmplY3RhYmxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgV2ViU29ja2V0QXV0aFNlcnZpY2UgfSBmcm9tICcuLi9tZXNzYWdpbmcvc2VydmljZXMvd2Vic29ja2V0LWF1dGguc2VydmljZSc7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHsgRXZlbnRCdXNTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL2V2ZW50cy9ldmVudC1idXMuc2VydmljZSc7XG5cbmludGVyZmFjZSBNZWV0aW5nUm9vbSB7XG4gIG1lZXRpbmdJZDogc3RyaW5nO1xuICBwYXJ0aWNpcGFudHM6IE1hcDxzdHJpbmcsIFBhcnRpY2lwYW50SW5mbz47XG4gIHN0YXJ0VGltZTogRGF0ZTtcbiAgc3RhdHVzOiAnd2FpdGluZycgfCAnYWN0aXZlJyB8ICdlbmRlZCc7XG4gIGhvc3RJZD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFBhcnRpY2lwYW50SW5mbyB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBzb2NrZXRJZDogc3RyaW5nO1xuICByb2xlOiAndGhlcmFwaXN0JyB8ICdjbGllbnQnO1xuICBqb2luZWRBdDogRGF0ZTtcbiAgaXNSZWFkeTogYm9vbGVhbjtcbiAgbWVkaWFTdGF0dXM6IHtcbiAgICB2aWRlbzogYm9vbGVhbjtcbiAgICBhdWRpbzogYm9vbGVhbjtcbiAgICBzY3JlZW46IGJvb2xlYW47XG4gIH07XG59XG5cbmludGVyZmFjZSBKb2luTWVldGluZ0RhdGEge1xuICBtZWV0aW5nSWQ6IHN0cmluZztcbiAgbWVkaWFQcmVmZXJlbmNlcz86IHtcbiAgICB2aWRlbzogYm9vbGVhbjtcbiAgICBhdWRpbzogYm9vbGVhbjtcbiAgfTtcbn1cblxuaW50ZXJmYWNlIE1lZGlhVG9nZ2xlRGF0YSB7XG4gIG1lZXRpbmdJZDogc3RyaW5nO1xuICBtZWRpYVR5cGU6ICd2aWRlbycgfCAnYXVkaW8nIHwgJ3NjcmVlbic7XG4gIGVuYWJsZWQ6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBDaGF0TWVzc2FnZURhdGEge1xuICBtZWV0aW5nSWQ6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG59XG5cbmludGVyZmFjZSBNZWV0aW5nQ29udHJvbERhdGEge1xuICBtZWV0aW5nSWQ6IHN0cmluZztcbiAgYWN0aW9uOiAnc3RhcnQnIHwgJ2VuZCcgfCAncGF1c2UnIHwgJ3JlY29yZCc7XG59XG5cbkBJbmplY3RhYmxlKClcbkBXZWJTb2NrZXRHYXRld2F5KHtcbiAgbmFtZXNwYWNlOiAnL21lZXRpbmdzJyxcbiAgY29yczoge1xuICAgIG9yaWdpbjogW1xuICAgICAgcHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnLFxuICAgICAgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsICAvLyBFeHBsaWNpdCBmYWxsYmFja1xuICAgICAgJ2h0dHA6Ly8xMjcuMC4wLjE6MzAwMCcsICAvLyBBbHRlcm5hdGl2ZSBsb2NhbGhvc3RcbiAgICBdLFxuICAgIG1ldGhvZHM6IFsnR0VUJywgJ1BPU1QnXSxcbiAgICBjcmVkZW50aWFsczogdHJ1ZSxcbiAgICBhbGxvd2VkSGVhZGVyczogWydhdXRob3JpemF0aW9uJywgJ2NvbnRlbnQtdHlwZSddLFxuICB9LFxufSlcbmV4cG9ydCBjbGFzcyBNZWV0aW5nc0dhdGV3YXlcbiAgaW1wbGVtZW50cyBPbkdhdGV3YXlJbml0LCBPbkdhdGV3YXlDb25uZWN0aW9uLCBPbkdhdGV3YXlEaXNjb25uZWN0XG57XG4gIEBXZWJTb2NrZXRTZXJ2ZXIoKVxuICBzZXJ2ZXIhOiBTZXJ2ZXI7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKE1lZXRpbmdzR2F0ZXdheS5uYW1lKTtcbiAgcHJpdmF0ZSBtZWV0aW5ncyA9IG5ldyBNYXA8c3RyaW5nLCBNZWV0aW5nUm9vbT4oKTtcbiAgcHJpdmF0ZSB1c2VyVG9Tb2NrZXQgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuICBwcml2YXRlIHNvY2tldFRvVXNlciA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSB3ZWJzb2NrZXRBdXRoOiBXZWJTb2NrZXRBdXRoU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByaXNtYTogUHJpc21hU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGV2ZW50QnVzOiBFdmVudEJ1c1NlcnZpY2UsXG4gICkge31cblxuICBhZnRlckluaXQoKSB7XG4gICAgdGhpcy5sb2dnZXIubG9nKCdNZWV0aW5ncyBXZWJTb2NrZXQgR2F0ZXdheSBpbml0aWFsaXplZCcpO1xuICB9XG5cbiAgYXN5bmMgaGFuZGxlQ29ubmVjdGlvbihjbGllbnQ6IFNvY2tldCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy53ZWJzb2NrZXRBdXRoLmF1dGhlbnRpY2F0ZVNvY2tldChjbGllbnQpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIGNsaWVudC5kaXNjb25uZWN0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy51c2VyVG9Tb2NrZXQuc2V0KHVzZXIudXNlcklkLCBjbGllbnQuaWQpO1xuICAgICAgdGhpcy5zb2NrZXRUb1VzZXIuc2V0KGNsaWVudC5pZCwgdXNlci51c2VySWQpO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coYFVzZXIgJHt1c2VyLnVzZXJJZH0gY29ubmVjdGVkIHRvIG1lZXRpbmdzIGdhdGV3YXlgKTtcblxuICAgICAgLy8gU2VuZCB1c2VyIHRoZWlyIGFjdGl2ZSBtZWV0aW5nc1xuICAgICAgYXdhaXQgdGhpcy5zZW5kQWN0aXZlTWVldGluZ3MoY2xpZW50LCB1c2VyLnVzZXJJZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdDb25uZWN0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICBjbGllbnQuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZURpc2Nvbm5lY3QoY2xpZW50OiBTb2NrZXQpIHtcbiAgICBjb25zdCB1c2VySWQgPSB0aGlzLnNvY2tldFRvVXNlci5nZXQoY2xpZW50LmlkKTtcbiAgICBpZiAoIXVzZXJJZCkgcmV0dXJuO1xuXG4gICAgLy8gUmVtb3ZlIHVzZXIgZnJvbSBhbGwgbWVldGluZ3NcbiAgICBmb3IgKGNvbnN0IFttZWV0aW5nSWQsIG1lZXRpbmddIG9mIHRoaXMubWVldGluZ3MuZW50cmllcygpKSB7XG4gICAgICBpZiAobWVldGluZy5wYXJ0aWNpcGFudHMuaGFzKHVzZXJJZCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sZWF2ZU1lZXRpbmcoY2xpZW50LCB7IG1lZXRpbmdJZCB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnVzZXJUb1NvY2tldC5kZWxldGUodXNlcklkKTtcbiAgICB0aGlzLnNvY2tldFRvVXNlci5kZWxldGUoY2xpZW50LmlkKTtcblxuICAgIHRoaXMubG9nZ2VyLmxvZyhgVXNlciAke3VzZXJJZH0gZGlzY29ubmVjdGVkIGZyb20gbWVldGluZ3MgZ2F0ZXdheWApO1xuICB9XG5cbiAgQFN1YnNjcmliZU1lc3NhZ2UoJ2pvaW4tbWVldGluZycpXG4gIGFzeW5jIGpvaW5NZWV0aW5nKFxuICAgIEBDb25uZWN0ZWRTb2NrZXQoKSBjbGllbnQ6IFNvY2tldCxcbiAgICBATWVzc2FnZUJvZHkoKSBkYXRhOiBKb2luTWVldGluZ0RhdGEsXG4gICkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHRoaXMuc29ja2V0VG9Vc2VyLmdldChjbGllbnQuaWQpO1xuICAgIGlmICghdXNlcklkKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgLy8gVmFsaWRhdGUgbWVldGluZyBleGlzdHMgYW5kIHVzZXIgaGFzIGFjY2Vzc1xuICAgICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogZGF0YS5tZWV0aW5nSWQsXG4gICAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgICAgIHN0YXR1czogeyBpbjogWydTQ0hFRFVMRUQnLCAnQ09ORklSTUVEJywgJ0lOX1BST0dSRVNTJ10gfSxcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGNsaWVudDoge1xuICAgICAgICAgICAgaW5jbHVkZTogeyB1c2VyOiB0cnVlIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFtZWV0aW5nKSB7XG4gICAgICAgIGNsaWVudC5lbWl0KCdtZWV0aW5nLWVycm9yJywge1xuICAgICAgICAgIGVycm9yOiAnTWVldGluZyBub3QgZm91bmQgb3IgYWNjZXNzIGRlbmllZCcsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIERldGVybWluZSB1c2VyIHJvbGVcbiAgICAgIGNvbnN0IHJvbGUgPSBtZWV0aW5nLnRoZXJhcGlzdElkID09PSB1c2VySWQgPyAndGhlcmFwaXN0JyA6ICdjbGllbnQnO1xuXG4gICAgICAvLyBDcmVhdGUgb3IgZ2V0IG1lZXRpbmcgcm9vbVxuICAgICAgbGV0IG1lZXRpbmdSb29tID0gdGhpcy5tZWV0aW5ncy5nZXQoZGF0YS5tZWV0aW5nSWQpO1xuICAgICAgaWYgKCFtZWV0aW5nUm9vbSkge1xuICAgICAgICBtZWV0aW5nUm9vbSA9IHtcbiAgICAgICAgICBtZWV0aW5nSWQ6IGRhdGEubWVldGluZ0lkLFxuICAgICAgICAgIHBhcnRpY2lwYW50czogbmV3IE1hcCgpLFxuICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICBzdGF0dXM6ICd3YWl0aW5nJyxcbiAgICAgICAgICBob3N0SWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsIC8vIFRoZXJhcGlzdCBpcyB0eXBpY2FsbHkgdGhlIGhvc3RcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5tZWV0aW5ncy5zZXQoZGF0YS5tZWV0aW5nSWQsIG1lZXRpbmdSb29tKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIHBhcnRpY2lwYW50XG4gICAgICBjb25zdCBwYXJ0aWNpcGFudDogUGFydGljaXBhbnRJbmZvID0ge1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIHNvY2tldElkOiBjbGllbnQuaWQsXG4gICAgICAgIHJvbGUsXG4gICAgICAgIGpvaW5lZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBpc1JlYWR5OiBmYWxzZSxcbiAgICAgICAgbWVkaWFTdGF0dXM6IHtcbiAgICAgICAgICB2aWRlbzogZGF0YS5tZWRpYVByZWZlcmVuY2VzPy52aWRlbyA/PyBmYWxzZSxcbiAgICAgICAgICBhdWRpbzogZGF0YS5tZWRpYVByZWZlcmVuY2VzPy5hdWRpbyA/PyB0cnVlLFxuICAgICAgICAgIHNjcmVlbjogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBtZWV0aW5nUm9vbS5wYXJ0aWNpcGFudHMuc2V0KHVzZXJJZCwgcGFydGljaXBhbnQpO1xuXG4gICAgICAvLyBKb2luIHNvY2tldCByb29tXG4gICAgICB2b2lkIGNsaWVudC5qb2luKGRhdGEubWVldGluZ0lkKTtcblxuICAgICAgLy8gTm90aWZ5IG90aGVyIHBhcnRpY2lwYW50c1xuICAgICAgdm9pZCBjbGllbnQudG8oZGF0YS5tZWV0aW5nSWQpLmVtaXQoJ3BhcnRpY2lwYW50LWpvaW5lZCcsIHtcbiAgICAgICAgcGFydGljaXBhbnQ6IHtcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgcm9sZSxcbiAgICAgICAgICBtZWRpYVN0YXR1czogcGFydGljaXBhbnQubWVkaWFTdGF0dXMsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gU2VuZCBjdXJyZW50IG1lZXRpbmcgc3RhdGUgdG8gam9pbmluZyB1c2VyXG4gICAgICBjbGllbnQuZW1pdCgnbWVldGluZy1qb2luZWQnLCB7XG4gICAgICAgIG1lZXRpbmdJZDogZGF0YS5tZWV0aW5nSWQsXG4gICAgICAgIG1lZXRpbmc6IHtcbiAgICAgICAgICBpZDogbWVldGluZy5pZCxcbiAgICAgICAgICB0aXRsZTogbWVldGluZy50aXRsZSxcbiAgICAgICAgICBzdGFydFRpbWU6IG1lZXRpbmcuc3RhcnRUaW1lLFxuICAgICAgICAgIGR1cmF0aW9uOiBtZWV0aW5nLmR1cmF0aW9uLFxuICAgICAgICAgIHN0YXR1czogbWVldGluZ1Jvb20uc3RhdHVzLFxuICAgICAgICB9LFxuICAgICAgICBwYXJ0aWNpcGFudHM6IEFycmF5LmZyb20obWVldGluZ1Jvb20ucGFydGljaXBhbnRzLnZhbHVlcygpKS5tYXAoXG4gICAgICAgICAgKHApID0+ICh7XG4gICAgICAgICAgICB1c2VySWQ6IHAudXNlcklkLFxuICAgICAgICAgICAgcm9sZTogcC5yb2xlLFxuICAgICAgICAgICAgbWVkaWFTdGF0dXM6IHAubWVkaWFTdGF0dXMsXG4gICAgICAgICAgICBpc1JlYWR5OiBwLmlzUmVhZHksXG4gICAgICAgICAgfSksXG4gICAgICAgICksXG4gICAgICAgIGlzSG9zdDogdXNlcklkID09PSBtZWV0aW5nUm9vbS5ob3N0SWQsXG4gICAgICB9KTtcblxuICAgICAgLy8gVXBkYXRlIG1lZXRpbmcgc3RhdHVzIGlmIGZpcnN0IHBhcnRpY2lwYW50XG4gICAgICBpZiAobWVldGluZ1Jvb20ucGFydGljaXBhbnRzLnNpemUgPT09IDEpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBkYXRhLm1lZXRpbmdJZCB9LFxuICAgICAgICAgIGRhdGE6IHsgc3RhdHVzOiAnSU5fUFJPR1JFU1MnIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coYFVzZXIgJHt1c2VySWR9IGpvaW5lZCBtZWV0aW5nICR7ZGF0YS5tZWV0aW5nSWR9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gam9pbiBtZWV0aW5nOicsIGVycm9yKTtcbiAgICAgIGNsaWVudC5lbWl0KCdtZWV0aW5nLWVycm9yJywge1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBqb2luIG1lZXRpbmcnLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgQFN1YnNjcmliZU1lc3NhZ2UoJ2xlYXZlLW1lZXRpbmcnKVxuICBhc3luYyBsZWF2ZU1lZXRpbmcoXG4gICAgQENvbm5lY3RlZFNvY2tldCgpIGNsaWVudDogU29ja2V0LFxuICAgIEBNZXNzYWdlQm9keSgpIGRhdGE6IHsgbWVldGluZ0lkOiBzdHJpbmcgfSxcbiAgKSB7XG4gICAgY29uc3QgdXNlcklkID0gdGhpcy5zb2NrZXRUb1VzZXIuZ2V0KGNsaWVudC5pZCk7XG4gICAgaWYgKCF1c2VySWQpIHJldHVybjtcblxuICAgIGNvbnN0IG1lZXRpbmdSb29tID0gdGhpcy5tZWV0aW5ncy5nZXQoZGF0YS5tZWV0aW5nSWQpO1xuICAgIGlmICghbWVldGluZ1Jvb20pIHJldHVybjtcblxuICAgIC8vIFJlbW92ZSBwYXJ0aWNpcGFudFxuICAgIG1lZXRpbmdSb29tLnBhcnRpY2lwYW50cy5kZWxldGUodXNlcklkKTtcbiAgICB2b2lkIGNsaWVudC5sZWF2ZShkYXRhLm1lZXRpbmdJZCk7XG5cbiAgICAvLyBOb3RpZnkgb3RoZXIgcGFydGljaXBhbnRzXG4gICAgdm9pZCBjbGllbnQudG8oZGF0YS5tZWV0aW5nSWQpLmVtaXQoJ3BhcnRpY2lwYW50LWxlZnQnLCB7XG4gICAgICB1c2VySWQsXG4gICAgfSk7XG5cbiAgICAvLyBJZiBubyBwYXJ0aWNpcGFudHMgbGVmdCwgZW5kIG1lZXRpbmdcbiAgICBpZiAobWVldGluZ1Jvb20ucGFydGljaXBhbnRzLnNpemUgPT09IDApIHtcbiAgICAgIGF3YWl0IHRoaXMuZW5kTWVldGluZyhkYXRhLm1lZXRpbmdJZCk7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBVc2VyICR7dXNlcklkfSBsZWZ0IG1lZXRpbmcgJHtkYXRhLm1lZXRpbmdJZH1gKTtcbiAgfVxuXG4gIEBTdWJzY3JpYmVNZXNzYWdlKCd0b2dnbGUtbWVkaWEnKVxuICBhc3luYyB0b2dnbGVNZWRpYShcbiAgICBAQ29ubmVjdGVkU29ja2V0KCkgY2xpZW50OiBTb2NrZXQsXG4gICAgQE1lc3NhZ2VCb2R5KCkgZGF0YTogTWVkaWFUb2dnbGVEYXRhLFxuICApIHtcbiAgICBjb25zdCB1c2VySWQgPSB0aGlzLnNvY2tldFRvVXNlci5nZXQoY2xpZW50LmlkKTtcbiAgICBpZiAoIXVzZXJJZCkgcmV0dXJuO1xuXG4gICAgY29uc3QgbWVldGluZ1Jvb20gPSB0aGlzLm1lZXRpbmdzLmdldChkYXRhLm1lZXRpbmdJZCk7XG4gICAgaWYgKCFtZWV0aW5nUm9vbSkgcmV0dXJuO1xuXG4gICAgY29uc3QgcGFydGljaXBhbnQgPSBtZWV0aW5nUm9vbS5wYXJ0aWNpcGFudHMuZ2V0KHVzZXJJZCk7XG4gICAgaWYgKCFwYXJ0aWNpcGFudCkgcmV0dXJuO1xuXG4gICAgLy8gVXBkYXRlIG1lZGlhIHN0YXR1c1xuICAgIHBhcnRpY2lwYW50Lm1lZGlhU3RhdHVzW2RhdGEubWVkaWFUeXBlXSA9IGRhdGEuZW5hYmxlZDtcblxuICAgIC8vIE5vdGlmeSBvdGhlciBwYXJ0aWNpcGFudHNcbiAgICBjbGllbnQudG8oZGF0YS5tZWV0aW5nSWQpLmVtaXQoJ3BhcnRpY2lwYW50LW1lZGlhLWNoYW5nZWQnLCB7XG4gICAgICB1c2VySWQsXG4gICAgICBtZWRpYVR5cGU6IGRhdGEubWVkaWFUeXBlLFxuICAgICAgZW5hYmxlZDogZGF0YS5lbmFibGVkLFxuICAgIH0pO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFVzZXIgJHt1c2VySWR9IHRvZ2dsZWQgJHtkYXRhLm1lZGlhVHlwZX0gdG8gJHtkYXRhLmVuYWJsZWR9IGluIG1lZXRpbmcgJHtkYXRhLm1lZXRpbmdJZH1gLFxuICAgICk7XG4gIH1cblxuICBAU3Vic2NyaWJlTWVzc2FnZSgncGFydGljaXBhbnQtcmVhZHknKVxuICBhc3luYyBwYXJ0aWNpcGFudFJlYWR5KFxuICAgIEBDb25uZWN0ZWRTb2NrZXQoKSBjbGllbnQ6IFNvY2tldCxcbiAgICBATWVzc2FnZUJvZHkoKSBkYXRhOiB7IG1lZXRpbmdJZDogc3RyaW5nIH0sXG4gICkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHRoaXMuc29ja2V0VG9Vc2VyLmdldChjbGllbnQuaWQpO1xuICAgIGlmICghdXNlcklkKSByZXR1cm47XG5cbiAgICBjb25zdCBtZWV0aW5nUm9vbSA9IHRoaXMubWVldGluZ3MuZ2V0KGRhdGEubWVldGluZ0lkKTtcbiAgICBpZiAoIW1lZXRpbmdSb29tKSByZXR1cm47XG5cbiAgICBjb25zdCBwYXJ0aWNpcGFudCA9IG1lZXRpbmdSb29tLnBhcnRpY2lwYW50cy5nZXQodXNlcklkKTtcbiAgICBpZiAoIXBhcnRpY2lwYW50KSByZXR1cm47XG5cbiAgICBwYXJ0aWNpcGFudC5pc1JlYWR5ID0gdHJ1ZTtcblxuICAgIC8vIE5vdGlmeSBvdGhlciBwYXJ0aWNpcGFudHNcbiAgICBjbGllbnQudG8oZGF0YS5tZWV0aW5nSWQpLmVtaXQoJ3BhcnRpY2lwYW50LXJlYWR5Jywge1xuICAgICAgdXNlcklkLFxuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgaWYgYWxsIHBhcnRpY2lwYW50cyBhcmUgcmVhZHlcbiAgICBjb25zdCBhbGxSZWFkeSA9IEFycmF5LmZyb20obWVldGluZ1Jvb20ucGFydGljaXBhbnRzLnZhbHVlcygpKS5ldmVyeShcbiAgICAgIChwKSA9PiBwLmlzUmVhZHksXG4gICAgKTtcblxuICAgIGlmIChhbGxSZWFkeSAmJiBtZWV0aW5nUm9vbS5zdGF0dXMgPT09ICd3YWl0aW5nJykge1xuICAgICAgbWVldGluZ1Jvb20uc3RhdHVzID0gJ2FjdGl2ZSc7XG4gICAgICB0aGlzLnNlcnZlci50byhkYXRhLm1lZXRpbmdJZCkuZW1pdCgnbWVldGluZy1zdGFydGVkJywge1xuICAgICAgICBtZWV0aW5nSWQ6IGRhdGEubWVldGluZ0lkLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgQFN1YnNjcmliZU1lc3NhZ2UoJ2NoYXQtbWVzc2FnZScpXG4gIGFzeW5jIHNlbmRDaGF0TWVzc2FnZShcbiAgICBAQ29ubmVjdGVkU29ja2V0KCkgY2xpZW50OiBTb2NrZXQsXG4gICAgQE1lc3NhZ2VCb2R5KCkgZGF0YTogQ2hhdE1lc3NhZ2VEYXRhLFxuICApIHtcbiAgICBjb25zdCB1c2VySWQgPSB0aGlzLnNvY2tldFRvVXNlci5nZXQoY2xpZW50LmlkKTtcbiAgICBpZiAoIXVzZXJJZCkgcmV0dXJuO1xuXG4gICAgY29uc3QgbWVldGluZ1Jvb20gPSB0aGlzLm1lZXRpbmdzLmdldChkYXRhLm1lZXRpbmdJZCk7XG4gICAgaWYgKCFtZWV0aW5nUm9vbSB8fCAhbWVldGluZ1Jvb20ucGFydGljaXBhbnRzLmhhcyh1c2VySWQpKSByZXR1cm47XG5cbiAgICBjb25zdCBwYXJ0aWNpcGFudCA9IG1lZXRpbmdSb29tLnBhcnRpY2lwYW50cy5nZXQodXNlcklkKTtcbiAgICBpZiAoIXBhcnRpY2lwYW50KSByZXR1cm47XG5cbiAgICAvLyBCcm9hZGNhc3QgbWVzc2FnZSB0byBhbGwgcGFydGljaXBhbnRzXG4gICAgdGhpcy5zZXJ2ZXIudG8oZGF0YS5tZWV0aW5nSWQpLmVtaXQoJ2NoYXQtbWVzc2FnZScsIHtcbiAgICAgIHNlbmRlcklkOiB1c2VySWQsXG4gICAgICBzZW5kZXJSb2xlOiBwYXJ0aWNpcGFudC5yb2xlLFxuICAgICAgbWVzc2FnZTogZGF0YS5tZXNzYWdlLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgIH0pO1xuICB9XG5cbiAgQFN1YnNjcmliZU1lc3NhZ2UoJ21lZXRpbmctY29udHJvbCcpXG4gIGFzeW5jIG1lZXRpbmdDb250cm9sKFxuICAgIEBDb25uZWN0ZWRTb2NrZXQoKSBjbGllbnQ6IFNvY2tldCxcbiAgICBATWVzc2FnZUJvZHkoKSBkYXRhOiBNZWV0aW5nQ29udHJvbERhdGEsXG4gICkge1xuICAgIGNvbnN0IHVzZXJJZCA9IHRoaXMuc29ja2V0VG9Vc2VyLmdldChjbGllbnQuaWQpO1xuICAgIGlmICghdXNlcklkKSByZXR1cm47XG5cbiAgICBjb25zdCBtZWV0aW5nUm9vbSA9IHRoaXMubWVldGluZ3MuZ2V0KGRhdGEubWVldGluZ0lkKTtcbiAgICBpZiAoIW1lZXRpbmdSb29tKSByZXR1cm47XG5cbiAgICAvLyBPbmx5IGhvc3QgY2FuIGNvbnRyb2wgbWVldGluZ1xuICAgIGlmICh1c2VySWQgIT09IG1lZXRpbmdSb29tLmhvc3RJZCkge1xuICAgICAgY2xpZW50LmVtaXQoJ21lZXRpbmctZXJyb3InLCB7XG4gICAgICAgIGVycm9yOiAnT25seSB0aGUgaG9zdCBjYW4gY29udHJvbCB0aGUgbWVldGluZycsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKGRhdGEuYWN0aW9uKSB7XG4gICAgICBjYXNlICdzdGFydCc6XG4gICAgICAgIG1lZXRpbmdSb29tLnN0YXR1cyA9ICdhY3RpdmUnO1xuICAgICAgICB0aGlzLnNlcnZlci50byhkYXRhLm1lZXRpbmdJZCkuZW1pdCgnbWVldGluZy1zdGFydGVkJywge1xuICAgICAgICAgIG1lZXRpbmdJZDogZGF0YS5tZWV0aW5nSWQsXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnZW5kJzpcbiAgICAgICAgYXdhaXQgdGhpcy5lbmRNZWV0aW5nKGRhdGEubWVldGluZ0lkKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3JlY29yZCc6XG4gICAgICAgIC8vIFJlY29yZGluZyBmdW5jdGlvbmFsaXR5IHdvdWxkIGJlIGltcGxlbWVudGVkIGhlcmVcbiAgICAgICAgdGhpcy5zZXJ2ZXIudG8oZGF0YS5tZWV0aW5nSWQpLmVtaXQoJ3JlY29yZGluZy1zdGFydGVkJywge1xuICAgICAgICAgIG1lZXRpbmdJZDogZGF0YS5tZWV0aW5nSWQsXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBAU3Vic2NyaWJlTWVzc2FnZSgnd2VicnRjLXNpZ25hbCcpXG4gIGFzeW5jIGhhbmRsZVdlYlJUQ1NpZ25hbChcbiAgICBAQ29ubmVjdGVkU29ja2V0KCkgY2xpZW50OiBTb2NrZXQsXG4gICAgQE1lc3NhZ2VCb2R5KClcbiAgICBkYXRhOiB7XG4gICAgICBtZWV0aW5nSWQ6IHN0cmluZztcbiAgICAgIHRhcmdldFVzZXJJZDogc3RyaW5nO1xuICAgICAgc2lnbmFsOiBhbnk7XG4gICAgICB0eXBlOiAnb2ZmZXInIHwgJ2Fuc3dlcicgfCAnaWNlLWNhbmRpZGF0ZSc7XG4gICAgfSxcbiAgKSB7XG4gICAgY29uc3QgdXNlcklkID0gdGhpcy5zb2NrZXRUb1VzZXIuZ2V0KGNsaWVudC5pZCk7XG4gICAgaWYgKCF1c2VySWQpIHJldHVybjtcblxuICAgIGNvbnN0IHRhcmdldFNvY2tldElkID0gdGhpcy51c2VyVG9Tb2NrZXQuZ2V0KGRhdGEudGFyZ2V0VXNlcklkKTtcbiAgICBpZiAoIXRhcmdldFNvY2tldElkKSByZXR1cm47XG5cbiAgICAvLyBGb3J3YXJkIFdlYlJUQyBzaWduYWwgdG8gdGFyZ2V0IHVzZXJcbiAgICB0aGlzLnNlcnZlci50byh0YXJnZXRTb2NrZXRJZCkuZW1pdCgnd2VicnRjLXNpZ25hbCcsIHtcbiAgICAgIGZyb21Vc2VySWQ6IHVzZXJJZCxcbiAgICAgIHNpZ25hbDogZGF0YS5zaWduYWwsXG4gICAgICB0eXBlOiBkYXRhLnR5cGUsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVuZE1lZXRpbmcobWVldGluZ0lkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBtZWV0aW5nUm9vbSA9IHRoaXMubWVldGluZ3MuZ2V0KG1lZXRpbmdJZCk7XG4gICAgaWYgKCFtZWV0aW5nUm9vbSkgcmV0dXJuO1xuXG4gICAgbWVldGluZ1Jvb20uc3RhdHVzID0gJ2VuZGVkJztcblxuICAgIC8vIE5vdGlmeSBhbGwgcGFydGljaXBhbnRzXG4gICAgdGhpcy5zZXJ2ZXIudG8obWVldGluZ0lkKS5lbWl0KCdtZWV0aW5nLWVuZGVkJywge1xuICAgICAgbWVldGluZ0lkLFxuICAgICAgZW5kVGltZTogbmV3IERhdGUoKSxcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSBkYXRhYmFzZVxuICAgIGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBtZWV0aW5nSWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICAgICAgLy8gQWRkIGVuZCB0aW1lIG9yIGFjdHVhbCBkdXJhdGlvbiBpZiBuZWVkZWRcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBSZW1vdmUgYWxsIHBhcnRpY2lwYW50cyBmcm9tIHJvb21cbiAgICBmb3IgKGNvbnN0IHBhcnRpY2lwYW50IG9mIG1lZXRpbmdSb29tLnBhcnRpY2lwYW50cy52YWx1ZXMoKSkge1xuICAgICAgY29uc3Qgc29ja2V0ID0gdGhpcy5zZXJ2ZXIuc29ja2V0cy5zb2NrZXRzLmdldChwYXJ0aWNpcGFudC5zb2NrZXRJZCk7XG4gICAgICB2b2lkIHNvY2tldD8ubGVhdmUobWVldGluZ0lkKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhbiB1cCBtZWV0aW5nIHJvb21cbiAgICB0aGlzLm1lZXRpbmdzLmRlbGV0ZShtZWV0aW5nSWQpO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBNZWV0aW5nICR7bWVldGluZ0lkfSBlbmRlZGApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzZW5kQWN0aXZlTWVldGluZ3MoY2xpZW50OiBTb2NrZXQsIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFjdGl2ZU1lZXRpbmdzID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgICAgIHN0YXR1czogeyBpbjogWydTQ0hFRFVMRUQnLCAnQ09ORklSTUVEJywgJ0lOX1BST0dSRVNTJ10gfSxcbiAgICAgICAgICBzdGFydFRpbWU6IHtcbiAgICAgICAgICAgIGd0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyBMYXN0IDI0IGhvdXJzXG4gICAgICAgICAgICBsdGU6IG5ldyBEYXRlKERhdGUubm93KCkgKyA2MCAqIDYwICogMTAwMCksIC8vIE5leHQgMSBob3VyXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGNsaWVudDoge1xuICAgICAgICAgICAgaW5jbHVkZTogeyB1c2VyOiB7IHNlbGVjdDogeyBmaXJzdE5hbWU6IHRydWUsIGxhc3ROYW1lOiB0cnVlIH0gfSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7IHVzZXI6IHsgc2VsZWN0OiB7IGZpcnN0TmFtZTogdHJ1ZSwgbGFzdE5hbWU6IHRydWUgfSB9IH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjbGllbnQuZW1pdCgnYWN0aXZlLW1lZXRpbmdzJywge1xuICAgICAgICBtZWV0aW5nczogYWN0aXZlTWVldGluZ3MubWFwKChtZWV0aW5nKSA9PiAoe1xuICAgICAgICAgIGlkOiBtZWV0aW5nLmlkLFxuICAgICAgICAgIHRpdGxlOiBtZWV0aW5nLnRpdGxlLFxuICAgICAgICAgIHN0YXJ0VGltZTogbWVldGluZy5zdGFydFRpbWUsXG4gICAgICAgICAgZHVyYXRpb246IG1lZXRpbmcuZHVyYXRpb24sXG4gICAgICAgICAgc3RhdHVzOiBtZWV0aW5nLnN0YXR1cyxcbiAgICAgICAgICBpc0FjdGl2ZTogdGhpcy5tZWV0aW5ncy5oYXMobWVldGluZy5pZCksXG4gICAgICAgICAgcGFydGljaXBhbnRDb3VudDpcbiAgICAgICAgICAgIHRoaXMubWVldGluZ3MuZ2V0KG1lZXRpbmcuaWQpPy5wYXJ0aWNpcGFudHMuc2l6ZSB8fCAwLFxuICAgICAgICB9KSksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIGFjdGl2ZSBtZWV0aW5nczonLCBlcnJvcik7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=