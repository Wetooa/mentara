8ceb7c479eda48eb4ce0387681845908
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SearchController = void 0;
const common_1 = require("@nestjs/common");
const search_service_1 = require("./search.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const zod_validation_pipe_1 = require("../common/pipes/zod-validation.pipe");
const swagger_1 = require("@nestjs/swagger");
const mentara_commons_1 = require("mentara-commons");
let SearchController = class SearchController {
    searchService;
    constructor(searchService) {
        this.searchService = searchService;
    }
    searchTherapists(query) {
        return this.searchService.searchTherapists(query.query || '', {
            location: query.location,
            specialties: query.specialties,
            priceRange: query.priceRange,
            experienceYears: query.experienceYears,
            rating: query.rating,
            gender: query.gender,
            languages: query.languages,
            availability: query.availability,
            verifiedOnly: query.verifiedOnly,
            // Map maxHourlyRate from priceRange.max for backward compatibility
            maxHourlyRate: query.priceRange?.max,
        });
    }
    searchPosts(query) {
        return this.searchService.searchPosts(query.query, query.communityId);
    }
    searchCommunities(query) {
        return this.searchService.searchCommunities(query.query);
    }
    searchUsers(query) {
        return this.searchService.searchUsers(query.query, query.role);
    }
    globalSearch(query) {
        // Filter out unsupported types like 'worksheets'
        const supportedTypes = query.types?.filter((type) => ['users', 'therapists', 'posts', 'communities'].includes(type));
        return this.searchService.globalSearch(query.query, supportedTypes);
    }
};
exports.SearchController = SearchController;
__decorate([
    (0, common_1.Get)('therapists'),
    (0, swagger_1.ApiOperation)({
        summary: 'Search therapists',
        description: 'Search for therapists with advanced filtering options including location, specialties, price range, and more',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'query',
        required: false,
        description: 'Search query string',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'location',
        required: false,
        description: 'Filter by location',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'specialties',
        required: false,
        description: 'Filter by specializations (comma-separated)',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'priceRange',
        required: false,
        description: 'Price range filter',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'experienceYears',
        required: false,
        description: 'Minimum years of experience',
    }),
    (0, swagger_1.ApiQuery)({ name: 'rating', required: false, description: 'Minimum rating' }),
    (0, swagger_1.ApiQuery)({
        name: 'gender',
        required: false,
        description: 'Filter by gender',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'languages',
        required: false,
        description: 'Filter by languages spoken',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'availability',
        required: false,
        description: 'Filter by availability',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'verifiedOnly',
        required: false,
        description: 'Show only verified therapists',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Therapists found successfully',
        schema: {
            type: 'object',
            properties: {
                therapists: {
                    type: 'array',
                    items: {
                        type: 'object',
                        properties: {
                            id: { type: 'string' },
                            firstName: { type: 'string' },
                            lastName: { type: 'string' },
                            specializations: { type: 'array', items: { type: 'string' } },
                            location: { type: 'string' },
                            hourlyRate: { type: 'number' },
                            rating: { type: 'number' },
                            experienceYears: { type: 'number' },
                            verified: { type: 'boolean' },
                        },
                    },
                },
                totalCount: { type: 'number' },
                filters: { type: 'object' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.SearchTherapistsQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], SearchController.prototype, "searchTherapists", null);
__decorate([
    (0, common_1.Get)('posts'),
    (0, swagger_1.ApiOperation)({
        summary: 'Search posts',
        description: 'Search for posts within communities with optional community filtering',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'query',
        required: true,
        description: 'Search query string',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'communityId',
        required: false,
        description: 'Filter by specific community ID',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Posts found successfully',
        schema: {
            type: 'object',
            properties: {
                posts: {
                    type: 'array',
                    items: {
                        type: 'object',
                        properties: {
                            id: { type: 'string' },
                            title: { type: 'string' },
                            content: { type: 'string' },
                            authorId: { type: 'string' },
                            communityId: { type: 'string' },
                            createdAt: { type: 'string', format: 'date-time' },
                            likesCount: { type: 'number' },
                            commentsCount: { type: 'number' },
                        },
                    },
                },
                totalCount: { type: 'number' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.SearchPostsQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], SearchController.prototype, "searchPosts", null);
__decorate([
    (0, common_1.Get)('communities'),
    (0, swagger_1.ApiOperation)({
        summary: 'Search communities',
        description: 'Search for communities by name or description',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'query',
        required: true,
        description: 'Search query string',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Communities found successfully',
        schema: {
            type: 'object',
            properties: {
                communities: {
                    type: 'array',
                    items: {
                        type: 'object',
                        properties: {
                            id: { type: 'string' },
                            name: { type: 'string' },
                            description: { type: 'string' },
                            memberCount: { type: 'number' },
                            isPrivate: { type: 'boolean' },
                            createdAt: { type: 'string', format: 'date-time' },
                        },
                    },
                },
                totalCount: { type: 'number' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.SearchCommunitiesQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], SearchController.prototype, "searchCommunities", null);
__decorate([
    (0, common_1.Get)('users'),
    (0, swagger_1.ApiOperation)({
        summary: 'Search users',
        description: 'Search for users by name or email with optional role filtering',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'query',
        required: true,
        description: 'Search query string',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'role',
        required: false,
        description: 'Filter by user role (client, therapist, admin, moderator)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Users found successfully',
        schema: {
            type: 'object',
            properties: {
                users: {
                    type: 'array',
                    items: {
                        type: 'object',
                        properties: {
                            id: { type: 'string' },
                            firstName: { type: 'string' },
                            lastName: { type: 'string' },
                            email: { type: 'string' },
                            role: { type: 'string' },
                            isActive: { type: 'boolean' },
                            createdAt: { type: 'string', format: 'date-time' },
                        },
                    },
                },
                totalCount: { type: 'number' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.SearchUsersQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], SearchController.prototype, "searchUsers", null);
__decorate([
    (0, common_1.Get)('global'),
    (0, swagger_1.ApiOperation)({
        summary: 'Global search',
        description: 'Search across multiple entity types (users, therapists, posts, communities) in a single query',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'query',
        required: true,
        description: 'Search query string',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'types',
        required: false,
        description: 'Entity types to search (users, therapists, posts, communities)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Global search results',
        schema: {
            type: 'object',
            properties: {
                results: {
                    type: 'object',
                    properties: {
                        users: {
                            type: 'array',
                            items: { type: 'object' },
                        },
                        therapists: {
                            type: 'array',
                            items: { type: 'object' },
                        },
                        posts: {
                            type: 'array',
                            items: { type: 'object' },
                        },
                        communities: {
                            type: 'array',
                            items: { type: 'object' },
                        },
                    },
                },
                totalCount: { type: 'number' },
                query: { type: 'string' },
                searchTypes: { type: 'array', items: { type: 'string' } },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.GlobalSearchQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", void 0)
], SearchController.prototype, "globalSearch", null);
exports.SearchController = SearchController = __decorate([
    (0, swagger_1.ApiTags)('search'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('search'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof search_service_1.SearchService !== "undefined" && search_service_1.SearchService) === "function" ? _a : Object])
], SearchController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3NlYXJjaC9zZWFyY2guY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQW1FO0FBQ25FLHFEQUFpRDtBQUNqRCxrRUFBNkQ7QUFDN0QsNkVBQXdFO0FBQ3hFLDZDQVF5QjtBQUN6QixxREFXeUI7QUFNbEIsSUFBTSxnQkFBZ0IsR0FBdEIsTUFBTSxnQkFBZ0I7SUFDRTtJQUE3QixZQUE2QixhQUE0QjtRQUE1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtJQUFHLENBQUM7SUFtRjdELGdCQUFnQixDQUVkLEtBQStCO1FBRS9CLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUUsRUFBRTtZQUM1RCxRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7WUFDeEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO1lBQzlCLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtZQUM1QixlQUFlLEVBQUUsS0FBSyxDQUFDLGVBQWU7WUFDdEMsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO1lBQ3BCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtZQUNwQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDMUIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZO1lBQ2hDLFlBQVksRUFBRSxLQUFLLENBQUMsWUFBWTtZQUNoQyxtRUFBbUU7WUFDbkUsYUFBYSxFQUFFLEtBQUssQ0FBQyxVQUFVLEVBQUUsR0FBRztTQUNyQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBNkNELFdBQVcsQ0FFVCxLQUEwQjtRQUUxQixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7SUFxQ0QsaUJBQWlCLENBRWYsS0FBZ0M7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QUMxQjtxQkFDRjtpQkFDRjtnQkFDRCxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO2dCQUM5QixLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO2dCQUN6QixXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRTthQUMxRDtTQUNGO0tBQ0YsQ0FBQztJQUNELElBQUEscUJBQVcsRUFBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxDQUFDO0lBRXZELFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSx1Q0FBaUIsQ0FBQyw0Q0FBMEIsQ0FBQyxDQUFDLENBQUE7Ozs7b0RBUzFEOzJCQWpUVSxnQkFBZ0I7SUFKNUIsSUFBQSxpQkFBTyxFQUFDLFFBQVEsQ0FBQztJQUNqQixJQUFBLHVCQUFhLEVBQUMsVUFBVSxDQUFDO0lBQ3pCLElBQUEsbUJBQVUsRUFBQyxRQUFRLENBQUM7SUFDcEIsSUFBQSxrQkFBUyxFQUFDLDZCQUFZLENBQUM7eURBRXNCLDhCQUFhLG9CQUFiLDhCQUFhO0dBRDlDLGdCQUFnQixDQWtUNUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3NlYXJjaC9zZWFyY2guY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb250cm9sbGVyLCBHZXQsIFF1ZXJ5LCBVc2VHdWFyZHMgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBTZWFyY2hTZXJ2aWNlIH0gZnJvbSAnLi9zZWFyY2guc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBab2RWYWxpZGF0aW9uUGlwZSB9IGZyb20gJy4uL2NvbW1vbi9waXBlcy96b2QtdmFsaWRhdGlvbi5waXBlJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJvZHksXG4gIEFwaUJlYXJlckF1dGgsXG4gIEFwaVBhcmFtLFxuICBBcGlRdWVyeSxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7XG4gIFNlYXJjaFRoZXJhcGlzdHNRdWVyeUR0b1NjaGVtYSxcbiAgU2VhcmNoUG9zdHNRdWVyeUR0b1NjaGVtYSxcbiAgU2VhcmNoQ29tbXVuaXRpZXNRdWVyeUR0b1NjaGVtYSxcbiAgU2VhcmNoVXNlcnNRdWVyeUR0b1NjaGVtYSxcbiAgR2xvYmFsU2VhcmNoUXVlcnlEdG9TY2hlbWEsXG4gIHR5cGUgU2VhcmNoVGhlcmFwaXN0c1F1ZXJ5RHRvLFxuICB0eXBlIFNlYXJjaFBvc3RzUXVlcnlEdG8sXG4gIHR5cGUgU2VhcmNoQ29tbXVuaXRpZXNRdWVyeUR0byxcbiAgdHlwZSBTZWFyY2hVc2Vyc1F1ZXJ5RHRvLFxuICB0eXBlIEdsb2JhbFNlYXJjaFF1ZXJ5RHRvLFxufSBmcm9tICdtZW50YXJhLWNvbW1vbnMnO1xuXG5AQXBpVGFncygnc2VhcmNoJylcbkBBcGlCZWFyZXJBdXRoKCdKV1QtYXV0aCcpXG5AQ29udHJvbGxlcignc2VhcmNoJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIFNlYXJjaENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHNlYXJjaFNlcnZpY2U6IFNlYXJjaFNlcnZpY2UpIHt9XG5cbiAgQEdldCgndGhlcmFwaXN0cycpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdTZWFyY2ggdGhlcmFwaXN0cycsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnU2VhcmNoIGZvciB0aGVyYXBpc3RzIHdpdGggYWR2YW5jZWQgZmlsdGVyaW5nIG9wdGlvbnMgaW5jbHVkaW5nIGxvY2F0aW9uLCBzcGVjaWFsdGllcywgcHJpY2UgcmFuZ2UsIGFuZCBtb3JlJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAncXVlcnknLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ1NlYXJjaCBxdWVyeSBzdHJpbmcnLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdsb2NhdGlvbicsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGRlc2NyaXB0aW9uOiAnRmlsdGVyIGJ5IGxvY2F0aW9uJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnc3BlY2lhbHRpZXMnLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ0ZpbHRlciBieSBzcGVjaWFsaXphdGlvbnMgKGNvbW1hLXNlcGFyYXRlZCknLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdwcmljZVJhbmdlJyxcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246ICdQcmljZSByYW5nZSBmaWx0ZXInLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdleHBlcmllbmNlWWVhcnMnLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ01pbmltdW0geWVhcnMgb2YgZXhwZXJpZW5jZScsXG4gIH0pXG4gIEBBcGlRdWVyeSh7IG5hbWU6ICdyYXRpbmcnLCByZXF1aXJlZDogZmFsc2UsIGRlc2NyaXB0aW9uOiAnTWluaW11bSByYXRpbmcnIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ2dlbmRlcicsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGRlc2NyaXB0aW9uOiAnRmlsdGVyIGJ5IGdlbmRlcicsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ2xhbmd1YWdlcycsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGRlc2NyaXB0aW9uOiAnRmlsdGVyIGJ5IGxhbmd1YWdlcyBzcG9rZW4nLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdhdmFpbGFiaWxpdHknLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ0ZpbHRlciBieSBhdmFpbGFiaWxpdHknLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICd2ZXJpZmllZE9ubHknLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ1Nob3cgb25seSB2ZXJpZmllZCB0aGVyYXBpc3RzJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1RoZXJhcGlzdHMgZm91bmQgc3VjY2Vzc2Z1bGx5JyxcbiAgICBzY2hlbWE6IHtcbiAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB0aGVyYXBpc3RzOiB7XG4gICAgICAgICAgdHlwZTogJ2FycmF5JyxcbiAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIGlkOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBsYXN0TmFtZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBzcGVjaWFsaXphdGlvbnM6IHsgdHlwZTogJ2FycmF5JywgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSB9LFxuICAgICAgICAgICAgICBsb2NhdGlvbjogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBob3VybHlSYXRlOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICAgIHJhdGluZzogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgICBleHBlcmllbmNlWWVhcnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgICAgdmVyaWZpZWQ6IHsgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRvdGFsQ291bnQ6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgZmlsdGVyczogeyB0eXBlOiAnb2JqZWN0JyB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIHNlYXJjaFRoZXJhcGlzdHMoXG4gICAgQFF1ZXJ5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShTZWFyY2hUaGVyYXBpc3RzUXVlcnlEdG9TY2hlbWEpKVxuICAgIHF1ZXJ5OiBTZWFyY2hUaGVyYXBpc3RzUXVlcnlEdG8sXG4gICkge1xuICAgIHJldHVybiB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoVGhlcmFwaXN0cyhxdWVyeS5xdWVyeSB8fCAnJywge1xuICAgICAgbG9jYXRpb246IHF1ZXJ5LmxvY2F0aW9uLFxuICAgICAgc3BlY2lhbHRpZXM6IHF1ZXJ5LnNwZWNpYWx0aWVzLFxuICAgICAgcHJpY2VSYW5nZTogcXVlcnkucHJpY2VSYW5nZSxcbiAgICAgIGV4cGVyaWVuY2VZZWFyczogcXVlcnkuZXhwZXJpZW5jZVllYXJzLFxuICAgICAgcmF0aW5nOiBxdWVyeS5yYXRpbmcsXG4gICAgICBnZW5kZXI6IHF1ZXJ5LmdlbmRlcixcbiAgICAgIGxhbmd1YWdlczogcXVlcnkubGFuZ3VhZ2VzLFxuICAgICAgYXZhaWxhYmlsaXR5OiBxdWVyeS5hdmFpbGFiaWxpdHksXG4gICAgICB2ZXJpZmllZE9ubHk6IHF1ZXJ5LnZlcmlmaWVkT25seSxcbiAgICAgIC8vIE1hcCBtYXhIb3VybHlSYXRlIGZyb20gcHJpY2VSYW5nZS5tYXggZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICAgIG1heEhvdXJseVJhdGU6IHF1ZXJ5LnByaWNlUmFuZ2U/Lm1heCxcbiAgICB9KTtcbiAgfVxuXG4gIEBHZXQoJ3Bvc3RzJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ1NlYXJjaCBwb3N0cycsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnU2VhcmNoIGZvciBwb3N0cyB3aXRoaW4gY29tbXVuaXRpZXMgd2l0aCBvcHRpb25hbCBjb21tdW5pdHkgZmlsdGVyaW5nJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAncXVlcnknLFxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiAnU2VhcmNoIHF1ZXJ5IHN0cmluZycsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ2NvbW11bml0eUlkJyxcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246ICdGaWx0ZXIgYnkgc3BlY2lmaWMgY29tbXVuaXR5IElEJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1Bvc3RzIGZvdW5kIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcG9zdHM6IHtcbiAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgIGl0ZW1zOiB7XG4gICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgaWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgdGl0bGU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgY29udGVudDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBhdXRob3JJZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBjb21tdW5pdHlJZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHsgdHlwZTogJ3N0cmluZycsIGZvcm1hdDogJ2RhdGUtdGltZScgfSxcbiAgICAgICAgICAgICAgbGlrZXNDb3VudDogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgICBjb21tZW50c0NvdW50OiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRvdGFsQ291bnQ6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBzZWFyY2hQb3N0cyhcbiAgICBAUXVlcnkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFNlYXJjaFBvc3RzUXVlcnlEdG9TY2hlbWEpKVxuICAgIHF1ZXJ5OiBTZWFyY2hQb3N0c1F1ZXJ5RHRvLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaFBvc3RzKHF1ZXJ5LnF1ZXJ5LCBxdWVyeS5jb21tdW5pdHlJZCk7XG4gIH1cblxuICBAR2V0KCdjb21tdW5pdGllcycpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdTZWFyY2ggY29tbXVuaXRpZXMnLFxuICAgIGRlc2NyaXB0aW9uOiAnU2VhcmNoIGZvciBjb21tdW5pdGllcyBieSBuYW1lIG9yIGRlc2NyaXB0aW9uJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAncXVlcnknLFxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiAnU2VhcmNoIHF1ZXJ5IHN0cmluZycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdDb21tdW5pdGllcyBmb3VuZCBzdWNjZXNzZnVsbHknLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGNvbW11bml0aWVzOiB7XG4gICAgICAgICAgdHlwZTogJ2FycmF5JyxcbiAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIGlkOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgIG5hbWU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgbWVtYmVyQ291bnQ6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgICAgaXNQcml2YXRlOiB7IHR5cGU6ICdib29sZWFuJyB9LFxuICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHsgdHlwZTogJ3N0cmluZycsIGZvcm1hdDogJ2RhdGUtdGltZScgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdG90YWxDb3VudDogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIHNlYXJjaENvbW11bml0aWVzKFxuICAgIEBRdWVyeShuZXcgWm9kVmFsaWRhdGlvblBpcGUoU2VhcmNoQ29tbXVuaXRpZXNRdWVyeUR0b1NjaGVtYSkpXG4gICAgcXVlcnk6IFNlYXJjaENvbW11bml0aWVzUXVlcnlEdG8sXG4gICkge1xuICAgIHJldHVybiB0aGlzLnNlYXJjaFNlcnZpY2Uuc2VhcmNoQ29tbXVuaXRpZXMocXVlcnkucXVlcnkpO1xuICB9XG5cbiAgQEdldCgndXNlcnMnKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnU2VhcmNoIHVzZXJzJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdTZWFyY2ggZm9yIHVzZXJzIGJ5IG5hbWUgb3IgZW1haWwgd2l0aCBvcHRpb25hbCByb2xlIGZpbHRlcmluZycsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ3F1ZXJ5JyxcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogJ1NlYXJjaCBxdWVyeSBzdHJpbmcnLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdyb2xlJyxcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246ICdGaWx0ZXIgYnkgdXNlciByb2xlIChjbGllbnQsIHRoZXJhcGlzdCwgYWRtaW4sIG1vZGVyYXRvciknLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnVXNlcnMgZm91bmQgc3VjY2Vzc2Z1bGx5JyxcbiAgICBzY2hlbWE6IHtcbiAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIHR5cGU6ICdhcnJheScsXG4gICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICBpZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgZW1haWw6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgcm9sZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7IHR5cGU6ICdzdHJpbmcnLCBmb3JtYXQ6ICdkYXRlLXRpbWUnIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRvdGFsQ291bnQ6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBzZWFyY2hVc2VycyhcbiAgICBAUXVlcnkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFNlYXJjaFVzZXJzUXVlcnlEdG9TY2hlbWEpKVxuICAgIHF1ZXJ5OiBTZWFyY2hVc2Vyc1F1ZXJ5RHRvLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaFVzZXJzKHF1ZXJ5LnF1ZXJ5LCBxdWVyeS5yb2xlKTtcbiAgfVxuXG4gIEBHZXQoJ2dsb2JhbCcpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdHbG9iYWwgc2VhcmNoJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdTZWFyY2ggYWNyb3NzIG11bHRpcGxlIGVudGl0eSB0eXBlcyAodXNlcnMsIHRoZXJhcGlzdHMsIHBvc3RzLCBjb21tdW5pdGllcykgaW4gYSBzaW5nbGUgcXVlcnknLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdxdWVyeScsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgZGVzY3JpcHRpb246ICdTZWFyY2ggcXVlcnkgc3RyaW5nJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAndHlwZXMnLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdFbnRpdHkgdHlwZXMgdG8gc2VhcmNoICh1c2VycywgdGhlcmFwaXN0cywgcG9zdHMsIGNvbW11bml0aWVzKScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdHbG9iYWwgc2VhcmNoIHJlc3VsdHMnLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHJlc3VsdHM6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICB1c2Vyczoge1xuICAgICAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgICAgICBpdGVtczogeyB0eXBlOiAnb2JqZWN0JyB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRoZXJhcGlzdHM6IHtcbiAgICAgICAgICAgICAgdHlwZTogJ2FycmF5JyxcbiAgICAgICAgICAgICAgaXRlbXM6IHsgdHlwZTogJ29iamVjdCcgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3N0czoge1xuICAgICAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgICAgICBpdGVtczogeyB0eXBlOiAnb2JqZWN0JyB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbW11bml0aWVzOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdhcnJheScsXG4gICAgICAgICAgICAgIGl0ZW1zOiB7IHR5cGU6ICdvYmplY3QnIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRvdGFsQ291bnQ6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgcXVlcnk6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgc2VhcmNoVHlwZXM6IHsgdHlwZTogJ2FycmF5JywgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIGdsb2JhbFNlYXJjaChcbiAgICBAUXVlcnkobmV3IFpvZFZhbGlkYXRpb25QaXBlKEdsb2JhbFNlYXJjaFF1ZXJ5RHRvU2NoZW1hKSlcbiAgICBxdWVyeTogR2xvYmFsU2VhcmNoUXVlcnlEdG8sXG4gICkge1xuICAgIC8vIEZpbHRlciBvdXQgdW5zdXBwb3J0ZWQgdHlwZXMgbGlrZSAnd29ya3NoZWV0cydcbiAgICBjb25zdCBzdXBwb3J0ZWRUeXBlcyA9IHF1ZXJ5LnR5cGVzPy5maWx0ZXIoKHR5cGUpID0+XG4gICAgICBbJ3VzZXJzJywgJ3RoZXJhcGlzdHMnLCAncG9zdHMnLCAnY29tbXVuaXRpZXMnXS5pbmNsdWRlcyh0eXBlKSxcbiAgICApIGFzICgndXNlcnMnIHwgJ3RoZXJhcGlzdHMnIHwgJ3Bvc3RzJyB8ICdjb21tdW5pdGllcycpW10gfCB1bmRlZmluZWQ7XG5cbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXJ2aWNlLmdsb2JhbFNlYXJjaChxdWVyeS5xdWVyeSwgc3VwcG9ydGVkVHlwZXMpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=