{"version":3,"names":["common_1","cov_1o96hs3opa","s","require","search_service_1","jwt_auth_guard_1","zod_validation_pipe_1","search_schemas_1","SearchController","searchService","constructor","f","searchTherapists","query","b","location","specialties","priceRange","experienceYears","rating","gender","languages","availability","verifiedOnly","maxHourlyRate","max","searchPosts","communityId","searchCommunities","searchUsers","role","globalSearch","req","supportedTypes","types","filter","type","includes","userId","userRole","exports","__decorate","Get","__param","Query","ZodValidationPipe","SearchTherapistsQueryDtoSchema","SearchPostsQueryDtoSchema","SearchCommunitiesQueryDtoSchema","SearchUsersQueryDtoSchema","GlobalSearchQueryDtoSchema","Req","Controller","UseGuards","JwtAuthGuard","SearchService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.controller.ts"],"sourcesContent":["import { Controller, Get, Query, UseGuards, Req } from '@nestjs/common';\nimport { SearchService } from './search.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport {\n  SearchTherapistsQueryDtoSchema,\n  SearchPostsQueryDtoSchema,\n  SearchCommunitiesQueryDtoSchema,\n  SearchUsersQueryDtoSchema,\n  GlobalSearchQueryDtoSchema,\n} from './validation/search.schemas';\nimport type {\n  SearchTherapistsQueryDto,\n  SearchPostsQueryDto,\n  SearchCommunitiesQueryDto,\n  SearchUsersQueryDto,\n  GlobalSearchQueryDto,\n} from './types';\n\n@Controller('search')\n@UseGuards(JwtAuthGuard)\nexport class SearchController {\n  constructor(private readonly searchService: SearchService) {}\n\n  @Get('therapists')\n  searchTherapists(\n    @Query(new ZodValidationPipe(SearchTherapistsQueryDtoSchema))\n    query: SearchTherapistsQueryDto,\n  ) {\n    return this.searchService.searchTherapists(query.query || '', {\n      location: query.location,\n      specialties: query.specialties,\n      priceRange: query.priceRange,\n      experienceYears: query.experienceYears,\n      rating: query.rating,\n      gender: query.gender,\n      languages: query.languages,\n      availability: query.availability,\n      verifiedOnly: query.verifiedOnly,\n      // Map maxHourlyRate from priceRange.max for backward compatibility\n      maxHourlyRate: query.priceRange?.max,\n    });\n  }\n\n  @Get('posts')\n  searchPosts(\n    @Query(new ZodValidationPipe(SearchPostsQueryDtoSchema))\n    query: SearchPostsQueryDto,\n  ) {\n    return this.searchService.searchPosts(query.query, query.communityId);\n  }\n\n  @Get('communities')\n  searchCommunities(\n    @Query(new ZodValidationPipe(SearchCommunitiesQueryDtoSchema))\n    query: SearchCommunitiesQueryDto,\n  ) {\n    return this.searchService.searchCommunities(query.query);\n  }\n\n  @Get('users')\n  searchUsers(\n    @Query(new ZodValidationPipe(SearchUsersQueryDtoSchema))\n    query: SearchUsersQueryDto,\n  ) {\n    return this.searchService.searchUsers(query.query, query.role);\n  }\n\n  @Get('global')\n  globalSearch(\n    @Query(new ZodValidationPipe(GlobalSearchQueryDtoSchema))\n    query: GlobalSearchQueryDto,\n    @Req() req: any, // Get user from request\n  ) {\n    // Include worksheets and messages in supported types\n    const supportedTypes = query.types?.filter((type) =>\n      ['users', 'therapists', 'posts', 'communities', 'worksheets', 'messages'].includes(type),\n    ) as ('users' | 'therapists' | 'posts' | 'communities' | 'worksheets' | 'messages')[] | undefined;\n\n    // Extract user information from the request\n    const userId = req.userId;\n    const userRole = req.userRole;\n\n    return this.searchService.globalSearch(\n      query.query, \n      supportedTypes, \n      userId, \n      userRole\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}