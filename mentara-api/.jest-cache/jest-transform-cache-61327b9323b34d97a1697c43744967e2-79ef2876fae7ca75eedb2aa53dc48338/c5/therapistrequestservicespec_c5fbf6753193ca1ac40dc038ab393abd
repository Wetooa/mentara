12db0181fa34707f59ea117ae7531930
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const therapist_request_service_1 = require("./therapist-request.service");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const notifications_service_1 = require("../../notifications/notifications.service");
const common_1 = require("@nestjs/common");
describe('TherapistRequestService', () => {
    let service;
    let prismaService;
    let notificationsService;
    let logger;
    const mockClientTherapistRequest = {
        id: 'request-123',
        clientId: 'client-123',
        therapistId: 'therapist-123',
        status: 'PENDING',
        priority: 'NORMAL',
        requestedAt: new Date(),
        respondedAt: null,
        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days from now
        therapistResponse: null,
        client: {
            id: 'client-123',
            userId: 'client-user-123',
            user: {
                firstName: 'John',
                lastName: 'Doe',
                avatarUrl: 'https://example.com/avatar.jpg',
                createdAt: new Date(),
            },
        },
        therapist: {
            id: 'therapist-123',
            userId: 'therapist-user-123',
            user: {
                firstName: 'Dr. Jane',
                lastName: 'Smith',
            },
        },
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockTherapist = {
        id: 'therapist-123',
        userId: 'therapist-user-123',
        status: 'approved',
        user: {
            isActive: true,
            firstName: 'Dr. Jane',
            lastName: 'Smith',
        },
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockClientTherapistRelationship = {
        id: 'relationship-123',
        clientId: 'client-123',
        therapistId: 'therapist-123',
        status: 'active',
        assignedAt: new Date(),
        notes: 'Relationship started from accepted request.',
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockResponseDto = {
        response: 'I would be happy to work with you.',
        acceptNewClients: true,
        preferredContactMethod: 'platform',
        schedulingMessage: 'Please schedule your first session through the platform.',
    };
    const mockFilters = {
        status: 'PENDING',
        priority: 'NORMAL',
        page: 1,
        limit: 20,
        sortBy: 'requestedAt',
        sortOrder: 'desc',
        includeExpired: false,
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                therapist_request_service_1.TherapistRequestService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: {
                        clientTherapistRequest: {
                            findMany: jest.fn(),
                            findUnique: jest.fn(),
                            count: jest.fn(),
                            update: jest.fn(),
                            findFirst: jest.fn(),
                        },
                        therapist: {
                            findUnique: jest.fn(),
                        },
                        clientTherapist: {
                            findFirst: jest.fn(),
                            create: jest.fn(),
                            count: jest.fn(),
                        },
                        auditLog: {
                            create: jest.fn(),
                        },
                        $transaction: jest.fn(),
                    },
                },
                {
                    provide: notifications_service_1.NotificationsService,
                    useValue: {
                        create: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(therapist_request_service_1.TherapistRequestService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        notificationsService = module.get(notifications_service_1.NotificationsService);
        logger = service['logger'];
        // Mock logger methods
        jest.spyOn(logger, 'log').mockImplementation();
        jest.spyOn(logger, 'error').mockImplementation();
        jest.spyOn(logger, 'warn').mockImplementation();
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('getTherapistRequests', () => {
        it('should retrieve therapist requests with filters and pagination', async () => {
            const mockRequests = [mockClientTherapistRequest];
            const mockCounts = { total: 1, pending: 1, highPriority: 0 };
            prismaService.clientTherapistRequest.findMany.mockResolvedValue(mockRequests);
            prismaService.clientTherapistRequest.count.mockResolvedValueOnce(mockCounts.total);
            prismaService.clientTherapistRequest.count.mockResolvedValueOnce(mockCounts.pending);
            prismaService.clientTherapistRequest.count.mockResolvedValueOnce(mockCounts.highPriority);
            const result = await service.getTherapistRequests('therapist-123', mockFilters);
            expect(result).toEqual({
                requests: mockRequests,
                pagination: {
                    page: 1,
                    limit: 20,
                    totalCount: 1,
                    totalPages: 1,
                },
                summary: {
                    pendingCount: 1,
                    highPriorityCount: 0,
                    filteredCount: 1,
                },
                filters: mockFilters,
            });
            expect(prismaService.clientTherapistRequest.findMany).toHaveBeenCalledWith({
                where: {
                    therapistId: 'therapist-123',
                    status: 'PENDING',
                    priority: 'NORMAL',
                },
                skip: 0,
                take: 20,
                orderBy: { requestedAt: 'desc' },
                include: {
                    client: {
                        include: {
                            user: {
                                select: {
                                    firstName: true,
                                    lastName: true,
                                    avatarUrl: true,
                                    createdAt: true,
                                },
                            },
                        },
                    },
                },
            });
        });
        it('should handle date range filters correctly', async () => {
            const filtersWithDates = {
                ...mockFilters,
                requestedAfter: '2023-01-01',
                requestedBefore: '2023-12-31',
                respondedAfter: '2023-01-01',
                respondedBefore: '2023-12-31',
            };
            prismaService.clientTherapistRequest.findMany.mockResolvedValue([]);
            prismaService.clientTherapistRequest.count.mockResolvedValue(0);
            await service.getTherapistRequests('therapist-123', filtersWithDates);
            expect(prismaService.clientTherapistRequest.findMany).toHaveBeenCalledWith({
                where: {
                    therapistId: 'therapist-123',
                    status: 'PENDING',
                    priority: 'NORMAL',
                    requestedAt: {
                        gte: new Date('2023-01-01'),
                        lte: new Date('2023-12-31'),
                    },
                    respondedAt: {
                        gte: new Date('2023-01-01'),
                        lte: new Date('2023-12-31'),
                    },
                },
                skip: 0,
                take: 20,
                orderBy: { requestedAt: 'desc' },
                include: expect.any(Object),
            });
        });
        it('should include expired requests when includeExpired is true', async () => {
            const filtersWithExpired = {
                ...mockFilters,
                includeExpired: true,
            };
            prismaService.clientTherapistRequest.findMany.mockResolvedValue([]);
            prismaService.clientTherapistRequest.count.mockResolvedValue(0);
            await service.getTherapistRequests('therapist-123', filtersWithExpired);
            expect(prismaService.clientTherapistRequest.findMany).toHaveBeenCalledWith({
                where: {
                    therapistId: 'therapist-123',
                    status: 'PENDING',
                    priority: 'NORMAL',
                },
                skip: 0,
                take: 20,
                orderBy: { requestedAt: 'desc' },
                include: expect.any(Object),
            });
        });
        it('should exclude expired requests by default', async () => {
            prismaService.clientTherapistRequest.findMany.mockResolvedValue([]);
            prismaService.clientTherapistRequest.count.mockResolvedValue(0);
            await service.getTherapistRequests('therapist-123', { ...mockFilters, includeExpired: false });
            expect(prismaService.clientTherapistRequest.findMany).toHaveBeenCalledWith({
                where: {
                    therapistId: 'therapist-123',
                    status: { not: 'EXPIRED' },
                    priority: 'NORMAL',
                },
                skip: 0,
                take: 20,
                orderBy: { requestedAt: 'desc' },
                include: expect.any(Object),
            });
        });
        it('should handle pagination correctly', async () => {
            const filtersWithPagination = {
                ...mockFilters,
                page: 2,
                limit: 10,
            };
            prismaService.clientTherapistRequest.findMany.mockResolvedValue([]);
            prismaService.clientTherapistRequest.count.mockResolvedValue(0);
            await service.getTherapistRequests('therapist-123', filtersWithPagination);
            expect(prismaService.clientTherapistRequest.findMany).toHaveBeenCalledWith({
                where: expect.any(Object),
                skip: 10, // (page - 1) * limit
                take: 10,
                orderBy: { requestedAt: 'desc' },
                include: expect.any(Object),
            });
        });
        it('should handle database errors', async () => {
            prismaService.clientTherapistRequest.findMany.mockRejectedValue(new Error('Database error'));
            await expect(service.getTherapistRequests('therapist-123', mockFilters)).rejects.toThrow('Database error');
        });
    });
    describe('acceptClientRequest', () => {
        it('should accept client request successfully', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                    update: jest.fn().mockResolvedValue({ ...mockClientTherapistRequest, status: 'ACCEPTED' }),
                },
                therapist: {
                    findUnique: jest.fn().mockResolvedValue(mockTherapist),
                },
                clientTherapist: {
                    findFirst: jest.fn().mockResolvedValue(null),
                    create: jest.fn().mockResolvedValue(mockClientTherapistRelationship),
                },
                auditLog: {
                    create: jest.fn().mockResolvedValue({}),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            notificationsService.create.mockResolvedValue({});
            const result = await service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto);
            expect(result).toEqual({
                success: true,
                request: { ...mockClientTherapistRequest, status: 'ACCEPTED' },
                relationship: mockClientTherapistRelationship,
                message: 'Client request accepted successfully',
                nextSteps: {
                    scheduleSession: 'Contact information provided',
                    clientNotified: true,
                    relationshipEstablished: true,
                },
            });
            expect(mockTransaction.clientTherapistRequest.update).toHaveBeenCalledWith({
                where: { id: 'request-123' },
                data: {
                    status: 'ACCEPTED',
                    respondedAt: expect.any(Date),
                    therapistResponse: mockResponseDto.response,
                },
            });
            expect(mockTransaction.clientTherapist.create).toHaveBeenCalledWith({
                data: {
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    status: 'active',
                    assignedAt: expect.any(Date),
                    notes: expect.stringContaining('Relationship started from accepted request'),
                },
            });
            expect(notificationsService.create).toHaveBeenCalledTimes(2);
        });
        it('should throw NotFoundException for non-existent request', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(null),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw ForbiddenException for request not belonging to therapist', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue({
                        ...mockClientTherapistRequest,
                        therapistId: 'different-therapist',
                    }),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should throw BadRequestException for non-pending request', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue({
                        ...mockClientTherapistRequest,
                        status: 'ACCEPTED',
                    }),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should throw BadRequestException for expired request', async () => {
            const expiredRequest = {
                ...mockClientTherapistRequest,
                expiresAt: new Date(Date.now() - 1000), // 1 second ago
            };
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(expiredRequest),
                    update: jest.fn().mockResolvedValue({ ...expiredRequest, status: 'EXPIRED' }),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.BadRequestException);
            expect(mockTransaction.clientTherapistRequest.update).toHaveBeenCalledWith({
                where: { id: 'request-123' },
                data: { status: 'EXPIRED', respondedAt: expect.any(Date) },
            });
        });
        it('should throw BadRequestException for inactive therapist', async () => {
            const inactiveTherapist = {
                ...mockTherapist,
                status: 'pending',
            };
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                },
                therapist: {
                    findUnique: jest.fn().mockResolvedValue(inactiveTherapist),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should throw ConflictException for existing active relationship', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                },
                therapist: {
                    findUnique: jest.fn().mockResolvedValue(mockTherapist),
                },
                clientTherapist: {
                    findFirst: jest.fn().mockResolvedValue(mockClientTherapistRelationship),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.ConflictException);
        });
        it('should send scheduling notification when provided', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                    update: jest.fn().mockResolvedValue({ ...mockClientTherapistRequest, status: 'ACCEPTED' }),
                },
                therapist: {
                    findUnique: jest.fn().mockResolvedValue(mockTherapist),
                },
                clientTherapist: {
                    findFirst: jest.fn().mockResolvedValue(null),
                    create: jest.fn().mockResolvedValue(mockClientTherapistRelationship),
                },
                auditLog: {
                    create: jest.fn().mockResolvedValue({}),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            notificationsService.create.mockResolvedValue({});
            await service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto);
            expect(notificationsService.create).toHaveBeenCalledWith({
                userId: 'client-123',
                title: 'Scheduling Information',
                message: mockResponseDto.schedulingMessage,
                type: 'SCHEDULING_INFO',
                priority: 'NORMAL',
                actionUrl: '/client/therapists/therapist-123/schedule',
            });
        });
    });
    describe('declineClientRequest', () => {
        it('should decline client request successfully', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                    update: jest.fn().mockResolvedValue({ ...mockClientTherapistRequest, status: 'DECLINED' }),
                },
                auditLog: {
                    create: jest.fn().mockResolvedValue({}),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            notificationsService.create.mockResolvedValue({});
            const result = await service.declineClientRequest('request-123', 'therapist-123', mockResponseDto);
            expect(result).toEqual({
                success: true,
                request: { ...mockClientTherapistRequest, status: 'DECLINED' },
                message: 'Client request declined',
                providedAlternatives: false,
            });
            expect(mockTransaction.clientTherapistRequest.update).toHaveBeenCalledWith({
                where: { id: 'request-123' },
                data: {
                    status: 'DECLINED',
                    respondedAt: expect.any(Date),
                    therapistResponse: mockResponseDto.response,
                },
            });
            expect(notificationsService.create).toHaveBeenCalledWith({
                userId: 'client-123',
                title: 'Therapist Request Update',
                message: expect.stringContaining('has responded to your therapy request'),
                type: 'THERAPIST_REQUEST_DECLINED',
                priority: 'NORMAL',
                actionUrl: '/client/therapists/browse',
                data: {
                    requestId: 'request-123',
                    therapistId: 'therapist-123',
                    response: mockResponseDto.response,
                },
            });
        });
        it('should send alternative recommendations when therapist not accepting new clients', async () => {
            const responseDto = {
                ...mockResponseDto,
                acceptNewClients: false,
            };
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                    update: jest.fn().mockResolvedValue({ ...mockClientTherapistRequest, status: 'DECLINED' }),
                },
                auditLog: {
                    create: jest.fn().mockResolvedValue({}),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            notificationsService.create.mockResolvedValue({});
            const result = await service.declineClientRequest('request-123', 'therapist-123', responseDto);
            expect(result.providedAlternatives).toBe(true);
            expect(notificationsService.create).toHaveBeenCalledWith({
                userId: 'client-123',
                title: 'Alternative Therapist Recommendations',
                message: 'We can help you find other qualified therapists who may be a good fit.',
                type: 'ALTERNATIVE_RECOMMENDATIONS',
                priority: 'NORMAL',
                actionUrl: '/client/therapists/recommendations',
            });
        });
        it('should throw NotFoundException for non-existent request', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(null),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.declineClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw ForbiddenException for request not belonging to therapist', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue({
                        ...mockClientTherapistRequest,
                        therapistId: 'different-therapist',
                    }),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.declineClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should throw BadRequestException for non-pending request', async () => {
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue({
                        ...mockClientTherapistRequest,
                        status: 'ACCEPTED',
                    }),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            await expect(service.declineClientRequest('request-123', 'therapist-123', mockResponseDto)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('performBulkAction', () => {
        const mockBulkActionDto = {
            requestIds: ['request-1', 'request-2'],
            action: 'accept',
            response: 'I am happy to work with you all.',
        };
        it('should perform bulk accept action successfully', async () => {
            jest.spyOn(service, 'acceptClientRequest').mockResolvedValue({
                success: true,
                request: mockClientTherapistRequest,
                relationship: mockClientTherapistRelationship,
                message: 'Request accepted',
                nextSteps: { scheduleSession: 'Schedule first session', clientNotified: true, relationshipEstablished: true },
            });
            const result = await service.performBulkAction('therapist-123', mockBulkActionDto);
            expect(result).toEqual({
                success: true,
                results: {
                    successful: [
                        { requestId: 'request-1', action: 'accept', status: 'completed' },
                        { requestId: 'request-2', action: 'accept', status: 'completed' },
                    ],
                    failed: [],
                    totalProcessed: 2,
                },
                summary: {
                    totalRequested: 2,
                    totalProcessed: 2,
                    totalFailed: 0,
                    action: 'accept',
                },
            });
            expect(service.acceptClientRequest).toHaveBeenCalledTimes(2);
        });
        it('should perform bulk decline action successfully', async () => {
            const declineDto = {
                ...mockBulkActionDto,
                action: 'decline',
            };
            jest.spyOn(service, 'declineClientRequest').mockResolvedValue({
                success: true,
                request: mockClientTherapistRequest,
                message: 'Request declined',
                providedAlternatives: false,
            });
            const result = await service.performBulkAction('therapist-123', declineDto);
            expect(result.results.successful).toHaveLength(2);
            expect(result.results.failed).toHaveLength(0);
            expect(service.declineClientRequest).toHaveBeenCalledTimes(2);
        });
        it('should perform bulk mark_reviewed action successfully', async () => {
            const markReviewedDto = {
                ...mockBulkActionDto,
                action: 'mark_reviewed',
            };
            jest.spyOn(service, 'markRequestAsReviewed').mockResolvedValue({
                success: true,
                requestId: 'request-1',
                message: 'Request marked as reviewed',
            });
            const result = await service.performBulkAction('therapist-123', markReviewedDto);
            expect(result.results.successful).toHaveLength(2);
            expect(result.results.failed).toHaveLength(0);
            expect(service['markRequestAsReviewed']).toHaveBeenCalledTimes(2);
        });
        it('should handle partial failures in bulk actions', async () => {
            jest.spyOn(service, 'acceptClientRequest')
                .mockResolvedValueOnce({
                success: true,
                request: mockClientTherapistRequest,
                relationship: mockClientTherapistRelationship,
                message: 'Request accepted',
                nextSteps: { scheduleSession: 'Schedule first session', clientNotified: true, relationshipEstablished: true },
            })
                .mockRejectedValueOnce(new Error('Request not found'));
            const result = await service.performBulkAction('therapist-123', mockBulkActionDto);
            expect(result.results.successful).toHaveLength(1);
            expect(result.results.failed).toHaveLength(1);
            expect(result.results.failed[0]).toEqual({
                requestId: 'request-2',
                action: 'accept',
                error: 'Request not found',
            });
        });
        it('should throw BadRequestException for invalid action', async () => {
            const invalidActionDto = {
                ...mockBulkActionDto,
                action: 'invalid_action',
            };
            const result = await service.performBulkAction('therapist-123', invalidActionDto);
            expect(result.results.successful).toHaveLength(0);
            expect(result.results.failed).toHaveLength(2);
            expect(result.results.failed[0].error).toBe('Invalid action: invalid_action');
        });
        it('should throw BadRequestException for missing response in accept action', async () => {
            const actionWithoutResponse = {
                ...mockBulkActionDto,
                response: undefined,
            };
            const result = await service.performBulkAction('therapist-123', actionWithoutResponse);
            expect(result.results.successful).toHaveLength(0);
            expect(result.results.failed).toHaveLength(2);
            expect(result.results.failed[0].error).toBe('Response message required for accept action');
        });
    });
    describe('getTherapistRequestStatistics', () => {
        it('should calculate statistics correctly', async () => {
            const mockRecentRequests = [
                {
                    requestedAt: new Date('2023-01-01T10:00:00Z'),
                    respondedAt: new Date('2023-01-01T12:00:00Z'),
                },
                {
                    requestedAt: new Date('2023-01-02T10:00:00Z'),
                    respondedAt: new Date('2023-01-02T14:00:00Z'),
                },
            ];
            const mockLastRequest = { requestedAt: new Date('2023-01-03T10:00:00Z') };
            const mockLastResponse = { respondedAt: new Date('2023-01-03T14:00:00Z') };
            prismaService.clientTherapistRequest.count
                .mockResolvedValueOnce(10) // totalReceived
                .mockResolvedValueOnce(3) // pending
                .mockResolvedValueOnce(5) // accepted
                .mockResolvedValueOnce(2) // declined
                .mockResolvedValueOnce(0); // expired
            prismaService.clientTherapistRequest.findMany
                .mockResolvedValueOnce(mockRecentRequests)
                .mockResolvedValueOnce([mockLastRequest])
                .mockResolvedValueOnce([mockLastResponse]);
            prismaService.clientTherapist.count.mockResolvedValue(4); // activeRelationships
            const result = await service.getTherapistRequestStatistics('therapist-123');
            expect(result).toEqual({
                totalReceived: 10,
                pending: 3,
                accepted: 5,
                declined: 2,
                expired: 0,
                activeRelationships: 4,
                acceptanceRate: 71.43, // 5 / (5 + 2) * 100
                averageResponseTime: 3, // Average of 2 hours and 4 hours
                lastRequestAt: mockLastRequest.requestedAt,
                lastResponseAt: mockLastResponse.respondedAt,
            });
        });
        it('should handle empty statistics', async () => {
            prismaService.clientTherapistRequest.count.mockResolvedValue(0);
            prismaService.clientTherapistRequest.findMany.mockResolvedValue([]);
            prismaService.clientTherapist.count.mockResolvedValue(0);
            const result = await service.getTherapistRequestStatistics('therapist-123');
            expect(result).toEqual({
                totalReceived: 0,
                pending: 0,
                accepted: 0,
                declined: 0,
                expired: 0,
                activeRelationships: 0,
                acceptanceRate: 0,
                averageResponseTime: 0,
                lastRequestAt: null,
                lastResponseAt: null,
            });
        });
        it('should handle database errors', async () => {
            prismaService.clientTherapistRequest.count.mockRejectedValue(new Error('Database error'));
            await expect(service.getTherapistRequestStatistics('therapist-123')).rejects.toThrow('Database error');
        });
    });
    describe('markRequestAsReviewed', () => {
        it('should mark request as reviewed successfully', async () => {
            prismaService.clientTherapistRequest.findUnique.mockResolvedValue(mockClientTherapistRequest);
            prismaService.auditLog.create.mockResolvedValue({});
            const result = await service['markRequestAsReviewed']('request-123', 'therapist-123');
            expect(result).toEqual({
                success: true,
                requestId: 'request-123',
                message: 'Request marked as reviewed',
            });
            expect(prismaService.auditLog.create).toHaveBeenCalledWith({
                data: {
                    userId: 'therapist-123',
                    action: 'REVIEW_CLIENT_REQUEST',
                    entity: 'client_therapist_request',
                    entityId: 'request-123',
                    metadata: {
                        requestId: 'request-123',
                        reviewedAt: expect.any(String),
                    },
                },
            });
        });
        it('should throw NotFoundException for non-existent request', async () => {
            prismaService.clientTherapistRequest.findUnique.mockResolvedValue(null);
            await expect(service['markRequestAsReviewed']('request-123', 'therapist-123')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw NotFoundException for request not belonging to therapist', async () => {
            prismaService.clientTherapistRequest.findUnique.mockResolvedValue({
                ...mockClientTherapistRequest,
                therapistId: 'different-therapist',
            });
            await expect(service['markRequestAsReviewed']('request-123', 'therapist-123')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('integration tests', () => {
        it('should handle complete request acceptance workflow', async () => {
            // Mock all transaction operations
            const mockTransaction = {
                clientTherapistRequest: {
                    findUnique: jest.fn().mockResolvedValue(mockClientTherapistRequest),
                    update: jest.fn().mockResolvedValue({ ...mockClientTherapistRequest, status: 'ACCEPTED' }),
                },
                therapist: {
                    findUnique: jest.fn().mockResolvedValue(mockTherapist),
                },
                clientTherapist: {
                    findFirst: jest.fn().mockResolvedValue(null),
                    create: jest.fn().mockResolvedValue(mockClientTherapistRelationship),
                },
                auditLog: {
                    create: jest.fn().mockResolvedValue({}),
                },
            };
            prismaService.$transaction.mockImplementation(async (callback) => {
                return callback(mockTransaction);
            });
            notificationsService.create.mockResolvedValue({});
            const result = await service.acceptClientRequest('request-123', 'therapist-123', mockResponseDto);
            // Verify all transaction operations were called
            expect(mockTransaction.clientTherapistRequest.findUnique).toHaveBeenCalled();
            expect(mockTransaction.therapist.findUnique).toHaveBeenCalled();
            expect(mockTransaction.clientTherapist.findFirst).toHaveBeenCalled();
            expect(mockTransaction.clientTherapist.create).toHaveBeenCalled();
            expect(mockTransaction.auditLog.create).toHaveBeenCalled();
            // Verify notifications were sent
            expect(notificationsService.create).toHaveBeenCalledTimes(2);
            // Verify result structure
            expect(result.success).toBe(true);
            expect(result.request).toBeDefined();
            expect(result.relationship).toBeDefined();
            expect(result.nextSteps).toBeDefined();
        });
        it('should handle complex filtering scenarios', async () => {
            const complexFilters = {
                status: 'PENDING',
                priority: 'HIGH',
                clientId: 'client-123',
                requestedAfter: '2023-01-01',
                requestedBefore: '2023-12-31',
                page: 2,
                limit: 5,
                sortBy: 'priority',
                sortOrder: 'asc',
                includeExpired: true,
            };
            prismaService.clientTherapistRequest.findMany.mockResolvedValue([]);
            prismaService.clientTherapistRequest.count.mockResolvedValue(0);
            const result = await service.getTherapistRequests('therapist-123', complexFilters);
            expect(result.filters).toEqual(complexFilters);
            expect(result.pagination.page).toBe(2);
            expect(result.pagination.limit).toBe(5);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9zZXJ2aWNlcy90aGVyYXBpc3QtcmVxdWVzdC5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkVBQXNFO0FBQ3RFLG1GQUF1RTtBQUN2RSxxRkFBaUY7QUFDakYsMkNBTXdCO0FBT3hCLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7SUFDdkMsSUFBSSxPQUFnQyxDQUFDO0lBQ3JDLElBQUksYUFBeUMsQ0FBQztJQUM5QyxJQUFJLG9CQUF1RCxDQUFDO0lBQzVELElBQUksTUFBMkIsQ0FBQztJQUVoQyxNQUFNLDBCQUEwQixHQUFHO1FBQ2pDLEVBQUUsRUFBRSxhQUFhO1FBQ2pCLFFBQVEsRUFBRSxZQUFZO1FBQ3RCLFdBQVcsRUFBRSxlQUFlO1FBQzVCLE1BQU0sRUFBRSxTQUFTO1FBQ2pCLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtRQUN2QixXQUFXLEVBQUUsSUFBSTtRQUNqQixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxrQkFBa0I7UUFDN0UsaUJBQWlCLEVBQUUsSUFBSTtRQUN2QixNQUFNLEVBQUU7WUFDTixFQUFFLEVBQUUsWUFBWTtZQUNoQixNQUFNLEVBQUUsaUJBQWlCO1lBQ3pCLElBQUksRUFBRTtnQkFDSixTQUFTLEVBQUUsTUFBTTtnQkFDakIsUUFBUSxFQUFFLEtBQUs7Z0JBQ2YsU0FBUyxFQUFFLGdDQUFnQztnQkFDM0MsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ3RCO1NBQ0Y7UUFDRCxTQUFTLEVBQUU7WUFDVCxFQUFFLEVBQUUsZUFBZTtZQUNuQixNQUFNLEVBQUUsb0JBQW9CO1lBQzVCLElB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QUMsQ0FBQztZQUNwRSxhQUFhLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLG9CQUFvQixDQUFDLGVBQWUsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUVuRixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdGhlcmFwaXN0L3NlcnZpY2VzL3RoZXJhcGlzdC1yZXF1ZXN0LnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IFRoZXJhcGlzdFJlcXVlc3RTZXJ2aWNlIH0gZnJvbSAnLi90aGVyYXBpc3QtcmVxdWVzdC5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi8uLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25zU2VydmljZSB9IGZyb20gJy4uLy4uL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9ucy5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIExvZ2dlcixcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIENvbmZsaWN0RXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBGb3JiaWRkZW5FeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7XG4gIFRoZXJhcGlzdFJlcXVlc3RGaWx0ZXJzRHRvLFxuICBUaGVyYXBpc3RSZXF1ZXN0UmVzcG9uc2VEdG8sXG4gIEJ1bGtUaGVyYXBpc3RBY3Rpb25EdG8sXG59IGZyb20gJ21lbnRhcmEtY29tbW9ucyc7XG5cbmRlc2NyaWJlKCdUaGVyYXBpc3RSZXF1ZXN0U2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFRoZXJhcGlzdFJlcXVlc3RTZXJ2aWNlO1xuICBsZXQgcHJpc21hU2VydmljZTogamVzdC5Nb2NrZWQ8UHJpc21hU2VydmljZT47XG4gIGxldCBub3RpZmljYXRpb25zU2VydmljZTogamVzdC5Nb2NrZWQ8Tm90aWZpY2F0aW9uc1NlcnZpY2U+O1xuICBsZXQgbG9nZ2VyOiBqZXN0Lk1vY2tlZDxMb2dnZXI+O1xuXG4gIGNvbnN0IG1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0ID0ge1xuICAgIGlkOiAncmVxdWVzdC0xMjMnLFxuICAgIGNsaWVudElkOiAnY2xpZW50LTEyMycsXG4gICAgdGhlcmFwaXN0SWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICBzdGF0dXM6ICdQRU5ESU5HJyxcbiAgICBwcmlvcml0eTogJ05PUk1BTCcsXG4gICAgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgcmVzcG9uZGVkQXQ6IG51bGwsXG4gICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyA3IGRheXMgZnJvbSBub3dcbiAgICB0aGVyYXBpc3RSZXNwb25zZTogbnVsbCxcbiAgICBjbGllbnQ6IHtcbiAgICAgIGlkOiAnY2xpZW50LTEyMycsXG4gICAgICB1c2VySWQ6ICdjbGllbnQtdXNlci0xMjMnLFxuICAgICAgdXNlcjoge1xuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgICBhdmF0YXJVcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2F2YXRhci5qcGcnLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIH0sXG4gICAgdGhlcmFwaXN0OiB7XG4gICAgICBpZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgdXNlcklkOiAndGhlcmFwaXN0LXVzZXItMTIzJyxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnRHIuIEphbmUnLFxuICAgICAgICBsYXN0TmFtZTogJ1NtaXRoJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tUaGVyYXBpc3QgPSB7XG4gICAgaWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICB1c2VySWQ6ICd0aGVyYXBpc3QtdXNlci0xMjMnLFxuICAgIHN0YXR1czogJ2FwcHJvdmVkJyxcbiAgICB1c2VyOiB7XG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIGZpcnN0TmFtZTogJ0RyLiBKYW5lJyxcbiAgICAgIGxhc3ROYW1lOiAnU21pdGgnLFxuICAgIH0sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ2xpZW50VGhlcmFwaXN0UmVsYXRpb25zaGlwID0ge1xuICAgIGlkOiAncmVsYXRpb25zaGlwLTEyMycsXG4gICAgY2xpZW50SWQ6ICdjbGllbnQtMTIzJyxcbiAgICB0aGVyYXBpc3RJZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgYXNzaWduZWRBdDogbmV3IERhdGUoKSxcbiAgICBub3RlczogJ1JlbGF0aW9uc2hpcCBzdGFydGVkIGZyb20gYWNjZXB0ZWQgcmVxdWVzdC4nLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1Jlc3BvbnNlRHRvOiBUaGVyYXBpc3RSZXF1ZXN0UmVzcG9uc2VEdG8gPSB7XG4gICAgcmVzcG9uc2U6ICdJIHdvdWxkIGJlIGhhcHB5IHRvIHdvcmsgd2l0aCB5b3UuJyxcbiAgICBhY2NlcHROZXdDbGllbnRzOiB0cnVlLFxuICAgIHByZWZlcnJlZENvbnRhY3RNZXRob2Q6ICdwbGF0Zm9ybScsXG4gICAgc2NoZWR1bGluZ01lc3NhZ2U6ICdQbGVhc2Ugc2NoZWR1bGUgeW91ciBmaXJzdCBzZXNzaW9uIHRocm91Z2ggdGhlIHBsYXRmb3JtLicsXG4gIH07XG5cbiAgY29uc3QgbW9ja0ZpbHRlcnM6IFRoZXJhcGlzdFJlcXVlc3RGaWx0ZXJzRHRvID0ge1xuICAgIHN0YXR1czogJ1BFTkRJTkcnLFxuICAgIHByaW9yaXR5OiAnTk9STUFMJyxcbiAgICBwYWdlOiAxLFxuICAgIGxpbWl0OiAyMCxcbiAgICBzb3J0Qnk6ICdyZXF1ZXN0ZWRBdCcsXG4gICAgc29ydE9yZGVyOiAnZGVzYycsXG4gICAgaW5jbHVkZUV4cGlyZWQ6IGZhbHNlLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgVGhlcmFwaXN0UmVxdWVzdFNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgICAgIGZpbmRNYW55OiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgY291bnQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgIGZpbmRGaXJzdDogamVzdC5mbigpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRoZXJhcGlzdDoge1xuICAgICAgICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xpZW50VGhlcmFwaXN0OiB7XG4gICAgICAgICAgICAgIGZpbmRGaXJzdDogamVzdC5mbigpLFxuICAgICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgY291bnQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdWRpdExvZzoge1xuICAgICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAkdHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogTm90aWZpY2F0aW9uc1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFRoZXJhcGlzdFJlcXVlc3RTZXJ2aWNlPihUaGVyYXBpc3RSZXF1ZXN0U2VydmljZSk7XG4gICAgcHJpc21hU2VydmljZSA9IG1vZHVsZS5nZXQoUHJpc21hU2VydmljZSk7XG4gICAgbm90aWZpY2F0aW9uc1NlcnZpY2UgPSBtb2R1bGUuZ2V0KE5vdGlmaWNhdGlvbnNTZXJ2aWNlKTtcbiAgICBsb2dnZXIgPSBzZXJ2aWNlWydsb2dnZXInXSBhcyBqZXN0Lk1vY2tlZDxMb2dnZXI+O1xuXG4gICAgLy8gTW9jayBsb2dnZXIgbWV0aG9kc1xuICAgIGplc3Quc3B5T24obG9nZ2VyLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgamVzdC5zcHlPbihsb2dnZXIsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICAgIGplc3Quc3B5T24obG9nZ2VyLCAnd2FybicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRUaGVyYXBpc3RSZXF1ZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHRoZXJhcGlzdCByZXF1ZXN0cyB3aXRoIGZpbHRlcnMgYW5kIHBhZ2luYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdHMgPSBbbW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3RdO1xuICAgICAgY29uc3QgbW9ja0NvdW50cyA9IHsgdG90YWw6IDEsIHBlbmRpbmc6IDEsIGhpZ2hQcmlvcml0eTogMCB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlcXVlc3RzKTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja0NvdW50cy50b3RhbCk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tDb3VudHMucGVuZGluZyk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tDb3VudHMuaGlnaFByaW9yaXR5KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRUaGVyYXBpc3RSZXF1ZXN0cygndGhlcmFwaXN0LTEyMycsIG1vY2tGaWx0ZXJzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHJlcXVlc3RzOiBtb2NrUmVxdWVzdHMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgIGxpbWl0OiAyMCxcbiAgICAgICAgICB0b3RhbENvdW50OiAxLFxuICAgICAgICAgIHRvdGFsUGFnZXM6IDEsXG4gICAgICAgIH0sXG4gICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICBwZW5kaW5nQ291bnQ6IDEsXG4gICAgICAgICAgaGlnaFByaW9yaXR5Q291bnQ6IDAsXG4gICAgICAgICAgZmlsdGVyZWRDb3VudDogMSxcbiAgICAgICAgfSxcbiAgICAgICAgZmlsdGVyczogbW9ja0ZpbHRlcnMsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHRoZXJhcGlzdElkOiAndGhlcmFwaXN0LTEyMycsXG4gICAgICAgICAgc3RhdHVzOiAnUEVORElORycsXG4gICAgICAgICAgcHJpb3JpdHk6ICdOT1JNQUwnLFxuICAgICAgICB9LFxuICAgICAgICBza2lwOiAwLFxuICAgICAgICB0YWtlOiAyMCxcbiAgICAgICAgb3JkZXJCeTogeyByZXF1ZXN0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBjbGllbnQ6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0ZSByYW5nZSBmaWx0ZXJzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnNXaXRoRGF0ZXMgPSB7XG4gICAgICAgIC4uLm1vY2tGaWx0ZXJzLFxuICAgICAgICByZXF1ZXN0ZWRBZnRlcjogJzIwMjMtMDEtMDEnLFxuICAgICAgICByZXF1ZXN0ZWRCZWZvcmU6ICcyMDIzLTEyLTMxJyxcbiAgICAgICAgcmVzcG9uZGVkQWZ0ZXI6ICcyMDIzLTAxLTAxJyxcbiAgICAgICAgcmVzcG9uZGVkQmVmb3JlOiAnMjAyMy0xMi0zMScsXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmdldFRoZXJhcGlzdFJlcXVlc3RzKCd0aGVyYXBpc3QtMTIzJywgZmlsdGVyc1dpdGhEYXRlcyk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB0aGVyYXBpc3RJZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICAgIHN0YXR1czogJ1BFTkRJTkcnLFxuICAgICAgICAgIHByaW9yaXR5OiAnTk9STUFMJyxcbiAgICAgICAgICByZXF1ZXN0ZWRBdDoge1xuICAgICAgICAgICAgZ3RlOiBuZXcgRGF0ZSgnMjAyMy0wMS0wMScpLFxuICAgICAgICAgICAgbHRlOiBuZXcgRGF0ZSgnMjAyMy0xMi0zMScpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVzcG9uZGVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogbmV3IERhdGUoJzIwMjMtMDEtMDEnKSxcbiAgICAgICAgICAgIGx0ZTogbmV3IERhdGUoJzIwMjMtMTItMzEnKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBza2lwOiAwLFxuICAgICAgICB0YWtlOiAyMCxcbiAgICAgICAgb3JkZXJCeTogeyByZXF1ZXN0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIGV4cGlyZWQgcmVxdWVzdHMgd2hlbiBpbmNsdWRlRXhwaXJlZCBpcyB0cnVlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyc1dpdGhFeHBpcmVkID0ge1xuICAgICAgICAuLi5tb2NrRmlsdGVycyxcbiAgICAgICAgaW5jbHVkZUV4cGlyZWQ6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmdldFRoZXJhcGlzdFJlcXVlc3RzKCd0aGVyYXBpc3QtMTIzJywgZmlsdGVyc1dpdGhFeHBpcmVkKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHRoZXJhcGlzdElkOiAndGhlcmFwaXN0LTEyMycsXG4gICAgICAgICAgc3RhdHVzOiAnUEVORElORycsXG4gICAgICAgICAgcHJpb3JpdHk6ICdOT1JNQUwnLFxuICAgICAgICB9LFxuICAgICAgICBza2lwOiAwLFxuICAgICAgICB0YWtlOiAyMCxcbiAgICAgICAgb3JkZXJCeTogeyByZXF1ZXN0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGNsdWRlIGV4cGlyZWQgcmVxdWVzdHMgYnkgZGVmYXVsdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0VGhlcmFwaXN0UmVxdWVzdHMoJ3RoZXJhcGlzdC0xMjMnLCB7IC4uLm1vY2tGaWx0ZXJzLCBpbmNsdWRlRXhwaXJlZDogZmFsc2UgfSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB0aGVyYXBpc3RJZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICAgIHN0YXR1czogeyBub3Q6ICdFWFBJUkVEJyB9LFxuICAgICAgICAgIHByaW9yaXR5OiAnTk9STUFMJyxcbiAgICAgICAgfSxcbiAgICAgICAgc2tpcDogMCxcbiAgICAgICAgdGFrZTogMjAsXG4gICAgICAgIG9yZGVyQnk6IHsgcmVxdWVzdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICBpbmNsdWRlOiBleHBlY3QuYW55KE9iamVjdCksXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhZ2luYXRpb24gY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyc1dpdGhQYWdpbmF0aW9uID0ge1xuICAgICAgICAuLi5tb2NrRmlsdGVycyxcbiAgICAgICAgcGFnZTogMixcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5jb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSgwKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5nZXRUaGVyYXBpc3RSZXF1ZXN0cygndGhlcmFwaXN0LTEyMycsIGZpbHRlcnNXaXRoUGFnaW5hdGlvbik7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgICAgc2tpcDogMTAsIC8vIChwYWdlIC0gMSkgKiBsaW1pdFxuICAgICAgICB0YWtlOiAxMCxcbiAgICAgICAgb3JkZXJCeTogeyByZXF1ZXN0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIGluY2x1ZGU6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmZpbmRNYW55Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmdldFRoZXJhcGlzdFJlcXVlc3RzKCd0aGVyYXBpc3QtMTIzJywgbW9ja0ZpbHRlcnMpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdEYXRhYmFzZSBlcnJvcicsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWNjZXB0Q2xpZW50UmVxdWVzdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBjbGllbnQgcmVxdWVzdCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb24gPSB7XG4gICAgICAgIGNsaWVudFRoZXJhcGlzdFJlcXVlc3Q6IHtcbiAgICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QpLFxuICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsIHN0YXR1czogJ0FDQ0VQVEVEJyB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUaGVyYXBpc3QpLFxuICAgICAgICB9LFxuICAgICAgICBjbGllbnRUaGVyYXBpc3Q6IHtcbiAgICAgICAgICBmaW5kRmlyc3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSxcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xpZW50VGhlcmFwaXN0UmVsYXRpb25zaGlwKSxcbiAgICAgICAgfSxcbiAgICAgICAgYXVkaXRMb2c6IHtcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIG5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYWNjZXB0Q2xpZW50UmVxdWVzdChcbiAgICAgICAgJ3JlcXVlc3QtMTIzJyxcbiAgICAgICAgJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICBtb2NrUmVzcG9uc2VEdG8sXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgcmVxdWVzdDogeyAuLi5tb2NrQ2xpZW50VGhlcmFwaXN0UmVxdWVzdCwgc3RhdHVzOiAnQUNDRVBURUQnIH0sXG4gICAgICAgIHJlbGF0aW9uc2hpcDogbW9ja0NsaWVudFRoZXJhcGlzdFJlbGF0aW9uc2hpcCxcbiAgICAgICAgbWVzc2FnZTogJ0NsaWVudCByZXF1ZXN0IGFjY2VwdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIG5leHRTdGVwczoge1xuICAgICAgICAgIHNjaGVkdWxlU2Vzc2lvbjogJ0NvbnRhY3QgaW5mb3JtYXRpb24gcHJvdmlkZWQnLFxuICAgICAgICAgIGNsaWVudE5vdGlmaWVkOiB0cnVlLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcEVzdGFibGlzaGVkOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uY2xpZW50VGhlcmFwaXN0UmVxdWVzdC51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6ICdyZXF1ZXN0LTEyMycgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHN0YXR1czogJ0FDQ0VQVEVEJyxcbiAgICAgICAgICByZXNwb25kZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICB0aGVyYXBpc3RSZXNwb25zZTogbW9ja1Jlc3BvbnNlRHRvLnJlc3BvbnNlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uY2xpZW50VGhlcmFwaXN0LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgY2xpZW50SWQ6ICdjbGllbnQtMTIzJyxcbiAgICAgICAgICB0aGVyYXBpc3RJZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICAgICAgYXNzaWduZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICBub3RlczogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1JlbGF0aW9uc2hpcCBzdGFydGVkIGZyb20gYWNjZXB0ZWQgcmVxdWVzdCcpLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gZm9yIG5vbi1leGlzdGVudCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS4kdHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja1RyYW5zYWN0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuYWNjZXB0Q2xpZW50UmVxdWVzdCgncmVxdWVzdC0xMjMnLCAndGhlcmFwaXN0LTEyMycsIG1vY2tSZXNwb25zZUR0byksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiBmb3IgcmVxdWVzdCBub3QgYmVsb25naW5nIHRvIHRoZXJhcGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tUcmFuc2FjdGlvbiA9IHtcbiAgICAgICAgY2xpZW50VGhlcmFwaXN0UmVxdWVzdDoge1xuICAgICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICAuLi5tb2NrQ2xpZW50VGhlcmFwaXN0UmVxdWVzdCxcbiAgICAgICAgICAgIHRoZXJhcGlzdElkOiAnZGlmZmVyZW50LXRoZXJhcGlzdCcsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5hY2NlcHRDbGllbnRSZXF1ZXN0KCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJywgbW9ja1Jlc3BvbnNlRHRvKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gZm9yIG5vbi1wZW5kaW5nIHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb24gPSB7XG4gICAgICAgIGNsaWVudFRoZXJhcGlzdFJlcXVlc3Q6IHtcbiAgICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgLi4ubW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsXG4gICAgICAgICAgICBzdGF0dXM6ICdBQ0NFUFRFRCcsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5hY2NlcHRDbGllbnRSZXF1ZXN0KCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJywgbW9ja1Jlc3BvbnNlRHRvKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBleHBpcmVkIHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleHBpcmVkUmVxdWVzdCA9IHtcbiAgICAgICAgLi4ubW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDEwMDApLCAvLyAxIHNlY29uZCBhZ29cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tUcmFuc2FjdGlvbiA9IHtcbiAgICAgICAgY2xpZW50VGhlcmFwaXN0UmVxdWVzdDoge1xuICAgICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShleHBpcmVkUmVxdWVzdCksXG4gICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyAuLi5leHBpcmVkUmVxdWVzdCwgc3RhdHVzOiAnRVhQSVJFRCcgfSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5hY2NlcHRDbGllbnRSZXF1ZXN0KCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJywgbW9ja1Jlc3BvbnNlRHRvKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuXG4gICAgICBleHBlY3QobW9ja1RyYW5zYWN0aW9uLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAncmVxdWVzdC0xMjMnIH0sXG4gICAgICAgIGRhdGE6IHsgc3RhdHVzOiAnRVhQSVJFRCcsIHJlc3BvbmRlZEF0OiBleHBlY3QuYW55KERhdGUpIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiBmb3IgaW5hY3RpdmUgdGhlcmFwaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW5hY3RpdmVUaGVyYXBpc3QgPSB7XG4gICAgICAgIC4uLm1vY2tUaGVyYXBpc3QsXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0KSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGluYWN0aXZlVGhlcmFwaXN0KSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG1vY2tUcmFuc2FjdGlvbik7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmFjY2VwdENsaWVudFJlcXVlc3QoJ3JlcXVlc3QtMTIzJywgJ3RoZXJhcGlzdC0xMjMnLCBtb2NrUmVzcG9uc2VEdG8pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IENvbmZsaWN0RXhjZXB0aW9uIGZvciBleGlzdGluZyBhY3RpdmUgcmVsYXRpb25zaGlwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0KSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUaGVyYXBpc3QpLFxuICAgICAgICB9LFxuICAgICAgICBjbGllbnRUaGVyYXBpc3Q6IHtcbiAgICAgICAgICBmaW5kRmlyc3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xpZW50VGhlcmFwaXN0UmVsYXRpb25zaGlwKSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG1vY2tUcmFuc2FjdGlvbik7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmFjY2VwdENsaWVudFJlcXVlc3QoJ3JlcXVlc3QtMTIzJywgJ3RoZXJhcGlzdC0xMjMnLCBtb2NrUmVzcG9uc2VEdG8pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQ29uZmxpY3RFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZW5kIHNjaGVkdWxpbmcgbm90aWZpY2F0aW9uIHdoZW4gcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb24gPSB7XG4gICAgICAgIGNsaWVudFRoZXJhcGlzdFJlcXVlc3Q6IHtcbiAgICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QpLFxuICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsIHN0YXR1czogJ0FDQ0VQVEVEJyB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUaGVyYXBpc3QpLFxuICAgICAgICB9LFxuICAgICAgICBjbGllbnRUaGVyYXBpc3Q6IHtcbiAgICAgICAgICBmaW5kRmlyc3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSxcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xpZW50VGhlcmFwaXN0UmVsYXRpb25zaGlwKSxcbiAgICAgICAgfSxcbiAgICAgICAgYXVkaXRMb2c6IHtcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIG5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuYWNjZXB0Q2xpZW50UmVxdWVzdCgncmVxdWVzdC0xMjMnLCAndGhlcmFwaXN0LTEyMycsIG1vY2tSZXNwb25zZUR0byk7XG5cbiAgICAgIGV4cGVjdChub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcklkOiAnY2xpZW50LTEyMycsXG4gICAgICAgIHRpdGxlOiAnU2NoZWR1bGluZyBJbmZvcm1hdGlvbicsXG4gICAgICAgIG1lc3NhZ2U6IG1vY2tSZXNwb25zZUR0by5zY2hlZHVsaW5nTWVzc2FnZSxcbiAgICAgICAgdHlwZTogJ1NDSEVEVUxJTkdfSU5GTycsXG4gICAgICAgIHByaW9yaXR5OiAnTk9STUFMJyxcbiAgICAgICAgYWN0aW9uVXJsOiAnL2NsaWVudC90aGVyYXBpc3RzL3RoZXJhcGlzdC0xMjMvc2NoZWR1bGUnLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWNsaW5lQ2xpZW50UmVxdWVzdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRlY2xpbmUgY2xpZW50IHJlcXVlc3Qgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0KSxcbiAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0LCBzdGF0dXM6ICdERUNMSU5FRCcgfSksXG4gICAgICAgIH0sXG4gICAgICAgIGF1ZGl0TG9nOiB7XG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS4kdHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja1RyYW5zYWN0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmRlY2xpbmVDbGllbnRSZXF1ZXN0KFxuICAgICAgICAncmVxdWVzdC0xMjMnLFxuICAgICAgICAndGhlcmFwaXN0LTEyMycsXG4gICAgICAgIG1vY2tSZXNwb25zZUR0byxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICByZXF1ZXN0OiB7IC4uLm1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0LCBzdGF0dXM6ICdERUNMSU5FRCcgfSxcbiAgICAgICAgbWVzc2FnZTogJ0NsaWVudCByZXF1ZXN0IGRlY2xpbmVkJyxcbiAgICAgICAgcHJvdmlkZWRBbHRlcm5hdGl2ZXM6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uY2xpZW50VGhlcmFwaXN0UmVxdWVzdC51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6ICdyZXF1ZXN0LTEyMycgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHN0YXR1czogJ0RFQ0xJTkVEJyxcbiAgICAgICAgICByZXNwb25kZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICB0aGVyYXBpc3RSZXNwb25zZTogbW9ja1Jlc3BvbnNlRHRvLnJlc3BvbnNlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcklkOiAnY2xpZW50LTEyMycsXG4gICAgICAgIHRpdGxlOiAnVGhlcmFwaXN0IFJlcXVlc3QgVXBkYXRlJyxcbiAgICAgICAgbWVzc2FnZTogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2hhcyByZXNwb25kZWQgdG8geW91ciB0aGVyYXB5IHJlcXVlc3QnKSxcbiAgICAgICAgdHlwZTogJ1RIRVJBUElTVF9SRVFVRVNUX0RFQ0xJTkVEJyxcbiAgICAgICAgcHJpb3JpdHk6ICdOT1JNQUwnLFxuICAgICAgICBhY3Rpb25Vcmw6ICcvY2xpZW50L3RoZXJhcGlzdHMvYnJvd3NlJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHJlcXVlc3RJZDogJ3JlcXVlc3QtMTIzJyxcbiAgICAgICAgICB0aGVyYXBpc3RJZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICAgIHJlc3BvbnNlOiBtb2NrUmVzcG9uc2VEdG8ucmVzcG9uc2UsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2VuZCBhbHRlcm5hdGl2ZSByZWNvbW1lbmRhdGlvbnMgd2hlbiB0aGVyYXBpc3Qgbm90IGFjY2VwdGluZyBuZXcgY2xpZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlRHRvID0ge1xuICAgICAgICAuLi5tb2NrUmVzcG9uc2VEdG8sXG4gICAgICAgIGFjY2VwdE5ld0NsaWVudHM6IGZhbHNlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0KSxcbiAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0LCBzdGF0dXM6ICdERUNMSU5FRCcgfSksXG4gICAgICAgIH0sXG4gICAgICAgIGF1ZGl0TG9nOiB7XG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS4kdHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja1RyYW5zYWN0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmRlY2xpbmVDbGllbnRSZXF1ZXN0KCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJywgcmVzcG9uc2VEdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnByb3ZpZGVkQWx0ZXJuYXRpdmVzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB1c2VySWQ6ICdjbGllbnQtMTIzJyxcbiAgICAgICAgdGl0bGU6ICdBbHRlcm5hdGl2ZSBUaGVyYXBpc3QgUmVjb21tZW5kYXRpb25zJyxcbiAgICAgICAgbWVzc2FnZTogJ1dlIGNhbiBoZWxwIHlvdSBmaW5kIG90aGVyIHF1YWxpZmllZCB0aGVyYXBpc3RzIHdobyBtYXkgYmUgYSBnb29kIGZpdC4nLFxuICAgICAgICB0eXBlOiAnQUxURVJOQVRJVkVfUkVDT01NRU5EQVRJT05TJyxcbiAgICAgICAgcHJpb3JpdHk6ICdOT1JNQUwnLFxuICAgICAgICBhY3Rpb25Vcmw6ICcvY2xpZW50L3RoZXJhcGlzdHMvcmVjb21tZW5kYXRpb25zJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiBmb3Igbm9uLWV4aXN0ZW50IHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb24gPSB7XG4gICAgICAgIGNsaWVudFRoZXJhcGlzdFJlcXVlc3Q6IHtcbiAgICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5kZWNsaW5lQ2xpZW50UmVxdWVzdCgncmVxdWVzdC0xMjMnLCAndGhlcmFwaXN0LTEyMycsIG1vY2tSZXNwb25zZUR0byksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiBmb3IgcmVxdWVzdCBub3QgYmVsb25naW5nIHRvIHRoZXJhcGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tUcmFuc2FjdGlvbiA9IHtcbiAgICAgICAgY2xpZW50VGhlcmFwaXN0UmVxdWVzdDoge1xuICAgICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICAuLi5tb2NrQ2xpZW50VGhlcmFwaXN0UmVxdWVzdCxcbiAgICAgICAgICAgIHRoZXJhcGlzdElkOiAnZGlmZmVyZW50LXRoZXJhcGlzdCcsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5kZWNsaW5lQ2xpZW50UmVxdWVzdCgncmVxdWVzdC0xMjMnLCAndGhlcmFwaXN0LTEyMycsIG1vY2tSZXNwb25zZUR0byksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBub24tcGVuZGluZyByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICBjbGllbnRUaGVyYXBpc3RSZXF1ZXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIC4uLm1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0LFxuICAgICAgICAgICAgc3RhdHVzOiAnQUNDRVBURUQnLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS4kdHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja1RyYW5zYWN0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuZGVjbGluZUNsaWVudFJlcXVlc3QoJ3JlcXVlc3QtMTIzJywgJ3RoZXJhcGlzdC0xMjMnLCBtb2NrUmVzcG9uc2VEdG8pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwZXJmb3JtQnVsa0FjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQnVsa0FjdGlvbkR0bzogQnVsa1RoZXJhcGlzdEFjdGlvbkR0byA9IHtcbiAgICAgIHJlcXVlc3RJZHM6IFsncmVxdWVzdC0xJywgJ3JlcXVlc3QtMiddLFxuICAgICAgYWN0aW9uOiAnYWNjZXB0JyxcbiAgICAgIHJlc3BvbnNlOiAnSSBhbSBoYXBweSB0byB3b3JrIHdpdGggeW91IGFsbC4nLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHBlcmZvcm0gYnVsayBhY2NlcHQgYWN0aW9uIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2FjY2VwdENsaWVudFJlcXVlc3QnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHJlcXVlc3Q6IG1vY2tDbGllbnRUaGVyYXBpc3RSZXF1ZXN0LFxuICAgICAgICByZWxhdGlvbnNoaXA6IG1vY2tDbGllbnRUaGVyYXBpc3RSZWxhdGlvbnNoaXAsXG4gICAgICAgIG1lc3NhZ2U6ICdSZXF1ZXN0IGFjY2VwdGVkJyxcbiAgICAgICAgbmV4dFN0ZXBzOiB7IHNjaGVkdWxlU2Vzc2lvbjogJ1NjaGVkdWxlIGZpcnN0IHNlc3Npb24nLCBjbGllbnROb3RpZmllZDogdHJ1ZSwgcmVsYXRpb25zaGlwRXN0YWJsaXNoZWQ6IHRydWUgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnBlcmZvcm1CdWxrQWN0aW9uKCd0aGVyYXBpc3QtMTIzJywgbW9ja0J1bGtBY3Rpb25EdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgcmVzdWx0czoge1xuICAgICAgICAgIHN1Y2Nlc3NmdWw6IFtcbiAgICAgICAgICAgIHsgcmVxdWVzdElkOiAncmVxdWVzdC0xJywgYWN0aW9uOiAnYWNjZXB0Jywgc3RhdHVzOiAnY29tcGxldGVkJyB9LFxuICAgICAgICAgICAgeyByZXF1ZXN0SWQ6ICdyZXF1ZXN0LTInLCBhY3Rpb246ICdhY2NlcHQnLCBzdGF0dXM6ICdjb21wbGV0ZWQnIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBmYWlsZWQ6IFtdLFxuICAgICAgICAgIHRvdGFsUHJvY2Vzc2VkOiAyLFxuICAgICAgICB9LFxuICAgICAgICBzdW1tYXJ5OiB7XG4gICAgICAgICAgdG90YWxSZXF1ZXN0ZWQ6IDIsXG4gICAgICAgICAgdG90YWxQcm9jZXNzZWQ6IDIsXG4gICAgICAgICAgdG90YWxGYWlsZWQ6IDAsXG4gICAgICAgICAgYWN0aW9uOiAnYWNjZXB0JyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5hY2NlcHRDbGllbnRSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBlcmZvcm0gYnVsayBkZWNsaW5lIGFjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZWNsaW5lRHRvID0ge1xuICAgICAgICAuLi5tb2NrQnVsa0FjdGlvbkR0byxcbiAgICAgICAgYWN0aW9uOiAnZGVjbGluZScgYXMgY29uc3QsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdkZWNsaW5lQ2xpZW50UmVxdWVzdCcpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgcmVxdWVzdDogbW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsXG4gICAgICAgIG1lc3NhZ2U6ICdSZXF1ZXN0IGRlY2xpbmVkJyxcbiAgICAgICAgcHJvdmlkZWRBbHRlcm5hdGl2ZXM6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybUJ1bGtBY3Rpb24oJ3RoZXJhcGlzdC0xMjMnLCBkZWNsaW5lRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzLnN1Y2Nlc3NmdWwpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0cy5mYWlsZWQpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmRlY2xpbmVDbGllbnRSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBlcmZvcm0gYnVsayBtYXJrX3Jldmlld2VkIGFjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYXJrUmV2aWV3ZWREdG8gPSB7XG4gICAgICAgIC4uLm1vY2tCdWxrQWN0aW9uRHRvLFxuICAgICAgICBhY3Rpb246ICdtYXJrX3Jldmlld2VkJyBhcyBjb25zdCxcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksICdtYXJrUmVxdWVzdEFzUmV2aWV3ZWQnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHJlcXVlc3RJZDogJ3JlcXVlc3QtMScsXG4gICAgICAgIG1lc3NhZ2U6ICdSZXF1ZXN0IG1hcmtlZCBhcyByZXZpZXdlZCcsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtQnVsa0FjdGlvbigndGhlcmFwaXN0LTEyMycsIG1hcmtSZXZpZXdlZER0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0cy5zdWNjZXNzZnVsKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMuZmFpbGVkKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3Qoc2VydmljZVsnbWFya1JlcXVlc3RBc1Jldmlld2VkJ10pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhcnRpYWwgZmFpbHVyZXMgaW4gYnVsayBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnYWNjZXB0Q2xpZW50UmVxdWVzdCcpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgcmVxdWVzdDogbW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsXG4gICAgICAgICAgcmVsYXRpb25zaGlwOiBtb2NrQ2xpZW50VGhlcmFwaXN0UmVsYXRpb25zaGlwLFxuICAgICAgICAgIG1lc3NhZ2U6ICdSZXF1ZXN0IGFjY2VwdGVkJyxcbiAgICAgICAgICBuZXh0U3RlcHM6IHsgc2NoZWR1bGVTZXNzaW9uOiAnU2NoZWR1bGUgZmlyc3Qgc2Vzc2lvbicsIGNsaWVudE5vdGlmaWVkOiB0cnVlLCByZWxhdGlvbnNoaXBFc3RhYmxpc2hlZDogdHJ1ZSB9LFxuICAgICAgICB9KVxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignUmVxdWVzdCBub3QgZm91bmQnKSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybUJ1bGtBY3Rpb24oJ3RoZXJhcGlzdC0xMjMnLCBtb2NrQnVsa0FjdGlvbkR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0cy5zdWNjZXNzZnVsKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMuZmFpbGVkKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMuZmFpbGVkWzBdKS50b0VxdWFsKHtcbiAgICAgICAgcmVxdWVzdElkOiAncmVxdWVzdC0yJyxcbiAgICAgICAgYWN0aW9uOiAnYWNjZXB0JyxcbiAgICAgICAgZXJyb3I6ICdSZXF1ZXN0IG5vdCBmb3VuZCcsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiBmb3IgaW52YWxpZCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkQWN0aW9uRHRvID0ge1xuICAgICAgICAuLi5tb2NrQnVsa0FjdGlvbkR0byxcbiAgICAgICAgYWN0aW9uOiAnaW52YWxpZF9hY3Rpb24nIGFzIGFueSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybUJ1bGtBY3Rpb24oJ3RoZXJhcGlzdC0xMjMnLCBpbnZhbGlkQWN0aW9uRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzLnN1Y2Nlc3NmdWwpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0cy5mYWlsZWQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0cy5mYWlsZWRbMF0uZXJyb3IpLnRvQmUoJ0ludmFsaWQgYWN0aW9uOiBpbnZhbGlkX2FjdGlvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBtaXNzaW5nIHJlc3BvbnNlIGluIGFjY2VwdCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhY3Rpb25XaXRob3V0UmVzcG9uc2UgPSB7XG4gICAgICAgIC4uLm1vY2tCdWxrQWN0aW9uRHRvLFxuICAgICAgICByZXNwb25zZTogdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtQnVsa0FjdGlvbigndGhlcmFwaXN0LTEyMycsIGFjdGlvbldpdGhvdXRSZXNwb25zZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0cy5zdWNjZXNzZnVsKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMuZmFpbGVkKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMuZmFpbGVkWzBdLmVycm9yKS50b0JlKCdSZXNwb25zZSBtZXNzYWdlIHJlcXVpcmVkIGZvciBhY2NlcHQgYWN0aW9uJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRUaGVyYXBpc3RSZXF1ZXN0U3RhdGlzdGljcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBzdGF0aXN0aWNzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWNlbnRSZXF1ZXN0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHJlcXVlc3RlZEF0OiBuZXcgRGF0ZSgnMjAyMy0wMS0wMVQxMDowMDowMFonKSxcbiAgICAgICAgICByZXNwb25kZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDFUMTI6MDA6MDBaJyksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByZXF1ZXN0ZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDJUMTA6MDA6MDBaJyksXG4gICAgICAgICAgcmVzcG9uZGVkQXQ6IG5ldyBEYXRlKCcyMDIzLTAxLTAyVDE0OjAwOjAwWicpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbW9ja0xhc3RSZXF1ZXN0ID0geyByZXF1ZXN0ZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDNUMTA6MDA6MDBaJykgfTtcbiAgICAgIGNvbnN0IG1vY2tMYXN0UmVzcG9uc2UgPSB7IHJlc3BvbmRlZEF0OiBuZXcgRGF0ZSgnMjAyMy0wMS0wM1QxNDowMDowMFonKSB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuY291bnRcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSgxMCkgLy8gdG90YWxSZWNlaXZlZFxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKDMpIC8vIHBlbmRpbmdcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSg1KSAvLyBhY2NlcHRlZFxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKDIpIC8vIGRlY2xpbmVkXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoMCk7IC8vIGV4cGlyZWRcblxuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmZpbmRNYW55XG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1JlY2VudFJlcXVlc3RzKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKFttb2NrTGFzdFJlcXVlc3RdKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKFttb2NrTGFzdFJlc3BvbnNlXSk7XG5cbiAgICAgIHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDQpOyAvLyBhY3RpdmVSZWxhdGlvbnNoaXBzXG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VGhlcmFwaXN0UmVxdWVzdFN0YXRpc3RpY3MoJ3RoZXJhcGlzdC0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHRvdGFsUmVjZWl2ZWQ6IDEwLFxuICAgICAgICBwZW5kaW5nOiAzLFxuICAgICAgICBhY2NlcHRlZDogNSxcbiAgICAgICAgZGVjbGluZWQ6IDIsXG4gICAgICAgIGV4cGlyZWQ6IDAsXG4gICAgICAgIGFjdGl2ZVJlbGF0aW9uc2hpcHM6IDQsXG4gICAgICAgIGFjY2VwdGFuY2VSYXRlOiA3MS40MywgLy8gNSAvICg1ICsgMikgKiAxMDBcbiAgICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogMywgLy8gQXZlcmFnZSBvZiAyIGhvdXJzIGFuZCA0IGhvdXJzXG4gICAgICAgIGxhc3RSZXF1ZXN0QXQ6IG1vY2tMYXN0UmVxdWVzdC5yZXF1ZXN0ZWRBdCxcbiAgICAgICAgbGFzdFJlc3BvbnNlQXQ6IG1vY2tMYXN0UmVzcG9uc2UucmVzcG9uZGVkQXQsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3QuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0VGhlcmFwaXN0UmVxdWVzdFN0YXRpc3RpY3MoJ3RoZXJhcGlzdC0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHRvdGFsUmVjZWl2ZWQ6IDAsXG4gICAgICAgIHBlbmRpbmc6IDAsXG4gICAgICAgIGFjY2VwdGVkOiAwLFxuICAgICAgICBkZWNsaW5lZDogMCxcbiAgICAgICAgZXhwaXJlZDogMCxcbiAgICAgICAgYWN0aXZlUmVsYXRpb25zaGlwczogMCxcbiAgICAgICAgYWNjZXB0YW5jZVJhdGU6IDAsXG4gICAgICAgIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIGxhc3RSZXF1ZXN0QXQ6IG51bGwsXG4gICAgICAgIGxhc3RSZXNwb25zZUF0OiBudWxsLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuY291bnQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2V0VGhlcmFwaXN0UmVxdWVzdFN0YXRpc3RpY3MoJ3RoZXJhcGlzdC0xMjMnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnRGF0YWJhc2UgZXJyb3InLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21hcmtSZXF1ZXN0QXNSZXZpZXdlZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgcmVxdWVzdCBhcyByZXZpZXdlZCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xpZW50VGhlcmFwaXN0UmVxdWVzdCk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLmF1ZGl0TG9nLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2VbJ21hcmtSZXF1ZXN0QXNSZXZpZXdlZCddKCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICByZXF1ZXN0SWQ6ICdyZXF1ZXN0LTEyMycsXG4gICAgICAgIG1lc3NhZ2U6ICdSZXF1ZXN0IG1hcmtlZCBhcyByZXZpZXdlZCcsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuYXVkaXRMb2cuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICAgICAgICBhY3Rpb246ICdSRVZJRVdfQ0xJRU5UX1JFUVVFU1QnLFxuICAgICAgICAgIGVudGl0eTogJ2NsaWVudF90aGVyYXBpc3RfcmVxdWVzdCcsXG4gICAgICAgICAgZW50aXR5SWQ6ICdyZXF1ZXN0LTEyMycsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIHJlcXVlc3RJZDogJ3JlcXVlc3QtMTIzJyxcbiAgICAgICAgICAgIHJldmlld2VkQXQ6IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGZvciBub24tZXhpc3RlbnQgcmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UuY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2VbJ21hcmtSZXF1ZXN0QXNSZXZpZXdlZCddKCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGZvciByZXF1ZXN0IG5vdCBiZWxvbmdpbmcgdG8gdGhlcmFwaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrQ2xpZW50VGhlcmFwaXN0UmVxdWVzdCxcbiAgICAgICAgdGhlcmFwaXN0SWQ6ICdkaWZmZXJlbnQtdGhlcmFwaXN0JyxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2VbJ21hcmtSZXF1ZXN0QXNSZXZpZXdlZCddKCdyZXF1ZXN0LTEyMycsICd0aGVyYXBpc3QtMTIzJyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnRlZ3JhdGlvbiB0ZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSByZXF1ZXN0IGFjY2VwdGFuY2Ugd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIGFsbCB0cmFuc2FjdGlvbiBvcGVyYXRpb25zXG4gICAgICBjb25zdCBtb2NrVHJhbnNhY3Rpb24gPSB7XG4gICAgICAgIGNsaWVudFRoZXJhcGlzdFJlcXVlc3Q6IHtcbiAgICAgICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QpLFxuICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja0NsaWVudFRoZXJhcGlzdFJlcXVlc3QsIHN0YXR1czogJ0FDQ0VQVEVEJyB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUaGVyYXBpc3QpLFxuICAgICAgICB9LFxuICAgICAgICBjbGllbnRUaGVyYXBpc3Q6IHtcbiAgICAgICAgICBmaW5kRmlyc3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSxcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xpZW50VGhlcmFwaXN0UmVsYXRpb25zaGlwKSxcbiAgICAgICAgfSxcbiAgICAgICAgYXVkaXRMb2c6IHtcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIG5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYWNjZXB0Q2xpZW50UmVxdWVzdChcbiAgICAgICAgJ3JlcXVlc3QtMTIzJyxcbiAgICAgICAgJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICBtb2NrUmVzcG9uc2VEdG8sXG4gICAgICApO1xuXG4gICAgICAvLyBWZXJpZnkgYWxsIHRyYW5zYWN0aW9uIG9wZXJhdGlvbnMgd2VyZSBjYWxsZWRcbiAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uY2xpZW50VGhlcmFwaXN0UmVxdWVzdC5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1RyYW5zYWN0aW9uLnRoZXJhcGlzdC5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1RyYW5zYWN0aW9uLmNsaWVudFRoZXJhcGlzdC5maW5kRmlyc3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uY2xpZW50VGhlcmFwaXN0LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tUcmFuc2FjdGlvbi5hdWRpdExvZy5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgLy8gVmVyaWZ5IG5vdGlmaWNhdGlvbnMgd2VyZSBzZW50XG4gICAgICBleHBlY3Qobm90aWZpY2F0aW9uc1NlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG5cbiAgICAgIC8vIFZlcmlmeSByZXN1bHQgc3RydWN0dXJlXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlcXVlc3QpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlbGF0aW9uc2hpcCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubmV4dFN0ZXBzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBmaWx0ZXJpbmcgc2NlbmFyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29tcGxleEZpbHRlcnMgPSB7XG4gICAgICAgIHN0YXR1czogJ1BFTkRJTkcnLFxuICAgICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgICBjbGllbnRJZDogJ2NsaWVudC0xMjMnLFxuICAgICAgICByZXF1ZXN0ZWRBZnRlcjogJzIwMjMtMDEtMDEnLFxuICAgICAgICByZXF1ZXN0ZWRCZWZvcmU6ICcyMDIzLTEyLTMxJyxcbiAgICAgICAgcGFnZTogMixcbiAgICAgICAgbGltaXQ6IDUsXG4gICAgICAgIHNvcnRCeTogJ3ByaW9yaXR5JyxcbiAgICAgICAgc29ydE9yZGVyOiAnYXNjJyxcbiAgICAgICAgaW5jbHVkZUV4cGlyZWQ6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLmNsaWVudFRoZXJhcGlzdFJlcXVlc3QuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgcHJpc21hU2VydmljZS5jbGllbnRUaGVyYXBpc3RSZXF1ZXN0LmNvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKDApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFRoZXJhcGlzdFJlcXVlc3RzKCd0aGVyYXBpc3QtMTIzJywgY29tcGxleEZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmZpbHRlcnMpLnRvRXF1YWwoY29tcGxleEZpbHRlcnMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYWdpbmF0aW9uLnBhZ2UpLnRvQmUoMik7XG4gICAgICBleHBlY3QocmVzdWx0LnBhZ2luYXRpb24ubGltaXQpLnRvQmUoNSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9