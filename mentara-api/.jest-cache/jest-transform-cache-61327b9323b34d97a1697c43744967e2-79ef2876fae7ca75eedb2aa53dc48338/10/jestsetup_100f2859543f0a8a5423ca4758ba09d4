5ed64761208ffe8ac8dab66b5395160f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TEST_TIMEOUT = void 0;
// Mock external dependencies
jest.mock('axios');
jest.mock('@clerk/backend', () => ({
    clerkClient: {
        users: {
            getUser: jest.fn(),
            updateUser: jest.fn(),
            deleteUser: jest.fn(),
        },
    },
    createClerkClient: jest.fn(),
}));
// Mock file upload services
jest.mock('@supabase/supabase-js');
jest.mock('@aws-sdk/client-s3');
// Mock AI service
jest.mock('src/pre-assessment/services/ai-service.client', () => ({
    AiServiceClient: jest.fn().mockImplementation(() => ({
        predict: jest.fn().mockResolvedValue({ prediction: [0.5, 0.3, 0.8] }),
    })),
}));
require("reflect-metadata");
// Global test setup for unit tests
beforeAll(async () => {
    // Set test environment variables
    process.env.NODE_ENV = 'test';
    process.env.DATABASE_URL =
        process.env.TEST_DATABASE_URL ||
            'postgresql://test:test@localhost:5432/mentara_test';
    // Disable external services in tests
    process.env.DISABLE_CLERK_WEBHOOK = 'true';
    process.env.DISABLE_EMAIL_SERVICE = 'true';
    process.env.DISABLE_AI_SERVICE = 'true';
    // Test-specific configurations
    process.env.JWT_SECRET = 'test-jwt-secret-key';
    process.env.ENCRYPTION_KEY = 'test-encryption-key-32-chars!!';
});
// Enhanced console mocking with test insights
const originalConsole = { ...console };
global.console = {
    ...console,
    // Suppress console.log during tests unless explicitly needed
    log: jest.fn((message) => {
        if (process.env.DEBUG_TESTS === 'true') {
            originalConsole.log('[TEST DEBUG]', message);
        }
    }),
    debug: jest.fn(),
    info: jest.fn(),
    warn: (message) => {
        if (process.env.SHOW_WARNINGS === 'true') {
            originalConsole.warn('[TEST WARN]', message);
        }
    },
    error: originalConsole.error, // Always show errors
};
// Setup global test timeout
jest.setTimeout(10000);
// Enhanced cleanup after each test
afterEach(async () => {
    jest.clearAllMocks();
    jest.clearAllTimers();
    // Reset environment variables that might have been modified
    delete process.env.TEST_USER_ID;
    delete process.env.TEST_ROLE;
});
// Global cleanup
afterAll(async () => {
    // Clean up any remaining async operations
    await new Promise(resolve => setTimeout(resolve, 100));
});
// Test environment validation
if (process.env.JEST_TEST_TYPE === 'integration' &&
    !process.env.DATABASE_URL?.includes('test')) {
    throw new Error('Integration tests must use a test database. DATABASE_URL must contain "test"');
}
// Prevent tests from running against production database
if (process.env.DATABASE_URL?.includes('prod')) {
    throw new Error('Tests cannot run against production database!');
}
// Enhanced test timeouts with categories
exports.TEST_TIMEOUT = {
    UNIT: 5000,
    INTEGRATION: 15000,
    E2E: 30000,
    DATABASE: 20000,
    ASYNC_OPERATION: 10000,
};
// Test performance tracking
const testStartTimes = new Map();
beforeEach(() => {
    const testName = expect.getState().currentTestName;
    testStartTimes.set(testName, Date.now());
});
afterEach(() => {
    const testName = expect.getState().currentTestName;
    const startTime = testStartTimes.get(testName);
    if (startTime && process.env.TRACK_TEST_PERFORMANCE === 'true') {
        const duration = Date.now() - startTime;
        if (duration > 1000) {
            console.warn(`Slow test detected: ${testName} took ${duration}ms`);
        }
    }
    testStartTimes.delete(testName);
});
// Global error handlers for unhandled promises
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
process.on('uncaughtException', (error) => {
    console.error('Uncaught Exception:', error);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvamVzdC5zZXR1cC50cyIsIm1hcHBpbmdzIjoiOzs7QUFvQkEsNkJBQTZCO0FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLFdBQVcsRUFBRTtRQUNYLEtBQUssRUFBRTtZQUNMLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2xCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3JCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ3RCO0tBQ0Y7SUFDRCxpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQzdCLENBQUMsQ0FBQyxDQUFDO0FBRUosNEJBQTRCO0FBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFFaEMsa0JBQWtCO0FBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsK0NBQStDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNoRSxlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDbkQsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFVBQVUsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztLQUN0RSxDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQTFDSiw0QkFBMEI7QUFFMUIsbUNBQW1DO0FBQ25DLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNuQixpQ0FBaUM7SUFDakMsT0FB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QU0sQ0FBQyxDQUFDO0FBQ3ZFLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ3hDLE9BQU8sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDOUMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvamVzdC5zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuXG4vLyBHbG9iYWwgdGVzdCBzZXR1cCBmb3IgdW5pdCB0ZXN0c1xuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gU2V0IHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xuICBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPVxuICAgIHByb2Nlc3MuZW52LlRFU1RfREFUQUJBU0VfVVJMIHx8XG4gICAgJ3Bvc3RncmVzcWw6Ly90ZXN0OnRlc3RAbG9jYWxob3N0OjU0MzIvbWVudGFyYV90ZXN0JztcbiAgXG4gIC8vIERpc2FibGUgZXh0ZXJuYWwgc2VydmljZXMgaW4gdGVzdHNcbiAgcHJvY2Vzcy5lbnYuRElTQUJMRV9DTEVSS19XRUJIT09LID0gJ3RydWUnO1xuICBwcm9jZXNzLmVudi5ESVNBQkxFX0VNQUlMX1NFUlZJQ0UgPSAndHJ1ZSc7XG4gIHByb2Nlc3MuZW52LkRJU0FCTEVfQUlfU0VSVklDRSA9ICd0cnVlJztcbiAgXG4gIC8vIFRlc3Qtc3BlY2lmaWMgY29uZmlndXJhdGlvbnNcbiAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCA9ICd0ZXN0LWp3dC1zZWNyZXQta2V5JztcbiAgcHJvY2Vzcy5lbnYuRU5DUllQVElPTl9LRVkgPSAndGVzdC1lbmNyeXB0aW9uLWtleS0zMi1jaGFycyEhJztcbn0pO1xuXG4vLyBNb2NrIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCdheGlvcycpO1xuamVzdC5tb2NrKCdAY2xlcmsvYmFja2VuZCcsICgpID0+ICh7XG4gIGNsZXJrQ2xpZW50OiB7XG4gICAgdXNlcnM6IHtcbiAgICAgIGdldFVzZXI6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVVzZXI6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZVVzZXI6IGplc3QuZm4oKSxcbiAgICB9LFxuICB9LFxuICBjcmVhdGVDbGVya0NsaWVudDogamVzdC5mbigpLFxufSkpO1xuXG4vLyBNb2NrIGZpbGUgdXBsb2FkIHNlcnZpY2VzXG5qZXN0Lm1vY2soJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycpO1xuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnKTtcblxuLy8gTW9jayBBSSBzZXJ2aWNlXG5qZXN0Lm1vY2soJ3NyYy9wcmUtYXNzZXNzbWVudC9zZXJ2aWNlcy9haS1zZXJ2aWNlLmNsaWVudCcsICgpID0+ICh7XG4gIEFpU2VydmljZUNsaWVudDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIHByZWRpY3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHByZWRpY3Rpb246IFswLjUsIDAuMywgMC44XSB9KSxcbiAgfSkpLFxufSkpO1xuXG4vLyBFbmhhbmNlZCBjb25zb2xlIG1vY2tpbmcgd2l0aCB0ZXN0IGluc2lnaHRzXG5jb25zdCBvcmlnaW5hbENvbnNvbGUgPSB7IC4uLmNvbnNvbGUgfTtcbmdsb2JhbC5jb25zb2xlID0ge1xuICAuLi5jb25zb2xlLFxuICAvLyBTdXBwcmVzcyBjb25zb2xlLmxvZyBkdXJpbmcgdGVzdHMgdW5sZXNzIGV4cGxpY2l0bHkgbmVlZGVkXG4gIGxvZzogamVzdC5mbigobWVzc2FnZSkgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5ERUJVR19URVNUUyA9PT0gJ3RydWUnKSB7XG4gICAgICBvcmlnaW5hbENvbnNvbGUubG9nKCdbVEVTVCBERUJVR10nLCBtZXNzYWdlKTtcbiAgICB9XG4gIH0pLFxuICBkZWJ1ZzogamVzdC5mbigpLFxuICBpbmZvOiBqZXN0LmZuKCksXG4gIHdhcm46IChtZXNzYWdlKSA9PiB7XG4gICAgaWYgKHByb2Nlc3MuZW52LlNIT1dfV0FSTklOR1MgPT09ICd0cnVlJykge1xuICAgICAgb3JpZ2luYWxDb25zb2xlLndhcm4oJ1tURVNUIFdBUk5dJywgbWVzc2FnZSk7XG4gICAgfVxuICB9LFxuICBlcnJvcjogb3JpZ2luYWxDb25zb2xlLmVycm9yLCAvLyBBbHdheXMgc2hvdyBlcnJvcnNcbn07XG5cbi8vIFNldHVwIGdsb2JhbCB0ZXN0IHRpbWVvdXRcbmplc3Quc2V0VGltZW91dCgxMDAwMCk7XG5cbi8vIEVuaGFuY2VkIGNsZWFudXAgYWZ0ZXIgZWFjaCB0ZXN0XG5hZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICBcbiAgLy8gUmVzZXQgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRoYXQgbWlnaHQgaGF2ZSBiZWVuIG1vZGlmaWVkXG4gIGRlbGV0ZSBwcm9jZXNzLmVudi5URVNUX1VTRVJfSUQ7XG4gIGRlbGV0ZSBwcm9jZXNzLmVudi5URVNUX1JPTEU7XG59KTtcblxuLy8gR2xvYmFsIGNsZWFudXBcbmFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gQ2xlYW4gdXAgYW55IHJlbWFpbmluZyBhc3luYyBvcGVyYXRpb25zXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbn0pO1xuXG4vLyBUZXN0IGVudmlyb25tZW50IHZhbGlkYXRpb25cbmlmIChcbiAgcHJvY2Vzcy5lbnYuSkVTVF9URVNUX1RZUEUgPT09ICdpbnRlZ3JhdGlvbicgJiZcbiAgIXByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTD8uaW5jbHVkZXMoJ3Rlc3QnKVxuKSB7XG4gIHRocm93IG5ldyBFcnJvcihcbiAgICAnSW50ZWdyYXRpb24gdGVzdHMgbXVzdCB1c2UgYSB0ZXN0IGRhdGFiYXNlLiBEQVRBQkFTRV9VUkwgbXVzdCBjb250YWluIFwidGVzdFwiJyxcbiAgKTtcbn1cblxuLy8gUHJldmVudCB0ZXN0cyBmcm9tIHJ1bm5pbmcgYWdhaW5zdCBwcm9kdWN0aW9uIGRhdGFiYXNlXG5pZiAocHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMPy5pbmNsdWRlcygncHJvZCcpKSB7XG4gIHRocm93IG5ldyBFcnJvcihcbiAgICAnVGVzdHMgY2Fubm90IHJ1biBhZ2FpbnN0IHByb2R1Y3Rpb24gZGF0YWJhc2UhJyxcbiAgKTtcbn1cblxuLy8gR2xvYmFsIHRlc3QgY29uc3RhbnRzXG5kZWNsYXJlIGdsb2JhbCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbmFtZXNwYWNlXG4gIG5hbWVzcGFjZSBOb2RlSlMge1xuICAgIGludGVyZmFjZSBHbG9iYWwge1xuICAgICAgdGVzdERiOiBhbnk7XG4gICAgICB0ZXN0RmFjdG9yeTogYW55O1xuICAgIH1cbiAgfVxufVxuXG4vLyBFbmhhbmNlZCB0ZXN0IHRpbWVvdXRzIHdpdGggY2F0ZWdvcmllc1xuZXhwb3J0IGNvbnN0IFRFU1RfVElNRU9VVCA9IHtcbiAgVU5JVDogNTAwMCxcbiAgSU5URUdSQVRJT046IDE1MDAwLFxuICBFMkU6IDMwMDAwLFxuICBEQVRBQkFTRTogMjAwMDAsXG4gIEFTWU5DX09QRVJBVElPTjogMTAwMDAsXG59O1xuXG4vLyBUZXN0IHBlcmZvcm1hbmNlIHRyYWNraW5nXG5jb25zdCB0ZXN0U3RhcnRUaW1lcyA9IG5ldyBNYXAoKTtcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIGNvbnN0IHRlc3ROYW1lID0gZXhwZWN0LmdldFN0YXRlKCkuY3VycmVudFRlc3ROYW1lO1xuICB0ZXN0U3RhcnRUaW1lcy5zZXQodGVzdE5hbWUsIERhdGUubm93KCkpO1xufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIGNvbnN0IHRlc3ROYW1lID0gZXhwZWN0LmdldFN0YXRlKCkuY3VycmVudFRlc3ROYW1lO1xuICBjb25zdCBzdGFydFRpbWUgPSB0ZXN0U3RhcnRUaW1lcy5nZXQodGVzdE5hbWUpO1xuICBpZiAoc3RhcnRUaW1lICYmIHByb2Nlc3MuZW52LlRSQUNLX1RFU1RfUEVSRk9STUFOQ0UgPT09ICd0cnVlJykge1xuICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBpZiAoZHVyYXRpb24gPiAxMDAwKSB7XG4gICAgICBjb25zb2xlLndhcm4oYFNsb3cgdGVzdCBkZXRlY3RlZDogJHt0ZXN0TmFtZX0gdG9vayAke2R1cmF0aW9ufW1zYCk7XG4gICAgfVxuICB9XG4gIHRlc3RTdGFydFRpbWVzLmRlbGV0ZSh0ZXN0TmFtZSk7XG59KTtcblxuLy8gR2xvYmFsIGVycm9yIGhhbmRsZXJzIGZvciB1bmhhbmRsZWQgcHJvbWlzZXNcbnByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChyZWFzb24sIHByb21pc2UpID0+IHtcbiAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIFJlamVjdGlvbiBhdDonLCBwcm9taXNlLCAncmVhc29uOicsIHJlYXNvbik7XG59KTtcblxucHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCAoZXJyb3IpID0+IHtcbiAgY29uc29sZS5lcnJvcignVW5jYXVnaHQgRXhjZXB0aW9uOicsIGVycm9yKTtcbn0pO1xuIl0sInZlcnNpb24iOjN9