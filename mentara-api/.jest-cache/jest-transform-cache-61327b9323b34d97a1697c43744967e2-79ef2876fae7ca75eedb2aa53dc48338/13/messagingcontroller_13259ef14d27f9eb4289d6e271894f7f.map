{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Param,\n  Query,\n  Body,\n  UseGuards,\n  UseInterceptors,\n  UploadedFiles,\n  HttpCode,\n  HttpStatus,\n  HttpException,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { MessagingService } from './messaging.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport {\n  SupabaseStorageService,\n  FileUploadResult,\n} from '../common/services/supabase-storage.service';\nimport type {\n  CreateConversationDto,\n  SendMessageDto,\n  UpdateMessageDto,\n  AddReactionDto,\n  BlockUserDto,\n  SearchMessagesDto,\n  ConversationListParams,\n} from './types';\n\n@Controller('messaging')\n@UseGuards(JwtAuthGuard)\nexport class MessagingController {\n  constructor(\n    private readonly messagingService: MessagingService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  // Conversation endpoints\n  @Post('conversations')\n  @HttpCode(HttpStatus.CREATED)\n  async createConversation(\n    @CurrentUserId() userId: string,\n    @Body() createConversationDto: CreateConversationDto,\n  ) {\n    return this.messagingService.createConversation(\n      userId,\n      createConversationDto,\n    );\n  }\n\n  @Get('conversations')\n  async getUserConversations(\n    @CurrentUserId() userId: string,\n    @Query() params: ConversationListParams,\n  ) {\n    console.log(\n      'ðŸš€ [MESSAGING CONTROLLER] getUserConversations endpoint called',\n    );\n    console.log('ðŸ‘¤ [USER ID]', userId);\n    console.log('ðŸ“Š [QUERY PARAMS]', params);\n\n    try {\n      const result = await this.messagingService.getUserConversations(\n        userId,\n        params.page || 1,\n        params.limit || 20,\n      );\n\n      console.log(\n        'âœ… [CONTROLLER RESPONSE] Returning',\n        result.length,\n        'conversations',\n      );\n      console.log(\n        'ðŸ“ [RESPONSE SUMMARY]:',\n        result.map((conv) => ({\n          id: conv.id,\n          type: conv.type,\n          title: conv.title,\n          participantCount: conv.participants?.length || 0,\n          messageCount: conv.messages?.length || 0,\n        })),\n      );\n\n      return result;\n    } catch (error) {\n      console.error(\n        'âŒ [CONTROLLER ERROR] getUserConversations failed:',\n        error,\n      );\n      throw error;\n    }\n  }\n\n  @Get('recent-communications')\n  async getRecentCommunications(\n    @CurrentUserId() userId: string,\n    @Query('limit') limit?: string,\n  ) {\n    console.log('ðŸ“ž [MESSAGING CONTROLLER] getRecentCommunications endpoint called');\n    console.log('ðŸ‘¤ [USER ID]', userId);\n    console.log('ðŸ“Š [LIMIT]', limit);\n    \n    try {\n      const limitNum = limit ? Number(limit) : 5;\n      const result = await this.messagingService.getRecentCommunications(\n        userId,\n        limitNum,\n      );\n      \n      console.log('âœ… [CONTROLLER RESPONSE] Returning', result.length, 'recent communications');\n      console.log('ðŸ“± [RESPONSE SUMMARY]:', result.map(comm => ({\n        id: comm?.id,\n        name: comm?.name,\n        role: comm?.role,\n        hasLastMessage: !!comm?.lastMessage,\n        unreadCount: comm?.unreadCount\n      })));\n      \n      return result;\n    } catch (error) {\n      console.error('âŒ [CONTROLLER ERROR] getRecentCommunications failed:', error);\n      throw error;\n    }\n  }\n\n  @Get('conversations/:conversationId/messages')\n  async getConversationMessages(\n    @CurrentUserId() userId: string,\n    @Param('conversationId') conversationId: string,\n    @Query() params: ConversationListParams,\n  ) {\n    const pageNum = params.page || 1;\n    const limitNum = params.limit || 50;\n    return this.messagingService.getConversationMessages(\n      userId,\n      conversationId,\n      pageNum,\n      limitNum,\n    );\n  }\n\n  // Message endpoints\n  @Post('conversations/:conversationId/messages')\n  @UseInterceptors(FilesInterceptor('files', 3)) // Support up to 3 files\n  @HttpCode(HttpStatus.CREATED)\n  async sendMessage(\n    @CurrentUserId() userId: string,\n    @Param('conversationId') conversationId: string,\n    @Body() sendMessageDto: SendMessageDto,\n    @UploadedFiles() files: Express.Multer.File[] = [], // Optional files\n  ) {\n    // Validate and upload files if provided\n    const fileResults: FileUploadResult[] = [];\n    if (files && files.length > 0) {\n      for (const file of files) {\n        const validation = this.supabaseStorageService.validateFile(file);\n        if (!validation.isValid) {\n          throw new HttpException(\n            `File validation failed: ${validation.error}`,\n            HttpStatus.BAD_REQUEST,\n          );\n        }\n      }\n\n      // Upload files to Supabase\n      const uploadResults = await this.supabaseStorageService.uploadFiles(\n        files,\n        SupabaseStorageService.getSupportedBuckets().MESSAGES,\n      );\n      fileResults.push(...uploadResults);\n    }\n\n    return this.messagingService.sendMessage(\n      userId,\n      conversationId,\n      sendMessageDto,\n      fileResults.map((f) => f.url),\n      fileResults.map((f) => f.filename),\n      files.map((f) => f.size),\n    );\n  }\n\n  @Put('messages/:messageId')\n  async updateMessage(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Body() updateMessageDto: UpdateMessageDto,\n  ) {\n    return this.messagingService.updateMessage(\n      userId,\n      messageId,\n      updateMessageDto,\n    );\n  }\n\n  @Delete('messages/:messageId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteMessage(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n  ) {\n    return this.messagingService.deleteMessage(userId, messageId);\n  }\n\n  // Read receipts\n  @Post('messages/:messageId/read')\n  @HttpCode(HttpStatus.OK)\n  async markMessageAsRead(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n  ) {\n    return this.messagingService.markMessageAsRead(userId, messageId);\n  }\n\n  // Message reactions\n  @Post('messages/:messageId/reactions')\n  @HttpCode(HttpStatus.CREATED)\n  async addMessageReaction(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Body() addReactionDto: AddReactionDto,\n  ) {\n    return this.messagingService.addMessageReaction(\n      userId,\n      messageId,\n      addReactionDto.emoji,\n    );\n  }\n\n  @Delete('messages/:messageId/reactions/:emoji')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async removeMessageReaction(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Param('emoji') emoji: string,\n  ) {\n    return this.messagingService.removeMessageReaction(\n      userId,\n      messageId,\n      emoji,\n    );\n  }\n\n  // User blocking\n  @Post('block')\n  @HttpCode(HttpStatus.CREATED)\n  async blockUser(\n    @CurrentUserId() userId: string,\n    @Body() blockUserDto: BlockUserDto,\n  ) {\n    return this.messagingService.blockUser(\n      userId,\n      blockUserDto.userId,\n      blockUserDto.reason,\n    );\n  }\n\n  @Delete('block/:blockedUserId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async unblockUser(\n    @CurrentUserId() userId: string,\n    @Param('blockedUserId') blockedUserId: string,\n  ) {\n    return this.messagingService.unblockUser(userId, blockedUserId);\n  }\n\n  // Search messages\n  @Get('search')\n  async searchMessages(\n    @CurrentUserId() userId: string,\n    @Query() searchDto: SearchMessagesDto,\n  ) {\n    const { query, conversationId, page, limit } = searchDto;\n    const pageNum = page ? Number(page) : 1;\n    const limitNum = limit ? Number(limit) : 20;\n    return this.messagingService.searchMessages(\n      userId,\n      query || '',\n      conversationId,\n      pageNum,\n      limitNum,\n    );\n  }\n}\n"],"version":3}