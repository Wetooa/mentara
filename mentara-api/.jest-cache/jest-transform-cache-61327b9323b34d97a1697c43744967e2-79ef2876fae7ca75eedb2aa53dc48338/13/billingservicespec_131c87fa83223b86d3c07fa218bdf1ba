3abd7298216f724753c264f3c8352f9f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const billing_service_1 = require("./billing.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
const test_utils_1 = require("../test-utils");
describe('BillingService', () => {
    let service;
    let prismaService;
    beforeEach(async () => {
        const mockPrisma = (0, test_utils_1.createMockPrismaService)();
        const module = await testing_1.Test.createTestingModule({
            providers: [
                billing_service_1.BillingService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrisma,
                },
            ],
        }).compile();
        service = module.get(billing_service_1.BillingService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Subscription Management', () => {
        describe('createSubscription', () => {
            const mockPlan = {
                id: 'plan-id',
                name: 'Premium Plan',
                tier: client_1.SubscriptionTier.PREMIUM,
                monthlyPrice: 29.99,
                yearlyPrice: 299.99,
            };
            const mockSubscriptionData = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                planId: 'plan-id',
                billingCycle: client_1.BillingCycle.MONTHLY,
            };
            it('should successfully create a monthly subscription', async () => {
                const expectedSubscription = {
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    planId: 'plan-id',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    billingCycle: client_1.BillingCycle.MONTHLY,
                    amount: 29.99,
                    status: client_1.SubscriptionStatus.ACTIVE,
                    plan: mockPlan,
                    defaultPaymentMethod: null,
                };
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(mockPlan);
                prismaService.subscription.create.mockResolvedValue(expectedSubscription);
                const result = await service.createSubscription(mockSubscriptionData);
                expect(result).toEqual(expectedSubscription);
                expect(prismaService.subscription.create).toHaveBeenCalledWith({
                    data: expect.objectContaining({
                        userId: test_utils_1.TEST_USER_IDS.CLIENT,
                        planId: 'plan-id',
                        tier: client_1.SubscriptionTier.PREMIUM,
                        billingCycle: client_1.BillingCycle.MONTHLY,
                        amount: 29.99,
                        status: client_1.SubscriptionStatus.ACTIVE,
                    }),
                    include: {
                        plan: true,
                        defaultPaymentMethod: true,
                    },
                });
            });
            it('should successfully create a yearly subscription', async () => {
                const yearlyData = {
                    ...mockSubscriptionData,
                    billingCycle: client_1.BillingCycle.YEARLY,
                };
                const expectedSubscription = {
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    amount: 299.99,
                    billingCycle: client_1.BillingCycle.YEARLY,
                };
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(mockPlan);
                prismaService.subscription.create.mockResolvedValue(expectedSubscription);
                const result = await service.createSubscription(yearlyData);
                expect(result.amount).toBe(299.99);
                expect(result.billingCycle).toBe(client_1.BillingCycle.YEARLY);
            });
            it('should create subscription with trial period', async () => {
                const trialStart = new Date();
                const trialEnd = new Date();
                trialEnd.setDate(trialEnd.getDate() + 14);
                const trialData = {
                    ...mockSubscriptionData,
                    trialStart,
                    trialEnd,
                };
                const expectedSubscription = {
                    id: 'subscription-id',
                    status: client_1.SubscriptionStatus.TRIALING,
                    trialStart,
                    trialEnd,
                };
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(mockPlan);
                prismaService.subscription.create.mockResolvedValue(expectedSubscription);
                const result = await service.createSubscription(trialData);
                expect(result.status).toBe(client_1.SubscriptionStatus.TRIALING);
                expect(prismaService.subscription.create).toHaveBeenCalledWith({
                    data: expect.objectContaining({
                        status: client_1.SubscriptionStatus.TRIALING,
                        trialStart,
                        trialEnd,
                    }),
                    include: expect.any(Object),
                });
            });
            it('should throw NotFoundException when plan does not exist', async () => {
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(null);
                await expect(service.createSubscription(mockSubscriptionData)).rejects.toThrow(common_1.NotFoundException);
                expect(prismaService.subscription.create).not.toHaveBeenCalled();
            });
        });
        describe('findUserSubscription', () => {
            it('should return user subscription with included data', async () => {
                const mockSubscription = {
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    plan: { name: 'Premium Plan' },
                    defaultPaymentMethod: { cardLast4: '4242' },
                    invoices: [{ id: 'invoice-1' }],
                };
                prismaService.subscription.findUnique.mockResolvedValue(mockSubscription);
                const result = await service.findUserSubscription(test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockSubscription);
                expect(prismaService.subscription.findUnique).toHaveBeenCalledWith({
                    where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                    include: {
                        plan: true,
                        defaultPaymentMethod: true,
                        invoices: {
                            orderBy: { createdAt: 'desc' },
                            take: 5,
                        },
                    },
                });
            });
            it('should return null when subscription does not exist', async () => {
                prismaService.subscription.findUnique.mockResolvedValue(null);
                const result = await service.findUserSubscription('non-existent-user');
                expect(result).toBeNull();
            });
        });
        describe('updateSubscription', () => {
            const mockSubscription = {
                id: 'subscription-id',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                planId: 'old-plan-id',
            };
            const mockNewPlan = {
                id: 'new-plan-id',
                tier: client_1.SubscriptionTier.ENTERPRISE,
                monthlyPrice: 99.99,
                yearlyPrice: 999.99,
            };
            it('should successfully update subscription plan', async () => {
                const updateData = {
                    planId: 'new-plan-id',
                    billingCycle: client_1.BillingCycle.MONTHLY,
                };
                const updatedSubscription = {
                    ...mockSubscription,
                    planId: 'new-plan-id',
                    tier: client_1.SubscriptionTier.ENTERPRISE,
                    amount: 99.99,
                };
                jest
                    .spyOn(service, 'findUserSubscription')
                    .mockResolvedValue(mockSubscription);
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(mockNewPlan);
                prismaService.subscription.update.mockResolvedValue(updatedSubscription);
                const result = await service.updateSubscription(test_utils_1.TEST_USER_IDS.CLIENT, updateData);
                expect(result).toEqual(updatedSubscription);
                expect(prismaService.subscription.update).toHaveBeenCalledWith({
                    where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                    data: expect.objectContaining({
                        planId: 'new-plan-id',
                        tier: client_1.SubscriptionTier.ENTERPRISE,
                        amount: 99.99,
                        billingCycle: client_1.BillingCycle.MONTHLY,
                    }),
                    include: expect.any(Object),
                });
            });
            it('should throw NotFoundException when subscription does not exist', async () => {
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(null);
                await expect(service.updateSubscription('non-existent-user', {
                    planId: 'new-plan',
                })).rejects.toThrow(common_1.NotFoundException);
            });
            it('should throw NotFoundException when new plan does not exist', async () => {
                jest
                    .spyOn(service, 'findUserSubscription')
                    .mockResolvedValue(mockSubscription);
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(null);
                await expect(service.updateSubscription(test_utils_1.TEST_USER_IDS.CLIENT, {
                    planId: 'non-existent-plan',
                })).rejects.toThrow(common_1.NotFoundException);
            });
        });
        describe('cancelSubscription', () => {
            it('should cancel subscription by updating status', async () => {
                const canceledSubscription = {
                    id: 'subscription-id',
                    status: client_1.SubscriptionStatus.CANCELED,
                };
                jest
                    .spyOn(service, 'updateSubscription')
                    .mockResolvedValue(canceledSubscription);
                const result = await service.cancelSubscription(test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result.status).toBe(client_1.SubscriptionStatus.CANCELED);
                expect(service.updateSubscription).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, {
                    status: client_1.SubscriptionStatus.CANCELED,
                });
            });
        });
    });
    describe('Subscription Plans', () => {
        describe('createSubscriptionPlan', () => {
            it('should successfully create a subscription plan', async () => {
                const planData = {
                    name: 'Premium Plan',
                    description: 'Full access plan',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    monthlyPrice: 29.99,
                    yearlyPrice: 299.99,
                    features: { sessions: 'unlimited', storage: '100GB' },
                    limits: { clients: 50 },
                    trialDays: 14,
                };
                const expectedPlan = {
                    id: 'plan-id',
                    ...planData,
                };
                prismaService.subscriptionPlan.create.mockResolvedValue(expectedPlan);
                const result = await service.createSubscriptionPlan(planData);
                expect(result).toEqual(expectedPlan);
                expect(prismaService.subscriptionPlan.create).toHaveBeenCalledWith({
                    data: planData,
                });
            });
        });
        describe('findAllPlans', () => {
            it('should return active plans by default', async () => {
                const mockPlans = [
                    { id: 'plan-1', name: 'Basic', monthlyPrice: 9.99 },
                    { id: 'plan-2', name: 'Premium', monthlyPrice: 29.99 },
                ];
                prismaService.subscriptionPlan.findMany.mockResolvedValue(mockPlans);
                const result = await service.findAllPlans();
                expect(result).toEqual(mockPlans);
                expect(prismaService.subscriptionPlan.findMany).toHaveBeenCalledWith({
                    where: { isActive: true },
                    orderBy: { monthlyPrice: 'asc' },
                });
            });
            it('should return inactive plans when specified', async () => {
                await service.findAllPlans(false);
                expect(prismaService.subscriptionPlan.findMany).toHaveBeenCalledWith({
                    where: { isActive: false },
                    orderBy: { monthlyPrice: 'asc' },
                });
            });
        });
        describe('updatePlan', () => {
            it('should successfully update plan', async () => {
                const updateData = {
                    name: 'Updated Plan',
                    monthlyPrice: 39.99,
                    features: { newFeature: true },
                };
                const updatedPlan = {
                    id: 'plan-id',
                    ...updateData,
                };
                prismaService.subscriptionPlan.update.mockResolvedValue(updatedPlan);
                const result = await service.updatePlan('plan-id', updateData);
                expect(result).toEqual(updatedPlan);
                expect(prismaService.subscriptionPlan.update).toHaveBeenCalledWith({
                    where: { id: 'plan-id' },
                    data: updateData,
                });
            });
        });
    });
    describe('Payment Methods', () => {
        describe('createPaymentMethod', () => {
            it('should create payment method and set as default', async () => {
                const paymentMethodData = {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    type: client_1.PaymentMethodType.CARD,
                    cardLast4: '4242',
                    cardBrand: 'visa',
                    cardExpMonth: 12,
                    cardExpYear: 2025,
                    isDefault: true,
                };
                const expectedPaymentMethod = {
                    id: 'payment-method-id',
                    ...paymentMethodData,
                };
                prismaService.paymentMethod.updateMany.mockResolvedValue({ count: 1 });
                prismaService.paymentMethod.create.mockResolvedValue(expectedPaymentMethod);
                const result = await service.createPaymentMethod(paymentMethodData);
                expect(result).toEqual(expectedPaymentMethod);
                expect(prismaService.paymentMethod.updateMany).toHaveBeenCalledWith({
                    where: { userId: test_utils_1.TEST_USER_IDS.CLIENT, isDefault: true },
                    data: { isDefault: false },
                });
                expect(prismaService.paymentMethod.create).toHaveBeenCalledWith({
                    data: paymentMethodData,
                });
            });
            it('should create payment method without setting as default', async () => {
                const paymentMethodData = {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    type: client_1.PaymentMethodType.CARD,
                    cardLast4: '4242',
                };
                prismaService.paymentMethod.create.mockResolvedValue(paymentMethodData);
                await service.createPaymentMethod(paymentMethodData);
                expect(prismaService.paymentMethod.updateMany).not.toHaveBeenCalled();
            });
        });
        describe('findUserPaymentMethods', () => {
            it('should return user payment methods ordered by default and creation date', async () => {
                const mockPaymentMethods = [
                    { id: 'pm-1', isDefault: true, cardLast4: '4242' },
                    { id: 'pm-2', isDefault: false, cardLast4: '1234' },
                ];
                prismaService.paymentMethod.findMany.mockResolvedValue(mockPaymentMethods);
                const result = await service.findUserPaymentMethods(test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockPaymentMethods);
                expect(prismaService.paymentMethod.findMany).toHaveBeenCalledWith({
                    where: { userId: test_utils_1.TEST_USER_IDS.CLIENT, isActive: true },
                    orderBy: [{ isDefault: 'desc' }, { createdAt: 'desc' }],
                });
            });
        });
        describe('updatePaymentMethod', () => {
            const mockPaymentMethod = {
                id: 'payment-method-id',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
            };
            it('should successfully update payment method', async () => {
                const updateData = { isDefault: true };
                const updatedPaymentMethod = { ...mockPaymentMethod, ...updateData };
                prismaService.paymentMethod.findUnique.mockResolvedValue(mockPaymentMethod);
                prismaService.paymentMethod.updateMany.mockResolvedValue({ count: 1 });
                prismaService.paymentMethod.update.mockResolvedValue(updatedPaymentMethod);
                const result = await service.updatePaymentMethod('payment-method-id', updateData);
                expect(result).toEqual(updatedPaymentMethod);
                expect(prismaService.paymentMethod.updateMany).toHaveBeenCalledWith({
                    where: { userId: test_utils_1.TEST_USER_IDS.CLIENT, isDefault: true },
                    data: { isDefault: false },
                });
            });
            it('should throw NotFoundException when payment method does not exist', async () => {
                prismaService.paymentMethod.findUnique.mockResolvedValue(null);
                await expect(service.updatePaymentMethod('non-existent-id', { isDefault: true })).rejects.toThrow(common_1.NotFoundException);
            });
        });
        describe('deletePaymentMethod', () => {
            it('should soft delete payment method by setting isActive to false', async () => {
                const deactivatedPaymentMethod = {
                    id: 'payment-method-id',
                    isActive: false,
                };
                prismaService.paymentMethod.update.mockResolvedValue(deactivatedPaymentMethod);
                const result = await service.deletePaymentMethod('payment-method-id');
                expect(result).toEqual(deactivatedPaymentMethod);
                expect(prismaService.paymentMethod.update).toHaveBeenCalledWith({
                    where: { id: 'payment-method-id' },
                    data: { isActive: false },
                });
            });
        });
    });
    describe('Payments', () => {
        describe('createPayment', () => {
            it('should create payment with default values', async () => {
                const paymentData = {
                    amount: 29.99,
                    paymentMethodId: 'payment-method-id',
                    subscriptionId: 'subscription-id',
                    description: 'Monthly subscription',
                };
                const expectedPayment = {
                    id: 'payment-id',
                    ...paymentData,
                    status: client_1.PaymentStatus.PENDING,
                    currency: 'USD',
                    paymentMethod: { cardLast4: '4242' },
                    subscription: { tier: client_1.SubscriptionTier.PREMIUM },
                    invoice: null,
                };
                prismaService.payment.create.mockResolvedValue(expectedPayment);
                const result = await service.createPayment(paymentData);
                expect(result).toEqual(expectedPayment);
                expect(prismaService.payment.create).toHaveBeenCalledWith({
                    data: {
                        ...paymentData,
                        status: client_1.PaymentStatus.PENDING,
                        currency: 'USD',
                    },
                    include: {
                        paymentMethod: true,
                        subscription: true,
                        invoice: true,
                    },
                });
            });
            it('should create payment with custom currency', async () => {
                const paymentData = {
                    amount: 25.99,
                    currency: 'EUR',
                };
                prismaService.payment.create.mockResolvedValue({
                    id: 'payment-id',
                    currency: 'EUR',
                });
                await service.createPayment(paymentData);
                expect(prismaService.payment.create).toHaveBeenCalledWith({
                    data: expect.objectContaining({
                        currency: 'EUR',
                    }),
                    include: expect.any(Object),
                });
            });
        });
        describe('updatePaymentStatus', () => {
            it('should update payment status to succeeded', async () => {
                const updatedPayment = {
                    id: 'payment-id',
                    status: client_1.PaymentStatus.SUCCEEDED,
                    processedAt: expect.any(Date),
                };
                prismaService.payment.update.mockResolvedValue(updatedPayment);
                const result = await service.updatePaymentStatus('payment-id', client_1.PaymentStatus.SUCCEEDED);
                expect(result).toEqual(updatedPayment);
                expect(prismaService.payment.update).toHaveBeenCalledWith({
                    where: { id: 'payment-id' },
                    data: {
                        status: client_1.PaymentStatus.SUCCEEDED,
                        processedAt: expect.any(Date),
                    },
                });
            });
            it('should update payment status to failed with metadata', async () => {
                const metadata = {
                    failureCode: 'card_declined',
                    failureMessage: 'Your card was declined.',
                };
                const updatedPayment = {
                    id: 'payment-id',
                    status: client_1.PaymentStatus.FAILED,
                    failedAt: expect.any(Date),
                    failureCode: 'card_declined',
                    failureMessage: 'Your card was declined.',
                };
                prismaService.payment.update.mockResolvedValue(updatedPayment);
                const result = await service.updatePaymentStatus('payment-id', client_1.PaymentStatus.FAILED, metadata);
                expect(result).toEqual(updatedPayment);
                expect(prismaService.payment.update).toHaveBeenCalledWith({
                    where: { id: 'payment-id' },
                    data: {
                        status: client_1.PaymentStatus.FAILED,
                        failedAt: expect.any(Date),
                        failureCode: 'card_declined',
                        failureMessage: 'Your card was declined.',
                    },
                });
            });
        });
        describe('findPayments', () => {
            it('should return payments with filters', async () => {
                const mockPayments = [
                    { id: 'payment-1', status: client_1.PaymentStatus.SUCCEEDED },
                    { id: 'payment-2', status: client_1.PaymentStatus.SUCCEEDED },
                ];
                const startDate = new Date('2024-01-01');
                const endDate = new Date('2024-01-31');
                prismaService.payment.findMany.mockResolvedValue(mockPayments);
                const result = await service.findPayments('subscription-id', client_1.PaymentStatus.SUCCEEDED, startDate, endDate);
                expect(result).toEqual(mockPayments);
                expect(prismaService.payment.findMany).toHaveBeenCalledWith({
                    where: {
                        subscriptionId: 'subscription-id',
                        status: client_1.PaymentStatus.SUCCEEDED,
                        createdAt: {
                            gte: startDate,
                            lte: endDate,
                        },
                    },
                    include: {
                        paymentMethod: true,
                        subscription: true,
                        invoice: true,
                    },
                    orderBy: { createdAt: 'desc' },
                });
            });
        });
    });
    describe('Invoices', () => {
        describe('createInvoice', () => {
            it('should create invoice with calculated total', async () => {
                const invoiceData = {
                    subscriptionId: 'subscription-id',
                    subtotal: 100,
                    taxAmount: 10,
                    discountAmount: 5,
                    dueDate: new Date('2024-02-01'),
                };
                const expectedInvoice = {
                    id: 'invoice-id',
                    ...invoiceData,
                    number: 'INV-2024-000001',
                    total: 105, // 100 + 10 - 5
                    amountDue: 105,
                    status: client_1.InvoiceStatus.OPEN,
                };
                // Mock generateInvoiceNumber
                jest
                    .spyOn(service, 'generateInvoiceNumber')
                    .mockResolvedValue('INV-2024-000001');
                prismaService.invoice.create.mockResolvedValue(expectedInvoice);
                const result = await service.createInvoice(invoiceData);
                expect(result).toEqual(expectedInvoice);
                expect(prismaService.invoice.create).toHaveBeenCalledWith({
                    data: {
                        ...invoiceData,
                        number: 'INV-2024-000001',
                        total: 105,
                        amountDue: 105,
                        status: client_1.InvoiceStatus.OPEN,
                    },
                    include: {
                        subscription: true,
                        lineItems: true,
                    },
                });
            });
        });
        describe('findInvoices', () => {
            it('should return invoices with filters', async () => {
                const mockInvoices = [
                    { id: 'invoice-1', status: client_1.InvoiceStatus.OPEN },
                    { id: 'invoice-2', status: client_1.InvoiceStatus.PAID },
                ];
                prismaService.invoice.findMany.mockResolvedValue(mockInvoices);
                const result = await service.findInvoices('subscription-id', client_1.InvoiceStatus.OPEN);
                expect(result).toEqual(mockInvoices);
                expect(prismaService.invoice.findMany).toHaveBeenCalledWith({
                    where: {
                        subscriptionId: 'subscription-id',
                        status: client_1.InvoiceStatus.OPEN,
                    },
                    include: {
                        subscription: {
                            include: { user: true },
                        },
                        lineItems: true,
                        payments: true,
                    },
                    orderBy: { createdAt: 'desc' },
                });
            });
        });
        describe('markInvoiceAsPaid', () => {
            it('should mark invoice as paid when fully paid', async () => {
                const mockInvoice = {
                    id: 'invoice-id',
                    total: 100,
                    payments: [
                        { amount: 60, status: client_1.PaymentStatus.SUCCEEDED },
                        { amount: 40, status: client_1.PaymentStatus.SUCCEEDED },
                    ],
                };
                const updatedInvoice = {
                    ...mockInvoice,
                    status: client_1.InvoiceStatus.PAID,
                    amountPaid: 100,
                    paidAt: expect.any(Date),
                };
                prismaService.invoice.findUnique.mockResolvedValue(mockInvoice);
                prismaService.invoice.update.mockResolvedValue(updatedInvoice);
                const result = await service.markInvoiceAsPaid('invoice-id');
                expect(result).toEqual(updatedInvoice);
                expect(prismaService.invoice.update).toHaveBeenCalledWith({
                    where: { id: 'invoice-id' },
                    data: {
                        status: client_1.InvoiceStatus.PAID,
                        amountPaid: 100,
                        paidAt: expect.any(Date),
                    },
                });
            });
            it('should keep invoice open when partially paid', async () => {
                const mockInvoice = {
                    id: 'invoice-id',
                    total: 100,
                    payments: [
                        { amount: 30, status: client_1.PaymentStatus.SUCCEEDED },
                        { amount: 20, status: client_1.PaymentStatus.FAILED },
                    ],
                };
                prismaService.invoice.findUnique.mockResolvedValue(mockInvoice);
                prismaService.invoice.update.mockResolvedValue({
                    ...mockInvoice,
                    status: client_1.InvoiceStatus.OPEN,
                    amountPaid: 30,
                });
                const result = await service.markInvoiceAsPaid('invoice-id');
                expect(result.status).toBe(client_1.InvoiceStatus.OPEN);
                expect(result.amountPaid).toBe(30);
            });
            it('should throw NotFoundException when invoice does not exist', async () => {
                prismaService.invoice.findUnique.mockResolvedValue(null);
                await expect(service.markInvoiceAsPaid('non-existent-id')).rejects.toThrow(common_1.NotFoundException);
            });
        });
    });
    describe('Discounts', () => {
        describe('createDiscount', () => {
            it('should create discount with default valid from date', async () => {
                const discountData = {
                    code: 'SAVE20',
                    name: '20% Off',
                    type: client_1.DiscountType.PERCENTAGE,
                    percentOff: 20,
                };
                const expectedDiscount = {
                    id: 'discount-id',
                    ...discountData,
                    validFrom: expect.any(Date),
                };
                prismaService.discount.create.mockResolvedValue(expectedDiscount);
                const result = await service.createDiscount(discountData);
                expect(result).toEqual(expectedDiscount);
                expect(prismaService.discount.create).toHaveBeenCalledWith({
                    data: {
                        ...discountData,
                        validFrom: expect.any(Date),
                    },
                });
            });
        });
        describe('validateDiscount', () => {
            const mockDiscount = {
                id: 'discount-id',
                code: 'SAVE20',
                isActive: true,
                validUntil: new Date('2024-12-31'),
                maxUses: 100,
                currentUses: 50,
                maxUsesPerUser: 1,
                minAmount: 50,
                redemptions: [],
            };
            it('should return valid discount', async () => {
                prismaService.discount.findUnique.mockResolvedValue(mockDiscount);
                const result = await service.validateDiscount('SAVE20', test_utils_1.TEST_USER_IDS.CLIENT, 100);
                expect(result).toEqual(mockDiscount);
            });
            it('should throw BadRequestException for invalid discount code', async () => {
                prismaService.discount.findUnique.mockResolvedValue(null);
                await expect(service.validateDiscount('INVALID', test_utils_1.TEST_USER_IDS.CLIENT, 100)).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw BadRequestException for inactive discount', async () => {
                prismaService.discount.findUnique.mockResolvedValue({
                    ...mockDiscount,
                    isActive: false,
                });
                await expect(service.validateDiscount('SAVE20', test_utils_1.TEST_USER_IDS.CLIENT, 100)).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw BadRequestException for expired discount', async () => {
                prismaService.discount.findUnique.mockResolvedValue({
                    ...mockDiscount,
                    validUntil: new Date('2020-01-01'), // Expired
                });
                await expect(service.validateDiscount('SAVE20', test_utils_1.TEST_USER_IDS.CLIENT, 100)).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw BadRequestException when max uses reached', async () => {
                prismaService.discount.findUnique.mockResolvedValue({
                    ...mockDiscount,
                    maxUses: 50,
                    currentUses: 50, // Reached limit
                });
                await expect(service.validateDiscount('SAVE20', test_utils_1.TEST_USER_IDS.CLIENT, 100)).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw BadRequestException when user has already used discount', async () => {
                prismaService.discount.findUnique.mockResolvedValue({
                    ...mockDiscount,
                    redemptions: [{ userId: test_utils_1.TEST_USER_IDS.CLIENT }], // User already used
                });
                await expect(service.validateDiscount('SAVE20', test_utils_1.TEST_USER_IDS.CLIENT, 100)).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw BadRequestException when amount is below minimum', async () => {
                await expect(service.validateDiscount('SAVE20', test_utils_1.TEST_USER_IDS.CLIENT, 25)).rejects.toThrow(common_1.BadRequestException);
            });
        });
        describe('redeemDiscount', () => {
            it('should redeem discount in transaction', async () => {
                const mockTransaction = {
                    ...(0, test_utils_1.createMockPrismaService)(),
                    discountRedemption: {
                        create: jest.fn(),
                    },
                    discount: {
                        update: jest.fn(),
                    },
                };
                prismaService.$transaction.mockImplementation(async (callback) => {
                    return callback(mockTransaction);
                });
                await service.redeemDiscount('discount-id', test_utils_1.TEST_USER_IDS.CLIENT, 20);
                expect(mockTransaction.discountRedemption.create).toHaveBeenCalledWith({
                    data: {
                        discountId: 'discount-id',
                        userId: test_utils_1.TEST_USER_IDS.CLIENT,
                        amountSaved: 20,
                    },
                });
                expect(mockTransaction.discount.update).toHaveBeenCalledWith({
                    where: { id: 'discount-id' },
                    data: {
                        currentUses: { increment: 1 },
                    },
                });
            });
        });
    });
    describe('Usage Records', () => {
        describe('recordUsage', () => {
            it('should create usage record with default date', async () => {
                const usageData = {
                    subscriptionId: 'subscription-id',
                    feature: 'api_calls',
                    quantity: 100,
                    unit: 'requests',
                    metadata: { endpoint: '/api/users' },
                };
                const expectedUsage = {
                    id: 'usage-id',
                    ...usageData,
                    usageDate: expect.any(Date),
                };
                prismaService.usageRecord.create.mockResolvedValue(expectedUsage);
                const result = await service.recordUsage(usageData);
                expect(result).toEqual(expectedUsage);
                expect(prismaService.usageRecord.create).toHaveBeenCalledWith({
                    data: {
                        ...usageData,
                        usageDate: expect.any(Date),
                    },
                });
            });
        });
        describe('getUsageRecords', () => {
            it('should return usage records with filters', async () => {
                const mockUsageRecords = [
                    { id: 'usage-1', feature: 'api_calls', quantity: 100 },
                    { id: 'usage-2', feature: 'api_calls', quantity: 50 },
                ];
                const startDate = new Date('2024-01-01');
                const endDate = new Date('2024-01-31');
                prismaService.usageRecord.findMany.mockResolvedValue(mockUsageRecords);
                const result = await service.getUsageRecords('subscription-id', 'api_calls', startDate, endDate);
                expect(result).toEqual(mockUsageRecords);
                expect(prismaService.usageRecord.findMany).toHaveBeenCalledWith({
                    where: {
                        subscriptionId: 'subscription-id',
                        feature: 'api_calls',
                        usageDate: {
                            gte: startDate,
                            lte: endDate,
                        },
                    },
                    orderBy: { usageDate: 'desc' },
                });
            });
        });
    });
    describe('Helper Methods', () => {
        describe('generateInvoiceNumber', () => {
            it('should generate first invoice number for year', async () => {
                prismaService.invoice.findFirst.mockResolvedValue(null);
                const result = await service.generateInvoiceNumber();
                const currentYear = new Date().getFullYear();
                expect(result).toBe(`INV-${currentYear}-000001`);
            });
            it('should increment from last invoice number', async () => {
                const currentYear = new Date().getFullYear();
                const lastInvoice = {
                    number: `INV-${currentYear}-000005`,
                };
                prismaService.invoice.findFirst.mockResolvedValue(lastInvoice);
                const result = await service.generateInvoiceNumber();
                expect(result).toBe(`INV-${currentYear}-000006`);
            });
            it('should handle invalid invoice number format', async () => {
                const lastInvoice = {
                    number: 'INVALID-FORMAT',
                };
                prismaService.invoice.findFirst.mockResolvedValue(lastInvoice);
                const result = await service.generateInvoiceNumber();
                const currentYear = new Date().getFullYear();
                expect(result).toBe(`INV-${currentYear}-000001`);
            });
        });
        describe('getBillingStatistics', () => {
            it('should return billing statistics', async () => {
                const mockStats = {
                    totalRevenue: { _sum: { amount: 10000 } },
                    activeSubscriptions: 25,
                    trialSubscriptions: 5,
                    canceledSubscriptions: 10,
                    subscriptionsByTier: [
                        { tier: client_1.SubscriptionTier.BASIC, _count: { tier: 10 } },
                        { tier: client_1.SubscriptionTier.PREMIUM, _count: { tier: 15 } },
                    ],
                };
                prismaService.payment.aggregate.mockResolvedValue(mockStats.totalRevenue);
                prismaService.subscription.count
                    .mockResolvedValueOnce(mockStats.activeSubscriptions)
                    .mockResolvedValueOnce(mockStats.trialSubscriptions)
                    .mockResolvedValueOnce(mockStats.canceledSubscriptions);
                prismaService.subscription.groupBy.mockResolvedValue(mockStats.subscriptionsByTier);
                const result = await service.getBillingStatistics();
                expect(result).toEqual({
                    totalRevenue: 10000,
                    activeSubscriptions: 25,
                    trialSubscriptions: 5,
                    canceledSubscriptions: 10,
                    subscriptionsByTier: mockStats.subscriptionsByTier,
                });
            });
            it('should handle null revenue sum', async () => {
                prismaService.payment.aggregate.mockResolvedValue({
                    _sum: { amount: null },
                });
                prismaService.subscription.count.mockResolvedValue(0);
                prismaService.subscription.groupBy.mockResolvedValue([]);
                const result = await service.getBillingStatistics();
                expect(result.totalRevenue).toBe(0);
            });
        });
    });
    describe('Error Handling', () => {
        it('should handle database errors in createSubscription', async () => {
            prismaService.subscriptionPlan.findUnique.mockResolvedValue({
                id: 'plan-id',
                monthlyPrice: 29.99,
            });
            prismaService.subscription.create.mockRejectedValue(new Error('Database error'));
            await expect(service.createSubscription({
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                planId: 'plan-id',
            })).rejects.toThrow('Database error');
        });
        it('should handle database errors in payment operations', async () => {
            prismaService.payment.create.mockRejectedValue(new Error('Payment creation failed'));
            await expect(service.createPayment({
                amount: 29.99,
            })).rejects.toThrow('Payment creation failed');
        });
        it('should handle transaction errors in discount redemption', async () => {
            prismaService.$transaction.mockRejectedValue(new Error('Transaction failed'));
            await expect(service.redeemDiscount('discount-id', test_utils_1.TEST_USER_IDS.CLIENT, 20)).rejects.toThrow('Transaction failed');
            // Verify no partial state changes
            expect(prismaService.discountRedemption.create).not.toHaveBeenCalled();
        });
    });
    describe('Advanced Subscription Management', () => {
        const mockSubscription = {
            id: 'subscription-id',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            planId: 'old-plan-id',
            tier: client_1.SubscriptionTier.BASIC,
            billingCycle: client_1.BillingCycle.MONTHLY,
            amount: 9.99,
            status: client_1.SubscriptionStatus.ACTIVE,
            currentPeriodStart: new Date('2024-01-01'),
            currentPeriodEnd: new Date('2024-02-01'),
            plan: {
                id: 'old-plan-id',
                monthlyPrice: 9.99,
                yearlyPrice: 99.99,
            },
        };
        const mockNewPlan = {
            id: 'new-plan-id',
            tier: client_1.SubscriptionTier.PREMIUM,
            monthlyPrice: 29.99,
            yearlyPrice: 299.99,
        };
        describe('changeSubscriptionPlan', () => {
            beforeEach(() => {
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(mockSubscription);
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(mockNewPlan);
            });
            it('should change plan with immediate proration', async () => {
                const options = {
                    billingCycle: client_1.BillingCycle.MONTHLY,
                    prorationBehavior: 'create_prorations',
                    effectiveDate: new Date('2024-01-15'),
                };
                const expectedUpdate = {
                    ...mockSubscription,
                    planId: 'new-plan-id',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    amount: 29.99,
                };
                const mockProrationCredit = {
                    id: 'credit-id',
                    amount: -5.00,
                    description: 'Proration credit for plan change',
                };
                const mockProrationCharge = {
                    id: 'charge-id',
                    amount: 15.00,
                    description: 'Proration charge for plan change',
                };
                prismaService.$transaction.mockImplementation(async (callback) => {
                    const mockTxn = {
                        subscription: {
                            update: jest.fn().mockResolvedValue(expectedUpdate),
                        },
                        invoice: {
                            create: jest.fn().mockResolvedValue({
                                id: 'proration-invoice',
                                lineItems: [mockProrationCredit, mockProrationCharge],
                            }),
                        },
                        invoiceLineItem: {
                            createMany: jest.fn(),
                        },
                    };
                    return callback(mockTxn);
                });
                const result = await service.changeSubscriptionPlan(test_utils_1.TEST_USER_IDS.CLIENT, 'new-plan-id', options);
                expect(result).toEqual(expectedUpdate);
                expect(prismaService.$transaction).toHaveBeenCalled();
            });
            it('should change plan with no proration', async () => {
                const options = {
                    billingCycle: client_1.BillingCycle.MONTHLY,
                    prorationBehavior: 'none',
                };
                const expectedUpdate = {
                    ...mockSubscription,
                    planId: 'new-plan-id',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    amount: 29.99,
                };
                prismaService.subscription.update.mockResolvedValue(expectedUpdate);
                const result = await service.changeSubscriptionPlan(test_utils_1.TEST_USER_IDS.CLIENT, 'new-plan-id', options);
                expect(result).toEqual(expectedUpdate);
                expect(prismaService.subscription.update).toHaveBeenCalledWith({
                    where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                    data: {
                        planId: 'new-plan-id',
                        tier: client_1.SubscriptionTier.PREMIUM,
                        amount: 29.99,
                        billingCycle: client_1.BillingCycle.MONTHLY,
                    },
                    include: expect.any(Object),
                });
            });
            it('should change plan with effective date in future', async () => {
                const futureDate = new Date('2024-02-01');
                const options = {
                    billingCycle: client_1.BillingCycle.YEARLY,
                    effectiveDate: futureDate,
                    prorationBehavior: 'none',
                };
                const expectedUpdate = {
                    ...mockSubscription,
                    planId: 'new-plan-id',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    amount: 299.99,
                    scheduledPlanChange: {
                        newPlanId: 'new-plan-id',
                        effectiveDate: futureDate,
                    },
                };
                prismaService.subscription.update.mockResolvedValue(expectedUpdate);
                const result = await service.changeSubscriptionPlan(test_utils_1.TEST_USER_IDS.CLIENT, 'new-plan-id', options);
                expect(result.scheduledPlanChange).toBeDefined();
                expect(result.scheduledPlanChange.effectiveDate).toEqual(futureDate);
            });
            it('should throw error when changing to same plan', async () => {
                await expect(service.changeSubscriptionPlan(test_utils_1.TEST_USER_IDS.CLIENT, 'old-plan-id', { billingCycle: client_1.BillingCycle.MONTHLY })).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw error when subscription is canceled', async () => {
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue({
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.CANCELED,
                });
                await expect(service.changeSubscriptionPlan(test_utils_1.TEST_USER_IDS.CLIENT, 'new-plan-id', { billingCycle: client_1.BillingCycle.MONTHLY })).rejects.toThrow(common_1.BadRequestException);
            });
        });
        describe('pauseSubscription', () => {
            it('should pause subscription with specified date', async () => {
                const pauseUntil = new Date('2024-03-01');
                const options = {
                    pauseUntil,
                    reason: 'Financial hardship',
                };
                const pausedSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.PAUSED,
                    pausedAt: new Date(),
                    pauseUntil,
                    pauseReason: 'Financial hardship',
                };
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(pausedSubscription);
                const result = await service.pauseSubscription(test_utils_1.TEST_USER_IDS.CLIENT, options);
                expect(result.status).toBe(client_1.SubscriptionStatus.PAUSED);
                expect(result.pauseUntil).toEqual(pauseUntil);
                expect(service.updateSubscription).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, {
                    status: client_1.SubscriptionStatus.PAUSED,
                    pausedAt: expect.any(Date),
                    pauseUntil,
                    pauseReason: 'Financial hardship',
                });
            });
            it('should pause subscription indefinitely', async () => {
                const options = {
                    reason: 'Temporary break',
                };
                const pausedSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.PAUSED,
                    pausedAt: new Date(),
                    pauseReason: 'Temporary break',
                };
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(pausedSubscription);
                const result = await service.pauseSubscription(test_utils_1.TEST_USER_IDS.CLIENT, options);
                expect(result.status).toBe(client_1.SubscriptionStatus.PAUSED);
                expect(result.pauseUntil).toBeUndefined();
            });
        });
        describe('resumeSubscription', () => {
            it('should resume paused subscription', async () => {
                const pausedSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.PAUSED,
                    pausedAt: new Date('2024-01-15'),
                    pauseUntil: new Date('2024-03-01'),
                };
                const resumedSubscription = {
                    ...pausedSubscription,
                    status: client_1.SubscriptionStatus.ACTIVE,
                    pausedAt: null,
                    pauseUntil: null,
                    pauseReason: null,
                    resumedAt: new Date(),
                };
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(pausedSubscription);
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(resumedSubscription);
                const result = await service.resumeSubscription(test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result.status).toBe(client_1.SubscriptionStatus.ACTIVE);
                expect(result.resumedAt).toBeDefined();
                expect(service.updateSubscription).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.CLIENT, {
                    status: client_1.SubscriptionStatus.ACTIVE,
                    pausedAt: null,
                    pauseUntil: null,
                    pauseReason: null,
                    resumedAt: expect.any(Date),
                });
            });
            it('should throw error when subscription is not paused', async () => {
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(mockSubscription);
                await expect(service.resumeSubscription(test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.BadRequestException);
            });
        });
        describe('scheduleSubscriptionCancellation', () => {
            it('should schedule cancellation at period end', async () => {
                const scheduleData = {
                    cancelAtPeriodEnd: true,
                    reason: 'No longer needed',
                };
                const scheduledSubscription = {
                    ...mockSubscription,
                    cancelAtPeriodEnd: true,
                    canceledAt: new Date(),
                    cancellationReason: 'No longer needed',
                    cancellationEffectiveDate: mockSubscription.currentPeriodEnd,
                };
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(scheduledSubscription);
                const result = await service.scheduleSubscriptionCancellation(test_utils_1.TEST_USER_IDS.CLIENT, scheduleData);
                expect(result.cancelAtPeriodEnd).toBe(true);
                expect(result.cancellationEffectiveDate).toEqual(mockSubscription.currentPeriodEnd);
            });
            it('should schedule immediate cancellation', async () => {
                const scheduleData = {
                    cancelAtPeriodEnd: false,
                    reason: 'Dissatisfied with service',
                };
                const canceledSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.CANCELED,
                    canceledAt: new Date(),
                    cancellationReason: 'Dissatisfied with service',
                    cancellationEffectiveDate: new Date(),
                };
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(canceledSubscription);
                const result = await service.scheduleSubscriptionCancellation(test_utils_1.TEST_USER_IDS.CLIENT, scheduleData);
                expect(result.status).toBe(client_1.SubscriptionStatus.CANCELED);
                expect(result.cancellationReason).toBe('Dissatisfied with service');
            });
        });
        describe('reactivateSubscription', () => {
            it('should reactivate canceled subscription with new payment method', async () => {
                const canceledSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.CANCELED,
                    canceledAt: new Date('2024-01-15'),
                };
                const newPaymentMethod = {
                    id: 'new-payment-method-id',
                    type: client_1.PaymentMethodType.CARD,
                    isDefault: true,
                };
                const reactivatedSubscription = {
                    ...canceledSubscription,
                    status: client_1.SubscriptionStatus.ACTIVE,
                    canceledAt: null,
                    cancellationReason: null,
                    reactivatedAt: new Date(),
                    defaultPaymentMethodId: 'new-payment-method-id',
                };
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(canceledSubscription);
                prismaService.paymentMethod.findUnique.mockResolvedValue(newPaymentMethod);
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(reactivatedSubscription);
                const result = await service.reactivateSubscription(test_utils_1.TEST_USER_IDS.CLIENT, 'new-payment-method-id');
                expect(result.status).toBe(client_1.SubscriptionStatus.ACTIVE);
                expect(result.reactivatedAt).toBeDefined();
                expect(result.defaultPaymentMethodId).toBe('new-payment-method-id');
            });
            it('should reactivate subscription without changing payment method', async () => {
                const canceledSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.CANCELED,
                    defaultPaymentMethodId: 'existing-payment-method',
                };
                const reactivatedSubscription = {
                    ...canceledSubscription,
                    status: client_1.SubscriptionStatus.ACTIVE,
                    canceledAt: null,
                    reactivatedAt: new Date(),
                };
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(canceledSubscription);
                jest.spyOn(service, 'updateSubscription').mockResolvedValue(reactivatedSubscription);
                const result = await service.reactivateSubscription(test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result.status).toBe(client_1.SubscriptionStatus.ACTIVE);
                expect(result.defaultPaymentMethodId).toBe('existing-payment-method');
            });
            it('should throw error when subscription is not canceled', async () => {
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(mockSubscription);
                await expect(service.reactivateSubscription(test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.BadRequestException);
            });
            it('should throw error when payment method does not exist', async () => {
                const canceledSubscription = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.CANCELED,
                };
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(canceledSubscription);
                prismaService.paymentMethod.findUnique.mockResolvedValue(null);
                await expect(service.reactivateSubscription(test_utils_1.TEST_USER_IDS.CLIENT, 'non-existent-payment-method')).rejects.toThrow(common_1.NotFoundException);
            });
        });
        describe('applyDiscountToSubscription', () => {
            it('should apply discount to subscription', async () => {
                const mockDiscount = {
                    id: 'discount-id',
                    code: 'SAVE20',
                    type: client_1.DiscountType.PERCENTAGE,
                    percentOff: 20,
                    isActive: true,
                    validUntil: new Date('2024-12-31'),
                    currentUses: 5,
                    maxUses: 100,
                };
                const subscriptionWithDiscount = {
                    ...mockSubscription,
                    appliedDiscounts: [{
                            id: 'applied-discount-id',
                            discountId: 'discount-id',
                            subscriptionId: mockSubscription.id,
                            appliedAt: new Date(),
                        }],
                };
                jest.spyOn(service, 'validateDiscount').mockResolvedValue(mockDiscount);
                prismaService.$transaction.mockImplementation(async (callback) => {
                    const mockTxn = {
                        subscriptionDiscount: {
                            create: jest.fn().mockResolvedValue(subscriptionWithDiscount.appliedDiscounts[0]),
                        },
                        discount: {
                            update: jest.fn(),
                        },
                        subscription: {
                            findUnique: jest.fn().mockResolvedValue(subscriptionWithDiscount),
                        },
                    };
                    return callback(mockTxn);
                });
                const result = await service.applyDiscountToSubscription(test_utils_1.TEST_USER_IDS.CLIENT, 'SAVE20');
                expect(result.appliedDiscounts).toBeDefined();
                expect(result.appliedDiscounts).toHaveLength(1);
            });
            it('should throw error when discount is already applied', async () => {
                const mockDiscount = {
                    id: 'discount-id',
                    code: 'SAVE20',
                };
                const subscriptionWithDiscount = {
                    ...mockSubscription,
                    appliedDiscounts: [{
                            discountId: 'discount-id',
                        }],
                };
                jest.spyOn(service, 'validateDiscount').mockResolvedValue(mockDiscount);
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(subscriptionWithDiscount);
                await expect(service.applyDiscountToSubscription(test_utils_1.TEST_USER_IDS.CLIENT, 'SAVE20')).rejects.toThrow(common_1.BadRequestException);
            });
        });
        describe('processSubscriptionRenewal', () => {
            it('should process successful renewal', async () => {
                const renewalDate = new Date('2024-02-01');
                const renewedSubscription = {
                    ...mockSubscription,
                    currentPeriodStart: renewalDate,
                    currentPeriodEnd: new Date('2024-03-01'),
                    renewalCount: 1,
                };
                const mockPayment = {
                    id: 'renewal-payment-id',
                    amount: mockSubscription.amount,
                    status: client_1.PaymentStatus.SUCCEEDED,
                };
                prismaService.subscription.findUnique.mockResolvedValue(mockSubscription);
                prismaService.$transaction.mockImplementation(async (callback) => {
                    const mockTxn = {
                        payment: {
                            create: jest.fn().mockResolvedValue(mockPayment),
                        },
                        subscription: {
                            update: jest.fn().mockResolvedValue(renewedSubscription),
                        },
                    };
                    return callback(mockTxn);
                });
                const result = await service.processSubscriptionRenewal(mockSubscription.id);
                expect(result.renewalCount).toBe(1);
                expect(result.currentPeriodStart).toEqual(renewalDate);
            });
            it('should handle renewal payment failure', async () => {
                const mockPayment = {
                    id: 'failed-payment-id',
                    status: client_1.PaymentStatus.FAILED,
                };
                const subscriptionPastDue = {
                    ...mockSubscription,
                    status: client_1.SubscriptionStatus.PAST_DUE,
                    pastDueDate: new Date(),
                };
                prismaService.subscription.findUnique.mockResolvedValue(mockSubscription);
                prismaService.$transaction.mockImplementation(async (callback) => {
                    const mockTxn = {
                        payment: {
                            create: jest.fn().mockResolvedValue(mockPayment),
                        },
                        subscription: {
                            update: jest.fn().mockResolvedValue(subscriptionPastDue),
                        },
                    };
                    return callback(mockTxn);
                });
                const result = await service.processSubscriptionRenewal(mockSubscription.id);
                expect(result.status).toBe(client_1.SubscriptionStatus.PAST_DUE);
            });
            it('should throw error when subscription not found', async () => {
                prismaService.subscription.findUnique.mockResolvedValue(null);
                await expect(service.processSubscriptionRenewal('non-existent-subscription')).rejects.toThrow(common_1.NotFoundException);
            });
        });
        describe('getSubscriptionUsageAnalytics', () => {
            it('should return usage analytics for subscription', async () => {
                const startDate = new Date('2024-01-01');
                const endDate = new Date('2024-01-31');
                const mockUsageRecords = [
                    { feature: 'api_calls', quantity: 1000, usageDate: new Date('2024-01-15') },
                    { feature: 'storage', quantity: 50, usageDate: new Date('2024-01-20') },
                    { feature: 'api_calls', quantity: 800, usageDate: new Date('2024-01-25') },
                ];
                const expectedAnalytics = {
                    subscriptionId: mockSubscription.id,
                    period: { start: startDate, end: endDate },
                    totalUsage: {
                        api_calls: 1800,
                        storage: 50,
                    },
                    dailyUsage: [
                        { date: '2024-01-15', api_calls: 1000 },
                        { date: '2024-01-20', storage: 50 },
                        { date: '2024-01-25', api_calls: 800 },
                    ],
                    trends: {
                        api_calls: { growth: 0.2, trend: 'increasing' },
                        storage: { growth: 0.0, trend: 'stable' },
                    },
                };
                prismaService.usageRecord.findMany.mockResolvedValue(mockUsageRecords);
                prismaService.usageRecord.groupBy.mockResolvedValue([
                    { feature: 'api_calls', _sum: { quantity: 1800 } },
                    { feature: 'storage', _sum: { quantity: 50 } },
                ]);
                const result = await service.getSubscriptionUsageAnalytics(mockSubscription.id, startDate, endDate);
                expect(result.subscriptionId).toBe(mockSubscription.id);
                expect(result.totalUsage).toBeDefined();
                expect(result.totalUsage.api_calls).toBe(1800);
                expect(result.totalUsage.storage).toBe(50);
            });
            it('should return analytics for current month when no dates provided', async () => {
                const currentDate = new Date();
                const startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                prismaService.usageRecord.findMany.mockResolvedValue([]);
                prismaService.usageRecord.groupBy.mockResolvedValue([]);
                const result = await service.getSubscriptionUsageAnalytics(mockSubscription.id);
                expect(result.period.start.getMonth()).toBe(startOfMonth.getMonth());
                expect(result.period.end.getMonth()).toBe(endOfMonth.getMonth());
            });
        });
    });
    describe('Advanced Billing Features', () => {
        describe('Proration Calculations', () => {
            it('should calculate prorated amount for mid-cycle upgrade', async () => {
                const currentDate = new Date('2024-01-15');
                const periodStart = new Date('2024-01-01');
                const periodEnd = new Date('2024-02-01');
                const oldAmount = 10.00;
                const newAmount = 30.00;
                const result = service.calculateProration(oldAmount, newAmount, periodStart, periodEnd, currentDate);
                expect(result.credit).toBeLessThan(0);
                expect(result.charge).toBeGreaterThan(0);
                expect(result.netAmount).toBe(result.credit + result.charge);
            });
            it('should calculate prorated amount for downgrade', async () => {
                const currentDate = new Date('2024-01-10');
                const periodStart = new Date('2024-01-01');
                const periodEnd = new Date('2024-02-01');
                const oldAmount = 30.00;
                const newAmount = 10.00;
                const result = service.calculateProration(oldAmount, newAmount, periodStart, periodEnd, currentDate);
                expect(result.credit).toBeLessThan(0);
                expect(result.charge).toBeGreaterThan(0);
                expect(result.netAmount).toBeLessThan(0);
            });
            it('should handle end-of-period changes with no proration', async () => {
                const currentDate = new Date('2024-02-01');
                const periodStart = new Date('2024-01-01');
                const periodEnd = new Date('2024-02-01');
                const oldAmount = 10.00;
                const newAmount = 30.00;
                const result = service.calculateProration(oldAmount, newAmount, periodStart, periodEnd, currentDate);
                expect(result.credit).toBe(0);
                expect(result.charge).toBe(0);
                expect(result.netAmount).toBe(0);
            });
        });
        describe('Usage-Based Billing', () => {
            it('should calculate usage charges for metered features', async () => {
                const mockUsageRecords = [
                    { feature: 'api_calls', quantity: 1000, unitPrice: 0.01 },
                    { feature: 'storage_gb', quantity: 25, unitPrice: 0.10 },
                    { feature: 'bandwidth_gb', quantity: 100, unitPrice: 0.05 },
                ];
                const startDate = new Date('2024-01-01');
                const endDate = new Date('2024-01-31');
                prismaService.usageRecord.findMany.mockResolvedValue(mockUsageRecords);
                const result = await service.calculateUsageCharges('subscription-id', startDate, endDate);
                expect(result.totalCharges).toBe(17.50);
                expect(result.breakdown).toHaveLength(3);
                expect(result.breakdown[0]).toEqual({
                    feature: 'api_calls',
                    quantity: 1000,
                    unitPrice: 0.01,
                    totalCharge: 10.00,
                });
            });
            it('should apply usage tiers and discounts', async () => {
                const mockUsageRecords = [
                    { feature: 'api_calls', quantity: 10000, unitPrice: 0.01 },
                ];
                const mockPricingTiers = [
                    { min: 0, max: 1000, price: 0.01 },
                    { min: 1001, max: 5000, price: 0.008 },
                    { min: 5001, max: Infinity, price: 0.005 },
                ];
                prismaService.usageRecord.findMany.mockResolvedValue(mockUsageRecords);
                prismaService.pricingTier.findMany.mockResolvedValue(mockPricingTiers);
                const result = await service.calculateTieredUsageCharges('subscription-id', 'api_calls', new Date('2024-01-01'), new Date('2024-01-31'));
                expect(result.totalCharge).toBe(67);
                expect(result.tiers).toHaveLength(3);
            });
        });
        describe('Revenue Recognition', () => {
            it('should recognize revenue for monthly subscription', async () => {
                const subscription = {
                    id: 'subscription-id',
                    amount: 29.99,
                    billingCycle: client_1.BillingCycle.MONTHLY,
                    currentPeriodStart: new Date('2024-01-01'),
                    currentPeriodEnd: new Date('2024-02-01'),
                };
                const result = await service.calculateRevenueRecognition(subscription);
                expect(result.totalRevenue).toBe(29.99);
                expect(result.dailyRevenue).toBeCloseTo(0.97, 2);
                expect(result.recognitionSchedule).toHaveLength(31);
            });
            it('should handle deferred revenue for annual subscriptions', async () => {
                const subscription = {
                    id: 'subscription-id',
                    amount: 299.99,
                    billingCycle: client_1.BillingCycle.YEARLY,
                    currentPeriodStart: new Date('2024-01-01'),
                    currentPeriodEnd: new Date('2025-01-01'),
                };
                const result = await service.calculateRevenueRecognition(subscription);
                expect(result.totalRevenue).toBe(299.99);
                expect(result.monthlyRevenue).toBeCloseTo(25.00, 2);
                expect(result.recognitionSchedule).toHaveLength(12);
            });
        });
        describe('Tax Calculations', () => {
            it('should calculate tax for US customers', async () => {
                const billingAddress = {
                    country: 'US',
                    state: 'CA',
                    city: 'San Francisco',
                    postalCode: '94105',
                };
                const amount = 100.00;
                const result = await service.calculateTax(amount, billingAddress);
                expect(result.taxAmount).toBeGreaterThan(0);
                expect(result.taxRate).toBeGreaterThan(0);
                expect(result.taxJurisdiction).toBe('CA');
                expect(result.totalAmount).toBe(amount + result.taxAmount);
            });
            it('should handle VAT for EU customers', async () => {
                const billingAddress = {
                    country: 'DE',
                    vatNumber: 'DE123456789',
                };
                const amount = 100.00;
                const result = await service.calculateTax(amount, billingAddress);
                expect(result.taxType).toBe('VAT');
                expect(result.vatNumber).toBe('DE123456789');
            });
            it('should skip tax for tax-exempt customers', async () => {
                const billingAddress = {
                    country: 'US',
                    state: 'CA',
                    taxExempt: true,
                    exemptionCertificate: 'EXEMPT-123',
                };
                const amount = 100.00;
                const result = await service.calculateTax(amount, billingAddress);
                expect(result.taxAmount).toBe(0);
                expect(result.exemptionReason).toBe('Tax exempt customer');
            });
        });
        describe('Dunning Management', () => {
            it('should process failed payment with retry logic', async () => {
                const failedPayment = {
                    id: 'payment-id',
                    subscriptionId: 'subscription-id',
                    amount: 29.99,
                    status: client_1.PaymentStatus.FAILED,
                    attemptCount: 1,
                    failureCode: 'card_declined',
                };
                const mockSubscription = {
                    id: 'subscription-id',
                    status: client_1.SubscriptionStatus.ACTIVE,
                    defaultPaymentMethodId: 'payment-method-id',
                };
                prismaService.payment.findUnique.mockResolvedValue(failedPayment);
                prismaService.subscription.findUnique.mockResolvedValue(mockSubscription);
                const result = await service.processDunning('payment-id');
                expect(result.retryScheduled).toBe(true);
                expect(result.nextRetryDate).toBeDefined();
                expect(result.dunningLevel).toBe(1);
            });
            it('should escalate dunning after multiple failures', async () => {
                const failedPayment = {
                    id: 'payment-id',
                    subscriptionId: 'subscription-id',
                    status: client_1.PaymentStatus.FAILED,
                    attemptCount: 3,
                };
                const mockSubscription = {
                    id: 'subscription-id',
                    status: client_1.SubscriptionStatus.PAST_DUE,
                };
                prismaService.payment.findUnique.mockResolvedValue(failedPayment);
                prismaService.subscription.findUnique.mockResolvedValue(mockSubscription);
                const result = await service.processDunning('payment-id');
                expect(result.escalated).toBe(true);
                expect(result.dunningLevel).toBe(3);
                expect(result.actionRequired).toBe('update_payment_method');
            });
            it('should cancel subscription after maximum retries', async () => {
                const failedPayment = {
                    id: 'payment-id',
                    subscriptionId: 'subscription-id',
                    status: client_1.PaymentStatus.FAILED,
                    attemptCount: 5,
                };
                prismaService.payment.findUnique.mockResolvedValue(failedPayment);
                jest.spyOn(service, 'cancelSubscription').mockResolvedValue({ status: client_1.SubscriptionStatus.CANCELED });
                const result = await service.processDunning('payment-id');
                expect(result.subscriptionCanceled).toBe(true);
                expect(service.cancelSubscription).toHaveBeenCalled();
            });
        });
        describe('Subscription Analytics', () => {
            it('should calculate customer lifetime value', async () => {
                const mockPayments = [
                    { amount: 29.99, createdAt: new Date('2024-01-01') },
                    { amount: 29.99, createdAt: new Date('2024-02-01') },
                    { amount: 29.99, createdAt: new Date('2024-03-01') },
                ];
                const mockSubscription = {
                    createdAt: new Date('2024-01-01'),
                    status: client_1.SubscriptionStatus.ACTIVE,
                };
                prismaService.payment.findMany.mockResolvedValue(mockPayments);
                const result = await service.calculateCustomerLifetimeValue(test_utils_1.TEST_USER_IDS.CLIENT, mockSubscription);
                expect(result.totalRevenue).toBe(89.97);
                expect(result.averageMonthlyRevenue).toBeCloseTo(29.99, 2);
                expect(result.subscriptionMonths).toBe(3);
                expect(result.projectedLTV).toBeGreaterThan(89.97);
            });
            it('should calculate churn prediction', async () => {
                const mockUsageData = {
                    lastLoginDate: new Date('2024-01-01'),
                    averageSessionDuration: 300,
                    featureUsage: {
                        api_calls: 100,
                        storage: 1,
                    },
                    supportTickets: 2,
                };
                const mockPaymentHistory = [
                    { status: client_1.PaymentStatus.FAILED, createdAt: new Date('2024-01-15') },
                    { status: client_1.PaymentStatus.SUCCEEDED, createdAt: new Date('2024-01-01') },
                ];
                prismaService.usageRecord.findMany.mockResolvedValue(mockUsageData.featureUsage);
                prismaService.payment.findMany.mockResolvedValue(mockPaymentHistory);
                const result = await service.calculateChurnPrediction(test_utils_1.TEST_USER_IDS.CLIENT, mockUsageData);
                expect(result.churnRisk).toBeGreaterThan(0.5);
                expect(result.riskFactors).toContain('low_usage');
                expect(result.riskFactors).toContain('payment_failures');
                expect(result.recommendedActions).toContain('engagement_campaign');
            });
        });
    });
    describe('Integration Tests', () => {
        describe('Complete Subscription Lifecycle', () => {
            it('should handle complete subscription flow from creation to cancellation', async () => {
                const mockPlan = {
                    id: 'plan-id',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    monthlyPrice: 29.99,
                };
                const mockPaymentMethod = {
                    id: 'payment-method-id',
                    type: client_1.PaymentMethodType.CARD,
                    isDefault: true,
                };
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(mockPlan);
                prismaService.subscription.create.mockResolvedValue({
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    status: client_1.SubscriptionStatus.ACTIVE,
                });
                const subscription = await service.createSubscription({
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    planId: 'plan-id',
                    paymentMethodId: 'payment-method-id',
                });
                expect(subscription.status).toBe(client_1.SubscriptionStatus.ACTIVE);
                prismaService.payment.create.mockResolvedValue({
                    id: 'payment-id',
                    status: client_1.PaymentStatus.SUCCEEDED,
                    amount: 29.99,
                });
                const payment = await service.createPayment({
                    amount: 29.99,
                    subscriptionId: subscription.id,
                    paymentMethodId: 'payment-method-id',
                });
                expect(payment.status).toBe(client_1.PaymentStatus.SUCCEEDED);
                prismaService.usageRecord.create.mockResolvedValue({
                    id: 'usage-id',
                    feature: 'api_calls',
                    quantity: 1000,
                });
                const usage = await service.recordUsage({
                    subscriptionId: subscription.id,
                    feature: 'api_calls',
                    quantity: 1000,
                });
                expect(usage.quantity).toBe(1000);
                jest.spyOn(service, 'updateSubscription').mockResolvedValue({
                    ...subscription,
                    status: client_1.SubscriptionStatus.CANCELED,
                });
                const canceledSubscription = await service.cancelSubscription(test_utils_1.TEST_USER_IDS.CLIENT);
                expect(canceledSubscription.status).toBe(client_1.SubscriptionStatus.CANCELED);
            });
            it('should handle subscription upgrade with proration', async () => {
                const basicPlan = {
                    id: 'basic-plan',
                    tier: client_1.SubscriptionTier.BASIC,
                    monthlyPrice: 9.99,
                };
                const premiumPlan = {
                    id: 'premium-plan',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    monthlyPrice: 29.99,
                };
                const currentSubscription = {
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    planId: 'basic-plan',
                    tier: client_1.SubscriptionTier.BASIC,
                    amount: 9.99,
                    currentPeriodStart: new Date('2024-01-01'),
                    currentPeriodEnd: new Date('2024-02-01'),
                };
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(currentSubscription);
                prismaService.subscriptionPlan.findUnique.mockResolvedValue(premiumPlan);
                const upgradedSubscription = {
                    ...currentSubscription,
                    planId: 'premium-plan',
                    tier: client_1.SubscriptionTier.PREMIUM,
                    amount: 29.99,
                };
                prismaService.$transaction.mockImplementation(async (callback) => {
                    const mockTxn = {
                        subscription: {
                            update: jest.fn().mockResolvedValue(upgradedSubscription),
                        },
                        invoice: {
                            create: jest.fn().mockResolvedValue({
                                id: 'proration-invoice',
                                total: 15.00,
                            }),
                        },
                        invoiceLineItem: {
                            createMany: jest.fn(),
                        },
                    };
                    return callback(mockTxn);
                });
                const result = await service.changeSubscriptionPlan(test_utils_1.TEST_USER_IDS.CLIENT, 'premium-plan', {
                    billingCycle: client_1.BillingCycle.MONTHLY,
                    prorationBehavior: 'create_prorations',
                });
                expect(result.tier).toBe(client_1.SubscriptionTier.PREMIUM);
                expect(result.amount).toBe(29.99);
            });
        });
        describe('Error Recovery and Resilience', () => {
            it('should handle payment gateway timeouts gracefully', async () => {
                const paymentData = {
                    amount: 29.99,
                    paymentMethodId: 'payment-method-id',
                    subscriptionId: 'subscription-id',
                };
                const timeoutError = new Error('Payment gateway timeout');
                timeoutError.name = 'TimeoutError';
                prismaService.payment.create.mockRejectedValue(timeoutError);
                await expect(service.createPayment(paymentData)).rejects.toThrow('Payment gateway timeout');
                expect(prismaService.subscription.update).not.toHaveBeenCalled();
            });
            it('should handle concurrent subscription modifications', async () => {
                const subscription = {
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    version: 1,
                };
                jest.spyOn(service, 'findUserSubscription').mockResolvedValue(subscription);
                const conflictError = new Error('Subscription was modified by another process');
                conflictError.name = 'ConflictError';
                prismaService.subscription.update.mockRejectedValue(conflictError);
                await expect(service.updateSubscription(test_utils_1.TEST_USER_IDS.CLIENT, {
                    planId: 'new-plan-id',
                })).rejects.toThrow('Subscription was modified by another process');
            });
            it('should handle database transaction rollbacks', async () => {
                const discountData = {
                    code: 'SAVE20',
                    type: client_1.DiscountType.PERCENTAGE,
                    percentOff: 20,
                };
                prismaService.$transaction.mockRejectedValue(new Error('Database transaction failed'));
                await expect(service.redeemDiscount('discount-id', test_utils_1.TEST_USER_IDS.CLIENT, 20)).rejects.toThrow('Database transaction failed');
                expect(prismaService.discountRedemption.create).not.toHaveBeenCalled();
            });
        });
        describe('Performance and Scalability', () => {
            it('should handle high-volume billing operations efficiently', async () => {
                const operationCount = 1000;
                const batchOperations = Array.from({ length: operationCount }, (_, i) => {
                    if (i % 3 === 0) {
                        return service.recordUsage({
                            subscriptionId: `subscription-${i}`,
                            feature: 'api_calls',
                            quantity: 100,
                        });
                    }
                    else if (i % 3 === 1) {
                        return service.createPayment({
                            amount: 29.99,
                            subscriptionId: `subscription-${i}`,
                        });
                    }
                    else {
                        return service.getBillingStatistics(new Date('2024-01-01'), new Date('2024-01-31'));
                    }
                });
                prismaService.usageRecord.create.mockResolvedValue({ id: 'usage-id' });
                prismaService.payment.create.mockResolvedValue({ id: 'payment-id' });
                prismaService.payment.aggregate.mockResolvedValue({ _sum: { amount: 1000 } });
                prismaService.subscription.count.mockResolvedValue(10);
                prismaService.subscription.groupBy.mockResolvedValue([]);
                const startTime = Date.now();
                const results = await Promise.all(batchOperations);
                const endTime = Date.now();
                expect(results).toHaveLength(operationCount);
                expect(endTime - startTime).toBeLessThan(5000);
            });
            it('should optimize memory usage for large result sets', async () => {
                const largeUsageDataset = Array.from({ length: 50000 }, (_, i) => ({
                    id: `usage-${i}`,
                    feature: 'api_calls',
                    quantity: Math.floor(Math.random() * 1000),
                    usageDate: new Date(),
                }));
                prismaService.usageRecord.findMany.mockResolvedValue(largeUsageDataset);
                const initialMemory = process.memoryUsage().heapUsed;
                const result = await service.getUsageRecords('subscription-id', 'api_calls', new Date('2024-01-01'), new Date('2024-01-31'));
                const finalMemory = process.memoryUsage().heapUsed;
                expect(result).toHaveLength(50000);
                const memoryIncrease = finalMemory - initialMemory;
                expect(memoryIncrease).toBeLessThan(200 * 1024 * 1024);
            });
        });
        describe('Data Consistency and Integrity', () => {
            it('should maintain invoice number sequence integrity', async () => {
                const concurrentInvoiceCreations = Array.from({ length: 10 }, (_, i) => {
                    prismaService.invoice.findFirst.mockResolvedValueOnce({
                        number: `INV-2024-00000${i}`,
                    });
                    prismaService.invoice.create.mockResolvedValueOnce({
                        id: `invoice-${i}`,
                        number: `INV-2024-00000${i + 1}`,
                    });
                    return service.createInvoice({
                        subscriptionId: `subscription-${i}`,
                        subtotal: 100,
                        dueDate: new Date(),
                    });
                });
                const results = await Promise.all(concurrentInvoiceCreations);
                const invoiceNumbers = results.map(invoice => invoice.number);
                const uniqueNumbers = new Set(invoiceNumbers);
                expect(uniqueNumbers.size).toBe(invoiceNumbers.length);
            });
            it('should ensure subscription state consistency during transitions', async () => {
                const subscription = {
                    id: 'subscription-id',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    status: client_1.SubscriptionStatus.ACTIVE,
                };
                const transitions = [
                    { from: client_1.SubscriptionStatus.ACTIVE, to: client_1.SubscriptionStatus.PAUSED, valid: true },
                    { from: client_1.SubscriptionStatus.PAUSED, to: client_1.SubscriptionStatus.ACTIVE, valid: true },
                    { from: client_1.SubscriptionStatus.CANCELED, to: client_1.SubscriptionStatus.ACTIVE, valid: true },
                    { from: client_1.SubscriptionStatus.TRIALING, to: client_1.SubscriptionStatus.ACTIVE, valid: true },
                    { from: client_1.SubscriptionStatus.PAST_DUE, to: client_1.SubscriptionStatus.CANCELED, valid: true },
                ];
                for (const transition of transitions) {
                    jest.spyOn(service, 'findUserSubscription').mockResolvedValue({
                        ...subscription,
                        status: transition.from,
                    });
                    if (transition.valid) {
                        jest.spyOn(service, 'updateSubscription').mockResolvedValue({
                            ...subscription,
                            status: transition.to,
                        });
                        await expect(service.updateSubscription(test_utils_1.TEST_USER_IDS.CLIENT, {
                            status: transition.to,
                        })).resolves.toBeDefined();
                    }
                }
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2JpbGxpbmcvYmlsbGluZy5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQTJGO0FBQzNGLHVEQUFtRDtBQUNuRCxnRkFBb0U7QUFDcEUsMkNBUXdCO0FBQ3hCLDhDQUF1RTtBQUV2RSxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksT0FBdUIsQ0FBQztJQUM1QixJQUFJLGFBQXlDLENBQUM7SUFFOUMsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sVUFBVSxHQUFHLElBQUEsb0NBQXVCLEdBQUUsQ0FBQztRQUU3QyxNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFO2dCQUNULGdDQUFjO2dCQUNkO29CQUNFLE9BQU8sRUFBRSxzQ0FBYTtvQkFDdEIsUUFBUSxFQUFFLFVBQVU7aUJBQ3JCO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBaUIsZ0NBQWMsQ0FBQyxDQUFDO1FBQ3JELGFBQWEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLHNDQUFhLENBQUMsQ0FBQztJQUM1QyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1FBQ3ZDLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7WUFDbEMsTUFBTSxRQUFRLEdBQUc7Z0JBQ2YsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsSUFBSSxFQUFFLGNBQWM7Z0JBQ3BCLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxPQUFPO2dCQUM5QixZQUFZLEVBQUUsS0FBSztnQkFDbkIsV0FBVyxFQUFFLE1BQU07YUFDcEIsQ0FBQztZQUVGLE1BQU0sb0JBQW9CLEdBQUc7Z0JBQzNCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07Z0JBQzVCLE1BQU0sRUFBRSxTQUFTO2dCQUNqQixZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPO2FBQ25DLENBQUM7WUFFRixFQUFFLENBQUMsbURBQW1ELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2pFLE1BQU0sb0JBQW9CLEdBQUc7b0JBQzNCLEVBQUUsRUFBRSxpQkFBaUI7b0JBQ3JCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07b0JBQzVCLE1BQU0sRUFBRSxTQUFTO29CQUNqQixJQUFJLEVBQUUseUJBQWdCLENBQUMsT0FBTztvQkFDOUIsWUFBWSxFQUFFLHFCQUFZLENBQUMsT0FBTztvQkFDbEMsTUFBTSxFQUFFLEtBQUs7b0JBQ2IsTUFBTSxFQUFFLDJCQUFrQixDQUFDLE1BQU07b0JBQ2pDLElBQUksRUFBRSxRQUFRO29CQUNkLG9CQUFvQixFQUFFLElBQUk7aUJBQzNCLENBQUM7Z0JBR0EsYUFBYSxDQUFDLGdCQUFnQixDQUFDLFVBQ2hDLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdCLGFBQWEsQ0FBQyxZQUFZLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDaEUsb0JBQW9CLENBQ3JCLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLENBQUMsQ0FBQztnQkFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO2dCQUM3QyxNQUFNLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDN0QsSUFBSSxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDNUIsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTt3QkFDNUIsTUFBTSxFQUFFLFNBQVM7d0JBQ2pCLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxPQUFPO3dCQUM5QixZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPO3dCQUNsQyxNQUFNLEVBQUUsS0FBSzt3QkFDYixNQUFNLEVBQUUsMkJBQWtCLENBQUMsTUFBTTtxQkFDbEMsQ0FBQztvQkFDRixPQUFPLEVBQUU7d0JBQ1AsSUFBSSxFQUFFLElBQUk7d0JBQ1Ysb0JBQW9CLEVBQUUsSUFBSTtxQkFDM0I7aUJBQ0YsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2hFLE1BQU0sVUFBVSxHQUFHO29CQUNqQixHQUFHLG9CQUFvQjtvQkFDdkIsWUFBWSxFQUFFLHFCQUFZLENBQUMsTUFBTTtpQkFDbEMsQ0FBQztnQkFFRixNQUFNLG9CQUFvQixHQUFHO29CQUMzQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNO29CQUM1QixNQUFNLEVBQUUsTUFBTTtvQkFDZCxZQUFZLEVBQUUscUJBQVksQ0FBQyxNQUFNO2lCQUNsQyxDQUFDO2dCQUdBLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUNoQyxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QixhQUFhLENBQUMsWUFBWSxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQ2hFLG9CQUFvQixDQUNyQixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUU1RCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMscUJBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN4RCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDNUQsTUFBTSxVQUFVLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFDOUIsTUFBTSxRQUFRLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFDNUIsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7Z0JBRTFDLE1BQU0sU0FBUyxHQUFHO29CQUNoQixHQUFHLG9CQUFvQjtvQkFDdkIsVUFBVTtvQkFDVixRQUFRO2lCQUNULENBQUM7Z0JBRUYsTUFBTSxvQkFBb0IsR0FBRztvQkFDM0IsRUFBRSxFQUFFLGlCQUFpQjtvQkFDckIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLFFBQVE7b0JBQ25DLFVBQVU7b0JBQ1YsUUFBUTtpQkFDVCxDQUFDO2dCQUdBLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUNoQyxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QixhQUFhLENBQUMsWUFBWSxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQ2hFLG9CQUFvQixDQUNyQixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUUzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQzdELElBQUksRUFBRSxNQUFNLENBQUMsZ0JBQWdCLENBQUM7d0JBQzVCLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxRQUFRO3dCQUNuQyxVQUFVO3dCQUNWLFFBQVE7cUJBQ1QsQ0FBQztvQkFDRixPQUFPLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7aUJBQzVCLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUVyRSxhQUFhLENBQUMsZ0JBQWdCLENBQUMsVUFDaEMsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFMUIsTUFBTSxNQUFNLENBQ1YsT0FBTyxDQUFDLGtCQUFrQixDQUFDLG9CQUFvQixDQUFDLENBQ2pELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO2dCQUVyQyxNQUFNLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUNuRSxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtZQUNwQyxFQUFFLENBQUMsb0RBQW9ELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2xFLE1BQU0sZ0JBQWdCLEdBQUc7b0JBQ3ZCLEVBQUUsRUFBRSxpQkFBaUI7b0JBQ3JCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07b0JBQzVCLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUU7b0JBQzlCLG9CQUFvQixFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRTtvQkFDM0MsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLENBQUM7aUJBQ2hDLENBQUM7Z0JBRUQsYUFBYSxDQUFDLFlBQVksQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUNwRSxnQkFBZ0IsQ0FDakIsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUV4RSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUNqRSxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUU7b0JBQ3ZDLE9BQU8sRUFBRTt3QkFDUCxJQUFJLEVBQUUsSUFBSTt3QkFDVixvQkFBb0IsRUFBRSxJQUFJO3dCQUMxQixRQUFRLEVBQUU7NEJBQ1IsT0FBTyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRTs0QkFDOUIsSUFBSSxFQUFFLENBQUM7eUJBQ1I7cUJBQ0Y7aUJBQ0YsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2xFLGFBQWEsQ0FBQyxZQUFZLENBQUMsVUFBd0IsQ0FBQyxpQkFBaUIsQ0FDcEUsSUFBSSxDQUNMLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsb0JBQW9CLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFFdkUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1lBQ2xDLE1BQU0sZ0JBQWdCLEdBQUc7Z0JBQ3ZCLEVBQUUsRUFBRSxpQkFBaUI7Z0JBQ3JCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07Z0JBQzVCLE1BQU0sRUFBRSxhQUFhO2FBQ3RCLENBQUM7WUFFRixNQUFNLFdBQVcsR0FBRztnQkFDbEIsRUFBRSxFQUFFLGFBQWE7Z0JBQ2pCLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxVQUFVO2dCQUNqQyxZQUFZLEVBQUUsS0FBSztnQkFDbkIsV0FBVyxFQUFFLE1BQU07YUFDcEIsQ0FBQztZQUVGLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDNUQsTUFBTSxVQUFVLEdBQUc7b0JBQ2pCLE1BQU0sRUFBRSxhQUFhO29CQUNyQixZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPO2lCQUNuQyxDQUFDO2dCQUVGLE1BQU0sbUJBQW1CLEdBQUc7b0JBQzFCLEdBQUcsZ0JBQWdCO29CQUNuQixNQUFNLEVBQUUsYUFBYTtvQkFDckIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLFVBQVU7b0JBQ2pDLE1BQU0sRUFBRSxLQUFLO2lCQUNkLENBQUM7Z0JBRUYsSUFBSTtxQkFDRCxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDO3FCQUN0QyxpQkFBaUIsQ0FBQyxnQkFBdUIsQ0FBQyxDQUFDO2dCQUU1QyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsVUFDaEMsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDaEMsYUFBYSxDQUFDLFlBQVksQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUNoRSxtQkFBbUIsQ0FDcEIsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FDN0MsMEJBQWEsQ0FBQyxNQUFNLEVBQ3BCLFVBQVUsQ0FDWCxDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQzdELEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU0sRUFBRTtvQkFDdkMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDNUIsTUFBTSxFQUFFLGFBQWE7d0JBQ3JCLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxVQUFVO3dCQUNqQyxNQUFNLEVBQUUsS0FBSzt3QkFDYixZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPO3FCQUNuQyxDQUFDO29CQUNGLE9BQU8sRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztpQkFDNUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsaUVBQWlFLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQy9FLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRXBFLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUIsRUFBRTtvQkFDOUMsTUFBTSxFQUFFLFVBQVU7aUJBQ25CLENBQUMsQ0FDSCxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsMEJBQWlCLENBQUMsQ0FBQztZQUN2QyxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyw2REFBNkQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDM0UsSUFBSTtxQkFDRCxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDO3FCQUN0QyxpQkFBaUIsQ0FBQyxnQkFBdUIsQ0FBQyxDQUFDO2dCQUU1QyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsVUFDaEMsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFMUIsTUFBTSxNQUFNLENBQ1YsT0FBTyxDQUFDLGtCQUFrQixDQUFDLDBCQUFhLENBQUMsTUFBTSxFQUFFO29CQUMvQyxNQUFNLEVBQUUsbUJBQW1CO2lCQUM1QixDQUFDLENBQ0gsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7WUFDbEMsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUM3RCxNQUFNLG9CQUFvQixHQUFHO29CQUMzQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixNQUFNLEVBQUUsMkJBQWtCLENBQUMsUUFBUTtpQkFDcEMsQ0FBQztnQkFFRixJQUFJO3FCQUNELEtBQUssQ0FBQyxPQUFPLEVBQUUsb0JBQW9CLENBQUM7cUJBQ3BDLGlCQUFpQixDQUFDLG9CQUEyQixDQUFDLENBQUM7Z0JBRWxELE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGtCQUFrQixDQUFDLDBCQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRXRFLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLDJCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUN4RCxNQUFNLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUMsb0JBQW9CLENBQ3JELDBCQUFhLENBQUMsTUFBTSxFQUNwQjtvQkFDRSxNQUFNLEVBQUUsMkJBQWtCLENBQUMsUUFBUTtpQkFDcEMsQ0FDRixDQUFDO1lBQ0osQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO1lBQ3RDLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDOUQsTUFBTSxRQUFRLEdBQUc7b0JBQ2YsSUFBSSxFQUFFLGNBQWM7b0JBQ3BCLFdBQVcsRUFBRSxrQkFBa0I7b0JBQy9CLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxPQUFPO29CQUM5QixZQUFZLEVBQUUsS0FBSztvQkFDbkIsV0FBVyxFQUFFLE1BQU07b0JBQ25CLFFBQVEsRUFBRSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRTtvQkFDckQsTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRTtvQkFDdkIsU0FBUyxFQUFFLEVBQUU7aUJBQ2QsQ0FBQztnQkFFRixNQUFNLFlBQVksR0FBRztvQkFDbkIsRUFBRSxFQUFFLFNBQVM7b0JBQ2IsR0FBRyxRQUFRO2lCQUNaLENBQUM7Z0JBRUQsYUFBYSxDQUFDLGdCQUFnQixDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQ3BFLFlBQVksQ0FDYixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUNyQyxNQUFNLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUNqRSxJQUFJLEVBQUUsUUFBUTtpQkFDZixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7WUFDNUIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNyRCxNQUFNLFNBQVMsR0FBRztvQkFDaEIsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRTtvQkFDbkQsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRTtpQkFDdkQsQ0FBQztnQkFHQSxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFDaEMsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFFL0IsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBRTVDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ2xDLE1BQU0sQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ25FLEtBQUssRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7b0JBQ3pCLE9BQU8sRUFBRSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUU7aUJBQ2pDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUMzRCxNQUFNLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBRWxDLE1BQU0sQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ25FLEtBQUssRUFBRSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUU7b0JBQzFCLE9BQU8sRUFBRSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUU7aUJBQ2pDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLENBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQy9DLE1BQU0sVUFBVSxHQUFHO29CQUNqQixJQUFJLEVBQUUsY0FBYztvQkFDcEIsWUFBWSxFQUFFLEtBQUs7b0JBQ25CLFFBQVEsRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUU7aUJBQy9CLENBQUM7Z0JBRUYsTUFBTSxXQUFXLEdBQUc7b0JBQ2xCLEVBQUUsRUFBRSxTQUFTO29CQUNiLEdBQUcsVUFBVTtpQkFDZCxDQUFDO2dCQUVELGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUNwRSxXQUFXLENBQ1osQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUUvRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUNwQyxNQUFNLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUNqRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFO29CQUN4QixJQUFJLEVBQUUsVUFBVTtpQkFDakIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1lBQ25DLEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDL0QsTUFBTSxpQkFBaUIsR0FBRztvQkFDeEIsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTtvQkFDNUIsSUFBSSxFQUFFLDBCQUFpQixDQUFDLElBQUk7b0JBQzVCLFNBQVMsRUFBRSxNQUFNO29CQUNqQixTQUFTLEVBQUUsTUFBTTtvQkFDakIsWUFBWSxFQUFFLEVBQUU7b0JBQ2hCLFdBQVcsRUFBRSxJQUFJO29CQUNqQixTQUFTLEVBQUUsSUFBSTtpQkFDaEIsQ0FBQztnQkFFRixNQUFNLHFCQUFxQixHQUFHO29CQUM1QixFQUFFLEVBQUUsbUJBQW1CO29CQUN2QixHQUFHLGlCQUFpQjtpQkFDckIsQ0FBQztnQkFFRCxhQUFhLENBQUMsYUFBYSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQ3JFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUNiLENBQUM7Z0JBQ0QsYUFBYSxDQUFDLGFBQWEsQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUNqRSxxQkFBcUIsQ0FDdEIsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO2dCQUVwRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUNsRSxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRTtvQkFDeEQsSUFBSSxFQUFFLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRTtpQkFDM0IsQ0FBQyxDQUFDO2dCQUNILE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUM5RCxJQUFJLEVBQUUsaUJBQWlCO2lCQUN4QixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyx5REFBeUQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDdkUsTUFBTSxpQkFBaUIsR0FBRztvQkFDeEIsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTtvQkFDNUIsSUFBSSxFQUFFLDBCQUFpQixDQUFDLElBQUk7b0JBQzVCLFNBQVMsRUFBRSxNQUFNO2lCQUNsQixDQUFDO2dCQUVELGFBQWEsQ0FBQyxhQUFhLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDakUsaUJBQWlCLENBQ2xCLENBQUM7Z0JBRUYsTUFBTSxPQUFPLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsQ0FBQztnQkFFckQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDeEUsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7WUFDdEMsRUFBRSxDQUFDLHlFQUF5RSxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN2RixNQUFNLGtCQUFrQixHQUFHO29CQUN6QixFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO29CQUNsRCxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO2lCQUNwRCxDQUFDO2dCQUVELGFBQWEsQ0FBQyxhQUFhLENBQUMsUUFBc0IsQ0FBQyxpQkFBaUIsQ0FDbkUsa0JBQWtCLENBQ25CLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsc0JBQXNCLENBQ2pELDBCQUFhLENBQUMsTUFBTSxDQUNyQixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDM0MsTUFBTSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ2hFLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO29CQUN2RCxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsQ0FBQztpQkFDeEQsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxpQkFBaUIsR0FBRztnQkFDeEIsRUFBRSxFQUFFLG1CQUFtQjtnQkFDdkIsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTthQUM3QixDQUFDO1lBRUYsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN6RCxNQUFNLFVBQVUsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQztnQkFDdkMsTUFBTSxvQkFBb0IsR0FBRyxFQUFFLEdBQUcsaUJBQWlCLEVBQUUsR0FBRyxVQUFVLEVBQUUsQ0FBQztnQkFFcEUsYUFBYSxDQUFDLGFBQWEsQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUNyRSxpQkFBaUIsQ0FDbEIsQ0FBQztnQkFDRCxhQUFhLENBQUMsYUFBYSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQ3JFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUNiLENBQUM7Z0JBQ0QsYUFBYSxDQUFDLGFBQWEsQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUNqRSxvQkFBb0IsQ0FDckIsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxtQkFBbUIsQ0FDOUMsbUJBQW1CLEVBQ25CLFVBQVUsQ0FDWCxDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztnQkFDN0MsTUFBTSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ2xFLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO29CQUN4RCxJQUFJLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFO2lCQUMzQixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxtRUFBbUUsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDaEYsYUFBYSxDQUFDLGFBQWEsQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUNyRSxJQUFJLENBQ0wsQ0FBQztnQkFFRixNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FDcEUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsRUFBRSxDQUFDLGdFQUFnRSxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUM5RSxNQUFNLHdCQUF3QixHQUFHO29CQUMvQixFQUFFLEVBQUUsbUJBQW1CO29CQUN2QixRQUFRLEVBQUUsS0FBSztpQkFDaEIsQ0FBQztnQkFFRCxhQUFhLENBQUMsYUFBYSxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQ2pFLHdCQUF3QixDQUN6QixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLG1CQUFtQixDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBRXRFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztnQkFDakQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQzlELEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxtQkFBbUIsRUFBRTtvQkFDbEMsSUFBSSxFQUFFLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRTtpQkFDMUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7UUFDeEIsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7WUFDN0IsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN6RCxNQUFNLFdBQVcsR0FBRztvQkFDbEIsTUFBTSxFQUFFLEtBQUs7b0JBQ2IsZUFBZSxFQUFFLG1CQUFtQjtvQkFDcEMsY0FBYyxFQUFFLGlCQUFpQjtvQkFDakMsV0FBVyxFQUFFLHNCQUFzQjtpQkFDcEMsQ0FBQztnQkFFRixNQUFNLGVBQWUsR0FBRztvQkFDdEIsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLEdBQUcsV0FBVztvQkFDZCxNQUFNLEVBQUUsc0JBQWEsQ0FBQyxPQUFPO29CQUM3QixRQUFRLEVBQUUsS0FBSztvQkFDZixhQUFhLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO29CQUNwQyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUseUJBQWdCLENBQUMsT0FBTyxFQUFFO29CQUNoRCxPQUFPLEVBQUUsSUFBSTtpQkFDZCxDQUFDO2dCQUVELGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDM0QsZUFBZSxDQUNoQixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFFeEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ3hELElBQUksRUFBRTt3QkFDSixHQUFHLFdBQVc7d0JBQ2QsTUFBTSxFQUFFLHNCQUFhLENBQUMsT0FBTzt3QkFDN0IsUUFBUSxFQUFFLEtBQUs7cUJBQ2hCO29CQUNELE9BQU8sRUFBRTt3QkFDUCxhQUFhLEVBQUUsSUFBSTt3QkFDbkIsWUFBWSxFQUFFLElBQUk7d0JBQ2xCLE9BQU8sRUFBRSxJQUFJO3FCQUNkO2lCQUNGLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUMxRCxNQUFNLFdBQVcsR0FBRztvQkFDbEIsTUFBTSxFQUFFLEtBQUs7b0JBQ2IsUUFBUSxFQUFFLEtBQUs7aUJBQ2hCLENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUFDO29CQUM1RCxFQUFFLEVBQUUsWUFBWTtvQkFDaEIsUUFBUSxFQUFFLEtBQUs7aUJBQ2hCLENBQUMsQ0FBQztnQkFFSCxNQUFNLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBRXpDLE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUN4RCxJQUFJLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUM1QixRQUFRLEVBQUUsS0FBSztxQkFDaEIsQ0FBQztvQkFDRixPQUFPLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7aUJBQzVCLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1lBQ25DLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDekQsTUFBTSxjQUFjLEdBQUc7b0JBQ3JCLEVBQUUsRUFBRSxZQUFZO29CQUNoQixNQUFNLEVBQUUsc0JBQWEsQ0FBQyxTQUFTO29CQUMvQixXQUFXLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7aUJBQzlCLENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUMzRCxjQUFjLENBQ2YsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxtQkFBbUIsQ0FDOUMsWUFBWSxFQUNaLHNCQUFhLENBQUMsU0FBUyxDQUN4QixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBQ3ZDLE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUN4RCxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFO29CQUMzQixJQUFJLEVBQUU7d0JBQ0osTUFBTSxFQUFFLHNCQUFhLENBQUMsU0FBUzt3QkFDL0IsV0FBVyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO3FCQUM5QjtpQkFDRixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxzREFBc0QsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDcEUsTUFBTSxRQUFRLEdBQUc7b0JBQ2YsV0FBVyxFQUFFLGVBQWU7b0JBQzVCLGNBQWMsRUFBRSx5QkFBeUI7aUJBQzFDLENBQUM7Z0JBRUYsTUFBTSxjQUFjLEdBQUc7b0JBQ3JCLEVBQUUsRUFBRSxZQUFZO29CQUNoQixNQUFNLEVBQUUsc0JBQWEsQ0FBQyxNQUFNO29CQUM1QixRQUFRLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLFdBQVcsRUFBRSxlQUFlO29CQUM1QixjQUFjLEVBQUUseUJBQXlCO2lCQUMxQyxDQUFDO2dCQUVELGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDM0QsY0FBYyxDQUNmLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsbUJBQW1CLENBQzlDLFlBQVksRUFDWixzQkFBYSxDQUFDLE1BQU0sRUFDcEIsUUFBUSxDQUNULENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ3hELEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUU7b0JBQzNCLElBQUksRUFBRTt3QkFDSixNQUFNLEVBQUUsc0JBQWEsQ0FBQyxNQUFNO3dCQUM1QixRQUFRLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7d0JBQzFCLFdBQVcsRUFBRSxlQUFlO3dCQUM1QixjQUFjLEVBQUUseUJBQXlCO3FCQUMxQztpQkFDRixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7WUFDNUIsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNuRCxNQUFNLFlBQVksR0FBRztvQkFDbkIsRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxzQkFBYSxDQUFDLFNBQVMsRUFBRTtvQkFDcEQsRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxzQkFBYSxDQUFDLFNBQVMsRUFBRTtpQkFDckQsQ0FBQztnQkFFRixNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDekMsTUFBTSxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBRXRDLGFBQWEsQ0FBQyxPQUFPLENBQUMsUUFBc0IsQ0FBQyxpQkFBaUIsQ0FDN0QsWUFBWSxDQUNiLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsWUFBWSxDQUN2QyxpQkFBaUIsRUFDakIsc0JBQWEsQ0FBQyxTQUFTLEVBQ3ZCLFNBQVMsRUFDVCxPQUFPLENBQ1IsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUNyQyxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDMUQsS0FBSyxFQUFFO3dCQUNMLGNBQWMsRUFBRSxpQkFBaUI7d0JBQ2pDLE1BQU0sRUFBRSxzQkFBYSxDQUFDLFNBQVM7d0JBQy9CLFNBQVMsRUFBRTs0QkFDVCxHQUFHLEVBQUUsU0FBUzs0QkFDZCxHQUFHLEVBQUUsT0FBTzt5QkFDYjtxQkFDRjtvQkFDRCxPQUFPLEVBQUU7d0JBQ1AsYUFBYSxFQUFFLElBQUk7d0JBQ25CLFlBQVksRUFBRSxJQUFJO3dCQUNsQixPQUFPLEVBQUUsSUFBSTtxQkFDZDtvQkFDRCxPQUFPLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFO2lCQUMvQixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtRQUN4QixRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtZQUM3QixFQUFFLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzNELE1BQU0sV0FBVyxHQUFHO29CQUNsQixjQUFjLEVBQUUsaUJBQWlCO29CQUNqQyxRQUFRLEVBQUUsR0FBRztvQkFDYixTQUFTLEVBQUUsRUFBRTtvQkFDYixjQUFjLEVBQUUsQ0FBQztvQkFDakIsT0FBTyxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztpQkFDaEMsQ0FBQztnQkFFRixNQUFNLGVBQWUsR0FBRztvQkFDdEIsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLEdBQUcsV0FBVztvQkFDZCxNQUFNLEVBQUUsaUJBQWlCO29CQUN6QixLQUFLLEVBQUUsR0FBRyxFQUFFLGVBQWU7b0JBQzNCLFNBQVMsRUFBRSxHQUFHO29CQUNkLE1BQU0sRUFBRSxzQkFBYSxDQUFDLElBQUk7aUJBQzNCLENBQUM7Z0JBRUYsNkJBQTZCO2dCQUM3QixJQUFJO3FCQUNELEtBQUssQ0FBQyxPQUFjLEVBQUUsdUJBQXVCLENBQUM7cUJBQzlDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLENBQUM7Z0JBQ3ZDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDM0QsZUFBZSxDQUNoQixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFFeEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ3hELElBQUksRUFBRTt3QkFDSixHQUFHLFdBQVc7d0JBQ2QsTUFBTSxFQUFFLGlCQUFpQjt3QkFDekIsS0FBSyxFQUFFLEdBQUc7d0JBQ1YsU0FBUyxFQUFFLEdBQUc7d0JBQ2QsTUFBTSxFQUFFLHNCQUFhLENBQUMsSUFBSTtxQkFDM0I7b0JBQ0QsT0FBTyxFQUFFO3dCQUNQLFlBQVksRUFBRSxJQUFJO3dCQUNsQixTQUFTLEVBQUUsSUFBSTtxQkFDaEI7aUJBQ0YsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1lBQzVCLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDbkQsTUFBTSxZQUFZLEdBQUc7b0JBQ25CLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsc0JBQWEsQ0FBQyxJQUFJLEVBQUU7b0JBQy9DLEVBQUUsRUFBRSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsc0JBQWEsQ0FBQyxJQUFJLEVBQUU7aUJBQ2hELENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFzQixDQUFDLGlCQUFpQixDQUM3RCxZQUFZLENBQ2IsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxZQUFZLENBQ3ZDLGlCQUFpQixFQUNqQixzQkFBYSxDQUFDLElBQUksQ0FDbkIsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUNyQyxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDMUQsS0FBSyxFQUFFO3dCQUNMLGNBQWMsRUFBRSxpQkFBaUI7d0JBQ2pDLE1BQU0sRUFBRSxzQkFBYSxDQUFDLElBQUk7cUJBQzNCO29CQUNELE9BQU8sRUFBRTt3QkFDUCxZQUFZLEVBQUU7NEJBQ1osT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTt5QkFDeEI7d0JBQ0QsU0FBUyxFQUFFLElBQUk7d0JBQ2YsUUFBUSxFQUFFLElBQUk7cUJBQ2Y7b0JBQ0QsT0FBTyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRTtpQkFDL0IsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUMzRCxNQUFNLFdBQVcsR0FBRztvQkFDbEIsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLEtBQUssRUFBRSxHQUFHO29CQUNWLFFBQVEsRUFBRTt3QkFDUixFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLHNCQUFhLENBQUMsU0FBUyxFQUFFO3dCQUMvQyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLHNCQUFhLENBQUMsU0FBUyxFQUFFO3FCQUNoRDtpQkFDRixDQUFDO2dCQUVGLE1BQU0sY0FBYyxHQUFHO29CQUNyQixHQUFHLFdBQVc7b0JBQ2QsTUFBTSxFQUFFLHNCQUFhLENBQUMsSUFBSTtvQkFDMUIsVUFBVSxFQUFFLEdBQUc7b0JBQ2YsTUFBTSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO2lCQUN6QixDQUFDO2dCQUVELGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBd0IsQ0FBQyxpQkFBaUIsQ0FDL0QsV0FBVyxDQUNaLENBQUM7Z0JBQ0QsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUMzRCxjQUFjLENBQ2YsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFFN0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ3hELEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUU7b0JBQzNCLElBQUksRUFBRTt3QkFDSixNQUFNLEVBQUUsc0JBQWEsQ0FBQyxJQUFJO3dCQUMxQixVQUFVLEVBQUUsR0FBRzt3QkFDZixNQUFNLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7cUJBQ3pCO2lCQUNGLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUM1RCxNQUFNLFdBQVcsR0FBRztvQkFDbEIsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLEtBQUssRUFBRSxHQUFHO29CQUNWLFFBQVEsRUFBRTt3QkFDUixFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLHNCQUFhLENBQUMsU0FBUyxFQUFFO3dCQUMvQyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLHNCQUFhLENBQUMsTUFBTSxFQUFFO3FCQUM3QztpQkFDRixDQUFDO2dCQUVELGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBd0IsQ0FBQyxpQkFBaUIsQ0FDL0QsV0FBVyxDQUNaLENBQUM7Z0JBQ0QsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUFDO29CQUM1RCxHQUFHLFdBQVc7b0JBQ2QsTUFBTSxFQUFFLHNCQUFhLENBQUMsSUFBSTtvQkFDMUIsVUFBVSxFQUFFLEVBQUU7aUJBQ2YsQ0FBQyxDQUFDO2dCQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUU3RCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxzQkFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNyQyxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyw0REFBNEQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDekUsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUV4RSxNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FDN0MsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtZQUM5QixFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ25FLE1BQU0sWUFBWSxHQUFHO29CQUNuQixJQUFJLEVBQUUsUUFBUTtvQkFDZCxJQUFJLEVBQUUsU0FBUztvQkFDZixJQUFJLEVBQUUscUJBQVksQ0FBQyxVQUFVO29CQUM3QixVQUFVLEVBQUUsRUFBRTtpQkFDZixDQUFDO2dCQUVGLE1BQU0sZ0JBQWdCLEdBQUc7b0JBQ3ZCLEVBQUUsRUFBRSxhQUFhO29CQUNqQixHQUFHLFlBQVk7b0JBQ2YsU0FBUyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO2lCQUM1QixDQUFDO2dCQUVELGFBQWEsQ0FBQyxRQUFRLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDNUQsZ0JBQWdCLENBQ2pCLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUUxRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUN6RCxJQUFJLEVBQUU7d0JBQ0osR0FBRyxZQUFZO3dCQUNmLFNBQVMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQztxQkFDNUI7aUJBQ0YsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7WUFDaEMsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLEVBQUUsRUFBRSxhQUFhO2dCQUNqQixJQUFJLEVBQUUsUUFBUTtnQkFDZCxRQUFRLEVBQUUsSUFBSTtnQkFDZCxVQUFVLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO2dCQUNsQyxPQUFPLEVBQUUsR0FBRztnQkFDWixXQUFXLEVBQUUsRUFBRTtnQkFDZixjQUFjLEVBQUUsQ0FBQztnQkFDakIsU0FBUyxFQUFFLEVBQUU7Z0JBQ2IsV0FBVyxFQUFFLEVBQUU7YUFDaEIsQ0FBQztZQUVGLEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDM0MsYUFBYSxDQUFDLFFBQVEsQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUNoRSxZQUFZLENBQ2IsQ0FBQztnQkFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FDM0MsUUFBUSxFQUNSLDBCQUFhLENBQUMsTUFBTSxFQUNwQixHQUFHLENBQ0osQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDREQUE0RCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN6RSxhQUFhLENBQUMsUUFBUSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQ2hFLElBQUksQ0FDTCxDQUFDO2dCQUVGLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQy9ELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNyRSxhQUFhLENBQUMsUUFBUSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pFLEdBQUcsWUFBWTtvQkFDZixRQUFRLEVBQUUsS0FBSztpQkFDaEIsQ0FBQyxDQUFDO2dCQUVILE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQzlELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHVEQUF1RCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNwRSxhQUFhLENBQUMsUUFBUSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pFLEdBQUcsWUFBWTtvQkFDZixVQUFVLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsVUFBVTtpQkFDL0MsQ0FBQyxDQUFDO2dCQUVILE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQzlELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNyRSxhQUFhLENBQUMsUUFBUSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pFLEdBQUcsWUFBWTtvQkFDZixPQUFPLEVBQUUsRUFBRTtvQkFDWCxXQUFXLEVBQUUsRUFBRSxFQUFFLGdCQUFnQjtpQkFDbEMsQ0FBQyxDQUFDO2dCQUVILE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQzlELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHNFQUFzRSxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNuRixhQUFhLENBQUMsUUFBUSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pFLEdBQUcsWUFBWTtvQkFDZixXQUFXLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsb0JBQW9CO2lCQUN0RSxDQUFDLENBQUM7Z0JBRUgsTUFBTSxNQUFNLENBQ1YsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSwwQkFBYSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FDOUQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDRCQUFtQixDQUFDLENBQUM7WUFDekMsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsK0RBQStELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzdFLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQzdELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1lBQzlCLEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDckQsTUFBTSxlQUFlLEdBQUc7b0JBQ3RCLEdBQUcsSUFBQSxvQ0FBdUIsR0FBRTtvQkFDNUIsa0JBQWtCLEVBQUU7d0JBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3FCQUNsQjtvQkFDRCxRQUFRLEVBQUU7d0JBQ1IsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7cUJBQ2xCO2lCQUNGLENBQUM7Z0JBRUQsYUFBYSxDQUFDLFlBQTBCLENBQUMsa0JBQWtCLENBQzFELEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRTtvQkFDakIsT0FBTyxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQ25DLENBQUMsQ0FDRixDQUFDO2dCQUVGLE1BQU0sT0FBTyxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBRXRFLE1BQU0sQ0FBQyxlQUFlLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQ3JFLElBQUksRUFBRTt3QkFDSixVQUFVLEVBQUUsYUFBYTt3QkFDekIsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTt3QkFDNUIsV0FBVyxFQUFFLEVBQUU7cUJBQ2hCO2lCQUNGLENBQUMsQ0FBQztnQkFFSCxNQUFNLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDM0QsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRTtvQkFDNUIsSUFBSSxFQUFFO3dCQUNKLFdBQVcsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7cUJBQzlCO2lCQUNGLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1lBQzNCLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDNUQsTUFBTSxTQUFTLEdBQUc7b0JBQ2hCLGNBQWMsRUFBRSxpQkFBaUI7b0JBQ2pDLE9BQU8sRUFBRSxXQUFXO29CQUNwQixRQUFRLEVBQUUsR0FBRztvQkFDYixJQUFJLEVBQUUsVUFBVTtvQkFDaEIsUUFBUSxFQUFFLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRTtpQkFDckMsQ0FBQztnQkFFRixNQUFNLGFBQWEsR0FBRztvQkFDcEIsRUFBRSxFQUFFLFVBQVU7b0JBQ2QsR0FBRyxTQUFTO29CQUNaLFNBQVMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQztpQkFDNUIsQ0FBQztnQkFFRCxhQUFhLENBQUMsV0FBVyxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQy9ELGFBQWEsQ0FDZCxDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFFcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztnQkFDdEMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUM7b0JBQzVELElBQUksRUFBRTt3QkFDSixHQUFHLFNBQVM7d0JBQ1osU0FBUyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO3FCQUM1QjtpQkFDRixDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtZQUMvQixFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3hELE1BQU0sZ0JBQWdCLEdBQUc7b0JBQ3ZCLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUU7b0JBQ3RELEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUU7aUJBQ3RELENBQUM7Z0JBRUYsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUV0QyxhQUFhLENBQUMsV0FBVyxDQUFDLFFBQXNCLENBQUMsaUJBQWlCLENBQ2pFLGdCQUFnQixDQUNqQixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGVBQWUsQ0FDMUMsaUJBQWlCLEVBQ2pCLFdBQVcsRUFDWCxTQUFTLEVBQ1QsT0FBTyxDQUNSLENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUN6QyxNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDOUQsS0FBSyxFQUFFO3dCQUNMLGNBQWMsRUFBRSxpQkFBaUI7d0JBQ2pDLE9BQU8sRUFBRSxXQUFXO3dCQUNwQixTQUFTLEVBQUU7NEJBQ1QsR0FBRyxFQUFFLFNBQVM7NEJBQ2QsR0FBRyxFQUFFLE9BQU87eUJBQ2I7cUJBQ0Y7b0JBQ0QsT0FBTyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRTtpQkFDL0IsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUM5QixRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1lBQ3JDLEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDNUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxTQUF1QixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUV2RSxNQUFNLE1BQU0sR0FBRyxNQUFPLE9BQWUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO2dCQUU5RCxNQUFNLFdBQVcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUM3QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sV0FBVyxTQUFTLENBQUMsQ0FBQztZQUNuRCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDekQsTUFBTSxXQUFXLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDN0MsTUFBTSxXQUFXLEdBQUc7b0JBQ2xCLE1BQU0sRUFBRSxPQUFPLFdBQVcsU0FBUztpQkFDcEMsQ0FBQztnQkFFRCxhQUFhLENBQUMsT0FBTyxDQUFDLFNBQXVCLENBQUMsaUJBQWlCLENBQzlELFdBQVcsQ0FDWixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU8sT0FBZSxDQUFDLHFCQUFxQixFQUFFLENBQUM7Z0JBRTlELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxXQUFXLFNBQVMsQ0FBQyxDQUFDO1lBQ25ELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUMzRCxNQUFNLFdBQVcsR0FBRztvQkFDbEIsTUFBTSxFQUFFLGdCQUFnQjtpQkFDekIsQ0FBQztnQkFFRCxhQUFhLENBQUMsT0FBTyxDQUFDLFNBQXVCLENBQUMsaUJBQWlCLENBQzlELFdBQVcsQ0FDWixDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU8sT0FBZSxDQUFDLHFCQUFxQixFQUFFLENBQUM7Z0JBRTlELE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxXQUFXLFNBQVMsQ0FBQyxDQUFDO1lBQ25ELENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDaEQsTUFBTSxTQUFTLEdBQUc7b0JBQ2hCLFlBQVksRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRTtvQkFDekMsbUJBQW1CLEVBQUUsRUFBRTtvQkFDdkIsa0JBQWtCLEVBQUUsQ0FBQztvQkFDckIscUJBQXFCLEVBQUUsRUFBRTtvQkFDekIsbUJBQW1CLEVBQUU7d0JBQ25CLEVBQUUsSUFBSSxFQUFFLHlCQUFnQixDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUU7d0JBQ3RELEVBQUUsSUFBSSxFQUFFLHlCQUFnQixDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUU7cUJBQ3pEO2lCQUNGLENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxTQUF1QixDQUFDLGlCQUFpQixDQUM5RCxTQUFTLENBQUMsWUFBWSxDQUN2QixDQUFDO2dCQUNELGFBQWEsQ0FBQyxZQUFZLENBQUMsS0FBbUI7cUJBQzVDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQztxQkFDcEQscUJBQXFCLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDO3FCQUNuRCxxQkFBcUIsQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMsQ0FBQztnQkFDekQsYUFBYSxDQUFDLFlBQVksQ0FBQyxPQUFxQixDQUFDLGlCQUFpQixDQUNqRSxTQUFTLENBQUMsbUJBQW1CLENBQzlCLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztnQkFFcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztvQkFDckIsWUFBWSxFQUFFLEtBQUs7b0JBQ25CLG1CQUFtQixFQUFFLEVBQUU7b0JBQ3ZCLGtCQUFrQixFQUFFLENBQUM7b0JBQ3JCLHFCQUFxQixFQUFFLEVBQUU7b0JBQ3pCLG1CQUFtQixFQUFFLFNBQVMsQ0FBQyxtQkFBbUI7aUJBQ25ELENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUM3QyxhQUFhLENBQUMsT0FBTyxDQUFDLFNBQXVCLENBQUMsaUJBQWlCLENBQUM7b0JBQy9ELElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7aUJBQ3ZCLENBQUMsQ0FBQztnQkFDRixhQUFhLENBQUMsWUFBWSxDQUFDLEtBQW1CLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BFLGFBQWEsQ0FBQyxZQUFZLENBQUMsT0FBcUIsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFeEUsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztnQkFFcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFFakUsYUFBYSxDQUFDLGdCQUFnQixDQUFDLFVBQ2hDLENBQUMsaUJBQWlCLENBQUM7Z0JBQ2xCLEVBQUUsRUFBRSxTQUFTO2dCQUNiLFlBQVksRUFBRSxLQUFLO2FBQ3BCLENBQUMsQ0FBQztZQUNGLGFBQWEsQ0FBQyxZQUFZLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDaEUsSUFBSSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FDNUIsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztnQkFDekIsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTtnQkFDNUIsTUFBTSxFQUFFLFNBQVM7YUFDbEIsQ0FBQyxDQUNILENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xFLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FDM0QsSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FDckMsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxhQUFhLENBQUM7Z0JBQ3BCLE1BQU0sRUFBRSxLQUFLO2FBQ2QsQ0FBQyxDQUNILENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZFLGFBQWEsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQzFDLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQ2hDLENBQUM7WUFFRixNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSwwQkFBYSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FDaEUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFFeEMsa0NBQWtDO1lBQ2xDLE1BQU0sQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7UUFDaEQsTUFBTSxnQkFBZ0IsR0FBRztZQUN2QixFQUFFLEVBQUUsaUJBQWlCO1lBQ3JCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07WUFDNUIsTUFBTSxFQUFFLGFBQWE7WUFDckIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLEtBQUs7WUFDNUIsWUFBWSxFQUFFLHFCQUFZLENBQUMsT0FBTztZQUNsQyxNQUFNLEVBQUUsSUFBSTtZQUNaLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxNQUFNO1lBQ2pDLGtCQUFrQixFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztZQUMxQyxnQkFBZ0IsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUM7WUFDeEMsSUFBSSxFQUFFO2dCQUNKLEVBQUUsRUFBRSxhQUFhO2dCQUNqQixZQUFZLEVBQUUsSUFBSTtnQkFDbEIsV0FBVyxFQUFFLEtBQUs7YUFDbkI7U0FDRixDQUFDO1FBRUYsTUFBTSxXQUFXLEdBQUc7WUFDbEIsRUFBRSxFQUFFLGFBQWE7WUFDakIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLE9BQU87WUFDOUIsWUFBWSxFQUFFLEtBQUs7WUFDbkIsV0FBVyxFQUFFLE1BQU07U0FDcEIsQ0FBQztRQUVGLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7WUFDdEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGdCQUF1QixDQUFDLENBQUM7Z0JBQ3RGLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzFGLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUMzRCxNQUFNLE9BQU8sR0FBRztvQkFDZCxZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPO29CQUNsQyxpQkFBaUIsRUFBRSxtQkFBbUI7b0JBQ3RDLGFBQWEsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUM7aUJBQ3RDLENBQUM7Z0JBRUYsTUFBTSxjQUFjLEdBQUc7b0JBQ3JCLEdBQUcsZ0JBQWdCO29CQUNuQixNQUFNLEVBQUUsYUFBYTtvQkFDckIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLE9BQU87b0JBQzlCLE1BQU0sRUFBRSxLQUFLO2lCQUNkLENBQUM7Z0JBRUYsTUFBTSxtQkFBbUIsR0FBRztvQkFDMUIsRUFBRSxFQUFFLFdBQVc7b0JBQ2YsTUFBTSxFQUFFLENBQUMsSUFBSTtvQkFDYixXQUFXLEVBQUUsa0NBQWtDO2lCQUNoRCxDQUFDO2dCQUVGLE1BQU0sbUJBQW1CLEdBQUc7b0JBQzFCLEVBQUUsRUFBRSxXQUFXO29CQUNmLE1BQU0sRUFBRSxLQUFLO29CQUNiLFdBQVcsRUFBRSxrQ0FBa0M7aUJBQ2hELENBQUM7Z0JBRUQsYUFBYSxDQUFDLFlBQTBCLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFO29CQUM5RSxNQUFNLE9BQU8sR0FBRzt3QkFDZCxZQUFZLEVBQUU7NEJBQ1osTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLENBQUM7eUJBQ3BEO3dCQUNELE9BQU8sRUFBRTs0QkFDUCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO2dDQUNsQyxFQUFFLEVBQUUsbUJBQW1CO2dDQUN2QixTQUFTLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxtQkFBbUIsQ0FBQzs2QkFDdEQsQ0FBQzt5QkFDSDt3QkFDRCxlQUFlLEVBQUU7NEJBQ2YsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7eUJBQ3RCO3FCQUNGLENBQUM7b0JBQ0YsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzNCLENBQUMsQ0FBQyxDQUFDO2dCQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLHNCQUFzQixDQUNqRCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIsYUFBYSxFQUNiLE9BQU8sQ0FDUixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBQ3ZDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUN4RCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDcEQsTUFBTSxPQUFPLEdBQUc7b0JBQ2QsWUFBWSxFQUFFLHFCQUFZLENBQUMsT0FBTztvQkFDbEMsaUJBQWlCLEVBQUUsTUFBTTtpQkFDMUIsQ0FBQztnQkFFRixNQUFNLGNBQWMsR0FBRztvQkFDckIsR0FBRyxnQkFBZ0I7b0JBQ25CLE1BQU0sRUFBRSxhQUFhO29CQUNyQixJQUFJLEVBQUUseUJBQWdCLENBQUMsT0FBTztvQkFDOUIsTUFBTSxFQUFFLEtBQUs7aUJBQ2QsQ0FBQztnQkFFRCxhQUFhLENBQUMsWUFBWSxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBRW5GLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLHNCQUFzQixDQUNqRCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIsYUFBYSxFQUNiLE9BQU8sQ0FDUixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBQ3ZDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUM3RCxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNLEVBQUU7b0JBQ3ZDLElBQUksRUFBRTt3QkFDSixNQUFNLEVBQUUsYUFBYTt3QkFDckIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLE9BQU87d0JBQzlCLE1BQU0sRUFBRSxLQUFLO3dCQUNiLFlBQVksRUFBRSxxQkFBWSxDQUFDLE9BQU87cUJBQ25DO29CQUNELE9BQU8sRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztpQkFDNUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2hFLE1BQU0sVUFBVSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLE9BQU8sR0FBRztvQkFDZCxZQUFZLEVBQUUscUJBQVksQ0FBQyxNQUFNO29CQUNqQyxhQUFhLEVBQUUsVUFBVTtvQkFDekIsaUJBQWlCLEVBQUUsTUFBTTtpQkFDMUIsQ0FBQztnQkFFRixNQUFNLGNBQWMsR0FBRztvQkFDckIsR0FBRyxnQkFBZ0I7b0JBQ25CLE1BQU0sRUFBRSxhQUFhO29CQUNyQixJQUFJLEVBQUUseUJBQWdCLENBQUMsT0FBTztvQkFDOUIsTUFBTSxFQUFFLE1BQU07b0JBQ2QsbUJBQW1CLEVBQUU7d0JBQ25CLFNBQVMsRUFBRSxhQUFhO3dCQUN4QixhQUFhLEVBQUUsVUFBVTtxQkFDMUI7aUJBQ0YsQ0FBQztnQkFFRCxhQUFhLENBQUMsWUFBWSxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBRW5GLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLHNCQUFzQixDQUNqRCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIsYUFBYSxFQUNiLE9BQU8sQ0FDUixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdkUsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzdELE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxzQkFBc0IsQ0FDNUIsMEJBQWEsQ0FBQyxNQUFNLEVBQ3BCLGFBQWEsRUFDYixFQUFFLFlBQVksRUFBRSxxQkFBWSxDQUFDLE9BQU8sRUFBRSxDQUN2QyxDQUNGLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1lBQ3pDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNoRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDO29CQUM1RCxHQUFHLGdCQUFnQjtvQkFDbkIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLFFBQVE7aUJBQzdCLENBQUMsQ0FBQztnQkFFVixNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsc0JBQXNCLENBQzVCLDBCQUFhLENBQUMsTUFBTSxFQUNwQixhQUFhLEVBQ2IsRUFBRSxZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPLEVBQUUsQ0FDdkMsQ0FDRixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsNEJBQW1CLENBQUMsQ0FBQztZQUN6QyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtZQUNqQyxFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzdELE1BQU0sVUFBVSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLE9BQU8sR0FBRztvQkFDZCxVQUFVO29CQUNWLE1BQU0sRUFBRSxvQkFBb0I7aUJBQzdCLENBQUM7Z0JBRUYsTUFBTSxrQkFBa0IsR0FBRztvQkFDekIsR0FBRyxnQkFBZ0I7b0JBQ25CLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxNQUFNO29CQUNqQyxRQUFRLEVBQUUsSUFBSSxJQUFJLEVBQUU7b0JBQ3BCLFVBQVU7b0JBQ1YsV0FBVyxFQUFFLG9CQUFvQjtpQkFDbEMsQ0FBQztnQkFFRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGtCQUF5QixDQUFDLENBQUM7Z0JBRXZGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGlCQUFpQixDQUFDLDBCQUFhLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUU5RSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sRUFBRTtvQkFDNUUsTUFBTSxFQUFFLDJCQUFrQixDQUFDLE1BQU07b0JBQ2pDLFFBQVEsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQztvQkFDMUIsVUFBVTtvQkFDVixXQUFXLEVBQUUsb0JBQW9CO2lCQUNsQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDdEQsTUFBTSxPQUFPLEdBQUc7b0JBQ2QsTUFBTSxFQUFFLGlCQUFpQjtpQkFDMUIsQ0FBQztnQkFFRixNQUFNLGtCQUFrQixHQUFHO29CQUN6QixHQUFHLGdCQUFnQjtvQkFDbkIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLE1BQU07b0JBQ2pDLFFBQVEsRUFBRSxJQUFJLElBQUksRUFBRTtvQkFDcEIsV0FBVyxFQUFFLGlCQUFpQjtpQkFDL0IsQ0FBQztnQkFFRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGtCQUF5QixDQUFDLENBQUM7Z0JBRXZGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGlCQUFpQixDQUFDLDBCQUFhLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUU5RSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUM1QyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtZQUNsQyxFQUFFLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2pELE1BQU0sa0JBQWtCLEdBQUc7b0JBQ3pCLEdBQUcsZ0JBQWdCO29CQUNuQixNQUFNLEVBQUUsMkJBQWtCLENBQUMsTUFBTTtvQkFDakMsUUFBUSxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztvQkFDaEMsVUFBVSxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztpQkFDbkMsQ0FBQztnQkFFRixNQUFNLG1CQUFtQixHQUFHO29CQUMxQixHQUFHLGtCQUFrQjtvQkFDckIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLE1BQU07b0JBQ2pDLFFBQVEsRUFBRSxJQUFJO29CQUNkLFVBQVUsRUFBRSxJQUFJO29CQUNoQixXQUFXLEVBQUUsSUFBSTtvQkFDakIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2lCQUN0QixDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsa0JBQXlCLENBQUMsQ0FBQztnQkFDekYsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxtQkFBMEIsQ0FBQyxDQUFDO2dCQUV4RixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUV0RSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLDBCQUFhLENBQUMsTUFBTSxFQUFFO29CQUM1RSxNQUFNLEVBQUUsMkJBQWtCLENBQUMsTUFBTTtvQkFDakMsUUFBUSxFQUFFLElBQUk7b0JBQ2QsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLFdBQVcsRUFBRSxJQUFJO29CQUNqQixTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7aUJBQzVCLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLG9EQUFvRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNsRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGdCQUF1QixDQUFDLENBQUM7Z0JBRXZGLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUNqRCxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsNEJBQW1CLENBQUMsQ0FBQztZQUN6QyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxFQUFFLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzFELE1BQU0sWUFBWSxHQUFHO29CQUNuQixpQkFBaUIsRUFBRSxJQUFJO29CQUN2QixNQUFNLEVBQUUsa0JBQWtCO2lCQUMzQixDQUFDO2dCQUVGLE1BQU0scUJBQXFCLEdBQUc7b0JBQzVCLEdBQUcsZ0JBQWdCO29CQUNuQixpQkFBaUIsRUFBRSxJQUFJO29CQUN2QixVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUU7b0JBQ3RCLGtCQUFrQixFQUFFLGtCQUFrQjtvQkFDdEMseUJBQXlCLEVBQUUsZ0JBQWdCLENBQUMsZ0JBQWdCO2lCQUM3RCxDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLG9CQUFvQixDQUFDLENBQUMsaUJBQWlCLENBQUMscUJBQTRCLENBQUMsQ0FBQztnQkFFMUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsZ0NBQWdDLENBQzNELDBCQUFhLENBQUMsTUFBTSxFQUNwQixZQUFZLENBQ2IsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM1QyxNQUFNLENBQUMsTUFBTSxDQUFDLHlCQUF5QixDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDdEYsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3RELE1BQU0sWUFBWSxHQUFHO29CQUNuQixpQkFBaUIsRUFBRSxLQUFLO29CQUN4QixNQUFNLEVBQUUsMkJBQTJCO2lCQUNwQyxDQUFDO2dCQUVGLE1BQU0sb0JBQW9CLEdBQUc7b0JBQzNCLEdBQUcsZ0JBQWdCO29CQUNuQixNQUFNLEVBQUUsMkJBQWtCLENBQUMsUUFBUTtvQkFDbkMsVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFO29CQUN0QixrQkFBa0IsRUFBRSwyQkFBMkI7b0JBQy9DLHlCQUF5QixFQUFFLElBQUksSUFBSSxFQUFFO2lCQUN0QyxDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLG9CQUFvQixDQUFDLENBQUMsaUJBQWlCLENBQUMsb0JBQTJCLENBQUMsQ0FBQztnQkFFekYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsZ0NBQWdDLENBQzNELDBCQUFhLENBQUMsTUFBTSxFQUNwQixZQUFZLENBQ2IsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1lBQ3RFLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO1lBQ3RDLEVBQUUsQ0FBQyxpRUFBaUUsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDL0UsTUFBTSxvQkFBb0IsR0FBRztvQkFDM0IsR0FBRyxnQkFBZ0I7b0JBQ25CLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxRQUFRO29CQUNuQyxVQUFVLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO2lCQUNuQyxDQUFDO2dCQUVGLE1BQU0sZ0JBQWdCLEdBQUc7b0JBQ3ZCLEVBQUUsRUFBRSx1QkFBdUI7b0JBQzNCLElBQUksRUFBRSwwQkFBaUIsQ0FBQyxJQUFJO29CQUM1QixTQUFTLEVBQUUsSUFBSTtpQkFDaEIsQ0FBQztnQkFFRixNQUFNLHVCQUF1QixHQUFHO29CQUM5QixHQUFHLG9CQUFvQjtvQkFDdkIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLE1BQU07b0JBQ2pDLFVBQVUsRUFBRSxJQUFJO29CQUNoQixrQkFBa0IsRUFBRSxJQUFJO29CQUN4QixhQUFhLEVBQUUsSUFBSSxJQUFJLEVBQUU7b0JBQ3pCLHNCQUFzQixFQUFFLHVCQUF1QjtpQkFDaEQsQ0FBQztnQkFFRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLG9CQUEyQixDQUFDLENBQUM7Z0JBQzFGLGFBQWEsQ0FBQyxhQUFhLENBQUMsVUFBd0IsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUMxRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLHVCQUE4QixDQUFDLENBQUM7Z0JBRTVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLHNCQUFzQixDQUNqRCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIsdUJBQXVCLENBQ3hCLENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsMkJBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3RELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUN0RSxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxnRUFBZ0UsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDOUUsTUFBTSxvQkFBb0IsR0FBRztvQkFDM0IsR0FBRyxnQkFBZ0I7b0JBQ25CLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxRQUFRO29CQUNuQyxzQkFBc0IsRUFBRSx5QkFBeUI7aUJBQ2xELENBQUM7Z0JBRUYsTUFBTSx1QkFBdUIsR0FBRztvQkFDOUIsR0FBRyxvQkFBb0I7b0JBQ3ZCLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxNQUFNO29CQUNqQyxVQUFVLEVBQUUsSUFBSTtvQkFDaEIsYUFBYSxFQUFFLElBQUksSUFBSSxFQUFFO2lCQUMxQixDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsb0JBQTJCLENBQUMsQ0FBQztnQkFDM0YsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyx1QkFBOEIsQ0FBQyxDQUFDO2dCQUU1RixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUUxRSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQywyQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBQ3hFLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNwRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGdCQUF1QixDQUFDLENBQUM7Z0JBRXZGLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUNyRCxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsNEJBQW1CLENBQUMsQ0FBQztZQUN6QyxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDckUsTUFBTSxvQkFBb0IsR0FBRztvQkFDM0IsR0FBRyxnQkFBZ0I7b0JBQ25CLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxRQUFRO2lCQUNwQyxDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsb0JBQTJCLENBQUMsQ0FBQztnQkFDMUYsYUFBYSxDQUFDLGFBQWEsQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUU5RSxNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsc0JBQXNCLENBQUMsMEJBQWEsQ0FBQyxNQUFNLEVBQUUsNkJBQTZCLENBQUMsQ0FDcEYsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7WUFDM0MsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNyRCxNQUFNLFlBQVksR0FBRztvQkFDbkIsRUFBRSxFQUFFLGFBQWE7b0JBQ2pCLElBQUksRUFBRSxRQUFRO29CQUNkLElBQUksRUFBRSxxQkFBWSxDQUFDLFVBQVU7b0JBQzdCLFVBQVUsRUFBRSxFQUFFO29CQUNkLFFBQVEsRUFBRSxJQUFJO29CQUNkLFVBQVUsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUM7b0JBQ2xDLFdBQVcsRUFBRSxDQUFDO29CQUNkLE9BQU8sRUFBRSxHQUFHO2lCQUNiLENBQUM7Z0JBRUYsTUFBTSx3QkFBd0IsR0FBRztvQkFDL0IsR0FBRyxnQkFBZ0I7b0JBQ25CLGdCQUFnQixFQUFFLENBQUM7NEJBQ2pCLEVBQUUsRUFBRSxxQkFBcUI7NEJBQ3pCLFVBQVUsRUFBRSxhQUFhOzRCQUN6QixjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBRTs0QkFDbkMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO3lCQUN0QixDQUFDO2lCQUNILENBQUM7Z0JBRUYsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFtQixDQUFDLENBQUM7Z0JBQzlFLGFBQWEsQ0FBQyxZQUEwQixDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRTtvQkFDOUUsTUFBTSxPQUFPLEdBQUc7d0JBQ2Qsb0JBQW9CLEVBQUU7NEJBQ3BCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsd0JBQXdCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQ2xGO3dCQUNELFFBQVEsRUFBRTs0QkFDUixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt5QkFDbEI7d0JBQ0QsWUFBWSxFQUFFOzRCQUNaLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsd0JBQXdCLENBQUM7eUJBQ2xFO3FCQUNGLENBQUM7b0JBQ0YsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzNCLENBQUMsQ0FBQyxDQUFDO2dCQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLDJCQUEyQixDQUN0RCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIsUUFBUSxDQUNULENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUM5QyxNQUFNLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNuRSxNQUFNLFlBQVksR0FBRztvQkFDbkIsRUFBRSxFQUFFLGFBQWE7b0JBQ2pCLElBQUksRUFBRSxRQUFRO2lCQUNmLENBQUM7Z0JBRUYsTUFBTSx3QkFBd0IsR0FBRztvQkFDL0IsR0FBRyxnQkFBZ0I7b0JBQ25CLGdCQUFnQixFQUFFLENBQUM7NEJBQ2pCLFVBQVUsRUFBRSxhQUFhO3lCQUMxQixDQUFDO2lCQUNILENBQUM7Z0JBRUYsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFtQixDQUFDLENBQUM7Z0JBQy9FLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsd0JBQStCLENBQUMsQ0FBQztnQkFFL0YsTUFBTSxNQUFNLENBQ1YsT0FBTyxDQUFDLDJCQUEyQixDQUFDLDBCQUFhLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUNwRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsNEJBQW1CLENBQUMsQ0FBQztZQUN6QyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtZQUMxQyxFQUFFLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2pELE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMzQyxNQUFNLG1CQUFtQixHQUFHO29CQUMxQixHQUFHLGdCQUFnQjtvQkFDbkIsa0JBQWtCLEVBQUUsV0FBVztvQkFDL0IsZ0JBQWdCLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO29CQUN4QyxZQUFZLEVBQUUsQ0FBQztpQkFDaEIsQ0FBQztnQkFFRixNQUFNLFdBQVcsR0FBRztvQkFDbEIsRUFBRSxFQUFFLG9CQUFvQjtvQkFDeEIsTUFBTSxFQUFFLGdCQUFnQixDQUFDLE1BQU07b0JBQy9CLE1BQU0sRUFBRSxzQkFBYSxDQUFDLFNBQVM7aUJBQ2hDLENBQUM7Z0JBRUQsYUFBYSxDQUFDLFlBQVksQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JBQ3hGLGFBQWEsQ0FBQyxZQUEwQixDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRTtvQkFDOUUsTUFBTSxPQUFPLEdBQUc7d0JBQ2QsT0FBTyxFQUFFOzRCQUNQLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDO3lCQUNqRDt3QkFDRCxZQUFZLEVBQUU7NEJBQ1osTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxtQkFBbUIsQ0FBQzt5QkFDekQ7cUJBQ0YsQ0FBQztvQkFDRixPQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDM0IsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRTdFLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNwQyxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3pELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNyRCxNQUFNLFdBQVcsR0FBRztvQkFDbEIsRUFBRSxFQUFFLG1CQUFtQjtvQkFDdkIsTUFBTSxFQUFFLHNCQUFhLENBQUMsTUFBTTtpQkFDN0IsQ0FBQztnQkFFRixNQUFNLG1CQUFtQixHQUFHO29CQUMxQixHQUFHLGdCQUFnQjtvQkFDbkIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLFFBQVE7b0JBQ25DLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtpQkFDeEIsQ0FBQztnQkFFRCxhQUFhLENBQUMsWUFBWSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDeEYsYUFBYSxDQUFDLFlBQTBCLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFO29CQUM5RSxNQUFNLE9BQU8sR0FBRzt3QkFDZCxPQUFPLEVBQUU7NEJBQ1AsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUM7eUJBQ2pEO3dCQUNELFlBQVksRUFBRTs0QkFDWixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLG1CQUFtQixDQUFDO3lCQUN6RDtxQkFDRixDQUFDO29CQUNGLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMzQixDQUFDLENBQUMsQ0FBQztnQkFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFN0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsMkJBQWtCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDMUQsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsZ0RBQWdELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzdELGFBQWEsQ0FBQyxZQUFZLENBQUMsVUFBd0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFN0UsTUFBTSxNQUFNLENBQ1YsT0FBTyxDQUFDLDBCQUEwQixDQUFDLDJCQUEyQixDQUFDLENBQ2hFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1lBQzdDLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDOUQsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUV2QyxNQUFNLGdCQUFnQixHQUFHO29CQUN2QixFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7b0JBQzNFLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTtvQkFDdkUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFO2lCQUMzRSxDQUFDO2dCQUVGLE1BQU0saUJBQWlCLEdBQUc7b0JBQ3hCLGNBQWMsRUFBRSxnQkFBZ0IsQ0FBQyxFQUFFO29CQUNuQyxNQUFNLEVBQUUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUU7b0JBQzFDLFVBQVUsRUFBRTt3QkFDVixTQUFTLEVBQUUsSUFBSTt3QkFDZixPQUFPLEVBQUUsRUFBRTtxQkFDWjtvQkFDRCxVQUFVLEVBQUU7d0JBQ1YsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUU7d0JBQ3ZDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFO3dCQUNuQyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRTtxQkFDdkM7b0JBQ0QsTUFBTSxFQUFFO3dCQUNOLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRTt3QkFDL0MsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFO3FCQUMxQztpQkFDRixDQUFDO2dCQUVELGFBQWEsQ0FBQyxXQUFXLENBQUMsUUFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUNyRixhQUFhLENBQUMsV0FBVyxDQUFDLE9BQXFCLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pFLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUU7b0JBQ2xELEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUU7aUJBQy9DLENBQUMsQ0FBQztnQkFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyw2QkFBNkIsQ0FDeEQsZ0JBQWdCLENBQUMsRUFBRSxFQUNuQixTQUFTLEVBQ1QsT0FBTyxDQUNSLENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDL0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzdDLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLGtFQUFrRSxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNoRixNQUFNLFdBQVcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO2dCQUMvQixNQUFNLFlBQVksR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLEVBQUUsV0FBVyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUNwRixNQUFNLFVBQVUsR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLEVBQUUsV0FBVyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFFckYsYUFBYSxDQUFDLFdBQVcsQ0FBQyxRQUFzQixDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN2RSxhQUFhLENBQUMsV0FBVyxDQUFDLE9BQXFCLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRXZFLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLDZCQUE2QixDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUVoRixNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7Z0JBQ3JFLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUNuRSxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1FBQ3pDLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7WUFDdEMsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN0RSxNQUFNLFdBQVcsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDM0MsTUFBTSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQzNDLE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUN6QyxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBQ3hCLE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFFeEIsTUFBTSxNQUFNLEdBQUksT0FBZSxDQUFDLGtCQUFrQixDQUNoRCxTQUFTLEVBQ1QsU0FBUyxFQUNULFdBQVcsRUFDWCxTQUFTLEVBQ1QsV0FBVyxDQUNaLENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6QyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMvRCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDOUQsTUFBTSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQzNDLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMzQyxNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDekMsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDO2dCQUN4QixNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBRXhCLE1BQU0sTUFBTSxHQUFJLE9BQWUsQ0FBQyxrQkFBa0IsQ0FDaEQsU0FBUyxFQUNULFNBQVMsRUFDVCxXQUFXLEVBQ1gsU0FBUyxFQUNULFdBQVcsQ0FDWixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0MsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsdURBQXVELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3JFLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDM0MsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFDeEIsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDO2dCQUV4QixNQUFNLE1BQU0sR0FBSSxPQUFlLENBQUMsa0JBQWtCLENBQ2hELFNBQVMsRUFDVCxTQUFTLEVBQ1QsV0FBVyxFQUNYLFNBQVMsRUFDVCxXQUFXLENBQ1osQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1lBQ25DLEVBQUUsQ0FBQyxxREFBcUQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDbkUsTUFBTSxnQkFBZ0IsR0FBRztvQkFDdkIsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRTtvQkFDekQsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRTtvQkFDeEQsRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRTtpQkFDNUQsQ0FBQztnQkFFRixNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDekMsTUFBTSxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBRXRDLGFBQWEsQ0FBQyxXQUFXLENBQUMsUUFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUV0RixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxxQkFBcUIsQ0FDaEQsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxPQUFPLENBQ1IsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO29CQUNsQyxPQUFPLEVBQUUsV0FBVztvQkFDcEIsUUFBUSxFQUFFLElBQUk7b0JBQ2QsU0FBUyxFQUFFLElBQUk7b0JBQ2YsV0FBVyxFQUFFLEtBQUs7aUJBQ25CLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN0RCxNQUFNLGdCQUFnQixHQUFHO29CQUN2QixFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO2lCQUMzRCxDQUFDO2dCQUVGLE1BQU0sZ0JBQWdCLEdBQUc7b0JBQ3ZCLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7b0JBQ2xDLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7b0JBQ3RDLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7aUJBQzNDLENBQUM7Z0JBRUQsYUFBYSxDQUFDLFdBQVcsQ0FBQyxRQUFzQixDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JBQ3JGLGFBQWEsQ0FBQyxXQUFXLENBQUMsUUFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUV0RixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQywyQkFBMkIsQ0FDdEQsaUJBQWlCLEVBQ2pCLFdBQVcsRUFDWCxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFDdEIsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQ3ZCLENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3BDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1lBQ25DLEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDakUsTUFBTSxZQUFZLEdBQUc7b0JBQ25CLEVBQUUsRUFBRSxpQkFBaUI7b0JBQ3JCLE1BQU0sRUFBRSxLQUFLO29CQUNiLFlBQVksRUFBRSxxQkFBWSxDQUFDLE9BQU87b0JBQ2xDLGtCQUFrQixFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztvQkFDMUMsZ0JBQWdCLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO2lCQUN6QyxDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLDJCQUEyQixDQUFDLFlBQW1CLENBQUMsQ0FBQztnQkFFOUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN0RCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyx5REFBeUQsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDdkUsTUFBTSxZQUFZLEdBQUc7b0JBQ25CLEVBQUUsRUFBRSxpQkFBaUI7b0JBQ3JCLE1BQU0sRUFBRSxNQUFNO29CQUNkLFlBQVksRUFBRSxxQkFBWSxDQUFDLE1BQU07b0JBQ2pDLGtCQUFrQixFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztvQkFDMUMsZ0JBQWdCLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO2lCQUN6QyxDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLDJCQUEyQixDQUFDLFlBQW1CLENBQUMsQ0FBQztnQkFFOUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN0RCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtZQUNoQyxFQUFFLENBQUMsdUNBQXVDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3JELE1BQU0sY0FBYyxHQUFHO29CQUNyQixPQUFPLEVBQUUsSUFBSTtvQkFDYixLQUFLLEVBQUUsSUFBSTtvQkFDWCxJQUFJLEVBQUUsZUFBZTtvQkFDckIsVUFBVSxFQUFFLE9BQU87aUJBQ3BCLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDO2dCQUV0QixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO2dCQUVsRSxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzdELENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNsRCxNQUFNLGNBQWMsR0FBRztvQkFDckIsT0FBTyxFQUFFLElBQUk7b0JBQ2IsU0FBUyxFQUFFLGFBQWE7aUJBQ3pCLENBQUM7Z0JBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDO2dCQUV0QixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO2dCQUVsRSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDL0MsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3hELE1BQU0sY0FBYyxHQUFHO29CQUNyQixPQUFPLEVBQUUsSUFBSTtvQkFDYixLQUFLLEVBQUUsSUFBSTtvQkFDWCxTQUFTLEVBQUUsSUFBSTtvQkFDZixvQkFBb0IsRUFBRSxZQUFZO2lCQUNuQyxDQUFDO2dCQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQztnQkFFdEIsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQztnQkFFbEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7WUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7WUFDbEMsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUM5RCxNQUFNLGFBQWEsR0FBRztvQkFDcEIsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLGNBQWMsRUFBRSxpQkFBaUI7b0JBQ2pDLE1BQU0sRUFBRSxLQUFLO29CQUNiLE1BQU0sRUFBRSxzQkFBYSxDQUFDLE1BQU07b0JBQzVCLFlBQVksRUFBRSxDQUFDO29CQUNmLFdBQVcsRUFBRSxlQUFlO2lCQUM3QixDQUFDO2dCQUVGLE1BQU0sZ0JBQWdCLEdBQUc7b0JBQ3ZCLEVBQUUsRUFBRSxpQkFBaUI7b0JBQ3JCLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxNQUFNO29CQUNqQyxzQkFBc0IsRUFBRSxtQkFBbUI7aUJBQzVDLENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUNoRixhQUFhLENBQUMsWUFBWSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFFekYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUUxRCxNQUFNLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDekMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsaURBQWlELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQy9ELE1BQU0sYUFBYSxHQUFHO29CQUNwQixFQUFFLEVBQUUsWUFBWTtvQkFDaEIsY0FBYyxFQUFFLGlCQUFpQjtvQkFDakMsTUFBTSxFQUFFLHNCQUFhLENBQUMsTUFBTTtvQkFDNUIsWUFBWSxFQUFFLENBQUM7aUJBQ2hCLENBQUM7Z0JBRUYsTUFBTSxnQkFBZ0IsR0FBRztvQkFDdkIsRUFBRSxFQUFFLGlCQUFpQjtvQkFDckIsTUFBTSxFQUFFLDJCQUFrQixDQUFDLFFBQVE7aUJBQ3BDLENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUNoRixhQUFhLENBQUMsWUFBWSxDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFFekYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUUxRCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDOUQsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2hFLE1BQU0sYUFBYSxHQUFHO29CQUNwQixFQUFFLEVBQUUsWUFBWTtvQkFDaEIsY0FBYyxFQUFFLGlCQUFpQjtvQkFDakMsTUFBTSxFQUFFLHNCQUFhLENBQUMsTUFBTTtvQkFDNUIsWUFBWSxFQUFFLENBQUM7aUJBQ2hCLENBQUM7Z0JBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUNqRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsTUFBTSxFQUFFLDJCQUFrQixDQUFDLFFBQVEsRUFBUyxDQUFDLENBQUM7Z0JBRTVHLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFFMUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDL0MsTUFBTSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDeEQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7WUFDdEMsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN4RCxNQUFNLFlBQVksR0FBRztvQkFDbkIsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTtvQkFDcEQsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTtvQkFDcEQsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTtpQkFDckQsQ0FBQztnQkFFRixNQUFNLGdCQUFnQixHQUFHO29CQUN2QixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO29CQUNqQyxNQUFNLEVBQUUsMkJBQWtCLENBQUMsTUFBTTtpQkFDbEMsQ0FBQztnQkFFRCxhQUFhLENBQUMsT0FBTyxDQUFDLFFBQXNCLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBRTlFLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLDhCQUE4QixDQUN6RCwwQkFBYSxDQUFDLE1BQU0sRUFDcEIsZ0JBQXVCLENBQ3hCLENBQUM7Z0JBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNyRCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDakQsTUFBTSxhQUFhLEdBQUc7b0JBQ3BCLGFBQWEsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUM7b0JBQ3JDLHNCQUFzQixFQUFFLEdBQUc7b0JBQzNCLFlBQVksRUFBRTt3QkFDWixTQUFTLEVBQUUsR0FBRzt3QkFDZCxPQUFPLEVBQUUsQ0FBQztxQkFDWDtvQkFDRCxjQUFjLEVBQUUsQ0FBQztpQkFDbEIsQ0FBQztnQkFFRixNQUFNLGtCQUFrQixHQUFHO29CQUN6QixFQUFFLE1BQU0sRUFBRSxzQkFBYSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7b0JBQ25FLEVBQUUsTUFBTSxFQUFFLHNCQUFhLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRTtpQkFDdkUsQ0FBQztnQkFFRCxhQUFhLENBQUMsV0FBVyxDQUFDLFFBQXNCLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMvRixhQUFhLENBQUMsT0FBTyxDQUFDLFFBQXNCLENBQUMsaUJBQWlCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFFcEYsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsd0JBQXdCLENBQ25ELDBCQUFhLENBQUMsTUFBTSxFQUNwQixhQUFhLENBQ2QsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ3pELE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUNyRSxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLFFBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsRUFBRSxDQUFDLHdFQUF3RSxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUN0RixNQUFNLFFBQVEsR0FBRztvQkFDZixFQUFFLEVBQUUsU0FBUztvQkFDYixJQUFJLEVBQUUseUJBQWdCLENBQUMsT0FBTztvQkFDOUIsWUFBWSxFQUFFLEtBQUs7aUJBQ3BCLENBQUM7Z0JBRUYsTUFBTSxpQkFBaUIsR0FBRztvQkFDeEIsRUFBRSxFQUFFLG1CQUFtQjtvQkFDdkIsSUFBSSxFQUFFLDBCQUFpQixDQUFDLElBQUk7b0JBQzVCLFNBQVMsRUFBRSxJQUFJO2lCQUNoQixDQUFDO2dCQUVELGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUF3QixDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNwRixhQUFhLENBQUMsWUFBWSxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQUM7b0JBQ2pFLEVBQUUsRUFBRSxpQkFBaUI7b0JBQ3JCLE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07b0JBQzVCLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxNQUFNO2lCQUNsQyxDQUFDLENBQUM7Z0JBRUgsTUFBTSxZQUFZLEdBQUcsTUFBTSxPQUFPLENBQUMsa0JBQWtCLENBQUM7b0JBQ3BELE1BQU0sRUFBRSwwQkFBYSxDQUFDLE1BQU07b0JBQzVCLE1BQU0sRUFBRSxTQUFTO29CQUNqQixlQUFlLEVBQUUsbUJBQW1CO2lCQUNyQyxDQUFDLENBQUM7Z0JBRUgsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsMkJBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRTNELGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FBQztvQkFDNUQsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLE1BQU0sRUFBRSxzQkFBYSxDQUFDLFNBQVM7b0JBQy9CLE1BQU0sRUFBRSxLQUFLO2lCQUNkLENBQUMsQ0FBQztnQkFFSCxNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxhQUFhLENBQUM7b0JBQzFDLE1BQU0sRUFBRSxLQUFLO29CQUNiLGNBQWMsRUFBRSxZQUFZLENBQUMsRUFBRTtvQkFDL0IsZUFBZSxFQUFFLG1CQUFtQjtpQkFDckMsQ0FBQyxDQUFDO2dCQUVILE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFhLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBRXBELGFBQWEsQ0FBQyxXQUFXLENBQUMsTUFBb0IsQ0FBQyxpQkFBaUIsQ0FBQztvQkFDaEUsRUFBRSxFQUFFLFVBQVU7b0JBQ2QsT0FBTyxFQUFFLFdBQVc7b0JBQ3BCLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQztnQkFFSCxNQUFNLEtBQUssR0FBRyxNQUFNLE9BQU8sQ0FBQyxXQUFXLENBQUM7b0JBQ3RDLGNBQWMsRUFBRSxZQUFZLENBQUMsRUFBRTtvQkFDL0IsT0FBTyxFQUFFLFdBQVc7b0JBQ3BCLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQztnQkFFSCxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQztvQkFDMUQsR0FBRyxZQUFZO29CQUNmLE1BQU0sRUFBRSwyQkFBa0IsQ0FBQyxRQUFRO2lCQUM3QixDQUFDLENBQUM7Z0JBRVYsTUFBTSxvQkFBb0IsR0FBRyxNQUFNLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUVwRixNQUFNLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLDJCQUFrQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3hFLENBQUMsQ0FBQyxDQUFDO1lBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNqRSxNQUFNLFNBQVMsR0FBRztvQkFDaEIsRUFBRSxFQUFFLFlBQVk7b0JBQ2hCLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxLQUFLO29CQUM1QixZQUFZLEVBQUUsSUFBSTtpQkFDbkIsQ0FBQztnQkFFRixNQUFNLFdBQVcsR0FBRztvQkFDbEIsRUFBRSxFQUFFLGNBQWM7b0JBQ2xCLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxPQUFPO29CQUM5QixZQUFZLEVBQUUsS0FBSztpQkFDcEIsQ0FBQztnQkFFRixNQUFNLG1CQUFtQixHQUFHO29CQUMxQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNO29CQUM1QixNQUFNLEVBQUUsWUFBWTtvQkFDcEIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLEtBQUs7b0JBQzVCLE1BQU0sRUFBRSxJQUFJO29CQUNaLGtCQUFrQixFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQztvQkFDMUMsZ0JBQWdCLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO2lCQUN6QyxDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsbUJBQTBCLENBQUMsQ0FBQztnQkFDekYsYUFBYSxDQUFDLGdCQUFnQixDQUFDLFVBQXdCLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBRXhGLE1BQU0sb0JBQW9CLEdBQUc7b0JBQzNCLEdBQUcsbUJBQW1CO29CQUN0QixNQUFNLEVBQUUsY0FBYztvQkFDdEIsSUFBSSxFQUFFLHlCQUFnQixDQUFDLE9BQU87b0JBQzlCLE1BQU0sRUFBRSxLQUFLO2lCQUNkLENBQUM7Z0JBRUQsYUFBYSxDQUFDLFlBQTBCLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFO29CQUM5RSxNQUFNLE9BQU8sR0FBRzt3QkFDZCxZQUFZLEVBQUU7NEJBQ1osTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxvQkFBb0IsQ0FBQzt5QkFDMUQ7d0JBQ0QsT0FBTyxFQUFFOzRCQUNQLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7Z0NBQ2xDLEVBQUUsRUFBRSxtQkFBbUI7Z0NBQ3ZCLEtBQUssRUFBRSxLQUFLOzZCQUNiLENBQUM7eUJBQ0g7d0JBQ0QsZUFBZSxFQUFFOzRCQUNmLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3lCQUN0QjtxQkFDRixDQUFDO29CQUNGLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMzQixDQUFDLENBQUMsQ0FBQztnQkFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxzQkFBc0IsQ0FDakQsMEJBQWEsQ0FBQyxNQUFNLEVBQ3BCLGNBQWMsRUFDZDtvQkFDRSxZQUFZLEVBQUUscUJBQVksQ0FBQyxPQUFPO29CQUNsQyxpQkFBaUIsRUFBRSxtQkFBbUI7aUJBQ3ZDLENBQ0YsQ0FBQztnQkFFRixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyx5QkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7WUFDN0MsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNqRSxNQUFNLFdBQVcsR0FBRztvQkFDbEIsTUFBTSxFQUFFLEtBQUs7b0JBQ2IsZUFBZSxFQUFFLG1CQUFtQjtvQkFDcEMsY0FBYyxFQUFFLGlCQUFpQjtpQkFDbEMsQ0FBQztnQkFFRixNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO2dCQUMxRCxZQUFZLENBQUMsSUFBSSxHQUFHLGNBQWMsQ0FBQztnQkFFbEMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUU1RSxNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUNuQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztnQkFFN0MsTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDbkUsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ25FLE1BQU0sWUFBWSxHQUFHO29CQUNuQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNO29CQUM1QixPQUFPLEVBQUUsQ0FBQztpQkFDWCxDQUFDO2dCQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsWUFBbUIsQ0FBQyxDQUFDO2dCQUVuRixNQUFNLGFBQWEsR0FBRyxJQUFJLEtBQUssQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO2dCQUNoRixhQUFhLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQztnQkFFcEMsYUFBYSxDQUFDLFlBQVksQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUVsRixNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsa0JBQWtCLENBQUMsMEJBQWEsQ0FBQyxNQUFNLEVBQUU7b0JBQy9DLE1BQU0sRUFBRSxhQUFhO2lCQUN0QixDQUFDLENBQ0gsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7WUFDcEUsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQzVELE1BQU0sWUFBWSxHQUFHO29CQUNuQixJQUFJLEVBQUUsUUFBUTtvQkFDZCxJQUFJLEVBQUUscUJBQVksQ0FBQyxVQUFVO29CQUM3QixVQUFVLEVBQUUsRUFBRTtpQkFDZixDQUFDO2dCQUVELGFBQWEsQ0FBQyxZQUEwQixDQUFDLGlCQUFpQixDQUN6RCxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUN6QyxDQUFDO2dCQUVGLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLDBCQUFhLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUNoRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsNkJBQTZCLENBQUMsQ0FBQztnQkFFakQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUN6RSxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtZQUMzQyxFQUFFLENBQUMsMERBQTBELEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3hFLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQztnQkFDNUIsTUFBTSxlQUFlLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtvQkFDdEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO3dCQUNoQixPQUFPLE9BQU8sQ0FBQyxXQUFXLENBQUM7NEJBQ3pCLGNBQWMsRUFBRSxnQkFBZ0IsQ0FBQyxFQUFFOzRCQUNuQyxPQUFPLEVBQUUsV0FBVzs0QkFDcEIsUUFBUSxFQUFFLEdBQUc7eUJBQ2QsQ0FBQyxDQUFDO29CQUNMLENBQUM7eUJBQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO3dCQUN2QixPQUFPLE9BQU8sQ0FBQyxhQUFhLENBQUM7NEJBQzNCLE1BQU0sRUFBRSxLQUFLOzRCQUNiLGNBQWMsRUFBRSxnQkFBZ0IsQ0FBQyxFQUFFO3lCQUNwQyxDQUFDLENBQUM7b0JBQ0wsQ0FBQzt5QkFBTSxDQUFDO3dCQUNOLE9BQU8sT0FBTyxDQUFDLG9CQUFvQixDQUNqQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsRUFDdEIsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQ3ZCLENBQUM7b0JBQ0osQ0FBQztnQkFDSCxDQUFDLENBQUMsQ0FBQztnQkFFRixhQUFhLENBQUMsV0FBVyxDQUFDLE1BQW9CLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztnQkFDckYsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7Z0JBQ25GLGFBQWEsQ0FBQyxPQUFPLENBQUMsU0FBdUIsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQzVGLGFBQWEsQ0FBQyxZQUFZLENBQUMsS0FBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDckUsYUFBYSxDQUFDLFlBQVksQ0FBQyxPQUFxQixDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUV4RSxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzdCLE1BQU0sT0FBTyxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztnQkFDbkQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUUzQixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUM3QyxNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqRCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDbEUsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDakUsRUFBRSxFQUFFLFNBQVMsQ0FBQyxFQUFFO29CQUNoQixPQUFPLEVBQUUsV0FBVztvQkFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQztvQkFDMUMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2lCQUN0QixDQUFDLENBQUMsQ0FBQztnQkFFSCxhQUFhLENBQUMsV0FBVyxDQUFDLFFBQXNCLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztnQkFFdkYsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQkFDckQsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsZUFBZSxDQUMxQyxpQkFBaUIsRUFDakIsV0FBVyxFQUNYLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUN0QixJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FDdkIsQ0FBQztnQkFDRixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDO2dCQUVuRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUVuQyxNQUFNLGNBQWMsR0FBRyxXQUFXLEdBQUcsYUFBYSxDQUFDO2dCQUNuRCxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDekQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7WUFDOUMsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO2dCQUNqRSxNQUFNLDBCQUEwQixHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQ3BFLGFBQWEsQ0FBQyxPQUFPLENBQUMsU0FBdUIsQ0FBQyxxQkFBcUIsQ0FBQzt3QkFDbkUsTUFBTSxFQUFFLGlCQUFpQixDQUFDLEVBQUU7cUJBQzdCLENBQUMsQ0FBQztvQkFDRixhQUFhLENBQUMsT0FBTyxDQUFDLE1BQW9CLENBQUMscUJBQXFCLENBQUM7d0JBQ2hFLEVBQUUsRUFBRSxXQUFXLENBQUMsRUFBRTt3QkFDbEIsTUFBTSxFQUFFLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxFQUFFO3FCQUNqQyxDQUFDLENBQUM7b0JBRUgsT0FBTyxPQUFPLENBQUMsYUFBYSxDQUFDO3dCQUMzQixjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBRTt3QkFDbkMsUUFBUSxFQUFFLEdBQUc7d0JBQ2IsT0FBTyxFQUFFLElBQUksSUFBSSxFQUFFO3FCQUNwQixDQUFDLENBQUM7Z0JBQ0wsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7Z0JBRTlELE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzlELE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUM5QyxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekQsQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsaUVBQWlFLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQy9FLE1BQU0sWUFBWSxHQUFHO29CQUNuQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixNQUFNLEVBQUUsMEJBQWEsQ0FBQyxNQUFNO29CQUM1QixNQUFNLEVBQUUsMkJBQWtCLENBQUMsTUFBTTtpQkFDbEMsQ0FBQztnQkFFRixNQUFNLFdBQVcsR0FBRztvQkFDbEIsRUFBRSxJQUFJLEVBQUUsMkJBQWtCLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSwyQkFBa0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDL0UsRUFBRSxJQUFJLEVBQUUsMkJBQWtCLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSwyQkFBa0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDL0UsRUFBRSxJQUFJLEVBQUUsMkJBQWtCLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSwyQkFBa0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDakYsRUFBRSxJQUFJLEVBQUUsMkJBQWtCLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSwyQkFBa0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtvQkFDakYsRUFBRSxJQUFJLEVBQUUsMkJBQWtCLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSwyQkFBa0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtpQkFDcEYsQ0FBQztnQkFFRixLQUFLLE1BQU0sVUFBVSxJQUFJLFdBQVcsRUFBRSxDQUFDO29CQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDO3dCQUM1RCxHQUFHLFlBQVk7d0JBQ2YsTUFBTSxFQUFFLFVBQVUsQ0FBQyxJQUFJO3FCQUNqQixDQUFDLENBQUM7b0JBRVYsSUFBSSxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7d0JBQ3JCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLG9CQUFvQixDQUFDLENBQUMsaUJBQWlCLENBQUM7NEJBQzFELEdBQUcsWUFBWTs0QkFDZixNQUFNLEVBQUUsVUFBVSxDQUFDLEVBQUU7eUJBQ2YsQ0FBQyxDQUFDO3dCQUVWLE1BQU0sTUFBTSxDQUNWLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQywwQkFBYSxDQUFDLE1BQU0sRUFBRTs0QkFDL0MsTUFBTSxFQUFFLFVBQVUsQ0FBQyxFQUFFO3lCQUN0QixDQUFDLENBQ0gsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQzNCLENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9iaWxsaW5nL2JpbGxpbmcuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgTm90Rm91bmRFeGNlcHRpb24sIEJhZFJlcXVlc3RFeGNlcHRpb24sIENvbmZsaWN0RXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQmlsbGluZ1NlcnZpY2UgfSBmcm9tICcuL2JpbGxpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHtcbiAgU3Vic2NyaXB0aW9uU3RhdHVzLFxuICBTdWJzY3JpcHRpb25UaWVyLFxuICBCaWxsaW5nQ3ljbGUsXG4gIFBheW1lbnRTdGF0dXMsXG4gIFBheW1lbnRNZXRob2RUeXBlLFxuICBJbnZvaWNlU3RhdHVzLFxuICBEaXNjb3VudFR5cGUsXG59IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcbmltcG9ydCB7IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlLCBURVNUX1VTRVJfSURTIH0gZnJvbSAnLi4vdGVzdC11dGlscyc7XG5cbmRlc2NyaWJlKCdCaWxsaW5nU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IEJpbGxpbmdTZXJ2aWNlO1xuICBsZXQgcHJpc21hU2VydmljZTogamVzdC5Nb2NrZWQ8UHJpc21hU2VydmljZT47XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1ByaXNtYSA9IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlKCk7XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIEJpbGxpbmdTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUHJpc21hU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1ByaXNtYSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8QmlsbGluZ1NlcnZpY2U+KEJpbGxpbmdTZXJ2aWNlKTtcbiAgICBwcmlzbWFTZXJ2aWNlID0gbW9kdWxlLmdldChQcmlzbWFTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N1YnNjcmlwdGlvbiBNYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdjcmVhdGVTdWJzY3JpcHRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUGxhbiA9IHtcbiAgICAgICAgaWQ6ICdwbGFuLWlkJyxcbiAgICAgICAgbmFtZTogJ1ByZW1pdW0gUGxhbicsXG4gICAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuUFJFTUlVTSxcbiAgICAgICAgbW9udGhseVByaWNlOiAyOS45OSxcbiAgICAgICAgeWVhcmx5UHJpY2U6IDI5OS45OSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tTdWJzY3JpcHRpb25EYXRhID0ge1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBwbGFuSWQ6ICdwbGFuLWlkJyxcbiAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGNyZWF0ZSBhIG1vbnRobHkgc3Vic2NyaXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBleHBlY3RlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICBpZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBwbGFuSWQ6ICdwbGFuLWlkJyxcbiAgICAgICAgICB0aWVyOiBTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0sXG4gICAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSxcbiAgICAgICAgICBhbW91bnQ6IDI5Ljk5LFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSxcbiAgICAgICAgICBwbGFuOiBtb2NrUGxhbixcbiAgICAgICAgICBkZWZhdWx0UGF5bWVudE1ldGhvZDogbnVsbCxcbiAgICAgICAgfTtcblxuICAgICAgICAoXG4gICAgICAgICAgcHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrXG4gICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BsYW4pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgZXhwZWN0ZWRTdWJzY3JpcHRpb24sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24obW9ja1N1YnNjcmlwdGlvbkRhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWRTdWJzY3JpcHRpb24pO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgZGF0YTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAgIHBsYW5JZDogJ3BsYW4taWQnLFxuICAgICAgICAgICAgdGllcjogU3Vic2NyaXB0aW9uVGllci5QUkVNSVVNLFxuICAgICAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSxcbiAgICAgICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgcGxhbjogdHJ1ZSxcbiAgICAgICAgICAgIGRlZmF1bHRQYXltZW50TWV0aG9kOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGNyZWF0ZSBhIHllYXJseSBzdWJzY3JpcHRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHllYXJseURhdGEgPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbkRhdGEsXG4gICAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuWUVBUkxZLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIGFtb3VudDogMjk5Ljk5LFxuICAgICAgICAgIGJpbGxpbmdDeWNsZTogQmlsbGluZ0N5Y2xlLllFQVJMWSxcbiAgICAgICAgfTtcblxuICAgICAgICAoXG4gICAgICAgICAgcHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrXG4gICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BsYW4pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgZXhwZWN0ZWRTdWJzY3JpcHRpb24sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24oeWVhcmx5RGF0YSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5hbW91bnQpLnRvQmUoMjk5Ljk5KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5iaWxsaW5nQ3ljbGUpLnRvQmUoQmlsbGluZ0N5Y2xlLllFQVJMWSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3Vic2NyaXB0aW9uIHdpdGggdHJpYWwgcGVyaW9kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB0cmlhbFN0YXJ0ID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgdHJpYWxFbmQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0cmlhbEVuZC5zZXREYXRlKHRyaWFsRW5kLmdldERhdGUoKSArIDE0KTtcblxuICAgICAgICBjb25zdCB0cmlhbERhdGEgPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbkRhdGEsXG4gICAgICAgICAgdHJpYWxTdGFydCxcbiAgICAgICAgICB0cmlhbEVuZCxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBleHBlY3RlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICBpZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuVFJJQUxJTkcsXG4gICAgICAgICAgdHJpYWxTdGFydCxcbiAgICAgICAgICB0cmlhbEVuZCxcbiAgICAgICAgfTtcblxuICAgICAgICAoXG4gICAgICAgICAgcHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrXG4gICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BsYW4pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgZXhwZWN0ZWRTdWJzY3JpcHRpb24sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24odHJpYWxEYXRhKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShTdWJzY3JpcHRpb25TdGF0dXMuVFJJQUxJTkcpO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgZGF0YTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuVFJJQUxJTkcsXG4gICAgICAgICAgICB0cmlhbFN0YXJ0LFxuICAgICAgICAgICAgdHJpYWxFbmQsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaW5jbHVkZTogZXhwZWN0LmFueShPYmplY3QpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gcGxhbiBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKFxuICAgICAgICAgIHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uUGxhbi5maW5kVW5pcXVlIGFzIGplc3QuTW9ja1xuICAgICAgICApLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZVN1YnNjcmlwdGlvbihtb2NrU3Vic2NyaXB0aW9uRGF0YSksXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcblxuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmluZFVzZXJTdWJzY3JpcHRpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIHN1YnNjcmlwdGlvbiB3aXRoIGluY2x1ZGVkIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tTdWJzY3JpcHRpb24gPSB7XG4gICAgICAgICAgaWQ6ICdzdWJzY3JpcHRpb24taWQnLFxuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgcGxhbjogeyBuYW1lOiAnUHJlbWl1bSBQbGFuJyB9LFxuICAgICAgICAgIGRlZmF1bHRQYXltZW50TWV0aG9kOiB7IGNhcmRMYXN0NDogJzQyNDInIH0sXG4gICAgICAgICAgaW52b2ljZXM6IFt7IGlkOiAnaW52b2ljZS0xJyB9XSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIG1vY2tTdWJzY3JpcHRpb24sXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kVXNlclN1YnNjcmlwdGlvbihURVNUX1VTRVJfSURTLkNMSUVOVCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU3Vic2NyaXB0aW9uKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgcGxhbjogdHJ1ZSxcbiAgICAgICAgICAgIGRlZmF1bHRQYXltZW50TWV0aG9kOiB0cnVlLFxuICAgICAgICAgICAgaW52b2ljZXM6IHtcbiAgICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgICAgICB0YWtlOiA1LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gc3Vic2NyaXB0aW9uIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIG51bGwsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kVXNlclN1YnNjcmlwdGlvbignbm9uLWV4aXN0ZW50LXVzZXInKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndXBkYXRlU3Vic2NyaXB0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1N1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgaWQ6ICdzdWJzY3JpcHRpb24taWQnLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBwbGFuSWQ6ICdvbGQtcGxhbi1pZCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrTmV3UGxhbiA9IHtcbiAgICAgICAgaWQ6ICduZXctcGxhbi1pZCcsXG4gICAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuRU5URVJQUklTRSxcbiAgICAgICAgbW9udGhseVByaWNlOiA5OS45OSxcbiAgICAgICAgeWVhcmx5UHJpY2U6IDk5OS45OSxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHVwZGF0ZSBzdWJzY3JpcHRpb24gcGxhbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgICBwbGFuSWQ6ICduZXctcGxhbi1pZCcsXG4gICAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB1cGRhdGVkU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIC4uLm1vY2tTdWJzY3JpcHRpb24sXG4gICAgICAgICAgcGxhbklkOiAnbmV3LXBsYW4taWQnLFxuICAgICAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuRU5URVJQUklTRSxcbiAgICAgICAgICBhbW91bnQ6IDk5Ljk5LFxuICAgICAgICB9O1xuXG4gICAgICAgIGplc3RcbiAgICAgICAgICAuc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJylcbiAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N1YnNjcmlwdGlvbiBhcyBhbnkpO1xuICAgICAgICAoXG4gICAgICAgICAgcHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrXG4gICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobW9ja05ld1BsYW4pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24udXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgdXBkYXRlZFN1YnNjcmlwdGlvbixcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwZGF0ZVN1YnNjcmlwdGlvbihcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICB1cGRhdGVEYXRhLFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZFN1YnNjcmlwdGlvbik7XG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgICAgZGF0YTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgcGxhbklkOiAnbmV3LXBsYW4taWQnLFxuICAgICAgICAgICAgdGllcjogU3Vic2NyaXB0aW9uVGllci5FTlRFUlBSSVNFLFxuICAgICAgICAgICAgYW1vdW50OiA5OS45OSxcbiAgICAgICAgICAgIGJpbGxpbmdDeWNsZTogQmlsbGluZ0N5Y2xlLk1PTlRITFksXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaW5jbHVkZTogZXhwZWN0LmFueShPYmplY3QpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gc3Vic2NyaXB0aW9uIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZVN1YnNjcmlwdGlvbignbm9uLWV4aXN0ZW50LXVzZXInLCB7XG4gICAgICAgICAgICBwbGFuSWQ6ICduZXctcGxhbicsXG4gICAgICAgICAgfSksXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gbmV3IHBsYW4gZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGplc3RcbiAgICAgICAgICAuc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJylcbiAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N1YnNjcmlwdGlvbiBhcyBhbnkpO1xuICAgICAgICAoXG4gICAgICAgICAgcHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrXG4gICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UudXBkYXRlU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCB7XG4gICAgICAgICAgICBwbGFuSWQ6ICdub24tZXhpc3RlbnQtcGxhbicsXG4gICAgICAgICAgfSksXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NhbmNlbFN1YnNjcmlwdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY2FuY2VsIHN1YnNjcmlwdGlvbiBieSB1cGRhdGluZyBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbmNlbGVkU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCxcbiAgICAgICAgfTtcblxuICAgICAgICBqZXN0XG4gICAgICAgICAgLnNweU9uKHNlcnZpY2UsICd1cGRhdGVTdWJzY3JpcHRpb24nKVxuICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShjYW5jZWxlZFN1YnNjcmlwdGlvbiBhcyBhbnkpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FuY2VsU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShTdWJzY3JpcHRpb25TdGF0dXMuQ0FOQ0VMRUQpO1xuICAgICAgICBleHBlY3Qoc2VydmljZS51cGRhdGVTdWJzY3JpcHRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkNBTkNFTEVELFxuICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N1YnNjcmlwdGlvbiBQbGFucycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnY3JlYXRlU3Vic2NyaXB0aW9uUGxhbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGNyZWF0ZSBhIHN1YnNjcmlwdGlvbiBwbGFuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwbGFuRGF0YSA9IHtcbiAgICAgICAgICBuYW1lOiAnUHJlbWl1bSBQbGFuJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0Z1bGwgYWNjZXNzIHBsYW4nLFxuICAgICAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuUFJFTUlVTSxcbiAgICAgICAgICBtb250aGx5UHJpY2U6IDI5Ljk5LFxuICAgICAgICAgIHllYXJseVByaWNlOiAyOTkuOTksXG4gICAgICAgICAgZmVhdHVyZXM6IHsgc2Vzc2lvbnM6ICd1bmxpbWl0ZWQnLCBzdG9yYWdlOiAnMTAwR0InIH0sXG4gICAgICAgICAgbGltaXRzOiB7IGNsaWVudHM6IDUwIH0sXG4gICAgICAgICAgdHJpYWxEYXlzOiAxNCxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBleHBlY3RlZFBsYW4gPSB7XG4gICAgICAgICAgaWQ6ICdwbGFuLWlkJyxcbiAgICAgICAgICAuLi5wbGFuRGF0YSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4cGVjdGVkUGxhbixcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZVN1YnNjcmlwdGlvblBsYW4ocGxhbkRhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWRQbGFuKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uUGxhbi5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBkYXRhOiBwbGFuRGF0YSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmaW5kQWxsUGxhbnMnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBhY3RpdmUgcGxhbnMgYnkgZGVmYXVsdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1BsYW5zID0gW1xuICAgICAgICAgIHsgaWQ6ICdwbGFuLTEnLCBuYW1lOiAnQmFzaWMnLCBtb250aGx5UHJpY2U6IDkuOTkgfSxcbiAgICAgICAgICB7IGlkOiAncGxhbi0yJywgbmFtZTogJ1ByZW1pdW0nLCBtb250aGx5UHJpY2U6IDI5Ljk5IH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgKFxuICAgICAgICAgIHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uUGxhbi5maW5kTWFueSBhcyBqZXN0Lk1vY2tcbiAgICAgICAgKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGxhbnMpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEFsbFBsYW5zKCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGxhbnMpO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHsgaXNBY3RpdmU6IHRydWUgfSxcbiAgICAgICAgICBvcmRlckJ5OiB7IG1vbnRobHlQcmljZTogJ2FzYycgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gaW5hY3RpdmUgcGxhbnMgd2hlbiBzcGVjaWZpZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHNlcnZpY2UuZmluZEFsbFBsYW5zKGZhbHNlKTtcblxuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHsgaXNBY3RpdmU6IGZhbHNlIH0sXG4gICAgICAgICAgb3JkZXJCeTogeyBtb250aGx5UHJpY2U6ICdhc2MnIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndXBkYXRlUGxhbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHVwZGF0ZSBwbGFuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgICAgIG5hbWU6ICdVcGRhdGVkIFBsYW4nLFxuICAgICAgICAgIG1vbnRobHlQcmljZTogMzkuOTksXG4gICAgICAgICAgZmVhdHVyZXM6IHsgbmV3RmVhdHVyZTogdHJ1ZSB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQbGFuID0ge1xuICAgICAgICAgIGlkOiAncGxhbi1pZCcsXG4gICAgICAgICAgLi4udXBkYXRlRGF0YSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLnVwZGF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIHVwZGF0ZWRQbGFuLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBkYXRlUGxhbigncGxhbi1pZCcsIHVwZGF0ZURhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZFBsYW4pO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiAncGxhbi1pZCcgfSxcbiAgICAgICAgICBkYXRhOiB1cGRhdGVEYXRhLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGF5bWVudCBNZXRob2RzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdjcmVhdGVQYXltZW50TWV0aG9kJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF5bWVudCBtZXRob2QgYW5kIHNldCBhcyBkZWZhdWx0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwYXltZW50TWV0aG9kRGF0YSA9IHtcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHR5cGU6IFBheW1lbnRNZXRob2RUeXBlLkNBUkQsXG4gICAgICAgICAgY2FyZExhc3Q0OiAnNDI0MicsXG4gICAgICAgICAgY2FyZEJyYW5kOiAndmlzYScsXG4gICAgICAgICAgY2FyZEV4cE1vbnRoOiAxMixcbiAgICAgICAgICBjYXJkRXhwWWVhcjogMjAyNSxcbiAgICAgICAgICBpc0RlZmF1bHQ6IHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWRQYXltZW50TWV0aG9kID0ge1xuICAgICAgICAgIGlkOiAncGF5bWVudC1tZXRob2QtaWQnLFxuICAgICAgICAgIC4uLnBheW1lbnRNZXRob2REYXRhLFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnRNZXRob2QudXBkYXRlTWFueSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIHsgY291bnQ6IDEgfSxcbiAgICAgICAgKTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudE1ldGhvZC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBleHBlY3RlZFBheW1lbnRNZXRob2QsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGVQYXltZW50TWV0aG9kKHBheW1lbnRNZXRob2REYXRhKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGV4cGVjdGVkUGF5bWVudE1ldGhvZCk7XG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnBheW1lbnRNZXRob2QudXBkYXRlTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsIGlzRGVmYXVsdDogdHJ1ZSB9LFxuICAgICAgICAgIGRhdGE6IHsgaXNEZWZhdWx0OiBmYWxzZSB9LFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucGF5bWVudE1ldGhvZC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBkYXRhOiBwYXltZW50TWV0aG9kRGF0YSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF5bWVudCBtZXRob2Qgd2l0aG91dCBzZXR0aW5nIGFzIGRlZmF1bHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBheW1lbnRNZXRob2REYXRhID0ge1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgdHlwZTogUGF5bWVudE1ldGhvZFR5cGUuQ0FSRCxcbiAgICAgICAgICBjYXJkTGFzdDQ6ICc0MjQyJyxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50TWV0aG9kLmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIHBheW1lbnRNZXRob2REYXRhLFxuICAgICAgICApO1xuXG4gICAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlUGF5bWVudE1ldGhvZChwYXltZW50TWV0aG9kRGF0YSk7XG5cbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucGF5bWVudE1ldGhvZC51cGRhdGVNYW55KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmluZFVzZXJQYXltZW50TWV0aG9kcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHVzZXIgcGF5bWVudCBtZXRob2RzIG9yZGVyZWQgYnkgZGVmYXVsdCBhbmQgY3JlYXRpb24gZGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1BheW1lbnRNZXRob2RzID0gW1xuICAgICAgICAgIHsgaWQ6ICdwbS0xJywgaXNEZWZhdWx0OiB0cnVlLCBjYXJkTGFzdDQ6ICc0MjQyJyB9LFxuICAgICAgICAgIHsgaWQ6ICdwbS0yJywgaXNEZWZhdWx0OiBmYWxzZSwgY2FyZExhc3Q0OiAnMTIzNCcgfSxcbiAgICAgICAgXTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50TWV0aG9kLmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbW9ja1BheW1lbnRNZXRob2RzLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZFVzZXJQYXltZW50TWV0aG9kcyhcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQYXltZW50TWV0aG9kcyk7XG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnBheW1lbnRNZXRob2QuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBpc0FjdGl2ZTogdHJ1ZSB9LFxuICAgICAgICAgIG9yZGVyQnk6IFt7IGlzRGVmYXVsdDogJ2Rlc2MnIH0sIHsgY3JlYXRlZEF0OiAnZGVzYycgfV0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndXBkYXRlUGF5bWVudE1ldGhvZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQYXltZW50TWV0aG9kID0ge1xuICAgICAgICBpZDogJ3BheW1lbnQtbWV0aG9kLWlkJyxcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHVwZGF0ZSBwYXltZW50IG1ldGhvZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsgaXNEZWZhdWx0OiB0cnVlIH07XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQYXltZW50TWV0aG9kID0geyAuLi5tb2NrUGF5bWVudE1ldGhvZCwgLi4udXBkYXRlRGF0YSB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnRNZXRob2QuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIG1vY2tQYXltZW50TWV0aG9kLFxuICAgICAgICApO1xuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50TWV0aG9kLnVwZGF0ZU1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICB7IGNvdW50OiAxIH0sXG4gICAgICAgICk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnRNZXRob2QudXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgdXBkYXRlZFBheW1lbnRNZXRob2QsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGRhdGVQYXltZW50TWV0aG9kKFxuICAgICAgICAgICdwYXltZW50LW1ldGhvZC1pZCcsXG4gICAgICAgICAgdXBkYXRlRGF0YSxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRQYXltZW50TWV0aG9kKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucGF5bWVudE1ldGhvZC51cGRhdGVNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCwgaXNEZWZhdWx0OiB0cnVlIH0sXG4gICAgICAgICAgZGF0YTogeyBpc0RlZmF1bHQ6IGZhbHNlIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBwYXltZW50IG1ldGhvZCBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudE1ldGhvZC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbnVsbCxcbiAgICAgICAgKTtcblxuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgc2VydmljZS51cGRhdGVQYXltZW50TWV0aG9kKCdub24tZXhpc3RlbnQtaWQnLCB7IGlzRGVmYXVsdDogdHJ1ZSB9KSxcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZGVsZXRlUGF5bWVudE1ldGhvZCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc29mdCBkZWxldGUgcGF5bWVudCBtZXRob2QgYnkgc2V0dGluZyBpc0FjdGl2ZSB0byBmYWxzZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZGVhY3RpdmF0ZWRQYXltZW50TWV0aG9kID0ge1xuICAgICAgICAgIGlkOiAncGF5bWVudC1tZXRob2QtaWQnLFxuICAgICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50TWV0aG9kLnVwZGF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGRlYWN0aXZhdGVkUGF5bWVudE1ldGhvZCxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmRlbGV0ZVBheW1lbnRNZXRob2QoJ3BheW1lbnQtbWV0aG9kLWlkJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChkZWFjdGl2YXRlZFBheW1lbnRNZXRob2QpO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5wYXltZW50TWV0aG9kLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiAncGF5bWVudC1tZXRob2QtaWQnIH0sXG4gICAgICAgICAgZGF0YTogeyBpc0FjdGl2ZTogZmFsc2UgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BheW1lbnRzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdjcmVhdGVQYXltZW50JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF5bWVudCB3aXRoIGRlZmF1bHQgdmFsdWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwYXltZW50RGF0YSA9IHtcbiAgICAgICAgICBhbW91bnQ6IDI5Ljk5LFxuICAgICAgICAgIHBheW1lbnRNZXRob2RJZDogJ3BheW1lbnQtbWV0aG9kLWlkJyxcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdNb250aGx5IHN1YnNjcmlwdGlvbicsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWRQYXltZW50ID0ge1xuICAgICAgICAgIGlkOiAncGF5bWVudC1pZCcsXG4gICAgICAgICAgLi4ucGF5bWVudERhdGEsXG4gICAgICAgICAgc3RhdHVzOiBQYXltZW50U3RhdHVzLlBFTkRJTkcsXG4gICAgICAgICAgY3VycmVuY3k6ICdVU0QnLFxuICAgICAgICAgIHBheW1lbnRNZXRob2Q6IHsgY2FyZExhc3Q0OiAnNDI0MicgfSxcbiAgICAgICAgICBzdWJzY3JpcHRpb246IHsgdGllcjogU3Vic2NyaXB0aW9uVGllci5QUkVNSVVNIH0sXG4gICAgICAgICAgaW52b2ljZTogbnVsbCxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4cGVjdGVkUGF5bWVudCxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZVBheW1lbnQocGF5bWVudERhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWRQYXltZW50KTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucGF5bWVudC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAuLi5wYXltZW50RGF0YSxcbiAgICAgICAgICAgIHN0YXR1czogUGF5bWVudFN0YXR1cy5QRU5ESU5HLFxuICAgICAgICAgICAgY3VycmVuY3k6ICdVU0QnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgcGF5bWVudE1ldGhvZDogdHJ1ZSxcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIGludm9pY2U6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF5bWVudCB3aXRoIGN1c3RvbSBjdXJyZW5jeScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcGF5bWVudERhdGEgPSB7XG4gICAgICAgICAgYW1vdW50OiAyNS45OSxcbiAgICAgICAgICBjdXJyZW5jeTogJ0VVUicsXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgaWQ6ICdwYXltZW50LWlkJyxcbiAgICAgICAgICBjdXJyZW5jeTogJ0VVUicsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlUGF5bWVudChwYXltZW50RGF0YSk7XG5cbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucGF5bWVudC5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBkYXRhOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBjdXJyZW5jeTogJ0VVUicsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaW5jbHVkZTogZXhwZWN0LmFueShPYmplY3QpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3VwZGF0ZVBheW1lbnRTdGF0dXMnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBwYXltZW50IHN0YXR1cyB0byBzdWNjZWVkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQYXltZW50ID0ge1xuICAgICAgICAgIGlkOiAncGF5bWVudC1pZCcsXG4gICAgICAgICAgc3RhdHVzOiBQYXltZW50U3RhdHVzLlNVQ0NFRURFRCxcbiAgICAgICAgICBwcm9jZXNzZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LnVwZGF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIHVwZGF0ZWRQYXltZW50LFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBkYXRlUGF5bWVudFN0YXR1cyhcbiAgICAgICAgICAncGF5bWVudC1pZCcsXG4gICAgICAgICAgUGF5bWVudFN0YXR1cy5TVUNDRUVERUQsXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkUGF5bWVudCk7XG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnBheW1lbnQudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6ICdwYXltZW50LWlkJyB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXR1czogUGF5bWVudFN0YXR1cy5TVUNDRUVERUQsXG4gICAgICAgICAgICBwcm9jZXNzZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBwYXltZW50IHN0YXR1cyB0byBmYWlsZWQgd2l0aCBtZXRhZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB7XG4gICAgICAgICAgZmFpbHVyZUNvZGU6ICdjYXJkX2RlY2xpbmVkJyxcbiAgICAgICAgICBmYWlsdXJlTWVzc2FnZTogJ1lvdXIgY2FyZCB3YXMgZGVjbGluZWQuJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB1cGRhdGVkUGF5bWVudCA9IHtcbiAgICAgICAgICBpZDogJ3BheW1lbnQtaWQnLFxuICAgICAgICAgIHN0YXR1czogUGF5bWVudFN0YXR1cy5GQUlMRUQsXG4gICAgICAgICAgZmFpbGVkQXQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgICAgZmFpbHVyZUNvZGU6ICdjYXJkX2RlY2xpbmVkJyxcbiAgICAgICAgICBmYWlsdXJlTWVzc2FnZTogJ1lvdXIgY2FyZCB3YXMgZGVjbGluZWQuJyxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LnVwZGF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIHVwZGF0ZWRQYXltZW50LFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBkYXRlUGF5bWVudFN0YXR1cyhcbiAgICAgICAgICAncGF5bWVudC1pZCcsXG4gICAgICAgICAgUGF5bWVudFN0YXR1cy5GQUlMRUQsXG4gICAgICAgICAgbWV0YWRhdGEsXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkUGF5bWVudCk7XG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnBheW1lbnQudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6ICdwYXltZW50LWlkJyB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXR1czogUGF5bWVudFN0YXR1cy5GQUlMRUQsXG4gICAgICAgICAgICBmYWlsZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICAgIGZhaWx1cmVDb2RlOiAnY2FyZF9kZWNsaW5lZCcsXG4gICAgICAgICAgICBmYWlsdXJlTWVzc2FnZTogJ1lvdXIgY2FyZCB3YXMgZGVjbGluZWQuJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2ZpbmRQYXltZW50cycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHBheW1lbnRzIHdpdGggZmlsdGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1BheW1lbnRzID0gW1xuICAgICAgICAgIHsgaWQ6ICdwYXltZW50LTEnLCBzdGF0dXM6IFBheW1lbnRTdGF0dXMuU1VDQ0VFREVEIH0sXG4gICAgICAgICAgeyBpZDogJ3BheW1lbnQtMicsIHN0YXR1czogUGF5bWVudFN0YXR1cy5TVUNDRUVERUQgfSxcbiAgICAgICAgXTtcblxuICAgICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpO1xuICAgICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoJzIwMjQtMDEtMzEnKTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbW9ja1BheW1lbnRzLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZFBheW1lbnRzKFxuICAgICAgICAgICdzdWJzY3JpcHRpb24taWQnLFxuICAgICAgICAgIFBheW1lbnRTdGF0dXMuU1VDQ0VFREVELFxuICAgICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgICBlbmREYXRlLFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1BheW1lbnRzKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucGF5bWVudC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgICBzdGF0dXM6IFBheW1lbnRTdGF0dXMuU1VDQ0VFREVELFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgICAgICAgICBsdGU6IGVuZERhdGUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgcGF5bWVudE1ldGhvZDogdHJ1ZSxcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIGludm9pY2U6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnZvaWNlcycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnY3JlYXRlSW52b2ljZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGludm9pY2Ugd2l0aCBjYWxjdWxhdGVkIHRvdGFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBpbnZvaWNlRGF0YSA9IHtcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgc3VidG90YWw6IDEwMCxcbiAgICAgICAgICB0YXhBbW91bnQ6IDEwLFxuICAgICAgICAgIGRpc2NvdW50QW1vdW50OiA1LFxuICAgICAgICAgIGR1ZURhdGU6IG5ldyBEYXRlKCcyMDI0LTAyLTAxJyksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWRJbnZvaWNlID0ge1xuICAgICAgICAgIGlkOiAnaW52b2ljZS1pZCcsXG4gICAgICAgICAgLi4uaW52b2ljZURhdGEsXG4gICAgICAgICAgbnVtYmVyOiAnSU5WLTIwMjQtMDAwMDAxJyxcbiAgICAgICAgICB0b3RhbDogMTA1LCAvLyAxMDAgKyAxMCAtIDVcbiAgICAgICAgICBhbW91bnREdWU6IDEwNSxcbiAgICAgICAgICBzdGF0dXM6IEludm9pY2VTdGF0dXMuT1BFTixcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBNb2NrIGdlbmVyYXRlSW52b2ljZU51bWJlclxuICAgICAgICBqZXN0XG4gICAgICAgICAgLnNweU9uKHNlcnZpY2UgYXMgYW55LCAnZ2VuZXJhdGVJbnZvaWNlTnVtYmVyJylcbiAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoJ0lOVi0yMDI0LTAwMDAwMScpO1xuICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4cGVjdGVkSW52b2ljZSxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZUludm9pY2UoaW52b2ljZURhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWRJbnZvaWNlKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuaW52b2ljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAuLi5pbnZvaWNlRGF0YSxcbiAgICAgICAgICAgIG51bWJlcjogJ0lOVi0yMDI0LTAwMDAwMScsXG4gICAgICAgICAgICB0b3RhbDogMTA1LFxuICAgICAgICAgICAgYW1vdW50RHVlOiAxMDUsXG4gICAgICAgICAgICBzdGF0dXM6IEludm9pY2VTdGF0dXMuT1BFTixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIGxpbmVJdGVtczogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2ZpbmRJbnZvaWNlcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGludm9pY2VzIHdpdGggZmlsdGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0ludm9pY2VzID0gW1xuICAgICAgICAgIHsgaWQ6ICdpbnZvaWNlLTEnLCBzdGF0dXM6IEludm9pY2VTdGF0dXMuT1BFTiB9LFxuICAgICAgICAgIHsgaWQ6ICdpbnZvaWNlLTInLCBzdGF0dXM6IEludm9pY2VTdGF0dXMuUEFJRCB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLmludm9pY2UuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBtb2NrSW52b2ljZXMsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kSW52b2ljZXMoXG4gICAgICAgICAgJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgSW52b2ljZVN0YXR1cy5PUEVOLFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0ludm9pY2VzKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuaW52b2ljZS5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgICBzdGF0dXM6IEludm9pY2VTdGF0dXMuT1BFTixcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7IHVzZXI6IHRydWUgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5lSXRlbXM6IHRydWUsXG4gICAgICAgICAgICBwYXltZW50czogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdtYXJrSW52b2ljZUFzUGFpZCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgbWFyayBpbnZvaWNlIGFzIHBhaWQgd2hlbiBmdWxseSBwYWlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrSW52b2ljZSA9IHtcbiAgICAgICAgICBpZDogJ2ludm9pY2UtaWQnLFxuICAgICAgICAgIHRvdGFsOiAxMDAsXG4gICAgICAgICAgcGF5bWVudHM6IFtcbiAgICAgICAgICAgIHsgYW1vdW50OiA2MCwgc3RhdHVzOiBQYXltZW50U3RhdHVzLlNVQ0NFRURFRCB9LFxuICAgICAgICAgICAgeyBhbW91bnQ6IDQwLCBzdGF0dXM6IFBheW1lbnRTdGF0dXMuU1VDQ0VFREVEIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB1cGRhdGVkSW52b2ljZSA9IHtcbiAgICAgICAgICAuLi5tb2NrSW52b2ljZSxcbiAgICAgICAgICBzdGF0dXM6IEludm9pY2VTdGF0dXMuUEFJRCxcbiAgICAgICAgICBhbW91bnRQYWlkOiAxMDAsXG4gICAgICAgICAgcGFpZEF0OiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLmludm9pY2UuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIG1vY2tJbnZvaWNlLFxuICAgICAgICApO1xuICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLnVwZGF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIHVwZGF0ZWRJbnZvaWNlLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubWFya0ludm9pY2VBc1BhaWQoJ2ludm9pY2UtaWQnKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRJbnZvaWNlKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuaW52b2ljZS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogJ2ludm9pY2UtaWQnIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgc3RhdHVzOiBJbnZvaWNlU3RhdHVzLlBBSUQsXG4gICAgICAgICAgICBhbW91bnRQYWlkOiAxMDAsXG4gICAgICAgICAgICBwYWlkQXQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBrZWVwIGludm9pY2Ugb3BlbiB3aGVuIHBhcnRpYWxseSBwYWlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrSW52b2ljZSA9IHtcbiAgICAgICAgICBpZDogJ2ludm9pY2UtaWQnLFxuICAgICAgICAgIHRvdGFsOiAxMDAsXG4gICAgICAgICAgcGF5bWVudHM6IFtcbiAgICAgICAgICAgIHsgYW1vdW50OiAzMCwgc3RhdHVzOiBQYXltZW50U3RhdHVzLlNVQ0NFRURFRCB9LFxuICAgICAgICAgICAgeyBhbW91bnQ6IDIwLCBzdGF0dXM6IFBheW1lbnRTdGF0dXMuRkFJTEVEIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBtb2NrSW52b2ljZSxcbiAgICAgICAgKTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuaW52b2ljZS51cGRhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgLi4ubW9ja0ludm9pY2UsXG4gICAgICAgICAgc3RhdHVzOiBJbnZvaWNlU3RhdHVzLk9QRU4sXG4gICAgICAgICAgYW1vdW50UGFpZDogMzAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubWFya0ludm9pY2VBc1BhaWQoJ2ludm9pY2UtaWQnKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShJbnZvaWNlU3RhdHVzLk9QRU4pO1xuICAgICAgICBleHBlY3QocmVzdWx0LmFtb3VudFBhaWQpLnRvQmUoMzApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBpbnZvaWNlIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgc2VydmljZS5tYXJrSW52b2ljZUFzUGFpZCgnbm9uLWV4aXN0ZW50LWlkJyksXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGlzY291bnRzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdjcmVhdGVEaXNjb3VudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGRpc2NvdW50IHdpdGggZGVmYXVsdCB2YWxpZCBmcm9tIGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGRpc2NvdW50RGF0YSA9IHtcbiAgICAgICAgICBjb2RlOiAnU0FWRTIwJyxcbiAgICAgICAgICBuYW1lOiAnMjAlIE9mZicsXG4gICAgICAgICAgdHlwZTogRGlzY291bnRUeXBlLlBFUkNFTlRBR0UsXG4gICAgICAgICAgcGVyY2VudE9mZjogMjAsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZXhwZWN0ZWREaXNjb3VudCA9IHtcbiAgICAgICAgICBpZDogJ2Rpc2NvdW50LWlkJyxcbiAgICAgICAgICAuLi5kaXNjb3VudERhdGEsXG4gICAgICAgICAgdmFsaWRGcm9tOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLmRpc2NvdW50LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4cGVjdGVkRGlzY291bnQsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGVEaXNjb3VudChkaXNjb3VudERhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWREaXNjb3VudCk7XG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmRpc2NvdW50LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIC4uLmRpc2NvdW50RGF0YSxcbiAgICAgICAgICAgIHZhbGlkRnJvbTogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3ZhbGlkYXRlRGlzY291bnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRGlzY291bnQgPSB7XG4gICAgICAgIGlkOiAnZGlzY291bnQtaWQnLFxuICAgICAgICBjb2RlOiAnU0FWRTIwJyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIHZhbGlkVW50aWw6IG5ldyBEYXRlKCcyMDI0LTEyLTMxJyksXG4gICAgICAgIG1heFVzZXM6IDEwMCxcbiAgICAgICAgY3VycmVudFVzZXM6IDUwLFxuICAgICAgICBtYXhVc2VzUGVyVXNlcjogMSxcbiAgICAgICAgbWluQW1vdW50OiA1MCxcbiAgICAgICAgcmVkZW1wdGlvbnM6IFtdLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdmFsaWQgZGlzY291bnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLmRpc2NvdW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBtb2NrRGlzY291bnQsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZURpc2NvdW50KFxuICAgICAgICAgICdTQVZFMjAnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIDEwMCxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tEaXNjb3VudCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBpbnZhbGlkIGRpc2NvdW50IGNvZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLmRpc2NvdW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBudWxsLFxuICAgICAgICApO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnZhbGlkYXRlRGlzY291bnQoJ0lOVkFMSUQnLCBURVNUX1VTRVJfSURTLkNMSUVOVCwgMTAwKSxcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBpbmFjdGl2ZSBkaXNjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuZGlzY291bnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAuLi5tb2NrRGlzY291bnQsXG4gICAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgICB9KTtcblxuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgc2VydmljZS52YWxpZGF0ZURpc2NvdW50KCdTQVZFMjAnLCBURVNUX1VTRVJfSURTLkNMSUVOVCwgMTAwKSxcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBleHBpcmVkIGRpc2NvdW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5kaXNjb3VudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIC4uLm1vY2tEaXNjb3VudCxcbiAgICAgICAgICB2YWxpZFVudGlsOiBuZXcgRGF0ZSgnMjAyMC0wMS0wMScpLCAvLyBFeHBpcmVkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnZhbGlkYXRlRGlzY291bnQoJ1NBVkUyMCcsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAxMDApLFxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gd2hlbiBtYXggdXNlcyByZWFjaGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5kaXNjb3VudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIC4uLm1vY2tEaXNjb3VudCxcbiAgICAgICAgICBtYXhVc2VzOiA1MCxcbiAgICAgICAgICBjdXJyZW50VXNlczogNTAsIC8vIFJlYWNoZWQgbGltaXRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UudmFsaWRhdGVEaXNjb3VudCgnU0FWRTIwJywgVEVTVF9VU0VSX0lEUy5DTElFTlQsIDEwMCksXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiB3aGVuIHVzZXIgaGFzIGFscmVhZHkgdXNlZCBkaXNjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuZGlzY291bnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAuLi5tb2NrRGlzY291bnQsXG4gICAgICAgICAgcmVkZW1wdGlvbnM6IFt7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfV0sIC8vIFVzZXIgYWxyZWFkeSB1c2VkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnZhbGlkYXRlRGlzY291bnQoJ1NBVkUyMCcsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAxMDApLFxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gd2hlbiBhbW91bnQgaXMgYmVsb3cgbWluaW11bScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UudmFsaWRhdGVEaXNjb3VudCgnU0FWRTIwJywgVEVTVF9VU0VSX0lEUy5DTElFTlQsIDI1KSwgLy8gQmVsb3cgbWluIG9mIDUwXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncmVkZWVtRGlzY291bnQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJlZGVlbSBkaXNjb3VudCBpbiB0cmFuc2FjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1RyYW5zYWN0aW9uID0ge1xuICAgICAgICAgIC4uLmNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlKCksXG4gICAgICAgICAgZGlzY291bnRSZWRlbXB0aW9uOiB7XG4gICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc2NvdW50OiB7XG4gICAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLiR0cmFuc2FjdGlvbiBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbihcbiAgICAgICAgICBhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHJhbnNhY3Rpb24pO1xuICAgICAgICAgIH0sXG4gICAgICAgICk7XG5cbiAgICAgICAgYXdhaXQgc2VydmljZS5yZWRlZW1EaXNjb3VudCgnZGlzY291bnQtaWQnLCBURVNUX1VTRVJfSURTLkNMSUVOVCwgMjApO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uZGlzY291bnRSZWRlbXB0aW9uLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGRpc2NvdW50SWQ6ICdkaXNjb3VudC1pZCcsXG4gICAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgYW1vdW50U2F2ZWQ6IDIwLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrVHJhbnNhY3Rpb24uZGlzY291bnQudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6ICdkaXNjb3VudC1pZCcgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBjdXJyZW50VXNlczogeyBpbmNyZW1lbnQ6IDEgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNhZ2UgUmVjb3JkcycsICgpID0+IHtcbiAgICBkZXNjcmliZSgncmVjb3JkVXNhZ2UnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGNyZWF0ZSB1c2FnZSByZWNvcmQgd2l0aCBkZWZhdWx0IGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVzYWdlRGF0YSA9IHtcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgZmVhdHVyZTogJ2FwaV9jYWxscycsXG4gICAgICAgICAgcXVhbnRpdHk6IDEwMCxcbiAgICAgICAgICB1bml0OiAncmVxdWVzdHMnLFxuICAgICAgICAgIG1ldGFkYXRhOiB7IGVuZHBvaW50OiAnL2FwaS91c2VycycgfSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBleHBlY3RlZFVzYWdlID0ge1xuICAgICAgICAgIGlkOiAndXNhZ2UtaWQnLFxuICAgICAgICAgIC4uLnVzYWdlRGF0YSxcbiAgICAgICAgICB1c2FnZURhdGU6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UudXNhZ2VSZWNvcmQuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgZXhwZWN0ZWRVc2FnZSxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnJlY29yZFVzYWdlKHVzYWdlRGF0YSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChleHBlY3RlZFVzYWdlKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UudXNhZ2VSZWNvcmQuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgLi4udXNhZ2VEYXRhLFxuICAgICAgICAgICAgdXNhZ2VEYXRlOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0VXNhZ2VSZWNvcmRzJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdXNhZ2UgcmVjb3JkcyB3aXRoIGZpbHRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tVc2FnZVJlY29yZHMgPSBbXG4gICAgICAgICAgeyBpZDogJ3VzYWdlLTEnLCBmZWF0dXJlOiAnYXBpX2NhbGxzJywgcXVhbnRpdHk6IDEwMCB9LFxuICAgICAgICAgIHsgaWQ6ICd1c2FnZS0yJywgZmVhdHVyZTogJ2FwaV9jYWxscycsIHF1YW50aXR5OiA1MCB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyk7XG4gICAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpO1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnVzYWdlUmVjb3JkLmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbW9ja1VzYWdlUmVjb3JkcyxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzYWdlUmVjb3JkcyhcbiAgICAgICAgICAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICAnYXBpX2NhbGxzJyxcbiAgICAgICAgICBzdGFydERhdGUsXG4gICAgICAgICAgZW5kRGF0ZSxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc2FnZVJlY29yZHMpO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2FnZVJlY29yZC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgICBmZWF0dXJlOiAnYXBpX2NhbGxzJyxcbiAgICAgICAgICAgIHVzYWdlRGF0ZToge1xuICAgICAgICAgICAgICBndGU6IHN0YXJ0RGF0ZSxcbiAgICAgICAgICAgICAgbHRlOiBlbmREYXRlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9yZGVyQnk6IHsgdXNhZ2VEYXRlOiAnZGVzYycgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hlbHBlciBNZXRob2RzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdnZW5lcmF0ZUludm9pY2VOdW1iZXInLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGZpcnN0IGludm9pY2UgbnVtYmVyIGZvciB5ZWFyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLmZpbmRGaXJzdCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IChzZXJ2aWNlIGFzIGFueSkuZ2VuZXJhdGVJbnZvaWNlTnVtYmVyKCk7XG5cbiAgICAgICAgY29uc3QgY3VycmVudFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoYElOVi0ke2N1cnJlbnRZZWFyfS0wMDAwMDFgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGluY3JlbWVudCBmcm9tIGxhc3QgaW52b2ljZSBudW1iZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xuICAgICAgICBjb25zdCBsYXN0SW52b2ljZSA9IHtcbiAgICAgICAgICBudW1iZXI6IGBJTlYtJHtjdXJyZW50WWVhcn0tMDAwMDA1YCxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLmZpbmRGaXJzdCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGxhc3RJbnZvaWNlLFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IChzZXJ2aWNlIGFzIGFueSkuZ2VuZXJhdGVJbnZvaWNlTnVtYmVyKCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShgSU5WLSR7Y3VycmVudFllYXJ9LTAwMDAwNmApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgaW52b2ljZSBudW1iZXIgZm9ybWF0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBsYXN0SW52b2ljZSA9IHtcbiAgICAgICAgICBudW1iZXI6ICdJTlZBTElELUZPUk1BVCcsXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UuaW52b2ljZS5maW5kRmlyc3QgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBsYXN0SW52b2ljZSxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoc2VydmljZSBhcyBhbnkpLmdlbmVyYXRlSW52b2ljZU51bWJlcigpO1xuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGBJTlYtJHtjdXJyZW50WWVhcn0tMDAwMDAxYCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXRCaWxsaW5nU3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGJpbGxpbmcgc3RhdGlzdGljcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogeyBfc3VtOiB7IGFtb3VudDogMTAwMDAgfSB9LFxuICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnM6IDI1LFxuICAgICAgICAgIHRyaWFsU3Vic2NyaXB0aW9uczogNSxcbiAgICAgICAgICBjYW5jZWxlZFN1YnNjcmlwdGlvbnM6IDEwLFxuICAgICAgICAgIHN1YnNjcmlwdGlvbnNCeVRpZXI6IFtcbiAgICAgICAgICAgIHsgdGllcjogU3Vic2NyaXB0aW9uVGllci5CQVNJQywgX2NvdW50OiB7IHRpZXI6IDEwIH0gfSxcbiAgICAgICAgICAgIHsgdGllcjogU3Vic2NyaXB0aW9uVGllci5QUkVNSVVNLCBfY291bnQ6IHsgdGllcjogMTUgfSB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudC5hZ2dyZWdhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBtb2NrU3RhdHMudG90YWxSZXZlbnVlLFxuICAgICAgICApO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY291bnQgYXMgamVzdC5Nb2NrKVxuICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1N0YXRzLmFjdGl2ZVN1YnNjcmlwdGlvbnMpXG4gICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrU3RhdHMudHJpYWxTdWJzY3JpcHRpb25zKVxuICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1N0YXRzLmNhbmNlbGVkU3Vic2NyaXB0aW9ucyk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi5ncm91cEJ5IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbW9ja1N0YXRzLnN1YnNjcmlwdGlvbnNCeVRpZXIsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRCaWxsaW5nU3RhdGlzdGljcygpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICAgIHRvdGFsUmV2ZW51ZTogMTAwMDAsXG4gICAgICAgICAgYWN0aXZlU3Vic2NyaXB0aW9uczogMjUsXG4gICAgICAgICAgdHJpYWxTdWJzY3JpcHRpb25zOiA1LFxuICAgICAgICAgIGNhbmNlbGVkU3Vic2NyaXB0aW9uczogMTAsXG4gICAgICAgICAgc3Vic2NyaXB0aW9uc0J5VGllcjogbW9ja1N0YXRzLnN1YnNjcmlwdGlvbnNCeVRpZXIsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgcmV2ZW51ZSBzdW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnQuYWdncmVnYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIF9zdW06IHsgYW1vdW50OiBudWxsIH0sXG4gICAgICAgIH0pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY291bnQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSgwKTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uLmdyb3VwQnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRCaWxsaW5nU3RhdGlzdGljcygpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQudG90YWxSZXZlbnVlKS50b0JlKDApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMgaW4gY3JlYXRlU3Vic2NyaXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKFxuICAgICAgICBwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvblBsYW4uZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2tcbiAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3BsYW4taWQnLFxuICAgICAgICBtb250aGx5UHJpY2U6IDI5Ljk5LFxuICAgICAgfSk7XG4gICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24oe1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgcGxhbklkOiAncGxhbi1pZCcsXG4gICAgICAgIH0pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIGVycm9yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMgaW4gcGF5bWVudCBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdQYXltZW50IGNyZWF0aW9uIGZhaWxlZCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmNyZWF0ZVBheW1lbnQoe1xuICAgICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgIH0pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ1BheW1lbnQgY3JlYXRpb24gZmFpbGVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0cmFuc2FjdGlvbiBlcnJvcnMgaW4gZGlzY291bnQgcmVkZW1wdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ1RyYW5zYWN0aW9uIGZhaWxlZCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnJlZGVlbURpc2NvdW50KCdkaXNjb3VudC1pZCcsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAyMCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnVHJhbnNhY3Rpb24gZmFpbGVkJyk7XG5cbiAgICAgIC8vIFZlcmlmeSBubyBwYXJ0aWFsIHN0YXRlIGNoYW5nZXNcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmRpc2NvdW50UmVkZW1wdGlvbi5jcmVhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBZHZhbmNlZCBTdWJzY3JpcHRpb24gTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBjb25zdCBtb2NrU3Vic2NyaXB0aW9uID0ge1xuICAgICAgaWQ6ICdzdWJzY3JpcHRpb24taWQnLFxuICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgIHBsYW5JZDogJ29sZC1wbGFuLWlkJyxcbiAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuQkFTSUMsXG4gICAgICBiaWxsaW5nQ3ljbGU6IEJpbGxpbmdDeWNsZS5NT05USExZLFxuICAgICAgYW1vdW50OiA5Ljk5LFxuICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuQUNUSVZFLFxuICAgICAgY3VycmVudFBlcmlvZFN0YXJ0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgY3VycmVudFBlcmlvZEVuZDogbmV3IERhdGUoJzIwMjQtMDItMDEnKSxcbiAgICAgIHBsYW46IHtcbiAgICAgICAgaWQ6ICdvbGQtcGxhbi1pZCcsXG4gICAgICAgIG1vbnRobHlQcmljZTogOS45OSxcbiAgICAgICAgeWVhcmx5UHJpY2U6IDk5Ljk5LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja05ld1BsYW4gPSB7XG4gICAgICBpZDogJ25ldy1wbGFuLWlkJyxcbiAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuUFJFTUlVTSxcbiAgICAgIG1vbnRobHlQcmljZTogMjkuOTksXG4gICAgICB5ZWFybHlQcmljZTogMjk5Ljk5LFxuICAgIH07XG5cbiAgICBkZXNjcmliZSgnY2hhbmdlU3Vic2NyaXB0aW9uUGxhbicsICgpID0+IHtcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdWJzY3JpcHRpb24gYXMgYW55KTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uUGxhbi5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja05ld1BsYW4pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgY2hhbmdlIHBsYW4gd2l0aCBpbW1lZGlhdGUgcHJvcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIGJpbGxpbmdDeWNsZTogQmlsbGluZ0N5Y2xlLk1PTlRITFksXG4gICAgICAgICAgcHJvcmF0aW9uQmVoYXZpb3I6ICdjcmVhdGVfcHJvcmF0aW9ucycsXG4gICAgICAgICAgZWZmZWN0aXZlRGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBleHBlY3RlZFVwZGF0ZSA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHBsYW5JZDogJ25ldy1wbGFuLWlkJyxcbiAgICAgICAgICB0aWVyOiBTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0sXG4gICAgICAgICAgYW1vdW50OiAyOS45OSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBtb2NrUHJvcmF0aW9uQ3JlZGl0ID0ge1xuICAgICAgICAgIGlkOiAnY3JlZGl0LWlkJyxcbiAgICAgICAgICBhbW91bnQ6IC01LjAwLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUHJvcmF0aW9uIGNyZWRpdCBmb3IgcGxhbiBjaGFuZ2UnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG1vY2tQcm9yYXRpb25DaGFyZ2UgPSB7XG4gICAgICAgICAgaWQ6ICdjaGFyZ2UtaWQnLFxuICAgICAgICAgIGFtb3VudDogMTUuMDAsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdQcm9yYXRpb24gY2hhcmdlIGZvciBwbGFuIGNoYW5nZScsXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vY2tUeG4gPSB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb246IHtcbiAgICAgICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcGRhdGUpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludm9pY2U6IHtcbiAgICAgICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICAgIGlkOiAncHJvcmF0aW9uLWludm9pY2UnLFxuICAgICAgICAgICAgICAgIGxpbmVJdGVtczogW21vY2tQcm9yYXRpb25DcmVkaXQsIG1vY2tQcm9yYXRpb25DaGFyZ2VdLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnZvaWNlTGluZUl0ZW06IHtcbiAgICAgICAgICAgICAgY3JlYXRlTWFueTogamVzdC5mbigpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHhuKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jaGFuZ2VTdWJzY3JpcHRpb25QbGFuKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICduZXctcGxhbi1pZCcsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWRVcGRhdGUpO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS4kdHJhbnNhY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGNoYW5nZSBwbGFuIHdpdGggbm8gcHJvcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgIGJpbGxpbmdDeWNsZTogQmlsbGluZ0N5Y2xlLk1PTlRITFksXG4gICAgICAgICAgcHJvcmF0aW9uQmVoYXZpb3I6ICdub25lJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBleHBlY3RlZFVwZGF0ZSA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHBsYW5JZDogJ25ldy1wbGFuLWlkJyxcbiAgICAgICAgICB0aWVyOiBTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0sXG4gICAgICAgICAgYW1vdW50OiAyOS45OSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24udXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRVcGRhdGUpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2hhbmdlU3Vic2NyaXB0aW9uUGxhbihcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAnbmV3LXBsYW4taWQnLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGV4cGVjdGVkVXBkYXRlKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBwbGFuSWQ6ICduZXctcGxhbi1pZCcsXG4gICAgICAgICAgICB0aWVyOiBTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0sXG4gICAgICAgICAgICBhbW91bnQ6IDI5Ljk5LFxuICAgICAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluY2x1ZGU6IGV4cGVjdC5hbnkoT2JqZWN0KSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjaGFuZ2UgcGxhbiB3aXRoIGVmZmVjdGl2ZSBkYXRlIGluIGZ1dHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZnV0dXJlRGF0ZSA9IG5ldyBEYXRlKCcyMDI0LTAyLTAxJyk7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuWUVBUkxZLFxuICAgICAgICAgIGVmZmVjdGl2ZURhdGU6IGZ1dHVyZURhdGUsXG4gICAgICAgICAgcHJvcmF0aW9uQmVoYXZpb3I6ICdub25lJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBleHBlY3RlZFVwZGF0ZSA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHBsYW5JZDogJ25ldy1wbGFuLWlkJyxcbiAgICAgICAgICB0aWVyOiBTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0sXG4gICAgICAgICAgYW1vdW50OiAyOTkuOTksXG4gICAgICAgICAgc2NoZWR1bGVkUGxhbkNoYW5nZToge1xuICAgICAgICAgICAgbmV3UGxhbklkOiAnbmV3LXBsYW4taWQnLFxuICAgICAgICAgICAgZWZmZWN0aXZlRGF0ZTogZnV0dXJlRGF0ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi51cGRhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFVwZGF0ZSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jaGFuZ2VTdWJzY3JpcHRpb25QbGFuKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICduZXctcGxhbi1pZCcsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc2NoZWR1bGVkUGxhbkNoYW5nZSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zY2hlZHVsZWRQbGFuQ2hhbmdlLmVmZmVjdGl2ZURhdGUpLnRvRXF1YWwoZnV0dXJlRGF0ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIGNoYW5naW5nIHRvIHNhbWUgcGxhbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UuY2hhbmdlU3Vic2NyaXB0aW9uUGxhbihcbiAgICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgJ29sZC1wbGFuLWlkJyxcbiAgICAgICAgICAgIHsgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSB9XG4gICAgICAgICAgKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gc3Vic2NyaXB0aW9uIGlzIGNhbmNlbGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkNBTkNFTEVELFxuICAgICAgICB9IGFzIGFueSk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UuY2hhbmdlU3Vic2NyaXB0aW9uUGxhbihcbiAgICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgJ25ldy1wbGFuLWlkJyxcbiAgICAgICAgICAgIHsgYmlsbGluZ0N5Y2xlOiBCaWxsaW5nQ3ljbGUuTU9OVEhMWSB9XG4gICAgICAgICAgKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3BhdXNlU3Vic2NyaXB0aW9uJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBwYXVzZSBzdWJzY3JpcHRpb24gd2l0aCBzcGVjaWZpZWQgZGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcGF1c2VVbnRpbCA9IG5ldyBEYXRlKCcyMDI0LTAzLTAxJyk7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgcGF1c2VVbnRpbCxcbiAgICAgICAgICByZWFzb246ICdGaW5hbmNpYWwgaGFyZHNoaXAnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHBhdXNlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLlBBVVNFRCxcbiAgICAgICAgICBwYXVzZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBwYXVzZVVudGlsLFxuICAgICAgICAgIHBhdXNlUmVhc29uOiAnRmluYW5jaWFsIGhhcmRzaGlwJyxcbiAgICAgICAgfTtcblxuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICd1cGRhdGVTdWJzY3JpcHRpb24nKS5tb2NrUmVzb2x2ZWRWYWx1ZShwYXVzZWRTdWJzY3JpcHRpb24gYXMgYW55KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnBhdXNlU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBvcHRpb25zKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShTdWJzY3JpcHRpb25TdGF0dXMuUEFVU0VEKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5wYXVzZVVudGlsKS50b0VxdWFsKHBhdXNlVW50aWwpO1xuICAgICAgICBleHBlY3Qoc2VydmljZS51cGRhdGVTdWJzY3JpcHRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCB7XG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuUEFVU0VELFxuICAgICAgICAgIHBhdXNlZEF0OiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICAgIHBhdXNlVW50aWwsXG4gICAgICAgICAgcGF1c2VSZWFzb246ICdGaW5hbmNpYWwgaGFyZHNoaXAnLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHBhdXNlIHN1YnNjcmlwdGlvbiBpbmRlZmluaXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgcmVhc29uOiAnVGVtcG9yYXJ5IGJyZWFrJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBwYXVzZWRTdWJzY3JpcHRpb24gPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbixcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5QQVVTRUQsXG4gICAgICAgICAgcGF1c2VkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgcGF1c2VSZWFzb246ICdUZW1wb3JhcnkgYnJlYWsnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ3VwZGF0ZVN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKHBhdXNlZFN1YnNjcmlwdGlvbiBhcyBhbnkpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGF1c2VTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQsIG9wdGlvbnMpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN1YnNjcmlwdGlvblN0YXR1cy5QQVVTRUQpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnBhdXNlVW50aWwpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3Jlc3VtZVN1YnNjcmlwdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmVzdW1lIHBhdXNlZCBzdWJzY3JpcHRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhdXNlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLlBBVVNFRCxcbiAgICAgICAgICBwYXVzZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgICBwYXVzZVVudGlsOiBuZXcgRGF0ZSgnMjAyNC0wMy0wMScpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VtZWRTdWJzY3JpcHRpb24gPSB7XG4gICAgICAgICAgLi4ucGF1c2VkU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSxcbiAgICAgICAgICBwYXVzZWRBdDogbnVsbCxcbiAgICAgICAgICBwYXVzZVVudGlsOiBudWxsLFxuICAgICAgICAgIHBhdXNlUmVhc29uOiBudWxsLFxuICAgICAgICAgIHJlc3VtZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfTtcblxuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKHBhdXNlZFN1YnNjcmlwdGlvbiBhcyBhbnkpO1xuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICd1cGRhdGVTdWJzY3JpcHRpb24nKS5tb2NrUmVzb2x2ZWRWYWx1ZShyZXN1bWVkU3Vic2NyaXB0aW9uIGFzIGFueSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5yZXN1bWVTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnJlc3VtZWRBdCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHNlcnZpY2UudXBkYXRlU3Vic2NyaXB0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSxcbiAgICAgICAgICBwYXVzZWRBdDogbnVsbCxcbiAgICAgICAgICBwYXVzZVVudGlsOiBudWxsLFxuICAgICAgICAgIHBhdXNlUmVhc29uOiBudWxsLFxuICAgICAgICAgIHJlc3VtZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIHN1YnNjcmlwdGlvbiBpcyBub3QgcGF1c2VkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdWJzY3JpcHRpb24gYXMgYW55KTtcblxuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgc2VydmljZS5yZXN1bWVTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQpXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnc2NoZWR1bGVTdWJzY3JpcHRpb25DYW5jZWxsYXRpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHNjaGVkdWxlIGNhbmNlbGxhdGlvbiBhdCBwZXJpb2QgZW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBzY2hlZHVsZURhdGEgPSB7XG4gICAgICAgICAgY2FuY2VsQXRQZXJpb2RFbmQ6IHRydWUsXG4gICAgICAgICAgcmVhc29uOiAnTm8gbG9uZ2VyIG5lZWRlZCcsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3Qgc2NoZWR1bGVkU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIC4uLm1vY2tTdWJzY3JpcHRpb24sXG4gICAgICAgICAgY2FuY2VsQXRQZXJpb2RFbmQ6IHRydWUsXG4gICAgICAgICAgY2FuY2VsZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBjYW5jZWxsYXRpb25SZWFzb246ICdObyBsb25nZXIgbmVlZGVkJyxcbiAgICAgICAgICBjYW5jZWxsYXRpb25FZmZlY3RpdmVEYXRlOiBtb2NrU3Vic2NyaXB0aW9uLmN1cnJlbnRQZXJpb2RFbmQsXG4gICAgICAgIH07XG5cbiAgICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAndXBkYXRlU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoc2NoZWR1bGVkU3Vic2NyaXB0aW9uIGFzIGFueSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5zY2hlZHVsZVN1YnNjcmlwdGlvbkNhbmNlbGxhdGlvbihcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBzY2hlZHVsZURhdGFcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmNhbmNlbEF0UGVyaW9kRW5kKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmNhbmNlbGxhdGlvbkVmZmVjdGl2ZURhdGUpLnRvRXF1YWwobW9ja1N1YnNjcmlwdGlvbi5jdXJyZW50UGVyaW9kRW5kKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHNjaGVkdWxlIGltbWVkaWF0ZSBjYW5jZWxsYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNjaGVkdWxlRGF0YSA9IHtcbiAgICAgICAgICBjYW5jZWxBdFBlcmlvZEVuZDogZmFsc2UsXG4gICAgICAgICAgcmVhc29uOiAnRGlzc2F0aXNmaWVkIHdpdGggc2VydmljZScsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgY2FuY2VsZWRTdWJzY3JpcHRpb24gPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbixcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCxcbiAgICAgICAgICBjYW5jZWxlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogJ0Rpc3NhdGlzZmllZCB3aXRoIHNlcnZpY2UnLFxuICAgICAgICAgIGNhbmNlbGxhdGlvbkVmZmVjdGl2ZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAndXBkYXRlU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoY2FuY2VsZWRTdWJzY3JpcHRpb24gYXMgYW55KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnNjaGVkdWxlU3Vic2NyaXB0aW9uQ2FuY2VsbGF0aW9uKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHNjaGVkdWxlRGF0YVxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuY2FuY2VsbGF0aW9uUmVhc29uKS50b0JlKCdEaXNzYXRpc2ZpZWQgd2l0aCBzZXJ2aWNlJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdyZWFjdGl2YXRlU3Vic2NyaXB0aW9uJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZWFjdGl2YXRlIGNhbmNlbGVkIHN1YnNjcmlwdGlvbiB3aXRoIG5ldyBwYXltZW50IG1ldGhvZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY2FuY2VsZWRTdWJzY3JpcHRpb24gPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbixcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCxcbiAgICAgICAgICBjYW5jZWxlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0xNScpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG5ld1BheW1lbnRNZXRob2QgPSB7XG4gICAgICAgICAgaWQ6ICduZXctcGF5bWVudC1tZXRob2QtaWQnLFxuICAgICAgICAgIHR5cGU6IFBheW1lbnRNZXRob2RUeXBlLkNBUkQsXG4gICAgICAgICAgaXNEZWZhdWx0OiB0cnVlLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlYWN0aXZhdGVkU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIC4uLmNhbmNlbGVkU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSxcbiAgICAgICAgICBjYW5jZWxlZEF0OiBudWxsLFxuICAgICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogbnVsbCxcbiAgICAgICAgICByZWFjdGl2YXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGRlZmF1bHRQYXltZW50TWV0aG9kSWQ6ICduZXctcGF5bWVudC1tZXRob2QtaWQnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoY2FuY2VsZWRTdWJzY3JpcHRpb24gYXMgYW55KTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudE1ldGhvZC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobmV3UGF5bWVudE1ldGhvZCk7XG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ3VwZGF0ZVN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKHJlYWN0aXZhdGVkU3Vic2NyaXB0aW9uIGFzIGFueSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5yZWFjdGl2YXRlU3Vic2NyaXB0aW9uKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICduZXctcGF5bWVudC1tZXRob2QtaWQnXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucmVhY3RpdmF0ZWRBdCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kZWZhdWx0UGF5bWVudE1ldGhvZElkKS50b0JlKCduZXctcGF5bWVudC1tZXRob2QtaWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlYWN0aXZhdGUgc3Vic2NyaXB0aW9uIHdpdGhvdXQgY2hhbmdpbmcgcGF5bWVudCBtZXRob2QnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbmNlbGVkU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIC4uLm1vY2tTdWJzY3JpcHRpb24sXG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuQ0FOQ0VMRUQsXG4gICAgICAgICAgZGVmYXVsdFBheW1lbnRNZXRob2RJZDogJ2V4aXN0aW5nLXBheW1lbnQtbWV0aG9kJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZWFjdGl2YXRlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICAuLi5jYW5jZWxlZFN1YnNjcmlwdGlvbixcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsXG4gICAgICAgICAgY2FuY2VsZWRBdDogbnVsbCxcbiAgICAgICAgICByZWFjdGl2YXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoY2FuY2VsZWRTdWJzY3JpcHRpb24gYXMgYW55KTtcbiAgICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAndXBkYXRlU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUocmVhY3RpdmF0ZWRTdWJzY3JpcHRpb24gYXMgYW55KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnJlYWN0aXZhdGVTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRlZmF1bHRQYXltZW50TWV0aG9kSWQpLnRvQmUoJ2V4aXN0aW5nLXBheW1lbnQtbWV0aG9kJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIHN1YnNjcmlwdGlvbiBpcyBub3QgY2FuY2VsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N1YnNjcmlwdGlvbiBhcyBhbnkpO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnJlYWN0aXZhdGVTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQpXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBwYXltZW50IG1ldGhvZCBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY2FuY2VsZWRTdWJzY3JpcHRpb24gPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbixcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCxcbiAgICAgICAgfTtcblxuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKGNhbmNlbGVkU3Vic2NyaXB0aW9uIGFzIGFueSk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnRNZXRob2QuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnJlYWN0aXZhdGVTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQsICdub24tZXhpc3RlbnQtcGF5bWVudC1tZXRob2QnKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdhcHBseURpc2NvdW50VG9TdWJzY3JpcHRpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGFwcGx5IGRpc2NvdW50IHRvIHN1YnNjcmlwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0Rpc2NvdW50ID0ge1xuICAgICAgICAgIGlkOiAnZGlzY291bnQtaWQnLFxuICAgICAgICAgIGNvZGU6ICdTQVZFMjAnLFxuICAgICAgICAgIHR5cGU6IERpc2NvdW50VHlwZS5QRVJDRU5UQUdFLFxuICAgICAgICAgIHBlcmNlbnRPZmY6IDIwLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHZhbGlkVW50aWw6IG5ldyBEYXRlKCcyMDI0LTEyLTMxJyksXG4gICAgICAgICAgY3VycmVudFVzZXM6IDUsXG4gICAgICAgICAgbWF4VXNlczogMTAwLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbldpdGhEaXNjb3VudCA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIGFwcGxpZWREaXNjb3VudHM6IFt7XG4gICAgICAgICAgICBpZDogJ2FwcGxpZWQtZGlzY291bnQtaWQnLFxuICAgICAgICAgICAgZGlzY291bnRJZDogJ2Rpc2NvdW50LWlkJyxcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbklkOiBtb2NrU3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgICAgYXBwbGllZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9O1xuXG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ3ZhbGlkYXRlRGlzY291bnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGlzY291bnQgYXMgYW55KTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vY2tUeG4gPSB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25EaXNjb3VudDoge1xuICAgICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShzdWJzY3JpcHRpb25XaXRoRGlzY291bnQuYXBwbGllZERpc2NvdW50c1swXSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGlzY291bnQ6IHtcbiAgICAgICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB7XG4gICAgICAgICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShzdWJzY3JpcHRpb25XaXRoRGlzY291bnQpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhtb2NrVHhuKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hcHBseURpc2NvdW50VG9TdWJzY3JpcHRpb24oXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgJ1NBVkUyMCdcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmFwcGxpZWREaXNjb3VudHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYXBwbGllZERpc2NvdW50cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBkaXNjb3VudCBpcyBhbHJlYWR5IGFwcGxpZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tEaXNjb3VudCA9IHtcbiAgICAgICAgICBpZDogJ2Rpc2NvdW50LWlkJyxcbiAgICAgICAgICBjb2RlOiAnU0FWRTIwJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb25XaXRoRGlzY291bnQgPSB7XG4gICAgICAgICAgLi4ubW9ja1N1YnNjcmlwdGlvbixcbiAgICAgICAgICBhcHBsaWVkRGlzY291bnRzOiBbe1xuICAgICAgICAgICAgZGlzY291bnRJZDogJ2Rpc2NvdW50LWlkJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfTtcblxuICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICd2YWxpZGF0ZURpc2NvdW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Rpc2NvdW50IGFzIGFueSk7XG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoc3Vic2NyaXB0aW9uV2l0aERpc2NvdW50IGFzIGFueSk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UuYXBwbHlEaXNjb3VudFRvU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAnU0FWRTIwJylcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdwcm9jZXNzU3Vic2NyaXB0aW9uUmVuZXdhbCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcHJvY2VzcyBzdWNjZXNzZnVsIHJlbmV3YWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlbmV3YWxEYXRlID0gbmV3IERhdGUoJzIwMjQtMDItMDEnKTtcbiAgICAgICAgY29uc3QgcmVuZXdlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICAuLi5tb2NrU3Vic2NyaXB0aW9uLFxuICAgICAgICAgIGN1cnJlbnRQZXJpb2RTdGFydDogcmVuZXdhbERhdGUsXG4gICAgICAgICAgY3VycmVudFBlcmlvZEVuZDogbmV3IERhdGUoJzIwMjQtMDMtMDEnKSxcbiAgICAgICAgICByZW5ld2FsQ291bnQ6IDEsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbW9ja1BheW1lbnQgPSB7XG4gICAgICAgICAgaWQ6ICdyZW5ld2FsLXBheW1lbnQtaWQnLFxuICAgICAgICAgIGFtb3VudDogbW9ja1N1YnNjcmlwdGlvbi5hbW91bnQsXG4gICAgICAgICAgc3RhdHVzOiBQYXltZW50U3RhdHVzLlNVQ0NFRURFRCxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdWJzY3JpcHRpb24pO1xuICAgICAgICAocHJpc21hU2VydmljZS4kdHJhbnNhY3Rpb24gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgY29uc3QgbW9ja1R4biA9IHtcbiAgICAgICAgICAgIHBheW1lbnQ6IHtcbiAgICAgICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BheW1lbnQpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjoge1xuICAgICAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShyZW5ld2VkU3Vic2NyaXB0aW9uKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja1R4bik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucHJvY2Vzc1N1YnNjcmlwdGlvblJlbmV3YWwobW9ja1N1YnNjcmlwdGlvbi5pZCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yZW5ld2FsQ291bnQpLnRvQmUoMSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuY3VycmVudFBlcmlvZFN0YXJ0KS50b0VxdWFsKHJlbmV3YWxEYXRlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSByZW5ld2FsIHBheW1lbnQgZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1BheW1lbnQgPSB7XG4gICAgICAgICAgaWQ6ICdmYWlsZWQtcGF5bWVudC1pZCcsXG4gICAgICAgICAgc3RhdHVzOiBQYXltZW50U3RhdHVzLkZBSUxFRCxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb25QYXN0RHVlID0ge1xuICAgICAgICAgIC4uLm1vY2tTdWJzY3JpcHRpb24sXG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuUEFTVF9EVUUsXG4gICAgICAgICAgcGFzdER1ZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3Vic2NyaXB0aW9uKTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vY2tUeG4gPSB7XG4gICAgICAgICAgICBwYXltZW50OiB7XG4gICAgICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYXltZW50KSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWJzY3JpcHRpb246IHtcbiAgICAgICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoc3Vic2NyaXB0aW9uUGFzdER1ZSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG1vY2tUeG4pO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnByb2Nlc3NTdWJzY3JpcHRpb25SZW5ld2FsKG1vY2tTdWJzY3JpcHRpb24uaWQpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN1YnNjcmlwdGlvblN0YXR1cy5QQVNUX0RVRSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIHN1YnNjcmlwdGlvbiBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UucHJvY2Vzc1N1YnNjcmlwdGlvblJlbmV3YWwoJ25vbi1leGlzdGVudC1zdWJzY3JpcHRpb24nKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXRTdWJzY3JpcHRpb25Vc2FnZUFuYWx5dGljcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHVzYWdlIGFuYWx5dGljcyBmb3Igc3Vic2NyaXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpO1xuICAgICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoJzIwMjQtMDEtMzEnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG1vY2tVc2FnZVJlY29yZHMgPSBbXG4gICAgICAgICAgeyBmZWF0dXJlOiAnYXBpX2NhbGxzJywgcXVhbnRpdHk6IDEwMDAsIHVzYWdlRGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSB9LFxuICAgICAgICAgIHsgZmVhdHVyZTogJ3N0b3JhZ2UnLCBxdWFudGl0eTogNTAsIHVzYWdlRGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMjAnKSB9LFxuICAgICAgICAgIHsgZmVhdHVyZTogJ2FwaV9jYWxscycsIHF1YW50aXR5OiA4MDAsIHVzYWdlRGF0ZTogbmV3IERhdGUoJzIwMjQtMDEtMjUnKSB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkQW5hbHl0aWNzID0ge1xuICAgICAgICAgIHN1YnNjcmlwdGlvbklkOiBtb2NrU3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgIHBlcmlvZDogeyBzdGFydDogc3RhcnREYXRlLCBlbmQ6IGVuZERhdGUgfSxcbiAgICAgICAgICB0b3RhbFVzYWdlOiB7XG4gICAgICAgICAgICBhcGlfY2FsbHM6IDE4MDAsXG4gICAgICAgICAgICBzdG9yYWdlOiA1MCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRhaWx5VXNhZ2U6IFtcbiAgICAgICAgICAgIHsgZGF0ZTogJzIwMjQtMDEtMTUnLCBhcGlfY2FsbHM6IDEwMDAgfSxcbiAgICAgICAgICAgIHsgZGF0ZTogJzIwMjQtMDEtMjAnLCBzdG9yYWdlOiA1MCB9LFxuICAgICAgICAgICAgeyBkYXRlOiAnMjAyNC0wMS0yNScsIGFwaV9jYWxsczogODAwIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICB0cmVuZHM6IHtcbiAgICAgICAgICAgIGFwaV9jYWxsczogeyBncm93dGg6IDAuMiwgdHJlbmQ6ICdpbmNyZWFzaW5nJyB9LFxuICAgICAgICAgICAgc3RvcmFnZTogeyBncm93dGg6IDAuMCwgdHJlbmQ6ICdzdGFibGUnIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS51c2FnZVJlY29yZC5maW5kTWFueSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2FnZVJlY29yZHMpO1xuICAgICAgICAocHJpc21hU2VydmljZS51c2FnZVJlY29yZC5ncm91cEJ5IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICAgIHsgZmVhdHVyZTogJ2FwaV9jYWxscycsIF9zdW06IHsgcXVhbnRpdHk6IDE4MDAgfSB9LFxuICAgICAgICAgIHsgZmVhdHVyZTogJ3N0b3JhZ2UnLCBfc3VtOiB7IHF1YW50aXR5OiA1MCB9IH0sXG4gICAgICAgIF0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0U3Vic2NyaXB0aW9uVXNhZ2VBbmFseXRpY3MoXG4gICAgICAgICAgbW9ja1N1YnNjcmlwdGlvbi5pZCxcbiAgICAgICAgICBzdGFydERhdGUsXG4gICAgICAgICAgZW5kRGF0ZVxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3Vic2NyaXB0aW9uSWQpLnRvQmUobW9ja1N1YnNjcmlwdGlvbi5pZCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudG90YWxVc2FnZSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFVzYWdlLmFwaV9jYWxscykudG9CZSgxODAwKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFVzYWdlLnN0b3JhZ2UpLnRvQmUoNTApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGFuYWx5dGljcyBmb3IgY3VycmVudCBtb250aCB3aGVuIG5vIGRhdGVzIHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IHN0YXJ0T2ZNb250aCA9IG5ldyBEYXRlKGN1cnJlbnREYXRlLmdldEZ1bGxZZWFyKCksIGN1cnJlbnREYXRlLmdldE1vbnRoKCksIDEpO1xuICAgICAgICBjb25zdCBlbmRPZk1vbnRoID0gbmV3IERhdGUoY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKSwgY3VycmVudERhdGUuZ2V0TW9udGgoKSArIDEsIDApO1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnVzYWdlUmVjb3JkLmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICAgICAgICAocHJpc21hU2VydmljZS51c2FnZVJlY29yZC5ncm91cEJ5IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0U3Vic2NyaXB0aW9uVXNhZ2VBbmFseXRpY3MobW9ja1N1YnNjcmlwdGlvbi5pZCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5wZXJpb2Quc3RhcnQuZ2V0TW9udGgoKSkudG9CZShzdGFydE9mTW9udGguZ2V0TW9udGgoKSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucGVyaW9kLmVuZC5nZXRNb250aCgpKS50b0JlKGVuZE9mTW9udGguZ2V0TW9udGgoKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FkdmFuY2VkIEJpbGxpbmcgRmVhdHVyZXMnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ1Byb3JhdGlvbiBDYWxjdWxhdGlvbnMnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBwcm9yYXRlZCBhbW91bnQgZm9yIG1pZC1jeWNsZSB1cGdyYWRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCcyMDI0LTAxLTE1Jyk7XG4gICAgICAgIGNvbnN0IHBlcmlvZFN0YXJ0ID0gbmV3IERhdGUoJzIwMjQtMDEtMDEnKTtcbiAgICAgICAgY29uc3QgcGVyaW9kRW5kID0gbmV3IERhdGUoJzIwMjQtMDItMDEnKTtcbiAgICAgICAgY29uc3Qgb2xkQW1vdW50ID0gMTAuMDA7XG4gICAgICAgIGNvbnN0IG5ld0Ftb3VudCA9IDMwLjAwO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gKHNlcnZpY2UgYXMgYW55KS5jYWxjdWxhdGVQcm9yYXRpb24oXG4gICAgICAgICAgb2xkQW1vdW50LFxuICAgICAgICAgIG5ld0Ftb3VudCxcbiAgICAgICAgICBwZXJpb2RTdGFydCxcbiAgICAgICAgICBwZXJpb2RFbmQsXG4gICAgICAgICAgY3VycmVudERhdGVcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmNyZWRpdCkudG9CZUxlc3NUaGFuKDApO1xuICAgICAgICBleHBlY3QocmVzdWx0LmNoYXJnZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgICBleHBlY3QocmVzdWx0Lm5ldEFtb3VudCkudG9CZShyZXN1bHQuY3JlZGl0ICsgcmVzdWx0LmNoYXJnZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgcHJvcmF0ZWQgYW1vdW50IGZvciBkb3duZ3JhZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoJzIwMjQtMDEtMTAnKTtcbiAgICAgICAgY29uc3QgcGVyaW9kU3RhcnQgPSBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpO1xuICAgICAgICBjb25zdCBwZXJpb2RFbmQgPSBuZXcgRGF0ZSgnMjAyNC0wMi0wMScpO1xuICAgICAgICBjb25zdCBvbGRBbW91bnQgPSAzMC4wMDtcbiAgICAgICAgY29uc3QgbmV3QW1vdW50ID0gMTAuMDA7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXN1bHQgPSAoc2VydmljZSBhcyBhbnkpLmNhbGN1bGF0ZVByb3JhdGlvbihcbiAgICAgICAgICBvbGRBbW91bnQsXG4gICAgICAgICAgbmV3QW1vdW50LFxuICAgICAgICAgIHBlcmlvZFN0YXJ0LFxuICAgICAgICAgIHBlcmlvZEVuZCxcbiAgICAgICAgICBjdXJyZW50RGF0ZVxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuY3JlZGl0KS50b0JlTGVzc1RoYW4oMCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuY2hhcmdlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQubmV0QW1vdW50KS50b0JlTGVzc1RoYW4oMCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW5kLW9mLXBlcmlvZCBjaGFuZ2VzIHdpdGggbm8gcHJvcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCcyMDI0LTAyLTAxJyk7XG4gICAgICAgIGNvbnN0IHBlcmlvZFN0YXJ0ID0gbmV3IERhdGUoJzIwMjQtMDEtMDEnKTtcbiAgICAgICAgY29uc3QgcGVyaW9kRW5kID0gbmV3IERhdGUoJzIwMjQtMDItMDEnKTtcbiAgICAgICAgY29uc3Qgb2xkQW1vdW50ID0gMTAuMDA7XG4gICAgICAgIGNvbnN0IG5ld0Ftb3VudCA9IDMwLjAwO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gKHNlcnZpY2UgYXMgYW55KS5jYWxjdWxhdGVQcm9yYXRpb24oXG4gICAgICAgICAgb2xkQW1vdW50LFxuICAgICAgICAgIG5ld0Ftb3VudCxcbiAgICAgICAgICBwZXJpb2RTdGFydCxcbiAgICAgICAgICBwZXJpb2RFbmQsXG4gICAgICAgICAgY3VycmVudERhdGVcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmNyZWRpdCkudG9CZSgwKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGFyZ2UpLnRvQmUoMCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQubmV0QW1vdW50KS50b0JlKDApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnVXNhZ2UtQmFzZWQgQmlsbGluZycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHVzYWdlIGNoYXJnZXMgZm9yIG1ldGVyZWQgZmVhdHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tVc2FnZVJlY29yZHMgPSBbXG4gICAgICAgICAgeyBmZWF0dXJlOiAnYXBpX2NhbGxzJywgcXVhbnRpdHk6IDEwMDAsIHVuaXRQcmljZTogMC4wMSB9LFxuICAgICAgICAgIHsgZmVhdHVyZTogJ3N0b3JhZ2VfZ2InLCBxdWFudGl0eTogMjUsIHVuaXRQcmljZTogMC4xMCB9LFxuICAgICAgICAgIHsgZmVhdHVyZTogJ2JhbmR3aWR0aF9nYicsIHF1YW50aXR5OiAxMDAsIHVuaXRQcmljZTogMC4wNSB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyk7XG4gICAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpO1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnVzYWdlUmVjb3JkLmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzYWdlUmVjb3Jkcyk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jYWxjdWxhdGVVc2FnZUNoYXJnZXMoXG4gICAgICAgICAgJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICAgIGVuZERhdGVcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnRvdGFsQ2hhcmdlcykudG9CZSgxNy41MCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYnJlYWtkb3duKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYnJlYWtkb3duWzBdKS50b0VxdWFsKHtcbiAgICAgICAgICBmZWF0dXJlOiAnYXBpX2NhbGxzJyxcbiAgICAgICAgICBxdWFudGl0eTogMTAwMCxcbiAgICAgICAgICB1bml0UHJpY2U6IDAuMDEsXG4gICAgICAgICAgdG90YWxDaGFyZ2U6IDEwLjAwLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGFwcGx5IHVzYWdlIHRpZXJzIGFuZCBkaXNjb3VudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tVc2FnZVJlY29yZHMgPSBbXG4gICAgICAgICAgeyBmZWF0dXJlOiAnYXBpX2NhbGxzJywgcXVhbnRpdHk6IDEwMDAwLCB1bml0UHJpY2U6IDAuMDEgfSxcbiAgICAgICAgXTtcblxuICAgICAgICBjb25zdCBtb2NrUHJpY2luZ1RpZXJzID0gW1xuICAgICAgICAgIHsgbWluOiAwLCBtYXg6IDEwMDAsIHByaWNlOiAwLjAxIH0sXG4gICAgICAgICAgeyBtaW46IDEwMDEsIG1heDogNTAwMCwgcHJpY2U6IDAuMDA4IH0sXG4gICAgICAgICAgeyBtaW46IDUwMDEsIG1heDogSW5maW5pdHksIHByaWNlOiAwLjAwNSB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnVzYWdlUmVjb3JkLmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzYWdlUmVjb3Jkcyk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnByaWNpbmdUaWVyLmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1ByaWNpbmdUaWVycyk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jYWxjdWxhdGVUaWVyZWRVc2FnZUNoYXJnZXMoXG4gICAgICAgICAgJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgJ2FwaV9jYWxscycsXG4gICAgICAgICAgbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgICAgICBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbENoYXJnZSkudG9CZSg2Nyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudGllcnMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1JldmVudWUgUmVjb2duaXRpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJlY29nbml6ZSByZXZlbnVlIGZvciBtb250aGx5IHN1YnNjcmlwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICBhbW91bnQ6IDI5Ljk5LFxuICAgICAgICAgIGJpbGxpbmdDeWNsZTogQmlsbGluZ0N5Y2xlLk1PTlRITFksXG4gICAgICAgICAgY3VycmVudFBlcmlvZFN0YXJ0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgICAgIGN1cnJlbnRQZXJpb2RFbmQ6IG5ldyBEYXRlKCcyMDI0LTAyLTAxJyksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jYWxjdWxhdGVSZXZlbnVlUmVjb2duaXRpb24oc3Vic2NyaXB0aW9uIGFzIGFueSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFJldmVudWUpLnRvQmUoMjkuOTkpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhaWx5UmV2ZW51ZSkudG9CZUNsb3NlVG8oMC45NywgMik7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucmVjb2duaXRpb25TY2hlZHVsZSkudG9IYXZlTGVuZ3RoKDMxKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBkZWZlcnJlZCByZXZlbnVlIGZvciBhbm51YWwgc3Vic2NyaXB0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICBhbW91bnQ6IDI5OS45OSxcbiAgICAgICAgICBiaWxsaW5nQ3ljbGU6IEJpbGxpbmdDeWNsZS5ZRUFSTFksXG4gICAgICAgICAgY3VycmVudFBlcmlvZFN0YXJ0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgICAgIGN1cnJlbnRQZXJpb2RFbmQ6IG5ldyBEYXRlKCcyMDI1LTAxLTAxJyksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jYWxjdWxhdGVSZXZlbnVlUmVjb2duaXRpb24oc3Vic2NyaXB0aW9uIGFzIGFueSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFJldmVudWUpLnRvQmUoMjk5Ljk5KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5tb250aGx5UmV2ZW51ZSkudG9CZUNsb3NlVG8oMjUuMDAsIDIpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnJlY29nbml0aW9uU2NoZWR1bGUpLnRvSGF2ZUxlbmd0aCgxMik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdUYXggQ2FsY3VsYXRpb25zJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgdGF4IGZvciBVUyBjdXN0b21lcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGJpbGxpbmdBZGRyZXNzID0ge1xuICAgICAgICAgIGNvdW50cnk6ICdVUycsXG4gICAgICAgICAgc3RhdGU6ICdDQScsXG4gICAgICAgICAgY2l0eTogJ1NhbiBGcmFuY2lzY28nLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICc5NDEwNScsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW1vdW50ID0gMTAwLjAwO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FsY3VsYXRlVGF4KGFtb3VudCwgYmlsbGluZ0FkZHJlc3MpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQudGF4QW1vdW50KS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudGF4UmF0ZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgICBleHBlY3QocmVzdWx0LnRheEp1cmlzZGljdGlvbikudG9CZSgnQ0EnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbEFtb3VudCkudG9CZShhbW91bnQgKyByZXN1bHQudGF4QW1vdW50KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBWQVQgZm9yIEVVIGN1c3RvbWVycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYmlsbGluZ0FkZHJlc3MgPSB7XG4gICAgICAgICAgY291bnRyeTogJ0RFJyxcbiAgICAgICAgICB2YXROdW1iZXI6ICdERTEyMzQ1Njc4OScsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW1vdW50ID0gMTAwLjAwO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FsY3VsYXRlVGF4KGFtb3VudCwgYmlsbGluZ0FkZHJlc3MpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQudGF4VHlwZSkudG9CZSgnVkFUJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQudmF0TnVtYmVyKS50b0JlKCdERTEyMzQ1Njc4OScpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgc2tpcCB0YXggZm9yIHRheC1leGVtcHQgY3VzdG9tZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBiaWxsaW5nQWRkcmVzcyA9IHtcbiAgICAgICAgICBjb3VudHJ5OiAnVVMnLFxuICAgICAgICAgIHN0YXRlOiAnQ0EnLFxuICAgICAgICAgIHRheEV4ZW1wdDogdHJ1ZSxcbiAgICAgICAgICBleGVtcHRpb25DZXJ0aWZpY2F0ZTogJ0VYRU1QVC0xMjMnLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGFtb3VudCA9IDEwMC4wMDtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNhbGN1bGF0ZVRheChhbW91bnQsIGJpbGxpbmdBZGRyZXNzKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnRheEFtb3VudCkudG9CZSgwKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5leGVtcHRpb25SZWFzb24pLnRvQmUoJ1RheCBleGVtcHQgY3VzdG9tZXInKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0R1bm5pbmcgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcHJvY2VzcyBmYWlsZWQgcGF5bWVudCB3aXRoIHJldHJ5IGxvZ2ljJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBmYWlsZWRQYXltZW50ID0ge1xuICAgICAgICAgIGlkOiAncGF5bWVudC1pZCcsXG4gICAgICAgICAgc3Vic2NyaXB0aW9uSWQ6ICdzdWJzY3JpcHRpb24taWQnLFxuICAgICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgICAgc3RhdHVzOiBQYXltZW50U3RhdHVzLkZBSUxFRCxcbiAgICAgICAgICBhdHRlbXB0Q291bnQ6IDEsXG4gICAgICAgICAgZmFpbHVyZUNvZGU6ICdjYXJkX2RlY2xpbmVkJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBtb2NrU3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsXG4gICAgICAgICAgZGVmYXVsdFBheW1lbnRNZXRob2RJZDogJ3BheW1lbnQtbWV0aG9kLWlkJyxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWlsZWRQYXltZW50KTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnByb2Nlc3NEdW5uaW5nKCdwYXltZW50LWlkJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yZXRyeVNjaGVkdWxlZCkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5uZXh0UmV0cnlEYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmR1bm5pbmdMZXZlbCkudG9CZSgxKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGVzY2FsYXRlIGR1bm5pbmcgYWZ0ZXIgbXVsdGlwbGUgZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZhaWxlZFBheW1lbnQgPSB7XG4gICAgICAgICAgaWQ6ICdwYXltZW50LWlkJyxcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgc3RhdHVzOiBQYXltZW50U3RhdHVzLkZBSUxFRCxcbiAgICAgICAgICBhdHRlbXB0Q291bnQ6IDMsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbW9ja1N1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICBpZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuUEFTVF9EVUUsXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoZmFpbGVkUGF5bWVudCk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N1YnNjcmlwdGlvbik7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wcm9jZXNzRHVubmluZygncGF5bWVudC1pZCcpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXNjYWxhdGVkKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmR1bm5pbmdMZXZlbCkudG9CZSgzKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5hY3Rpb25SZXF1aXJlZCkudG9CZSgndXBkYXRlX3BheW1lbnRfbWV0aG9kJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjYW5jZWwgc3Vic2NyaXB0aW9uIGFmdGVyIG1heGltdW0gcmV0cmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZmFpbGVkUGF5bWVudCA9IHtcbiAgICAgICAgICBpZDogJ3BheW1lbnQtaWQnLFxuICAgICAgICAgIHN1YnNjcmlwdGlvbklkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICBzdGF0dXM6IFBheW1lbnRTdGF0dXMuRkFJTEVELFxuICAgICAgICAgIGF0dGVtcHRDb3VudDogNSxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWlsZWRQYXltZW50KTtcbiAgICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnY2FuY2VsU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoeyBzdGF0dXM6IFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCB9IGFzIGFueSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wcm9jZXNzRHVubmluZygncGF5bWVudC1pZCcpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3Vic2NyaXB0aW9uQ2FuY2VsZWQpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLmNhbmNlbFN1YnNjcmlwdGlvbikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnU3Vic2NyaXB0aW9uIEFuYWx5dGljcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGN1c3RvbWVyIGxpZmV0aW1lIHZhbHVlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUGF5bWVudHMgPSBbXG4gICAgICAgICAgeyBhbW91bnQ6IDI5Ljk5LCBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJykgfSxcbiAgICAgICAgICB7IGFtb3VudDogMjkuOTksIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDItMDEnKSB9LFxuICAgICAgICAgIHsgYW1vdW50OiAyOS45OSwgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMy0wMScpIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgbW9ja1N1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxJyksXG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuQUNUSVZFLFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bWVudHMpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FsY3VsYXRlQ3VzdG9tZXJMaWZldGltZVZhbHVlKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIG1vY2tTdWJzY3JpcHRpb24gYXMgYW55XG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFJldmVudWUpLnRvQmUoODkuOTcpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmF2ZXJhZ2VNb250aGx5UmV2ZW51ZSkudG9CZUNsb3NlVG8oMjkuOTksIDIpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1YnNjcmlwdGlvbk1vbnRocykudG9CZSgzKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5wcm9qZWN0ZWRMVFYpLnRvQmVHcmVhdGVyVGhhbig4OS45Nyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY2h1cm4gcHJlZGljdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1VzYWdlRGF0YSA9IHtcbiAgICAgICAgICBsYXN0TG9naW5EYXRlOiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgICAgIGF2ZXJhZ2VTZXNzaW9uRHVyYXRpb246IDMwMCxcbiAgICAgICAgICBmZWF0dXJlVXNhZ2U6IHtcbiAgICAgICAgICAgIGFwaV9jYWxsczogMTAwLFxuICAgICAgICAgICAgc3RvcmFnZTogMSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN1cHBvcnRUaWNrZXRzOiAyLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG1vY2tQYXltZW50SGlzdG9yeSA9IFtcbiAgICAgICAgICB7IHN0YXR1czogUGF5bWVudFN0YXR1cy5GQUlMRUQsIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSB9LFxuICAgICAgICAgIHsgc3RhdHVzOiBQYXltZW50U3RhdHVzLlNVQ0NFRURFRCwgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UudXNhZ2VSZWNvcmQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNhZ2VEYXRhLmZlYXR1cmVVc2FnZSk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bWVudEhpc3RvcnkpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FsY3VsYXRlQ2h1cm5QcmVkaWN0aW9uKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIG1vY2tVc2FnZURhdGFcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmNodXJuUmlzaykudG9CZUdyZWF0ZXJUaGFuKDAuNSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucmlza0ZhY3RvcnMpLnRvQ29udGFpbignbG93X3VzYWdlJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQucmlza0ZhY3RvcnMpLnRvQ29udGFpbigncGF5bWVudF9mYWlsdXJlcycpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnJlY29tbWVuZGVkQWN0aW9ucykudG9Db250YWluKCdlbmdhZ2VtZW50X2NhbXBhaWduJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdDb21wbGV0ZSBTdWJzY3JpcHRpb24gTGlmZWN5Y2xlJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgc3Vic2NyaXB0aW9uIGZsb3cgZnJvbSBjcmVhdGlvbiB0byBjYW5jZWxsYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tQbGFuID0ge1xuICAgICAgICAgIGlkOiAncGxhbi1pZCcsXG4gICAgICAgICAgdGllcjogU3Vic2NyaXB0aW9uVGllci5QUkVNSVVNLFxuICAgICAgICAgIG1vbnRobHlQcmljZTogMjkuOTksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbW9ja1BheW1lbnRNZXRob2QgPSB7XG4gICAgICAgICAgaWQ6ICdwYXltZW50LW1ldGhvZC1pZCcsXG4gICAgICAgICAgdHlwZTogUGF5bWVudE1ldGhvZFR5cGUuQ0FSRCxcbiAgICAgICAgICBpc0RlZmF1bHQ6IHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2Uuc3Vic2NyaXB0aW9uUGxhbi5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BsYW4pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgc2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24oe1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgcGxhbklkOiAncGxhbi1pZCcsXG4gICAgICAgICAgcGF5bWVudE1ldGhvZElkOiAncGF5bWVudC1tZXRob2QtaWQnLFxuICAgICAgICB9KTtcblxuICAgICAgICBleHBlY3Qoc3Vic2NyaXB0aW9uLnN0YXR1cykudG9CZShTdWJzY3JpcHRpb25TdGF0dXMuQUNUSVZFKTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5wYXltZW50LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBpZDogJ3BheW1lbnQtaWQnLFxuICAgICAgICAgIHN0YXR1czogUGF5bWVudFN0YXR1cy5TVUNDRUVERUQsXG4gICAgICAgICAgYW1vdW50OiAyOS45OSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcGF5bWVudCA9IGF3YWl0IHNlcnZpY2UuY3JlYXRlUGF5bWVudCh7XG4gICAgICAgICAgYW1vdW50OiAyOS45OSxcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogc3Vic2NyaXB0aW9uLmlkLFxuICAgICAgICAgIHBheW1lbnRNZXRob2RJZDogJ3BheW1lbnQtbWV0aG9kLWlkJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXhwZWN0KHBheW1lbnQuc3RhdHVzKS50b0JlKFBheW1lbnRTdGF0dXMuU1VDQ0VFREVEKTtcblxuICAgICAgICAocHJpc21hU2VydmljZS51c2FnZVJlY29yZC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgaWQ6ICd1c2FnZS1pZCcsXG4gICAgICAgICAgZmVhdHVyZTogJ2FwaV9jYWxscycsXG4gICAgICAgICAgcXVhbnRpdHk6IDEwMDAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHVzYWdlID0gYXdhaXQgc2VydmljZS5yZWNvcmRVc2FnZSh7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uSWQ6IHN1YnNjcmlwdGlvbi5pZCxcbiAgICAgICAgICBmZWF0dXJlOiAnYXBpX2NhbGxzJyxcbiAgICAgICAgICBxdWFudGl0eTogMTAwMCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXhwZWN0KHVzYWdlLnF1YW50aXR5KS50b0JlKDEwMDApO1xuXG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ3VwZGF0ZVN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAuLi5zdWJzY3JpcHRpb24sXG4gICAgICAgICAgc3RhdHVzOiBTdWJzY3JpcHRpb25TdGF0dXMuQ0FOQ0VMRUQsXG4gICAgICAgIH0gYXMgYW55KTtcblxuICAgICAgICBjb25zdCBjYW5jZWxlZFN1YnNjcmlwdGlvbiA9IGF3YWl0IHNlcnZpY2UuY2FuY2VsU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICBleHBlY3QoY2FuY2VsZWRTdWJzY3JpcHRpb24uc3RhdHVzKS50b0JlKFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3Vic2NyaXB0aW9uIHVwZ3JhZGUgd2l0aCBwcm9yYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGJhc2ljUGxhbiA9IHtcbiAgICAgICAgICBpZDogJ2Jhc2ljLXBsYW4nLFxuICAgICAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuQkFTSUMsXG4gICAgICAgICAgbW9udGhseVByaWNlOiA5Ljk5LFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHByZW1pdW1QbGFuID0ge1xuICAgICAgICAgIGlkOiAncHJlbWl1bS1wbGFuJyxcbiAgICAgICAgICB0aWVyOiBTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0sXG4gICAgICAgICAgbW9udGhseVByaWNlOiAyOS45OSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjdXJyZW50U3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHBsYW5JZDogJ2Jhc2ljLXBsYW4nLFxuICAgICAgICAgIHRpZXI6IFN1YnNjcmlwdGlvblRpZXIuQkFTSUMsXG4gICAgICAgICAgYW1vdW50OiA5Ljk5LFxuICAgICAgICAgIGN1cnJlbnRQZXJpb2RTdGFydDogbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgICAgICBjdXJyZW50UGVyaW9kRW5kOiBuZXcgRGF0ZSgnMjAyNC0wMi0wMScpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2ZpbmRVc2VyU3Vic2NyaXB0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoY3VycmVudFN1YnNjcmlwdGlvbiBhcyBhbnkpO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb25QbGFuLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShwcmVtaXVtUGxhbik7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1cGdyYWRlZFN1YnNjcmlwdGlvbiA9IHtcbiAgICAgICAgICAuLi5jdXJyZW50U3Vic2NyaXB0aW9uLFxuICAgICAgICAgIHBsYW5JZDogJ3ByZW1pdW0tcGxhbicsXG4gICAgICAgICAgdGllcjogU3Vic2NyaXB0aW9uVGllci5QUkVNSVVNLFxuICAgICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgIGNvbnN0IG1vY2tUeG4gPSB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb246IHtcbiAgICAgICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodXBncmFkZWRTdWJzY3JpcHRpb24pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludm9pY2U6IHtcbiAgICAgICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICAgIGlkOiAncHJvcmF0aW9uLWludm9pY2UnLFxuICAgICAgICAgICAgICAgIHRvdGFsOiAxNS4wMCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW52b2ljZUxpbmVJdGVtOiB7XG4gICAgICAgICAgICAgIGNyZWF0ZU1hbnk6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja1R4bik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2hhbmdlU3Vic2NyaXB0aW9uUGxhbihcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAncHJlbWl1bS1wbGFuJyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBiaWxsaW5nQ3ljbGU6IEJpbGxpbmdDeWNsZS5NT05USExZLFxuICAgICAgICAgICAgcHJvcmF0aW9uQmVoYXZpb3I6ICdjcmVhdGVfcHJvcmF0aW9ucycsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQudGllcikudG9CZShTdWJzY3JpcHRpb25UaWVyLlBSRU1JVU0pO1xuICAgICAgICBleHBlY3QocmVzdWx0LmFtb3VudCkudG9CZSgyOS45OSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdFcnJvciBSZWNvdmVyeSBhbmQgUmVzaWxpZW5jZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHBheW1lbnQgZ2F0ZXdheSB0aW1lb3V0cyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwYXltZW50RGF0YSA9IHtcbiAgICAgICAgICBhbW91bnQ6IDI5Ljk5LFxuICAgICAgICAgIHBheW1lbnRNZXRob2RJZDogJ3BheW1lbnQtbWV0aG9kLWlkJyxcbiAgICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgdGltZW91dEVycm9yID0gbmV3IEVycm9yKCdQYXltZW50IGdhdGV3YXkgdGltZW91dCcpO1xuICAgICAgICB0aW1lb3V0RXJyb3IubmFtZSA9ICdUaW1lb3V0RXJyb3InO1xuICAgICAgICBcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZSh0aW1lb3V0RXJyb3IpO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZVBheW1lbnQocGF5bWVudERhdGEpXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KCdQYXltZW50IGdhdGV3YXkgdGltZW91dCcpO1xuXG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi51cGRhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBzdWJzY3JpcHRpb24gbW9kaWZpY2F0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHZlcnNpb246IDEsXG4gICAgICAgIH07XG5cbiAgICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnZmluZFVzZXJTdWJzY3JpcHRpb24nKS5tb2NrUmVzb2x2ZWRWYWx1ZShzdWJzY3JpcHRpb24gYXMgYW55KTtcblxuICAgICAgICBjb25zdCBjb25mbGljdEVycm9yID0gbmV3IEVycm9yKCdTdWJzY3JpcHRpb24gd2FzIG1vZGlmaWVkIGJ5IGFub3RoZXIgcHJvY2VzcycpO1xuICAgICAgICBjb25mbGljdEVycm9yLm5hbWUgPSAnQ29uZmxpY3RFcnJvcic7XG4gICAgICAgIFxuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24udXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoY29uZmxpY3RFcnJvcik7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIHNlcnZpY2UudXBkYXRlU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCB7XG4gICAgICAgICAgICBwbGFuSWQ6ICduZXctcGxhbi1pZCcsXG4gICAgICAgICAgfSlcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ1N1YnNjcmlwdGlvbiB3YXMgbW9kaWZpZWQgYnkgYW5vdGhlciBwcm9jZXNzJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgdHJhbnNhY3Rpb24gcm9sbGJhY2tzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBkaXNjb3VudERhdGEgPSB7XG4gICAgICAgICAgY29kZTogJ1NBVkUyMCcsXG4gICAgICAgICAgdHlwZTogRGlzY291bnRUeXBlLlBFUkNFTlRBR0UsXG4gICAgICAgICAgcGVyY2VudE9mZjogMjAsXG4gICAgICAgIH07XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UuJHRyYW5zYWN0aW9uIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgICAgbmV3IEVycm9yKCdEYXRhYmFzZSB0cmFuc2FjdGlvbiBmYWlsZWQnKVxuICAgICAgICApO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBzZXJ2aWNlLnJlZGVlbURpc2NvdW50KCdkaXNjb3VudC1pZCcsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAyMClcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIHRyYW5zYWN0aW9uIGZhaWxlZCcpO1xuXG4gICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmRpc2NvdW50UmVkZW1wdGlvbi5jcmVhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdQZXJmb3JtYW5jZSBhbmQgU2NhbGFiaWxpdHknLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBoaWdoLXZvbHVtZSBiaWxsaW5nIG9wZXJhdGlvbnMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbkNvdW50ID0gMTAwMDtcbiAgICAgICAgY29uc3QgYmF0Y2hPcGVyYXRpb25zID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogb3BlcmF0aW9uQ291bnQgfSwgKF8sIGkpID0+IHtcbiAgICAgICAgICBpZiAoaSAlIDMgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnJlY29yZFVzYWdlKHtcbiAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uSWQ6IGBzdWJzY3JpcHRpb24tJHtpfWAsXG4gICAgICAgICAgICAgIGZlYXR1cmU6ICdhcGlfY2FsbHMnLFxuICAgICAgICAgICAgICBxdWFudGl0eTogMTAwLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChpICUgMyA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuY3JlYXRlUGF5bWVudCh7XG4gICAgICAgICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgICAgICAgIHN1YnNjcmlwdGlvbklkOiBgc3Vic2NyaXB0aW9uLSR7aX1gLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLmdldEJpbGxpbmdTdGF0aXN0aWNzKFxuICAgICAgICAgICAgICBuZXcgRGF0ZSgnMjAyNC0wMS0wMScpLFxuICAgICAgICAgICAgICBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UudXNhZ2VSZWNvcmQuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3VzYWdlLWlkJyB9KTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucGF5bWVudC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAncGF5bWVudC1pZCcgfSk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnBheW1lbnQuYWdncmVnYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoeyBfc3VtOiB7IGFtb3VudDogMTAwMCB9IH0pO1xuICAgICAgICAocHJpc21hU2VydmljZS5zdWJzY3JpcHRpb24uY291bnQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSgxMCk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnN1YnNjcmlwdGlvbi5ncm91cEJ5IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChiYXRjaE9wZXJhdGlvbnMpO1xuICAgICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKG9wZXJhdGlvbkNvdW50KTtcbiAgICAgICAgZXhwZWN0KGVuZFRpbWUgLSBzdGFydFRpbWUpLnRvQmVMZXNzVGhhbig1MDAwKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG9wdGltaXplIG1lbW9yeSB1c2FnZSBmb3IgbGFyZ2UgcmVzdWx0IHNldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxhcmdlVXNhZ2VEYXRhc2V0ID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNTAwMDAgfSwgKF8sIGkpID0+ICh7XG4gICAgICAgICAgaWQ6IGB1c2FnZS0ke2l9YCxcbiAgICAgICAgICBmZWF0dXJlOiAnYXBpX2NhbGxzJyxcbiAgICAgICAgICBxdWFudGl0eTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCksXG4gICAgICAgICAgdXNhZ2VEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgKHByaXNtYVNlcnZpY2UudXNhZ2VSZWNvcmQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShsYXJnZVVzYWdlRGF0YXNldCk7XG5cbiAgICAgICAgY29uc3QgaW5pdGlhbE1lbW9yeSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2FnZVJlY29yZHMoXG4gICAgICAgICAgJ3N1YnNjcmlwdGlvbi1pZCcsXG4gICAgICAgICAgJ2FwaV9jYWxscycsXG4gICAgICAgICAgbmV3IERhdGUoJzIwMjQtMDEtMDEnKSxcbiAgICAgICAgICBuZXcgRGF0ZSgnMjAyNC0wMS0zMScpXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGZpbmFsTWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpLmhlYXBVc2VkO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCg1MDAwMCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBtZW1vcnlJbmNyZWFzZSA9IGZpbmFsTWVtb3J5IC0gaW5pdGlhbE1lbW9yeTtcbiAgICAgICAgZXhwZWN0KG1lbW9yeUluY3JlYXNlKS50b0JlTGVzc1RoYW4oMjAwICogMTAyNCAqIDEwMjQpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnRGF0YSBDb25zaXN0ZW5jeSBhbmQgSW50ZWdyaXR5JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBtYWludGFpbiBpbnZvaWNlIG51bWJlciBzZXF1ZW5jZSBpbnRlZ3JpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbmN1cnJlbnRJbnZvaWNlQ3JlYXRpb25zID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+IHtcbiAgICAgICAgICAocHJpc21hU2VydmljZS5pbnZvaWNlLmZpbmRGaXJzdCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgICAgICBudW1iZXI6IGBJTlYtMjAyNC0wMDAwMCR7aX1gLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIChwcmlzbWFTZXJ2aWNlLmludm9pY2UuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgICAgIGlkOiBgaW52b2ljZS0ke2l9YCxcbiAgICAgICAgICAgIG51bWJlcjogYElOVi0yMDI0LTAwMDAwJHtpICsgMX1gLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHNlcnZpY2UuY3JlYXRlSW52b2ljZSh7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25JZDogYHN1YnNjcmlwdGlvbi0ke2l9YCxcbiAgICAgICAgICAgIHN1YnRvdGFsOiAxMDAsXG4gICAgICAgICAgICBkdWVEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoY29uY3VycmVudEludm9pY2VDcmVhdGlvbnMpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW52b2ljZU51bWJlcnMgPSByZXN1bHRzLm1hcChpbnZvaWNlID0+IGludm9pY2UubnVtYmVyKTtcbiAgICAgICAgY29uc3QgdW5pcXVlTnVtYmVycyA9IG5ldyBTZXQoaW52b2ljZU51bWJlcnMpO1xuICAgICAgICBleHBlY3QodW5pcXVlTnVtYmVycy5zaXplKS50b0JlKGludm9pY2VOdW1iZXJzLmxlbmd0aCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBlbnN1cmUgc3Vic2NyaXB0aW9uIHN0YXRlIGNvbnNpc3RlbmN5IGR1cmluZyB0cmFuc2l0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0ge1xuICAgICAgICAgIGlkOiAnc3Vic2NyaXB0aW9uLWlkJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHN0YXR1czogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCB0cmFuc2l0aW9ucyA9IFtcbiAgICAgICAgICB7IGZyb206IFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsIHRvOiBTdWJzY3JpcHRpb25TdGF0dXMuUEFVU0VELCB2YWxpZDogdHJ1ZSB9LFxuICAgICAgICAgIHsgZnJvbTogU3Vic2NyaXB0aW9uU3RhdHVzLlBBVVNFRCwgdG86IFN1YnNjcmlwdGlvblN0YXR1cy5BQ1RJVkUsIHZhbGlkOiB0cnVlIH0sXG4gICAgICAgICAgeyBmcm9tOiBTdWJzY3JpcHRpb25TdGF0dXMuQ0FOQ0VMRUQsIHRvOiBTdWJzY3JpcHRpb25TdGF0dXMuQUNUSVZFLCB2YWxpZDogdHJ1ZSB9LFxuICAgICAgICAgIHsgZnJvbTogU3Vic2NyaXB0aW9uU3RhdHVzLlRSSUFMSU5HLCB0bzogU3Vic2NyaXB0aW9uU3RhdHVzLkFDVElWRSwgdmFsaWQ6IHRydWUgfSxcbiAgICAgICAgICB7IGZyb206IFN1YnNjcmlwdGlvblN0YXR1cy5QQVNUX0RVRSwgdG86IFN1YnNjcmlwdGlvblN0YXR1cy5DQU5DRUxFRCwgdmFsaWQ6IHRydWUgfSxcbiAgICAgICAgXTtcblxuICAgICAgICBmb3IgKGNvbnN0IHRyYW5zaXRpb24gb2YgdHJhbnNpdGlvbnMpIHtcbiAgICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdmaW5kVXNlclN1YnNjcmlwdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIC4uLnN1YnNjcmlwdGlvbixcbiAgICAgICAgICAgIHN0YXR1czogdHJhbnNpdGlvbi5mcm9tLFxuICAgICAgICAgIH0gYXMgYW55KTtcblxuICAgICAgICAgIGlmICh0cmFuc2l0aW9uLnZhbGlkKSB7XG4gICAgICAgICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICd1cGRhdGVTdWJzY3JpcHRpb24nKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICAgIC4uLnN1YnNjcmlwdGlvbixcbiAgICAgICAgICAgICAgc3RhdHVzOiB0cmFuc2l0aW9uLnRvLFxuICAgICAgICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlU3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiB0cmFuc2l0aW9uLnRvLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKS5yZXNvbHZlcy50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=