{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/booking.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/booking.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  Param,\n  Post,\n  Put,\n  Query,\n  UseGuards,\n  UnauthorizedException,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport { BookingService } from './booking.service';\nimport {\n  BookingMeetingParamsDtoSchema,\n  AvailabilityParamsDtoSchema,\n  GetAvailableSlotsQueryDtoSchema,\n} from './validation/booking.schemas';\nimport type {\n  TherapistAvailabilityCreateDto,\n  TherapistAvailabilityUpdateDto,\n  MeetingCreateDto,\n  MeetingUpdateDto,\n  BookingMeetingParamsDto,\n  AvailabilityParamsDto,\n  GetAvailableSlotsQueryDto,\n} from './types';\n\n@Controller('booking')\n@UseGuards(JwtAuthGuard)\nexport class BookingController {\n  constructor(private readonly bookingService: BookingService) {}\n\n  // Meeting endpoints\n  @Post('meetings')\n  async createMeeting(\n    @Body() createMeetingDto: MeetingCreateDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    // Only clients can book meetings, but we'll validate the relationship in the service\n    if (role !== 'client') {\n      throw new ForbiddenException('Only clients can book meetings');\n    }\n    return this.bookingService.createMeeting(createMeetingDto, userId);\n  }\n\n  @Get('meetings')\n  async getMeetings(\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.getMeetings(userId, role);\n  }\n\n  @Get('meetings/:id')\n  async getMeeting(\n    @Param(new ZodValidationPipe(BookingMeetingParamsDtoSchema))\n    params: BookingMeetingParamsDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.getMeeting(params.id, userId, role);\n  }\n\n  @Put('meetings/:id')\n  async updateMeeting(\n    @Param(new ZodValidationPipe(BookingMeetingParamsDtoSchema))\n    params: BookingMeetingParamsDto,\n    @Body() updateMeetingDto: MeetingUpdateDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.updateMeeting(\n      params.id,\n      updateMeetingDto,\n      userId,\n      role,\n    );\n  }\n\n  @Delete('meetings/:id/cancel')\n  async cancelMeeting(\n    @Param(new ZodValidationPipe(BookingMeetingParamsDtoSchema))\n    params: BookingMeetingParamsDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.cancelMeeting(params.id, userId, role);\n  }\n\n  // Availability endpoints (therapist only)\n  @Post('availability')\n  async createAvailability(\n    @Body() createAvailabilityDto: TherapistAvailabilityCreateDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can manage availability',\n      );\n    }\n    return this.bookingService.createAvailability(\n      createAvailabilityDto,\n      therapistId,\n    );\n  }\n\n  @Get('availability')\n  async getAvailability(\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can view their availability',\n      );\n    }\n    return this.bookingService.getAvailability(therapistId);\n  }\n\n  @Put('availability/:id')\n  async updateAvailability(\n    @Param(new ZodValidationPipe(AvailabilityParamsDtoSchema))\n    params: AvailabilityParamsDto,\n    @Body() updateAvailabilityDto: TherapistAvailabilityUpdateDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can update availability',\n      );\n    }\n    return this.bookingService.updateAvailability(\n      params.id,\n      updateAvailabilityDto,\n      therapistId,\n    );\n  }\n\n  @Delete('availability/:id')\n  async deleteAvailability(\n    @Param(new ZodValidationPipe(AvailabilityParamsDtoSchema))\n    params: AvailabilityParamsDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can delete availability',\n      );\n    }\n    return this.bookingService.deleteAvailability(params.id, therapistId);\n  }\n\n  // Duration endpoints (public)\n  @Get('durations')\n  getDurations() {\n    return this.bookingService.getDurations();\n  }\n\n  // Available slots endpoint\n  @Get('slots')\n  async getAvailableSlots(\n    @Query(new ZodValidationPipe(GetAvailableSlotsQueryDtoSchema))\n    query: GetAvailableSlotsQueryDto,\n  ) {\n    return this.bookingService.getAvailableSlots(query.therapistId, query.date);\n  }\n}\n"],"version":3}