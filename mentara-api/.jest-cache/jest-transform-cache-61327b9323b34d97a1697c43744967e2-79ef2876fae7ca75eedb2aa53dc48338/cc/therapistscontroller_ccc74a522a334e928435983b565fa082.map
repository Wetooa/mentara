{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/therapists.controller.ts","mappings":";;;;;;;;;;;;;;;;AAAA,2CAUwB;AACxB,gFAAoE;AACpE,kEAA6D;AAC7D,4FAA6E;AAC7E,6CAMyB;AAMlB,IAAM,oBAAoB,GAA1B,MAAM,oBAAoB;IACF;IAA7B,YAA6B,MAAqB;QAArB,WAAM,GAAN,MAAM,CAAe;IAAG,CAAC;IAahD,AAAN,KAAK,CAAC,gBAAgB,CACH,MAAc,EACf,KAAc,EACb,MAAe;QAEhC,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,uCAAuC;YAC/F,MAAM,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAE9C,0DAA0D;YAC1D,MAAM,CAAC,UAAU,EAAE,UAAU,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;gBACjD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;oBAC7B,KAAK,EAAE;wBACL,MAAM,EAAE,UAAU;qBACnB;oBACD,IAAI;oBACJ,IAAI;oBACJ,OAAO,EAAE;wBACP,IAAI,EAAE;4BACJ,MAAM,EAAE;gCACN,EAAE,EAAE,IAAI;gCACR,SAAS,EAAE,IAAI;gCACf,QAAQ,EAAE,IAAI;gCACd,KAAK,EAAE,IAAI;gCACX,SAAS,EAAE,IAAI;gCACf,GAAG,EAAE,IAAI;gCACT,SAAS,EAAE,IAAI;6BAChB;yBACF;wBACD,OAAO,EAAE;4BACP,MAAM,EAAE;gCACN,MAAM,EAAE,IAAI;gCACZ,OAAO,EAAE,IAAI;gCACb,SAAS,EAAE,IAAI;gCACf,MAAM,EAAE;oCACN,MAAM,EAAE;wCACN,IAAI,EAAE;4CACJ,MAAM,EAAE;gDACN,SAAS,EAAE,IAAI;gDACf,QAAQ,EAAE,IAAI;6CACf;yCACF;qCACF;iCACF;6BACF;4BACD,OAAO,EAAE;gCACP,SAAS,EAAE,MAAM;6BAClB;4BACD,IAAI,EAAE,CAAC,EAAE,mBAAmB;yBAC7B;qBACF;oBACD,OAAO,EAAE;wBACP,SAAS,EAAE,MAAM;qBAClB;iBACF,CAAC;gBACF,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;oBAC1B,KAAK,EAAE;wBACL,MAAM,EAAE,UAAU;qBACnB;iBACF,CAAC;aACH,CAAC,CAAC;YAEH,gDAAgD;YAChD,MAAM,qBAAqB,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE;gBACzD,MAAM,aAAa,GACjB,SAAS,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;oBAC1B,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CACtB,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,EACpC,CAAC,CACF,GAAG,SAAS,CAAC,OAAO,CAAC,MAAM;oBAC9B,CAAC,CAAC,CAAC,CAAC;gBAER,OAAO;oBACL,EAAE,EAAE,SAAS,CAAC,MAAM;oBACpB,MAAM,EAAE,SAAS,CAAC,MAAM;oBACxB,SAAS,EAAE,SAAS,CAAC,IAAI,CAAC,SAAS;oBACnC,QAAQ,EAAE,SAAS,CAAC,IAAI,CAAC,QAAQ;oBACjC,IAAI,EAAE,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE;oBAC9D,KAAK,EAAE,SAAS,CAAC,IAAI,CAAC,KAAK;oBAC3B,SAAS,EAAE,SAAS,CAAC,IAAI,CAAC,SAAS;oBACnC,YAAY,EAAE,SAAS,CAAC,IAAI,CAAC,SAAS;oBACtC,GAAG,EAAE,SAAS,CAAC,IAAI,CAAC,GAAG;oBACvB,KAAK,EAAE,oBAAoB,EAAE,8BAA8B;oBAC3D,WAAW,EAAE,SAAS,CAAC,gBAAgB,IAAI,EAAE;oBAC7C,gBAAgB,EAAE,SAAS,CAAC,gBAAgB,IAAI,EAAE;oBAClD,UAAU,EAAE,SAAS,CAAC,UAAU,IAAI,EAAE;oBACtC,SAAS,EAAE,SAAS,CAAC,SAAS,IAAI,EAAE;oBACpC,sBAAsB,EAAE,SAAS,CAAC,sBAAsB,IAAI,EAAE;oBAC9D,UAAU,EAAE,SAAS,CAAC,iBAAiB,IAAI,CAAC;oBAC5C,iBAAiB,EAAE,SAAS,CAAC,iBAAiB,IAAI,CAAC;oBACnD,YAAY,EAAE,IAAI,SAAS,CAAC,UAAU,CAAC,QAAQ,EAAE,EAAE;oBACnD,UAAU,EAAE,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC;oBACxC,MAAM,EAAE,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;oBACxC,YAAY,EAAG,SAAiB,CAAC,OAAO,CAAC,MAAM;oBAC/C,QAAQ,EAAE,SAAS,CAAC,QAAQ;oBAC5B,QAAQ,EAAE,SAAS,CAAC,QAAQ;oBAC5B,QAAQ,EAAE,SAAS,CAAC,QAAQ;oBAC5B,QAAQ,EAAE,IAAI,EAAE,gDAAgD;oBAChE,gBAAgB,EAAE,SAAS,CAAC,gBAAgB;oBAC5C,sBAAsB,EAAE,SAAS,CAAC,sBAAsB,IAAI,EAAE;oBAC9D,aAAa,EAAE,SAAS,CAAC,aAAa;oBACtC,sBAAsB,EAAE,SAAS,CAAC,sBAAsB,IAAI,EAAE;oBAC9D,SAAS,EAAE,SAAS,CAAC,SAAS;oBAC9B,SAAS,EAAE,SAAS,CAAC,SAAS;iBAC/B,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,uCAAuC;YACvC,MAAM,QAAQ,GAAG,IAAI,IAAI,UAAU,IAAI,CAAC,CAAC,CAAC,+DAA+D;YAEzG,OAAO;gBACL,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE;oBACJ,UAAU,EAAE,qBAAqB;oBACjC,UAAU;oBACV,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;oBACnD,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAC;oBAC5C,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,KAAK;oBACpD,eAAe,EAAE,IAAI,GAAG,CAAC;iBAC1B;aACF,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,4BAA4B,CACtE,CAAC;QACJ,CAAC;IACH,CAAC;IAmBK,AAAN,KAAK,CAAC,mBAAmB,CAAc,WAAmB;QACxD,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC;gBACtD,KAAK,EAAE;oBACL,MAAM,EAAE,WAAW;oBACnB,MAAM,EAAE,UAAU;iBACnB;gBACD,OAAO,EAAE;oBACP,IAAI,EAAE;wBACJ,MAAM,EAAE;4BACN,EAAE,EAAE,IAAI;4BACR,SAAS,EAAE,IAAI;4BACf,QAAQ,EAAE,IAAI;4BACd,KAAK,EAAE,IAAI;4BACX,SAAS,EAAE,IAAI;4BACf,GAAG,EAAE,IAAI;4BACT,SAAS,EAAE,IAAI;yBAChB;qBACF;oBACD,OAAO,EAAE;wBACP,MAAM,EAAE;4BACN,EAAE,EAAE,IAAI;4BACR,MAAM,EAAE,IAAI;4BACZ,OAAO,EAAE,IAAI;4BACb,SAAS,EAAE,IAAI;4BACf,MAAM,EAAE;gCACN,MAAM,EAAE;oCACN,IAAI,EAAE;wCACJ,MAAM,EAAE;4CACN,SAAS,EAAE,IAAI;4CACf,QAAQ,EAAE,IAAI;4CACd,SAAS,EAAE,IAAI;yCAChB;qCACF;iCACF;6BACF;yBACF;wBACD,OAAO,EAAE;4BACP,SAAS,EAAE,MAAM;yBAClB;wBACD,IAAI,EAAE,EAAE,EAAE,oCAAoC;qBAC/C;oBACD,uBAAuB,EAAE;wBACvB,MAAM,EAAE;4BACN,SAAS,EAAE,IAAI;4BACf,SAAS,EAAE,IAAI;4BACf,OAAO,EAAE,IAAI;4BACb,WAAW,EAAE,IAAI;yBAClB;wBACD,KAAK,EAAE;4BACL,WAAW,EAAE,IAAI;yBAClB;qBACF;iBACF;aACF,CAAC,CAAC;YAEH,IAAI,CAAC,SAAS,EAAE,CAAC;gBACf,MAAM,IAAI,0BAAiB,CACzB,qBAAqB,WAAW,YAAY,CAC7C,CAAC;YACJ,CAAC;YAED,MAAM,aAAa,GACjB,SAAS,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;gBAC1B,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;oBACjE,SAAS,CAAC,OAAO,CAAC,MAAM;gBAC1B,CAAC,CAAC,CAAC,CAAC;YAER,MAAM,oBAAoB,GAAG;gBAC3B,EAAE,EAAE,SAAS,CAAC,MAAM;gBACpB,MAAM,EAAE,SAAS,CAAC,MAAM;gBACxB,SAAS,EAAE,SAAS,CAAC,IAAI,CAAC,SAAS;gBACnC,QAAQ,EAAE,SAAS,CAAC,IAAI,CAAC,QAAQ;gBACjC,IAAI,EAAE,GAAG,SAAS,CAAC,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE;gBAC9D,KAAK,EAAE,SAAS,CAAC,IAAI,CAAC,KAAK;gBAC3B,SAAS,EAAE,SAAS,CAAC,IAAI,CAAC,SAAS;gBACnC,YAAY,EAAE,SAAS,CAAC,IAAI,CAAC,SAAS;gBACtC,GAAG,EAAE,SAAS,CAAC,IAAI,CAAC,GAAG;gBACvB,KAAK,EAAE,oBAAoB;gBAC3B,WAAW,EAAE,SAAS,CAAC,gBAAgB,IAAI,EAAE;gBAC7C,gBAAgB,EAAE,SAAS,CAAC,gBAAgB,IAAI,EAAE;gBAClD,UAAU,EAAE,SAAS,CAAC,UAAU,IAAI,EAAE;gBACtC,SAAS,EAAE,SAAS,CAAC,SAAS,IAAI,EAAE;gBACpC,sBAAsB,EAAE,SAAS,CAAC,sBAAsB,IAAI,EAAE;gBAC9D,UAAU,EAAE,SAAS,CAAC,iBAAiB,IAAI,CAAC;gBAC5C,iBAAiB,EAAE,SAAS,CAAC,iBAAiB,IAAI,CAAC;gBACnD,YAAY,EAAE,IAAI,SAAS,CAAC,UAAU,CAAC,QAAQ,EAAE,EAAE;gBACnD,UAAU,EAAE,SAAS,CAAC,UAAU;gBAChC,MAAM,EAAE,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACxC,YAAY,EAAG,SAAiB,CAAC,OAAO,CAAC,MAAM;gBAC/C,QAAQ,EAAE,SAAS,CAAC,QAAQ;gBAC5B,QAAQ,EAAE,SAAS,CAAC,QAAQ;gBAC5B,QAAQ,EAAE,SAAS,CAAC,QAAQ;gBAC5B,QAAQ,EAAE,IAAI;gBACd,gBAAgB,EAAE,SAAS,CAAC,gBAAgB;gBAC5C,sBAAsB,EAAE,SAAS,CAAC,sBAAsB,IAAI,EAAE;gBAC9D,aAAa,EAAE,SAAS,CAAC,aAAa;gBACtC,sBAAsB,EAAE,SAAS,CAAC,sBAAsB,IAAI,EAAE;gBAC9D,YAAY,EAAE,SAAS,CAAC,uBAAuB;gBAC/C,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;oBAC1C,EAAE,EAAE,MAAM,CAAC,EAAE;oBACb,MAAM,EAAE,MAAM,CAAC,MAAM;oBACrB,OAAO,EAAE,MAAM,CAAC,OAAO;oBACvB,SAAS,EAAE,MAAM,CAAC,SAAS;oBAC3B,UAAU,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG;oBAChF,YAAY,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS;iBAC3C,CAAC,CAAC;gBACH,SAAS,EAAE,SAAS,CAAC,SAAS;gBAC9B,SAAS,EAAE,SAAS,CAAC,SAAS;gBAE9B,4BAA4B;gBAC5B,mBAAmB,EAAE,SAAS,CAAC,mBAAmB;gBAClD,qBAAqB,EAAE,SAAS,CAAC,qBAAqB,IAAI,EAAE;gBAC5D,gBAAgB,EAAE,SAAS,CAAC,gBAAgB;gBAC5C,6BAA6B,EAC3B,SAAS,CAAC,6BAA6B,IAAI,EAAE;gBAC/C,eAAe,EAAE,SAAS,CAAC,eAAe,IAAI,EAAE;gBAChD,gBAAgB,EAAE,SAAS,CAAC,gBAAgB,IAAI,EAAE;gBAClD,2BAA2B,EAAE,SAAS,CAAC,2BAA2B;gBAClE,iCAAiC,EAC/B,SAAS,CAAC,iCAAiC;gBAC7C,uBAAuB,EAAE,SAAS,CAAC,uBAAuB;gBAC1D,eAAe,EAAE,SAAS,CAAC,eAAe;gBAC1C,iBAAiB,EAAE,SAAS,CAAC,iBAAiB;aAC/C,CAAC;YAEF,OAAO;gBACL,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,oBAAoB;aAC3B,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,KAAK,YAAY,0BAAiB,EAAE,CAAC;gBACvC,MAAM,KAAK,CAAC;YACd,CAAC;YACD,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK;gBACpB,CAAC,CAAC,KAAK,CAAC,OAAO;gBACf,CAAC,CAAC,mCAAmC,CACxC,CAAC;QACJ,CAAC;IACH,CAAC;CACF,CAAA;AA5SY,oDAAoB;AAczB;IAXL,IAAA,YAAG,GAAE;IACL,IAAA,sBAAY,EAAC;QACZ,OAAO,EAAE,6BAA6B;QACtC,WAAW,EAAE,8CAA8C;KAC5D,CAAC;IACD,IAAA,qBAAW,EAAC;QACX,MAAM,EAAE,GAAG;QACX,WAAW,EAAE,wBAAwB;KACtC,CAAC;IACD,IAAA,qBAAW,EAAC,EAAE,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE,cAAc,EAAE,CAAC;IACzD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,yCAAa,GAAE,CAAA;IACf,WAAA,IAAA,cAAK,EAAC,OAAO,CAAC,CAAA;IACd,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;;;;4DA2HjB;AAmBK;IAjBL,IAAA,YAAG,EAAC,KAAK,CAAC;IACV,IAAA,sBAAY,EAAC;QACZ,OAAO,EAAE,6BAA6B;QACtC,WAAW,EAAE,iDAAiD;KAC/D,CAAC;IACD,IAAA,kBAAQ,EAAC;QACR,IAAI,EAAE,IAAI;QACV,WAAW,EAAE,mBAAmB;QAChC,IAAI,EAAE,QAAQ;KACf,CAAC;IACD,IAAA,qBAAW,EAAC;QACX,MAAM,EAAE,GAAG;QACX,WAAW,EAAE,wBAAwB;KACtC,CAAC;IACD,IAAA,qBAAW,EAAC,EAAE,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE,qBAAqB,EAAE,CAAC;IAChE,IAAA,qBAAW,EAAC,EAAE,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE,cAAc,EAAE,CAAC;IACzD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IACG,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;;;;+DA4IrC;+BA3SU,oBAAoB;IAJhC,IAAA,iBAAO,EAAC,YAAY,CAAC;IACrB,IAAA,uBAAa,EAAC,UAAU,CAAC;IACzB,IAAA,mBAAU,EAAC,YAAY,CAAC;IACxB,IAAA,kBAAS,EAAC,6BAAY,CAAC;yDAEe,sCAAa,oBAAb,sCAAa;GADvC,oBAAoB,CA4ShC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/therapists.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Query,\n  Param,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  InternalServerErrorException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBearerAuth,\n  ApiParam,\n} from '@nestjs/swagger';\n\n@ApiTags('therapists')\n@ApiBearerAuth('JWT-auth')\n@Controller('therapists')\n@UseGuards(JwtAuthGuard)\nexport class TherapistsController {\n  constructor(private readonly prisma: PrismaService) {}\n\n  @Get()\n  @ApiOperation({\n    summary: 'Get all approved therapists',\n    description: 'Retrieve all therapists with APPROVED status',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.OK)\n  async getAllTherapists(\n    @CurrentUserId() userId: string,\n    @Query('limit') limit?: number,\n    @Query('offset') offset?: number,\n  ) {\n    try {\n      const take = limit ? Math.min(limit, 1000) : undefined; // Allow unlimited, max 1000 for safety\n      const skip = offset ? Math.max(offset, 0) : 0;\n\n      // Get all approved therapists with their user information\n      const [therapists, totalCount] = await Promise.all([\n        this.prisma.therapist.findMany({\n          where: {\n            status: 'APPROVED',\n          },\n          take,\n          skip,\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                email: true,\n                avatarUrl: true,\n                bio: true,\n                createdAt: true,\n              },\n            },\n            reviews: {\n              select: {\n                rating: true,\n                content: true,\n                createdAt: true,\n                client: {\n                  select: {\n                    user: {\n                      select: {\n                        firstName: true,\n                        lastName: true,\n                      },\n                    },\n                  },\n                },\n              },\n              orderBy: {\n                createdAt: 'desc',\n              },\n              take: 5, // Latest 5 reviews\n            },\n          },\n          orderBy: {\n            createdAt: 'desc',\n          },\n        }),\n        this.prisma.therapist.count({\n          where: {\n            status: 'APPROVED',\n          },\n        }),\n      ]);\n\n      // Transform data to match frontend expectations\n      const transformedTherapists = therapists.map((therapist) => {\n        const averageRating =\n          therapist.reviews.length > 0\n            ? therapist.reviews.reduce(\n                (sum, review) => sum + review.rating,\n                0,\n              ) / therapist.reviews.length\n            : 0;\n\n        return {\n          id: therapist.userId,\n          userId: therapist.userId,\n          firstName: therapist.user.firstName,\n          lastName: therapist.user.lastName,\n          name: `${therapist.user.firstName} ${therapist.user.lastName}`,\n          email: therapist.user.email,\n          avatarUrl: therapist.user.avatarUrl,\n          profileImage: therapist.user.avatarUrl,\n          bio: therapist.user.bio,\n          title: 'Licensed Therapist', // Could be made dynamic later\n          specialties: therapist.areasOfExpertise || [],\n          areasOfExpertise: therapist.areasOfExpertise || [],\n          approaches: therapist.approaches || [],\n          languages: therapist.languages || [],\n          illnessSpecializations: therapist.illnessSpecializations || [],\n          experience: therapist.yearsOfExperience || 0,\n          yearsOfExperience: therapist.yearsOfExperience || 0,\n          sessionPrice: `$${therapist.hourlyRate.toString()}`,\n          hourlyRate: Number(therapist.hourlyRate),\n          rating: Number(averageRating.toFixed(1)),\n          totalReviews: (therapist as any).reviews.length,\n          location: therapist.province,\n          province: therapist.province,\n          timezone: therapist.timezone,\n          isActive: true, // All approved therapists are considered active\n          acceptsInsurance: therapist.acceptsInsurance,\n          acceptedInsuranceTypes: therapist.acceptedInsuranceTypes || [],\n          sessionLength: therapist.sessionLength,\n          preferredSessionLength: therapist.preferredSessionLength || [],\n          createdAt: therapist.createdAt,\n          updatedAt: therapist.updatedAt,\n        };\n      });\n\n      // Handle pagination calculation safely\n      const pageSize = take || totalCount || 1; // Use take if provided, otherwise totalCount, or 1 as fallback\n      \n      return {\n        success: true,\n        data: {\n          therapists: transformedTherapists,\n          totalCount,\n          currentPage: take ? Math.floor(skip / take) + 1 : 1,\n          totalPages: Math.ceil(totalCount / pageSize),\n          hasNextPage: take ? skip + take < totalCount : false,\n          hasPreviousPage: skip > 0,\n        },\n      };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to fetch therapists',\n      );\n    }\n  }\n\n  @Get(':id')\n  @ApiOperation({\n    summary: 'Get therapist profile by ID',\n    description: 'Retrieve detailed therapist profile information',\n  })\n  @ApiParam({\n    name: 'id',\n    description: 'Therapist user ID',\n    type: 'string',\n  })\n  @ApiResponse({\n    status: 200,\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 404, description: 'Therapist not found' })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.OK)\n  async getTherapistProfile(@Param('id') therapistId: string) {\n    try {\n      const therapist = await this.prisma.therapist.findFirst({\n        where: {\n          userId: therapistId,\n          status: 'APPROVED',\n        },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              email: true,\n              avatarUrl: true,\n              bio: true,\n              createdAt: true,\n            },\n          },\n          reviews: {\n            select: {\n              id: true,\n              rating: true,\n              content: true,\n              createdAt: true,\n              client: {\n                select: {\n                  user: {\n                    select: {\n                      firstName: true,\n                      lastName: true,\n                      avatarUrl: true,\n                    },\n                  },\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'desc',\n            },\n            take: 10, // Get more reviews for profile page\n          },\n          therapistAvailabilities: {\n            select: {\n              dayOfWeek: true,\n              startTime: true,\n              endTime: true,\n              isAvailable: true,\n            },\n            where: {\n              isAvailable: true,\n            },\n          },\n        },\n      });\n\n      if (!therapist) {\n        throw new NotFoundException(\n          `Therapist with ID ${therapistId} not found`,\n        );\n      }\n\n      const averageRating =\n        therapist.reviews.length > 0\n          ? therapist.reviews.reduce((sum, review) => sum + review.rating, 0) /\n            therapist.reviews.length\n          : 0;\n\n      const transformedTherapist = {\n        id: therapist.userId,\n        userId: therapist.userId,\n        firstName: therapist.user.firstName,\n        lastName: therapist.user.lastName,\n        name: `${therapist.user.firstName} ${therapist.user.lastName}`,\n        email: therapist.user.email,\n        avatarUrl: therapist.user.avatarUrl,\n        profileImage: therapist.user.avatarUrl,\n        bio: therapist.user.bio,\n        title: 'Licensed Therapist',\n        specialties: therapist.areasOfExpertise || [],\n        areasOfExpertise: therapist.areasOfExpertise || [],\n        approaches: therapist.approaches || [],\n        languages: therapist.languages || [],\n        illnessSpecializations: therapist.illnessSpecializations || [],\n        experience: therapist.yearsOfExperience || 0,\n        yearsOfExperience: therapist.yearsOfExperience || 0,\n        sessionPrice: `$${therapist.hourlyRate.toString()}`,\n        hourlyRate: therapist.hourlyRate,\n        rating: Number(averageRating.toFixed(1)),\n        totalReviews: (therapist as any).reviews.length,\n        location: therapist.province,\n        province: therapist.province,\n        timezone: therapist.timezone,\n        isActive: true,\n        acceptsInsurance: therapist.acceptsInsurance,\n        acceptedInsuranceTypes: therapist.acceptedInsuranceTypes || [],\n        sessionLength: therapist.sessionLength,\n        preferredSessionLength: therapist.preferredSessionLength || [],\n        availability: therapist.therapistAvailabilities,\n        reviews: therapist.reviews.map((review) => ({\n          id: review.id,\n          rating: review.rating,\n          comment: review.content,\n          createdAt: review.createdAt,\n          clientName: `${review.client.user.firstName} ${review.client.user.lastName[0]}.`,\n          clientAvatar: review.client.user.avatarUrl,\n        })),\n        createdAt: therapist.createdAt,\n        updatedAt: therapist.updatedAt,\n\n        // Additional profile fields\n        educationBackground: therapist.educationBackground,\n        specialCertifications: therapist.specialCertifications || [],\n        practiceLocation: therapist.practiceLocation,\n        therapeuticApproachesUsedList:\n          therapist.therapeuticApproachesUsedList || [],\n        assessmentTools: therapist.assessmentTools || [],\n        languagesOffered: therapist.languagesOffered || [],\n        providedOnlineTherapyBefore: therapist.providedOnlineTherapyBefore,\n        comfortableUsingVideoConferencing:\n          therapist.comfortableUsingVideoConferencing,\n        professionalLicenseType: therapist.professionalLicenseType,\n        licenseVerified: therapist.licenseVerified,\n        practiceStartDate: therapist.practiceStartDate,\n      };\n\n      return {\n        success: true,\n        data: transformedTherapist,\n      };\n    } catch (error) {\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error\n          ? error.message\n          : 'Failed to fetch therapist profile',\n      );\n    }\n  }\n}\n"],"version":3}