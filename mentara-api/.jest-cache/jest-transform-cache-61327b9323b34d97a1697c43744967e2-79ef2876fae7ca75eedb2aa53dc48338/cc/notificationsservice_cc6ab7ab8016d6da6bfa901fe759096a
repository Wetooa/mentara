de21814304abd2435d67dbf958ef2a5a
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var NotificationsService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationsService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("src/providers/prisma-client.provider");
const event_emitter_1 = require("@nestjs/event-emitter");
const client_1 = require("@prisma/client");
let NotificationsService = NotificationsService_1 = class NotificationsService {
    prisma;
    eventEmitter;
    logger = new common_1.Logger(NotificationsService_1.name);
    webSocketServer = null;
    constructor(prisma, eventEmitter) {
        this.prisma = prisma;
        this.eventEmitter = eventEmitter;
    }
    onModuleInit() {
        this.logger.log('NotificationsService initialized with real-time capabilities');
    }
    /**
     * Set WebSocket server instance for real-time notifications
     */
    setWebSocketServer(server) {
        this.webSocketServer = server;
        this.logger.log('WebSocket server configured for real-time notifications');
    }
    async create(data, deliveryOptions) {
        const notification = await this.prisma.notification.create({
            data: {
                ...data,
                priority: data.priority || client_1.NotificationPriority.NORMAL,
            },
            include: {
                user: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        email: true,
                    },
                },
            },
        });
        // Default delivery options
        const options = {
            realTime: true,
            email: false,
            push: false,
            scheduled: false,
            ...deliveryOptions,
        };
        // Deliver notification immediately if not scheduled
        if (!data.scheduledFor) {
            await this.deliverNotification(notification, options);
        }
        return notification;
    }
    async findAll(userId, isRead, type, priority) {
        const where = { userId };
        if (isRead !== undefined)
            where.isRead = isRead;
        if (type)
            where.type = type;
        if (priority)
            where.priority = priority;
        return this.prisma.notification.findMany({
            where,
            orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }],
            take: 50, // Limit to recent notifications
        });
    }
    async findOne(id) {
        return this.prisma.notification.findUnique({
            where: { id },
            include: {
                user: {
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        email: true,
                    },
                },
            },
        });
    }
    async markAsRead(id) {
        const notification = await this.findOne(id);
        if (!notification) {
            throw new common_1.NotFoundException(`Notification with ID ${id} not found`);
        }
        return this.prisma.notification.update({
            where: { id },
            data: {
                isRead: true,
                readAt: new Date(),
            },
        });
    }
    async markAllAsRead(userId) {
        const result = await this.prisma.notification.updateMany({
            where: {
                userId,
                isRead: false,
            },
            data: {
                isRead: true,
                readAt: new Date(),
            },
        });
        return { count: result.count };
    }
    async delete(id) {
        const notification = await this.findOne(id);
        if (!notification) {
            throw new common_1.NotFoundException(`Notification with ID ${id} not found`);
        }
        return this.prisma.notification.delete({
            where: { id },
        });
    }
    async getUnreadCount(userId) {
        return this.prisma.notification.count({
            where: {
                userId,
                isRead: false,
            },
        });
    }
    async getNotificationSettings(userId) {
        let settings = await this.prisma.notificationSettings.findUnique({
            where: { userId },
        });
        if (!settings) {
            // Create default settings
            settings = await this.prisma.notificationSettings.create({
                data: { userId },
            });
        }
        return settings;
    }
    async updateNotificationSettings(userId, data) {
        return this.prisma.notificationSettings.upsert({
            where: { userId },
            update: data,
            create: {
                userId,
                ...data,
            },
        });
    }
    /**
     * Deliver notification through configured channels
     */
    async deliverNotification(notification, options) {
        try {
            // Real-time WebSocket delivery
            if (options.realTime && this.webSocketServer) {
                await this.deliverRealTimeNotification(notification);
            }
            // Email delivery (if configured)
            if (options.email) {
                await this.deliverEmailNotification(notification);
            }
            // Push notification delivery (if configured)
            if (options.push) {
                await this.deliverPushNotification(notification);
            }
        }
        catch (error) {
            this.logger.error(`Error delivering notification ${notification.id}:`, error);
        }
    }
    /**
     * Deliver real-time notification via WebSocket
     */
    async deliverRealTimeNotification(notification) {
        if (!this.webSocketServer) {
            this.logger.warn('WebSocket server not configured for real-time notifications');
            return;
        }
        try {
            // Send to user's personal room
            this.webSocketServer
                .to(`user:${notification.userId}`)
                .emit('notification', {
                id: notification.id,
                title: notification.title,
                message: notification.message,
                type: notification.type,
                priority: notification.priority,
                actionUrl: notification.actionUrl,
                data: notification.data,
                createdAt: notification.createdAt,
                isRead: false,
            });
            // Send unread count update
            const unreadCount = await this.getUnreadCount(notification.userId);
            this.webSocketServer
                .to(`user:${notification.userId}`)
                .emit('unreadCount', {
                count: unreadCount,
            });
            this.logger.log(`Real-time notification delivered to user ${notification.userId}`);
        }
        catch (error) {
            this.logger.error(`Error delivering real-time notification:`, error);
        }
    }
    /**
     * Deliver email notification (placeholder for email service integration)
     */
    async deliverEmailNotification(notification) {
        // TODO: Integrate with email service (SendGrid, AWS SES, etc.)
        this.logger.log(`Email notification queued for user ${notification.userId}`);
    }
    /**
     * Deliver push notification (placeholder for push service integration)
     */
    async deliverPushNotification(notification) {
        // TODO: Integrate with push notification service (FCM, APNS, etc.)
        this.logger.log(`Push notification queued for user ${notification.userId}`);
    }
    /**
     * Batch create notifications with optimized delivery
     */
    async createBatch(notifications, deliveryOptions) {
        const createdNotifications = [];
        // Create notifications in batches for better performance
        for (const notificationData of notifications) {
            const notification = await this.create(notificationData, deliveryOptions);
            createdNotifications.push(notification);
        }
        return createdNotifications;
    }
    /**
     * Send notification to all users in a community
     */
    async sendToCommunity(communityId, notification, deliveryOptions) {
        try {
            // Get all community members
            const members = await this.prisma.membership.findMany({
                where: { communityId },
                select: { userId: true },
            });
            // Create notifications for all members (filter out null userIds)
            const notifications = members
                .filter((member) => member.userId !== null)
                .map((member) => ({
                ...notification,
                userId: member.userId,
            }));
            await this.createBatch(notifications, deliveryOptions);
            this.logger.log(`Sent notifications to ${members.length} community members`);
        }
        catch (error) {
            this.logger.error(`Error sending notifications to community ${communityId}:`, error);
        }
    }
    // ===== EVENT LISTENERS FOR COMMUNITY RECOMMENDATION SYSTEM =====
    /**
     * Handle community recommendation generated events
     */
    async handleRecommendationsGenerated(payload) {
        try {
            await this.create({
                userId: payload.userId,
                title: 'New Community Recommendations',
                message: `We've found ${payload.recommendationCount} new communities that might interest you based on your assessment results.`,
                type: client_1.NotificationType.COMMUNITY_RECOMMENDATION,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/communities/recommendations',
                data: {
                    recommendationCount: payload.recommendationCount,
                    generatedAt: payload.timestamp,
                },
            }, {
                realTime: true,
                email: false,
                push: true,
            });
            this.logger.log(`Community recommendation notification sent to user ${payload.userId}`);
        }
        catch (error) {
            this.logger.error(`Error handling recommendations generated event:`, error);
        }
    }
    /**
     * Handle community recommendation interaction events
     */
    async handleRecommendationInteraction(payload) {
        try {
            if (payload.action === 'accept') {
                await this.create({
                    userId: payload.userId,
                    title: `Welcome to ${payload.communityName}!`,
                    message: `You've successfully joined ${payload.communityName}. Start exploring and connecting with the community.`,
                    type: client_1.NotificationType.COMMUNITY_JOINED,
                    priority: client_1.NotificationPriority.HIGH,
                    actionUrl: `/communities/${payload.communityId}`,
                    data: {
                        communityId: payload.communityId,
                        communityName: payload.communityName,
                        compatibilityScore: payload.compatibilityScore,
                        joinMethod: 'recommendation_accepted',
                    },
                }, {
                    realTime: true,
                    email: false,
                    push: true,
                });
                this.logger.log(`Community join notification sent to user ${payload.userId}`);
            }
        }
        catch (error) {
            this.logger.error(`Error handling recommendation interaction event:`, error);
        }
    }
    /**
     * Handle community member joined events
     */
    async handleMemberJoined(payload) {
        try {
            // Get community details
            const community = await this.prisma.community.findUnique({
                where: { id: payload.communityId },
                select: { name: true, _count: { select: { memberships: true } } },
            });
            if (!community)
                return;
            // Send welcome notification to the new member
            await this.create({
                userId: payload.userId,
                title: `Welcome to ${community.name}!`,
                message: `You're now part of a community with ${community._count.memberships} members. Start exploring and connecting!`,
                type: client_1.NotificationType.COMMUNITY_WELCOME,
                priority: client_1.NotificationPriority.HIGH,
                actionUrl: `/communities/${payload.communityId}`,
                data: {
                    communityId: payload.communityId,
                    communityName: community.name,
                    memberCount: community._count.memberships,
                    joinMethod: payload.joinMethod,
                },
            }, {
                realTime: true,
                email: false,
                push: true,
            });
            this.logger.log(`Community welcome notification sent to user ${payload.userId}`);
        }
        catch (error) {
            this.logger.error(`Error handling member joined event:`, error);
        }
    }
    /**
     * Handle recommendations refreshed events
     */
    async handleRecommendationsRefreshed(payload) {
        try {
            await this.create({
                userId: payload.userId,
                title: 'Community Recommendations Updated',
                message: 'Your community recommendations have been updated based on your latest assessment results.',
                type: client_1.NotificationType.RECOMMENDATIONS_UPDATED,
                priority: client_1.NotificationPriority.NORMAL,
                actionUrl: '/communities/recommendations',
                data: {
                    refreshedAt: payload.timestamp,
                    reason: 'assessment_change',
                },
            }, {
                realTime: true,
                email: false,
                push: false,
            });
            this.logger.log(`Recommendations refreshed notification sent to user ${payload.userId}`);
        }
        catch (error) {
            this.logger.error(`Error handling recommendations refreshed event:`, error);
        }
    }
    // Helper methods for creating specific notification types
    async createAppointmentReminder(userId, appointmentId, appointmentTime, therapistName) {
        return this.create({
            userId,
            title: 'Upcoming Appointment',
            message: `You have an appointment with ${therapistName} in 1 hour.`,
            type: client_1.NotificationType.APPOINTMENT_REMINDER,
            priority: client_1.NotificationPriority.HIGH,
            actionUrl: `/appointments/${appointmentId}`,
            data: { appointmentId, appointmentTime },
        });
    }
    async createMessageNotification(userId, senderId, senderName, conversationId) {
        return this.create({
            userId,
            title: 'New Message',
            message: `You have a new message from ${senderName}.`,
            type: client_1.NotificationType.MESSAGE_RECEIVED,
            priority: client_1.NotificationPriority.NORMAL,
            actionUrl: `/messages/${conversationId}`,
            data: { senderId, conversationId },
        });
    }
    async createWorksheetAssignedNotification(userId, worksheetId, worksheetTitle, therapistName) {
        return this.create({
            userId,
            title: 'New Worksheet Assigned',
            message: `${therapistName} has assigned you a new worksheet: "${worksheetTitle}".`,
            type: client_1.NotificationType.WORKSHEET_ASSIGNED,
            priority: client_1.NotificationPriority.NORMAL,
            actionUrl: `/worksheets/${worksheetId}`,
            data: { worksheetId },
        });
    }
    async createTherapistApplicationNotification(userId, status) {
        const title = status === 'approved' ? 'Application Approved' : 'Application Update';
        const message = status === 'approved'
            ? 'Congratulations! Your therapist application has been approved.'
            : 'Your therapist application has been reviewed. Please check your application status.';
        return this.create({
            userId,
            title,
            message,
            type: status === 'approved'
                ? client_1.NotificationType.THERAPIST_APPROVED
                : client_1.NotificationType.THERAPIST_REJECTED,
            priority: client_1.NotificationPriority.HIGH,
            actionUrl: '/therapist/application',
            data: { status },
        });
    }
    async createReviewRequestNotification(userId, therapistId, therapistName, sessionId) {
        return this.create({
            userId,
            title: 'Review Request',
            message: `Please leave a review for your session with ${therapistName}.`,
            type: client_1.NotificationType.REVIEW_REQUEST,
            priority: client_1.NotificationPriority.NORMAL,
            actionUrl: `/therapists/${therapistId}/review?session=${sessionId}`,
            data: { therapistId, sessionId },
        });
    }
    async createCommunityPostNotification(userId, postId, communityName, authorName) {
        return this.create({
            userId,
            title: 'New Community Post',
            message: `${authorName} posted in ${communityName}.`,
            type: client_1.NotificationType.COMMUNITY_POST,
            priority: client_1.NotificationPriority.LOW,
            actionUrl: `/communities/posts/${postId}`,
            data: { postId, communityName },
        });
    }
    // ===== THERAPIST MATCHING SYSTEM NOTIFICATIONS =====
    async createClientRequestNotification(therapistId, clientId, clientName, requestMessage, priority = 'NORMAL') {
        const notificationPriority = priority === 'HIGH' || priority === 'URGENT' ? 'HIGH' : 'NORMAL';
        return this.create({
            userId: therapistId,
            title: `New Client Request ${priority === 'URGENT' ? '(Urgent)' : ''}`,
            message: `${clientName} has sent you a therapy request.${requestMessage ? ` "${requestMessage.substring(0, 100)}${requestMessage.length > 100 ? '...' : ''}"` : ''}`,
            type: 'CLIENT_REQUEST_RECEIVED',
            priority: notificationPriority,
            actionUrl: `/therapist/requests`,
            data: {
                clientId,
                clientName,
                requestType: 'therapy_request',
                priority,
                hasMessage: !!requestMessage,
            },
        });
    }
    async createRequestAcceptedNotification(clientId, therapistId, therapistName, responseMessage, schedulingInfo) {
        return this.create({
            userId: clientId,
            title: 'Therapist Request Accepted! ðŸŽ‰',
            message: `Great news! ${therapistName} has accepted your therapy request.${responseMessage ? ` "${responseMessage}"` : ''}`,
            type: 'THERAPIST_REQUEST_ACCEPTED',
            priority: 'HIGH',
            actionUrl: `/client/therapists/${therapistId}`,
            data: {
                therapistId,
                therapistName,
                responseMessage,
                schedulingInfo,
                nextStep: 'schedule_session',
            },
        });
    }
    async createRequestDeclinedNotification(clientId, therapistId, therapistName, responseMessage) {
        return this.create({
            userId: clientId,
            title: 'Therapist Request Update',
            message: `${therapistName} has responded to your therapy request.${responseMessage ? ` "${responseMessage}"` : ''} Don't worry - we can help you find other great matches!`,
            type: 'THERAPIST_REQUEST_DECLINED',
            priority: 'NORMAL',
            actionUrl: '/client/therapists/browse',
            data: {
                therapistId,
                therapistName,
                responseMessage,
                nextStep: 'browse_alternatives',
            },
        });
    }
    async createRequestCancelledNotification(therapistId, clientName, reason) {
        return this.create({
            userId: therapistId,
            title: 'Client Request Cancelled',
            message: `${clientName} has cancelled their therapy request.${reason ? ` Reason: ${reason}` : ''}`,
            type: 'CLIENT_REQUEST_CANCELLED',
            priority: 'NORMAL',
            actionUrl: '/therapist/requests',
            data: {
                clientName,
                reason,
                actionType: 'cancellation',
            },
        });
    }
    async createAdminTherapistApprovalNotification(therapistId, approvalMessage) {
        return this.create({
            userId: therapistId,
            title: 'Application Approved! Welcome to Mentara ðŸŽ‰',
            message: `Congratulations! Your therapist application has been approved. You can now start receiving client requests.${approvalMessage ? ` Message from our team: "${approvalMessage}"` : ''}`,
            type: 'THERAPIST_APPROVED',
            priority: 'HIGH',
            actionUrl: '/therapist/dashboard',
            data: {
                approvalMessage,
                nextSteps: [
                    'complete_profile',
                    'set_availability',
                    'review_guidelines',
                ],
                welcomeFlow: true,
            },
        });
    }
    async createAdminTherapistRejectionNotification(therapistId, rejectionReason, rejectionMessage, allowReapplication) {
        return this.create({
            userId: therapistId,
            title: 'Application Status Update',
            message: `Your therapist application has been reviewed. ${rejectionMessage}`,
            type: 'THERAPIST_REJECTED',
            priority: 'HIGH',
            actionUrl: allowReapplication
                ? '/therapist/reapply'
                : '/therapist/application-status',
            data: {
                rejectionReason,
                rejectionMessage,
                allowReapplication,
                nextStep: allowReapplication ? 'reapply' : 'contact_support',
            },
        });
    }
    async createNewRecommendationsNotification(clientId, therapistCount, updateReason = 'new_therapists') {
        const reasonMessages = {
            profile_update: 'based on your updated preferences',
            new_therapists: 'with newly approved therapists',
            algorithm_improvement: 'with improved matching',
        };
        return this.create({
            userId: clientId,
            title: 'New Therapist Recommendations Available',
            message: `We've found ${therapistCount} new therapist matches for you ${reasonMessages[updateReason]}. Check them out!`,
            type: 'NEW_RECOMMENDATIONS',
            priority: 'NORMAL',
            actionUrl: '/client/therapists/recommendations',
            data: {
                therapistCount,
                updateReason,
                recommendationType: 'updated_matches',
            },
        });
    }
    async createMatchingSystemUpdateNotification(userId, updateType, updateMessage) {
        const titles = {
            algorithm_improvement: 'Better Matching Available',
            feature_release: 'New Feature Available',
            maintenance: 'System Update Complete',
        };
        const priorities = {
            algorithm_improvement: 'NORMAL',
            feature_release: 'NORMAL',
            maintenance: 'LOW',
        };
        return this.create({
            userId,
            title: titles[updateType],
            message: updateMessage,
            type: 'SYSTEM_UPDATE',
            priority: priorities[updateType],
            actionUrl: '/dashboard',
            data: {
                updateType,
                systemUpdate: true,
            },
        });
    }
    async createRelationshipEstablishedNotification(clientId, therapistId, therapistName) {
        return this.create({
            userId: clientId,
            title: 'Welcome to Your Therapy Journey! ðŸŒŸ',
            message: `You're now connected with ${therapistName}. Your therapy relationship has officially begun. Take the first step by scheduling your initial session.`,
            type: 'RELATIONSHIP_ESTABLISHED',
            priority: 'HIGH',
            actionUrl: `/client/therapists/${therapistId}/schedule`,
            data: {
                therapistId,
                therapistName,
                relationshipStatus: 'active',
                nextStep: 'schedule_first_session',
            },
        });
    }
    async createTherapistRequestReminderNotification(therapistId, pendingRequestCount) {
        return this.create({
            userId: therapistId,
            title: `${pendingRequestCount} Pending Client Request${pendingRequestCount > 1 ? 's' : ''}`,
            message: `You have ${pendingRequestCount} client request${pendingRequestCount > 1 ? 's' : ''} waiting for your response. Clients appreciate timely responses!`,
            type: 'REQUEST_REMINDER',
            priority: pendingRequestCount > 3 ? 'HIGH' : 'NORMAL',
            actionUrl: '/therapist/requests/pending',
            data: {
                pendingRequestCount,
                reminderType: 'pending_requests',
                urgency: pendingRequestCount > 3 ? 'high' : 'normal',
            },
        });
    }
    async createProfileCompletionReminderNotification(userId, userType, missingFields) {
        const actionUrls = {
            client: '/client/profile',
            therapist: '/therapist/profile',
        };
        return this.create({
            userId,
            title: 'Complete Your Profile for Better Matches',
            message: `Complete your profile to get better therapist recommendations. Missing: ${missingFields.slice(0, 3).join(', ')}${missingFields.length > 3 ? '...' : ''}`,
            type: 'PROFILE_COMPLETION',
            priority: 'LOW',
            actionUrl: actionUrls[userType],
            data: {
                missingFields,
                userType,
                profileCompleteness: Math.max(0, 100 - missingFields.length * 10),
            },
        });
    }
    async sendScheduledNotifications() {
        const now = new Date();
        const scheduledNotifications = await this.prisma.notification.findMany({
            where: {
                scheduledFor: {
                    lte: now,
                },
                sentAt: null,
            },
        });
        for (const notification of scheduledNotifications) {
            // In a real implementation, you would send the notification
            // via email, push notification, etc. here
            await this.prisma.notification.update({
                where: { id: notification.id },
                data: { sentAt: now },
            });
        }
        return { sent: scheduledNotifications.length };
    }
};
exports.NotificationsService = NotificationsService;
__decorate([
    (0, event_emitter_1.OnEvent)('community.recommendations.generated'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], NotificationsService.prototype, "handleRecommendationsGenerated", null);
__decorate([
    (0, event_emitter_1.OnEvent)('community.recommendation.interaction'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], NotificationsService.prototype, "handleRecommendationInteraction", null);
__decorate([
    (0, event_emitter_1.OnEvent)('community.member.joined'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], NotificationsService.prototype, "handleMemberJoined", null);
__decorate([
    (0, event_emitter_1.OnEvent)('community.recommendations.refreshed'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], NotificationsService.prototype, "handleRecommendationsRefreshed", null);
exports.NotificationsService = NotificationsService = NotificationsService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof event_emitter_1.EventEmitter2 !== "undefined" && event_emitter_1.EventEmitter2) === "function" ? _b : Object])
], NotificationsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9ucy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBS3dCO0FBQ3hCLGlGQUFxRTtBQUNyRSx5REFBK0Q7QUFFL0QsMkNBSXdCO0FBMEJqQixJQUFNLG9CQUFvQiw0QkFBMUIsTUFBTSxvQkFBb0I7SUFLWjtJQUNBO0lBTEYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLHNCQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hELGVBQWUsR0FBMkIsSUFBSSxDQUFDO0lBRXZELFlBQ21CLE1BQXFCLEVBQ3JCLFlBQTJCO1FBRDNCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsaUJBQVksR0FBWixZQUFZLENBQWU7SUFDM0MsQ0FBQztJQUVKLFlBQVk7UUFDVixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYiw4REFBOEQsQ0FDL0QsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILGtCQUFrQixDQUFDLE1BQXVCO1FBQ3hDLElBQUksQ0FBQyxlQUFlLEdBQUcsTUFBTSxDQUFDO1FBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLHlEQUF5RCxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNLENBQ1YsSUFTQyxFQUNELGVBQTZDO1FBRTdDLE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO1lBQ3pELElBQUksRUFBRTtnQkFDSixHQUFHLElBQUk7Z0JBQ1AsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLElBQUksNkJBQW9CLENBQUMsTUFBTTthQUN2RDtZQUNELE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUU7b0JBQ0osTUFBTSxFQUFFO3dCQUNOLEVBQUUsRUFBRSxJQUFJO3dCQUNSLFNBQVMsRUFBRSxJQUFJO3dCQUNmLFFBQVEsRUFBRSxJQUFJO3dCQUNkLEtBQUssRUFBRSxJQUFJO3FCQUNaO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCwyQkFBMkI7UUFDM0IsTUFBTSxPQUFPLEdBQUc7WUFDZCxRQUFRLEVBQUUsSUFBSTtZQUNkLEtBQUssRUFBRSxLQUFLO1lBQ1osSUFBSSxFQUFFLEtBQUs7WUFDWCxTQUFTLEVBQUUsS0FBSztZQUNoQixHQUFHLGVBQWU7U0FDbkIsQ0FBQztRQUVGLG9EQUFvRDtRQUNwRCxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN4RCxDQUFDO1FBRUQsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPLENBQ1gsTUFBYyxFQUNkLE1BQWdCLEVBQ2hCLElBQXVCLEVBQ3ZCLFFBQStCO1FBRS9CLE1BQU0sS0FBSyxHQUFRLEVBQUUsTUFBTSxFQUFFLENBQUM7UUFFOUIsSUFBSSxNQUFNLEtBQUssU0FBUztZQUFFLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ2hELElBQUksSUFBSTtZQUFFLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQzVCLElBQUksUUFBUTtZQUFFLEtBQUssQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBRXhDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO1lBQ3ZDLEtBQUs7WUFDTCxPQUFPLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUN0RCxJQUFJLEVBQUUsRUFBRSxFQUFFLGdDQUFnQztTQUMzQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFVO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO1lBQ3pDLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUNiLE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUU7b0JBQ0osTUFBTSxFQUFFO3dCQUNOLEVBQUUsRUFBRSxJQUFJO3dCQUNSLFNBQVMsRUFBRSxJQUFJO3dCQUNmLFFBQVEsRUFBRSxJQUFJO3dCQUNkLEtBQUssRUFBRSxJQUFJO3FCQUNaO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFVO1FBQ3pCLE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDbEIsTUFBTSxJQUFJLDBCQUFpQixDQUFDLHdCQUF3QixFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3RFLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQztZQUNyQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUU7WUFDYixJQUFJLEVBQUU7Z0JBQ0osTUFBTSxFQUFFLElBQUk7Z0JBQ1osTUFBTSxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ25CO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBYztRQUNoQyxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQztZQUN2RCxLQUFLLEVBQUU7Z0JBQ0wsTUFBTTtnQkFDTixNQUFNLEVBQUUsS0FBSzthQUNkO1lBQ0QsSUFBSSxFQUFFO2dCQUNKLE1BQU0sRUFBRSxJQUFJO2dCQUNaLE1BQU0sRUFBRSxJQUFJLElBQUksRUFBRTthQUNuQjtTQUNGLENBQUMsQ0FBQztRQUVILE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2pDLENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQVU7UUFDckIsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNsQixNQUFNLElBQUksMEJBQWlCLENBQUMsd0JBQXdCLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDdEUsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO1lBQ3JDLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRTtTQUNkLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQWM7UUFDakMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7WUFDcEMsS0FBSyxFQUFFO2dCQUNMLE1BQU07Z0JBQ04sTUFBTSxFQUFFLEtBQUs7YUFDZDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsdUJBQXVCLENBQUMsTUFBYztRQUMxQyxJQUFJLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDO1lBQy9ELEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRTtTQUNsQixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDZCwwQkFBMEI7WUFDMUIsUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUM7Z0JBQ3ZELElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRTthQUNqQixDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVELEtBQUssQ0FBQywwQkFBMEIsQ0FDOUIsTUFBYyxFQUNkLElBZ0JDO1FBRUQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQztZQUM3QyxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUU7WUFDakIsTUFBTSxFQUFFLElBQUk7WUFDWixNQUFNLEVBQUU7Z0JBQ04sTUFBTTtnQkFDTixHQUFHLElBQUk7YUFDUjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyxtQkFBbUIsQ0FDL0IsWUFBMEMsRUFDMUMsT0FBb0M7UUFFcEMsSUFBSSxDQUFDO1lBQ0gsK0JBQStCO1lBQy9CLElBQUksT0FBTyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQzdDLE1BQU0sSUFBSSxDQUFDLDJCQUEyQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3ZELENBQUM7WUFFRCxpQ0FBaUM7WUFDakMsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2xCLE1BQU0sSUFBSSxDQUFDLHdCQUF3QixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3BELENBQUM7WUFFRCw2Q0FBNkM7WUFDN0MsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2pCLE1BQU0sSUFBSSxDQUFDLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ25ELENBQUM7UUFDSCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNmLGlDQUFpQyxZQUFZLENBQUMsRUFBRSxHQUFHLEVBQ25ELEtBQUssQ0FDTixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQywyQkFBMkIsQ0FDdkMsWUFBMEM7UUFFMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZCw2REFBNkQsQ0FDOUQsQ0FBQztZQUNGLE9BQU87UUFDVCxDQUFDO1FBRUQsSUFBSSxDQUFDO1lBQ0gsK0JBQStCO1lBQy9CLElBQUksQ0FBQyxlQUFlO2lCQUNqQixFQUFFLENBQUMsUUFBUSxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUM7aUJBQ2pDLElBQUksQ0FBQyxjQUFjLEVBQUU7Z0JBQ3BCLEVBQUUsRUFBRSxZQUFZLENBQUMsRUFBRTtnQkFDbkIsS0FBSyxFQUFFLFlBQVksQ0FBQyxLQUFLO2dCQUN6QixPQUFPLEVBQUUsWUFBWSxDQUFDLE9BQU87Z0JBQzdCLElBQUksRUFBRSxZQUFZLENBQUMsSUFBSTtnQkFDdkIsUUFBUSxFQUFFLFlBQVksQ0FBQyxRQUFRO2dCQUMvQixTQUFTLEVBQUUsWUFBWSxDQUFDLFNBQVM7Z0JBQ2pDLElBQUksRUFBRSxZQUFZLENBQUMsSUFBSTtnQkFDdkIsU0FBUyxFQUFFLFlBQVksQ0FBQyxTQUFTO2dCQUNqQyxNQUFNLEVBQUUsS0FBSzthQUNkLENBQUMsQ0FBQztZQUVMLDJCQUEyQjtZQUMzQixNQUFNLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ25FLElBQUksQ0FBQyxlQUFlO2lCQUNqQixFQUFFLENBQUMsUUFBUSxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUM7aUJBQ2pDLElBQUksQ0FBQyxhQUFhLEVBQUU7Z0JBQ25CLEtBQUssRUFBRSxXQUFXO2FBQ25CLENBQUMsQ0FBQztZQUVMLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLDRDQUE0QyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQ2xFLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLDBDQUEwQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsd0JBQXdCLENBQ3BDLFlBQTBDO1FBRTFDLCtEQUErRDtRQUMvRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYixzQ0FBc0MsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUM1RCxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0ssS0FBSyxDQUFDLHVCQUF1QixDQUNuQyxZQUEwQztRQUUxQyxtRUFBbUU7UUFDbkUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMscUNBQXFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxXQUFXLENBQ2YsYUFTRSxFQUNGLGVBQTZDO1FBRTdDLE1BQU0sb0JBQW9CLEdBQW1CLEVBQUUsQ0FBQztRQUVoRCx5REFBeUQ7UUFDekQsS0FBSyxNQUFNLGdCQUFnQixJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQzdDLE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxlQUFlLENBQUMsQ0FBQztZQUMxRSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUVELE9BQU8sb0JBQW9CLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGVBQWUsQ0FDbkIsV0FBbUIsRUFDbkIsWUFBK0QsRUFDL0QsZUFBNkM7UUFFN0MsSUFBSSxDQUFDO1lBQ0gsNEJBQTRCO1lBQzVCLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO2dCQUNwRCxLQUFLLEVBQUUsRUFBRSxXQUFXLEVBQUU7Z0JBQ3RCLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7YUFDekIsQ0FBQyxDQUFDO1lBRUgsaUVBQWlFO1lBQ2pFLE1BQU0sYUFBYSxHQUFHLE9BQU87aUJBQzFCLE1BQU0sQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUM7aUJBQzFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDaEIsR0FBRyxZQUFZO2dCQUNmLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTzthQUN2QixDQUFDLENBQUMsQ0FBQztZQUVOLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLEVBQUUsZUFBZSxDQUFDLENBQUM7WUFFdkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQ2IseUJBQXlCLE9BQU8sQ0FBQyxNQUFNLG9CQUFvQixDQUM1RCxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FDZiw0Q0FBNEMsV0FBVyxHQUFHLEVBQzFELEtBQUssQ0FDTixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFFRCxrRUFBa0U7SUFFbEU7O09BRUc7SUFFRyxBQUFOLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxPQUlwQztRQUNDLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FDZjtnQkFDRSxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07Z0JBQ3RCLEtBQUssRUFBRSwrQkFBK0I7Z0JBQ3RDLE9BQU8sRUFBRSxlQUFlLE9BQU8sQ0FBQyxtQkFBbUIsNEVBQTRFO2dCQUMvSCxJQUFJLEVBQUUseUJBQWdCLENBQUMsd0JBQXdCO2dCQUMvQyxRQUFRLEVBQUUsNkJBQW9CLENBQUMsTUFBTTtnQkFDckMsU0FBUyxFQUFFLDhCQUE4QjtnQkFDekMsSUFBSSxFQUFFO29CQUNKLG1CQUFtQixFQUFFLE9BQU8sQ0FBQyxtQkFBbUI7b0JBQ2hELFdBQVcsRUFBRSxPQUFPLENBQUMsU0FBUztpQkFDL0I7YUFDRixFQUNEO2dCQUNFLFFBQVEsRUFBRSxJQUFJO2dCQUNkLEtBQUssRUFBRSxLQUFLO2dCQUNaLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FDRixDQUFDO1lBRUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQ2Isc0RBQXNELE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FDdkUsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2YsaURBQWlELEVBQ2pELEtBQUssQ0FDTixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUVHLEFBQU4sS0FBSyxDQUFDLCtCQUErQixDQUFDLE9BT3JDO1FBQ0MsSUFBSSxDQUFDO1lBQ0gsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLFFBQVEsRUFBRSxDQUFDO2dCQUNoQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQ2Y7b0JBQ0UsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO29CQUN0QixLQUFLLEVBQUUsY0FBYyxPQUFPLENBQUMsYUFBYSxHQUFHO29CQUM3QyxPQUFPLEVBQUUsOEJBQThCLE9BQU8sQ0FBQyxhQUFhLHNEQUFzRDtvQkFDbEgsSUFBSSxFQUFFLHlCQUFnQixDQUFDLGdCQUFnQjtvQkFDdkMsUUFBUSxFQUFFLDZCQUFvQixDQUFDLElBQUk7b0JBQ25DLFNBQVMsRUFBRSxnQkFBZ0IsT0FBTyxDQUFDLFdBQVcsRUFBRTtvQkFDaEQsSUFBSSxFQUFFO3dCQUNKLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVzt3QkFDaEMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhO3dCQUNwQyxrQkFBa0IsRUFBRSxPQUFPLENBQUMsa0JBQWtCO3dCQUM5QyxVQUFVLEVBQUUseUJBQXlCO3FCQUN0QztpQkFDRixFQUNEO29CQUNFLFFBQVEsRUFBRSxJQUFJO29CQUNkLEtBQUssRUFBRSxLQUFLO29CQUNaLElBQUksRUFBRSxJQUFJO2lCQUNYLENBQ0YsQ0FBQztnQkFFRixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYiw0Q0FBNEMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUM3RCxDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2Ysa0RBQWtELEVBQ2xELEtBQUssQ0FDTixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUVHLEFBQU4sS0FBSyxDQUFDLGtCQUFrQixDQUFDLE9BS3hCO1FBQ0MsSUFBSSxDQUFDO1lBQ0gsd0JBQXdCO1lBQ3hCLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO2dCQUN2RCxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRTtnQkFDbEMsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRTthQUNsRSxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsU0FBUztnQkFBRSxPQUFPO1lBRXZCLDhDQUE4QztZQUM5QyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQ2Y7Z0JBQ0UsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO2dCQUN0QixLQUFLLEVBQUUsY0FBYyxTQUFTLENBQUMsSUFBSSxHQUFHO2dCQUN0QyxPQUFPLEVBQUUsdUNBQXVDLFNBQVMsQ0FBQyxNQUFNLENBQUMsV0FBVywyQ0FBMkM7Z0JBQ3ZILElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxpQkFBaUI7Z0JBQ3hDLFFBQVEsRUFBRSw2QkFBb0IsQ0FBQyxJQUFJO2dCQUNuQyxTQUFTLEVBQUUsZ0JBQWdCLE9BQU8sQ0FBQyxXQUFXLEVBQUU7Z0JBQ2hELElBQUksRUFBRTtvQkFDSixXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVc7b0JBQ2hDLGFBQWEsRUFBRSxTQUFTLENBQUMsSUFBSTtvQkFDN0IsV0FBVyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsV0FBVztvQkFDekMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO2lCQUMvQjthQUNGLEVBQ0Q7Z0JBQ0UsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osSUFBSSxFQUFFLElBQUk7YUFDWCxDQUNGLENBQUM7WUFFRixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYiwrQ0FBK0MsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUNoRSxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNsRSxDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBRUcsQUFBTixLQUFLLENBQUMsOEJBQThCLENBQUMsT0FHcEM7UUFDQyxJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksQ0FBQyxNQUFNLENBQ2Y7Z0JBQ0UsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO2dCQUN0QixLQUFLLEVBQUUsbUNBQW1DO2dCQUMxQyxPQUFPLEVBQ0wsMkZBQTJGO2dCQUM3RixJQUFJLEVBQUUseUJBQWdCLENBQUMsdUJBQXVCO2dCQUM5QyxRQUFRLEVBQUUsNkJBQW9CLENBQUMsTUFBTTtnQkFDckMsU0FBUyxFQUFFLDhCQUE4QjtnQkFDekMsSUFBSSxFQUFFO29CQUNKLFdBQVcsRUFBRSxPQUFPLENBQUMsU0FBUztvQkFDOUIsTUFBTSxFQUFFLG1CQUFtQjtpQkFDNUI7YUFDRixFQUNEO2dCQUNFLFFBQVEsRUFBRSxJQUFJO2dCQUNkLEtBQUssRUFBRSxLQUFLO2dCQUNaLElBQUksRUFBRSxLQUFLO2FBQ1osQ0FDRixDQUFDO1lBRUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQ2IsdURBQXVELE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FDeEUsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2YsaURBQWlELEVBQ2pELEtBQUssQ0FDTixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFFRCwwREFBMEQ7SUFFMUQsS0FBSyxDQUFDLHlCQUF5QixDQUM3QixNQUFjLEVBQ2QsYUFBcUIsRUFDckIsZUFBcUIsRUFDckIsYUFBcUI7UUFFckIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU07WUFDTixLQUFLLEVBQUUsc0JBQXNCO1lBQzdCLE9BQU8sRUFBRSxnQ0FBZ0MsYUFBYSxhQUFhO1lBQ25FLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxvQkFBb0I7WUFDM0MsUUFBUSxFQUFFLDZCQUFvQixDQUFDLElBQUk7WUFDbkMsU0FBUyxFQUFFLGlCQUFpQixhQUFhLEVBQUU7WUFDM0MsSUFBSSxFQUFFLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRTtTQUN6QyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLHlCQUF5QixDQUM3QixNQUFjLEVBQ2QsUUFBZ0IsRUFDaEIsVUFBa0IsRUFDbEIsY0FBc0I7UUFFdEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU07WUFDTixLQUFLLEVBQUUsYUFBYTtZQUNwQixPQUFPLEVBQUUsK0JBQStCLFVBQVUsR0FBRztZQUNyRCxJQUFJLEVBQUUseUJBQWdCLENBQUMsZ0JBQWdCO1lBQ3ZDLFFBQVEsRUFBRSw2QkFBb0IsQ0FBQyxNQUFNO1lBQ3JDLFNBQVMsRUFBRSxhQUFhLGNBQWMsRUFBRTtZQUN4QyxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsY0FBYyxFQUFFO1NBQ25DLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsbUNBQW1DLENBQ3ZDLE1BQWMsRUFDZCxXQUFtQixFQUNuQixjQUFzQixFQUN0QixhQUFxQjtRQUVyQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDakIsTUFBTTtZQUNOLEtBQUssRUFBRSx3QkFBd0I7WUFDL0IsT0FBTyxFQUFFLEdBQUcsYUFBYSx1Q0FBdUMsY0FBYyxJQUFJO1lBQ2xGLElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxrQkFBa0I7WUFDekMsUUFBUSxFQUFFLDZCQUFvQixDQUFDLE1BQU07WUFDckMsU0FBUyxFQUFFLGVBQWUsV0FBVyxFQUFFO1lBQ3ZDLElBQUksRUFBRSxFQUFFLFdBQVcsRUFBRTtTQUN0QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLHNDQUFzQyxDQUMxQyxNQUFjLEVBQ2QsTUFBK0I7UUFFL0IsTUFBTSxLQUFLLEdBQ1QsTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO1FBQ3hFLE1BQU0sT0FBTyxHQUNYLE1BQU0sS0FBSyxVQUFVO1lBQ25CLENBQUMsQ0FBQyxnRUFBZ0U7WUFDbEUsQ0FBQyxDQUFDLHFGQUFxRixDQUFDO1FBRTVGLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNqQixNQUFNO1lBQ04sS0FBSztZQUNMLE9BQU87WUFDUCxJQUFJLEVBQ0YsTUFBTSxLQUFLLFVBQVU7Z0JBQ25CLENBQUMsQ0FBQyx5QkFBZ0IsQ0FBQyxrQkFBa0I7Z0JBQ3JDLENBQUMsQ0FBQyx5QkFBZ0IsQ0FBQyxrQkFBa0I7WUFDekMsUUFBUSxFQUFFLDZCQUFvQixDQUFDLElBQUk7WUFDbkMsU0FBUyxFQUFFLHdCQUF3QjtZQUNuQyxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUU7U0FDakIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQywrQkFBK0IsQ0FDbkMsTUFBYyxFQUNkLFdBQW1CLEVBQ25CLGFBQXFCLEVBQ3JCLFNBQWlCO1FBRWpCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNqQixNQUFNO1lBQ04sS0FBSyxFQUFFLGdCQUFnQjtZQUN2QixPQUFPLEVBQUUsK0NBQStDLGFBQWEsR0FBRztZQUN4RSxJQUFJLEVBQUUseUJBQWdCLENBQUMsY0FBYztZQUNyQyxRQUFRLEVBQUUsNkJBQW9CLENBQUMsTUFBTTtZQUNyQyxTQUFTLEVBQUUsZUFBZSxXQUFXLG1CQUFtQixTQUFTLEVBQUU7WUFDbkUsSUFBSSxFQUFFLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRTtTQUNqQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLCtCQUErQixDQUNuQyxNQUFjLEVBQ2QsTUFBYyxFQUNkLGFBQXFCLEVBQ3JCLFVBQWtCO1FBRWxCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNqQixNQUFNO1lBQ04sS0FBSyxFQUFFLG9CQUFvQjtZQUMzQixPQUFPLEVBQUUsR0FBRyxVQUFVLGNBQWMsYUFBYSxHQUFHO1lBQ3BELElBQUksRUFBRSx5QkFBZ0IsQ0FBQyxjQUFjO1lBQ3JDLFFBQVEsRUFBRSw2QkFBb0IsQ0FBQyxHQUFHO1lBQ2xDLFNBQVMsRUFBRSxzQkFBc0IsTUFBTSxFQUFFO1lBQ3pDLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUU7U0FDaEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHNEQUFzRDtJQUV0RCxLQUFLLENBQUMsK0JBQStCLENBQ25DLFdBQW1CLEVBQ25CLFFBQWdCLEVBQ2hCLFVBQWtCLEVBQ2xCLGNBQXVCLEVBQ3ZCLFdBQWlELFFBQVE7UUFFekQsTUFBTSxvQkFBb0IsR0FDeEIsUUFBUSxLQUFLLE1BQU0sSUFBSSxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUVuRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDakIsTUFBTSxFQUFFLFdBQVc7WUFDbkIsS0FBSyxFQUFFLHNCQUFzQixRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUN0RSxPQUFPLEVBQUUsR0FBRyxVQUFVLG1DQUFtQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEtBQUssY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsY0FBYyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNwSyxJQUFJLEVBQUUseUJBQXlCO1lBQy9CLFFBQVEsRUFBRSxvQkFBb0I7WUFDOUIsU0FBUyxFQUFFLHFCQUFxQjtZQUNoQyxJQUFJLEVBQUU7Z0JBQ0osUUFBUTtnQkFDUixVQUFVO2dCQUNWLFdBQVcsRUFBRSxpQkFBaUI7Z0JBQzlCLFFBQVE7Z0JBQ1IsVUFBVSxFQUFFLENBQUMsQ0FBQyxjQUFjO2FBQzdCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxpQ0FBaUMsQ0FDckMsUUFBZ0IsRUFDaEIsV0FBbUIsRUFDbkIsYUFBcUIsRUFDckIsZUFBd0IsRUFDeEIsY0FBdUI7UUFFdkIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU0sRUFBRSxRQUFRO1lBQ2hCLEtBQUssRUFBRSxnQ0FBZ0M7WUFDdkMsT0FBTyxFQUFFLGVBQWUsYUFBYSxzQ0FBc0MsZUFBZSxDQUFDLENBQUMsQ0FBQyxLQUFLLGVBQWUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDM0gsSUFBSSxFQUFFLDRCQUE0QjtZQUNsQyxRQUFRLEVBQUUsTUFBTTtZQUNoQixTQUFTLEVBQUUsc0JBQXNCLFdBQVcsRUFBRTtZQUM5QyxJQUFJLEVBQUU7Z0JBQ0osV0FBVztnQkFDWCxhQUFhO2dCQUNiLGVBQWU7Z0JBQ2YsY0FBYztnQkFDZCxRQUFRLEVBQUUsa0JBQWtCO2FBQzdCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxpQ0FBaUMsQ0FDckMsUUFBZ0IsRUFDaEIsV0FBbUIsRUFDbkIsYUFBcUIsRUFDckIsZUFBd0I7UUFFeEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU0sRUFBRSxRQUFRO1lBQ2hCLEtBQUssRUFBRSwwQkFBMEI7WUFDakMsT0FBTyxFQUFFLEdBQUcsYUFBYSwwQ0FBMEMsZUFBZSxDQUFDLENBQUMsQ0FBQyxLQUFLLGVBQWUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLDBEQUEwRDtZQUMzSyxJQUFJLEVBQUUsNEJBQTRCO1lBQ2xDLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFNBQVMsRUFBRSwyQkFBMkI7WUFDdEMsSUFBSSxFQUFFO2dCQUNKLFdBQVc7Z0JBQ1gsYUFBYTtnQkFDYixlQUFlO2dCQUNmLFFBQVEsRUFBRSxxQkFBcUI7YUFDaEM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLGtDQUFrQyxDQUN0QyxXQUFtQixFQUNuQixVQUFrQixFQUNsQixNQUFlO1FBRWYsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU0sRUFBRSxXQUFXO1lBQ25CLEtBQUssRUFBRSwwQkFBMEI7WUFDakMsT0FBTyxFQUFFLEdBQUcsVUFBVSx3Q0FBd0MsTUFBTSxDQUFDLENBQUMsQ0FBQyxZQUFZLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDbEcsSUFBSSxFQUFFLDBCQUEwQjtZQUNoQyxRQUFRLEVBQUUsUUFBUTtZQUNsQixTQUFTLEVBQUUscUJBQXFCO1lBQ2hDLElBQUksRUFBRTtnQkFDSixVQUFVO2dCQUNWLE1BQU07Z0JBQ04sVUFBVSxFQUFFLGNBQWM7YUFDM0I7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLHdDQUF3QyxDQUM1QyxXQUFtQixFQUNuQixlQUF3QjtRQUV4QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDakIsTUFBTSxFQUFFLFdBQVc7WUFDbkIsS0FBSyxFQUFFLDZDQUE2QztZQUNwRCxPQUFPLEVBQUUsOEdBQThHLGVBQWUsQ0FBQyxDQUFDLENBQUMsNEJBQTRCLGVBQWUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDOUwsSUFBSSxFQUFFLG9CQUFvQjtZQUMxQixRQUFRLEVBQUUsTUFBTTtZQUNoQixTQUFTLEVBQUUsc0JBQXNCO1lBQ2pDLElBQUksRUFBRTtnQkFDSixlQUFlO2dCQUNmLFNBQVMsRUFBRTtvQkFDVCxrQkFBa0I7b0JBQ2xCLGtCQUFrQjtvQkFDbEIsbUJBQW1CO2lCQUNwQjtnQkFDRCxXQUFXLEVBQUUsSUFBSTthQUNsQjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMseUNBQXlDLENBQzdDLFdBQW1CLEVBQ25CLGVBQXVCLEVBQ3ZCLGdCQUF3QixFQUN4QixrQkFBMkI7UUFFM0IsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU0sRUFBRSxXQUFXO1lBQ25CLEtBQUssRUFBRSwyQkFBMkI7WUFDbEMsT0FBTyxFQUFFLGlEQUFpRCxnQkFBZ0IsRUFBRTtZQUM1RSxJQUFJLEVBQUUsb0JBQW9CO1lBQzFCLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFNBQVMsRUFBRSxrQkFBa0I7Z0JBQzNCLENBQUMsQ0FBQyxvQkFBb0I7Z0JBQ3RCLENBQUMsQ0FBQywrQkFBK0I7WUFDbkMsSUFBSSxFQUFFO2dCQUNKLGVBQWU7Z0JBQ2YsZ0JBQWdCO2dCQUNoQixrQkFBa0I7Z0JBQ2xCLFFBQVEsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxpQkFBaUI7YUFDN0Q7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLG9DQUFvQyxDQUN4QyxRQUFnQixFQUNoQixjQUFzQixFQUN0QixlQUc4QixnQkFBZ0I7UUFFOUMsTUFBTSxjQUFjLEdBQUc7WUFDckIsY0FBYyxFQUFFLG1DQUFtQztZQUNuRCxjQUFjLEVBQUUsZ0NBQWdDO1lBQ2hELHFCQUFxQixFQUFFLHdCQUF3QjtTQUNoRCxDQUFDO1FBRUYsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU0sRUFBRSxRQUFRO1lBQ2hCLEtBQUssRUFBRSx5Q0FBeUM7WUFDaEQsT0FBTyxFQUFFLGVBQWUsY0FBYyxrQ0FBa0MsY0FBYyxDQUFDLFlBQVksQ0FBQyxtQkFBbUI7WUFDdkgsSUFBSSxFQUFFLHFCQUFxQjtZQUMzQixRQUFRLEVBQUUsUUFBUTtZQUNsQixTQUFTLEVBQUUsb0NBQW9DO1lBQy9DLElBQUksRUFBRTtnQkFDSixjQUFjO2dCQUNkLFlBQVk7Z0JBQ1osa0JBQWtCLEVBQUUsaUJBQWlCO2FBQ3RDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxzQ0FBc0MsQ0FDMUMsTUFBYyxFQUNkLFVBQXVFLEVBQ3ZFLGFBQXFCO1FBRXJCLE1BQU0sTUFBTSxHQUFHO1lBQ2IscUJBQXFCLEVBQUUsMkJBQTJCO1lBQ2xELGVBQWUsRUFBRSx1QkFBdUI7WUFDeEMsV0FBVyxFQUFFLHdCQUF3QjtTQUN0QyxDQUFDO1FBRUYsTUFBTSxVQUFVLEdBQUc7WUFDakIscUJBQXFCLEVBQUUsUUFBUTtZQUMvQixlQUFlLEVBQUUsUUFBUTtZQUN6QixXQUFXLEVBQUUsS0FBSztTQUNWLENBQUM7UUFFWCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDakIsTUFBTTtZQUNOLEtBQUssRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDO1lBQ3pCLE9BQU8sRUFBRSxhQUFhO1lBQ3RCLElBQUksRUFBRSxlQUFlO1lBQ3JCLFFBQVEsRUFBRSxVQUFVLENBQUMsVUFBVSxDQUFDO1lBQ2hDLFNBQVMsRUFBRSxZQUFZO1lBQ3ZCLElBQUksRUFBRTtnQkFDSixVQUFVO2dCQUNWLFlBQVksRUFBRSxJQUFJO2FBQ25CO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyx5Q0FBeUMsQ0FDN0MsUUFBZ0IsRUFDaEIsV0FBbUIsRUFDbkIsYUFBcUI7UUFFckIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU0sRUFBRSxRQUFRO1lBQ2hCLEtBQUssRUFBRSxxQ0FBcUM7WUFDNUMsT0FBTyxFQUFFLDZCQUE2QixhQUFhLDJHQUEyRztZQUM5SixJQUFJLEVBQUUsMEJBQTBCO1lBQ2hDLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFNBQVMsRUFBRSxzQkFBc0IsV0FBVyxXQUFXO1lBQ3ZELElBQUksRUFBRTtnQkFDSixXQUFXO2dCQUNYLGFBQWE7Z0JBQ2Isa0JBQWtCLEVBQUUsUUFBUTtnQkFDNUIsUUFBUSxFQUFFLHdCQUF3QjthQUNuQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsMENBQTBDLENBQzlDLFdBQW1CLEVBQ25CLG1CQUEyQjtRQUUzQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDakIsTUFBTSxFQUFFLFdBQVc7WUFDbkIsS0FBSyxFQUFFLEdBQUcsbUJBQW1CLDBCQUEwQixtQkFBbUIsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQzNGLE9BQU8sRUFBRSxZQUFZLG1CQUFtQixrQkFBa0IsbUJBQW1CLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsa0VBQWtFO1lBQzlKLElBQUksRUFBRSxrQkFBa0I7WUFDeEIsUUFBUSxFQUFFLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxRQUFRO1lBQ3JELFNBQVMsRUFBRSw2QkFBNkI7WUFDeEMsSUFBSSxFQUFFO2dCQUNKLG1CQUFtQjtnQkFDbkIsWUFBWSxFQUFFLGtCQUFrQjtnQkFDaEMsT0FBTyxFQUFFLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxRQUFRO2FBQ3JEO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQywyQ0FBMkMsQ0FDL0MsTUFBYyxFQUNkLFFBQWdDLEVBQ2hDLGFBQXVCO1FBRXZCLE1BQU0sVUFBVSxHQUFHO1lBQ2pCLE1BQU0sRUFBRSxpQkFBaUI7WUFDekIsU0FBUyxFQUFFLG9CQUFvQjtTQUNoQyxDQUFDO1FBRUYsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2pCLE1BQU07WUFDTixLQUFLLEVBQUUsMENBQTBDO1lBQ2pELE9BQU8sRUFBRSwyRUFBMkUsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNsSyxJQUFJLEVBQUUsb0JBQW9CO1lBQzFCLFFBQVEsRUFBRSxLQUFLO1lBQ2YsU0FBUyxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUM7WUFDL0IsSUFBSSxFQUFFO2dCQUNKLGFBQWE7Z0JBQ2IsUUFBUTtnQkFDUixtQkFBbUIsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsYUFBYSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7YUFDbEU7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLDBCQUEwQjtRQUM5QixNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBRXZCLE1BQU0sc0JBQXNCLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7WUFDckUsS0FBSyxFQUFFO2dCQUNMLFlBQVksRUFBRTtvQkFDWixHQUFHLEVBQUUsR0FBRztpQkFDVDtnQkFDRCxNQUFNLEVBQUUsSUFBSTthQUNiO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsS0FBSyxNQUFNLFlBQVksSUFBSSxzQkFBc0IsRUFBRSxDQUFDO1lBQ2xELDREQUE0RDtZQUM1RCwwQ0FBMEM7WUFFMUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7Z0JBQ3BDLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxZQUFZLENBQUMsRUFBRSxFQUFFO2dCQUM5QixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFO2FBQ3RCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxPQUFPLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2pELENBQUM7Q0FDRixDQUFBO0FBajdCWSxvREFBb0I7QUE4V3pCO0lBREwsSUFBQSx1QkFBTyxFQUFDLHFDQUFxQyxDQUFDOzs7OzBFQW9DOUM7QUFNSztJQURMLElBQUEsdUJBQU8sRUFBQyxzQ0FBc0MsQ0FBQzs7OzsyRUEyQy9DO0FBTUs7SUFETCxJQUFBLHVCQUFPLEVBQUMseUJBQXlCLENBQUM7Ozs7OERBNkNsQztBQU1LO0lBREwsSUFBQSx1QkFBTyxFQUFDLHFDQUFxQyxDQUFDOzs7OzBFQW9DOUM7K0JBNWhCVSxvQkFBb0I7SUFEaEMsSUFBQSxtQkFBVSxHQUFFO3lEQU1nQixzQ0FBYSxvQkFBYixzQ0FBYSxvREFDUCw2QkFBYSxvQkFBYiw2QkFBYTtHQU5uQyxvQkFBb0IsQ0FpN0JoQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbm90aWZpY2F0aW9ucy9ub3RpZmljYXRpb25zLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSW5qZWN0YWJsZSxcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIExvZ2dlcixcbiAgT25Nb2R1bGVJbml0LFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnc3JjL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlcjIsIE9uRXZlbnQgfSBmcm9tICdAbmVzdGpzL2V2ZW50LWVtaXR0ZXInO1xuaW1wb3J0IHsgU2VydmVyIH0gZnJvbSAnc29ja2V0LmlvJztcbmltcG9ydCB7XG4gIE5vdGlmaWNhdGlvbixcbiAgTm90aWZpY2F0aW9uVHlwZSxcbiAgTm90aWZpY2F0aW9uUHJpb3JpdHksXG59IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuaW50ZXJmYWNlIFdlYlNvY2tldFNlcnZlciB7XG4gIHRvKHJvb206IHN0cmluZyk6IHtcbiAgICBlbWl0KGV2ZW50OiBzdHJpbmcsIGRhdGE6IGFueSk6IHZvaWQ7XG4gIH07XG59XG5cbmludGVyZmFjZSBOb3RpZmljYXRpb25EZWxpdmVyeU9wdGlvbnMge1xuICByZWFsVGltZT86IGJvb2xlYW47XG4gIGVtYWlsPzogYm9vbGVhbjtcbiAgcHVzaD86IGJvb2xlYW47XG4gIHNjaGVkdWxlZD86IGJvb2xlYW47XG4gIHByaW9yaXR5PzogTm90aWZpY2F0aW9uUHJpb3JpdHk7XG59XG5cbmludGVyZmFjZSBOb3RpZmljYXRpb25UZW1wbGF0ZSB7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgdHlwZTogTm90aWZpY2F0aW9uVHlwZTtcbiAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5O1xuICBhY3Rpb25Vcmw/OiBzdHJpbmc7XG4gIGRhdGE/OiBhbnk7XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25zU2VydmljZSBpbXBsZW1lbnRzIE9uTW9kdWxlSW5pdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihOb3RpZmljYXRpb25zU2VydmljZS5uYW1lKTtcbiAgcHJpdmF0ZSB3ZWJTb2NrZXRTZXJ2ZXI6IFdlYlNvY2tldFNlcnZlciB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJpc21hOiBQcmlzbWFTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZXZlbnRFbWl0dGVyOiBFdmVudEVtaXR0ZXIyLFxuICApIHt9XG5cbiAgb25Nb2R1bGVJbml0KCkge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICdOb3RpZmljYXRpb25zU2VydmljZSBpbml0aWFsaXplZCB3aXRoIHJlYWwtdGltZSBjYXBhYmlsaXRpZXMnLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IFdlYlNvY2tldCBzZXJ2ZXIgaW5zdGFuY2UgZm9yIHJlYWwtdGltZSBub3RpZmljYXRpb25zXG4gICAqL1xuICBzZXRXZWJTb2NrZXRTZXJ2ZXIoc2VydmVyOiBXZWJTb2NrZXRTZXJ2ZXIpIHtcbiAgICB0aGlzLndlYlNvY2tldFNlcnZlciA9IHNlcnZlcjtcbiAgICB0aGlzLmxvZ2dlci5sb2coJ1dlYlNvY2tldCBzZXJ2ZXIgY29uZmlndXJlZCBmb3IgcmVhbC10aW1lIG5vdGlmaWNhdGlvbnMnKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZShcbiAgICBkYXRhOiB7XG4gICAgICB1c2VySWQ6IHN0cmluZztcbiAgICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlO1xuICAgICAgcHJpb3JpdHk/OiBOb3RpZmljYXRpb25Qcmlvcml0eTtcbiAgICAgIGRhdGE/OiBhbnk7XG4gICAgICBhY3Rpb25Vcmw/OiBzdHJpbmc7XG4gICAgICBzY2hlZHVsZWRGb3I/OiBEYXRlO1xuICAgIH0sXG4gICAgZGVsaXZlcnlPcHRpb25zPzogTm90aWZpY2F0aW9uRGVsaXZlcnlPcHRpb25zLFxuICApOiBQcm9taXNlPE5vdGlmaWNhdGlvbj4ge1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IHRoaXMucHJpc21hLm5vdGlmaWNhdGlvbi5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICAuLi5kYXRhLFxuICAgICAgICBwcmlvcml0eTogZGF0YS5wcmlvcml0eSB8fCBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBEZWZhdWx0IGRlbGl2ZXJ5IG9wdGlvbnNcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgcmVhbFRpbWU6IHRydWUsXG4gICAgICBlbWFpbDogZmFsc2UsXG4gICAgICBwdXNoOiBmYWxzZSxcbiAgICAgIHNjaGVkdWxlZDogZmFsc2UsXG4gICAgICAuLi5kZWxpdmVyeU9wdGlvbnMsXG4gICAgfTtcblxuICAgIC8vIERlbGl2ZXIgbm90aWZpY2F0aW9uIGltbWVkaWF0ZWx5IGlmIG5vdCBzY2hlZHVsZWRcbiAgICBpZiAoIWRhdGEuc2NoZWR1bGVkRm9yKSB7XG4gICAgICBhd2FpdCB0aGlzLmRlbGl2ZXJOb3RpZmljYXRpb24obm90aWZpY2F0aW9uLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm90aWZpY2F0aW9uO1xuICB9XG5cbiAgYXN5bmMgZmluZEFsbChcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBpc1JlYWQ/OiBib29sZWFuLFxuICAgIHR5cGU/OiBOb3RpZmljYXRpb25UeXBlLFxuICAgIHByaW9yaXR5PzogTm90aWZpY2F0aW9uUHJpb3JpdHksXG4gICk6IFByb21pc2U8Tm90aWZpY2F0aW9uW10+IHtcbiAgICBjb25zdCB3aGVyZTogYW55ID0geyB1c2VySWQgfTtcblxuICAgIGlmIChpc1JlYWQgIT09IHVuZGVmaW5lZCkgd2hlcmUuaXNSZWFkID0gaXNSZWFkO1xuICAgIGlmICh0eXBlKSB3aGVyZS50eXBlID0gdHlwZTtcbiAgICBpZiAocHJpb3JpdHkpIHdoZXJlLnByaW9yaXR5ID0gcHJpb3JpdHk7XG5cbiAgICByZXR1cm4gdGhpcy5wcmlzbWEubm90aWZpY2F0aW9uLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlLFxuICAgICAgb3JkZXJCeTogW3sgcHJpb3JpdHk6ICdkZXNjJyB9LCB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1dLFxuICAgICAgdGFrZTogNTAsIC8vIExpbWl0IHRvIHJlY2VudCBub3RpZmljYXRpb25zXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBmaW5kT25lKGlkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGlmaWNhdGlvbiB8IG51bGw+IHtcbiAgICByZXR1cm4gdGhpcy5wcmlzbWEubm90aWZpY2F0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgbWFya0FzUmVhZChpZDogc3RyaW5nKTogUHJvbWlzZTxOb3RpZmljYXRpb24+IHtcbiAgICBjb25zdCBub3RpZmljYXRpb24gPSBhd2FpdCB0aGlzLmZpbmRPbmUoaWQpO1xuICAgIGlmICghbm90aWZpY2F0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oYE5vdGlmaWNhdGlvbiB3aXRoIElEICR7aWR9IG5vdCBmb3VuZGApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnByaXNtYS5ub3RpZmljYXRpb24udXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlzUmVhZDogdHJ1ZSxcbiAgICAgICAgcmVhZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIG1hcmtBbGxBc1JlYWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHsgY291bnQ6IG51bWJlciB9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcmlzbWEubm90aWZpY2F0aW9uLnVwZGF0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaXNSZWFkOiB0cnVlLFxuICAgICAgICByZWFkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgY291bnQ6IHJlc3VsdC5jb3VudCB9O1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGlmaWNhdGlvbj4ge1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IHRoaXMuZmluZE9uZShpZCk7XG4gICAgaWYgKCFub3RpZmljYXRpb24pIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihgTm90aWZpY2F0aW9uIHdpdGggSUQgJHtpZH0gbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucHJpc21hLm5vdGlmaWNhdGlvbi5kZWxldGUoe1xuICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdldFVucmVhZENvdW50KHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5wcmlzbWEubm90aWZpY2F0aW9uLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgaXNSZWFkOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXROb3RpZmljYXRpb25TZXR0aW5ncyh1c2VySWQ6IHN0cmluZykge1xuICAgIGxldCBzZXR0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm5vdGlmaWNhdGlvblNldHRpbmdzLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXNldHRpbmdzKSB7XG4gICAgICAvLyBDcmVhdGUgZGVmYXVsdCBzZXR0aW5nc1xuICAgICAgc2V0dGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5ub3RpZmljYXRpb25TZXR0aW5ncy5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7IHVzZXJJZCB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNldHRpbmdzO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgZGF0YToge1xuICAgICAgZW1haWxBcHBvaW50bWVudFJlbWluZGVycz86IGJvb2xlYW47XG4gICAgICBlbWFpbE5ld01lc3NhZ2VzPzogYm9vbGVhbjtcbiAgICAgIGVtYWlsV29ya3NoZWV0VXBkYXRlcz86IGJvb2xlYW47XG4gICAgICBlbWFpbFN5c3RlbVVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgZW1haWxNYXJrZXRpbmc/OiBib29sZWFuO1xuICAgICAgcHVzaEFwcG9pbnRtZW50UmVtaW5kZXJzPzogYm9vbGVhbjtcbiAgICAgIHB1c2hOZXdNZXNzYWdlcz86IGJvb2xlYW47XG4gICAgICBwdXNoV29ya3NoZWV0VXBkYXRlcz86IGJvb2xlYW47XG4gICAgICBwdXNoU3lzdGVtVXBkYXRlcz86IGJvb2xlYW47XG4gICAgICBpbkFwcE1lc3NhZ2VzPzogYm9vbGVhbjtcbiAgICAgIGluQXBwVXBkYXRlcz86IGJvb2xlYW47XG4gICAgICBxdWlldEhvdXJzRW5hYmxlZD86IGJvb2xlYW47XG4gICAgICBxdWlldEhvdXJzU3RhcnQ/OiBzdHJpbmc7XG4gICAgICBxdWlldEhvdXJzRW5kPzogc3RyaW5nO1xuICAgICAgcXVpZXRIb3Vyc1RpbWV6b25lPzogc3RyaW5nO1xuICAgIH0sXG4gICkge1xuICAgIHJldHVybiB0aGlzLnByaXNtYS5ub3RpZmljYXRpb25TZXR0aW5ncy51cHNlcnQoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICB1cGRhdGU6IGRhdGEsXG4gICAgICBjcmVhdGU6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICAuLi5kYXRhLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxpdmVyIG5vdGlmaWNhdGlvbiB0aHJvdWdoIGNvbmZpZ3VyZWQgY2hhbm5lbHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZGVsaXZlck5vdGlmaWNhdGlvbihcbiAgICBub3RpZmljYXRpb246IE5vdGlmaWNhdGlvbiAmIHsgdXNlcjogYW55IH0sXG4gICAgb3B0aW9uczogTm90aWZpY2F0aW9uRGVsaXZlcnlPcHRpb25zLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVhbC10aW1lIFdlYlNvY2tldCBkZWxpdmVyeVxuICAgICAgaWYgKG9wdGlvbnMucmVhbFRpbWUgJiYgdGhpcy53ZWJTb2NrZXRTZXJ2ZXIpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWxpdmVyUmVhbFRpbWVOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcbiAgICAgIH1cblxuICAgICAgLy8gRW1haWwgZGVsaXZlcnkgKGlmIGNvbmZpZ3VyZWQpXG4gICAgICBpZiAob3B0aW9ucy5lbWFpbCkge1xuICAgICAgICBhd2FpdCB0aGlzLmRlbGl2ZXJFbWFpbE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pO1xuICAgICAgfVxuXG4gICAgICAvLyBQdXNoIG5vdGlmaWNhdGlvbiBkZWxpdmVyeSAoaWYgY29uZmlndXJlZClcbiAgICAgIGlmIChvcHRpb25zLnB1c2gpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWxpdmVyUHVzaE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm9yIGRlbGl2ZXJpbmcgbm90aWZpY2F0aW9uICR7bm90aWZpY2F0aW9uLmlkfTpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlbGl2ZXIgcmVhbC10aW1lIG5vdGlmaWNhdGlvbiB2aWEgV2ViU29ja2V0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGRlbGl2ZXJSZWFsVGltZU5vdGlmaWNhdGlvbihcbiAgICBub3RpZmljYXRpb246IE5vdGlmaWNhdGlvbiAmIHsgdXNlcjogYW55IH0sXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy53ZWJTb2NrZXRTZXJ2ZXIpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICdXZWJTb2NrZXQgc2VydmVyIG5vdCBjb25maWd1cmVkIGZvciByZWFsLXRpbWUgbm90aWZpY2F0aW9ucycsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBTZW5kIHRvIHVzZXIncyBwZXJzb25hbCByb29tXG4gICAgICB0aGlzLndlYlNvY2tldFNlcnZlclxuICAgICAgICAudG8oYHVzZXI6JHtub3RpZmljYXRpb24udXNlcklkfWApXG4gICAgICAgIC5lbWl0KCdub3RpZmljYXRpb24nLCB7XG4gICAgICAgICAgaWQ6IG5vdGlmaWNhdGlvbi5pZCxcbiAgICAgICAgICB0aXRsZTogbm90aWZpY2F0aW9uLnRpdGxlLFxuICAgICAgICAgIG1lc3NhZ2U6IG5vdGlmaWNhdGlvbi5tZXNzYWdlLFxuICAgICAgICAgIHR5cGU6IG5vdGlmaWNhdGlvbi50eXBlLFxuICAgICAgICAgIHByaW9yaXR5OiBub3RpZmljYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgYWN0aW9uVXJsOiBub3RpZmljYXRpb24uYWN0aW9uVXJsLFxuICAgICAgICAgIGRhdGE6IG5vdGlmaWNhdGlvbi5kYXRhLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbm90aWZpY2F0aW9uLmNyZWF0ZWRBdCxcbiAgICAgICAgICBpc1JlYWQ6IGZhbHNlLFxuICAgICAgICB9KTtcblxuICAgICAgLy8gU2VuZCB1bnJlYWQgY291bnQgdXBkYXRlXG4gICAgICBjb25zdCB1bnJlYWRDb3VudCA9IGF3YWl0IHRoaXMuZ2V0VW5yZWFkQ291bnQobm90aWZpY2F0aW9uLnVzZXJJZCk7XG4gICAgICB0aGlzLndlYlNvY2tldFNlcnZlclxuICAgICAgICAudG8oYHVzZXI6JHtub3RpZmljYXRpb24udXNlcklkfWApXG4gICAgICAgIC5lbWl0KCd1bnJlYWRDb3VudCcsIHtcbiAgICAgICAgICBjb3VudDogdW5yZWFkQ291bnQsXG4gICAgICAgIH0pO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBSZWFsLXRpbWUgbm90aWZpY2F0aW9uIGRlbGl2ZXJlZCB0byB1c2VyICR7bm90aWZpY2F0aW9uLnVzZXJJZH1gLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGRlbGl2ZXJpbmcgcmVhbC10aW1lIG5vdGlmaWNhdGlvbjpgLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlbGl2ZXIgZW1haWwgbm90aWZpY2F0aW9uIChwbGFjZWhvbGRlciBmb3IgZW1haWwgc2VydmljZSBpbnRlZ3JhdGlvbilcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZGVsaXZlckVtYWlsTm90aWZpY2F0aW9uKFxuICAgIG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uICYgeyB1c2VyOiBhbnkgfSxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gVE9ETzogSW50ZWdyYXRlIHdpdGggZW1haWwgc2VydmljZSAoU2VuZEdyaWQsIEFXUyBTRVMsIGV0Yy4pXG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYEVtYWlsIG5vdGlmaWNhdGlvbiBxdWV1ZWQgZm9yIHVzZXIgJHtub3RpZmljYXRpb24udXNlcklkfWAsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxpdmVyIHB1c2ggbm90aWZpY2F0aW9uIChwbGFjZWhvbGRlciBmb3IgcHVzaCBzZXJ2aWNlIGludGVncmF0aW9uKVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBkZWxpdmVyUHVzaE5vdGlmaWNhdGlvbihcbiAgICBub3RpZmljYXRpb246IE5vdGlmaWNhdGlvbiAmIHsgdXNlcjogYW55IH0sXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFRPRE86IEludGVncmF0ZSB3aXRoIHB1c2ggbm90aWZpY2F0aW9uIHNlcnZpY2UgKEZDTSwgQVBOUywgZXRjLilcbiAgICB0aGlzLmxvZ2dlci5sb2coYFB1c2ggbm90aWZpY2F0aW9uIHF1ZXVlZCBmb3IgdXNlciAke25vdGlmaWNhdGlvbi51c2VySWR9YCk7XG4gIH1cblxuICAvKipcbiAgICogQmF0Y2ggY3JlYXRlIG5vdGlmaWNhdGlvbnMgd2l0aCBvcHRpbWl6ZWQgZGVsaXZlcnlcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUJhdGNoKFxuICAgIG5vdGlmaWNhdGlvbnM6IEFycmF5PHtcbiAgICAgIHVzZXJJZDogc3RyaW5nO1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGU7XG4gICAgICBwcmlvcml0eT86IE5vdGlmaWNhdGlvblByaW9yaXR5O1xuICAgICAgZGF0YT86IGFueTtcbiAgICAgIGFjdGlvblVybD86IHN0cmluZztcbiAgICAgIHNjaGVkdWxlZEZvcj86IERhdGU7XG4gICAgfT4sXG4gICAgZGVsaXZlcnlPcHRpb25zPzogTm90aWZpY2F0aW9uRGVsaXZlcnlPcHRpb25zLFxuICApOiBQcm9taXNlPE5vdGlmaWNhdGlvbltdPiB7XG4gICAgY29uc3QgY3JlYXRlZE5vdGlmaWNhdGlvbnM6IE5vdGlmaWNhdGlvbltdID0gW107XG5cbiAgICAvLyBDcmVhdGUgbm90aWZpY2F0aW9ucyBpbiBiYXRjaGVzIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgICBmb3IgKGNvbnN0IG5vdGlmaWNhdGlvbkRhdGEgb2Ygbm90aWZpY2F0aW9ucykge1xuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYXdhaXQgdGhpcy5jcmVhdGUobm90aWZpY2F0aW9uRGF0YSwgZGVsaXZlcnlPcHRpb25zKTtcbiAgICAgIGNyZWF0ZWROb3RpZmljYXRpb25zLnB1c2gobm90aWZpY2F0aW9uKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3JlYXRlZE5vdGlmaWNhdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBub3RpZmljYXRpb24gdG8gYWxsIHVzZXJzIGluIGEgY29tbXVuaXR5XG4gICAqL1xuICBhc3luYyBzZW5kVG9Db21tdW5pdHkoXG4gICAgY29tbXVuaXR5SWQ6IHN0cmluZyxcbiAgICBub3RpZmljYXRpb246IE9taXQ8UGFyYW1ldGVyczx0eXBlb2YgdGhpcy5jcmVhdGU+WzBdLCAndXNlcklkJz4sXG4gICAgZGVsaXZlcnlPcHRpb25zPzogTm90aWZpY2F0aW9uRGVsaXZlcnlPcHRpb25zLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGFsbCBjb21tdW5pdHkgbWVtYmVyc1xuICAgICAgY29uc3QgbWVtYmVycyA9IGF3YWl0IHRoaXMucHJpc21hLm1lbWJlcnNoaXAuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogeyBjb21tdW5pdHlJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gQ3JlYXRlIG5vdGlmaWNhdGlvbnMgZm9yIGFsbCBtZW1iZXJzIChmaWx0ZXIgb3V0IG51bGwgdXNlcklkcylcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbnMgPSBtZW1iZXJzXG4gICAgICAgIC5maWx0ZXIoKG1lbWJlcikgPT4gbWVtYmVyLnVzZXJJZCAhPT0gbnVsbClcbiAgICAgICAgLm1hcCgobWVtYmVyKSA9PiAoe1xuICAgICAgICAgIC4uLm5vdGlmaWNhdGlvbixcbiAgICAgICAgICB1c2VySWQ6IG1lbWJlci51c2VySWQhLFxuICAgICAgICB9KSk7XG5cbiAgICAgIGF3YWl0IHRoaXMuY3JlYXRlQmF0Y2gobm90aWZpY2F0aW9ucywgZGVsaXZlcnlPcHRpb25zKTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgU2VudCBub3RpZmljYXRpb25zIHRvICR7bWVtYmVycy5sZW5ndGh9IGNvbW11bml0eSBtZW1iZXJzYCxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJyb3Igc2VuZGluZyBub3RpZmljYXRpb25zIHRvIGNvbW11bml0eSAke2NvbW11bml0eUlkfTpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT0gRVZFTlQgTElTVEVORVJTIEZPUiBDT01NVU5JVFkgUkVDT01NRU5EQVRJT04gU1lTVEVNID09PT09XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBjb21tdW5pdHkgcmVjb21tZW5kYXRpb24gZ2VuZXJhdGVkIGV2ZW50c1xuICAgKi9cbiAgQE9uRXZlbnQoJ2NvbW11bml0eS5yZWNvbW1lbmRhdGlvbnMuZ2VuZXJhdGVkJylcbiAgYXN5bmMgaGFuZGxlUmVjb21tZW5kYXRpb25zR2VuZXJhdGVkKHBheWxvYWQ6IHtcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICByZWNvbW1lbmRhdGlvbkNvdW50OiBudW1iZXI7XG4gICAgdGltZXN0YW1wOiBEYXRlO1xuICB9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY3JlYXRlKFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICB0aXRsZTogJ05ldyBDb21tdW5pdHkgUmVjb21tZW5kYXRpb25zJyxcbiAgICAgICAgICBtZXNzYWdlOiBgV2UndmUgZm91bmQgJHtwYXlsb2FkLnJlY29tbWVuZGF0aW9uQ291bnR9IG5ldyBjb21tdW5pdGllcyB0aGF0IG1pZ2h0IGludGVyZXN0IHlvdSBiYXNlZCBvbiB5b3VyIGFzc2Vzc21lbnQgcmVzdWx0cy5gLFxuICAgICAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuQ09NTVVOSVRZX1JFQ09NTUVOREFUSU9OLFxuICAgICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25Db3VudDogcGF5bG9hZC5yZWNvbW1lbmRhdGlvbkNvdW50LFxuICAgICAgICAgICAgZ2VuZXJhdGVkQXQ6IHBheWxvYWQudGltZXN0YW1wLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByZWFsVGltZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogZmFsc2UsXG4gICAgICAgICAgcHVzaDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgYENvbW11bml0eSByZWNvbW1lbmRhdGlvbiBub3RpZmljYXRpb24gc2VudCB0byB1c2VyICR7cGF5bG9hZC51c2VySWR9YCxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJyb3IgaGFuZGxpbmcgcmVjb21tZW5kYXRpb25zIGdlbmVyYXRlZCBldmVudDpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBjb21tdW5pdHkgcmVjb21tZW5kYXRpb24gaW50ZXJhY3Rpb24gZXZlbnRzXG4gICAqL1xuICBAT25FdmVudCgnY29tbXVuaXR5LnJlY29tbWVuZGF0aW9uLmludGVyYWN0aW9uJylcbiAgYXN5bmMgaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbihwYXlsb2FkOiB7XG4gICAgdXNlcklkOiBzdHJpbmc7XG4gICAgY29tbXVuaXR5SWQ6IHN0cmluZztcbiAgICBjb21tdW5pdHlOYW1lOiBzdHJpbmc7XG4gICAgYWN0aW9uOiAnYWNjZXB0JyB8ICdyZWplY3QnO1xuICAgIGNvbXBhdGliaWxpdHlTY29yZTogbnVtYmVyO1xuICAgIHRpbWVzdGFtcDogRGF0ZTtcbiAgfSkge1xuICAgIHRyeSB7XG4gICAgICBpZiAocGF5bG9hZC5hY3Rpb24gPT09ICdhY2NlcHQnKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY3JlYXRlKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVzZXJJZDogcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgICB0aXRsZTogYFdlbGNvbWUgdG8gJHtwYXlsb2FkLmNvbW11bml0eU5hbWV9IWAsXG4gICAgICAgICAgICBtZXNzYWdlOiBgWW91J3ZlIHN1Y2Nlc3NmdWxseSBqb2luZWQgJHtwYXlsb2FkLmNvbW11bml0eU5hbWV9LiBTdGFydCBleHBsb3JpbmcgYW5kIGNvbm5lY3Rpbmcgd2l0aCB0aGUgY29tbXVuaXR5LmAsXG4gICAgICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9KT0lORUQsXG4gICAgICAgICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgICAgICAgIGFjdGlvblVybDogYC9jb21tdW5pdGllcy8ke3BheWxvYWQuY29tbXVuaXR5SWR9YCxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgY29tbXVuaXR5SWQ6IHBheWxvYWQuY29tbXVuaXR5SWQsXG4gICAgICAgICAgICAgIGNvbW11bml0eU5hbWU6IHBheWxvYWQuY29tbXVuaXR5TmFtZSxcbiAgICAgICAgICAgICAgY29tcGF0aWJpbGl0eVNjb3JlOiBwYXlsb2FkLmNvbXBhdGliaWxpdHlTY29yZSxcbiAgICAgICAgICAgICAgam9pbk1ldGhvZDogJ3JlY29tbWVuZGF0aW9uX2FjY2VwdGVkJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICByZWFsVGltZTogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiBmYWxzZSxcbiAgICAgICAgICAgIHB1c2g6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgICAgYENvbW11bml0eSBqb2luIG5vdGlmaWNhdGlvbiBzZW50IHRvIHVzZXIgJHtwYXlsb2FkLnVzZXJJZH1gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm9yIGhhbmRsaW5nIHJlY29tbWVuZGF0aW9uIGludGVyYWN0aW9uIGV2ZW50OmAsXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGNvbW11bml0eSBtZW1iZXIgam9pbmVkIGV2ZW50c1xuICAgKi9cbiAgQE9uRXZlbnQoJ2NvbW11bml0eS5tZW1iZXIuam9pbmVkJylcbiAgYXN5bmMgaGFuZGxlTWVtYmVySm9pbmVkKHBheWxvYWQ6IHtcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICBjb21tdW5pdHlJZDogc3RyaW5nO1xuICAgIGpvaW5NZXRob2Q6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IERhdGU7XG4gIH0pIHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGNvbW11bml0eSBkZXRhaWxzXG4gICAgICBjb25zdCBjb21tdW5pdHkgPSBhd2FpdCB0aGlzLnByaXNtYS5jb21tdW5pdHkuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBwYXlsb2FkLmNvbW11bml0eUlkIH0sXG4gICAgICAgIHNlbGVjdDogeyBuYW1lOiB0cnVlLCBfY291bnQ6IHsgc2VsZWN0OiB7IG1lbWJlcnNoaXBzOiB0cnVlIH0gfSB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY29tbXVuaXR5KSByZXR1cm47XG5cbiAgICAgIC8vIFNlbmQgd2VsY29tZSBub3RpZmljYXRpb24gdG8gdGhlIG5ldyBtZW1iZXJcbiAgICAgIGF3YWl0IHRoaXMuY3JlYXRlKFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICB0aXRsZTogYFdlbGNvbWUgdG8gJHtjb21tdW5pdHkubmFtZX0hYCxcbiAgICAgICAgICBtZXNzYWdlOiBgWW91J3JlIG5vdyBwYXJ0IG9mIGEgY29tbXVuaXR5IHdpdGggJHtjb21tdW5pdHkuX2NvdW50Lm1lbWJlcnNoaXBzfSBtZW1iZXJzLiBTdGFydCBleHBsb3JpbmcgYW5kIGNvbm5lY3RpbmchYCxcbiAgICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLkNPTU1VTklUWV9XRUxDT01FLFxuICAgICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5ISUdILFxuICAgICAgICAgIGFjdGlvblVybDogYC9jb21tdW5pdGllcy8ke3BheWxvYWQuY29tbXVuaXR5SWR9YCxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBjb21tdW5pdHlJZDogcGF5bG9hZC5jb21tdW5pdHlJZCxcbiAgICAgICAgICAgIGNvbW11bml0eU5hbWU6IGNvbW11bml0eS5uYW1lLFxuICAgICAgICAgICAgbWVtYmVyQ291bnQ6IGNvbW11bml0eS5fY291bnQubWVtYmVyc2hpcHMsXG4gICAgICAgICAgICBqb2luTWV0aG9kOiBwYXlsb2FkLmpvaW5NZXRob2QsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJlYWxUaW1lOiB0cnVlLFxuICAgICAgICAgIGVtYWlsOiBmYWxzZSxcbiAgICAgICAgICBwdXNoOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgQ29tbXVuaXR5IHdlbGNvbWUgbm90aWZpY2F0aW9uIHNlbnQgdG8gdXNlciAke3BheWxvYWQudXNlcklkfWAsXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgaGFuZGxpbmcgbWVtYmVyIGpvaW5lZCBldmVudDpgLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSByZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIGV2ZW50c1xuICAgKi9cbiAgQE9uRXZlbnQoJ2NvbW11bml0eS5yZWNvbW1lbmRhdGlvbnMucmVmcmVzaGVkJylcbiAgYXN5bmMgaGFuZGxlUmVjb21tZW5kYXRpb25zUmVmcmVzaGVkKHBheWxvYWQ6IHtcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IERhdGU7XG4gIH0pIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jcmVhdGUoXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IHBheWxvYWQudXNlcklkLFxuICAgICAgICAgIHRpdGxlOiAnQ29tbXVuaXR5IFJlY29tbWVuZGF0aW9ucyBVcGRhdGVkJyxcbiAgICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICAgJ1lvdXIgY29tbXVuaXR5IHJlY29tbWVuZGF0aW9ucyBoYXZlIGJlZW4gdXBkYXRlZCBiYXNlZCBvbiB5b3VyIGxhdGVzdCBhc3Nlc3NtZW50IHJlc3VsdHMuJyxcbiAgICAgICAgICB0eXBlOiBOb3RpZmljYXRpb25UeXBlLlJFQ09NTUVOREFUSU9OU19VUERBVEVELFxuICAgICAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcmVmcmVzaGVkQXQ6IHBheWxvYWQudGltZXN0YW1wLFxuICAgICAgICAgICAgcmVhc29uOiAnYXNzZXNzbWVudF9jaGFuZ2UnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICByZWFsVGltZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogZmFsc2UsXG4gICAgICAgICAgcHVzaDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBSZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIG5vdGlmaWNhdGlvbiBzZW50IHRvIHVzZXIgJHtwYXlsb2FkLnVzZXJJZH1gLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvciBoYW5kbGluZyByZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIGV2ZW50OmAsXG4gICAgICAgIGVycm9yLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kcyBmb3IgY3JlYXRpbmcgc3BlY2lmaWMgbm90aWZpY2F0aW9uIHR5cGVzXG5cbiAgYXN5bmMgY3JlYXRlQXBwb2ludG1lbnRSZW1pbmRlcihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBhcHBvaW50bWVudElkOiBzdHJpbmcsXG4gICAgYXBwb2ludG1lbnRUaW1lOiBEYXRlLFxuICAgIHRoZXJhcGlzdE5hbWU6IHN0cmluZyxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHRpdGxlOiAnVXBjb21pbmcgQXBwb2ludG1lbnQnLFxuICAgICAgbWVzc2FnZTogYFlvdSBoYXZlIGFuIGFwcG9pbnRtZW50IHdpdGggJHt0aGVyYXBpc3ROYW1lfSBpbiAxIGhvdXIuYCxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuQVBQT0lOVE1FTlRfUkVNSU5ERVIsXG4gICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgIGFjdGlvblVybDogYC9hcHBvaW50bWVudHMvJHthcHBvaW50bWVudElkfWAsXG4gICAgICBkYXRhOiB7IGFwcG9pbnRtZW50SWQsIGFwcG9pbnRtZW50VGltZSB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlTWVzc2FnZU5vdGlmaWNhdGlvbihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBzZW5kZXJJZDogc3RyaW5nLFxuICAgIHNlbmRlck5hbWU6IHN0cmluZyxcbiAgICBjb252ZXJzYXRpb25JZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgdXNlcklkLFxuICAgICAgdGl0bGU6ICdOZXcgTWVzc2FnZScsXG4gICAgICBtZXNzYWdlOiBgWW91IGhhdmUgYSBuZXcgbWVzc2FnZSBmcm9tICR7c2VuZGVyTmFtZX0uYCxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuTUVTU0FHRV9SRUNFSVZFRCxcbiAgICAgIHByaW9yaXR5OiBOb3RpZmljYXRpb25Qcmlvcml0eS5OT1JNQUwsXG4gICAgICBhY3Rpb25Vcmw6IGAvbWVzc2FnZXMvJHtjb252ZXJzYXRpb25JZH1gLFxuICAgICAgZGF0YTogeyBzZW5kZXJJZCwgY29udmVyc2F0aW9uSWQgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVdvcmtzaGVldEFzc2lnbmVkTm90aWZpY2F0aW9uKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHdvcmtzaGVldElkOiBzdHJpbmcsXG4gICAgd29ya3NoZWV0VGl0bGU6IHN0cmluZyxcbiAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQsXG4gICAgICB0aXRsZTogJ05ldyBXb3Jrc2hlZXQgQXNzaWduZWQnLFxuICAgICAgbWVzc2FnZTogYCR7dGhlcmFwaXN0TmFtZX0gaGFzIGFzc2lnbmVkIHlvdSBhIG5ldyB3b3Jrc2hlZXQ6IFwiJHt3b3Jrc2hlZXRUaXRsZX1cIi5gLFxuICAgICAgdHlwZTogTm90aWZpY2F0aW9uVHlwZS5XT1JLU0hFRVRfQVNTSUdORUQsXG4gICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMLFxuICAgICAgYWN0aW9uVXJsOiBgL3dvcmtzaGVldHMvJHt3b3Jrc2hlZXRJZH1gLFxuICAgICAgZGF0YTogeyB3b3Jrc2hlZXRJZCB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlVGhlcmFwaXN0QXBwbGljYXRpb25Ob3RpZmljYXRpb24oXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgc3RhdHVzOiAnYXBwcm92ZWQnIHwgJ3JlamVjdGVkJyxcbiAgKSB7XG4gICAgY29uc3QgdGl0bGUgPVxuICAgICAgc3RhdHVzID09PSAnYXBwcm92ZWQnID8gJ0FwcGxpY2F0aW9uIEFwcHJvdmVkJyA6ICdBcHBsaWNhdGlvbiBVcGRhdGUnO1xuICAgIGNvbnN0IG1lc3NhZ2UgPVxuICAgICAgc3RhdHVzID09PSAnYXBwcm92ZWQnXG4gICAgICAgID8gJ0NvbmdyYXR1bGF0aW9ucyEgWW91ciB0aGVyYXBpc3QgYXBwbGljYXRpb24gaGFzIGJlZW4gYXBwcm92ZWQuJ1xuICAgICAgICA6ICdZb3VyIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiBoYXMgYmVlbiByZXZpZXdlZC4gUGxlYXNlIGNoZWNrIHlvdXIgYXBwbGljYXRpb24gc3RhdHVzLic7XG5cbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgdXNlcklkLFxuICAgICAgdGl0bGUsXG4gICAgICBtZXNzYWdlLFxuICAgICAgdHlwZTpcbiAgICAgICAgc3RhdHVzID09PSAnYXBwcm92ZWQnXG4gICAgICAgICAgPyBOb3RpZmljYXRpb25UeXBlLlRIRVJBUElTVF9BUFBST1ZFRFxuICAgICAgICAgIDogTm90aWZpY2F0aW9uVHlwZS5USEVSQVBJU1RfUkVKRUNURUQsXG4gICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCxcbiAgICAgIGFjdGlvblVybDogJy90aGVyYXBpc3QvYXBwbGljYXRpb24nLFxuICAgICAgZGF0YTogeyBzdGF0dXMgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVJldmlld1JlcXVlc3ROb3RpZmljYXRpb24oXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmcsXG4gICAgc2Vzc2lvbklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQsXG4gICAgICB0aXRsZTogJ1JldmlldyBSZXF1ZXN0JyxcbiAgICAgIG1lc3NhZ2U6IGBQbGVhc2UgbGVhdmUgYSByZXZpZXcgZm9yIHlvdXIgc2Vzc2lvbiB3aXRoICR7dGhlcmFwaXN0TmFtZX0uYCxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuUkVWSUVXX1JFUVVFU1QsXG4gICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMLFxuICAgICAgYWN0aW9uVXJsOiBgL3RoZXJhcGlzdHMvJHt0aGVyYXBpc3RJZH0vcmV2aWV3P3Nlc3Npb249JHtzZXNzaW9uSWR9YCxcbiAgICAgIGRhdGE6IHsgdGhlcmFwaXN0SWQsIHNlc3Npb25JZCB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlQ29tbXVuaXR5UG9zdE5vdGlmaWNhdGlvbihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBwb3N0SWQ6IHN0cmluZyxcbiAgICBjb21tdW5pdHlOYW1lOiBzdHJpbmcsXG4gICAgYXV0aG9yTmFtZTogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgdXNlcklkLFxuICAgICAgdGl0bGU6ICdOZXcgQ29tbXVuaXR5IFBvc3QnLFxuICAgICAgbWVzc2FnZTogYCR7YXV0aG9yTmFtZX0gcG9zdGVkIGluICR7Y29tbXVuaXR5TmFtZX0uYCxcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGUuQ09NTVVOSVRZX1BPU1QsXG4gICAgICBwcmlvcml0eTogTm90aWZpY2F0aW9uUHJpb3JpdHkuTE9XLFxuICAgICAgYWN0aW9uVXJsOiBgL2NvbW11bml0aWVzL3Bvc3RzLyR7cG9zdElkfWAsXG4gICAgICBkYXRhOiB7IHBvc3RJZCwgY29tbXVuaXR5TmFtZSB9LFxuICAgIH0pO1xuICB9XG5cbiAgLy8gPT09PT0gVEhFUkFQSVNUIE1BVENISU5HIFNZU1RFTSBOT1RJRklDQVRJT05TID09PT09XG5cbiAgYXN5bmMgY3JlYXRlQ2xpZW50UmVxdWVzdE5vdGlmaWNhdGlvbihcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIGNsaWVudElkOiBzdHJpbmcsXG4gICAgY2xpZW50TmFtZTogc3RyaW5nLFxuICAgIHJlcXVlc3RNZXNzYWdlPzogc3RyaW5nLFxuICAgIHByaW9yaXR5OiAnTE9XJyB8ICdOT1JNQUwnIHwgJ0hJR0gnIHwgJ1VSR0VOVCcgPSAnTk9STUFMJyxcbiAgKSB7XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uUHJpb3JpdHkgPVxuICAgICAgcHJpb3JpdHkgPT09ICdISUdIJyB8fCBwcmlvcml0eSA9PT0gJ1VSR0VOVCcgPyAnSElHSCcgOiAnTk9STUFMJztcblxuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQ6IHRoZXJhcGlzdElkLFxuICAgICAgdGl0bGU6IGBOZXcgQ2xpZW50IFJlcXVlc3QgJHtwcmlvcml0eSA9PT0gJ1VSR0VOVCcgPyAnKFVyZ2VudCknIDogJyd9YCxcbiAgICAgIG1lc3NhZ2U6IGAke2NsaWVudE5hbWV9IGhhcyBzZW50IHlvdSBhIHRoZXJhcHkgcmVxdWVzdC4ke3JlcXVlc3RNZXNzYWdlID8gYCBcIiR7cmVxdWVzdE1lc3NhZ2Uuc3Vic3RyaW5nKDAsIDEwMCl9JHtyZXF1ZXN0TWVzc2FnZS5sZW5ndGggPiAxMDAgPyAnLi4uJyA6ICcnfVwiYCA6ICcnfWAsXG4gICAgICB0eXBlOiAnQ0xJRU5UX1JFUVVFU1RfUkVDRUlWRUQnLFxuICAgICAgcHJpb3JpdHk6IG5vdGlmaWNhdGlvblByaW9yaXR5LFxuICAgICAgYWN0aW9uVXJsOiBgL3RoZXJhcGlzdC9yZXF1ZXN0c2AsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGNsaWVudElkLFxuICAgICAgICBjbGllbnROYW1lLFxuICAgICAgICByZXF1ZXN0VHlwZTogJ3RoZXJhcHlfcmVxdWVzdCcsXG4gICAgICAgIHByaW9yaXR5LFxuICAgICAgICBoYXNNZXNzYWdlOiAhIXJlcXVlc3RNZXNzYWdlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVJlcXVlc3RBY2NlcHRlZE5vdGlmaWNhdGlvbihcbiAgICBjbGllbnRJZDogc3RyaW5nLFxuICAgIHRoZXJhcGlzdElkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0TmFtZTogc3RyaW5nLFxuICAgIHJlc3BvbnNlTWVzc2FnZT86IHN0cmluZyxcbiAgICBzY2hlZHVsaW5nSW5mbz86IHN0cmluZyxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlKHtcbiAgICAgIHVzZXJJZDogY2xpZW50SWQsXG4gICAgICB0aXRsZTogJ1RoZXJhcGlzdCBSZXF1ZXN0IEFjY2VwdGVkISDwn46JJyxcbiAgICAgIG1lc3NhZ2U6IGBHcmVhdCBuZXdzISAke3RoZXJhcGlzdE5hbWV9IGhhcyBhY2NlcHRlZCB5b3VyIHRoZXJhcHkgcmVxdWVzdC4ke3Jlc3BvbnNlTWVzc2FnZSA/IGAgXCIke3Jlc3BvbnNlTWVzc2FnZX1cImAgOiAnJ31gLFxuICAgICAgdHlwZTogJ1RIRVJBUElTVF9SRVFVRVNUX0FDQ0VQVEVEJyxcbiAgICAgIHByaW9yaXR5OiAnSElHSCcsXG4gICAgICBhY3Rpb25Vcmw6IGAvY2xpZW50L3RoZXJhcGlzdHMvJHt0aGVyYXBpc3RJZH1gLFxuICAgICAgZGF0YToge1xuICAgICAgICB0aGVyYXBpc3RJZCxcbiAgICAgICAgdGhlcmFwaXN0TmFtZSxcbiAgICAgICAgcmVzcG9uc2VNZXNzYWdlLFxuICAgICAgICBzY2hlZHVsaW5nSW5mbyxcbiAgICAgICAgbmV4dFN0ZXA6ICdzY2hlZHVsZV9zZXNzaW9uJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVSZXF1ZXN0RGVjbGluZWROb3RpZmljYXRpb24oXG4gICAgY2xpZW50SWQ6IHN0cmluZyxcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIHRoZXJhcGlzdE5hbWU6IHN0cmluZyxcbiAgICByZXNwb25zZU1lc3NhZ2U/OiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQ6IGNsaWVudElkLFxuICAgICAgdGl0bGU6ICdUaGVyYXBpc3QgUmVxdWVzdCBVcGRhdGUnLFxuICAgICAgbWVzc2FnZTogYCR7dGhlcmFwaXN0TmFtZX0gaGFzIHJlc3BvbmRlZCB0byB5b3VyIHRoZXJhcHkgcmVxdWVzdC4ke3Jlc3BvbnNlTWVzc2FnZSA/IGAgXCIke3Jlc3BvbnNlTWVzc2FnZX1cImAgOiAnJ30gRG9uJ3Qgd29ycnkgLSB3ZSBjYW4gaGVscCB5b3UgZmluZCBvdGhlciBncmVhdCBtYXRjaGVzIWAsXG4gICAgICB0eXBlOiAnVEhFUkFQSVNUX1JFUVVFU1RfREVDTElORUQnLFxuICAgICAgcHJpb3JpdHk6ICdOT1JNQUwnLFxuICAgICAgYWN0aW9uVXJsOiAnL2NsaWVudC90aGVyYXBpc3RzL2Jyb3dzZScsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHRoZXJhcGlzdElkLFxuICAgICAgICB0aGVyYXBpc3ROYW1lLFxuICAgICAgICByZXNwb25zZU1lc3NhZ2UsXG4gICAgICAgIG5leHRTdGVwOiAnYnJvd3NlX2FsdGVybmF0aXZlcycsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlUmVxdWVzdENhbmNlbGxlZE5vdGlmaWNhdGlvbihcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIGNsaWVudE5hbWU6IHN0cmluZyxcbiAgICByZWFzb24/OiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQ6IHRoZXJhcGlzdElkLFxuICAgICAgdGl0bGU6ICdDbGllbnQgUmVxdWVzdCBDYW5jZWxsZWQnLFxuICAgICAgbWVzc2FnZTogYCR7Y2xpZW50TmFtZX0gaGFzIGNhbmNlbGxlZCB0aGVpciB0aGVyYXB5IHJlcXVlc3QuJHtyZWFzb24gPyBgIFJlYXNvbjogJHtyZWFzb259YCA6ICcnfWAsXG4gICAgICB0eXBlOiAnQ0xJRU5UX1JFUVVFU1RfQ0FOQ0VMTEVEJyxcbiAgICAgIHByaW9yaXR5OiAnTk9STUFMJyxcbiAgICAgIGFjdGlvblVybDogJy90aGVyYXBpc3QvcmVxdWVzdHMnLFxuICAgICAgZGF0YToge1xuICAgICAgICBjbGllbnROYW1lLFxuICAgICAgICByZWFzb24sXG4gICAgICAgIGFjdGlvblR5cGU6ICdjYW5jZWxsYXRpb24nLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZUFkbWluVGhlcmFwaXN0QXBwcm92YWxOb3RpZmljYXRpb24oXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICBhcHByb3ZhbE1lc3NhZ2U/OiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQ6IHRoZXJhcGlzdElkLFxuICAgICAgdGl0bGU6ICdBcHBsaWNhdGlvbiBBcHByb3ZlZCEgV2VsY29tZSB0byBNZW50YXJhIPCfjoknLFxuICAgICAgbWVzc2FnZTogYENvbmdyYXR1bGF0aW9ucyEgWW91ciB0aGVyYXBpc3QgYXBwbGljYXRpb24gaGFzIGJlZW4gYXBwcm92ZWQuIFlvdSBjYW4gbm93IHN0YXJ0IHJlY2VpdmluZyBjbGllbnQgcmVxdWVzdHMuJHthcHByb3ZhbE1lc3NhZ2UgPyBgIE1lc3NhZ2UgZnJvbSBvdXIgdGVhbTogXCIke2FwcHJvdmFsTWVzc2FnZX1cImAgOiAnJ31gLFxuICAgICAgdHlwZTogJ1RIRVJBUElTVF9BUFBST1ZFRCcsXG4gICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgYWN0aW9uVXJsOiAnL3RoZXJhcGlzdC9kYXNoYm9hcmQnLFxuICAgICAgZGF0YToge1xuICAgICAgICBhcHByb3ZhbE1lc3NhZ2UsXG4gICAgICAgIG5leHRTdGVwczogW1xuICAgICAgICAgICdjb21wbGV0ZV9wcm9maWxlJyxcbiAgICAgICAgICAnc2V0X2F2YWlsYWJpbGl0eScsXG4gICAgICAgICAgJ3Jldmlld19ndWlkZWxpbmVzJyxcbiAgICAgICAgXSxcbiAgICAgICAgd2VsY29tZUZsb3c6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlQWRtaW5UaGVyYXBpc3RSZWplY3Rpb25Ob3RpZmljYXRpb24oXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICByZWplY3Rpb25SZWFzb246IHN0cmluZyxcbiAgICByZWplY3Rpb25NZXNzYWdlOiBzdHJpbmcsXG4gICAgYWxsb3dSZWFwcGxpY2F0aW9uOiBib29sZWFuLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgdXNlcklkOiB0aGVyYXBpc3RJZCxcbiAgICAgIHRpdGxlOiAnQXBwbGljYXRpb24gU3RhdHVzIFVwZGF0ZScsXG4gICAgICBtZXNzYWdlOiBgWW91ciB0aGVyYXBpc3QgYXBwbGljYXRpb24gaGFzIGJlZW4gcmV2aWV3ZWQuICR7cmVqZWN0aW9uTWVzc2FnZX1gLFxuICAgICAgdHlwZTogJ1RIRVJBUElTVF9SRUpFQ1RFRCcsXG4gICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgYWN0aW9uVXJsOiBhbGxvd1JlYXBwbGljYXRpb25cbiAgICAgICAgPyAnL3RoZXJhcGlzdC9yZWFwcGx5J1xuICAgICAgICA6ICcvdGhlcmFwaXN0L2FwcGxpY2F0aW9uLXN0YXR1cycsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHJlamVjdGlvblJlYXNvbixcbiAgICAgICAgcmVqZWN0aW9uTWVzc2FnZSxcbiAgICAgICAgYWxsb3dSZWFwcGxpY2F0aW9uLFxuICAgICAgICBuZXh0U3RlcDogYWxsb3dSZWFwcGxpY2F0aW9uID8gJ3JlYXBwbHknIDogJ2NvbnRhY3Rfc3VwcG9ydCcsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlTmV3UmVjb21tZW5kYXRpb25zTm90aWZpY2F0aW9uKFxuICAgIGNsaWVudElkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0Q291bnQ6IG51bWJlcixcbiAgICB1cGRhdGVSZWFzb246XG4gICAgICB8ICdwcm9maWxlX3VwZGF0ZSdcbiAgICAgIHwgJ25ld190aGVyYXBpc3RzJ1xuICAgICAgfCAnYWxnb3JpdGhtX2ltcHJvdmVtZW50JyA9ICduZXdfdGhlcmFwaXN0cycsXG4gICkge1xuICAgIGNvbnN0IHJlYXNvbk1lc3NhZ2VzID0ge1xuICAgICAgcHJvZmlsZV91cGRhdGU6ICdiYXNlZCBvbiB5b3VyIHVwZGF0ZWQgcHJlZmVyZW5jZXMnLFxuICAgICAgbmV3X3RoZXJhcGlzdHM6ICd3aXRoIG5ld2x5IGFwcHJvdmVkIHRoZXJhcGlzdHMnLFxuICAgICAgYWxnb3JpdGhtX2ltcHJvdmVtZW50OiAnd2l0aCBpbXByb3ZlZCBtYXRjaGluZycsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQ6IGNsaWVudElkLFxuICAgICAgdGl0bGU6ICdOZXcgVGhlcmFwaXN0IFJlY29tbWVuZGF0aW9ucyBBdmFpbGFibGUnLFxuICAgICAgbWVzc2FnZTogYFdlJ3ZlIGZvdW5kICR7dGhlcmFwaXN0Q291bnR9IG5ldyB0aGVyYXBpc3QgbWF0Y2hlcyBmb3IgeW91ICR7cmVhc29uTWVzc2FnZXNbdXBkYXRlUmVhc29uXX0uIENoZWNrIHRoZW0gb3V0IWAsXG4gICAgICB0eXBlOiAnTkVXX1JFQ09NTUVOREFUSU9OUycsXG4gICAgICBwcmlvcml0eTogJ05PUk1BTCcsXG4gICAgICBhY3Rpb25Vcmw6ICcvY2xpZW50L3RoZXJhcGlzdHMvcmVjb21tZW5kYXRpb25zJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGhlcmFwaXN0Q291bnQsXG4gICAgICAgIHVwZGF0ZVJlYXNvbixcbiAgICAgICAgcmVjb21tZW5kYXRpb25UeXBlOiAndXBkYXRlZF9tYXRjaGVzJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVNYXRjaGluZ1N5c3RlbVVwZGF0ZU5vdGlmaWNhdGlvbihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1cGRhdGVUeXBlOiAnYWxnb3JpdGhtX2ltcHJvdmVtZW50JyB8ICdmZWF0dXJlX3JlbGVhc2UnIHwgJ21haW50ZW5hbmNlJyxcbiAgICB1cGRhdGVNZXNzYWdlOiBzdHJpbmcsXG4gICkge1xuICAgIGNvbnN0IHRpdGxlcyA9IHtcbiAgICAgIGFsZ29yaXRobV9pbXByb3ZlbWVudDogJ0JldHRlciBNYXRjaGluZyBBdmFpbGFibGUnLFxuICAgICAgZmVhdHVyZV9yZWxlYXNlOiAnTmV3IEZlYXR1cmUgQXZhaWxhYmxlJyxcbiAgICAgIG1haW50ZW5hbmNlOiAnU3lzdGVtIFVwZGF0ZSBDb21wbGV0ZScsXG4gICAgfTtcblxuICAgIGNvbnN0IHByaW9yaXRpZXMgPSB7XG4gICAgICBhbGdvcml0aG1faW1wcm92ZW1lbnQ6ICdOT1JNQUwnLFxuICAgICAgZmVhdHVyZV9yZWxlYXNlOiAnTk9STUFMJyxcbiAgICAgIG1haW50ZW5hbmNlOiAnTE9XJyxcbiAgICB9IGFzIGNvbnN0O1xuXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHRpdGxlOiB0aXRsZXNbdXBkYXRlVHlwZV0sXG4gICAgICBtZXNzYWdlOiB1cGRhdGVNZXNzYWdlLFxuICAgICAgdHlwZTogJ1NZU1RFTV9VUERBVEUnLFxuICAgICAgcHJpb3JpdHk6IHByaW9yaXRpZXNbdXBkYXRlVHlwZV0sXG4gICAgICBhY3Rpb25Vcmw6ICcvZGFzaGJvYXJkJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXBkYXRlVHlwZSxcbiAgICAgICAgc3lzdGVtVXBkYXRlOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVJlbGF0aW9uc2hpcEVzdGFibGlzaGVkTm90aWZpY2F0aW9uKFxuICAgIGNsaWVudElkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICB1c2VySWQ6IGNsaWVudElkLFxuICAgICAgdGl0bGU6ICdXZWxjb21lIHRvIFlvdXIgVGhlcmFweSBKb3VybmV5ISDwn4yfJyxcbiAgICAgIG1lc3NhZ2U6IGBZb3UncmUgbm93IGNvbm5lY3RlZCB3aXRoICR7dGhlcmFwaXN0TmFtZX0uIFlvdXIgdGhlcmFweSByZWxhdGlvbnNoaXAgaGFzIG9mZmljaWFsbHkgYmVndW4uIFRha2UgdGhlIGZpcnN0IHN0ZXAgYnkgc2NoZWR1bGluZyB5b3VyIGluaXRpYWwgc2Vzc2lvbi5gLFxuICAgICAgdHlwZTogJ1JFTEFUSU9OU0hJUF9FU1RBQkxJU0hFRCcsXG4gICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgYWN0aW9uVXJsOiBgL2NsaWVudC90aGVyYXBpc3RzLyR7dGhlcmFwaXN0SWR9L3NjaGVkdWxlYCxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGhlcmFwaXN0SWQsXG4gICAgICAgIHRoZXJhcGlzdE5hbWUsXG4gICAgICAgIHJlbGF0aW9uc2hpcFN0YXR1czogJ2FjdGl2ZScsXG4gICAgICAgIG5leHRTdGVwOiAnc2NoZWR1bGVfZmlyc3Rfc2Vzc2lvbicsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlVGhlcmFwaXN0UmVxdWVzdFJlbWluZGVyTm90aWZpY2F0aW9uKFxuICAgIHRoZXJhcGlzdElkOiBzdHJpbmcsXG4gICAgcGVuZGluZ1JlcXVlc3RDb3VudDogbnVtYmVyLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgdXNlcklkOiB0aGVyYXBpc3RJZCxcbiAgICAgIHRpdGxlOiBgJHtwZW5kaW5nUmVxdWVzdENvdW50fSBQZW5kaW5nIENsaWVudCBSZXF1ZXN0JHtwZW5kaW5nUmVxdWVzdENvdW50ID4gMSA/ICdzJyA6ICcnfWAsXG4gICAgICBtZXNzYWdlOiBgWW91IGhhdmUgJHtwZW5kaW5nUmVxdWVzdENvdW50fSBjbGllbnQgcmVxdWVzdCR7cGVuZGluZ1JlcXVlc3RDb3VudCA+IDEgPyAncycgOiAnJ30gd2FpdGluZyBmb3IgeW91ciByZXNwb25zZS4gQ2xpZW50cyBhcHByZWNpYXRlIHRpbWVseSByZXNwb25zZXMhYCxcbiAgICAgIHR5cGU6ICdSRVFVRVNUX1JFTUlOREVSJyxcbiAgICAgIHByaW9yaXR5OiBwZW5kaW5nUmVxdWVzdENvdW50ID4gMyA/ICdISUdIJyA6ICdOT1JNQUwnLFxuICAgICAgYWN0aW9uVXJsOiAnL3RoZXJhcGlzdC9yZXF1ZXN0cy9wZW5kaW5nJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcGVuZGluZ1JlcXVlc3RDb3VudCxcbiAgICAgICAgcmVtaW5kZXJUeXBlOiAncGVuZGluZ19yZXF1ZXN0cycsXG4gICAgICAgIHVyZ2VuY3k6IHBlbmRpbmdSZXF1ZXN0Q291bnQgPiAzID8gJ2hpZ2gnIDogJ25vcm1hbCcsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlUHJvZmlsZUNvbXBsZXRpb25SZW1pbmRlck5vdGlmaWNhdGlvbihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyVHlwZTogJ2NsaWVudCcgfCAndGhlcmFwaXN0JyxcbiAgICBtaXNzaW5nRmllbGRzOiBzdHJpbmdbXSxcbiAgKSB7XG4gICAgY29uc3QgYWN0aW9uVXJscyA9IHtcbiAgICAgIGNsaWVudDogJy9jbGllbnQvcHJvZmlsZScsXG4gICAgICB0aGVyYXBpc3Q6ICcvdGhlcmFwaXN0L3Byb2ZpbGUnLFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5jcmVhdGUoe1xuICAgICAgdXNlcklkLFxuICAgICAgdGl0bGU6ICdDb21wbGV0ZSBZb3VyIFByb2ZpbGUgZm9yIEJldHRlciBNYXRjaGVzJyxcbiAgICAgIG1lc3NhZ2U6IGBDb21wbGV0ZSB5b3VyIHByb2ZpbGUgdG8gZ2V0IGJldHRlciB0aGVyYXBpc3QgcmVjb21tZW5kYXRpb25zLiBNaXNzaW5nOiAke21pc3NpbmdGaWVsZHMuc2xpY2UoMCwgMykuam9pbignLCAnKX0ke21pc3NpbmdGaWVsZHMubGVuZ3RoID4gMyA/ICcuLi4nIDogJyd9YCxcbiAgICAgIHR5cGU6ICdQUk9GSUxFX0NPTVBMRVRJT04nLFxuICAgICAgcHJpb3JpdHk6ICdMT1cnLFxuICAgICAgYWN0aW9uVXJsOiBhY3Rpb25VcmxzW3VzZXJUeXBlXSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbWlzc2luZ0ZpZWxkcyxcbiAgICAgICAgdXNlclR5cGUsXG4gICAgICAgIHByb2ZpbGVDb21wbGV0ZW5lc3M6IE1hdGgubWF4KDAsIDEwMCAtIG1pc3NpbmdGaWVsZHMubGVuZ3RoICogMTApLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHNlbmRTY2hlZHVsZWROb3RpZmljYXRpb25zKCkge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICBjb25zdCBzY2hlZHVsZWROb3RpZmljYXRpb25zID0gYXdhaXQgdGhpcy5wcmlzbWEubm90aWZpY2F0aW9uLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHNjaGVkdWxlZEZvcjoge1xuICAgICAgICAgIGx0ZTogbm93LFxuICAgICAgICB9LFxuICAgICAgICBzZW50QXQ6IG51bGwsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBub3RpZmljYXRpb24gb2Ygc2NoZWR1bGVkTm90aWZpY2F0aW9ucykge1xuICAgICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3Ugd291bGQgc2VuZCB0aGUgbm90aWZpY2F0aW9uXG4gICAgICAvLyB2aWEgZW1haWwsIHB1c2ggbm90aWZpY2F0aW9uLCBldGMuIGhlcmVcblxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEubm90aWZpY2F0aW9uLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBub3RpZmljYXRpb24uaWQgfSxcbiAgICAgICAgZGF0YTogeyBzZW50QXQ6IG5vdyB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc2VudDogc2NoZWR1bGVkTm90aWZpY2F0aW9ucy5sZW5ndGggfTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9