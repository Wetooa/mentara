{"version":3,"names":["cov_rwlgke5tx","actualCoverage","common_1","s","require","prisma_client_provider_1","AvailabilityValidatorService","prisma","defaultConfig","allowedDurations","timeFormat","timezone","businessHours","start","end","advanceBooking","minHours","maxDays","weekendBooking","constructor","f","validateTimeFormat","timeString","format","b","regex","test","BadRequestException","validateDuration","duration","allowed","includes","join","validateBookingDateTime","startTime","config","finalConfig","validateAdvanceBooking","validateBusinessHours","validateWeekendBooking","now","Date","timeDiff","getTime","hoursDiff","daysDiff","endTime","startTimeStr","formatTime","endTimeStr","dayOfWeek","getDay","validateTherapistAvailability","therapistId","availability","therapistAvailability","findFirst","where","toString","lte","gte","isAvailable","validateClientTherapistRelationship","clientId","relationship","clientTherapist","validateTherapistExists","therapist","userId","status","include","user","select","isActive","validateAvailabilityOverlap","startTime1","endTime1","startTime2","endTime2","hasOverlap","validateTimezone","Intl","DateTimeFormat","undefined","timeZone","validateMeetingCreation","Promise","all","validateAvailabilityCreation","overlapping","OR","lt","gt","date","toTimeString","slice","parseTimeToMinutes","hours","minutes","split","map","Number","minutesToTimeString","Math","floor","mins","padStart","exports","__decorate","Injectable","PrismaService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/services/availability-validator.service.ts"],"sourcesContent":["import { Injectable, BadRequestException } from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\n\nexport interface ValidationConfig {\n  allowedDurations: number[]; // minutes\n  timeFormat: 'HH:MM' | 'HH:mm';\n  timezone: string;\n  businessHours: {\n    start: string; // HH:MM\n    end: string; // HH:MM\n  };\n  advanceBooking: {\n    minHours: number;\n    maxDays: number;\n  };\n  weekendBooking: boolean;\n}\n\n@Injectable()\nexport class AvailabilityValidatorService {\n  private readonly defaultConfig: ValidationConfig = {\n    allowedDurations: [30, 60, 90, 120],\n    timeFormat: 'HH:MM',\n    timezone: 'UTC',\n    businessHours: {\n      start: '08:00',\n      end: '20:00',\n    },\n    advanceBooking: {\n      minHours: 2,\n      maxDays: 90,\n    },\n    weekendBooking: true,\n  };\n\n  constructor(private readonly prisma: PrismaService) {}\n\n  /**\n   * Validate time format (HH:MM or HH:mm)\n   */\n  validateTimeFormat(\n    timeString: string,\n    format: 'HH:MM' | 'HH:mm' = 'HH:MM',\n  ): boolean {\n    const regex =\n      format === 'HH:MM'\n        ? /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/\n        : /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;\n\n    if (!regex.test(timeString)) {\n      throw new BadRequestException(\n        `Invalid time format. Expected ${format} format (e.g., 09:30)`,\n      );\n    }\n    return true;\n  }\n\n  /**\n   * Validate meeting duration\n   */\n  validateDuration(duration: number, allowedDurations?: number[]): boolean {\n    const allowed = allowedDurations || this.defaultConfig.allowedDurations;\n\n    if (!allowed.includes(duration)) {\n      throw new BadRequestException(\n        `Invalid duration. Allowed durations are: ${allowed.join(', ')} minutes`,\n      );\n    }\n    return true;\n  }\n\n  /**\n   * Validate booking date and time constraints\n   */\n  validateBookingDateTime(\n    startTime: Date,\n    duration: number,\n    config: Partial<ValidationConfig> = {},\n  ): boolean {\n    const finalConfig = { ...this.defaultConfig, ...config };\n\n    this.validateAdvanceBooking(startTime, finalConfig);\n    this.validateBusinessHours(startTime, duration, finalConfig);\n    this.validateWeekendBooking(startTime, finalConfig);\n    this.validateDuration(duration, finalConfig.allowedDurations);\n\n    return true;\n  }\n\n  /**\n   * Validate advance booking constraints\n   */\n  private validateAdvanceBooking(\n    startTime: Date,\n    config: ValidationConfig,\n  ): void {\n    const now = new Date();\n    const timeDiff = startTime.getTime() - now.getTime();\n    const hoursDiff = timeDiff / (1000 * 60 * 60);\n    const daysDiff = timeDiff / (1000 * 60 * 60 * 24);\n\n    if (hoursDiff < config.advanceBooking.minHours) {\n      throw new BadRequestException(\n        `Bookings must be made at least ${config.advanceBooking.minHours} hours in advance`,\n      );\n    }\n\n    if (daysDiff > config.advanceBooking.maxDays) {\n      throw new BadRequestException(\n        `Bookings can only be made up to ${config.advanceBooking.maxDays} days in advance`,\n      );\n    }\n  }\n\n  /**\n   * Validate business hours constraints\n   */\n  private validateBusinessHours(\n    startTime: Date,\n    duration: number,\n    config: ValidationConfig,\n  ): void {\n    const endTime = new Date(startTime.getTime() + duration * 60 * 1000);\n\n    const startTimeStr = this.formatTime(startTime);\n    const endTimeStr = this.formatTime(endTime);\n\n    if (\n      startTimeStr < config.businessHours.start ||\n      endTimeStr > config.businessHours.end\n    ) {\n      throw new BadRequestException(\n        `Meeting must be within business hours (${config.businessHours.start} - ${config.businessHours.end})`,\n      );\n    }\n  }\n\n  /**\n   * Validate weekend booking if not allowed\n   */\n  private validateWeekendBooking(\n    startTime: Date,\n    config: ValidationConfig,\n  ): void {\n    if (!config.weekendBooking) {\n      const dayOfWeek = startTime.getDay();\n      if (dayOfWeek === 0 || dayOfWeek === 6) {\n        // Sunday = 0, Saturday = 6\n        throw new BadRequestException('Weekend bookings are not allowed');\n      }\n    }\n  }\n\n  /**\n   * Check if therapist is available at the specified time\n   */\n  async validateTherapistAvailability(\n    therapistId: string,\n    startTime: Date,\n    duration: number,\n  ): Promise<boolean> {\n    const dayOfWeek = startTime.getDay();\n    const startTimeStr = this.formatTime(startTime);\n    const endTime = new Date(startTime.getTime() + duration * 60 * 1000);\n    const endTimeStr = this.formatTime(endTime);\n\n    const availability = await this.prisma.therapistAvailability.findFirst({\n      where: {\n        therapistId,\n        dayOfWeek: dayOfWeek.toString(),\n        startTime: { lte: startTimeStr },\n        endTime: { gte: endTimeStr },\n        isAvailable: true,\n      },\n    });\n\n    if (!availability) {\n      throw new BadRequestException(\n        'Therapist is not available at the requested time',\n      );\n    }\n\n    return true;\n  }\n\n  /**\n   * Validate client-therapist relationship exists\n   */\n  async validateClientTherapistRelationship(\n    clientId: string,\n    therapistId: string,\n  ): Promise<boolean> {\n    const relationship = await this.prisma.clientTherapist.findFirst({\n      where: {\n        clientId,\n        therapistId,\n      },\n    });\n\n    if (!relationship) {\n      throw new BadRequestException(\n        'You can only book sessions with your assigned therapists',\n      );\n    }\n\n    return true;\n  }\n\n  /**\n   * Validate therapist exists and is active\n   */\n  async validateTherapistExists(therapistId: string): Promise<boolean> {\n    const therapist = await this.prisma.therapist.findFirst({\n      where: {\n        userId: therapistId,\n        status: 'APPROVED',\n      },\n      include: {\n        user: {\n          select: {\n            isActive: true,\n          },\n        },\n      },\n    });\n\n    if (!therapist || !therapist.user.isActive) {\n      throw new BadRequestException('Therapist not found or inactive');\n    }\n\n    return true;\n  }\n\n  /**\n   * Validate availability slot overlap\n   */\n  validateAvailabilityOverlap(\n    startTime1: string,\n    endTime1: string,\n    startTime2: string,\n    endTime2: string,\n  ): boolean {\n    if (startTime1 >= endTime1) {\n      throw new BadRequestException('Start time must be before end time');\n    }\n\n    if (startTime2 >= endTime2) {\n      throw new BadRequestException('Start time must be before end time');\n    }\n\n    const hasOverlap = startTime1 < endTime2 && endTime1 > startTime2;\n\n    if (hasOverlap) {\n      throw new BadRequestException(\n        'Availability slot overlaps with existing availability',\n      );\n    }\n\n    return true;\n  }\n\n  /**\n   * Validate timezone (if timezone support is needed)\n   */\n  validateTimezone(timezone: string): boolean {\n    try {\n      // Check if timezone is valid\n      Intl.DateTimeFormat(undefined, { timeZone: timezone });\n      return true;\n    } catch {\n      throw new BadRequestException(`Invalid timezone: ${timezone}`);\n    }\n  }\n\n  /**\n   * Comprehensive validation for meeting creation\n   */\n  async validateMeetingCreation({\n    therapistId,\n    clientId,\n    startTime,\n    duration,\n    config = {},\n  }: {\n    therapistId: string;\n    clientId: string;\n    startTime: Date;\n    duration: number;\n    config?: Partial<ValidationConfig>;\n  }): Promise<boolean> {\n    // Run all validations\n    await Promise.all([\n      this.validateTherapistExists(therapistId),\n      this.validateClientTherapistRelationship(clientId, therapistId),\n      this.validateTherapistAvailability(therapistId, startTime, duration),\n    ]);\n\n    this.validateBookingDateTime(startTime, duration, config);\n\n    return true;\n  }\n\n  /**\n   * Comprehensive validation for availability creation\n   */\n  async validateAvailabilityCreation({\n    therapistId,\n    dayOfWeek,\n    startTime,\n    endTime,\n  }: {\n    therapistId: string;\n    dayOfWeek: number;\n    startTime: string;\n    endTime: string;\n  }): Promise<boolean> {\n    // Validate therapist exists\n    await this.validateTherapistExists(therapistId);\n\n    // Validate time formats\n    this.validateTimeFormat(startTime);\n    this.validateTimeFormat(endTime);\n\n    // Validate time range\n    if (startTime >= endTime) {\n      throw new BadRequestException('Start time must be before end time');\n    }\n\n    // Validate day of week\n    if (dayOfWeek < 0 || dayOfWeek > 6) {\n      throw new BadRequestException(\n        'Day of week must be between 0 (Sunday) and 6 (Saturday)',\n      );\n    }\n\n    // Check for overlapping availability\n    const overlapping = await this.prisma.therapistAvailability.findFirst({\n      where: {\n        therapistId,\n        dayOfWeek: dayOfWeek.toString(),\n        OR: [\n          {\n            startTime: { lt: endTime },\n            endTime: { gt: startTime },\n          },\n        ],\n      },\n    });\n\n    if (overlapping) {\n      throw new BadRequestException(\n        'Availability slot overlaps with existing availability',\n      );\n    }\n\n    return true;\n  }\n\n  /**\n   * Format Date to HH:MM string\n   */\n  private formatTime(date: Date): string {\n    return date.toTimeString().slice(0, 5);\n  }\n\n  /**\n   * Parse time string to minutes since midnight\n   */\n  private parseTimeToMinutes(timeString: string): number {\n    const [hours, minutes] = timeString.split(':').map(Number);\n    return hours * 60 + minutes;\n  }\n\n  /**\n   * Convert minutes since midnight to HH:MM string\n   */\n  private minutesToTimeString(minutes: number): string {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}