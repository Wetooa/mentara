{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/auth.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Post,\n  Query,\n  Req,\n  Res,\n  UnauthorizedException,\n  UseGuards,\n} from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { Throttle } from '@nestjs/throttler';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport { CurrentUserId } from './decorators/current-user-id.decorator';\nimport { Public } from './decorators/public.decorator';\nimport { JwtAuthGuard } from './guards/jwt-auth.guard';\n// Import types from local auth types\nimport type { SuccessResponse } from '../types/global';\nimport type {\n  AuthResponse,\n  LoginDto,\n  RequestPasswordResetDto,\n  ResendVerificationEmailDto,\n  ResetPasswordDto,\n  UserResponse,\n  VerifyEmailDto,\n} from './types';\n\n// Import validation schemas from local validation\nimport { Request } from 'express';\nimport { SuccessMessageDto } from '../common/dto';\nimport { AuthService } from './auth.service';\nimport { EmailVerificationService } from './services/email-verification.service';\nimport { PasswordResetService } from './services/password-reset.service';\nimport {\n  LoginDtoSchema,\n  RequestPasswordResetDtoSchema,\n  ResendVerificationEmailDtoSchema,\n  ResetPasswordDtoSchema,\n  VerifyEmailDtoSchema,\n} from './validation';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(\n    private readonly authService: AuthService,\n    private readonly emailVerificationService: EmailVerificationService,\n    private readonly passwordResetService: PasswordResetService,\n  ) {}\n\n  // Universal login works for all roles - role-specific registration endpoints:\n  // - /auth/client/register\n  // - /auth/therapist/register\n  // - /auth/admin/create-account\n  // - /auth/moderator/create-account\n\n  @UseGuards(JwtAuthGuard)\n  @Get('me')\n  async getMe(@CurrentUserId() id: string): Promise<UserResponse> {\n    const user = await this.authService.getUser(id);\n    return {\n      user: {\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName || '',\n        lastName: user.lastName || '',\n        role: user.role as any,\n        isEmailVerified: user.emailVerified ?? false,\n        createdAt: user.createdAt,\n        updatedAt: user.updatedAt,\n        client: user.client || undefined,\n      },\n    };\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('users')\n  async getAllUsers(): Promise<UserResponse[]> {\n    const users = await this.authService.getUsers();\n    return users.map((user) => ({\n      user: {\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName || '',\n        lastName: user.lastName || '',\n        role: user.role as any,\n        isEmailVerified: user.emailVerified ?? false,\n        createdAt: user.createdAt,\n        updatedAt: user.updatedAt,\n        client: user.client || undefined,\n      },\n    }));\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Throttle({ default: { limit: 20, ttl: 300000 } }) // 20 logout attempts per 5 minutes\n  @Post('force-logout')\n  @HttpCode(HttpStatus.OK)\n  async forceLogout(@CurrentUserId() id: string): Promise<SuccessResponse> {\n    await this.authService.forceLogout(id);\n    return new SuccessMessageDto('Successfully logged out from all devices');\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 10, ttl: 300000 } }) // 10 login attempts per 5 minutes\n  @Post('login')\n  @HttpCode(HttpStatus.OK)\n  async login(\n    @Body(new ZodValidationPipe(LoginDtoSchema)) loginDto: LoginDto,\n    @Req() req: Request,\n  ): Promise<AuthResponse> {\n    const ipAddress = req.ip;\n    const userAgent = req.get('User-Agent');\n\n    const result = await this.authService.loginWithEmail(\n      loginDto.email,\n      loginDto.password,\n      ipAddress,\n      userAgent,\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName || '',\n        lastName: result.user.lastName || '',\n        role: result.user.role,\n        isEmailVerified: result.user.emailVerified ?? false,\n        createdAt: result.user.createdAt,\n        updatedAt: result.user.updatedAt,\n        client: result.user.client,\n      },\n      token: result.token,\n      message: 'Login successful',\n    };\n  }\n\n  // Removed refresh token endpoint - no longer needed with non-expiring tokens\n  @UseGuards(JwtAuthGuard)\n  @Post('logout')\n  @HttpCode(HttpStatus.OK)\n  async logout(@CurrentUserId() userId: string): Promise<SuccessResponse> {\n    await this.authService.logout(userId);\n    return new SuccessMessageDto('Logged out successfully');\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string): Promise<UserResponse> {\n    const user = await this.authService.validateUser(userId);\n    if (!user) {\n      throw new UnauthorizedException('User not found');\n    }\n    return {\n      user: {\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName || '',\n        lastName: user.lastName || '',\n        role: user.role as any,\n        isEmailVerified: user.emailVerified ?? false,\n        createdAt: user.createdAt,\n        updatedAt: user.updatedAt,\n        client: user.client || undefined,\n      },\n    };\n  }\n\n  // ===== SECURE ROLE CHECKING ENDPOINT =====\n\n  @UseGuards(JwtAuthGuard)\n  @Get('user-role')\n  async getUserRole(\n    @CurrentUserId() userId: string,\n  ): Promise<{ role: string; userId: string }> {\n    const user = await this.authService.validateUser(userId);\n    if (!user) {\n      throw new UnauthorizedException('User not found');\n    }\n\n    return {\n      role: user.role,\n      userId: user.id,\n    };\n  }\n\n  // Role-specific profile endpoints moved to dedicated controllers:\n  // - /auth/client/profile\n  // - /auth/therapist/profile\n  // - /auth/admin/profile\n  // - /auth/moderator/profile\n\n  // ===== PASSWORD RESET ENDPOINTS =====\n\n  @Public()\n  @Throttle({ default: { limit: 5, ttl: 300000 } }) // 5 reset requests per 5 minutes\n  @Post('request-password-reset')\n  @HttpCode(HttpStatus.OK)\n  async requestPasswordReset(\n    @Body(new ZodValidationPipe(RequestPasswordResetDtoSchema))\n    requestResetDto: RequestPasswordResetDto,\n  ): Promise<SuccessResponse> {\n    await this.passwordResetService.requestPasswordReset(requestResetDto.email);\n    return new SuccessMessageDto(\n      'If an account with that email exists, we will send a password reset link.',\n    );\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 10, ttl: 300000 } }) // 10 reset attempts per 5 minutes\n  @Post('reset-password')\n  @HttpCode(HttpStatus.OK)\n  async resetPassword(\n    @Body(new ZodValidationPipe(ResetPasswordDtoSchema))\n    resetDto: ResetPasswordDto,\n  ) {\n    // Validate that passwords match\n    if (resetDto.newPassword !== resetDto.confirmPassword) {\n      throw new UnauthorizedException('Passwords do not match');\n    }\n\n    const result = await this.passwordResetService.resetPassword(\n      resetDto.token,\n      resetDto.newPassword,\n    );\n    return result;\n  }\n\n  @Public()\n  @Get('validate-reset-token')\n  async validateResetToken(@Query('token') token: string) {\n    const result = await this.passwordResetService.validateResetToken(token);\n    return result;\n  }\n\n  // ===== JWT TOKEN VALIDATION ENDPOINT =====\n\n  @Public()\n  @Throttle({ default: { limit: 100, ttl: 60000 } }) // 100 validation requests per minute\n  @Post('validate-token')\n  @HttpCode(HttpStatus.OK)\n  async validateToken(@Body() body: { token: string }) {\n    if (!body.token) {\n      throw new UnauthorizedException('Token is required');\n    }\n\n    const result = await this.authService.validateToken(body.token);\n\n    if (!result.valid) {\n      return {\n        valid: false,\n        error: result.error,\n      };\n    }\n\n    return {\n      valid: true,\n      user: result.user,\n    };\n  }\n\n  // ===== USER EXISTENCE CHECK ENDPOINT =====\n\n  @Public()\n  @Throttle({ default: { limit: 30, ttl: 60000 } }) // 30 requests per minute\n  @Get('check-user')\n  async checkUserExists(@Query('email') email: string) {\n    if (!email) {\n      throw new UnauthorizedException('Email is required');\n    }\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      throw new UnauthorizedException('Invalid email format');\n    }\n\n    const result = await this.authService.checkUserExists(email);\n    return result;\n  }\n\n  // ===== EMAIL VERIFICATION ENDPOINTS =====\n\n  @UseGuards(JwtAuthGuard)\n  @Throttle({ default: { limit: 3, ttl: 300000 } }) // 3 verification emails per 5 minutes\n  @Post('send-verification-email')\n  @HttpCode(HttpStatus.OK)\n  async sendVerificationEmail(@CurrentUserId() userId: string) {\n    await this.emailVerificationService.sendVerificationEmail(userId);\n    return {\n      message: 'Verification email sent successfully',\n    };\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 5, ttl: 300000 } }) // 5 resend attempts per 5 minutes\n  @Post('resend-verification-email')\n  @HttpCode(HttpStatus.OK)\n  async resendVerificationEmail(\n    @Body(new ZodValidationPipe(ResendVerificationEmailDtoSchema))\n    resendDto: ResendVerificationEmailDto,\n  ) {\n    await this.emailVerificationService.resendVerificationEmail(\n      resendDto.email,\n    );\n    return {\n      message:\n        'If an account with that email exists, we will send a verification link.',\n    };\n  }\n\n  @Public()\n  @Post('verify-email')\n  @HttpCode(HttpStatus.OK)\n  async verifyEmail(\n    @Body(new ZodValidationPipe(VerifyEmailDtoSchema))\n    verifyDto: VerifyEmailDto,\n  ) {\n    const result = await this.emailVerificationService.verifyEmail(\n      verifyDto.token,\n    );\n    return result;\n  }\n\n  // Google OAuth Routes\n  @Public()\n  @Get('google')\n  @UseGuards(AuthGuard('google'))\n  async googleAuth() {\n    // Initiates Google OAuth flow\n  }\n\n  @Public()\n  @Get('google/callback')\n  @UseGuards(AuthGuard('google'))\n  async googleAuthRedirect(@Req() req, @Res() res, @Query() query) {\n    try {\n      // Get role from state parameter if provided (for role-specific OAuth flows)\n      const role = query.state || 'client'; // Default to client if no role specified\n\n      // Handle Google OAuth callback and get tokens\n      const result = await this.authService.handleOAuthLogin(\n        req.user,\n        'google',\n        role,\n      );\n\n      // Extract token from result\n      const { token } = result;\n\n      // Determine frontend redirect URL based on environment\n      const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';\n      const redirectUrl = `${frontendUrl}/sso-callback?token=${token}&role=${role}`;\n\n      // Redirect to frontend with tokens in URL parameters\n      return res.redirect(redirectUrl);\n    } catch (error) {\n      console.error('Google OAuth callback error:', error);\n\n      // Redirect to frontend with error\n      const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';\n      const errorUrl = `${frontendUrl}/auth/sign-in?error=oauth_failed&provider=google`;\n      return res.redirect(errorUrl);\n    }\n  }\n\n  // Microsoft OAuth Routes\n  @Public()\n  @Get('microsoft')\n  @UseGuards(AuthGuard('microsoft'))\n  async microsoftAuth() {\n    // Initiates Microsoft OAuth flow\n  }\n\n  @Public()\n  @Get('microsoft/callback')\n  @UseGuards(AuthGuard('microsoft'))\n  async microsoftAuthRedirect(@Req() req, @Res() res, @Query() query) {\n    try {\n      // Get role from state parameter if provided (for role-specific OAuth flows)\n      const role = query.state || 'client'; // Default to client if no role specified\n\n      // Handle Microsoft OAuth callback and get tokens\n      const result = await this.authService.handleOAuthLogin(\n        req.user,\n        'microsoft',\n        role,\n      );\n\n      // Extract token from result\n      const { token } = result;\n\n      // Determine frontend redirect URL based on environment\n      const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';\n      const redirectUrl = `${frontendUrl}/sso-callback?token=${token}&role=${role}`;\n\n      // Redirect to frontend with tokens in URL parameters\n      return res.redirect(redirectUrl);\n    } catch (error) {\n      console.error('Microsoft OAuth callback error:', error);\n\n      // Redirect to frontend with error\n      const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';\n      const errorUrl = `${frontendUrl}/auth/sign-in?error=oauth_failed&provider=microsoft`;\n      return res.redirect(errorUrl);\n    }\n  }\n\n  // OAuth Token Exchange API Endpoint (for frontend to call)\n  @Public()\n  @Post('oauth/token-exchange')\n  @HttpCode(HttpStatus.OK)\n  async exchangeOAuthToken(\n    @Body()\n    body: {\n      provider: 'google' | 'microsoft';\n      code: string;\n      state?: string;\n    },\n  ) {\n    const { provider, code } = body;\n\n    if (!code) {\n      throw new UnauthorizedException('Authorization code is required');\n    }\n\n    if (!['google', 'microsoft'].includes(provider)) {\n      throw new UnauthorizedException('Invalid OAuth provider');\n    }\n\n    try {\n      // TODO: Implement proper OAuth token exchange with provider APIs\n      // This would involve exchanging the authorization code for an access token\n      // and then fetching user profile information from the OAuth provider\n\n      // For now, this is a placeholder that expects the full OAuth flow\n      // to be handled by the existing Passport strategies\n      throw new UnauthorizedException(\n        'Direct token exchange not yet implemented. Use OAuth redirect flow.',\n      );\n    } catch (error) {\n      console.error('OAuth token exchange error:', error);\n      throw new UnauthorizedException('OAuth token exchange failed');\n    }\n  }\n\n  // Removed session management endpoints - using single tokens now\n}\n"],"version":3}