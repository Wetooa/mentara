467f4f00861df0246b9e7d3fca742395
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthController = void 0;
const common_1 = require("@nestjs/common");
const passport_1 = require("@nestjs/passport");
const throttler_1 = require("@nestjs/throttler");
const zod_validation_pipe_1 = require("../common/pipes/zod-validation.pipe");
const current_user_id_decorator_1 = require("./decorators/current-user-id.decorator");
const public_decorator_1 = require("./decorators/public.decorator");
const jwt_auth_guard_1 = require("./guards/jwt-auth.guard");
// Import validation schemas from local validation
const express_1 = require("express");
const dto_1 = require("../common/dto");
const auth_service_1 = require("./auth.service");
const email_verification_service_1 = require("./services/email-verification.service");
const password_reset_service_1 = require("./services/password-reset.service");
const validation_1 = require("./validation");
let AuthController = class AuthController {
    authService;
    emailVerificationService;
    passwordResetService;
    constructor(authService, emailVerificationService, passwordResetService) {
        this.authService = authService;
        this.emailVerificationService = emailVerificationService;
        this.passwordResetService = passwordResetService;
    }
    // Universal login works for all roles - role-specific registration endpoints:
    // - /auth/client/register
    // - /auth/therapist/register
    // - /auth/admin/create-account
    // - /auth/moderator/create-account
    async getMe(id) {
        const user = await this.authService.getUser(id);
        return {
            user: {
                id: user.id,
                email: user.email,
                firstName: user.firstName || '',
                lastName: user.lastName || '',
                role: user.role,
                isEmailVerified: user.emailVerified ?? false,
                createdAt: user.createdAt,
                updatedAt: user.updatedAt,
                client: user.client || undefined,
            },
        };
    }
    async getAllUsers() {
        const users = await this.authService.getUsers();
        return users.map((user) => ({
            user: {
                id: user.id,
                email: user.email,
                firstName: user.firstName || '',
                lastName: user.lastName || '',
                role: user.role,
                isEmailVerified: user.emailVerified ?? false,
                createdAt: user.createdAt,
                updatedAt: user.updatedAt,
                client: user.client || undefined,
            },
        }));
    }
    async forceLogout(id) {
        await this.authService.forceLogout(id);
        return new dto_1.SuccessMessageDto('Successfully logged out from all devices');
    }
    async login(loginDto, req) {
        const ipAddress = req.ip;
        const userAgent = req.get('User-Agent');
        const result = await this.authService.loginWithEmail(loginDto.email, loginDto.password, ipAddress, userAgent);
        return {
            user: {
                id: result.user.id,
                email: result.user.email,
                firstName: result.user.firstName || '',
                lastName: result.user.lastName || '',
                role: result.user.role,
                isEmailVerified: result.user.emailVerified ?? false,
                createdAt: result.user.createdAt,
                updatedAt: result.user.updatedAt,
                client: result.user.client,
            },
            token: result.token,
            message: 'Login successful',
        };
    }
    // Removed refresh token endpoint - no longer needed with non-expiring tokens
    async logout(userId) {
        await this.authService.logout(userId);
        return new dto_1.SuccessMessageDto('Logged out successfully');
    }
    async getProfile(userId) {
        const user = await this.authService.validateUser(userId);
        if (!user) {
            throw new common_1.UnauthorizedException('User not found');
        }
        return {
            user: {
                id: user.id,
                email: user.email,
                firstName: user.firstName || '',
                lastName: user.lastName || '',
                role: user.role,
                isEmailVerified: user.emailVerified ?? false,
                createdAt: user.createdAt,
                updatedAt: user.updatedAt,
                client: user.client || undefined,
            },
        };
    }
    // ===== SECURE ROLE CHECKING ENDPOINT =====
    async getUserRole(userId) {
        const user = await this.authService.validateUser(userId);
        if (!user) {
            throw new common_1.UnauthorizedException('User not found');
        }
        return {
            role: user.role,
            userId: user.id,
        };
    }
    // Role-specific profile endpoints moved to dedicated controllers:
    // - /auth/client/profile
    // - /auth/therapist/profile
    // - /auth/admin/profile
    // - /auth/moderator/profile
    // ===== PASSWORD RESET ENDPOINTS =====
    async requestPasswordReset(requestResetDto) {
        await this.passwordResetService.requestPasswordReset(requestResetDto.email);
        return new dto_1.SuccessMessageDto('If an account with that email exists, we will send a password reset link.');
    }
    async resetPassword(resetDto) {
        // Validate that passwords match
        if (resetDto.newPassword !== resetDto.confirmPassword) {
            throw new common_1.UnauthorizedException('Passwords do not match');
        }
        const result = await this.passwordResetService.resetPassword(resetDto.token, resetDto.newPassword);
        return result;
    }
    async validateResetToken(token) {
        const result = await this.passwordResetService.validateResetToken(token);
        return result;
    }
    // ===== JWT TOKEN VALIDATION ENDPOINT =====
    async validateToken(body) {
        if (!body.token) {
            throw new common_1.UnauthorizedException('Token is required');
        }
        const result = await this.authService.validateToken(body.token);
        if (!result.valid) {
            return {
                valid: false,
                error: result.error,
            };
        }
        return {
            valid: true,
            user: result.user,
        };
    }
    // ===== USER EXISTENCE CHECK ENDPOINT =====
    async checkUserExists(email) {
        if (!email) {
            throw new common_1.UnauthorizedException('Email is required');
        }
        // Basic email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            throw new common_1.UnauthorizedException('Invalid email format');
        }
        const result = await this.authService.checkUserExists(email);
        return result;
    }
    // ===== EMAIL VERIFICATION ENDPOINTS =====
    async sendVerificationEmail(userId) {
        await this.emailVerificationService.sendVerificationEmail(userId);
        return {
            message: 'Verification email sent successfully',
        };
    }
    async resendVerificationEmail(resendDto) {
        await this.emailVerificationService.resendVerificationEmail(resendDto.email);
        return {
            message: 'If an account with that email exists, we will send a verification link.',
        };
    }
    async verifyEmail(verifyDto) {
        const result = await this.emailVerificationService.verifyEmail(verifyDto.token);
        return result;
    }
    // Google OAuth Routes
    async googleAuth() {
        // Initiates Google OAuth flow
    }
    async googleAuthRedirect(req, res, query) {
        try {
            // Get role from state parameter if provided (for role-specific OAuth flows)
            const role = query.state || 'client'; // Default to client if no role specified
            // Handle Google OAuth callback and get tokens
            const result = await this.authService.handleOAuthLogin(req.user, 'google', role);
            // Extract token from result
            const { token } = result;
            // Determine frontend redirect URL based on environment
            const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';
            const redirectUrl = `${frontendUrl}/sso-callback?token=${token}&role=${role}`;
            // Redirect to frontend with tokens in URL parameters
            return res.redirect(redirectUrl);
        }
        catch (error) {
            console.error('Google OAuth callback error:', error);
            // Redirect to frontend with error
            const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';
            const errorUrl = `${frontendUrl}/auth/sign-in?error=oauth_failed&provider=google`;
            return res.redirect(errorUrl);
        }
    }
    // Microsoft OAuth Routes
    async microsoftAuth() {
        // Initiates Microsoft OAuth flow
    }
    async microsoftAuthRedirect(req, res, query) {
        try {
            // Get role from state parameter if provided (for role-specific OAuth flows)
            const role = query.state || 'client'; // Default to client if no role specified
            // Handle Microsoft OAuth callback and get tokens
            const result = await this.authService.handleOAuthLogin(req.user, 'microsoft', role);
            // Extract token from result
            const { token } = result;
            // Determine frontend redirect URL based on environment
            const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';
            const redirectUrl = `${frontendUrl}/sso-callback?token=${token}&role=${role}`;
            // Redirect to frontend with tokens in URL parameters
            return res.redirect(redirectUrl);
        }
        catch (error) {
            console.error('Microsoft OAuth callback error:', error);
            // Redirect to frontend with error
            const frontendUrl = process.env.FRONTEND_URL || 'http://localhost:3000';
            const errorUrl = `${frontendUrl}/auth/sign-in?error=oauth_failed&provider=microsoft`;
            return res.redirect(errorUrl);
        }
    }
    // OAuth Token Exchange API Endpoint (for frontend to call)
    async exchangeOAuthToken(body) {
        const { provider, code } = body;
        if (!code) {
            throw new common_1.UnauthorizedException('Authorization code is required');
        }
        if (!['google', 'microsoft'].includes(provider)) {
            throw new common_1.UnauthorizedException('Invalid OAuth provider');
        }
        try {
            // TODO: Implement proper OAuth token exchange with provider APIs
            // This would involve exchanging the authorization code for an access token
            // and then fetching user profile information from the OAuth provider
            // For now, this is a placeholder that expects the full OAuth flow
            // to be handled by the existing Passport strategies
            throw new common_1.UnauthorizedException('Direct token exchange not yet implemented. Use OAuth redirect flow.');
        }
        catch (error) {
            console.error('OAuth token exchange error:', error);
            throw new common_1.UnauthorizedException('OAuth token exchange failed');
        }
    }
};
exports.AuthController = AuthController;
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('me'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], AuthController.prototype, "getMe", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('users'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], AuthController.prototype, "getAllUsers", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, throttler_1.Throttle)({ default: { limit: 20, ttl: 300000 } }) // 20 logout attempts per 5 minutes
    ,
    (0, common_1.Post)('force-logout'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], AuthController.prototype, "forceLogout", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 300000 } }) // 10 login attempts per 5 minutes
    ,
    (0, common_1.Post)('login'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.LoginDtoSchema))),
    __param(1, (0, common_1.Req)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_g = typeof express_1.Request !== "undefined" && express_1.Request) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], AuthController.prototype, "login", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Post)('logout'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], AuthController.prototype, "logout", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('profile'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], AuthController.prototype, "getProfile", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('user-role'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], AuthController.prototype, "getUserRole", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 300000 } }) // 5 reset requests per 5 minutes
    ,
    (0, common_1.Post)('request-password-reset'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.RequestPasswordResetDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], AuthController.prototype, "requestPasswordReset", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 300000 } }) // 10 reset attempts per 5 minutes
    ,
    (0, common_1.Post)('reset-password'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.ResetPasswordDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "resetPassword", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Get)('validate-reset-token'),
    __param(0, (0, common_1.Query)('token')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "validateResetToken", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 100, ttl: 60000 } }) // 100 validation requests per minute
    ,
    (0, common_1.Post)('validate-token'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "validateToken", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 30, ttl: 60000 } }) // 30 requests per minute
    ,
    (0, common_1.Get)('check-user'),
    __param(0, (0, common_1.Query)('email')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "checkUserExists", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, throttler_1.Throttle)({ default: { limit: 3, ttl: 300000 } }) // 3 verification emails per 5 minutes
    ,
    (0, common_1.Post)('send-verification-email'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "sendVerificationEmail", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 300000 } }) // 5 resend attempts per 5 minutes
    ,
    (0, common_1.Post)('resend-verification-email'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.ResendVerificationEmailDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "resendVerificationEmail", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Post)('verify-email'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.VerifyEmailDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "verifyEmail", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Get)('google'),
    (0, common_1.UseGuards)((0, passport_1.AuthGuard)('google')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "googleAuth", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Get)('google/callback'),
    (0, common_1.UseGuards)((0, passport_1.AuthGuard)('google')),
    __param(0, (0, common_1.Req)()),
    __param(1, (0, common_1.Res)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "googleAuthRedirect", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Get)('microsoft'),
    (0, common_1.UseGuards)((0, passport_1.AuthGuard)('microsoft')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "microsoftAuth", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Get)('microsoft/callback'),
    (0, common_1.UseGuards)((0, passport_1.AuthGuard)('microsoft')),
    __param(0, (0, common_1.Req)()),
    __param(1, (0, common_1.Res)()),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "microsoftAuthRedirect", null);
__decorate([
    (0, public_decorator_1.Public)(),
    (0, common_1.Post)('oauth/token-exchange'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], AuthController.prototype, "exchangeOAuthToken", null);
exports.AuthController = AuthController = __decorate([
    (0, common_1.Controller)('auth'),
    __metadata("design:paramtypes", [typeof (_a = typeof auth_service_1.AuthService !== "undefined" && auth_service_1.AuthService) === "function" ? _a : Object, typeof (_b = typeof email_verification_service_1.EmailVerificationService !== "undefined" && email_verification_service_1.EmailVerificationService) === "function" ? _b : Object, typeof (_c = typeof password_reset_service_1.PasswordResetService !== "undefined" && password_reset_service_1.PasswordResetService) === "function" ? _c : Object])
], AuthController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvYXV0aC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FZd0I7QUFDeEIsK0NBQTZDO0FBQzdDLGlEQUE2QztBQUM3Qyw2RUFBd0U7QUFDeEUsc0ZBQXVFO0FBQ3ZFLG9FQUF1RDtBQUN2RCw0REFBdUQ7QUFhdkQsa0RBQWtEO0FBQ2xELHFDQUFrQztBQUNsQyx1Q0FBa0Q7QUFDbEQsaURBQTZDO0FBQzdDLHNGQUFpRjtBQUNqRiw4RUFBeUU7QUFDekUsNkNBTXNCO0FBR2YsSUFBTSxjQUFjLEdBQXBCLE1BQU0sY0FBYztJQUVOO0lBQ0E7SUFDQTtJQUhuQixZQUNtQixXQUF3QixFQUN4Qix3QkFBa0QsRUFDbEQsb0JBQTBDO1FBRjFDLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtJQUMxRCxDQUFDO0lBRUosOEVBQThFO0lBQzlFLDBCQUEwQjtJQUMxQiw2QkFBNkI7SUFDN0IsK0JBQStCO0lBQy9CLG1DQUFtQztJQUk3QixBQUFOLEtBQUssQ0FBQyxLQUFLLENBQWtCLEVBQVU7UUFDckMsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRCxPQUFPO1lBQ0wsSUFBSSxFQUFFO2dCQUNKLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtnQkFDWCxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7Z0JBQ2pCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxJQUFJLEVBQUU7Z0JBQy9CLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxJQUFJLEVBQUU7Z0JBQzdCLElBQUksRUFBRSxJQUFJLENBQUMsSUFBVztnQkFDdEIsZUFBZSxFQUFFLElBQUksQ0FBQyxh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RUFBQyxzQkFBc0IsQ0FBQztJQUM1QixJQUFBLGlCQUFRLEVBQUMsbUJBQVUsQ0FBQyxFQUFFLENBQUM7SUFFckIsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBOzs7O3dEQStCUjt5QkFsWlUsY0FBYztJQUQxQixJQUFBLG1CQUFVLEVBQUMsTUFBTSxDQUFDO3lEQUdlLDBCQUFXLG9CQUFYLDBCQUFXLG9EQUNFLHFEQUF3QixvQkFBeEIscURBQXdCLG9EQUM1Qiw2Q0FBb0Isb0JBQXBCLDZDQUFvQjtHQUpsRCxjQUFjLENBcVoxQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYXV0aC9hdXRoLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQm9keSxcbiAgQ29udHJvbGxlcixcbiAgR2V0LFxuICBIdHRwQ29kZSxcbiAgSHR0cFN0YXR1cyxcbiAgUG9zdCxcbiAgUXVlcnksXG4gIFJlcSxcbiAgUmVzLFxuICBVbmF1dGhvcml6ZWRFeGNlcHRpb24sXG4gIFVzZUd1YXJkcyxcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQXV0aEd1YXJkIH0gZnJvbSAnQG5lc3Rqcy9wYXNzcG9ydCc7XG5pbXBvcnQgeyBUaHJvdHRsZSB9IGZyb20gJ0BuZXN0anMvdGhyb3R0bGVyJztcbmltcG9ydCB7IFpvZFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnLi4vY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJJZCB9IGZyb20gJy4vZGVjb3JhdG9ycy9jdXJyZW50LXVzZXItaWQuZGVjb3JhdG9yJztcbmltcG9ydCB7IFB1YmxpYyB9IGZyb20gJy4vZGVjb3JhdG9ycy9wdWJsaWMuZGVjb3JhdG9yJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4vZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbi8vIEltcG9ydCB0eXBlcyBmcm9tIGxvY2FsIGF1dGggdHlwZXNcbmltcG9ydCB0eXBlIHsgU3VjY2Vzc1Jlc3BvbnNlIH0gZnJvbSAnLi4vdHlwZXMvZ2xvYmFsJztcbmltcG9ydCB0eXBlIHtcbiAgQXV0aFJlc3BvbnNlLFxuICBMb2dpbkR0byxcbiAgUmVxdWVzdFBhc3N3b3JkUmVzZXREdG8sXG4gIFJlc2VuZFZlcmlmaWNhdGlvbkVtYWlsRHRvLFxuICBSZXNldFBhc3N3b3JkRHRvLFxuICBVc2VyUmVzcG9uc2UsXG4gIFZlcmlmeUVtYWlsRHRvLFxufSBmcm9tICcuL3R5cGVzJztcblxuLy8gSW1wb3J0IHZhbGlkYXRpb24gc2NoZW1hcyBmcm9tIGxvY2FsIHZhbGlkYXRpb25cbmltcG9ydCB7IFJlcXVlc3QgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IFN1Y2Nlc3NNZXNzYWdlRHRvIH0gZnJvbSAnLi4vY29tbW9uL2R0byc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJy4vYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IEVtYWlsVmVyaWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvZW1haWwtdmVyaWZpY2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFzc3dvcmRSZXNldFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3Bhc3N3b3JkLXJlc2V0LnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgTG9naW5EdG9TY2hlbWEsXG4gIFJlcXVlc3RQYXNzd29yZFJlc2V0RHRvU2NoZW1hLFxuICBSZXNlbmRWZXJpZmljYXRpb25FbWFpbER0b1NjaGVtYSxcbiAgUmVzZXRQYXNzd29yZER0b1NjaGVtYSxcbiAgVmVyaWZ5RW1haWxEdG9TY2hlbWEsXG59IGZyb20gJy4vdmFsaWRhdGlvbic7XG5cbkBDb250cm9sbGVyKCdhdXRoJylcbmV4cG9ydCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZW1haWxWZXJpZmljYXRpb25TZXJ2aWNlOiBFbWFpbFZlcmlmaWNhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYXNzd29yZFJlc2V0U2VydmljZTogUGFzc3dvcmRSZXNldFNlcnZpY2UsXG4gICkge31cblxuICAvLyBVbml2ZXJzYWwgbG9naW4gd29ya3MgZm9yIGFsbCByb2xlcyAtIHJvbGUtc3BlY2lmaWMgcmVnaXN0cmF0aW9uIGVuZHBvaW50czpcbiAgLy8gLSAvYXV0aC9jbGllbnQvcmVnaXN0ZXJcbiAgLy8gLSAvYXV0aC90aGVyYXBpc3QvcmVnaXN0ZXJcbiAgLy8gLSAvYXV0aC9hZG1pbi9jcmVhdGUtYWNjb3VudFxuICAvLyAtIC9hdXRoL21vZGVyYXRvci9jcmVhdGUtYWNjb3VudFxuXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuICBAR2V0KCdtZScpXG4gIGFzeW5jIGdldE1lKEBDdXJyZW50VXNlcklkKCkgaWQ6IHN0cmluZyk6IFByb21pc2U8VXNlclJlc3BvbnNlPiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UuZ2V0VXNlcihpZCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICBmaXJzdE5hbWU6IHVzZXIuZmlyc3ROYW1lIHx8ICcnLFxuICAgICAgICBsYXN0TmFtZTogdXNlci5sYXN0TmFtZSB8fCAnJyxcbiAgICAgICAgcm9sZTogdXNlci5yb2xlIGFzIGFueSxcbiAgICAgICAgaXNFbWFpbFZlcmlmaWVkOiB1c2VyLmVtYWlsVmVyaWZpZWQgPz8gZmFsc2UsXG4gICAgICAgIGNyZWF0ZWRBdDogdXNlci5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogdXNlci51cGRhdGVkQXQsXG4gICAgICAgIGNsaWVudDogdXNlci5jbGllbnQgfHwgdW5kZWZpbmVkLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG4gIEBHZXQoJ3VzZXJzJylcbiAgYXN5bmMgZ2V0QWxsVXNlcnMoKTogUHJvbWlzZTxVc2VyUmVzcG9uc2VbXT4ge1xuICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5nZXRVc2VycygpO1xuICAgIHJldHVybiB1c2Vycy5tYXAoKHVzZXIpID0+ICh7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSB8fCAnJyxcbiAgICAgICAgbGFzdE5hbWU6IHVzZXIubGFzdE5hbWUgfHwgJycsXG4gICAgICAgIHJvbGU6IHVzZXIucm9sZSBhcyBhbnksXG4gICAgICAgIGlzRW1haWxWZXJpZmllZDogdXNlci5lbWFpbFZlcmlmaWVkID8/IGZhbHNlLFxuICAgICAgICBjcmVhdGVkQXQ6IHVzZXIuY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IHVzZXIudXBkYXRlZEF0LFxuICAgICAgICBjbGllbnQ6IHVzZXIuY2xpZW50IHx8IHVuZGVmaW5lZCxcbiAgICAgIH0sXG4gICAgfSkpO1xuICB9XG5cbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDIwLCB0dGw6IDMwMDAwMCB9IH0pIC8vIDIwIGxvZ291dCBhdHRlbXB0cyBwZXIgNSBtaW51dGVzXG4gIEBQb3N0KCdmb3JjZS1sb2dvdXQnKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgZm9yY2VMb2dvdXQoQEN1cnJlbnRVc2VySWQoKSBpZDogc3RyaW5nKTogUHJvbWlzZTxTdWNjZXNzUmVzcG9uc2U+IHtcbiAgICBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLmZvcmNlTG9nb3V0KGlkKTtcbiAgICByZXR1cm4gbmV3IFN1Y2Nlc3NNZXNzYWdlRHRvKCdTdWNjZXNzZnVsbHkgbG9nZ2VkIG91dCBmcm9tIGFsbCBkZXZpY2VzJyk7XG4gIH1cblxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogMTAsIHR0bDogMzAwMDAwIH0gfSkgLy8gMTAgbG9naW4gYXR0ZW1wdHMgcGVyIDUgbWludXRlc1xuICBAUG9zdCgnbG9naW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgbG9naW4oXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKExvZ2luRHRvU2NoZW1hKSkgbG9naW5EdG86IExvZ2luRHRvLFxuICAgIEBSZXEoKSByZXE6IFJlcXVlc3QsXG4gICk6IFByb21pc2U8QXV0aFJlc3BvbnNlPiB7XG4gICAgY29uc3QgaXBBZGRyZXNzID0gcmVxLmlwO1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcS5nZXQoJ1VzZXItQWdlbnQnKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UubG9naW5XaXRoRW1haWwoXG4gICAgICBsb2dpbkR0by5lbWFpbCxcbiAgICAgIGxvZ2luRHRvLnBhc3N3b3JkLFxuICAgICAgaXBBZGRyZXNzLFxuICAgICAgdXNlckFnZW50LFxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogcmVzdWx0LnVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiByZXN1bHQudXNlci5lbWFpbCxcbiAgICAgICAgZmlyc3ROYW1lOiByZXN1bHQudXNlci5maXJzdE5hbWUgfHwgJycsXG4gICAgICAgIGxhc3ROYW1lOiByZXN1bHQudXNlci5sYXN0TmFtZSB8fCAnJyxcbiAgICAgICAgcm9sZTogcmVzdWx0LnVzZXIucm9sZSxcbiAgICAgICAgaXNFbWFpbFZlcmlmaWVkOiByZXN1bHQudXNlci5lbWFpbFZlcmlmaWVkID8/IGZhbHNlLFxuICAgICAgICBjcmVhdGVkQXQ6IHJlc3VsdC51c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiByZXN1bHQudXNlci51cGRhdGVkQXQsXG4gICAgICAgIGNsaWVudDogcmVzdWx0LnVzZXIuY2xpZW50LFxuICAgICAgfSxcbiAgICAgIHRva2VuOiByZXN1bHQudG9rZW4sXG4gICAgICBtZXNzYWdlOiAnTG9naW4gc3VjY2Vzc2Z1bCcsXG4gICAgfTtcbiAgfVxuXG4gIC8vIFJlbW92ZWQgcmVmcmVzaCB0b2tlbiBlbmRwb2ludCAtIG5vIGxvbmdlciBuZWVkZWQgd2l0aCBub24tZXhwaXJpbmcgdG9rZW5zXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuICBAUG9zdCgnbG9nb3V0JylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIGxvZ291dChAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxTdWNjZXNzUmVzcG9uc2U+IHtcbiAgICBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLmxvZ291dCh1c2VySWQpO1xuICAgIHJldHVybiBuZXcgU3VjY2Vzc01lc3NhZ2VEdG8oJ0xvZ2dlZCBvdXQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH1cblxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbiAgQEdldCgncHJvZmlsZScpXG4gIGFzeW5jIGdldFByb2ZpbGUoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlclJlc3BvbnNlPiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmFsaWRhdGVVc2VyKHVzZXJJZCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIGZpcnN0TmFtZTogdXNlci5maXJzdE5hbWUgfHwgJycsXG4gICAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lIHx8ICcnLFxuICAgICAgICByb2xlOiB1c2VyLnJvbGUgYXMgYW55LFxuICAgICAgICBpc0VtYWlsVmVyaWZpZWQ6IHVzZXIuZW1haWxWZXJpZmllZCA/PyBmYWxzZSxcbiAgICAgICAgY3JlYXRlZEF0OiB1c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiB1c2VyLnVwZGF0ZWRBdCxcbiAgICAgICAgY2xpZW50OiB1c2VyLmNsaWVudCB8fCB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvLyA9PT09PSBTRUNVUkUgUk9MRSBDSEVDS0lORyBFTkRQT0lOVCA9PT09PVxuXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuICBAR2V0KCd1c2VyLXJvbGUnKVxuICBhc3luYyBnZXRVc2VyUm9sZShcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHsgcm9sZTogc3RyaW5nOyB1c2VySWQ6IHN0cmluZyB9PiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmFsaWRhdGVVc2VyKHVzZXJJZCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgfTtcbiAgfVxuXG4gIC8vIFJvbGUtc3BlY2lmaWMgcHJvZmlsZSBlbmRwb2ludHMgbW92ZWQgdG8gZGVkaWNhdGVkIGNvbnRyb2xsZXJzOlxuICAvLyAtIC9hdXRoL2NsaWVudC9wcm9maWxlXG4gIC8vIC0gL2F1dGgvdGhlcmFwaXN0L3Byb2ZpbGVcbiAgLy8gLSAvYXV0aC9hZG1pbi9wcm9maWxlXG4gIC8vIC0gL2F1dGgvbW9kZXJhdG9yL3Byb2ZpbGVcblxuICAvLyA9PT09PSBQQVNTV09SRCBSRVNFVCBFTkRQT0lOVFMgPT09PT1cblxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogNSwgdHRsOiAzMDAwMDAgfSB9KSAvLyA1IHJlc2V0IHJlcXVlc3RzIHBlciA1IG1pbnV0ZXNcbiAgQFBvc3QoJ3JlcXVlc3QtcGFzc3dvcmQtcmVzZXQnKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgcmVxdWVzdFBhc3N3b3JkUmVzZXQoXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFJlcXVlc3RQYXNzd29yZFJlc2V0RHRvU2NoZW1hKSlcbiAgICByZXF1ZXN0UmVzZXREdG86IFJlcXVlc3RQYXNzd29yZFJlc2V0RHRvLFxuICApOiBQcm9taXNlPFN1Y2Nlc3NSZXNwb25zZT4ge1xuICAgIGF3YWl0IHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UucmVxdWVzdFBhc3N3b3JkUmVzZXQocmVxdWVzdFJlc2V0RHRvLmVtYWlsKTtcbiAgICByZXR1cm4gbmV3IFN1Y2Nlc3NNZXNzYWdlRHRvKFxuICAgICAgJ0lmIGFuIGFjY291bnQgd2l0aCB0aGF0IGVtYWlsIGV4aXN0cywgd2Ugd2lsbCBzZW5kIGEgcGFzc3dvcmQgcmVzZXQgbGluay4nLFxuICAgICk7XG4gIH1cblxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogMTAsIHR0bDogMzAwMDAwIH0gfSkgLy8gMTAgcmVzZXQgYXR0ZW1wdHMgcGVyIDUgbWludXRlc1xuICBAUG9zdCgncmVzZXQtcGFzc3dvcmQnKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgcmVzZXRQYXNzd29yZChcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoUmVzZXRQYXNzd29yZER0b1NjaGVtYSkpXG4gICAgcmVzZXREdG86IFJlc2V0UGFzc3dvcmREdG8sXG4gICkge1xuICAgIC8vIFZhbGlkYXRlIHRoYXQgcGFzc3dvcmRzIG1hdGNoXG4gICAgaWYgKHJlc2V0RHRvLm5ld1Bhc3N3b3JkICE9PSByZXNldER0by5jb25maXJtUGFzc3dvcmQpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oJ1Bhc3N3b3JkcyBkbyBub3QgbWF0Y2gnKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBhc3N3b3JkUmVzZXRTZXJ2aWNlLnJlc2V0UGFzc3dvcmQoXG4gICAgICByZXNldER0by50b2tlbixcbiAgICAgIHJlc2V0RHRvLm5ld1Bhc3N3b3JkLFxuICAgICk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIEBQdWJsaWMoKVxuICBAR2V0KCd2YWxpZGF0ZS1yZXNldC10b2tlbicpXG4gIGFzeW5jIHZhbGlkYXRlUmVzZXRUb2tlbihAUXVlcnkoJ3Rva2VuJykgdG9rZW46IHN0cmluZykge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UudmFsaWRhdGVSZXNldFRva2VuKHRva2VuKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gPT09PT0gSldUIFRPS0VOIFZBTElEQVRJT04gRU5EUE9JTlQgPT09PT1cblxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogMTAwLCB0dGw6IDYwMDAwIH0gfSkgLy8gMTAwIHZhbGlkYXRpb24gcmVxdWVzdHMgcGVyIG1pbnV0ZVxuICBAUG9zdCgndmFsaWRhdGUtdG9rZW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgdmFsaWRhdGVUb2tlbihAQm9keSgpIGJvZHk6IHsgdG9rZW46IHN0cmluZyB9KSB7XG4gICAgaWYgKCFib2R5LnRva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdUb2tlbiBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UudmFsaWRhdGVUb2tlbihib2R5LnRva2VuKTtcblxuICAgIGlmICghcmVzdWx0LnZhbGlkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiByZXN1bHQuZXJyb3IsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgIHVzZXI6IHJlc3VsdC51c2VyLFxuICAgIH07XG4gIH1cblxuICAvLyA9PT09PSBVU0VSIEVYSVNURU5DRSBDSEVDSyBFTkRQT0lOVCA9PT09PVxuXG4gIEBQdWJsaWMoKVxuICBAVGhyb3R0bGUoeyBkZWZhdWx0OiB7IGxpbWl0OiAzMCwgdHRsOiA2MDAwMCB9IH0pIC8vIDMwIHJlcXVlc3RzIHBlciBtaW51dGVcbiAgQEdldCgnY2hlY2stdXNlcicpXG4gIGFzeW5jIGNoZWNrVXNlckV4aXN0cyhAUXVlcnkoJ2VtYWlsJykgZW1haWw6IHN0cmluZykge1xuICAgIGlmICghZW1haWwpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oJ0VtYWlsIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgLy8gQmFzaWMgZW1haWwgdmFsaWRhdGlvblxuICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcbiAgICBpZiAoIWVtYWlsUmVnZXgudGVzdChlbWFpbCkpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oJ0ludmFsaWQgZW1haWwgZm9ybWF0Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5jaGVja1VzZXJFeGlzdHMoZW1haWwpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyA9PT09PSBFTUFJTCBWRVJJRklDQVRJT04gRU5EUE9JTlRTID09PT09XG5cbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDMsIHR0bDogMzAwMDAwIH0gfSkgLy8gMyB2ZXJpZmljYXRpb24gZW1haWxzIHBlciA1IG1pbnV0ZXNcbiAgQFBvc3QoJ3NlbmQtdmVyaWZpY2F0aW9uLWVtYWlsJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHNlbmRWZXJpZmljYXRpb25FbWFpbChAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5lbWFpbFZlcmlmaWNhdGlvblNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkVtYWlsKHVzZXJJZCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2U6ICdWZXJpZmljYXRpb24gZW1haWwgc2VudCBzdWNjZXNzZnVsbHknLFxuICAgIH07XG4gIH1cblxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogNSwgdHRsOiAzMDAwMDAgfSB9KSAvLyA1IHJlc2VuZCBhdHRlbXB0cyBwZXIgNSBtaW51dGVzXG4gIEBQb3N0KCdyZXNlbmQtdmVyaWZpY2F0aW9uLWVtYWlsJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHJlc2VuZFZlcmlmaWNhdGlvbkVtYWlsKFxuICAgIEBCb2R5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShSZXNlbmRWZXJpZmljYXRpb25FbWFpbER0b1NjaGVtYSkpXG4gICAgcmVzZW5kRHRvOiBSZXNlbmRWZXJpZmljYXRpb25FbWFpbER0byxcbiAgKSB7XG4gICAgYXdhaXQgdGhpcy5lbWFpbFZlcmlmaWNhdGlvblNlcnZpY2UucmVzZW5kVmVyaWZpY2F0aW9uRW1haWwoXG4gICAgICByZXNlbmREdG8uZW1haWwsXG4gICAgKTtcbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZTpcbiAgICAgICAgJ0lmIGFuIGFjY291bnQgd2l0aCB0aGF0IGVtYWlsIGV4aXN0cywgd2Ugd2lsbCBzZW5kIGEgdmVyaWZpY2F0aW9uIGxpbmsuJyxcbiAgICB9O1xuICB9XG5cbiAgQFB1YmxpYygpXG4gIEBQb3N0KCd2ZXJpZnktZW1haWwnKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgdmVyaWZ5RW1haWwoXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFZlcmlmeUVtYWlsRHRvU2NoZW1hKSlcbiAgICB2ZXJpZnlEdG86IFZlcmlmeUVtYWlsRHRvLFxuICApIHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmVtYWlsVmVyaWZpY2F0aW9uU2VydmljZS52ZXJpZnlFbWFpbChcbiAgICAgIHZlcmlmeUR0by50b2tlbixcbiAgICApO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBHb29nbGUgT0F1dGggUm91dGVzXG4gIEBQdWJsaWMoKVxuICBAR2V0KCdnb29nbGUnKVxuICBAVXNlR3VhcmRzKEF1dGhHdWFyZCgnZ29vZ2xlJykpXG4gIGFzeW5jIGdvb2dsZUF1dGgoKSB7XG4gICAgLy8gSW5pdGlhdGVzIEdvb2dsZSBPQXV0aCBmbG93XG4gIH1cblxuICBAUHVibGljKClcbiAgQEdldCgnZ29vZ2xlL2NhbGxiYWNrJylcbiAgQFVzZUd1YXJkcyhBdXRoR3VhcmQoJ2dvb2dsZScpKVxuICBhc3luYyBnb29nbGVBdXRoUmVkaXJlY3QoQFJlcSgpIHJlcSwgQFJlcygpIHJlcywgQFF1ZXJ5KCkgcXVlcnkpIHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHJvbGUgZnJvbSBzdGF0ZSBwYXJhbWV0ZXIgaWYgcHJvdmlkZWQgKGZvciByb2xlLXNwZWNpZmljIE9BdXRoIGZsb3dzKVxuICAgICAgY29uc3Qgcm9sZSA9IHF1ZXJ5LnN0YXRlIHx8ICdjbGllbnQnOyAvLyBEZWZhdWx0IHRvIGNsaWVudCBpZiBubyByb2xlIHNwZWNpZmllZFxuXG4gICAgICAvLyBIYW5kbGUgR29vZ2xlIE9BdXRoIGNhbGxiYWNrIGFuZCBnZXQgdG9rZW5zXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLmhhbmRsZU9BdXRoTG9naW4oXG4gICAgICAgIHJlcS51c2VyLFxuICAgICAgICAnZ29vZ2xlJyxcbiAgICAgICAgcm9sZSxcbiAgICAgICk7XG5cbiAgICAgIC8vIEV4dHJhY3QgdG9rZW4gZnJvbSByZXN1bHRcbiAgICAgIGNvbnN0IHsgdG9rZW4gfSA9IHJlc3VsdDtcblxuICAgICAgLy8gRGV0ZXJtaW5lIGZyb250ZW5kIHJlZGlyZWN0IFVSTCBiYXNlZCBvbiBlbnZpcm9ubWVudFxuICAgICAgY29uc3QgZnJvbnRlbmRVcmwgPSBwcm9jZXNzLmVudi5GUk9OVEVORF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XG4gICAgICBjb25zdCByZWRpcmVjdFVybCA9IGAke2Zyb250ZW5kVXJsfS9zc28tY2FsbGJhY2s/dG9rZW49JHt0b2tlbn0mcm9sZT0ke3JvbGV9YDtcblxuICAgICAgLy8gUmVkaXJlY3QgdG8gZnJvbnRlbmQgd2l0aCB0b2tlbnMgaW4gVVJMIHBhcmFtZXRlcnNcbiAgICAgIHJldHVybiByZXMucmVkaXJlY3QocmVkaXJlY3RVcmwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHb29nbGUgT0F1dGggY2FsbGJhY2sgZXJyb3I6JywgZXJyb3IpO1xuXG4gICAgICAvLyBSZWRpcmVjdCB0byBmcm9udGVuZCB3aXRoIGVycm9yXG4gICAgICBjb25zdCBmcm9udGVuZFVybCA9IHByb2Nlc3MuZW52LkZST05URU5EX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbiAgICAgIGNvbnN0IGVycm9yVXJsID0gYCR7ZnJvbnRlbmRVcmx9L2F1dGgvc2lnbi1pbj9lcnJvcj1vYXV0aF9mYWlsZWQmcHJvdmlkZXI9Z29vZ2xlYDtcbiAgICAgIHJldHVybiByZXMucmVkaXJlY3QoZXJyb3JVcmwpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1pY3Jvc29mdCBPQXV0aCBSb3V0ZXNcbiAgQFB1YmxpYygpXG4gIEBHZXQoJ21pY3Jvc29mdCcpXG4gIEBVc2VHdWFyZHMoQXV0aEd1YXJkKCdtaWNyb3NvZnQnKSlcbiAgYXN5bmMgbWljcm9zb2Z0QXV0aCgpIHtcbiAgICAvLyBJbml0aWF0ZXMgTWljcm9zb2Z0IE9BdXRoIGZsb3dcbiAgfVxuXG4gIEBQdWJsaWMoKVxuICBAR2V0KCdtaWNyb3NvZnQvY2FsbGJhY2snKVxuICBAVXNlR3VhcmRzKEF1dGhHdWFyZCgnbWljcm9zb2Z0JykpXG4gIGFzeW5jIG1pY3Jvc29mdEF1dGhSZWRpcmVjdChAUmVxKCkgcmVxLCBAUmVzKCkgcmVzLCBAUXVlcnkoKSBxdWVyeSkge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgcm9sZSBmcm9tIHN0YXRlIHBhcmFtZXRlciBpZiBwcm92aWRlZCAoZm9yIHJvbGUtc3BlY2lmaWMgT0F1dGggZmxvd3MpXG4gICAgICBjb25zdCByb2xlID0gcXVlcnkuc3RhdGUgfHwgJ2NsaWVudCc7IC8vIERlZmF1bHQgdG8gY2xpZW50IGlmIG5vIHJvbGUgc3BlY2lmaWVkXG5cbiAgICAgIC8vIEhhbmRsZSBNaWNyb3NvZnQgT0F1dGggY2FsbGJhY2sgYW5kIGdldCB0b2tlbnNcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UuaGFuZGxlT0F1dGhMb2dpbihcbiAgICAgICAgcmVxLnVzZXIsXG4gICAgICAgICdtaWNyb3NvZnQnLFxuICAgICAgICByb2xlLFxuICAgICAgKTtcblxuICAgICAgLy8gRXh0cmFjdCB0b2tlbiBmcm9tIHJlc3VsdFxuICAgICAgY29uc3QgeyB0b2tlbiB9ID0gcmVzdWx0O1xuXG4gICAgICAvLyBEZXRlcm1pbmUgZnJvbnRlbmQgcmVkaXJlY3QgVVJMIGJhc2VkIG9uIGVudmlyb25tZW50XG4gICAgICBjb25zdCBmcm9udGVuZFVybCA9IHByb2Nlc3MuZW52LkZST05URU5EX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbiAgICAgIGNvbnN0IHJlZGlyZWN0VXJsID0gYCR7ZnJvbnRlbmRVcmx9L3Nzby1jYWxsYmFjaz90b2tlbj0ke3Rva2VufSZyb2xlPSR7cm9sZX1gO1xuXG4gICAgICAvLyBSZWRpcmVjdCB0byBmcm9udGVuZCB3aXRoIHRva2VucyBpbiBVUkwgcGFyYW1ldGVyc1xuICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdChyZWRpcmVjdFVybCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01pY3Jvc29mdCBPQXV0aCBjYWxsYmFjayBlcnJvcjonLCBlcnJvcik7XG5cbiAgICAgIC8vIFJlZGlyZWN0IHRvIGZyb250ZW5kIHdpdGggZXJyb3JcbiAgICAgIGNvbnN0IGZyb250ZW5kVXJsID0gcHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xuICAgICAgY29uc3QgZXJyb3JVcmwgPSBgJHtmcm9udGVuZFVybH0vYXV0aC9zaWduLWluP2Vycm9yPW9hdXRoX2ZhaWxlZCZwcm92aWRlcj1taWNyb3NvZnRgO1xuICAgICAgcmV0dXJuIHJlcy5yZWRpcmVjdChlcnJvclVybCk7XG4gICAgfVxuICB9XG5cbiAgLy8gT0F1dGggVG9rZW4gRXhjaGFuZ2UgQVBJIEVuZHBvaW50IChmb3IgZnJvbnRlbmQgdG8gY2FsbClcbiAgQFB1YmxpYygpXG4gIEBQb3N0KCdvYXV0aC90b2tlbi1leGNoYW5nZScpXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBhc3luYyBleGNoYW5nZU9BdXRoVG9rZW4oXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIHByb3ZpZGVyOiAnZ29vZ2xlJyB8ICdtaWNyb3NvZnQnO1xuICAgICAgY29kZTogc3RyaW5nO1xuICAgICAgc3RhdGU/OiBzdHJpbmc7XG4gICAgfSxcbiAgKSB7XG4gICAgY29uc3QgeyBwcm92aWRlciwgY29kZSB9ID0gYm9keTtcblxuICAgIGlmICghY29kZSkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignQXV0aG9yaXphdGlvbiBjb2RlIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCFbJ2dvb2dsZScsICdtaWNyb3NvZnQnXS5pbmNsdWRlcyhwcm92aWRlcikpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oJ0ludmFsaWQgT0F1dGggcHJvdmlkZXInKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gVE9ETzogSW1wbGVtZW50IHByb3BlciBPQXV0aCB0b2tlbiBleGNoYW5nZSB3aXRoIHByb3ZpZGVyIEFQSXNcbiAgICAgIC8vIFRoaXMgd291bGQgaW52b2x2ZSBleGNoYW5naW5nIHRoZSBhdXRob3JpemF0aW9uIGNvZGUgZm9yIGFuIGFjY2VzcyB0b2tlblxuICAgICAgLy8gYW5kIHRoZW4gZmV0Y2hpbmcgdXNlciBwcm9maWxlIGluZm9ybWF0aW9uIGZyb20gdGhlIE9BdXRoIHByb3ZpZGVyXG5cbiAgICAgIC8vIEZvciBub3csIHRoaXMgaXMgYSBwbGFjZWhvbGRlciB0aGF0IGV4cGVjdHMgdGhlIGZ1bGwgT0F1dGggZmxvd1xuICAgICAgLy8gdG8gYmUgaGFuZGxlZCBieSB0aGUgZXhpc3RpbmcgUGFzc3BvcnQgc3RyYXRlZ2llc1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcbiAgICAgICAgJ0RpcmVjdCB0b2tlbiBleGNoYW5nZSBub3QgeWV0IGltcGxlbWVudGVkLiBVc2UgT0F1dGggcmVkaXJlY3QgZmxvdy4nLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignT0F1dGggdG9rZW4gZXhjaGFuZ2UgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignT0F1dGggdG9rZW4gZXhjaGFuZ2UgZmFpbGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gUmVtb3ZlZCBzZXNzaW9uIG1hbmFnZW1lbnQgZW5kcG9pbnRzIC0gdXNpbmcgc2luZ2xlIHRva2VucyBub3dcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==