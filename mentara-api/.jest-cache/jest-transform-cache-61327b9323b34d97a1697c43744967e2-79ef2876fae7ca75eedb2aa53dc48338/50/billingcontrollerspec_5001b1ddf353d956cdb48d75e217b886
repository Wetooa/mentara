bbaaa0169d39de983bd2a7ae3ea82ed7
"use strict";
/**
 * Comprehensive Test Suite for BillingController
 * Tests all billing endpoints including subscriptions, payments, invoices, and discounts
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const billing_controller_1 = require("./billing.controller");
const billing_service_1 = require("./billing.service");
const enhanced_test_helpers_1 = require("../test-utils/enhanced-test-helpers");
const index_1 = require("../test-utils/index");
describe('BillingController', () => {
    let controller;
    let billingService;
    let module;
    // Mock BillingService
    const mockBillingService = {
        createSubscription: jest.fn(),
        findUserSubscription: jest.fn(),
        updateSubscription: jest.fn(),
        cancelSubscription: jest.fn(),
        changeSubscriptionPlan: jest.fn(),
        pauseSubscription: jest.fn(),
        resumeSubscription: jest.fn(),
        scheduleSubscriptionCancellation: jest.fn(),
        reactivateSubscription: jest.fn(),
        applyDiscountToSubscription: jest.fn(),
        processSubscriptionRenewal: jest.fn(),
        getSubscriptionUsageAnalytics: jest.fn(),
        findAllPlans: jest.fn(),
        createSubscriptionPlan: jest.fn(),
        updatePlan: jest.fn(),
        createPaymentMethod: jest.fn(),
        findUserPaymentMethods: jest.fn(),
        updatePaymentMethod: jest.fn(),
        deletePaymentMethod: jest.fn(),
        createPayment: jest.fn(),
        findPayments: jest.fn(),
        updatePaymentStatus: jest.fn(),
        createInvoice: jest.fn(),
        findInvoices: jest.fn(),
        markInvoiceAsPaid: jest.fn(),
        createDiscount: jest.fn(),
        validateDiscount: jest.fn(),
        redeemDiscount: jest.fn(),
        recordUsage: jest.fn(),
        getUsageRecords: jest.fn(),
        getBillingStatistics: jest.fn(),
    };
    // Mock JwtAuthGuard
    const mockJwtAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    // Test data
    const mockSubscription = {
        id: 'sub_123456789',
        userId: index_1.TEST_USER_IDS.CLIENT,
        planId: 'plan_basic_monthly',
        status: 'active',
        currentPeriodStart: new Date(),
        currentPeriodEnd: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockPlan = {
        id: 'plan_basic_monthly',
        name: 'Basic Monthly',
        description: 'Basic plan with monthly billing',
        amount: 29.99,
        currency: 'USD',
        interval: 'month',
        intervalCount: 1,
        isActive: true,
        features: ['therapy_sessions', 'basic_support'],
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockPaymentMethod = {
        id: 'pm_123456789',
        userId: index_1.TEST_USER_IDS.CLIENT,
        type: 'card',
        isDefault: true,
        last4: '4242',
        brand: 'visa',
        expiryMonth: 12,
        expiryYear: 2025,
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockPayment = {
        id: 'pay_123456789',
        subscriptionId: 'sub_123456789',
        amount: 29.99,
        currency: 'USD',
        status: 'succeeded',
        paymentMethodId: 'pm_123456789',
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockInvoice = {
        id: 'inv_123456789',
        subscriptionId: 'sub_123456789',
        amount: 29.99,
        currency: 'USD',
        status: 'paid',
        dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockDiscount = {
        id: 'disc_123456789',
        code: 'SAVE20',
        type: 'percentage',
        value: 20,
        isActive: true,
        usageLimit: 100,
        usageCount: 0,
        validFrom: new Date(),
        validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    beforeEach(async () => {
        module = await testing_1.Test.createTestingModule({
            controllers: [billing_controller_1.BillingController],
            providers: [
                {
                    provide: billing_service_1.BillingService,
                    useValue: mockBillingService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .compile();
        controller = module.get(billing_controller_1.BillingController);
        billingService = module.get(billing_service_1.BillingService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Controller Initialization', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have billingService injected', () => {
            expect(billingService).toBeDefined();
        });
    });
    describe('Security Guards', () => {
        it('should be protected by JwtAuthGuard', () => {
            const guards = Reflect.getMetadata('__guards__', billing_controller_1.BillingController);
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
        });
        it('should have proper route decorators', () => {
            const controllerMetadata = Reflect.getMetadata('path', billing_controller_1.BillingController);
            expect(controllerMetadata).toBe('billing');
        });
    });
    describe('Subscription Management', () => {
        describe('POST /billing/subscriptions', () => {
            const createSubscriptionDto = {
                planId: 'plan_basic_monthly',
                paymentMethodId: 'pm_123456789',
                trialStart: '2024-01-01T00:00:00.000Z',
                trialEnd: '2024-01-14T23:59:59.999Z',
            };
            it('should create subscription successfully', async () => {
                mockBillingService.createSubscription.mockResolvedValue(mockSubscription);
                const result = await controller.createSubscription(createSubscriptionDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockSubscription);
                expect(billingService.createSubscription).toHaveBeenCalledWith({
                    ...createSubscriptionDto,
                    userId: index_1.TEST_USER_IDS.CLIENT,
                    trialStart: new Date(createSubscriptionDto.trialStart),
                    trialEnd: new Date(createSubscriptionDto.trialEnd),
                });
            });
            it('should handle subscription creation without trial dates', async () => {
                const basicDto = {
                    planId: 'plan_basic_monthly',
                    paymentMethodId: 'pm_123456789',
                };
                mockBillingService.createSubscription.mockResolvedValue(mockSubscription);
                const result = await controller.createSubscription(basicDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockSubscription);
                expect(billingService.createSubscription).toHaveBeenCalledWith({
                    ...basicDto,
                    userId: index_1.TEST_USER_IDS.CLIENT,
                    trialStart: undefined,
                    trialEnd: undefined,
                });
            });
            it('should handle service errors', async () => {
                const serviceError = new Error('Payment method not found');
                mockBillingService.createSubscription.mockRejectedValue(serviceError);
                await expect(controller.createSubscription(createSubscriptionDto, index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(serviceError);
            });
        });
        describe('GET /billing/subscriptions/me', () => {
            it('should get user subscription successfully', async () => {
                mockBillingService.findUserSubscription.mockResolvedValue(mockSubscription);
                const result = await controller.getMySubscription(index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockSubscription);
                expect(billingService.findUserSubscription).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT);
            });
            it('should handle subscription not found', async () => {
                mockBillingService.findUserSubscription.mockResolvedValue(null);
                const result = await controller.getMySubscription(index_1.TEST_USER_IDS.CLIENT);
                expect(result).toBeNull();
            });
        });
        describe('PATCH /billing/subscriptions/me', () => {
            const updateDto = {
                billingCycle: 'monthly',
                autoRenew: true,
            };
            it('should update subscription successfully', async () => {
                const updatedSubscription = { ...mockSubscription, ...updateDto };
                mockBillingService.updateSubscription.mockResolvedValue(updatedSubscription);
                const result = await controller.updateMySubscription(updateDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(updatedSubscription);
                expect(billingService.updateSubscription).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT, updateDto);
            });
        });
        describe('POST /billing/subscriptions/me/cancel', () => {
            const cancelDto = {
                reason: 'No longer needed',
                cancelAtPeriodEnd: true,
            };
            it('should cancel subscription successfully', async () => {
                const cancelledSubscription = { ...mockSubscription, status: 'canceled' };
                mockBillingService.cancelSubscription.mockResolvedValue(cancelledSubscription);
                const result = await controller.cancelMySubscription(cancelDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(cancelledSubscription);
                expect(billingService.cancelSubscription).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT);
            });
        });
        describe('POST /billing/subscriptions/me/change-plan', () => {
            const changePlanDto = {
                newPlanId: 'plan_premium_monthly',
                billingCycle: 'monthly',
                prorationBehavior: 'always_invoice',
                effectiveDate: '2024-01-01T00:00:00.000Z',
            };
            it('should change subscription plan successfully', async () => {
                const updatedSubscription = { ...mockSubscription, planId: changePlanDto.newPlanId };
                mockBillingService.changeSubscriptionPlan.mockResolvedValue(updatedSubscription);
                const result = await controller.changeMySubscriptionPlan(changePlanDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(updatedSubscription);
                expect(billingService.changeSubscriptionPlan).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT, changePlanDto.newPlanId, {
                    billingCycle: changePlanDto.billingCycle,
                    prorationBehavior: changePlanDto.prorationBehavior,
                    effectiveDate: new Date(changePlanDto.effectiveDate),
                });
            });
        });
        describe('POST /billing/subscriptions/me/pause', () => {
            const pauseDto = {
                pauseUntil: '2024-02-01T00:00:00.000Z',
                reason: 'Temporary break',
            };
            it('should pause subscription successfully', async () => {
                const pausedSubscription = { ...mockSubscription, status: 'paused' };
                mockBillingService.pauseSubscription.mockResolvedValue(pausedSubscription);
                const result = await controller.pauseMySubscription(pauseDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(pausedSubscription);
                expect(billingService.pauseSubscription).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT, {
                    pauseUntil: new Date(pauseDto.pauseUntil),
                    reason: pauseDto.reason,
                });
            });
        });
        describe('POST /billing/subscriptions/me/resume', () => {
            it('should resume subscription successfully', async () => {
                const resumedSubscription = { ...mockSubscription, status: 'active' };
                mockBillingService.resumeSubscription.mockResolvedValue(resumedSubscription);
                const result = await controller.resumeMySubscription(index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(resumedSubscription);
                expect(billingService.resumeSubscription).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT);
            });
        });
    });
    describe('Plan Management', () => {
        describe('GET /billing/plans', () => {
            it('should get all active plans by default', async () => {
                const mockPlans = [mockPlan];
                mockBillingService.findAllPlans.mockResolvedValue(mockPlans);
                const result = await controller.getAllPlans({});
                expect(result).toEqual(mockPlans);
                expect(billingService.findAllPlans).toHaveBeenCalledWith(true);
            });
            it('should get all plans including inactive when specified', async () => {
                const mockPlans = [mockPlan, { ...mockPlan, isActive: false }];
                mockBillingService.findAllPlans.mockResolvedValue(mockPlans);
                const result = await controller.getAllPlans({ isActive: false });
                expect(result).toEqual(mockPlans);
                expect(billingService.findAllPlans).toHaveBeenCalledWith(false);
            });
        });
        describe('POST /billing/plans', () => {
            const createPlanDto = {
                name: 'Premium Monthly',
                description: 'Premium plan with monthly billing',
                amount: 99.99,
                currency: 'USD',
                interval: 'month',
                intervalCount: 1,
                features: ['unlimited_sessions', 'priority_support'],
            };
            it('should create plan as admin', async () => {
                mockBillingService.createSubscriptionPlan.mockResolvedValue(mockPlan);
                const result = await controller.createPlan(createPlanDto, 'admin');
                expect(result).toEqual(mockPlan);
                expect(billingService.createSubscriptionPlan).toHaveBeenCalledWith(createPlanDto);
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.createPlan(createPlanDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
        describe('PATCH /billing/plans/:id', () => {
            const updatePlanDto = {
                name: 'Updated Premium Monthly',
                amount: 79.99,
            };
            it('should update plan as admin', async () => {
                const updatedPlan = { ...mockPlan, ...updatePlanDto };
                mockBillingService.updatePlan.mockResolvedValue(updatedPlan);
                const result = await controller.updatePlan('plan_123', updatePlanDto, 'admin');
                expect(result).toEqual(updatedPlan);
                expect(billingService.updatePlan).toHaveBeenCalledWith('plan_123', updatePlanDto);
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.updatePlan('plan_123', updatePlanDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
    });
    describe('Payment Method Management', () => {
        describe('POST /billing/payment-methods', () => {
            const createPaymentMethodDto = {
                type: 'card',
                cardToken: 'tok_visa',
                isDefault: true,
            };
            it('should create payment method successfully', async () => {
                mockBillingService.createPaymentMethod.mockResolvedValue(mockPaymentMethod);
                const result = await controller.createPaymentMethod(createPaymentMethodDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockPaymentMethod);
                expect(billingService.createPaymentMethod).toHaveBeenCalledWith({
                    ...createPaymentMethodDto,
                    userId: index_1.TEST_USER_IDS.CLIENT,
                });
            });
        });
        describe('GET /billing/payment-methods', () => {
            it('should get user payment methods', async () => {
                const mockPaymentMethods = [mockPaymentMethod];
                mockBillingService.findUserPaymentMethods.mockResolvedValue(mockPaymentMethods);
                const result = await controller.getMyPaymentMethods(index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(mockPaymentMethods);
                expect(billingService.findUserPaymentMethods).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT);
            });
        });
        describe('PATCH /billing/payment-methods/:id', () => {
            const updatePaymentMethodDto = {
                isDefault: false,
                expiryMonth: 6,
                expiryYear: 2026,
            };
            it('should update payment method successfully', async () => {
                const updatedPaymentMethod = { ...mockPaymentMethod, ...updatePaymentMethodDto };
                mockBillingService.updatePaymentMethod.mockResolvedValue(updatedPaymentMethod);
                const result = await controller.updatePaymentMethod('pm_123', updatePaymentMethodDto);
                expect(result).toEqual(updatedPaymentMethod);
                expect(billingService.updatePaymentMethod).toHaveBeenCalledWith('pm_123', updatePaymentMethodDto);
            });
        });
        describe('DELETE /billing/payment-methods/:id', () => {
            it('should delete payment method successfully', async () => {
                mockBillingService.deletePaymentMethod.mockResolvedValue({ success: true });
                const result = await controller.deletePaymentMethod('pm_123');
                expect(result).toEqual({ success: true });
                expect(billingService.deletePaymentMethod).toHaveBeenCalledWith('pm_123');
            });
        });
    });
    describe('Payment Management', () => {
        describe('POST /billing/payments', () => {
            const createPaymentDto = {
                subscriptionId: 'sub_123456789',
                amount: 29.99,
                currency: 'USD',
                paymentMethodId: 'pm_123456789',
            };
            it('should create payment successfully', async () => {
                mockBillingService.createPayment.mockResolvedValue(mockPayment);
                const result = await controller.createPayment(createPaymentDto);
                expect(result).toEqual(mockPayment);
                expect(billingService.createPayment).toHaveBeenCalledWith(createPaymentDto);
            });
        });
        describe('GET /billing/payments', () => {
            const paymentsQuery = {
                subscriptionId: 'sub_123456789',
                status: 'succeeded',
                startDate: '2024-01-01T00:00:00.000Z',
                endDate: '2024-01-31T23:59:59.999Z',
            };
            it('should get payments as admin', async () => {
                const mockPayments = [mockPayment];
                mockBillingService.findPayments.mockResolvedValue(mockPayments);
                const result = await controller.getPayments('admin', paymentsQuery);
                expect(result).toEqual(mockPayments);
                expect(billingService.findPayments).toHaveBeenCalledWith(paymentsQuery.subscriptionId, paymentsQuery.status, new Date(paymentsQuery.startDate), new Date(paymentsQuery.endDate));
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.getPayments('client', paymentsQuery)).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
        describe('PATCH /billing/payments/:id/status', () => {
            const updateStatusDto = {
                status: 'succeeded',
                metadata: { processor: 'stripe' },
            };
            it('should update payment status as admin', async () => {
                const updatedPayment = { ...mockPayment, ...updateStatusDto };
                mockBillingService.updatePaymentStatus.mockResolvedValue(updatedPayment);
                const result = await controller.updatePaymentStatus('pay_123', updateStatusDto, 'admin');
                expect(result).toEqual(updatedPayment);
                expect(billingService.updatePaymentStatus).toHaveBeenCalledWith('pay_123', updateStatusDto.status, updateStatusDto.metadata);
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.updatePaymentStatus('pay_123', updateStatusDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
    });
    describe('Invoice Management', () => {
        describe('POST /billing/invoices', () => {
            const createInvoiceDto = {
                subscriptionId: 'sub_123456789',
                amount: 29.99,
                currency: 'USD',
                dueDate: '2024-02-01T00:00:00.000Z',
                description: 'Monthly subscription fee',
            };
            it('should create invoice as admin', async () => {
                mockBillingService.createInvoice.mockResolvedValue(mockInvoice);
                const result = await controller.createInvoice(createInvoiceDto, 'admin');
                expect(result).toEqual(mockInvoice);
                expect(billingService.createInvoice).toHaveBeenCalledWith({
                    ...createInvoiceDto,
                    dueDate: new Date(createInvoiceDto.dueDate),
                });
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.createInvoice(createInvoiceDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
        describe('GET /billing/invoices', () => {
            const invoicesQuery = {
                subscriptionId: 'sub_123456789',
                status: 'paid',
            };
            it('should get invoices successfully', async () => {
                const mockInvoices = [mockInvoice];
                mockBillingService.findInvoices.mockResolvedValue(mockInvoices);
                const result = await controller.getInvoices('admin', index_1.TEST_USER_IDS.CLIENT, invoicesQuery);
                expect(result).toEqual(mockInvoices);
                expect(billingService.findInvoices).toHaveBeenCalledWith(invoicesQuery.subscriptionId, invoicesQuery.status);
            });
        });
        describe('POST /billing/invoices/:id/pay', () => {
            const markPaidDto = {
                paymentId: 'pay_123456789',
                paidAt: '2024-01-15T12:00:00.000Z',
            };
            it('should mark invoice as paid as admin', async () => {
                const paidInvoice = { ...mockInvoice, status: 'paid' };
                mockBillingService.markInvoiceAsPaid.mockResolvedValue(paidInvoice);
                const result = await controller.markInvoiceAsPaid('inv_123', markPaidDto, 'admin');
                expect(result).toEqual(paidInvoice);
                expect(billingService.markInvoiceAsPaid).toHaveBeenCalledWith('inv_123');
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.markInvoiceAsPaid('inv_123', markPaidDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
    });
    describe('Discount Management', () => {
        describe('POST /billing/discounts', () => {
            const createDiscountDto = {
                code: 'SAVE30',
                type: 'percentage',
                value: 30,
                usageLimit: 50,
                validFrom: '2024-01-01T00:00:00.000Z',
                validUntil: '2024-12-31T23:59:59.999Z',
            };
            it('should create discount as admin', async () => {
                mockBillingService.createDiscount.mockResolvedValue(mockDiscount);
                const result = await controller.createDiscount(createDiscountDto, 'admin');
                expect(result).toEqual(mockDiscount);
                expect(billingService.createDiscount).toHaveBeenCalledWith({
                    ...createDiscountDto,
                    validFrom: new Date(createDiscountDto.validFrom),
                    validUntil: new Date(createDiscountDto.validUntil),
                });
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.createDiscount(createDiscountDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
        describe('POST /billing/discounts/validate', () => {
            const validateDto = {
                code: 'SAVE20',
                amount: 29.99,
            };
            it('should validate discount successfully', async () => {
                const validationResult = {
                    isValid: true,
                    discount: mockDiscount,
                    discountAmount: 5.99,
                };
                mockBillingService.validateDiscount.mockResolvedValue(validationResult);
                const result = await controller.validateDiscount(validateDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(validationResult);
                expect(billingService.validateDiscount).toHaveBeenCalledWith(validateDto.code, index_1.TEST_USER_IDS.CLIENT, validateDto.amount);
            });
        });
        describe('POST /billing/discounts/:id/redeem', () => {
            const redeemDto = {
                amountSaved: 5.99,
            };
            it('should redeem discount successfully', async () => {
                const redeemResult = {
                    success: true,
                    discount: mockDiscount,
                    amountSaved: redeemDto.amountSaved,
                };
                mockBillingService.redeemDiscount.mockResolvedValue(redeemResult);
                const result = await controller.redeemDiscount('disc_123', redeemDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(redeemResult);
                expect(billingService.redeemDiscount).toHaveBeenCalledWith('disc_123', index_1.TEST_USER_IDS.CLIENT, redeemDto.amountSaved);
            });
        });
    });
    describe('Usage Tracking', () => {
        describe('POST /billing/usage', () => {
            const recordUsageDto = {
                subscriptionId: 'sub_123456789',
                feature: 'therapy_sessions',
                quantity: 1,
                usageDate: '2024-01-15T14:30:00.000Z',
            };
            it('should record usage as admin', async () => {
                const usageRecord = {
                    id: 'usage_123456789',
                    ...recordUsageDto,
                    usageDate: new Date(recordUsageDto.usageDate),
                };
                mockBillingService.recordUsage.mockResolvedValue(usageRecord);
                const result = await controller.recordUsage(recordUsageDto, 'admin');
                expect(result).toEqual(usageRecord);
                expect(billingService.recordUsage).toHaveBeenCalledWith({
                    ...recordUsageDto,
                    usageDate: new Date(recordUsageDto.usageDate),
                });
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.recordUsage(recordUsageDto, 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
        describe('GET /billing/usage/:subscriptionId', () => {
            const usageQuery = {
                feature: 'therapy_sessions',
                startDate: '2024-01-01T00:00:00.000Z',
                endDate: '2024-01-31T23:59:59.999Z',
            };
            it('should get usage records for admin', async () => {
                const mockUsageRecords = [
                    {
                        id: 'usage_123456789',
                        subscriptionId: 'sub_123456789',
                        feature: 'therapy_sessions',
                        quantity: 5,
                        usageDate: new Date(),
                    },
                ];
                mockBillingService.getUsageRecords.mockResolvedValue(mockUsageRecords);
                const result = await controller.getUsageRecords('sub_123456789', 'admin', usageQuery);
                expect(result).toEqual(mockUsageRecords);
                expect(billingService.getUsageRecords).toHaveBeenCalledWith('sub_123456789', usageQuery.feature, new Date(usageQuery.startDate), new Date(usageQuery.endDate));
            });
        });
    });
    describe('Statistics', () => {
        describe('GET /billing/statistics', () => {
            const statsQuery = {
                startDate: '2024-01-01T00:00:00.000Z',
                endDate: '2024-01-31T23:59:59.999Z',
            };
            it('should get billing statistics as admin', async () => {
                const mockStatistics = {
                    totalRevenue: 15000.00,
                    activeSubscriptions: 120,
                    cancelledSubscriptions: 15,
                    averageRevenuePer: 125.00,
                    monthlyGrowthRate: 8.5,
                };
                mockBillingService.getBillingStatistics.mockResolvedValue(mockStatistics);
                const result = await controller.getBillingStatistics('admin', statsQuery);
                expect(result).toEqual(mockStatistics);
                expect(billingService.getBillingStatistics).toHaveBeenCalledWith(new Date(statsQuery.startDate), new Date(statsQuery.endDate));
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.getBillingStatistics('client', statsQuery)).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
    });
    describe('Advanced Subscription Features', () => {
        describe('POST /billing/subscriptions/me/apply-discount', () => {
            const applyDiscountDto = {
                discountCode: 'SAVE20',
            };
            it('should apply discount to subscription successfully', async () => {
                const updatedSubscription = { ...mockSubscription, discountApplied: true };
                mockBillingService.applyDiscountToSubscription.mockResolvedValue(updatedSubscription);
                const result = await controller.applyDiscountToMySubscription(applyDiscountDto, index_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual(updatedSubscription);
                expect(billingService.applyDiscountToSubscription).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT, applyDiscountDto.discountCode);
            });
        });
        describe('POST /billing/subscriptions/:id/renew', () => {
            it('should process subscription renewal as admin', async () => {
                const renewedSubscription = { ...mockSubscription, renewedAt: new Date() };
                mockBillingService.processSubscriptionRenewal.mockResolvedValue(renewedSubscription);
                const result = await controller.processSubscriptionRenewal('sub_123456789', 'admin');
                expect(result).toEqual(renewedSubscription);
                expect(billingService.processSubscriptionRenewal).toHaveBeenCalledWith('sub_123456789');
            });
            it('should throw unauthorized error for non-admin users', async () => {
                await expect(controller.processSubscriptionRenewal('sub_123456789', 'client')).rejects.toThrow(common_1.UnauthorizedException);
            });
        });
        describe('GET /billing/subscriptions/:id/usage-analytics', () => {
            const analyticsQuery = {
                startDate: '2024-01-01T00:00:00.000Z',
                endDate: '2024-01-31T23:59:59.999Z',
            };
            it('should get subscription usage analytics', async () => {
                const mockAnalytics = {
                    totalUsage: 25,
                    featureBreakdown: {
                        therapy_sessions: 20,
                        support_tickets: 5,
                    },
                    utilizationRate: 83.3,
                };
                mockBillingService.getSubscriptionUsageAnalytics.mockResolvedValue(mockAnalytics);
                const result = await controller.getSubscriptionUsageAnalytics('sub_123456789', 'admin', index_1.TEST_USER_IDS.CLIENT, analyticsQuery);
                expect(result).toEqual(mockAnalytics);
                expect(billingService.getSubscriptionUsageAnalytics).toHaveBeenCalledWith('sub_123456789', new Date(analyticsQuery.startDate), new Date(analyticsQuery.endDate));
            });
        });
    });
    describe('Error Handling', () => {
        it('should handle service unavailable scenarios', async () => {
            const serviceError = new Error('Service temporarily unavailable');
            mockBillingService.findUserSubscription.mockRejectedValue(serviceError);
            await expect(controller.getMySubscription(index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(serviceError);
        });
        it('should handle payment processing failures', async () => {
            const paymentError = new Error('Payment processing failed');
            mockBillingService.createPayment.mockRejectedValue(paymentError);
            await expect(controller.createPayment({
                subscriptionId: 'sub_123456789',
                amount: 29.99,
                currency: 'USD',
                paymentMethodId: 'pm_123456789',
            })).rejects.toThrow(paymentError);
        });
        it('should handle invalid discount codes', async () => {
            const invalidDiscountError = new Error('Invalid discount code');
            mockBillingService.validateDiscount.mockRejectedValue(invalidDiscountError);
            await expect(controller.validateDiscount({ code: 'INVALID', amount: 29.99 }, index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(invalidDiscountError);
        });
        it('should handle subscription limits exceeded', async () => {
            const limitError = new Error('Subscription limit exceeded');
            mockBillingService.createSubscription.mockRejectedValue(limitError);
            await expect(controller.createSubscription({ planId: 'plan_basic_monthly', paymentMethodId: 'pm_123456789' }, index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(limitError);
        });
    });
    describe('Response Format Validation', () => {
        it('should return properly formatted subscription response', async () => {
            mockBillingService.findUserSubscription.mockResolvedValue(mockSubscription);
            const result = await controller.getMySubscription(index_1.TEST_USER_IDS.CLIENT);
            enhanced_test_helpers_1.TestAssertions.expectValidEntity(result, ['id', 'userId', 'planId', 'status']);
            expect(result.id).toBe(mockSubscription.id);
            expect(result.userId).toBe(index_1.TEST_USER_IDS.CLIENT);
        });
        it('should return properly formatted payment method response', async () => {
            const mockPaymentMethods = [mockPaymentMethod];
            mockBillingService.findUserPaymentMethods.mockResolvedValue(mockPaymentMethods);
            const result = await controller.getMyPaymentMethods(index_1.TEST_USER_IDS.CLIENT);
            expect(Array.isArray(result)).toBe(true);
            if (result.length > 0) {
                enhanced_test_helpers_1.TestAssertions.expectValidEntity(result[0], ['id', 'userId', 'type', 'isDefault']);
            }
        });
        it('should return properly formatted billing statistics', async () => {
            const mockStats = {
                totalRevenue: 15000.00,
                activeSubscriptions: 120,
                cancelledSubscriptions: 15,
                averageRevenuePer: 125.00,
                monthlyGrowthRate: 8.5,
            };
            mockBillingService.getBillingStatistics.mockResolvedValue(mockStats);
            const result = await controller.getBillingStatistics('admin', {});
            expect(typeof result.totalRevenue).toBe('number');
            expect(typeof result.activeSubscriptions).toBe('number');
            expect(typeof result.monthlyGrowthRate).toBe('number');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2JpbGxpbmcvYmlsbGluZy5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCw2Q0FBc0Q7QUFDdEQsMkNBQXVEO0FBQ3ZELGtFQUE2RDtBQUM3RCw2REFBeUQ7QUFDekQsdURBQW1EO0FBRW5ELCtFQUFxRztBQUNyRywrQ0FBaUU7QUFFakUsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLFVBQTZCLENBQUM7SUFDbEMsSUFBSSxjQUE4QixDQUFDO0lBQ25DLElBQUksTUFBcUIsQ0FBQztJQUUxQixzQkFBc0I7SUFDdEIsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzdCLG9CQUFvQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDL0Isa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM3QixrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzdCLHNCQUFzQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM1QixrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzdCLGdDQUFnQyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDM0Msc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNqQywyQkFBMkIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3RDLDBCQUEwQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDckMsNkJBQTZCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN4QyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN2QixzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pDLFVB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QUNsRCxNQUFNLENBQUMsT0FBTyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDekQsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYmlsbGluZy9iaWxsaW5nLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbXByZWhlbnNpdmUgVGVzdCBTdWl0ZSBmb3IgQmlsbGluZ0NvbnRyb2xsZXJcbiAqIFRlc3RzIGFsbCBiaWxsaW5nIGVuZHBvaW50cyBpbmNsdWRpbmcgc3Vic2NyaXB0aW9ucywgcGF5bWVudHMsIGludm9pY2VzLCBhbmQgZGlzY291bnRzXG4gKi9cblxuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBVbmF1dGhvcml6ZWRFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBCaWxsaW5nQ29udHJvbGxlciB9IGZyb20gJy4vYmlsbGluZy5jb250cm9sbGVyJztcbmltcG9ydCB7IEJpbGxpbmdTZXJ2aWNlIH0gZnJvbSAnLi9iaWxsaW5nLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2VjdXJpdHlHdWFyZFRlc3RVdGlscywgUm9sZUJhc2VkVGVzdFV0aWxzIH0gZnJvbSAnLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQgeyBNb2NrQnVpbGRlciwgVGVzdERhdGFHZW5lcmF0b3IsIFRlc3RBc3NlcnRpb25zIH0gZnJvbSAnLi4vdGVzdC11dGlscy9lbmhhbmNlZC10ZXN0LWhlbHBlcnMnO1xuaW1wb3J0IHsgVEVTVF9VU0VSX0lEUywgVEVTVF9FTUFJTFMgfSBmcm9tICcuLi90ZXN0LXV0aWxzL2luZGV4JztcblxuZGVzY3JpYmUoJ0JpbGxpbmdDb250cm9sbGVyJywgKCkgPT4ge1xuICBsZXQgY29udHJvbGxlcjogQmlsbGluZ0NvbnRyb2xsZXI7XG4gIGxldCBiaWxsaW5nU2VydmljZTogQmlsbGluZ1NlcnZpY2U7XG4gIGxldCBtb2R1bGU6IFRlc3RpbmdNb2R1bGU7XG5cbiAgLy8gTW9jayBCaWxsaW5nU2VydmljZVxuICBjb25zdCBtb2NrQmlsbGluZ1NlcnZpY2UgPSB7XG4gICAgY3JlYXRlU3Vic2NyaXB0aW9uOiBqZXN0LmZuKCksXG4gICAgZmluZFVzZXJTdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICB1cGRhdGVTdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICBjYW5jZWxTdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICBjaGFuZ2VTdWJzY3JpcHRpb25QbGFuOiBqZXN0LmZuKCksXG4gICAgcGF1c2VTdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICByZXN1bWVTdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICBzY2hlZHVsZVN1YnNjcmlwdGlvbkNhbmNlbGxhdGlvbjogamVzdC5mbigpLFxuICAgIHJlYWN0aXZhdGVTdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICBhcHBseURpc2NvdW50VG9TdWJzY3JpcHRpb246IGplc3QuZm4oKSxcbiAgICBwcm9jZXNzU3Vic2NyaXB0aW9uUmVuZXdhbDogamVzdC5mbigpLFxuICAgIGdldFN1YnNjcmlwdGlvblVzYWdlQW5hbHl0aWNzOiBqZXN0LmZuKCksXG4gICAgZmluZEFsbFBsYW5zOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlU3Vic2NyaXB0aW9uUGxhbjogamVzdC5mbigpLFxuICAgIHVwZGF0ZVBsYW46IGplc3QuZm4oKSxcbiAgICBjcmVhdGVQYXltZW50TWV0aG9kOiBqZXN0LmZuKCksXG4gICAgZmluZFVzZXJQYXltZW50TWV0aG9kczogamVzdC5mbigpLFxuICAgIHVwZGF0ZVBheW1lbnRNZXRob2Q6IGplc3QuZm4oKSxcbiAgICBkZWxldGVQYXltZW50TWV0aG9kOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlUGF5bWVudDogamVzdC5mbigpLFxuICAgIGZpbmRQYXltZW50czogamVzdC5mbigpLFxuICAgIHVwZGF0ZVBheW1lbnRTdGF0dXM6IGplc3QuZm4oKSxcbiAgICBjcmVhdGVJbnZvaWNlOiBqZXN0LmZuKCksXG4gICAgZmluZEludm9pY2VzOiBqZXN0LmZuKCksXG4gICAgbWFya0ludm9pY2VBc1BhaWQ6IGplc3QuZm4oKSxcbiAgICBjcmVhdGVEaXNjb3VudDogamVzdC5mbigpLFxuICAgIHZhbGlkYXRlRGlzY291bnQ6IGplc3QuZm4oKSxcbiAgICByZWRlZW1EaXNjb3VudDogamVzdC5mbigpLFxuICAgIHJlY29yZFVzYWdlOiBqZXN0LmZuKCksXG4gICAgZ2V0VXNhZ2VSZWNvcmRzOiBqZXN0LmZuKCksXG4gICAgZ2V0QmlsbGluZ1N0YXRpc3RpY3M6IGplc3QuZm4oKSxcbiAgfTtcblxuICAvLyBNb2NrIEp3dEF1dGhHdWFyZFxuICBjb25zdCBtb2NrSnd0QXV0aEd1YXJkID0ge1xuICAgIGNhbkFjdGl2YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICB9O1xuXG4gIC8vIFRlc3QgZGF0YVxuICBjb25zdCBtb2NrU3Vic2NyaXB0aW9uID0ge1xuICAgIGlkOiAnc3ViXzEyMzQ1Njc4OScsXG4gICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICBwbGFuSWQ6ICdwbGFuX2Jhc2ljX21vbnRobHknLFxuICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgY3VycmVudFBlcmlvZFN0YXJ0OiBuZXcgRGF0ZSgpLFxuICAgIGN1cnJlbnRQZXJpb2RFbmQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1BsYW4gPSB7XG4gICAgaWQ6ICdwbGFuX2Jhc2ljX21vbnRobHknLFxuICAgIG5hbWU6ICdCYXNpYyBNb250aGx5JyxcbiAgICBkZXNjcmlwdGlvbjogJ0Jhc2ljIHBsYW4gd2l0aCBtb250aGx5IGJpbGxpbmcnLFxuICAgIGFtb3VudDogMjkuOTksXG4gICAgY3VycmVuY3k6ICdVU0QnLFxuICAgIGludGVydmFsOiAnbW9udGgnLFxuICAgIGludGVydmFsQ291bnQ6IDEsXG4gICAgaXNBY3RpdmU6IHRydWUsXG4gICAgZmVhdHVyZXM6IFsndGhlcmFweV9zZXNzaW9ucycsICdiYXNpY19zdXBwb3J0J10sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgfTtcblxuICBjb25zdCBtb2NrUGF5bWVudE1ldGhvZCA9IHtcbiAgICBpZDogJ3BtXzEyMzQ1Njc4OScsXG4gICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICB0eXBlOiAnY2FyZCcsXG4gICAgaXNEZWZhdWx0OiB0cnVlLFxuICAgIGxhc3Q0OiAnNDI0MicsXG4gICAgYnJhbmQ6ICd2aXNhJyxcbiAgICBleHBpcnlNb250aDogMTIsXG4gICAgZXhwaXJ5WWVhcjogMjAyNSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tQYXltZW50ID0ge1xuICAgIGlkOiAncGF5XzEyMzQ1Njc4OScsXG4gICAgc3Vic2NyaXB0aW9uSWQ6ICdzdWJfMTIzNDU2Nzg5JyxcbiAgICBhbW91bnQ6IDI5Ljk5LFxuICAgIGN1cnJlbmN5OiAnVVNEJyxcbiAgICBzdGF0dXM6ICdzdWNjZWVkZWQnLFxuICAgIHBheW1lbnRNZXRob2RJZDogJ3BtXzEyMzQ1Njc4OScsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgfTtcblxuICBjb25zdCBtb2NrSW52b2ljZSA9IHtcbiAgICBpZDogJ2ludl8xMjM0NTY3ODknLFxuICAgIHN1YnNjcmlwdGlvbklkOiAnc3ViXzEyMzQ1Njc4OScsXG4gICAgYW1vdW50OiAyOS45OSxcbiAgICBjdXJyZW5jeTogJ1VTRCcsXG4gICAgc3RhdHVzOiAncGFpZCcsXG4gICAgZHVlRGF0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSArIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tEaXNjb3VudCA9IHtcbiAgICBpZDogJ2Rpc2NfMTIzNDU2Nzg5JyxcbiAgICBjb2RlOiAnU0FWRTIwJyxcbiAgICB0eXBlOiAncGVyY2VudGFnZScsXG4gICAgdmFsdWU6IDIwLFxuICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgIHVzYWdlTGltaXQ6IDEwMCxcbiAgICB1c2FnZUNvdW50OiAwLFxuICAgIHZhbGlkRnJvbTogbmV3IERhdGUoKSxcbiAgICB2YWxpZFVudGlsOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIG1vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW0JpbGxpbmdDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQmlsbGluZ1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tCaWxsaW5nU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgICAgIC5vdmVycmlkZUd1YXJkKEp3dEF1dGhHdWFyZClcbiAgICAgIC51c2VWYWx1ZShtb2NrSnd0QXV0aEd1YXJkKVxuICAgICAgLmNvbXBpbGUoKTtcblxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PEJpbGxpbmdDb250cm9sbGVyPihCaWxsaW5nQ29udHJvbGxlcik7XG4gICAgYmlsbGluZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0PEJpbGxpbmdTZXJ2aWNlPihCaWxsaW5nU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb250cm9sbGVyIEluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGJpbGxpbmdTZXJ2aWNlIGluamVjdGVkJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgR3VhcmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgcHJvdGVjdGVkIGJ5IEp3dEF1dGhHdWFyZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGd1YXJkcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fZ3VhcmRzX18nLCBCaWxsaW5nQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoZ3VhcmRzKS50b0NvbnRhaW4oSnd0QXV0aEd1YXJkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBwcm9wZXIgcm91dGUgZGVjb3JhdG9ycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRyb2xsZXJNZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ3BhdGgnLCBCaWxsaW5nQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoY29udHJvbGxlck1ldGFkYXRhKS50b0JlKCdiaWxsaW5nJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdWJzY3JpcHRpb24gTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9zdWJzY3JpcHRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlU3Vic2NyaXB0aW9uRHRvID0ge1xuICAgICAgICBwbGFuSWQ6ICdwbGFuX2Jhc2ljX21vbnRobHknLFxuICAgICAgICBwYXltZW50TWV0aG9kSWQ6ICdwbV8xMjM0NTY3ODknLFxuICAgICAgICB0cmlhbFN0YXJ0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgdHJpYWxFbmQ6ICcyMDI0LTAxLTE0VDIzOjU5OjU5Ljk5OVonLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3Vic2NyaXB0aW9uIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmNyZWF0ZVN1YnNjcmlwdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZVN1YnNjcmlwdGlvbihcbiAgICAgICAgICBjcmVhdGVTdWJzY3JpcHRpb25EdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlRcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tTdWJzY3JpcHRpb24pO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuY3JlYXRlU3Vic2NyaXB0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgLi4uY3JlYXRlU3Vic2NyaXB0aW9uRHRvLFxuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgdHJpYWxTdGFydDogbmV3IERhdGUoY3JlYXRlU3Vic2NyaXB0aW9uRHRvLnRyaWFsU3RhcnQpLFxuICAgICAgICAgIHRyaWFsRW5kOiBuZXcgRGF0ZShjcmVhdGVTdWJzY3JpcHRpb25EdG8udHJpYWxFbmQpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdWJzY3JpcHRpb24gY3JlYXRpb24gd2l0aG91dCB0cmlhbCBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgYmFzaWNEdG8gPSB7XG4gICAgICAgICAgcGxhbklkOiAncGxhbl9iYXNpY19tb250aGx5JyxcbiAgICAgICAgICBwYXltZW50TWV0aG9kSWQ6ICdwbV8xMjM0NTY3ODknLFxuICAgICAgICB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuY3JlYXRlU3Vic2NyaXB0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdWJzY3JpcHRpb24pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlU3Vic2NyaXB0aW9uKFxuICAgICAgICAgIGJhc2ljRHRvLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5UXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU3Vic2NyaXB0aW9uKTtcbiAgICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlLmNyZWF0ZVN1YnNjcmlwdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIC4uLmJhc2ljRHRvLFxuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgdHJpYWxTdGFydDogdW5kZWZpbmVkLFxuICAgICAgICAgIHRyaWFsRW5kOiB1bmRlZmluZWQsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ1BheW1lbnQgbWV0aG9kIG5vdCBmb3VuZCcpO1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuY3JlYXRlU3Vic2NyaXB0aW9uLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlU3Vic2NyaXB0aW9uKGNyZWF0ZVN1YnNjcmlwdGlvbkR0bywgVEVTVF9VU0VSX0lEUy5DTElFTlQpXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdHRVQgL2JpbGxpbmcvc3Vic2NyaXB0aW9ucy9tZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IHVzZXIgc3Vic2NyaXB0aW9uIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmZpbmRVc2VyU3Vic2NyaXB0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdWJzY3JpcHRpb24pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0TXlTdWJzY3JpcHRpb24oVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1N1YnNjcmlwdGlvbik7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5maW5kVXNlclN1YnNjcmlwdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHN1YnNjcmlwdGlvbiBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5maW5kVXNlclN1YnNjcmlwdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE15U3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUEFUQ0ggL2JpbGxpbmcvc3Vic2NyaXB0aW9ucy9tZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZUR0byA9IHtcbiAgICAgICAgYmlsbGluZ0N5Y2xlOiAnbW9udGhseScgYXMgY29uc3QsXG4gICAgICAgIGF1dG9SZW5ldzogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgdXBkYXRlIHN1YnNjcmlwdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRTdWJzY3JpcHRpb24gPSB7IC4uLm1vY2tTdWJzY3JpcHRpb24sIC4uLnVwZGF0ZUR0byB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UudXBkYXRlU3Vic2NyaXB0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHVwZGF0ZWRTdWJzY3JpcHRpb24pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlTXlTdWJzY3JpcHRpb24oXG4gICAgICAgICAgdXBkYXRlRHRvLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5UXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkU3Vic2NyaXB0aW9uKTtcbiAgICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlLnVwZGF0ZVN1YnNjcmlwdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgdXBkYXRlRHRvXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdQT1NUIC9iaWxsaW5nL3N1YnNjcmlwdGlvbnMvbWUvY2FuY2VsJywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FuY2VsRHRvID0ge1xuICAgICAgICByZWFzb246ICdObyBsb25nZXIgbmVlZGVkJyxcbiAgICAgICAgY2FuY2VsQXRQZXJpb2RFbmQ6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBpdCgnc2hvdWxkIGNhbmNlbCBzdWJzY3JpcHRpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjYW5jZWxsZWRTdWJzY3JpcHRpb24gPSB7IC4uLm1vY2tTdWJzY3JpcHRpb24sIHN0YXR1czogJ2NhbmNlbGVkJyB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuY2FuY2VsU3Vic2NyaXB0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKGNhbmNlbGxlZFN1YnNjcmlwdGlvbik7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jYW5jZWxNeVN1YnNjcmlwdGlvbihcbiAgICAgICAgICBjYW5jZWxEdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlRcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGNhbmNlbGxlZFN1YnNjcmlwdGlvbik7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5jYW5jZWxTdWJzY3JpcHRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1BPU1QgL2JpbGxpbmcvc3Vic2NyaXB0aW9ucy9tZS9jaGFuZ2UtcGxhbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGNoYW5nZVBsYW5EdG8gPSB7XG4gICAgICAgIG5ld1BsYW5JZDogJ3BsYW5fcHJlbWl1bV9tb250aGx5JyxcbiAgICAgICAgYmlsbGluZ0N5Y2xlOiAnbW9udGhseScgYXMgY29uc3QsXG4gICAgICAgIHByb3JhdGlvbkJlaGF2aW9yOiAnYWx3YXlzX2ludm9pY2UnIGFzIGNvbnN0LFxuICAgICAgICBlZmZlY3RpdmVEYXRlOiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgY2hhbmdlIHN1YnNjcmlwdGlvbiBwbGFuIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdXBkYXRlZFN1YnNjcmlwdGlvbiA9IHsgLi4ubW9ja1N1YnNjcmlwdGlvbiwgcGxhbklkOiBjaGFuZ2VQbGFuRHRvLm5ld1BsYW5JZCB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuY2hhbmdlU3Vic2NyaXB0aW9uUGxhbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNoYW5nZU15U3Vic2NyaXB0aW9uUGxhbihcbiAgICAgICAgICBjaGFuZ2VQbGFuRHRvLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5UXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkU3Vic2NyaXB0aW9uKTtcbiAgICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlLmNoYW5nZVN1YnNjcmlwdGlvblBsYW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIGNoYW5nZVBsYW5EdG8ubmV3UGxhbklkLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGJpbGxpbmdDeWNsZTogY2hhbmdlUGxhbkR0by5iaWxsaW5nQ3ljbGUsXG4gICAgICAgICAgICBwcm9yYXRpb25CZWhhdmlvcjogY2hhbmdlUGxhbkR0by5wcm9yYXRpb25CZWhhdmlvcixcbiAgICAgICAgICAgIGVmZmVjdGl2ZURhdGU6IG5ldyBEYXRlKGNoYW5nZVBsYW5EdG8uZWZmZWN0aXZlRGF0ZSksXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9zdWJzY3JpcHRpb25zL21lL3BhdXNlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF1c2VEdG8gPSB7XG4gICAgICAgIHBhdXNlVW50aWw6ICcyMDI0LTAyLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICByZWFzb246ICdUZW1wb3JhcnkgYnJlYWsnLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBwYXVzZSBzdWJzY3JpcHRpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwYXVzZWRTdWJzY3JpcHRpb24gPSB7IC4uLm1vY2tTdWJzY3JpcHRpb24sIHN0YXR1czogJ3BhdXNlZCcgfTtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLnBhdXNlU3Vic2NyaXB0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHBhdXNlZFN1YnNjcmlwdGlvbik7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5wYXVzZU15U3Vic2NyaXB0aW9uKFxuICAgICAgICAgIHBhdXNlRHRvLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5UXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwYXVzZWRTdWJzY3JpcHRpb24pO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UucGF1c2VTdWJzY3JpcHRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHBhdXNlVW50aWw6IG5ldyBEYXRlKHBhdXNlRHRvLnBhdXNlVW50aWwpLFxuICAgICAgICAgICAgcmVhc29uOiBwYXVzZUR0by5yZWFzb24sXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9zdWJzY3JpcHRpb25zL21lL3Jlc3VtZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmVzdW1lIHN1YnNjcmlwdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VtZWRTdWJzY3JpcHRpb24gPSB7IC4uLm1vY2tTdWJzY3JpcHRpb24sIHN0YXR1czogJ2FjdGl2ZScgfTtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLnJlc3VtZVN1YnNjcmlwdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZShyZXN1bWVkU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlc3VtZU15U3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHJlc3VtZWRTdWJzY3JpcHRpb24pO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UucmVzdW1lU3Vic2NyaXB0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BsYW4gTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnR0VUIC9iaWxsaW5nL3BsYW5zJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBnZXQgYWxsIGFjdGl2ZSBwbGFucyBieSBkZWZhdWx0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUGxhbnMgPSBbbW9ja1BsYW5dO1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuZmluZEFsbFBsYW5zLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQbGFucyk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBbGxQbGFucyh7fSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGxhbnMpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuZmluZEFsbFBsYW5zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGdldCBhbGwgcGxhbnMgaW5jbHVkaW5nIGluYWN0aXZlIHdoZW4gc3BlY2lmaWVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUGxhbnMgPSBbbW9ja1BsYW4sIHsgLi4ubW9ja1BsYW4sIGlzQWN0aXZlOiBmYWxzZSB9XTtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmZpbmRBbGxQbGFucy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGxhbnMpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QWxsUGxhbnMoeyBpc0FjdGl2ZTogZmFsc2UgfSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGxhbnMpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuZmluZEFsbFBsYW5zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdQT1NUIC9iaWxsaW5nL3BsYW5zJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlUGxhbkR0byA9IHtcbiAgICAgICAgbmFtZTogJ1ByZW1pdW0gTW9udGhseScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUHJlbWl1bSBwbGFuIHdpdGggbW9udGhseSBiaWxsaW5nJyxcbiAgICAgICAgYW1vdW50OiA5OS45OSxcbiAgICAgICAgY3VycmVuY3k6ICdVU0QnLFxuICAgICAgICBpbnRlcnZhbDogJ21vbnRoJyBhcyBjb25zdCxcbiAgICAgICAgaW50ZXJ2YWxDb3VudDogMSxcbiAgICAgICAgZmVhdHVyZXM6IFsndW5saW1pdGVkX3Nlc3Npb25zJywgJ3ByaW9yaXR5X3N1cHBvcnQnXSxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIHBsYW4gYXMgYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb25QbGFuLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQbGFuKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZVBsYW4oY3JlYXRlUGxhbkR0bywgJ2FkbWluJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGxhbik7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb25QbGFuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjcmVhdGVQbGFuRHRvKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IHVuYXV0aG9yaXplZCBlcnJvciBmb3Igbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgY29udHJvbGxlci5jcmVhdGVQbGFuKGNyZWF0ZVBsYW5EdG8sICdjbGllbnQnKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUEFUQ0ggL2JpbGxpbmcvcGxhbnMvOmlkJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlUGxhbkR0byA9IHtcbiAgICAgICAgbmFtZTogJ1VwZGF0ZWQgUHJlbWl1bSBNb250aGx5JyxcbiAgICAgICAgYW1vdW50OiA3OS45OSxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgdXBkYXRlIHBsYW4gYXMgYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQbGFuID0geyAuLi5tb2NrUGxhbiwgLi4udXBkYXRlUGxhbkR0byB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UudXBkYXRlUGxhbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkUGxhbik7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVQbGFuKCdwbGFuXzEyMycsIHVwZGF0ZVBsYW5EdG8sICdhZG1pbicpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZFBsYW4pO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UudXBkYXRlUGxhbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3BsYW5fMTIzJywgdXBkYXRlUGxhbkR0byk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyB1bmF1dGhvcml6ZWQgZXJyb3IgZm9yIG5vbi1hZG1pbiB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIGNvbnRyb2xsZXIudXBkYXRlUGxhbigncGxhbl8xMjMnLCB1cGRhdGVQbGFuRHRvLCAnY2xpZW50JylcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGF5bWVudCBNZXRob2QgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9wYXltZW50LW1ldGhvZHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVQYXltZW50TWV0aG9kRHRvID0ge1xuICAgICAgICB0eXBlOiAnY2FyZCcgYXMgY29uc3QsXG4gICAgICAgIGNhcmRUb2tlbjogJ3Rva192aXNhJyxcbiAgICAgICAgaXNEZWZhdWx0OiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcGF5bWVudCBtZXRob2Qgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuY3JlYXRlUGF5bWVudE1ldGhvZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bWVudE1ldGhvZCk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVQYXltZW50TWV0aG9kKFxuICAgICAgICAgIGNyZWF0ZVBheW1lbnRNZXRob2REdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlRcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQYXltZW50TWV0aG9kKTtcbiAgICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlLmNyZWF0ZVBheW1lbnRNZXRob2QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICAuLi5jcmVhdGVQYXltZW50TWV0aG9kRHRvLFxuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnR0VUIC9iaWxsaW5nL3BheW1lbnQtbWV0aG9kcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IHVzZXIgcGF5bWVudCBtZXRob2RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUGF5bWVudE1ldGhvZHMgPSBbbW9ja1BheW1lbnRNZXRob2RdO1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuZmluZFVzZXJQYXltZW50TWV0aG9kcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bWVudE1ldGhvZHMpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0TXlQYXltZW50TWV0aG9kcyhURVNUX1VTRVJfSURTLkNMSUVOVCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGF5bWVudE1ldGhvZHMpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuZmluZFVzZXJQYXltZW50TWV0aG9kcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUEFUQ0ggL2JpbGxpbmcvcGF5bWVudC1tZXRob2RzLzppZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZVBheW1lbnRNZXRob2REdG8gPSB7XG4gICAgICAgIGlzRGVmYXVsdDogZmFsc2UsXG4gICAgICAgIGV4cGlyeU1vbnRoOiA2LFxuICAgICAgICBleHBpcnlZZWFyOiAyMDI2LFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCB1cGRhdGUgcGF5bWVudCBtZXRob2Qgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1cGRhdGVkUGF5bWVudE1ldGhvZCA9IHsgLi4ubW9ja1BheW1lbnRNZXRob2QsIC4uLnVwZGF0ZVBheW1lbnRNZXRob2REdG8gfTtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLnVwZGF0ZVBheW1lbnRNZXRob2QubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZFBheW1lbnRNZXRob2QpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlUGF5bWVudE1ldGhvZCgncG1fMTIzJywgdXBkYXRlUGF5bWVudE1ldGhvZER0byk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkUGF5bWVudE1ldGhvZCk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS51cGRhdGVQYXltZW50TWV0aG9kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAncG1fMTIzJyxcbiAgICAgICAgICB1cGRhdGVQYXltZW50TWV0aG9kRHRvXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdERUxFVEUgL2JpbGxpbmcvcGF5bWVudC1tZXRob2RzLzppZCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgZGVsZXRlIHBheW1lbnQgbWV0aG9kIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmRlbGV0ZVBheW1lbnRNZXRob2QubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZGVsZXRlUGF5bWVudE1ldGhvZCgncG1fMTIzJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5kZWxldGVQYXltZW50TWV0aG9kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncG1fMTIzJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BheW1lbnQgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9wYXltZW50cycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZVBheW1lbnREdG8gPSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbklkOiAnc3ViXzEyMzQ1Njc4OScsXG4gICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgIGN1cnJlbmN5OiAnVVNEJyxcbiAgICAgICAgcGF5bWVudE1ldGhvZElkOiAncG1fMTIzNDU2Nzg5JyxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIHBheW1lbnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuY3JlYXRlUGF5bWVudC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bWVudCk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVQYXltZW50KGNyZWF0ZVBheW1lbnREdG8pO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1BheW1lbnQpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuY3JlYXRlUGF5bWVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY3JlYXRlUGF5bWVudER0byk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdHRVQgL2JpbGxpbmcvcGF5bWVudHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXltZW50c1F1ZXJ5ID0ge1xuICAgICAgICBzdWJzY3JpcHRpb25JZDogJ3N1Yl8xMjM0NTY3ODknLFxuICAgICAgICBzdGF0dXM6ICdzdWNjZWVkZWQnIGFzIGNvbnN0LFxuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBlbmREYXRlOiAnMjAyNC0wMS0zMVQyMzo1OTo1OS45OTlaJyxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgZ2V0IHBheW1lbnRzIGFzIGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrUGF5bWVudHMgPSBbbW9ja1BheW1lbnRdO1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuZmluZFBheW1lbnRzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYXltZW50cyk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRQYXltZW50cygnYWRtaW4nLCBwYXltZW50c1F1ZXJ5KTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQYXltZW50cyk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5maW5kUGF5bWVudHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIHBheW1lbnRzUXVlcnkuc3Vic2NyaXB0aW9uSWQsXG4gICAgICAgICAgcGF5bWVudHNRdWVyeS5zdGF0dXMsXG4gICAgICAgICAgbmV3IERhdGUocGF5bWVudHNRdWVyeS5zdGFydERhdGUpLFxuICAgICAgICAgIG5ldyBEYXRlKHBheW1lbnRzUXVlcnkuZW5kRGF0ZSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IHVuYXV0aG9yaXplZCBlcnJvciBmb3Igbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgY29udHJvbGxlci5nZXRQYXltZW50cygnY2xpZW50JywgcGF5bWVudHNRdWVyeSlcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1BBVENIIC9iaWxsaW5nL3BheW1lbnRzLzppZC9zdGF0dXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVTdGF0dXNEdG8gPSB7XG4gICAgICAgIHN0YXR1czogJ3N1Y2NlZWRlZCcgYXMgY29uc3QsXG4gICAgICAgIG1ldGFkYXRhOiB7IHByb2Nlc3NvcjogJ3N0cmlwZScgfSxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgdXBkYXRlIHBheW1lbnQgc3RhdHVzIGFzIGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1cGRhdGVkUGF5bWVudCA9IHsgLi4ubW9ja1BheW1lbnQsIC4uLnVwZGF0ZVN0YXR1c0R0byB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UudXBkYXRlUGF5bWVudFN0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkUGF5bWVudCk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVQYXltZW50U3RhdHVzKFxuICAgICAgICAgICdwYXlfMTIzJyxcbiAgICAgICAgICB1cGRhdGVTdGF0dXNEdG8sXG4gICAgICAgICAgJ2FkbWluJ1xuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZFBheW1lbnQpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UudXBkYXRlUGF5bWVudFN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ3BheV8xMjMnLFxuICAgICAgICAgIHVwZGF0ZVN0YXR1c0R0by5zdGF0dXMsXG4gICAgICAgICAgdXBkYXRlU3RhdHVzRHRvLm1ldGFkYXRhXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aHJvdyB1bmF1dGhvcml6ZWQgZXJyb3IgZm9yIG5vbi1hZG1pbiB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIGNvbnRyb2xsZXIudXBkYXRlUGF5bWVudFN0YXR1cygncGF5XzEyMycsIHVwZGF0ZVN0YXR1c0R0bywgJ2NsaWVudCcpXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEV4Y2VwdGlvbik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludm9pY2UgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9pbnZvaWNlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWF0ZUludm9pY2VEdG8gPSB7XG4gICAgICAgIHN1YnNjcmlwdGlvbklkOiAnc3ViXzEyMzQ1Njc4OScsXG4gICAgICAgIGFtb3VudDogMjkuOTksXG4gICAgICAgIGN1cnJlbmN5OiAnVVNEJyxcbiAgICAgICAgZHVlRGF0ZTogJzIwMjQtMDItMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTW9udGhseSBzdWJzY3JpcHRpb24gZmVlJyxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGludm9pY2UgYXMgYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5jcmVhdGVJbnZvaWNlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJbnZvaWNlKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZUludm9pY2UoY3JlYXRlSW52b2ljZUR0bywgJ2FkbWluJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrSW52b2ljZSk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5jcmVhdGVJbnZvaWNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgLi4uY3JlYXRlSW52b2ljZUR0byxcbiAgICAgICAgICBkdWVEYXRlOiBuZXcgRGF0ZShjcmVhdGVJbnZvaWNlRHRvLmR1ZURhdGUpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IHVuYXV0aG9yaXplZCBlcnJvciBmb3Igbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgY29udHJvbGxlci5jcmVhdGVJbnZvaWNlKGNyZWF0ZUludm9pY2VEdG8sICdjbGllbnQnKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnR0VUIC9iaWxsaW5nL2ludm9pY2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52b2ljZXNRdWVyeSA9IHtcbiAgICAgICAgc3Vic2NyaXB0aW9uSWQ6ICdzdWJfMTIzNDU2Nzg5JyxcbiAgICAgICAgc3RhdHVzOiAncGFpZCcgYXMgY29uc3QsXG4gICAgICB9O1xuXG4gICAgICBpdCgnc2hvdWxkIGdldCBpbnZvaWNlcyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tJbnZvaWNlcyA9IFttb2NrSW52b2ljZV07XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5maW5kSW52b2ljZXMubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ludm9pY2VzKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldEludm9pY2VzKFxuICAgICAgICAgICdhZG1pbicsXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgaW52b2ljZXNRdWVyeVxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0ludm9pY2VzKTtcbiAgICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlLmZpbmRJbnZvaWNlcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgaW52b2ljZXNRdWVyeS5zdWJzY3JpcHRpb25JZCxcbiAgICAgICAgICBpbnZvaWNlc1F1ZXJ5LnN0YXR1c1xuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9pbnZvaWNlcy86aWQvcGF5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbWFya1BhaWREdG8gPSB7XG4gICAgICAgIHBheW1lbnRJZDogJ3BheV8xMjM0NTY3ODknLFxuICAgICAgICBwYWlkQXQ6ICcyMDI0LTAxLTE1VDEyOjAwOjAwLjAwMFonLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBtYXJrIGludm9pY2UgYXMgcGFpZCBhcyBhZG1pbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcGFpZEludm9pY2UgPSB7IC4uLm1vY2tJbnZvaWNlLCBzdGF0dXM6ICdwYWlkJyB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UubWFya0ludm9pY2VBc1BhaWQubW9ja1Jlc29sdmVkVmFsdWUocGFpZEludm9pY2UpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubWFya0ludm9pY2VBc1BhaWQoJ2ludl8xMjMnLCBtYXJrUGFpZER0bywgJ2FkbWluJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwYWlkSW52b2ljZSk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5tYXJrSW52b2ljZUFzUGFpZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ludl8xMjMnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IHVuYXV0aG9yaXplZCBlcnJvciBmb3Igbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgY29udHJvbGxlci5tYXJrSW52b2ljZUFzUGFpZCgnaW52XzEyMycsIG1hcmtQYWlkRHRvLCAnY2xpZW50JylcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGlzY291bnQgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9kaXNjb3VudHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVEaXNjb3VudER0byA9IHtcbiAgICAgICAgY29kZTogJ1NBVkUzMCcsXG4gICAgICAgIHR5cGU6ICdwZXJjZW50YWdlJyBhcyBjb25zdCxcbiAgICAgICAgdmFsdWU6IDMwLFxuICAgICAgICB1c2FnZUxpbWl0OiA1MCxcbiAgICAgICAgdmFsaWRGcm9tOiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgdmFsaWRVbnRpbDogJzIwMjQtMTItMzFUMjM6NTk6NTkuOTk5WicsXG4gICAgICB9O1xuXG4gICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBkaXNjb3VudCBhcyBhZG1pbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmNyZWF0ZURpc2NvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEaXNjb3VudCk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVEaXNjb3VudChjcmVhdGVEaXNjb3VudER0bywgJ2FkbWluJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRGlzY291bnQpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuY3JlYXRlRGlzY291bnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICAuLi5jcmVhdGVEaXNjb3VudER0byxcbiAgICAgICAgICB2YWxpZEZyb206IG5ldyBEYXRlKGNyZWF0ZURpc2NvdW50RHRvLnZhbGlkRnJvbSksXG4gICAgICAgICAgdmFsaWRVbnRpbDogbmV3IERhdGUoY3JlYXRlRGlzY291bnREdG8udmFsaWRVbnRpbCksXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgdW5hdXRob3JpemVkIGVycm9yIGZvciBub24tYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBjb250cm9sbGVyLmNyZWF0ZURpc2NvdW50KGNyZWF0ZURpc2NvdW50RHRvLCAnY2xpZW50JylcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1BPU1QgL2JpbGxpbmcvZGlzY291bnRzL3ZhbGlkYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGVEdG8gPSB7XG4gICAgICAgIGNvZGU6ICdTQVZFMjAnLFxuICAgICAgICBhbW91bnQ6IDI5Ljk5LFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBkaXNjb3VudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgICAgICBkaXNjb3VudDogbW9ja0Rpc2NvdW50LFxuICAgICAgICAgIGRpc2NvdW50QW1vdW50OiA1Ljk5LFxuICAgICAgICB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UudmFsaWRhdGVEaXNjb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZSh2YWxpZGF0aW9uUmVzdWx0KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnZhbGlkYXRlRGlzY291bnQodmFsaWRhdGVEdG8sIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHZhbGlkYXRpb25SZXN1bHQpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UudmFsaWRhdGVEaXNjb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgdmFsaWRhdGVEdG8uY29kZSxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICB2YWxpZGF0ZUR0by5hbW91bnRcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1BPU1QgL2JpbGxpbmcvZGlzY291bnRzLzppZC9yZWRlZW0nLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWRlZW1EdG8gPSB7XG4gICAgICAgIGFtb3VudFNhdmVkOiA1Ljk5LFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCByZWRlZW0gZGlzY291bnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZWRlZW1SZXN1bHQgPSB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBkaXNjb3VudDogbW9ja0Rpc2NvdW50LFxuICAgICAgICAgIGFtb3VudFNhdmVkOiByZWRlZW1EdG8uYW1vdW50U2F2ZWQsXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5yZWRlZW1EaXNjb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZShyZWRlZW1SZXN1bHQpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIucmVkZWVtRGlzY291bnQoXG4gICAgICAgICAgJ2Rpc2NfMTIzJyxcbiAgICAgICAgICByZWRlZW1EdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlRcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHJlZGVlbVJlc3VsdCk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5yZWRlZW1EaXNjb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ2Rpc2NfMTIzJyxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICByZWRlZW1EdG8uYW1vdW50U2F2ZWRcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNhZ2UgVHJhY2tpbmcnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ1BPU1QgL2JpbGxpbmcvdXNhZ2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNvcmRVc2FnZUR0byA9IHtcbiAgICAgICAgc3Vic2NyaXB0aW9uSWQ6ICdzdWJfMTIzNDU2Nzg5JyxcbiAgICAgICAgZmVhdHVyZTogJ3RoZXJhcHlfc2Vzc2lvbnMnLFxuICAgICAgICBxdWFudGl0eTogMSxcbiAgICAgICAgdXNhZ2VEYXRlOiAnMjAyNC0wMS0xNVQxNDozMDowMC4wMDBaJyxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgcmVjb3JkIHVzYWdlIGFzIGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1c2FnZVJlY29yZCA9IHtcbiAgICAgICAgICBpZDogJ3VzYWdlXzEyMzQ1Njc4OScsXG4gICAgICAgICAgLi4ucmVjb3JkVXNhZ2VEdG8sXG4gICAgICAgICAgdXNhZ2VEYXRlOiBuZXcgRGF0ZShyZWNvcmRVc2FnZUR0by51c2FnZURhdGUpLFxuICAgICAgICB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UucmVjb3JkVXNhZ2UubW9ja1Jlc29sdmVkVmFsdWUodXNhZ2VSZWNvcmQpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIucmVjb3JkVXNhZ2UocmVjb3JkVXNhZ2VEdG8sICdhZG1pbicpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXNhZ2VSZWNvcmQpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UucmVjb3JkVXNhZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICAuLi5yZWNvcmRVc2FnZUR0byxcbiAgICAgICAgICB1c2FnZURhdGU6IG5ldyBEYXRlKHJlY29yZFVzYWdlRHRvLnVzYWdlRGF0ZSksXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgdW5hdXRob3JpemVkIGVycm9yIGZvciBub24tYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBjb250cm9sbGVyLnJlY29yZFVzYWdlKHJlY29yZFVzYWdlRHRvLCAnY2xpZW50JylcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0dFVCAvYmlsbGluZy91c2FnZS86c3Vic2NyaXB0aW9uSWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2FnZVF1ZXJ5ID0ge1xuICAgICAgICBmZWF0dXJlOiAndGhlcmFweV9zZXNzaW9ucycsXG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTAxLTMxVDIzOjU5OjU5Ljk5OVonLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBnZXQgdXNhZ2UgcmVjb3JkcyBmb3IgYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tVc2FnZVJlY29yZHMgPSBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICd1c2FnZV8xMjM0NTY3ODknLFxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uSWQ6ICdzdWJfMTIzNDU2Nzg5JyxcbiAgICAgICAgICAgIGZlYXR1cmU6ICd0aGVyYXB5X3Nlc3Npb25zJyxcbiAgICAgICAgICAgIHF1YW50aXR5OiA1LFxuICAgICAgICAgICAgdXNhZ2VEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5nZXRVc2FnZVJlY29yZHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzYWdlUmVjb3Jkcyk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2FnZVJlY29yZHMoXG4gICAgICAgICAgJ3N1Yl8xMjM0NTY3ODknLFxuICAgICAgICAgICdhZG1pbicsXG4gICAgICAgICAgdXNhZ2VRdWVyeVxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzYWdlUmVjb3Jkcyk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5nZXRVc2FnZVJlY29yZHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICdzdWJfMTIzNDU2Nzg5JyxcbiAgICAgICAgICB1c2FnZVF1ZXJ5LmZlYXR1cmUsXG4gICAgICAgICAgbmV3IERhdGUodXNhZ2VRdWVyeS5zdGFydERhdGUpLFxuICAgICAgICAgIG5ldyBEYXRlKHVzYWdlUXVlcnkuZW5kRGF0ZSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3RhdGlzdGljcycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnR0VUIC9iaWxsaW5nL3N0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0c1F1ZXJ5ID0ge1xuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxVDAwOjAwOjAwLjAwMFonLFxuICAgICAgICBlbmREYXRlOiAnMjAyNC0wMS0zMVQyMzo1OTo1OS45OTlaJyxcbiAgICAgIH07XG5cbiAgICAgIGl0KCdzaG91bGQgZ2V0IGJpbGxpbmcgc3RhdGlzdGljcyBhcyBhZG1pbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja1N0YXRpc3RpY3MgPSB7XG4gICAgICAgICAgdG90YWxSZXZlbnVlOiAxNTAwMC4wMCxcbiAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zOiAxMjAsXG4gICAgICAgICAgY2FuY2VsbGVkU3Vic2NyaXB0aW9uczogMTUsXG4gICAgICAgICAgYXZlcmFnZVJldmVudWVQZXI6IDEyNS4wMCxcbiAgICAgICAgICBtb250aGx5R3Jvd3RoUmF0ZTogOC41LFxuICAgICAgICB9O1xuICAgICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuZ2V0QmlsbGluZ1N0YXRpc3RpY3MubW9ja1Jlc29sdmVkVmFsdWUobW9ja1N0YXRpc3RpY3MpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QmlsbGluZ1N0YXRpc3RpY3MoJ2FkbWluJywgc3RhdHNRdWVyeSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU3RhdGlzdGljcyk7XG4gICAgICAgIGV4cGVjdChiaWxsaW5nU2VydmljZS5nZXRCaWxsaW5nU3RhdGlzdGljcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgbmV3IERhdGUoc3RhdHNRdWVyeS5zdGFydERhdGUpLFxuICAgICAgICAgIG5ldyBEYXRlKHN0YXRzUXVlcnkuZW5kRGF0ZSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRocm93IHVuYXV0aG9yaXplZCBlcnJvciBmb3Igbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgY29udHJvbGxlci5nZXRCaWxsaW5nU3RhdGlzdGljcygnY2xpZW50Jywgc3RhdHNRdWVyeSlcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coVW5hdXRob3JpemVkRXhjZXB0aW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWR2YW5jZWQgU3Vic2NyaXB0aW9uIEZlYXR1cmVzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdQT1NUIC9iaWxsaW5nL3N1YnNjcmlwdGlvbnMvbWUvYXBwbHktZGlzY291bnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhcHBseURpc2NvdW50RHRvID0ge1xuICAgICAgICBkaXNjb3VudENvZGU6ICdTQVZFMjAnLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBhcHBseSBkaXNjb3VudCB0byBzdWJzY3JpcHRpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1cGRhdGVkU3Vic2NyaXB0aW9uID0geyAuLi5tb2NrU3Vic2NyaXB0aW9uLCBkaXNjb3VudEFwcGxpZWQ6IHRydWUgfTtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmFwcGx5RGlzY291bnRUb1N1YnNjcmlwdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmFwcGx5RGlzY291bnRUb015U3Vic2NyaXB0aW9uKFxuICAgICAgICAgIGFwcGx5RGlzY291bnREdG8sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlRcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRTdWJzY3JpcHRpb24pO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuYXBwbHlEaXNjb3VudFRvU3Vic2NyaXB0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBhcHBseURpc2NvdW50RHRvLmRpc2NvdW50Q29kZVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnUE9TVCAvYmlsbGluZy9zdWJzY3JpcHRpb25zLzppZC9yZW5ldycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcHJvY2VzcyBzdWJzY3JpcHRpb24gcmVuZXdhbCBhcyBhZG1pbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVuZXdlZFN1YnNjcmlwdGlvbiA9IHsgLi4ubW9ja1N1YnNjcmlwdGlvbiwgcmVuZXdlZEF0OiBuZXcgRGF0ZSgpIH07XG4gICAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5wcm9jZXNzU3Vic2NyaXB0aW9uUmVuZXdhbC5tb2NrUmVzb2x2ZWRWYWx1ZShyZW5ld2VkU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnByb2Nlc3NTdWJzY3JpcHRpb25SZW5ld2FsKCdzdWJfMTIzNDU2Nzg5JywgJ2FkbWluJyk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChyZW5ld2VkU3Vic2NyaXB0aW9uKTtcbiAgICAgICAgZXhwZWN0KGJpbGxpbmdTZXJ2aWNlLnByb2Nlc3NTdWJzY3JpcHRpb25SZW5ld2FsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc3ViXzEyMzQ1Njc4OScpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdGhyb3cgdW5hdXRob3JpemVkIGVycm9yIGZvciBub24tYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICBjb250cm9sbGVyLnByb2Nlc3NTdWJzY3JpcHRpb25SZW5ld2FsKCdzdWJfMTIzNDU2Nzg5JywgJ2NsaWVudCcpXG4gICAgICAgICkucmVqZWN0cy50b1Rocm93KFVuYXV0aG9yaXplZEV4Y2VwdGlvbik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdHRVQgL2JpbGxpbmcvc3Vic2NyaXB0aW9ucy86aWQvdXNhZ2UtYW5hbHl0aWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgYW5hbHl0aWNzUXVlcnkgPSB7XG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTAxLTMxVDIzOjU5OjU5Ljk5OVonLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBnZXQgc3Vic2NyaXB0aW9uIHVzYWdlIGFuYWx5dGljcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0FuYWx5dGljcyA9IHtcbiAgICAgICAgICB0b3RhbFVzYWdlOiAyNSxcbiAgICAgICAgICBmZWF0dXJlQnJlYWtkb3duOiB7XG4gICAgICAgICAgICB0aGVyYXB5X3Nlc3Npb25zOiAyMCxcbiAgICAgICAgICAgIHN1cHBvcnRfdGlja2V0czogNSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHV0aWxpemF0aW9uUmF0ZTogODMuMyxcbiAgICAgICAgfTtcbiAgICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmdldFN1YnNjcmlwdGlvblVzYWdlQW5hbHl0aWNzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tBbmFseXRpY3MpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0U3Vic2NyaXB0aW9uVXNhZ2VBbmFseXRpY3MoXG4gICAgICAgICAgJ3N1Yl8xMjM0NTY3ODknLFxuICAgICAgICAgICdhZG1pbicsXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgYW5hbHl0aWNzUXVlcnlcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tBbmFseXRpY3MpO1xuICAgICAgICBleHBlY3QoYmlsbGluZ1NlcnZpY2UuZ2V0U3Vic2NyaXB0aW9uVXNhZ2VBbmFseXRpY3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICdzdWJfMTIzNDU2Nzg5JyxcbiAgICAgICAgICBuZXcgRGF0ZShhbmFseXRpY3NRdWVyeS5zdGFydERhdGUpLFxuICAgICAgICAgIG5ldyBEYXRlKGFuYWx5dGljc1F1ZXJ5LmVuZERhdGUpXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgdW5hdmFpbGFibGUgc2NlbmFyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdTZXJ2aWNlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlJyk7XG4gICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuZmluZFVzZXJTdWJzY3JpcHRpb24ubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldE15U3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBheW1lbnQgcHJvY2Vzc2luZyBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBheW1lbnRFcnJvciA9IG5ldyBFcnJvcignUGF5bWVudCBwcm9jZXNzaW5nIGZhaWxlZCcpO1xuICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmNyZWF0ZVBheW1lbnQubW9ja1JlamVjdGVkVmFsdWUocGF5bWVudEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZVBheW1lbnQoe1xuICAgICAgICAgIHN1YnNjcmlwdGlvbklkOiAnc3ViXzEyMzQ1Njc4OScsXG4gICAgICAgICAgYW1vdW50OiAyOS45OSxcbiAgICAgICAgICBjdXJyZW5jeTogJ1VTRCcsXG4gICAgICAgICAgcGF5bWVudE1ldGhvZElkOiAncG1fMTIzNDU2Nzg5JyxcbiAgICAgICAgfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KHBheW1lbnRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGRpc2NvdW50IGNvZGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZERpc2NvdW50RXJyb3IgPSBuZXcgRXJyb3IoJ0ludmFsaWQgZGlzY291bnQgY29kZScpO1xuICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLnZhbGlkYXRlRGlzY291bnQubW9ja1JlamVjdGVkVmFsdWUoaW52YWxpZERpc2NvdW50RXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIudmFsaWRhdGVEaXNjb3VudCh7IGNvZGU6ICdJTlZBTElEJywgYW1vdW50OiAyOS45OSB9LCBURVNUX1VTRVJfSURTLkNMSUVOVClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGludmFsaWREaXNjb3VudEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHN1YnNjcmlwdGlvbiBsaW1pdHMgZXhjZWVkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsaW1pdEVycm9yID0gbmV3IEVycm9yKCdTdWJzY3JpcHRpb24gbGltaXQgZXhjZWVkZWQnKTtcbiAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5jcmVhdGVTdWJzY3JpcHRpb24ubW9ja1JlamVjdGVkVmFsdWUobGltaXRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVTdWJzY3JpcHRpb24oXG4gICAgICAgICAgeyBwbGFuSWQ6ICdwbGFuX2Jhc2ljX21vbnRobHknLCBwYXltZW50TWV0aG9kSWQ6ICdwbV8xMjM0NTY3ODknIH0sXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlRcbiAgICAgICAgKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3cobGltaXRFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZXNwb25zZSBGb3JtYXQgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXJseSBmb3JtYXR0ZWQgc3Vic2NyaXB0aW9uIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0JpbGxpbmdTZXJ2aWNlLmZpbmRVc2VyU3Vic2NyaXB0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTdWJzY3JpcHRpb24pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE15U3Vic2NyaXB0aW9uKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgVGVzdEFzc2VydGlvbnMuZXhwZWN0VmFsaWRFbnRpdHkocmVzdWx0LCBbJ2lkJywgJ3VzZXJJZCcsICdwbGFuSWQnLCAnc3RhdHVzJ10pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5pZCkudG9CZShtb2NrU3Vic2NyaXB0aW9uLmlkKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcklkKS50b0JlKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3Blcmx5IGZvcm1hdHRlZCBwYXltZW50IG1ldGhvZCByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQYXltZW50TWV0aG9kcyA9IFttb2NrUGF5bWVudE1ldGhvZF07XG4gICAgICBtb2NrQmlsbGluZ1NlcnZpY2UuZmluZFVzZXJQYXltZW50TWV0aG9kcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bWVudE1ldGhvZHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE15UGF5bWVudE1ldGhvZHMoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIFRlc3RBc3NlcnRpb25zLmV4cGVjdFZhbGlkRW50aXR5KHJlc3VsdFswXSwgWydpZCcsICd1c2VySWQnLCAndHlwZScsICdpc0RlZmF1bHQnXSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXJseSBmb3JtYXR0ZWQgYmlsbGluZyBzdGF0aXN0aWNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1N0YXRzID0ge1xuICAgICAgICB0b3RhbFJldmVudWU6IDE1MDAwLjAwLFxuICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zOiAxMjAsXG4gICAgICAgIGNhbmNlbGxlZFN1YnNjcmlwdGlvbnM6IDE1LFxuICAgICAgICBhdmVyYWdlUmV2ZW51ZVBlcjogMTI1LjAwLFxuICAgICAgICBtb250aGx5R3Jvd3RoUmF0ZTogOC41LFxuICAgICAgfTtcbiAgICAgIG1vY2tCaWxsaW5nU2VydmljZS5nZXRCaWxsaW5nU3RhdGlzdGljcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3RhdHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldEJpbGxpbmdTdGF0aXN0aWNzKCdhZG1pbicsIHt9KTtcblxuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQudG90YWxSZXZlbnVlKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmFjdGl2ZVN1YnNjcmlwdGlvbnMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQubW9udGhseUdyb3d0aFJhdGUpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==