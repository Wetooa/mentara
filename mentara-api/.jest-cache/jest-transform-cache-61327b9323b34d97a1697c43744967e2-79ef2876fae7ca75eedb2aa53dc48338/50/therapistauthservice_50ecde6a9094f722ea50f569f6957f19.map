{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/therapist-auth.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/therapist-auth.service.ts"],"sourcesContent":["import {\n  Injectable,\n  UnauthorizedException,\n  BadRequestException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { TokenService } from './token.service';\nimport { EmailVerificationService } from './email-verification.service';\nimport { EmailService } from '../../email/email.service';\nimport { SupabaseStorageService } from '../../common/services/supabase-storage.service';\n\nimport type { RegisterTherapistDto } from '../types';\nimport {\n  TherapistApplicationResponse,\n  ApplicationStatusUpdateDto,\n} from '../../therapist/interfaces/therapist-application.interfaces';\nimport * as bcrypt from 'bcrypt';\n\n@Injectable()\nexport class TherapistAuthService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly tokenService: TokenService,\n    private readonly emailVerificationService: EmailVerificationService,\n    private readonly emailService: EmailService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  async registerTherapistWithDocuments(\n    registerData: RegisterTherapistDto,\n    files: Express.Multer.File[],\n    fileTypeMap: Record<string, string>,\n  ) {\n    // Hash password\n    const hashedPassword = await bcrypt.hash(registerData.password, 12);\n\n    // No longer need application data transformation since we create directly\n\n    // Process and upload documents if provided\n    let uploadedFiles: Array<{ id: string; fileName: string; url: string }> =\n      [];\n    let documentUrls: string[] = [];\n    let documentNames: string[] = [];\n    let certificateUrls: string[] = [];\n    let certificateNames: string[] = [];\n    let licenseUrls: string[] = [];\n    let licenseNames: string[] = [];\n\n    if (files && files.length > 0) {\n      // Validate and upload files to Supabase\n      for (const file of files) {\n        const validation = this.supabaseStorageService.validateFile(file);\n        if (!validation.isValid) {\n          throw new BadRequestException(\n            `File validation failed for ${file.originalname}: ${validation.error}`,\n          );\n        }\n      }\n\n      // Upload files to Supabase\n      const uploadResults = await this.supabaseStorageService.uploadFiles(\n        files,\n        SupabaseStorageService.getSupportedBuckets().DOCUMENTS,\n      );\n\n      uploadedFiles = uploadResults.map((result, index) => ({\n        id: `file-${Date.now()}-${index}`,\n        fileName: files[index].originalname,\n        url: result.url,\n      }));\n\n      // Categorize files based on fileTypeMap\n      uploadedFiles.forEach((file, index) => {\n        const fileType = fileTypeMap[files[index].originalname] || 'document';\n\n        switch (fileType) {\n          case 'certificate':\n            certificateUrls.push(file.url);\n            certificateNames.push(file.fileName);\n            break;\n          case 'license':\n            licenseUrls.push(file.url);\n            licenseNames.push(file.fileName);\n            break;\n          default:\n            documentUrls.push(file.url);\n            documentNames.push(file.fileName);\n            break;\n        }\n      });\n    }\n\n    // Create user and therapist profile in transaction with proper error handling\n    const userResult = await this.prisma.$transaction(async (tx) => {\n      let user: any;\n      let isExistingUser = false;\n\n      try {\n        // Try to create new user first\n        user = await tx.user.create({\n          data: {\n            email: registerData.email,\n            password: hashedPassword,\n            firstName: registerData.firstName,\n            lastName: registerData.lastName,\n            role: 'therapist',\n            emailVerified: false,\n          },\n        });\n      } catch (error) {\n        // Handle unique constraint violation (P2002) for email\n        if (\n          error &&\n          typeof error === 'object' &&\n          'code' in error &&\n          error.code === 'P2002' &&\n          'meta' in error &&\n          error.meta &&\n          typeof error.meta === 'object' &&\n          'target' in error.meta &&\n          Array.isArray(error.meta.target) &&\n          error.meta.target.includes('email')\n        ) {\n          // Check existing user and their role\n          const existingUser = await tx.user.findUnique({\n            where: { email: registerData.email },\n            include: { therapist: true },\n          });\n\n          if (!existingUser) {\n            throw new BadRequestException(\n              'User creation failed. Please try again.',\n            );\n          }\n\n          // Handle based on existing user's role\n          if (existingUser.role === 'therapist') {\n            if (existingUser.therapist) {\n              throw new BadRequestException(\n                'You already have a therapist account with this email. Please sign in instead.',\n              );\n            }\n            // User has therapist role but no therapist profile - use existing user\n            user = existingUser;\n            isExistingUser = true;\n          } else if (existingUser.role === 'client') {\n            // Allow client to upgrade to therapist\n            user = await tx.user.update({\n              where: { id: existingUser.id },\n              data: {\n                role: 'therapist',\n                password: hashedPassword, // Update password\n                firstName: registerData.firstName,\n                lastName: registerData.lastName,\n              },\n            });\n            isExistingUser = true;\n          } else {\n            // User has admin/moderator role\n            throw new BadRequestException(\n              `An account with this email already exists with ${existingUser.role} privileges. Please contact support if you need assistance.`,\n            );\n          }\n        } else {\n          // Re-throw other errors\n          throw error;\n        }\n      }\n\n      // No application update needed since we're creating directly\n\n      // Create single therapist profile for all scenarios\n      const therapist = await tx.therapist.create({\n        data: {\n          userId: user.id,\n          status: 'PENDING',\n          mobile: registerData.mobile || '',\n          province: registerData.province || '',\n          providerType: registerData.providerType || '',\n          professionalLicenseType:\n            registerData.professionalLicenseType_specify ||\n            registerData.professionalLicenseType,\n          isPRCLicensed: registerData.isPRCLicensed || '',\n          prcLicenseNumber: registerData.prcLicenseNumber || '',\n          expirationDateOfLicense: registerData.expirationDateOfLicense\n            ? new Date(registerData.expirationDateOfLicense)\n            : new Date(),\n          practiceStartDate: registerData.practiceStartDate\n            ? new Date(registerData.practiceStartDate)\n            : new Date(),\n          sessionLength:\n            registerData.preferredSessionLength_specify ||\n            registerData.preferredSessionLength ||\n            '60 minutes',\n          hourlyRate: registerData.hourlyRate || 0,\n          providedOnlineTherapyBefore:\n            registerData.providedOnlineTherapyBefore === 'yes',\n          comfortableUsingVideoConferencing:\n            registerData.comfortableUsingVideoConferencing === 'yes',\n          compliesWithDataPrivacyAct:\n            registerData.compliesWithDataPrivacyAct === 'yes',\n          willingToAbideByPlatformGuidelines:\n            registerData.willingToAbideByPlatformGuidelines === 'yes',\n          treatmentSuccessRates: {},\n          // Store document URLs from Supabase uploads\n          certificateUrls,\n          certificateNames,\n          licenseUrls,\n          licenseNames,\n          documentUrls,\n          documentNames,\n          // Professional expertise arrays\n          areasOfExpertise: registerData.areasOfExpertise,\n          assessmentTools: registerData.assessmentTools,\n          therapeuticApproachesUsedList:\n            registerData.therapeuticApproachesUsedList_specify\n              ? [\n                  ...registerData.therapeuticApproachesUsedList.filter(\n                    (t) => t !== 'other',\n                  ),\n                  ...(Array.isArray(registerData.therapeuticApproachesUsedList_specify) \n                    ? registerData.therapeuticApproachesUsedList_specify\n                    : [registerData.therapeuticApproachesUsedList_specify]),\n                ]\n              : registerData.therapeuticApproachesUsedList,\n          languagesOffered: registerData.languagesOffered_specify\n            ? [\n                ...registerData.languagesOffered.filter((l) => l !== 'other'),\n                registerData.languagesOffered_specify,\n              ]\n            : registerData.languagesOffered,\n          // Additional fields from registration\n          privateConfidentialSpace:\n            registerData.privateConfidentialSpace === 'yes' ? 'yes' : 'no',\n          professionalLiabilityInsurance:\n            registerData.professionalLiabilityInsurance,\n          complaintsOrDisciplinaryActions:\n            registerData.complaintsOrDisciplinaryActions,\n          // Compliance arrays for schema compatibility\n          expertise: registerData.areasOfExpertise,\n          approaches: registerData.therapeuticApproachesUsedList_specify\n            ? [\n                ...registerData.therapeuticApproachesUsedList.filter(\n                  (t) => t !== 'other',\n                ),\n                ...(Array.isArray(registerData.therapeuticApproachesUsedList_specify) \n                  ? registerData.therapeuticApproachesUsedList_specify\n                  : [registerData.therapeuticApproachesUsedList_specify]),\n              ]\n            : registerData.therapeuticApproachesUsedList,\n          languages: registerData.languagesOffered_specify\n            ? [\n                ...registerData.languagesOffered.filter((l) => l !== 'other'),\n                registerData.languagesOffered_specify,\n              ]\n            : registerData.languagesOffered,\n          acceptTypes: registerData.accepts || [],\n          acceptsInsurance: false,\n          acceptedInsuranceTypes: [],\n          specialCertifications: [],\n          illnessSpecializations: [],\n          preferredSessionLength: [30, 45, 60], // Default session lengths\n        },\n      });\n\n      return { user, therapist, isExistingUser };\n    });\n\n    // Generate single token\n    const { token } = await this.tokenService.generateToken(\n      userResult.user.id,\n      userResult.user.email,\n      userResult.user.role,\n    );\n\n    // Send verification email\n    await this.emailVerificationService.sendVerificationEmail(\n      userResult.user.id,\n    );\n\n    // Send therapist registration success email\n    try {\n      await this.emailService.sendTherapistRegistrationSuccess(\n        userResult.user.email,\n        `${userResult.user.firstName || ''} ${userResult.user.lastName || ''}`.trim() ||\n          'Therapist',\n        'Welcome to Mentara - Your Therapist Application Has Been Submitted'\n      );\n      console.log('Therapist registration success email sent successfully');\n    } catch (error) {\n      console.error('Failed to send therapist registration success email:', error);\n      // Don't fail the entire operation if email fails\n    }\n\n    return {\n      user: userResult.user,\n      token,\n      message: userResult.isExistingUser\n        ? 'Therapist application submitted successfully. Your account has been upgraded to therapist role. Application is under review.'\n        : 'Therapist registration successful with documents uploaded. Application is under review.',\n      therapist: userResult.therapist,\n      uploadedFiles,\n    };\n  }\n\n  async registerTherapist(\n    email: string,\n    password: string,\n    firstName: string,\n    lastName: string,\n  ) {\n    // Check if user already exists\n    const existingUser = await this.prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (existingUser) {\n      throw new BadRequestException('User with this email already exists');\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(password, 12);\n\n    // Create user and therapist profile in transaction\n    const result = await this.prisma.$transaction(async (tx) => {\n      const user = await tx.user.create({\n        data: {\n          email,\n          password: hashedPassword,\n          firstName,\n          lastName,\n          role: 'therapist',\n          emailVerified: false,\n        },\n      });\n\n      const therapist = await tx.therapist.create({\n        data: {\n          userId: user.id,\n          status: 'PENDING',\n          mobile: '',\n          province: '',\n          providerType: '',\n          professionalLicenseType: '',\n          isPRCLicensed: '',\n          prcLicenseNumber: '',\n          expirationDateOfLicense: new Date(),\n          practiceStartDate: new Date(),\n          sessionLength: '60 minutes', // Default\n          hourlyRate: 0,\n          providedOnlineTherapyBefore: false,\n          comfortableUsingVideoConferencing: false,\n          compliesWithDataPrivacyAct: false,\n          willingToAbideByPlatformGuidelines: false,\n          treatmentSuccessRates: {},\n        },\n      });\n\n      return { user, therapist };\n    });\n\n    // Generate single token\n    const { token } = await this.tokenService.generateToken(\n      result.user.id,\n      result.user.email,\n      result.user.role,\n    );\n\n    // Send verification email\n    await this.emailVerificationService.sendVerificationEmail(result.user.id);\n\n    // Send therapist registration success email\n    try {\n      await this.emailService.sendTherapistRegistrationSuccess(\n        result.user.email,\n        `${result.user.firstName || ''} ${result.user.lastName || ''}`.trim() ||\n          'Therapist',\n        'Welcome to Mentara - Your Therapist Registration Was Successful'\n      );\n      console.log('Therapist registration success email sent successfully');\n    } catch (error) {\n      console.error('Failed to send therapist registration success email:', error);\n      // Don't fail the entire operation if email fails\n    }\n\n    return {\n      user: result.user,\n      token,\n      message:\n        'Therapist registration successful. Please complete your application and submit required documents.',\n    };\n  }\n\n  async loginTherapist(\n    email: string,\n    password: string,\n    ipAddress?: string,\n    userAgent?: string,\n  ) {\n    // Find user with therapist role\n    const user = await this.prisma.user.findFirst({\n      where: {\n        email,\n        role: 'therapist',\n      },\n      include: {\n        therapist: true,\n      },\n    });\n\n    if (!user) {\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Check if account is locked\n    if (user.lockoutUntil && user.lockoutUntil > new Date()) {\n      throw new UnauthorizedException(\n        'Account is temporarily locked due to failed login attempts',\n      );\n    }\n\n    // Verify password\n    if (!user.password) {\n      throw new UnauthorizedException('Account setup incomplete');\n    }\n    const isPasswordValid = await bcrypt.compare(password, user.password);\n    if (!isPasswordValid) {\n      // Increment failed login count\n      await this.handleFailedLogin(user.id);\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Reset failed login count and update last login\n    await this.prisma.user.update({\n      where: { id: user.id },\n      data: {\n        failedLoginCount: 0,\n        lockoutUntil: null,\n        lastLoginAt: new Date(),\n      },\n    });\n\n    // Generate single token\n    const { token } = await this.tokenService.generateToken(\n      user.id,\n      user.email,\n      user.role,\n    );\n\n    return {\n      user,\n      token,\n    };\n  }\n\n  async getTherapistProfile(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      include: {\n        therapist: {\n          include: {\n            assignedClients: {\n              include: {\n                client: {\n                  include: {\n                    user: {\n                      select: {\n                        id: true,\n                        firstName: true,\n                        lastName: true,\n                        email: true,\n                        avatarUrl: true,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!user || user.role !== 'therapist') {\n      throw new UnauthorizedException('Therapist not found');\n    }\n\n    return user;\n  }\n\n  // Application management methods (moved from TherapistApplicationService)\n  async getAllApplications(options: {\n    status?: string;\n    page: number;\n    limit: number;\n  }) {\n    const { status, page, limit } = options;\n    const skip = (page - 1) * limit;\n\n    const whereClause = status ? { status: status.toUpperCase() as any } : {};\n\n    const [applications, totalCount] = await Promise.all([\n      this.prisma.therapist.findMany({\n        where: whereClause,\n        include: {\n          user: true,\n        },\n        skip,\n        take: limit,\n        orderBy: { submissionDate: 'desc' },\n      }),\n      this.prisma.therapist.count({ where: whereClause }),\n    ]);\n\n    // Helper function to determine if license is active\n    const isLicenseActive = (expirationDate: Date): boolean => {\n      const today = new Date();\n      return expirationDate > today;\n    };\n\n    const transformedApplications: TherapistApplicationResponse[] =\n      await Promise.all(\n        applications.map(async (app) => {\n          const files = await this.getApplicationFiles(app.userId);\n\n          return {\n            id: app.userId,\n            status: app.status,\n            submissionDate: app.submissionDate.toISOString(),\n            processingDate: app.processingDate?.toISOString(),\n            firstName: (app as any).user?.firstName || '',\n            lastName: (app as any).user?.lastName || '',\n            email: (app as any).user?.email || '',\n            mobile: app.mobile,\n            province: app.province,\n            providerType: app.providerType,\n            professionalLicenseType: app.professionalLicenseType,\n            isPRCLicensed: app.isPRCLicensed,\n            prcLicenseNumber: app.prcLicenseNumber,\n            expirationDateOfLicense: app.expirationDateOfLicense.toISOString(),\n            isLicenseActive: isLicenseActive(app.expirationDateOfLicense)\n              ? 'yes'\n              : 'no',\n            practiceStartDate: app.practiceStartDate.toISOString(),\n            yearsOfExperience: app.yearsOfExperience?.toString() || 'N/A',\n            areasOfExpertise: app.areasOfExpertise || [],\n            assessmentTools: app.assessmentTools || [],\n            therapeuticApproachesUsedList:\n              app.therapeuticApproachesUsedList || [],\n            languagesOffered: app.languagesOffered || [],\n            providedOnlineTherapyBefore: app.providedOnlineTherapyBefore\n              ? 'yes'\n              : 'no',\n            comfortableUsingVideoConferencing:\n              app.comfortableUsingVideoConferencing ? 'yes' : 'no',\n            weeklyAvailability: 'flexible', // Default value\n            preferredSessionLength: app.sessionLength,\n            accepts: app.acceptTypes || [],\n            privateConfidentialSpace: app.privateConfidentialSpace || 'N/A',\n            compliesWithDataPrivacyAct: app.compliesWithDataPrivacyAct\n              ? 'yes'\n              : 'no',\n            professionalLiabilityInsurance:\n              app.professionalLiabilityInsurance || 'N/A',\n            complaintsOrDisciplinaryActions:\n              app.complaintsOrDisciplinaryActions || 'N/A',\n            willingToAbideByPlatformGuidelines:\n              app.willingToAbideByPlatformGuidelines ? 'yes' : 'no',\n            bio: app.educationBackground || undefined,\n            hourlyRate: app.hourlyRate ? Number(app.hourlyRate) : undefined,\n            files: files,\n          };\n        }),\n      );\n\n    return {\n      applications: transformedApplications,\n      totalCount,\n      page,\n      totalPages: Math.ceil(totalCount / limit),\n    };\n  }\n\n  async getApplicationById(\n    id: string,\n  ): Promise<TherapistApplicationResponse | null> {\n    const application = await this.prisma.therapist.findUnique({\n      where: { userId: id },\n      include: {\n        user: true,\n      },\n    });\n\n    if (!application) {\n      return null;\n    }\n\n    const files = await this.getApplicationFiles(application.userId);\n\n    // Helper function to determine if license is active\n    const isLicenseActive = (expirationDate: Date): boolean => {\n      const today = new Date();\n      return expirationDate > today;\n    };\n\n    return {\n      id: application.userId,\n      status: application.status,\n      submissionDate: application.submissionDate.toISOString(),\n      processingDate: application.processingDate?.toISOString(),\n      firstName: application.user.firstName || '',\n      lastName: application.user.lastName || '',\n      email: application.user.email,\n      mobile: application.mobile,\n      province: application.province,\n      providerType: application.providerType,\n      professionalLicenseType: application.professionalLicenseType,\n      isPRCLicensed: application.isPRCLicensed,\n      prcLicenseNumber: application.prcLicenseNumber,\n      expirationDateOfLicense:\n        application.expirationDateOfLicense.toISOString(),\n      isLicenseActive: isLicenseActive(application.expirationDateOfLicense)\n        ? 'yes'\n        : 'no',\n      practiceStartDate: application.practiceStartDate.toISOString(),\n      yearsOfExperience: application.yearsOfExperience?.toString() || 'N/A',\n      areasOfExpertise: application.areasOfExpertise || [],\n      assessmentTools: application.assessmentTools || [],\n      therapeuticApproachesUsedList:\n        application.therapeuticApproachesUsedList || [],\n      languagesOffered: application.languagesOffered || [],\n      providedOnlineTherapyBefore: application.providedOnlineTherapyBefore\n        ? 'yes'\n        : 'no',\n      comfortableUsingVideoConferencing:\n        application.comfortableUsingVideoConferencing ? 'yes' : 'no',\n      weeklyAvailability: 'flexible',\n      preferredSessionLength: application.sessionLength,\n      accepts: application.acceptTypes || [],\n      privateConfidentialSpace: application.privateConfidentialSpace || 'N/A',\n      compliesWithDataPrivacyAct: application.compliesWithDataPrivacyAct\n        ? 'yes'\n        : 'no',\n      professionalLiabilityInsurance:\n        application.professionalLiabilityInsurance || 'N/A',\n      complaintsOrDisciplinaryActions:\n        application.complaintsOrDisciplinaryActions || 'N/A',\n      willingToAbideByPlatformGuidelines:\n        application.willingToAbideByPlatformGuidelines ? 'yes' : 'no',\n      bio: application.educationBackground || undefined,\n      hourlyRate: application.hourlyRate\n        ? Number(application.hourlyRate)\n        : undefined,\n      files: files,\n    };\n  }\n\n  async updateApplicationStatus(\n    id: string,\n    updateData: ApplicationStatusUpdateDto,\n  ): Promise<{\n    success: boolean;\n    message: string;\n    credentials?: { email: string; password: string };\n  }> {\n    const application = await this.prisma.therapist.findUnique({\n      where: { userId: id },\n      include: { user: true },\n    });\n\n    if (!application) {\n      throw new NotFoundException('Application not found');\n    }\n\n    try {\n      // Update application status\n      await this.prisma.therapist.update({\n        where: { userId: id },\n        data: {\n          status: updateData.status,\n          processingDate: new Date(),\n        },\n      });\n\n      let result: {\n        success: boolean;\n        message: string;\n        credentials?: { email: string; password: string };\n      } = {\n        success: true,\n        message: `Application ${updateData.status} successfully`,\n      };\n\n      // Handle status-specific actions and notifications\n      if (updateData.status === 'APPROVED') {\n        // Create Clerk account for approved therapist\n        const temporaryPassword = this.generateTemporaryPassword();\n        let clerkUserId: string | null = null;\n\n        try {\n          // Create Clerk user account\n          const clerkUser = await this.createClerkTherapistAccount(\n            application.user.email,\n            `${application.user.firstName || ''} ${application.user.lastName || ''}`.trim(),\n            temporaryPassword,\n          );\n\n          clerkUserId = clerkUser.id;\n          console.log('Clerk account created successfully:', clerkUserId);\n\n          // Update user record to change role to therapist and activate account\n          await this.prisma.user.update({\n            where: { id: application.userId },\n            data: {\n              role: 'therapist',\n              isActive: true,\n            },\n          });\n\n          console.log('User role updated to therapist');\n        } catch (error) {\n          console.error('Error creating Clerk account:', error);\n          // Continue with the process but note the error\n        }\n\n        const credentials = {\n          email: application.user.email,\n          password: temporaryPassword,\n        };\n\n        result = {\n          ...result,\n          message:\n            'Application approved successfully. Therapist account created and credentials generated.',\n          credentials,\n        };\n\n        // Send approval email notification\n        try {\n          await this.emailService.sendTherapistApproved(\n            application.user.email,\n            `${application.user.firstName || ''} ${application.user.lastName || ''}`.trim() ||\n              'Therapist',\n            'Congratulations! Your Therapist Application Has Been Approved'\n          );\n          console.log('Approval email notification sent successfully');\n        } catch (error) {\n          console.error('Failed to send approval email notification:', error);\n          // Don't fail the entire operation if email fails\n        }\n      } else if (updateData.status === 'REJECTED') {\n        // Send rejection email notification\n        try {\n          await this.emailService.sendTherapistDenied(\n            application.user.email,\n            `${application.user.firstName || ''} ${application.user.lastName || ''}`.trim() ||\n              'Therapist',\n            'Update on Your Therapist Application'\n          );\n          console.log('Rejection email notification sent successfully');\n        } catch (error) {\n          console.error('Failed to send rejection email notification:', error);\n          // Don't fail the entire operation if email fails\n        }\n      }\n\n      return result;\n    } catch (error) {\n      console.error('Error updating application status:', error);\n      throw new BadRequestException('Failed to update application status');\n    }\n  }\n\n  async getApplicationFiles(applicationId: string): Promise<\n    Array<{\n      id: string;\n      fileName: string;\n      fileUrl: string;\n      uploadedAt: string;\n    }>\n  > {\n    // Get therapist record with document URLs\n    const therapist = await this.prisma.therapist.findUnique({\n      where: { userId: applicationId },\n      select: {\n        certificateUrls: true,\n        certificateNames: true,\n        licenseUrls: true,\n        licenseNames: true,\n        documentUrls: true,\n        documentNames: true,\n        createdAt: true,\n      },\n    });\n\n    if (!therapist) {\n      return [];\n    }\n\n    const files: Array<{\n      id: string;\n      fileName: string;\n      fileUrl: string;\n      uploadedAt: string;\n    }> = [];\n\n    // Process certificates\n    therapist.certificateUrls.forEach((url, index) => {\n      files.push({\n        id: `cert-${index}`,\n        fileName:\n          therapist.certificateNames[index] || `certificate-${index + 1}`,\n        fileUrl: url,\n        uploadedAt: therapist.createdAt.toISOString(),\n      });\n    });\n\n    // Process licenses\n    therapist.licenseUrls.forEach((url, index) => {\n      files.push({\n        id: `license-${index}`,\n        fileName: therapist.licenseNames[index] || `license-${index + 1}`,\n        fileUrl: url,\n        uploadedAt: therapist.createdAt.toISOString(),\n      });\n    });\n\n    // Process documents\n    therapist.documentUrls.forEach((url, index) => {\n      files.push({\n        id: `doc-${index}`,\n        fileName: therapist.documentNames[index] || `document-${index + 1}`,\n        fileUrl: url,\n        uploadedAt: therapist.createdAt.toISOString(),\n      });\n    });\n\n    return files;\n  }\n\n  private generateTemporaryPassword(): string {\n    const chars =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%';\n    let password = '';\n    for (let i = 0; i < 12; i++) {\n      password += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return password;\n  }\n\n  private async createClerkTherapistAccount(\n    email: string,\n    fullName: string,\n    password: string,\n  ): Promise<{ id: string; email: string }> {\n    try {\n      console.log('Creating Clerk account for therapist:', { email, fullName });\n      console.log(\n        'Password provided for future Clerk integration:',\n        password ? 'Yes' : 'No',\n      );\n\n      // For production, you would integrate with Clerk Admin API\n      // For now, we'll simulate the account creation and return a mock response\n      // In a real implementation, you would use:\n      // - Clerk Backend API\n      // - clerk/backend package\n      // - Or MCP Clerk integration\n\n      // Create Clerk user using MCP integration\n      // Note: In a real implementation, you would inject the Clerk MCP service\n      // For now, we'll simulate a successful account creation\n\n      const firstName = fullName.split(' ')[0] || '';\n      const lastName = fullName.split(' ').slice(1).join(' ') || '';\n\n      // Simulate Clerk account creation\n      // In production, use the actual Clerk MCP service\n      const clerkUser = {\n        id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        email: email,\n        firstName: firstName,\n        lastName: lastName,\n        publicMetadata: {\n          role: 'therapist',\n        },\n        privateMetadata: {\n          accountType: 'therapist',\n          createdBy: 'admin_approval',\n          approvedAt: new Date().toISOString(),\n        },\n      };\n\n      console.log('Clerk account created successfully:', {\n        id: clerkUser.id,\n        email: clerkUser.email,\n        role: 'therapist',\n      });\n\n      // TODO: Replace with actual Clerk MCP call\n      // Example using MCP Clerk integration:\n      /*\n      const clerkUser = await this.clerkMcpService.createUser({\n        emailAddress: email,\n        firstName: firstName,\n        lastName: lastName,\n        password: password,\n        publicMetadata: { role: 'therapist' },\n        privateMetadata: { \n          accountType: 'therapist',\n          createdBy: 'admin_approval'\n        }\n      });\n      */\n\n      return {\n        id: clerkUser.id,\n        email: clerkUser.email,\n      };\n    } catch (error) {\n      console.error('Error creating Clerk account:', error);\n      throw new BadRequestException(\n        'Failed to create therapist account. Please try again.',\n      );\n    }\n  }\n\n  private async handleFailedLogin(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      select: { failedLoginCount: true },\n    });\n\n    const newFailedCount = (user?.failedLoginCount || 0) + 1;\n    const maxAttempts = 5;\n    const lockoutDuration = 30 * 60 * 1000; // 30 minutes\n\n    const updateData: any = {\n      failedLoginCount: newFailedCount,\n    };\n\n    if (newFailedCount >= maxAttempts) {\n      updateData.lockoutUntil = new Date(Date.now() + lockoutDuration);\n    }\n\n    await this.prisma.user.update({\n      where: { id: userId },\n      data: updateData,\n    });\n  }\n}\n"],"version":3}