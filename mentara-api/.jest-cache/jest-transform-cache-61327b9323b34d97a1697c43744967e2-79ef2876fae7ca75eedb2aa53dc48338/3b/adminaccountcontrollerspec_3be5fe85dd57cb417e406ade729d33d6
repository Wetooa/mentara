3aa99d91c9fcdb37ff7b84cc6733ff1f
"use strict";
/**
 * Comprehensive Test Suite for AdminAccountController
 * Tests admin account management operations
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const admin_account_controller_1 = require("./admin-account.controller");
const admin_service_1 = require("../admin.service");
const jwt_auth_guard_1 = require("../../auth/guards/jwt-auth.guard");
const admin_auth_guard_1 = require("../../auth/guards/admin-auth.guard");
const enhanced_test_helpers_1 = require("../../test-utils/enhanced-test-helpers");
const index_1 = require("../../test-utils/index");
describe('AdminAccountController', () => {
    let controller;
    let adminService;
    let module;
    // Mock AdminService
    const mockAdminService = {
        create: jest.fn(),
        findAll: jest.fn(),
        findOne: jest.fn(),
        update: jest.fn(),
        remove: jest.fn(),
    };
    // Mock Guards
    const mockJwtAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    const mockAdminAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    // Test data
    const mockAdmin = {
        id: index_1.TEST_USER_IDS.ADMIN,
        userId: index_1.TEST_USER_IDS.ADMIN,
        email: index_1.TEST_EMAILS.ADMIN,
        firstName: 'Admin',
        lastName: 'User',
        role: 'admin',
        isActive: true,
        createdAt: new Date('2024-02-14T10:00:00Z'),
        updatedAt: new Date('2024-02-14T10:00:00Z'),
    };
    const createAdminDto = {
        userId: 'user_123456789',
        email: 'newadmin@example.com',
        firstName: 'New',
        lastName: 'Admin',
    };
    const updateAdminDto = {
        firstName: 'Updated',
        lastName: 'Admin',
        isActive: false,
    };
    beforeEach(async () => {
        module = await testing_1.Test.createTestingModule({
            controllers: [admin_account_controller_1.AdminAccountController],
            providers: [
                {
                    provide: admin_service_1.AdminService,
                    useValue: mockAdminService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(admin_auth_guard_1.AdminAuthGuard)
            .useValue(mockAdminAuthGuard)
            .compile();
        controller = module.get(admin_account_controller_1.AdminAccountController);
        adminService = module.get(admin_service_1.AdminService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Controller Initialization', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have adminService injected', () => {
            expect(adminService).toBeDefined();
        });
    });
    describe('Security Guards', () => {
        it('should be protected by JwtAuthGuard and AdminAuthGuard', () => {
            const guards = Reflect.getMetadata('__guards__', admin_account_controller_1.AdminAccountController);
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
            expect(guards).toContain(admin_auth_guard_1.AdminAuthGuard);
        });
        it('should have proper route decorators', () => {
            const controllerMetadata = Reflect.getMetadata('path', admin_account_controller_1.AdminAccountController);
            expect(controllerMetadata).toBe('admin/accounts');
        });
        it('should require admin role for all endpoints', () => {
            const adminOnlyMethods = [
                'create',
                'findAll',
                'findOne',
                'update',
                'remove',
            ];
            adminOnlyMethods.forEach((method) => {
                const metadata = Reflect.getMetadata('roles', controller[method]);
                expect(metadata).toEqual(['admin']);
            });
        });
    });
    describe('POST /admin/accounts', () => {
        it('should create admin successfully', async () => {
            mockAdminService.create.mockResolvedValue(mockAdmin);
            const result = await controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockAdmin);
            expect(adminService.create).toHaveBeenCalledWith(createAdminDto);
        });
        it('should handle service errors during creation', async () => {
            const serviceError = new Error('User already exists');
            mockAdminService.create.mockRejectedValue(serviceError);
            await expect(controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should validate admin creation with proper DTO', async () => {
            mockAdminService.create.mockResolvedValue(mockAdmin);
            const validDto = {
                userId: 'user_123456789',
                email: 'test@example.com',
                firstName: 'Test',
                lastName: 'Admin',
            };
            const result = await controller.create(validDto, index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockAdmin);
            expect(adminService.create).toHaveBeenCalledWith(validDto);
        });
    });
    describe('GET /admin/accounts', () => {
        it('should find all admins successfully', async () => {
            const admins = [mockAdmin];
            mockAdminService.findAll.mockResolvedValue(admins);
            const result = await controller.findAll(index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(admins);
            expect(adminService.findAll).toHaveBeenCalled();
        });
        it('should handle empty admin list', async () => {
            mockAdminService.findAll.mockResolvedValue([]);
            const result = await controller.findAll(index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual([]);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database connection failed');
            mockAdminService.findAll.mockRejectedValue(serviceError);
            await expect(controller.findAll(index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('GET /admin/accounts/:id', () => {
        it('should find one admin successfully', async () => {
            mockAdminService.findOne.mockResolvedValue(mockAdmin);
            const result = await controller.findOne('admin_123', index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockAdmin);
            expect(adminService.findOne).toHaveBeenCalledWith('admin_123');
        });
        it('should throw NOT_FOUND when admin does not exist', async () => {
            mockAdminService.findOne.mockResolvedValue(null);
            await expect(controller.findOne('nonexistent_admin', index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(new common_1.HttpException('Admin not found', common_1.HttpStatus.NOT_FOUND));
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database error');
            mockAdminService.findOne.mockRejectedValue(serviceError);
            await expect(controller.findOne('admin_123', index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should pass through HTTP exceptions from service', async () => {
            const httpError = new common_1.HttpException('Forbidden', common_1.HttpStatus.FORBIDDEN);
            mockAdminService.findOne.mockRejectedValue(httpError);
            await expect(controller.findOne('admin_123', index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(httpError);
        });
    });
    describe('PATCH /admin/accounts/:id', () => {
        it('should update admin successfully', async () => {
            const updatedAdmin = { ...mockAdmin, ...updateAdminDto };
            mockAdminService.update.mockResolvedValue(updatedAdmin);
            const result = await controller.update('admin_123', updateAdminDto, index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(updatedAdmin);
            expect(adminService.update).toHaveBeenCalledWith('admin_123', updateAdminDto);
        });
        it('should handle service errors during update', async () => {
            const serviceError = new Error('Admin not found');
            mockAdminService.update.mockRejectedValue(serviceError);
            await expect(controller.update('admin_123', updateAdminDto, index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should handle partial updates', async () => {
            const partialUpdate = { firstName: 'UpdatedFirst' };
            const updatedAdmin = { ...mockAdmin, firstName: 'UpdatedFirst' };
            mockAdminService.update.mockResolvedValue(updatedAdmin);
            const result = await controller.update('admin_123', partialUpdate, index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(updatedAdmin);
            expect(adminService.update).toHaveBeenCalledWith('admin_123', partialUpdate);
        });
    });
    describe('DELETE /admin/accounts/:id', () => {
        it('should remove admin successfully', async () => {
            mockAdminService.remove.mockResolvedValue(undefined);
            const result = await controller.remove('admin_123', index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual({ message: 'Admin user deleted successfully' });
            expect(adminService.remove).toHaveBeenCalledWith('admin_123');
        });
        it('should prevent self-deletion', async () => {
            await expect(controller.remove(index_1.TEST_USER_IDS.ADMIN, index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(new common_1.HttpException('Cannot delete your own admin account', common_1.HttpStatus.BAD_REQUEST));
            expect(adminService.remove).not.toHaveBeenCalled();
        });
        it('should handle service errors during removal', async () => {
            const serviceError = new Error('Admin not found');
            mockAdminService.remove.mockRejectedValue(serviceError);
            await expect(controller.remove('admin_123', index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should pass through HTTP exceptions from service', async () => {
            const httpError = new common_1.HttpException('Cannot delete admin', common_1.HttpStatus.CONFLICT);
            mockAdminService.remove.mockRejectedValue(httpError);
            await expect(controller.remove('admin_123', index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(httpError);
        });
    });
    describe('Response Format Validation', () => {
        it('should return properly formatted admin response', async () => {
            mockAdminService.create.mockResolvedValue(mockAdmin);
            const result = await controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN);
            enhanced_test_helpers_1.TestAssertions.expectValidEntity(result, [
                'id',
                'userId',
                'email',
                'firstName',
                'lastName',
            ]);
            expect(result.role).toBe('admin');
            expect(typeof result.isActive).toBe('boolean');
            expect(result.createdAt).toBeInstanceOf(Date);
        });
        it('should return properly formatted admin list', async () => {
            const admins = [mockAdmin];
            mockAdminService.findAll.mockResolvedValue(admins);
            const result = await controller.findAll(index_1.TEST_USER_IDS.ADMIN);
            expect(Array.isArray(result)).toBe(true);
            result.forEach((admin) => {
                enhanced_test_helpers_1.TestAssertions.expectValidEntity(admin, ['id', 'userId', 'email']);
                expect(admin.role).toBe('admin');
            });
        });
        it('should return properly formatted deletion response', async () => {
            mockAdminService.remove.mockResolvedValue(undefined);
            const result = await controller.remove('admin_123', index_1.TEST_USER_IDS.ADMIN);
            expect(result).toHaveProperty('message');
            expect(typeof result.message).toBe('string');
            expect(result.message).toContain('deleted successfully');
        });
    });
    describe('Error Handling', () => {
        it('should handle validation errors', async () => {
            const validationError = new Error('Validation failed');
            mockAdminService.create.mockRejectedValue(validationError);
            await expect(controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should handle duplicate admin creation', async () => {
            const duplicateError = new Error('Admin already exists');
            mockAdminService.create.mockRejectedValue(duplicateError);
            await expect(controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should handle database connection errors', async () => {
            const dbError = new Error('Database connection failed');
            mockAdminService.findAll.mockRejectedValue(dbError);
            await expect(controller.findAll(index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete admin lifecycle', async () => {
            // Create admin
            mockAdminService.create.mockResolvedValue(mockAdmin);
            const createResult = await controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN);
            expect(createResult.id).toBeDefined();
            // Find created admin
            mockAdminService.findOne.mockResolvedValue(mockAdmin);
            const findResult = await controller.findOne(mockAdmin.id, index_1.TEST_USER_IDS.ADMIN);
            expect(findResult.id).toBe(mockAdmin.id);
            // Update admin
            const updatedAdmin = { ...mockAdmin, firstName: 'Updated' };
            mockAdminService.update.mockResolvedValue(updatedAdmin);
            const updateResult = await controller.update(mockAdmin.id, { firstName: 'Updated' }, index_1.TEST_USER_IDS.ADMIN);
            expect(updateResult.firstName).toBe('Updated');
            // List all admins
            mockAdminService.findAll.mockResolvedValue([updatedAdmin]);
            const listResult = await controller.findAll(index_1.TEST_USER_IDS.ADMIN);
            expect(listResult).toHaveLength(1);
            // Remove admin
            mockAdminService.remove.mockResolvedValue(undefined);
            const removeResult = await controller.remove(mockAdmin.id, index_1.TEST_USER_IDS.ADMIN);
            expect(removeResult.message).toContain('deleted successfully');
        });
        it('should validate admin management permissions', async () => {
            // All operations should require admin authentication
            const operations = [
                () => controller.create(createAdminDto, index_1.TEST_USER_IDS.ADMIN),
                () => controller.findAll(index_1.TEST_USER_IDS.ADMIN),
                () => controller.findOne('admin_123', index_1.TEST_USER_IDS.ADMIN),
                () => controller.update('admin_123', updateAdminDto, index_1.TEST_USER_IDS.ADMIN),
                () => controller.remove('admin_123', index_1.TEST_USER_IDS.ADMIN),
            ];
            // Mock successful responses for permission validation
            mockAdminService.create.mockResolvedValue(mockAdmin);
            mockAdminService.findAll.mockResolvedValue([mockAdmin]);
            mockAdminService.findOne.mockResolvedValue(mockAdmin);
            mockAdminService.update.mockResolvedValue(mockAdmin);
            mockAdminService.remove.mockResolvedValue(undefined);
            // All operations should be accessible with admin auth
            for (const operation of operations) {
                await expect(operation()).resolves.toBeDefined();
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2FkbWluL2NvbnRyb2xsZXJzL2FkbWluLWFjY291bnQuY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsNkNBQXNEO0FBQ3RELDJDQUEyRDtBQUMzRCx5RUFBb0U7QUFDcEUsb0RBQWdEO0FBQ2hELHFFQUFnRTtBQUNoRSx5RUFBb0U7QUFLcEUsa0ZBSWdEO0FBQ2hELGtEQUFvRTtBQUVwRSxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLElBQUksVUFBa0MsQ0FBQztJQUN2QyxJQUFJLFlBQTBCLENBQUM7SUFDL0IsSUFBSSxNQUFxQixDQUFDO0lBRTFCLG9CQUFvQjtJQUNwQixNQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2xCLENBQUM7SUFFRixjQUFjO0lBQ2QsTUFBTSxnQkFBZ0IsR0FBRztRQUN2QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7S0FDN0MsQ0FBQztJQUVGLE1BQU0sa0JBQWtCLEdBQUc7UUFDekIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO0tBQzdDLENBQUM7SUFFRixZQUFZO0lBQ1osTUFBTSxTQUFTLEdBQUc7UUFDaEIsRUFBRSxFQUFFLHFCQUFhLENBQUMsS0FBSztRQUN2QixNQUFNLEVBQUUscUJBQWEsQ0FBQyxLQUFLO1FBQzNCLEtBQUssRUFBRSxtQkFBVyxDQUFD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bWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYWRtaW4vY29udHJvbGxlcnMvYWRtaW4tYWNjb3VudC5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21wcmVoZW5zaXZlIFRlc3QgU3VpdGUgZm9yIEFkbWluQWNjb3VudENvbnRyb2xsZXJcbiAqIFRlc3RzIGFkbWluIGFjY291bnQgbWFuYWdlbWVudCBvcGVyYXRpb25zXG4gKi9cblxuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBIdHRwRXhjZXB0aW9uLCBIdHRwU3RhdHVzIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQWRtaW5BY2NvdW50Q29udHJvbGxlciB9IGZyb20gJy4vYWRtaW4tYWNjb3VudC5jb250cm9sbGVyJztcbmltcG9ydCB7IEFkbWluU2VydmljZSB9IGZyb20gJy4uL2FkbWluLnNlcnZpY2UnO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnLi4vLi4vYXV0aC9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgQWRtaW5BdXRoR3VhcmQgfSBmcm9tICcuLi8uLi9hdXRoL2d1YXJkcy9hZG1pbi1hdXRoLmd1YXJkJztcbmltcG9ydCB7XG4gIFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMsXG4gIFJvbGVCYXNlZFRlc3RVdGlscyxcbn0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQge1xuICBNb2NrQnVpbGRlcixcbiAgVGVzdERhdGFHZW5lcmF0b3IsXG4gIFRlc3RBc3NlcnRpb25zLFxufSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2VuaGFuY2VkLXRlc3QtaGVscGVycyc7XG5pbXBvcnQgeyBURVNUX1VTRVJfSURTLCBURVNUX0VNQUlMUyB9IGZyb20gJy4uLy4uL3Rlc3QtdXRpbHMvaW5kZXgnO1xuXG5kZXNjcmliZSgnQWRtaW5BY2NvdW50Q29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IEFkbWluQWNjb3VudENvbnRyb2xsZXI7XG4gIGxldCBhZG1pblNlcnZpY2U6IEFkbWluU2VydmljZTtcbiAgbGV0IG1vZHVsZTogVGVzdGluZ01vZHVsZTtcblxuICAvLyBNb2NrIEFkbWluU2VydmljZVxuICBjb25zdCBtb2NrQWRtaW5TZXJ2aWNlID0ge1xuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIGZpbmRBbGw6IGplc3QuZm4oKSxcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgcmVtb3ZlOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgLy8gTW9jayBHdWFyZHNcbiAgY29uc3QgbW9ja0p3dEF1dGhHdWFyZCA9IHtcbiAgICBjYW5BY3RpdmF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgfTtcblxuICBjb25zdCBtb2NrQWRtaW5BdXRoR3VhcmQgPSB7XG4gICAgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSksXG4gIH07XG5cbiAgLy8gVGVzdCBkYXRhXG4gIGNvbnN0IG1vY2tBZG1pbiA9IHtcbiAgICBpZDogVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgZW1haWw6IFRFU1RfRU1BSUxTLkFETUlOLFxuICAgIGZpcnN0TmFtZTogJ0FkbWluJyxcbiAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgIHJvbGU6ICdhZG1pbicsXG4gICAgaXNBY3RpdmU6IHRydWUsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMi0xNFQxMDowMDowMFonKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAyLTE0VDEwOjAwOjAwWicpLFxuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZUFkbWluRHRvID0ge1xuICAgIHVzZXJJZDogJ3VzZXJfMTIzNDU2Nzg5JyxcbiAgICBlbWFpbDogJ25ld2FkbWluQGV4YW1wbGUuY29tJyxcbiAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgIGxhc3ROYW1lOiAnQWRtaW4nLFxuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZUFkbWluRHRvID0ge1xuICAgIGZpcnN0TmFtZTogJ1VwZGF0ZWQnLFxuICAgIGxhc3ROYW1lOiAnQWRtaW4nLFxuICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBtb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgY29udHJvbGxlcnM6IFtBZG1pbkFjY291bnRDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQWRtaW5TZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQWRtaW5TZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KVxuICAgICAgLm92ZXJyaWRlR3VhcmQoSnd0QXV0aEd1YXJkKVxuICAgICAgLnVzZVZhbHVlKG1vY2tKd3RBdXRoR3VhcmQpXG4gICAgICAub3ZlcnJpZGVHdWFyZChBZG1pbkF1dGhHdWFyZClcbiAgICAgIC51c2VWYWx1ZShtb2NrQWRtaW5BdXRoR3VhcmQpXG4gICAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8QWRtaW5BY2NvdW50Q29udHJvbGxlcj4oQWRtaW5BY2NvdW50Q29udHJvbGxlcik7XG4gICAgYWRtaW5TZXJ2aWNlID0gbW9kdWxlLmdldDxBZG1pblNlcnZpY2U+KEFkbWluU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb250cm9sbGVyIEluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGFkbWluU2VydmljZSBpbmplY3RlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChhZG1pblNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBHdWFyZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBiZSBwcm90ZWN0ZWQgYnkgSnd0QXV0aEd1YXJkIGFuZCBBZG1pbkF1dGhHdWFyZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGd1YXJkcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fZ3VhcmRzX18nLCBBZG1pbkFjY291bnRDb250cm9sbGVyKTtcbiAgICAgIGV4cGVjdChndWFyZHMpLnRvQ29udGFpbihKd3RBdXRoR3VhcmQpO1xuICAgICAgZXhwZWN0KGd1YXJkcykudG9Db250YWluKEFkbWluQXV0aEd1YXJkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBwcm9wZXIgcm91dGUgZGVjb3JhdG9ycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRyb2xsZXJNZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoXG4gICAgICAgICdwYXRoJyxcbiAgICAgICAgQWRtaW5BY2NvdW50Q29udHJvbGxlcixcbiAgICAgICk7XG4gICAgICBleHBlY3QoY29udHJvbGxlck1ldGFkYXRhKS50b0JlKCdhZG1pbi9hY2NvdW50cycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIGFkbWluIHJvbGUgZm9yIGFsbCBlbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhZG1pbk9ubHlNZXRob2RzID0gW1xuICAgICAgICAnY3JlYXRlJyxcbiAgICAgICAgJ2ZpbmRBbGwnLFxuICAgICAgICAnZmluZE9uZScsXG4gICAgICAgICd1cGRhdGUnLFxuICAgICAgICAncmVtb3ZlJyxcbiAgICAgIF07XG4gICAgICBhZG1pbk9ubHlNZXRob2RzLmZvckVhY2goKG1ldGhvZCkgPT4ge1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ3JvbGVzJywgY29udHJvbGxlclttZXRob2RdKTtcbiAgICAgICAgZXhwZWN0KG1ldGFkYXRhKS50b0VxdWFsKFsnYWRtaW4nXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2FkbWluL2FjY291bnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFkbWluIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tBZG1pbik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlKFxuICAgICAgICBjcmVhdGVBZG1pbkR0byxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0FkbWluKTtcbiAgICAgIGV4cGVjdChhZG1pblNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjcmVhdGVBZG1pbkR0byk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycyBkdXJpbmcgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ1VzZXIgYWxyZWFkeSBleGlzdHMnKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuY3JlYXRlLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGUoY3JlYXRlQWRtaW5EdG8sIFRFU1RfVVNFUl9JRFMuQURNSU4pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFkbWluIGNyZWF0aW9uIHdpdGggcHJvcGVyIERUTycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tBZG1pbik7XG5cbiAgICAgIGNvbnN0IHZhbGlkRHRvID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMzQ1Njc4OScsXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBsYXN0TmFtZTogJ0FkbWluJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlKHZhbGlkRHRvLCBURVNUX1VTRVJfSURTLkFETUlOKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQWRtaW4pO1xuICAgICAgZXhwZWN0KGFkbWluU2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHZhbGlkRHRvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYWRtaW4vYWNjb3VudHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmaW5kIGFsbCBhZG1pbnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWRtaW5zID0gW21vY2tBZG1pbl07XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUoYWRtaW5zKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKFRFU1RfVVNFUl9JRFMuQURNSU4pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGFkbWlucyk7XG4gICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLmZpbmRBbGwpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGFkbWluIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRBbGwoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmZpbmRBbGwubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZmluZEFsbChURVNUX1VTRVJfSURTLkFETUlOKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBIdHRwRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYWRtaW4vYWNjb3VudHMvOmlkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmluZCBvbmUgYWRtaW4gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FkbWluU2VydmljZS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tBZG1pbik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZE9uZSgnYWRtaW5fMTIzJywgVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0FkbWluKTtcbiAgICAgIGV4cGVjdChhZG1pblNlcnZpY2UuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FkbWluXzEyMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOT1RfRk9VTkQgd2hlbiBhZG1pbiBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmZpbmRPbmUoJ25vbmV4aXN0ZW50X2FkbWluJywgVEVTVF9VU0VSX0lEUy5BRE1JTiksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgbmV3IEh0dHBFeGNlcHRpb24oJ0FkbWluIG5vdCBmb3VuZCcsIEh0dHBTdGF0dXMuTk9UX0ZPVU5EKSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZmluZE9uZS5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZmluZE9uZSgnYWRtaW5fMTIzJywgVEVTVF9VU0VSX0lEUy5BRE1JTiksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcGFzcyB0aHJvdWdoIEhUVFAgZXhjZXB0aW9ucyBmcm9tIHNlcnZpY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBodHRwRXJyb3IgPSBuZXcgSHR0cEV4Y2VwdGlvbignRm9yYmlkZGVuJywgSHR0cFN0YXR1cy5GT1JCSURERU4pO1xuICAgICAgbW9ja0FkbWluU2VydmljZS5maW5kT25lLm1vY2tSZWplY3RlZFZhbHVlKGh0dHBFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5maW5kT25lKCdhZG1pbl8xMjMnLCBURVNUX1VTRVJfSURTLkFETUlOKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGh0dHBFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQQVRDSCAvYWRtaW4vYWNjb3VudHMvOmlkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdXBkYXRlIGFkbWluIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWRBZG1pbiA9IHsgLi4ubW9ja0FkbWluLCAuLi51cGRhdGVBZG1pbkR0byB9O1xuICAgICAgbW9ja0FkbWluU2VydmljZS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZEFkbWluKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGUoXG4gICAgICAgICdhZG1pbl8xMjMnLFxuICAgICAgICB1cGRhdGVBZG1pbkR0byxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXBkYXRlZEFkbWluKTtcbiAgICAgIGV4cGVjdChhZG1pblNlcnZpY2UudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ2FkbWluXzEyMycsXG4gICAgICAgIHVwZGF0ZUFkbWluRHRvLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzIGR1cmluZyB1cGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0FkbWluIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja0FkbWluU2VydmljZS51cGRhdGUubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLnVwZGF0ZSgnYWRtaW5fMTIzJywgdXBkYXRlQWRtaW5EdG8sIFRFU1RfVVNFUl9JRFMuQURNSU4pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYXJ0aWFsIHVwZGF0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJ0aWFsVXBkYXRlID0geyBmaXJzdE5hbWU6ICdVcGRhdGVkRmlyc3QnIH07XG4gICAgICBjb25zdCB1cGRhdGVkQWRtaW4gPSB7IC4uLm1vY2tBZG1pbiwgZmlyc3ROYW1lOiAnVXBkYXRlZEZpcnN0JyB9O1xuICAgICAgbW9ja0FkbWluU2VydmljZS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZEFkbWluKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGUoXG4gICAgICAgICdhZG1pbl8xMjMnLFxuICAgICAgICBwYXJ0aWFsVXBkYXRlLFxuICAgICAgICBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkQWRtaW4pO1xuICAgICAgZXhwZWN0KGFkbWluU2VydmljZS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnYWRtaW5fMTIzJyxcbiAgICAgICAgcGFydGlhbFVwZGF0ZSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdERUxFVEUgL2FkbWluL2FjY291bnRzLzppZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBhZG1pbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLnJlbW92ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlbW92ZSgnYWRtaW5fMTIzJywgVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBtZXNzYWdlOiAnQWRtaW4gdXNlciBkZWxldGVkIHN1Y2Nlc3NmdWxseScgfSk7XG4gICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLnJlbW92ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FkbWluXzEyMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHNlbGYtZGVsZXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIucmVtb3ZlKFRFU1RfVVNFUl9JRFMuQURNSU4sIFRFU1RfVVNFUl9JRFMuQURNSU4pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAgICdDYW5ub3QgZGVsZXRlIHlvdXIgb3duIGFkbWluIGFjY291bnQnLFxuICAgICAgICAgIEh0dHBTdGF0dXMuQkFEX1JFUVVFU1QsXG4gICAgICAgICksXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLnJlbW92ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzIGR1cmluZyByZW1vdmFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdBZG1pbiBub3QgZm91bmQnKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UucmVtb3ZlLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5yZW1vdmUoJ2FkbWluXzEyMycsIFRFU1RfVVNFUl9JRFMuQURNSU4pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBhc3MgdGhyb3VnaCBIVFRQIGV4Y2VwdGlvbnMgZnJvbSBzZXJ2aWNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaHR0cEVycm9yID0gbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgICdDYW5ub3QgZGVsZXRlIGFkbWluJyxcbiAgICAgICAgSHR0cFN0YXR1cy5DT05GTElDVCxcbiAgICAgICk7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLnJlbW92ZS5tb2NrUmVqZWN0ZWRWYWx1ZShodHRwRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIucmVtb3ZlKCdhZG1pbl8xMjMnLCBURVNUX1VTRVJfSURTLkFETUlOKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGh0dHBFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZXNwb25zZSBGb3JtYXQgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXJseSBmb3JtYXR0ZWQgYWRtaW4gcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQWRtaW4pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShcbiAgICAgICAgY3JlYXRlQWRtaW5EdG8sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICApO1xuXG4gICAgICBUZXN0QXNzZXJ0aW9ucy5leHBlY3RWYWxpZEVudGl0eShyZXN1bHQsIFtcbiAgICAgICAgJ2lkJyxcbiAgICAgICAgJ3VzZXJJZCcsXG4gICAgICAgICdlbWFpbCcsXG4gICAgICAgICdmaXJzdE5hbWUnLFxuICAgICAgICAnbGFzdE5hbWUnLFxuICAgICAgXSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUoJ2FkbWluJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5pc0FjdGl2ZSkudG9CZSgnYm9vbGVhbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jcmVhdGVkQXQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIGFkbWluIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhZG1pbnMgPSBbbW9ja0FkbWluXTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZmluZEFsbC5tb2NrUmVzb2x2ZWRWYWx1ZShhZG1pbnMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRBbGwoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgICByZXN1bHQuZm9yRWFjaCgoYWRtaW4pID0+IHtcbiAgICAgICAgVGVzdEFzc2VydGlvbnMuZXhwZWN0VmFsaWRFbnRpdHkoYWRtaW4sIFsnaWQnLCAndXNlcklkJywgJ2VtYWlsJ10pO1xuICAgICAgICBleHBlY3QoYWRtaW4ucm9sZSkudG9CZSgnYWRtaW4nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIGRlbGV0aW9uIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FkbWluU2VydmljZS5yZW1vdmUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZW1vdmUoJ2FkbWluXzEyMycsIFRFU1RfVVNFUl9JRFMuQURNSU4pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnbWVzc2FnZScpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQubWVzc2FnZSkudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignZGVsZXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZhbGlkYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGlvbkVycm9yID0gbmV3IEVycm9yKCdWYWxpZGF0aW9uIGZhaWxlZCcpO1xuICAgICAgbW9ja0FkbWluU2VydmljZS5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWUodmFsaWRhdGlvbkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZShjcmVhdGVBZG1pbkR0bywgVEVTVF9VU0VSX0lEUy5BRE1JTiksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGR1cGxpY2F0ZSBhZG1pbiBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZUVycm9yID0gbmV3IEVycm9yKCdBZG1pbiBhbHJlYWR5IGV4aXN0cycpO1xuICAgICAgbW9ja0FkbWluU2VydmljZS5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWUoZHVwbGljYXRlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlKGNyZWF0ZUFkbWluRHRvLCBURVNUX1VTRVJfSURTLkFETUlOKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYkVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgbW9ja0FkbWluU2VydmljZS5maW5kQWxsLm1vY2tSZWplY3RlZFZhbHVlKGRiRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kQWxsKFRFU1RfVVNFUl9JRFMuQURNSU4pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEh0dHBFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgYWRtaW4gbGlmZWN5Y2xlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGFkbWluXG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQWRtaW4pO1xuICAgICAgY29uc3QgY3JlYXRlUmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGUoXG4gICAgICAgIGNyZWF0ZUFkbWluRHRvLFxuICAgICAgICBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChjcmVhdGVSZXN1bHQuaWQpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIEZpbmQgY3JlYXRlZCBhZG1pblxuICAgICAgbW9ja0FkbWluU2VydmljZS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tBZG1pbik7XG4gICAgICBjb25zdCBmaW5kUmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kT25lKFxuICAgICAgICBtb2NrQWRtaW4uaWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICApO1xuICAgICAgZXhwZWN0KGZpbmRSZXN1bHQuaWQpLnRvQmUobW9ja0FkbWluLmlkKTtcblxuICAgICAgLy8gVXBkYXRlIGFkbWluXG4gICAgICBjb25zdCB1cGRhdGVkQWRtaW4gPSB7IC4uLm1vY2tBZG1pbiwgZmlyc3ROYW1lOiAnVXBkYXRlZCcgfTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHVwZGF0ZWRBZG1pbik7XG4gICAgICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZShcbiAgICAgICAgbW9ja0FkbWluLmlkLFxuICAgICAgICB7IGZpcnN0TmFtZTogJ1VwZGF0ZWQnIH0sXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICApO1xuICAgICAgZXhwZWN0KHVwZGF0ZVJlc3VsdC5maXJzdE5hbWUpLnRvQmUoJ1VwZGF0ZWQnKTtcblxuICAgICAgLy8gTGlzdCBhbGwgYWRtaW5zXG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUoW3VwZGF0ZWRBZG1pbl0pO1xuICAgICAgY29uc3QgbGlzdFJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZEFsbChURVNUX1VTRVJfSURTLkFETUlOKTtcbiAgICAgIGV4cGVjdChsaXN0UmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG5cbiAgICAgIC8vIFJlbW92ZSBhZG1pblxuICAgICAgbW9ja0FkbWluU2VydmljZS5yZW1vdmUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgIGNvbnN0IHJlbW92ZVJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIucmVtb3ZlKFxuICAgICAgICBtb2NrQWRtaW4uaWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlbW92ZVJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ2RlbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFkbWluIG1hbmFnZW1lbnQgcGVybWlzc2lvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBbGwgb3BlcmF0aW9ucyBzaG91bGQgcmVxdWlyZSBhZG1pbiBhdXRoZW50aWNhdGlvblxuICAgICAgY29uc3Qgb3BlcmF0aW9ucyA9IFtcbiAgICAgICAgKCkgPT4gY29udHJvbGxlci5jcmVhdGUoY3JlYXRlQWRtaW5EdG8sIFRFU1RfVVNFUl9JRFMuQURNSU4pLFxuICAgICAgICAoKSA9PiBjb250cm9sbGVyLmZpbmRBbGwoVEVTVF9VU0VSX0lEUy5BRE1JTiksXG4gICAgICAgICgpID0+IGNvbnRyb2xsZXIuZmluZE9uZSgnYWRtaW5fMTIzJywgVEVTVF9VU0VSX0lEUy5BRE1JTiksXG4gICAgICAgICgpID0+XG4gICAgICAgICAgY29udHJvbGxlci51cGRhdGUoJ2FkbWluXzEyMycsIHVwZGF0ZUFkbWluRHRvLCBURVNUX1VTRVJfSURTLkFETUlOKSxcbiAgICAgICAgKCkgPT4gY29udHJvbGxlci5yZW1vdmUoJ2FkbWluXzEyMycsIFRFU1RfVVNFUl9JRFMuQURNSU4pLFxuICAgICAgXTtcblxuICAgICAgLy8gTW9jayBzdWNjZXNzZnVsIHJlc3BvbnNlcyBmb3IgcGVybWlzc2lvbiB2YWxpZGF0aW9uXG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQWRtaW4pO1xuICAgICAgbW9ja0FkbWluU2VydmljZS5maW5kQWxsLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrQWRtaW5dKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQWRtaW4pO1xuICAgICAgbW9ja0FkbWluU2VydmljZS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0FkbWluKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UucmVtb3ZlLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIC8vIEFsbCBvcGVyYXRpb25zIHNob3VsZCBiZSBhY2Nlc3NpYmxlIHdpdGggYWRtaW4gYXV0aFxuICAgICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2Ygb3BlcmF0aW9ucykge1xuICAgICAgICBhd2FpdCBleHBlY3Qob3BlcmF0aW9uKCkpLnJlc29sdmVzLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=