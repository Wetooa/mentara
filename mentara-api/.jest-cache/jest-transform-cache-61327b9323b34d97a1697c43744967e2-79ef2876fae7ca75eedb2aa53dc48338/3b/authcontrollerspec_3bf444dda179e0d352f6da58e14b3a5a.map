{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/auth.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/auth.controller.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { ConflictException } from '@nestjs/common';\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { createMockPrismaService, TEST_USER_IDS } from '../test-utils';\n\ndescribe('AuthController', () => {\n  let controller: AuthController;\n  let authService: jest.Mocked<AuthService>;\n\n  const mockAuthService = {\n    registerClient: jest.fn(),\n    registerTherapist: jest.fn(),\n    updateUserRole: jest.fn(),\n    validateToken: jest.fn(),\n    getUserProfile: jest.fn(),\n  };\n\n  beforeEach(async () => {\n    const mockPrisma = createMockPrismaService();\n\n    const module: TestingModule = await Test.createTestingModule({\n      controllers: [AuthController],\n      providers: [\n        {\n          provide: AuthService,\n          useValue: mockAuthService,\n        },\n        {\n          provide: PrismaService,\n          useValue: mockPrisma,\n        },\n      ],\n    }).compile();\n\n    controller = module.get<AuthController>(AuthController);\n    authService = module.get(AuthService);\n\n    // Reset all mocks before each test\n    jest.clearAllMocks();\n  });\n\n  describe('basic functionality', () => {\n    it('should be defined', () => {\n      expect(controller).toBeDefined();\n    });\n\n    it('should have authService injected', () => {\n      expect(authService).toBeDefined();\n    });\n  });\n\n  describe('registerClient', () => {\n    const mockClientData = {\n      user: {\n        firstName: 'John',\n        lastName: 'Doe',\n        email: 'john.doe@example.com',\n        mobile: '+1234567890',\n        address: '123 Main St',\n        birthDate: '1990-01-01',\n      },\n      hasSeenTherapistRecommendations: false,\n    };\n\n    it('should successfully register a client', async () => {\n      const expectedResult = {\n        id: TEST_USER_IDS.CLIENT,\n        ...mockClientData,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n\n      authService.registerClient.mockResolvedValue(expectedResult as any);\n\n      const result = await controller.registerClient(\n        TEST_USER_IDS.CLIENT,\n        mockClientData as any,\n      );\n\n      expect(authService.registerClient).toHaveBeenCalledWith(\n        TEST_USER_IDS.CLIENT,\n        mockClientData,\n      );\n      expect(result).toEqual(expectedResult);\n    });\n\n    it('should handle registration conflict', async () => {\n      authService.registerClient.mockRejectedValue(\n        new ConflictException('User already exists'),\n      );\n\n      await expect(\n        controller.registerClient(TEST_USER_IDS.CLIENT, mockClientData as any),\n      ).rejects.toThrow(ConflictException);\n    });\n  });\n\n  describe('error handling', () => {\n    it('should handle service errors gracefully', async () => {\n      authService.registerClient.mockRejectedValue(\n        new Error('Database connection failed'),\n      );\n\n      await expect(\n        controller.registerClient(TEST_USER_IDS.CLIENT, {} as any),\n      ).rejects.toThrow('Database connection failed');\n    });\n  });\n});\n"],"version":3}