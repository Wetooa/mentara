c9d50d71231b5149862bdaaf12f20685
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const moderator_auth_controller_1 = require("./moderator-auth.controller");
const moderator_auth_service_1 = require("../../services/auth/moderator-auth.service");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const zod_validation_pipe_1 = require("../../common/pipes/zod-validation.pipe");
const auth_testing_helpers_1 = require("../../test-utils/auth-testing-helpers");
describe('ModeratorAuthController', () => {
    let controller;
    let moderatorAuthService;
    let mockJwtAuthGuard;
    // Test data constants
    const mockModeratorUser = {
        id: auth_testing_helpers_1.TEST_USER_IDS.MODERATOR,
        email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
        firstName: 'Jane',
        lastName: 'Moderator',
        role: 'moderator',
        emailVerified: true,
        permissions: ['moderate_posts', 'ban_users', 'delete_comments'],
        assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP],
        createdAt: new Date(),
        lastLoginAt: new Date(),
    };
    const mockTokens = {
        accessToken: 'mock-access-token',
        refreshToken: 'mock-refresh-token',
        expiresIn: 3600,
    };
    const mockCreateAccountResult = {
        user: mockModeratorUser,
        message: 'Moderator account created successfully',
    };
    const mockLoginResult = {
        user: mockModeratorUser,
        tokens: mockTokens,
    };
    const mockPermissions = {
        permissions: ['moderate_posts', 'ban_users', 'delete_comments'],
        canModeratePosts: true,
        canBanUsers: true,
        canDeleteComments: true,
        canAccessReports: true,
    };
    const mockAssignedCommunities = {
        assignedCommunities: [
            {
                id: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                name: 'Anxiety Support',
                description: 'A supportive community for anxiety management',
                memberCount: 150,
                pendingPosts: 5,
            },
            {
                id: auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP,
                name: 'Depression Help',
                description: 'Support for depression recovery',
                memberCount: 120,
                pendingPosts: 3,
            },
        ],
    };
    const mockDashboardStats = {
        totalPostsModerated: 45,
        pendingReports: 8,
        communitiesManaged: 2,
        usersModerated: 12,
        recentActivity: [
            {
                action: 'post_moderated',
                timestamp: new Date().toISOString(),
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
            },
            {
                action: 'user_banned',
                timestamp: new Date().toISOString(),
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP,
            },
        ],
    };
    beforeEach(async () => {
        // Create mock services
        const mockModeratorAuthService = {
            createModeratorAccount: jest.fn(),
            loginModerator: jest.fn(),
            getModeratorProfile: jest.fn(),
            getModeratorPermissions: jest.fn(),
            getAssignedCommunities: jest.fn(),
            getModeratorDashboardStats: jest.fn(),
        };
        mockJwtAuthGuard = {
            canActivate: jest.fn().mockReturnValue(true),
        };
        const module = await testing_1.Test.createTestingModule({
            imports: [
                throttler_1.ThrottlerModule.forRoot([
                    {
                        name: 'short',
                        ttl: 1000,
                        limit: 3,
                    },
                ]),
            ],
            controllers: [moderator_auth_controller_1.ModeratorAuthController],
            providers: [
                {
                    provide: moderator_auth_service_1.ModeratorAuthService,
                    useValue: mockModeratorAuthService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: jest.fn().mockReturnValue(true) })
            .compile();
        controller = module.get(moderator_auth_controller_1.ModeratorAuthController);
        moderatorAuthService = module.get(moderator_auth_service_1.ModeratorAuthService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('createModeratorAccount', () => {
        const validRegisterDto = {
            email: 'newmoderator@mentara.com',
            password: 'SecurePass123!',
            firstName: 'New',
            lastName: 'Moderator',
            permissions: ['moderate_posts', 'ban_users'],
            assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
        };
        it('should create moderator account successfully for admin user', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', validRegisterDto);
            // Assert
            expect(moderatorAuthService.createModeratorAccount).toHaveBeenCalledWith(validRegisterDto.email, validRegisterDto.password, validRegisterDto.firstName, validRegisterDto.lastName, validRegisterDto.permissions, validRegisterDto.assignedCommunities);
            expect(result).toEqual({
                user: {
                    id: mockModeratorUser.id,
                    email: mockModeratorUser.email,
                    firstName: mockModeratorUser.firstName,
                    lastName: mockModeratorUser.lastName,
                    role: mockModeratorUser.role,
                    emailVerified: mockModeratorUser.emailVerified,
                },
                message: mockCreateAccountResult.message,
            });
        });
        it('should create moderator account with optional fields', async () => {
            // Arrange
            const minimalRegisterDto = {
                email: 'minimal@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Minimal',
                lastName: 'Moderator',
            };
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', minimalRegisterDto);
            // Assert
            expect(moderatorAuthService.createModeratorAccount).toHaveBeenCalledWith(minimalRegisterDto.email, minimalRegisterDto.password, minimalRegisterDto.firstName, minimalRegisterDto.lastName, [], // empty permissions array
            []);
            expect(result).toBeDefined();
        });
        it('should throw ForbiddenException for non-admin users', async () => {
            // Act & Assert
            await expect(controller.createModeratorAccount('client', validRegisterDto)).rejects.toThrow(common_1.ForbiddenException);
            await expect(controller.createModeratorAccount('therapist', validRegisterDto)).rejects.toThrow(common_1.ForbiddenException);
            await expect(controller.createModeratorAccount('moderator', validRegisterDto)).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle email already exists error', async () => {
            // Arrange
            const error = new common_1.BadRequestException('Email already exists');
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.createModeratorAccount('admin', validRegisterDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.createModeratorAccount('admin', validRegisterDto)).rejects.toThrow(error);
        });
    });
    describe('login', () => {
        const validLoginDto = {
            email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
            password: 'SecurePass123!',
        };
        const mockRequest = {
            ip: '192.168.1.1',
            get: jest.fn().mockReturnValue('Test User Agent'),
        };
        it('should login moderator successfully with valid credentials', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(validLoginDto, mockRequest);
            // Assert
            expect(moderatorAuthService.loginModerator).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequest.ip, 'Test User Agent');
            expect(result).toEqual({
                user: {
                    id: mockModeratorUser.id,
                    email: mockModeratorUser.email,
                    firstName: mockModeratorUser.firstName,
                    lastName: mockModeratorUser.lastName,
                    role: mockModeratorUser.role,
                    emailVerified: mockModeratorUser.emailVerified,
                },
                accessToken: mockTokens.accessToken,
                refreshToken: mockTokens.refreshToken,
                expiresIn: mockTokens.expiresIn,
            });
        });
        it('should handle missing User-Agent header', async () => {
            // Arrange
            const mockRequestWithoutUserAgent = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue(undefined),
            };
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            await controller.login(validLoginDto, mockRequestWithoutUserAgent);
            // Assert
            expect(moderatorAuthService.loginModerator).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequestWithoutUserAgent.ip, undefined);
        });
        it('should handle invalid credentials', async () => {
            // Arrange
            const authError = new common_1.UnauthorizedException('Invalid credentials');
            jest.spyOn(moderatorAuthService, 'loginModerator').mockRejectedValue(authError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(authError);
        });
        it('should handle service errors', async () => {
            // Arrange
            const serviceError = new Error('Database connection failed');
            jest.spyOn(moderatorAuthService, 'loginModerator').mockRejectedValue(serviceError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(serviceError);
        });
    });
    describe('getProfile', () => {
        it('should return moderator profile successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockResolvedValue(mockModeratorUser);
            // Act
            const result = await controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getModeratorProfile).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockModeratorUser);
        });
        it('should handle profile not found', async () => {
            // Arrange
            const notFoundError = new Error('Moderator profile not found');
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('getPermissions', () => {
        it('should return moderator permissions successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockResolvedValue(mockPermissions);
            // Act
            const result = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getModeratorPermissions).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockPermissions);
        });
        it('should handle permissions not found', async () => {
            // Arrange
            const notFoundError = new Error('Moderator permissions not found');
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('getAssignedCommunities', () => {
        it('should return assigned communities successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getAssignedCommunities').mockResolvedValue(mockAssignedCommunities);
            // Act
            const result = await controller.getAssignedCommunities(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getAssignedCommunities).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockAssignedCommunities);
        });
        it('should handle assigned communities not found', async () => {
            // Arrange
            const notFoundError = new Error('Assigned communities not found');
            jest.spyOn(moderatorAuthService, 'getAssignedCommunities').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getAssignedCommunities(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('getDashboardStats', () => {
        it('should return dashboard statistics successfully', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const result = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(moderatorAuthService.getModeratorDashboardStats).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            expect(result).toEqual(mockDashboardStats);
        });
        it('should handle dashboard stats not found', async () => {
            // Arrange
            const notFoundError = new Error('Dashboard stats not found');
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(notFoundError);
        });
    });
    describe('Security Tests', () => {
        it('should validate input data through ZodValidationPipe', () => {
            // This tests that the controller uses proper validation
            const validationPipe = new zod_validation_pipe_1.ZodValidationPipe({});
            expect(validationPipe).toBeDefined();
        });
        it('should apply rate limiting through ThrottlerGuard', () => {
            // Test that throttling is configured
            const createAccountMetadata = Reflect.getMetadata('__throttler_options__', controller.createModeratorAccount);
            const loginMetadata = Reflect.getMetadata('__throttler_options__', controller.login);
            expect(createAccountMetadata).toBeDefined();
            expect(loginMetadata).toBeDefined();
        });
        it('should require authentication for protected endpoints', () => {
            // Test that protected endpoints have JwtAuthGuard
            const protectedMethods = ['createModeratorAccount', 'getProfile', 'getPermissions', 'getAssignedCommunities', 'getDashboardStats'];
            protectedMethods.forEach(method => {
                const guards = Reflect.getMetadata('__guards__', controller[method]);
                expect(guards).toBeDefined();
            });
        });
        it('should allow public access to login endpoint', () => {
            // Test that login endpoint is marked as public
            const publicMetadata = Reflect.getMetadata('isPublic', controller.login);
            expect(publicMetadata).toBeTruthy();
        });
    });
    describe('Role-based Access Control', () => {
        it('should test role-based access for moderator creation', async () => {
            // Test that only admin role can create moderators
            const registerDto = {
                email: 'test@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Test',
                lastName: 'Moderator',
            };
            await auth_testing_helpers_1.RoleBasedTestUtils.testWithRoles(async (userId, role) => {
                try {
                    await controller.createModeratorAccount(role, registerDto);
                    return true;
                }
                catch (error) {
                    return false;
                }
            }, {
                client: false,
                therapist: false,
                admin: true,
                moderator: false,
            });
        });
        it('should validate moderator-specific functionality', async () => {
            // Test that moderator-specific endpoints work for moderators
            const moderatorContext = auth_testing_helpers_1.MockBuilder.createAuthContext('moderator');
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockResolvedValue(mockModeratorUser);
            const result = await controller.getProfile(moderatorContext.userId);
            expect(result).toBeDefined();
            expect(result.role).toBe('moderator');
        });
    });
    describe('Error Handling', () => {
        it('should handle network errors gracefully', async () => {
            // Arrange
            const networkError = new Error('Network timeout');
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockRejectedValue(networkError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR)).rejects.toThrow(networkError);
        });
        it('should handle validation errors', async () => {
            // Test that invalid data would be caught by the validation pipe
            const invalidData = {
                email: 'invalid-email',
                password: '123', // Too short
                firstName: '',
                lastName: '',
            };
            // In a real scenario, this would throw a validation error
            // The pipe would catch this before it reaches the controller
            expect(() => {
                // This would be handled by ZodValidationPipe
                // and would throw a BadRequestException
            }).not.toThrow();
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete moderator account creation workflow', async () => {
            // Arrange
            const createAccountDto = {
                email: 'integration@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Integration',
                lastName: 'Test',
                permissions: ['moderate_posts', 'ban_users'],
                assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
            };
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', createAccountDto);
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockModeratorUser.email);
            expect(result.user.role).toBe('moderator');
            expect(result.message).toBe(mockCreateAccountResult.message);
        });
        it('should handle complete moderator login workflow', async () => {
            // Arrange
            const loginDto = {
                email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
                password: 'SecurePass123!',
            };
            const mockRequest = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue('Test User Agent'),
            };
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(loginDto, mockRequest);
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockModeratorUser.email);
            expect(result.accessToken).toBe(mockTokens.accessToken);
            expect(result.refreshToken).toBe(mockTokens.refreshToken);
            expect(result.expiresIn).toBe(mockTokens.expiresIn);
        });
        it('should handle complete moderator profile workflow', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorProfile').mockResolvedValue(mockModeratorUser);
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockResolvedValue(mockPermissions);
            jest.spyOn(moderatorAuthService, 'getAssignedCommunities').mockResolvedValue(mockAssignedCommunities);
            // Act - Get profile
            const profile = await controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Act - Get permissions
            const permissions = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Act - Get assigned communities
            const communities = await controller.getAssignedCommunities(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(profile).toBeDefined();
            expect(profile.role).toBe('moderator');
            expect(profile.permissions).toEqual(mockModeratorUser.permissions);
            expect(permissions).toBeDefined();
            expect(permissions.canModeratePosts).toBe(true);
            expect(permissions.canBanUsers).toBe(true);
            expect(communities).toBeDefined();
            expect(communities.assignedCommunities).toHaveLength(2);
        });
        it('should handle complete moderator dashboard workflow', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const stats = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(stats).toBeDefined();
            expect(stats.totalPostsModerated).toBe(45);
            expect(stats.pendingReports).toBe(8);
            expect(stats.communitiesManaged).toBe(2);
            expect(stats.recentActivity).toHaveLength(2);
        });
    });
    describe('Data Validation', () => {
        it('should validate moderator creation data structure', () => {
            // Test that we're using the correct DTO structure
            const validModeratorData = {
                email: 'test@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Test',
                lastName: 'Moderator',
                permissions: ['moderate_posts', 'ban_users'],
                assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
            };
            // Verify all required fields are present
            expect(validModeratorData.email).toBeDefined();
            expect(validModeratorData.password).toBeDefined();
            expect(validModeratorData.firstName).toBeDefined();
            expect(validModeratorData.lastName).toBeDefined();
            expect(validModeratorData.permissions).toBeDefined();
            expect(validModeratorData.assignedCommunities).toBeDefined();
        });
        it('should validate login data structure', () => {
            // Test that we're using the correct DTO structure
            const validLoginData = {
                email: 'test@mentara.com',
                password: 'SecurePass123!',
            };
            // Verify all required fields are present
            expect(validLoginData.email).toBeDefined();
            expect(validLoginData.password).toBeDefined();
        });
    });
    describe('Response Format Validation', () => {
        it('should return correctly formatted moderator creation response', async () => {
            // Arrange
            const createAccountDto = {
                email: 'format@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Format',
                lastName: 'Test',
                permissions: ['moderate_posts'],
                assignedCommunities: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
            };
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            // Act
            const result = await controller.createModeratorAccount('admin', createAccountDto);
            // Assert
            expect(result).toHaveProperty('user');
            expect(result).toHaveProperty('message');
            expect(result).not.toHaveProperty('accessToken'); // Creation doesn't include tokens
            expect(result).not.toHaveProperty('refreshToken');
            expect(result.user).toHaveProperty('id');
            expect(result.user).toHaveProperty('email');
            expect(result.user).toHaveProperty('firstName');
            expect(result.user).toHaveProperty('lastName');
            expect(result.user).toHaveProperty('role');
            expect(result.user).toHaveProperty('emailVerified');
        });
        it('should return correctly formatted login response', async () => {
            // Arrange
            const loginDto = {
                email: auth_testing_helpers_1.TEST_EMAILS.MODERATOR,
                password: 'SecurePass123!',
            };
            const mockRequest = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue('Test User Agent'),
            };
            jest.spyOn(moderatorAuthService, 'loginModerator').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(loginDto, mockRequest);
            // Assert
            expect(result).toHaveProperty('user');
            expect(result).toHaveProperty('accessToken');
            expect(result).toHaveProperty('refreshToken');
            expect(result).toHaveProperty('expiresIn');
            expect(result).not.toHaveProperty('message'); // Login doesn't include message
        });
        it('should return correctly formatted permissions response', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorPermissions').mockResolvedValue(mockPermissions);
            // Act
            const result = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(result).toHaveProperty('permissions');
            expect(result).toHaveProperty('canModeratePosts');
            expect(result).toHaveProperty('canBanUsers');
            expect(result).toHaveProperty('canDeleteComments');
            expect(result).toHaveProperty('canAccessReports');
            expect(result.permissions).toBeInstanceOf(Array);
            expect(result.canModeratePosts).toBe(true);
            expect(result.canBanUsers).toBe(true);
        });
        it('should return correctly formatted dashboard stats response', async () => {
            // Arrange
            jest.spyOn(moderatorAuthService, 'getModeratorDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const result = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.MODERATOR);
            // Assert
            expect(result).toHaveProperty('totalPostsModerated');
            expect(result).toHaveProperty('pendingReports');
            expect(result).toHaveProperty('communitiesManaged');
            expect(result).toHaveProperty('usersModerated');
            expect(result).toHaveProperty('recentActivity');
            expect(result.totalPostsModerated).toBe(45);
            expect(result.recentActivity).toBeInstanceOf(Array);
            expect(result.recentActivity).toHaveLength(2);
        });
    });
    describe('Admin-only Functionality', () => {
        it('should enforce admin-only access for moderator creation', async () => {
            // Arrange
            const createAccountDto = {
                email: 'admin-only@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Admin',
                lastName: 'Only',
            };
            // Test each role
            const roles = ['client', 'therapist', 'moderator'];
            for (const role of roles) {
                await expect(controller.createModeratorAccount(role, createAccountDto)).rejects.toThrow(common_1.ForbiddenException);
            }
            // Test admin access
            jest.spyOn(moderatorAuthService, 'createModeratorAccount').mockResolvedValue(mockCreateAccountResult);
            const result = await controller.createModeratorAccount('admin', createAccountDto);
            expect(result).toBeDefined();
        });
        it('should validate admin role before moderator creation', async () => {
            // Arrange
            const createAccountDto = {
                email: 'validation@mentara.com',
                password: 'SecurePass123!',
                firstName: 'Validation',
                lastName: 'Test',
            };
            // Act & Assert
            await expect(controller.createModeratorAccount('invalid-role', createAccountDto)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvY29udHJvbGxlcnMvbW9kZXJhdG9yLWF1dGguY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDJDQUl3QjtBQUN4QixpREFBb0U7QUFDcEUsMkVBQXNFO0FBQ3RFLHVGQUFrRjtBQUNsRiw2REFBd0Q7QUFDeEQsZ0ZBQTJFO0FBQzNFLGdGQVMrQztBQUUvQyxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUksVUFBbUMsQ0FBQztJQUN4QyxJQUFJLG9CQUEwQyxDQUFDO0lBQy9DLElBQUksZ0JBQTJDLENBQUM7SUFFaEQsc0JBQXNCO0lBQ3RCLE1BQU0saUJBQWlCLEdBQUc7UUFDeEIsRUFBRSxFQUFFLG9DQUFhLENBQUMsU0FBUztRQUMzQixLQUFLLEVBQUUsa0NBQVcsQ0FBQyxTQUFTO1FBQzVCLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLFFBQVEsRUFBRSxXQUFXO1FBQ3JCLElBQUksRUFBRSxXQUFXO1FBQ2pCLGFBQWEsRUFBRSxJQUFJO1FBQ25CLFdBQVcsRUFBRSxDQUFDLGdCQUFnQixFQUFFLFdBQVcsRUFBRSxpQkFBaUIsQ0FBQztRQUMvRCxtQkFBbUIsRUFBRSxDQUFDLHlDQUFrQixDQUFDLGVBQWUsRUFBRSx5Q0FBa0IsQ0FBQyxlQUFlLENBQUM7UUFDN0YsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtLQUN4QixDQUFDO0lBRUYsTUFBTSxVQUFVLEdBQUc7UUFDakIsV0FBVyxFQUFFLG1CQUFtQjtRQUNoQyxZQUFZLEVBQUUsb0JBQW9CO1FBQ2xDLFNBQVMsRUFBRSxJQUFJO0tBQ2hCLENBQUM7SUFFRixNQUFNLHVCQUF1QixHQUFHO1FBQzlCLElBQUksRUFBRSxpQkFBaUI7UUFDdkIsT0FBTyxFQUFFLHdDQUF3QztLQUNsRCxDQUFD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Q2pCLE1BQU0sS0FBSyxHQUFHLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUVuRCxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUN6QixNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUNyRiwyQkFBa0IsQ0FDbkIsQ0FBQztZQUNKLENBQUM7WUFFRCxvQkFBb0I7WUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDdEcsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsT0FBTyxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFDbEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BFLFVBQVU7WUFDVixNQUFNLGdCQUFnQixHQUFHO2dCQUN2QixLQUFLLEVBQUUsd0JBQXdCO2dCQUMvQixRQUFRLEVBQUUsZ0JBQWdCO2dCQUMxQixTQUFTLEVBQUUsWUFBWTtnQkFDdkIsUUFBUSxFQUFFLE1BQU07YUFDakIsQ0FBQztZQUVGLGVBQWU7WUFDZixNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsc0JBQXNCLENBQUMsY0FBYyxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUMvRiwyQkFBa0IsQ0FDbkIsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYXV0aC9jb250cm9sbGVycy9tb2RlcmF0b3ItYXV0aC5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBcbiAgVW5hdXRob3JpemVkRXhjZXB0aW9uLCBcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbiwgXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbiBcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVGhyb3R0bGVyR3VhcmQsIFRocm90dGxlck1vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGhyb3R0bGVyJztcbmltcG9ydCB7IE1vZGVyYXRvckF1dGhDb250cm9sbGVyIH0gZnJvbSAnLi9tb2RlcmF0b3ItYXV0aC5jb250cm9sbGVyJztcbmltcG9ydCB7IE1vZGVyYXRvckF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYXV0aC9tb2RlcmF0b3ItYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBab2RWYWxpZGF0aW9uUGlwZSB9IGZyb20gJy4uLy4uL2NvbW1vbi9waXBlcy96b2QtdmFsaWRhdGlvbi5waXBlJztcbmltcG9ydCB7XG4gIE1vY2tCdWlsZGVyLFxuICBUZXN0RGF0YUdlbmVyYXRvcixcbiAgVGVzdEFzc2VydGlvbnMsXG4gIFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMsXG4gIFJvbGVCYXNlZFRlc3RVdGlscyxcbiAgVEVTVF9VU0VSX0lEUyxcbiAgVEVTVF9FTUFJTFMsXG4gIFRFU1RfQ09NTVVOSVRZX0lEUyxcbn0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5cbmRlc2NyaWJlKCdNb2RlcmF0b3JBdXRoQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IE1vZGVyYXRvckF1dGhDb250cm9sbGVyO1xuICBsZXQgbW9kZXJhdG9yQXV0aFNlcnZpY2U6IE1vZGVyYXRvckF1dGhTZXJ2aWNlO1xuICBsZXQgbW9ja0p3dEF1dGhHdWFyZDogamVzdC5Nb2NrZWQ8Snd0QXV0aEd1YXJkPjtcblxuICAvLyBUZXN0IGRhdGEgY29uc3RhbnRzXG4gIGNvbnN0IG1vY2tNb2RlcmF0b3JVc2VyID0ge1xuICAgIGlkOiBURVNUX1VTRVJfSURTLk1PREVSQVRPUixcbiAgICBlbWFpbDogVEVTVF9FTUFJTFMuTU9ERVJBVE9SLFxuICAgIGZpcnN0TmFtZTogJ0phbmUnLFxuICAgIGxhc3ROYW1lOiAnTW9kZXJhdG9yJyxcbiAgICByb2xlOiAnbW9kZXJhdG9yJyxcbiAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgIHBlcm1pc3Npb25zOiBbJ21vZGVyYXRlX3Bvc3RzJywgJ2Jhbl91c2VycycsICdkZWxldGVfY29tbWVudHMnXSxcbiAgICBhc3NpZ25lZENvbW11bml0aWVzOiBbVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgVEVTVF9DT01NVU5JVFlfSURTLkRFUFJFU1NJT05fSEVMUF0sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIGxhc3RMb2dpbkF0OiBuZXcgRGF0ZSgpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tUb2tlbnMgPSB7XG4gICAgYWNjZXNzVG9rZW46ICdtb2NrLWFjY2Vzcy10b2tlbicsXG4gICAgcmVmcmVzaFRva2VuOiAnbW9jay1yZWZyZXNoLXRva2VuJyxcbiAgICBleHBpcmVzSW46IDM2MDAsXG4gIH07XG5cbiAgY29uc3QgbW9ja0NyZWF0ZUFjY291bnRSZXN1bHQgPSB7XG4gICAgdXNlcjogbW9ja01vZGVyYXRvclVzZXIsXG4gICAgbWVzc2FnZTogJ01vZGVyYXRvciBhY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfTtcblxuICBjb25zdCBtb2NrTG9naW5SZXN1bHQgPSB7XG4gICAgdXNlcjogbW9ja01vZGVyYXRvclVzZXIsXG4gICAgdG9rZW5zOiBtb2NrVG9rZW5zLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tQZXJtaXNzaW9ucyA9IHtcbiAgICBwZXJtaXNzaW9uczogWydtb2RlcmF0ZV9wb3N0cycsICdiYW5fdXNlcnMnLCAnZGVsZXRlX2NvbW1lbnRzJ10sXG4gICAgY2FuTW9kZXJhdGVQb3N0czogdHJ1ZSxcbiAgICBjYW5CYW5Vc2VyczogdHJ1ZSxcbiAgICBjYW5EZWxldGVDb21tZW50czogdHJ1ZSxcbiAgICBjYW5BY2Nlc3NSZXBvcnRzOiB0cnVlLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tBc3NpZ25lZENvbW11bml0aWVzID0ge1xuICAgIGFzc2lnbmVkQ29tbXVuaXRpZXM6IFtcbiAgICAgIHtcbiAgICAgICAgaWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgIG5hbWU6ICdBbnhpZXR5IFN1cHBvcnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0Egc3VwcG9ydGl2ZSBjb21tdW5pdHkgZm9yIGFueGlldHkgbWFuYWdlbWVudCcsXG4gICAgICAgIG1lbWJlckNvdW50OiAxNTAsXG4gICAgICAgIHBlbmRpbmdQb3N0czogNSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiBURVNUX0NPTU1VTklUWV9JRFMuREVQUkVTU0lPTl9IRUxQLFxuICAgICAgICBuYW1lOiAnRGVwcmVzc2lvbiBIZWxwJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdTdXBwb3J0IGZvciBkZXByZXNzaW9uIHJlY292ZXJ5JyxcbiAgICAgICAgbWVtYmVyQ291bnQ6IDEyMCxcbiAgICAgICAgcGVuZGluZ1Bvc3RzOiAzLFxuICAgICAgfSxcbiAgICBdLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tEYXNoYm9hcmRTdGF0cyA9IHtcbiAgICB0b3RhbFBvc3RzTW9kZXJhdGVkOiA0NSxcbiAgICBwZW5kaW5nUmVwb3J0czogOCxcbiAgICBjb21tdW5pdGllc01hbmFnZWQ6IDIsXG4gICAgdXNlcnNNb2RlcmF0ZWQ6IDEyLFxuICAgIHJlY2VudEFjdGl2aXR5OiBbXG4gICAgICB7XG4gICAgICAgIGFjdGlvbjogJ3Bvc3RfbW9kZXJhdGVkJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGNvbW11bml0eUlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgYWN0aW9uOiAndXNlcl9iYW5uZWQnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5ERVBSRVNTSU9OX0hFTFAsXG4gICAgICB9LFxuICAgIF0sXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIG1vY2sgc2VydmljZXNcbiAgICBjb25zdCBtb2NrTW9kZXJhdG9yQXV0aFNlcnZpY2UgPSB7XG4gICAgICBjcmVhdGVNb2RlcmF0b3JBY2NvdW50OiBqZXN0LmZuKCksXG4gICAgICBsb2dpbk1vZGVyYXRvcjogamVzdC5mbigpLFxuICAgICAgZ2V0TW9kZXJhdG9yUHJvZmlsZTogamVzdC5mbigpLFxuICAgICAgZ2V0TW9kZXJhdG9yUGVybWlzc2lvbnM6IGplc3QuZm4oKSxcbiAgICAgIGdldEFzc2lnbmVkQ29tbXVuaXRpZXM6IGplc3QuZm4oKSxcbiAgICAgIGdldE1vZGVyYXRvckRhc2hib2FyZFN0YXRzOiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIG1vY2tKd3RBdXRoR3VhcmQgPSB7XG4gICAgICBjYW5BY3RpdmF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgICB9IGFzIGFueTtcblxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBpbXBvcnRzOiBbXG4gICAgICAgIFRocm90dGxlck1vZHVsZS5mb3JSb290KFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnc2hvcnQnLFxuICAgICAgICAgICAgdHRsOiAxMDAwLFxuICAgICAgICAgICAgbGltaXQ6IDMsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSksXG4gICAgICBdLFxuICAgICAgY29udHJvbGxlcnM6IFtNb2RlcmF0b3JBdXRoQ29udHJvbGxlcl0sXG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IE1vZGVyYXRvckF1dGhTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrTW9kZXJhdG9yQXV0aFNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gICAgICAub3ZlcnJpZGVHdWFyZChKd3RBdXRoR3VhcmQpXG4gICAgICAudXNlVmFsdWUobW9ja0p3dEF1dGhHdWFyZClcbiAgICAgIC5vdmVycmlkZUd1YXJkKFRocm90dGxlckd1YXJkKVxuICAgICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSkgfSlcbiAgICAgIC5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxNb2RlcmF0b3JBdXRoQ29udHJvbGxlcj4oTW9kZXJhdG9yQXV0aENvbnRyb2xsZXIpO1xuICAgIG1vZGVyYXRvckF1dGhTZXJ2aWNlID0gbW9kdWxlLmdldDxNb2RlcmF0b3JBdXRoU2VydmljZT4oTW9kZXJhdG9yQXV0aFNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZFJlZ2lzdGVyRHRvID0ge1xuICAgICAgZW1haWw6ICduZXdtb2RlcmF0b3JAbWVudGFyYS5jb20nLFxuICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgbGFzdE5hbWU6ICdNb2RlcmF0b3InLFxuICAgICAgcGVybWlzc2lvbnM6IFsnbW9kZXJhdGVfcG9zdHMnLCAnYmFuX3VzZXJzJ10sXG4gICAgICBhc3NpZ25lZENvbW11bml0aWVzOiBbVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVF0sXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG1vZGVyYXRvciBhY2NvdW50IHN1Y2Nlc3NmdWxseSBmb3IgYWRtaW4gdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdjcmVhdGVNb2RlcmF0b3JBY2NvdW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZUFjY291bnRSZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnYWRtaW4nLCB2YWxpZFJlZ2lzdGVyRHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9kZXJhdG9yQXV0aFNlcnZpY2UuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8uZW1haWwsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8ucGFzc3dvcmQsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8uZmlyc3ROYW1lLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLmxhc3ROYW1lLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLnBlcm1pc3Npb25zLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLmFzc2lnbmVkQ29tbXVuaXRpZXMsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogbW9ja01vZGVyYXRvclVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IG1vY2tNb2RlcmF0b3JVc2VyLmVtYWlsLFxuICAgICAgICAgIGZpcnN0TmFtZTogbW9ja01vZGVyYXRvclVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiBtb2NrTW9kZXJhdG9yVXNlci5sYXN0TmFtZSxcbiAgICAgICAgICByb2xlOiBtb2NrTW9kZXJhdG9yVXNlci5yb2xlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IG1vY2tNb2RlcmF0b3JVc2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2U6IG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0Lm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG1vZGVyYXRvciBhY2NvdW50IHdpdGggb3B0aW9uYWwgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbWluaW1hbFJlZ2lzdGVyRHRvID0ge1xuICAgICAgICBlbWFpbDogJ21pbmltYWxAbWVudGFyYS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnTWluaW1hbCcsXG4gICAgICAgIGxhc3ROYW1lOiAnTW9kZXJhdG9yJyxcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdjcmVhdGVNb2RlcmF0b3JBY2NvdW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZUFjY291bnRSZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnYWRtaW4nLCBtaW5pbWFsUmVnaXN0ZXJEdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JBdXRoU2VydmljZS5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWluaW1hbFJlZ2lzdGVyRHRvLmVtYWlsLFxuICAgICAgICBtaW5pbWFsUmVnaXN0ZXJEdG8ucGFzc3dvcmQsXG4gICAgICAgIG1pbmltYWxSZWdpc3RlckR0by5maXJzdE5hbWUsXG4gICAgICAgIG1pbmltYWxSZWdpc3RlckR0by5sYXN0TmFtZSxcbiAgICAgICAgW10sIC8vIGVtcHR5IHBlcm1pc3Npb25zIGFycmF5XG4gICAgICAgIFtdLCAvLyBlbXB0eSBhc3NpZ25lZENvbW11bml0aWVzIGFycmF5XG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgRm9yYmlkZGVuRXhjZXB0aW9uIGZvciBub24tYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ2NsaWVudCcsIHZhbGlkUmVnaXN0ZXJEdG8pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCd0aGVyYXBpc3QnLCB2YWxpZFJlZ2lzdGVyRHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBGb3JiaWRkZW5FeGNlcHRpb24sXG4gICAgICApO1xuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnbW9kZXJhdG9yJywgdmFsaWRSZWdpc3RlckR0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgRm9yYmlkZGVuRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtYWlsIGFscmVhZHkgZXhpc3RzIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignRW1haWwgYWxyZWFkeSBleGlzdHMnKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdjcmVhdGVNb2RlcmF0b3JBY2NvdW50JykubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ2FkbWluJywgdmFsaWRSZWdpc3RlckR0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2NyZWF0ZU1vZGVyYXRvckFjY291bnQnKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudCgnYWRtaW4nLCB2YWxpZFJlZ2lzdGVyRHRvKSkucmVqZWN0cy50b1Rocm93KGVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvZ2luJywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkTG9naW5EdG8gPSB7XG4gICAgICBlbWFpbDogVEVTVF9FTUFJTFMuTU9ERVJBVE9SLFxuICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3QgVXNlciBBZ2VudCcpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgaXQoJ3Nob3VsZCBsb2dpbiBtb2RlcmF0b3Igc3VjY2Vzc2Z1bGx5IHdpdGggdmFsaWQgY3JlZGVudGlhbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnbG9naW5Nb2RlcmF0b3InKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG9naW5SZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubG9naW4odmFsaWRMb2dpbkR0bywgbW9ja1JlcXVlc3QpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JBdXRoU2VydmljZS5sb2dpbk1vZGVyYXRvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHZhbGlkTG9naW5EdG8uZW1haWwsXG4gICAgICAgIHZhbGlkTG9naW5EdG8ucGFzc3dvcmQsXG4gICAgICAgIG1vY2tSZXF1ZXN0LmlwLFxuICAgICAgICAnVGVzdCBVc2VyIEFnZW50JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IG1vY2tNb2RlcmF0b3JVc2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiBtb2NrTW9kZXJhdG9yVXNlci5lbWFpbCxcbiAgICAgICAgICBmaXJzdE5hbWU6IG1vY2tNb2RlcmF0b3JVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbW9ja01vZGVyYXRvclVzZXIubGFzdE5hbWUsXG4gICAgICAgICAgcm9sZTogbW9ja01vZGVyYXRvclVzZXIucm9sZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBtb2NrTW9kZXJhdG9yVXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NUb2tlbjogbW9ja1Rva2Vucy5hY2Nlc3NUb2tlbixcbiAgICAgICAgcmVmcmVzaFRva2VuOiBtb2NrVG9rZW5zLnJlZnJlc2hUb2tlbixcbiAgICAgICAgZXhwaXJlc0luOiBtb2NrVG9rZW5zLmV4cGlyZXNJbixcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBVc2VyLUFnZW50IGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0V2l0aG91dFVzZXJBZ2VudCA9IHtcbiAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdsb2dpbk1vZGVyYXRvcicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dpblJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgY29udHJvbGxlci5sb2dpbih2YWxpZExvZ2luRHRvLCBtb2NrUmVxdWVzdFdpdGhvdXRVc2VyQWdlbnQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2RlcmF0b3JBdXRoU2VydmljZS5sb2dpbk1vZGVyYXRvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHZhbGlkTG9naW5EdG8uZW1haWwsXG4gICAgICAgIHZhbGlkTG9naW5EdG8ucGFzc3dvcmQsXG4gICAgICAgIG1vY2tSZXF1ZXN0V2l0aG91dFVzZXJBZ2VudC5pcCxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgY3JlZGVudGlhbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBhdXRoRXJyb3IgPSBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnbG9naW5Nb2RlcmF0b3InKS5tb2NrUmVqZWN0ZWRWYWx1ZShhdXRoRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmxvZ2luKHZhbGlkTG9naW5EdG8sIG1vY2tSZXF1ZXN0KSkucmVqZWN0cy50b1Rocm93KGF1dGhFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdsb2dpbk1vZGVyYXRvcicpLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIubG9naW4odmFsaWRMb2dpbkR0bywgbW9ja1JlcXVlc3QpKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByb2ZpbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbW9kZXJhdG9yIHByb2ZpbGUgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclByb2ZpbGUnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yVXNlcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRQcm9maWxlKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9kZXJhdG9yQXV0aFNlcnZpY2UuZ2V0TW9kZXJhdG9yUHJvZmlsZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTW9kZXJhdG9yVXNlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwcm9maWxlIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5vdEZvdW5kRXJyb3IgPSBuZXcgRXJyb3IoJ01vZGVyYXRvciBwcm9maWxlIG5vdCBmb3VuZCcpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclByb2ZpbGUnKS5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRQcm9maWxlKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKSkucmVqZWN0cy50b1Rocm93KG5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGVybWlzc2lvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbW9kZXJhdG9yIHBlcm1pc3Npb25zIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JQZXJtaXNzaW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXJtaXNzaW9ucyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRQZXJtaXNzaW9ucyhURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vZGVyYXRvckF1dGhTZXJ2aWNlLmdldE1vZGVyYXRvclBlcm1pc3Npb25zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQZXJtaXNzaW9ucyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwZXJtaXNzaW9ucyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdNb2RlcmF0b3IgcGVybWlzc2lvbnMgbm90IGZvdW5kJyk7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yUGVybWlzc2lvbnMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRQZXJtaXNzaW9ucyhURVNUX1VTRVJfSURTLk1PREVSQVRPUikpLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEFzc2lnbmVkQ29tbXVuaXRpZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYXNzaWduZWQgY29tbXVuaXRpZXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldEFzc2lnbmVkQ29tbXVuaXRpZXMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQXNzaWduZWRDb21tdW5pdGllcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBc3NpZ25lZENvbW11bml0aWVzKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9kZXJhdG9yQXV0aFNlcnZpY2UuZ2V0QXNzaWduZWRDb21tdW5pdGllcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQXNzaWduZWRDb21tdW5pdGllcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhc3NpZ25lZCBjb21tdW5pdGllcyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdBc3NpZ25lZCBjb21tdW5pdGllcyBub3QgZm91bmQnKTtcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRBc3NpZ25lZENvbW11bml0aWVzJykubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0QXNzaWduZWRDb21tdW5pdGllcyhURVNUX1VTRVJfSURTLk1PREVSQVRPUikpLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldERhc2hib2FyZFN0YXRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRhc2hib2FyZCBzdGF0aXN0aWNzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdnZXRNb2RlcmF0b3JEYXNoYm9hcmRTdGF0cycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXNoYm9hcmRTdGF0cyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXREYXNoYm9hcmRTdGF0cyhURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vZGVyYXRvckF1dGhTZXJ2aWNlLmdldE1vZGVyYXRvckRhc2hib2FyZFN0YXRzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tEYXNoYm9hcmRTdGF0cyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXNoYm9hcmQgc3RhdHMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignRGFzaGJvYXJkIHN0YXRzIG5vdCBmb3VuZCcpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvckRhc2hib2FyZFN0YXRzJykubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0RGFzaGJvYXJkU3RhdHMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGlucHV0IGRhdGEgdGhyb3VnaCBab2RWYWxpZGF0aW9uUGlwZScsICgpID0+IHtcbiAgICAgIC8vIFRoaXMgdGVzdHMgdGhhdCB0aGUgY29udHJvbGxlciB1c2VzIHByb3BlciB2YWxpZGF0aW9uXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUGlwZSA9IG5ldyBab2RWYWxpZGF0aW9uUGlwZSh7fSBhcyBhbnkpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25QaXBlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhcHBseSByYXRlIGxpbWl0aW5nIHRocm91Z2ggVGhyb3R0bGVyR3VhcmQnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgdGhyb3R0bGluZyBpcyBjb25maWd1cmVkXG4gICAgICBjb25zdCBjcmVhdGVBY2NvdW50TWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdfX3Rocm90dGxlcl9vcHRpb25zX18nLCBjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQpO1xuICAgICAgY29uc3QgbG9naW5NZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fdGhyb3R0bGVyX29wdGlvbnNfXycsIGNvbnRyb2xsZXIubG9naW4pO1xuICAgICAgXG4gICAgICBleHBlY3QoY3JlYXRlQWNjb3VudE1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxvZ2luTWV0YWRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcXVpcmUgYXV0aGVudGljYXRpb24gZm9yIHByb3RlY3RlZCBlbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgcHJvdGVjdGVkIGVuZHBvaW50cyBoYXZlIEp3dEF1dGhHdWFyZFxuICAgICAgY29uc3QgcHJvdGVjdGVkTWV0aG9kcyA9IFsnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcsICdnZXRQcm9maWxlJywgJ2dldFBlcm1pc3Npb25zJywgJ2dldEFzc2lnbmVkQ29tbXVuaXRpZXMnLCAnZ2V0RGFzaGJvYXJkU3RhdHMnXTtcbiAgICAgIFxuICAgICAgcHJvdGVjdGVkTWV0aG9kcy5mb3JFYWNoKG1ldGhvZCA9PiB7XG4gICAgICAgIGNvbnN0IGd1YXJkcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fZ3VhcmRzX18nLCBjb250cm9sbGVyW21ldGhvZCBhcyBrZXlvZiBNb2RlcmF0b3JBdXRoQ29udHJvbGxlcl0pO1xuICAgICAgICBleHBlY3QoZ3VhcmRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHB1YmxpYyBhY2Nlc3MgdG8gbG9naW4gZW5kcG9pbnQnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgbG9naW4gZW5kcG9pbnQgaXMgbWFya2VkIGFzIHB1YmxpY1xuICAgICAgY29uc3QgcHVibGljTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdpc1B1YmxpYycsIGNvbnRyb2xsZXIubG9naW4pO1xuICAgICAgZXhwZWN0KHB1YmxpY01ldGFkYXRhKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSb2xlLWJhc2VkIEFjY2VzcyBDb250cm9sJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdGVzdCByb2xlLWJhc2VkIGFjY2VzcyBmb3IgbW9kZXJhdG9yIGNyZWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IG9ubHkgYWRtaW4gcm9sZSBjYW4gY3JlYXRlIG1vZGVyYXRvcnNcbiAgICAgIGNvbnN0IHJlZ2lzdGVyRHRvID0ge1xuICAgICAgICBlbWFpbDogJ3Rlc3RAbWVudGFyYS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnVGVzdCcsXG4gICAgICAgIGxhc3ROYW1lOiAnTW9kZXJhdG9yJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IFJvbGVCYXNlZFRlc3RVdGlscy50ZXN0V2l0aFJvbGVzKFxuICAgICAgICBhc3luYyAodXNlcklkOiBzdHJpbmcsIHJvbGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQocm9sZSwgcmVnaXN0ZXJEdG8pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjbGllbnQ6IGZhbHNlLFxuICAgICAgICAgIHRoZXJhcGlzdDogZmFsc2UsXG4gICAgICAgICAgYWRtaW46IHRydWUsXG4gICAgICAgICAgbW9kZXJhdG9yOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG1vZGVyYXRvci1zcGVjaWZpYyBmdW5jdGlvbmFsaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IG1vZGVyYXRvci1zcGVjaWZpYyBlbmRwb2ludHMgd29yayBmb3IgbW9kZXJhdG9yc1xuICAgICAgY29uc3QgbW9kZXJhdG9yQ29udGV4dCA9IE1vY2tCdWlsZGVyLmNyZWF0ZUF1dGhDb250ZXh0KCdtb2RlcmF0b3InKTtcbiAgICAgIFxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclByb2ZpbGUnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yVXNlcik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShtb2RlcmF0b3JDb250ZXh0LnVzZXJJZCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUoJ21vZGVyYXRvcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmV0d29yayBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5ldHdvcmtFcnJvciA9IG5ldyBFcnJvcignTmV0d29yayB0aW1lb3V0Jyk7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yUHJvZmlsZScpLm1vY2tSZWplY3RlZFZhbHVlKG5ldHdvcmtFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShURVNUX1VTRVJfSURTLk1PREVSQVRPUikpLnJlamVjdHMudG9UaHJvdyhuZXR3b3JrRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgaW52YWxpZCBkYXRhIHdvdWxkIGJlIGNhdWdodCBieSB0aGUgdmFsaWRhdGlvbiBwaXBlXG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICdpbnZhbGlkLWVtYWlsJyxcbiAgICAgICAgcGFzc3dvcmQ6ICcxMjMnLCAvLyBUb28gc2hvcnRcbiAgICAgICAgZmlyc3ROYW1lOiAnJyxcbiAgICAgICAgbGFzdE5hbWU6ICcnLFxuICAgICAgfTtcblxuICAgICAgLy8gSW4gYSByZWFsIHNjZW5hcmlvLCB0aGlzIHdvdWxkIHRocm93IGEgdmFsaWRhdGlvbiBlcnJvclxuICAgICAgLy8gVGhlIHBpcGUgd291bGQgY2F0Y2ggdGhpcyBiZWZvcmUgaXQgcmVhY2hlcyB0aGUgY29udHJvbGxlclxuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgLy8gVGhpcyB3b3VsZCBiZSBoYW5kbGVkIGJ5IFpvZFZhbGlkYXRpb25QaXBlXG4gICAgICAgIC8vIGFuZCB3b3VsZCB0aHJvdyBhIEJhZFJlcXVlc3RFeGNlcHRpb25cbiAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBtb2RlcmF0b3IgYWNjb3VudCBjcmVhdGlvbiB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNyZWF0ZUFjY291bnREdG8gPSB7XG4gICAgICAgIGVtYWlsOiAnaW50ZWdyYXRpb25AbWVudGFyYS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnSW50ZWdyYXRpb24nLFxuICAgICAgICBsYXN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBwZXJtaXNzaW9uczogWydtb2RlcmF0ZV9wb3N0cycsICdiYW5fdXNlcnMnXSxcbiAgICAgICAgYXNzaWduZWRDb21tdW5pdGllczogW1RFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlRdLFxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2NyZWF0ZU1vZGVyYXRvckFjY291bnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ3JlYXRlQWNjb3VudFJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCdhZG1pbicsIGNyZWF0ZUFjY291bnREdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIuZW1haWwpLnRvQmUobW9ja01vZGVyYXRvclVzZXIuZW1haWwpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLnJvbGUpLnRvQmUoJ21vZGVyYXRvcicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0JlKG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0Lm1lc3NhZ2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgbW9kZXJhdG9yIGxvZ2luIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbG9naW5EdG8gPSB7XG4gICAgICAgIGVtYWlsOiBURVNUX0VNQUlMUy5NT0RFUkFUT1IsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3QgVXNlciBBZ2VudCcpLFxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdsb2dpbk1vZGVyYXRvcicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dpblJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5sb2dpbihsb2dpbkR0bywgbW9ja1JlcXVlc3QpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIuZW1haWwpLnRvQmUobW9ja01vZGVyYXRvclVzZXIuZW1haWwpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hY2Nlc3NUb2tlbikudG9CZShtb2NrVG9rZW5zLmFjY2Vzc1Rva2VuKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmcmVzaFRva2VuKS50b0JlKG1vY2tUb2tlbnMucmVmcmVzaFRva2VuKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXhwaXJlc0luKS50b0JlKG1vY2tUb2tlbnMuZXhwaXJlc0luKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXRlIG1vZGVyYXRvciBwcm9maWxlIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldE1vZGVyYXRvclByb2ZpbGUnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdG9yVXNlcik7XG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yUGVybWlzc2lvbnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGVybWlzc2lvbnMpO1xuICAgICAgamVzdC5zcHlPbihtb2RlcmF0b3JBdXRoU2VydmljZSwgJ2dldEFzc2lnbmVkQ29tbXVuaXRpZXMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQXNzaWduZWRDb21tdW5pdGllcyk7XG5cbiAgICAgIC8vIEFjdCAtIEdldCBwcm9maWxlXG4gICAgICBjb25zdCBwcm9maWxlID0gYXdhaXQgY29udHJvbGxlci5nZXRQcm9maWxlKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcbiAgICAgIFxuICAgICAgLy8gQWN0IC0gR2V0IHBlcm1pc3Npb25zXG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UGVybWlzc2lvbnMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuICAgICAgXG4gICAgICAvLyBBY3QgLSBHZXQgYXNzaWduZWQgY29tbXVuaXRpZXNcbiAgICAgIGNvbnN0IGNvbW11bml0aWVzID0gYXdhaXQgY29udHJvbGxlci5nZXRBc3NpZ25lZENvbW11bml0aWVzKFRFU1RfVVNFUl9JRFMuTU9ERVJBVE9SKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocHJvZmlsZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChwcm9maWxlLnJvbGUpLnRvQmUoJ21vZGVyYXRvcicpO1xuICAgICAgZXhwZWN0KHByb2ZpbGUucGVybWlzc2lvbnMpLnRvRXF1YWwobW9ja01vZGVyYXRvclVzZXIucGVybWlzc2lvbnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocGVybWlzc2lvbnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuTW9kZXJhdGVQb3N0cykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5CYW5Vc2VycykudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGNvbW11bml0aWVzLmFzc2lnbmVkQ29tbXVuaXRpZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXRlIG1vZGVyYXRvciBkYXNoYm9hcmQgd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yRGFzaGJvYXJkU3RhdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGFzaGJvYXJkU3RhdHMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgY29udHJvbGxlci5nZXREYXNoYm9hcmRTdGF0cyhURVNUX1VTRVJfSURTLk1PREVSQVRPUik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHN0YXRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUG9zdHNNb2RlcmF0ZWQpLnRvQmUoNDUpO1xuICAgICAgZXhwZWN0KHN0YXRzLnBlbmRpbmdSZXBvcnRzKS50b0JlKDgpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbW11bml0aWVzTWFuYWdlZCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChzdGF0cy5yZWNlbnRBY3Rpdml0eSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YSBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgbW9kZXJhdG9yIGNyZWF0aW9uIGRhdGEgc3RydWN0dXJlJywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IHdlJ3JlIHVzaW5nIHRoZSBjb3JyZWN0IERUTyBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IHZhbGlkTW9kZXJhdG9yRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICd0ZXN0QG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBsYXN0TmFtZTogJ01vZGVyYXRvcicsXG4gICAgICAgIHBlcm1pc3Npb25zOiBbJ21vZGVyYXRlX3Bvc3RzJywgJ2Jhbl91c2VycyddLFxuICAgICAgICBhc3NpZ25lZENvbW11bml0aWVzOiBbVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVF0sXG4gICAgICB9O1xuXG4gICAgICAvLyBWZXJpZnkgYWxsIHJlcXVpcmVkIGZpZWxkcyBhcmUgcHJlc2VudFxuICAgICAgZXhwZWN0KHZhbGlkTW9kZXJhdG9yRGF0YS5lbWFpbCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh2YWxpZE1vZGVyYXRvckRhdGEucGFzc3dvcmQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodmFsaWRNb2RlcmF0b3JEYXRhLmZpcnN0TmFtZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh2YWxpZE1vZGVyYXRvckRhdGEubGFzdE5hbWUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodmFsaWRNb2RlcmF0b3JEYXRhLnBlcm1pc3Npb25zKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHZhbGlkTW9kZXJhdG9yRGF0YS5hc3NpZ25lZENvbW11bml0aWVzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBsb2dpbiBkYXRhIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCB3ZSdyZSB1c2luZyB0aGUgY29ycmVjdCBEVE8gc3RydWN0dXJlXG4gICAgICBjb25zdCB2YWxpZExvZ2luRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICd0ZXN0QG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICB9O1xuXG4gICAgICAvLyBWZXJpZnkgYWxsIHJlcXVpcmVkIGZpZWxkcyBhcmUgcHJlc2VudFxuICAgICAgZXhwZWN0KHZhbGlkTG9naW5EYXRhLmVtYWlsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHZhbGlkTG9naW5EYXRhLnBhc3N3b3JkKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzcG9uc2UgRm9ybWF0IFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdGx5IGZvcm1hdHRlZCBtb2RlcmF0b3IgY3JlYXRpb24gcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjcmVhdGVBY2NvdW50RHRvID0ge1xuICAgICAgICBlbWFpbDogJ2Zvcm1hdEBtZW50YXJhLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgICBmaXJzdE5hbWU6ICdGb3JtYXQnLFxuICAgICAgICBsYXN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBwZXJtaXNzaW9uczogWydtb2RlcmF0ZV9wb3N0cyddLFxuICAgICAgICBhc3NpZ25lZENvbW11bml0aWVzOiBbVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVF0sXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnY3JlYXRlTW9kZXJhdG9yQWNjb3VudCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVBY2NvdW50UmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZU1vZGVyYXRvckFjY291bnQoJ2FkbWluJywgY3JlYXRlQWNjb3VudER0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3VzZXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS5ub3QudG9IYXZlUHJvcGVydHkoJ2FjY2Vzc1Rva2VuJyk7IC8vIENyZWF0aW9uIGRvZXNuJ3QgaW5jbHVkZSB0b2tlbnNcbiAgICAgIGV4cGVjdChyZXN1bHQpLm5vdC50b0hhdmVQcm9wZXJ0eSgncmVmcmVzaFRva2VuJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcikudG9IYXZlUHJvcGVydHkoJ2lkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIpLnRvSGF2ZVByb3BlcnR5KCdlbWFpbCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyKS50b0hhdmVQcm9wZXJ0eSgnZmlyc3ROYW1lJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIpLnRvSGF2ZVByb3BlcnR5KCdsYXN0TmFtZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyKS50b0hhdmVQcm9wZXJ0eSgncm9sZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyKS50b0hhdmVQcm9wZXJ0eSgnZW1haWxWZXJpZmllZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdGx5IGZvcm1hdHRlZCBsb2dpbiByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGxvZ2luRHRvID0ge1xuICAgICAgICBlbWFpbDogVEVTVF9FTUFJTFMuTU9ERVJBVE9SLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdUZXN0IFVzZXIgQWdlbnQnKSxcbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnbG9naW5Nb2RlcmF0b3InKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG9naW5SZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubG9naW4obG9naW5EdG8sIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndXNlcicpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2FjY2Vzc1Rva2VuJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmVmcmVzaFRva2VuJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZXhwaXJlc0luJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS5ub3QudG9IYXZlUHJvcGVydHkoJ21lc3NhZ2UnKTsgLy8gTG9naW4gZG9lc24ndCBpbmNsdWRlIG1lc3NhZ2VcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3RseSBmb3JtYXR0ZWQgcGVybWlzc2lvbnMgcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yUGVybWlzc2lvbnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGVybWlzc2lvbnMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UGVybWlzc2lvbnMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdwZXJtaXNzaW9ucycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2Nhbk1vZGVyYXRlUG9zdHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdjYW5CYW5Vc2VycycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NhbkRlbGV0ZUNvbW1lbnRzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnY2FuQWNjZXNzUmVwb3J0cycpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnBlcm1pc3Npb25zKS50b0JlSW5zdGFuY2VPZihBcnJheSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNhbk1vZGVyYXRlUG9zdHMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNhbkJhblVzZXJzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdGx5IGZvcm1hdHRlZCBkYXNoYm9hcmQgc3RhdHMgcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKG1vZGVyYXRvckF1dGhTZXJ2aWNlLCAnZ2V0TW9kZXJhdG9yRGFzaGJvYXJkU3RhdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGFzaGJvYXJkU3RhdHMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0RGFzaGJvYXJkU3RhdHMoVEVTVF9VU0VSX0lEUy5NT0RFUkFUT1IpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbFBvc3RzTW9kZXJhdGVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncGVuZGluZ1JlcG9ydHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdjb21tdW5pdGllc01hbmFnZWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd1c2Vyc01vZGVyYXRlZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3JlY2VudEFjdGl2aXR5Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxQb3N0c01vZGVyYXRlZCkudG9CZSg0NSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlY2VudEFjdGl2aXR5KS50b0JlSW5zdGFuY2VPZihBcnJheSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlY2VudEFjdGl2aXR5KS50b0hhdmVMZW5ndGgoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBZG1pbi1vbmx5IEZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbmZvcmNlIGFkbWluLW9ubHkgYWNjZXNzIGZvciBtb2RlcmF0b3IgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjcmVhdGVBY2NvdW50RHRvID0ge1xuICAgICAgICBlbWFpbDogJ2FkbWluLW9ubHlAbWVudGFyYS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnQWRtaW4nLFxuICAgICAgICBsYXN0TmFtZTogJ09ubHknLFxuICAgICAgfTtcblxuICAgICAgLy8gVGVzdCBlYWNoIHJvbGVcbiAgICAgIGNvbnN0IHJvbGVzID0gWydjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvciddO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IHJvbGUgb2Ygcm9sZXMpIHtcbiAgICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlTW9kZXJhdG9yQWNjb3VudChyb2xlLCBjcmVhdGVBY2NvdW50RHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAgIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gVGVzdCBhZG1pbiBhY2Nlc3NcbiAgICAgIGplc3Quc3B5T24obW9kZXJhdG9yQXV0aFNlcnZpY2UsICdjcmVhdGVNb2RlcmF0b3JBY2NvdW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZUFjY291bnRSZXN1bHQpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCdhZG1pbicsIGNyZWF0ZUFjY291bnREdG8pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYWRtaW4gcm9sZSBiZWZvcmUgbW9kZXJhdG9yIGNyZWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgY3JlYXRlQWNjb3VudER0byA9IHtcbiAgICAgICAgZW1haWw6ICd2YWxpZGF0aW9uQG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ1ZhbGlkYXRpb24nLFxuICAgICAgICBsYXN0TmFtZTogJ1Rlc3QnLFxuICAgICAgfTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5jcmVhdGVNb2RlcmF0b3JBY2NvdW50KCdpbnZhbGlkLXJvbGUnLCBjcmVhdGVBY2NvdW50RHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBGb3JiaWRkZW5FeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==