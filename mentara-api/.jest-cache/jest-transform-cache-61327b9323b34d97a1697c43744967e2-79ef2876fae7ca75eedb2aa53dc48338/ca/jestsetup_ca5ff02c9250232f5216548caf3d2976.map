{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/jest.setup.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/jest.setup.ts"],"sourcesContent":["import 'reflect-metadata';\n\n// Global test setup for unit tests\nbeforeAll(async () => {\n  // Set test environment variables\n  process.env.NODE_ENV = 'test';\n  process.env.DATABASE_URL =\n    process.env.TEST_DATABASE_URL ||\n    'postgresql://test:test@localhost:5432/mentara_test';\n\n  // Disable external services in tests\n  process.env.DISABLE_CLERK_WEBHOOK = 'true';\n  process.env.DISABLE_EMAIL_SERVICE = 'true';\n  process.env.DISABLE_AI_SERVICE = 'true';\n\n  // Test-specific configurations\n  process.env.JWT_SECRET = 'test-jwt-secret-key';\n  process.env.ENCRYPTION_KEY = 'test-encryption-key-32-chars!!';\n});\n\n// Mock external dependencies\njest.mock('axios');\n// @clerk/backend has been removed from the project - JWT auth is now used instead\n\n// Note: File upload and AI service mocks will be added per-test as needed\n// This prevents global module resolution issues when dependencies aren't installed\n\n// Enhanced console mocking with test insights\nconst originalConsole = { ...console };\nglobal.console = {\n  ...console,\n  // Suppress console.log during tests unless explicitly needed\n  log: jest.fn((message) => {\n    if (process.env.DEBUG_TESTS === 'true') {\n      originalConsole.log('[TEST DEBUG]', message);\n    }\n  }),\n  debug: jest.fn(),\n  info: jest.fn(),\n  warn: (message) => {\n    if (process.env.SHOW_WARNINGS === 'true') {\n      originalConsole.warn('[TEST WARN]', message);\n    }\n  },\n  error: originalConsole.error.bind(originalConsole), // Always show errors\n};\n\n// Setup global test timeout\njest.setTimeout(10000);\n\n// Enhanced cleanup after each test\nafterEach(async () => {\n  jest.clearAllMocks();\n  jest.clearAllTimers();\n\n  // Reset environment variables that might have been modified\n  delete process.env.TEST_USER_ID;\n  delete process.env.TEST_ROLE;\n});\n\n// Global cleanup\nafterAll(async () => {\n  // Clean up any remaining async operations\n  await new Promise((resolve) => setTimeout(resolve, 100));\n});\n\n// Test environment validation\nif (\n  process.env.JEST_TEST_TYPE === 'integration' &&\n  !process.env.DATABASE_URL?.includes('test')\n) {\n  throw new Error(\n    'Integration tests must use a test database. DATABASE_URL must contain \"test\"',\n  );\n}\n\n// Prevent tests from running against production database\nif (process.env.DATABASE_URL?.includes('prod')) {\n  throw new Error('Tests cannot run against production database!');\n}\n\n// Global test constants\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-namespace\n  namespace NodeJS {\n    interface Global {\n      testDb: any;\n      testFactory: any;\n    }\n  }\n}\n\n// Enhanced test timeouts with categories\nexport const TEST_TIMEOUT = {\n  UNIT: 5000,\n  INTEGRATION: 15000,\n  E2E: 30000,\n  DATABASE: 20000,\n  ASYNC_OPERATION: 10000,\n};\n\n// Test performance tracking\nconst testStartTimes = new Map();\n\nbeforeEach(() => {\n  const testName = expect.getState().currentTestName;\n  testStartTimes.set(testName, Date.now());\n});\n\nafterEach(() => {\n  const testName = expect.getState().currentTestName;\n  const startTime = testStartTimes.get(testName);\n  if (startTime && process.env.TRACK_TEST_PERFORMANCE === 'true') {\n    const duration = Date.now() - startTime;\n    if (duration > 1000) {\n      console.warn(`Slow test detected: ${testName} took ${duration}ms`);\n    }\n  }\n  testStartTimes.delete(testName);\n});\n\n// Global error handlers for unhandled promises\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\n});\n\nprocess.on('uncaughtException', (error) => {\n  console.error('Uncaught Exception:', error);\n});\n"],"version":3}