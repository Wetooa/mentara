{"version":3,"names":["cov_1ii0rm8xp6","actualCoverage","common_1","s","require","prisma_client_provider_1","ConflictDetectionService","prisma","constructor","f","checkSchedulingConflicts","therapistId","clientId","startTime","duration","endTime","Date","getTime","timeRange","therapistConflicts","clientConflicts","Promise","all","checkTherapistConflicts","checkClientConflicts","hasConflict","b","length","conflictType","conflictingMeetings","findConflictingMeetings","statuses","checkUpdateConflicts","meetingId","newStartTime","newDuration","conflicts","excludeMeetingId","filter","m","checkBulkConflicts","meetings","i","meeting","existingConflicts","internalConflicts","checkInternalConflicts","push","meetingIndex","whereConditions","overlapCondition","lt","OR","gt","AND","gte","status","in","findMany","where","id","not","include","client","select","user","firstName","lastName","therapist","meetingEndTime","hasTimeOverlap","currentMeeting","allMeetings","currentIndex","currentEndTime","otherMeeting","otherEndTime","sameTherapist","sameClient","isInternalConflict","conflictIndex","start1","end1","start2","end2","validateNoConflicts","conflictMessages","map","meetingStart","toLocaleString","meetingEnd","BadRequestException","join","exports","__decorate","Injectable","PrismaService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/services/conflict-detection.service.ts"],"sourcesContent":["import { Injectable, BadRequestException } from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\n\nexport interface TimeRange {\n  startTime: Date;\n  endTime: Date;\n}\n\nexport interface ConflictResult {\n  hasConflict: boolean;\n  conflictingMeetings: any[];\n  conflictType: 'therapist' | 'client' | 'both' | 'none';\n}\n\n@Injectable()\nexport class ConflictDetectionService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  /**\n   * Check for scheduling conflicts for both therapist and client\n   */\n  async checkSchedulingConflicts(\n    therapistId: string,\n    clientId: string,\n    startTime: Date,\n    duration: number,\n  ): Promise<ConflictResult> {\n    const endTime = new Date(startTime.getTime() + duration * 60 * 1000);\n    const timeRange = { startTime, endTime };\n\n    const [therapistConflicts, clientConflicts] = await Promise.all([\n      this.checkTherapistConflicts(therapistId, timeRange),\n      this.checkClientConflicts(clientId, timeRange),\n    ]);\n\n    const hasConflict =\n      therapistConflicts.length > 0 || clientConflicts.length > 0;\n    let conflictType: 'therapist' | 'client' | 'both' | 'none' = 'none';\n\n    if (therapistConflicts.length > 0 && clientConflicts.length > 0) {\n      conflictType = 'both';\n    } else if (therapistConflicts.length > 0) {\n      conflictType = 'therapist';\n    } else if (clientConflicts.length > 0) {\n      conflictType = 'client';\n    }\n\n    return {\n      hasConflict,\n      conflictingMeetings: [...therapistConflicts, ...clientConflicts],\n      conflictType,\n    };\n  }\n\n  /**\n   * Check for conflicts in therapist's schedule\n   */\n  async checkTherapistConflicts(\n    therapistId: string,\n    timeRange: TimeRange,\n  ): Promise<any[]> {\n    return this.findConflictingMeetings({\n      therapistId,\n      timeRange,\n      statuses: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'],\n    });\n  }\n\n  /**\n   * Check for conflicts in client's schedule\n   */\n  async checkClientConflicts(\n    clientId: string,\n    timeRange: TimeRange,\n  ): Promise<any[]> {\n    return this.findConflictingMeetings({\n      clientId,\n      timeRange,\n      statuses: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'],\n    });\n  }\n\n  /**\n   * Check if updating a meeting would cause conflicts\n   */\n  async checkUpdateConflicts(\n    meetingId: string,\n    therapistId: string,\n    clientId: string,\n    newStartTime: Date,\n    newDuration: number,\n  ): Promise<ConflictResult> {\n    const endTime = new Date(newStartTime.getTime() + newDuration * 60 * 1000);\n    const timeRange = { startTime: newStartTime, endTime };\n\n    // Find conflicts excluding the current meeting\n    const conflicts = await this.findConflictingMeetings({\n      therapistId,\n      clientId,\n      timeRange,\n      statuses: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'],\n      excludeMeetingId: meetingId,\n    });\n\n    const therapistConflicts = conflicts.filter(\n      (m) => m.therapistId === therapistId,\n    );\n    const clientConflicts = conflicts.filter((m) => m.clientId === clientId);\n\n    const hasConflict = conflicts.length > 0;\n    let conflictType: 'therapist' | 'client' | 'both' | 'none' = 'none';\n\n    if (therapistConflicts.length > 0 && clientConflicts.length > 0) {\n      conflictType = 'both';\n    } else if (therapistConflicts.length > 0) {\n      conflictType = 'therapist';\n    } else if (clientConflicts.length > 0) {\n      conflictType = 'client';\n    }\n\n    return {\n      hasConflict,\n      conflictingMeetings: conflicts,\n      conflictType,\n    };\n  }\n\n  /**\n   * Check for conflicts when bulk scheduling multiple meetings\n   */\n  async checkBulkConflicts(\n    meetings: Array<{\n      therapistId: string;\n      clientId: string;\n      startTime: Date;\n      duration: number;\n    }>,\n  ): Promise<{ meetingIndex: number; conflicts: ConflictResult }[]> {\n    const conflicts: { meetingIndex: number; conflicts: ConflictResult }[] = [];\n\n    for (let i = 0; i < meetings.length; i++) {\n      const meeting = meetings[i];\n\n      // Check against existing meetings\n      const existingConflicts = await this.checkSchedulingConflicts(\n        meeting.therapistId,\n        meeting.clientId,\n        meeting.startTime,\n        meeting.duration,\n      );\n\n      // Check against other meetings in the bulk operation\n      const internalConflicts = this.checkInternalConflicts(\n        meeting,\n        meetings,\n        i,\n      );\n\n      if (existingConflicts.hasConflict || internalConflicts.length > 0) {\n        conflicts.push({\n          meetingIndex: i,\n          conflicts: {\n            hasConflict: true,\n            conflictingMeetings: [\n              ...existingConflicts.conflictingMeetings,\n              ...internalConflicts,\n            ],\n            conflictType: existingConflicts.conflictType,\n          },\n        });\n      }\n    }\n\n    return conflicts;\n  }\n\n  private async findConflictingMeetings({\n    therapistId,\n    clientId,\n    timeRange,\n    statuses,\n    excludeMeetingId,\n  }: {\n    therapistId?: string;\n    clientId?: string;\n    timeRange: TimeRange;\n    statuses: string[];\n    excludeMeetingId?: string;\n  }): Promise<any[]> {\n    const whereConditions: any[] = [];\n\n    // Build more efficient query conditions using the new endTime field\n    const overlapCondition = {\n      startTime: { lt: timeRange.endTime },\n      OR: [\n        { endTime: { gt: timeRange.startTime } }, // Meeting ends after our start\n        {\n          // Fallback for meetings without endTime (legacy data)\n          AND: [\n            { endTime: null },\n            {\n              // Calculate endTime on the fly for legacy meetings\n              startTime: { gte: timeRange.startTime },\n            },\n          ],\n        },\n      ],\n      status: { in: statuses },\n    };\n\n    // Add therapist condition\n    if (therapistId) {\n      whereConditions.push({\n        therapistId,\n        ...overlapCondition,\n      });\n    }\n\n    // Add client condition\n    if (clientId) {\n      whereConditions.push({\n        clientId,\n        ...overlapCondition,\n      });\n    }\n\n    if (whereConditions.length === 0) {\n      return [];\n    }\n\n    const meetings = await this.prisma.meeting.findMany({\n      where: {\n        OR: whereConditions,\n        ...(excludeMeetingId && { id: { not: excludeMeetingId } }),\n      },\n      include: {\n        client: {\n          select: {\n            user: {\n              select: { firstName: true, lastName: true },\n            },\n          },\n        },\n        therapist: {\n          select: {\n            user: {\n              select: { firstName: true, lastName: true },\n            },\n          },\n        },\n      },\n    });\n\n    // Additional filtering for meetings without endTime (legacy data)\n    return meetings.filter((meeting) => {\n      const meetingEndTime =\n        meeting.endTime ||\n        new Date(meeting.startTime.getTime() + meeting.duration * 60 * 1000);\n      return this.hasTimeOverlap(\n        timeRange.startTime,\n        timeRange.endTime,\n        meeting.startTime,\n        meetingEndTime,\n      );\n    });\n  }\n\n  private checkInternalConflicts(\n    currentMeeting: {\n      therapistId: string;\n      clientId: string;\n      startTime: Date;\n      duration: number;\n    },\n    allMeetings: Array<{\n      therapistId: string;\n      clientId: string;\n      startTime: Date;\n      duration: number;\n    }>,\n    currentIndex: number,\n  ): any[] {\n    const conflicts: any[] = [];\n    const currentEndTime = new Date(\n      currentMeeting.startTime.getTime() + currentMeeting.duration * 60 * 1000,\n    );\n\n    for (let i = 0; i < allMeetings.length; i++) {\n      if (i === currentIndex) continue;\n\n      const otherMeeting = allMeetings[i];\n      const otherEndTime = new Date(\n        otherMeeting.startTime.getTime() + otherMeeting.duration * 60 * 1000,\n      );\n\n      // Check if meetings involve the same people\n      const sameTherapist =\n        currentMeeting.therapistId === otherMeeting.therapistId;\n      const sameClient = currentMeeting.clientId === otherMeeting.clientId;\n\n      if (\n        (sameTherapist || sameClient) &&\n        this.hasTimeOverlap(\n          currentMeeting.startTime,\n          currentEndTime,\n          otherMeeting.startTime,\n          otherEndTime,\n        )\n      ) {\n        conflicts.push({\n          ...otherMeeting,\n          conflictType:\n            sameTherapist && sameClient\n              ? 'both'\n              : sameTherapist\n                ? 'therapist'\n                : 'client',\n          isInternalConflict: true,\n          conflictIndex: i,\n        });\n      }\n    }\n\n    return conflicts;\n  }\n\n  /**\n   * Check if two time ranges overlap\n   */\n  hasTimeOverlap(start1: Date, end1: Date, start2: Date, end2: Date): boolean {\n    return start1 < end2 && end1 > start2;\n  }\n\n  /**\n   * Validate that a proposed meeting time doesn't conflict\n   * Throws BadRequestException if conflicts are found\n   */\n  async validateNoConflicts(\n    therapistId: string,\n    clientId: string,\n    startTime: Date,\n    duration: number,\n  ): Promise<void> {\n    const conflicts = await this.checkSchedulingConflicts(\n      therapistId,\n      clientId,\n      startTime,\n      duration,\n    );\n\n    if (conflicts.hasConflict) {\n      const conflictMessages = conflicts.conflictingMeetings.map((meeting) => {\n        const meetingStart = meeting.startTime.toLocaleString();\n        const meetingEnd = new Date(\n          meeting.startTime.getTime() + meeting.duration * 60000,\n        ).toLocaleString();\n        return `Meeting from ${meetingStart} to ${meetingEnd}`;\n      });\n\n      throw new BadRequestException(\n        `Time slot conflicts with existing meetings: ${conflictMessages.join(', ')}`,\n      );\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}