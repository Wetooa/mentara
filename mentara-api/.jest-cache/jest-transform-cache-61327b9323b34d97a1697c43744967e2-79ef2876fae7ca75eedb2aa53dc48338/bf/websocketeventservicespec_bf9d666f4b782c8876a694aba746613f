f4c44f57e2b2cefe52d9dd6ea820692a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const websocket_event_service_1 = require("./websocket-event.service");
const event_bus_service_1 = require("../../common/events/event-bus.service");
const messaging_gateway_1 = require("../messaging.gateway");
const common_1 = require("@nestjs/common");
const messaging_events_1 = require("../../common/events/messaging-events");
const booking_events_1 = require("../../common/events/booking-events");
const user_events_1 = require("../../common/events/user-events");
const social_events_1 = require("../../common/events/social-events");
describe('WebSocketEventService', () => {
    let service;
    let eventBusService;
    let messagingGateway;
    let mockServer;
    let mockSocket;
    beforeEach(async () => {
        // Mock socket.io server
        mockSocket = {
            socketsJoin: jest.fn(),
            socketsLeave: jest.fn(),
        };
        mockServer = {
            to: jest.fn(() => ({ emit: jest.fn() })),
            in: jest.fn(() => mockSocket),
            emit: jest.fn(),
            sockets: {
                sockets: new Map([
                    ['socket1', {}],
                    ['socket2', {}],
                    ['socket3', {}],
                ]),
            },
        };
        const mockEventBus = {
            subscribe: jest.fn(),
            emit: jest.fn(),
            getEventStats: jest.fn(() => ({ totalListeners: 10 })),
        };
        const mockMessagingGateway = {
            server: mockServer,
            broadcastMessage: jest.fn(),
            broadcastReadReceipt: jest.fn(),
        };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                websocket_event_service_1.WebSocketEventService,
                {
                    provide: event_bus_service_1.EventBusService,
                    useValue: mockEventBus,
                },
                {
                    provide: messaging_gateway_1.MessagingGateway,
                    useValue: mockMessagingGateway,
                },
            ],
        }).compile();
        service = module.get(websocket_event_service_1.WebSocketEventService);
        eventBusService = module.get(event_bus_service_1.EventBusService);
        messagingGateway = module.get(messaging_gateway_1.MessagingGateway);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('onModuleInit', () => {
        it('should initialize event subscriptions', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            service.onModuleInit();
            expect(eventBusService.subscribe).toHaveBeenCalledTimes(10); // All event types
            expect(loggerSpy).toHaveBeenCalledWith('WebSocket event handlers initialized successfully');
        });
        it('should subscribe to all event types', async () => {
            service.onModuleInit();
            const eventTypes = [
                'MessageSentEvent',
                'MessageReadEvent',
                'ConversationCreatedEvent',
                'ParticipantJoinedEvent',
                'ParticipantLeftEvent',
                'TypingIndicatorEvent',
                'AppointmentBookedEvent',
                'AppointmentCancelledEvent',
                'UserRegisteredEvent',
                'UserProfileUpdatedEvent',
                'PostCreatedEvent',
                'CommentAddedEvent',
            ];
            eventTypes.forEach(eventType => {
                expect(eventBusService.subscribe).toHaveBeenCalledWith(eventType, expect.any(Function));
            });
        });
    });
    describe('Messaging Events', () => {
        beforeEach(() => {
            service.onModuleInit();
        });
        describe('MessageSentEvent', () => {
            it('should broadcast message to conversation participants', async () => {
                const messageEvent = new messaging_events_1.MessageSentEvent({
                    messageId: 'msg-123',
                    conversationId: 'conv-123',
                    senderId: 'user-123',
                    content: 'Hello world',
                    messageType: 'text',
                    sentAt: new Date(),
                    recipientIds: ['user-456', 'user-789'],
                });
                // Get the handler function
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'MessageSentEvent')[1];
                await handler(messageEvent);
                expect(messagingGateway.broadcastMessage).toHaveBeenCalledWith('conv-123', {
                    id: 'msg-123',
                    conversationId: 'conv-123',
                    senderId: 'user-123',
                    content: 'Hello world',
                    messageType: 'text',
                    sentAt: messageEvent.eventData.sentAt,
                    eventType: 'message_sent',
                });
                expect(mockServer.to).toHaveBeenCalledWith('user_user-456');
                expect(mockServer.to).toHaveBeenCalledWith('user_user-789');
            });
            it('should send delivery confirmations to recipients', async () => {
                const messageEvent = new messaging_events_1.MessageSentEvent({
                    messageId: 'msg-123',
                    conversationId: 'conv-123',
                    senderId: 'user-123',
                    content: 'Hello world',
                    messageType: 'text',
                    sentAt: new Date(),
                    recipientIds: ['user-456'],
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'MessageSentEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(messageEvent);
                expect(mockEmit).toHaveBeenCalledWith('message_delivered', {
                    messageId: 'msg-123',
                    conversationId: 'conv-123',
                    deliveredAt: expect.any(Date),
                    eventType: 'message_delivered',
                });
            });
        });
        describe('MessageReadEvent', () => {
            it('should broadcast read receipt', async () => {
                const readEvent = new messaging_events_1.MessageReadEvent({
                    messageId: 'msg-123',
                    conversationId: 'conv-123',
                    readBy: 'user-456',
                    readAt: new Date(),
                    messagesSinceLastRead: 1,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'MessageReadEvent')[1];
                await handler(readEvent);
                expect(messagingGateway.broadcastReadReceipt).toHaveBeenCalledWith('conv-123', 'msg-123', 'user-456');
            });
        });
        describe('ConversationCreatedEvent', () => {
            it('should notify all participants about new conversation', async () => {
                const conversationEvent = new messaging_events_1.ConversationCreatedEvent({
                    conversationId: 'conv-123',
                    createdBy: 'user-123',
                    participantIds: ['user-123', 'user-456'],
                    conversationType: 'direct',
                    title: 'Test Conversation',
                    isPrivate: true,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'ConversationCreatedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(conversationEvent);
                expect(mockServer.to).toHaveBeenCalledWith('user_user-123');
                expect(mockServer.to).toHaveBeenCalledWith('user_user-456');
                expect(mockEmit).toHaveBeenCalledWith('conversation_created', {
                    conversationId: 'conv-123',
                    createdBy: 'user-123',
                    conversationType: 'direct',
                    title: 'Test Conversation',
                    participantIds: ['user-123', 'user-456'],
                    eventType: 'conversation_created',
                    timestamp: expect.any(Date),
                });
            });
        });
        describe('ParticipantJoinedEvent', () => {
            it('should notify conversation about new participant', async () => {
                const joinEvent = new messaging_events_1.ParticipantJoinedEvent({
                    conversationId: 'conv-123',
                    participantId: 'user-789',
                    addedBy: 'user-123',
                    joinedAt: new Date(),
                    role: 'member',
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'ParticipantJoinedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(joinEvent);
                expect(mockServer.to).toHaveBeenCalledWith('conv-123');
                expect(mockEmit).toHaveBeenCalledWith('participant_joined', {
                    conversationId: 'conv-123',
                    participantId: 'user-789',
                    addedBy: 'user-123',
                    joinedAt: joinEvent.eventData.joinedAt,
                    role: 'member',
                    eventType: 'participant_joined',
                });
            });
        });
        describe('ParticipantLeftEvent', () => {
            it('should notify conversation about participant leaving', async () => {
                const leftEvent = new messaging_events_1.ParticipantLeftEvent({
                    conversationId: 'conv-123',
                    participantId: 'user-789',
                    leftAt: new Date(),
                    leftReason: 'User left voluntarily',
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'ParticipantLeftEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(leftEvent);
                expect(mockServer.to).toHaveBeenCalledWith('conv-123');
                expect(mockEmit).toHaveBeenCalledWith('participant_left', {
                    conversationId: 'conv-123',
                    participantId: 'user-789',
                    leftAt: leftEvent.eventData.leftAt,
                    leftReason: 'User left voluntarily',
                    eventType: 'participant_left',
                });
            });
        });
        describe('TypingIndicatorEvent', () => {
            it('should relay typing indicator to conversation', async () => {
                const typingEvent = new messaging_events_1.TypingIndicatorEvent({
                    conversationId: 'conv-123',
                    userId: 'user-456',
                    isTyping: true,
                    timestamp: new Date(),
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'TypingIndicatorEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(typingEvent);
                expect(mockServer.to).toHaveBeenCalledWith('conv-123');
                expect(mockEmit).toHaveBeenCalledWith('typing_indicator', {
                    conversationId: 'conv-123',
                    userId: 'user-456',
                    isTyping: true,
                    timestamp: typingEvent.eventData.timestamp,
                    eventType: 'typing_indicator',
                });
            });
        });
    });
    describe('Booking Events', () => {
        beforeEach(() => {
            service.onModuleInit();
        });
        describe('AppointmentBookedEvent', () => {
            it('should notify both client and therapist about appointment booking', async () => {
                const appointmentEvent = new booking_events_1.AppointmentBookedEvent({
                    appointmentId: 'appointment-123',
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    startTime: new Date(),
                    meetingType: 'video',
                    duration: 60,
                    title: 'Therapy Session',
                    description: 'Regular therapy session',
                    isInitialConsultation: false,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'AppointmentBookedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(appointmentEvent);
                expect(mockServer.to).toHaveBeenCalledWith('user_client-123');
                expect(mockServer.to).toHaveBeenCalledWith('user_therapist-123');
                expect(mockEmit).toHaveBeenCalledWith('appointment_notification', {
                    appointmentId: 'appointment-123',
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    startTime: appointmentEvent.eventData.startTime,
                    meetingType: 'video',
                    isInitialConsultation: false,
                    eventType: 'appointment_booked',
                    timestamp: expect.any(Date),
                    message: expect.any(String),
                });
            });
            it('should send different messages to client and therapist', async () => {
                const appointmentEvent = new booking_events_1.AppointmentBookedEvent({
                    appointmentId: 'appointment-123',
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    startTime: new Date(),
                    meetingType: 'video',
                    duration: 60,
                    title: 'Therapy Session',
                    description: 'Regular therapy session',
                    isInitialConsultation: false,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'AppointmentBookedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(appointmentEvent);
                expect(mockEmit).toHaveBeenCalledWith('appointment_notification', expect.objectContaining({
                    message: 'Your appointment has been booked and is pending confirmation.',
                }));
                expect(mockEmit).toHaveBeenCalledWith('appointment_notification', expect.objectContaining({
                    message: 'You have a new appointment request that requires confirmation.',
                }));
            });
        });
        describe('AppointmentCancelledEvent', () => {
            it('should notify both parties about appointment cancellation', async () => {
                const cancelEvent = new booking_events_1.AppointmentCancelledEvent({
                    appointmentId: 'appointment-123',
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    cancelledBy: 'client-123',
                    cancellationReason: 'Personal emergency',
                    originalStartTime: new Date(),
                    cancelledAt: new Date(),
                    cancellationNotice: 24,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'AppointmentCancelledEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(cancelEvent);
                expect(mockServer.to).toHaveBeenCalledWith('user_client-123');
                expect(mockServer.to).toHaveBeenCalledWith('user_therapist-123');
                expect(mockEmit).toHaveBeenCalledWith('appointment_notification', {
                    appointmentId: 'appointment-123',
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    cancelledBy: 'client-123',
                    cancellationReason: 'Personal emergency',
                    cancelledAt: cancelEvent.eventData.cancelledAt,
                    eventType: 'appointment_cancelled',
                    timestamp: expect.any(Date),
                    message: expect.any(String),
                });
            });
            it('should send different messages based on who cancelled', async () => {
                const cancelEvent = new booking_events_1.AppointmentCancelledEvent({
                    appointmentId: 'appointment-123',
                    clientId: 'client-123',
                    therapistId: 'therapist-123',
                    cancelledBy: 'therapist-123',
                    cancellationReason: 'Schedule conflict',
                    originalStartTime: new Date(),
                    cancelledAt: new Date(),
                    cancellationNotice: 24,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'AppointmentCancelledEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(cancelEvent);
                expect(mockEmit).toHaveBeenCalledWith('appointment_notification', expect.objectContaining({
                    message: 'Your appointment has been cancelled by the therapist.',
                }));
                expect(mockEmit).toHaveBeenCalledWith('appointment_notification', expect.objectContaining({
                    message: 'You have cancelled the appointment.',
                }));
            });
        });
    });
    describe('User Events', () => {
        beforeEach(() => {
            service.onModuleInit();
        });
        describe('UserRegisteredEvent', () => {
            it('should send welcome notification to new user', async () => {
                const registrationEvent = new user_events_1.UserRegisteredEvent({
                    userId: 'user-123',
                    email: 'user@example.com',
                    firstName: 'John',
                    lastName: 'Doe',
                    role: 'client',
                    registrationMethod: 'email',
                    emailVerified: true,
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'UserRegisteredEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(registrationEvent);
                expect(mockServer.to).toHaveBeenCalledWith('user_user-123');
                expect(mockEmit).toHaveBeenCalledWith('welcome_notification', {
                    userId: 'user-123',
                    firstName: 'John',
                    lastName: 'Doe',
                    role: 'client',
                    eventType: 'user_registered',
                    message: 'Welcome to Mentara, John! Your account has been successfully created.',
                    timestamp: expect.any(Date),
                });
            });
        });
        describe('UserProfileUpdatedEvent', () => {
            it('should broadcast profile update to all connections', async () => {
                const profileEvent = new user_events_1.UserProfileUpdatedEvent({
                    userId: 'user-123',
                    updatedFields: ['firstName', 'lastName'],
                    newValues: { firstName: 'Jane', lastName: 'Smith' },
                    previousValues: { firstName: 'John', lastName: 'Doe' },
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'UserProfileUpdatedEvent')[1];
                await handler(profileEvent);
                expect(mockServer.emit).toHaveBeenCalledWith('user_profile_updated', {
                    userId: 'user-123',
                    updatedFields: ['firstName', 'lastName'],
                    profileData: { firstName: 'Jane', lastName: 'Smith' },
                    eventType: 'user_profile_updated',
                    timestamp: expect.any(Date),
                });
            });
        });
    });
    describe('Social Events', () => {
        beforeEach(() => {
            service.onModuleInit();
        });
        describe('PostCreatedEvent', () => {
            it('should broadcast new post to community room', async () => {
                const postEvent = new social_events_1.PostCreatedEvent({
                    postId: 'post-123',
                    authorId: 'user-123',
                    communityId: 'community-123',
                    title: 'New Post',
                    content: 'This is a new post',
                    tags: ['mental-health', 'support'],
                    postType: 'discussion',
                    isAnonymous: false,
                    timestamp: new Date(),
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'PostCreatedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(postEvent);
                expect(mockServer.to).toHaveBeenCalledWith('community_community-123');
                expect(mockEmit).toHaveBeenCalledWith('new_post', {
                    postId: 'post-123',
                    authorId: 'user-123',
                    communityId: 'community-123',
                    title: 'New Post',
                    content: 'This is a new post',
                    tags: ['mental-health', 'support'],
                    postType: 'discussion',
                    isAnonymous: false,
                    eventType: 'post_created',
                    timestamp: expect.any(Date),
                });
            });
            it('should hide author ID for anonymous posts', async () => {
                const postEvent = new social_events_1.PostCreatedEvent({
                    postId: 'post-123',
                    authorId: 'user-123',
                    communityId: 'community-123',
                    title: 'Anonymous Post',
                    content: 'This is an anonymous post',
                    tags: ['support'],
                    postType: 'discussion',
                    isAnonymous: true,
                    timestamp: new Date(),
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'PostCreatedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(postEvent);
                expect(mockEmit).toHaveBeenCalledWith('new_post', expect.objectContaining({
                    authorId: null,
                    isAnonymous: true,
                }));
            });
            it('should not broadcast if no communityId', async () => {
                const postEvent = new social_events_1.PostCreatedEvent({
                    postId: 'post-123',
                    authorId: 'user-123',
                    communityId: null,
                    title: 'Private Post',
                    content: 'This is a private post',
                    tags: [],
                    postType: 'discussion',
                    isAnonymous: false,
                    timestamp: new Date(),
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'PostCreatedEvent')[1];
                await handler(postEvent);
                expect(mockServer.to).not.toHaveBeenCalled();
            });
        });
        describe('CommentAddedEvent', () => {
            it('should broadcast comment to post room', async () => {
                const commentEvent = new social_events_1.CommentAddedEvent({
                    commentId: 'comment-123',
                    postId: 'post-123',
                    authorId: 'user-456',
                    content: 'Great post!',
                    parentCommentId: null,
                    isAnonymous: false,
                    timestamp: new Date(),
                });
                const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'CommentAddedEvent')[1];
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                await handler(commentEvent);
                expect(mockServer.to).toHaveBeenCalledWith('post_post-123');
                expect(mockEmit).toHaveBeenCalledWith('post_interaction', {
                    commentId: 'comment-123',
                    postId: 'post-123',
                    authorId: 'user-456',
                    content: 'Great post!',
                    interactionType: 'comment',
                    eventType: 'comment_created',
                    message: 'Someone commented on your post',
                    timestamp: expect.any(Date),
                });
                expect(mockEmit).toHaveBeenCalledWith('new_comment', {
                    commentId: 'comment-123',
                    postId: 'post-123',
                    authorId: 'user-456',
                    content: 'Great post!',
                    eventType: 'comment_created',
                    timestamp: expect.any(Date),
                });
            });
        });
    });
    describe('Room Management', () => {
        describe('subscribeUserToPersonalRoom', () => {
            it('should subscribe user to personal room', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
                service.subscribeUserToPersonalRoom('user-123', 'socket-123');
                expect(mockServer.in).toHaveBeenCalledWith('socket-123');
                expect(mockSocket.socketsJoin).toHaveBeenCalledWith('user_user-123');
                expect(loggerSpy).toHaveBeenCalledWith('User user-123 subscribed to personal room: user_user-123');
            });
        });
        describe('unsubscribeUserFromPersonalRoom', () => {
            it('should unsubscribe user from personal room', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
                service.unsubscribeUserFromPersonalRoom('user-123', 'socket-123');
                expect(mockServer.in).toHaveBeenCalledWith('socket-123');
                expect(mockSocket.socketsLeave).toHaveBeenCalledWith('user_user-123');
                expect(loggerSpy).toHaveBeenCalledWith('User user-123 unsubscribed from personal room: user_user-123');
            });
        });
        describe('subscribeUserToCommunityRoom', () => {
            it('should subscribe user to community room', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
                service.subscribeUserToCommunityRoom('user-123', 'community-456', 'socket-123');
                expect(mockServer.in).toHaveBeenCalledWith('socket-123');
                expect(mockSocket.socketsJoin).toHaveBeenCalledWith('community_community-456');
                expect(loggerSpy).toHaveBeenCalledWith('User user-123 subscribed to community room: community_community-456');
            });
        });
        describe('subscribeUserToPostRoom', () => {
            it('should subscribe user to post room', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
                service.subscribeUserToPostRoom('user-123', 'post-456', 'socket-123');
                expect(mockServer.in).toHaveBeenCalledWith('socket-123');
                expect(mockSocket.socketsJoin).toHaveBeenCalledWith('post_post-456');
                expect(loggerSpy).toHaveBeenCalledWith('User user-123 subscribed to post room: post_post-456');
            });
        });
    });
    describe('Utility Methods', () => {
        describe('getConnectionStats', () => {
            it('should return connection statistics', () => {
                const stats = service.getConnectionStats();
                expect(stats).toEqual({
                    totalConnections: 3,
                    eventSubscriptions: 10,
                });
            });
        });
        describe('broadcastSystemAnnouncement', () => {
            it('should broadcast system announcement with default priority', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
                service.broadcastSystemAnnouncement('System maintenance scheduled');
                expect(mockServer.emit).toHaveBeenCalledWith('system_announcement', {
                    message: 'System maintenance scheduled',
                    priority: 'medium',
                    eventType: 'system_announcement',
                    timestamp: expect.any(Date),
                });
                expect(loggerSpy).toHaveBeenCalledWith('Broadcasted system announcement: System maintenance scheduled (priority: medium)');
            });
            it('should broadcast system announcement with custom priority', () => {
                service.broadcastSystemAnnouncement('Critical security update', 'high');
                expect(mockServer.emit).toHaveBeenCalledWith('system_announcement', {
                    message: 'Critical security update',
                    priority: 'high',
                    eventType: 'system_announcement',
                    timestamp: expect.any(Date),
                });
            });
        });
        describe('sendTargetedNotification', () => {
            it('should send notification to specific users', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
                const userIds = ['user-123', 'user-456'];
                const notification = {
                    title: 'Important Update',
                    message: 'Please check your settings',
                    priority: 'high',
                };
                const mockEmit = jest.fn();
                mockServer.to.mockReturnValue({ emit: mockEmit });
                service.sendTargetedNotification(userIds, notification);
                expect(mockServer.to).toHaveBeenCalledWith('user_user-123');
                expect(mockServer.to).toHaveBeenCalledWith('user_user-456');
                expect(mockEmit).toHaveBeenCalledWith('targeted_notification', {
                    title: 'Important Update',
                    message: 'Please check your settings',
                    priority: 'high',
                    eventType: 'targeted_notification',
                    timestamp: expect.any(Date),
                });
                expect(loggerSpy).toHaveBeenCalledWith('Sent targeted notification to 2 users');
            });
            it('should handle empty user list', () => {
                const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
                service.sendTargetedNotification([], { message: 'test' });
                expect(mockServer.to).not.toHaveBeenCalled();
                expect(loggerSpy).toHaveBeenCalledWith('Sent targeted notification to 0 users');
            });
        });
    });
    describe('Error Handling', () => {
        it('should handle event handler errors gracefully', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            // Mock broadcastMessage to throw an error
            messagingGateway.broadcastMessage.mockImplementation(() => {
                throw new Error('WebSocket connection failed');
            });
            service.onModuleInit();
            const messageEvent = new messaging_events_1.MessageSentEvent({
                messageId: 'msg-123',
                conversationId: 'conv-123',
                senderId: 'user-123',
                content: 'Hello world',
                messageType: 'text',
                sentAt: new Date(),
                recipientIds: ['user-456'],
            });
            const handler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'MessageSentEvent')[1];
            // Should not throw error
            await expect(handler(messageEvent)).rejects.toThrow('WebSocket connection failed');
        });
    });
    describe('Integration Tests', () => {
        it('should handle multiple events simultaneously', async () => {
            service.onModuleInit();
            const messageEvent = new messaging_events_1.MessageSentEvent({
                messageId: 'msg-123',
                conversationId: 'conv-123',
                senderId: 'user-123',
                content: 'Hello world',
                messageType: 'text',
                sentAt: new Date(),
                recipientIds: ['user-456'],
            });
            const appointmentEvent = new booking_events_1.AppointmentBookedEvent({
                appointmentId: 'appointment-123',
                clientId: 'client-123',
                therapistId: 'therapist-123',
                startTime: new Date(),
                meetingType: 'video',
                duration: 60,
                title: 'Therapy Session',
                description: 'Regular therapy session',
                isInitialConsultation: false,
            });
            const messageHandler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'MessageSentEvent')[1];
            const appointmentHandler = eventBusService.subscribe.mock.calls.find(call => call[0] === 'AppointmentBookedEvent')[1];
            const mockEmit = jest.fn();
            mockServer.to.mockReturnValue({ emit: mockEmit });
            await Promise.all([
                messageHandler(messageEvent),
                appointmentHandler(appointmentEvent),
            ]);
            expect(messagingGateway.broadcastMessage).toHaveBeenCalled();
            expect(mockEmit).toHaveBeenCalledWith('message_delivered', expect.any(Object));
            expect(mockEmit).toHaveBeenCalledWith('appointment_notification', expect.any(Object));
        });
        it('should maintain proper room isolation', () => {
            service.subscribeUserToPersonalRoom('user-123', 'socket-123');
            service.subscribeUserToCommunityRoom('user-123', 'community-456', 'socket-123');
            service.subscribeUserToPostRoom('user-123', 'post-789', 'socket-123');
            expect(mockSocket.socketsJoin).toHaveBeenCalledWith('user_user-123');
            expect(mockSocket.socketsJoin).toHaveBeenCalledWith('community_community-456');
            expect(mockSocket.socketsJoin).toHaveBeenCalledWith('post_post-789');
            expect(mockSocket.socketsJoin).toHaveBeenCalledTimes(3);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9zZXJ2aWNlcy93ZWJzb2NrZXQtZXZlbnQuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELHVFQUFrRTtBQUNsRSw2RUFBd0U7QUFDeEUsNERBQXdEO0FBQ3hELDJDQUF3QztBQUN4QywyRUFPOEM7QUFDOUMsdUVBRzRDO0FBQzVDLGlFQUd5QztBQUN6QyxxRUFHMkM7QUFFM0MsUUFBUSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtJQUNyQyxJQUFJLE9BQThCLENBQUM7SUFDbkMsSUFBSSxlQUE2QyxDQUFDO0lBQ2xELElBQUksZ0JBQStDLENBQUM7SUFDcEQsSUFBSSxVQUFlLENBQUM7SUFDcEIsSUFBSSxVQUFlLENBQUM7SUFFcEIsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLHdCQUF3QjtRQUN4QixVQUFVLEdBQUc7WUFDWCxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUN4QixDQUFDO1FBRUYsVUFBVSxHQUFHO1lBQ1gsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3hDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUM3QixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNmLE9BQU8sRUFBRTtnQkFDUCxPQUFPLEVBQUUsSUFBSSxHQUFHLENBQUM7b0JBQ2YsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDO29CQUNmLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQztvQkFDZixDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUM7aUJB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RSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDL0UsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLDBCQUEwQixFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN4RixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsT0FBTyxDQUFDLDJCQUEyQixDQUFDLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUM5RCxPQUFPLENBQUMsNEJBQTRCLENBQUMsVUFBVSxFQUFFLGVBQWUsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUNoRixPQUFPLENBQUMsdUJBQXVCLENBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUV0RSxNQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ3JFLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUMsb0JBQW9CLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUMvRSxNQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ3JFLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9tZXNzYWdpbmcvc2VydmljZXMvd2Vic29ja2V0LWV2ZW50LnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IFdlYlNvY2tldEV2ZW50U2VydmljZSB9IGZyb20gJy4vd2Vic29ja2V0LWV2ZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgRXZlbnRCdXNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29tbW9uL2V2ZW50cy9ldmVudC1idXMuc2VydmljZSc7XG5pbXBvcnQgeyBNZXNzYWdpbmdHYXRld2F5IH0gZnJvbSAnLi4vbWVzc2FnaW5nLmdhdGV3YXknO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHtcbiAgTWVzc2FnZVNlbnRFdmVudCxcbiAgTWVzc2FnZVJlYWRFdmVudCxcbiAgQ29udmVyc2F0aW9uQ3JlYXRlZEV2ZW50LFxuICBQYXJ0aWNpcGFudEpvaW5lZEV2ZW50LFxuICBQYXJ0aWNpcGFudExlZnRFdmVudCxcbiAgVHlwaW5nSW5kaWNhdG9yRXZlbnQsXG59IGZyb20gJy4uLy4uL2NvbW1vbi9ldmVudHMvbWVzc2FnaW5nLWV2ZW50cyc7XG5pbXBvcnQge1xuICBBcHBvaW50bWVudEJvb2tlZEV2ZW50LFxuICBBcHBvaW50bWVudENhbmNlbGxlZEV2ZW50LFxufSBmcm9tICcuLi8uLi9jb21tb24vZXZlbnRzL2Jvb2tpbmctZXZlbnRzJztcbmltcG9ydCB7XG4gIFVzZXJSZWdpc3RlcmVkRXZlbnQsXG4gIFVzZXJQcm9maWxlVXBkYXRlZEV2ZW50LFxufSBmcm9tICcuLi8uLi9jb21tb24vZXZlbnRzL3VzZXItZXZlbnRzJztcbmltcG9ydCB7XG4gIFBvc3RDcmVhdGVkRXZlbnQsXG4gIENvbW1lbnRBZGRlZEV2ZW50LFxufSBmcm9tICcuLi8uLi9jb21tb24vZXZlbnRzL3NvY2lhbC1ldmVudHMnO1xuXG5kZXNjcmliZSgnV2ViU29ja2V0RXZlbnRTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogV2ViU29ja2V0RXZlbnRTZXJ2aWNlO1xuICBsZXQgZXZlbnRCdXNTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxFdmVudEJ1c1NlcnZpY2U+O1xuICBsZXQgbWVzc2FnaW5nR2F0ZXdheTogamVzdC5Nb2NrZWQ8TWVzc2FnaW5nR2F0ZXdheT47XG4gIGxldCBtb2NrU2VydmVyOiBhbnk7XG4gIGxldCBtb2NrU29ja2V0OiBhbnk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gTW9jayBzb2NrZXQuaW8gc2VydmVyXG4gICAgbW9ja1NvY2tldCA9IHtcbiAgICAgIHNvY2tldHNKb2luOiBqZXN0LmZuKCksXG4gICAgICBzb2NrZXRzTGVhdmU6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgbW9ja1NlcnZlciA9IHtcbiAgICAgIHRvOiBqZXN0LmZuKCgpID0+ICh7IGVtaXQ6IGplc3QuZm4oKSB9KSksXG4gICAgICBpbjogamVzdC5mbigoKSA9PiBtb2NrU29ja2V0KSxcbiAgICAgIGVtaXQ6IGplc3QuZm4oKSxcbiAgICAgIHNvY2tldHM6IHtcbiAgICAgICAgc29ja2V0czogbmV3IE1hcChbXG4gICAgICAgICAgWydzb2NrZXQxJywge31dLFxuICAgICAgICAgIFsnc29ja2V0MicsIHt9XSxcbiAgICAgICAgICBbJ3NvY2tldDMnLCB7fV0sXG4gICAgICAgIF0pLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja0V2ZW50QnVzID0ge1xuICAgICAgc3Vic2NyaWJlOiBqZXN0LmZuKCksXG4gICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgICBnZXRFdmVudFN0YXRzOiBqZXN0LmZuKCgpID0+ICh7IHRvdGFsTGlzdGVuZXJzOiAxMCB9KSksXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tNZXNzYWdpbmdHYXRld2F5ID0ge1xuICAgICAgc2VydmVyOiBtb2NrU2VydmVyLFxuICAgICAgYnJvYWRjYXN0TWVzc2FnZTogamVzdC5mbigpLFxuICAgICAgYnJvYWRjYXN0UmVhZFJlY2VpcHQ6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBXZWJTb2NrZXRFdmVudFNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBFdmVudEJ1c1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tFdmVudEJ1cyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IE1lc3NhZ2luZ0dhdGV3YXksXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tNZXNzYWdpbmdHYXRld2F5LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxXZWJTb2NrZXRFdmVudFNlcnZpY2U+KFdlYlNvY2tldEV2ZW50U2VydmljZSk7XG4gICAgZXZlbnRCdXNTZXJ2aWNlID0gbW9kdWxlLmdldChFdmVudEJ1c1NlcnZpY2UpO1xuICAgIG1lc3NhZ2luZ0dhdGV3YXkgPSBtb2R1bGUuZ2V0KE1lc3NhZ2luZ0dhdGV3YXkpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdvbk1vZHVsZUluaXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIGV2ZW50IHN1YnNjcmlwdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcbiAgICAgIFxuICAgICAgc2VydmljZS5vbk1vZHVsZUluaXQoKTtcblxuICAgICAgZXhwZWN0KGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxMCk7IC8vIEFsbCBldmVudCB0eXBlc1xuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdXZWJTb2NrZXQgZXZlbnQgaGFuZGxlcnMgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1YnNjcmliZSB0byBhbGwgZXZlbnQgdHlwZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXJ2aWNlLm9uTW9kdWxlSW5pdCgpO1xuXG4gICAgICBjb25zdCBldmVudFR5cGVzID0gW1xuICAgICAgICAnTWVzc2FnZVNlbnRFdmVudCcsXG4gICAgICAgICdNZXNzYWdlUmVhZEV2ZW50JyxcbiAgICAgICAgJ0NvbnZlcnNhdGlvbkNyZWF0ZWRFdmVudCcsXG4gICAgICAgICdQYXJ0aWNpcGFudEpvaW5lZEV2ZW50JyxcbiAgICAgICAgJ1BhcnRpY2lwYW50TGVmdEV2ZW50JyxcbiAgICAgICAgJ1R5cGluZ0luZGljYXRvckV2ZW50JyxcbiAgICAgICAgJ0FwcG9pbnRtZW50Qm9va2VkRXZlbnQnLFxuICAgICAgICAnQXBwb2ludG1lbnRDYW5jZWxsZWRFdmVudCcsXG4gICAgICAgICdVc2VyUmVnaXN0ZXJlZEV2ZW50JyxcbiAgICAgICAgJ1VzZXJQcm9maWxlVXBkYXRlZEV2ZW50JyxcbiAgICAgICAgJ1Bvc3RDcmVhdGVkRXZlbnQnLFxuICAgICAgICAnQ29tbWVudEFkZGVkRXZlbnQnLFxuICAgICAgXTtcblxuICAgICAgZXZlbnRUeXBlcy5mb3JFYWNoKGV2ZW50VHlwZSA9PiB7XG4gICAgICAgIGV4cGVjdChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBldmVudFR5cGUsXG4gICAgICAgICAgZXhwZWN0LmFueShGdW5jdGlvbiksXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ01lc3NhZ2luZyBFdmVudHMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzZXJ2aWNlLm9uTW9kdWxlSW5pdCgpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ01lc3NhZ2VTZW50RXZlbnQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGJyb2FkY2FzdCBtZXNzYWdlIHRvIGNvbnZlcnNhdGlvbiBwYXJ0aWNpcGFudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VFdmVudCA9IG5ldyBNZXNzYWdlU2VudEV2ZW50KHtcbiAgICAgICAgICBtZXNzYWdlSWQ6ICdtc2ctMTIzJyxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgICBzZW5kZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBjb250ZW50OiAnSGVsbG8gd29ybGQnLFxuICAgICAgICAgIG1lc3NhZ2VUeXBlOiAndGV4dCcsXG4gICAgICAgICAgc2VudEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHJlY2lwaWVudElkczogWyd1c2VyLTQ1NicsICd1c2VyLTc4OSddLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBHZXQgdGhlIGhhbmRsZXIgZnVuY3Rpb25cbiAgICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICAgIGNhbGwgPT4gY2FsbFswXSA9PT0gJ01lc3NhZ2VTZW50RXZlbnQnLFxuICAgICAgICApWzFdO1xuXG4gICAgICAgIGF3YWl0IGhhbmRsZXIobWVzc2FnZUV2ZW50KTtcblxuICAgICAgICBleHBlY3QobWVzc2FnaW5nR2F0ZXdheS5icm9hZGNhc3RNZXNzYWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnY29udi0xMjMnLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnbXNnLTEyMycsXG4gICAgICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgICAgIHNlbmRlcklkOiAndXNlci0xMjMnLFxuICAgICAgICAgICAgY29udGVudDogJ0hlbGxvIHdvcmxkJyxcbiAgICAgICAgICAgIG1lc3NhZ2VUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICBzZW50QXQ6IG1lc3NhZ2VFdmVudC5ldmVudERhdGEuc2VudEF0LFxuICAgICAgICAgICAgZXZlbnRUeXBlOiAnbWVzc2FnZV9zZW50JyxcbiAgICAgICAgICB9LFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl91c2VyLTQ1NicpO1xuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfdXNlci03ODknKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHNlbmQgZGVsaXZlcnkgY29uZmlybWF0aW9ucyB0byByZWNpcGllbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtZXNzYWdlRXZlbnQgPSBuZXcgTWVzc2FnZVNlbnRFdmVudCh7XG4gICAgICAgICAgbWVzc2FnZUlkOiAnbXNnLTEyMycsXG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6ICdjb252LTEyMycsXG4gICAgICAgICAgc2VuZGVySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgICAgY29udGVudDogJ0hlbGxvIHdvcmxkJyxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogJ3RleHQnLFxuICAgICAgICAgIHNlbnRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICByZWNpcGllbnRJZHM6IFsndXNlci00NTYnXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICAgIGNhbGwgPT4gY2FsbFswXSA9PT0gJ01lc3NhZ2VTZW50RXZlbnQnLFxuICAgICAgICApWzFdO1xuXG4gICAgICAgIGNvbnN0IG1vY2tFbWl0ID0gamVzdC5mbigpO1xuICAgICAgICBtb2NrU2VydmVyLnRvLm1vY2tSZXR1cm5WYWx1ZSh7IGVtaXQ6IG1vY2tFbWl0IH0pO1xuXG4gICAgICAgIGF3YWl0IGhhbmRsZXIobWVzc2FnZUV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja0VtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdtZXNzYWdlX2RlbGl2ZXJlZCcsIHtcbiAgICAgICAgICBtZXNzYWdlSWQ6ICdtc2ctMTIzJyxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgICBkZWxpdmVyZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICBldmVudFR5cGU6ICdtZXNzYWdlX2RlbGl2ZXJlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnTWVzc2FnZVJlYWRFdmVudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYnJvYWRjYXN0IHJlYWQgcmVjZWlwdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVhZEV2ZW50ID0gbmV3IE1lc3NhZ2VSZWFkRXZlbnQoe1xuICAgICAgICAgIG1lc3NhZ2VJZDogJ21zZy0xMjMnLFxuICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiAnY29udi0xMjMnLFxuICAgICAgICAgIHJlYWRCeTogJ3VzZXItNDU2JyxcbiAgICAgICAgICByZWFkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbWVzc2FnZXNTaW5jZUxhc3RSZWFkOiAxLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnTWVzc2FnZVJlYWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihyZWFkRXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChtZXNzYWdpbmdHYXRld2F5LmJyb2FkY2FzdFJlYWRSZWNlaXB0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnY29udi0xMjMnLFxuICAgICAgICAgICdtc2ctMTIzJyxcbiAgICAgICAgICAndXNlci00NTYnLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQ29udmVyc2F0aW9uQ3JlYXRlZEV2ZW50JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBub3RpZnkgYWxsIHBhcnRpY2lwYW50cyBhYm91dCBuZXcgY29udmVyc2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBjb252ZXJzYXRpb25FdmVudCA9IG5ldyBDb252ZXJzYXRpb25DcmVhdGVkRXZlbnQoe1xuICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiAnY29udi0xMjMnLFxuICAgICAgICAgIGNyZWF0ZWRCeTogJ3VzZXItMTIzJyxcbiAgICAgICAgICBwYXJ0aWNpcGFudElkczogWyd1c2VyLTEyMycsICd1c2VyLTQ1NiddLFxuICAgICAgICAgIGNvbnZlcnNhdGlvblR5cGU6ICdkaXJlY3QnLFxuICAgICAgICAgIHRpdGxlOiAnVGVzdCBDb252ZXJzYXRpb24nLFxuICAgICAgICAgIGlzUHJpdmF0ZTogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICAgIGNhbGwgPT4gY2FsbFswXSA9PT0gJ0NvbnZlcnNhdGlvbkNyZWF0ZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihjb252ZXJzYXRpb25FdmVudCk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tTZXJ2ZXIudG8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyX3VzZXItMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl91c2VyLTQ1NicpO1xuICAgICAgICBleHBlY3QobW9ja0VtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb252ZXJzYXRpb25fY3JlYXRlZCcsIHtcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgICBjcmVhdGVkQnk6ICd1c2VyLTEyMycsXG4gICAgICAgICAgY29udmVyc2F0aW9uVHlwZTogJ2RpcmVjdCcsXG4gICAgICAgICAgdGl0bGU6ICdUZXN0IENvbnZlcnNhdGlvbicsXG4gICAgICAgICAgcGFydGljaXBhbnRJZHM6IFsndXNlci0xMjMnLCAndXNlci00NTYnXSxcbiAgICAgICAgICBldmVudFR5cGU6ICdjb252ZXJzYXRpb25fY3JlYXRlZCcsXG4gICAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1BhcnRpY2lwYW50Sm9pbmVkRXZlbnQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIG5vdGlmeSBjb252ZXJzYXRpb24gYWJvdXQgbmV3IHBhcnRpY2lwYW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBqb2luRXZlbnQgPSBuZXcgUGFydGljaXBhbnRKb2luZWRFdmVudCh7XG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6ICdjb252LTEyMycsXG4gICAgICAgICAgcGFydGljaXBhbnRJZDogJ3VzZXItNzg5JyxcbiAgICAgICAgICBhZGRlZEJ5OiAndXNlci0xMjMnLFxuICAgICAgICAgIGpvaW5lZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHJvbGU6ICdtZW1iZXInLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnUGFydGljaXBhbnRKb2luZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihqb2luRXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY29udi0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncGFydGljaXBhbnRfam9pbmVkJywge1xuICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiAnY29udi0xMjMnLFxuICAgICAgICAgIHBhcnRpY2lwYW50SWQ6ICd1c2VyLTc4OScsXG4gICAgICAgICAgYWRkZWRCeTogJ3VzZXItMTIzJyxcbiAgICAgICAgICBqb2luZWRBdDogam9pbkV2ZW50LmV2ZW50RGF0YS5qb2luZWRBdCxcbiAgICAgICAgICByb2xlOiAnbWVtYmVyJyxcbiAgICAgICAgICBldmVudFR5cGU6ICdwYXJ0aWNpcGFudF9qb2luZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1BhcnRpY2lwYW50TGVmdEV2ZW50JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBub3RpZnkgY29udmVyc2F0aW9uIGFib3V0IHBhcnRpY2lwYW50IGxlYXZpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxlZnRFdmVudCA9IG5ldyBQYXJ0aWNpcGFudExlZnRFdmVudCh7XG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6ICdjb252LTEyMycsXG4gICAgICAgICAgcGFydGljaXBhbnRJZDogJ3VzZXItNzg5JyxcbiAgICAgICAgICBsZWZ0QXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbGVmdFJlYXNvbjogJ1VzZXIgbGVmdCB2b2x1bnRhcmlseScsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSAoZXZlbnRCdXNTZXJ2aWNlLnN1YnNjcmliZSBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHMuZmluZChcbiAgICAgICAgICBjYWxsID0+IGNhbGxbMF0gPT09ICdQYXJ0aWNpcGFudExlZnRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihsZWZ0RXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY29udi0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncGFydGljaXBhbnRfbGVmdCcsIHtcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgICBwYXJ0aWNpcGFudElkOiAndXNlci03ODknLFxuICAgICAgICAgIGxlZnRBdDogbGVmdEV2ZW50LmV2ZW50RGF0YS5sZWZ0QXQsXG4gICAgICAgICAgbGVmdFJlYXNvbjogJ1VzZXIgbGVmdCB2b2x1bnRhcmlseScsXG4gICAgICAgICAgZXZlbnRUeXBlOiAncGFydGljaXBhbnRfbGVmdCcsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnVHlwaW5nSW5kaWNhdG9yRXZlbnQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJlbGF5IHR5cGluZyBpbmRpY2F0b3IgdG8gY29udmVyc2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB0eXBpbmdFdmVudCA9IG5ldyBUeXBpbmdJbmRpY2F0b3JFdmVudCh7XG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6ICdjb252LTEyMycsXG4gICAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICAgIGlzVHlwaW5nOiB0cnVlLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICAgIGNhbGwgPT4gY2FsbFswXSA9PT0gJ1R5cGluZ0luZGljYXRvckV2ZW50JyxcbiAgICAgICAgKVsxXTtcblxuICAgICAgICBjb25zdCBtb2NrRW1pdCA9IGplc3QuZm4oKTtcbiAgICAgICAgbW9ja1NlcnZlci50by5tb2NrUmV0dXJuVmFsdWUoeyBlbWl0OiBtb2NrRW1pdCB9KTtcblxuICAgICAgICBhd2FpdCBoYW5kbGVyKHR5cGluZ0V2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2NvbnYtMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrRW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3R5cGluZ19pbmRpY2F0b3InLCB7XG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6ICdjb252LTEyMycsXG4gICAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxuICAgICAgICAgIGlzVHlwaW5nOiB0cnVlLFxuICAgICAgICAgIHRpbWVzdGFtcDogdHlwaW5nRXZlbnQuZXZlbnREYXRhLnRpbWVzdGFtcCxcbiAgICAgICAgICBldmVudFR5cGU6ICd0eXBpbmdfaW5kaWNhdG9yJyxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Jvb2tpbmcgRXZlbnRzJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgc2VydmljZS5vbk1vZHVsZUluaXQoKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdBcHBvaW50bWVudEJvb2tlZEV2ZW50JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBub3RpZnkgYm90aCBjbGllbnQgYW5kIHRoZXJhcGlzdCBhYm91dCBhcHBvaW50bWVudCBib29raW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBhcHBvaW50bWVudEV2ZW50ID0gbmV3IEFwcG9pbnRtZW50Qm9va2VkRXZlbnQoe1xuICAgICAgICAgIGFwcG9pbnRtZW50SWQ6ICdhcHBvaW50bWVudC0xMjMnLFxuICAgICAgICAgIGNsaWVudElkOiAnY2xpZW50LTEyMycsXG4gICAgICAgICAgdGhlcmFwaXN0SWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgICAgIHRpdGxlOiAnVGhlcmFweSBTZXNzaW9uJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JlZ3VsYXIgdGhlcmFweSBzZXNzaW9uJyxcbiAgICAgICAgICBpc0luaXRpYWxDb25zdWx0YXRpb246IGZhbHNlLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnQXBwb2ludG1lbnRCb29rZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihhcHBvaW50bWVudEV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfY2xpZW50LTEyMycpO1xuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfdGhlcmFwaXN0LTEyMycpO1xuICAgICAgICBleHBlY3QobW9ja0VtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhcHBvaW50bWVudF9ub3RpZmljYXRpb24nLCB7XG4gICAgICAgICAgYXBwb2ludG1lbnRJZDogJ2FwcG9pbnRtZW50LTEyMycsXG4gICAgICAgICAgY2xpZW50SWQ6ICdjbGllbnQtMTIzJyxcbiAgICAgICAgICB0aGVyYXBpc3RJZDogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICAgIHN0YXJ0VGltZTogYXBwb2ludG1lbnRFdmVudC5ldmVudERhdGEuc3RhcnRUaW1lLFxuICAgICAgICAgIG1lZXRpbmdUeXBlOiAndmlkZW8nLFxuICAgICAgICAgIGlzSW5pdGlhbENvbnN1bHRhdGlvbjogZmFsc2UsXG4gICAgICAgICAgZXZlbnRUeXBlOiAnYXBwb2ludG1lbnRfYm9va2VkJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgICAgbWVzc2FnZTogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHNlbmQgZGlmZmVyZW50IG1lc3NhZ2VzIHRvIGNsaWVudCBhbmQgdGhlcmFwaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBhcHBvaW50bWVudEV2ZW50ID0gbmV3IEFwcG9pbnRtZW50Qm9va2VkRXZlbnQoe1xuICAgICAgICAgIGFwcG9pbnRtZW50SWQ6ICdhcHBvaW50bWVudC0xMjMnLFxuICAgICAgICAgIGNsaWVudElkOiAnY2xpZW50LTEyMycsXG4gICAgICAgICAgdGhlcmFwaXN0SWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgICAgIHRpdGxlOiAnVGhlcmFweSBTZXNzaW9uJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JlZ3VsYXIgdGhlcmFweSBzZXNzaW9uJyxcbiAgICAgICAgICBpc0luaXRpYWxDb25zdWx0YXRpb246IGZhbHNlLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnQXBwb2ludG1lbnRCb29rZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihhcHBvaW50bWVudEV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja0VtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhcHBvaW50bWVudF9ub3RpZmljYXRpb24nLCBcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBtZXNzYWdlOiAnWW91ciBhcHBvaW50bWVudCBoYXMgYmVlbiBib29rZWQgYW5kIGlzIHBlbmRpbmcgY29uZmlybWF0aW9uLicsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYXBwb2ludG1lbnRfbm90aWZpY2F0aW9uJywgXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgbWVzc2FnZTogJ1lvdSBoYXZlIGEgbmV3IGFwcG9pbnRtZW50IHJlcXVlc3QgdGhhdCByZXF1aXJlcyBjb25maXJtYXRpb24uJyxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQXBwb2ludG1lbnRDYW5jZWxsZWRFdmVudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgbm90aWZ5IGJvdGggcGFydGllcyBhYm91dCBhcHBvaW50bWVudCBjYW5jZWxsYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbmNlbEV2ZW50ID0gbmV3IEFwcG9pbnRtZW50Q2FuY2VsbGVkRXZlbnQoe1xuICAgICAgICAgIGFwcG9pbnRtZW50SWQ6ICdhcHBvaW50bWVudC0xMjMnLFxuICAgICAgICAgIGNsaWVudElkOiAnY2xpZW50LTEyMycsXG4gICAgICAgICAgdGhlcmFwaXN0SWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICAgICAgICBjYW5jZWxsZWRCeTogJ2NsaWVudC0xMjMnLFxuICAgICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogJ1BlcnNvbmFsIGVtZXJnZW5jeScsXG4gICAgICAgICAgb3JpZ2luYWxTdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgY2FuY2VsbGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgY2FuY2VsbGF0aW9uTm90aWNlOiAyNCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICAgIGNhbGwgPT4gY2FsbFswXSA9PT0gJ0FwcG9pbnRtZW50Q2FuY2VsbGVkRXZlbnQnLFxuICAgICAgICApWzFdO1xuXG4gICAgICAgIGNvbnN0IG1vY2tFbWl0ID0gamVzdC5mbigpO1xuICAgICAgICBtb2NrU2VydmVyLnRvLm1vY2tSZXR1cm5WYWx1ZSh7IGVtaXQ6IG1vY2tFbWl0IH0pO1xuXG4gICAgICAgIGF3YWl0IGhhbmRsZXIoY2FuY2VsRXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl9jbGllbnQtMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl90aGVyYXBpc3QtMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrRW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FwcG9pbnRtZW50X25vdGlmaWNhdGlvbicsIHtcbiAgICAgICAgICBhcHBvaW50bWVudElkOiAnYXBwb2ludG1lbnQtMTIzJyxcbiAgICAgICAgICBjbGllbnRJZDogJ2NsaWVudC0xMjMnLFxuICAgICAgICAgIHRoZXJhcGlzdElkOiAndGhlcmFwaXN0LTEyMycsXG4gICAgICAgICAgY2FuY2VsbGVkQnk6ICdjbGllbnQtMTIzJyxcbiAgICAgICAgICBjYW5jZWxsYXRpb25SZWFzb246ICdQZXJzb25hbCBlbWVyZ2VuY3knLFxuICAgICAgICAgIGNhbmNlbGxlZEF0OiBjYW5jZWxFdmVudC5ldmVudERhdGEuY2FuY2VsbGVkQXQsXG4gICAgICAgICAgZXZlbnRUeXBlOiAnYXBwb2ludG1lbnRfY2FuY2VsbGVkJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgICAgbWVzc2FnZTogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHNlbmQgZGlmZmVyZW50IG1lc3NhZ2VzIGJhc2VkIG9uIHdobyBjYW5jZWxsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbmNlbEV2ZW50ID0gbmV3IEFwcG9pbnRtZW50Q2FuY2VsbGVkRXZlbnQoe1xuICAgICAgICAgIGFwcG9pbnRtZW50SWQ6ICdhcHBvaW50bWVudC0xMjMnLFxuICAgICAgICAgIGNsaWVudElkOiAnY2xpZW50LTEyMycsXG4gICAgICAgICAgdGhlcmFwaXN0SWQ6ICd0aGVyYXBpc3QtMTIzJyxcbiAgICAgICAgICBjYW5jZWxsZWRCeTogJ3RoZXJhcGlzdC0xMjMnLFxuICAgICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogJ1NjaGVkdWxlIGNvbmZsaWN0JyxcbiAgICAgICAgICBvcmlnaW5hbFN0YXJ0VGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICBjYW5jZWxsZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBjYW5jZWxsYXRpb25Ob3RpY2U6IDI0LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnQXBwb2ludG1lbnRDYW5jZWxsZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihjYW5jZWxFdmVudCk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYXBwb2ludG1lbnRfbm90aWZpY2F0aW9uJywgXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgbWVzc2FnZTogJ1lvdXIgYXBwb2ludG1lbnQgaGFzIGJlZW4gY2FuY2VsbGVkIGJ5IHRoZSB0aGVyYXBpc3QuJyxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja0VtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhcHBvaW50bWVudF9ub3RpZmljYXRpb24nLCBcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBtZXNzYWdlOiAnWW91IGhhdmUgY2FuY2VsbGVkIHRoZSBhcHBvaW50bWVudC4nLFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1VzZXIgRXZlbnRzJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgc2VydmljZS5vbk1vZHVsZUluaXQoKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdVc2VyUmVnaXN0ZXJlZEV2ZW50JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBzZW5kIHdlbGNvbWUgbm90aWZpY2F0aW9uIHRvIG5ldyB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZWdpc3RyYXRpb25FdmVudCA9IG5ldyBVc2VyUmVnaXN0ZXJlZEV2ZW50KHtcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgICAgZW1haWw6ICd1c2VyQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgICAgcmVnaXN0cmF0aW9uTWV0aG9kOiAnZW1haWwnLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSAoZXZlbnRCdXNTZXJ2aWNlLnN1YnNjcmliZSBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHMuZmluZChcbiAgICAgICAgICBjYWxsID0+IGNhbGxbMF0gPT09ICdVc2VyUmVnaXN0ZXJlZEV2ZW50JyxcbiAgICAgICAgKVsxXTtcblxuICAgICAgICBjb25zdCBtb2NrRW1pdCA9IGplc3QuZm4oKTtcbiAgICAgICAgbW9ja1NlcnZlci50by5tb2NrUmV0dXJuVmFsdWUoeyBlbWl0OiBtb2NrRW1pdCB9KTtcblxuICAgICAgICBhd2FpdCBoYW5kbGVyKHJlZ2lzdHJhdGlvbkV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfdXNlci0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnd2VsY29tZV9ub3RpZmljYXRpb24nLCB7XG4gICAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICBldmVudFR5cGU6ICd1c2VyX3JlZ2lzdGVyZWQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdXZWxjb21lIHRvIE1lbnRhcmEsIEpvaG4hIFlvdXIgYWNjb3VudCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgY3JlYXRlZC4nLFxuICAgICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdVc2VyUHJvZmlsZVVwZGF0ZWRFdmVudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYnJvYWRjYXN0IHByb2ZpbGUgdXBkYXRlIHRvIGFsbCBjb25uZWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJvZmlsZUV2ZW50ID0gbmV3IFVzZXJQcm9maWxlVXBkYXRlZEV2ZW50KHtcbiAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgICAgdXBkYXRlZEZpZWxkczogWydmaXJzdE5hbWUnLCAnbGFzdE5hbWUnXSxcbiAgICAgICAgICBuZXdWYWx1ZXM6IHsgZmlyc3ROYW1lOiAnSmFuZScsIGxhc3ROYW1lOiAnU21pdGgnIH0sXG4gICAgICAgICAgcHJldmlvdXNWYWx1ZXM6IHsgZmlyc3ROYW1lOiAnSm9obicsIGxhc3ROYW1lOiAnRG9lJyB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnVXNlclByb2ZpbGVVcGRhdGVkRXZlbnQnLFxuICAgICAgICApWzFdO1xuXG4gICAgICAgIGF3YWl0IGhhbmRsZXIocHJvZmlsZUV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci5lbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl9wcm9maWxlX3VwZGF0ZWQnLCB7XG4gICAgICAgICAgdXNlcklkOiAndXNlci0xMjMnLFxuICAgICAgICAgIHVwZGF0ZWRGaWVsZHM6IFsnZmlyc3ROYW1lJywgJ2xhc3ROYW1lJ10sXG4gICAgICAgICAgcHJvZmlsZURhdGE6IHsgZmlyc3ROYW1lOiAnSmFuZScsIGxhc3ROYW1lOiAnU21pdGgnIH0sXG4gICAgICAgICAgZXZlbnRUeXBlOiAndXNlcl9wcm9maWxlX3VwZGF0ZWQnLFxuICAgICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NvY2lhbCBFdmVudHMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzZXJ2aWNlLm9uTW9kdWxlSW5pdCgpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1Bvc3RDcmVhdGVkRXZlbnQnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGJyb2FkY2FzdCBuZXcgcG9zdCB0byBjb21tdW5pdHkgcm9vbScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcG9zdEV2ZW50ID0gbmV3IFBvc3RDcmVhdGVkRXZlbnQoe1xuICAgICAgICAgIHBvc3RJZDogJ3Bvc3QtMTIzJyxcbiAgICAgICAgICBhdXRob3JJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBjb21tdW5pdHlJZDogJ2NvbW11bml0eS0xMjMnLFxuICAgICAgICAgIHRpdGxlOiAnTmV3IFBvc3QnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdUaGlzIGlzIGEgbmV3IHBvc3QnLFxuICAgICAgICAgIHRhZ3M6IFsnbWVudGFsLWhlYWx0aCcsICdzdXBwb3J0J10sXG4gICAgICAgICAgcG9zdFR5cGU6ICdkaXNjdXNzaW9uJyxcbiAgICAgICAgICBpc0Fub255bW91czogZmFsc2UsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnUG9zdENyZWF0ZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihwb3N0RXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY29tbXVuaXR5X2NvbW11bml0eS0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnbmV3X3Bvc3QnLCB7XG4gICAgICAgICAgcG9zdElkOiAncG9zdC0xMjMnLFxuICAgICAgICAgIGF1dGhvcklkOiAndXNlci0xMjMnLFxuICAgICAgICAgIGNvbW11bml0eUlkOiAnY29tbXVuaXR5LTEyMycsXG4gICAgICAgICAgdGl0bGU6ICdOZXcgUG9zdCcsXG4gICAgICAgICAgY29udGVudDogJ1RoaXMgaXMgYSBuZXcgcG9zdCcsXG4gICAgICAgICAgdGFnczogWydtZW50YWwtaGVhbHRoJywgJ3N1cHBvcnQnXSxcbiAgICAgICAgICBwb3N0VHlwZTogJ2Rpc2N1c3Npb24nLFxuICAgICAgICAgIGlzQW5vbnltb3VzOiBmYWxzZSxcbiAgICAgICAgICBldmVudFR5cGU6ICdwb3N0X2NyZWF0ZWQnLFxuICAgICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoaWRlIGF1dGhvciBJRCBmb3IgYW5vbnltb3VzIHBvc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwb3N0RXZlbnQgPSBuZXcgUG9zdENyZWF0ZWRFdmVudCh7XG4gICAgICAgICAgcG9zdElkOiAncG9zdC0xMjMnLFxuICAgICAgICAgIGF1dGhvcklkOiAndXNlci0xMjMnLFxuICAgICAgICAgIGNvbW11bml0eUlkOiAnY29tbXVuaXR5LTEyMycsXG4gICAgICAgICAgdGl0bGU6ICdBbm9ueW1vdXMgUG9zdCcsXG4gICAgICAgICAgY29udGVudDogJ1RoaXMgaXMgYW4gYW5vbnltb3VzIHBvc3QnLFxuICAgICAgICAgIHRhZ3M6IFsnc3VwcG9ydCddLFxuICAgICAgICAgIHBvc3RUeXBlOiAnZGlzY3Vzc2lvbicsXG4gICAgICAgICAgaXNBbm9ueW1vdXM6IHRydWUsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnUG9zdENyZWF0ZWRFdmVudCcsXG4gICAgICAgIClbMV07XG5cbiAgICAgICAgY29uc3QgbW9ja0VtaXQgPSBqZXN0LmZuKCk7XG4gICAgICAgIG1vY2tTZXJ2ZXIudG8ubW9ja1JldHVyblZhbHVlKHsgZW1pdDogbW9ja0VtaXQgfSk7XG5cbiAgICAgICAgYXdhaXQgaGFuZGxlcihwb3N0RXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrRW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ25ld19wb3N0JywgXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgYXV0aG9ySWQ6IG51bGwsXG4gICAgICAgICAgICBpc0Fub255bW91czogdHJ1ZSxcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbm90IGJyb2FkY2FzdCBpZiBubyBjb21tdW5pdHlJZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcG9zdEV2ZW50ID0gbmV3IFBvc3RDcmVhdGVkRXZlbnQoe1xuICAgICAgICAgIHBvc3RJZDogJ3Bvc3QtMTIzJyxcbiAgICAgICAgICBhdXRob3JJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBjb21tdW5pdHlJZDogbnVsbCxcbiAgICAgICAgICB0aXRsZTogJ1ByaXZhdGUgUG9zdCcsXG4gICAgICAgICAgY29udGVudDogJ1RoaXMgaXMgYSBwcml2YXRlIHBvc3QnLFxuICAgICAgICAgIHRhZ3M6IFtdLFxuICAgICAgICAgIHBvc3RUeXBlOiAnZGlzY3Vzc2lvbicsXG4gICAgICAgICAgaXNBbm9ueW1vdXM6IGZhbHNlLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICAgIGNhbGwgPT4gY2FsbFswXSA9PT0gJ1Bvc3RDcmVhdGVkRXZlbnQnLFxuICAgICAgICApWzFdO1xuXG4gICAgICAgIGF3YWl0IGhhbmRsZXIocG9zdEV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ0NvbW1lbnRBZGRlZEV2ZW50JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBicm9hZGNhc3QgY29tbWVudCB0byBwb3N0IHJvb20nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbW1lbnRFdmVudCA9IG5ldyBDb21tZW50QWRkZWRFdmVudCh7XG4gICAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xMjMnLFxuICAgICAgICAgIHBvc3RJZDogJ3Bvc3QtMTIzJyxcbiAgICAgICAgICBhdXRob3JJZDogJ3VzZXItNDU2JyxcbiAgICAgICAgICBjb250ZW50OiAnR3JlYXQgcG9zdCEnLFxuICAgICAgICAgIHBhcmVudENvbW1lbnRJZDogbnVsbCxcbiAgICAgICAgICBpc0Fub255bW91czogZmFsc2UsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBoYW5kbGVyID0gKGV2ZW50QnVzU2VydmljZS5zdWJzY3JpYmUgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzLmZpbmQoXG4gICAgICAgICAgY2FsbCA9PiBjYWxsWzBdID09PSAnQ29tbWVudEFkZGVkRXZlbnQnLFxuICAgICAgICApWzFdO1xuXG4gICAgICAgIGNvbnN0IG1vY2tFbWl0ID0gamVzdC5mbigpO1xuICAgICAgICBtb2NrU2VydmVyLnRvLm1vY2tSZXR1cm5WYWx1ZSh7IGVtaXQ6IG1vY2tFbWl0IH0pO1xuXG4gICAgICAgIGF3YWl0IGhhbmRsZXIoY29tbWVudEV2ZW50KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Bvc3RfcG9zdC0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncG9zdF9pbnRlcmFjdGlvbicsIHtcbiAgICAgICAgICBjb21tZW50SWQ6ICdjb21tZW50LTEyMycsXG4gICAgICAgICAgcG9zdElkOiAncG9zdC0xMjMnLFxuICAgICAgICAgIGF1dGhvcklkOiAndXNlci00NTYnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdHcmVhdCBwb3N0IScsXG4gICAgICAgICAgaW50ZXJhY3Rpb25UeXBlOiAnY29tbWVudCcsXG4gICAgICAgICAgZXZlbnRUeXBlOiAnY29tbWVudF9jcmVhdGVkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnU29tZW9uZSBjb21tZW50ZWQgb24geW91ciBwb3N0JyxcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIH0pO1xuICAgICAgICBleHBlY3QobW9ja0VtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCduZXdfY29tbWVudCcsIHtcbiAgICAgICAgICBjb21tZW50SWQ6ICdjb21tZW50LTEyMycsXG4gICAgICAgICAgcG9zdElkOiAncG9zdC0xMjMnLFxuICAgICAgICAgIGF1dGhvcklkOiAndXNlci00NTYnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdHcmVhdCBwb3N0IScsXG4gICAgICAgICAgZXZlbnRUeXBlOiAnY29tbWVudF9jcmVhdGVkJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSb29tIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ3N1YnNjcmliZVVzZXJUb1BlcnNvbmFsUm9vbScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc3Vic2NyaWJlIHVzZXIgdG8gcGVyc29uYWwgcm9vbScsICgpID0+IHtcbiAgICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZGVidWcnKTtcbiAgICAgICAgXG4gICAgICAgIHNlcnZpY2Uuc3Vic2NyaWJlVXNlclRvUGVyc29uYWxSb29tKCd1c2VyLTEyMycsICdzb2NrZXQtMTIzJyk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tTZXJ2ZXIuaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzb2NrZXQtMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrU29ja2V0LnNvY2tldHNKb2luKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl91c2VyLTEyMycpO1xuICAgICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnVXNlciB1c2VyLTEyMyBzdWJzY3JpYmVkIHRvIHBlcnNvbmFsIHJvb206IHVzZXJfdXNlci0xMjMnLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndW5zdWJzY3JpYmVVc2VyRnJvbVBlcnNvbmFsUm9vbScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgdW5zdWJzY3JpYmUgdXNlciBmcm9tIHBlcnNvbmFsIHJvb20nLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2RlYnVnJyk7XG4gICAgICAgIFxuICAgICAgICBzZXJ2aWNlLnVuc3Vic2NyaWJlVXNlckZyb21QZXJzb25hbFJvb20oJ3VzZXItMTIzJywgJ3NvY2tldC0xMjMnKTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci5pbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NvY2tldC0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tTb2NrZXQuc29ja2V0c0xlYXZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl91c2VyLTEyMycpO1xuICAgICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnVXNlciB1c2VyLTEyMyB1bnN1YnNjcmliZWQgZnJvbSBwZXJzb25hbCByb29tOiB1c2VyX3VzZXItMTIzJyxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3N1YnNjcmliZVVzZXJUb0NvbW11bml0eVJvb20nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHN1YnNjcmliZSB1c2VyIHRvIGNvbW11bml0eSByb29tJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdkZWJ1ZycpO1xuICAgICAgICBcbiAgICAgICAgc2VydmljZS5zdWJzY3JpYmVVc2VyVG9Db21tdW5pdHlSb29tKCd1c2VyLTEyMycsICdjb21tdW5pdHktNDU2JywgJ3NvY2tldC0xMjMnKTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci5pbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NvY2tldC0xMjMnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tTb2NrZXQuc29ja2V0c0pvaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb21tdW5pdHlfY29tbXVuaXR5LTQ1NicpO1xuICAgICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnVXNlciB1c2VyLTEyMyBzdWJzY3JpYmVkIHRvIGNvbW11bml0eSByb29tOiBjb21tdW5pdHlfY29tbXVuaXR5LTQ1NicsXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdzdWJzY3JpYmVVc2VyVG9Qb3N0Um9vbScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc3Vic2NyaWJlIHVzZXIgdG8gcG9zdCByb29tJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdkZWJ1ZycpO1xuICAgICAgICBcbiAgICAgICAgc2VydmljZS5zdWJzY3JpYmVVc2VyVG9Qb3N0Um9vbSgndXNlci0xMjMnLCAncG9zdC00NTYnLCAnc29ja2V0LTEyMycpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLmluKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc29ja2V0LTEyMycpO1xuICAgICAgICBleHBlY3QobW9ja1NvY2tldC5zb2NrZXRzSm9pbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Bvc3RfcG9zdC00NTYnKTtcbiAgICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ1VzZXIgdXNlci0xMjMgc3Vic2NyaWJlZCB0byBwb3N0IHJvb206IHBvc3RfcG9zdC00NTYnLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdVdGlsaXR5IE1ldGhvZHMnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2dldENvbm5lY3Rpb25TdGF0cycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbm5lY3Rpb24gc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuXG4gICAgICAgIGV4cGVjdChzdGF0cykudG9FcXVhbCh7XG4gICAgICAgICAgdG90YWxDb25uZWN0aW9uczogMyxcbiAgICAgICAgICBldmVudFN1YnNjcmlwdGlvbnM6IDEwLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Jyb2FkY2FzdFN5c3RlbUFubm91bmNlbWVudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYnJvYWRjYXN0IHN5c3RlbSBhbm5vdW5jZW1lbnQgd2l0aCBkZWZhdWx0IHByaW9yaXR5JywgKCkgPT4ge1xuICAgICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICdsb2cnKTtcbiAgICAgICAgXG4gICAgICAgIHNlcnZpY2UuYnJvYWRjYXN0U3lzdGVtQW5ub3VuY2VtZW50KCdTeXN0ZW0gbWFpbnRlbmFuY2Ugc2NoZWR1bGVkJyk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tTZXJ2ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N5c3RlbV9hbm5vdW5jZW1lbnQnLCB7XG4gICAgICAgICAgbWVzc2FnZTogJ1N5c3RlbSBtYWludGVuYW5jZSBzY2hlZHVsZWQnLFxuICAgICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgICBldmVudFR5cGU6ICdzeXN0ZW1fYW5ub3VuY2VtZW50JyxcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIH0pO1xuICAgICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnQnJvYWRjYXN0ZWQgc3lzdGVtIGFubm91bmNlbWVudDogU3lzdGVtIG1haW50ZW5hbmNlIHNjaGVkdWxlZCAocHJpb3JpdHk6IG1lZGl1bSknLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgYnJvYWRjYXN0IHN5c3RlbSBhbm5vdW5jZW1lbnQgd2l0aCBjdXN0b20gcHJpb3JpdHknLCAoKSA9PiB7XG4gICAgICAgIHNlcnZpY2UuYnJvYWRjYXN0U3lzdGVtQW5ub3VuY2VtZW50KCdDcml0aWNhbCBzZWN1cml0eSB1cGRhdGUnLCAnaGlnaCcpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzeXN0ZW1fYW5ub3VuY2VtZW50Jywge1xuICAgICAgICAgIG1lc3NhZ2U6ICdDcml0aWNhbCBzZWN1cml0eSB1cGRhdGUnLFxuICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXG4gICAgICAgICAgZXZlbnRUeXBlOiAnc3lzdGVtX2Fubm91bmNlbWVudCcsXG4gICAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3NlbmRUYXJnZXRlZE5vdGlmaWNhdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgc2VuZCBub3RpZmljYXRpb24gdG8gc3BlY2lmaWMgdXNlcnMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2RlYnVnJyk7XG4gICAgICAgIGNvbnN0IHVzZXJJZHMgPSBbJ3VzZXItMTIzJywgJ3VzZXItNDU2J107XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgICB0aXRsZTogJ0ltcG9ydGFudCBVcGRhdGUnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdQbGVhc2UgY2hlY2sgeW91ciBzZXR0aW5ncycsXG4gICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJyxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBtb2NrRW1pdCA9IGplc3QuZm4oKTtcbiAgICAgICAgbW9ja1NlcnZlci50by5tb2NrUmV0dXJuVmFsdWUoeyBlbWl0OiBtb2NrRW1pdCB9KTtcblxuICAgICAgICBzZXJ2aWNlLnNlbmRUYXJnZXRlZE5vdGlmaWNhdGlvbih1c2VySWRzLCBub3RpZmljYXRpb24pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrU2VydmVyLnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl91c2VyLTEyMycpO1xuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfdXNlci00NTYnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndGFyZ2V0ZWRfbm90aWZpY2F0aW9uJywge1xuICAgICAgICAgIHRpdGxlOiAnSW1wb3J0YW50IFVwZGF0ZScsXG4gICAgICAgICAgbWVzc2FnZTogJ1BsZWFzZSBjaGVjayB5b3VyIHNldHRpbmdzJyxcbiAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICAgIGV2ZW50VHlwZTogJ3RhcmdldGVkX25vdGlmaWNhdGlvbicsXG4gICAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ1NlbnQgdGFyZ2V0ZWQgbm90aWZpY2F0aW9uIHRvIDIgdXNlcnMnLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHVzZXIgbGlzdCcsICgpID0+IHtcbiAgICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZGVidWcnKTtcbiAgICAgICAgXG4gICAgICAgIHNlcnZpY2Uuc2VuZFRhcmdldGVkTm90aWZpY2F0aW9uKFtdLCB7IG1lc3NhZ2U6ICd0ZXN0JyB9KTtcblxuICAgICAgICBleHBlY3QobW9ja1NlcnZlci50bykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ1NlbnQgdGFyZ2V0ZWQgbm90aWZpY2F0aW9uIHRvIDAgdXNlcnMnLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBldmVudCBoYW5kbGVyIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcbiAgICAgIFxuICAgICAgLy8gTW9jayBicm9hZGNhc3RNZXNzYWdlIHRvIHRocm93IGFuIGVycm9yXG4gICAgICBtZXNzYWdpbmdHYXRld2F5LmJyb2FkY2FzdE1lc3NhZ2UubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXZWJTb2NrZXQgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBzZXJ2aWNlLm9uTW9kdWxlSW5pdCgpO1xuXG4gICAgICBjb25zdCBtZXNzYWdlRXZlbnQgPSBuZXcgTWVzc2FnZVNlbnRFdmVudCh7XG4gICAgICAgIG1lc3NhZ2VJZDogJ21zZy0xMjMnLFxuICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgc2VuZGVySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIGNvbnRlbnQ6ICdIZWxsbyB3b3JsZCcsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiAndGV4dCcsXG4gICAgICAgIHNlbnRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgcmVjaXBpZW50SWRzOiBbJ3VzZXItNDU2J10sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICBjYWxsID0+IGNhbGxbMF0gPT09ICdNZXNzYWdlU2VudEV2ZW50JyxcbiAgICAgIClbMV07XG5cbiAgICAgIC8vIFNob3VsZCBub3QgdGhyb3cgZXJyb3JcbiAgICAgIGF3YWl0IGV4cGVjdChoYW5kbGVyKG1lc3NhZ2VFdmVudCkpLnJlamVjdHMudG9UaHJvdygnV2ViU29ja2V0IGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtdWx0aXBsZSBldmVudHMgc2ltdWx0YW5lb3VzbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXJ2aWNlLm9uTW9kdWxlSW5pdCgpO1xuXG4gICAgICBjb25zdCBtZXNzYWdlRXZlbnQgPSBuZXcgTWVzc2FnZVNlbnRFdmVudCh7XG4gICAgICAgIG1lc3NhZ2VJZDogJ21zZy0xMjMnLFxuICAgICAgICBjb252ZXJzYXRpb25JZDogJ2NvbnYtMTIzJyxcbiAgICAgICAgc2VuZGVySWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIGNvbnRlbnQ6ICdIZWxsbyB3b3JsZCcsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiAndGV4dCcsXG4gICAgICAgIHNlbnRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgcmVjaXBpZW50SWRzOiBbJ3VzZXItNDU2J10sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgYXBwb2ludG1lbnRFdmVudCA9IG5ldyBBcHBvaW50bWVudEJvb2tlZEV2ZW50KHtcbiAgICAgICAgYXBwb2ludG1lbnRJZDogJ2FwcG9pbnRtZW50LTEyMycsXG4gICAgICAgIGNsaWVudElkOiAnY2xpZW50LTEyMycsXG4gICAgICAgIHRoZXJhcGlzdElkOiAndGhlcmFwaXN0LTEyMycsXG4gICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgdGl0bGU6ICdUaGVyYXB5IFNlc3Npb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1JlZ3VsYXIgdGhlcmFweSBzZXNzaW9uJyxcbiAgICAgICAgaXNJbml0aWFsQ29uc3VsdGF0aW9uOiBmYWxzZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtZXNzYWdlSGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICBjYWxsID0+IGNhbGxbMF0gPT09ICdNZXNzYWdlU2VudEV2ZW50JyxcbiAgICAgIClbMV07XG5cbiAgICAgIGNvbnN0IGFwcG9pbnRtZW50SGFuZGxlciA9IChldmVudEJ1c1NlcnZpY2Uuc3Vic2NyaWJlIGFzIGplc3QuTW9jaykubW9jay5jYWxscy5maW5kKFxuICAgICAgICBjYWxsID0+IGNhbGxbMF0gPT09ICdBcHBvaW50bWVudEJvb2tlZEV2ZW50JyxcbiAgICAgIClbMV07XG5cbiAgICAgIGNvbnN0IG1vY2tFbWl0ID0gamVzdC5mbigpO1xuICAgICAgbW9ja1NlcnZlci50by5tb2NrUmV0dXJuVmFsdWUoeyBlbWl0OiBtb2NrRW1pdCB9KTtcblxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBtZXNzYWdlSGFuZGxlcihtZXNzYWdlRXZlbnQpLFxuICAgICAgICBhcHBvaW50bWVudEhhbmRsZXIoYXBwb2ludG1lbnRFdmVudCksXG4gICAgICBdKTtcblxuICAgICAgZXhwZWN0KG1lc3NhZ2luZ0dhdGV3YXkuYnJvYWRjYXN0TWVzc2FnZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnbWVzc2FnZV9kZWxpdmVyZWQnLCBleHBlY3QuYW55KE9iamVjdCkpO1xuICAgICAgZXhwZWN0KG1vY2tFbWl0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYXBwb2ludG1lbnRfbm90aWZpY2F0aW9uJywgZXhwZWN0LmFueShPYmplY3QpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gcHJvcGVyIHJvb20gaXNvbGF0aW9uJywgKCkgPT4ge1xuICAgICAgc2VydmljZS5zdWJzY3JpYmVVc2VyVG9QZXJzb25hbFJvb20oJ3VzZXItMTIzJywgJ3NvY2tldC0xMjMnKTtcbiAgICAgIHNlcnZpY2Uuc3Vic2NyaWJlVXNlclRvQ29tbXVuaXR5Um9vbSgndXNlci0xMjMnLCAnY29tbXVuaXR5LTQ1NicsICdzb2NrZXQtMTIzJyk7XG4gICAgICBzZXJ2aWNlLnN1YnNjcmliZVVzZXJUb1Bvc3RSb29tKCd1c2VyLTEyMycsICdwb3N0LTc4OScsICdzb2NrZXQtMTIzJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrU29ja2V0LnNvY2tldHNKb2luKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcl91c2VyLTEyMycpO1xuICAgICAgZXhwZWN0KG1vY2tTb2NrZXQuc29ja2V0c0pvaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb21tdW5pdHlfY29tbXVuaXR5LTQ1NicpO1xuICAgICAgZXhwZWN0KG1vY2tTb2NrZXQuc29ja2V0c0pvaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwb3N0X3Bvc3QtNzg5Jyk7XG4gICAgICBleHBlY3QobW9ja1NvY2tldC5zb2NrZXRzSm9pbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==