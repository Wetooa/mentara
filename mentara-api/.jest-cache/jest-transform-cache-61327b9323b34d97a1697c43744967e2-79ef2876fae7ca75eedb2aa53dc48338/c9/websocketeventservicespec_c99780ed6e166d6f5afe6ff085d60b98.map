{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/services/websocket-event.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/services/websocket-event.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { WebSocketEventService } from './websocket-event.service';\nimport { EventBusService } from '../../common/events/event-bus.service';\nimport { MessagingGateway } from '../messaging.gateway';\nimport { Logger } from '@nestjs/common';\nimport {\n  MessageSentEvent,\n  MessageReadEvent,\n  ConversationCreatedEvent,\n  ParticipantJoinedEvent,\n  ParticipantLeftEvent,\n  TypingIndicatorEvent,\n} from '../../common/events/messaging-events';\nimport {\n  AppointmentBookedEvent,\n  AppointmentCancelledEvent,\n} from '../../common/events/booking-events';\nimport {\n  UserRegisteredEvent,\n  UserProfileUpdatedEvent,\n} from '../../common/events/user-events';\nimport {\n  PostCreatedEvent,\n  CommentAddedEvent,\n} from '../../common/events/social-events';\n\ndescribe('WebSocketEventService', () => {\n  let service: WebSocketEventService;\n  let eventBusService: jest.Mocked<EventBusService>;\n  let messagingGateway: jest.Mocked<MessagingGateway>;\n  let mockServer: any;\n  let mockSocket: any;\n\n  beforeEach(async () => {\n    // Mock socket.io server\n    mockSocket = {\n      socketsJoin: jest.fn(),\n      socketsLeave: jest.fn(),\n    };\n\n    mockServer = {\n      to: jest.fn(() => ({ emit: jest.fn() })),\n      in: jest.fn(() => mockSocket),\n      emit: jest.fn(),\n      sockets: {\n        sockets: new Map([\n          ['socket1', {}],\n          ['socket2', {}],\n          ['socket3', {}],\n        ]),\n      },\n    };\n\n    const mockEventBus = {\n      subscribe: jest.fn(),\n      emit: jest.fn(),\n      getEventStats: jest.fn(() => ({ totalListeners: 10 })),\n    };\n\n    const mockMessagingGateway = {\n      server: mockServer,\n      broadcastMessage: jest.fn(),\n      broadcastReadReceipt: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        WebSocketEventService,\n        {\n          provide: EventBusService,\n          useValue: mockEventBus,\n        },\n        {\n          provide: MessagingGateway,\n          useValue: mockMessagingGateway,\n        },\n      ],\n    }).compile();\n\n    service = module.get<WebSocketEventService>(WebSocketEventService);\n    eventBusService = module.get(EventBusService);\n    messagingGateway = module.get(MessagingGateway);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('onModuleInit', () => {\n    it('should initialize event subscriptions', async () => {\n      const loggerSpy = jest.spyOn(Logger.prototype, 'log');\n      \n      service.onModuleInit();\n\n      expect(eventBusService.subscribe).toHaveBeenCalledTimes(10); // All event types\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'WebSocket event handlers initialized successfully',\n      );\n    });\n\n    it('should subscribe to all event types', async () => {\n      service.onModuleInit();\n\n      const eventTypes = [\n        'MessageSentEvent',\n        'MessageReadEvent',\n        'ConversationCreatedEvent',\n        'ParticipantJoinedEvent',\n        'ParticipantLeftEvent',\n        'TypingIndicatorEvent',\n        'AppointmentBookedEvent',\n        'AppointmentCancelledEvent',\n        'UserRegisteredEvent',\n        'UserProfileUpdatedEvent',\n        'PostCreatedEvent',\n        'CommentAddedEvent',\n      ];\n\n      eventTypes.forEach(eventType => {\n        expect(eventBusService.subscribe).toHaveBeenCalledWith(\n          eventType,\n          expect.any(Function),\n        );\n      });\n    });\n  });\n\n  describe('Messaging Events', () => {\n    beforeEach(() => {\n      service.onModuleInit();\n    });\n\n    describe('MessageSentEvent', () => {\n      it('should broadcast message to conversation participants', async () => {\n        const messageEvent = new MessageSentEvent({\n          messageId: 'msg-123',\n          conversationId: 'conv-123',\n          senderId: 'user-123',\n          content: 'Hello world',\n          messageType: 'text',\n          sentAt: new Date(),\n          recipientIds: ['user-456', 'user-789'],\n        });\n\n        // Get the handler function\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'MessageSentEvent',\n        )[1];\n\n        await handler(messageEvent);\n\n        expect(messagingGateway.broadcastMessage).toHaveBeenCalledWith(\n          'conv-123',\n          {\n            id: 'msg-123',\n            conversationId: 'conv-123',\n            senderId: 'user-123',\n            content: 'Hello world',\n            messageType: 'text',\n            sentAt: messageEvent.eventData.sentAt,\n            eventType: 'message_sent',\n          },\n        );\n\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-456');\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-789');\n      });\n\n      it('should send delivery confirmations to recipients', async () => {\n        const messageEvent = new MessageSentEvent({\n          messageId: 'msg-123',\n          conversationId: 'conv-123',\n          senderId: 'user-123',\n          content: 'Hello world',\n          messageType: 'text',\n          sentAt: new Date(),\n          recipientIds: ['user-456'],\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'MessageSentEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(messageEvent);\n\n        expect(mockEmit).toHaveBeenCalledWith('message_delivered', {\n          messageId: 'msg-123',\n          conversationId: 'conv-123',\n          deliveredAt: expect.any(Date),\n          eventType: 'message_delivered',\n        });\n      });\n    });\n\n    describe('MessageReadEvent', () => {\n      it('should broadcast read receipt', async () => {\n        const readEvent = new MessageReadEvent({\n          messageId: 'msg-123',\n          conversationId: 'conv-123',\n          readBy: 'user-456',\n          readAt: new Date(),\n          messagesSinceLastRead: 1,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'MessageReadEvent',\n        )[1];\n\n        await handler(readEvent);\n\n        expect(messagingGateway.broadcastReadReceipt).toHaveBeenCalledWith(\n          'conv-123',\n          'msg-123',\n          'user-456',\n        );\n      });\n    });\n\n    describe('ConversationCreatedEvent', () => {\n      it('should notify all participants about new conversation', async () => {\n        const conversationEvent = new ConversationCreatedEvent({\n          conversationId: 'conv-123',\n          createdBy: 'user-123',\n          participantIds: ['user-123', 'user-456'],\n          conversationType: 'direct',\n          title: 'Test Conversation',\n          isPrivate: true,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'ConversationCreatedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(conversationEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-123');\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-456');\n        expect(mockEmit).toHaveBeenCalledWith('conversation_created', {\n          conversationId: 'conv-123',\n          createdBy: 'user-123',\n          conversationType: 'direct',\n          title: 'Test Conversation',\n          participantIds: ['user-123', 'user-456'],\n          eventType: 'conversation_created',\n          timestamp: expect.any(Date),\n        });\n      });\n    });\n\n    describe('ParticipantJoinedEvent', () => {\n      it('should notify conversation about new participant', async () => {\n        const joinEvent = new ParticipantJoinedEvent({\n          conversationId: 'conv-123',\n          participantId: 'user-789',\n          addedBy: 'user-123',\n          joinedAt: new Date(),\n          role: 'member',\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'ParticipantJoinedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(joinEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('conv-123');\n        expect(mockEmit).toHaveBeenCalledWith('participant_joined', {\n          conversationId: 'conv-123',\n          participantId: 'user-789',\n          addedBy: 'user-123',\n          joinedAt: joinEvent.eventData.joinedAt,\n          role: 'member',\n          eventType: 'participant_joined',\n        });\n      });\n    });\n\n    describe('ParticipantLeftEvent', () => {\n      it('should notify conversation about participant leaving', async () => {\n        const leftEvent = new ParticipantLeftEvent({\n          conversationId: 'conv-123',\n          participantId: 'user-789',\n          leftAt: new Date(),\n          leftReason: 'User left voluntarily',\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'ParticipantLeftEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(leftEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('conv-123');\n        expect(mockEmit).toHaveBeenCalledWith('participant_left', {\n          conversationId: 'conv-123',\n          participantId: 'user-789',\n          leftAt: leftEvent.eventData.leftAt,\n          leftReason: 'User left voluntarily',\n          eventType: 'participant_left',\n        });\n      });\n    });\n\n    describe('TypingIndicatorEvent', () => {\n      it('should relay typing indicator to conversation', async () => {\n        const typingEvent = new TypingIndicatorEvent({\n          conversationId: 'conv-123',\n          userId: 'user-456',\n          isTyping: true,\n          timestamp: new Date(),\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'TypingIndicatorEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(typingEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('conv-123');\n        expect(mockEmit).toHaveBeenCalledWith('typing_indicator', {\n          conversationId: 'conv-123',\n          userId: 'user-456',\n          isTyping: true,\n          timestamp: typingEvent.eventData.timestamp,\n          eventType: 'typing_indicator',\n        });\n      });\n    });\n  });\n\n  describe('Booking Events', () => {\n    beforeEach(() => {\n      service.onModuleInit();\n    });\n\n    describe('AppointmentBookedEvent', () => {\n      it('should notify both client and therapist about appointment booking', async () => {\n        const appointmentEvent = new AppointmentBookedEvent({\n          appointmentId: 'appointment-123',\n          clientId: 'client-123',\n          therapistId: 'therapist-123',\n          startTime: new Date(),\n          meetingType: 'video',\n          duration: 60,\n          title: 'Therapy Session',\n          description: 'Regular therapy session',\n          isInitialConsultation: false,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'AppointmentBookedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(appointmentEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('user_client-123');\n        expect(mockServer.to).toHaveBeenCalledWith('user_therapist-123');\n        expect(mockEmit).toHaveBeenCalledWith('appointment_notification', {\n          appointmentId: 'appointment-123',\n          clientId: 'client-123',\n          therapistId: 'therapist-123',\n          startTime: appointmentEvent.eventData.startTime,\n          meetingType: 'video',\n          isInitialConsultation: false,\n          eventType: 'appointment_booked',\n          timestamp: expect.any(Date),\n          message: expect.any(String),\n        });\n      });\n\n      it('should send different messages to client and therapist', async () => {\n        const appointmentEvent = new AppointmentBookedEvent({\n          appointmentId: 'appointment-123',\n          clientId: 'client-123',\n          therapistId: 'therapist-123',\n          startTime: new Date(),\n          meetingType: 'video',\n          duration: 60,\n          title: 'Therapy Session',\n          description: 'Regular therapy session',\n          isInitialConsultation: false,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'AppointmentBookedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(appointmentEvent);\n\n        expect(mockEmit).toHaveBeenCalledWith('appointment_notification', \n          expect.objectContaining({\n            message: 'Your appointment has been booked and is pending confirmation.',\n          })\n        );\n        expect(mockEmit).toHaveBeenCalledWith('appointment_notification', \n          expect.objectContaining({\n            message: 'You have a new appointment request that requires confirmation.',\n          })\n        );\n      });\n    });\n\n    describe('AppointmentCancelledEvent', () => {\n      it('should notify both parties about appointment cancellation', async () => {\n        const cancelEvent = new AppointmentCancelledEvent({\n          appointmentId: 'appointment-123',\n          clientId: 'client-123',\n          therapistId: 'therapist-123',\n          cancelledBy: 'client-123',\n          cancellationReason: 'Personal emergency',\n          originalStartTime: new Date(),\n          cancelledAt: new Date(),\n          cancellationNotice: 24,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'AppointmentCancelledEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(cancelEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('user_client-123');\n        expect(mockServer.to).toHaveBeenCalledWith('user_therapist-123');\n        expect(mockEmit).toHaveBeenCalledWith('appointment_notification', {\n          appointmentId: 'appointment-123',\n          clientId: 'client-123',\n          therapistId: 'therapist-123',\n          cancelledBy: 'client-123',\n          cancellationReason: 'Personal emergency',\n          cancelledAt: cancelEvent.eventData.cancelledAt,\n          eventType: 'appointment_cancelled',\n          timestamp: expect.any(Date),\n          message: expect.any(String),\n        });\n      });\n\n      it('should send different messages based on who cancelled', async () => {\n        const cancelEvent = new AppointmentCancelledEvent({\n          appointmentId: 'appointment-123',\n          clientId: 'client-123',\n          therapistId: 'therapist-123',\n          cancelledBy: 'therapist-123',\n          cancellationReason: 'Schedule conflict',\n          originalStartTime: new Date(),\n          cancelledAt: new Date(),\n          cancellationNotice: 24,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'AppointmentCancelledEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(cancelEvent);\n\n        expect(mockEmit).toHaveBeenCalledWith('appointment_notification', \n          expect.objectContaining({\n            message: 'Your appointment has been cancelled by the therapist.',\n          })\n        );\n        expect(mockEmit).toHaveBeenCalledWith('appointment_notification', \n          expect.objectContaining({\n            message: 'You have cancelled the appointment.',\n          })\n        );\n      });\n    });\n  });\n\n  describe('User Events', () => {\n    beforeEach(() => {\n      service.onModuleInit();\n    });\n\n    describe('UserRegisteredEvent', () => {\n      it('should send welcome notification to new user', async () => {\n        const registrationEvent = new UserRegisteredEvent({\n          userId: 'user-123',\n          email: 'user@example.com',\n          firstName: 'John',\n          lastName: 'Doe',\n          role: 'client',\n          registrationMethod: 'email',\n          isVerified: true,\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'UserRegisteredEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(registrationEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-123');\n        expect(mockEmit).toHaveBeenCalledWith('welcome_notification', {\n          userId: 'user-123',\n          firstName: 'John',\n          lastName: 'Doe',\n          role: 'client',\n          eventType: 'user_registered',\n          message: 'Welcome to Mentara, John! Your account has been successfully created.',\n          timestamp: expect.any(Date),\n        });\n      });\n    });\n\n    describe('UserProfileUpdatedEvent', () => {\n      it('should broadcast profile update to all connections', async () => {\n        const profileEvent = new UserProfileUpdatedEvent({\n          userId: 'user-123',\n          updatedFields: ['firstName', 'lastName'],\n          newValues: { firstName: 'Jane', lastName: 'Smith' },\n          previousValues: { firstName: 'John', lastName: 'Doe' },\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'UserProfileUpdatedEvent',\n        )[1];\n\n        await handler(profileEvent);\n\n        expect(mockServer.emit).toHaveBeenCalledWith('user_profile_updated', {\n          userId: 'user-123',\n          updatedFields: ['firstName', 'lastName'],\n          profileData: { firstName: 'Jane', lastName: 'Smith' },\n          eventType: 'user_profile_updated',\n          timestamp: expect.any(Date),\n        });\n      });\n    });\n  });\n\n  describe('Social Events', () => {\n    beforeEach(() => {\n      service.onModuleInit();\n    });\n\n    describe('PostCreatedEvent', () => {\n      it('should broadcast new post to community room', async () => {\n        const postEvent = new PostCreatedEvent({\n          postId: 'post-123',\n          authorId: 'user-123',\n          communityId: 'community-123',\n          title: 'New Post',\n          content: 'This is a new post',\n          tags: ['mental-health', 'support'],\n          postType: 'discussion',\n          isAnonymous: false,\n          timestamp: new Date(),\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'PostCreatedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(postEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('community_community-123');\n        expect(mockEmit).toHaveBeenCalledWith('new_post', {\n          postId: 'post-123',\n          authorId: 'user-123',\n          communityId: 'community-123',\n          title: 'New Post',\n          content: 'This is a new post',\n          tags: ['mental-health', 'support'],\n          postType: 'discussion',\n          isAnonymous: false,\n          eventType: 'post_created',\n          timestamp: expect.any(Date),\n        });\n      });\n\n      it('should hide author ID for anonymous posts', async () => {\n        const postEvent = new PostCreatedEvent({\n          postId: 'post-123',\n          authorId: 'user-123',\n          communityId: 'community-123',\n          title: 'Anonymous Post',\n          content: 'This is an anonymous post',\n          tags: ['support'],\n          postType: 'discussion',\n          isAnonymous: true,\n          timestamp: new Date(),\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'PostCreatedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(postEvent);\n\n        expect(mockEmit).toHaveBeenCalledWith('new_post', \n          expect.objectContaining({\n            authorId: null,\n            isAnonymous: true,\n          })\n        );\n      });\n\n      it('should not broadcast if no communityId', async () => {\n        const postEvent = new PostCreatedEvent({\n          postId: 'post-123',\n          authorId: 'user-123',\n          communityId: null,\n          title: 'Private Post',\n          content: 'This is a private post',\n          tags: [],\n          postType: 'discussion',\n          isAnonymous: false,\n          timestamp: new Date(),\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'PostCreatedEvent',\n        )[1];\n\n        await handler(postEvent);\n\n        expect(mockServer.to).not.toHaveBeenCalled();\n      });\n    });\n\n    describe('CommentAddedEvent', () => {\n      it('should broadcast comment to post room', async () => {\n        const commentEvent = new CommentAddedEvent({\n          commentId: 'comment-123',\n          postId: 'post-123',\n          authorId: 'user-456',\n          content: 'Great post!',\n          parentCommentId: null,\n          isAnonymous: false,\n          timestamp: new Date(),\n        });\n\n        const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n          call => call[0] === 'CommentAddedEvent',\n        )[1];\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        await handler(commentEvent);\n\n        expect(mockServer.to).toHaveBeenCalledWith('post_post-123');\n        expect(mockEmit).toHaveBeenCalledWith('post_interaction', {\n          commentId: 'comment-123',\n          postId: 'post-123',\n          authorId: 'user-456',\n          content: 'Great post!',\n          interactionType: 'comment',\n          eventType: 'comment_created',\n          message: 'Someone commented on your post',\n          timestamp: expect.any(Date),\n        });\n        expect(mockEmit).toHaveBeenCalledWith('new_comment', {\n          commentId: 'comment-123',\n          postId: 'post-123',\n          authorId: 'user-456',\n          content: 'Great post!',\n          eventType: 'comment_created',\n          timestamp: expect.any(Date),\n        });\n      });\n    });\n  });\n\n  describe('Room Management', () => {\n    describe('subscribeUserToPersonalRoom', () => {\n      it('should subscribe user to personal room', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'debug');\n        \n        service.subscribeUserToPersonalRoom('user-123', 'socket-123');\n\n        expect(mockServer.in).toHaveBeenCalledWith('socket-123');\n        expect(mockSocket.socketsJoin).toHaveBeenCalledWith('user_user-123');\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'User user-123 subscribed to personal room: user_user-123',\n        );\n      });\n    });\n\n    describe('unsubscribeUserFromPersonalRoom', () => {\n      it('should unsubscribe user from personal room', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'debug');\n        \n        service.unsubscribeUserFromPersonalRoom('user-123', 'socket-123');\n\n        expect(mockServer.in).toHaveBeenCalledWith('socket-123');\n        expect(mockSocket.socketsLeave).toHaveBeenCalledWith('user_user-123');\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'User user-123 unsubscribed from personal room: user_user-123',\n        );\n      });\n    });\n\n    describe('subscribeUserToCommunityRoom', () => {\n      it('should subscribe user to community room', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'debug');\n        \n        service.subscribeUserToCommunityRoom('user-123', 'community-456', 'socket-123');\n\n        expect(mockServer.in).toHaveBeenCalledWith('socket-123');\n        expect(mockSocket.socketsJoin).toHaveBeenCalledWith('community_community-456');\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'User user-123 subscribed to community room: community_community-456',\n        );\n      });\n    });\n\n    describe('subscribeUserToPostRoom', () => {\n      it('should subscribe user to post room', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'debug');\n        \n        service.subscribeUserToPostRoom('user-123', 'post-456', 'socket-123');\n\n        expect(mockServer.in).toHaveBeenCalledWith('socket-123');\n        expect(mockSocket.socketsJoin).toHaveBeenCalledWith('post_post-456');\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'User user-123 subscribed to post room: post_post-456',\n        );\n      });\n    });\n  });\n\n  describe('Utility Methods', () => {\n    describe('getConnectionStats', () => {\n      it('should return connection statistics', () => {\n        const stats = service.getConnectionStats();\n\n        expect(stats).toEqual({\n          totalConnections: 3,\n          eventSubscriptions: 10,\n        });\n      });\n    });\n\n    describe('broadcastSystemAnnouncement', () => {\n      it('should broadcast system announcement with default priority', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'log');\n        \n        service.broadcastSystemAnnouncement('System maintenance scheduled');\n\n        expect(mockServer.emit).toHaveBeenCalledWith('system_announcement', {\n          message: 'System maintenance scheduled',\n          priority: 'medium',\n          eventType: 'system_announcement',\n          timestamp: expect.any(Date),\n        });\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'Broadcasted system announcement: System maintenance scheduled (priority: medium)',\n        );\n      });\n\n      it('should broadcast system announcement with custom priority', () => {\n        service.broadcastSystemAnnouncement('Critical security update', 'high');\n\n        expect(mockServer.emit).toHaveBeenCalledWith('system_announcement', {\n          message: 'Critical security update',\n          priority: 'high',\n          eventType: 'system_announcement',\n          timestamp: expect.any(Date),\n        });\n      });\n    });\n\n    describe('sendTargetedNotification', () => {\n      it('should send notification to specific users', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'debug');\n        const userIds = ['user-123', 'user-456'];\n        const notification = {\n          title: 'Important Update',\n          message: 'Please check your settings',\n          priority: 'high',\n        };\n\n        const mockEmit = jest.fn();\n        mockServer.to.mockReturnValue({ emit: mockEmit });\n\n        service.sendTargetedNotification(userIds, notification);\n\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-123');\n        expect(mockServer.to).toHaveBeenCalledWith('user_user-456');\n        expect(mockEmit).toHaveBeenCalledWith('targeted_notification', {\n          title: 'Important Update',\n          message: 'Please check your settings',\n          priority: 'high',\n          eventType: 'targeted_notification',\n          timestamp: expect.any(Date),\n        });\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'Sent targeted notification to 2 users',\n        );\n      });\n\n      it('should handle empty user list', () => {\n        const loggerSpy = jest.spyOn(Logger.prototype, 'debug');\n        \n        service.sendTargetedNotification([], { message: 'test' });\n\n        expect(mockServer.to).not.toHaveBeenCalled();\n        expect(loggerSpy).toHaveBeenCalledWith(\n          'Sent targeted notification to 0 users',\n        );\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle event handler errors gracefully', async () => {\n      const loggerSpy = jest.spyOn(Logger.prototype, 'error');\n      \n      // Mock broadcastMessage to throw an error\n      messagingGateway.broadcastMessage.mockImplementation(() => {\n        throw new Error('WebSocket connection failed');\n      });\n\n      service.onModuleInit();\n\n      const messageEvent = new MessageSentEvent({\n        messageId: 'msg-123',\n        conversationId: 'conv-123',\n        senderId: 'user-123',\n        content: 'Hello world',\n        messageType: 'text',\n        sentAt: new Date(),\n        recipientIds: ['user-456'],\n      });\n\n      const handler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n        call => call[0] === 'MessageSentEvent',\n      )[1];\n\n      // Should not throw error\n      await expect(handler(messageEvent)).rejects.toThrow('WebSocket connection failed');\n    });\n  });\n\n  describe('Integration Tests', () => {\n    it('should handle multiple events simultaneously', async () => {\n      service.onModuleInit();\n\n      const messageEvent = new MessageSentEvent({\n        messageId: 'msg-123',\n        conversationId: 'conv-123',\n        senderId: 'user-123',\n        content: 'Hello world',\n        messageType: 'text',\n        sentAt: new Date(),\n        recipientIds: ['user-456'],\n      });\n\n      const appointmentEvent = new AppointmentBookedEvent({\n        appointmentId: 'appointment-123',\n        clientId: 'client-123',\n        therapistId: 'therapist-123',\n        startTime: new Date(),\n        meetingType: 'video',\n        duration: 60,\n        title: 'Therapy Session',\n        description: 'Regular therapy session',\n        isInitialConsultation: false,\n      });\n\n      const messageHandler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n        call => call[0] === 'MessageSentEvent',\n      )[1];\n\n      const appointmentHandler = (eventBusService.subscribe as jest.Mock).mock.calls.find(\n        call => call[0] === 'AppointmentBookedEvent',\n      )[1];\n\n      const mockEmit = jest.fn();\n      mockServer.to.mockReturnValue({ emit: mockEmit });\n\n      await Promise.all([\n        messageHandler(messageEvent),\n        appointmentHandler(appointmentEvent),\n      ]);\n\n      expect(messagingGateway.broadcastMessage).toHaveBeenCalled();\n      expect(mockEmit).toHaveBeenCalledWith('message_delivered', expect.any(Object));\n      expect(mockEmit).toHaveBeenCalledWith('appointment_notification', expect.any(Object));\n    });\n\n    it('should maintain proper room isolation', () => {\n      service.subscribeUserToPersonalRoom('user-123', 'socket-123');\n      service.subscribeUserToCommunityRoom('user-123', 'community-456', 'socket-123');\n      service.subscribeUserToPostRoom('user-123', 'post-789', 'socket-123');\n\n      expect(mockSocket.socketsJoin).toHaveBeenCalledWith('user_user-123');\n      expect(mockSocket.socketsJoin).toHaveBeenCalledWith('community_community-456');\n      expect(mockSocket.socketsJoin).toHaveBeenCalledWith('post_post-789');\n      expect(mockSocket.socketsJoin).toHaveBeenCalledTimes(3);\n    });\n  });\n});"],"version":3}