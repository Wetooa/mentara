{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/community-matching.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/community-matching.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { Logger } from '@nestjs/common';\nimport { CommunityMatchingService } from './community-matching.service';\nimport { PrismaService } from '../../providers/prisma-client.provider';\n\ndescribe('CommunityMatchingService', () => {\n  let service: CommunityMatchingService;\n  let prismaService: jest.Mocked<PrismaService>;\n  let loggerSpy: jest.SpyInstance;\n\n  // Mock data\n  const mockCommunity = {\n    id: 'community-123',\n    name: 'Depression Support Network',\n    slug: 'depression-support',\n    description: 'A supportive community for depression',\n    imageUrl: 'image.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockAnxietyCommunity = {\n    id: 'community-456',\n    name: 'Anxiety Warriors',\n    slug: 'anxiety-warriors',\n    description: 'A supportive community for anxiety',\n    imageUrl: 'anxiety.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockPTSDCommunity = {\n    id: 'community-789',\n    name: 'PTSD Support Network',\n    slug: 'ptsd-support',\n    description: 'A supportive community for PTSD',\n    imageUrl: 'ptsd.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockGeneralCommunity = {\n    id: 'community-general',\n    name: 'General Support',\n    slug: 'general-support',\n    description: 'General mental health support',\n    imageUrl: 'general.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockPreAssessment = {\n    id: 'assessment-123',\n    clientId: 'user-123',\n    questionnaires: ['phq-9', 'gad-7', 'ptsd-5'],\n    answers: [[1, 2, 3], [4, 5, 6], [7, 8, 9]],\n    answerMatrix: [[1, 2, 3], [4, 5, 6], [7, 8, 9]],\n    scores: {\n      phq9Score: 15, // Moderately severe depression\n      gad7Score: 12, // Moderate anxiety\n      ptsd5Score: 8, // Moderate PTSD\n    },\n    severityLevels: {\n      phq9: 'moderately severe',\n      gad7: 'moderate',\n      ptsd5: 'moderate',\n    },\n    aiEstimate: { hasDepression: true, hasAnxiety: true },\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockUserAssessmentProfile = {\n    userId: 'user-123',\n    assessments: {\n      phq9: {\n        score: 15,\n        severity: 'moderately severe',\n        date: new Date('2024-01-01'),\n      },\n      gad7: {\n        score: 12,\n        severity: 'moderate',\n        date: new Date('2024-01-01'),\n      },\n      ptsd5: {\n        score: 8,\n        severity: 'moderate',\n        date: new Date('2024-01-01'),\n      },\n    },\n  };\n\n  beforeEach(async () => {\n    const mockPrismaService = {\n      community: {\n        findUnique: jest.fn(),\n        findMany: jest.fn(),\n      },\n      preAssessment: {\n        findUnique: jest.fn(),\n        findFirst: jest.fn(),\n      },\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        CommunityMatchingService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n      ],\n    }).compile();\n\n    service = module.get<CommunityMatchingService>(CommunityMatchingService);\n    prismaService = module.get(PrismaService);\n\n    // Setup logger spies\n    loggerSpy = jest.spyOn(Logger.prototype, 'log').mockImplementation();\n    jest.spyOn(Logger.prototype, 'warn').mockImplementation();\n    jest.spyOn(Logger.prototype, 'error').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('calculateCompatibilityScore', () => {\n    beforeEach(() => {\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n    });\n\n    it('should calculate high compatibility score for matching conditions', async () => {\n      const result = await service.calculateCompatibilityScore(\n        mockUserAssessmentProfile,\n        'depression-support'\n      );\n\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'depression-support' },\n        select: { id: true, name: true, slug: true },\n      });\n\n      expect(result).toEqual({\n        communityId: 'community-123',\n        communitySlug: 'depression-support',\n        compatibilityScore: expect.any(Number),\n        reasoning: expect.stringContaining('Depression Support Network'),\n        matchingFactors: expect.arrayContaining(['PHQ9 (moderately severe)']),\n        assessmentContributions: expect.objectContaining({\n          phq9: expect.objectContaining({\n            score: 15,\n            weight: 0.8,\n            contribution: expect.any(Number),\n          }),\n        }),\n      });\n\n      expect(result.compatibilityScore).toBeGreaterThan(0.7); // High compatibility\n    });\n\n    it('should calculate moderate compatibility for general communities', async () => {\n      prismaService.community.findUnique.mockResolvedValue(mockGeneralCommunity);\n\n      const result = await service.calculateCompatibilityScore(\n        mockUserAssessmentProfile,\n        'general-support'\n      );\n\n      expect(result.compatibilityScore).toBeLessThan(0.9); // Should be lower due to general community penalty\n      expect(result.communitySlug).toBe('general-support');\n    });\n\n    it('should throw error for non-existent community', async () => {\n      prismaService.community.findUnique.mockResolvedValue(null);\n\n      await expect(\n        service.calculateCompatibilityScore(mockUserAssessmentProfile, 'non-existent-community')\n      ).rejects.toThrow('Community not found: non-existent-community');\n    });\n\n    it('should return zero compatibility when no assessments match', async () => {\n      const noMatchProfile = {\n        userId: 'user-123',\n        assessments: {\n          unknownAssessment: {\n            score: 15,\n            severity: 'moderate',\n            date: new Date('2024-01-01'),\n          },\n        },\n      };\n\n      const result = await service.calculateCompatibilityScore(\n        noMatchProfile,\n        'depression-support'\n      );\n\n      expect(result.compatibilityScore).toBe(0);\n      expect(result.matchingFactors).toEqual([]);\n    });\n\n    it('should apply specificity bonus for targeted communities', async () => {\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n\n      const result = await service.calculateCompatibilityScore(\n        mockUserAssessmentProfile,\n        'depression-support'\n      );\n\n      // Depression-support is a specific community for PHQ-9, should get bonus\n      expect(result.compatibilityScore).toBeGreaterThan(0.7);\n    });\n\n    it('should apply general community penalty', async () => {\n      prismaService.community.findUnique.mockResolvedValue(mockGeneralCommunity);\n\n      const result = await service.calculateCompatibilityScore(\n        mockUserAssessmentProfile,\n        'general-support'\n      );\n\n      // General communities get penalty\n      expect(result.assessmentContributions.phq9.contribution).toBeLessThan(\n        0.8 * 1.0 * 0.8 // weight * severity * full specificity\n      );\n    });\n\n    it('should handle multiple assessment contributions correctly', async () => {\n      prismaService.community.findUnique.mockResolvedValue(mockAnxietyCommunity);\n\n      const multiAssessmentProfile = {\n        userId: 'user-123',\n        assessments: {\n          gad7: {\n            score: 15,\n            severity: 'severe',\n            date: new Date('2024-01-01'),\n          },\n          phq9: {\n            score: 10,\n            severity: 'moderate',\n            date: new Date('2024-01-01'),\n          },\n        },\n      };\n\n      const result = await service.calculateCompatibilityScore(\n        multiAssessmentProfile,\n        'anxiety-warriors'\n      );\n\n      expect(result.matchingFactors).toContain('GAD7 (severe)');\n      expect(result.assessmentContributions).toHaveProperty('gad7');\n      expect(result.assessmentContributions.gad7.score).toBe(15);\n    });\n  });\n\n  describe('getSeverityMultiplier', () => {\n    it('should return correct multipliers for PHQ-9 scores', () => {\n      const getSeverityMultiplier = (service as any).getSeverityMultiplier.bind(service);\n\n      expect(getSeverityMultiplier('phq9', 2)).toBe(0.3); // Minimal\n      expect(getSeverityMultiplier('phq9', 7)).toBe(0.6); // Mild\n      expect(getSeverityMultiplier('phq9', 12)).toBe(0.9); // Moderate\n      expect(getSeverityMultiplier('phq9', 17)).toBe(1.0); // Moderately severe\n      expect(getSeverityMultiplier('phq9', 25)).toBe(1.0); // Severe\n    });\n\n    it('should return correct multipliers for GAD-7 scores', () => {\n      const getSeverityMultiplier = (service as any).getSeverityMultiplier.bind(service);\n\n      expect(getSeverityMultiplier('gad7', 3)).toBe(0.3); // Minimal\n      expect(getSeverityMultiplier('gad7', 8)).toBe(0.6); // Mild\n      expect(getSeverityMultiplier('gad7', 13)).toBe(0.9); // Moderate\n      expect(getSeverityMultiplier('gad7', 18)).toBe(1.0); // Severe\n    });\n\n    it('should return correct multipliers for PTSD-5 scores', () => {\n      const getSeverityMultiplier = (service as any).getSeverityMultiplier.bind(service);\n\n      expect(getSeverityMultiplier('ptsd5', 1)).toBe(0.3); // Minimal\n      expect(getSeverityMultiplier('ptsd5', 5)).toBe(0.6); // Mild\n      expect(getSeverityMultiplier('ptsd5', 12)).toBe(0.9); // Moderate\n      expect(getSeverityMultiplier('ptsd5', 18)).toBe(1.0); // Severe\n    });\n\n    it('should return default multiplier for unknown assessment types', () => {\n      const getSeverityMultiplier = (service as any).getSeverityMultiplier.bind(service);\n\n      expect(getSeverityMultiplier('unknown-assessment', 15)).toBe(0.5);\n    });\n  });\n\n  describe('getCommunitySpecificityBonus', () => {\n    it('should return bonus for specific community matches', () => {\n      const getCommunitySpecificityBonus = (service as any).getCommunitySpecificityBonus.bind(service);\n\n      expect(getCommunitySpecificityBonus('depression-support', 'phq9')).toBe(1.2);\n      expect(getCommunitySpecificityBonus('anxiety-support', 'gad7')).toBe(1.2);\n      expect(getCommunitySpecificityBonus('ptsd-support', 'ptsd5')).toBe(1.2);\n      expect(getCommunitySpecificityBonus('trauma-recovery', 'ptsd5')).toBe(1.2);\n      expect(getCommunitySpecificityBonus('panic-disorder', 'gad7')).toBe(1.2);\n      expect(getCommunitySpecificityBonus('social-anxiety', 'gad7')).toBe(1.2);\n    });\n\n    it('should return penalty for general communities', () => {\n      const getCommunitySpecificityBonus = (service as any).getCommunitySpecificityBonus.bind(service);\n\n      expect(getCommunitySpecificityBonus('general-support', 'phq9')).toBe(0.8);\n      expect(getCommunitySpecificityBonus('mental-wellness', 'gad7')).toBe(0.8);\n      expect(getCommunitySpecificityBonus('therapy-discussion', 'ptsd5')).toBe(0.8);\n    });\n\n    it('should return neutral multiplier for other communities', () => {\n      const getCommunitySpecificityBonus = (service as any).getCommunitySpecificityBonus.bind(service);\n\n      expect(getCommunitySpecificityBonus('other-community', 'phq9')).toBe(1.0);\n    });\n  });\n\n  describe('generateReasoningText', () => {\n    it('should generate appropriate text for high compatibility', () => {\n      const generateReasoningText = (service as any).generateReasoningText.bind(service);\n\n      const reasoning = generateReasoningText(\n        'Depression Support Network',\n        ['PHQ9 (moderately severe)'],\n        0.85,\n        { phq9: { score: 15, weight: 0.8, contribution: 0.68 } }\n      );\n\n      expect(reasoning).toContain('85% compatibility');\n      expect(reasoning).toContain('Depression Support Network');\n      expect(reasoning).toContain('PHQ9 (moderately severe)');\n      expect(reasoning).toContain('excellent match');\n    });\n\n    it('should generate appropriate text for moderate compatibility', () => {\n      const generateReasoningText = (service as any).generateReasoningText.bind(service);\n\n      const reasoning = generateReasoningText(\n        'General Support',\n        ['PHQ9 (mild)'],\n        0.65,\n        { phq9: { score: 8, weight: 0.8, contribution: 0.52 } }\n      );\n\n      expect(reasoning).toContain('65% compatibility');\n      expect(reasoning).toContain('good fit');\n    });\n\n    it('should generate appropriate text for low compatibility', () => {\n      const generateReasoningText = (service as any).generateReasoningText.bind(service);\n\n      const reasoning = generateReasoningText(\n        'Specific Community',\n        ['GAD7 (minimal)'],\n        0.35,\n        { gad7: { score: 3, weight: 0.7, contribution: 0.21 } }\n      );\n\n      expect(reasoning).toContain('35% compatibility');\n      expect(reasoning).toContain('some relevant support');\n    });\n\n    it('should generate appropriate text for very low compatibility', () => {\n      const generateReasoningText = (service as any).generateReasoningText.bind(service);\n\n      const reasoning = generateReasoningText(\n        'Unrelated Community',\n        [],\n        0.15,\n        {}\n      );\n\n      expect(reasoning).toContain('15% compatibility');\n      expect(reasoning).toContain('other communities that are more specifically aligned');\n    });\n\n    it('should handle empty matching factors', () => {\n      const generateReasoningText = (service as any).generateReasoningText.bind(service);\n\n      const reasoning = generateReasoningText(\n        'Community Name',\n        [],\n        0.5,\n        {}\n      );\n\n      expect(reasoning).not.toContain('This recommendation is based on your');\n      expect(reasoning).toContain('50% compatibility');\n    });\n  });\n\n  describe('getRecommendationsForUser', () => {\n    beforeEach(() => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findMany.mockResolvedValue([\n        { slug: 'depression-support', name: 'Depression Support Network' },\n        { slug: 'anxiety-warriors', name: 'Anxiety Warriors' },\n        { slug: 'ptsd-support', name: 'PTSD Support Network' },\n        { slug: 'general-support', name: 'General Support' },\n      ]);\n      prismaService.community.findUnique.mockImplementation((args) => {\n        const slug = args.where.slug;\n        if (slug === 'depression-support') return Promise.resolve(mockCommunity);\n        if (slug === 'anxiety-warriors') return Promise.resolve(mockAnxietyCommunity);\n        if (slug === 'ptsd-support') return Promise.resolve(mockPTSDCommunity);\n        if (slug === 'general-support') return Promise.resolve(mockGeneralCommunity);\n        return Promise.resolve(null);\n      });\n    });\n\n    it('should return sorted recommendations for user', async () => {\n      const result = await service.getRecommendationsForUser('user-123');\n\n      expect(prismaService.preAssessment.findUnique).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n        select: {\n          scores: true,\n          severityLevels: true,\n          createdAt: true,\n        },\n      });\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        select: { slug: true, name: true },\n      });\n\n      expect(result).toBeInstanceOf(Array);\n      expect(result.length).toBeGreaterThan(0);\n\n      // Should be sorted by compatibility score (highest first)\n      for (let i = 1; i < result.length; i++) {\n        expect(result[i-1].compatibilityScore).toBeGreaterThanOrEqual(result[i].compatibilityScore);\n      }\n\n      // Should only include communities with >20% compatibility\n      result.forEach(recommendation => {\n        expect(recommendation.compatibilityScore).toBeGreaterThan(0.2);\n      });\n    });\n\n    it('should return empty array when no assessment data exists', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(null);\n\n      const result = await service.getRecommendationsForUser('user-123');\n\n      expect(result).toEqual([]);\n      expect(loggerSpy).toHaveBeenCalledWith(\n        expect.stringContaining('No assessment data found for user user-123')\n      );\n    });\n\n    it('should return empty array when assessment has no scores', async () => {\n      const emptyAssessment = {\n        ...mockPreAssessment,\n        scores: {},\n        severityLevels: {},\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(emptyAssessment);\n\n      const result = await service.getRecommendationsForUser('user-123');\n\n      expect(result).toEqual([]);\n      expect(loggerSpy).toHaveBeenCalledWith(\n        expect.stringContaining('No assessment data found for user user-123')\n      );\n    });\n\n    it('should filter out low compatibility recommendations', async () => {\n      // Mock very low scores that would result in low compatibility\n      const lowScoreAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          phq9Score: 1, // Minimal depression\n          gad7Score: 1, // Minimal anxiety\n        },\n        severityLevels: {\n          phq9: 'minimal',\n          gad7: 'minimal',\n        },\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(lowScoreAssessment);\n\n      const result = await service.getRecommendationsForUser('user-123');\n\n      // Should filter out recommendations with <20% compatibility\n      result.forEach(recommendation => {\n        expect(recommendation.compatibilityScore).toBeGreaterThan(0.2);\n      });\n    });\n\n    it('should limit results to top 10 recommendations', async () => {\n      // Mock many communities\n      const manyCommunities = Array.from({ length: 15 }, (_, i) => ({\n        slug: `community-${i}`,\n        name: `Community ${i}`,\n      }));\n      prismaService.community.findMany.mockResolvedValue(manyCommunities);\n      \n      // Mock all communities as found\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n\n      const result = await service.getRecommendationsForUser('user-123');\n\n      expect(result.length).toBeLessThanOrEqual(10);\n    });\n\n    it('should handle errors for individual community calculations gracefully', async () => {\n      prismaService.community.findUnique.mockImplementation((args) => {\n        if (args.where.slug === 'depression-support') return Promise.resolve(mockCommunity);\n        if (args.where.slug === 'anxiety-warriors') return Promise.reject(new Error('Database error'));\n        return Promise.resolve(mockGeneralCommunity);\n      });\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      const result = await service.getRecommendationsForUser('user-123');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error calculating compatibility for anxiety-warriors'),\n        expect.any(Error)\n      );\n\n      // Should still return other successful recommendations\n      expect(result.length).toBeGreaterThan(0);\n    });\n\n    it('should handle database errors during user profile retrieval', async () => {\n      prismaService.preAssessment.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      await expect(service.getRecommendationsForUser('user-123')).rejects.toThrow('Database error');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting recommendations for user user-123'),\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('getUserAssessmentProfile', () => {\n    beforeEach(() => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(mockPreAssessment);\n    });\n\n    it('should map PHQ-9 scores correctly', async () => {\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result).toEqual({\n        userId: 'user-123',\n        assessments: expect.objectContaining({\n          phq9: expect.objectContaining({\n            score: 15,\n            severity: 'moderately severe',\n            date: expect.any(Date),\n          }),\n        }),\n      });\n    });\n\n    it('should map GAD-7 scores correctly', async () => {\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result.assessments).toHaveProperty('gad7');\n      expect(result.assessments.gad7.score).toBe(12);\n      expect(result.assessments.gad7.severity).toBe('moderate');\n    });\n\n    it('should map PTSD-5 scores correctly', async () => {\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result.assessments).toHaveProperty('ptsd5');\n      expect(result.assessments.ptsd5.score).toBe(8);\n      expect(result.assessments.ptsd5.severity).toBe('moderate');\n    });\n\n    it('should return null when no pre-assessment exists', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(null);\n\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result).toBeNull();\n    });\n\n    it('should handle missing score fields gracefully', async () => {\n      const incompleteAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          phq9Score: 15,\n          // Missing gad7Score and ptsd5Score\n        },\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(incompleteAssessment);\n\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result.assessments).toHaveProperty('phq9');\n      expect(result.assessments).not.toHaveProperty('gad7');\n      expect(result.assessments).not.toHaveProperty('ptsd5');\n    });\n\n    it('should handle null/undefined scores', async () => {\n      const nullScoresAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          phq9Score: null,\n          gad7Score: undefined,\n          ptsd5Score: 0, // Valid zero score\n        },\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(nullScoresAssessment);\n\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result.assessments).not.toHaveProperty('phq9');\n      expect(result.assessments).not.toHaveProperty('gad7');\n      expect(result.assessments).toHaveProperty('ptsd5'); // Zero is valid\n    });\n\n    it('should handle database errors', async () => {\n      prismaService.preAssessment.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result).toBeNull();\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting assessment profile for user user-123'),\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('severity assessment helpers', () => {\n    describe('getDepressionSeverity', () => {\n      it('should return correct severity levels for PHQ-9 scores', () => {\n        const getDepressionSeverity = (service as any).getDepressionSeverity.bind(service);\n\n        expect(getDepressionSeverity(2)).toBe('minimal');\n        expect(getDepressionSeverity(4)).toBe('minimal');\n        expect(getDepressionSeverity(7)).toBe('mild');\n        expect(getDepressionSeverity(9)).toBe('mild');\n        expect(getDepressionSeverity(12)).toBe('moderate');\n        expect(getDepressionSeverity(14)).toBe('moderate');\n        expect(getDepressionSeverity(17)).toBe('moderately severe');\n        expect(getDepressionSeverity(19)).toBe('moderately severe');\n        expect(getDepressionSeverity(25)).toBe('severe');\n      });\n    });\n\n    describe('getAnxietySeverity', () => {\n      it('should return correct severity levels for GAD-7 scores', () => {\n        const getAnxietySeverity = (service as any).getAnxietySeverity.bind(service);\n\n        expect(getAnxietySeverity(3)).toBe('minimal');\n        expect(getAnxietySeverity(4)).toBe('minimal');\n        expect(getAnxietySeverity(7)).toBe('mild');\n        expect(getAnxietySeverity(9)).toBe('mild');\n        expect(getAnxietySeverity(12)).toBe('moderate');\n        expect(getAnxietySeverity(14)).toBe('moderate');\n        expect(getAnxietySeverity(18)).toBe('severe');\n        expect(getAnxietySeverity(21)).toBe('severe');\n      });\n    });\n\n    describe('getPTSDSeverity', () => {\n      it('should return correct severity levels for PTSD-5 scores', () => {\n        const getPTSDSeverity = (service as any).getPTSDSeverity.bind(service);\n\n        expect(getPTSDSeverity(1)).toBe('minimal');\n        expect(getPTSDSeverity(2)).toBe('minimal');\n        expect(getPTSDSeverity(5)).toBe('mild');\n        expect(getPTSDSeverity(7)).toBe('mild');\n        expect(getPTSDSeverity(12)).toBe('moderate');\n        expect(getPTSDSeverity(14)).toBe('moderate');\n        expect(getPTSDSeverity(18)).toBe('severe');\n        expect(getPTSDSeverity(20)).toBe('severe');\n      });\n    });\n  });\n\n  describe('handleAssessmentChange', () => {\n    beforeEach(() => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findMany.mockResolvedValue([\n        { slug: 'depression-support', name: 'Depression Support Network' },\n        { slug: 'anxiety-warriors', name: 'Anxiety Warriors' },\n      ]);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n    });\n\n    it('should handle assessment change and generate new recommendations', async () => {\n      await service.handleAssessmentChange('user-123', 'phq9');\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'Assessment change detected for user user-123: phq9'\n      );\n      expect(loggerSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Generated')\n      );\n      expect(loggerSpy).toHaveBeenCalledWith(\n        expect.stringContaining('new recommendations for user user-123')\n      );\n    });\n\n    it('should handle errors during recommendation generation', async () => {\n      prismaService.preAssessment.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      await service.handleAssessmentChange('user-123', 'gad7');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error handling assessment change for user user-123'),\n        expect.any(Error)\n      );\n    });\n\n    it('should log when no new recommendations are generated', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(null); // No assessment\n\n      await service.handleAssessmentChange('user-123', 'ptsd5');\n\n      expect(loggerSpy).toHaveBeenCalledWith(\n        'Generated 0 new recommendations for user user-123'\n      );\n    });\n  });\n\n  describe('edge cases and error handling', () => {\n    it('should handle empty community list', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findMany.mockResolvedValue([]);\n\n      const result = await service.getRecommendationsForUser('user-123');\n\n      expect(result).toEqual([]);\n    });\n\n    it('should handle malformed assessment scores', async () => {\n      const malformedAssessment = {\n        ...mockPreAssessment,\n        scores: 'invalid-scores', // Should be object\n        severityLevels: null,\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(malformedAssessment);\n\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result.assessments).toEqual({});\n    });\n\n    it('should handle very high scores correctly', async () => {\n      const highScoreAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          phq9Score: 50, // Beyond normal range\n          gad7Score: 100,\n          ptsd5Score: 200,\n        },\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(highScoreAssessment);\n\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n      const result = await getUserAssessmentProfile('user-123');\n\n      expect(result.assessments.phq9.severity).toBe('severe');\n      expect(result.assessments.gad7.severity).toBe('severe');\n      expect(result.assessments.ptsd5.severity).toBe('severe');\n    });\n\n    it('should handle negative scores correctly', async () => {\n      const negativeScoreAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          phq9Score: -5, // Invalid negative score\n          gad7Score: -1,\n          ptsd5Score: -10,\n        },\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(negativeScoreAssessment);\n\n      const getUserAssessmentProfile = (service as any).getUserAssessmentProfile.bind(service);\n      const result = await getUserAssessmentProfile('user-123');\n\n      // Should still process negative scores (might be data error)\n      expect(result.assessments.phq9.severity).toBe('minimal'); // Negative treated as minimal\n      expect(result.assessments.gad7.severity).toBe('minimal');\n      expect(result.assessments.ptsd5.severity).toBe('minimal');\n    });\n\n    it('should handle concurrent assessment changes', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findMany.mockResolvedValue([\n        { slug: 'depression-support', name: 'Depression Support Network' },\n      ]);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n\n      // Simulate concurrent changes\n      const promises = [\n        service.handleAssessmentChange('user-123', 'phq9'),\n        service.handleAssessmentChange('user-123', 'gad7'),\n        service.handleAssessmentChange('user-123', 'ptsd5'),\n      ];\n\n      await Promise.all(promises);\n\n      // Should handle all changes without errors\n      expect(loggerSpy).toHaveBeenCalledTimes(6); // 2 logs per change * 3 changes\n    });\n\n    it('should handle assessment community mapping edge cases', () => {\n      const getAssessmentCommunityMappings = (service as any).getAssessmentCommunityMappings.bind(service);\n      const mappings = getAssessmentCommunityMappings();\n\n      // Verify all mappings have required properties\n      Object.values(mappings).forEach((mapping: any) => {\n        expect(mapping).toHaveProperty('score');\n        expect(mapping).toHaveProperty('communities');\n        expect(mapping).toHaveProperty('weight');\n        expect(Array.isArray(mapping.communities)).toBe(true);\n        expect(typeof mapping.weight).toBe('number');\n        expect(mapping.weight).toBeGreaterThan(0);\n        expect(mapping.weight).toBeLessThanOrEqual(1);\n      });\n    });\n\n    it('should normalize compatibility scores to 0-1 range', async () => {\n      // Test with very high contributions that might exceed 1.0\n      const highContributionProfile = {\n        userId: 'user-123',\n        assessments: {\n          phq9: {\n            score: 27, // Maximum PHQ-9 score\n            severity: 'severe',\n            date: new Date('2024-01-01'),\n          },\n          gad7: {\n            score: 21, // Maximum GAD-7 score\n            severity: 'severe',\n            date: new Date('2024-01-01'),\n          },\n          ptsd5: {\n            score: 20, // Maximum PTSD-5 score\n            severity: 'severe',\n            date: new Date('2024-01-01'),\n          },\n        },\n      };\n\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n\n      const result = await service.calculateCompatibilityScore(\n        highContributionProfile,\n        'depression-support'\n      );\n\n      expect(result.compatibilityScore).toBeLessThanOrEqual(1.0);\n      expect(result.compatibilityScore).toBeGreaterThanOrEqual(0);\n    });\n  });\n});"],"version":3}