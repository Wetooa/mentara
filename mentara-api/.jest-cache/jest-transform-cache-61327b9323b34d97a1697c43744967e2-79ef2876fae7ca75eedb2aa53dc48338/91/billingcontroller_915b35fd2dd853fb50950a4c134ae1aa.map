{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Body,\n  Patch,\n  Param,\n  Query,\n  UseGuards,\n  Delete,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBody,\n  ApiBearerAuth,\n  ApiParam,\n  ApiQuery,\n  ApiSecurity,\n} from '@nestjs/swagger';\nimport { BillingService } from './billing.service';\nimport { JwtAuthGuard } from 'src/auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from 'src/auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from 'src/auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from 'src/common/pipes/zod-validation.pipe';\nimport {\n  CreateSubscriptionDtoSchema,\n  UpdateSubscriptionDtoSchema,\n  CancelSubscriptionDtoSchema,\n  ChangeSubscriptionPlanDtoSchema,\n  PauseSubscriptionDtoSchema,\n  ScheduleSubscriptionCancellationDtoSchema,\n  ReactivateSubscriptionDtoSchema,\n  ApplyDiscountDtoSchema,\n  SubscriptionUsageAnalyticsQueryDtoSchema,\n  GetPlansQueryDtoSchema,\n  CreatePlanDtoSchema,\n  UpdatePlanDtoSchema,\n  CreatePaymentMethodDtoSchema,\n  UpdatePaymentMethodDtoSchema,\n  CreatePaymentDtoSchema,\n  GetPaymentsQueryDtoSchema,\n  UpdatePaymentStatusDtoSchema,\n  CreateInvoiceDtoSchema,\n  GetInvoicesQueryDtoSchema,\n  MarkInvoiceAsPaidDtoSchema,\n  CreateDiscountDtoSchema,\n  ValidateDiscountDtoSchema,\n  RedeemDiscountDtoSchema,\n  RecordUsageDtoSchema,\n  GetUsageRecordsQueryDtoSchema,\n  GetBillingStatisticsQueryDtoSchema,\n  type CreateSubscriptionDto,\n  type UpdateSubscriptionDto,\n  type CancelSubscriptionDto,\n  type ChangeSubscriptionPlanDto,\n  type PauseSubscriptionDto,\n  type ScheduleSubscriptionCancellationDto,\n  type ReactivateSubscriptionDto,\n  type ApplyDiscountDto,\n  type SubscriptionUsageAnalyticsQueryDto,\n  type GetPlansQueryDto,\n  type CreatePlanDto,\n  type UpdatePlanDto,\n  type CreatePaymentMethodDto,\n  type UpdatePaymentMethodDto,\n  type CreatePaymentDto,\n  type GetPaymentsQueryDto,\n  type UpdatePaymentStatusDto,\n  type CreateInvoiceDto,\n  type GetInvoicesQueryDto,\n  type MarkInvoiceAsPaidDto,\n  type CreateDiscountDto,\n  type ValidateDiscountDto,\n  type RedeemDiscountDto,\n  type RecordUsageDto,\n  type GetUsageRecordsQueryDto,\n  type GetBillingStatisticsQueryDto,\n} from '@mentara/commons';\nimport {\n  BillingCycle,\n  SubscriptionTier,\n  PaymentMethodType,\n  PaymentStatus,\n  InvoiceStatus,\n  DiscountType,\n} from '@prisma/client';\n\n@ApiTags('billing')\n@ApiBearerAuth('JWT-auth')\n@Controller('billing')\n@UseGuards(JwtAuthGuard)\nexport class BillingController {\n  constructor(private readonly billingService: BillingService) {}\n\n  // Subscription endpoints\n  @Post('subscriptions')\n  @ApiOperation({\n    summary: 'Create new subscription',\n    description: 'Create a new subscription plan for the authenticated user',\n  })\n  @ApiBody({\n    description: 'Subscription creation details',\n    schema: {\n      type: 'object',\n      properties: {\n        planId: { type: 'string', description: 'ID of the subscription plan' },\n        paymentMethodId: {\n          type: 'string',\n          description: 'Payment method to use',\n        },\n        trialStart: {\n          type: 'string',\n          format: 'date-time',\n          description: 'Trial start date',\n        },\n        trialEnd: {\n          type: 'string',\n          format: 'date-time',\n          description: 'Trial end date',\n        },\n      },\n      required: ['planId', 'paymentMethodId'],\n    },\n  })\n  @ApiResponse({\n    status: 201,\n    description: 'Subscription created successfully',\n    schema: {\n      type: 'object',\n      properties: {\n        id: { type: 'string' },\n        userId: { type: 'string' },\n        planId: { type: 'string' },\n        status: {\n          type: 'string',\n          enum: ['active', 'trialing', 'past_due', 'canceled'],\n        },\n        createdAt: { type: 'string', format: 'date-time' },\n      },\n    },\n  })\n  @ApiResponse({ status: 400, description: 'Invalid subscription data' })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @ApiResponse({\n    status: 409,\n    description: 'User already has an active subscription',\n  })\n  createSubscription(\n    @Body(new ZodValidationPipe(CreateSubscriptionDtoSchema))\n    body: CreateSubscriptionDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.createSubscription({\n      ...body,\n      userId,\n      trialStart: body.trialStart ? new Date(body.trialStart) : undefined,\n      trialEnd: body.trialEnd ? new Date(body.trialEnd) : undefined,\n    });\n  }\n\n  @Get('subscriptions/me')\n  getMySubscription(@CurrentUserId() userId: string) {\n    return this.billingService.findUserSubscription(userId);\n  }\n\n  @Patch('subscriptions/me')\n  updateMySubscription(\n    @Body(new ZodValidationPipe(UpdateSubscriptionDtoSchema))\n    body: UpdateSubscriptionDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.updateSubscription(userId, body);\n  }\n\n  @Post('subscriptions/me/cancel')\n  cancelMySubscription(\n    @Body(new ZodValidationPipe(CancelSubscriptionDtoSchema))\n    body: CancelSubscriptionDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.cancelSubscription(userId);\n  }\n\n  // ===== ADVANCED SUBSCRIPTION MANAGEMENT =====\n\n  @Post('subscriptions/me/change-plan')\n  changeMySubscriptionPlan(\n    @Body(new ZodValidationPipe(ChangeSubscriptionPlanDtoSchema))\n    body: ChangeSubscriptionPlanDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.changeSubscriptionPlan(userId, body.newPlanId, {\n      billingCycle: body.billingCycle,\n      prorationBehavior: body.prorationBehavior,\n      effectiveDate: body.effectiveDate\n        ? new Date(body.effectiveDate)\n        : undefined,\n    });\n  }\n\n  @Post('subscriptions/me/pause')\n  pauseMySubscription(\n    @Body(new ZodValidationPipe(PauseSubscriptionDtoSchema))\n    body: PauseSubscriptionDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.pauseSubscription(userId, {\n      pauseUntil: body.pauseUntil ? new Date(body.pauseUntil) : undefined,\n      reason: body.reason,\n    });\n  }\n\n  @Post('subscriptions/me/resume')\n  resumeMySubscription(@CurrentUserId() userId: string) {\n    return this.billingService.resumeSubscription(userId);\n  }\n\n  @Post('subscriptions/me/schedule-cancellation')\n  scheduleMySubscriptionCancellation(\n    @Body(new ZodValidationPipe(ScheduleSubscriptionCancellationDtoSchema))\n    body: ScheduleSubscriptionCancellationDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.scheduleSubscriptionCancellation(userId, body);\n  }\n\n  @Post('subscriptions/me/reactivate')\n  reactivateMySubscription(\n    @Body(new ZodValidationPipe(ReactivateSubscriptionDtoSchema))\n    body: ReactivateSubscriptionDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.reactivateSubscription(\n      userId,\n      body.newPaymentMethodId,\n    );\n  }\n\n  @Post('subscriptions/me/apply-discount')\n  applyDiscountToMySubscription(\n    @Body(new ZodValidationPipe(ApplyDiscountDtoSchema)) body: ApplyDiscountDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.applyDiscountToSubscription(\n      userId,\n      body.discountCode,\n    );\n  }\n\n  @Post('subscriptions/:id/renew')\n  processSubscriptionRenewal(\n    @Param('id') subscriptionId: string,\n    @CurrentUserRole() userRole: string,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n    return this.billingService.processSubscriptionRenewal(subscriptionId);\n  }\n\n  @Get('subscriptions/:id/usage-analytics')\n  getSubscriptionUsageAnalytics(\n    @Param('id') subscriptionId: string,\n    @CurrentUserRole() userRole: string,\n    @CurrentUserId() userId: string,\n    @Query(new ZodValidationPipe(SubscriptionUsageAnalyticsQueryDtoSchema))\n    query: SubscriptionUsageAnalyticsQueryDto,\n  ) {\n    // Users can only see their own subscription analytics\n    if (userRole !== 'admin') {\n      // In a real implementation, verify subscriptionId belongs to user\n    }\n\n    return this.billingService.getSubscriptionUsageAnalytics(\n      subscriptionId,\n      query.startDate ? new Date(query.startDate) : undefined,\n      query.endDate ? new Date(query.endDate) : undefined,\n    );\n  }\n\n  // Subscription Plans\n  @Get('plans')\n  getAllPlans(\n    @Query(new ZodValidationPipe(GetPlansQueryDtoSchema))\n    query: GetPlansQueryDto,\n  ) {\n    return this.billingService.findAllPlans(\n      query.isActive !== undefined ? query.isActive : true,\n    );\n  }\n\n  @Post('plans')\n  createPlan(\n    @Body(new ZodValidationPipe(CreatePlanDtoSchema)) body: CreatePlanDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n    return this.billingService.createSubscriptionPlan(body);\n  }\n\n  @Patch('plans/:id')\n  updatePlan(\n    @Param('id') id: string,\n    @Body(new ZodValidationPipe(UpdatePlanDtoSchema)) body: UpdatePlanDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n    return this.billingService.updatePlan(id, body);\n  }\n\n  // Payment Methods\n  @Post('payment-methods')\n  createPaymentMethod(\n    @Body(new ZodValidationPipe(CreatePaymentMethodDtoSchema))\n    body: CreatePaymentMethodDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.createPaymentMethod({\n      ...body,\n      userId,\n    });\n  }\n\n  @Get('payment-methods')\n  getMyPaymentMethods(@CurrentUserId() userId: string) {\n    return this.billingService.findUserPaymentMethods(userId);\n  }\n\n  @Patch('payment-methods/:id')\n  updatePaymentMethod(\n    @Param('id') id: string,\n    @Body(new ZodValidationPipe(UpdatePaymentMethodDtoSchema))\n    body: UpdatePaymentMethodDto,\n  ) {\n    return this.billingService.updatePaymentMethod(id, body);\n  }\n\n  @Delete('payment-methods/:id')\n  deletePaymentMethod(@Param('id') id: string) {\n    return this.billingService.deletePaymentMethod(id);\n  }\n\n  // Payments\n  @Post('payments')\n  createPayment(\n    @Body(new ZodValidationPipe(CreatePaymentDtoSchema)) body: CreatePaymentDto,\n  ) {\n    return this.billingService.createPayment(body);\n  }\n\n  @Get('payments')\n  getPayments(\n    @CurrentUserRole() userRole: string,\n    @Query(new ZodValidationPipe(GetPaymentsQueryDtoSchema))\n    query: GetPaymentsQueryDto,\n  ) {\n    // Only admins can view all payments\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.findPayments(\n      query.subscriptionId,\n      query.status,\n      query.startDate ? new Date(query.startDate) : undefined,\n      query.endDate ? new Date(query.endDate) : undefined,\n    );\n  }\n\n  @Patch('payments/:id/status')\n  updatePaymentStatus(\n    @Param('id') id: string,\n    @Body(new ZodValidationPipe(UpdatePaymentStatusDtoSchema))\n    body: UpdatePaymentStatusDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    // Only admins can update payment status\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.updatePaymentStatus(\n      id,\n      body.status,\n      body.metadata,\n    );\n  }\n\n  // Invoices\n  @Post('invoices')\n  createInvoice(\n    @Body(new ZodValidationPipe(CreateInvoiceDtoSchema)) body: CreateInvoiceDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.createInvoice({\n      ...body,\n      dueDate: new Date(body.dueDate),\n    });\n  }\n\n  @Get('invoices')\n  getInvoices(\n    @CurrentUserRole() userRole: string,\n    @CurrentUserId() userId: string,\n    @Query(new ZodValidationPipe(GetInvoicesQueryDtoSchema))\n    query: GetInvoicesQueryDto,\n  ) {\n    // Users can only see their own invoices\n    if (userRole !== 'admin') {\n      // Filter by user's subscription\n      // In a real implementation, you'd need to verify subscriptionId belongs to user\n    }\n\n    return this.billingService.findInvoices(query.subscriptionId, query.status);\n  }\n\n  @Post('invoices/:id/pay')\n  markInvoiceAsPaid(\n    @Param('id') id: string,\n    @Body(new ZodValidationPipe(MarkInvoiceAsPaidDtoSchema))\n    body: MarkInvoiceAsPaidDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.markInvoiceAsPaid(id);\n  }\n\n  // Discounts\n  @Post('discounts')\n  createDiscount(\n    @Body(new ZodValidationPipe(CreateDiscountDtoSchema))\n    body: CreateDiscountDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.createDiscount({\n      ...body,\n      validFrom: body.validFrom ? new Date(body.validFrom) : undefined,\n      validUntil: body.validUntil ? new Date(body.validUntil) : undefined,\n    });\n  }\n\n  @Post('discounts/validate')\n  validateDiscount(\n    @Body(new ZodValidationPipe(ValidateDiscountDtoSchema))\n    body: ValidateDiscountDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.validateDiscount(body.code, userId, body.amount);\n  }\n\n  @Post('discounts/:id/redeem')\n  redeemDiscount(\n    @Param('id') discountId: string,\n    @Body(new ZodValidationPipe(RedeemDiscountDtoSchema))\n    body: RedeemDiscountDto,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.billingService.redeemDiscount(\n      discountId,\n      userId,\n      body.amountSaved,\n    );\n  }\n\n  // Usage Records\n  @Post('usage')\n  recordUsage(\n    @Body(new ZodValidationPipe(RecordUsageDtoSchema)) body: RecordUsageDto,\n    @CurrentUserRole() userRole?: string,\n  ) {\n    // Only admins or system can record usage\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.recordUsage({\n      ...body,\n      usageDate: body.usageDate ? new Date(body.usageDate) : undefined,\n    });\n  }\n\n  @Get('usage/:subscriptionId')\n  getUsageRecords(\n    @Param('subscriptionId') subscriptionId: string,\n    @CurrentUserRole() userRole: string,\n    @Query(new ZodValidationPipe(GetUsageRecordsQueryDtoSchema))\n    query: GetUsageRecordsQueryDto,\n  ) {\n    // Users can only see their own usage\n    if (userRole !== 'admin') {\n      // In a real implementation, verify subscriptionId belongs to user\n    }\n\n    return this.billingService.getUsageRecords(\n      subscriptionId,\n      query.feature,\n      query.startDate ? new Date(query.startDate) : undefined,\n      query.endDate ? new Date(query.endDate) : undefined,\n    );\n  }\n\n  // Statistics\n  @Get('statistics')\n  getBillingStatistics(\n    @CurrentUserRole() userRole: string,\n    @Query(new ZodValidationPipe(GetBillingStatisticsQueryDtoSchema))\n    query: GetBillingStatisticsQueryDto,\n  ) {\n    if (userRole !== 'admin') {\n      throw new UnauthorizedException('Insufficient permissions');\n    }\n\n    return this.billingService.getBillingStatistics(\n      query.startDate ? new Date(query.startDate) : undefined,\n      query.endDate ? new Date(query.endDate) : undefined,\n    );\n  }\n}\n"],"version":3}