{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-account.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-account.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Patch,\n  Param,\n  Delete,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { AdminService } from '../admin.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../../auth/decorators/current-user-role.decorator';\nimport { ValidatedBody } from '../../common/decorators/validate-body.decorator';\nimport {\n  UpdateAdminDtoSchema,\n  type UpdateAdminDto,\n  type AdminResponseDto,\n} from '../types';\n\n@Controller('admin/accounts')\n@UseGuards(JwtAuthGuard)\nexport class AdminAccountController {\n  private readonly logger = new Logger(AdminAccountController.name);\n\n  constructor(private readonly adminService: AdminService) {}\n\n  @Get()\n  async findAll(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<AdminResponseDto[]> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving all admins`);\n      return await this.adminService.findAll();\n    } catch (error) {\n      this.logger.error('Failed to retrieve admins:', error);\n      throw new HttpException(\n        'Failed to retrieve admin users',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Get(':id')\n  async findOne(\n    @Param('id') id: string,\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<AdminResponseDto | null> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving admin ${id}`);\n      const admin = await this.adminService.findOne(id);\n\n      if (!admin) {\n        throw new HttpException('Admin not found', HttpStatus.NOT_FOUND);\n      }\n\n      return admin;\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      this.logger.error('Failed to retrieve admin:', error);\n      throw new HttpException(\n        'Failed to retrieve admin user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Patch(':id')\n  async update(\n    @Param('id') id: string,\n    @ValidatedBody(UpdateAdminDtoSchema) updateAdminDto: UpdateAdminDto,\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<AdminResponseDto> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} updating admin ${id}`);\n      return await this.adminService.update(id, updateAdminDto);\n    } catch (error) {\n      this.logger.error('Failed to update admin:', error);\n      throw new HttpException(\n        'Failed to update admin user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Delete(':id')\n  async remove(\n    @Param('id') id: string,\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<{ message: string }> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} deleting admin ${id}`);\n\n      // Prevent self-deletion\n      if (id === currentUserId) {\n        throw new HttpException(\n          'Cannot delete your own admin account',\n          HttpStatus.BAD_REQUEST,\n        );\n      }\n\n      await this.adminService.remove(id);\n      return { message: 'Admin user deleted successfully' };\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      this.logger.error('Failed to delete admin:', error);\n      throw new HttpException(\n        'Failed to delete admin user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"version":3}