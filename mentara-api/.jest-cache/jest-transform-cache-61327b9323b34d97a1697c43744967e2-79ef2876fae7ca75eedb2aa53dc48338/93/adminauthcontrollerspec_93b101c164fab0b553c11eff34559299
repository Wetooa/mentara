78073a07bd72e4410c7153c3cab10f1e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const admin_auth_controller_1 = require("./admin-auth.controller");
const admin_auth_service_1 = require("../services/admin-auth.service");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const zod_validation_pipe_1 = require("../../common/pipes/zod-validation.pipe");
const auth_testing_helpers_1 = require("../../test-utils/auth-testing-helpers");
describe('AdminAuthController', () => {
    let controller;
    let adminAuthService;
    let mockJwtAuthGuard;
    // Test data constants
    const mockAdminUser = {
        id: auth_testing_helpers_1.TEST_USER_IDS.ADMIN,
        email: auth_testing_helpers_1.TEST_EMAILS.ADMIN,
        firstName: 'Admin',
        lastName: 'User',
        role: 'admin',
        emailVerified: true,
        adminLevel: 'admin',
        permissions: ['read', 'write', 'delete'],
        createdAt: new Date(),
        lastLoginAt: new Date(),
    };
    const mockSuperAdminUser = {
        ...mockAdminUser,
        id: 'super-admin-123',
        email: 'super@mentara.com',
        adminLevel: 'super_admin',
        permissions: ['read', 'write', 'delete', 'create_admins'],
    };
    const mockTokens = {
        accessToken: 'mock-access-token',
        refreshToken: 'mock-refresh-token',
        expiresIn: 3600,
    };
    const mockDashboardStats = {
        totalUsers: 1000,
        totalTherapists: 100,
        totalAdmins: 5,
        activeUsers: 750,
        pendingApplications: 25,
        systemHealth: 'healthy',
        lastUpdated: new Date(),
    };
    beforeEach(async () => {
        // Create mock services
        const mockAdminAuthService = {
            createAdminAccount: jest.fn(),
            loginAdmin: jest.fn(),
            getAdminProfile: jest.fn(),
            getAdminPermissions: jest.fn(),
            getAdminDashboardStats: jest.fn(),
        };
        mockJwtAuthGuard = {
            canActivate: jest.fn().mockReturnValue(true),
        };
        const module = await testing_1.Test.createTestingModule({
            imports: [
                throttler_1.ThrottlerModule.forRoot([
                    {
                        name: 'short',
                        ttl: 1000,
                        limit: 3,
                    },
                ]),
            ],
            controllers: [admin_auth_controller_1.AdminAuthController],
            providers: [
                {
                    provide: admin_auth_service_1.AdminAuthService,
                    useValue: mockAdminAuthService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: jest.fn().mockReturnValue(true) })
            .compile();
        controller = module.get(admin_auth_controller_1.AdminAuthController);
        adminAuthService = module.get(admin_auth_service_1.AdminAuthService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('createAdminAccount', () => {
        const validRegisterDto = {
            email: 'newadmin@mentara.com',
            password: 'SecurePass123!',
            firstName: 'New',
            lastName: 'Admin',
            adminLevel: 'admin',
            permissions: ['read', 'write'],
        };
        it('should create admin account successfully when called by admin', async () => {
            // Arrange
            const mockCreatedUser = {
                user: mockAdminUser,
                message: 'Admin account created successfully',
            };
            jest.spyOn(adminAuthService, 'createAdminAccount').mockResolvedValue(mockCreatedUser);
            // Act
            const result = await controller.createAdminAccount('admin', validRegisterDto);
            // Assert
            expect(adminAuthService.createAdminAccount).toHaveBeenCalledWith(validRegisterDto.email, validRegisterDto.password, validRegisterDto.firstName, validRegisterDto.lastName, validRegisterDto.adminLevel, validRegisterDto.permissions);
            expect(result).toEqual({
                user: {
                    id: mockAdminUser.id,
                    email: mockAdminUser.email,
                    firstName: mockAdminUser.firstName,
                    lastName: mockAdminUser.lastName,
                    role: mockAdminUser.role,
                    emailVerified: mockAdminUser.emailVerified,
                },
                message: mockCreatedUser.message,
            });
        });
        it('should throw ForbiddenException when called by non-admin', async () => {
            // Arrange & Act & Assert
            await auth_testing_helpers_1.TestAssertions.expectToThrowNestException(() => controller.createAdminAccount('client', validRegisterDto), common_1.ForbiddenException, 'Only admins can create admin accounts');
            expect(adminAuthService.createAdminAccount).not.toHaveBeenCalled();
        });
        it('should use default values when optional fields are not provided', async () => {
            // Arrange
            const minimalRegisterDto = {
                email: 'newadmin@mentara.com',
                password: 'SecurePass123!',
                firstName: 'New',
                lastName: 'Admin',
            };
            const mockCreatedUser = {
                user: mockAdminUser,
                message: 'Admin account created successfully',
            };
            jest.spyOn(adminAuthService, 'createAdminAccount').mockResolvedValue(mockCreatedUser);
            // Act
            await controller.createAdminAccount('admin', minimalRegisterDto);
            // Assert
            expect(adminAuthService.createAdminAccount).toHaveBeenCalledWith(minimalRegisterDto.email, minimalRegisterDto.password, minimalRegisterDto.firstName, minimalRegisterDto.lastName, 'admin', // Default adminLevel
            []);
        });
        it('should handle service errors appropriately', async () => {
            // Arrange
            const serviceError = new Error('Email already exists');
            jest.spyOn(adminAuthService, 'createAdminAccount').mockRejectedValue(serviceError);
            // Act & Assert
            await expect(controller.createAdminAccount('admin', validRegisterDto)).rejects.toThrow(serviceError);
        });
    });
    describe('login', () => {
        const validLoginDto = {
            email: auth_testing_helpers_1.TEST_EMAILS.ADMIN,
            password: 'SecurePass123!',
        };
        const mockRequest = {
            ip: '192.168.1.1',
            get: jest.fn().mockReturnValue('Test User Agent'),
        };
        it('should login admin successfully with valid credentials', async () => {
            // Arrange
            const mockLoginResult = {
                user: mockAdminUser,
                tokens: mockTokens,
            };
            jest.spyOn(adminAuthService, 'loginAdmin').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(validLoginDto, mockRequest);
            // Assert
            expect(adminAuthService.loginAdmin).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequest.ip, 'Test User Agent');
            expect(result).toEqual({
                user: {
                    id: mockAdminUser.id,
                    email: mockAdminUser.email,
                    firstName: mockAdminUser.firstName,
                    lastName: mockAdminUser.lastName,
                    role: mockAdminUser.role,
                    emailVerified: mockAdminUser.emailVerified,
                },
                accessToken: mockTokens.accessToken,
                refreshToken: mockTokens.refreshToken,
                expiresIn: mockTokens.expiresIn,
            });
        });
        it('should handle missing User-Agent header', async () => {
            // Arrange
            const mockRequestWithoutUserAgent = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue(undefined),
            };
            const mockLoginResult = {
                user: mockAdminUser,
                tokens: mockTokens,
            };
            jest.spyOn(adminAuthService, 'loginAdmin').mockResolvedValue(mockLoginResult);
            // Act
            await controller.login(validLoginDto, mockRequestWithoutUserAgent);
            // Assert
            expect(adminAuthService.loginAdmin).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequestWithoutUserAgent.ip, undefined);
        });
        it('should handle invalid credentials', async () => {
            // Arrange
            const authError = new common_1.UnauthorizedException('Invalid credentials');
            jest.spyOn(adminAuthService, 'loginAdmin').mockRejectedValue(authError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(authError);
        });
        it('should handle service errors', async () => {
            // Arrange
            const serviceError = new Error('Database connection failed');
            jest.spyOn(adminAuthService, 'loginAdmin').mockRejectedValue(serviceError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(serviceError);
        });
    });
    describe('getProfile', () => {
        it('should return admin profile successfully', async () => {
            // Arrange
            jest.spyOn(adminAuthService, 'getAdminProfile').mockResolvedValue(mockAdminUser);
            // Act
            const result = await controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            // Assert
            expect(adminAuthService.getAdminProfile).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockAdminUser);
        });
        it('should handle profile not found', async () => {
            // Arrange
            const notFoundError = new Error('Admin profile not found');
            jest.spyOn(adminAuthService, 'getAdminProfile').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(notFoundError);
        });
    });
    describe('getPermissions', () => {
        const mockPermissions = {
            permissions: ['read', 'write', 'delete'],
            adminLevel: 'admin',
            canCreateAdmins: true,
            canModifyUsers: true,
            canAccessAnalytics: true,
        };
        it('should return admin permissions successfully', async () => {
            // Arrange
            jest.spyOn(adminAuthService, 'getAdminPermissions').mockResolvedValue(mockPermissions);
            // Act
            const result = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            // Assert
            expect(adminAuthService.getAdminPermissions).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockPermissions);
        });
        it('should handle permissions not found', async () => {
            // Arrange
            const notFoundError = new Error('Admin permissions not found');
            jest.spyOn(adminAuthService, 'getAdminPermissions').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(notFoundError);
        });
    });
    describe('getDashboardStats', () => {
        it('should return dashboard statistics successfully', async () => {
            // Arrange
            jest.spyOn(adminAuthService, 'getAdminDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const result = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            // Assert
            expect(adminAuthService.getAdminDashboardStats).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockDashboardStats);
        });
        it('should handle dashboard stats error', async () => {
            // Arrange
            const statsError = new Error('Unable to fetch dashboard statistics');
            jest.spyOn(adminAuthService, 'getAdminDashboardStats').mockRejectedValue(statsError);
            // Act & Assert
            await expect(controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(statsError);
        });
    });
    describe('Role-based Access Control', () => {
        it('should test role-based access for protected endpoints', async () => {
            // Test that different roles can access appropriate endpoints
            await auth_testing_helpers_1.RoleBasedTestUtils.testWithRoles(async (userId, role) => {
                // Mock the auth guard to return the specific role
                mockJwtAuthGuard.canActivate.mockReturnValue(role === 'admin');
                try {
                    await controller.getProfile(userId);
                    return true;
                }
                catch (error) {
                    return false;
                }
            }, {
                admin: true,
                client: false,
                therapist: false,
                moderator: false,
            });
        });
    });
    describe('Security Tests', () => {
        it('should validate input data through ZodValidationPipe', () => {
            // This tests that the controller uses proper validation
            const validationPipe = new zod_validation_pipe_1.ZodValidationPipe({});
            expect(validationPipe).toBeDefined();
        });
        it('should apply rate limiting through ThrottlerGuard', () => {
            // Test that throttling is configured
            const createAccountMetadata = Reflect.getMetadata('__throttler_options__', controller.createAdminAccount);
            const loginMetadata = Reflect.getMetadata('__throttler_options__', controller.login);
            expect(createAccountMetadata).toBeDefined();
            expect(loginMetadata).toBeDefined();
        });
        it('should require authentication for protected endpoints', () => {
            // Test that protected endpoints have JwtAuthGuard
            const protectedMethods = ['createAdminAccount', 'getProfile', 'getPermissions', 'getDashboardStats'];
            protectedMethods.forEach(method => {
                const guards = Reflect.getMetadata('__guards__', controller[method]);
                expect(guards).toBeDefined();
            });
        });
        it('should allow public access to login endpoint', () => {
            // Test that login endpoint is marked as public
            const publicMetadata = Reflect.getMetadata('isPublic', controller.login);
            expect(publicMetadata).toBeTruthy();
        });
    });
    describe('Error Handling', () => {
        it('should handle network errors gracefully', async () => {
            // Arrange
            const networkError = new Error('Network timeout');
            jest.spyOn(adminAuthService, 'getAdminProfile').mockRejectedValue(networkError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(networkError);
        });
        it('should handle validation errors', async () => {
            // This would be handled by the ZodValidationPipe
            const invalidData = {
                email: 'invalid-email',
                password: '123', // Too short
                firstName: '',
                lastName: '',
            };
            // In a real scenario, this would throw a validation error
            // The pipe would catch this before it reaches the controller
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete admin creation workflow', async () => {
            // Arrange
            const mockCreatedUser = {
                user: mockAdminUser,
                message: 'Admin account created successfully',
            };
            jest.spyOn(adminAuthService, 'createAdminAccount').mockResolvedValue(mockCreatedUser);
            // Act
            const result = await controller.createAdminAccount('admin', {
                email: 'newadmin@mentara.com',
                password: 'SecurePass123!',
                firstName: 'New',
                lastName: 'Admin',
                adminLevel: 'admin',
                permissions: ['read', 'write'],
            });
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockAdminUser.email);
            expect(result.message).toBe('Admin account created successfully');
        });
        it('should handle complete login workflow', async () => {
            // Arrange
            const mockLoginResult = {
                user: mockAdminUser,
                tokens: mockTokens,
            };
            jest.spyOn(adminAuthService, 'loginAdmin').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login({
                email: auth_testing_helpers_1.TEST_EMAILS.ADMIN,
                password: 'SecurePass123!',
            }, {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue('Test User Agent'),
            });
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockAdminUser.email);
            expect(result.accessToken).toBe(mockTokens.accessToken);
            expect(result.refreshToken).toBe(mockTokens.refreshToken);
            expect(result.expiresIn).toBe(mockTokens.expiresIn);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvY29udHJvbGxlcnMvYWRtaW4tYXV0aC5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQTJFO0FBQzNFLGlEQUFvRTtBQUNwRSxtRUFBOEQ7QUFDOUQsdUVBQWtFO0FBQ2xFLDZEQUF3RDtBQUN4RCxnRkFBMkU7QUFDM0UsZ0ZBUStDO0FBRy9DLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxVQUErQixDQUFDO0lBQ3BDLElBQUksZ0JBQWtDLENBQUM7SUFDdkMsSUFBSSxnQkFBMkMsQ0FBQztJQUVoRCxzQkFBc0I7SUFDdEIsTUFBTSxhQUFhLEdBQUc7UUFDcEIsRUFBRSxFQUFFLG9DQUFhLENBQUMsS0FBSztRQUN2QixLQUFLLEVBQUUsa0NBQVcsQ0FBQyxLQUFLO1FBQ3hCLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFFBQVEsRUFBRSxNQUFNO1FBQ2hCLElBQUksRUFBRSxPQUFPO1FBQ2IsYUFBYSxFQUFFLElBQUk7UUFDbkIsVUFBVSxFQUFFLE9BQU87UUFDbkIsV0FBVyxFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUM7UUFDeEMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtLQUN4QixDQUFDO0lBRUYsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixHQUFHLGFBQWE7UUFDaEIsRUFBRSxFQUFFLGlCQUFpQjtRQUNyQixLQUFLLEVBQUUsbUJBQW1CO1FBQzFCLFVBQVUsRUFBRSxhQUFhO1FBQ3pCLFdBQVcsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsQ0FBQztLQUMxRCxDQUFDO0lBRUYsTUFBTSxVQUFVLEdBQUc7UUFDakIsV0FBVyxFQUFFLG1CQUFtQjtRQUNoQyxZQUFZLEVB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RUFBRSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQzthQUMzQyxDQUNULENBQUM7WUFFRixTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMxRCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9hdXRoL2NvbnRyb2xsZXJzL2FkbWluLWF1dGguY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgRm9yYmlkZGVuRXhjZXB0aW9uLCBVbmF1dGhvcml6ZWRFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBUaHJvdHRsZXJHdWFyZCwgVGhyb3R0bGVyTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90aHJvdHRsZXInO1xuaW1wb3J0IHsgQWRtaW5BdXRoQ29udHJvbGxlciB9IGZyb20gJy4vYWRtaW4tYXV0aC5jb250cm9sbGVyJztcbmltcG9ydCB7IEFkbWluQXV0aFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hZG1pbi1hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnLi4vZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFpvZFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnLi4vLi4vY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHtcbiAgTW9ja0J1aWxkZXIsXG4gIFRlc3REYXRhR2VuZXJhdG9yLFxuICBUZXN0QXNzZXJ0aW9ucyxcbiAgU2VjdXJpdHlHdWFyZFRlc3RVdGlscyxcbiAgUm9sZUJhc2VkVGVzdFV0aWxzLFxuICBURVNUX1VTRVJfSURTLFxuICBURVNUX0VNQUlMUyxcbn0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQgeyBjcmVhdGVNb2NrUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Rlc3QtdXRpbHMnO1xuXG5kZXNjcmliZSgnQWRtaW5BdXRoQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IEFkbWluQXV0aENvbnRyb2xsZXI7XG4gIGxldCBhZG1pbkF1dGhTZXJ2aWNlOiBBZG1pbkF1dGhTZXJ2aWNlO1xuICBsZXQgbW9ja0p3dEF1dGhHdWFyZDogamVzdC5Nb2NrZWQ8Snd0QXV0aEd1YXJkPjtcblxuICAvLyBUZXN0IGRhdGEgY29uc3RhbnRzXG4gIGNvbnN0IG1vY2tBZG1pblVzZXIgPSB7XG4gICAgaWQ6IFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgZW1haWw6IFRFU1RfRU1BSUxTLkFETUlOLFxuICAgIGZpcnN0TmFtZTogJ0FkbWluJyxcbiAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgIHJvbGU6ICdhZG1pbicsXG4gICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICBhZG1pbkxldmVsOiAnYWRtaW4nLFxuICAgIHBlcm1pc3Npb25zOiBbJ3JlYWQnLCAnd3JpdGUnLCAnZGVsZXRlJ10sXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIGxhc3RMb2dpbkF0OiBuZXcgRGF0ZSgpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tTdXBlckFkbWluVXNlciA9IHtcbiAgICAuLi5tb2NrQWRtaW5Vc2VyLFxuICAgIGlkOiAnc3VwZXItYWRtaW4tMTIzJyxcbiAgICBlbWFpbDogJ3N1cGVyQG1lbnRhcmEuY29tJyxcbiAgICBhZG1pbkxldmVsOiAnc3VwZXJfYWRtaW4nLFxuICAgIHBlcm1pc3Npb25zOiBbJ3JlYWQnLCAnd3JpdGUnLCAnZGVsZXRlJywgJ2NyZWF0ZV9hZG1pbnMnXSxcbiAgfTtcblxuICBjb25zdCBtb2NrVG9rZW5zID0ge1xuICAgIGFjY2Vzc1Rva2VuOiAnbW9jay1hY2Nlc3MtdG9rZW4nLFxuICAgIHJlZnJlc2hUb2tlbjogJ21vY2stcmVmcmVzaC10b2tlbicsXG4gICAgZXhwaXJlc0luOiAzNjAwLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tEYXNoYm9hcmRTdGF0cyA9IHtcbiAgICB0b3RhbFVzZXJzOiAxMDAwLFxuICAgIHRvdGFsVGhlcmFwaXN0czogMTAwLFxuICAgIHRvdGFsQWRtaW5zOiA1LFxuICAgIGFjdGl2ZVVzZXJzOiA3NTAsXG4gICAgcGVuZGluZ0FwcGxpY2F0aW9uczogMjUsXG4gICAgc3lzdGVtSGVhbHRoOiAnaGVhbHRoeScsXG4gICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIG1vY2sgc2VydmljZXNcbiAgICBjb25zdCBtb2NrQWRtaW5BdXRoU2VydmljZSA9IHtcbiAgICAgIGNyZWF0ZUFkbWluQWNjb3VudDogamVzdC5mbigpLFxuICAgICAgbG9naW5BZG1pbjogamVzdC5mbigpLFxuICAgICAgZ2V0QWRtaW5Qcm9maWxlOiBqZXN0LmZuKCksXG4gICAgICBnZXRBZG1pblBlcm1pc3Npb25zOiBqZXN0LmZuKCksXG4gICAgICBnZXRBZG1pbkRhc2hib2FyZFN0YXRzOiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIG1vY2tKd3RBdXRoR3VhcmQgPSB7XG4gICAgICBjYW5BY3RpdmF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgICB9IGFzIGFueTtcblxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBpbXBvcnRzOiBbXG4gICAgICAgIFRocm90dGxlck1vZHVsZS5mb3JSb290KFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnc2hvcnQnLFxuICAgICAgICAgICAgdHRsOiAxMDAwLFxuICAgICAgICAgICAgbGltaXQ6IDMsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSksXG4gICAgICBdLFxuICAgICAgY29udHJvbGxlcnM6IFtBZG1pbkF1dGhDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQWRtaW5BdXRoU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0FkbWluQXV0aFNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gICAgICAub3ZlcnJpZGVHdWFyZChKd3RBdXRoR3VhcmQpXG4gICAgICAudXNlVmFsdWUobW9ja0p3dEF1dGhHdWFyZClcbiAgICAgIC5vdmVycmlkZUd1YXJkKFRocm90dGxlckd1YXJkKVxuICAgICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSkgfSlcbiAgICAgIC5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxBZG1pbkF1dGhDb250cm9sbGVyPihBZG1pbkF1dGhDb250cm9sbGVyKTtcbiAgICBhZG1pbkF1dGhTZXJ2aWNlID0gbW9kdWxlLmdldDxBZG1pbkF1dGhTZXJ2aWNlPihBZG1pbkF1dGhTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZUFkbWluQWNjb3VudCcsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZFJlZ2lzdGVyRHRvID0ge1xuICAgICAgZW1haWw6ICduZXdhZG1pbkBtZW50YXJhLmNvbScsXG4gICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgIGZpcnN0TmFtZTogJ05ldycsXG4gICAgICBsYXN0TmFtZTogJ0FkbWluJyxcbiAgICAgIGFkbWluTGV2ZWw6ICdhZG1pbicgYXMgY29uc3QsXG4gICAgICBwZXJtaXNzaW9uczogWydyZWFkJywgJ3dyaXRlJ10gYXMgc3RyaW5nW10sXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFkbWluIGFjY291bnQgc3VjY2Vzc2Z1bGx5IHdoZW4gY2FsbGVkIGJ5IGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja0NyZWF0ZWRVc2VyID0ge1xuICAgICAgICB1c2VyOiBtb2NrQWRtaW5Vc2VyLFxuICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdjcmVhdGVBZG1pbkFjY291bnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ3JlYXRlZFVzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlQWRtaW5BY2NvdW50KCdhZG1pbicsIHZhbGlkUmVnaXN0ZXJEdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChhZG1pbkF1dGhTZXJ2aWNlLmNyZWF0ZUFkbWluQWNjb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8uZW1haWwsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8ucGFzc3dvcmQsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8uZmlyc3ROYW1lLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLmxhc3ROYW1lLFxuICAgICAgICB2YWxpZFJlZ2lzdGVyRHRvLmFkbWluTGV2ZWwsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8ucGVybWlzc2lvbnMsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBtb2NrQWRtaW5Vc2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiBtb2NrQWRtaW5Vc2VyLmVtYWlsLFxuICAgICAgICAgIGZpcnN0TmFtZTogbW9ja0FkbWluVXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgbGFzdE5hbWU6IG1vY2tBZG1pblVzZXIubGFzdE5hbWUsXG4gICAgICAgICAgcm9sZTogbW9ja0FkbWluVXNlci5yb2xlLFxuICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IG1vY2tBZG1pblVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZTogbW9ja0NyZWF0ZWRVc2VyLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgRm9yYmlkZGVuRXhjZXB0aW9uIHdoZW4gY2FsbGVkIGJ5IG5vbi1hZG1pbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2UgJiBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IFRlc3RBc3NlcnRpb25zLmV4cGVjdFRvVGhyb3dOZXN0RXhjZXB0aW9uKFxuICAgICAgICAoKSA9PiBjb250cm9sbGVyLmNyZWF0ZUFkbWluQWNjb3VudCgnY2xpZW50JywgdmFsaWRSZWdpc3RlckR0byksXG4gICAgICAgIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgICAgICAgJ09ubHkgYWRtaW5zIGNhbiBjcmVhdGUgYWRtaW4gYWNjb3VudHMnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UuY3JlYXRlQWRtaW5BY2NvdW50KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCB2YWx1ZXMgd2hlbiBvcHRpb25hbCBmaWVsZHMgYXJlIG5vdCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1pbmltYWxSZWdpc3RlckR0byA9IHtcbiAgICAgICAgZW1haWw6ICduZXdhZG1pbkBtZW50YXJhLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgICBsYXN0TmFtZTogJ0FkbWluJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tDcmVhdGVkVXNlciA9IHtcbiAgICAgICAgdXNlcjogbW9ja0FkbWluVXNlcixcbiAgICAgICAgbWVzc2FnZTogJ0FkbWluIGFjY291bnQgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnY3JlYXRlQWRtaW5BY2NvdW50JykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWF0ZWRVc2VyKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZUFkbWluQWNjb3VudCgnYWRtaW4nLCBtaW5pbWFsUmVnaXN0ZXJEdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChhZG1pbkF1dGhTZXJ2aWNlLmNyZWF0ZUFkbWluQWNjb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1pbmltYWxSZWdpc3RlckR0by5lbWFpbCxcbiAgICAgICAgbWluaW1hbFJlZ2lzdGVyRHRvLnBhc3N3b3JkLFxuICAgICAgICBtaW5pbWFsUmVnaXN0ZXJEdG8uZmlyc3ROYW1lLFxuICAgICAgICBtaW5pbWFsUmVnaXN0ZXJEdG8ubGFzdE5hbWUsXG4gICAgICAgICdhZG1pbicsIC8vIERlZmF1bHQgYWRtaW5MZXZlbFxuICAgICAgICBbXSwgLy8gRGVmYXVsdCBwZXJtaXNzaW9uc1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzIGFwcHJvcHJpYXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyk7XG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdjcmVhdGVBZG1pbkFjY291bnQnKS5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZUFkbWluQWNjb3VudCgnYWRtaW4nLCB2YWxpZFJlZ2lzdGVyRHRvKSkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsb2dpbicsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZExvZ2luRHRvID0ge1xuICAgICAgZW1haWw6IFRFU1RfRU1BSUxTLkFETUlOLFxuICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3QgVXNlciBBZ2VudCcpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgaXQoJ3Nob3VsZCBsb2dpbiBhZG1pbiBzdWNjZXNzZnVsbHkgd2l0aCB2YWxpZCBjcmVkZW50aWFscycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tMb2dpblJlc3VsdCA9IHtcbiAgICAgICAgdXNlcjogbW9ja0FkbWluVXNlcixcbiAgICAgICAgdG9rZW5zOiBtb2NrVG9rZW5zLFxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnbG9naW5BZG1pbicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dpblJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5sb2dpbih2YWxpZExvZ2luRHRvLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UubG9naW5BZG1pbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHZhbGlkTG9naW5EdG8uZW1haWwsXG4gICAgICAgIHZhbGlkTG9naW5EdG8ucGFzc3dvcmQsXG4gICAgICAgIG1vY2tSZXF1ZXN0LmlwLFxuICAgICAgICAnVGVzdCBVc2VyIEFnZW50JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IG1vY2tBZG1pblVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IG1vY2tBZG1pblVzZXIuZW1haWwsXG4gICAgICAgICAgZmlyc3ROYW1lOiBtb2NrQWRtaW5Vc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbW9ja0FkbWluVXNlci5sYXN0TmFtZSxcbiAgICAgICAgICByb2xlOiBtb2NrQWRtaW5Vc2VyLnJvbGUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogbW9ja0FkbWluVXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NUb2tlbjogbW9ja1Rva2Vucy5hY2Nlc3NUb2tlbixcbiAgICAgICAgcmVmcmVzaFRva2VuOiBtb2NrVG9rZW5zLnJlZnJlc2hUb2tlbixcbiAgICAgICAgZXhwaXJlc0luOiBtb2NrVG9rZW5zLmV4cGlyZXNJbixcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBVc2VyLUFnZW50IGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0V2l0aG91dFVzZXJBZ2VudCA9IHtcbiAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXG4gICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh1bmRlZmluZWQpLFxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IG1vY2tMb2dpblJlc3VsdCA9IHtcbiAgICAgICAgdXNlcjogbW9ja0FkbWluVXNlcixcbiAgICAgICAgdG9rZW5zOiBtb2NrVG9rZW5zLFxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnbG9naW5BZG1pbicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dpblJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgY29udHJvbGxlci5sb2dpbih2YWxpZExvZ2luRHRvLCBtb2NrUmVxdWVzdFdpdGhvdXRVc2VyQWdlbnQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChhZG1pbkF1dGhTZXJ2aWNlLmxvZ2luQWRtaW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB2YWxpZExvZ2luRHRvLmVtYWlsLFxuICAgICAgICB2YWxpZExvZ2luRHRvLnBhc3N3b3JkLFxuICAgICAgICBtb2NrUmVxdWVzdFdpdGhvdXRVc2VyQWdlbnQuaXAsXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGNyZWRlbnRpYWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgYXV0aEVycm9yID0gbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnbG9naW5BZG1pbicpLm1vY2tSZWplY3RlZFZhbHVlKGF1dGhFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIubG9naW4odmFsaWRMb2dpbkR0bywgbW9ja1JlcXVlc3QpKS5yZWplY3RzLnRvVGhyb3coYXV0aEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnbG9naW5BZG1pbicpLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIubG9naW4odmFsaWRMb2dpbkR0bywgbW9ja1JlcXVlc3QpKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByb2ZpbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYWRtaW4gcHJvZmlsZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdnZXRBZG1pblByb2ZpbGUnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQWRtaW5Vc2VyKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFByb2ZpbGUoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UuZ2V0QWRtaW5Qcm9maWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLkFETUlOKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0FkbWluVXNlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwcm9maWxlIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5vdEZvdW5kRXJyb3IgPSBuZXcgRXJyb3IoJ0FkbWluIHByb2ZpbGUgbm90IGZvdW5kJyk7XG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdnZXRBZG1pblByb2ZpbGUnKS5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRQcm9maWxlKFRFU1RfVVNFUl9JRFMuQURNSU4pKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQZXJtaXNzaW9ucycsICgpID0+IHtcbiAgICBjb25zdCBtb2NrUGVybWlzc2lvbnMgPSB7XG4gICAgICBwZXJtaXNzaW9uczogWydyZWFkJywgJ3dyaXRlJywgJ2RlbGV0ZSddLFxuICAgICAgYWRtaW5MZXZlbDogJ2FkbWluJyxcbiAgICAgIGNhbkNyZWF0ZUFkbWluczogdHJ1ZSxcbiAgICAgIGNhbk1vZGlmeVVzZXJzOiB0cnVlLFxuICAgICAgY2FuQWNjZXNzQW5hbHl0aWNzOiB0cnVlLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhZG1pbiBwZXJtaXNzaW9ucyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdnZXRBZG1pblBlcm1pc3Npb25zJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Blcm1pc3Npb25zKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFBlcm1pc3Npb25zKFRFU1RfVVNFUl9JRFMuQURNSU4pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChhZG1pbkF1dGhTZXJ2aWNlLmdldEFkbWluUGVybWlzc2lvbnMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuQURNSU4pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGVybWlzc2lvbnMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGVybWlzc2lvbnMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignQWRtaW4gcGVybWlzc2lvbnMgbm90IGZvdW5kJyk7XG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdnZXRBZG1pblBlcm1pc3Npb25zJykubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0UGVybWlzc2lvbnMoVEVTVF9VU0VSX0lEUy5BRE1JTikpLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldERhc2hib2FyZFN0YXRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRhc2hib2FyZCBzdGF0aXN0aWNzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2dldEFkbWluRGFzaGJvYXJkU3RhdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGFzaGJvYXJkU3RhdHMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0RGFzaGJvYXJkU3RhdHMoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UuZ2V0QWRtaW5EYXNoYm9hcmRTdGF0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tEYXNoYm9hcmRTdGF0cyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXNoYm9hcmQgc3RhdHMgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzdGF0c0Vycm9yID0gbmV3IEVycm9yKCdVbmFibGUgdG8gZmV0Y2ggZGFzaGJvYXJkIHN0YXRpc3RpY3MnKTtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2dldEFkbWluRGFzaGJvYXJkU3RhdHMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShzdGF0c0Vycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXREYXNoYm9hcmRTdGF0cyhURVNUX1VTRVJfSURTLkFETUlOKSkucmVqZWN0cy50b1Rocm93KHN0YXRzRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUm9sZS1iYXNlZCBBY2Nlc3MgQ29udHJvbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRlc3Qgcm9sZS1iYXNlZCBhY2Nlc3MgZm9yIHByb3RlY3RlZCBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgZGlmZmVyZW50IHJvbGVzIGNhbiBhY2Nlc3MgYXBwcm9wcmlhdGUgZW5kcG9pbnRzXG4gICAgICBhd2FpdCBSb2xlQmFzZWRUZXN0VXRpbHMudGVzdFdpdGhSb2xlcyhcbiAgICAgICAgYXN5bmMgKHVzZXJJZDogc3RyaW5nLCByb2xlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAvLyBNb2NrIHRoZSBhdXRoIGd1YXJkIHRvIHJldHVybiB0aGUgc3BlY2lmaWMgcm9sZVxuICAgICAgICAgIG1vY2tKd3RBdXRoR3VhcmQuY2FuQWN0aXZhdGUubW9ja1JldHVyblZhbHVlKHJvbGUgPT09ICdhZG1pbicpO1xuICAgICAgICAgIFxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBjb250cm9sbGVyLmdldFByb2ZpbGUodXNlcklkKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgYWRtaW46IHRydWUsXG4gICAgICAgICAgY2xpZW50OiBmYWxzZSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IGZhbHNlLFxuICAgICAgICAgIG1vZGVyYXRvcjogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBpbnB1dCBkYXRhIHRocm91Z2ggWm9kVmFsaWRhdGlvblBpcGUnLCAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHRlc3RzIHRoYXQgdGhlIGNvbnRyb2xsZXIgdXNlcyBwcm9wZXIgdmFsaWRhdGlvblxuICAgICAgY29uc3QgdmFsaWRhdGlvblBpcGUgPSBuZXcgWm9kVmFsaWRhdGlvblBpcGUoe30gYXMgYW55KTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0aW9uUGlwZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYXBwbHkgcmF0ZSBsaW1pdGluZyB0aHJvdWdoIFRocm90dGxlckd1YXJkJywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IHRocm90dGxpbmcgaXMgY29uZmlndXJlZFxuICAgICAgY29uc3QgY3JlYXRlQWNjb3VudE1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnX190aHJvdHRsZXJfb3B0aW9uc19fJywgY29udHJvbGxlci5jcmVhdGVBZG1pbkFjY291bnQpO1xuICAgICAgY29uc3QgbG9naW5NZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fdGhyb3R0bGVyX29wdGlvbnNfXycsIGNvbnRyb2xsZXIubG9naW4pO1xuICAgICAgXG4gICAgICBleHBlY3QoY3JlYXRlQWNjb3VudE1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxvZ2luTWV0YWRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcXVpcmUgYXV0aGVudGljYXRpb24gZm9yIHByb3RlY3RlZCBlbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgcHJvdGVjdGVkIGVuZHBvaW50cyBoYXZlIEp3dEF1dGhHdWFyZFxuICAgICAgY29uc3QgcHJvdGVjdGVkTWV0aG9kcyA9IFsnY3JlYXRlQWRtaW5BY2NvdW50JywgJ2dldFByb2ZpbGUnLCAnZ2V0UGVybWlzc2lvbnMnLCAnZ2V0RGFzaGJvYXJkU3RhdHMnXTtcbiAgICAgIFxuICAgICAgcHJvdGVjdGVkTWV0aG9kcy5mb3JFYWNoKG1ldGhvZCA9PiB7XG4gICAgICAgIGNvbnN0IGd1YXJkcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fZ3VhcmRzX18nLCBjb250cm9sbGVyW21ldGhvZCBhcyBrZXlvZiBBZG1pbkF1dGhDb250cm9sbGVyXSk7XG4gICAgICAgIGV4cGVjdChndWFyZHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgcHVibGljIGFjY2VzcyB0byBsb2dpbiBlbmRwb2ludCcsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBsb2dpbiBlbmRwb2ludCBpcyBtYXJrZWQgYXMgcHVibGljXG4gICAgICBjb25zdCBwdWJsaWNNZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ2lzUHVibGljJywgY29udHJvbGxlci5sb2dpbik7XG4gICAgICBleHBlY3QocHVibGljTWV0YWRhdGEpLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5ldHdvcmsgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBuZXR3b3JrRXJyb3IgPSBuZXcgRXJyb3IoJ05ldHdvcmsgdGltZW91dCcpO1xuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnZ2V0QWRtaW5Qcm9maWxlJykubW9ja1JlamVjdGVkVmFsdWUobmV0d29ya0Vycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRQcm9maWxlKFRFU1RfVVNFUl9JRFMuQURNSU4pKS5yZWplY3RzLnRvVGhyb3cobmV0d29ya0Vycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZhbGlkYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGhpcyB3b3VsZCBiZSBoYW5kbGVkIGJ5IHRoZSBab2RWYWxpZGF0aW9uUGlwZVxuICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAnaW52YWxpZC1lbWFpbCcsXG4gICAgICAgIHBhc3N3b3JkOiAnMTIzJywgLy8gVG9vIHNob3J0XG4gICAgICAgIGZpcnN0TmFtZTogJycsXG4gICAgICAgIGxhc3ROYW1lOiAnJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIEluIGEgcmVhbCBzY2VuYXJpbywgdGhpcyB3b3VsZCB0aHJvdyBhIHZhbGlkYXRpb24gZXJyb3JcbiAgICAgIC8vIFRoZSBwaXBlIHdvdWxkIGNhdGNoIHRoaXMgYmVmb3JlIGl0IHJlYWNoZXMgdGhlIGNvbnRyb2xsZXJcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXRlIGFkbWluIGNyZWF0aW9uIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja0NyZWF0ZWRVc2VyID0ge1xuICAgICAgICB1c2VyOiBtb2NrQWRtaW5Vc2VyLFxuICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdjcmVhdGVBZG1pbkFjY291bnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ3JlYXRlZFVzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlQWRtaW5BY2NvdW50KCdhZG1pbicsIHtcbiAgICAgICAgZW1haWw6ICduZXdhZG1pbkBtZW50YXJhLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgICBsYXN0TmFtZTogJ0FkbWluJyxcbiAgICAgICAgYWRtaW5MZXZlbDogJ2FkbWluJyxcbiAgICAgICAgcGVybWlzc2lvbnM6IFsncmVhZCcsICd3cml0ZSddLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlci5lbWFpbCkudG9CZShtb2NrQWRtaW5Vc2VyLmVtYWlsKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9CZSgnQWRtaW4gYWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgbG9naW4gd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrTG9naW5SZXN1bHQgPSB7XG4gICAgICAgIHVzZXI6IG1vY2tBZG1pblVzZXIsXG4gICAgICAgIHRva2VuczogbW9ja1Rva2VucyxcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2xvZ2luQWRtaW4nKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTG9naW5SZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubG9naW4oXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogVEVTVF9FTUFJTFMuQURNSU4sXG4gICAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3QgVXNlciBBZ2VudCcpLFxuICAgICAgICB9IGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlci5lbWFpbCkudG9CZShtb2NrQWRtaW5Vc2VyLmVtYWlsKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWNjZXNzVG9rZW4pLnRvQmUobW9ja1Rva2Vucy5hY2Nlc3NUb2tlbik7XG4gICAgICBleHBlY3QocmVzdWx0LnJlZnJlc2hUb2tlbikudG9CZShtb2NrVG9rZW5zLnJlZnJlc2hUb2tlbik7XG4gICAgICBleHBlY3QocmVzdWx0LmV4cGlyZXNJbikudG9CZShtb2NrVG9rZW5zLmV4cGlyZXNJbik7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9