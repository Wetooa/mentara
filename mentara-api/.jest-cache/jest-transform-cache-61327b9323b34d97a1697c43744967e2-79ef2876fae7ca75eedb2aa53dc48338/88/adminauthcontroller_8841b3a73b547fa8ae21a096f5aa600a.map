{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/admin-auth.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/admin-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  Post,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Req,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../decorators/current-user-role.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterAdminDto,\n  LoginDto,\n  AdminAuthResponse,\n} from '../types';\n\n// Import validation schemas from local validation\nimport {\n  RegisterAdminDtoSchema,\n  LoginDtoSchema,\n} from '../validation';\nimport { AdminAuthService } from '../services/admin-auth.service';\nimport { Request } from 'express';\n\n@Controller('auth/admin')\nexport class AdminAuthController {\n  constructor(private readonly adminAuthService: AdminAuthService) {}\n\n  @Post('create-account')\n  @UseGuards(JwtAuthGuard)\n  @Throttle({ default: { limit: 3, ttl: 600000 } }) // 3 admin creations per 10 minutes\n  @HttpCode(HttpStatus.CREATED)\n  async createAdminAccount(\n    @CurrentUserRole() currentUserRole: string,\n    @Body(new ZodValidationPipe(RegisterAdminDtoSchema))\n    registerDto: RegisterAdminDto,\n  ) {\n    // Only super admins can create other admins\n    if (currentUserRole !== 'admin') {\n      throw new ForbiddenException('Only admins can create admin accounts');\n    }\n\n    const result = await this.adminAuthService.createAdminAccount(\n      registerDto.email,\n      registerDto.password,\n      registerDto.firstName,\n      registerDto.lastName,\n      (registerDto as any).adminLevel || 'admin',\n      (registerDto as any).permissions || [],\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName,\n        lastName: result.user.lastName,\n        role: result.user.role as any,\n        isEmailVerified: result.user.emailVerified ?? false,\n        createdAt: result.user.createdAt,\n        updatedAt: result.user.updatedAt,\n      },\n      message: result.message,\n    };\n  }\n\n  // REMOVED: Duplicate login route - use universal /auth/login instead\n  // This was redundant with AuthController.login() which handles all roles\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string): Promise<any> {\n    // TODO: Add AdminProfileResponse schema\n    return this.adminAuthService.getAdminProfile(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('permissions')\n  async getPermissions(@CurrentUserId() userId: string) {\n    return this.adminAuthService.getAdminPermissions(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('dashboard-stats')\n  async getDashboardStats(@CurrentUserId() userId: string) {\n    return this.adminAuthService.getAdminDashboardStats(userId);\n  }\n}\n"],"version":3}