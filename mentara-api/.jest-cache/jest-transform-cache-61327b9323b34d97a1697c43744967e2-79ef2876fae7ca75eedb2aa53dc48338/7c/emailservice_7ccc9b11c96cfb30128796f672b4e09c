ff47c0a07210a203a7828b192d6c89d5
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var EmailService_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.EmailService = void 0;
const common_1 = require("@nestjs/common");
const nodejs_1 = require("@emailjs/nodejs");
let EmailService = EmailService_1 = class EmailService {
    logger = new common_1.Logger(EmailService_1.name);
    isInitialized = false;
    // EmailJS configuration
    config = {
        serviceId: process.env.EMAILJS_SERVICE_ID ?? '',
        templateId: process.env.EMAILJS_TEMPLATE_ID ?? '',
        publicKey: process.env.EMAILJS_PUBLIC_KEY ?? '',
        privateKey: process.env.EMAILJS_PRIVATE_KEY ?? '',
    };
    constructor() {
        this.initializeEmailJS();
    }
    initializeEmailJS() {
        try {
            if (this.config.publicKey) {
                const initConfig = {
                    publicKey: this.config.publicKey,
                };
                // Add private key if available for enhanced security
                if (this.config.privateKey) {
                    initConfig.privateKey = this.config.privateKey;
                    this.logger.log('EmailJS initializing with private key for enhanced security');
                }
                nodejs_1.default.init(initConfig);
                this.isInitialized = true;
                this.logger.log('EmailJS initialized successfully');
            }
            else {
                this.logger.warn('EmailJS public key not found in environment variables');
            }
        }
        catch (error) {
            this.logger.error('Failed to initialize EmailJS:', error);
        }
    }
    /**
     * Send OTP email for registration or verification
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param subject - Email subject line
     * @param otpCode - OTP code (optional, will generate if not provided)
     * @param expiresIn - Expiry time (optional, defaults to "10 minutes")
     * @returns Promise with operation result
     */
    async sendOTP(email, name, subject, otpCode, expiresIn = '10 minutes') {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const otp = otpCode ?? this.generateOtp(6);
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #436B00; text-align: center; margin-bottom: 30px;">Mentara - Email Verification</h1>
        <h2 style="color: #1F2937; text-align: center;">Your verification code is:</h2>
        <div style="background-color: #436B00; color: white; font-size: 32px; font-weight: bold; text-align: center; padding: 20px; margin: 20px 0; border-radius: 8px; letter-spacing: 4px;">${otp}</div>
        <p style="color: #4B5563; text-align: center; margin: 20px 0;">This code will expire in ${expiresIn}.</p>
        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">If you didn't request this verification, please ignore this email.</p>
      </div>
    </div>`;
            const templateParams = {
                email,
                name,
                subject,
                html,
                otp,
                expiresIn,
                appUrl: process.env.APP_URL ?? 'https://mentara.com',
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ OTP email sent successfully:', { email, subject });
            return {
                success: true,
                status: 'success',
                message: 'OTP email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send OTP email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send OTP email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send therapist registration success email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param subject - Email subject line
     * @returns Promise with operation result
     */
    async sendTherapistRegistrationSuccess(email, name, subject) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #10B981; text-align: center; margin-bottom: 30px;">Welcome to Mentara!</h1>
        <p style="color: #1F2937; font-size: 16px;">Thank you, ${name}, for registering as a therapist with Mentara.</p>
        <p style="color: #4B5563;">Your application has been received and is currently under review. We will notify you once the review process is complete.</p>
        <div style="background-color: #F0FDF4; border-left: 4px solid #10B981; padding: 16px; margin: 20px 0;">
          <p style="color: #065F46; margin: 0; font-weight: 500;">Next Steps:</p>
          <ul style="color: #065F46; margin: 10px 0;">
            <li>Complete your profile if you haven't already</li>
            <li>Upload required documents</li>
            <li>Wait for admin approval</li>
          </ul>
        </div>
        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">Thank you for joining our mental health community.</p>
      </div>
    </div>`;
            const templateParams = {
                email,
                name,
                subject,
                html,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Therapist registration success email sent:', {
                email,
                subject,
            });
            return {
                success: true,
                status: 'success',
                message: 'Therapist registration success email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send therapist registration success email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send therapist registration success email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send therapist approved email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param subject - Email subject line
     * @returns Promise with operation result
     */
    async sendTherapistApproved(email, name, subject, password = '') {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const appUrl = process.env.APP_URL ?? 'https://mentara.com';
            const html = `
<div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
  <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h1 style="color: #10B981; text-align: center; margin-bottom: 30px;">üéâ Congratulations! You're Approved!</h1>
    <p style="color: #1F2937; font-size: 16px;">Great news, ${name}! Your therapist application has been approved.</p>
    <p style="color: #4B5563;">You can now start accepting clients and providing mental health services through the Mentara platform.</p>
    
    ${password
                ? `
    <div style="background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 16px; margin: 20px 0; border-radius: 6px;">
      <p style="color: #92400E; margin: 0; font-weight: 500;">üîê Your Login Credentials:</p>
      <p style="color: #92400E; margin: 10px 0 5px 0;"><strong>Email:</strong> ${email}</p>
      <p style="color: #92400E; margin: 5px 0;"><strong>Password:</strong> <code style="background-color: #FEF3C7; padding: 2px 6px; border-radius: 4px; font-family: monospace;">${password}</code></p>
      <p style="color: #92400E; margin: 10px 0 0 0; font-size: 14px;">‚ö†Ô∏è Please change your password after your first login for security.</p>
    </div>
    `
                : ''}
    
    <div style="background-color: #F0FDF4; border-left: 4px solid #10B981; padding: 16px; margin: 20px 0;">
      <p style="color: #065F46; margin: 0; font-weight: 500;">You can now:</p>
      <ul style="color: #065F46; margin: 10px 0;">
        <li>Complete your therapist profile</li>
        <li>Set your availability</li>
        <li>Start accepting client bookings</li>
        <li>Access the therapist dashboard</li>
      </ul>
    </div>
    <div style="text-align: center; margin: 30px 0;">
      <a href="${appUrl}/auth/sign-in" style="background-color: #436B00; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500; margin-right: 10px;">Login Now</a>
      <a href="${appUrl}/therapist/dashboard" style="background-color: #10B981; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500;">Go to Dashboard</a>
    </div>
    <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">Welcome to the Mentara therapist community!</p>
  </div>
</div>`;
            const templateParams = {
                email,
                name,
                subject,
                html,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Therapist approved email sent:', { email, subject });
            return {
                success: true,
                status: 'success',
                message: 'Therapist approved email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send therapist approved email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send therapist approved email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send therapist denied email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param subject - Email subject line
     * @returns Promise with operation result
     */
    async sendTherapistDenied(email, name, subject) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #EF4444; text-align: center; margin-bottom: 30px;">Application Update</h1>
        <p style="color: #1F2937; font-size: 16px;">Dear ${name}, thank you for your interest in becoming a therapist with Mentara.</p>
        <p style="color: #4B5563;">After careful review, we regret to inform you that your application has not been approved at this time.</p>
        <div style="background-color: #FEF2F2; border-left: 4px solid #EF4444; padding: 16px; margin: 20px 0;">
          <p style="color: #991B1B; margin: 0; font-weight: 500;">Common reasons for denial:</p>
          <ul style="color: #991B1B; margin: 10px 0;">
            <li>Incomplete documentation</li>
            <li>Licensing requirements not met</li>
            <li>Application did not meet our current criteria</li>
          </ul>
        </div>
        <p style="color: #4B5563;">You're welcome to reapply in the future once any issues have been addressed.</p>
        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">Thank you for your understanding.</p>
      </div>
    </div>`;
            const templateParams = {
                email,
                name,
                subject,
                html,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Therapist denied email sent:', { email, subject });
            return {
                success: true,
                status: 'success',
                message: 'Therapist denied email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send therapist denied email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send therapist denied email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send password reset email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param subject - Email subject line
     * @param resetLink - Password reset link
     * @returns Promise with operation result
     */
    async sendPasswordReset(email, name, subject, resetLink) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #436B00; text-align: center; margin-bottom: 30px;">Reset Your Password</h1>
        <p style="color: #1F2937; font-size: 16px;">Hello ${name}, we received a request to reset your password for your Mentara account.</p>
        <p style="color: #4B5563;">Click the button below to reset your password:</p>
        <div style="text-align: center; margin: 30px 0;">
          <a href="${resetLink}" style="background-color: #436B00; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500; display: inline-block;">Reset Password</a>
        </div>
        <p style="color: #6B7280; font-size: 14px;">If you didn't request this password reset, please ignore this email. Your password will remain unchanged.</p>
        <p style="color: #6B7280; font-size: 14px;">For security reasons, this link will expire in 1 hour.</p>
      </div>
    </div>`;
            const templateParams = {
                email,
                name,
                subject,
                html,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Password reset email sent:', { email, subject });
            return {
                success: true,
                status: 'success',
                message: 'Password reset email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send password reset email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send password reset email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send password reset success confirmation email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param subject - Email subject line
     * @returns Promise with operation result
     */
    async sendPasswordResetSuccess(email, name, subject) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const appUrl = process.env.APP_URL || 'https://mentara.com';
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #10B981; text-align: center; margin-bottom: 30px;">‚úÖ Password Reset Successful</h1>
        <p style="color: #1F2937; font-size: 16px;">Hello ${name}, your password has been successfully reset.</p>
        <p style="color: #4B5563;">You can now log in to your Mentara account using your new password.</p>
        <div style="background-color: #F0FDF4; border-left: 4px solid #10B981; padding: 16px; margin: 20px 0;">
          <p style="color: #065F46; margin: 0; font-weight: 500;">Security Tip:</p>
          <p style="color: #065F46; margin: 10px 0 0 0;">Make sure to use a strong, unique password and keep it secure.</p>
        </div>
        <div style="text-align: center; margin: 30px 0;">
          <a href="${appUrl}/auth/login" style="background-color: #436B00; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500;">Login to Your Account</a>
        </div>
        <p style="color: #6B7280; font-size: 14px; text-align: center;">If you didn't make this change, please contact our support team immediately.</p>
      </div>
    </div>`;
            const templateParams = {
                email,
                name,
                subject,
                html,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Password reset success email sent:', {
                email,
                subject,
            });
            return {
                success: true,
                status: 'success',
                message: 'Password reset success email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send password reset success email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send password reset success email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send meeting booking confirmation email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param meetingDetails - Meeting information
     * @returns Promise with operation result
     */
    async sendMeetingBookingConfirmation(email, name, meetingDetails) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const startTimeFormatted = meetingDetails.startTime.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                timeZoneName: 'short',
            });
            const appUrl = process.env.APP_URL || 'https://mentara.com';
            const meetingUrl = meetingDetails.meetingUrl ||
                `${appUrl}/meeting/${meetingDetails.meetingId}`;
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #436B00; text-align: center; margin-bottom: 30px;">üéâ Meeting Confirmed!</h1>
        <p style="color: #1F2937; font-size: 16px;">Hello ${name}, your therapy session has been successfully booked.</p>
        
        <div style="background-color: #F0FDF4; border-left: 4px solid #10B981; padding: 20px; margin: 20px 0; border-radius: 6px;">
          <h3 style="color: #065F46; margin: 0 0 15px 0;">Meeting Details:</h3>
          <p style="color: #065F46; margin: 5px 0;"><strong>Session:</strong> ${meetingDetails.title}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Date & Time:</strong> ${startTimeFormatted}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Duration:</strong> ${meetingDetails.duration} minutes</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Therapist:</strong> ${meetingDetails.therapistName}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Client:</strong> ${meetingDetails.clientName}</p>
          ${meetingDetails.amount ? `<p style="color: #065F46; margin: 5px 0;"><strong>Payment:</strong> ${meetingDetails.currency || 'USD'} $${meetingDetails.amount}</p>` : ''}
        </div>

        <div style="text-align: center; margin: 30px 0;">
          <a href="${meetingUrl}" style="background-color: #436B00; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500; display: inline-block;">Join Meeting</a>
        </div>

        <div style="background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 16px; margin: 20px 0;">
          <p style="color: #92400E; margin: 0; font-weight: 500;">üìÖ Add to Calendar:</p>
          <p style="color: #92400E; margin: 10px 0 0 0;">Save this meeting to your calendar so you don't miss it!</p>
        </div>

        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">
          We'll send you a reminder 24 hours before your session. If you need to reschedule, please do so at least 24 hours in advance.
        </p>
      </div>
    </div>`;
            const subject = `Meeting Confirmed - ${meetingDetails.title} on ${startTimeFormatted}`;
            const templateParams = {
                email,
                name,
                subject,
                html,
                meetingId: meetingDetails.meetingId,
                meetingUrl,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Meeting booking confirmation email sent:', {
                email,
                meetingId: meetingDetails.meetingId,
            });
            return {
                success: true,
                status: 'success',
                message: 'Meeting booking confirmation email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send meeting booking confirmation email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send meeting booking confirmation email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send upcoming meeting reminder email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param meetingDetails - Meeting information
     * @param reminderType - Type of reminder (24h, 1h, etc.)
     * @returns Promise with operation result
     */
    async sendMeetingReminder(email, name, meetingDetails, reminderType = '24h') {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const startTimeFormatted = meetingDetails.startTime.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                timeZoneName: 'short',
            });
            const reminderText = {
                '24h': 'tomorrow',
                '1h': 'in 1 hour',
                '15m': 'in 15 minutes',
            }[reminderType];
            const urgencyColor = {
                '24h': '#436B00',
                '1h': '#F59E0B',
                '15m': '#EF4444',
            }[reminderType];
            const appUrl = process.env.APP_URL || 'https://mentara.com';
            const meetingUrl = meetingDetails.meetingUrl ||
                `${appUrl}/meeting/${meetingDetails.meetingId}`;
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: ${urgencyColor}; text-align: center; margin-bottom: 30px;">‚è∞ Meeting Reminder</h1>
        <p style="color: #1F2937; font-size: 16px;">Hello ${name}, this is a friendly reminder that your therapy session is ${reminderText}.</p>
        
        <div style="background-color: #F0FDF4; border-left: 4px solid: ${urgencyColor}; padding: 20px; margin: 20px 0; border-radius: 6px;">
          <h3 style="color: #065F46; margin: 0 0 15px 0;">Upcoming Session:</h3>
          <p style="color: #065F46; margin: 5px 0;"><strong>Session:</strong> ${meetingDetails.title}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Date & Time:</strong> ${startTimeFormatted}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Duration:</strong> ${meetingDetails.duration} minutes</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Therapist:</strong> ${meetingDetails.therapistName}</p>
        </div>

        <div style="text-align: center; margin: 30px 0;">
          <a href="${meetingUrl}" style="background-color: ${urgencyColor}; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500; display: inline-block;">Join Meeting</a>
        </div>

        <div style="background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 16px; margin: 20px 0;">
          <p style="color: #92400E; margin: 0; font-weight: 500;">üí° Preparation Tips:</p>
          <ul style="color: #92400E; margin: 10px 0;">
            <li>Ensure you have a stable internet connection</li>
            <li>Find a quiet, private space for your session</li>
            <li>Test your camera and microphone beforehand</li>
            <li>Have any questions or topics ready to discuss</li>
          </ul>
        </div>

        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">
          Looking forward to seeing you in the session. If you need to reschedule, please contact us as soon as possible.
        </p>
      </div>
    </div>`;
            const subject = `Reminder: ${meetingDetails.title} - ${reminderText}`;
            const templateParams = {
                email,
                name,
                subject,
                html,
                meetingId: meetingDetails.meetingId,
                meetingUrl,
                reminderType,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Meeting reminder email sent:', {
                email,
                meetingId: meetingDetails.meetingId,
                reminderType,
            });
            return {
                success: true,
                status: 'success',
                message: 'Meeting reminder email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send meeting reminder email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send meeting reminder email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send meeting cancellation notification email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param meetingDetails - Meeting information
     * @param cancellationReason - Reason for cancellation
     * @param cancelledBy - Who cancelled the meeting (client/therapist)
     * @returns Promise with operation result
     */
    async sendMeetingCancellation(email, name, meetingDetails, cancellationReason, cancelledBy) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const startTimeFormatted = meetingDetails.startTime.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                timeZoneName: 'short',
            });
            const appUrl = process.env.APP_URL || 'https://mentara.com';
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #EF4444; text-align: center; margin-bottom: 30px;">‚ùå Meeting Cancelled</h1>
        <p style="color: #1F2937; font-size: 16px;">Hello ${name}, we're writing to inform you that your upcoming therapy session has been cancelled.</p>
        
        <div style="background-color: #FEF2F2; border-left: 4px solid #EF4444; padding: 20px; margin: 20px 0; border-radius: 6px;">
          <h3 style="color: #991B1B; margin: 0 0 15px 0;">Cancelled Session:</h3>
          <p style="color: #991B1B; margin: 5px 0;"><strong>Session:</strong> ${meetingDetails.title}</p>
          <p style="color: #991B1B; margin: 5px 0;"><strong>Date & Time:</strong> ${startTimeFormatted}</p>
          <p style="color: #991B1B; margin: 5px 0;"><strong>Therapist:</strong> ${meetingDetails.therapistName}</p>
          <p style="color: #991B1B; margin: 5px 0;"><strong>Cancelled by:</strong> ${cancelledBy === 'client' ? 'Client' : 'Therapist'}</p>
          <p style="color: #991B1B; margin: 5px 0;"><strong>Reason:</strong> ${cancellationReason}</p>
        </div>

        <div style="background-color: #F0FDF4; border-left: 4px solid #10B981; padding: 16px; margin: 20px 0;">
          <p style="color: #065F46; margin: 0; font-weight: 500;">üìÖ Rescheduling:</p>
          <p style="color: #065F46; margin: 10px 0 0 0;">You can book a new session at your convenience through your dashboard.</p>
        </div>

        <div style="text-align: center; margin: 30px 0;">
          <a href="${appUrl}/dashboard" style="background-color: #436B00; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500; display: inline-block;">Book New Session</a>
        </div>

        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">
          If you were charged for this session, any applicable refunds will be processed within 3-5 business days.
        </p>
      </div>
    </div>`;
            const subject = `Meeting Cancelled - ${meetingDetails.title} on ${startTimeFormatted}`;
            const templateParams = {
                email,
                name,
                subject,
                html,
                meetingId: meetingDetails.meetingId,
                cancellationReason,
                cancelledBy,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Meeting cancellation email sent:', {
                email,
                meetingId: meetingDetails.meetingId,
                cancelledBy,
            });
            return {
                success: true,
                status: 'success',
                message: 'Meeting cancellation email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send meeting cancellation email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send meeting cancellation email: ${errorMessage}`,
            };
        }
    }
    /**
     * Send payment confirmation email
     * @param email - Recipient email address
     * @param name - Recipient name
     * @param paymentDetails - Payment information
     * @returns Promise with operation result
     */
    async sendPaymentConfirmation(email, name, paymentDetails) {
        if (!this.isInitialized) {
            return {
                success: false,
                status: 'error',
                message: 'EmailJS not properly initialized. Check environment variables.',
            };
        }
        try {
            const meetingDateFormatted = paymentDetails.meetingDate?.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
            });
            const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f9fafb;">
      <div style="background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h1 style="color: #10B981; text-align: center; margin-bottom: 30px;">‚úÖ Payment Confirmed</h1>
        <p style="color: #1F2937; font-size: 16px;">Hello ${name}, your payment has been successfully processed.</p>
        
        <div style="background-color: #F0FDF4; border-left: 4px solid #10B981; padding: 20px; margin: 20px 0; border-radius: 6px;">
          <h3 style="color: #065F46; margin: 0 0 15px 0;">Payment Details:</h3>
          <p style="color: #065F46; margin: 5px 0;"><strong>Amount:</strong> ${paymentDetails.currency} $${paymentDetails.amount}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Therapist:</strong> ${paymentDetails.therapistName}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Payment Method:</strong> ${paymentDetails.paymentMethod}</p>
          <p style="color: #065F46; margin: 5px 0;"><strong>Transaction ID:</strong> ${paymentDetails.paymentId}</p>
          ${paymentDetails.meetingTitle ? `<p style="color: #065F46; margin: 5px 0;"><strong>Session:</strong> ${paymentDetails.meetingTitle}</p>` : ''}
          ${meetingDateFormatted ? `<p style="color: #065F46; margin: 5px 0;"><strong>Session Date:</strong> ${meetingDateFormatted}</p>` : ''}
        </div>

        <div style="background-color: #FEF3C7; border-left: 4px solid #F59E0B; padding: 16px; margin: 20px 0;">
          <p style="color: #92400E; margin: 0; font-weight: 500;">üìÑ Receipt:</p>
          <p style="color: #92400E; margin: 10px 0 0 0;">Keep this email as your payment receipt for your records.</p>
        </div>

        <p style="color: #6B7280; font-size: 14px; text-align: center; margin-top: 30px;">
          Thank you for choosing Mentara for your mental health care. If you have any questions about this payment, please contact our support team.
        </p>
      </div>
    </div>`;
            const subject = `Payment Confirmation - ${paymentDetails.currency} $${paymentDetails.amount} to ${paymentDetails.therapistName}`;
            const templateParams = {
                email,
                name,
                subject,
                html,
                paymentId: paymentDetails.paymentId,
                amount: paymentDetails.amount,
                currency: paymentDetails.currency,
            };
            await nodejs_1.default.send(this.config.serviceId, this.config.templateId, templateParams);
            this.logger.log('‚úÖ Payment confirmation email sent:', {
                email,
                paymentId: paymentDetails.paymentId,
                amount: paymentDetails.amount,
            });
            return {
                success: true,
                status: 'success',
                message: 'Payment confirmation email sent successfully',
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            this.logger.error('‚ùå Failed to send payment confirmation email:', errorMessage);
            return {
                success: false,
                status: 'error',
                message: `Failed to send payment confirmation email: ${errorMessage}`,
            };
        }
    }
    /**
     * Generate OTP code
     */
    generateOtp(length = 6) {
        const digits = '0123456789';
        let otp = '';
        for (let i = 0; i < length; i++) {
            otp += digits[Math.floor(Math.random() * 10)];
        }
        return otp;
    }
    /**
     * Format expiry time for email display
     */
    formatExpiryTime(minutes) {
        if (minutes < 60) {
            return `${minutes} minute${minutes !== 1 ? 's' : ''}`;
        }
        const hours = Math.floor(minutes / 60);
        const remainingMinutes = minutes % 60;
        let timeString = `${hours} hour${hours !== 1 ? 's' : ''}`;
        if (remainingMinutes > 0) {
            timeString += ` and ${remainingMinutes} minute${remainingMinutes !== 1 ? 's' : ''}`;
        }
        return timeString;
    }
    /**
     * Get configuration status
     */
    getConfigurationStatus() {
        return {
            isInitialized: this.isInitialized,
            hasServiceId: !!this.config.serviceId,
            hasTemplateId: !!this.config.templateId,
            hasPublicKey: !!this.config.publicKey,
            hasPrivateKey: !!this.config.privateKey,
        };
    }
};
exports.EmailService = EmailService;
exports.EmailService = EmailService = EmailService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], EmailService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2VtYWlsL2VtYWlsLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUFvRDtBQUNwRCw0Q0FBc0M7QUFJL0IsSUFBTSxZQUFZLG9CQUFsQixNQUFNLFlBQVk7SUFDTixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsY0FBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hELGFBQWEsR0FBRyxLQUFLLENBQUM7SUFFOUIsd0JBQXdCO0lBQ1AsTUFBTSxHQUFHO1FBQ3hCLFNBQVMsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLEVBQUU7UUFDL0MsVUFBVSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLElBQUksRUFBRTtRQUNqRCxTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsSUFBSSxFQUFFO1FBQy9DLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixJQUFJLEVBQUU7S0FDbEQsQ0FBQztJQUVGO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVPLGlCQUFpQjtRQUN2QixJQUFJLENBQUM7WUFDSCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQzFCLE1BQU0sVUFBVSxHQUFRO29CQUN0QixTQUFTLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTO2lCQUNqQyxDQUFDO2dCQUVGLHFEQUFxRDtnQkFDckQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO29CQUMzQixVQUFVLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDO29CQUMvQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYiw2REFBNkQsQ0FDOUQsQ0FBQztnQkFDSixDQUFDO2dCQUVELGdCQUFP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L3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9lbWFpbC9lbWFpbC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIExvZ2dlciB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCBlbWFpbGpzIGZyb20gJ0BlbWFpbGpzL25vZGVqcyc7XG5pbXBvcnQgdHlwZSB7IEVtYWlsUmVzcG9uc2UgfSBmcm9tICcuLi9hdXRoL3R5cGVzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEVtYWlsU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihFbWFpbFNlcnZpY2UubmFtZSk7XG4gIHByaXZhdGUgaXNJbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIC8vIEVtYWlsSlMgY29uZmlndXJhdGlvblxuICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZyA9IHtcbiAgICBzZXJ2aWNlSWQ6IHByb2Nlc3MuZW52LkVNQUlMSlNfU0VSVklDRV9JRCA/PyAnJyxcbiAgICB0ZW1wbGF0ZUlkOiBwcm9jZXNzLmVudi5FTUFJTEpTX1RFTVBMQVRFX0lEID8/ICcnLFxuICAgIHB1YmxpY0tleTogcHJvY2Vzcy5lbnYuRU1BSUxKU19QVUJMSUNfS0VZID8/ICcnLFxuICAgIHByaXZhdGVLZXk6IHByb2Nlc3MuZW52LkVNQUlMSlNfUFJJVkFURV9LRVkgPz8gJycsXG4gIH07XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplRW1haWxKUygpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplRW1haWxKUygpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMuY29uZmlnLnB1YmxpY0tleSkge1xuICAgICAgICBjb25zdCBpbml0Q29uZmlnOiBhbnkgPSB7XG4gICAgICAgICAgcHVibGljS2V5OiB0aGlzLmNvbmZpZy5wdWJsaWNLZXksXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIHByaXZhdGUga2V5IGlmIGF2YWlsYWJsZSBmb3IgZW5oYW5jZWQgc2VjdXJpdHlcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnByaXZhdGVLZXkpIHtcbiAgICAgICAgICBpbml0Q29uZmlnLnByaXZhdGVLZXkgPSB0aGlzLmNvbmZpZy5wcml2YXRlS2V5O1xuICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgICAgICdFbWFpbEpTIGluaXRpYWxpemluZyB3aXRoIHByaXZhdGUga2V5IGZvciBlbmhhbmNlZCBzZWN1cml0eScsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVtYWlsanMuaW5pdChpbml0Q29uZmlnKTtcbiAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdFbWFpbEpTIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICAnRW1haWxKUyBwdWJsaWMga2V5IG5vdCBmb3VuZCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMnLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgRW1haWxKUzonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgT1RQIGVtYWlsIGZvciByZWdpc3RyYXRpb24gb3IgdmVyaWZpY2F0aW9uXG4gICAqIEBwYXJhbSBlbWFpbCAtIFJlY2lwaWVudCBlbWFpbCBhZGRyZXNzXG4gICAqIEBwYXJhbSBuYW1lIC0gUmVjaXBpZW50IG5hbWVcbiAgICogQHBhcmFtIHN1YmplY3QgLSBFbWFpbCBzdWJqZWN0IGxpbmVcbiAgICogQHBhcmFtIG90cENvZGUgLSBPVFAgY29kZSAob3B0aW9uYWwsIHdpbGwgZ2VuZXJhdGUgaWYgbm90IHByb3ZpZGVkKVxuICAgKiBAcGFyYW0gZXhwaXJlc0luIC0gRXhwaXJ5IHRpbWUgKG9wdGlvbmFsLCBkZWZhdWx0cyB0byBcIjEwIG1pbnV0ZXNcIilcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIG9wZXJhdGlvbiByZXN1bHRcbiAgICovXG4gIGFzeW5jIHNlbmRPVFAoXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgc3ViamVjdDogc3RyaW5nLFxuICAgIG90cENvZGU/OiBzdHJpbmcsXG4gICAgZXhwaXJlc0luOiBzdHJpbmcgPSAnMTAgbWludXRlcycsXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdFbWFpbEpTIG5vdCBwcm9wZXJseSBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdHAgPSBvdHBDb2RlID8/IHRoaXMuZ2VuZXJhdGVPdHAoNik7XG4gICAgICBjb25zdCBodG1sID0gYFxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvOyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmYWZiO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiA0MHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7XCI+XG4gICAgICAgIDxoMSBzdHlsZT1cImNvbG9yOiAjNDM2QjAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDMwcHg7XCI+TWVudGFyYSAtIEVtYWlsIFZlcmlmaWNhdGlvbjwvaDE+XG4gICAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjMUYyOTM3OyB0ZXh0LWFsaWduOiBjZW50ZXI7XCI+WW91ciB2ZXJpZmljYXRpb24gY29kZSBpczo8L2gyPlxuICAgICAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogIzQzNkIwMDsgY29sb3I6IHdoaXRlOyBmb250LXNpemU6IDMycHg7IGZvbnQtd2VpZ2h0OiBib2xkOyB0ZXh0LWFsaWduOiBjZW50ZXI7IHBhZGRpbmc6IDIwcHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItcmFkaXVzOiA4cHg7IGxldHRlci1zcGFjaW5nOiA0cHg7XCI+JHtvdHB9PC9kaXY+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM0QjU1NjM7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAyMHB4IDA7XCI+VGhpcyBjb2RlIHdpbGwgZXhwaXJlIGluICR7ZXhwaXJlc0lufS48L3A+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2QjcyODA7IGZvbnQtc2l6ZTogMTRweDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tdG9wOiAzMHB4O1wiPklmIHlvdSBkaWRuJ3QgcmVxdWVzdCB0aGlzIHZlcmlmaWNhdGlvbiwgcGxlYXNlIGlnbm9yZSB0aGlzIGVtYWlsLjwvcD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PmA7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlUGFyYW1zID0ge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgc3ViamVjdCxcbiAgICAgICAgaHRtbCxcbiAgICAgICAgb3RwLFxuICAgICAgICBleHBpcmVzSW4sXG4gICAgICAgIGFwcFVybDogcHJvY2Vzcy5lbnYuQVBQX1VSTCA/PyAnaHR0cHM6Ly9tZW50YXJhLmNvbScsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBlbWFpbGpzLnNlbmQoXG4gICAgICAgIHRoaXMuY29uZmlnLnNlcnZpY2VJZCxcbiAgICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVJZCxcbiAgICAgICAgdGVtcGxhdGVQYXJhbXMsXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coJ+KchSBPVFAgZW1haWwgc2VudCBzdWNjZXNzZnVsbHk6JywgeyBlbWFpbCwgc3ViamVjdCB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXG4gICAgICAgIG1lc3NhZ2U6ICdPVFAgZW1haWwgc2VudCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcign4p2MIEZhaWxlZCB0byBzZW5kIE9UUCBlbWFpbDonLCBlcnJvck1lc3NhZ2UpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHNlbmQgT1RQIGVtYWlsOiAke2Vycm9yTWVzc2FnZX1gLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCB0aGVyYXBpc3QgcmVnaXN0cmF0aW9uIHN1Y2Nlc3MgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gc3ViamVjdCAtIEVtYWlsIHN1YmplY3QgbGluZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFRoZXJhcGlzdFJlZ2lzdHJhdGlvblN1Y2Nlc3MoXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgc3ViamVjdDogc3RyaW5nLFxuICApOiBQcm9taXNlPEVtYWlsUmVzcG9uc2U+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAnRW1haWxKUyBub3QgcHJvcGVybHkgaW5pdGlhbGl6ZWQuIENoZWNrIGVudmlyb25tZW50IHZhcmlhYmxlcy4nLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgaHRtbCA9IGBcbiAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZmFmYjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgcGFkZGluZzogNDBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpO1wiPlxuICAgICAgICA8aDEgc3R5bGU9XCJjb2xvcjogIzEwQjk4MTsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAzMHB4O1wiPldlbGNvbWUgdG8gTWVudGFyYSE8L2gxPlxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMUYyOTM3OyBmb250LXNpemU6IDE2cHg7XCI+VGhhbmsgeW91LCAke25hbWV9LCBmb3IgcmVnaXN0ZXJpbmcgYXMgYSB0aGVyYXBpc3Qgd2l0aCBNZW50YXJhLjwvcD5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzRCNTU2MztcIj5Zb3VyIGFwcGxpY2F0aW9uIGhhcyBiZWVuIHJlY2VpdmVkIGFuZCBpcyBjdXJyZW50bHkgdW5kZXIgcmV2aWV3LiBXZSB3aWxsIG5vdGlmeSB5b3Ugb25jZSB0aGUgcmV2aWV3IHByb2Nlc3MgaXMgY29tcGxldGUuPC9wPlxuICAgICAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogI0YwRkRGNDsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjMTBCOTgxOyBwYWRkaW5nOiAxNnB4OyBtYXJnaW46IDIwcHggMDtcIj5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMDY1RjQ2OyBtYXJnaW46IDA7IGZvbnQtd2VpZ2h0OiA1MDA7XCI+TmV4dCBTdGVwczo8L3A+XG4gICAgICAgICAgPHVsIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogMTBweCAwO1wiPlxuICAgICAgICAgICAgPGxpPkNvbXBsZXRlIHlvdXIgcHJvZmlsZSBpZiB5b3UgaGF2ZW4ndCBhbHJlYWR5PC9saT5cbiAgICAgICAgICAgIDxsaT5VcGxvYWQgcmVxdWlyZWQgZG9jdW1lbnRzPC9saT5cbiAgICAgICAgICAgIDxsaT5XYWl0IGZvciBhZG1pbiBhcHByb3ZhbDwvbGk+XG4gICAgICAgICAgPC91bD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2QjcyODA7IGZvbnQtc2l6ZTogMTRweDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tdG9wOiAzMHB4O1wiPlRoYW5rIHlvdSBmb3Igam9pbmluZyBvdXIgbWVudGFsIGhlYWx0aCBjb21tdW5pdHkuPC9wPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+YDtcblxuICAgICAgY29uc3QgdGVtcGxhdGVQYXJhbXMgPSB7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBuYW1lLFxuICAgICAgICBzdWJqZWN0LFxuICAgICAgICBodG1sLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZW1haWxqcy5zZW5kKFxuICAgICAgICB0aGlzLmNvbmZpZy5zZXJ2aWNlSWQsXG4gICAgICAgIHRoaXMuY29uZmlnLnRlbXBsYXRlSWQsXG4gICAgICAgIHRlbXBsYXRlUGFyYW1zLFxuICAgICAgKTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKCfinIUgVGhlcmFwaXN0IHJlZ2lzdHJhdGlvbiBzdWNjZXNzIGVtYWlsIHNlbnQ6Jywge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgc3ViamVjdCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgbWVzc2FnZTogJ1RoZXJhcGlzdCByZWdpc3RyYXRpb24gc3VjY2VzcyBlbWFpbCBzZW50IHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJztcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAn4p2MIEZhaWxlZCB0byBzZW5kIHRoZXJhcGlzdCByZWdpc3RyYXRpb24gc3VjY2VzcyBlbWFpbDonLFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHNlbmQgdGhlcmFwaXN0IHJlZ2lzdHJhdGlvbiBzdWNjZXNzIGVtYWlsOiAke2Vycm9yTWVzc2FnZX1gLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCB0aGVyYXBpc3QgYXBwcm92ZWQgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gc3ViamVjdCAtIEVtYWlsIHN1YmplY3QgbGluZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFRoZXJhcGlzdEFwcHJvdmVkKFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHN1YmplY3Q6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nID0gJycsXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdFbWFpbEpTIG5vdCBwcm9wZXJseSBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcHBVcmwgPSBwcm9jZXNzLmVudi5BUFBfVVJMID8/ICdodHRwczovL21lbnRhcmEuY29tJztcbiAgICAgIGNvbnN0IGh0bWwgPSBgXG48ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZmFmYjtcIj5cbiAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiA0MHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7XCI+XG4gICAgPGgxIHN0eWxlPVwiY29sb3I6ICMxMEI5ODE7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLWJvdHRvbTogMzBweDtcIj7wn46JIENvbmdyYXR1bGF0aW9ucyEgWW91J3JlIEFwcHJvdmVkITwvaDE+XG4gICAgPHAgc3R5bGU9XCJjb2xvcjogIzFGMjkzNzsgZm9udC1zaXplOiAxNnB4O1wiPkdyZWF0IG5ld3MsICR7bmFtZX0hIFlvdXIgdGhlcmFwaXN0IGFwcGxpY2F0aW9uIGhhcyBiZWVuIGFwcHJvdmVkLjwvcD5cbiAgICA8cCBzdHlsZT1cImNvbG9yOiAjNEI1NTYzO1wiPllvdSBjYW4gbm93IHN0YXJ0IGFjY2VwdGluZyBjbGllbnRzIGFuZCBwcm92aWRpbmcgbWVudGFsIGhlYWx0aCBzZXJ2aWNlcyB0aHJvdWdoIHRoZSBNZW50YXJhIHBsYXRmb3JtLjwvcD5cbiAgICBcbiAgICAke1xuICAgICAgcGFzc3dvcmRcbiAgICAgICAgPyBgXG4gICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICNGRUYzQzc7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgI0Y1OUUwQjsgcGFkZGluZzogMTZweDsgbWFyZ2luOiAyMHB4IDA7IGJvcmRlci1yYWRpdXM6IDZweDtcIj5cbiAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM5MjQwMEU7IG1hcmdpbjogMDsgZm9udC13ZWlnaHQ6IDUwMDtcIj7wn5SQIFlvdXIgTG9naW4gQ3JlZGVudGlhbHM6PC9wPlxuICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzkyNDAwRTsgbWFyZ2luOiAxMHB4IDAgNXB4IDA7XCI+PHN0cm9uZz5FbWFpbDo8L3N0cm9uZz4gJHtlbWFpbH08L3A+XG4gICAgICA8cCBzdHlsZT1cImNvbG9yOiAjOTI0MDBFOyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+UGFzc3dvcmQ6PC9zdHJvbmc+IDxjb2RlIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogI0ZFRjNDNzsgcGFkZGluZzogMnB4IDZweDsgYm9yZGVyLXJhZGl1czogNHB4OyBmb250LWZhbWlseTogbW9ub3NwYWNlO1wiPiR7cGFzc3dvcmR9PC9jb2RlPjwvcD5cbiAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM5MjQwMEU7IG1hcmdpbjogMTBweCAwIDAgMDsgZm9udC1zaXplOiAxNHB4O1wiPuKaoO+4jyBQbGVhc2UgY2hhbmdlIHlvdXIgcGFzc3dvcmQgYWZ0ZXIgeW91ciBmaXJzdCBsb2dpbiBmb3Igc2VjdXJpdHkuPC9wPlxuICAgIDwvZGl2PlxuICAgIGBcbiAgICAgICAgOiAnJ1xuICAgIH1cbiAgICBcbiAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogI0YwRkRGNDsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjMTBCOTgxOyBwYWRkaW5nOiAxNnB4OyBtYXJnaW46IDIwcHggMDtcIj5cbiAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogMDsgZm9udC13ZWlnaHQ6IDUwMDtcIj5Zb3UgY2FuIG5vdzo8L3A+XG4gICAgICA8dWwgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiAxMHB4IDA7XCI+XG4gICAgICAgIDxsaT5Db21wbGV0ZSB5b3VyIHRoZXJhcGlzdCBwcm9maWxlPC9saT5cbiAgICAgICAgPGxpPlNldCB5b3VyIGF2YWlsYWJpbGl0eTwvbGk+XG4gICAgICAgIDxsaT5TdGFydCBhY2NlcHRpbmcgY2xpZW50IGJvb2tpbmdzPC9saT5cbiAgICAgICAgPGxpPkFjY2VzcyB0aGUgdGhlcmFwaXN0IGRhc2hib2FyZDwvbGk+XG4gICAgICA8L3VsPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbjogMzBweCAwO1wiPlxuICAgICAgPGEgaHJlZj1cIiR7YXBwVXJsfS9hdXRoL3NpZ24taW5cIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICM0MzZCMDA7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC13ZWlnaHQ6IDUwMDsgbWFyZ2luLXJpZ2h0OiAxMHB4O1wiPkxvZ2luIE5vdzwvYT5cbiAgICAgIDxhIGhyZWY9XCIke2FwcFVybH0vdGhlcmFwaXN0L2Rhc2hib2FyZFwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogIzEwQjk4MTsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxMnB4IDI0cHg7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyLXJhZGl1czogNnB4OyBmb250LXdlaWdodDogNTAwO1wiPkdvIHRvIERhc2hib2FyZDwvYT5cbiAgICA8L2Rpdj5cbiAgICA8cCBzdHlsZT1cImNvbG9yOiAjNkI3MjgwOyBmb250LXNpemU6IDE0cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLXRvcDogMzBweDtcIj5XZWxjb21lIHRvIHRoZSBNZW50YXJhIHRoZXJhcGlzdCBjb21tdW5pdHkhPC9wPlxuICA8L2Rpdj5cbjwvZGl2PmA7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlUGFyYW1zID0ge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgc3ViamVjdCxcbiAgICAgICAgaHRtbCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGVtYWlsanMuc2VuZChcbiAgICAgICAgdGhpcy5jb25maWcuc2VydmljZUlkLFxuICAgICAgICB0aGlzLmNvbmZpZy50ZW1wbGF0ZUlkLFxuICAgICAgICB0ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZygn4pyFIFRoZXJhcGlzdCBhcHByb3ZlZCBlbWFpbCBzZW50OicsIHsgZW1haWwsIHN1YmplY3QgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBtZXNzYWdlOiAnVGhlcmFwaXN0IGFwcHJvdmVkIGVtYWlsIHNlbnQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICfinYwgRmFpbGVkIHRvIHNlbmQgdGhlcmFwaXN0IGFwcHJvdmVkIGVtYWlsOicsXG4gICAgICAgIGVycm9yTWVzc2FnZSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gc2VuZCB0aGVyYXBpc3QgYXBwcm92ZWQgZW1haWw6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHRoZXJhcGlzdCBkZW5pZWQgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gc3ViamVjdCAtIEVtYWlsIHN1YmplY3QgbGluZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFRoZXJhcGlzdERlbmllZChcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBzdWJqZWN0OiBzdHJpbmcsXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdFbWFpbEpTIG5vdCBwcm9wZXJseSBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBodG1sID0gYFxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvOyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmYWZiO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiA0MHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7XCI+XG4gICAgICAgIDxoMSBzdHlsZT1cImNvbG9yOiAjRUY0NDQ0OyB0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDMwcHg7XCI+QXBwbGljYXRpb24gVXBkYXRlPC9oMT5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzFGMjkzNzsgZm9udC1zaXplOiAxNnB4O1wiPkRlYXIgJHtuYW1lfSwgdGhhbmsgeW91IGZvciB5b3VyIGludGVyZXN0IGluIGJlY29taW5nIGEgdGhlcmFwaXN0IHdpdGggTWVudGFyYS48L3A+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM0QjU1NjM7XCI+QWZ0ZXIgY2FyZWZ1bCByZXZpZXcsIHdlIHJlZ3JldCB0byBpbmZvcm0geW91IHRoYXQgeW91ciBhcHBsaWNhdGlvbiBoYXMgbm90IGJlZW4gYXBwcm92ZWQgYXQgdGhpcyB0aW1lLjwvcD5cbiAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICNGRUYyRjI7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgI0VGNDQ0NDsgcGFkZGluZzogMTZweDsgbWFyZ2luOiAyMHB4IDA7XCI+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzk5MUIxQjsgbWFyZ2luOiAwOyBmb250LXdlaWdodDogNTAwO1wiPkNvbW1vbiByZWFzb25zIGZvciBkZW5pYWw6PC9wPlxuICAgICAgICAgIDx1bCBzdHlsZT1cImNvbG9yOiAjOTkxQjFCOyBtYXJnaW46IDEwcHggMDtcIj5cbiAgICAgICAgICAgIDxsaT5JbmNvbXBsZXRlIGRvY3VtZW50YXRpb248L2xpPlxuICAgICAgICAgICAgPGxpPkxpY2Vuc2luZyByZXF1aXJlbWVudHMgbm90IG1ldDwvbGk+XG4gICAgICAgICAgICA8bGk+QXBwbGljYXRpb24gZGlkIG5vdCBtZWV0IG91ciBjdXJyZW50IGNyaXRlcmlhPC9saT5cbiAgICAgICAgICA8L3VsPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzRCNTU2MztcIj5Zb3UncmUgd2VsY29tZSB0byByZWFwcGx5IGluIHRoZSBmdXR1cmUgb25jZSBhbnkgaXNzdWVzIGhhdmUgYmVlbiBhZGRyZXNzZWQuPC9wPlxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjNkI3MjgwOyBmb250LXNpemU6IDE0cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLXRvcDogMzBweDtcIj5UaGFuayB5b3UgZm9yIHlvdXIgdW5kZXJzdGFuZGluZy48L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5gO1xuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVBhcmFtcyA9IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHN1YmplY3QsXG4gICAgICAgIGh0bWwsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBlbWFpbGpzLnNlbmQoXG4gICAgICAgIHRoaXMuY29uZmlnLnNlcnZpY2VJZCxcbiAgICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVJZCxcbiAgICAgICAgdGVtcGxhdGVQYXJhbXMsXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coJ+KchSBUaGVyYXBpc3QgZGVuaWVkIGVtYWlsIHNlbnQ6JywgeyBlbWFpbCwgc3ViamVjdCB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXG4gICAgICAgIG1lc3NhZ2U6ICdUaGVyYXBpc3QgZGVuaWVkIGVtYWlsIHNlbnQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICfinYwgRmFpbGVkIHRvIHNlbmQgdGhlcmFwaXN0IGRlbmllZCBlbWFpbDonLFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHNlbmQgdGhlcmFwaXN0IGRlbmllZCBlbWFpbDogJHtlcnJvck1lc3NhZ2V9YCxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgcGFzc3dvcmQgcmVzZXQgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gc3ViamVjdCAtIEVtYWlsIHN1YmplY3QgbGluZVxuICAgKiBAcGFyYW0gcmVzZXRMaW5rIC0gUGFzc3dvcmQgcmVzZXQgbGlua1xuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFBhc3N3b3JkUmVzZXQoXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgc3ViamVjdDogc3RyaW5nLFxuICAgIHJlc2V0TGluazogc3RyaW5nLFxuICApOiBQcm9taXNlPEVtYWlsUmVzcG9uc2U+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAnRW1haWxKUyBub3QgcHJvcGVybHkgaW5pdGlhbGl6ZWQuIENoZWNrIGVudmlyb25tZW50IHZhcmlhYmxlcy4nLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgaHRtbCA9IGBcbiAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZmFmYjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgcGFkZGluZzogNDBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpO1wiPlxuICAgICAgICA8aDEgc3R5bGU9XCJjb2xvcjogIzQzNkIwMDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAzMHB4O1wiPlJlc2V0IFlvdXIgUGFzc3dvcmQ8L2gxPlxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMUYyOTM3OyBmb250LXNpemU6IDE2cHg7XCI+SGVsbG8gJHtuYW1lfSwgd2UgcmVjZWl2ZWQgYSByZXF1ZXN0IHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQgZm9yIHlvdXIgTWVudGFyYSBhY2NvdW50LjwvcD5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzRCNTU2MztcIj5DbGljayB0aGUgYnV0dG9uIGJlbG93IHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQ6PC9wPlxuICAgICAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW46IDMwcHggMDtcIj5cbiAgICAgICAgICA8YSBocmVmPVwiJHtyZXNldExpbmt9XCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjNDM2QjAwOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMjRweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGRpc3BsYXk6IGlubGluZS1ibG9jaztcIj5SZXNldCBQYXNzd29yZDwvYT5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2QjcyODA7IGZvbnQtc2l6ZTogMTRweDtcIj5JZiB5b3UgZGlkbid0IHJlcXVlc3QgdGhpcyBwYXNzd29yZCByZXNldCwgcGxlYXNlIGlnbm9yZSB0aGlzIGVtYWlsLiBZb3VyIHBhc3N3b3JkIHdpbGwgcmVtYWluIHVuY2hhbmdlZC48L3A+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2QjcyODA7IGZvbnQtc2l6ZTogMTRweDtcIj5Gb3Igc2VjdXJpdHkgcmVhc29ucywgdGhpcyBsaW5rIHdpbGwgZXhwaXJlIGluIDEgaG91ci48L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5gO1xuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVBhcmFtcyA9IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHN1YmplY3QsXG4gICAgICAgIGh0bWwsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBlbWFpbGpzLnNlbmQoXG4gICAgICAgIHRoaXMuY29uZmlnLnNlcnZpY2VJZCxcbiAgICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVJZCxcbiAgICAgICAgdGVtcGxhdGVQYXJhbXMsXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coJ+KchSBQYXNzd29yZCByZXNldCBlbWFpbCBzZW50OicsIHsgZW1haWwsIHN1YmplY3QgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBtZXNzYWdlOiAnUGFzc3dvcmQgcmVzZXQgZW1haWwgc2VudCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgJ+KdjCBGYWlsZWQgdG8gc2VuZCBwYXNzd29yZCByZXNldCBlbWFpbDonLFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHNlbmQgcGFzc3dvcmQgcmVzZXQgZW1haWw6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHBhc3N3b3JkIHJlc2V0IHN1Y2Nlc3MgY29uZmlybWF0aW9uIGVtYWlsXG4gICAqIEBwYXJhbSBlbWFpbCAtIFJlY2lwaWVudCBlbWFpbCBhZGRyZXNzXG4gICAqIEBwYXJhbSBuYW1lIC0gUmVjaXBpZW50IG5hbWVcbiAgICogQHBhcmFtIHN1YmplY3QgLSBFbWFpbCBzdWJqZWN0IGxpbmVcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIG9wZXJhdGlvbiByZXN1bHRcbiAgICovXG4gIGFzeW5jIHNlbmRQYXNzd29yZFJlc2V0U3VjY2VzcyhcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBzdWJqZWN0OiBzdHJpbmcsXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdFbWFpbEpTIG5vdCBwcm9wZXJseSBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhcHBVcmwgPSBwcm9jZXNzLmVudi5BUFBfVVJMIHx8ICdodHRwczovL21lbnRhcmEuY29tJztcbiAgICAgIGNvbnN0IGh0bWwgPSBgXG4gICAgPGRpdiBzdHlsZT1cImZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsgbWF4LXdpZHRoOiA2MDBweDsgbWFyZ2luOiAwIGF1dG87IHBhZGRpbmc6IDIwcHg7IGJhY2tncm91bmQtY29sb3I6ICNmOWZhZmI7XCI+XG4gICAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IHBhZGRpbmc6IDQwcHg7IGJvcmRlci1yYWRpdXM6IDhweDsgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwwLDAsMC4xKTtcIj5cbiAgICAgICAgPGgxIHN0eWxlPVwiY29sb3I6ICMxMEI5ODE7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLWJvdHRvbTogMzBweDtcIj7inIUgUGFzc3dvcmQgUmVzZXQgU3VjY2Vzc2Z1bDwvaDE+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMxRjI5Mzc7IGZvbnQtc2l6ZTogMTZweDtcIj5IZWxsbyAke25hbWV9LCB5b3VyIHBhc3N3b3JkIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSByZXNldC48L3A+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM0QjU1NjM7XCI+WW91IGNhbiBub3cgbG9nIGluIHRvIHlvdXIgTWVudGFyYSBhY2NvdW50IHVzaW5nIHlvdXIgbmV3IHBhc3N3b3JkLjwvcD5cbiAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICNGMEZERjQ7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzEwQjk4MTsgcGFkZGluZzogMTZweDsgbWFyZ2luOiAyMHB4IDA7XCI+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiAwOyBmb250LXdlaWdodDogNTAwO1wiPlNlY3VyaXR5IFRpcDo8L3A+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiAxMHB4IDAgMCAwO1wiPk1ha2Ugc3VyZSB0byB1c2UgYSBzdHJvbmcsIHVuaXF1ZSBwYXNzd29yZCBhbmQga2VlcCBpdCBzZWN1cmUuPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAzMHB4IDA7XCI+XG4gICAgICAgICAgPGEgaHJlZj1cIiR7YXBwVXJsfS9hdXRoL2xvZ2luXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjNDM2QjAwOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMjRweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtd2VpZ2h0OiA1MDA7XCI+TG9naW4gdG8gWW91ciBBY2NvdW50PC9hPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzZCNzI4MDsgZm9udC1zaXplOiAxNHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7XCI+SWYgeW91IGRpZG4ndCBtYWtlIHRoaXMgY2hhbmdlLCBwbGVhc2UgY29udGFjdCBvdXIgc3VwcG9ydCB0ZWFtIGltbWVkaWF0ZWx5LjwvcD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PmA7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlUGFyYW1zID0ge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgc3ViamVjdCxcbiAgICAgICAgaHRtbCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGVtYWlsanMuc2VuZChcbiAgICAgICAgdGhpcy5jb25maWcuc2VydmljZUlkLFxuICAgICAgICB0aGlzLmNvbmZpZy50ZW1wbGF0ZUlkLFxuICAgICAgICB0ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZygn4pyFIFBhc3N3b3JkIHJlc2V0IHN1Y2Nlc3MgZW1haWwgc2VudDonLCB7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBzdWJqZWN0LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBtZXNzYWdlOiAnUGFzc3dvcmQgcmVzZXQgc3VjY2VzcyBlbWFpbCBzZW50IHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJztcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAn4p2MIEZhaWxlZCB0byBzZW5kIHBhc3N3b3JkIHJlc2V0IHN1Y2Nlc3MgZW1haWw6JyxcbiAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byBzZW5kIHBhc3N3b3JkIHJlc2V0IHN1Y2Nlc3MgZW1haWw6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIG1lZXRpbmcgYm9va2luZyBjb25maXJtYXRpb24gZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gbWVldGluZ0RldGFpbHMgLSBNZWV0aW5nIGluZm9ybWF0aW9uXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCBvcGVyYXRpb24gcmVzdWx0XG4gICAqL1xuICBhc3luYyBzZW5kTWVldGluZ0Jvb2tpbmdDb25maXJtYXRpb24oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgbWVldGluZ0RldGFpbHM6IHtcbiAgICAgIG1lZXRpbmdJZDogc3RyaW5nO1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIHN0YXJ0VGltZTogRGF0ZTtcbiAgICAgIGR1cmF0aW9uOiBudW1iZXI7XG4gICAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmc7XG4gICAgICBjbGllbnROYW1lOiBzdHJpbmc7XG4gICAgICBtZWV0aW5nVXJsPzogc3RyaW5nO1xuICAgICAgYW1vdW50PzogbnVtYmVyO1xuICAgICAgY3VycmVuY3k/OiBzdHJpbmc7XG4gICAgfSxcbiAgKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiB7XG4gICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgJ0VtYWlsSlMgbm90IHByb3Blcmx5IGluaXRpYWxpemVkLiBDaGVjayBlbnZpcm9ubWVudCB2YXJpYWJsZXMuJyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXJ0VGltZUZvcm1hdHRlZCA9IG1lZXRpbmdEZXRhaWxzLnN0YXJ0VGltZS50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgJ2VuLVVTJyxcbiAgICAgICAge1xuICAgICAgICAgIHdlZWtkYXk6ICdsb25nJyxcbiAgICAgICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICAgICAgbW9udGg6ICdsb25nJyxcbiAgICAgICAgICBkYXk6ICdudW1lcmljJyxcbiAgICAgICAgICBob3VyOiAnbnVtZXJpYycsXG4gICAgICAgICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgICAgICAgdGltZVpvbmVOYW1lOiAnc2hvcnQnLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgYXBwVXJsID0gcHJvY2Vzcy5lbnYuQVBQX1VSTCB8fCAnaHR0cHM6Ly9tZW50YXJhLmNvbSc7XG4gICAgICBjb25zdCBtZWV0aW5nVXJsID1cbiAgICAgICAgbWVldGluZ0RldGFpbHMubWVldGluZ1VybCB8fFxuICAgICAgICBgJHthcHBVcmx9L21lZXRpbmcvJHttZWV0aW5nRGV0YWlscy5tZWV0aW5nSWR9YDtcblxuICAgICAgY29uc3QgaHRtbCA9IGBcbiAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZmFmYjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgcGFkZGluZzogNDBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpO1wiPlxuICAgICAgICA8aDEgc3R5bGU9XCJjb2xvcjogIzQzNkIwMDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAzMHB4O1wiPvCfjokgTWVldGluZyBDb25maXJtZWQhPC9oMT5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzFGMjkzNzsgZm9udC1zaXplOiAxNnB4O1wiPkhlbGxvICR7bmFtZX0sIHlvdXIgdGhlcmFweSBzZXNzaW9uIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBib29rZWQuPC9wPlxuICAgICAgICBcbiAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICNGMEZERjQ7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzEwQjk4MTsgcGFkZGluZzogMjBweDsgbWFyZ2luOiAyMHB4IDA7IGJvcmRlci1yYWRpdXM6IDZweDtcIj5cbiAgICAgICAgICA8aDMgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiAwIDAgMTVweCAwO1wiPk1lZXRpbmcgRGV0YWlsczo8L2gzPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5TZXNzaW9uOjwvc3Ryb25nPiAke21lZXRpbmdEZXRhaWxzLnRpdGxlfTwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMDY1RjQ2OyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+RGF0ZSAmIFRpbWU6PC9zdHJvbmc+ICR7c3RhcnRUaW1lRm9ybWF0dGVkfTwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMDY1RjQ2OyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+RHVyYXRpb246PC9zdHJvbmc+ICR7bWVldGluZ0RldGFpbHMuZHVyYXRpb259IG1pbnV0ZXM8L3A+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlRoZXJhcGlzdDo8L3N0cm9uZz4gJHttZWV0aW5nRGV0YWlscy50aGVyYXBpc3ROYW1lfTwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMDY1RjQ2OyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+Q2xpZW50Ojwvc3Ryb25nPiAke21lZXRpbmdEZXRhaWxzLmNsaWVudE5hbWV9PC9wPlxuICAgICAgICAgICR7bWVldGluZ0RldGFpbHMuYW1vdW50ID8gYDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5QYXltZW50Ojwvc3Ryb25nPiAke21lZXRpbmdEZXRhaWxzLmN1cnJlbmN5IHx8ICdVU0QnfSAkJHttZWV0aW5nRGV0YWlscy5hbW91bnR9PC9wPmAgOiAnJ31cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAzMHB4IDA7XCI+XG4gICAgICAgICAgPGEgaHJlZj1cIiR7bWVldGluZ1VybH1cIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICM0MzZCMDA7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC13ZWlnaHQ6IDUwMDsgZGlzcGxheTogaW5saW5lLWJsb2NrO1wiPkpvaW4gTWVldGluZzwvYT5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICNGRUYzQzc7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgI0Y1OUUwQjsgcGFkZGluZzogMTZweDsgbWFyZ2luOiAyMHB4IDA7XCI+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzkyNDAwRTsgbWFyZ2luOiAwOyBmb250LXdlaWdodDogNTAwO1wiPvCfk4UgQWRkIHRvIENhbGVuZGFyOjwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjOTI0MDBFOyBtYXJnaW46IDEwcHggMCAwIDA7XCI+U2F2ZSB0aGlzIG1lZXRpbmcgdG8geW91ciBjYWxlbmRhciBzbyB5b3UgZG9uJ3QgbWlzcyBpdCE8L3A+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2QjcyODA7IGZvbnQtc2l6ZTogMTRweDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tdG9wOiAzMHB4O1wiPlxuICAgICAgICAgIFdlJ2xsIHNlbmQgeW91IGEgcmVtaW5kZXIgMjQgaG91cnMgYmVmb3JlIHlvdXIgc2Vzc2lvbi4gSWYgeW91IG5lZWQgdG8gcmVzY2hlZHVsZSwgcGxlYXNlIGRvIHNvIGF0IGxlYXN0IDI0IGhvdXJzIGluIGFkdmFuY2UuXG4gICAgICAgIDwvcD5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PmA7XG5cbiAgICAgIGNvbnN0IHN1YmplY3QgPSBgTWVldGluZyBDb25maXJtZWQgLSAke21lZXRpbmdEZXRhaWxzLnRpdGxlfSBvbiAke3N0YXJ0VGltZUZvcm1hdHRlZH1gO1xuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVBhcmFtcyA9IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHN1YmplY3QsXG4gICAgICAgIGh0bWwsXG4gICAgICAgIG1lZXRpbmdJZDogbWVldGluZ0RldGFpbHMubWVldGluZ0lkLFxuICAgICAgICBtZWV0aW5nVXJsLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZW1haWxqcy5zZW5kKFxuICAgICAgICB0aGlzLmNvbmZpZy5zZXJ2aWNlSWQsXG4gICAgICAgIHRoaXMuY29uZmlnLnRlbXBsYXRlSWQsXG4gICAgICAgIHRlbXBsYXRlUGFyYW1zLFxuICAgICAgKTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKCfinIUgTWVldGluZyBib29raW5nIGNvbmZpcm1hdGlvbiBlbWFpbCBzZW50OicsIHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG1lZXRpbmdJZDogbWVldGluZ0RldGFpbHMubWVldGluZ0lkLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBtZXNzYWdlOiAnTWVldGluZyBib29raW5nIGNvbmZpcm1hdGlvbiBlbWFpbCBzZW50IHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJztcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAn4p2MIEZhaWxlZCB0byBzZW5kIG1lZXRpbmcgYm9va2luZyBjb25maXJtYXRpb24gZW1haWw6JyxcbiAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byBzZW5kIG1lZXRpbmcgYm9va2luZyBjb25maXJtYXRpb24gZW1haWw6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHVwY29taW5nIG1lZXRpbmcgcmVtaW5kZXIgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gbWVldGluZ0RldGFpbHMgLSBNZWV0aW5nIGluZm9ybWF0aW9uXG4gICAqIEBwYXJhbSByZW1pbmRlclR5cGUgLSBUeXBlIG9mIHJlbWluZGVyICgyNGgsIDFoLCBldGMuKVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZE1lZXRpbmdSZW1pbmRlcihcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBtZWV0aW5nRGV0YWlsczoge1xuICAgICAgbWVldGluZ0lkOiBzdHJpbmc7XG4gICAgICB0aXRsZTogc3RyaW5nO1xuICAgICAgc3RhcnRUaW1lOiBEYXRlO1xuICAgICAgZHVyYXRpb246IG51bWJlcjtcbiAgICAgIHRoZXJhcGlzdE5hbWU6IHN0cmluZztcbiAgICAgIGNsaWVudE5hbWU6IHN0cmluZztcbiAgICAgIG1lZXRpbmdVcmw/OiBzdHJpbmc7XG4gICAgfSxcbiAgICByZW1pbmRlclR5cGU6ICcyNGgnIHwgJzFoJyB8ICcxNW0nID0gJzI0aCcsXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdFbWFpbEpTIG5vdCBwcm9wZXJseSBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGFydFRpbWVGb3JtYXR0ZWQgPSBtZWV0aW5nRGV0YWlscy5zdGFydFRpbWUudG9Mb2NhbGVTdHJpbmcoXG4gICAgICAgICdlbi1VUycsXG4gICAgICAgIHtcbiAgICAgICAgICB3ZWVrZGF5OiAnbG9uZycsXG4gICAgICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgICAgIG1vbnRoOiAnbG9uZycsXG4gICAgICAgICAgZGF5OiAnbnVtZXJpYycsXG4gICAgICAgICAgaG91cjogJ251bWVyaWMnLFxuICAgICAgICAgIG1pbnV0ZTogJzItZGlnaXQnLFxuICAgICAgICAgIHRpbWVab25lTmFtZTogJ3Nob3J0JyxcbiAgICAgICAgfSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlbWluZGVyVGV4dCA9IHtcbiAgICAgICAgJzI0aCc6ICd0b21vcnJvdycsXG4gICAgICAgICcxaCc6ICdpbiAxIGhvdXInLFxuICAgICAgICAnMTVtJzogJ2luIDE1IG1pbnV0ZXMnLFxuICAgICAgfVtyZW1pbmRlclR5cGVdO1xuXG4gICAgICBjb25zdCB1cmdlbmN5Q29sb3IgPSB7XG4gICAgICAgICcyNGgnOiAnIzQzNkIwMCcsXG4gICAgICAgICcxaCc6ICcjRjU5RTBCJyxcbiAgICAgICAgJzE1bSc6ICcjRUY0NDQ0JyxcbiAgICAgIH1bcmVtaW5kZXJUeXBlXTtcblxuICAgICAgY29uc3QgYXBwVXJsID0gcHJvY2Vzcy5lbnYuQVBQX1VSTCB8fCAnaHR0cHM6Ly9tZW50YXJhLmNvbSc7XG4gICAgICBjb25zdCBtZWV0aW5nVXJsID1cbiAgICAgICAgbWVldGluZ0RldGFpbHMubWVldGluZ1VybCB8fFxuICAgICAgICBgJHthcHBVcmx9L21lZXRpbmcvJHttZWV0aW5nRGV0YWlscy5tZWV0aW5nSWR9YDtcblxuICAgICAgY29uc3QgaHRtbCA9IGBcbiAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZmFmYjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgcGFkZGluZzogNDBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpO1wiPlxuICAgICAgICA8aDEgc3R5bGU9XCJjb2xvcjogJHt1cmdlbmN5Q29sb3J9OyB0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDMwcHg7XCI+4o+wIE1lZXRpbmcgUmVtaW5kZXI8L2gxPlxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMUYyOTM3OyBmb250LXNpemU6IDE2cHg7XCI+SGVsbG8gJHtuYW1lfSwgdGhpcyBpcyBhIGZyaWVuZGx5IHJlbWluZGVyIHRoYXQgeW91ciB0aGVyYXB5IHNlc3Npb24gaXMgJHtyZW1pbmRlclRleHR9LjwvcD5cbiAgICAgICAgXG4gICAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjRjBGREY0OyBib3JkZXItbGVmdDogNHB4IHNvbGlkOiAke3VyZ2VuY3lDb2xvcn07IHBhZGRpbmc6IDIwcHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItcmFkaXVzOiA2cHg7XCI+XG4gICAgICAgICAgPGgzIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogMCAwIDE1cHggMDtcIj5VcGNvbWluZyBTZXNzaW9uOjwvaDM+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNlc3Npb246PC9zdHJvbmc+ICR7bWVldGluZ0RldGFpbHMudGl0bGV9PC9wPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5EYXRlICYgVGltZTo8L3N0cm9uZz4gJHtzdGFydFRpbWVGb3JtYXR0ZWR9PC9wPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5EdXJhdGlvbjo8L3N0cm9uZz4gJHttZWV0aW5nRGV0YWlscy5kdXJhdGlvbn0gbWludXRlczwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMDY1RjQ2OyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+VGhlcmFwaXN0Ojwvc3Ryb25nPiAke21lZXRpbmdEZXRhaWxzLnRoZXJhcGlzdE5hbWV9PC9wPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW46IDMwcHggMDtcIj5cbiAgICAgICAgICA8YSBocmVmPVwiJHttZWV0aW5nVXJsfVwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogJHt1cmdlbmN5Q29sb3J9OyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMjRweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGRpc3BsYXk6IGlubGluZS1ibG9jaztcIj5Kb2luIE1lZXRpbmc8L2E+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjRkVGM0M3OyBib3JkZXItbGVmdDogNHB4IHNvbGlkICNGNTlFMEI7IHBhZGRpbmc6IDE2cHg7IG1hcmdpbjogMjBweCAwO1wiPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM5MjQwMEU7IG1hcmdpbjogMDsgZm9udC13ZWlnaHQ6IDUwMDtcIj7wn5KhIFByZXBhcmF0aW9uIFRpcHM6PC9wPlxuICAgICAgICAgIDx1bCBzdHlsZT1cImNvbG9yOiAjOTI0MDBFOyBtYXJnaW46IDEwcHggMDtcIj5cbiAgICAgICAgICAgIDxsaT5FbnN1cmUgeW91IGhhdmUgYSBzdGFibGUgaW50ZXJuZXQgY29ubmVjdGlvbjwvbGk+XG4gICAgICAgICAgICA8bGk+RmluZCBhIHF1aWV0LCBwcml2YXRlIHNwYWNlIGZvciB5b3VyIHNlc3Npb248L2xpPlxuICAgICAgICAgICAgPGxpPlRlc3QgeW91ciBjYW1lcmEgYW5kIG1pY3JvcGhvbmUgYmVmb3JlaGFuZDwvbGk+XG4gICAgICAgICAgICA8bGk+SGF2ZSBhbnkgcXVlc3Rpb25zIG9yIHRvcGljcyByZWFkeSB0byBkaXNjdXNzPC9saT5cbiAgICAgICAgICA8L3VsPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjNkI3MjgwOyBmb250LXNpemU6IDE0cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLXRvcDogMzBweDtcIj5cbiAgICAgICAgICBMb29raW5nIGZvcndhcmQgdG8gc2VlaW5nIHlvdSBpbiB0aGUgc2Vzc2lvbi4gSWYgeW91IG5lZWQgdG8gcmVzY2hlZHVsZSwgcGxlYXNlIGNvbnRhY3QgdXMgYXMgc29vbiBhcyBwb3NzaWJsZS5cbiAgICAgICAgPC9wPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+YDtcblxuICAgICAgY29uc3Qgc3ViamVjdCA9IGBSZW1pbmRlcjogJHttZWV0aW5nRGV0YWlscy50aXRsZX0gLSAke3JlbWluZGVyVGV4dH1gO1xuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVBhcmFtcyA9IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHN1YmplY3QsXG4gICAgICAgIGh0bWwsXG4gICAgICAgIG1lZXRpbmdJZDogbWVldGluZ0RldGFpbHMubWVldGluZ0lkLFxuICAgICAgICBtZWV0aW5nVXJsLFxuICAgICAgICByZW1pbmRlclR5cGUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBlbWFpbGpzLnNlbmQoXG4gICAgICAgIHRoaXMuY29uZmlnLnNlcnZpY2VJZCxcbiAgICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVJZCxcbiAgICAgICAgdGVtcGxhdGVQYXJhbXMsXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coJ+KchSBNZWV0aW5nIHJlbWluZGVyIGVtYWlsIHNlbnQ6Jywge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbWVldGluZ0lkOiBtZWV0aW5nRGV0YWlscy5tZWV0aW5nSWQsXG4gICAgICAgIHJlbWluZGVyVHlwZSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgbWVzc2FnZTogJ01lZXRpbmcgcmVtaW5kZXIgZW1haWwgc2VudCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgJ+KdjCBGYWlsZWQgdG8gc2VuZCBtZWV0aW5nIHJlbWluZGVyIGVtYWlsOicsXG4gICAgICAgIGVycm9yTWVzc2FnZSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gc2VuZCBtZWV0aW5nIHJlbWluZGVyIGVtYWlsOiAke2Vycm9yTWVzc2FnZX1gLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBtZWV0aW5nIGNhbmNlbGxhdGlvbiBub3RpZmljYXRpb24gZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gUmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcbiAgICogQHBhcmFtIG5hbWUgLSBSZWNpcGllbnQgbmFtZVxuICAgKiBAcGFyYW0gbWVldGluZ0RldGFpbHMgLSBNZWV0aW5nIGluZm9ybWF0aW9uXG4gICAqIEBwYXJhbSBjYW5jZWxsYXRpb25SZWFzb24gLSBSZWFzb24gZm9yIGNhbmNlbGxhdGlvblxuICAgKiBAcGFyYW0gY2FuY2VsbGVkQnkgLSBXaG8gY2FuY2VsbGVkIHRoZSBtZWV0aW5nIChjbGllbnQvdGhlcmFwaXN0KVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZE1lZXRpbmdDYW5jZWxsYXRpb24oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgbWVldGluZ0RldGFpbHM6IHtcbiAgICAgIG1lZXRpbmdJZDogc3RyaW5nO1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIHN0YXJ0VGltZTogRGF0ZTtcbiAgICAgIHRoZXJhcGlzdE5hbWU6IHN0cmluZztcbiAgICAgIGNsaWVudE5hbWU6IHN0cmluZztcbiAgICB9LFxuICAgIGNhbmNlbGxhdGlvblJlYXNvbjogc3RyaW5nLFxuICAgIGNhbmNlbGxlZEJ5OiAnY2xpZW50JyB8ICd0aGVyYXBpc3QnLFxuICApOiBQcm9taXNlPEVtYWlsUmVzcG9uc2U+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAnRW1haWxKUyBub3QgcHJvcGVybHkgaW5pdGlhbGl6ZWQuIENoZWNrIGVudmlyb25tZW50IHZhcmlhYmxlcy4nLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lRm9ybWF0dGVkID0gbWVldGluZ0RldGFpbHMuc3RhcnRUaW1lLnRvTG9jYWxlU3RyaW5nKFxuICAgICAgICAnZW4tVVMnLFxuICAgICAgICB7XG4gICAgICAgICAgd2Vla2RheTogJ2xvbmcnLFxuICAgICAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgICAgICBtb250aDogJ2xvbmcnLFxuICAgICAgICAgIGRheTogJ251bWVyaWMnLFxuICAgICAgICAgIGhvdXI6ICdudW1lcmljJyxcbiAgICAgICAgICBtaW51dGU6ICcyLWRpZ2l0JyxcbiAgICAgICAgICB0aW1lWm9uZU5hbWU6ICdzaG9ydCcsXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICBjb25zdCBhcHBVcmwgPSBwcm9jZXNzLmVudi5BUFBfVVJMIHx8ICdodHRwczovL21lbnRhcmEuY29tJztcblxuICAgICAgY29uc3QgaHRtbCA9IGBcbiAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZmFmYjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgcGFkZGluZzogNDBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpO1wiPlxuICAgICAgICA8aDEgc3R5bGU9XCJjb2xvcjogI0VGNDQ0NDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAzMHB4O1wiPuKdjCBNZWV0aW5nIENhbmNlbGxlZDwvaDE+XG4gICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMxRjI5Mzc7IGZvbnQtc2l6ZTogMTZweDtcIj5IZWxsbyAke25hbWV9LCB3ZSdyZSB3cml0aW5nIHRvIGluZm9ybSB5b3UgdGhhdCB5b3VyIHVwY29taW5nIHRoZXJhcHkgc2Vzc2lvbiBoYXMgYmVlbiBjYW5jZWxsZWQuPC9wPlxuICAgICAgICBcbiAgICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICNGRUYyRjI7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgI0VGNDQ0NDsgcGFkZGluZzogMjBweDsgbWFyZ2luOiAyMHB4IDA7IGJvcmRlci1yYWRpdXM6IDZweDtcIj5cbiAgICAgICAgICA8aDMgc3R5bGU9XCJjb2xvcjogIzk5MUIxQjsgbWFyZ2luOiAwIDAgMTVweCAwO1wiPkNhbmNlbGxlZCBTZXNzaW9uOjwvaDM+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzk5MUIxQjsgbWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNlc3Npb246PC9zdHJvbmc+ICR7bWVldGluZ0RldGFpbHMudGl0bGV9PC9wPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM5OTFCMUI7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5EYXRlICYgVGltZTo8L3N0cm9uZz4gJHtzdGFydFRpbWVGb3JtYXR0ZWR9PC9wPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM5OTFCMUI7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5UaGVyYXBpc3Q6PC9zdHJvbmc+ICR7bWVldGluZ0RldGFpbHMudGhlcmFwaXN0TmFtZX08L3A+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzk5MUIxQjsgbWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPkNhbmNlbGxlZCBieTo8L3N0cm9uZz4gJHtjYW5jZWxsZWRCeSA9PT0gJ2NsaWVudCcgPyAnQ2xpZW50JyA6ICdUaGVyYXBpc3QnfTwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjOTkxQjFCOyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+UmVhc29uOjwvc3Ryb25nPiAke2NhbmNlbGxhdGlvblJlYXNvbn08L3A+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjRjBGREY0OyBib3JkZXItbGVmdDogNHB4IHNvbGlkICMxMEI5ODE7IHBhZGRpbmc6IDE2cHg7IG1hcmdpbjogMjBweCAwO1wiPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogMDsgZm9udC13ZWlnaHQ6IDUwMDtcIj7wn5OFIFJlc2NoZWR1bGluZzo8L3A+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiAxMHB4IDAgMCAwO1wiPllvdSBjYW4gYm9vayBhIG5ldyBzZXNzaW9uIGF0IHlvdXIgY29udmVuaWVuY2UgdGhyb3VnaCB5b3VyIGRhc2hib2FyZC48L3A+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbjogMzBweCAwO1wiPlxuICAgICAgICAgIDxhIGhyZWY9XCIke2FwcFVybH0vZGFzaGJvYXJkXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjNDM2QjAwOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMjRweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGRpc3BsYXk6IGlubGluZS1ibG9jaztcIj5Cb29rIE5ldyBTZXNzaW9uPC9hPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjNkI3MjgwOyBmb250LXNpemU6IDE0cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLXRvcDogMzBweDtcIj5cbiAgICAgICAgICBJZiB5b3Ugd2VyZSBjaGFyZ2VkIGZvciB0aGlzIHNlc3Npb24sIGFueSBhcHBsaWNhYmxlIHJlZnVuZHMgd2lsbCBiZSBwcm9jZXNzZWQgd2l0aGluIDMtNSBidXNpbmVzcyBkYXlzLlxuICAgICAgICA8L3A+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5gO1xuXG4gICAgICBjb25zdCBzdWJqZWN0ID0gYE1lZXRpbmcgQ2FuY2VsbGVkIC0gJHttZWV0aW5nRGV0YWlscy50aXRsZX0gb24gJHtzdGFydFRpbWVGb3JtYXR0ZWR9YDtcblxuICAgICAgY29uc3QgdGVtcGxhdGVQYXJhbXMgPSB7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBuYW1lLFxuICAgICAgICBzdWJqZWN0LFxuICAgICAgICBodG1sLFxuICAgICAgICBtZWV0aW5nSWQ6IG1lZXRpbmdEZXRhaWxzLm1lZXRpbmdJZCxcbiAgICAgICAgY2FuY2VsbGF0aW9uUmVhc29uLFxuICAgICAgICBjYW5jZWxsZWRCeSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGVtYWlsanMuc2VuZChcbiAgICAgICAgdGhpcy5jb25maWcuc2VydmljZUlkLFxuICAgICAgICB0aGlzLmNvbmZpZy50ZW1wbGF0ZUlkLFxuICAgICAgICB0ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZygn4pyFIE1lZXRpbmcgY2FuY2VsbGF0aW9uIGVtYWlsIHNlbnQ6Jywge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbWVldGluZ0lkOiBtZWV0aW5nRGV0YWlscy5tZWV0aW5nSWQsXG4gICAgICAgIGNhbmNlbGxlZEJ5LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBtZXNzYWdlOiAnTWVldGluZyBjYW5jZWxsYXRpb24gZW1haWwgc2VudCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgJ+KdjCBGYWlsZWQgdG8gc2VuZCBtZWV0aW5nIGNhbmNlbGxhdGlvbiBlbWFpbDonLFxuICAgICAgICBlcnJvck1lc3NhZ2UsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHNlbmQgbWVldGluZyBjYW5jZWxsYXRpb24gZW1haWw6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHBheW1lbnQgY29uZmlybWF0aW9uIGVtYWlsXG4gICAqIEBwYXJhbSBlbWFpbCAtIFJlY2lwaWVudCBlbWFpbCBhZGRyZXNzXG4gICAqIEBwYXJhbSBuYW1lIC0gUmVjaXBpZW50IG5hbWVcbiAgICogQHBhcmFtIHBheW1lbnREZXRhaWxzIC0gUGF5bWVudCBpbmZvcm1hdGlvblxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggb3BlcmF0aW9uIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgc2VuZFBheW1lbnRDb25maXJtYXRpb24oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgcGF5bWVudERldGFpbHM6IHtcbiAgICAgIHBheW1lbnRJZDogc3RyaW5nO1xuICAgICAgYW1vdW50OiBudW1iZXI7XG4gICAgICBjdXJyZW5jeTogc3RyaW5nO1xuICAgICAgdGhlcmFwaXN0TmFtZTogc3RyaW5nO1xuICAgICAgbWVldGluZ1RpdGxlPzogc3RyaW5nO1xuICAgICAgbWVldGluZ0RhdGU/OiBEYXRlO1xuICAgICAgcGF5bWVudE1ldGhvZDogc3RyaW5nO1xuICAgIH0sXG4gICk6IFByb21pc2U8RW1haWxSZXNwb25zZT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdFbWFpbEpTIG5vdCBwcm9wZXJseSBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBtZWV0aW5nRGF0ZUZvcm1hdHRlZCA9IHBheW1lbnREZXRhaWxzLm1lZXRpbmdEYXRlPy50b0xvY2FsZVN0cmluZyhcbiAgICAgICAgJ2VuLVVTJyxcbiAgICAgICAge1xuICAgICAgICAgIHdlZWtkYXk6ICdsb25nJyxcbiAgICAgICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICAgICAgbW9udGg6ICdsb25nJyxcbiAgICAgICAgICBkYXk6ICdudW1lcmljJyxcbiAgICAgICAgICBob3VyOiAnbnVtZXJpYycsXG4gICAgICAgICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICBjb25zdCBodG1sID0gYFxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvOyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmYWZiO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiA0MHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7XCI+XG4gICAgICAgIDxoMSBzdHlsZT1cImNvbG9yOiAjMTBCOTgxOyB0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDMwcHg7XCI+4pyFIFBheW1lbnQgQ29uZmlybWVkPC9oMT5cbiAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzFGMjkzNzsgZm9udC1zaXplOiAxNnB4O1wiPkhlbGxvICR7bmFtZX0sIHlvdXIgcGF5bWVudCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgcHJvY2Vzc2VkLjwvcD5cbiAgICAgICAgXG4gICAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjRjBGREY0OyBib3JkZXItbGVmdDogNHB4IHNvbGlkICMxMEI5ODE7IHBhZGRpbmc6IDIwcHg7IG1hcmdpbjogMjBweCAwOyBib3JkZXItcmFkaXVzOiA2cHg7XCI+XG4gICAgICAgICAgPGgzIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogMCAwIDE1cHggMDtcIj5QYXltZW50IERldGFpbHM6PC9oMz5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjMDY1RjQ2OyBtYXJnaW46IDVweCAwO1wiPjxzdHJvbmc+QW1vdW50Ojwvc3Ryb25nPiAke3BheW1lbnREZXRhaWxzLmN1cnJlbmN5fSAkJHtwYXltZW50RGV0YWlscy5hbW91bnR9PC9wPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5UaGVyYXBpc3Q6PC9zdHJvbmc+ICR7cGF5bWVudERldGFpbHMudGhlcmFwaXN0TmFtZX08L3A+XG4gICAgICAgICAgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlBheW1lbnQgTWV0aG9kOjwvc3Ryb25nPiAke3BheW1lbnREZXRhaWxzLnBheW1lbnRNZXRob2R9PC9wPlxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5UcmFuc2FjdGlvbiBJRDo8L3N0cm9uZz4gJHtwYXltZW50RGV0YWlscy5wYXltZW50SWR9PC9wPlxuICAgICAgICAgICR7cGF5bWVudERldGFpbHMubWVldGluZ1RpdGxlID8gYDxwIHN0eWxlPVwiY29sb3I6ICMwNjVGNDY7IG1hcmdpbjogNXB4IDA7XCI+PHN0cm9uZz5TZXNzaW9uOjwvc3Ryb25nPiAke3BheW1lbnREZXRhaWxzLm1lZXRpbmdUaXRsZX08L3A+YCA6ICcnfVxuICAgICAgICAgICR7bWVldGluZ0RhdGVGb3JtYXR0ZWQgPyBgPHAgc3R5bGU9XCJjb2xvcjogIzA2NUY0NjsgbWFyZ2luOiA1cHggMDtcIj48c3Ryb25nPlNlc3Npb24gRGF0ZTo8L3N0cm9uZz4gJHttZWV0aW5nRGF0ZUZvcm1hdHRlZH08L3A+YCA6ICcnfVxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogI0ZFRjNDNzsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjRjU5RTBCOyBwYWRkaW5nOiAxNnB4OyBtYXJnaW46IDIwcHggMDtcIj5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjOTI0MDBFOyBtYXJnaW46IDA7IGZvbnQtd2VpZ2h0OiA1MDA7XCI+8J+ThCBSZWNlaXB0OjwvcD5cbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjOTI0MDBFOyBtYXJnaW46IDEwcHggMCAwIDA7XCI+S2VlcCB0aGlzIGVtYWlsIGFzIHlvdXIgcGF5bWVudCByZWNlaXB0IGZvciB5b3VyIHJlY29yZHMuPC9wPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjNkI3MjgwOyBmb250LXNpemU6IDE0cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luLXRvcDogMzBweDtcIj5cbiAgICAgICAgICBUaGFuayB5b3UgZm9yIGNob29zaW5nIE1lbnRhcmEgZm9yIHlvdXIgbWVudGFsIGhlYWx0aCBjYXJlLiBJZiB5b3UgaGF2ZSBhbnkgcXVlc3Rpb25zIGFib3V0IHRoaXMgcGF5bWVudCwgcGxlYXNlIGNvbnRhY3Qgb3VyIHN1cHBvcnQgdGVhbS5cbiAgICAgICAgPC9wPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+YDtcblxuICAgICAgY29uc3Qgc3ViamVjdCA9IGBQYXltZW50IENvbmZpcm1hdGlvbiAtICR7cGF5bWVudERldGFpbHMuY3VycmVuY3l9ICQke3BheW1lbnREZXRhaWxzLmFtb3VudH0gdG8gJHtwYXltZW50RGV0YWlscy50aGVyYXBpc3ROYW1lfWA7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlUGFyYW1zID0ge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgc3ViamVjdCxcbiAgICAgICAgaHRtbCxcbiAgICAgICAgcGF5bWVudElkOiBwYXltZW50RGV0YWlscy5wYXltZW50SWQsXG4gICAgICAgIGFtb3VudDogcGF5bWVudERldGFpbHMuYW1vdW50LFxuICAgICAgICBjdXJyZW5jeTogcGF5bWVudERldGFpbHMuY3VycmVuY3ksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBlbWFpbGpzLnNlbmQoXG4gICAgICAgIHRoaXMuY29uZmlnLnNlcnZpY2VJZCxcbiAgICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVJZCxcbiAgICAgICAgdGVtcGxhdGVQYXJhbXMsXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coJ+KchSBQYXltZW50IGNvbmZpcm1hdGlvbiBlbWFpbCBzZW50OicsIHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBheW1lbnRJZDogcGF5bWVudERldGFpbHMucGF5bWVudElkLFxuICAgICAgICBhbW91bnQ6IHBheW1lbnREZXRhaWxzLmFtb3VudCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgbWVzc2FnZTogJ1BheW1lbnQgY29uZmlybWF0aW9uIGVtYWlsIHNlbnQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICfinYwgRmFpbGVkIHRvIHNlbmQgcGF5bWVudCBjb25maXJtYXRpb24gZW1haWw6JyxcbiAgICAgICAgZXJyb3JNZXNzYWdlLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byBzZW5kIHBheW1lbnQgY29uZmlybWF0aW9uIGVtYWlsOiAke2Vycm9yTWVzc2FnZX1gLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgT1RQIGNvZGVcbiAgICovXG4gIGdlbmVyYXRlT3RwKGxlbmd0aDogbnVtYmVyID0gNik6IHN0cmluZyB7XG4gICAgY29uc3QgZGlnaXRzID0gJzAxMjM0NTY3ODknO1xuICAgIGxldCBvdHAgPSAnJztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBvdHAgKz0gZGlnaXRzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKV07XG4gICAgfVxuICAgIHJldHVybiBvdHA7XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0IGV4cGlyeSB0aW1lIGZvciBlbWFpbCBkaXNwbGF5XG4gICAqL1xuICBmb3JtYXRFeHBpcnlUaW1lKG1pbnV0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKG1pbnV0ZXMgPCA2MCkge1xuICAgICAgcmV0dXJuIGAke21pbnV0ZXN9IG1pbnV0ZSR7bWludXRlcyAhPT0gMSA/ICdzJyA6ICcnfWA7XG4gICAgfVxuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihtaW51dGVzIC8gNjApO1xuICAgIGNvbnN0IHJlbWFpbmluZ01pbnV0ZXMgPSBtaW51dGVzICUgNjA7XG4gICAgbGV0IHRpbWVTdHJpbmcgPSBgJHtob3Vyc30gaG91ciR7aG91cnMgIT09IDEgPyAncycgOiAnJ31gO1xuICAgIGlmIChyZW1haW5pbmdNaW51dGVzID4gMCkge1xuICAgICAgdGltZVN0cmluZyArPSBgIGFuZCAke3JlbWFpbmluZ01pbnV0ZXN9IG1pbnV0ZSR7cmVtYWluaW5nTWludXRlcyAhPT0gMSA/ICdzJyA6ICcnfWA7XG4gICAgfVxuICAgIHJldHVybiB0aW1lU3RyaW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb25maWd1cmF0aW9uIHN0YXR1c1xuICAgKi9cbiAgZ2V0Q29uZmlndXJhdGlvblN0YXR1cygpOiB7XG4gICAgaXNJbml0aWFsaXplZDogYm9vbGVhbjtcbiAgICBoYXNTZXJ2aWNlSWQ6IGJvb2xlYW47XG4gICAgaGFzVGVtcGxhdGVJZDogYm9vbGVhbjtcbiAgICBoYXNQdWJsaWNLZXk6IGJvb2xlYW47XG4gICAgaGFzUHJpdmF0ZUtleTogYm9vbGVhbjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzSW5pdGlhbGl6ZWQ6IHRoaXMuaXNJbml0aWFsaXplZCxcbiAgICAgIGhhc1NlcnZpY2VJZDogISF0aGlzLmNvbmZpZy5zZXJ2aWNlSWQsXG4gICAgICBoYXNUZW1wbGF0ZUlkOiAhIXRoaXMuY29uZmlnLnRlbXBsYXRlSWQsXG4gICAgICBoYXNQdWJsaWNLZXk6ICEhdGhpcy5jb25maWcucHVibGljS2V5LFxuICAgICAgaGFzUHJpdmF0ZUtleTogISF0aGlzLmNvbmZpZy5wcml2YXRlS2V5LFxuICAgIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==