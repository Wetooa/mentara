ec9621fe8ced148479389ca40944532b
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnalyticsController = void 0;
const common_1 = require("@nestjs/common");
const analytics_service_1 = require("./analytics.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../auth/decorators/current-user-id.decorator");
const current_user_role_decorator_1 = require("../auth/decorators/current-user-role.decorator");
const zod_validation_pipe_1 = require("../common/pipes/zod-validation.pipe");
const swagger_1 = require("@nestjs/swagger");
const mentara_commons_1 = require("mentara-commons");
let AnalyticsController = class AnalyticsController {
    analyticsService;
    constructor(analyticsService) {
        this.analyticsService = analyticsService;
    }
    getPlatformAnalytics(role, query) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Access denied: Admin role required');
        }
        const start = query.dateFrom ? new Date(query.dateFrom) : undefined;
        const end = query.dateTo ? new Date(query.dateTo) : undefined;
        return this.analyticsService.getPlatformAnalytics(start, end);
    }
    getTherapistAnalytics(userId, role, query) {
        // Allow therapists to view their own analytics or admins to view any
        const targetTherapistId = query.therapistId || userId;
        if (role === 'therapist' && targetTherapistId !== userId) {
            throw new common_1.ForbiddenException('Access denied: Can only view your own analytics');
        }
        if (role !== 'therapist' && role !== 'admin') {
            throw new common_1.ForbiddenException('Access denied: Therapist or Admin role required');
        }
        const start = query.dateFrom ? new Date(query.dateFrom) : undefined;
        const end = query.dateTo ? new Date(query.dateTo) : undefined;
        return this.analyticsService.getTherapistAnalytics(targetTherapistId, start, end);
    }
    getClientAnalytics(userId, role, query) {
        // Allow clients to view their own analytics or admins/therapists to view assigned clients
        const targetClientId = query.clientId || userId;
        if (role === 'user' && targetClientId !== userId) {
            throw new common_1.ForbiddenException('Access denied: Can only view your own analytics');
        }
        if (role !== 'user' && role !== 'therapist' && role !== 'admin') {
            throw new common_1.ForbiddenException('Access denied: Invalid role');
        }
        const start = query.dateFrom ? new Date(query.dateFrom) : undefined;
        const end = query.dateTo ? new Date(query.dateTo) : undefined;
        return this.analyticsService.getClientAnalytics(targetClientId, start, end);
    }
};
exports.AnalyticsController = AnalyticsController;
__decorate([
    (0, common_1.Get)('platform'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get platform analytics',
        description: 'Retrieve comprehensive platform analytics data. Admin access required.',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'dateFrom',
        required: false,
        description: 'Start date for analytics (ISO string)',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'dateTo',
        required: false,
        description: 'End date for analytics (ISO string)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Platform analytics retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                userStats: {
                    type: 'object',
                    properties: {
                        totalUsers: { type: 'number' },
                        newUsers: { type: 'number' },
                        activeUsers: { type: 'number' },
                        userGrowthRate: { type: 'number' },
                    },
                },
                sessionStats: {
                    type: 'object',
                    properties: {
                        totalSessions: { type: 'number' },
                        averageSessionDuration: { type: 'number' },
                        sessionCompletionRate: { type: 'number' },
                    },
                },
                therapistStats: {
                    type: 'object',
                    properties: {
                        totalTherapists: { type: 'number' },
                        activeTherapists: { type: 'number' },
                        averageRating: { type: 'number' },
                    },
                },
                revenue: {
                    type: 'object',
                    properties: {
                        totalRevenue: { type: 'number' },
                        monthlyRevenue: { type: 'number' },
                        revenueGrowth: { type: 'number' },
                    },
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Access denied: Admin role required',
    }),
    __param(0, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __param(1, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.PlatformAnalyticsQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], AnalyticsController.prototype, "getPlatformAnalytics", null);
__decorate([
    (0, common_1.Get)('therapist'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get therapist analytics',
        description: 'Retrieve analytics for a specific therapist. Therapists can view their own analytics, admins can view any.',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'therapistId',
        required: false,
        description: 'Therapist ID (defaults to current user for therapists)',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'dateFrom',
        required: false,
        description: 'Start date for analytics (ISO string)',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'dateTo',
        required: false,
        description: 'End date for analytics (ISO string)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Therapist analytics retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                therapistInfo: {
                    type: 'object',
                    properties: {
                        id: { type: 'string' },
                        name: { type: 'string' },
                        specializations: { type: 'array', items: { type: 'string' } },
                    },
                },
                clientStats: {
                    type: 'object',
                    properties: {
                        totalClients: { type: 'number' },
                        activeClients: { type: 'number' },
                        newClients: { type: 'number' },
                        clientRetentionRate: { type: 'number' },
                    },
                },
                sessionMetrics: {
                    type: 'object',
                    properties: {
                        totalSessions: { type: 'number' },
                        averageSessionDuration: { type: 'number' },
                        sessionRating: { type: 'number' },
                        completionRate: { type: 'number' },
                    },
                },
                performanceMetrics: {
                    type: 'object',
                    properties: {
                        responseTime: { type: 'number' },
                        clientSatisfaction: { type: 'number' },
                        treatmentEffectiveness: { type: 'number' },
                    },
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Access denied: Can only view your own analytics or admin access required',
    }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __param(2, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.TherapistAnalyticsQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, Object]),
    __metadata("design:returntype", void 0)
], AnalyticsController.prototype, "getTherapistAnalytics", null);
__decorate([
    (0, common_1.Get)('client'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get client analytics',
        description: 'Retrieve analytics for a specific client. Clients can view their own analytics, therapists/admins can view assigned clients.',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'clientId',
        required: false,
        description: 'Client ID (defaults to current user for clients)',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'dateFrom',
        required: false,
        description: 'Start date for analytics (ISO string)',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'dateTo',
        required: false,
        description: 'End date for analytics (ISO string)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Client analytics retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                clientInfo: {
                    type: 'object',
                    properties: {
                        id: { type: 'string' },
                        name: { type: 'string' },
                        joinDate: { type: 'string', format: 'date-time' },
                    },
                },
                sessionHistory: {
                    type: 'object',
                    properties: {
                        totalSessions: { type: 'number' },
                        completedSessions: { type: 'number' },
                        cancelledSessions: { type: 'number' },
                        averageSessionRating: { type: 'number' },
                    },
                },
                progressMetrics: {
                    type: 'object',
                    properties: {
                        moodTrend: { type: 'array', items: { type: 'number' } },
                        goalAchievements: { type: 'number' },
                        improvementScore: { type: 'number' },
                        worksheetsCompleted: { type: 'number' },
                    },
                },
                engagementStats: {
                    type: 'object',
                    properties: {
                        loginFrequency: { type: 'number' },
                        messagesSent: { type: 'number' },
                        averageResponseTime: { type: 'number' },
                    },
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Access denied: Can only view your own analytics or authorized access required',
    }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __param(2, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.ClientAnalyticsQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, Object]),
    __metadata("design:returntype", void 0)
], AnalyticsController.prototype, "getClientAnalytics", null);
exports.AnalyticsController = AnalyticsController = __decorate([
    (0, swagger_1.ApiTags)('analytics'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('analytics'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof analytics_service_1.AnalyticsService !== "undefined" && analytics_service_1.AnalyticsService) === "function" ? _a : Object])
], AnalyticsController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2FuYWx5dGljcy9hbmFseXRpY3MuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBTXdCO0FBQ3hCLDJEQUF1RDtBQUN2RCxrRUFBNkQ7QUFDN0QsNEZBQTZFO0FBQzdFLGdHQUFpRjtBQUNqRiw2RUFBd0U7QUFDeEUsNkNBUXlCO0FBQ3pCLHFEQU95QjtBQU1sQixJQUFNLG1CQUFtQixHQUF6QixNQUFNLG1CQUFtQjtJQUNEO0lBQTdCLFlBQTZCLGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0lBQUcsQ0FBQztJQWlFbkUsb0JBQW9CLENBQ0MsSUFBWSxFQUUvQixLQUFnQztRQUVoQyxJQUFJLElBQUksS0FBSyxPQUFPLEVBQUUsQ0FBQztZQUNyQixNQUFNLElBQUksMkJBQWtCLENBQUMsb0NBQW9DLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBRUQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDcEUsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFFOUQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUF3RUQscUJBQXFCLENBQ0YsTUFBYyxFQUNaLElBQVksRUFFL0IsS0FBaUM7UUFFakMscUVBQXFFO1FBQ3JFLE1BQU0saUJBQWlCLEdBQUcsS0FBSyxDQUFDLFdBQVcsSUFBSSxNQUFNLENBQUM7UUFFdEQsSUFBSSxJQUFJLEtBQUss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QVksQ0FBQzt5REFFeUIsb0NBQWdCLG9CQUFoQixvQ0FBZ0I7R0FEcEQsbUJBQW1CLENBb1IvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYW5hbHl0aWNzL2FuYWx5dGljcy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUXVlcnksXG4gIFVzZUd1YXJkcyxcbiAgRm9yYmlkZGVuRXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBBbmFseXRpY3NTZXJ2aWNlIH0gZnJvbSAnLi9hbmFseXRpY3Muc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBDdXJyZW50VXNlcklkIH0gZnJvbSAnLi4vYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1pZC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJSb2xlIH0gZnJvbSAnLi4vYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1yb2xlLmRlY29yYXRvcic7XG5pbXBvcnQgeyBab2RWYWxpZGF0aW9uUGlwZSB9IGZyb20gJy4uL2NvbW1vbi9waXBlcy96b2QtdmFsaWRhdGlvbi5waXBlJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJvZHksXG4gIEFwaUJlYXJlckF1dGgsXG4gIEFwaVBhcmFtLFxuICBBcGlRdWVyeSxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7XG4gIFBsYXRmb3JtQW5hbHl0aWNzUXVlcnlEdG9TY2hlbWEsXG4gIFRoZXJhcGlzdEFuYWx5dGljc1F1ZXJ5RHRvU2NoZW1hLFxuICBDbGllbnRBbmFseXRpY3NRdWVyeUR0b1NjaGVtYSxcbiAgdHlwZSBQbGF0Zm9ybUFuYWx5dGljc1F1ZXJ5RHRvLFxuICB0eXBlIFRoZXJhcGlzdEFuYWx5dGljc1F1ZXJ5RHRvLFxuICB0eXBlIENsaWVudEFuYWx5dGljc1F1ZXJ5RHRvLFxufSBmcm9tICdtZW50YXJhLWNvbW1vbnMnO1xuXG5AQXBpVGFncygnYW5hbHl0aWNzJylcbkBBcGlCZWFyZXJBdXRoKCdKV1QtYXV0aCcpXG5AQ29udHJvbGxlcignYW5hbHl0aWNzJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIEFuYWx5dGljc0NvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGFuYWx5dGljc1NlcnZpY2U6IEFuYWx5dGljc1NlcnZpY2UpIHt9XG5cbiAgQEdldCgncGxhdGZvcm0nKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnR2V0IHBsYXRmb3JtIGFuYWx5dGljcycsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnUmV0cmlldmUgY29tcHJlaGVuc2l2ZSBwbGF0Zm9ybSBhbmFseXRpY3MgZGF0YS4gQWRtaW4gYWNjZXNzIHJlcXVpcmVkLicsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ2RhdGVGcm9tJyxcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246ICdTdGFydCBkYXRlIGZvciBhbmFseXRpY3MgKElTTyBzdHJpbmcpJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnZGF0ZVRvJyxcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVzY3JpcHRpb246ICdFbmQgZGF0ZSBmb3IgYW5hbHl0aWNzIChJU08gc3RyaW5nKScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdQbGF0Zm9ybSBhbmFseXRpY3MgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdXNlclN0YXRzOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgdG90YWxVc2VyczogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgbmV3VXNlcnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIGFjdGl2ZVVzZXJzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICB1c2VyR3Jvd3RoUmF0ZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHNlc3Npb25TdGF0czoge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIHRvdGFsU2Vzc2lvbnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIGF2ZXJhZ2VTZXNzaW9uRHVyYXRpb246IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIHNlc3Npb25Db21wbGV0aW9uUmF0ZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRoZXJhcGlzdFN0YXRzOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgdG90YWxUaGVyYXBpc3RzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBhY3RpdmVUaGVyYXBpc3RzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBhdmVyYWdlUmF0aW5nOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmV2ZW51ZToge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIHRvdGFsUmV2ZW51ZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgbW9udGhseVJldmVudWU6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIHJldmVudWVHcm93dGg6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDMsXG4gICAgZGVzY3JpcHRpb246ICdBY2Nlc3MgZGVuaWVkOiBBZG1pbiByb2xlIHJlcXVpcmVkJyxcbiAgfSlcbiAgZ2V0UGxhdGZvcm1BbmFseXRpY3MoXG4gICAgQEN1cnJlbnRVc2VyUm9sZSgpIHJvbGU6IHN0cmluZyxcbiAgICBAUXVlcnkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFBsYXRmb3JtQW5hbHl0aWNzUXVlcnlEdG9TY2hlbWEpKVxuICAgIHF1ZXJ5OiBQbGF0Zm9ybUFuYWx5dGljc1F1ZXJ5RHRvLFxuICApIHtcbiAgICBpZiAocm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignQWNjZXNzIGRlbmllZDogQWRtaW4gcm9sZSByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0ID0gcXVlcnkuZGF0ZUZyb20gPyBuZXcgRGF0ZShxdWVyeS5kYXRlRnJvbSkgOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgZW5kID0gcXVlcnkuZGF0ZVRvID8gbmV3IERhdGUocXVlcnkuZGF0ZVRvKSA6IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB0aGlzLmFuYWx5dGljc1NlcnZpY2UuZ2V0UGxhdGZvcm1BbmFseXRpY3Moc3RhcnQsIGVuZCk7XG4gIH1cblxuICBAR2V0KCd0aGVyYXBpc3QnKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnR2V0IHRoZXJhcGlzdCBhbmFseXRpY3MnLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ1JldHJpZXZlIGFuYWx5dGljcyBmb3IgYSBzcGVjaWZpYyB0aGVyYXBpc3QuIFRoZXJhcGlzdHMgY2FuIHZpZXcgdGhlaXIgb3duIGFuYWx5dGljcywgYWRtaW5zIGNhbiB2aWV3IGFueS4nLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICd0aGVyYXBpc3RJZCcsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGRlc2NyaXB0aW9uOiAnVGhlcmFwaXN0IElEIChkZWZhdWx0cyB0byBjdXJyZW50IHVzZXIgZm9yIHRoZXJhcGlzdHMpJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnZGF0ZUZyb20nLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ1N0YXJ0IGRhdGUgZm9yIGFuYWx5dGljcyAoSVNPIHN0cmluZyknLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdkYXRlVG8nLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ0VuZCBkYXRlIGZvciBhbmFseXRpY3MgKElTTyBzdHJpbmcpJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1RoZXJhcGlzdCBhbmFseXRpY3MgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdGhlcmFwaXN0SW5mbzoge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIGlkOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBuYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBzcGVjaWFsaXphdGlvbnM6IHsgdHlwZTogJ2FycmF5JywgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGNsaWVudFN0YXRzOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgdG90YWxDbGllbnRzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBhY3RpdmVDbGllbnRzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBuZXdDbGllbnRzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBjbGllbnRSZXRlbnRpb25SYXRlOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgc2Vzc2lvbk1ldHJpY3M6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICB0b3RhbFNlc3Npb25zOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBhdmVyYWdlU2Vzc2lvbkR1cmF0aW9uOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBzZXNzaW9uUmF0aW5nOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBjb21wbGV0aW9uUmF0ZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlTWV0cmljczoge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIHJlc3BvbnNlVGltZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgY2xpZW50U2F0aXNmYWN0aW9uOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICB0cmVhdG1lbnRFZmZlY3RpdmVuZXNzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAzLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ0FjY2VzcyBkZW5pZWQ6IENhbiBvbmx5IHZpZXcgeW91ciBvd24gYW5hbHl0aWNzIG9yIGFkbWluIGFjY2VzcyByZXF1aXJlZCcsXG4gIH0pXG4gIGdldFRoZXJhcGlzdEFuYWx5dGljcyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSByb2xlOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShUaGVyYXBpc3RBbmFseXRpY3NRdWVyeUR0b1NjaGVtYSkpXG4gICAgcXVlcnk6IFRoZXJhcGlzdEFuYWx5dGljc1F1ZXJ5RHRvLFxuICApIHtcbiAgICAvLyBBbGxvdyB0aGVyYXBpc3RzIHRvIHZpZXcgdGhlaXIgb3duIGFuYWx5dGljcyBvciBhZG1pbnMgdG8gdmlldyBhbnlcbiAgICBjb25zdCB0YXJnZXRUaGVyYXBpc3RJZCA9IHF1ZXJ5LnRoZXJhcGlzdElkIHx8IHVzZXJJZDtcblxuICAgIGlmIChyb2xlID09PSAndGhlcmFwaXN0JyAmJiB0YXJnZXRUaGVyYXBpc3RJZCAhPT0gdXNlcklkKSB7XG4gICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKFxuICAgICAgICAnQWNjZXNzIGRlbmllZDogQ2FuIG9ubHkgdmlldyB5b3VyIG93biBhbmFseXRpY3MnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocm9sZSAhPT0gJ3RoZXJhcGlzdCcgJiYgcm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbihcbiAgICAgICAgJ0FjY2VzcyBkZW5pZWQ6IFRoZXJhcGlzdCBvciBBZG1pbiByb2xlIHJlcXVpcmVkJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnQgPSBxdWVyeS5kYXRlRnJvbSA/IG5ldyBEYXRlKHF1ZXJ5LmRhdGVGcm9tKSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBlbmQgPSBxdWVyeS5kYXRlVG8gPyBuZXcgRGF0ZShxdWVyeS5kYXRlVG8pIDogdW5kZWZpbmVkO1xuXG4gICAgcmV0dXJuIHRoaXMuYW5hbHl0aWNzU2VydmljZS5nZXRUaGVyYXBpc3RBbmFseXRpY3MoXG4gICAgICB0YXJnZXRUaGVyYXBpc3RJZCxcbiAgICAgIHN0YXJ0LFxuICAgICAgZW5kLFxuICAgICk7XG4gIH1cblxuICBAR2V0KCdjbGllbnQnKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnR2V0IGNsaWVudCBhbmFseXRpY3MnLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ1JldHJpZXZlIGFuYWx5dGljcyBmb3IgYSBzcGVjaWZpYyBjbGllbnQuIENsaWVudHMgY2FuIHZpZXcgdGhlaXIgb3duIGFuYWx5dGljcywgdGhlcmFwaXN0cy9hZG1pbnMgY2FuIHZpZXcgYXNzaWduZWQgY2xpZW50cy4nLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdjbGllbnRJZCcsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGRlc2NyaXB0aW9uOiAnQ2xpZW50IElEIChkZWZhdWx0cyB0byBjdXJyZW50IHVzZXIgZm9yIGNsaWVudHMpJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnZGF0ZUZyb20nLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ1N0YXJ0IGRhdGUgZm9yIGFuYWx5dGljcyAoSVNPIHN0cmluZyknLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdkYXRlVG8nLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjcmlwdGlvbjogJ0VuZCBkYXRlIGZvciBhbmFseXRpY3MgKElTTyBzdHJpbmcpJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0NsaWVudCBhbmFseXRpY3MgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgY2xpZW50SW5mbzoge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIGlkOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBuYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICBqb2luRGF0ZTogeyB0eXBlOiAnc3RyaW5nJywgZm9ybWF0OiAnZGF0ZS10aW1lJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHNlc3Npb25IaXN0b3J5OiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgdG90YWxTZXNzaW9uczogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgY29tcGxldGVkU2Vzc2lvbnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIGNhbmNlbGxlZFNlc3Npb25zOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBhdmVyYWdlU2Vzc2lvblJhdGluZzogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHByb2dyZXNzTWV0cmljczoge1xuICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIG1vb2RUcmVuZDogeyB0eXBlOiAnYXJyYXknLCBpdGVtczogeyB0eXBlOiAnbnVtYmVyJyB9IH0sXG4gICAgICAgICAgICBnb2FsQWNoaWV2ZW1lbnRzOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBpbXByb3ZlbWVudFNjb3JlOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICB3b3Jrc2hlZXRzQ29tcGxldGVkOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZW5nYWdlbWVudFN0YXRzOiB7XG4gICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgbG9naW5GcmVxdWVuY3k6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIG1lc3NhZ2VzU2VudDogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdBY2Nlc3MgZGVuaWVkOiBDYW4gb25seSB2aWV3IHlvdXIgb3duIGFuYWx5dGljcyBvciBhdXRob3JpemVkIGFjY2VzcyByZXF1aXJlZCcsXG4gIH0pXG4gIGdldENsaWVudEFuYWx5dGljcyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSByb2xlOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShDbGllbnRBbmFseXRpY3NRdWVyeUR0b1NjaGVtYSkpXG4gICAgcXVlcnk6IENsaWVudEFuYWx5dGljc1F1ZXJ5RHRvLFxuICApIHtcbiAgICAvLyBBbGxvdyBjbGllbnRzIHRvIHZpZXcgdGhlaXIgb3duIGFuYWx5dGljcyBvciBhZG1pbnMvdGhlcmFwaXN0cyB0byB2aWV3IGFzc2lnbmVkIGNsaWVudHNcbiAgICBjb25zdCB0YXJnZXRDbGllbnRJZCA9IHF1ZXJ5LmNsaWVudElkIHx8IHVzZXJJZDtcblxuICAgIGlmIChyb2xlID09PSAndXNlcicgJiYgdGFyZ2V0Q2xpZW50SWQgIT09IHVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbihcbiAgICAgICAgJ0FjY2VzcyBkZW5pZWQ6IENhbiBvbmx5IHZpZXcgeW91ciBvd24gYW5hbHl0aWNzJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHJvbGUgIT09ICd1c2VyJyAmJiByb2xlICE9PSAndGhlcmFwaXN0JyAmJiByb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdBY2Nlc3MgZGVuaWVkOiBJbnZhbGlkIHJvbGUnKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFydCA9IHF1ZXJ5LmRhdGVGcm9tID8gbmV3IERhdGUocXVlcnkuZGF0ZUZyb20pIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IGVuZCA9IHF1ZXJ5LmRhdGVUbyA/IG5ldyBEYXRlKHF1ZXJ5LmRhdGVUbykgOiB1bmRlZmluZWQ7XG5cbiAgICByZXR1cm4gdGhpcy5hbmFseXRpY3NTZXJ2aWNlLmdldENsaWVudEFuYWx5dGljcyh0YXJnZXRDbGllbnRJZCwgc3RhcnQsIGVuZCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==