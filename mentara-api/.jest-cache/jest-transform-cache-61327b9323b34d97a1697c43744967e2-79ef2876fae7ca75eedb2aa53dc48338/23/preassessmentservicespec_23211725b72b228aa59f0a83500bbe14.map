{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/pre-assessment.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/pre-assessment.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport {\n  NotFoundException,\n  BadRequestException,\n  InternalServerErrorException,\n  Logger,\n} from '@nestjs/common';\nimport { PreAssessmentService } from './pre-assessment.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { AiServiceClient } from './services/ai-service.client';\nimport * as PreAssessmentUtils from './pre-assessment.utils';\n\n// Mock the utility functions\njest.mock('./pre-assessment.utils', () => ({\n  calculateAllScores: jest.fn(),\n  generateSeverityLevels: jest.fn(),\n}));\n\ndescribe('PreAssessmentService', () => {\n  let service: PreAssessmentService;\n  let prismaService: any;\n  let aiServiceClient: any;\n  let loggerSpy: jest.SpyInstance;\n\n  // Mock data\n  const mockUser = {\n    id: 'user-123',\n    isActive: true,\n  };\n\n  const mockClient = {\n    userId: 'user-123',\n  };\n\n  const mockValidQuestionnaires = ['Anxiety', 'Depression', 'Stress'];\n  const mockValidAnswers = [\n    [2, 3, 1, 4, 2, 3, 1], // Anxiety: 7 questions\n    [1, 2, 3, 2, 1, 4, 3, 2, 1], // Depression: 9 questions\n    [3, 4, 2, 1, 3, 4, 2, 1, 3, 2], // Stress: 10 questions\n  ];\n\n  const mockValidAnswerMatrix = [\n    [1, 2, 3, 4, 5],\n    [2, 3, 4, 5, 1],\n    [3, 4, 5, 1, 2],\n  ];\n\n  const mockCalculatedScores = {\n    Anxiety: { score: 15, severity: 'moderate' },\n    Depression: { score: 12, severity: 'mild' },\n    Stress: { score: 18, severity: 'high' },\n  };\n\n  const mockSeverityLevels = {\n    Anxiety: 'moderate',\n    Depression: 'mild',\n    Stress: 'high',\n  };\n\n  const mockPreAssessment = {\n    id: 'assessment-123',\n    clientId: 'user-123',\n    questionnaires: mockValidQuestionnaires,\n    answers: mockValidAnswers,\n    answerMatrix: mockValidAnswerMatrix,\n    scores: { Anxiety: 15, Depression: 12, Stress: 18 },\n    severityLevels: mockSeverityLevels,\n    aiEstimate: { hasAnxiety: true, hasDepression: false },\n    createdAt: new Date('2024-01-15T00:00:00Z'),\n    updatedAt: new Date('2024-01-15T00:00:00Z'),\n  };\n\n  const mockAiResponse = {\n    success: true,\n    predictions: { hasAnxiety: true, hasDepression: false, hasStress: true },\n    responseTime: 150,\n  };\n\n  beforeEach(async () => {\n    const mockPrismaService = {\n      user: {\n        findUnique: jest.fn(),\n      },\n      client: {\n        findUnique: jest.fn(),\n      },\n      preAssessment: {\n        findUnique: jest.fn(),\n        create: jest.fn(),\n        update: jest.fn(),\n        delete: jest.fn(),\n      },\n    };\n\n    const mockAiServiceClient = {\n      predict: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        PreAssessmentService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n        {\n          provide: AiServiceClient,\n          useValue: mockAiServiceClient,\n        },\n      ],\n    }).compile();\n\n    service = module.get<PreAssessmentService>(PreAssessmentService);\n    prismaService = module.get(PrismaService);\n    aiServiceClient = module.get(AiServiceClient);\n\n    // Setup utility mocks\n    (PreAssessmentUtils.calculateAllScores as jest.Mock).mockReturnValue(\n      mockCalculatedScores,\n    );\n    (PreAssessmentUtils.generateSeverityLevels as jest.Mock).mockReturnValue(\n      mockSeverityLevels,\n    );\n\n    // Setup logger spy\n    loggerSpy = jest.spyOn(Logger.prototype, 'log').mockImplementation();\n    jest.spyOn(Logger.prototype, 'debug').mockImplementation();\n    jest.spyOn(Logger.prototype, 'warn').mockImplementation();\n    jest.spyOn(Logger.prototype, 'error').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('createPreAssessment', () => {\n    const validCreateData = {\n      questionnaires: mockValidQuestionnaires,\n      answers: mockValidAnswers,\n      answerMatrix: mockValidAnswerMatrix,\n      scores: { Anxiety: 15, Depression: 12, Stress: 18 },\n      severityLevels: mockSeverityLevels,\n      aiEstimate: { hasAnxiety: true, hasDepression: false },\n    };\n\n    beforeEach(() => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.client.findUnique.mockResolvedValue(mockClient);\n      prismaService.preAssessment.findUnique.mockResolvedValue(null); // No existing assessment\n      prismaService.preAssessment.create.mockResolvedValue(mockPreAssessment);\n      aiServiceClient.predict.mockResolvedValue(mockAiResponse);\n    });\n\n    it('should create a pre-assessment successfully', async () => {\n      const result = await service.createPreAssessment(\n        'user-123',\n        validCreateData,\n      );\n\n      expect(prismaService.user.findUnique).toHaveBeenCalledWith({\n        where: { id: 'user-123', isActive: true },\n        select: { id: true, isActive: true },\n      });\n      expect(prismaService.client.findUnique).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n        select: { userId: true },\n      });\n      expect(prismaService.preAssessment.create).toHaveBeenCalledWith({\n        data: {\n          clientId: 'user-123',\n          questionnaires: mockValidQuestionnaires,\n          answers: mockValidAnswers,\n          answerMatrix: mockValidAnswerMatrix,\n          scores: validCreateData.scores,\n          severityLevels: validCreateData.severityLevels,\n          aiEstimate: expect.any(Object),\n        },\n      });\n      expect(result).toEqual(mockPreAssessment);\n    });\n\n    it('should throw NotFoundException when user not found', async () => {\n      prismaService.user.findUnique.mockResolvedValue(null);\n\n      await expect(\n        service.createPreAssessment('nonexistent-user', validCreateData),\n      ).rejects.toThrow(new NotFoundException('User not found or inactive'));\n    });\n\n    it('should throw NotFoundException when user is inactive', async () => {\n      // Override the beforeEach mock for this specific test\n      prismaService.user.findUnique.mockReset();\n      prismaService.user.findUnique.mockResolvedValue(null); // Inactive users return null from WHERE clause\n\n      await expect(\n        service.createPreAssessment('user-123', validCreateData),\n      ).rejects.toThrow(new NotFoundException('User not found or inactive'));\n    });\n\n    it('should throw NotFoundException when client profile not found', async () => {\n      prismaService.client.findUnique.mockResolvedValue(null);\n\n      await expect(\n        service.createPreAssessment('user-123', validCreateData),\n      ).rejects.toThrow(new NotFoundException('Client profile not found'));\n    });\n\n    it('should throw BadRequestException when pre-assessment already exists', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(\n        mockPreAssessment,\n      );\n\n      await expect(\n        service.createPreAssessment('user-123', validCreateData),\n      ).rejects.toThrow(\n        new BadRequestException('Pre-assessment already exists for this user'),\n      );\n    });\n\n    it('should calculate scores when not provided', async () => {\n      const dataWithoutScores = {\n        questionnaires: mockValidQuestionnaires,\n        answers: mockValidAnswers,\n        answerMatrix: mockValidAnswerMatrix,\n        scores: undefined, // Explicitly undefined to trigger calculation\n        severityLevels: undefined, // Explicitly undefined to trigger calculation\n        aiEstimate: {},\n      };\n\n      await service.createPreAssessment('user-123', dataWithoutScores);\n\n      expect(PreAssessmentUtils.calculateAllScores).toHaveBeenCalledWith(\n        mockValidQuestionnaires,\n        mockValidAnswers,\n      );\n      expect(PreAssessmentUtils.generateSeverityLevels).toHaveBeenCalledWith(\n        mockCalculatedScores,\n      );\n    });\n\n    it('should handle AI prediction successfully', async () => {\n      // Create flat answers array with exactly 201 values\n      const flatAnswers = new Array(201).fill(0).map((_, i) => i % 5);\n      const dataWith201Values = {\n        questionnaires: ['Test'],\n        answers: [flatAnswers],\n        answerMatrix: [flatAnswers],\n        scores: {},\n        severityLevels: {},\n        aiEstimate: {},\n      };\n\n      await service.createPreAssessment('user-123', dataWith201Values);\n\n      expect(aiServiceClient.predict).toHaveBeenCalledWith(flatAnswers);\n    });\n\n    it('should continue without AI prediction when AI service fails', async () => {\n      aiServiceClient.predict.mockResolvedValue({\n        success: false,\n        error: 'AI service unavailable',\n      });\n\n      const result = await service.createPreAssessment(\n        'user-123',\n        validCreateData,\n      );\n\n      expect(result).toBeDefined();\n      expect(loggerSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Pre-assessment created successfully'),\n      );\n    });\n\n    it('should handle validation errors for invalid answer types', async () => {\n      const invalidData = {\n        ...validCreateData,\n        answers: [['invalid', 'data']], // Invalid answer types\n      };\n\n      // Should throw because validation happens before AI processing\n      await expect(\n        service.createPreAssessment('user-123', invalidData),\n      ).rejects.toThrow(BadRequestException);\n    });\n\n    describe('Input validation', () => {\n      it('should validate questionnaires array', async () => {\n        const invalidData = {\n          ...validCreateData,\n          questionnaires: 'invalid-string',\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', invalidData),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should validate empty questionnaires array', async () => {\n        const invalidData = {\n          ...validCreateData,\n          questionnaires: [],\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', invalidData),\n        ).rejects.toThrow(\n          new BadRequestException('At least one questionnaire is required'),\n        );\n      });\n\n      it('should validate questionnaires and answers alignment', async () => {\n        const mismatchedData = {\n          ...validCreateData,\n          questionnaires: ['Anxiety', 'Depression'], // 2 questionnaires\n          answers: [[1, 2, 3]], // 1 answer array\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', mismatchedData),\n        ).rejects.toThrow(\n          new BadRequestException(\n            'Number of questionnaires must match number of answer arrays',\n          ),\n        );\n      });\n\n      it('should validate answer values are numbers', async () => {\n        const invalidData = {\n          ...validCreateData,\n          answers: [[1, 2, 'invalid', 4]], // Invalid answer type\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', invalidData),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should validate answer values are in range', async () => {\n        const invalidData = {\n          ...validCreateData,\n          answers: [[1, 2, 15, 4]], // Value out of range (0-10)\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', invalidData),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should validate answer values are finite', async () => {\n        const invalidData = {\n          ...validCreateData,\n          answers: [[1, 2, Infinity, 4]], // Infinite value\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', invalidData),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should validate questionnaire names are strings', async () => {\n        const invalidData = {\n          ...validCreateData,\n          questionnaires: ['Valid', 123, 'Another'], // Invalid questionnaire type\n        };\n\n        await expect(\n          service.createPreAssessment('user-123', invalidData),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should warn about unknown questionnaire types', async () => {\n        const dataWithUnknownQuestionnaire = {\n          ...validCreateData,\n          questionnaires: ['Anxiety', 'UnknownType'],\n          answers: [\n            [1, 2, 3],\n            [4, 5, 6],\n          ], // Match the questionnaire count\n        };\n\n        await service.createPreAssessment(\n          'user-123',\n          dataWithUnknownQuestionnaire,\n        );\n\n        expect(Logger.prototype.warn).toHaveBeenCalledWith(\n          'Unknown questionnaire type: UnknownType',\n        );\n      });\n    });\n\n    describe('Error handling', () => {\n      it('should handle database errors gracefully', async () => {\n        prismaService.preAssessment.create.mockRejectedValue(\n          new Error('Database error'),\n        );\n\n        await expect(\n          service.createPreAssessment('user-123', validCreateData),\n        ).rejects.toThrow(InternalServerErrorException);\n      });\n\n      it('should preserve specific exception types', async () => {\n        const notFoundError = new NotFoundException('User not found');\n        prismaService.user.findUnique.mockRejectedValue(notFoundError);\n\n        await expect(\n          service.createPreAssessment('user-123', validCreateData),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n  });\n\n  describe('getPreAssessmentByUserId', () => {\n    it('should return pre-assessment for valid user ID', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(\n        mockPreAssessment,\n      );\n\n      const result = await service.getPreAssessmentByUserId('user-123');\n\n      expect(prismaService.preAssessment.findUnique).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n      });\n      expect(result).toEqual(mockPreAssessment);\n    });\n\n    it('should throw NotFoundException when pre-assessment not found', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(null);\n\n      await expect(\n        service.getPreAssessmentByUserId('user-123'),\n      ).rejects.toThrow(new NotFoundException('Pre-assessment not found'));\n    });\n\n    it('should handle database errors', async () => {\n      prismaService.preAssessment.findUnique.mockRejectedValue(\n        new Error('Database error'),\n      );\n\n      await expect(\n        service.getPreAssessmentByUserId('user-123'),\n      ).rejects.toThrow(InternalServerErrorException);\n    });\n  });\n\n  describe('getPreAssessmentByClientId', () => {\n    it('should return pre-assessment with client and user data', async () => {\n      const mockPreAssessmentWithClient = {\n        ...mockPreAssessment,\n        client: {\n          user: mockUser,\n        },\n      };\n      prismaService.preAssessment.findUnique.mockResolvedValue(\n        mockPreAssessmentWithClient,\n      );\n\n      const result = await service.getPreAssessmentByClientId('user-123');\n\n      expect(prismaService.preAssessment.findUnique).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n        include: { client: { include: { user: true } } },\n      });\n      expect(result).toEqual(mockPreAssessmentWithClient);\n    });\n\n    it('should throw NotFoundException when pre-assessment not found', async () => {\n      prismaService.preAssessment.findUnique.mockResolvedValue(null);\n\n      await expect(\n        service.getPreAssessmentByClientId('user-123'),\n      ).rejects.toThrow(new NotFoundException('Pre-assessment not found'));\n    });\n  });\n\n  describe('updatePreAssessment', () => {\n    const updateData = {\n      questionnaires: ['Anxiety', 'Stress'],\n      answers: [\n        [1, 2, 3],\n        [4, 5, 6],\n      ],\n      answerMatrix: [\n        [1, 2],\n        [3, 4],\n      ],\n    };\n\n    beforeEach(() => {\n      prismaService.client.findUnique.mockResolvedValue(mockClient);\n      prismaService.preAssessment.update.mockResolvedValue(mockPreAssessment);\n    });\n\n    it('should update pre-assessment successfully', async () => {\n      const result = await service.updatePreAssessment('user-123', updateData);\n\n      expect(prismaService.client.findUnique).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n      });\n      expect(prismaService.preAssessment.update).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n        data: {\n          questionnaires: updateData.questionnaires,\n          answers: updateData.answers,\n          answerMatrix: updateData.answerMatrix,\n          scores: expect.any(Object),\n          severityLevels: expect.any(Object),\n        },\n      });\n      expect(result).toEqual(mockPreAssessment);\n    });\n\n    it('should use provided scores when valid', async () => {\n      const dataWithScores = {\n        ...updateData,\n        scores: { Anxiety: 20, Stress: 15 },\n        severityLevels: { Anxiety: 'high', Stress: 'moderate' },\n      };\n\n      await service.updatePreAssessment('user-123', dataWithScores);\n\n      expect(prismaService.preAssessment.update).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n        data: expect.objectContaining({\n          scores: { Anxiety: 20, Stress: 15 },\n          severityLevels: { Anxiety: 'high', Stress: 'moderate' },\n        }),\n      });\n    });\n\n    it('should calculate scores when questionnaires and answers provided without scores', async () => {\n      await service.updatePreAssessment('user-123', updateData);\n\n      expect(PreAssessmentUtils.calculateAllScores).toHaveBeenCalledWith(\n        updateData.questionnaires,\n        updateData.answers,\n      );\n      expect(PreAssessmentUtils.generateSeverityLevels).toHaveBeenCalledWith(\n        mockCalculatedScores,\n      );\n    });\n\n    it('should throw NotFoundException when client not found', async () => {\n      prismaService.client.findUnique.mockResolvedValue(null);\n\n      await expect(\n        service.updatePreAssessment('user-123', updateData),\n      ).rejects.toThrow(new NotFoundException('Client not found'));\n    });\n\n    it('should handle invalid scores gracefully', async () => {\n      const dataWithInvalidScores = {\n        ...updateData,\n        scores: 'invalid-scores',\n        severityLevels: { valid: 'levels' },\n      };\n\n      await service.updatePreAssessment('user-123', dataWithInvalidScores);\n\n      expect(prismaService.preAssessment.update).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n        data: expect.objectContaining({\n          scores: expect.any(Object), // Should be calculated scores\n          severityLevels: { valid: 'levels' },\n        }),\n      });\n    });\n\n    it('should handle invalid severity levels gracefully', async () => {\n      const dataWithInvalidLevels = {\n        ...updateData,\n        scores: { Anxiety: 15 },\n        severityLevels: 123, // Invalid type\n      };\n\n      await service.updatePreAssessment('user-123', dataWithInvalidLevels);\n\n      expect(prismaService.preAssessment.update).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n        data: expect.objectContaining({\n          scores: { Anxiety: 15 },\n          severityLevels: expect.any(Object), // Should be calculated levels\n        }),\n      });\n    });\n  });\n\n  describe('deletePreAssessment', () => {\n    it('should delete pre-assessment successfully', async () => {\n      prismaService.preAssessment.delete.mockResolvedValue(mockPreAssessment);\n\n      const result = await service.deletePreAssessment('user-123');\n\n      expect(prismaService.preAssessment.delete).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n      });\n      expect(result).toBeNull();\n    });\n\n    it('should handle deletion errors', async () => {\n      prismaService.preAssessment.delete.mockRejectedValue(\n        new Error('Delete failed'),\n      );\n\n      await expect(service.deletePreAssessment('user-123')).rejects.toThrow(\n        InternalServerErrorException,\n      );\n    });\n  });\n\n  describe('flattenAnswers', () => {\n    it('should flatten 2D array correctly', () => {\n      const answers = [\n        [1, 2, 3],\n        [4, 5],\n        [6, 7, 8, 9],\n      ];\n      // Access private method through service instance\n      const result = (service as any).flattenAnswers(answers);\n\n      expect(result).toEqual([1, 2, 3, 4, 5, 6, 7, 8, 9]);\n    });\n\n    it('should validate flattened array is not empty', () => {\n      const emptyAnswers = [[], [], []];\n\n      expect(() => (service as any).flattenAnswers(emptyAnswers)).toThrow(\n        new BadRequestException('Flattened answers array cannot be empty'),\n      );\n    });\n\n    it('should validate all values are finite numbers', () => {\n      const invalidAnswers = [\n        [1, 2, NaN],\n        [4, 5],\n      ];\n\n      expect(() => (service as any).flattenAnswers(invalidAnswers)).toThrow(\n        new BadRequestException('All answer values must be finite numbers'),\n      );\n    });\n\n    it('should warn when not exactly 201 values for AI prediction', () => {\n      const shortAnswers = [[1, 2, 3]];\n      const warnSpy = jest.spyOn(Logger.prototype, 'warn');\n\n      (service as any).flattenAnswers(shortAnswers);\n\n      expect(warnSpy).toHaveBeenCalledWith(\n        'Expected 201 values for AI prediction, got 3',\n      );\n    });\n  });\n\n  describe('validateAnswersStructure', () => {\n    it('should pass validation for valid answers structure', () => {\n      const validAnswers = [\n        [1, 2, 3],\n        [4, 5, 6],\n      ];\n\n      expect(() =>\n        (service as any).validateAnswersStructure(validAnswers),\n      ).not.toThrow();\n    });\n\n    it('should throw error for non-array input', () => {\n      expect(() =>\n        (service as any).validateAnswersStructure('invalid'),\n      ).toThrow(new BadRequestException('Answers must be an array of arrays'));\n    });\n\n    it('should throw error for empty answers array', () => {\n      expect(() => (service as any).validateAnswersStructure([])).toThrow(\n        new BadRequestException('Answers array cannot be empty'),\n      );\n    });\n\n    it('should throw error for non-array questionnaire answers', () => {\n      const invalidAnswers = [[1, 2, 3], 'invalid', [4, 5, 6]]; // First element is valid numbers\n\n      expect(() =>\n        (service as any).validateAnswersStructure(invalidAnswers),\n      ).toThrow(\n        new BadRequestException('Questionnaire 1 answers must be an array'),\n      );\n    });\n\n    it('should throw error for empty questionnaire answers', () => {\n      const invalidAnswers = [[1, 2, 3], [], [4, 5, 6]];\n\n      expect(() =>\n        (service as any).validateAnswersStructure(invalidAnswers),\n      ).toThrow(\n        new BadRequestException('Questionnaire 1 cannot have empty answers'),\n      );\n    });\n\n    it('should throw error for out-of-range values', () => {\n      const invalidAnswers = [\n        [1, 2, 15],\n        [4, 5, 6],\n      ]; // 15 is out of range\n\n      expect(() =>\n        (service as any).validateAnswersStructure(invalidAnswers),\n      ).toThrow(\n        new BadRequestException(\n          'Answer value out of range (0-10) at questionnaire 0, question 2: 15',\n        ),\n      );\n    });\n\n    it('should throw error for negative values', () => {\n      const invalidAnswers = [\n        [1, 2, -1],\n        [4, 5, 6],\n      ]; // -1 is out of range\n\n      expect(() =>\n        (service as any).validateAnswersStructure(invalidAnswers),\n      ).toThrow(\n        new BadRequestException(\n          'Answer value out of range (0-10) at questionnaire 0, question 2: -1',\n        ),\n      );\n    });\n  });\n\n  describe('validateQuestionnaires', () => {\n    it('should pass validation for valid questionnaires', () => {\n      const validQuestionnaires = ['Anxiety', 'Depression', 'Stress'];\n\n      expect(() =>\n        (service as any).validateQuestionnaires(validQuestionnaires),\n      ).not.toThrow();\n    });\n\n    it('should throw error for non-array input', () => {\n      expect(() => (service as any).validateQuestionnaires('invalid')).toThrow(\n        new BadRequestException('Questionnaires must be an array'),\n      );\n    });\n\n    it('should throw error for empty questionnaires array', () => {\n      expect(() => (service as any).validateQuestionnaires([])).toThrow(\n        new BadRequestException('At least one questionnaire is required'),\n      );\n    });\n\n    it('should throw error for non-string questionnaire names', () => {\n      const invalidQuestionnaires = ['Valid', 123, 'Another'];\n\n      expect(() =>\n        (service as any).validateQuestionnaires(invalidQuestionnaires),\n      ).toThrow(\n        new BadRequestException(\n          'All questionnaire names must be non-empty strings',\n        ),\n      );\n    });\n\n    it('should throw error for empty string questionnaire names', () => {\n      const invalidQuestionnaires = ['Valid', '', 'Another'];\n\n      expect(() =>\n        (service as any).validateQuestionnaires(invalidQuestionnaires),\n      ).toThrow(\n        new BadRequestException(\n          'All questionnaire names must be non-empty strings',\n        ),\n      );\n    });\n  });\n\n  describe('AI Service Integration', () => {\n    it('should handle successful AI prediction', async () => {\n      aiServiceClient.predict.mockResolvedValue(mockAiResponse);\n\n      const result = await (service as any).getAiEstimate(\n        new Array(201).fill(1),\n      );\n\n      expect(result).toEqual(mockAiResponse.predictions);\n      expect(Logger.prototype.log).toHaveBeenCalledWith(\n        'AI prediction completed successfully in 150ms',\n      );\n    });\n\n    it('should handle AI prediction failure', async () => {\n      const failureResponse = { success: false, error: 'Model unavailable' };\n      aiServiceClient.predict.mockResolvedValue(failureResponse);\n\n      const result = await (service as any).getAiEstimate(\n        new Array(201).fill(1),\n      );\n\n      expect(result).toBeNull();\n      expect(Logger.prototype.warn).toHaveBeenCalledWith(\n        'AI prediction failed: Model unavailable',\n      );\n    });\n\n    it('should handle AI service exceptions', async () => {\n      aiServiceClient.predict.mockRejectedValue(new Error('Network error'));\n\n      const result = await (service as any).getAiEstimate(\n        new Array(201).fill(1),\n      );\n\n      expect(result).toBeNull();\n      expect(Logger.prototype.error).toHaveBeenCalledWith(\n        'AI model prediction error:',\n        'Network error',\n      );\n    });\n\n    it('should handle AI service timeout', async () => {\n      aiServiceClient.predict.mockRejectedValue(new Error('Timeout'));\n\n      const result = await (service as any).getAiEstimate(\n        new Array(201).fill(1),\n      );\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('Edge Cases and Performance', () => {\n    it('should handle large questionnaire arrays', async () => {\n      const largeAnswers = new Array(50).fill([1, 2, 3, 4, 5]);\n      const largeQuestionnaires = new Array(50).fill('Stress');\n\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.client.findUnique.mockResolvedValue(mockClient);\n      prismaService.preAssessment.findUnique.mockResolvedValue(null);\n      prismaService.preAssessment.create.mockResolvedValue(mockPreAssessment);\n\n      const result = await service.createPreAssessment('user-123', {\n        questionnaires: largeQuestionnaires,\n        answers: largeAnswers,\n        answerMatrix: largeAnswers,\n        scores: {},\n        severityLevels: {},\n        aiEstimate: {},\n      });\n\n      expect(result).toBeDefined();\n    });\n\n    it('should handle concurrent creation attempts', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      prismaService.client.findUnique.mockResolvedValue(mockClient);\n      prismaService.preAssessment.findUnique.mockResolvedValue(null);\n      prismaService.preAssessment.create.mockResolvedValue(mockPreAssessment);\n\n      const validData = {\n        questionnaires: ['Anxiety'],\n        answers: [[1, 2, 3]],\n        answerMatrix: [[1, 2, 3]],\n        scores: {},\n        severityLevels: {},\n        aiEstimate: {},\n      };\n\n      // Simulate concurrent requests\n      const promises = [\n        service.createPreAssessment('user-123', validData),\n        service.createPreAssessment('user-123', validData),\n      ];\n\n      const results = await Promise.all(promises);\n      expect(results).toHaveLength(2);\n    });\n\n    it('should handle null and undefined in scores validation', () => {\n      const isValidScores = (service as any).isValidScores;\n\n      expect(isValidScores(null)).toBe(false);\n      expect(isValidScores(undefined)).toBe(false);\n      expect(isValidScores({})).toBe(true);\n      expect(isValidScores({ test: 5 })).toBe(true);\n      expect(isValidScores({ test: 'invalid' })).toBe(false);\n    });\n\n    it('should handle null and undefined in severity levels validation', () => {\n      const isValidSeverityLevels = (service as any).isValidSeverityLevels;\n\n      expect(isValidSeverityLevels(null)).toBe(false);\n      expect(isValidSeverityLevels(undefined)).toBe(false);\n      expect(isValidSeverityLevels({})).toBe(true);\n      expect(isValidSeverityLevels({ test: 'mild' })).toBe(true);\n      expect(isValidSeverityLevels({ test: 123 })).toBe(false);\n    });\n  });\n});\n"],"version":3}