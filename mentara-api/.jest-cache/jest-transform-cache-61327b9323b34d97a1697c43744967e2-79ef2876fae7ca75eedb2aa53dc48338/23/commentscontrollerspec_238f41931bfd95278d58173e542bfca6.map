{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/comments/comments.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/comments/comments.controller.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { HttpException, HttpStatus } from '@nestjs/common';\nimport { CommentsController } from './comments.controller';\nimport { CommentsService } from './comments.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CommunityAccessGuard } from '../auth/guards/community-access.guard';\nimport { SupabaseStorageService } from '../common/services/supabase-storage.service';\nimport { Comment } from '@prisma/client';\nimport {\n  MockBuilder,\n  TestDataGenerator,\n  TestAssertions,\n  SecurityGuardTestUtils,\n  TEST_USER_IDS,\n  TEST_POST_IDS,\n  TEST_COMMENT_IDS,\n} from '../test-utils/auth-testing-helpers';\n\ndescribe('CommentsController', () => {\n  let controller: CommentsController;\n  let commentsService: CommentsService;\n  let supabaseStorageService: SupabaseStorageService;\n  let mockJwtAuthGuard: jest.Mocked<JwtAuthGuard>;\n  let mockCommunityAccessGuard: jest.Mocked<CommunityAccessGuard>;\n\n  // Mock data\n  const mockComment: Comment = {\n    id: TEST_COMMENT_IDS.ANXIETY_COMMENT,\n    content: 'This is a test comment',\n    userId: TEST_USER_IDS.CLIENT,\n    postId: TEST_POST_IDS.ANXIETY_POST,\n    parentId: null,\n    attachmentUrls: [],\n    attachmentNames: [],\n    attachmentSizes: [],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockComments: Comment[] = [mockComment];\n\n  const mockCreateCommentDto = {\n    content: 'This is a new comment',\n    postId: TEST_POST_IDS.ANXIETY_POST,\n    parentId: null,\n  };\n\n  const mockUpdateCommentDto = {\n    content: 'This is an updated comment',\n  };\n\n  const mockFiles = [\n    {\n      fieldname: 'files',\n      originalname: 'comment-image.jpg',\n      encoding: '7bit',\n      mimetype: 'image/jpeg',\n      size: 512,\n      buffer: Buffer.from('test comment file content'),\n    },\n  ] as Express.Multer.File[];\n\n  const mockFileResults = [\n    {\n      url: 'https://example.com/comment-image.jpg',\n      filename: 'comment-image.jpg',\n      size: 512,\n    },\n  ];\n\n  beforeEach(async () => {\n    // Create mock services\n    const mockCommentsService = {\n      findAll: jest.fn(),\n      findOne: jest.fn(),\n      findByPostId: jest.fn(),\n      create: jest.fn(),\n      update: jest.fn(),\n      remove: jest.fn(),\n      heartComment: jest.fn(),\n      isCommentHeartedByUser: jest.fn(),\n      reportComment: jest.fn(),\n    };\n\n    const mockSupabaseStorageService = {\n      validateFile: jest.fn(),\n      uploadFiles: jest.fn(),\n      getSupportedBuckets: jest.fn(),\n    };\n\n    mockJwtAuthGuard = {\n      canActivate: jest.fn().mockReturnValue(true),\n    } as any;\n\n    mockCommunityAccessGuard = {\n      canActivate: jest.fn().mockReturnValue(true),\n    } as any;\n\n    // Add static method mock\n    SupabaseStorageService.getSupportedBuckets = jest.fn().mockReturnValue({\n      POST_ATTACHMENTS: 'post-attachments',\n    });\n\n    const module: TestingModule = await Test.createTestingModule({\n      controllers: [CommentsController],\n      providers: [\n        {\n          provide: CommentsService,\n          useValue: mockCommentsService,\n        },\n        {\n          provide: SupabaseStorageService,\n          useValue: mockSupabaseStorageService,\n        },\n      ],\n    })\n      .overrideGuard(JwtAuthGuard)\n      .useValue(mockJwtAuthGuard)\n      .overrideGuard(CommunityAccessGuard)\n      .useValue(mockCommunityAccessGuard)\n      .compile();\n\n    controller = module.get<CommentsController>(CommentsController);\n    commentsService = module.get<CommentsService>(CommentsService);\n    supabaseStorageService = module.get<SupabaseStorageService>(SupabaseStorageService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('findAll', () => {\n    it('should return all comments for authenticated user', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'findAll').mockResolvedValue(mockComments);\n\n      // Act\n      const result = await controller.findAll(TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(commentsService.findAll).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      expect(result).toEqual(mockComments);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(commentsService, 'findAll').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.findAll(TEST_USER_IDS.CLIENT)).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('findOne', () => {\n    it('should return a specific comment when found', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'findOne').mockResolvedValue(mockComment);\n\n      // Act\n      const result = await controller.findOne(TEST_COMMENT_IDS.ANXIETY_COMMENT);\n\n      // Assert\n      expect(commentsService.findOne).toHaveBeenCalledWith(TEST_COMMENT_IDS.ANXIETY_COMMENT);\n      expect(result).toEqual(mockComment);\n    });\n\n    it('should throw HttpException when comment not found', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'findOne').mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(controller.findOne(TEST_COMMENT_IDS.ANXIETY_COMMENT)).rejects.toThrow(\n        new HttpException('Comment not found', HttpStatus.NOT_FOUND),\n      );\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(commentsService, 'findOne').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.findOne(TEST_COMMENT_IDS.ANXIETY_COMMENT)).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('findByPostId', () => {\n    it('should return comments for a specific post', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'findByPostId').mockResolvedValue(mockComments);\n\n      // Act\n      const result = await controller.findByPostId(TEST_POST_IDS.ANXIETY_POST, TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(commentsService.findByPostId).toHaveBeenCalledWith(TEST_POST_IDS.ANXIETY_POST, TEST_USER_IDS.CLIENT);\n      expect(result).toEqual(mockComments);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(commentsService, 'findByPostId').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.findByPostId(TEST_POST_IDS.ANXIETY_POST, TEST_USER_IDS.CLIENT)).rejects.toThrow(\n        HttpException,\n      );\n    });\n  });\n\n  describe('create', () => {\n    it('should create comment successfully without files', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'create').mockResolvedValue(mockComment);\n\n      // Act\n      const result = await controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto);\n\n      // Assert\n      expect(commentsService.create).toHaveBeenCalledWith(\n        mockCreateCommentDto,\n        TEST_USER_IDS.CLIENT,\n        [],\n        [],\n        [],\n      );\n      expect(result).toEqual(mockComment);\n    });\n\n    it('should create comment successfully with files', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'create').mockResolvedValue(mockComment);\n      jest.spyOn(supabaseStorageService, 'validateFile').mockReturnValue({ isValid: true });\n      jest.spyOn(supabaseStorageService, 'uploadFiles').mockResolvedValue(mockFileResults);\n\n      // Act\n      const result = await controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto, mockFiles);\n\n      // Assert\n      expect(supabaseStorageService.validateFile).toHaveBeenCalledWith(mockFiles[0]);\n      expect(supabaseStorageService.uploadFiles).toHaveBeenCalledWith(mockFiles, 'post-attachments');\n      expect(commentsService.create).toHaveBeenCalledWith(\n        mockCreateCommentDto,\n        TEST_USER_IDS.CLIENT,\n        ['https://example.com/comment-image.jpg'],\n        ['comment-image.jpg'],\n        [512],\n      );\n      expect(result).toEqual(mockComment);\n    });\n\n    it('should handle file validation errors', async () => {\n      // Arrange\n      jest.spyOn(supabaseStorageService, 'validateFile').mockReturnValue({\n        isValid: false,\n        error: 'Invalid file type',\n      });\n\n      // Act & Assert\n      await expect(controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto, mockFiles)).rejects.toThrow(\n        HttpException,\n      );\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(commentsService, 'create').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto)).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('update', () => {\n    it('should update comment successfully', async () => {\n      // Arrange\n      const updatedComment = { ...mockComment, ...mockUpdateCommentDto };\n      jest.spyOn(commentsService, 'update').mockResolvedValue(updatedComment);\n\n      // Act\n      const result = await controller.update(\n        TEST_USER_IDS.CLIENT,\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        mockUpdateCommentDto,\n      );\n\n      // Assert\n      expect(commentsService.update).toHaveBeenCalledWith(\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        mockUpdateCommentDto,\n        TEST_USER_IDS.CLIENT,\n      );\n      expect(result).toEqual(updatedComment);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Comment not found');\n      jest.spyOn(commentsService, 'update').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(\n        controller.update(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT, mockUpdateCommentDto),\n      ).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('remove', () => {\n    it('should delete comment successfully', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'remove').mockResolvedValue(mockComment);\n\n      // Act\n      const result = await controller.remove(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT);\n\n      // Assert\n      expect(commentsService.remove).toHaveBeenCalledWith(TEST_COMMENT_IDS.ANXIETY_COMMENT, TEST_USER_IDS.CLIENT);\n      expect(result).toEqual(mockComment);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Comment not found');\n      jest.spyOn(commentsService, 'remove').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.remove(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT)).rejects.toThrow(\n        HttpException,\n      );\n    });\n  });\n\n  describe('heartComment', () => {\n    it('should heart comment successfully', async () => {\n      // Arrange\n      const heartResult = { hearted: true };\n      jest.spyOn(commentsService, 'heartComment').mockResolvedValue(heartResult);\n\n      // Act\n      const result = await controller.heartComment(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT);\n\n      // Assert\n      expect(commentsService.heartComment).toHaveBeenCalledWith(\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        TEST_USER_IDS.CLIENT,\n      );\n      expect(result).toEqual(heartResult);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Comment not found');\n      jest.spyOn(commentsService, 'heartComment').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.heartComment(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT)).rejects.toThrow(\n        HttpException,\n      );\n    });\n  });\n\n  describe('isCommentHearted', () => {\n    it('should check if comment is hearted successfully', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'isCommentHeartedByUser').mockResolvedValue(true);\n\n      // Act\n      const result = await controller.isCommentHearted(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT);\n\n      // Assert\n      expect(commentsService.isCommentHeartedByUser).toHaveBeenCalledWith(\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        TEST_USER_IDS.CLIENT,\n      );\n      expect(result).toEqual({ hearted: true });\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(commentsService, 'isCommentHeartedByUser').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(\n        controller.isCommentHearted(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT),\n      ).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('reportComment', () => {\n    const reportData = {\n      reason: 'harassment',\n      content: 'This comment is inappropriate',\n    };\n\n    it('should report comment successfully', async () => {\n      // Arrange\n      const reportId = 'comment-report-123';\n      jest.spyOn(commentsService, 'reportComment').mockResolvedValue(reportId);\n\n      // Act\n      const result = await controller.reportComment(\n        TEST_USER_IDS.CLIENT,\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        reportData,\n      );\n\n      // Assert\n      expect(commentsService.reportComment).toHaveBeenCalledWith(\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        TEST_USER_IDS.CLIENT,\n        reportData.reason,\n        reportData.content,\n      );\n      expect(result).toEqual({ success: true, reportId });\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Comment not found');\n      jest.spyOn(commentsService, 'reportComment').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(\n        controller.reportComment(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT, reportData),\n      ).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('Security Integration', () => {\n    it('should have proper guards applied', () => {\n      // Test that guards are applied at controller level\n      const guards = Reflect.getMetadata('__guards__', CommentsController);\n      expect(guards).toBeDefined();\n      expect(guards).toContain(JwtAuthGuard);\n      expect(guards).toContain(CommunityAccessGuard);\n    });\n\n    it('should apply RequireRoomAccess decorator to all endpoints', () => {\n      // Test that all endpoints have the RequireRoomAccess decorator\n      const protectedMethods = [\n        'findOne',\n        'findByPostId',\n        'create',\n        'update',\n        'remove',\n        'heartComment',\n        'reportComment',\n      ];\n\n      protectedMethods.forEach(method => {\n        const metadata = Reflect.getMetadata('require_room_access', controller[method as keyof CommentsController]);\n        expect(metadata).toBeTruthy();\n      });\n    });\n\n    it('should test community access guard integration', async () => {\n      // Test that CommunityAccessGuard is called for protected endpoints\n      mockCommunityAccessGuard.canActivate.mockReturnValue(true);\n      jest.spyOn(commentsService, 'findOne').mockResolvedValue(mockComment);\n\n      // Act\n      await controller.findOne(TEST_COMMENT_IDS.ANXIETY_COMMENT);\n\n      // Assert\n      expect(mockCommunityAccessGuard.canActivate).toHaveBeenCalled();\n    });\n  });\n\n  describe('Nested Comments (Parent-Child)', () => {\n    it('should create nested comment successfully', async () => {\n      // Arrange\n      const nestedCommentDto = {\n        content: 'This is a reply to another comment',\n        postId: TEST_POST_IDS.ANXIETY_POST,\n        parentId: TEST_COMMENT_IDS.ANXIETY_COMMENT,\n      };\n\n      const nestedComment = {\n        ...mockComment,\n        id: 'nested-comment-123',\n        parentId: TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        content: nestedCommentDto.content,\n      };\n\n      jest.spyOn(commentsService, 'create').mockResolvedValue(nestedComment);\n\n      // Act\n      const result = await controller.create(TEST_USER_IDS.CLIENT, nestedCommentDto);\n\n      // Assert\n      expect(commentsService.create).toHaveBeenCalledWith(\n        nestedCommentDto,\n        TEST_USER_IDS.CLIENT,\n        [],\n        [],\n        [],\n      );\n      expect(result).toEqual(nestedComment);\n    });\n\n    it('should handle nested comment creation errors', async () => {\n      // Arrange\n      const nestedCommentDto = {\n        content: 'This is a reply to another comment',\n        postId: TEST_POST_IDS.ANXIETY_POST,\n        parentId: 'non-existent-comment',\n      };\n\n      const error = new Error('Parent comment not found');\n      jest.spyOn(commentsService, 'create').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.create(TEST_USER_IDS.CLIENT, nestedCommentDto)).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('File Upload Integration', () => {\n    it('should handle multiple file uploads', async () => {\n      // Arrange\n      const multipleFiles = [\n        { ...mockFiles[0], originalname: 'comment1.jpg' },\n        { ...mockFiles[0], originalname: 'comment2.jpg' },\n      ];\n      const multipleFileResults = [\n        { url: 'https://example.com/comment1.jpg', filename: 'comment1.jpg', size: 512 },\n        { url: 'https://example.com/comment2.jpg', filename: 'comment2.jpg', size: 512 },\n      ];\n\n      jest.spyOn(commentsService, 'create').mockResolvedValue(mockComment);\n      jest.spyOn(supabaseStorageService, 'validateFile').mockReturnValue({ isValid: true });\n      jest.spyOn(supabaseStorageService, 'uploadFiles').mockResolvedValue(multipleFileResults);\n\n      // Act\n      const result = await controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto, multipleFiles);\n\n      // Assert\n      expect(supabaseStorageService.validateFile).toHaveBeenCalledTimes(2);\n      expect(supabaseStorageService.uploadFiles).toHaveBeenCalledWith(multipleFiles, 'post-attachments');\n      expect(commentsService.create).toHaveBeenCalledWith(\n        mockCreateCommentDto,\n        TEST_USER_IDS.CLIENT,\n        ['https://example.com/comment1.jpg', 'https://example.com/comment2.jpg'],\n        ['comment1.jpg', 'comment2.jpg'],\n        [512, 512],\n      );\n      expect(result).toEqual(mockComment);\n    });\n\n    it('should handle file upload service errors', async () => {\n      // Arrange\n      jest.spyOn(supabaseStorageService, 'validateFile').mockReturnValue({ isValid: true });\n      jest.spyOn(supabaseStorageService, 'uploadFiles').mockRejectedValue(new Error('Upload failed'));\n\n      // Act & Assert\n      await expect(controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto, mockFiles)).rejects.toThrow(\n        HttpException,\n      );\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle HttpException properly', async () => {\n      // Arrange\n      const httpException = new HttpException('Custom error', HttpStatus.BAD_REQUEST);\n      jest.spyOn(commentsService, 'findOne').mockRejectedValue(httpException);\n\n      // Act & Assert\n      await expect(controller.findOne(TEST_COMMENT_IDS.ANXIETY_COMMENT)).rejects.toThrow(httpException);\n    });\n\n    it('should wrap unknown errors in HttpException', async () => {\n      // Arrange\n      const unknownError = new Error('Unknown error');\n      jest.spyOn(commentsService, 'findAll').mockRejectedValue(unknownError);\n\n      // Act & Assert\n      await expect(controller.findAll(TEST_USER_IDS.CLIENT)).rejects.toThrow(HttpException);\n    });\n  });\n\n  describe('Integration Tests', () => {\n    it('should handle complete comment creation workflow', async () => {\n      // Arrange\n      jest.spyOn(commentsService, 'create').mockResolvedValue(mockComment);\n\n      // Act\n      const result = await controller.create(TEST_USER_IDS.CLIENT, mockCreateCommentDto);\n\n      // Assert\n      expect(result).toBeDefined();\n      expect(result.content).toBe(mockComment.content);\n      expect(result.userId).toBe(TEST_USER_IDS.CLIENT);\n      expect(result.postId).toBe(TEST_POST_IDS.ANXIETY_POST);\n    });\n\n    it('should handle complete comment update workflow', async () => {\n      // Arrange\n      const updatedComment = { ...mockComment, content: 'Updated content' };\n      jest.spyOn(commentsService, 'update').mockResolvedValue(updatedComment);\n\n      // Act\n      const result = await controller.update(\n        TEST_USER_IDS.CLIENT,\n        TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        { content: 'Updated content' },\n      );\n\n      // Assert\n      expect(result).toBeDefined();\n      expect(result.content).toBe('Updated content');\n      expect(result.id).toBe(TEST_COMMENT_IDS.ANXIETY_COMMENT);\n    });\n\n    it('should handle complete comment heart workflow', async () => {\n      // Arrange\n      const heartResult = { hearted: true };\n      jest.spyOn(commentsService, 'heartComment').mockResolvedValue(heartResult);\n\n      // Act\n      const result = await controller.heartComment(TEST_USER_IDS.CLIENT, TEST_COMMENT_IDS.ANXIETY_COMMENT);\n\n      // Assert\n      expect(result).toBeDefined();\n      expect(result.hearted).toBe(true);\n    });\n  });\n});"],"version":3}