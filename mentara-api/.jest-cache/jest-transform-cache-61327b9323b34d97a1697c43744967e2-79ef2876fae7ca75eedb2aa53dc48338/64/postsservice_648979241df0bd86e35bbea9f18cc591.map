{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/posts/posts.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/posts/posts.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  ForbiddenException,\n  InternalServerErrorException,\n} from '@nestjs/common';\nimport { EventEmitter2 } from '@nestjs/event-emitter';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { Post, Prisma, User } from '@prisma/client';\nimport type { PostUpdateInputDto } from './types';\nimport { PostCreatedEvent } from '../common/events/social-events';\n\n@Injectable()\nexport class PostsService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly eventEmitter: EventEmitter2,\n  ) {}\n\n  async findUserById(id: string): Promise<User | null> {\n    return this.prisma.user.findUnique({\n      where: { id },\n    });\n  }\n\n  async findAll(userId?: string): Promise<Post[]> {\n    return this.prisma.post.findMany({\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n        comments: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n            children: {\n              include: {\n                user: {\n                  select: {\n                    id: true,\n                    firstName: true,\n                    lastName: true,\n                    avatarUrl: true,\n                  },\n                },\n                _count: {\n                  select: {\n                    children: true,\n                    hearts: true,\n                  },\n                },\n              },\n              orderBy: {\n                createdAt: 'asc',\n              },\n            },\n          },\n          orderBy: {\n            createdAt: 'desc',\n          },\n        },\n        hearts: userId\n          ? {\n              where: {\n                userId,\n              },\n            }\n          : false,\n        _count: {\n          select: {\n            comments: true,\n            hearts: true,\n          },\n        },\n      },\n      orderBy: {\n        createdAt: 'desc',\n      },\n    });\n  }\n\n  async findOne(id: string, userId?: string): Promise<Post | null> {\n    return this.prisma.post.findUnique({\n      where: { id },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n        comments: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n            children: {\n              include: {\n                user: {\n                  select: {\n                    id: true,\n                    firstName: true,\n                    lastName: true,\n                    avatarUrl: true,\n                  },\n                },\n                _count: {\n                  select: {\n                    children: true,\n                    hearts: true,\n                  },\n                },\n              },\n              orderBy: {\n                createdAt: 'asc',\n              },\n            },\n          },\n          orderBy: {\n            createdAt: 'desc',\n          },\n        },\n        hearts: userId\n          ? {\n              where: {\n                userId,\n              },\n            }\n          : false,\n        _count: {\n          select: {\n            comments: true,\n            hearts: true,\n          },\n        },\n      },\n    });\n  }\n\n  async create(\n    data: Prisma.PostCreateInput,\n    attachmentUrls: string[] = [],\n    attachmentNames: string[] = [],\n    attachmentSizes: number[] = [],\n  ): Promise<Post> {\n    const post = await this.prisma.post.create({\n      data: {\n        ...data,\n        attachmentUrls,\n        attachmentNames,\n        attachmentSizes,\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n      },\n    });\n\n    // Emit PostCreatedEvent for notifications (only if post has a room/community)\n    if (post.roomId) {\n      await this.eventEmitter.emitAsync(\n        'PostCreatedEvent',\n        new PostCreatedEvent({\n          postId: post.id,\n          authorId: post.userId,\n          communityId: post.roomId,\n          title: post.title || '',\n          content: post.content || '',\n          tags: [], // Add tags if available in schema\n          postType: 'text', // Default to 'text' postType\n          isAnonymous: false, // Default to false since field doesn't exist in schema\n        }),\n      );\n    }\n\n    return post;\n  }\n\n  async update(\n    id: string,\n    data: PostUpdateInputDto,\n    userId: string,\n  ): Promise<Post> {\n    const post = await this.prisma.post.findUnique({\n      where: { id },\n      select: { userId: true },\n    });\n\n    if (!post) {\n      throw new NotFoundException('Post not found');\n    }\n\n    if (post.userId !== userId) {\n      throw new ForbiddenException('You can only edit your own posts');\n    }\n\n    return this.prisma.post.update({\n      where: { id },\n      data: {\n        title: data.title,\n        content: data.content,\n        // room: { connect: { id: data.roomId } }, // Commented out - roomId property missing\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n      },\n    });\n  }\n\n  async remove(id: string, userId: string): Promise<Post> {\n    const post = await this.prisma.post.findUnique({\n      where: { id },\n      select: { userId: true },\n    });\n\n    if (!post) {\n      throw new NotFoundException('Post not found');\n    }\n\n    if (post.userId !== userId) {\n      throw new ForbiddenException('You can only delete your own posts');\n    }\n\n    return this.prisma.post.delete({\n      where: { id },\n    });\n  }\n\n  async findByUserId(userId: string): Promise<Post[]> {\n    return this.prisma.post.findMany({\n      where: {\n        userId: userId,\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n        _count: {\n          select: {\n            comments: true,\n            hearts: true,\n          },\n        },\n      },\n      orderBy: {\n        createdAt: 'desc',\n      },\n    });\n  }\n\n  async findByRoomId(roomId: string, userId?: string): Promise<Post[]> {\n    return this.prisma.post.findMany({\n      where: {\n        roomId,\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n        comments: {\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n            children: {\n              include: {\n                user: {\n                  select: {\n                    id: true,\n                    firstName: true,\n                    lastName: true,\n                    avatarUrl: true,\n                  },\n                },\n                _count: {\n                  select: {\n                    children: true,\n                    hearts: true,\n                  },\n                },\n              },\n              orderBy: {\n                createdAt: 'asc',\n              },\n            },\n          },\n          orderBy: {\n            createdAt: 'desc',\n          },\n        },\n        hearts: userId\n          ? {\n              where: {\n                userId,\n              },\n            }\n          : false,\n        _count: {\n          select: {\n            comments: true,\n            hearts: true,\n          },\n        },\n      },\n      orderBy: {\n        createdAt: 'desc',\n      },\n    });\n  }\n\n  // Heart functionality\n  async heartPost(\n    postId: string,\n    userId: string,\n  ): Promise<{ hearted: boolean }> {\n    const existingHeart = await this.prisma.postHeart.findUnique({\n      where: {\n        postId_userId: {\n          postId,\n          userId,\n        },\n      },\n    });\n\n    if (existingHeart) {\n      // Remove heart\n      await this.prisma.postHeart.delete({\n        where: {\n          postId_userId: {\n            postId,\n            userId,\n          },\n        },\n      });\n\n      return { hearted: false };\n    } else {\n      // Add heart\n      await this.prisma.postHeart.create({\n        data: {\n          postId,\n          userId,\n        },\n      });\n\n      return { hearted: true };\n    }\n  }\n\n  async isPostHeartedByUser(postId: string, userId: string): Promise<boolean> {\n    const heart = await this.prisma.postHeart.findUnique({\n      where: {\n        postId_userId: {\n          postId,\n          userId,\n        },\n      },\n    });\n\n    return !!heart;\n  }\n\n  // File attachment methods\n  async attachFilesToPost(\n    postId: string,\n    fileIds: string[],\n    purpose: string = 'MEDIA',\n  ) {\n    // Stub implementation - files system removed\n    return { count: 0 };\n  }\n\n  async getPostAttachments(postId: string) {\n    // Stub implementation - files system removed\n    return [];\n  }\n\n  async removePostAttachment(postId: string, fileId: string) {\n    // Stub implementation - files system removed\n    return { count: 0 };\n  }\n\n  /**\n   * Report a post for inappropriate content\n   */\n  async reportPost(\n    postId: string,\n    reporterId: string,\n    reason: string,\n    content?: string,\n  ): Promise<string> {\n    try {\n      // Verify post exists\n      const post = await this.prisma.post.findUnique({\n        where: { id: postId },\n      });\n\n      if (!post) {\n        throw new NotFoundException('Post not found');\n      }\n\n      // Check if user already reported this post\n      const existingReport = await this.prisma.report.findFirst({\n        where: {\n          postId,\n          reporterId,\n        },\n      });\n\n      if (existingReport) {\n        throw new ForbiddenException('You have already reported this post');\n      }\n\n      // Create the report\n      const report = await this.prisma.report.create({\n        data: {\n          postId,\n          reporterId,\n          reason,\n          content,\n          status: 'PENDING',\n        },\n      });\n\n      return report.id;\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ForbiddenException\n      ) {\n        throw error;\n      }\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n}\n"],"version":3}