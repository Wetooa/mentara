{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/users/profile.controller.ts","mappings":";;;;;;;;;;;;;;;;;AAAA,2CAA+I;AAC/I,kEAA6D;AAC7D,4FAA6E;AAC7E,6EAAwE;AACxE,6CAAiD;AAEjD,uDAAmD;AAEnD;;GAEG;AAGI,IAAM,iBAAiB,yBAAvB,MAAM,iBAAiB;IAIT;IAHF,MAAM,GAAG,IAAI,eAAM,CAAC,mBAAiB,CAAC,IAAI,CAAC,CAAC;IAE7D,YACmB,cAA8B;QAA9B,mBAAc,GAAd,cAAc,CAAgB;IAC9C,CAAC;IAEJ;;;OAGG;IAGG,AAAN,KAAK,CAAC,gBAAgB,CAC6B,MAAmB,EACnD,aAAqB;QAEtC,IAAI,CAAC;YACH,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,aAAa,oBAAoB,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC;YACtE,OAAO,MAAM,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC;QAC9E,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,2BAA2B,MAAM,CAAC,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;YAClE,MAAM,IAAI,sBAAa,CACrB,4BAA4B,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,EACtF,mBAAU,CAAC,qBAAqB,CACjC,CAAC;QACJ,CAAC;IACH,CAAC;IAED;;;OAGG;IAGG,AAAN,KAAK,CAAC,gBAAgB,CACH,aAAqB,EAC9B,WAAgB;QAExB,IAAI,CAAC;YACH,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,aAAa,yBAAyB,CAAC,CAAC;YAChE,OAAO,MAAM,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;QAC7E,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qCAAqC,aAAa,GAAG,EAAE,KAAK,CAAC,CAAC;YAChF,MAAM,IAAI,sBAAa,CACrB,6BAA6B,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,EACvF,mBAAU,CAAC,qBAAqB,CACjC,CAAC;QACJ,CAAC;IACH,CAAC;CACF,CAAA;AAlDY,8CAAiB;AAatB;IAFL,IAAA,YAAG,EAAC,KAAK,CAAC;IACV,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,IAAI,uCAAiB,CAAC,8BAAiB,CAAC,CAAC,CAAA;IAC/C,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;yDAYjB;AAQK;IAFL,IAAA,YAAG,GAAE;IACL,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,yCAAa,GAAE,CAAA;IACf,WAAA,IAAA,aAAI,GAAE,CAAA;;;;yDAYR;4BAjDU,iBAAiB;IAF7B,IAAA,mBAAU,EAAC,SAAS,CAAC;IACrB,IAAA,kBAAS,EAAC,6BAAY,CAAC;yDAKa,gCAAc,oBAAd,gCAAc;GAJtC,iBAAiB,CAkD7B","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/users/profile.controller.ts"],"sourcesContent":["import { Controller, Get, Put, Param, Body, HttpCode, HttpStatus, UseGuards, ForbiddenException, HttpException, Logger } from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport { UserIdParamSchema } from './validation';\nimport type { UserIdParam } from './types';\nimport { ProfileService } from './profile.service';\n\n/**\n * Public profile controller for viewing user/therapist profiles\n */\n@Controller('profile')\n@UseGuards(JwtAuthGuard)\nexport class ProfileController {\n  private readonly logger = new Logger(ProfileController.name);\n\n  constructor(\n    private readonly profileService: ProfileService,\n  ) {}\n\n  /**\n   * Get public profile by user ID\n   * Anyone can view public profiles\n   */\n  @Get(':id')\n  @HttpCode(HttpStatus.OK)\n  async getPublicProfile(\n    @Param(new ZodValidationPipe(UserIdParamSchema)) params: UserIdParam,\n    @CurrentUserId() currentUserId: string,\n  ) {\n    try {\n      this.logger.log(`User ${currentUserId} viewing profile ${params.id}`);\n      return await this.profileService.getPublicProfile(params.id, currentUserId);\n    } catch (error) {\n      this.logger.error(`Failed to fetch profile ${params.id}:`, error);\n      throw new HttpException(\n        `Failed to fetch profile: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  /**\n   * Update own profile\n   * Users can only update their own profile\n   */\n  @Put()\n  @HttpCode(HttpStatus.OK)\n  async updateOwnProfile(\n    @CurrentUserId() currentUserId: string,\n    @Body() profileData: any, // TODO: Add proper DTO validation\n  ) {\n    try {\n      this.logger.log(`User ${currentUserId} updating their profile`);\n      return await this.profileService.updateProfile(currentUserId, profileData);\n    } catch (error) {\n      this.logger.error(`Failed to update profile for user ${currentUserId}:`, error);\n      throw new HttpException(\n        `Failed to update profile: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}"],"version":3}