8ddb43bddc8f7d02a26598b6b0848e5d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const core_1 = require("@nestjs/core");
const testing_1 = require("@nestjs/testing");
const community_access_guard_1 = require("./community-access.guard");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const auth_testing_helpers_1 = require("../../test-utils/auth-testing-helpers");
describe('CommunityAccessGuard', () => {
    let guard;
    let prismaService;
    let reflector;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                community_access_guard_1.CommunityAccessGuard,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: auth_testing_helpers_1.SecurityGuardTestUtils.createMockPrismaWithCommunityData(),
                },
                {
                    provide: core_1.Reflector,
                    useValue: auth_testing_helpers_1.SecurityGuardTestUtils.createMockReflector(),
                },
            ],
        }).compile();
        guard = module.get(community_access_guard_1.CommunityAccessGuard);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        reflector = module.get(core_1.Reflector);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('canActivate', () => {
        it('should return true when no metadata is set', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(false);
            // Act
            const result = await guard.canActivate(context);
            // Assert
            expect(result).toBe(true);
        });
        it('should throw ForbiddenException when user is not authenticated', async () => {
            // Arrange
            const request = { userId: null };
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            // Act & Assert
            await expect(guard.canActivate(context)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('Community Membership Validation', () => {
        it('should allow access for valid community member', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testCommunityMembership(guard, testScenarios.clientMemberAccess);
        });
        it('should deny access for non-member', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testCommunityMembership(guard, testScenarios.nonMemberAccess);
        });
        it('should validate community membership from different request contexts', async () => {
            // Test extracting community ID from different places
            const testCases = [
                {
                    name: 'from params.communityId',
                    request: auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                        communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                    }),
                },
                {
                    name: 'from body.communityId',
                    request: auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                        body: { communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT },
                    }),
                },
                {
                    name: 'from roomId lookup',
                    request: auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                        roomId: auth_testing_helpers_1.TEST_ROOM_IDS.ANXIETY_CHAT,
                    }),
                },
            ];
            for (const testCase of testCases) {
                const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(testCase.request);
                reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
                await expect(guard.canActivate(context)).resolves.toBe(true);
            }
        });
    });
    describe('Room Access Validation', () => {
        it('should allow room access for community member', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testRoomAccess(guard, testScenarios.clientMemberAccess);
        });
        it('should deny room access for non-member', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testRoomAccess(guard, testScenarios.nonMemberAccess);
        });
        it('should throw NotFoundException for non-existent room', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                roomId: 'non-existent-room',
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            // Mock prisma to return null for non-existent room
            prismaService.room.findUnique = jest.fn().mockResolvedValue(null);
            // Act & Assert
            await expect(guard.canActivate(context)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('Posting Permission Validation', () => {
        it('should allow posting for member in member room', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testPostingPermission(guard, testScenarios.clientMemberAccess);
        });
        it('should deny posting for member in moderator room', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testPostingPermission(guard, testScenarios.memberInModeratorRoom);
        });
        it('should allow posting for moderator in moderator room', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testPostingPermission(guard, testScenarios.therapistModeratorAccess);
        });
        it('should allow posting for admin in any room', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testPostingPermission(guard, testScenarios.adminFullAccess);
        });
        it('should test role hierarchy correctly', async () => {
            // Test that role hierarchy works: admin > moderator > member
            const roomWithModeratorPosting = {
                id: auth_testing_helpers_1.TEST_ROOM_IDS.ANXIETY_RESOURCES,
                postingRole: 'moderator',
                roomGroup: {
                    community: {
                        id: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                        memberships: [],
                    },
                },
            };
            const testRoles = [
                { userId: auth_testing_helpers_1.TEST_USER_IDS.CLIENT, role: 'member', canPost: false },
                { userId: auth_testing_helpers_1.TEST_USER_IDS.THERAPIST, role: 'moderator', canPost: true },
                { userId: auth_testing_helpers_1.TEST_USER_IDS.ADMIN, role: 'admin', canPost: true },
            ];
            for (const testRole of testRoles) {
                // Set up membership with specific role
                roomWithModeratorPosting.roomGroup.community.memberships = [
                    { userId: testRole.userId, role: testRole.role },
                ];
                prismaService.room.findUnique = jest.fn().mockResolvedValue(roomWithModeratorPosting);
                const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(testRole.userId, {
                    roomId: auth_testing_helpers_1.TEST_ROOM_IDS.ANXIETY_RESOURCES,
                    method: 'POST',
                });
                const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
                reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
                if (testRole.canPost) {
                    await expect(guard.canActivate(context)).resolves.toBe(true);
                }
                else {
                    await expect(guard.canActivate(context)).rejects.toThrow(common_1.ForbiddenException);
                }
            }
        });
    });
    describe('Moderator Permission Validation', () => {
        it('should allow moderator access for moderator user', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testModeratorPermission(guard, testScenarios.therapistModeratorAccess);
        });
        it('should allow admin access for admin user', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testModeratorPermission(guard, testScenarios.adminFullAccess);
        });
        it('should deny moderator access for regular member', async () => {
            // Arrange
            const testScenarios = auth_testing_helpers_1.SecurityGuardTestUtils.createAccessControlTestScenarios();
            const testSuite = auth_testing_helpers_1.CommunityAccessGuardTestUtils.createGuardTestSuite();
            // Act & Assert
            await testSuite.testModeratorPermission(guard, testScenarios.clientMemberAccess);
        });
    });
    describe('Context Extraction', () => {
        it('should extract community ID from post context', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                postId: auth_testing_helpers_1.TEST_POST_IDS.ANXIETY_POST,
                path: '/posts/some-endpoint',
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            // Act
            const result = await guard.canActivate(context);
            // Assert
            expect(result).toBe(true);
            expect(prismaService.post.findUnique).toHaveBeenCalledWith({
                where: { id: auth_testing_helpers_1.TEST_POST_IDS.ANXIETY_POST },
                include: {
                    room: {
                        include: {
                            roomGroup: {
                                include: {
                                    community: true,
                                },
                            },
                        },
                    },
                },
            });
        });
        it('should extract room ID from comment context', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                commentId: auth_testing_helpers_1.TEST_COMMENT_IDS.ANXIETY_COMMENT,
                path: '/comments/some-endpoint',
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            // Act
            const result = await guard.canActivate(context);
            // Assert
            expect(result).toBe(true);
            expect(prismaService.comment.findUnique).toHaveBeenCalledWith({
                where: { id: auth_testing_helpers_1.TEST_COMMENT_IDS.ANXIETY_COMMENT },
                include: {
                    post: {
                        select: { roomId: true },
                    },
                },
            });
        });
        it('should handle missing context gracefully', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
            // No community, room, post, or comment context
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            // Act
            const result = await guard.canActivate(context);
            // Assert
            expect(result).toBe(true); // Should pass when no context to validate
        });
    });
    describe('Helper Methods', () => {
        it('should get user community role correctly', async () => {
            // Arrange
            const mockMembership = {
                role: 'moderator',
            };
            prismaService.membership.findFirst = jest.fn().mockResolvedValue(mockMembership);
            // Act
            const role = await guard.getUserCommunityRole(auth_testing_helpers_1.TEST_USER_IDS.THERAPIST, auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(role).toBe('moderator');
            expect(prismaService.membership.findFirst).toHaveBeenCalledWith({
                where: {
                    userId: auth_testing_helpers_1.TEST_USER_IDS.THERAPIST,
                    communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                },
                select: {
                    role: true,
                },
            });
        });
        it('should check moderation capabilities correctly', async () => {
            // Arrange
            const mockMembership = {
                role: 'moderator',
            };
            prismaService.membership.findFirst = jest.fn().mockResolvedValue(mockMembership);
            // Act
            const canModerate = await guard.canModerate(auth_testing_helpers_1.TEST_USER_IDS.THERAPIST, auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(canModerate).toBe(true);
        });
        it('should return false for non-moderator in canModerate', async () => {
            // Arrange
            prismaService.membership.findFirst = jest.fn().mockResolvedValue(null);
            // Act
            const canModerate = await guard.canModerate(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(canModerate).toBe(false);
        });
    });
    describe('Error Handling', () => {
        it('should handle database errors gracefully', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            prismaService.membership.findFirst = jest.fn().mockRejectedValue(new Error('Database error'));
            // Act & Assert
            await expect(guard.canActivate(context)).rejects.toThrow('Database error');
        });
        it('should handle network timeouts', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                roomId: auth_testing_helpers_1.TEST_ROOM_IDS.ANXIETY_CHAT,
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            prismaService.room.findUnique = jest.fn().mockRejectedValue(new Error('Connection timeout'));
            // Act & Assert
            await expect(guard.canActivate(context)).rejects.toThrow('Connection timeout');
        });
    });
    describe('Multiple Guard Conditions', () => {
        it('should handle multiple guard conditions simultaneously', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: auth_testing_helpers_1.TEST_ROOM_IDS.ANXIETY_CHAT,
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockImplementation((key) => {
                return key === 'require_community_membership' || key === 'require_room_access';
            });
            // Act
            const result = await guard.canActivate(context);
            // Assert
            expect(result).toBe(true);
        });
        it('should fail if any guard condition fails', async () => {
            // Arrange - User who is not a community member
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext('non-member-user', {
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                roomId: auth_testing_helpers_1.TEST_ROOM_IDS.ANXIETY_CHAT,
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockImplementation((key) => {
                return key === 'require_community_membership' || key === 'require_room_access';
            });
            // Mock no membership found
            prismaService.membership.findFirst = jest.fn().mockResolvedValue(null);
            // Act & Assert
            await expect(guard.canActivate(context)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('Performance Tests', () => {
        it('should complete validation within acceptable time', async () => {
            // Arrange
            const request = auth_testing_helpers_1.SecurityGuardTestUtils.createMockRequestWithCommunityContext(auth_testing_helpers_1.TEST_USER_IDS.CLIENT, {
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
            });
            const context = auth_testing_helpers_1.SecurityGuardTestUtils.createMockExecutionContext(request);
            reflector.getAllAndOverride = jest.fn().mockReturnValue(true);
            // Act
            const startTime = Date.now();
            await guard.canActivate(context);
            const endTime = Date.now();
            // Assert
            expect(endTime - startTime).toBeLessThan(100); // Should complete within 100ms
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvZ3VhcmRzL2NvbW11bml0eS1hY2Nlc3MuZ3VhcmQuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDJDQUF5RjtBQUN6Rix1Q0FBeUM7QUFDekMsNkNBQXNEO0FBQ3RELHFFQUFnRTtBQUNoRSxtRkFBdUU7QUFDdkUsZ0ZBUStDO0FBRS9DLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsSUFBSSxLQUEyQixDQUFDO0lBQ2hDLElBQUksYUFBNEIsQ0FBQztJQUNqQyxJQUFJLFNBQW9CLENBQUM7SUFFekIsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1QsNkNBQW9CO2dCQUNwQjtvQkFDRSxPQUFPLEVBQUUsc0NBQWE7b0JBQ3RCLFFBQVEsRUFBRSw2Q0FBc0IsQ0FBQyxpQ0FBaUMsRUFBRTtpQkFDckU7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLGdCQUFTO29CQUNsQixRQUFRLEVBQUUsNkNBQXNCLENBQUMsbUJBQW1CLEVBQUU7aUJBQ3ZEO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixLQUFLLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBdUIsNkNBQW9CLENBQUMsQ0FBQztRQUMvRCxhQUFhLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBZ0Isc0NBQWEsQ0FBQyxDQUFDO1FBQ3pELFNBQVMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFZLGdCQUFTLENBQUMsQ0FBQztJQUMvQyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMz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QU07WUFDTixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDN0IsTUFBTSxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2pDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUUzQixTQUFTO1lBQ1QsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQywrQkFBK0I7UUFDaEYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9hdXRoL2d1YXJkcy9jb21tdW5pdHktYWNjZXNzLmd1YXJkLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhlY3V0aW9uQ29udGV4dCwgRm9yYmlkZGVuRXhjZXB0aW9uLCBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFJlZmxlY3RvciB9IGZyb20gJ0BuZXN0anMvY29yZSc7XG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IENvbW11bml0eUFjY2Vzc0d1YXJkIH0gZnJvbSAnLi9jb21tdW5pdHktYWNjZXNzLmd1YXJkJztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi8uLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQge1xuICBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLFxuICBDb21tdW5pdHlBY2Nlc3NHdWFyZFRlc3RVdGlscyxcbiAgVEVTVF9VU0VSX0lEUyxcbiAgVEVTVF9DT01NVU5JVFlfSURTLFxuICBURVNUX1JPT01fSURTLFxuICBURVNUX1BPU1RfSURTLFxuICBURVNUX0NPTU1FTlRfSURTLFxufSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2F1dGgtdGVzdGluZy1oZWxwZXJzJztcblxuZGVzY3JpYmUoJ0NvbW11bml0eUFjY2Vzc0d1YXJkJywgKCkgPT4ge1xuICBsZXQgZ3VhcmQ6IENvbW11bml0eUFjY2Vzc0d1YXJkO1xuICBsZXQgcHJpc21hU2VydmljZTogUHJpc21hU2VydmljZTtcbiAgbGV0IHJlZmxlY3RvcjogUmVmbGVjdG9yO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgQ29tbXVuaXR5QWNjZXNzR3VhcmQsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tQcmlzbWFXaXRoQ29tbXVuaXR5RGF0YSgpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUmVmbGVjdG9yLFxuICAgICAgICAgIHVzZVZhbHVlOiBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZWZsZWN0b3IoKSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgZ3VhcmQgPSBtb2R1bGUuZ2V0PENvbW11bml0eUFjY2Vzc0d1YXJkPihDb21tdW5pdHlBY2Nlc3NHdWFyZCk7XG4gICAgcHJpc21hU2VydmljZSA9IG1vZHVsZS5nZXQ8UHJpc21hU2VydmljZT4oUHJpc21hU2VydmljZSk7XG4gICAgcmVmbGVjdG9yID0gbW9kdWxlLmdldDxSZWZsZWN0b3I+KFJlZmxlY3Rvcik7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYW5BY3RpdmF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIHdoZW4gbm8gbWV0YWRhdGEgaXMgc2V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG4gICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgcmVmbGVjdG9yLmdldEFsbEFuZE92ZXJyaWRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgRm9yYmlkZGVuRXhjZXB0aW9uIHdoZW4gdXNlciBpcyBub3QgYXV0aGVudGljYXRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IHVzZXJJZDogbnVsbCB9O1xuICAgICAgY29uc3QgY29udGV4dCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbW11bml0eSBNZW1iZXJzaGlwIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhY2Nlc3MgZm9yIHZhbGlkIGNvbW11bml0eSBtZW1iZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0ZXN0U2NlbmFyaW9zID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVBY2Nlc3NDb250cm9sVGVzdFNjZW5hcmlvcygpO1xuICAgICAgY29uc3QgdGVzdFN1aXRlID0gQ29tbXVuaXR5QWNjZXNzR3VhcmRUZXN0VXRpbHMuY3JlYXRlR3VhcmRUZXN0U3VpdGUoKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCB0ZXN0U3VpdGUudGVzdENvbW11bml0eU1lbWJlcnNoaXAoZ3VhcmQsIHRlc3RTY2VuYXJpb3MuY2xpZW50TWVtYmVyQWNjZXNzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSBhY2Nlc3MgZm9yIG5vbi1tZW1iZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0ZXN0U2NlbmFyaW9zID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVBY2Nlc3NDb250cm9sVGVzdFNjZW5hcmlvcygpO1xuICAgICAgY29uc3QgdGVzdFN1aXRlID0gQ29tbXVuaXR5QWNjZXNzR3VhcmRUZXN0VXRpbHMuY3JlYXRlR3VhcmRUZXN0U3VpdGUoKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCB0ZXN0U3VpdGUudGVzdENvbW11bml0eU1lbWJlcnNoaXAoZ3VhcmQsIHRlc3RTY2VuYXJpb3Mubm9uTWVtYmVyQWNjZXNzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY29tbXVuaXR5IG1lbWJlcnNoaXAgZnJvbSBkaWZmZXJlbnQgcmVxdWVzdCBjb250ZXh0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgZXh0cmFjdGluZyBjb21tdW5pdHkgSUQgZnJvbSBkaWZmZXJlbnQgcGxhY2VzXG4gICAgICBjb25zdCB0ZXN0Q2FzZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnZnJvbSBwYXJhbXMuY29tbXVuaXR5SWQnLFxuICAgICAgICAgIHJlcXVlc3Q6IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnZnJvbSBib2R5LmNvbW11bml0eUlkJyxcbiAgICAgICAgICByZXF1ZXN0OiBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0V2l0aENvbW11bml0eUNvbnRleHQoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHtcbiAgICAgICAgICAgIGJvZHk6IHsgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdmcm9tIHJvb21JZCBsb29rdXAnLFxuICAgICAgICAgIHJlcXVlc3Q6IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICAgICAgcm9vbUlkOiBURVNUX1JPT01fSURTLkFOWElFVFlfQ0hBVCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGVzdENhc2Ugb2YgdGVzdENhc2VzKSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHRlc3RDYXNlLnJlcXVlc3QpO1xuICAgICAgICByZWZsZWN0b3IuZ2V0QWxsQW5kT3ZlcnJpZGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpO1xuXG4gICAgICAgIGF3YWl0IGV4cGVjdChndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KSkucmVzb2x2ZXMudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Jvb20gQWNjZXNzIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyByb29tIGFjY2VzcyBmb3IgY29tbXVuaXR5IG1lbWJlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRlc3RTY2VuYXJpb3MgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZUFjY2Vzc0NvbnRyb2xUZXN0U2NlbmFyaW9zKCk7XG4gICAgICBjb25zdCB0ZXN0U3VpdGUgPSBDb21tdW5pdHlBY2Nlc3NHdWFyZFRlc3RVdGlscy5jcmVhdGVHdWFyZFRlc3RTdWl0ZSgpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IHRlc3RTdWl0ZS50ZXN0Um9vbUFjY2VzcyhndWFyZCwgdGVzdFNjZW5hcmlvcy5jbGllbnRNZW1iZXJBY2Nlc3MpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IHJvb20gYWNjZXNzIGZvciBub24tbWVtYmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdGVzdFNjZW5hcmlvcyA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlQWNjZXNzQ29udHJvbFRlc3RTY2VuYXJpb3MoKTtcbiAgICAgIGNvbnN0IHRlc3RTdWl0ZSA9IENvbW11bml0eUFjY2Vzc0d1YXJkVGVzdFV0aWxzLmNyZWF0ZUd1YXJkVGVzdFN1aXRlKCk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgdGVzdFN1aXRlLnRlc3RSb29tQWNjZXNzKGd1YXJkLCB0ZXN0U2NlbmFyaW9zLm5vbk1lbWJlckFjY2Vzcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGZvciBub24tZXhpc3RlbnQgcm9vbScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0V2l0aENvbW11bml0eUNvbnRleHQoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHtcbiAgICAgICAgcm9vbUlkOiAnbm9uLWV4aXN0ZW50LXJvb20nLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgcmVmbGVjdG9yLmdldEFsbEFuZE92ZXJyaWRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gTW9jayBwcmlzbWEgdG8gcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCByb29tXG4gICAgICBwcmlzbWFTZXJ2aWNlLnJvb20uZmluZFVuaXF1ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQb3N0aW5nIFBlcm1pc3Npb24gVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IHBvc3RpbmcgZm9yIG1lbWJlciBpbiBtZW1iZXIgcm9vbScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRlc3RTY2VuYXJpb3MgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZUFjY2Vzc0NvbnRyb2xUZXN0U2NlbmFyaW9zKCk7XG4gICAgICBjb25zdCB0ZXN0U3VpdGUgPSBDb21tdW5pdHlBY2Nlc3NHdWFyZFRlc3RVdGlscy5jcmVhdGVHdWFyZFRlc3RTdWl0ZSgpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IHRlc3RTdWl0ZS50ZXN0UG9zdGluZ1Blcm1pc3Npb24oZ3VhcmQsIHRlc3RTY2VuYXJpb3MuY2xpZW50TWVtYmVyQWNjZXNzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSBwb3N0aW5nIGZvciBtZW1iZXIgaW4gbW9kZXJhdG9yIHJvb20nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0ZXN0U2NlbmFyaW9zID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVBY2Nlc3NDb250cm9sVGVzdFNjZW5hcmlvcygpO1xuICAgICAgY29uc3QgdGVzdFN1aXRlID0gQ29tbXVuaXR5QWNjZXNzR3VhcmRUZXN0VXRpbHMuY3JlYXRlR3VhcmRUZXN0U3VpdGUoKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCB0ZXN0U3VpdGUudGVzdFBvc3RpbmdQZXJtaXNzaW9uKGd1YXJkLCB0ZXN0U2NlbmFyaW9zLm1lbWJlckluTW9kZXJhdG9yUm9vbSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHBvc3RpbmcgZm9yIG1vZGVyYXRvciBpbiBtb2RlcmF0b3Igcm9vbScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRlc3RTY2VuYXJpb3MgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZUFjY2Vzc0NvbnRyb2xUZXN0U2NlbmFyaW9zKCk7XG4gICAgICBjb25zdCB0ZXN0U3VpdGUgPSBDb21tdW5pdHlBY2Nlc3NHdWFyZFRlc3RVdGlscy5jcmVhdGVHdWFyZFRlc3RTdWl0ZSgpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IHRlc3RTdWl0ZS50ZXN0UG9zdGluZ1Blcm1pc3Npb24oZ3VhcmQsIHRlc3RTY2VuYXJpb3MudGhlcmFwaXN0TW9kZXJhdG9yQWNjZXNzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgcG9zdGluZyBmb3IgYWRtaW4gaW4gYW55IHJvb20nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB0ZXN0U2NlbmFyaW9zID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVBY2Nlc3NDb250cm9sVGVzdFNjZW5hcmlvcygpO1xuICAgICAgY29uc3QgdGVzdFN1aXRlID0gQ29tbXVuaXR5QWNjZXNzR3VhcmRUZXN0VXRpbHMuY3JlYXRlR3VhcmRUZXN0U3VpdGUoKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCB0ZXN0U3VpdGUudGVzdFBvc3RpbmdQZXJtaXNzaW9uKGd1YXJkLCB0ZXN0U2NlbmFyaW9zLmFkbWluRnVsbEFjY2Vzcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRlc3Qgcm9sZSBoaWVyYXJjaHkgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IHJvbGUgaGllcmFyY2h5IHdvcmtzOiBhZG1pbiA+IG1vZGVyYXRvciA+IG1lbWJlclxuICAgICAgY29uc3Qgcm9vbVdpdGhNb2RlcmF0b3JQb3N0aW5nID0ge1xuICAgICAgICBpZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX1JFU09VUkNFUyxcbiAgICAgICAgcG9zdGluZ1JvbGU6ICdtb2RlcmF0b3InLFxuICAgICAgICByb29tR3JvdXA6IHtcbiAgICAgICAgICBjb21tdW5pdHk6IHtcbiAgICAgICAgICAgIGlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICAgICAgbWVtYmVyc2hpcHM6IFtdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB0ZXN0Um9sZXMgPSBbXG4gICAgICAgIHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCwgcm9sZTogJ21lbWJlcicsIGNhblBvc3Q6IGZhbHNlIH0sXG4gICAgICAgIHsgdXNlcklkOiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgcm9sZTogJ21vZGVyYXRvcicsIGNhblBvc3Q6IHRydWUgfSxcbiAgICAgICAgeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQURNSU4sIHJvbGU6ICdhZG1pbicsIGNhblBvc3Q6IHRydWUgfSxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGVzdFJvbGUgb2YgdGVzdFJvbGVzKSB7XG4gICAgICAgIC8vIFNldCB1cCBtZW1iZXJzaGlwIHdpdGggc3BlY2lmaWMgcm9sZVxuICAgICAgICByb29tV2l0aE1vZGVyYXRvclBvc3Rpbmcucm9vbUdyb3VwLmNvbW11bml0eS5tZW1iZXJzaGlwcyA9IFtcbiAgICAgICAgICB7IHVzZXJJZDogdGVzdFJvbGUudXNlcklkLCByb2xlOiB0ZXN0Um9sZS5yb2xlIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgcHJpc21hU2VydmljZS5yb29tLmZpbmRVbmlxdWUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUocm9vbVdpdGhNb2RlcmF0b3JQb3N0aW5nKTtcblxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdFdpdGhDb21tdW5pdHlDb250ZXh0KHRlc3RSb2xlLnVzZXJJZCwge1xuICAgICAgICAgIHJvb21JZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX1JFU09VUkNFUyxcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICAgIHJlZmxlY3Rvci5nZXRBbGxBbmRPdmVycmlkZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG5cbiAgICAgICAgaWYgKHRlc3RSb2xlLmNhblBvc3QpIHtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlc29sdmVzLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgZXhwZWN0KGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTW9kZXJhdG9yIFBlcm1pc3Npb24gVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IG1vZGVyYXRvciBhY2Nlc3MgZm9yIG1vZGVyYXRvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdGVzdFNjZW5hcmlvcyA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlQWNjZXNzQ29udHJvbFRlc3RTY2VuYXJpb3MoKTtcbiAgICAgIGNvbnN0IHRlc3RTdWl0ZSA9IENvbW11bml0eUFjY2Vzc0d1YXJkVGVzdFV0aWxzLmNyZWF0ZUd1YXJkVGVzdFN1aXRlKCk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgdGVzdFN1aXRlLnRlc3RNb2RlcmF0b3JQZXJtaXNzaW9uKGd1YXJkLCB0ZXN0U2NlbmFyaW9zLnRoZXJhcGlzdE1vZGVyYXRvckFjY2Vzcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIGFjY2VzcyBmb3IgYWRtaW4gdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHRlc3RTY2VuYXJpb3MgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZUFjY2Vzc0NvbnRyb2xUZXN0U2NlbmFyaW9zKCk7XG4gICAgICBjb25zdCB0ZXN0U3VpdGUgPSBDb21tdW5pdHlBY2Nlc3NHdWFyZFRlc3RVdGlscy5jcmVhdGVHdWFyZFRlc3RTdWl0ZSgpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IHRlc3RTdWl0ZS50ZXN0TW9kZXJhdG9yUGVybWlzc2lvbihndWFyZCwgdGVzdFNjZW5hcmlvcy5hZG1pbkZ1bGxBY2Nlc3MpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IG1vZGVyYXRvciBhY2Nlc3MgZm9yIHJlZ3VsYXIgbWVtYmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdGVzdFNjZW5hcmlvcyA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlQWNjZXNzQ29udHJvbFRlc3RTY2VuYXJpb3MoKTtcbiAgICAgIGNvbnN0IHRlc3RTdWl0ZSA9IENvbW11bml0eUFjY2Vzc0d1YXJkVGVzdFV0aWxzLmNyZWF0ZUd1YXJkVGVzdFN1aXRlKCk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgdGVzdFN1aXRlLnRlc3RNb2RlcmF0b3JQZXJtaXNzaW9uKGd1YXJkLCB0ZXN0U2NlbmFyaW9zLmNsaWVudE1lbWJlckFjY2Vzcyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb250ZXh0IEV4dHJhY3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IGNvbW11bml0eSBJRCBmcm9tIHBvc3QgY29udGV4dCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0V2l0aENvbW11bml0eUNvbnRleHQoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHtcbiAgICAgICAgcG9zdElkOiBURVNUX1BPU1RfSURTLkFOWElFVFlfUE9TVCxcbiAgICAgICAgcGF0aDogJy9wb3N0cy9zb21lLWVuZHBvaW50JyxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY29udGV4dCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIHJlZmxlY3Rvci5nZXRBbGxBbmRPdmVycmlkZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnBvc3QuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogVEVTVF9QT1NUX0lEUy5BTlhJRVRZX1BPU1QgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHJvb206IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgcm9vbUdyb3VwOiB7XG4gICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgY29tbXVuaXR5OiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCByb29tIElEIGZyb20gY29tbWVudCBjb250ZXh0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICBjb21tZW50SWQ6IFRFU1RfQ09NTUVOVF9JRFMuQU5YSUVUWV9DT01NRU5ULFxuICAgICAgICBwYXRoOiAnL2NvbW1lbnRzL3NvbWUtZW5kcG9pbnQnLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgcmVmbGVjdG9yLmdldEFsbEFuZE92ZXJyaWRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBURVNUX0NPTU1FTlRfSURTLkFOWElFVFlfQ09NTUVOVCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgcG9zdDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7IHJvb21JZDogdHJ1ZSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgY29udGV4dCBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICAvLyBObyBjb21tdW5pdHksIHJvb20sIHBvc3QsIG9yIGNvbW1lbnQgY29udGV4dFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgcmVmbGVjdG9yLmdldEFsbEFuZE92ZXJyaWRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpOyAvLyBTaG91bGQgcGFzcyB3aGVuIG5vIGNvbnRleHQgdG8gdmFsaWRhdGVcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hlbHBlciBNZXRob2RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHVzZXIgY29tbXVuaXR5IHJvbGUgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja01lbWJlcnNoaXAgPSB7XG4gICAgICAgIHJvbGU6ICdtb2RlcmF0b3InLFxuICAgICAgfTtcbiAgICAgIHByaXNtYVNlcnZpY2UubWVtYmVyc2hpcC5maW5kRmlyc3QgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lbWJlcnNoaXApO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJvbGUgPSBhd2FpdCBndWFyZC5nZXRVc2VyQ29tbXVuaXR5Um9sZShURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJvbGUpLnRvQmUoJ21vZGVyYXRvcicpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UubWVtYmVyc2hpcC5maW5kRmlyc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAgIGNvbW11bml0eUlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoZWNrIG1vZGVyYXRpb24gY2FwYWJpbGl0aWVzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tNZW1iZXJzaGlwID0ge1xuICAgICAgICByb2xlOiAnbW9kZXJhdG9yJyxcbiAgICAgIH07XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1lbWJlcnNoaXAuZmluZEZpcnN0ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZW1iZXJzaGlwKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCBjYW5Nb2RlcmF0ZSA9IGF3YWl0IGd1YXJkLmNhbk1vZGVyYXRlKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoY2FuTW9kZXJhdGUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3Igbm9uLW1vZGVyYXRvciBpbiBjYW5Nb2RlcmF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIHByaXNtYVNlcnZpY2UubWVtYmVyc2hpcC5maW5kRmlyc3QgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgY2FuTW9kZXJhdGUgPSBhd2FpdCBndWFyZC5jYW5Nb2RlcmF0ZShURVNUX1VTRVJfSURTLkNMSUVOVCwgVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNhbk1vZGVyYXRlKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY29udGV4dCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQocmVxdWVzdCk7XG5cbiAgICAgIHJlZmxlY3Rvci5nZXRBbGxBbmRPdmVycmlkZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBwcmlzbWFTZXJ2aWNlLm1lbWJlcnNoaXAuZmluZEZpcnN0ID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpKS5yZWplY3RzLnRvVGhyb3coJ0RhdGFiYXNlIGVycm9yJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBuZXR3b3JrIHRpbWVvdXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxdWVzdCA9IFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMuY3JlYXRlTW9ja1JlcXVlc3RXaXRoQ29tbXVuaXR5Q29udGV4dChURVNUX1VTRVJfSURTLkNMSUVOVCwge1xuICAgICAgICByb29tSWQ6IFRFU1RfUk9PTV9JRFMuQU5YSUVUWV9DSEFULFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgcmVmbGVjdG9yLmdldEFsbEFuZE92ZXJyaWRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIHByaXNtYVNlcnZpY2Uucm9vbS5maW5kVW5pcXVlID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ29ubmVjdGlvbiB0aW1lb3V0JykpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KSkucmVqZWN0cy50b1Rocm93KCdDb25uZWN0aW9uIHRpbWVvdXQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ011bHRpcGxlIEd1YXJkIENvbmRpdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbXVsdGlwbGUgZ3VhcmQgY29uZGl0aW9ucyBzaW11bHRhbmVvdXNseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0V2l0aENvbW11bml0eUNvbnRleHQoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHtcbiAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgIHJvb21JZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX0NIQVQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICByZWZsZWN0b3IuZ2V0QWxsQW5kT3ZlcnJpZGUgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIGtleSA9PT0gJ3JlcXVpcmVfY29tbXVuaXR5X21lbWJlcnNoaXAnIHx8IGtleSA9PT0gJ3JlcXVpcmVfcm9vbV9hY2Nlc3MnO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFpbCBpZiBhbnkgZ3VhcmQgY29uZGl0aW9uIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZSAtIFVzZXIgd2hvIGlzIG5vdCBhIGNvbW11bml0eSBtZW1iZXJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tSZXF1ZXN0V2l0aENvbW11bml0eUNvbnRleHQoJ25vbi1tZW1iZXItdXNlcicsIHtcbiAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgIHJvb21JZDogVEVTVF9ST09NX0lEUy5BTlhJRVRZX0NIQVQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLmNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHJlcXVlc3QpO1xuXG4gICAgICByZWZsZWN0b3IuZ2V0QWxsQW5kT3ZlcnJpZGUgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIGtleSA9PT0gJ3JlcXVpcmVfY29tbXVuaXR5X21lbWJlcnNoaXAnIHx8IGtleSA9PT0gJ3JlcXVpcmVfcm9vbV9hY2Nlc3MnO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIE1vY2sgbm8gbWVtYmVyc2hpcCBmb3VuZFxuICAgICAgcHJpc21hU2VydmljZS5tZW1iZXJzaGlwLmZpbmRGaXJzdCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCkpLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb21wbGV0ZSB2YWxpZGF0aW9uIHdpdGhpbiBhY2NlcHRhYmxlIHRpbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCByZXF1ZXN0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrUmVxdWVzdFdpdGhDb21tdW5pdHlDb250ZXh0KFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCB7XG4gICAgICAgIGNvbW11bml0eUlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjb250ZXh0ID0gU2VjdXJpdHlHdWFyZFRlc3RVdGlscy5jcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChyZXF1ZXN0KTtcblxuICAgICAgcmVmbGVjdG9yLmdldEFsbEFuZE92ZXJyaWRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoZW5kVGltZSAtIHN0YXJ0VGltZSkudG9CZUxlc3NUaGFuKDEwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gMTAwbXNcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=