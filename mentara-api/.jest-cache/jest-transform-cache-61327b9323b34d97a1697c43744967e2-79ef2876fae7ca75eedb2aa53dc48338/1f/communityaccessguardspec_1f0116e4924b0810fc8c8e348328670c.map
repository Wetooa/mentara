{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/guards/community-access.guard.spec.ts","mappings":";;AAAA,2CAAyF;AACzF,uCAAyC;AACzC,6CAAsD;AACtD,qEAAgE;AAChE,mFAAuE;AACvE,gFAQ+C;AAE/C,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;IACpC,IAAI,KAA2B,CAAC;IAChC,IAAI,aAA4B,CAAC;IACjC,IAAI,SAAoB,CAAC;IAEzB,UAAU,CAAC,KAAK,IAAI,EAAE;QACpB,MAAM,MAAM,GAAkB,MAAM,cAAI,CAAC,mBAAmB,CAAC;YAC3D,SAAS,EAAE;gBACT,6CAAoB;gBACpB;oBACE,OAAO,EAAE,sCAAa;oBACtB,QAAQ,EAAE,6CAAsB,CAAC,iCAAiC,EAAE;iBACrE;gBACD;oBACE,OAAO,EAAE,gBAAS;oBAClB,QAAQ,EAAE,6CAAsB,CAAC,mBAAmB,EAAE;iBACvD;aACF;SACF,CAAC,CAAC,OAAO,EAAE,CAAC;QAEb,KAAK,GAAG,MAAM,CAAC,GAAG,CAAuB,6CAAoB,CAAC,CAAC;QAC/D,aAAa,GAAG,MAAM,CAAC,GAAG,CAAgB,sCAAa,CAAC,CAAC;QACzD,SAAS,GAAG,MAAM,CAAC,GAAG,CAAY,gBAAS,CAAC,CAAC;IAC/C,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,aAAa,EAAE,GAAG,EAAE;QAC3B,EAAE,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;YAC1D,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,CAAC,CAAC;YACnG,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;YAE/D,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAEhD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE;YAC9E,UAAU;YACV,MAAM,OAAO,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;YACjC,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,eAAe;YACf,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,2BAAkB,CAAC,CAAC;QAC/E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,iCAAiC,EAAE,GAAG,EAAE;QAC/C,EAAE,CAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,uBAAuB,CAAC,KAAK,EAAE,aAAa,CAAC,kBAAkB,CAAC,CAAC;QACnF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;YACjD,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,uBAAuB,CAAC,KAAK,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE;YACpF,qDAAqD;YACrD,MAAM,SAAS,GAAG;gBAChB;oBACE,IAAI,EAAE,yBAAyB;oBAC/B,OAAO,EAAE,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;wBAC1F,WAAW,EAAE,yCAAkB,CAAC,eAAe;qBAChD,CAAC;iBACH;gBACD;oBACE,IAAI,EAAE,uBAAuB;oBAC7B,OAAO,EAAE,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;wBAC1F,IAAI,EAAE,EAAE,WAAW,EAAE,yCAAkB,CAAC,eAAe,EAAE;qBAC1D,CAAC;iBACH;gBACD;oBACE,IAAI,EAAE,oBAAoB;oBAC1B,OAAO,EAAE,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;wBAC1F,MAAM,EAAE,oCAAa,CAAC,YAAY;qBACnC,CAAC;iBACH;aACF,CAAC;YAEF,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE,CAAC;gBACjC,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;gBACpF,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;gBAE9D,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC/D,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,wBAAwB,EAAE,GAAG,EAAE;QACtC,EAAE,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;YAC7D,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,cAAc,CAAC,KAAK,EAAE,aAAa,CAAC,kBAAkB,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;YACtD,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,cAAc,CAAC,KAAK,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;YACpE,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,MAAM,EAAE,mBAAmB;aAC5B,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAE9D,mDAAmD;YACnD,aAAa,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAElE,eAAe;YACf,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,0BAAiB,CAAC,CAAC;QAC9E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,+BAA+B,EAAE,GAAG,EAAE;QAC7C,EAAE,CAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,qBAAqB,CAAC,KAAK,EAAE,aAAa,CAAC,kBAAkB,CAAC,CAAC;QACjF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;YAChE,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,qBAAqB,CAAC,KAAK,EAAE,aAAa,CAAC,qBAAqB,CAAC,CAAC;QACpF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;YACpE,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,qBAAqB,CAAC,KAAK,EAAE,aAAa,CAAC,wBAAwB,CAAC,CAAC;QACvF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;YAC1D,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,qBAAqB,CAAC,KAAK,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;QAC9E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;YACpD,6DAA6D;YAC7D,MAAM,wBAAwB,GAAG;gBAC/B,EAAE,EAAE,oCAAa,CAAC,iBAAiB;gBACnC,WAAW,EAAE,WAAW;gBACxB,SAAS,EAAE;oBACT,SAAS,EAAE;wBACT,EAAE,EAAE,yCAAkB,CAAC,eAAe;wBACtC,WAAW,EAAE,EAAE;qBAChB;iBACF;aACF,CAAC;YAEF,MAAM,SAAS,GAAG;gBAChB,EAAE,MAAM,EAAE,oCAAa,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;gBAChE,EAAE,MAAM,EAAE,oCAAa,CAAC,SAAS,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,IAAI,EAAE;gBACrE,EAAE,MAAM,EAAE,oCAAa,CAAC,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;aAC9D,CAAC;YAEF,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE,CAAC;gBACjC,uCAAuC;gBACvC,wBAAwB,CAAC,SAAS,CAAC,SAAS,CAAC,WAAW,GAAG;oBACzD,EAAE,MAAM,EAAE,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,CAAC,IAAI,EAAE;iBACjD,CAAC;gBAEF,aAAa,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,wBAAwB,CAAC,CAAC;gBAEtF,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,QAAQ,CAAC,MAAM,EAAE;oBAC5F,MAAM,EAAE,oCAAa,CAAC,iBAAiB;oBACvC,MAAM,EAAE,MAAM;iBACf,CAAC,CAAC;gBACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;gBAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;gBAE9D,IAAI,QAAQ,CAAC,OAAO,EAAE,CAAC;oBACrB,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC/D,CAAC;qBAAM,CAAC;oBACN,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,2BAAkB,CAAC,CAAC;gBAC/E,CAAC;YACH,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,iCAAiC,EAAE,GAAG,EAAE;QAC/C,EAAE,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;YAChE,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,uBAAuB,CAAC,KAAK,EAAE,aAAa,CAAC,wBAAwB,CAAC,CAAC;QACzF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,uBAAuB,CAAC,KAAK,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE;YAC/D,UAAU;YACV,MAAM,aAAa,GAAG,6CAAsB,CAAC,gCAAgC,EAAE,CAAC;YAChF,MAAM,SAAS,GAAG,oDAA6B,CAAC,oBAAoB,EAAE,CAAC;YAEvE,eAAe;YACf,MAAM,SAAS,CAAC,uBAAuB,CAAC,KAAK,EAAE,aAAa,CAAC,kBAAkB,CAAC,CAAC;QACnF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,EAAE,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;YAC7D,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,MAAM,EAAE,oCAAa,CAAC,YAAY;gBAClC,IAAI,EAAE,sBAAsB;aAC7B,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAE9D,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAEhD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1B,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC;gBACzD,KAAK,EAAE,EAAE,EAAE,EAAE,oCAAa,CAAC,YAAY,EAAE;gBACzC,OAAO,EAAE;oBACP,IAAI,EAAE;wBACJ,OAAO,EAAE;4BACP,SAAS,EAAE;gCACT,OAAO,EAAE;oCACP,SAAS,EAAE,IAAI;iCAChB;6BACF;yBACF;qBACF;iBACF;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE;YAC3D,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,SAAS,EAAE,uCAAgB,CAAC,eAAe;gBAC3C,IAAI,EAAE,yBAAyB;aAChC,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAE9D,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAEhD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1B,MAAM,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,oBAAoB,CAAC;gBAC5D,KAAK,EAAE,EAAE,EAAE,EAAE,uCAAgB,CAAC,eAAe,EAAE;gBAC/C,OAAO,EAAE;oBACP,IAAI,EAAE;wBACJ,MAAM,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE;qBACzB;iBACF;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;YACjG,+CAA+C;aAChD,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAE9D,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAEhD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,0CAA0C;QACvE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,UAAU;YACV,MAAM,cAAc,GAAG;gBACrB,IAAI,EAAE,WAAW;aAClB,CAAC;YACF,aAAa,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAEjF,MAAM;YACN,MAAM,IAAI,GAAG,MAAM,KAAK,CAAC,oBAAoB,CAAC,oCAAa,CAAC,SAAS,EAAE,yCAAkB,CAAC,eAAe,CAAC,CAAC;YAE3G,SAAS;YACT,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC/B,MAAM,CAAC,aAAa,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,oBAAoB,CAAC;gBAC9D,KAAK,EAAE;oBACL,MAAM,EAAE,oCAAa,CAAC,SAAS;oBAC/B,WAAW,EAAE,yCAAkB,CAAC,eAAe;iBAChD;gBACD,MAAM,EAAE;oBACN,IAAI,EAAE,IAAI;iBACX;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,UAAU;YACV,MAAM,cAAc,GAAG;gBACrB,IAAI,EAAE,WAAW;aAClB,CAAC;YACF,aAAa,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;YAEjF,MAAM;YACN,MAAM,WAAW,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,oCAAa,CAAC,SAAS,EAAE,yCAAkB,CAAC,eAAe,CAAC,CAAC;YAEzG,SAAS;YACT,MAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;YACpE,UAAU;YACV,aAAa,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAEvE,MAAM;YACN,MAAM,WAAW,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,oCAAa,CAAC,MAAM,EAAE,yCAAkB,CAAC,eAAe,CAAC,CAAC;YAEtG,SAAS;YACT,MAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,WAAW,EAAE,yCAAkB,CAAC,eAAe;aAChD,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAC9D,aAAa,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC;YAE9F,eAAe;YACf,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,MAAM,EAAE,oCAAa,CAAC,YAAY;aACnC,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAC9D,aAAa,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAE7F,eAAe;YACf,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;QACjF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,2BAA2B,EAAE,GAAG,EAAE;QACzC,EAAE,CAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE;YACtE,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,WAAW,EAAE,yCAAkB,CAAC,eAAe;gBAC/C,MAAM,EAAE,oCAAa,CAAC,YAAY;aACnC,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,kBAAkB,CAAC,CAAC,GAAG,EAAE,EAAE;gBACjE,OAAO,GAAG,KAAK,8BAA8B,IAAI,GAAG,KAAK,qBAAqB,CAAC;YACjF,CAAC,CAAC,CAAC;YAEH,MAAM;YACN,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAEhD,SAAS;YACT,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,+CAA+C;YAC/C,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,iBAAiB,EAAE;gBAC9F,WAAW,EAAE,yCAAkB,CAAC,eAAe;gBAC/C,MAAM,EAAE,oCAAa,CAAC,YAAY;aACnC,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,kBAAkB,CAAC,CAAC,GAAG,EAAE,EAAE;gBACjE,OAAO,GAAG,KAAK,8BAA8B,IAAI,GAAG,KAAK,qBAAqB,CAAC;YACjF,CAAC,CAAC,CAAC;YAEH,2BAA2B;YAC3B,aAAa,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAEvE,eAAe;YACf,MAAM,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,2BAAkB,CAAC,CAAC;QAC/E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;YACjE,UAAU;YACV,MAAM,OAAO,GAAG,6CAAsB,CAAC,qCAAqC,CAAC,oCAAa,CAAC,MAAM,EAAE;gBACjG,WAAW,EAAE,yCAAkB,CAAC,eAAe;aAChD,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,6CAAsB,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAE3E,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAE9D,MAAM;YACN,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAC7B,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YACjC,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE3B,SAAS;YACT,MAAM,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,+BAA+B;QAChF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/guards/community-access.guard.spec.ts"],"sourcesContent":["import { ExecutionContext, ForbiddenException, NotFoundException } from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { CommunityAccessGuard } from './community-access.guard';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport {\n  SecurityGuardTestUtils,\n  CommunityAccessGuardTestUtils,\n  TEST_USER_IDS,\n  TEST_COMMUNITY_IDS,\n  TEST_ROOM_IDS,\n  TEST_POST_IDS,\n  TEST_COMMENT_IDS,\n} from '../../test-utils/auth-testing-helpers';\n\ndescribe('CommunityAccessGuard', () => {\n  let guard: CommunityAccessGuard;\n  let prismaService: PrismaService;\n  let reflector: Reflector;\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        CommunityAccessGuard,\n        {\n          provide: PrismaService,\n          useValue: SecurityGuardTestUtils.createMockPrismaWithCommunityData(),\n        },\n        {\n          provide: Reflector,\n          useValue: SecurityGuardTestUtils.createMockReflector(),\n        },\n      ],\n    }).compile();\n\n    guard = module.get<CommunityAccessGuard>(CommunityAccessGuard);\n    prismaService = module.get<PrismaService>(PrismaService);\n    reflector = module.get<Reflector>(Reflector);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('canActivate', () => {\n    it('should return true when no metadata is set', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT);\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(false);\n\n      // Act\n      const result = await guard.canActivate(context);\n\n      // Assert\n      expect(result).toBe(true);\n    });\n\n    it('should throw ForbiddenException when user is not authenticated', async () => {\n      // Arrange\n      const request = { userId: null };\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      // Act & Assert\n      await expect(guard.canActivate(context)).rejects.toThrow(ForbiddenException);\n    });\n  });\n\n  describe('Community Membership Validation', () => {\n    it('should allow access for valid community member', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testCommunityMembership(guard, testScenarios.clientMemberAccess);\n    });\n\n    it('should deny access for non-member', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testCommunityMembership(guard, testScenarios.nonMemberAccess);\n    });\n\n    it('should validate community membership from different request contexts', async () => {\n      // Test extracting community ID from different places\n      const testCases = [\n        {\n          name: 'from params.communityId',\n          request: SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n            communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n          }),\n        },\n        {\n          name: 'from body.communityId',\n          request: SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n            body: { communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT },\n          }),\n        },\n        {\n          name: 'from roomId lookup',\n          request: SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n            roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n          }),\n        },\n      ];\n\n      for (const testCase of testCases) {\n        const context = SecurityGuardTestUtils.createMockExecutionContext(testCase.request);\n        reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n\n        await expect(guard.canActivate(context)).resolves.toBe(true);\n      }\n    });\n  });\n\n  describe('Room Access Validation', () => {\n    it('should allow room access for community member', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testRoomAccess(guard, testScenarios.clientMemberAccess);\n    });\n\n    it('should deny room access for non-member', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testRoomAccess(guard, testScenarios.nonMemberAccess);\n    });\n\n    it('should throw NotFoundException for non-existent room', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        roomId: 'non-existent-room',\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n      \n      // Mock prisma to return null for non-existent room\n      prismaService.room.findUnique = jest.fn().mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(guard.canActivate(context)).rejects.toThrow(NotFoundException);\n    });\n  });\n\n  describe('Posting Permission Validation', () => {\n    it('should allow posting for member in member room', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testPostingPermission(guard, testScenarios.clientMemberAccess);\n    });\n\n    it('should deny posting for member in moderator room', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testPostingPermission(guard, testScenarios.memberInModeratorRoom);\n    });\n\n    it('should allow posting for moderator in moderator room', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testPostingPermission(guard, testScenarios.therapistModeratorAccess);\n    });\n\n    it('should allow posting for admin in any room', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testPostingPermission(guard, testScenarios.adminFullAccess);\n    });\n\n    it('should test role hierarchy correctly', async () => {\n      // Test that role hierarchy works: admin > moderator > member\n      const roomWithModeratorPosting = {\n        id: TEST_ROOM_IDS.ANXIETY_RESOURCES,\n        postingRole: 'moderator',\n        roomGroup: {\n          community: {\n            id: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n            memberships: [],\n          },\n        },\n      };\n\n      const testRoles = [\n        { userId: TEST_USER_IDS.CLIENT, role: 'member', canPost: false },\n        { userId: TEST_USER_IDS.THERAPIST, role: 'moderator', canPost: true },\n        { userId: TEST_USER_IDS.ADMIN, role: 'admin', canPost: true },\n      ];\n\n      for (const testRole of testRoles) {\n        // Set up membership with specific role\n        roomWithModeratorPosting.roomGroup.community.memberships = [\n          { userId: testRole.userId, role: testRole.role },\n        ];\n\n        prismaService.room.findUnique = jest.fn().mockResolvedValue(roomWithModeratorPosting);\n\n        const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(testRole.userId, {\n          roomId: TEST_ROOM_IDS.ANXIETY_RESOURCES,\n          method: 'POST',\n        });\n        const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n        reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n\n        if (testRole.canPost) {\n          await expect(guard.canActivate(context)).resolves.toBe(true);\n        } else {\n          await expect(guard.canActivate(context)).rejects.toThrow(ForbiddenException);\n        }\n      }\n    });\n  });\n\n  describe('Moderator Permission Validation', () => {\n    it('should allow moderator access for moderator user', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testModeratorPermission(guard, testScenarios.therapistModeratorAccess);\n    });\n\n    it('should allow admin access for admin user', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testModeratorPermission(guard, testScenarios.adminFullAccess);\n    });\n\n    it('should deny moderator access for regular member', async () => {\n      // Arrange\n      const testScenarios = SecurityGuardTestUtils.createAccessControlTestScenarios();\n      const testSuite = CommunityAccessGuardTestUtils.createGuardTestSuite();\n\n      // Act & Assert\n      await testSuite.testModeratorPermission(guard, testScenarios.clientMemberAccess);\n    });\n  });\n\n  describe('Context Extraction', () => {\n    it('should extract community ID from post context', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        postId: TEST_POST_IDS.ANXIETY_POST,\n        path: '/posts/some-endpoint',\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n\n      // Act\n      const result = await guard.canActivate(context);\n\n      // Assert\n      expect(result).toBe(true);\n      expect(prismaService.post.findUnique).toHaveBeenCalledWith({\n        where: { id: TEST_POST_IDS.ANXIETY_POST },\n        include: {\n          room: {\n            include: {\n              roomGroup: {\n                include: {\n                  community: true,\n                },\n              },\n            },\n          },\n        },\n      });\n    });\n\n    it('should extract room ID from comment context', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        commentId: TEST_COMMENT_IDS.ANXIETY_COMMENT,\n        path: '/comments/some-endpoint',\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n\n      // Act\n      const result = await guard.canActivate(context);\n\n      // Assert\n      expect(result).toBe(true);\n      expect(prismaService.comment.findUnique).toHaveBeenCalledWith({\n        where: { id: TEST_COMMENT_IDS.ANXIETY_COMMENT },\n        include: {\n          post: {\n            select: { roomId: true },\n          },\n        },\n      });\n    });\n\n    it('should handle missing context gracefully', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        // No community, room, post, or comment context\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n\n      // Act\n      const result = await guard.canActivate(context);\n\n      // Assert\n      expect(result).toBe(true); // Should pass when no context to validate\n    });\n  });\n\n  describe('Helper Methods', () => {\n    it('should get user community role correctly', async () => {\n      // Arrange\n      const mockMembership = {\n        role: 'moderator',\n      };\n      prismaService.membership.findFirst = jest.fn().mockResolvedValue(mockMembership);\n\n      // Act\n      const role = await guard.getUserCommunityRole(TEST_USER_IDS.THERAPIST, TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);\n\n      // Assert\n      expect(role).toBe('moderator');\n      expect(prismaService.membership.findFirst).toHaveBeenCalledWith({\n        where: {\n          userId: TEST_USER_IDS.THERAPIST,\n          communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        },\n        select: {\n          role: true,\n        },\n      });\n    });\n\n    it('should check moderation capabilities correctly', async () => {\n      // Arrange\n      const mockMembership = {\n        role: 'moderator',\n      };\n      prismaService.membership.findFirst = jest.fn().mockResolvedValue(mockMembership);\n\n      // Act\n      const canModerate = await guard.canModerate(TEST_USER_IDS.THERAPIST, TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);\n\n      // Assert\n      expect(canModerate).toBe(true);\n    });\n\n    it('should return false for non-moderator in canModerate', async () => {\n      // Arrange\n      prismaService.membership.findFirst = jest.fn().mockResolvedValue(null);\n\n      // Act\n      const canModerate = await guard.canModerate(TEST_USER_IDS.CLIENT, TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);\n\n      // Assert\n      expect(canModerate).toBe(false);\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle database errors gracefully', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n      prismaService.membership.findFirst = jest.fn().mockRejectedValue(new Error('Database error'));\n\n      // Act & Assert\n      await expect(guard.canActivate(context)).rejects.toThrow('Database error');\n    });\n\n    it('should handle network timeouts', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n      prismaService.room.findUnique = jest.fn().mockRejectedValue(new Error('Connection timeout'));\n\n      // Act & Assert\n      await expect(guard.canActivate(context)).rejects.toThrow('Connection timeout');\n    });\n  });\n\n  describe('Multiple Guard Conditions', () => {\n    it('should handle multiple guard conditions simultaneously', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockImplementation((key) => {\n        return key === 'require_community_membership' || key === 'require_room_access';\n      });\n\n      // Act\n      const result = await guard.canActivate(context);\n\n      // Assert\n      expect(result).toBe(true);\n    });\n\n    it('should fail if any guard condition fails', async () => {\n      // Arrange - User who is not a community member\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext('non-member-user', {\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n        roomId: TEST_ROOM_IDS.ANXIETY_CHAT,\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockImplementation((key) => {\n        return key === 'require_community_membership' || key === 'require_room_access';\n      });\n\n      // Mock no membership found\n      prismaService.membership.findFirst = jest.fn().mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(guard.canActivate(context)).rejects.toThrow(ForbiddenException);\n    });\n  });\n\n  describe('Performance Tests', () => {\n    it('should complete validation within acceptable time', async () => {\n      // Arrange\n      const request = SecurityGuardTestUtils.createMockRequestWithCommunityContext(TEST_USER_IDS.CLIENT, {\n        communityId: TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,\n      });\n      const context = SecurityGuardTestUtils.createMockExecutionContext(request);\n\n      reflector.getAllAndOverride = jest.fn().mockReturnValue(true);\n\n      // Act\n      const startTime = Date.now();\n      await guard.canActivate(context);\n      const endTime = Date.now();\n\n      // Assert\n      expect(endTime - startTime).toBeLessThan(100); // Should complete within 100ms\n    });\n  });\n});"],"version":3}