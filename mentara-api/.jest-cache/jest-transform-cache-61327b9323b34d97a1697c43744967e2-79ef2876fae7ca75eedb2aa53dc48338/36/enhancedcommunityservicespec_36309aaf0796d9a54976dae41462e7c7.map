{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/enhanced-community.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/enhanced-community.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { Logger, NotFoundException } from '@nestjs/common';\nimport { EventEmitter2 } from '@nestjs/event-emitter';\nimport { EnhancedCommunityService } from './enhanced-community.service';\nimport { PrismaService } from '../../providers/prisma-client.provider';\n\ndescribe('EnhancedCommunityService', () => {\n  let service: EnhancedCommunityService;\n  let prismaService: jest.Mocked<PrismaService>;\n  let eventEmitter: jest.Mocked<EventEmitter2>;\n  let loggerSpy: jest.SpyInstance;\n\n  // Mock data\n  const mockUser = {\n    id: 'user-123',\n    firstName: 'John',\n    lastName: 'Doe',\n    avatarUrl: 'avatar.jpg',\n    updatedAt: new Date('2024-01-15'),\n  };\n\n  const mockModerator = {\n    user: mockUser,\n  };\n\n  const mockRoom = {\n    id: 'room-123',\n    name: 'General Discussion',\n    order: 1,\n    postingRole: 'member',\n    roomGroupId: 'roomgroup-123',\n    posts: [\n      {\n        id: 'post-123',\n        title: 'Test Post',\n        content: 'This is a test post',\n        createdAt: new Date('2024-01-10'),\n        user: mockUser,\n        _count: { comments: 5, hearts: 10 },\n      },\n      {\n        id: 'post-456',\n        title: 'Another Post',\n        content: 'Another test post',\n        createdAt: new Date('2024-01-12'),\n        user: mockUser,\n        _count: { comments: 3, hearts: 7 },\n      },\n    ],\n    _count: { posts: 2 },\n  };\n\n  const mockRoomGroup = {\n    id: 'roomgroup-123',\n    name: 'General',\n    order: 1,\n    communityId: 'community-123',\n    rooms: [mockRoom],\n  };\n\n  const mockCommunityWithDetails = {\n    id: 'community-123',\n    name: 'Depression Support Network',\n    slug: 'depression-support',\n    description: 'A supportive community for depression',\n    imageUrl: 'depression.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n    _count: { memberships: 45 },\n    roomGroups: [mockRoomGroup],\n    moderatorCommunities: [\n      {\n        moderator: mockModerator,\n        assignedAt: new Date('2024-01-01'),\n      },\n    ],\n    memberships: [{ role: 'member' }],\n  };\n\n  const mockCommunities = [\n    {\n      id: 'community-123',\n      name: 'Depression Support Network',\n      slug: 'depression-support',\n      description: 'A supportive community for depression',\n      imageUrl: 'depression.jpg',\n      createdAt: new Date('2024-01-01'),\n      updatedAt: new Date('2024-01-01'),\n      _count: { memberships: 45 },\n      memberships: [{ role: 'member' }],\n    },\n    {\n      id: 'community-456',\n      name: 'Anxiety Warriors',\n      slug: 'anxiety-warriors',\n      description: 'A supportive community for anxiety',\n      imageUrl: 'anxiety.jpg',\n      createdAt: new Date('2024-01-02'),\n      updatedAt: new Date('2024-01-02'),\n      _count: { memberships: 30 },\n      memberships: [],\n    },\n    {\n      id: 'community-789',\n      name: 'Small Support Group',\n      slug: 'small-support',\n      description: 'A small intimate support group',\n      imageUrl: 'small.jpg',\n      createdAt: new Date('2024-01-03'),\n      updatedAt: new Date('2024-01-03'),\n      _count: { memberships: 8 },\n      memberships: [],\n    },\n  ];\n\n  const mockTrendingCommunity = {\n    id: 'community-trending',\n    name: 'Trending Community',\n    slug: 'trending-community',\n    description: 'A trending community',\n    imageUrl: 'trending.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n    _count: { memberships: 100 },\n    memberships: [\n      { joinedAt: new Date('2024-01-15') }, // Recent member\n      { joinedAt: new Date('2024-01-14') }, // Recent member\n    ],\n    roomGroups: [\n      {\n        rooms: [\n          {\n            posts: [\n              {\n                createdAt: new Date('2024-01-15'),\n                _count: { comments: 10, hearts: 20 },\n              },\n              {\n                createdAt: new Date('2024-01-14'),\n                _count: { comments: 5, hearts: 15 },\n              },\n            ],\n          },\n        ],\n      },\n    ],\n  };\n\n  const mockTopContributor = {\n    id: 'user-contributor',\n    firstName: 'Jane',\n    lastName: 'Smith',\n    avatarUrl: 'jane.jpg',\n    _count: { posts: 15, comments: 25 },\n  };\n\n  beforeEach(async () => {\n    const mockPrismaService = {\n      community: {\n        findMany: jest.fn(),\n        findUnique: jest.fn(),\n        count: jest.fn(),\n      },\n      comment: {\n        count: jest.fn(),\n      },\n      post: {\n        count: jest.fn(),\n      },\n      membership: {\n        count: jest.fn(),\n        findMany: jest.fn(),\n      },\n      user: {\n        findMany: jest.fn(),\n      },\n    };\n\n    const mockEventEmitter = {\n      emit: jest.fn(),\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        EnhancedCommunityService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n        {\n          provide: EventEmitter2,\n          useValue: mockEventEmitter,\n        },\n      ],\n    }).compile();\n\n    service = module.get<EnhancedCommunityService>(EnhancedCommunityService);\n    prismaService = module.get(PrismaService);\n    eventEmitter = module.get(EventEmitter2);\n\n    // Setup logger spies\n    loggerSpy = jest.spyOn(Logger.prototype, 'log').mockImplementation();\n    jest.spyOn(Logger.prototype, 'warn').mockImplementation();\n    jest.spyOn(Logger.prototype, 'error').mockImplementation();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('searchCommunities', () => {\n    beforeEach(() => {\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n      prismaService.community.count.mockResolvedValue(3);\n    });\n\n    it('should search communities with text query', async () => {\n      const filters = { query: 'depression' };\n      \n      const result = await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        where: {\n          OR: [\n            { name: { contains: 'depression', mode: 'insensitive' } },\n            { description: { contains: 'depression', mode: 'insensitive' } },\n          ],\n        },\n        include: {\n          _count: { select: { memberships: true } },\n          memberships: {\n            where: { userId: 'user-123' },\n            select: { role: true },\n          },\n        },\n        skip: 0,\n        take: 10,\n      });\n\n      expect(result).toEqual({\n        communities: expect.arrayContaining([\n          expect.objectContaining({\n            id: 'community-123',\n            name: 'Depression Support Network',\n            membershipStatus: 'member',\n          }),\n        ]),\n        total: 3,\n        page: 1,\n        limit: 10,\n        totalPages: 1,\n        facets: expect.objectContaining({\n          memberRanges: expect.any(Array),\n          commonTags: expect.any(Array),\n        }),\n      });\n    });\n\n    it('should search communities without user context', async () => {\n      const filters = { query: 'support' };\n      \n      const result = await service.searchCommunities(filters, undefined, 1, 10);\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        where: {\n          OR: [\n            { name: { contains: 'support', mode: 'insensitive' } },\n            { description: { contains: 'support', mode: 'insensitive' } },\n          ],\n        },\n        include: {\n          _count: { select: { memberships: true } },\n          memberships: false,\n        },\n        skip: 0,\n        take: 10,\n      });\n\n      expect(result.communities).toHaveLength(3);\n      result.communities.forEach(community => {\n        expect(community.membershipStatus).toBe('none');\n      });\n    });\n\n    it('should filter by description presence', async () => {\n      const filters = { hasDescription: true };\n      \n      await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith(\n        expect.objectContaining({\n          where: expect.objectContaining({\n            description: { not: '' },\n          }),\n        })\n      );\n    });\n\n    it('should filter by image presence', async () => {\n      const filters = { hasImage: false };\n      \n      await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith(\n        expect.objectContaining({\n          where: expect.objectContaining({\n            imageUrl: '',\n          }),\n        })\n      );\n    });\n\n    it('should filter by member count range', async () => {\n      const filters = { minMembers: 20, maxMembers: 50 };\n      \n      const result = await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      // Should filter out communities outside range\n      result.communities.forEach(community => {\n        expect(community.memberCount).toBeGreaterThanOrEqual(20);\n        expect(community.memberCount).toBeLessThanOrEqual(50);\n      });\n    });\n\n    it('should handle pagination correctly', async () => {\n      const filters = {};\n      \n      await service.searchCommunities(filters, 'user-123', 2, 5);\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith(\n        expect.objectContaining({\n          skip: 5, // (page - 1) * limit = (2 - 1) * 5\n          take: 5,\n        })\n      );\n    });\n\n    it('should sort communities by members count', async () => {\n      const filters = { sortBy: 'members', sortOrder: 'desc' };\n      \n      const result = await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      // Should be sorted by member count descending\n      for (let i = 1; i < result.communities.length; i++) {\n        expect(result.communities[i-1].memberCount).toBeGreaterThanOrEqual(\n          result.communities[i].memberCount\n        );\n      }\n    });\n\n    it('should sort communities by newest first', async () => {\n      const filters = { sortBy: 'newest', sortOrder: 'desc' };\n      \n      const result = await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      // Should be sorted by creation date descending\n      for (let i = 1; i < result.communities.length; i++) {\n        expect(result.communities[i-1].createdAt.getTime()).toBeGreaterThanOrEqual(\n          result.communities[i].createdAt.getTime()\n        );\n      }\n    });\n\n    it('should sort communities alphabetically', async () => {\n      const filters = { sortBy: 'alphabetical', sortOrder: 'asc' };\n      \n      const result = await service.searchCommunities(filters, 'user-123', 1, 10);\n\n      // Should be sorted alphabetically\n      for (let i = 1; i < result.communities.length; i++) {\n        expect(result.communities[i-1].name.localeCompare(result.communities[i].name))\n          .toBeLessThanOrEqual(0);\n      }\n    });\n\n    it('should calculate total pages correctly', async () => {\n      prismaService.community.count.mockResolvedValue(25);\n      \n      const result = await service.searchCommunities({}, 'user-123', 1, 10);\n\n      expect(result.totalPages).toBe(3); // Math.ceil(25/10) = 3\n    });\n\n    it('should handle errors gracefully', async () => {\n      prismaService.community.findMany.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      await expect(service.searchCommunities({}, 'user-123')).rejects.toThrow('Database error');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error searching communities'),\n        expect.any(Error)\n      );\n    });\n\n    it('should set correct membership status based on user memberships', async () => {\n      const communitiesWithMemberships = [\n        { ...mockCommunities[0], memberships: [{ role: 'member' }] },\n        { ...mockCommunities[1], memberships: [] },\n      ];\n      \n      prismaService.community.findMany.mockResolvedValue(communitiesWithMemberships);\n\n      const result = await service.searchCommunities({}, 'user-123', 1, 10);\n\n      expect(result.communities[0].membershipStatus).toBe('member');\n      expect(result.communities[1].membershipStatus).toBe('none');\n    });\n  });\n\n  describe('getCommunityDetails', () => {\n    beforeEach(() => {\n      prismaService.community.findUnique.mockResolvedValue(mockCommunityWithDetails);\n      prismaService.comment.count.mockResolvedValue(50);\n      prismaService.post.count.mockResolvedValue(10);\n      prismaService.membership.count\n        .mockResolvedValueOnce(5) // weekly posts\n        .mockResolvedValueOnce(15) // weekly comments\n        .mockResolvedValueOnce(3) // weekly members\n        .mockResolvedValueOnce(25); // active members\n      prismaService.user.findMany.mockResolvedValue([mockTopContributor]);\n    });\n\n    it('should get detailed community information', async () => {\n      const result = await service.getCommunityDetails('community-123', 'user-123');\n\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { id: 'community-123' },\n        include: expect.objectContaining({\n          _count: { select: { memberships: true } },\n          roomGroups: expect.any(Object),\n          moderatorCommunities: expect.any(Object),\n          memberships: expect.any(Object),\n        }),\n      });\n\n      expect(result).toEqual({\n        id: 'community-123',\n        name: 'Depression Support Network',\n        slug: 'depression-support',\n        description: 'A supportive community for depression',\n        imageUrl: 'depression.jpg',\n        createdAt: expect.any(Date),\n        updatedAt: expect.any(Date),\n        memberCount: 45,\n        stats: expect.objectContaining({\n          totalPosts: 2,\n          totalComments: 50,\n          activeMembers: 25,\n          recentActivity: expect.objectContaining({\n            postsThisWeek: 10,\n            commentsThisWeek: 15,\n            newMembersThisWeek: 3,\n          }),\n        }),\n        recentPosts: expect.arrayContaining([\n          expect.objectContaining({\n            id: 'post-456',\n            title: 'Another Post',\n            author: expect.objectContaining({\n              firstName: 'John',\n              lastName: 'Doe',\n            }),\n          }),\n        ]),\n        topContributors: expect.any(Array),\n        moderators: expect.arrayContaining([\n          expect.objectContaining({\n            firstName: 'John',\n            lastName: 'Doe',\n          }),\n        ]),\n        membershipStatus: 'member',\n        userPermissions: expect.objectContaining({\n          canPost: true,\n          canComment: true,\n          canModerate: false,\n        }),\n      });\n    });\n\n    it('should handle community not found', async () => {\n      prismaService.community.findUnique.mockResolvedValue(null);\n\n      await expect(service.getCommunityDetails('non-existent')).rejects.toThrow(\n        new NotFoundException('Community non-existent not found')\n      );\n    });\n\n    it('should calculate user permissions for moderator', async () => {\n      const moderatorCommunity = {\n        ...mockCommunityWithDetails,\n        memberships: [{ role: 'moderator' }],\n      };\n      \n      prismaService.community.findUnique.mockResolvedValue(moderatorCommunity);\n\n      const result = await service.getCommunityDetails('community-123', 'user-123');\n\n      expect(result.userPermissions).toEqual({\n        canPost: true,\n        canComment: true,\n        canModerate: true,\n      });\n    });\n\n    it('should handle user without membership', async () => {\n      const communityWithoutUserMembership = {\n        ...mockCommunityWithDetails,\n        memberships: [],\n      };\n      \n      prismaService.community.findUnique.mockResolvedValue(communityWithoutUserMembership);\n\n      const result = await service.getCommunityDetails('community-123', 'user-123');\n\n      expect(result.membershipStatus).toBe('none');\n      expect(result.userPermissions).toEqual({\n        canPost: false,\n        canComment: false,\n        canModerate: false,\n      });\n    });\n\n    it('should handle missing user context', async () => {\n      const result = await service.getCommunityDetails('community-123');\n\n      expect(result.membershipStatus).toBe('none');\n      expect(result.userPermissions).toEqual({\n        canPost: false,\n        canComment: false,\n        canModerate: false,\n      });\n    });\n\n    it('should sort recent posts by creation date', async () => {\n      const result = await service.getCommunityDetails('community-123', 'user-123');\n\n      // Should be sorted newest first\n      for (let i = 1; i < result.recentPosts.length; i++) {\n        expect(result.recentPosts[i-1].createdAt.getTime()).toBeGreaterThanOrEqual(\n          result.recentPosts[i].createdAt.getTime()\n        );\n      }\n    });\n\n    it('should handle posts with missing user data', async () => {\n      const communityWithAnonymousPost = {\n        ...mockCommunityWithDetails,\n        roomGroups: [{\n          ...mockRoomGroup,\n          rooms: [{\n            ...mockRoom,\n            posts: [{\n              id: 'post-anonymous',\n              title: 'Anonymous Post',\n              content: 'Post without user',\n              createdAt: new Date('2024-01-10'),\n              user: null,\n              _count: { comments: 0, hearts: 0 },\n            }],\n          }],\n        }],\n      };\n      \n      prismaService.community.findUnique.mockResolvedValue(communityWithAnonymousPost);\n\n      const result = await service.getCommunityDetails('community-123', 'user-123');\n\n      const anonymousPost = result.recentPosts.find(p => p.id === 'post-anonymous');\n      expect(anonymousPost?.author).toEqual({\n        id: 'unknown',\n        firstName: 'Unknown',\n        lastName: 'User',\n        avatarUrl: undefined,\n      });\n    });\n\n    it('should handle errors gracefully', async () => {\n      prismaService.community.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      await expect(service.getCommunityDetails('community-123')).rejects.toThrow('Database error');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting community details for community-123'),\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('getTrendingCommunities', () => {\n    beforeEach(() => {\n      prismaService.community.findMany.mockResolvedValue([mockTrendingCommunity]);\n      prismaService.membership.count.mockResolvedValue(5); // Previous period members\n    });\n\n    it('should get trending communities with default parameters', async () => {\n      const result = await service.getTrendingCommunities();\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        include: expect.objectContaining({\n          _count: { select: { memberships: true } },\n          memberships: expect.objectContaining({\n            where: expect.objectContaining({\n              joinedAt: { gte: expect.any(Date) },\n            }),\n          }),\n          roomGroups: expect.any(Object),\n        }),\n      });\n\n      expect(result).toBeInstanceOf(Array);\n      expect(result.length).toBeLessThanOrEqual(10);\n      \n      if (result.length > 0) {\n        expect(result[0]).toHaveProperty('trendingData');\n        expect(result[0].trendingData).toHaveProperty('growthRate');\n        expect(result[0].trendingData).toHaveProperty('activityScore');\n        expect(result[0].trendingData).toHaveProperty('engagementRate');\n        expect(result[0].trendingData).toHaveProperty('retentionRate');\n      }\n    });\n\n    it('should get trending communities for month timeframe', async () => {\n      await service.getTrendingCommunities(5, 'month');\n\n      expect(prismaService.community.findMany).toHaveBeenCalledWith({\n        include: expect.objectContaining({\n          memberships: expect.objectContaining({\n            where: expect.objectContaining({\n              joinedAt: { gte: expect.any(Date) },\n            }),\n          }),\n        }),\n      });\n    });\n\n    it('should limit results to specified limit', async () => {\n      const result = await service.getTrendingCommunities(3);\n\n      expect(result.length).toBeLessThanOrEqual(3);\n    });\n\n    it('should sort by trending score', async () => {\n      // Mock multiple communities with different trending metrics\n      const multipleTrendingCommunities = [\n        { ...mockTrendingCommunity, id: 'trending-1' },\n        { ...mockTrendingCommunity, id: 'trending-2' },\n        { ...mockTrendingCommunity, id: 'trending-3' },\n      ];\n      \n      prismaService.community.findMany.mockResolvedValue(multipleTrendingCommunities);\n\n      const result = await service.getTrendingCommunities();\n\n      // Should be sorted by trending score (combination of metrics)\n      for (let i = 1; i < result.length; i++) {\n        const scoreA = result[i-1].trendingData.growthRate * 0.4 + \n                     result[i-1].trendingData.activityScore * 0.4 + \n                     result[i-1].trendingData.engagementRate * 0.2;\n        const scoreB = result[i].trendingData.growthRate * 0.4 + \n                     result[i].trendingData.activityScore * 0.4 + \n                     result[i].trendingData.engagementRate * 0.2;\n        expect(scoreA).toBeGreaterThanOrEqual(scoreB);\n      }\n    });\n\n    it('should handle errors gracefully', async () => {\n      prismaService.community.findMany.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n\n      await expect(service.getTrendingCommunities()).rejects.toThrow('Database error');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting trending communities'),\n        expect.any(Error)\n      );\n    });\n\n    it('should calculate growth rate correctly', async () => {\n      const calculateTrendingData = (service as any).calculateTrendingData.bind(service);\n      \n      const community = {\n        id: 'test-community',\n        memberships: [{ joinedAt: new Date() }], // 1 new member\n        _count: { memberships: 10 }, // Total 10 members\n        posts: [],\n      };\n      \n      const startDate = new Date('2024-01-15');\n      const previousStartDate = new Date('2024-01-08');\n      \n      // Mock 5 previous members\n      prismaService.membership.count.mockResolvedValue(5);\n\n      const result = await calculateTrendingData(community, startDate, previousStartDate);\n\n      // Growth rate = ((1 - 5) / 5) * 100 = -80% (but should be >= 0)\n      expect(result.growthRate).toBeGreaterThanOrEqual(0);\n    });\n\n    it('should handle zero previous members', async () => {\n      const calculateTrendingData = (service as any).calculateTrendingData.bind(service);\n      \n      const community = {\n        id: 'test-community',\n        memberships: [{ joinedAt: new Date() }], // 1 new member\n        _count: { memberships: 1 },\n        posts: [],\n      };\n      \n      // Mock 0 previous members\n      prismaService.membership.count.mockResolvedValue(0);\n\n      const result = await calculateTrendingData(\n        community, \n        new Date('2024-01-15'), \n        new Date('2024-01-08')\n      );\n\n      expect(result.growthRate).toBe(100); // 100% growth when starting from 0\n    });\n  });\n\n  describe('getSimilarCommunities', () => {\n    const mockRefCommunity = {\n      id: 'ref-community',\n      memberships: [\n        {\n          user: {\n            memberships: [\n              { communityId: 'similar-1', community: { id: 'similar-1' } },\n              { communityId: 'similar-2', community: { id: 'similar-2' } },\n            ],\n          },\n        },\n        {\n          user: {\n            memberships: [\n              { communityId: 'similar-1', community: { id: 'similar-1' } },\n              { communityId: 'similar-3', community: { id: 'similar-3' } },\n            ],\n          },\n        },\n      ],\n    };\n\n    const mockSimilarCommunities = [\n      {\n        id: 'similar-1',\n        name: 'Similar Community 1',\n        slug: 'similar-1',\n        description: 'Similar community',\n        imageUrl: 'similar1.jpg',\n        createdAt: new Date('2024-01-01'),\n        _count: { memberships: 20 },\n        roomGroups: [{ rooms: [{ _count: { posts: 5 } }] }],\n      },\n      {\n        id: 'similar-2',\n        name: 'Similar Community 2',\n        slug: 'similar-2',\n        description: 'Another similar community',\n        imageUrl: 'similar2.jpg',\n        createdAt: new Date('2024-01-02'),\n        _count: { memberships: 15 },\n        roomGroups: [{ rooms: [{ _count: { posts: 3 } }] }],\n      },\n    ];\n\n    beforeEach(() => {\n      prismaService.community.findUnique\n        .mockResolvedValueOnce(mockRefCommunity)\n        .mockResolvedValue(null);\n      prismaService.community.findMany.mockResolvedValue(mockSimilarCommunities);\n      prismaService.membership.findMany.mockResolvedValue([]);\n    });\n\n    it('should find similar communities based on member overlap', async () => {\n      const context = { userId: 'user-123', maxResults: 5 };\n      \n      const result = await service.getSimilarCommunities('ref-community', context);\n\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { id: 'ref-community' },\n        include: expect.objectContaining({\n          memberships: expect.any(Object),\n        }),\n      });\n\n      expect(result).toBeInstanceOf(Array);\n      expect(result.length).toBeLessThanOrEqual(5);\n      \n      if (result.length > 0) {\n        expect(result[0]).toHaveProperty('id');\n        expect(result[0]).toHaveProperty('name');\n        expect(result[0]).toHaveProperty('membershipStatus');\n        expect(result[0].membershipStatus).toBe('none');\n      }\n    });\n\n    it('should exclude user joined communities when excludeJoined is true', async () => {\n      const userMemberships = [{ communityId: 'similar-1' }];\n      prismaService.membership.findMany.mockResolvedValue(userMemberships);\n\n      const context = { userId: 'user-123', excludeJoined: true, maxResults: 5 };\n      \n      const result = await service.getSimilarCommunities('ref-community', context);\n\n      expect(prismaService.membership.findMany).toHaveBeenCalledWith({\n        where: { userId: 'user-123' },\n        select: { communityId: true },\n      });\n\n      // Should exclude similar-1 since user is already a member\n      const excludedCommunity = result.find(c => c.id === 'similar-1');\n      expect(excludedCommunity).toBeUndefined();\n    });\n\n    it('should include user joined communities when excludeJoined is false', async () => {\n      const context = { userId: 'user-123', excludeJoined: false, maxResults: 5 };\n      \n      await service.getSimilarCommunities('ref-community', context);\n\n      expect(prismaService.membership.findMany).not.toHaveBeenCalled();\n    });\n\n    it('should throw NotFoundException for non-existent reference community', async () => {\n      prismaService.community.findUnique.mockResolvedValueOnce(null);\n\n      const context = { userId: 'user-123' };\n\n      await expect(\n        service.getSimilarCommunities('non-existent', context)\n      ).rejects.toThrow(new NotFoundException('Community non-existent not found'));\n    });\n\n    it('should handle communities without members', async () => {\n      const emptyRefCommunity = { id: 'ref-community', memberships: [] };\n      prismaService.community.findUnique.mockResolvedValueOnce(emptyRefCommunity);\n\n      const context = { userId: 'user-123' };\n      \n      const result = await service.getSimilarCommunities('ref-community', context);\n\n      expect(result).toEqual([]);\n    });\n\n    it('should limit results to maxResults', async () => {\n      const context = { userId: 'user-123', maxResults: 1 };\n      \n      const result = await service.getSimilarCommunities('ref-community', context);\n\n      expect(result.length).toBeLessThanOrEqual(1);\n    });\n\n    it('should handle errors gracefully', async () => {\n      prismaService.community.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n      const context = { userId: 'user-123' };\n\n      await expect(\n        service.getSimilarCommunities('ref-community', context)\n      ).rejects.toThrow('Database error');\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting similar communities for ref-community'),\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('applySorting', () => {\n    const sampleCommunities = [\n      {\n        id: '1',\n        name: 'Beta Community',\n        memberCount: 10,\n        recentActivity: { postCount: 5, commentCount: 10, lastActivityAt: null },\n        createdAt: new Date('2024-01-02'),\n      },\n      {\n        id: '2',\n        name: 'Alpha Community',\n        memberCount: 20,\n        recentActivity: { postCount: 3, commentCount: 7, lastActivityAt: null },\n        createdAt: new Date('2024-01-01'),\n      },\n    ] as any[];\n\n    it('should sort by members descending', () => {\n      const applySorting = (service as any).applySorting.bind(service);\n      const communities = [...sampleCommunities];\n      \n      applySorting(communities, 'members', 'desc');\n\n      expect(communities[0].memberCount).toBe(20);\n      expect(communities[1].memberCount).toBe(10);\n    });\n\n    it('should sort by members ascending', () => {\n      const applySorting = (service as any).applySorting.bind(service);\n      const communities = [...sampleCommunities];\n      \n      applySorting(communities, 'members', 'asc');\n\n      expect(communities[0].memberCount).toBe(10);\n      expect(communities[1].memberCount).toBe(20);\n    });\n\n    it('should sort by activity', () => {\n      const applySorting = (service as any).applySorting.bind(service);\n      const communities = [...sampleCommunities];\n      \n      applySorting(communities, 'activity', 'desc');\n\n      // Community 1: 5 + 10 = 15, Community 2: 3 + 7 = 10\n      expect(communities[0].id).toBe('1');\n      expect(communities[1].id).toBe('2');\n    });\n\n    it('should sort by newest', () => {\n      const applySorting = (service as any).applySorting.bind(service);\n      const communities = [...sampleCommunities];\n      \n      applySorting(communities, 'newest', 'desc');\n\n      expect(communities[0].createdAt.getTime()).toBe(new Date('2024-01-02').getTime());\n      expect(communities[1].createdAt.getTime()).toBe(new Date('2024-01-01').getTime());\n    });\n\n    it('should sort alphabetically', () => {\n      const applySorting = (service as any).applySorting.bind(service);\n      const communities = [...sampleCommunities];\n      \n      applySorting(communities, 'alphabetical', 'asc');\n\n      expect(communities[0].name).toBe('Alpha Community');\n      expect(communities[1].name).toBe('Beta Community');\n    });\n\n    it('should default to relevance sorting (member count)', () => {\n      const applySorting = (service as any).applySorting.bind(service);\n      const communities = [...sampleCommunities];\n      \n      applySorting(communities, 'relevance', 'desc');\n\n      expect(communities[0].memberCount).toBe(20);\n      expect(communities[1].memberCount).toBe(10);\n    });\n  });\n\n  describe('calculateSearchFacets', () => {\n    beforeEach(() => {\n      prismaService.community.count\n        .mockResolvedValueOnce(5)  // 1-10 range\n        .mockResolvedValueOnce(3)  // 11-50 range\n        .mockResolvedValueOnce(2)  // 51-100 range\n        .mockResolvedValueOnce(1)  // 101-500 range\n        .mockResolvedValueOnce(0); // 500+ range\n    });\n\n    it('should calculate member range facets', async () => {\n      const calculateSearchFacets = (service as any).calculateSearchFacets.bind(service);\n      \n      const result = await calculateSearchFacets({});\n\n      expect(result).toEqual({\n        memberRanges: [\n          { range: '1-10', count: 5 },\n          { range: '11-50', count: 3 },\n          { range: '51-100', count: 2 },\n          { range: '101-500', count: 1 },\n          { range: '500+', count: 0 },\n        ],\n        commonTags: [],\n      });\n    });\n\n    it('should handle errors gracefully', async () => {\n      prismaService.community.count.mockRejectedValue(new Error('Database error'));\n\n      const calculateSearchFacets = (service as any).calculateSearchFacets.bind(service);\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n      \n      const result = await calculateSearchFacets({});\n\n      expect(result).toEqual({\n        memberRanges: [],\n        commonTags: [],\n      });\n\n      expect(errorSpy).toHaveBeenCalledWith(\n        'Error calculating search facets:',\n        expect.any(Error)\n      );\n    });\n  });\n\n  describe('getTopContributors', () => {\n    beforeEach(() => {\n      const mockCommunityForContributors = {\n        id: 'community-123',\n        roomGroups: [\n          { rooms: [{ id: 'room-1' }, { id: 'room-2' }] },\n        ],\n      };\n      \n      prismaService.community.findUnique.mockResolvedValue(mockCommunityForContributors);\n      prismaService.user.findMany.mockResolvedValue([\n        {\n          id: 'user-1',\n          firstName: 'Top',\n          lastName: 'Contributor',\n          avatarUrl: 'top.jpg',\n          _count: { posts: 10, comments: 20 },\n        },\n        {\n          id: 'user-2',\n          firstName: 'Second',\n          lastName: 'Contributor',\n          avatarUrl: 'second.jpg',\n          _count: { posts: 5, comments: 15 },\n        },\n      ]);\n    });\n\n    it('should get top contributors for community', async () => {\n      const getTopContributors = (service as any).getTopContributors.bind(service);\n      \n      const result = await getTopContributors('community-123', 5);\n\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { id: 'community-123' },\n        include: {\n          roomGroups: {\n            include: {\n              rooms: { select: { id: true } },\n            },\n          },\n        },\n      });\n\n      expect(result).toEqual([\n        {\n          id: 'user-1',\n          firstName: 'Top',\n          lastName: 'Contributor',\n          avatarUrl: 'top.jpg',\n          contributionScore: 50, // 10 * 3 + 20 * 1\n          postCount: 10,\n          commentCount: 20,\n        },\n        {\n          id: 'user-2',\n          firstName: 'Second',\n          lastName: 'Contributor',\n          avatarUrl: 'second.jpg',\n          contributionScore: 30, // 5 * 3 + 15 * 1\n          postCount: 5,\n          commentCount: 15,\n        },\n      ]);\n    });\n\n    it('should return empty array for non-existent community', async () => {\n      prismaService.community.findUnique.mockResolvedValue(null);\n\n      const getTopContributors = (service as any).getTopContributors.bind(service);\n      \n      const result = await getTopContributors('non-existent', 5);\n\n      expect(result).toEqual([]);\n    });\n\n    it('should filter out contributors with zero contributions', async () => {\n      prismaService.user.findMany.mockResolvedValue([\n        {\n          id: 'user-active',\n          firstName: 'Active',\n          lastName: 'User',\n          avatarUrl: 'active.jpg',\n          _count: { posts: 5, comments: 10 },\n        },\n        {\n          id: 'user-inactive',\n          firstName: 'Inactive',\n          lastName: 'User',\n          avatarUrl: 'inactive.jpg',\n          _count: { posts: 0, comments: 0 },\n        },\n      ]);\n\n      const getTopContributors = (service as any).getTopContributors.bind(service);\n      \n      const result = await getTopContributors('community-123', 5);\n\n      expect(result).toHaveLength(1);\n      expect(result[0].id).toBe('user-active');\n    });\n\n    it('should handle errors gracefully', async () => {\n      prismaService.community.findUnique.mockRejectedValue(new Error('Database error'));\n\n      const getTopContributors = (service as any).getTopContributors.bind(service);\n      const errorSpy = jest.spyOn(Logger.prototype, 'error').mockImplementation();\n      \n      const result = await getTopContributors('community-123', 5);\n\n      expect(result).toEqual([]);\n      expect(errorSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error getting top contributors for community community-123'),\n        expect.any(Error)\n      );\n    });\n\n    it('should limit results to specified limit', async () => {\n      const getTopContributors = (service as any).getTopContributors.bind(service);\n      \n      const result = await getTopContributors('community-123', 1);\n\n      expect(result).toHaveLength(1);\n    });\n\n    it('should handle missing avatarUrl', async () => {\n      prismaService.user.findMany.mockResolvedValue([\n        {\n          id: 'user-no-avatar',\n          firstName: 'No',\n          lastName: 'Avatar',\n          avatarUrl: null,\n          _count: { posts: 5, comments: 10 },\n        },\n      ]);\n\n      const getTopContributors = (service as any).getTopContributors.bind(service);\n      \n      const result = await getTopContributors('community-123', 5);\n\n      expect(result[0].avatarUrl).toBeUndefined();\n    });\n  });\n\n  describe('edge cases and performance', () => {\n    it('should handle very large search results efficiently', async () => {\n      const largeCommunityList = Array.from({ length: 1000 }, (_, i) => ({\n        id: `community-${i}`,\n        name: `Community ${i}`,\n        slug: `community-${i}`,\n        description: `Description ${i}`,\n        imageUrl: `image-${i}.jpg`,\n        createdAt: new Date('2024-01-01'),\n        updatedAt: new Date('2024-01-01'),\n        _count: { memberships: i % 100 },\n        memberships: [],\n      }));\n\n      prismaService.community.findMany.mockResolvedValue(largeCommunityList);\n      prismaService.community.count.mockResolvedValue(1000);\n\n      const startTime = Date.now();\n      const result = await service.searchCommunities({}, 'user-123', 1, 20);\n      const endTime = Date.now();\n\n      expect(result.communities).toHaveLength(20);\n      expect(endTime - startTime).toBeLessThan(2000); // Should complete within 2 seconds\n    });\n\n    it('should handle missing data gracefully', async () => {\n      const communityWithMissingData = {\n        id: 'community-missing',\n        name: null,\n        slug: 'missing-data',\n        description: '',\n        imageUrl: null,\n        createdAt: new Date('2024-01-01'),\n        updatedAt: new Date('2024-01-01'),\n        _count: { memberships: 0 },\n        memberships: [],\n      };\n\n      prismaService.community.findMany.mockResolvedValue([communityWithMissingData]);\n      prismaService.community.count.mockResolvedValue(1);\n\n      const result = await service.searchCommunities({}, 'user-123', 1, 10);\n\n      expect(result.communities).toHaveLength(1);\n      expect(result.communities[0].name).toBeNull();\n      expect(result.communities[0].imageUrl).toBeNull();\n    });\n\n    it('should handle concurrent requests', async () => {\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n      prismaService.community.count.mockResolvedValue(3);\n\n      const promises = [\n        service.searchCommunities({}, 'user-1'),\n        service.searchCommunities({}, 'user-2'),\n        service.searchCommunities({}, 'user-3'),\n      ];\n\n      const results = await Promise.all(promises);\n\n      expect(results).toHaveLength(3);\n      results.forEach(result => {\n        expect(result.communities).toBeInstanceOf(Array);\n      });\n    });\n\n    it('should handle malformed filter objects', async () => {\n      const malformedFilters = {\n        query: null,\n        minMembers: 'invalid',\n        maxMembers: {},\n        sortBy: [],\n      } as any;\n\n      prismaService.community.findMany.mockResolvedValue(mockCommunities);\n      prismaService.community.count.mockResolvedValue(3);\n\n      // Should not throw error\n      const result = await service.searchCommunities(malformedFilters, 'user-123');\n\n      expect(result).toBeDefined();\n      expect(result.communities).toBeInstanceOf(Array);\n    });\n  });\n});"],"version":3}