{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/performance/database-performance.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/performance/database-performance.spec.ts"],"sourcesContent":["/**\n * Database Performance Testing Suite\n *\n * Tests database query performance, connection pooling, and data handling\n * under various load conditions.\n */\n\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { PrismaService } from '../../database/prisma.service';\nimport { TestDataFactory } from '../test-data.factory';\nimport { performance } from 'perf_hooks';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ninterface QueryPerformanceResult {\n  queryName: string;\n  executionTime: number;\n  rowsAffected: number;\n  memoryUsage: number;\n  success: boolean;\n  error?: string;\n}\n\ninterface ConnectionPoolMetrics {\n  activeConnections: number;\n  idleConnections: number;\n  totalConnections: number;\n  connectionLatency: number;\n  queryQueueLength: number;\n}\n\ndescribe('Database Performance Testing', () => {\n  let prisma: PrismaService;\n  let testFactory: TestDataFactory;\n  const performanceResults: QueryPerformanceResult[] = [];\n\n  beforeAll(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      providers: [PrismaService],\n    }).compile();\n\n    prisma = moduleFixture.get<PrismaService>(PrismaService);\n    testFactory = new TestDataFactory(prisma);\n  });\n\n  afterAll(async () => {\n    // Generate comprehensive performance report\n    await generateDatabasePerformanceReport();\n    await prisma.$disconnect();\n  });\n\n  beforeEach(async () => {\n    // Clean database before each test\n    await cleanDatabase();\n  });\n\n  describe('Query Performance Analysis', () => {\n    it('should measure basic CRUD operation performance', async () => {\n      console.log('üìä Testing basic CRUD operations...');\n\n      // Test CREATE performance\n      const createResult = await measureQueryPerformance(\n        'User Creation',\n        async () => {\n          const users = [];\n          for (let i = 0; i < 100; i++) {\n            users.push(\n              await testFactory.createUser({\n                email: `user${i}@example.com`,\n                firstName: `User${i}`,\n                lastName: 'Test',\n              }),\n            );\n          }\n          return users.length;\n        },\n      );\n\n      // Test READ performance\n      const readResult = await measureQueryPerformance(\n        'User Query (All)',\n        async () => {\n          const users = await prisma.user.findMany({\n            include: {\n              client: true,\n              therapist: true,\n            },\n          });\n          return users.length;\n        },\n      );\n\n      // Test UPDATE performance\n      const updateResult = await measureQueryPerformance(\n        'User Update (Batch)',\n        async () => {\n          const result = await prisma.user.updateMany({\n            where: {\n              email: {\n                contains: '@example.com',\n              },\n            },\n            data: {\n              firstName: 'Updated',\n            },\n          });\n          return result.count;\n        },\n      );\n\n      // Test DELETE performance\n      const deleteResult = await measureQueryPerformance(\n        'User Deletion (Batch)',\n        async () => {\n          const result = await prisma.user.deleteMany({\n            where: {\n              email: {\n                contains: '@example.com',\n              },\n            },\n          });\n          return result.count;\n        },\n      );\n\n      // Assertions\n      expect(createResult.success).toBe(true);\n      expect(readResult.success).toBe(true);\n      expect(updateResult.success).toBe(true);\n      expect(deleteResult.success).toBe(true);\n\n      // Performance expectations\n      expect(createResult.executionTime).toBeLessThan(5000); // 5 seconds for 100 users\n      expect(readResult.executionTime).toBeLessThan(2000); // 2 seconds for read\n      expect(updateResult.executionTime).toBeLessThan(1000); // 1 second for batch update\n      expect(deleteResult.executionTime).toBeLessThan(1000); // 1 second for batch delete\n\n      console.log(`CRUD Performance Summary:\n        CREATE: ${createResult.executionTime.toFixed(2)}ms for ${createResult.rowsAffected} records\n        READ: ${readResult.executionTime.toFixed(2)}ms for ${readResult.rowsAffected} records\n        UPDATE: ${updateResult.executionTime.toFixed(2)}ms for ${updateResult.rowsAffected} records\n        DELETE: ${deleteResult.executionTime.toFixed(2)}ms for ${deleteResult.rowsAffected} records`);\n    }, 30000);\n\n    it('should test complex query performance', async () => {\n      console.log('üîç Testing complex query performance...');\n\n      // Set up test data\n      const users = [];\n      const therapists = [];\n\n      for (let i = 0; i < 50; i++) {\n        const user = await testFactory.createUser();\n        users.push(user);\n\n        if (i < 10) {\n          const therapist = await testFactory.createTherapist({\n            userId: user.id,\n            specializations: ['depression', 'anxiety'],\n            hourlyRate: 100 + i * 10,\n          });\n          therapists.push(therapist);\n        }\n      }\n\n      // Complex join query\n      const complexJoinResult = await measureQueryPerformance(\n        'Complex Join Query',\n        async () => {\n          const result = await prisma.user.findMany({\n            where: {\n              therapist: {\n                isNot: null,\n              },\n            },\n            include: {\n              therapist: {\n                include: {\n                  clients: {\n                    include: {\n                      user: true,\n                      preAssessment: true,\n                    },\n                  },\n                  application: true,\n                },\n              },\n              client: {\n                include: {\n                  therapist: {\n                    include: {\n                      user: true,\n                    },\n                  },\n                  preAssessment: true,\n                },\n              },\n            },\n          });\n          return result.length;\n        },\n      );\n\n      // Aggregation query\n      const aggregationResult = await measureQueryPerformance(\n        'Aggregation Query',\n        async () => {\n          const stats = await prisma.therapist.aggregate({\n            _avg: {\n              hourlyRate: true,\n            },\n            _count: {\n              id: true,\n            },\n            _max: {\n              hourlyRate: true,\n            },\n            _min: {\n              hourlyRate: true,\n            },\n          });\n          return 1; // Single result\n        },\n      );\n\n      // Search query with filters\n      const searchResult = await measureQueryPerformance(\n        'Search with Filters',\n        async () => {\n          const result = await prisma.therapist.findMany({\n            where: {\n              AND: [\n                {\n                  specializations: {\n                    hasSome: ['depression', 'anxiety'],\n                  },\n                },\n                {\n                  hourlyRate: {\n                    gte: 100,\n                    lte: 200,\n                  },\n                },\n                {\n                  user: {\n                    isActive: true,\n                  },\n                },\n              ],\n            },\n            include: {\n              user: true,\n              clients: {\n                take: 5,\n              },\n            },\n            orderBy: {\n              hourlyRate: 'asc',\n            },\n          });\n          return result.length;\n        },\n      );\n\n      // Assertions\n      expect(complexJoinResult.success).toBe(true);\n      expect(aggregationResult.success).toBe(true);\n      expect(searchResult.success).toBe(true);\n\n      // Performance expectations for complex queries\n      expect(complexJoinResult.executionTime).toBeLessThan(3000);\n      expect(aggregationResult.executionTime).toBeLessThan(1000);\n      expect(searchResult.executionTime).toBeLessThan(2000);\n\n      console.log(`Complex Query Performance:\n        Complex Join: ${complexJoinResult.executionTime.toFixed(2)}ms\n        Aggregation: ${aggregationResult.executionTime.toFixed(2)}ms\n        Search/Filter: ${searchResult.executionTime.toFixed(2)}ms`);\n    }, 30000);\n\n    it('should test pagination performance', async () => {\n      console.log('üìÑ Testing pagination performance...');\n\n      // Create test data\n      for (let i = 0; i < 200; i++) {\n        await testFactory.createUser({\n          email: `page-user-${i}@example.com`,\n          firstName: `PageUser${i}`,\n        });\n      }\n\n      const pageSize = 20;\n      const pageTests = [1, 5, 10]; // Test different page numbers\n\n      for (const pageNumber of pageTests) {\n        const paginationResult = await measureQueryPerformance(\n          `Pagination Page ${pageNumber}`,\n          async () => {\n            const skip = (pageNumber - 1) * pageSize;\n            const users = await prisma.user.findMany({\n              skip,\n              take: pageSize,\n              where: {\n                email: {\n                  contains: 'page-user',\n                },\n              },\n              orderBy: {\n                createdAt: 'desc',\n              },\n            });\n            return users.length;\n          },\n        );\n\n        expect(paginationResult.success).toBe(true);\n        expect(paginationResult.executionTime).toBeLessThan(1000); // Should be fast\n\n        console.log(\n          `Page ${pageNumber}: ${paginationResult.executionTime.toFixed(2)}ms`,\n        );\n      }\n    }, 20000);\n  });\n\n  describe('Connection Pool Performance', () => {\n    it('should handle concurrent database connections efficiently', async () => {\n      console.log('üîó Testing connection pool performance...');\n\n      const connectionTests: Promise<QueryPerformanceResult>[] = [];\n      const concurrentQueries = 20;\n\n      // Create multiple concurrent database operations\n      for (let i = 0; i < concurrentQueries; i++) {\n        connectionTests.push(\n          measureQueryPerformance(`Concurrent Query ${i}`, async () => {\n            // Simulate different types of database operations\n            const operations = [\n              () => prisma.user.count(),\n              () => prisma.user.findFirst(),\n              () => prisma.therapist.findMany({ take: 5 }),\n              () =>\n                prisma.user.findMany({ take: 10, include: { client: true } }),\n            ];\n\n            const operation = operations[i % operations.length];\n            const result = await operation();\n            return Array.isArray(result) ? result.length : 1;\n          }),\n        );\n      }\n\n      const results = await Promise.allSettled(connectionTests);\n\n      const successfulQueries = results.filter(\n        (r) => r.status === 'fulfilled',\n      ).length;\n      const failedQueries = results.length - successfulQueries;\n\n      console.log(`Connection Pool Test Results:\n        Concurrent Queries: ${concurrentQueries}\n        Successful: ${successfulQueries}\n        Failed: ${failedQueries}\n        Success Rate: ${((successfulQueries / concurrentQueries) * 100).toFixed(2)}%`);\n\n      // Most queries should succeed\n      expect(successfulQueries).toBeGreaterThan(concurrentQueries * 0.8); // 80% success rate\n      expect(failedQueries).toBeLessThan(concurrentQueries * 0.2); // Less than 20% failures\n    }, 15000);\n\n    it('should handle transaction performance under load', async () => {\n      console.log('üí≥ Testing transaction performance...');\n\n      const transactionResult = await measureQueryPerformance(\n        'Complex Transaction',\n        async () => {\n          const results = await prisma.$transaction(async (tx) => {\n            // Create user\n            const user = await tx.user.create({\n              data: {\n                email: 'transaction-test@example.com',\n                firstName: 'Transaction',\n                lastName: 'Test',\n                clerkId: `transaction-${Date.now()}`,\n              },\n            });\n\n            // Create client profile\n            const client = await tx.client.create({\n              data: {\n                userId: user.id,\n                needsTherapistRecommendations: true,\n              },\n            });\n\n            // Create pre-assessment\n            const preAssessment = await tx.preAssessment.create({\n              data: {\n                userId: user.id,\n                questionnaires: {\n                  PHQ9: [1, 2, 1, 0, 2, 1, 3, 2, 1],\n                  GAD7: [2, 1, 3, 2, 1, 2, 3],\n                },\n                scores: {\n                  depression: 15,\n                  anxiety: 12,\n                },\n                severityLevels: {\n                  depression: 'moderate',\n                  anxiety: 'mild',\n                },\n                status: 'COMPLETED',\n              },\n            });\n\n            return { user, client, preAssessment };\n          });\n\n          return 1; // One transaction completed\n        },\n      );\n\n      expect(transactionResult.success).toBe(true);\n      expect(transactionResult.executionTime).toBeLessThan(2000); // 2 seconds max for complex transaction\n\n      console.log(\n        `Transaction Performance: ${transactionResult.executionTime.toFixed(2)}ms`,\n      );\n    }, 10000);\n  });\n\n  describe('Data Volume Performance', () => {\n    it('should handle large dataset queries efficiently', async () => {\n      console.log('üìà Testing large dataset performance...');\n\n      // Create large dataset\n      const batchSize = 100;\n      const batches = 5; // Total: 500 records\n\n      for (let batch = 0; batch < batches; batch++) {\n        const users = [];\n        for (let i = 0; i < batchSize; i++) {\n          users.push({\n            email: `bulk-user-${batch}-${i}@example.com`,\n            firstName: `BulkUser${batch}${i}`,\n            lastName: 'Test',\n            clerkId: `bulk-${batch}-${i}-${Date.now()}`,\n          });\n        }\n\n        await prisma.user.createMany({\n          data: users,\n        });\n      }\n\n      // Test large dataset queries\n      const largeQueryResult = await measureQueryPerformance(\n        'Large Dataset Query',\n        async () => {\n          const users = await prisma.user.findMany({\n            where: {\n              email: {\n                contains: 'bulk-user',\n              },\n            },\n            include: {\n              client: true,\n            },\n          });\n          return users.length;\n        },\n      );\n\n      // Test large dataset aggregation\n      const aggregationResult = await measureQueryPerformance(\n        'Large Dataset Aggregation',\n        async () => {\n          const count = await prisma.user.count({\n            where: {\n              email: {\n                contains: 'bulk-user',\n              },\n            },\n          });\n          return count;\n        },\n      );\n\n      expect(largeQueryResult.success).toBe(true);\n      expect(aggregationResult.success).toBe(true);\n      expect(largeQueryResult.executionTime).toBeLessThan(5000); // 5 seconds for large query\n      expect(aggregationResult.executionTime).toBeLessThan(2000); // 2 seconds for aggregation\n\n      console.log(`Large Dataset Performance:\n        Query: ${largeQueryResult.executionTime.toFixed(2)}ms for ${largeQueryResult.rowsAffected} records\n        Aggregation: ${aggregationResult.executionTime.toFixed(2)}ms`);\n    }, 30000);\n  });\n\n  // Helper Functions\n  async function measureQueryPerformance(\n    queryName: string,\n    queryFunction: () => Promise<number>,\n  ): Promise<QueryPerformanceResult> {\n    const memoryBefore = process.memoryUsage().heapUsed / 1024 / 1024;\n    const startTime = performance.now();\n\n    let result: QueryPerformanceResult;\n\n    try {\n      const rowsAffected = await queryFunction();\n      const endTime = performance.now();\n      const memoryAfter = process.memoryUsage().heapUsed / 1024 / 1024;\n\n      result = {\n        queryName,\n        executionTime: endTime - startTime,\n        rowsAffected,\n        memoryUsage: memoryAfter - memoryBefore,\n        success: true,\n      };\n    } catch (error) {\n      const endTime = performance.now();\n      const memoryAfter = process.memoryUsage().heapUsed / 1024 / 1024;\n\n      result = {\n        queryName,\n        executionTime: endTime - startTime,\n        rowsAffected: 0,\n        memoryUsage: memoryAfter - memoryBefore,\n        success: false,\n        error: error.message,\n      };\n    }\n\n    performanceResults.push(result);\n    return result;\n  }\n\n  async function cleanDatabase(): Promise<void> {\n    await prisma.$transaction([\n      prisma.preAssessment.deleteMany(),\n      prisma.client.deleteMany(),\n      prisma.therapist.deleteMany(),\n      prisma.user.deleteMany(),\n    ]);\n  }\n\n  async function generateDatabasePerformanceReport(): Promise<void> {\n    const report = {\n      summary: {\n        totalQueries: performanceResults.length,\n        successfulQueries: performanceResults.filter((r) => r.success).length,\n        failedQueries: performanceResults.filter((r) => !r.success).length,\n        averageExecutionTime:\n          performanceResults.reduce((sum, r) => sum + r.executionTime, 0) /\n          performanceResults.length,\n        slowestQuery: performanceResults.reduce((max, r) =>\n          r.executionTime > max.executionTime ? r : max,\n        ),\n        fastestQuery: performanceResults.reduce((min, r) =>\n          r.executionTime < min.executionTime ? r : min,\n        ),\n        totalMemoryUsage: performanceResults.reduce(\n          (sum, r) => sum + r.memoryUsage,\n          0,\n        ),\n      },\n      performanceThresholds: {\n        maxAcceptableTime: 5000, // 5 seconds\n        queriesExceedingThreshold: performanceResults.filter(\n          (r) => r.executionTime > 5000,\n        ),\n      },\n      detailedResults: performanceResults,\n      recommendations: generatePerformanceRecommendations(),\n    };\n\n    const reportsDir = path.join(__dirname, '../../../test-reports/database');\n    await fs.promises.mkdir(reportsDir, { recursive: true });\n\n    const filePath = path.join(reportsDir, 'database-performance-report.json');\n    await fs.promises.writeFile(filePath, JSON.stringify(report, null, 2));\n\n    console.log(`üìä Database performance report saved to: ${filePath}`);\n  }\n\n  function generatePerformanceRecommendations(): string[] {\n    const recommendations: string[] = [];\n\n    const slowQueries = performanceResults.filter(\n      (r) => r.executionTime > 2000,\n    );\n    if (slowQueries.length > 0) {\n      recommendations.push(\n        `Optimize slow queries: ${slowQueries.map((q) => q.queryName).join(', ')}`,\n      );\n    }\n\n    const memoryIntensive = performanceResults.filter(\n      (r) => r.memoryUsage > 10,\n    );\n    if (memoryIntensive.length > 0) {\n      recommendations.push(\n        `Review memory usage for: ${memoryIntensive.map((q) => q.queryName).join(', ')}`,\n      );\n    }\n\n    const failedQueries = performanceResults.filter((r) => !r.success);\n    if (failedQueries.length > 0) {\n      recommendations.push(\n        `Fix failing queries: ${failedQueries.map((q) => q.queryName).join(', ')}`,\n      );\n    }\n\n    return recommendations;\n  }\n});\n"],"version":3}