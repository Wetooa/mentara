{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/decorators/validate-body.decorator.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/decorators/validate-body.decorator.ts"],"sourcesContent":["import {\n  createParamDecorator,\n  ExecutionContext,\n  BadRequestException,\n} from '@nestjs/common';\nimport { z } from 'zod';\nimport { validateSchema, formatValidationErrors } from '../../auth/validation';\n\n// Body validation decorator that validates request body using Zod schemas\nexport const ValidatedBody = createParamDecorator(\n  (schema: any, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    const body = request.body;\n\n    if (!schema) {\n      throw new Error('Schema is required for ValidatedBody decorator');\n    }\n\n    const result = validateSchema(schema, body);\n\n    if (!result.success) {\n      const errorMessage = formatValidationErrors(result.errors);\n      throw new BadRequestException(`Validation failed: ${errorMessage}`);\n    }\n\n    return result.data;\n  },\n);\n\n// Query validation decorator for query parameters\nexport const ValidatedQuery = createParamDecorator(\n  (schema: any, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    const query = request.query;\n\n    if (!schema) {\n      throw new Error('Schema is required for ValidatedQuery decorator');\n    }\n\n    // Convert query parameters to appropriate types\n    const processedQuery: Record<string, any> = {};\n    Object.entries(query).forEach(([key, value]) => {\n      if (typeof value === 'string') {\n        // Try to coerce string values\n        if (value === 'true') {\n          processedQuery[key] = true;\n        } else if (value === 'false') {\n          processedQuery[key] = false;\n        } else if (value === 'null') {\n          processedQuery[key] = null;\n        } else if (value === 'undefined') {\n          processedQuery[key] = undefined;\n        } else if (!isNaN(Number(value)) && value !== '') {\n          processedQuery[key] = Number(value);\n        } else {\n          processedQuery[key] = value;\n        }\n      } else {\n        processedQuery[key] = value;\n      }\n    });\n\n    const result = validateSchema(schema, processedQuery);\n\n    if (!result.success) {\n      const errorMessage = formatValidationErrors(result.errors);\n      throw new BadRequestException(`Query validation failed: ${errorMessage}`);\n    }\n\n    return result.data;\n  },\n);\n\n// Params validation decorator for path parameters\nexport const ValidatedParams = createParamDecorator(\n  (schema: any, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    const params = request.params;\n\n    if (!schema) {\n      throw new Error('Schema is required for ValidatedParams decorator');\n    }\n\n    const result = validateSchema(schema, params);\n\n    if (!result.success) {\n      const errorMessage = formatValidationErrors(result.errors);\n      throw new BadRequestException(\n        `Path parameter validation failed: ${errorMessage}`,\n      );\n    }\n\n    return result.data;\n  },\n);\n"],"version":3}