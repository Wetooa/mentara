275e89a4c4910323a4f6cc5262bc517c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const admin_auth_controller_1 = require("./admin-auth.controller");
const admin_auth_service_1 = require("../../services/auth/admin-auth.service");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const zod_validation_pipe_1 = require("../../common/pipes/zod-validation.pipe");
const auth_testing_helpers_1 = require("../../test-utils/auth-testing-helpers");
describe('AdminAuthController', () => {
    let controller;
    let adminAuthService;
    let mockJwtAuthGuard;
    // Test data constants
    const mockAdminUser = {
        id: auth_testing_helpers_1.TEST_USER_IDS.ADMIN,
        email: auth_testing_helpers_1.TEST_EMAILS.ADMIN,
        firstName: 'Admin',
        lastName: 'User',
        role: 'admin',
        emailVerified: true,
        adminLevel: 'admin',
        permissions: ['read', 'write', 'delete'],
        createdAt: new Date(),
        lastLoginAt: new Date(),
    };
    const mockSuperAdminUser = {
        ...mockAdminUser,
        id: 'super-admin-123',
        email: 'super@mentara.com',
        adminLevel: 'super_admin',
        permissions: ['read', 'write', 'delete', 'create_admins'],
    };
    const mockTokens = {
        accessToken: 'mock-access-token',
        refreshToken: 'mock-refresh-token',
        expiresIn: 3600,
    };
    const mockDashboardStats = {
        totalUsers: 1000,
        totalTherapists: 100,
        totalAdmins: 5,
        activeUsers: 750,
        pendingApplications: 25,
        systemHealth: 'healthy',
        lastUpdated: new Date(),
    };
    beforeEach(async () => {
        // Create mock services
        const mockAdminAuthService = {
            createAdminAccount: jest.fn(),
            loginAdmin: jest.fn(),
            getAdminProfile: jest.fn(),
            getAdminPermissions: jest.fn(),
            getAdminDashboardStats: jest.fn(),
        };
        mockJwtAuthGuard = {
            canActivate: jest.fn().mockReturnValue(true),
        };
        const module = await testing_1.Test.createTestingModule({
            imports: [
                throttler_1.ThrottlerModule.forRoot([
                    {
                        name: 'short',
                        ttl: 1000,
                        limit: 3,
                    },
                ]),
            ],
            controllers: [admin_auth_controller_1.AdminAuthController],
            providers: [
                {
                    provide: admin_auth_service_1.AdminAuthService,
                    useValue: mockAdminAuthService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: jest.fn().mockReturnValue(true) })
            .compile();
        controller = module.get(admin_auth_controller_1.AdminAuthController);
        adminAuthService = module.get(admin_auth_service_1.AdminAuthService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('createAdminAccount', () => {
        const validRegisterDto = {
            email: 'newadmin@mentara.com',
            password: 'SecurePass123!',
            firstName: 'New',
            lastName: 'Admin',
            adminLevel: 'admin',
            permissions: ['read', 'write'],
        };
        it('should create admin account successfully when called by admin', async () => {
            // Arrange
            const mockCreatedUser = {
                user: mockAdminUser,
                message: 'Admin account created successfully',
            };
            jest.spyOn(adminAuthService, 'createAdminAccount').mockResolvedValue(mockCreatedUser);
            // Act
            const result = await controller.createAdminAccount('admin', validRegisterDto);
            // Assert
            expect(adminAuthService.createAdminAccount).toHaveBeenCalledWith(validRegisterDto.email, validRegisterDto.password, validRegisterDto.firstName, validRegisterDto.lastName, validRegisterDto.adminLevel, validRegisterDto.permissions);
            expect(result).toEqual({
                user: {
                    id: mockAdminUser.id,
                    email: mockAdminUser.email,
                    firstName: mockAdminUser.firstName,
                    lastName: mockAdminUser.lastName,
                    role: mockAdminUser.role,
                    emailVerified: mockAdminUser.emailVerified,
                },
                message: mockCreatedUser.message,
            });
        });
        it('should throw ForbiddenException when called by non-admin', async () => {
            // Arrange & Act & Assert
            await auth_testing_helpers_1.TestAssertions.expectToThrowNestException(() => controller.createAdminAccount('client', validRegisterDto), common_1.ForbiddenException, 'Only admins can create admin accounts');
            expect(adminAuthService.createAdminAccount).not.toHaveBeenCalled();
        });
        it('should use default values when optional fields are not provided', async () => {
            // Arrange
            const minimalRegisterDto = {
                email: 'newadmin@mentara.com',
                password: 'SecurePass123!',
                firstName: 'New',
                lastName: 'Admin',
            };
            const mockCreatedUser = {
                user: mockAdminUser,
                message: 'Admin account created successfully',
            };
            jest.spyOn(adminAuthService, 'createAdminAccount').mockResolvedValue(mockCreatedUser);
            // Act
            await controller.createAdminAccount('admin', minimalRegisterDto);
            // Assert
            expect(adminAuthService.createAdminAccount).toHaveBeenCalledWith(minimalRegisterDto.email, minimalRegisterDto.password, minimalRegisterDto.firstName, minimalRegisterDto.lastName, 'admin', // Default adminLevel
            []);
        });
        it('should handle service errors appropriately', async () => {
            // Arrange
            const serviceError = new Error('Email already exists');
            jest.spyOn(adminAuthService, 'createAdminAccount').mockRejectedValue(serviceError);
            // Act & Assert
            await expect(controller.createAdminAccount('admin', validRegisterDto)).rejects.toThrow(serviceError);
        });
    });
    describe('login', () => {
        const validLoginDto = {
            email: auth_testing_helpers_1.TEST_EMAILS.ADMIN,
            password: 'SecurePass123!',
        };
        const mockRequest = {
            ip: '192.168.1.1',
            get: jest.fn().mockReturnValue('Test User Agent'),
        };
        it('should login admin successfully with valid credentials', async () => {
            // Arrange
            const mockLoginResult = {
                user: mockAdminUser,
                tokens: mockTokens,
            };
            jest.spyOn(adminAuthService, 'loginAdmin').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login(validLoginDto, mockRequest);
            // Assert
            expect(adminAuthService.loginAdmin).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequest.ip, 'Test User Agent');
            expect(result).toEqual({
                user: {
                    id: mockAdminUser.id,
                    email: mockAdminUser.email,
                    firstName: mockAdminUser.firstName,
                    lastName: mockAdminUser.lastName,
                    role: mockAdminUser.role,
                    emailVerified: mockAdminUser.emailVerified,
                },
                accessToken: mockTokens.accessToken,
                refreshToken: mockTokens.refreshToken,
                expiresIn: mockTokens.expiresIn,
            });
        });
        it('should handle missing User-Agent header', async () => {
            // Arrange
            const mockRequestWithoutUserAgent = {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue(undefined),
            };
            const mockLoginResult = {
                user: mockAdminUser,
                tokens: mockTokens,
            };
            jest.spyOn(adminAuthService, 'loginAdmin').mockResolvedValue(mockLoginResult);
            // Act
            await controller.login(validLoginDto, mockRequestWithoutUserAgent);
            // Assert
            expect(adminAuthService.loginAdmin).toHaveBeenCalledWith(validLoginDto.email, validLoginDto.password, mockRequestWithoutUserAgent.ip, undefined);
        });
        it('should handle invalid credentials', async () => {
            // Arrange
            const authError = new common_1.UnauthorizedException('Invalid credentials');
            jest.spyOn(adminAuthService, 'loginAdmin').mockRejectedValue(authError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(authError);
        });
        it('should handle service errors', async () => {
            // Arrange
            const serviceError = new Error('Database connection failed');
            jest.spyOn(adminAuthService, 'loginAdmin').mockRejectedValue(serviceError);
            // Act & Assert
            await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(serviceError);
        });
    });
    describe('getProfile', () => {
        it('should return admin profile successfully', async () => {
            // Arrange
            jest.spyOn(adminAuthService, 'getAdminProfile').mockResolvedValue(mockAdminUser);
            // Act
            const result = await controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            // Assert
            expect(adminAuthService.getAdminProfile).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockAdminUser);
        });
        it('should handle profile not found', async () => {
            // Arrange
            const notFoundError = new Error('Admin profile not found');
            jest.spyOn(adminAuthService, 'getAdminProfile').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(notFoundError);
        });
    });
    describe('getPermissions', () => {
        const mockPermissions = {
            permissions: ['read', 'write', 'delete'],
            adminLevel: 'admin',
            canCreateAdmins: true,
            canModifyUsers: true,
            canAccessAnalytics: true,
        };
        it('should return admin permissions successfully', async () => {
            // Arrange
            jest.spyOn(adminAuthService, 'getAdminPermissions').mockResolvedValue(mockPermissions);
            // Act
            const result = await controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            // Assert
            expect(adminAuthService.getAdminPermissions).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockPermissions);
        });
        it('should handle permissions not found', async () => {
            // Arrange
            const notFoundError = new Error('Admin permissions not found');
            jest.spyOn(adminAuthService, 'getAdminPermissions').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.getPermissions(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(notFoundError);
        });
    });
    describe('getDashboardStats', () => {
        it('should return dashboard statistics successfully', async () => {
            // Arrange
            jest.spyOn(adminAuthService, 'getAdminDashboardStats').mockResolvedValue(mockDashboardStats);
            // Act
            const result = await controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            // Assert
            expect(adminAuthService.getAdminDashboardStats).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockDashboardStats);
        });
        it('should handle dashboard stats error', async () => {
            // Arrange
            const statsError = new Error('Unable to fetch dashboard statistics');
            jest.spyOn(adminAuthService, 'getAdminDashboardStats').mockRejectedValue(statsError);
            // Act & Assert
            await expect(controller.getDashboardStats(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(statsError);
        });
    });
    describe('Role-based Access Control', () => {
        it('should test role-based access for protected endpoints', async () => {
            // Test that different roles can access appropriate endpoints
            await auth_testing_helpers_1.RoleBasedTestUtils.testWithRoles(async (userId, role) => {
                // Mock the auth guard to return the specific role
                mockJwtAuthGuard.canActivate.mockReturnValue(role === 'admin');
                try {
                    await controller.getProfile(userId);
                    return true;
                }
                catch (error) {
                    return false;
                }
            }, {
                admin: true,
                client: false,
                therapist: false,
                moderator: false,
            });
        });
    });
    describe('Security Tests', () => {
        it('should validate input data through ZodValidationPipe', () => {
            // This tests that the controller uses proper validation
            const validationPipe = new zod_validation_pipe_1.ZodValidationPipe({});
            expect(validationPipe).toBeDefined();
        });
        it('should apply rate limiting through ThrottlerGuard', () => {
            // Test that throttling is configured
            const createAccountMetadata = Reflect.getMetadata('__throttler_options__', controller.createAdminAccount);
            const loginMetadata = Reflect.getMetadata('__throttler_options__', controller.login);
            expect(createAccountMetadata).toBeDefined();
            expect(loginMetadata).toBeDefined();
        });
        it('should require authentication for protected endpoints', () => {
            // Test that protected endpoints have JwtAuthGuard
            const protectedMethods = ['createAdminAccount', 'getProfile', 'getPermissions', 'getDashboardStats'];
            protectedMethods.forEach(method => {
                const guards = Reflect.getMetadata('__guards__', controller[method]);
                expect(guards).toBeDefined();
            });
        });
        it('should allow public access to login endpoint', () => {
            // Test that login endpoint is marked as public
            const publicMetadata = Reflect.getMetadata('isPublic', controller.login);
            expect(publicMetadata).toBeTruthy();
        });
    });
    describe('Error Handling', () => {
        it('should handle network errors gracefully', async () => {
            // Arrange
            const networkError = new Error('Network timeout');
            jest.spyOn(adminAuthService, 'getAdminProfile').mockRejectedValue(networkError);
            // Act & Assert
            await expect(controller.getProfile(auth_testing_helpers_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(networkError);
        });
        it('should handle validation errors', async () => {
            // This would be handled by the ZodValidationPipe
            const invalidData = {
                email: 'invalid-email',
                password: '123', // Too short
                firstName: '',
                lastName: '',
            };
            // In a real scenario, this would throw a validation error
            // The pipe would catch this before it reaches the controller
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete admin creation workflow', async () => {
            // Arrange
            const mockCreatedUser = {
                user: mockAdminUser,
                message: 'Admin account created successfully',
            };
            jest.spyOn(adminAuthService, 'createAdminAccount').mockResolvedValue(mockCreatedUser);
            // Act
            const result = await controller.createAdminAccount('admin', {
                email: 'newadmin@mentara.com',
                password: 'SecurePass123!',
                firstName: 'New',
                lastName: 'Admin',
                adminLevel: 'admin',
                permissions: ['read', 'write'],
            });
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockAdminUser.email);
            expect(result.message).toBe('Admin account created successfully');
        });
        it('should handle complete login workflow', async () => {
            // Arrange
            const mockLoginResult = {
                user: mockAdminUser,
                tokens: mockTokens,
            };
            jest.spyOn(adminAuthService, 'loginAdmin').mockResolvedValue(mockLoginResult);
            // Act
            const result = await controller.login({
                email: auth_testing_helpers_1.TEST_EMAILS.ADMIN,
                password: 'SecurePass123!',
            }, {
                ip: '192.168.1.1',
                get: jest.fn().mockReturnValue('Test User Agent'),
            });
            // Assert
            expect(result).toBeDefined();
            expect(result.user.email).toBe(mockAdminUser.email);
            expect(result.accessToken).toBe(mockTokens.accessToken);
            expect(result.refreshToken).toBe(mockTokens.refreshToken);
            expect(result.expiresIn).toBe(mockTokens.expiresIn);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvY29udHJvbGxlcnMvYWRtaW4tYXV0aC5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQTJFO0FBQzNFLGlEQUFvRTtBQUNwRSxtRUFBOEQ7QUFDOUQsK0VBQTBFO0FBQzFFLDZEQUF3RDtBQUN4RCxnRkFBMkU7QUFDM0UsZ0ZBUStDO0FBRy9DLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxVQUErQixDQUFDO0lBQ3BDLElBQUksZ0JBQWtDLENBQUM7SUFDdkMsSUFBSSxnQkFBMkMsQ0FBQztJQUVoRCxzQkFBc0I7SUFDdEIsTUFBTSxhQUFhLEdBQUc7UUFDcEIsRUFBRSxFQUFFLG9DQUFhLENBQUMsS0FBSztRQUN2QixLQUFLLEVBQUUsa0NBQVcsQ0FBQyxLQUFLO1FBQ3hCLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFFBQVEsRUFBRSxNQUFNO1FBQ2hCLElBQUksRUFBRSxPQUFPO1FBQ2IsYUFBYSxFQUFFLElBQUk7UUFDbkIsVUFBVSxFQUFFLE9BQU87UUFDbkIsV0FBVyxFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUM7UUFDeEMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3JCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtLQUN4QixDQUFDO0lBRUYsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixHQUFHLGFBQWE7UUFDaEIsRUFBRSxFQUFFLGlCQUFpQjtRQUNyQixLQUFLLEVBQUUsbUJBQW1CO1FBQzFCLFVBQVUsRUFBRSxhQUFhO1FBQ3pCLFdBQVcsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLGVBQWUsQ0FBQztLQUMxRCxDQUFDO0lBRUYsTUFBTSxVQUFVLEdBQUc7UUFDakIsV0FBVyxFQUFFLG1CQUFtQjtRQUNoQyxZQUFZLEVB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RUFBRSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQzthQUMzQyxDQUNULENBQUM7WUFFRixTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMxRCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9hdXRoL2NvbnRyb2xsZXJzL2FkbWluLWF1dGguY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgRm9yYmlkZGVuRXhjZXB0aW9uLCBVbmF1dGhvcml6ZWRFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBUaHJvdHRsZXJHdWFyZCwgVGhyb3R0bGVyTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90aHJvdHRsZXInO1xuaW1wb3J0IHsgQWRtaW5BdXRoQ29udHJvbGxlciB9IGZyb20gJy4vYWRtaW4tYXV0aC5jb250cm9sbGVyJztcbmltcG9ydCB7IEFkbWluQXV0aFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hdXRoL2FkbWluLWF1dGguc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICcuLi8uLi9jb21tb24vcGlwZXMvem9kLXZhbGlkYXRpb24ucGlwZSc7XG5pbXBvcnQge1xuICBNb2NrQnVpbGRlcixcbiAgVGVzdERhdGFHZW5lcmF0b3IsXG4gIFRlc3RBc3NlcnRpb25zLFxuICBTZWN1cml0eUd1YXJkVGVzdFV0aWxzLFxuICBSb2xlQmFzZWRUZXN0VXRpbHMsXG4gIFRFU1RfVVNFUl9JRFMsXG4gIFRFU1RfRU1BSUxTLFxufSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2F1dGgtdGVzdGluZy1oZWxwZXJzJztcbmltcG9ydCB7IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscyc7XG5cbmRlc2NyaWJlKCdBZG1pbkF1dGhDb250cm9sbGVyJywgKCkgPT4ge1xuICBsZXQgY29udHJvbGxlcjogQWRtaW5BdXRoQ29udHJvbGxlcjtcbiAgbGV0IGFkbWluQXV0aFNlcnZpY2U6IEFkbWluQXV0aFNlcnZpY2U7XG4gIGxldCBtb2NrSnd0QXV0aEd1YXJkOiBqZXN0Lk1vY2tlZDxKd3RBdXRoR3VhcmQ+O1xuXG4gIC8vIFRlc3QgZGF0YSBjb25zdGFudHNcbiAgY29uc3QgbW9ja0FkbWluVXNlciA9IHtcbiAgICBpZDogVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICBlbWFpbDogVEVTVF9FTUFJTFMuQURNSU4sXG4gICAgZmlyc3ROYW1lOiAnQWRtaW4nLFxuICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgcm9sZTogJ2FkbWluJyxcbiAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgIGFkbWluTGV2ZWw6ICdhZG1pbicsXG4gICAgcGVybWlzc2lvbnM6IFsncmVhZCcsICd3cml0ZScsICdkZWxldGUnXSxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgbGFzdExvZ2luQXQ6IG5ldyBEYXRlKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1N1cGVyQWRtaW5Vc2VyID0ge1xuICAgIC4uLm1vY2tBZG1pblVzZXIsXG4gICAgaWQ6ICdzdXBlci1hZG1pbi0xMjMnLFxuICAgIGVtYWlsOiAnc3VwZXJAbWVudGFyYS5jb20nLFxuICAgIGFkbWluTGV2ZWw6ICdzdXBlcl9hZG1pbicsXG4gICAgcGVybWlzc2lvbnM6IFsncmVhZCcsICd3cml0ZScsICdkZWxldGUnLCAnY3JlYXRlX2FkbWlucyddLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tUb2tlbnMgPSB7XG4gICAgYWNjZXNzVG9rZW46ICdtb2NrLWFjY2Vzcy10b2tlbicsXG4gICAgcmVmcmVzaFRva2VuOiAnbW9jay1yZWZyZXNoLXRva2VuJyxcbiAgICBleHBpcmVzSW46IDM2MDAsXG4gIH07XG5cbiAgY29uc3QgbW9ja0Rhc2hib2FyZFN0YXRzID0ge1xuICAgIHRvdGFsVXNlcnM6IDEwMDAsXG4gICAgdG90YWxUaGVyYXBpc3RzOiAxMDAsXG4gICAgdG90YWxBZG1pbnM6IDUsXG4gICAgYWN0aXZlVXNlcnM6IDc1MCxcbiAgICBwZW5kaW5nQXBwbGljYXRpb25zOiAyNSxcbiAgICBzeXN0ZW1IZWFsdGg6ICdoZWFsdGh5JyxcbiAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDcmVhdGUgbW9jayBzZXJ2aWNlc1xuICAgIGNvbnN0IG1vY2tBZG1pbkF1dGhTZXJ2aWNlID0ge1xuICAgICAgY3JlYXRlQWRtaW5BY2NvdW50OiBqZXN0LmZuKCksXG4gICAgICBsb2dpbkFkbWluOiBqZXN0LmZuKCksXG4gICAgICBnZXRBZG1pblByb2ZpbGU6IGplc3QuZm4oKSxcbiAgICAgIGdldEFkbWluUGVybWlzc2lvbnM6IGplc3QuZm4oKSxcbiAgICAgIGdldEFkbWluRGFzaGJvYXJkU3RhdHM6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgbW9ja0p3dEF1dGhHdWFyZCA9IHtcbiAgICAgIGNhbkFjdGl2YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGltcG9ydHM6IFtcbiAgICAgICAgVGhyb3R0bGVyTW9kdWxlLmZvclJvb3QoW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdzaG9ydCcsXG4gICAgICAgICAgICB0dGw6IDEwMDAsXG4gICAgICAgICAgICBsaW1pdDogMyxcbiAgICAgICAgICB9LFxuICAgICAgICBdKSxcbiAgICAgIF0sXG4gICAgICBjb250cm9sbGVyczogW0FkbWluQXV0aENvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBBZG1pbkF1dGhTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQWRtaW5BdXRoU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgICAgIC5vdmVycmlkZUd1YXJkKEp3dEF1dGhHdWFyZClcbiAgICAgIC51c2VWYWx1ZShtb2NrSnd0QXV0aEd1YXJkKVxuICAgICAgLm92ZXJyaWRlR3VhcmQoVGhyb3R0bGVyR3VhcmQpXG4gICAgICAudXNlVmFsdWUoeyBjYW5BY3RpdmF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSB9KVxuICAgICAgLmNvbXBpbGUoKTtcblxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PEFkbWluQXV0aENvbnRyb2xsZXI+KEFkbWluQXV0aENvbnRyb2xsZXIpO1xuICAgIGFkbWluQXV0aFNlcnZpY2UgPSBtb2R1bGUuZ2V0PEFkbWluQXV0aFNlcnZpY2U+KEFkbWluQXV0aFNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlQWRtaW5BY2NvdW50JywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkUmVnaXN0ZXJEdG8gPSB7XG4gICAgICBlbWFpbDogJ25ld2FkbWluQG1lbnRhcmEuY29tJyxcbiAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgZmlyc3ROYW1lOiAnTmV3JyxcbiAgICAgIGxhc3ROYW1lOiAnQWRtaW4nLFxuICAgICAgYWRtaW5MZXZlbDogJ2FkbWluJyBhcyBjb25zdCxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ3JlYWQnLCAnd3JpdGUnXSBhcyBzdHJpbmdbXSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYWRtaW4gYWNjb3VudCBzdWNjZXNzZnVsbHkgd2hlbiBjYWxsZWQgYnkgYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrQ3JlYXRlZFVzZXIgPSB7XG4gICAgICAgIHVzZXI6IG1vY2tBZG1pblVzZXIsXG4gICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2NyZWF0ZUFkbWluQWNjb3VudCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVkVXNlcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVBZG1pbkFjY291bnQoJ2FkbWluJywgdmFsaWRSZWdpc3RlckR0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UuY3JlYXRlQWRtaW5BY2NvdW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5lbWFpbCxcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5wYXNzd29yZCxcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5maXJzdE5hbWUsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8ubGFzdE5hbWUsXG4gICAgICAgIHZhbGlkUmVnaXN0ZXJEdG8uYWRtaW5MZXZlbCxcbiAgICAgICAgdmFsaWRSZWdpc3RlckR0by5wZXJtaXNzaW9ucyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IG1vY2tBZG1pblVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IG1vY2tBZG1pblVzZXIuZW1haWwsXG4gICAgICAgICAgZmlyc3ROYW1lOiBtb2NrQWRtaW5Vc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbW9ja0FkbWluVXNlci5sYXN0TmFtZSxcbiAgICAgICAgICByb2xlOiBtb2NrQWRtaW5Vc2VyLnJvbGUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogbW9ja0FkbWluVXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlOiBtb2NrQ3JlYXRlZFVzZXIubWVzc2FnZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBGb3JiaWRkZW5FeGNlcHRpb24gd2hlbiBjYWxsZWQgYnkgbm9uLWFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZSAmIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgVGVzdEFzc2VydGlvbnMuZXhwZWN0VG9UaHJvd05lc3RFeGNlcHRpb24oXG4gICAgICAgICgpID0+IGNvbnRyb2xsZXIuY3JlYXRlQWRtaW5BY2NvdW50KCdjbGllbnQnLCB2YWxpZFJlZ2lzdGVyRHRvKSxcbiAgICAgICAgRm9yYmlkZGVuRXhjZXB0aW9uLFxuICAgICAgICAnT25seSBhZG1pbnMgY2FuIGNyZWF0ZSBhZG1pbiBhY2NvdW50cycsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYWRtaW5BdXRoU2VydmljZS5jcmVhdGVBZG1pbkFjY291bnQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHZhbHVlcyB3aGVuIG9wdGlvbmFsIGZpZWxkcyBhcmUgbm90IHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbWluaW1hbFJlZ2lzdGVyRHRvID0ge1xuICAgICAgICBlbWFpbDogJ25ld2FkbWluQG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ05ldycsXG4gICAgICAgIGxhc3ROYW1lOiAnQWRtaW4nLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja0NyZWF0ZWRVc2VyID0ge1xuICAgICAgICB1c2VyOiBtb2NrQWRtaW5Vc2VyLFxuICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdjcmVhdGVBZG1pbkFjY291bnQnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ3JlYXRlZFVzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlQWRtaW5BY2NvdW50KCdhZG1pbicsIG1pbmltYWxSZWdpc3RlckR0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UuY3JlYXRlQWRtaW5BY2NvdW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWluaW1hbFJlZ2lzdGVyRHRvLmVtYWlsLFxuICAgICAgICBtaW5pbWFsUmVnaXN0ZXJEdG8ucGFzc3dvcmQsXG4gICAgICAgIG1pbmltYWxSZWdpc3RlckR0by5maXJzdE5hbWUsXG4gICAgICAgIG1pbmltYWxSZWdpc3RlckR0by5sYXN0TmFtZSxcbiAgICAgICAgJ2FkbWluJywgLy8gRGVmYXVsdCBhZG1pbkxldmVsXG4gICAgICAgIFtdLCAvLyBEZWZhdWx0IHBlcm1pc3Npb25zXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMgYXBwcm9wcmlhdGVseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRW1haWwgYWxyZWFkeSBleGlzdHMnKTtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2NyZWF0ZUFkbWluQWNjb3VudCcpLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlQWRtaW5BY2NvdW50KCdhZG1pbicsIHZhbGlkUmVnaXN0ZXJEdG8pKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvZ2luJywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkTG9naW5EdG8gPSB7XG4gICAgICBlbWFpbDogVEVTVF9FTUFJTFMuQURNSU4sXG4gICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdCBVc2VyIEFnZW50JyksXG4gICAgfSBhcyBhbnk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZ2luIGFkbWluIHN1Y2Nlc3NmdWxseSB3aXRoIHZhbGlkIGNyZWRlbnRpYWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja0xvZ2luUmVzdWx0ID0ge1xuICAgICAgICB1c2VyOiBtb2NrQWRtaW5Vc2VyLFxuICAgICAgICB0b2tlbnM6IG1vY2tUb2tlbnMsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdsb2dpbkFkbWluJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvZ2luUmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmxvZ2luKHZhbGlkTG9naW5EdG8sIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoYWRtaW5BdXRoU2VydmljZS5sb2dpbkFkbWluKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgdmFsaWRMb2dpbkR0by5lbWFpbCxcbiAgICAgICAgdmFsaWRMb2dpbkR0by5wYXNzd29yZCxcbiAgICAgICAgbW9ja1JlcXVlc3QuaXAsXG4gICAgICAgICdUZXN0IFVzZXIgQWdlbnQnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogbW9ja0FkbWluVXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogbW9ja0FkbWluVXNlci5lbWFpbCxcbiAgICAgICAgICBmaXJzdE5hbWU6IG1vY2tBZG1pblVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiBtb2NrQWRtaW5Vc2VyLmxhc3ROYW1lLFxuICAgICAgICAgIHJvbGU6IG1vY2tBZG1pblVzZXIucm9sZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBtb2NrQWRtaW5Vc2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgIH0sXG4gICAgICAgIGFjY2Vzc1Rva2VuOiBtb2NrVG9rZW5zLmFjY2Vzc1Rva2VuLFxuICAgICAgICByZWZyZXNoVG9rZW46IG1vY2tUb2tlbnMucmVmcmVzaFRva2VuLFxuICAgICAgICBleHBpcmVzSW46IG1vY2tUb2tlbnMuZXhwaXJlc0luLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIFVzZXItQWdlbnQgaGVhZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja1JlcXVlc3RXaXRob3V0VXNlckFnZW50ID0ge1xuICAgICAgICBpcDogJzE5Mi4xNjguMS4xJyxcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCksXG4gICAgICB9IGFzIGFueTtcblxuICAgICAgY29uc3QgbW9ja0xvZ2luUmVzdWx0ID0ge1xuICAgICAgICB1c2VyOiBtb2NrQWRtaW5Vc2VyLFxuICAgICAgICB0b2tlbnM6IG1vY2tUb2tlbnMsXG4gICAgICB9O1xuXG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdsb2dpbkFkbWluJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvZ2luUmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBjb250cm9sbGVyLmxvZ2luKHZhbGlkTG9naW5EdG8sIG1vY2tSZXF1ZXN0V2l0aG91dFVzZXJBZ2VudCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UubG9naW5BZG1pbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHZhbGlkTG9naW5EdG8uZW1haWwsXG4gICAgICAgIHZhbGlkTG9naW5EdG8ucGFzc3dvcmQsXG4gICAgICAgIG1vY2tSZXF1ZXN0V2l0aG91dFVzZXJBZ2VudC5pcCxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgY3JlZGVudGlhbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBhdXRoRXJyb3IgPSBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdsb2dpbkFkbWluJykubW9ja1JlamVjdGVkVmFsdWUoYXV0aEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5sb2dpbih2YWxpZExvZ2luRHRvLCBtb2NrUmVxdWVzdCkpLnJlamVjdHMudG9UaHJvdyhhdXRoRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdsb2dpbkFkbWluJykubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5sb2dpbih2YWxpZExvZ2luRHRvLCBtb2NrUmVxdWVzdCkpLnJlamVjdHMudG9UaHJvdyhzZXJ2aWNlRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJvZmlsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhZG1pbiBwcm9maWxlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2dldEFkbWluUHJvZmlsZScpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tBZG1pblVzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShURVNUX1VTRVJfSURTLkFETUlOKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoYWRtaW5BdXRoU2VydmljZS5nZXRBZG1pblByb2ZpbGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuQURNSU4pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQWRtaW5Vc2VyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHByb2ZpbGUgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignQWRtaW4gcHJvZmlsZSBub3QgZm91bmQnKTtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2dldEFkbWluUHJvZmlsZScpLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFByb2ZpbGUoVEVTVF9VU0VSX0lEUy5BRE1JTikpLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFBlcm1pc3Npb25zJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tQZXJtaXNzaW9ucyA9IHtcbiAgICAgIHBlcm1pc3Npb25zOiBbJ3JlYWQnLCAnd3JpdGUnLCAnZGVsZXRlJ10sXG4gICAgICBhZG1pbkxldmVsOiAnYWRtaW4nLFxuICAgICAgY2FuQ3JlYXRlQWRtaW5zOiB0cnVlLFxuICAgICAgY2FuTW9kaWZ5VXNlcnM6IHRydWUsXG4gICAgICBjYW5BY2Nlc3NBbmFseXRpY3M6IHRydWUsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFkbWluIHBlcm1pc3Npb25zIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2dldEFkbWluUGVybWlzc2lvbnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGVybWlzc2lvbnMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UGVybWlzc2lvbnMoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGFkbWluQXV0aFNlcnZpY2UuZ2V0QWRtaW5QZXJtaXNzaW9ucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQZXJtaXNzaW9ucyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwZXJtaXNzaW9ucyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdBZG1pbiBwZXJtaXNzaW9ucyBub3QgZm91bmQnKTtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2dldEFkbWluUGVybWlzc2lvbnMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRQZXJtaXNzaW9ucyhURVNUX1VTRVJfSURTLkFETUlOKSkucmVqZWN0cy50b1Rocm93KG5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0RGFzaGJvYXJkU3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZGFzaGJvYXJkIHN0YXRpc3RpY3Mgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnZ2V0QWRtaW5EYXNoYm9hcmRTdGF0cycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXNoYm9hcmRTdGF0cyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXREYXNoYm9hcmRTdGF0cyhURVNUX1VTRVJfSURTLkFETUlOKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoYWRtaW5BdXRoU2VydmljZS5nZXRBZG1pbkRhc2hib2FyZFN0YXRzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLkFETUlOKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0Rhc2hib2FyZFN0YXRzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhc2hib2FyZCBzdGF0cyBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHN0YXRzRXJyb3IgPSBuZXcgRXJyb3IoJ1VuYWJsZSB0byBmZXRjaCBkYXNoYm9hcmQgc3RhdGlzdGljcycpO1xuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnZ2V0QWRtaW5EYXNoYm9hcmRTdGF0cycpLm1vY2tSZWplY3RlZFZhbHVlKHN0YXRzRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldERhc2hib2FyZFN0YXRzKFRFU1RfVVNFUl9JRFMuQURNSU4pKS5yZWplY3RzLnRvVGhyb3coc3RhdHNFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSb2xlLWJhc2VkIEFjY2VzcyBDb250cm9sJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdGVzdCByb2xlLWJhc2VkIGFjY2VzcyBmb3IgcHJvdGVjdGVkIGVuZHBvaW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBkaWZmZXJlbnQgcm9sZXMgY2FuIGFjY2VzcyBhcHByb3ByaWF0ZSBlbmRwb2ludHNcbiAgICAgIGF3YWl0IFJvbGVCYXNlZFRlc3RVdGlscy50ZXN0V2l0aFJvbGVzKFxuICAgICAgICBhc3luYyAodXNlcklkOiBzdHJpbmcsIHJvbGU6IHN0cmluZykgPT4ge1xuICAgICAgICAgIC8vIE1vY2sgdGhlIGF1dGggZ3VhcmQgdG8gcmV0dXJuIHRoZSBzcGVjaWZpYyByb2xlXG4gICAgICAgICAgbW9ja0p3dEF1dGhHdWFyZC5jYW5BY3RpdmF0ZS5tb2NrUmV0dXJuVmFsdWUocm9sZSA9PT0gJ2FkbWluJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZ2V0UHJvZmlsZSh1c2VySWQpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBhZG1pbjogdHJ1ZSxcbiAgICAgICAgICBjbGllbnQ6IGZhbHNlLFxuICAgICAgICAgIHRoZXJhcGlzdDogZmFsc2UsXG4gICAgICAgICAgbW9kZXJhdG9yOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGlucHV0IGRhdGEgdGhyb3VnaCBab2RWYWxpZGF0aW9uUGlwZScsICgpID0+IHtcbiAgICAgIC8vIFRoaXMgdGVzdHMgdGhhdCB0aGUgY29udHJvbGxlciB1c2VzIHByb3BlciB2YWxpZGF0aW9uXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUGlwZSA9IG5ldyBab2RWYWxpZGF0aW9uUGlwZSh7fSBhcyBhbnkpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRpb25QaXBlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhcHBseSByYXRlIGxpbWl0aW5nIHRocm91Z2ggVGhyb3R0bGVyR3VhcmQnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgdGhyb3R0bGluZyBpcyBjb25maWd1cmVkXG4gICAgICBjb25zdCBjcmVhdGVBY2NvdW50TWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdfX3Rocm90dGxlcl9vcHRpb25zX18nLCBjb250cm9sbGVyLmNyZWF0ZUFkbWluQWNjb3VudCk7XG4gICAgICBjb25zdCBsb2dpbk1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnX190aHJvdHRsZXJfb3B0aW9uc19fJywgY29udHJvbGxlci5sb2dpbik7XG4gICAgICBcbiAgICAgIGV4cGVjdChjcmVhdGVBY2NvdW50TWV0YWRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobG9naW5NZXRhZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiBmb3IgcHJvdGVjdGVkIGVuZHBvaW50cycsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBwcm90ZWN0ZWQgZW5kcG9pbnRzIGhhdmUgSnd0QXV0aEd1YXJkXG4gICAgICBjb25zdCBwcm90ZWN0ZWRNZXRob2RzID0gWydjcmVhdGVBZG1pbkFjY291bnQnLCAnZ2V0UHJvZmlsZScsICdnZXRQZXJtaXNzaW9ucycsICdnZXREYXNoYm9hcmRTdGF0cyddO1xuICAgICAgXG4gICAgICBwcm90ZWN0ZWRNZXRob2RzLmZvckVhY2gobWV0aG9kID0+IHtcbiAgICAgICAgY29uc3QgZ3VhcmRzID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnX19ndWFyZHNfXycsIGNvbnRyb2xsZXJbbWV0aG9kIGFzIGtleW9mIEFkbWluQXV0aENvbnRyb2xsZXJdKTtcbiAgICAgICAgZXhwZWN0KGd1YXJkcykudG9CZURlZmluZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBwdWJsaWMgYWNjZXNzIHRvIGxvZ2luIGVuZHBvaW50JywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IGxvZ2luIGVuZHBvaW50IGlzIG1hcmtlZCBhcyBwdWJsaWNcbiAgICAgIGNvbnN0IHB1YmxpY01ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnaXNQdWJsaWMnLCBjb250cm9sbGVyLmxvZ2luKTtcbiAgICAgIGV4cGVjdChwdWJsaWNNZXRhZGF0YSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbmV0d29yayBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5ldHdvcmtFcnJvciA9IG5ldyBFcnJvcignTmV0d29yayB0aW1lb3V0Jyk7XG4gICAgICBqZXN0LnNweU9uKGFkbWluQXV0aFNlcnZpY2UsICdnZXRBZG1pblByb2ZpbGUnKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXR3b3JrRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFByb2ZpbGUoVEVTVF9VU0VSX0lEUy5BRE1JTikpLnJlamVjdHMudG9UaHJvdyhuZXR3b3JrRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHdvdWxkIGJlIGhhbmRsZWQgYnkgdGhlIFpvZFZhbGlkYXRpb25QaXBlXG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICdpbnZhbGlkLWVtYWlsJyxcbiAgICAgICAgcGFzc3dvcmQ6ICcxMjMnLCAvLyBUb28gc2hvcnRcbiAgICAgICAgZmlyc3ROYW1lOiAnJyxcbiAgICAgICAgbGFzdE5hbWU6ICcnLFxuICAgICAgfTtcblxuICAgICAgLy8gSW4gYSByZWFsIHNjZW5hcmlvLCB0aGlzIHdvdWxkIHRocm93IGEgdmFsaWRhdGlvbiBlcnJvclxuICAgICAgLy8gVGhlIHBpcGUgd291bGQgY2F0Y2ggdGhpcyBiZWZvcmUgaXQgcmVhY2hlcyB0aGUgY29udHJvbGxlclxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgYWRtaW4gY3JlYXRpb24gd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrQ3JlYXRlZFVzZXIgPSB7XG4gICAgICAgIHVzZXI6IG1vY2tBZG1pblVzZXIsXG4gICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH07XG5cbiAgICAgIGplc3Quc3B5T24oYWRtaW5BdXRoU2VydmljZSwgJ2NyZWF0ZUFkbWluQWNjb3VudCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDcmVhdGVkVXNlcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVBZG1pbkFjY291bnQoJ2FkbWluJywge1xuICAgICAgICBlbWFpbDogJ25ld2FkbWluQG1lbnRhcmEuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIGZpcnN0TmFtZTogJ05ldycsXG4gICAgICAgIGxhc3ROYW1lOiAnQWRtaW4nLFxuICAgICAgICBhZG1pbkxldmVsOiAnYWRtaW4nLFxuICAgICAgICBwZXJtaXNzaW9uczogWydyZWFkJywgJ3dyaXRlJ10sXG4gICAgICB9KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLmVtYWlsKS50b0JlKG1vY2tBZG1pblVzZXIuZW1haWwpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0JlKCdBZG1pbiBhY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBsb2dpbiB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tMb2dpblJlc3VsdCA9IHtcbiAgICAgICAgdXNlcjogbW9ja0FkbWluVXNlcixcbiAgICAgICAgdG9rZW5zOiBtb2NrVG9rZW5zLFxuICAgICAgfTtcblxuICAgICAgamVzdC5zcHlPbihhZG1pbkF1dGhTZXJ2aWNlLCAnbG9naW5BZG1pbicpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dpblJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5sb2dpbihcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiBURVNUX0VNQUlMUy5BRE1JTixcbiAgICAgICAgICBwYXNzd29yZDogJ1NlY3VyZVBhc3MxMjMhJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlwOiAnMTkyLjE2OC4xLjEnLFxuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdCBVc2VyIEFnZW50JyksXG4gICAgICAgIH0gYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLmVtYWlsKS50b0JlKG1vY2tBZG1pblVzZXIuZW1haWwpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hY2Nlc3NUb2tlbikudG9CZShtb2NrVG9rZW5zLmFjY2Vzc1Rva2VuKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVmcmVzaFRva2VuKS50b0JlKG1vY2tUb2tlbnMucmVmcmVzaFRva2VuKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXhwaXJlc0luKS50b0JlKG1vY2tUb2tlbnMuZXhwaXJlc0luKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=