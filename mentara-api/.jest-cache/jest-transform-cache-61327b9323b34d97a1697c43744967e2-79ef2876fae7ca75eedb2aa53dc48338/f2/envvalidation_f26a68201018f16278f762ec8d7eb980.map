{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/config/env-validation.ts","mappings":";;AAwCA,oEA8JC;AAED,gDA4BC;AApOD,2CAAwC;AAsCxC,MAAM,MAAM,GAAG,IAAI,eAAM,CAAC,uBAAuB,CAAC,CAAC;AAEnD,SAAgB,4BAA4B;IAC1C,MAAM,YAAY,GAA8B;QAC9C,cAAc;QACd,YAAY;QACZ,UAAU;QACV,kBAAkB;QAClB,sBAAsB;QACtB,qBAAqB;QACrB,yBAAyB;QACzB,cAAc;QACd,kBAAkB;KACnB,CAAC;IAEF,MAAM,WAAW,GAAa,EAAE,CAAC;IACjC,MAAM,WAAW,GAAa,EAAE,CAAC;IAEjC,2BAA2B;IAC3B,KAAK,MAAM,OAAO,IAAI,YAAY,EAAE,CAAC;QACnC,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACnC,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC;YAClC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,4BAA4B;IAC5B,IACE,OAAO,CAAC,GAAG,CAAC,YAAY;QACxB,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,EACrD,CAAC;QACD,WAAW,CAAC,IAAI,CACd,6DAA6D,CAC9D,CAAC;IACJ,CAAC;IAED,IACE,OAAO,CAAC,GAAG,CAAC,QAAQ;QACpB,CAAC,CAAC,aAAa,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EACrE,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,qDAAqD,CAAC,CAAC;IAC1E,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC;QACxD,WAAW,CAAC,IAAI,CAAC,+BAA+B,CAAC,CAAC;IACpD,CAAC;IAED,iEAAiE;IACjE,IACE,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAC5B,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,MAAM,GAAG,EAAE,EACxC,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAC;IACjE,CAAC;IAED,IACE,OAAO,CAAC,GAAG,CAAC,oBAAoB;QAChC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,MAAM,GAAG,EAAE,EAC5C,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,gDAAgD,CAAC,CAAC;IACrE,CAAC;IAED,IACE,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAC/B,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,MAAM,GAAG,EAAE,EAC3C,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,+CAA+C,CAAC,CAAC;IACpE,CAAC;IAED,IACE,OAAO,CAAC,GAAG,CAAC,uBAAuB;QACnC,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,MAAM,GAAG,EAAE,EAC/C,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,mDAAmD,CAAC,CAAC;IACxE,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,GAAG,EAAE,EAAE,CAAC;QACjE,WAAW,CAAC,IAAI,CACd,0DAA0D,CAC3D,CAAC;IACJ,CAAC;IAED,IACE,OAAO,CAAC,GAAG,CAAC,sBAAsB;QAClC,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,MAAM,GAAG,EAAE,EAC9C,CAAC;QACD,WAAW,CAAC,IAAI,CACd,sEAAsE,CACvE,CAAC;IACJ,CAAC;IAED,kCAAkC;IAClC,IACE,OAAO,CAAC,GAAG,CAAC,YAAY;QACxB,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,UAAU,CAAC,UAAU,CAAC,EAChD,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;IAC/D,CAAC;IAED,IACE,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAC5B,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,MAAM,GAAG,EAAE,EACxC,CAAC;QACD,WAAW,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAC;IACjE,CAAC;IAED,4DAA4D;IAC5D,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EAAE,CAAC;QAC1C,MAAM,mBAAmB,GAAG,CAAC,cAAc,EAAE,gBAAgB,CAAC,CAAC;QAC/D,MAAM,eAAe,GAAG,mBAAmB,CAAC,MAAM,CAChD,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CACnC,CAAC;QAEF,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC/B,MAAM,CAAC,IAAI,CACT,4DAA4D,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CACzF,CAAC;QACJ,CAAC;IACH,CAAC;IAED,gBAAgB;IAChB,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACrD,MAAM,MAAM,GAAa,EAAE,CAAC;QAE5B,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC3B,MAAM,CAAC,IAAI,CACT,2CAA2C,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CACpE,CAAC;QACJ,CAAC;QAED,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC3B,MAAM,CAAC,IAAI,CAAC,kCAAkC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAC1E,CAAC;QAED,MAAM,CAAC,KAAK,CAAC,gCAAgC,CAAC,CAAC;QAC/C,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,KAAK,EAAE,CAAC,CAAC,CAAC;QAExD,MAAM,IAAI,KAAK,CAAC,kCAAkC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACzE,CAAC;IAED,MAAM,CAAC,GAAG,CAAC,gDAAgD,CAAC,CAAC;IAE7D,OAAO;QACL,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,YAAa;QACvC,UAAU,EAAE,OAAO,CAAC,GAAG,CAAC,UAAW;QACnC,gBAAgB,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAiB;QAC/C,oBAAoB,EAAE,OAAO,CAAC,GAAG,CAAC,oBAAqB;QACvD,mBAAmB,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAoB;QACrD,uBAAuB,EAAE,OAAO,CAAC,GAAG,CAAC,uBAAwB;QAC7D,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,YAAa;QACvC,gBAAgB,EAAE,OAAO,CAAC,GAAG,CAAC,gBAAiB;QAC/C,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,QAAiD;QACvE,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI;QACtB,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY;QACtC,cAAc,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc;QAC1C,cAAc,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc;QAC1C,sBAAsB,EAAE,OAAO,CAAC,GAAG,CAAC,sBAAsB;QAC1D,mBAAmB,EAAE,OAAO,CAAC,GAAG,CAAC,mBAAmB;QACpD,sBAAsB,EAAE,OAAO,CAAC,GAAG,CAAC,sBAAsB;KAC3D,CAAC;AACJ,CAAC;AAED,SAAgB,kBAAkB;IAChC,MAAM,CAAC,GAAG,CACR,8BAA8B,OAAO,CAAC,GAAG,CAAC,QAAQ,IAAI,SAAS,OAAO,CACvE,CAAC;IACF,MAAM,CAAC,GAAG,CACR,gBAAgB,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,gBAAgB,EAAE,CAC5E,CAAC;IACF,MAAM,CAAC,GAAG,CACR,0BAA0B,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,gBAAgB,EAAE,CACrF,CAAC;IACF,MAAM,CAAC,GAAG,CACR,0BAA0B,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,gBAAgB,EAAE,CACjG,CAAC;IACF,MAAM,CAAC,GAAG,CACR,oBAAoB,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,gBAAgB,EAAE,CACrF,CAAC;IACF,MAAM,CAAC,GAAG,CACR,uBAAuB,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,gBAAgB,EAAE,CAC3F,CAAC;IACF,MAAM,CAAC,GAAG,CACR,oBAAoB,OAAO,CAAC,GAAG,CAAC,YAAY,IAAI,gBAAgB,EAAE,CACnE,CAAC;IACF,MAAM,CAAC,GAAG,CACR,kBAAkB,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI,gBAAgB,EAAE,CACnE,CAAC;IACF,MAAM,CAAC,GAAG,CACR,wBAAwB,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,gBAAgB,EAAE,CACrF,CAAC;AACJ,CAAC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/config/env-validation.ts"],"sourcesContent":["import { Logger } from '@nestjs/common';\n\nexport interface RequiredEnvVars {\n  DATABASE_URL: string;\n  JWT_SECRET: string;\n  NODE_ENV: 'development' | 'production' | 'test';\n  GOOGLE_CLIENT_ID: string;\n  GOOGLE_CLIENT_SECRET: string;\n  MICROSOFT_CLIENT_ID: string;\n  MICROSOFT_CLIENT_SECRET: string;\n  SUPABASE_URL: string;\n  SUPABASE_API_KEY: string;\n  PORT?: string;\n  FRONTEND_URL?: string;\n  AI_SERVICE_URL?: string;\n  JWT_EXPIRES_IN?: string;\n  JWT_REFRESH_EXPIRES_IN?: string;\n  GOOGLE_CALLBACK_URL?: string;\n  MICROSOFT_CALLBACK_URL?: string;\n}\n\nexport interface OptionalEnvVars {\n  REDIS_URL?: string;\n  S3_BUCKET_NAME?: string;\n  AWS_ACCESS_KEY_ID?: string;\n  AWS_SECRET_ACCESS_KEY?: string;\n  AWS_REGION?: string;\n  SMTP_HOST?: string;\n  SMTP_PORT?: string;\n  SMTP_USER?: string;\n  SMTP_PASS?: string;\n  STRIPE_SECRET_KEY?: string;\n  STRIPE_WEBHOOK_SECRET?: string;\n  CLERK_SECRET_KEY?: string;\n  ALLOWED_ORIGINS?: string;\n  TEST_DATABASE_URL?: string;\n}\n\nconst logger = new Logger('EnvironmentValidation');\n\nexport function validateEnvironmentVariables(): RequiredEnvVars {\n  const requiredVars: (keyof RequiredEnvVars)[] = [\n    'DATABASE_URL',\n    'JWT_SECRET',\n    'NODE_ENV',\n    'GOOGLE_CLIENT_ID',\n    'GOOGLE_CLIENT_SECRET',\n    'MICROSOFT_CLIENT_ID',\n    'MICROSOFT_CLIENT_SECRET',\n    'SUPABASE_URL',\n    'SUPABASE_API_KEY',\n  ];\n\n  const missingVars: string[] = [];\n  const invalidVars: string[] = [];\n\n  // Check required variables\n  for (const varName of requiredVars) {\n    const value = process.env[varName];\n    if (!value || value.trim() === '') {\n      missingVars.push(varName);\n    }\n  }\n\n  // Validate specific formats\n  if (\n    process.env.DATABASE_URL &&\n    !process.env.DATABASE_URL.startsWith('postgresql://')\n  ) {\n    invalidVars.push(\n      'DATABASE_URL (must be a valid PostgreSQL connection string)',\n    );\n  }\n\n  if (\n    process.env.NODE_ENV &&\n    !['development', 'production', 'test'].includes(process.env.NODE_ENV)\n  ) {\n    invalidVars.push('NODE_ENV (must be development, production, or test)');\n  }\n\n  if (process.env.PORT && isNaN(Number(process.env.PORT))) {\n    invalidVars.push('PORT (must be a valid number)');\n  }\n\n  // Validate OAuth client IDs (they should be substantial strings)\n  if (\n    process.env.GOOGLE_CLIENT_ID &&\n    process.env.GOOGLE_CLIENT_ID.length < 20\n  ) {\n    invalidVars.push('GOOGLE_CLIENT_ID (appears to be too short)');\n  }\n\n  if (\n    process.env.GOOGLE_CLIENT_SECRET &&\n    process.env.GOOGLE_CLIENT_SECRET.length < 20\n  ) {\n    invalidVars.push('GOOGLE_CLIENT_SECRET (appears to be too short)');\n  }\n\n  if (\n    process.env.MICROSOFT_CLIENT_ID &&\n    process.env.MICROSOFT_CLIENT_ID.length < 20\n  ) {\n    invalidVars.push('MICROSOFT_CLIENT_ID (appears to be too short)');\n  }\n\n  if (\n    process.env.MICROSOFT_CLIENT_SECRET &&\n    process.env.MICROSOFT_CLIENT_SECRET.length < 20\n  ) {\n    invalidVars.push('MICROSOFT_CLIENT_SECRET (appears to be too short)');\n  }\n\n  if (process.env.JWT_SECRET && process.env.JWT_SECRET.length < 32) {\n    invalidVars.push(\n      'JWT_SECRET (must be at least 32 characters for security)',\n    );\n  }\n\n  if (\n    process.env.MESSAGE_ENCRYPTION_KEY &&\n    process.env.MESSAGE_ENCRYPTION_KEY.length < 32\n  ) {\n    invalidVars.push(\n      'MESSAGE_ENCRYPTION_KEY (must be at least 32 characters for security)',\n    );\n  }\n\n  // Validate Supabase configuration\n  if (\n    process.env.SUPABASE_URL &&\n    !process.env.SUPABASE_URL.startsWith('https://')\n  ) {\n    invalidVars.push('SUPABASE_URL (must be a valid HTTPS URL)');\n  }\n\n  if (\n    process.env.SUPABASE_API_KEY &&\n    process.env.SUPABASE_API_KEY.length < 20\n  ) {\n    invalidVars.push('SUPABASE_API_KEY (appears to be too short)');\n  }\n\n  // Log warnings for missing optional variables in production\n  if (process.env.NODE_ENV === 'production') {\n    const recommendedProdVars = ['FRONTEND_URL', 'AI_SERVICE_URL'];\n    const missingProdVars = recommendedProdVars.filter(\n      (varName) => !process.env[varName],\n    );\n\n    if (missingProdVars.length > 0) {\n      logger.warn(\n        `Recommended environment variables missing in production: ${missingProdVars.join(', ')}`,\n      );\n    }\n  }\n\n  // Report errors\n  if (missingVars.length > 0 || invalidVars.length > 0) {\n    const errors: string[] = [];\n\n    if (missingVars.length > 0) {\n      errors.push(\n        `Missing required environment variables: ${missingVars.join(', ')}`,\n      );\n    }\n\n    if (invalidVars.length > 0) {\n      errors.push(`Invalid environment variables: ${invalidVars.join(', ')}`);\n    }\n\n    logger.error('Environment validation failed:');\n    errors.forEach((error) => logger.error(`  - ${error}`));\n\n    throw new Error(`Environment validation failed: ${errors.join('; ')}`);\n  }\n\n  logger.log('‚úÖ Environment variables validated successfully');\n\n  return {\n    DATABASE_URL: process.env.DATABASE_URL!,\n    JWT_SECRET: process.env.JWT_SECRET!,\n    GOOGLE_CLIENT_ID: process.env.GOOGLE_CLIENT_ID!,\n    GOOGLE_CLIENT_SECRET: process.env.GOOGLE_CLIENT_SECRET!,\n    MICROSOFT_CLIENT_ID: process.env.MICROSOFT_CLIENT_ID!,\n    MICROSOFT_CLIENT_SECRET: process.env.MICROSOFT_CLIENT_SECRET!,\n    SUPABASE_URL: process.env.SUPABASE_URL!,\n    SUPABASE_API_KEY: process.env.SUPABASE_API_KEY!,\n    NODE_ENV: process.env.NODE_ENV as 'development' | 'production' | 'test',\n    PORT: process.env.PORT,\n    FRONTEND_URL: process.env.FRONTEND_URL,\n    AI_SERVICE_URL: process.env.AI_SERVICE_URL,\n    JWT_EXPIRES_IN: process.env.JWT_EXPIRES_IN,\n    JWT_REFRESH_EXPIRES_IN: process.env.JWT_REFRESH_EXPIRES_IN,\n    GOOGLE_CALLBACK_URL: process.env.GOOGLE_CALLBACK_URL,\n    MICROSOFT_CALLBACK_URL: process.env.MICROSOFT_CALLBACK_URL,\n  };\n}\n\nexport function logEnvironmentInfo(): void {\n  logger.log(\n    `üöÄ Starting application in ${process.env.NODE_ENV || 'unknown'} mode`,\n  );\n  logger.log(\n    `üìä Database: ${process.env.DATABASE_URL ? 'Connected' : 'Not configured'}`,\n  );\n  logger.log(\n    `üîë JWT Authentication: ${process.env.JWT_SECRET ? 'Configured' : 'Not configured'}`,\n  );\n  logger.log(\n    `üîê Message Encryption: ${process.env.MESSAGE_ENCRYPTION_KEY ? 'Configured' : 'Not configured'}`,\n  );\n  logger.log(\n    `üîê Google OAuth: ${process.env.GOOGLE_CLIENT_ID ? 'Configured' : 'Not configured'}`,\n  );\n  logger.log(\n    `üîê Microsoft OAuth: ${process.env.MICROSOFT_CLIENT_ID ? 'Configured' : 'Not configured'}`,\n  );\n  logger.log(\n    `üåê Frontend URL: ${process.env.FRONTEND_URL || 'Not configured'}`,\n  );\n  logger.log(\n    `ü§ñ AI Service: ${process.env.AI_SERVICE_URL || 'Not configured'}`,\n  );\n  logger.log(\n    `‚òÅÔ∏è Supabase Storage: ${process.env.SUPABASE_URL ? 'Configured' : 'Not configured'}`,\n  );\n}\n"],"version":3}