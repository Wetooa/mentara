eca0f89c60a564d5a93eede475f14aa2
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("src/providers/prisma-client.provider");
// Remove unused imports - these DTOs don't exist in mentara-commons
const event_bus_service_1 = require("../common/events/event-bus.service");
const user_events_1 = require("../common/events/user-events");
const token_service_1 = require("./services/token.service");
const email_verification_service_1 = require("./services/email-verification.service");
const password_reset_service_1 = require("./services/password-reset.service");
let AuthService = class AuthService {
    prisma;
    eventBus;
    tokenService;
    emailVerificationService;
    passwordResetService;
    constructor(prisma, eventBus, tokenService, emailVerificationService, passwordResetService) {
        this.prisma = prisma;
        this.eventBus = eventBus;
        this.tokenService = tokenService;
        this.emailVerificationService = emailVerificationService;
        this.passwordResetService = passwordResetService;
    }
    async registerClient(email, password, firstName, lastName, additionalData) {
        try {
            // Use the existing local registration method
            const { user } = await this.registerUserWithEmail(email, password, firstName, lastName, 'client', additionalData);
            // Generate tokens for immediate login after registration
            const tokens = await this.tokenService.generateTokenPair(user.id, user.email, user.role);
            return {
                user,
                tokens,
                message: 'Client registered successfully. Please check your email to verify your account.',
            };
        }
        catch (error) {
            console.error('Client registration error:', error instanceof Error ? error.message : error);
            if (error instanceof common_1.ConflictException) {
                throw error;
            }
            throw new common_1.InternalServerErrorException('Client registration failed');
        }
    }
    async registerTherapist(email, password, firstName, lastName, additionalData) {
        try {
            // Use the existing local registration method
            const { user } = await this.registerUserWithEmail(email, password, firstName, lastName, 'therapist', additionalData);
            // Generate tokens for immediate login after registration
            const tokens = await this.tokenService.generateTokenPair(user.id, user.email, user.role);
            return {
                user,
                tokens,
                message: 'Therapist registered successfully. Please check your email to verify your account. Your application is pending approval.',
            };
        }
        catch (error) {
            console.error('Therapist registration error:', error instanceof Error ? error.message : error);
            if (error instanceof common_1.ConflictException) {
                throw error;
            }
            throw new common_1.InternalServerErrorException('Therapist registration failed');
        }
    }
    async getUsers() {
        return this.prisma.user.findMany({
            where: {
                deactivatedAt: null,
            },
            select: {
                id: true,
                email: true,
                firstName: true,
                lastName: true,
                role: true,
                emailVerified: true,
                createdAt: true,
                updatedAt: true,
                client: {
                    select: {
                        userId: true,
                    },
                },
                therapist: {
                    select: {
                        userId: true,
                        status: true,
                    },
                },
            },
            orderBy: {
                createdAt: 'desc',
            },
        });
    }
    async getUser(userId) {
        const user = await this.prisma.user.findUnique({
            where: {
                id: userId,
                deactivatedAt: null,
            },
            select: {
                id: true,
                email: true,
                firstName: true,
                lastName: true,
                role: true,
                emailVerified: true,
                createdAt: true,
                updatedAt: true,
                client: {
                    select: {
                        userId: true,
                    },
                },
                therapist: {
                    select: {
                        userId: true,
                        status: true,
                    },
                },
            },
        });
        if (!user) {
            throw new common_1.UnauthorizedException('User not found');
        }
        return user;
    }
    async forceLogout(userId) {
        try {
            // Revoke all JWT refresh tokens for the user
            await this.tokenService.revokeAllUserTokens(userId);
            return { success: true, message: 'User sessions revoked successfully' };
        }
        catch (error) {
            console.error('Force logout error:', error instanceof Error ? error.message : error);
            throw new common_1.InternalServerErrorException('Force logout failed');
        }
    }
    /**
     * Check if a user exists by email
     * @param email - User's email address
     * @returns Object containing user existence status, role, and verification status
     */
    async checkUserExists(email) {
        try {
            const user = await this.prisma.user.findUnique({
                where: { email },
                select: {
                    id: true,
                    email: true,
                    role: true,
                    emailVerified: true,
                    isActive: true,
                },
            });
            if (!user) {
                return { exists: false };
            }
            // Only return user info if account is active
            if (!user.isActive) {
                return { exists: false };
            }
            return {
                exists: true,
                role: user.role,
                isVerified: user.emailVerified,
            };
        }
        catch (error) {
            console.error('Error checking user existence:', error);
            // Return false for any database errors to prevent information leakage
            return { exists: false };
        }
    }
    // Local Authentication Methods
    async registerUserWithEmail(email, password, firstName, lastName, role = 'client', additionalData) {
        // Check if user already exists
        const existingUser = await this.prisma.user.findUnique({
            where: { email },
        });
        if (existingUser) {
            throw new common_1.ConflictException('User with this email already exists');
        }
        // Hash password
        const hashedPassword = await this.tokenService.hashPassword(password);
        // Generate email verification token
        const { hashedToken, expiresAt } = await this.tokenService.generateEmailVerificationToken();
        // Create user
        const userData = {
            email,
            password: hashedPassword,
            firstName,
            lastName,
            role,
            emailVerifyToken: hashedToken,
            emailVerifyTokenExp: expiresAt,
            ...additionalData,
        };
        const user = await this.prisma.user.create({
            data: userData,
            select: {
                id: true,
                email: true,
                firstName: true,
                lastName: true,
                role: true,
                emailVerified: true,
            },
        });
        // Create role-specific record
        if (role === 'client') {
            await this.prisma.client.create({
                data: { userId: user.id },
            });
        }
        else if (role === 'therapist') {
            await this.prisma.therapist.create({
                data: {
                    userId: user.id,
                    status: 'pending',
                    mobile: '',
                    province: '',
                    providerType: '',
                    professionalLicenseType: '',
                    isPRCLicensed: '',
                    prcLicenseNumber: '',
                    expirationDateOfLicense: new Date(),
                    practiceStartDate: new Date(),
                    sessionLength: '60 minutes', // Default
                    hourlyRate: 0,
                    providedOnlineTherapyBefore: false,
                    comfortableUsingVideoConferencing: false,
                    compliesWithDataPrivacyAct: false,
                    willingToAbideByPlatformGuidelines: false,
                    treatmentSuccessRates: {},
                },
            });
        }
        // Send verification email
        await this.emailVerificationService.sendVerificationEmail(user.id);
        // Publish registration event
        await this.eventBus.emit(new user_events_1.UserRegisteredEvent({
            userId: user.id,
            email: user.email,
            firstName: user.firstName,
            lastName: user.lastName,
            role,
            registrationMethod: 'email',
        }));
        return {
            user,
            message: 'User registered successfully. Please check your email to verify your account.',
        };
    }
    async loginWithEmail(email, password, ipAddress, userAgent) {
        const user = await this.prisma.user.findUnique({
            where: { email },
            select: {
                id: true,
                email: true,
                firstName: true,
                lastName: true,
                role: true,
                password: true,
                emailVerified: true,
                deactivatedAt: true,
                lockoutUntil: true,
                failedLoginCount: true,
                client: true,
                therapist: true,
            },
        });
        if (!user) {
            throw new common_1.UnauthorizedException('Invalid credentials');
        }
        if (user.deactivatedAt) {
            throw new common_1.UnauthorizedException('Account has been deactivated');
        }
        if (!user.password) {
            throw new common_1.UnauthorizedException('Please complete account setup or reset your password');
        }
        // Check account lockout
        const isLockedOut = await this.tokenService.checkAccountLockout(user.id);
        if (isLockedOut) {
            throw new common_1.UnauthorizedException('Account is temporarily locked due to too many failed login attempts');
        }
        // Verify password
        const isPasswordValid = await this.tokenService.comparePassword(password, user.password);
        if (!isPasswordValid) {
            await this.tokenService.handleFailedLogin(user.id);
            throw new common_1.UnauthorizedException('Invalid credentials');
        }
        // Check email verification
        if (!user.emailVerified) {
            throw new common_1.UnauthorizedException('Please verify your email address before logging in');
        }
        // Reset failed login count and update last login
        await this.tokenService.resetFailedLoginCount(user.id);
        // Generate tokens
        const tokens = await this.tokenService.generateTokenPair(user.id, user.email, user.role, ipAddress, userAgent);
        // Remove sensitive data from user object
        const { password: _, lockoutUntil: __, failedLoginCount: ___, ...safeUser } = user;
        return { user: safeUser, tokens };
    }
    async refreshTokens(refreshToken, ipAddress, userAgent) {
        return this.tokenService.refreshAccessToken(refreshToken, ipAddress, userAgent);
    }
    async logout(refreshToken) {
        await this.tokenService.revokeRefreshToken(refreshToken);
    }
    async validateUser(userId) {
        return this.prisma.user.findUnique({
            where: {
                id: userId,
                deactivatedAt: null,
            },
            select: {
                id: true,
                email: true,
                firstName: true,
                lastName: true,
                role: true,
                client: true,
                therapist: true,
            },
        });
    }
    /**
     * Validates a JWT token and returns user information
     * @param token - The JWT token to validate
     * @returns Promise with validation result and user data
     */
    /**
     * Validates a JWT token and returns user information
     * @param token - The JWT token to validate
     * @returns Promise with validation result and user data
     */
    async validateToken(token) {
        try {
            // Validate token using TokenService
            const tokenValidation = await this.tokenService.validateToken(token);
            if (!tokenValidation.valid) {
                return {
                    valid: false,
                    error: tokenValidation.error,
                };
            }
            // Get user information from the token payload
            const payload = tokenValidation.payload;
            const userId = payload.sub;
            // Fetch user from database to ensure they still exist and are active
            const user = await this.prisma.user.findUnique({
                where: {
                    id: userId,
                    deactivatedAt: null, // Ensure user is not deactivated
                },
                select: {
                    id: true,
                    email: true,
                    firstName: true,
                    lastName: true,
                    role: true,
                    emailVerified: true,
                    client: {
                        select: {
                            userId: true,
                        },
                    },
                    therapist: {
                        select: {
                            userId: true,
                            status: true,
                        },
                    },
                },
            });
            if (!user) {
                return {
                    valid: false,
                    error: 'User not found or deactivated',
                };
            }
            // Verify role matches token
            if (user.role !== payload.role) {
                return {
                    valid: false,
                    error: 'Role mismatch - token invalid',
                };
            }
            // Structure user data based on role
            let roleSpecificUser;
            if (user.role === 'client') {
                roleSpecificUser = {
                    id: user.id,
                    email: user.email,
                    firstName: user.firstName,
                    lastName: user.lastName,
                    role: user.role,
                    emailVerified: user.emailVerified,
                    isOnboardingComplete: false, // Default for now
                    profile: {
                        userId: user.id,
                        isOnboardingComplete: false, // Default for now
                    },
                };
            }
            else if (user.role === 'therapist') {
                roleSpecificUser = {
                    id: user.id,
                    email: user.email,
                    firstName: user.firstName,
                    lastName: user.lastName,
                    role: user.role,
                    emailVerified: user.emailVerified,
                    status: user.therapist?.status || 'pending',
                    profile: {
                        userId: user.id,
                        status: user.therapist?.status || 'pending',
                    },
                };
            }
            else {
                // For admin/moderator roles, return basic user info
                roleSpecificUser = {
                    id: user.id,
                    email: user.email,
                    firstName: user.firstName,
                    lastName: user.lastName,
                    role: user.role,
                    emailVerified: user.emailVerified,
                };
            }
            return {
                valid: true,
                user: roleSpecificUser,
                expires: tokenValidation.expires,
            };
        }
        catch (error) {
            console.error('Token validation error:', error);
            return {
                valid: false,
                error: 'Token validation failed',
            };
        }
    }
    // Email verification methods
    async verifyEmail(token) {
        return this.emailVerificationService.verifyEmail(token);
    }
    async resendVerificationEmail(email) {
        return this.emailVerificationService.resendVerificationEmail(email);
    }
    // Password reset methods
    async requestPasswordReset(email) {
        return this.passwordResetService.requestPasswordReset(email);
    }
    async resetPassword(token, newPassword) {
        return this.passwordResetService.resetPassword(token, newPassword);
    }
    async validateResetToken(token) {
        return this.passwordResetService.validateResetToken(token);
    }
    // Account management methods
    async changePassword(userId, currentPassword, newPassword) {
        const user = await this.prisma.user.findUnique({
            where: { id: userId },
            select: { password: true, deactivatedAt: true },
        });
        if (!user || user.deactivatedAt) {
            throw new common_1.UnauthorizedException('User not found or deactivated');
        }
        if (!user.password) {
            throw new common_1.BadRequestException('Please complete account setup first');
        }
        // Verify current password
        const isCurrentPasswordValid = await this.tokenService.comparePassword(currentPassword, user.password);
        if (!isCurrentPasswordValid) {
            throw new common_1.UnauthorizedException('Current password is incorrect');
        }
        // Check if new password is different
        const isSamePassword = await this.tokenService.comparePassword(newPassword, user.password);
        if (isSamePassword) {
            throw new common_1.BadRequestException('New password must be different from current password');
        }
        // Hash new password
        const hashedPassword = await this.tokenService.hashPassword(newPassword);
        // Update password
        await this.prisma.user.update({
            where: { id: userId },
            data: { password: hashedPassword },
        });
        // Revoke all refresh tokens for security
        await this.tokenService.revokeAllUserTokens(userId);
        return {
            success: true,
            message: 'Password changed successfully. Please log in again.',
        };
    }
    async deactivateAccount(userId, reason, deactivatedBy) {
        await this.prisma.user.update({
            where: { id: userId },
            data: {
                deactivatedAt: new Date(),
                deactivatedBy,
                deactivationReason: reason,
            },
        });
        // Revoke all tokens
        await this.tokenService.revokeAllUserTokens(userId);
        return {
            success: true,
            message: 'Account deactivated successfully',
        };
    }
    async reactivateAccount(userId) {
        await this.prisma.user.update({
            where: { id: userId },
            data: {
                deactivatedAt: null,
                deactivatedBy: null,
                deactivationReason: null,
                failedLoginCount: 0,
                lockoutUntil: null,
            },
        });
        return {
            success: true,
            message: 'Account reactivated successfully',
        };
    }
    async handleOAuthLogin(oauthUser, provider, role = 'client') {
        try {
            // Check if user exists
            const existingUser = await this.prisma.user.findUnique({
                where: { email: oauthUser.email },
                include: {
                    client: true,
                    therapist: true,
                },
            });
            if (existingUser) {
                // User exists, generate tokens and return
                const tokens = await this.tokenService.generateTokenPair(existingUser.id, existingUser.email, existingUser.role);
                return {
                    user: {
                        id: existingUser.id,
                        email: existingUser.email,
                        firstName: existingUser.firstName,
                        lastName: existingUser.lastName,
                        role: existingUser.role,
                        emailVerified: existingUser.emailVerified,
                    },
                    accessToken: tokens.accessToken,
                    refreshToken: tokens.refreshToken,
                    expiresIn: tokens.expiresIn,
                    message: 'Login successful',
                };
            }
            else {
                // Validate role for new user creation
                const validRole = ['client', 'therapist'].includes(role)
                    ? role
                    : 'client';
                // Create new user from OAuth data
                const newUser = await this.prisma.user.create({
                    data: {
                        email: oauthUser.email,
                        firstName: oauthUser.firstName,
                        lastName: oauthUser.lastName,
                        role: validRole,
                        emailVerified: true, // OAuth emails are pre-verified
                        avatarUrl: oauthUser.picture,
                    },
                    select: {
                        id: true,
                        email: true,
                        firstName: true,
                        lastName: true,
                        role: true,
                        emailVerified: true,
                    },
                });
                // Create role-specific record for new user
                if (validRole === 'client') {
                    await this.prisma.client.create({
                        data: { userId: newUser.id },
                    });
                }
                else if (validRole === 'therapist') {
                    await this.prisma.therapist.create({
                        data: {
                            userId: newUser.id,
                            status: 'pending',
                            mobile: '',
                            province: '',
                            providerType: '',
                            professionalLicenseType: '',
                            isPRCLicensed: '',
                            prcLicenseNumber: '',
                            expirationDateOfLicense: new Date(),
                            practiceStartDate: new Date(),
                            sessionLength: '60 minutes', // Default
                            hourlyRate: 0,
                            providedOnlineTherapyBefore: false,
                            comfortableUsingVideoConferencing: false,
                            compliesWithDataPrivacyAct: false,
                            willingToAbideByPlatformGuidelines: false,
                            treatmentSuccessRates: {},
                        },
                    });
                }
                const tokens = await this.tokenService.generateTokenPair(newUser.id, newUser.email, newUser.role);
                // Emit user registration event
                this.eventBus.emit(new user_events_1.UserRegisteredEvent({
                    userId: newUser.id,
                    email: newUser.email,
                    firstName: newUser.firstName,
                    lastName: newUser.lastName,
                    role: newUser.role,
                    registrationMethod: 'oauth',
                }));
                return {
                    user: newUser,
                    accessToken: tokens.accessToken,
                    refreshToken: tokens.refreshToken,
                    expiresIn: tokens.expiresIn,
                    message: 'Account created successfully',
                };
            }
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(`OAuth login failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    // ===== FIRST-TIME USER FLOW METHODS =====
    async getFirstSignInStatus(userId) {
        const client = await this.prisma.client.findUnique({
            where: { userId },
            select: {
                hasSeenTherapistRecommendations: true,
                createdAt: true,
            },
        });
        if (!client) {
            throw new common_1.UnauthorizedException('Client profile not found');
        }
        return {
            isFirstTime: !client.hasSeenTherapistRecommendations,
            needsWelcomeFlow: !client.hasSeenTherapistRecommendations,
            memberSince: client.createdAt,
        };
    }
    async markRecommendationsSeen(userId) {
        const updatedClient = await this.prisma.client.update({
            where: { userId },
            data: { hasSeenTherapistRecommendations: true },
            select: {
                hasSeenTherapistRecommendations: true,
                updatedAt: true,
            },
        });
        return {
            success: true,
            hasSeenRecommendations: updatedClient.hasSeenTherapistRecommendations,
            markedAt: updatedClient.updatedAt,
            message: 'Recommendations marked as seen successfully',
        };
    }
    // ===== SESSION MANAGEMENT METHODS =====
    /**
     * Get current session information
     */
    async getSessionInfo(refreshToken) {
        const sessionInfo = await this.tokenService.getSessionInfo(refreshToken);
        if (!sessionInfo) {
            throw new common_1.UnauthorizedException('Session not found or expired');
        }
        return sessionInfo;
    }
    /**
     * Get all active sessions for a user
     */
    async getActiveSessions(userId, currentRefreshToken) {
        return await this.tokenService.getActiveSessions(userId, currentRefreshToken);
    }
    /**
     * Terminate a specific session
     */
    async terminateSession(sessionId, userId) {
        return await this.tokenService.terminateSession(sessionId, userId);
    }
    /**
     * Terminate all other sessions except the current one
     */
    async terminateOtherSessions(userId, currentRefreshToken) {
        return await this.tokenService.terminateOtherSessions(userId, currentRefreshToken);
    }
    /**
     * Universal logout - clears all sessions for user
     */
    async universalLogout(userId) {
        // Revoke all refresh tokens for the user
        await this.tokenService.revokeAllUserTokens(userId);
        return {
            success: true,
            message: 'All sessions terminated successfully',
        };
    }
};
exports.AuthService = AuthService;
exports.AuthService = AuthService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof event_bus_service_1.EventBusService !== "undefined" && event_bus_service_1.EventBusService) === "function" ? _b : Object, typeof (_c = typeof token_service_1.TokenService !== "undefined" && token_service_1.TokenService) === "function" ? _c : Object, typeof (_d = typeof email_verification_service_1.EmailVerificationService !== "undefined" && email_verification_service_1.EmailVerificationService) === "function" ? _d : Object, typeof (_e = typeof password_reset_service_1.PasswordResetService !== "undefined" && password_reset_service_1.PasswordResetService) === "function" ? _e : Object])
], AuthService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvYXV0aC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FNd0I7QUFDeEIsaUZBQXFFO0FBQ3JFLG9FQUFvRTtBQUNwRSwwRUFBcUU7QUFDckUsOERBQW1FO0FBQ25FLDREQUFtRTtBQUNuRSxzRkFBaUY7QUFDakYsOEVBQXlFO0FBR2xFLElBQU0sV0FBVyxHQUFqQixNQUFNLFdBQVc7SUFFSDtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBTG5CLFlBQ21CLE1BQXFCLEVBQ3JCLFFBQXlCLEVBQ3pCLFlBQTBCLEVBQzFCLHdCQUFrRCxFQUNsRCxvQkFBMEM7UUFKMUMsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQUN6QixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQiw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7SUFDMUQsQ0FBQztJQUVKLEtBQUssQ0FBQyxjQUFjLENBQ2xCLEtBQWEsRUFDYixRQUFnQixFQUNoQixTQUFpQixFQUNqQixRQUFnQixFQUNoQixjQUFvQjtRQUVwQixJQUFJLENBQUM7WUFDSCw2Q0FBNkM7WUFDN0MsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLHFCQUFxQixDQUMvQyxLQUFLLEVBQ0wsUUFBUSxFQUNSLFNBQVMsRUFDVCxRQUFRLEVBQ1IsUUFBUSxFQUNSLGNBQWMsQ0FDZixDQUFDO1lBRUYseURBQXlEO1lBQ3pELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FDdEQsSUFBSSxDQUFDLEVBQUUsRUFDUCxJQUFJLENBQUMsS0FBSyxFQUNWLElBQUksQ0FBQyxJQUFJLENBQ1YsQ0FBQztZQUVGLE9BQU87Z0JBQ0wsSUFBSTtnQkFDSixNQUFNO2dC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QyxlQUFlLENBQUMsTUFBYztRQUNsQyx5Q0FBeUM7UUFDekMsTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXBELE9BQU87WUFDTCxPQUFPLEVBQUUsSUFBSTtZQUNiLE9BQU8sRUFBRSxzQ0FBc0M7U0FDaEQsQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFBO0FBMzVCWSxrQ0FBVztzQkFBWCxXQUFXO0lBRHZCLElBQUEsbUJBQVUsR0FBRTt5REFHZ0Isc0NBQWEsb0JBQWIsc0NBQWEsb0RBQ1gsbUNBQWUsb0JBQWYsbUNBQWUsb0RBQ1gsNEJBQVksb0JBQVosNEJBQVksb0RBQ0EscURBQXdCLG9CQUF4QixxREFBd0Isb0RBQzVCLDZDQUFvQixvQkFBcEIsNkNBQW9CO0dBTmxELFdBQVcsQ0EyNUJ2QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYXV0aC9hdXRoLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29uZmxpY3RFeGNlcHRpb24sXG4gIEluamVjdGFibGUsXG4gIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gIFVuYXV0aG9yaXplZEV4Y2VwdGlvbixcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJ3NyYy9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG4vLyBSZW1vdmUgdW51c2VkIGltcG9ydHMgLSB0aGVzZSBEVE9zIGRvbid0IGV4aXN0IGluIG1lbnRhcmEtY29tbW9uc1xuaW1wb3J0IHsgRXZlbnRCdXNTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL2V2ZW50cy9ldmVudC1idXMuc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyUmVnaXN0ZXJlZEV2ZW50IH0gZnJvbSAnLi4vY29tbW9uL2V2ZW50cy91c2VyLWV2ZW50cyc7XG5pbXBvcnQgeyBUb2tlblNlcnZpY2UsIFRva2VuUGFpciB9IGZyb20gJy4vc2VydmljZXMvdG9rZW4uc2VydmljZSc7XG5pbXBvcnQgeyBFbWFpbFZlcmlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2VtYWlsLXZlcmlmaWNhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IFBhc3N3b3JkUmVzZXRTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wYXNzd29yZC1yZXNldC5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBldmVudEJ1czogRXZlbnRCdXNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgdG9rZW5TZXJ2aWNlOiBUb2tlblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBlbWFpbFZlcmlmaWNhdGlvblNlcnZpY2U6IEVtYWlsVmVyaWZpY2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBhc3N3b3JkUmVzZXRTZXJ2aWNlOiBQYXNzd29yZFJlc2V0U2VydmljZSxcbiAgKSB7fVxuXG4gIGFzeW5jIHJlZ2lzdGVyQ2xpZW50KFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgICBmaXJzdE5hbWU6IHN0cmluZyxcbiAgICBsYXN0TmFtZTogc3RyaW5nLFxuICAgIGFkZGl0aW9uYWxEYXRhPzogYW55LFxuICApOiBQcm9taXNlPHsgdXNlcjogYW55OyB0b2tlbnM6IFRva2VuUGFpcjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXNlIHRoZSBleGlzdGluZyBsb2NhbCByZWdpc3RyYXRpb24gbWV0aG9kXG4gICAgICBjb25zdCB7IHVzZXIgfSA9IGF3YWl0IHRoaXMucmVnaXN0ZXJVc2VyV2l0aEVtYWlsKFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgIGZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWUsXG4gICAgICAgICdjbGllbnQnLFxuICAgICAgICBhZGRpdGlvbmFsRGF0YSxcbiAgICAgICk7XG5cbiAgICAgIC8vIEdlbmVyYXRlIHRva2VucyBmb3IgaW1tZWRpYXRlIGxvZ2luIGFmdGVyIHJlZ2lzdHJhdGlvblxuICAgICAgY29uc3QgdG9rZW5zID0gYXdhaXQgdGhpcy50b2tlblNlcnZpY2UuZ2VuZXJhdGVUb2tlblBhaXIoXG4gICAgICAgIHVzZXIuaWQsXG4gICAgICAgIHVzZXIuZW1haWwsXG4gICAgICAgIHVzZXIucm9sZSxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVzZXIsXG4gICAgICAgIHRva2VucyxcbiAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAnQ2xpZW50IHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5LiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbCB0byB2ZXJpZnkgeW91ciBhY2NvdW50LicsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAnQ2xpZW50IHJlZ2lzdHJhdGlvbiBlcnJvcjonLFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IGVycm9yLFxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENvbmZsaWN0RXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oJ0NsaWVudCByZWdpc3RyYXRpb24gZmFpbGVkJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVnaXN0ZXJUaGVyYXBpc3QoXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICBwYXNzd29yZDogc3RyaW5nLFxuICAgIGZpcnN0TmFtZTogc3RyaW5nLFxuICAgIGxhc3ROYW1lOiBzdHJpbmcsXG4gICAgYWRkaXRpb25hbERhdGE/OiBhbnksXG4gICk6IFByb21pc2U8eyB1c2VyOiBhbnk7IHRva2VuczogVG9rZW5QYWlyOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgdGhlIGV4aXN0aW5nIGxvY2FsIHJlZ2lzdHJhdGlvbiBtZXRob2RcbiAgICAgIGNvbnN0IHsgdXNlciB9ID0gYXdhaXQgdGhpcy5yZWdpc3RlclVzZXJXaXRoRW1haWwoXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBwYXNzd29yZCxcbiAgICAgICAgZmlyc3ROYW1lLFxuICAgICAgICBsYXN0TmFtZSxcbiAgICAgICAgJ3RoZXJhcGlzdCcsXG4gICAgICAgIGFkZGl0aW9uYWxEYXRhLFxuICAgICAgKTtcblxuICAgICAgLy8gR2VuZXJhdGUgdG9rZW5zIGZvciBpbW1lZGlhdGUgbG9naW4gYWZ0ZXIgcmVnaXN0cmF0aW9uXG4gICAgICBjb25zdCB0b2tlbnMgPSBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5nZW5lcmF0ZVRva2VuUGFpcihcbiAgICAgICAgdXNlci5pZCxcbiAgICAgICAgdXNlci5lbWFpbCxcbiAgICAgICAgdXNlci5yb2xlLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcixcbiAgICAgICAgdG9rZW5zLFxuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdUaGVyYXBpc3QgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHkuIFBsZWFzZSBjaGVjayB5b3VyIGVtYWlsIHRvIHZlcmlmeSB5b3VyIGFjY291bnQuIFlvdXIgYXBwbGljYXRpb24gaXMgcGVuZGluZyBhcHByb3ZhbC4nLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgJ1RoZXJhcGlzdCByZWdpc3RyYXRpb24gZXJyb3I6JyxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvcixcbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBDb25mbGljdEV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKCdUaGVyYXBpc3QgcmVnaXN0cmF0aW9uIGZhaWxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFVzZXJzKCkge1xuICAgIHJldHVybiB0aGlzLnByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGRlYWN0aXZhdGVkQXQ6IG51bGwsXG4gICAgICB9LFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIGlkOiB0cnVlLFxuICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICB1cGRhdGVkQXQ6IHRydWUsXG4gICAgICAgIGNsaWVudDoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgdXNlcklkOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRoZXJhcGlzdDoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgdXNlcklkOiB0cnVlLFxuICAgICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgb3JkZXJCeToge1xuICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRVc2VyKHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICBkZWFjdGl2YXRlZEF0OiBudWxsLFxuICAgICAgfSxcbiAgICAgIHNlbGVjdDoge1xuICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgdXBkYXRlZEF0OiB0cnVlLFxuICAgICAgICBjbGllbnQ6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdXNlcjtcbiAgfVxuXG4gIGFzeW5jIGZvcmNlTG9nb3V0KHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJldm9rZSBhbGwgSldUIHJlZnJlc2ggdG9rZW5zIGZvciB0aGUgdXNlclxuICAgICAgYXdhaXQgdGhpcy50b2tlblNlcnZpY2UucmV2b2tlQWxsVXNlclRva2Vucyh1c2VySWQpO1xuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnVXNlciBzZXNzaW9ucyByZXZva2VkIHN1Y2Nlc3NmdWxseScgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgJ0ZvcmNlIGxvZ291dCBlcnJvcjonLFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IGVycm9yLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKCdGb3JjZSBsb2dvdXQgZmFpbGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGEgdXNlciBleGlzdHMgYnkgZW1haWxcbiAgICogQHBhcmFtIGVtYWlsIC0gVXNlcidzIGVtYWlsIGFkZHJlc3NcbiAgICogQHJldHVybnMgT2JqZWN0IGNvbnRhaW5pbmcgdXNlciBleGlzdGVuY2Ugc3RhdHVzLCByb2xlLCBhbmQgdmVyaWZpY2F0aW9uIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgY2hlY2tVc2VyRXhpc3RzKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgICBleGlzdHM6IGJvb2xlYW47XG4gICAgcm9sZT86IHN0cmluZztcbiAgICBpc1ZlcmlmaWVkPzogYm9vbGVhbjtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgZW1haWwgfSxcbiAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4geyBleGlzdHM6IGZhbHNlIH07XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgcmV0dXJuIHVzZXIgaW5mbyBpZiBhY2NvdW50IGlzIGFjdGl2ZVxuICAgICAgaWYgKCF1c2VyLmlzQWN0aXZlKSB7XG4gICAgICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXhpc3RzOiB0cnVlLFxuICAgICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgIGlzVmVyaWZpZWQ6IHVzZXIuZW1haWxWZXJpZmllZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIHVzZXIgZXhpc3RlbmNlOicsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBmYWxzZSBmb3IgYW55IGRhdGFiYXNlIGVycm9ycyB0byBwcmV2ZW50IGluZm9ybWF0aW9uIGxlYWthZ2VcbiAgICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UgfTtcbiAgICB9XG4gIH1cblxuICAvLyBMb2NhbCBBdXRoZW50aWNhdGlvbiBNZXRob2RzXG4gIGFzeW5jIHJlZ2lzdGVyVXNlcldpdGhFbWFpbChcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIHBhc3N3b3JkOiBzdHJpbmcsXG4gICAgZmlyc3ROYW1lOiBzdHJpbmcsXG4gICAgbGFzdE5hbWU6IHN0cmluZyxcbiAgICByb2xlOiAnY2xpZW50JyB8ICd0aGVyYXBpc3QnID0gJ2NsaWVudCcsXG4gICAgYWRkaXRpb25hbERhdGE/OiBhbnksXG4gICk6IFByb21pc2U8eyB1c2VyOiBhbnk7IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBlbWFpbCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgdGhyb3cgbmV3IENvbmZsaWN0RXhjZXB0aW9uKCdVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cycpO1xuICAgIH1cblxuICAgIC8vIEhhc2ggcGFzc3dvcmRcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLmhhc2hQYXNzd29yZChwYXNzd29yZCk7XG5cbiAgICAvLyBHZW5lcmF0ZSBlbWFpbCB2ZXJpZmljYXRpb24gdG9rZW5cbiAgICBjb25zdCB7IGhhc2hlZFRva2VuLCBleHBpcmVzQXQgfSA9XG4gICAgICBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5nZW5lcmF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4oKTtcblxuICAgIC8vIENyZWF0ZSB1c2VyXG4gICAgY29uc3QgdXNlckRhdGEgPSB7XG4gICAgICBlbWFpbCxcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgIGZpcnN0TmFtZSxcbiAgICAgIGxhc3ROYW1lLFxuICAgICAgcm9sZSxcbiAgICAgIGVtYWlsVmVyaWZ5VG9rZW46IGhhc2hlZFRva2VuLFxuICAgICAgZW1haWxWZXJpZnlUb2tlbkV4cDogZXhwaXJlc0F0LFxuICAgICAgLi4uYWRkaXRpb25hbERhdGEsXG4gICAgfTtcblxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB1c2VyRGF0YSxcbiAgICAgIHNlbGVjdDoge1xuICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIHJvbGUtc3BlY2lmaWMgcmVjb3JkXG4gICAgaWYgKHJvbGUgPT09ICdjbGllbnQnKSB7XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5jbGllbnQuY3JlYXRlKHtcbiAgICAgICAgZGF0YTogeyB1c2VySWQ6IHVzZXIuaWQgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAocm9sZSA9PT0gJ3RoZXJhcGlzdCcpIHtcbiAgICAgIGF3YWl0IHRoaXMucHJpc21hLnRoZXJhcGlzdC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICAgIG1vYmlsZTogJycsXG4gICAgICAgICAgcHJvdmluY2U6ICcnLFxuICAgICAgICAgIHByb3ZpZGVyVHlwZTogJycsXG4gICAgICAgICAgcHJvZmVzc2lvbmFsTGljZW5zZVR5cGU6ICcnLFxuICAgICAgICAgIGlzUFJDTGljZW5zZWQ6ICcnLFxuICAgICAgICAgIHByY0xpY2Vuc2VOdW1iZXI6ICcnLFxuICAgICAgICAgIGV4cGlyYXRpb25EYXRlT2ZMaWNlbnNlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHByYWN0aWNlU3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHNlc3Npb25MZW5ndGg6ICc2MCBtaW51dGVzJywgLy8gRGVmYXVsdFxuICAgICAgICAgIGhvdXJseVJhdGU6IDAsXG4gICAgICAgICAgcHJvdmlkZWRPbmxpbmVUaGVyYXB5QmVmb3JlOiBmYWxzZSxcbiAgICAgICAgICBjb21mb3J0YWJsZVVzaW5nVmlkZW9Db25mZXJlbmNpbmc6IGZhbHNlLFxuICAgICAgICAgIGNvbXBsaWVzV2l0aERhdGFQcml2YWN5QWN0OiBmYWxzZSxcbiAgICAgICAgICB3aWxsaW5nVG9BYmlkZUJ5UGxhdGZvcm1HdWlkZWxpbmVzOiBmYWxzZSxcbiAgICAgICAgICB0cmVhdG1lbnRTdWNjZXNzUmF0ZXM6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU2VuZCB2ZXJpZmljYXRpb24gZW1haWxcbiAgICBhd2FpdCB0aGlzLmVtYWlsVmVyaWZpY2F0aW9uU2VydmljZS5zZW5kVmVyaWZpY2F0aW9uRW1haWwodXNlci5pZCk7XG5cbiAgICAvLyBQdWJsaXNoIHJlZ2lzdHJhdGlvbiBldmVudFxuICAgIGF3YWl0IHRoaXMuZXZlbnRCdXMuZW1pdChcbiAgICAgIG5ldyBVc2VyUmVnaXN0ZXJlZEV2ZW50KHtcbiAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHVzZXIubGFzdE5hbWUsXG4gICAgICAgIHJvbGUsXG4gICAgICAgIHJlZ2lzdHJhdGlvbk1ldGhvZDogJ2VtYWlsJyxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcixcbiAgICAgIG1lc3NhZ2U6XG4gICAgICAgICdVc2VyIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5LiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbCB0byB2ZXJpZnkgeW91ciBhY2NvdW50LicsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGxvZ2luV2l0aEVtYWlsKFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgICBpcEFkZHJlc3M/OiBzdHJpbmcsXG4gICAgdXNlckFnZW50Pzogc3RyaW5nLFxuICApOiBQcm9taXNlPHsgdXNlcjogYW55OyB0b2tlbnM6IFRva2VuUGFpciB9PiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBlbWFpbCB9LFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIGlkOiB0cnVlLFxuICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgcGFzc3dvcmQ6IHRydWUsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgIGRlYWN0aXZhdGVkQXQ6IHRydWUsXG4gICAgICAgIGxvY2tvdXRVbnRpbDogdHJ1ZSxcbiAgICAgICAgZmFpbGVkTG9naW5Db3VudDogdHJ1ZSxcbiAgICAgICAgY2xpZW50OiB0cnVlLFxuICAgICAgICB0aGVyYXBpc3Q6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgfVxuXG4gICAgaWYgKHVzZXIuZGVhY3RpdmF0ZWRBdCkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignQWNjb3VudCBoYXMgYmVlbiBkZWFjdGl2YXRlZCcpO1xuICAgIH1cblxuICAgIGlmICghdXNlci5wYXNzd29yZCkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcbiAgICAgICAgJ1BsZWFzZSBjb21wbGV0ZSBhY2NvdW50IHNldHVwIG9yIHJlc2V0IHlvdXIgcGFzc3dvcmQnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBhY2NvdW50IGxvY2tvdXRcbiAgICBjb25zdCBpc0xvY2tlZE91dCA9IGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLmNoZWNrQWNjb3VudExvY2tvdXQodXNlci5pZCk7XG4gICAgaWYgKGlzTG9ja2VkT3V0KSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFxuICAgICAgICAnQWNjb3VudCBpcyB0ZW1wb3JhcmlseSBsb2NrZWQgZHVlIHRvIHRvbyBtYW55IGZhaWxlZCBsb2dpbiBhdHRlbXB0cycsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZlcmlmeSBwYXNzd29yZFxuICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLmNvbXBhcmVQYXNzd29yZChcbiAgICAgIHBhc3N3b3JkLFxuICAgICAgdXNlci5wYXNzd29yZCxcbiAgICApO1xuICAgIGlmICghaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5oYW5kbGVGYWlsZWRMb2dpbih1c2VyLmlkKTtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oJ0ludmFsaWQgY3JlZGVudGlhbHMnKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBlbWFpbCB2ZXJpZmljYXRpb25cbiAgICBpZiAoIXVzZXIuZW1haWxWZXJpZmllZCkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcbiAgICAgICAgJ1BsZWFzZSB2ZXJpZnkgeW91ciBlbWFpbCBhZGRyZXNzIGJlZm9yZSBsb2dnaW5nIGluJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgZmFpbGVkIGxvZ2luIGNvdW50IGFuZCB1cGRhdGUgbGFzdCBsb2dpblxuICAgIGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLnJlc2V0RmFpbGVkTG9naW5Db3VudCh1c2VyLmlkKTtcblxuICAgIC8vIEdlbmVyYXRlIHRva2Vuc1xuICAgIGNvbnN0IHRva2VucyA9IGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLmdlbmVyYXRlVG9rZW5QYWlyKFxuICAgICAgdXNlci5pZCxcbiAgICAgIHVzZXIuZW1haWwsXG4gICAgICB1c2VyLnJvbGUsXG4gICAgICBpcEFkZHJlc3MsXG4gICAgICB1c2VyQWdlbnQsXG4gICAgKTtcblxuICAgIC8vIFJlbW92ZSBzZW5zaXRpdmUgZGF0YSBmcm9tIHVzZXIgb2JqZWN0XG4gICAgY29uc3Qge1xuICAgICAgcGFzc3dvcmQ6IF8sXG4gICAgICBsb2Nrb3V0VW50aWw6IF9fLFxuICAgICAgZmFpbGVkTG9naW5Db3VudDogX19fLFxuICAgICAgLi4uc2FmZVVzZXJcbiAgICB9ID0gdXNlcjtcblxuICAgIHJldHVybiB7IHVzZXI6IHNhZmVVc2VyLCB0b2tlbnMgfTtcbiAgfVxuXG4gIGFzeW5jIHJlZnJlc2hUb2tlbnMoXG4gICAgcmVmcmVzaFRva2VuOiBzdHJpbmcsXG4gICAgaXBBZGRyZXNzPzogc3RyaW5nLFxuICAgIHVzZXJBZ2VudD86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxUb2tlblBhaXI+IHtcbiAgICByZXR1cm4gdGhpcy50b2tlblNlcnZpY2UucmVmcmVzaEFjY2Vzc1Rva2VuKFxuICAgICAgcmVmcmVzaFRva2VuLFxuICAgICAgaXBBZGRyZXNzLFxuICAgICAgdXNlckFnZW50LFxuICAgICk7XG4gIH1cblxuICBhc3luYyBsb2dvdXQocmVmcmVzaFRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5yZXZva2VSZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKTtcbiAgfVxuXG4gIGFzeW5jIHZhbGlkYXRlVXNlcih1c2VySWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgZGVhY3RpdmF0ZWRBdDogbnVsbCxcbiAgICAgIH0sXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICBjbGllbnQ6IHRydWUsXG4gICAgICAgIHRoZXJhcGlzdDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGVzIGEgSldUIHRva2VuIGFuZCByZXR1cm5zIHVzZXIgaW5mb3JtYXRpb25cbiAgICogQHBhcmFtIHRva2VuIC0gVGhlIEpXVCB0b2tlbiB0byB2YWxpZGF0ZVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggdmFsaWRhdGlvbiByZXN1bHQgYW5kIHVzZXIgZGF0YVxuICAgKi9cbiAgLyoqXG4gICAqIFZhbGlkYXRlcyBhIEpXVCB0b2tlbiBhbmQgcmV0dXJucyB1c2VyIGluZm9ybWF0aW9uXG4gICAqIEBwYXJhbSB0b2tlbiAtIFRoZSBKV1QgdG9rZW4gdG8gdmFsaWRhdGVcbiAgICogQHJldHVybnMgUHJvbWlzZSB3aXRoIHZhbGlkYXRpb24gcmVzdWx0IGFuZCB1c2VyIGRhdGFcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlVG9rZW4odG9rZW46IHN0cmluZyk6IFByb21pc2U8e1xuICAgIHZhbGlkOiBib29sZWFuO1xuICAgIHVzZXI/OiBhbnk7XG4gICAgZXhwaXJlcz86IHN0cmluZztcbiAgICBlcnJvcj86IHN0cmluZztcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBWYWxpZGF0ZSB0b2tlbiB1c2luZyBUb2tlblNlcnZpY2VcbiAgICAgIGNvbnN0IHRva2VuVmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLnZhbGlkYXRlVG9rZW4odG9rZW4pO1xuXG4gICAgICBpZiAoIXRva2VuVmFsaWRhdGlvbi52YWxpZCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogdG9rZW5WYWxpZGF0aW9uLmVycm9yLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdXNlciBpbmZvcm1hdGlvbiBmcm9tIHRoZSB0b2tlbiBwYXlsb2FkXG4gICAgICBjb25zdCBwYXlsb2FkID0gdG9rZW5WYWxpZGF0aW9uLnBheWxvYWQ7XG4gICAgICBjb25zdCB1c2VySWQgPSBwYXlsb2FkLnN1YjtcblxuICAgICAgLy8gRmV0Y2ggdXNlciBmcm9tIGRhdGFiYXNlIHRvIGVuc3VyZSB0aGV5IHN0aWxsIGV4aXN0IGFuZCBhcmUgYWN0aXZlXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICAgIGRlYWN0aXZhdGVkQXQ6IG51bGwsIC8vIEVuc3VyZSB1c2VyIGlzIG5vdCBkZWFjdGl2YXRlZFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIGNsaWVudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICB1c2VySWQ6IHRydWUsXG4gICAgICAgICAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdVc2VyIG5vdCBmb3VuZCBvciBkZWFjdGl2YXRlZCcsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmeSByb2xlIG1hdGNoZXMgdG9rZW5cbiAgICAgIGlmICh1c2VyLnJvbGUgIT09IHBheWxvYWQucm9sZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1JvbGUgbWlzbWF0Y2ggLSB0b2tlbiBpbnZhbGlkJyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RydWN0dXJlIHVzZXIgZGF0YSBiYXNlZCBvbiByb2xlXG4gICAgICBsZXQgcm9sZVNwZWNpZmljVXNlcjtcblxuICAgICAgaWYgKHVzZXIucm9sZSA9PT0gJ2NsaWVudCcpIHtcbiAgICAgICAgcm9sZVNwZWNpZmljVXNlciA9IHtcbiAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICBmaXJzdE5hbWU6IHVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgaXNPbmJvYXJkaW5nQ29tcGxldGU6IGZhbHNlLCAvLyBEZWZhdWx0IGZvciBub3dcbiAgICAgICAgICBwcm9maWxlOiB7XG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICAgICAgICBpc09uYm9hcmRpbmdDb21wbGV0ZTogZmFsc2UsIC8vIERlZmF1bHQgZm9yIG5vd1xuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKHVzZXIucm9sZSA9PT0gJ3RoZXJhcGlzdCcpIHtcbiAgICAgICAgcm9sZVNwZWNpZmljVXNlciA9IHtcbiAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICBmaXJzdE5hbWU6IHVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB1c2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgc3RhdHVzOiB1c2VyLnRoZXJhcGlzdD8uc3RhdHVzIHx8ICdwZW5kaW5nJyxcbiAgICAgICAgICBwcm9maWxlOiB7XG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICAgICAgICBzdGF0dXM6IHVzZXIudGhlcmFwaXN0Py5zdGF0dXMgfHwgJ3BlbmRpbmcnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3IgYWRtaW4vbW9kZXJhdG9yIHJvbGVzLCByZXR1cm4gYmFzaWMgdXNlciBpbmZvXG4gICAgICAgIHJvbGVTcGVjaWZpY1VzZXIgPSB7XG4gICAgICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogdXNlci5sYXN0TmFtZSxcbiAgICAgICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdXNlci5lbWFpbFZlcmlmaWVkLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgdXNlcjogcm9sZVNwZWNpZmljVXNlcixcbiAgICAgICAgZXhwaXJlczogdG9rZW5WYWxpZGF0aW9uLmV4cGlyZXMsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdUb2tlbiB2YWxpZGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdUb2tlbiB2YWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIEVtYWlsIHZlcmlmaWNhdGlvbiBtZXRob2RzXG4gIGFzeW5jIHZlcmlmeUVtYWlsKFxuICAgIHRva2VuOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHJldHVybiB0aGlzLmVtYWlsVmVyaWZpY2F0aW9uU2VydmljZS52ZXJpZnlFbWFpbCh0b2tlbik7XG4gIH1cblxuICBhc3luYyByZXNlbmRWZXJpZmljYXRpb25FbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuZW1haWxWZXJpZmljYXRpb25TZXJ2aWNlLnJlc2VuZFZlcmlmaWNhdGlvbkVtYWlsKGVtYWlsKTtcbiAgfVxuXG4gIC8vIFBhc3N3b3JkIHJlc2V0IG1ldGhvZHNcbiAgYXN5bmMgcmVxdWVzdFBhc3N3b3JkUmVzZXQoZW1haWw6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLnBhc3N3b3JkUmVzZXRTZXJ2aWNlLnJlcXVlc3RQYXNzd29yZFJlc2V0KGVtYWlsKTtcbiAgfVxuXG4gIGFzeW5jIHJlc2V0UGFzc3dvcmQoXG4gICAgdG9rZW46IHN0cmluZyxcbiAgICBuZXdQYXNzd29yZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICByZXR1cm4gdGhpcy5wYXNzd29yZFJlc2V0U2VydmljZS5yZXNldFBhc3N3b3JkKHRva2VuLCBuZXdQYXNzd29yZCk7XG4gIH1cblxuICBhc3luYyB2YWxpZGF0ZVJlc2V0VG9rZW4oXG4gICAgdG9rZW46IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IHZhbGlkOiBib29sZWFuOyBlbWFpbD86IHN0cmluZyB9PiB7XG4gICAgcmV0dXJuIHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UudmFsaWRhdGVSZXNldFRva2VuKHRva2VuKTtcbiAgfVxuXG4gIC8vIEFjY291bnQgbWFuYWdlbWVudCBtZXRob2RzXG4gIGFzeW5jIGNoYW5nZVBhc3N3b3JkKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGN1cnJlbnRQYXNzd29yZDogc3RyaW5nLFxuICAgIG5ld1Bhc3N3b3JkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgc2VsZWN0OiB7IHBhc3N3b3JkOiB0cnVlLCBkZWFjdGl2YXRlZEF0OiB0cnVlIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXIgfHwgdXNlci5kZWFjdGl2YXRlZEF0KSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCBvciBkZWFjdGl2YXRlZCcpO1xuICAgIH1cblxuICAgIGlmICghdXNlci5wYXNzd29yZCkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1BsZWFzZSBjb21wbGV0ZSBhY2NvdW50IHNldHVwIGZpcnN0Jyk7XG4gICAgfVxuXG4gICAgLy8gVmVyaWZ5IGN1cnJlbnQgcGFzc3dvcmRcbiAgICBjb25zdCBpc0N1cnJlbnRQYXNzd29yZFZhbGlkID0gYXdhaXQgdGhpcy50b2tlblNlcnZpY2UuY29tcGFyZVBhc3N3b3JkKFxuICAgICAgY3VycmVudFBhc3N3b3JkLFxuICAgICAgdXNlci5wYXNzd29yZCxcbiAgICApO1xuICAgIGlmICghaXNDdXJyZW50UGFzc3dvcmRWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbignQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBuZXcgcGFzc3dvcmQgaXMgZGlmZmVyZW50XG4gICAgY29uc3QgaXNTYW1lUGFzc3dvcmQgPSBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5jb21wYXJlUGFzc3dvcmQoXG4gICAgICBuZXdQYXNzd29yZCxcbiAgICAgIHVzZXIucGFzc3dvcmQsXG4gICAgKTtcbiAgICBpZiAoaXNTYW1lUGFzc3dvcmQpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICAnTmV3IHBhc3N3b3JkIG11c3QgYmUgZGlmZmVyZW50IGZyb20gY3VycmVudCBwYXNzd29yZCcsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEhhc2ggbmV3IHBhc3N3b3JkXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5oYXNoUGFzc3dvcmQobmV3UGFzc3dvcmQpO1xuXG4gICAgLy8gVXBkYXRlIHBhc3N3b3JkXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEudXNlci51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgZGF0YTogeyBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQgfSxcbiAgICB9KTtcblxuICAgIC8vIFJldm9rZSBhbGwgcmVmcmVzaCB0b2tlbnMgZm9yIHNlY3VyaXR5XG4gICAgYXdhaXQgdGhpcy50b2tlblNlcnZpY2UucmV2b2tlQWxsVXNlclRva2Vucyh1c2VySWQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnUGFzc3dvcmQgY2hhbmdlZCBzdWNjZXNzZnVsbHkuIFBsZWFzZSBsb2cgaW4gYWdhaW4uJyxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZGVhY3RpdmF0ZUFjY291bnQoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgcmVhc29uPzogc3RyaW5nLFxuICAgIGRlYWN0aXZhdGVkQnk/OiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLnVzZXIudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZGVhY3RpdmF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgZGVhY3RpdmF0ZWRCeSxcbiAgICAgICAgZGVhY3RpdmF0aW9uUmVhc29uOiByZWFzb24sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gUmV2b2tlIGFsbCB0b2tlbnNcbiAgICBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5yZXZva2VBbGxVc2VyVG9rZW5zKHVzZXJJZCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdBY2NvdW50IGRlYWN0aXZhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIHJlYWN0aXZhdGVBY2NvdW50KFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS51c2VyLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGRlYWN0aXZhdGVkQXQ6IG51bGwsXG4gICAgICAgIGRlYWN0aXZhdGVkQnk6IG51bGwsXG4gICAgICAgIGRlYWN0aXZhdGlvblJlYXNvbjogbnVsbCxcbiAgICAgICAgZmFpbGVkTG9naW5Db3VudDogMCxcbiAgICAgICAgbG9ja291dFVudGlsOiBudWxsLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0FjY291bnQgcmVhY3RpdmF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgaGFuZGxlT0F1dGhMb2dpbihcbiAgICBvYXV0aFVzZXI6IGFueSxcbiAgICBwcm92aWRlcjogc3RyaW5nLFxuICAgIHJvbGU6IHN0cmluZyA9ICdjbGllbnQnLFxuICApIHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBleGlzdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGVtYWlsOiBvYXV0aFVzZXIuZW1haWwgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGNsaWVudDogdHJ1ZSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgICAvLyBVc2VyIGV4aXN0cywgZ2VuZXJhdGUgdG9rZW5zIGFuZCByZXR1cm5cbiAgICAgICAgY29uc3QgdG9rZW5zID0gYXdhaXQgdGhpcy50b2tlblNlcnZpY2UuZ2VuZXJhdGVUb2tlblBhaXIoXG4gICAgICAgICAgZXhpc3RpbmdVc2VyLmlkLFxuICAgICAgICAgIGV4aXN0aW5nVXNlci5lbWFpbCxcbiAgICAgICAgICBleGlzdGluZ1VzZXIucm9sZSxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIGlkOiBleGlzdGluZ1VzZXIuaWQsXG4gICAgICAgICAgICBlbWFpbDogZXhpc3RpbmdVc2VyLmVtYWlsLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiBleGlzdGluZ1VzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWU6IGV4aXN0aW5nVXNlci5sYXN0TmFtZSxcbiAgICAgICAgICAgIHJvbGU6IGV4aXN0aW5nVXNlci5yb2xlLFxuICAgICAgICAgICAgZW1haWxWZXJpZmllZDogZXhpc3RpbmdVc2VyLmVtYWlsVmVyaWZpZWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY2Nlc3NUb2tlbjogdG9rZW5zLmFjY2Vzc1Rva2VuLFxuICAgICAgICAgIHJlZnJlc2hUb2tlbjogdG9rZW5zLnJlZnJlc2hUb2tlbixcbiAgICAgICAgICBleHBpcmVzSW46IHRva2Vucy5leHBpcmVzSW4sXG4gICAgICAgICAgbWVzc2FnZTogJ0xvZ2luIHN1Y2Nlc3NmdWwnLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVmFsaWRhdGUgcm9sZSBmb3IgbmV3IHVzZXIgY3JlYXRpb25cbiAgICAgICAgY29uc3QgdmFsaWRSb2xlID0gWydjbGllbnQnLCAndGhlcmFwaXN0J10uaW5jbHVkZXMocm9sZSlcbiAgICAgICAgICA/IHJvbGVcbiAgICAgICAgICA6ICdjbGllbnQnO1xuXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgdXNlciBmcm9tIE9BdXRoIGRhdGFcbiAgICAgICAgY29uc3QgbmV3VXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBlbWFpbDogb2F1dGhVc2VyLmVtYWlsLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiBvYXV0aFVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWU6IG9hdXRoVXNlci5sYXN0TmFtZSxcbiAgICAgICAgICAgIHJvbGU6IHZhbGlkUm9sZSxcbiAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsIC8vIE9BdXRoIGVtYWlscyBhcmUgcHJlLXZlcmlmaWVkXG4gICAgICAgICAgICBhdmF0YXJVcmw6IG9hdXRoVXNlci5waWN0dXJlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgcm9sZS1zcGVjaWZpYyByZWNvcmQgZm9yIG5ldyB1c2VyXG4gICAgICAgIGlmICh2YWxpZFJvbGUgPT09ICdjbGllbnQnKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuY2xpZW50LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7IHVzZXJJZDogbmV3VXNlci5pZCB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbGlkUm9sZSA9PT0gJ3RoZXJhcGlzdCcpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgICAgICAgbW9iaWxlOiAnJyxcbiAgICAgICAgICAgICAgcHJvdmluY2U6ICcnLFxuICAgICAgICAgICAgICBwcm92aWRlclR5cGU6ICcnLFxuICAgICAgICAgICAgICBwcm9mZXNzaW9uYWxMaWNlbnNlVHlwZTogJycsXG4gICAgICAgICAgICAgIGlzUFJDTGljZW5zZWQ6ICcnLFxuICAgICAgICAgICAgICBwcmNMaWNlbnNlTnVtYmVyOiAnJyxcbiAgICAgICAgICAgICAgZXhwaXJhdGlvbkRhdGVPZkxpY2Vuc2U6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgIHByYWN0aWNlU3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICBzZXNzaW9uTGVuZ3RoOiAnNjAgbWludXRlcycsIC8vIERlZmF1bHRcbiAgICAgICAgICAgICAgaG91cmx5UmF0ZTogMCxcbiAgICAgICAgICAgICAgcHJvdmlkZWRPbmxpbmVUaGVyYXB5QmVmb3JlOiBmYWxzZSxcbiAgICAgICAgICAgICAgY29tZm9ydGFibGVVc2luZ1ZpZGVvQ29uZmVyZW5jaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgY29tcGxpZXNXaXRoRGF0YVByaXZhY3lBY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICB3aWxsaW5nVG9BYmlkZUJ5UGxhdGZvcm1HdWlkZWxpbmVzOiBmYWxzZSxcbiAgICAgICAgICAgICAgdHJlYXRtZW50U3VjY2Vzc1JhdGVzOiB7fSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0b2tlbnMgPSBhd2FpdCB0aGlzLnRva2VuU2VydmljZS5nZW5lcmF0ZVRva2VuUGFpcihcbiAgICAgICAgICBuZXdVc2VyLmlkLFxuICAgICAgICAgIG5ld1VzZXIuZW1haWwsXG4gICAgICAgICAgbmV3VXNlci5yb2xlLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEVtaXQgdXNlciByZWdpc3RyYXRpb24gZXZlbnRcbiAgICAgICAgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgICAgIG5ldyBVc2VyUmVnaXN0ZXJlZEV2ZW50KHtcbiAgICAgICAgICAgIHVzZXJJZDogbmV3VXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsOiBuZXdVc2VyLmVtYWlsLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiBuZXdVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiBuZXdVc2VyLmxhc3ROYW1lLFxuICAgICAgICAgICAgcm9sZTogbmV3VXNlci5yb2xlIGFzXG4gICAgICAgICAgICAgIHwgJ2NsaWVudCdcbiAgICAgICAgICAgICAgfCAndGhlcmFwaXN0J1xuICAgICAgICAgICAgICB8ICdtb2RlcmF0b3InXG4gICAgICAgICAgICAgIHwgJ2FkbWluJyxcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbk1ldGhvZDogJ29hdXRoJyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHVzZXI6IG5ld1VzZXIsXG4gICAgICAgICAgYWNjZXNzVG9rZW46IHRva2Vucy5hY2Nlc3NUb2tlbixcbiAgICAgICAgICByZWZyZXNoVG9rZW46IHRva2Vucy5yZWZyZXNoVG9rZW4sXG4gICAgICAgICAgZXhwaXJlc0luOiB0b2tlbnMuZXhwaXJlc0luLFxuICAgICAgICAgIG1lc3NhZ2U6ICdBY2NvdW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGBPQXV0aCBsb2dpbiBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT0gRklSU1QtVElNRSBVU0VSIEZMT1cgTUVUSE9EUyA9PT09PVxuXG4gIGFzeW5jIGdldEZpcnN0U2lnbkluU3RhdHVzKHVzZXJJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgdGhpcy5wcmlzbWEuY2xpZW50LmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogdHJ1ZSxcbiAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghY2xpZW50KSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKCdDbGllbnQgcHJvZmlsZSBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNGaXJzdFRpbWU6ICFjbGllbnQuaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9ucyxcbiAgICAgIG5lZWRzV2VsY29tZUZsb3c6ICFjbGllbnQuaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9ucyxcbiAgICAgIG1lbWJlclNpbmNlOiBjbGllbnQuY3JlYXRlZEF0LFxuICAgIH07XG4gIH1cblxuICBhc3luYyBtYXJrUmVjb21tZW5kYXRpb25zU2Vlbih1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHVwZGF0ZWRDbGllbnQgPSBhd2FpdCB0aGlzLnByaXNtYS5jbGllbnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgICAgZGF0YTogeyBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlIH0sXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogdHJ1ZSxcbiAgICAgICAgdXBkYXRlZEF0OiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgaGFzU2VlblJlY29tbWVuZGF0aW9uczogdXBkYXRlZENsaWVudC5oYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zLFxuICAgICAgbWFya2VkQXQ6IHVwZGF0ZWRDbGllbnQudXBkYXRlZEF0LFxuICAgICAgbWVzc2FnZTogJ1JlY29tbWVuZGF0aW9ucyBtYXJrZWQgYXMgc2VlbiBzdWNjZXNzZnVsbHknLFxuICAgIH07XG4gIH1cblxuICAvLyA9PT09PSBTRVNTSU9OIE1BTkFHRU1FTlQgTUVUSE9EUyA9PT09PVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBzZXNzaW9uIGluZm9ybWF0aW9uXG4gICAqL1xuICBhc3luYyBnZXRTZXNzaW9uSW5mbyhyZWZyZXNoVG9rZW46IHN0cmluZykge1xuICAgIGNvbnN0IHNlc3Npb25JbmZvID0gYXdhaXQgdGhpcy50b2tlblNlcnZpY2UuZ2V0U2Vzc2lvbkluZm8ocmVmcmVzaFRva2VuKTtcblxuICAgIGlmICghc2Vzc2lvbkluZm8pIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oJ1Nlc3Npb24gbm90IGZvdW5kIG9yIGV4cGlyZWQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2Vzc2lvbkluZm87XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBhY3RpdmUgc2Vzc2lvbnMgZm9yIGEgdXNlclxuICAgKi9cbiAgYXN5bmMgZ2V0QWN0aXZlU2Vzc2lvbnModXNlcklkOiBzdHJpbmcsIGN1cnJlbnRSZWZyZXNoVG9rZW4/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy50b2tlblNlcnZpY2UuZ2V0QWN0aXZlU2Vzc2lvbnMoXG4gICAgICB1c2VySWQsXG4gICAgICBjdXJyZW50UmVmcmVzaFRva2VuLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVGVybWluYXRlIGEgc3BlY2lmaWMgc2Vzc2lvblxuICAgKi9cbiAgYXN5bmMgdGVybWluYXRlU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy50b2tlblNlcnZpY2UudGVybWluYXRlU2Vzc2lvbihzZXNzaW9uSWQsIHVzZXJJZCk7XG4gIH1cblxuICAvKipcbiAgICogVGVybWluYXRlIGFsbCBvdGhlciBzZXNzaW9ucyBleGNlcHQgdGhlIGN1cnJlbnQgb25lXG4gICAqL1xuICBhc3luYyB0ZXJtaW5hdGVPdGhlclNlc3Npb25zKHVzZXJJZDogc3RyaW5nLCBjdXJyZW50UmVmcmVzaFRva2VuPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudG9rZW5TZXJ2aWNlLnRlcm1pbmF0ZU90aGVyU2Vzc2lvbnMoXG4gICAgICB1c2VySWQsXG4gICAgICBjdXJyZW50UmVmcmVzaFRva2VuLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVW5pdmVyc2FsIGxvZ291dCAtIGNsZWFycyBhbGwgc2Vzc2lvbnMgZm9yIHVzZXJcbiAgICovXG4gIGFzeW5jIHVuaXZlcnNhbExvZ291dCh1c2VySWQ6IHN0cmluZykge1xuICAgIC8vIFJldm9rZSBhbGwgcmVmcmVzaCB0b2tlbnMgZm9yIHRoZSB1c2VyXG4gICAgYXdhaXQgdGhpcy50b2tlblNlcnZpY2UucmV2b2tlQWxsVXNlclRva2Vucyh1c2VySWQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnQWxsIHNlc3Npb25zIHRlcm1pbmF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=