a50b5744a391741dee66d6cd5a6a741e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateEnvironmentVariables = validateEnvironmentVariables;
exports.logEnvironmentInfo = logEnvironmentInfo;
const common_1 = require("@nestjs/common");
const logger = new common_1.Logger('EnvironmentValidation');
function validateEnvironmentVariables() {
    const requiredVars = [
        'DATABASE_URL',
        'JWT_SECRET',
        'NODE_ENV',
        'GOOGLE_CLIENT_ID',
        'GOOGLE_CLIENT_SECRET',
        'MICROSOFT_CLIENT_ID',
        'MICROSOFT_CLIENT_SECRET',
        'SUPABASE_URL',
        'SUPABASE_API_KEY',
    ];
    const missingVars = [];
    const invalidVars = [];
    // Check required variables
    for (const varName of requiredVars) {
        const value = process.env[varName];
        if (!value || value.trim() === '') {
            missingVars.push(varName);
        }
    }
    // Validate specific formats
    if (process.env.DATABASE_URL &&
        !process.env.DATABASE_URL.startsWith('postgresql://')) {
        invalidVars.push('DATABASE_URL (must be a valid PostgreSQL connection string)');
    }
    if (process.env.NODE_ENV &&
        !['development', 'production', 'test'].includes(process.env.NODE_ENV)) {
        invalidVars.push('NODE_ENV (must be development, production, or test)');
    }
    if (process.env.PORT && isNaN(Number(process.env.PORT))) {
        invalidVars.push('PORT (must be a valid number)');
    }
    // Validate OAuth client IDs (they should be substantial strings)
    if (process.env.GOOGLE_CLIENT_ID &&
        process.env.GOOGLE_CLIENT_ID.length < 20) {
        invalidVars.push('GOOGLE_CLIENT_ID (appears to be too short)');
    }
    if (process.env.GOOGLE_CLIENT_SECRET &&
        process.env.GOOGLE_CLIENT_SECRET.length < 20) {
        invalidVars.push('GOOGLE_CLIENT_SECRET (appears to be too short)');
    }
    if (process.env.MICROSOFT_CLIENT_ID &&
        process.env.MICROSOFT_CLIENT_ID.length < 20) {
        invalidVars.push('MICROSOFT_CLIENT_ID (appears to be too short)');
    }
    if (process.env.MICROSOFT_CLIENT_SECRET &&
        process.env.MICROSOFT_CLIENT_SECRET.length < 20) {
        invalidVars.push('MICROSOFT_CLIENT_SECRET (appears to be too short)');
    }
    if (process.env.JWT_SECRET && process.env.JWT_SECRET.length < 32) {
        invalidVars.push('JWT_SECRET (must be at least 32 characters for security)');
    }
    if (process.env.MESSAGE_ENCRYPTION_KEY &&
        process.env.MESSAGE_ENCRYPTION_KEY.length < 32) {
        invalidVars.push('MESSAGE_ENCRYPTION_KEY (must be at least 32 characters for security)');
    }
    // Validate Supabase configuration
    if (process.env.SUPABASE_URL &&
        !process.env.SUPABASE_URL.startsWith('https://')) {
        invalidVars.push('SUPABASE_URL (must be a valid HTTPS URL)');
    }
    if (process.env.SUPABASE_API_KEY &&
        process.env.SUPABASE_API_KEY.length < 20) {
        invalidVars.push('SUPABASE_API_KEY (appears to be too short)');
    }
    // Log warnings for missing optional variables in production
    if (process.env.NODE_ENV === 'production') {
        const recommendedProdVars = ['FRONTEND_URL', 'AI_SERVICE_URL'];
        const missingProdVars = recommendedProdVars.filter((varName) => !process.env[varName]);
        if (missingProdVars.length > 0) {
            logger.warn(`Recommended environment variables missing in production: ${missingProdVars.join(', ')}`);
        }
    }
    // Report errors
    if (missingVars.length > 0 || invalidVars.length > 0) {
        const errors = [];
        if (missingVars.length > 0) {
            errors.push(`Missing required environment variables: ${missingVars.join(', ')}`);
        }
        if (invalidVars.length > 0) {
            errors.push(`Invalid environment variables: ${invalidVars.join(', ')}`);
        }
        logger.error('Environment validation failed:');
        errors.forEach((error) => logger.error(`  - ${error}`));
        throw new Error(`Environment validation failed: ${errors.join('; ')}`);
    }
    logger.log('‚úÖ Environment variables validated successfully');
    return {
        DATABASE_URL: process.env.DATABASE_URL,
        JWT_SECRET: process.env.JWT_SECRET,
        GOOGLE_CLIENT_ID: process.env.GOOGLE_CLIENT_ID,
        GOOGLE_CLIENT_SECRET: process.env.GOOGLE_CLIENT_SECRET,
        MICROSOFT_CLIENT_ID: process.env.MICROSOFT_CLIENT_ID,
        MICROSOFT_CLIENT_SECRET: process.env.MICROSOFT_CLIENT_SECRET,
        SUPABASE_URL: process.env.SUPABASE_URL,
        SUPABASE_API_KEY: process.env.SUPABASE_API_KEY,
        NODE_ENV: process.env.NODE_ENV,
        PORT: process.env.PORT,
        FRONTEND_URL: process.env.FRONTEND_URL,
        AI_SERVICE_URL: process.env.AI_SERVICE_URL,
        JWT_EXPIRES_IN: process.env.JWT_EXPIRES_IN,
        JWT_REFRESH_EXPIRES_IN: process.env.JWT_REFRESH_EXPIRES_IN,
        GOOGLE_CALLBACK_URL: process.env.GOOGLE_CALLBACK_URL,
        MICROSOFT_CALLBACK_URL: process.env.MICROSOFT_CALLBACK_URL,
    };
}
function logEnvironmentInfo() {
    logger.log(`üöÄ Starting application in ${process.env.NODE_ENV || 'unknown'} mode`);
    logger.log(`üìä Database: ${process.env.DATABASE_URL ? 'Connected' : 'Not configured'}`);
    logger.log(`üîë JWT Authentication: ${process.env.JWT_SECRET ? 'Configured' : 'Not configured'}`);
    logger.log(`üîê Message Encryption: ${process.env.MESSAGE_ENCRYPTION_KEY ? 'Configured' : 'Not configured'}`);
    logger.log(`üîê Google OAuth: ${process.env.GOOGLE_CLIENT_ID ? 'Configured' : 'Not configured'}`);
    logger.log(`üîê Microsoft OAuth: ${process.env.MICROSOFT_CLIENT_ID ? 'Configured' : 'Not configured'}`);
    logger.log(`üåê Frontend URL: ${process.env.FRONTEND_URL || 'Not configured'}`);
    logger.log(`ü§ñ AI Service: ${process.env.AI_SERVICE_URL || 'Not configured'}`);
    logger.log(`‚òÅÔ∏è Supabase Storage: ${process.env.SUPABASE_URL ? 'Configured' : 'Not configured'}`);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbmZpZy9lbnYtdmFsaWRhdGlvbi50cyIsIm1hcHBpbmdzIjoiOztBQXdDQSxvRUE4SkM7QUFFRCxnREE0QkM7QUFwT0QsMkNBQXdDO0FBc0N4QyxNQUFNLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRW5ELFNBQWdCLDRCQUE0QjtJQUMxQyxNQUFNLFlBQVksR0FBOEI7UUFDOUMsY0FBYztRQUNkLFlBQVk7UUFDWixVQUFVO1FBQ1Ysa0JBQWtCO1FBQ2xCLHNCQUFzQjtRQUN0QixxQkFBcUI7UUFDckIseUJBQXlCO1FBQ3pCLGNBQWM7UUFDZCxrQkFBa0I7S0FDbkIsQ0FBQztJQUVGLE1BQU0sV0FBVyxHQUFhLEVBQUUsQ0FBQztJQUNqQyxNQUFNLFdBQVcsR0FBYSxFQUFFLENBQUM7SUFFakMsMkJBQTJCO0lBQzNCLEtBQUssTUFBTSxPQUFPLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbkMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUNsQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVCLENBQUM7SUFDSCxDQUFDO0lBRUQsNEJBQTRCO0lBQzVCLElBQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZO1FBQ3hCLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxFQUNyRCxDQUFDO1FBQ0QsV0FBVyxDQUFDLElBQUksQ0FDZCw2REFBNkQsQ0FDOUQsQ0FBQztJQUNKLENBQUM7SUFFRCxJQUNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUTtRQUNwQixDQUFDLENBQUMsYUFBYSxFQUFFLFlBQVksRUFB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QyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FDckYsQ0FBQztJQUNGLE1BQU0sQ0FBQyxHQUFHLENBQ1IsMEJBQTBCLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FDakcsQ0FBQztJQUNGLE1BQU0sQ0FBQyxHQUFHLENBQ1Isb0JBQW9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FDckYsQ0FBQztJQUNGLE1BQU0sQ0FBQyxHQUFHLENBQ1IsdUJBQXVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FDM0YsQ0FBQztJQUNGLE1BQU0sQ0FBQyxHQUFHLENBQ1Isb0JBQW9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxJQUFJLGdCQUFnQixFQUFFLENBQ25FLENBQUM7SUFDRixNQUFNLENBQUMsR0FBRyxDQUNSLGtCQUFrQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsSUFBSSxnQkFBZ0IsRUFBRSxDQUNuRSxDQUFDO0lBQ0YsTUFBTSxDQUFDLEdBQUcsQ0FDUix3QkFBd0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FDckYsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbmZpZy9lbnYtdmFsaWRhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVxdWlyZWRFbnZWYXJzIHtcbiAgREFUQUJBU0VfVVJMOiBzdHJpbmc7XG4gIEpXVF9TRUNSRVQ6IHN0cmluZztcbiAgTk9ERV9FTlY6ICdkZXZlbG9wbWVudCcgfCAncHJvZHVjdGlvbicgfCAndGVzdCc7XG4gIEdPT0dMRV9DTElFTlRfSUQ6IHN0cmluZztcbiAgR09PR0xFX0NMSUVOVF9TRUNSRVQ6IHN0cmluZztcbiAgTUlDUk9TT0ZUX0NMSUVOVF9JRDogc3RyaW5nO1xuICBNSUNST1NPRlRfQ0xJRU5UX1NFQ1JFVDogc3RyaW5nO1xuICBTVVBBQkFTRV9VUkw6IHN0cmluZztcbiAgU1VQQUJBU0VfQVBJX0tFWTogc3RyaW5nO1xuICBQT1JUPzogc3RyaW5nO1xuICBGUk9OVEVORF9VUkw/OiBzdHJpbmc7XG4gIEFJX1NFUlZJQ0VfVVJMPzogc3RyaW5nO1xuICBKV1RfRVhQSVJFU19JTj86IHN0cmluZztcbiAgSldUX1JFRlJFU0hfRVhQSVJFU19JTj86IHN0cmluZztcbiAgR09PR0xFX0NBTExCQUNLX1VSTD86IHN0cmluZztcbiAgTUlDUk9TT0ZUX0NBTExCQUNLX1VSTD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcHRpb25hbEVudlZhcnMge1xuICBSRURJU19VUkw/OiBzdHJpbmc7XG4gIFMzX0JVQ0tFVF9OQU1FPzogc3RyaW5nO1xuICBBV1NfQUNDRVNTX0tFWV9JRD86IHN0cmluZztcbiAgQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZPzogc3RyaW5nO1xuICBBV1NfUkVHSU9OPzogc3RyaW5nO1xuICBTTVRQX0hPU1Q/OiBzdHJpbmc7XG4gIFNNVFBfUE9SVD86IHN0cmluZztcbiAgU01UUF9VU0VSPzogc3RyaW5nO1xuICBTTVRQX1BBU1M/OiBzdHJpbmc7XG4gIFNUUklQRV9TRUNSRVRfS0VZPzogc3RyaW5nO1xuICBTVFJJUEVfV0VCSE9PS19TRUNSRVQ/OiBzdHJpbmc7XG4gIENMRVJLX1NFQ1JFVF9LRVk/OiBzdHJpbmc7XG4gIEFMTE9XRURfT1JJR0lOUz86IHN0cmluZztcbiAgVEVTVF9EQVRBQkFTRV9VUkw/OiBzdHJpbmc7XG59XG5cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ0Vudmlyb25tZW50VmFsaWRhdGlvbicpO1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVFbnZpcm9ubWVudFZhcmlhYmxlcygpOiBSZXF1aXJlZEVudlZhcnMge1xuICBjb25zdCByZXF1aXJlZFZhcnM6IChrZXlvZiBSZXF1aXJlZEVudlZhcnMpW10gPSBbXG4gICAgJ0RBVEFCQVNFX1VSTCcsXG4gICAgJ0pXVF9TRUNSRVQnLFxuICAgICdOT0RFX0VOVicsXG4gICAgJ0dPT0dMRV9DTElFTlRfSUQnLFxuICAgICdHT09HTEVfQ0xJRU5UX1NFQ1JFVCcsXG4gICAgJ01JQ1JPU09GVF9DTElFTlRfSUQnLFxuICAgICdNSUNST1NPRlRfQ0xJRU5UX1NFQ1JFVCcsXG4gICAgJ1NVUEFCQVNFX1VSTCcsXG4gICAgJ1NVUEFCQVNFX0FQSV9LRVknLFxuICBdO1xuXG4gIGNvbnN0IG1pc3NpbmdWYXJzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBpbnZhbGlkVmFyczogc3RyaW5nW10gPSBbXTtcblxuICAvLyBDaGVjayByZXF1aXJlZCB2YXJpYWJsZXNcbiAgZm9yIChjb25zdCB2YXJOYW1lIG9mIHJlcXVpcmVkVmFycykge1xuICAgIGNvbnN0IHZhbHVlID0gcHJvY2Vzcy5lbnZbdmFyTmFtZV07XG4gICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS50cmltKCkgPT09ICcnKSB7XG4gICAgICBtaXNzaW5nVmFycy5wdXNoKHZhck5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFZhbGlkYXRlIHNwZWNpZmljIGZvcm1hdHNcbiAgaWYgKFxuICAgIHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCAmJlxuICAgICFwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwuc3RhcnRzV2l0aCgncG9zdGdyZXNxbDovLycpXG4gICkge1xuICAgIGludmFsaWRWYXJzLnB1c2goXG4gICAgICAnREFUQUJBU0VfVVJMIChtdXN0IGJlIGEgdmFsaWQgUG9zdGdyZVNRTCBjb25uZWN0aW9uIHN0cmluZyknLFxuICAgICk7XG4gIH1cblxuICBpZiAoXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgJiZcbiAgICAhWydkZXZlbG9wbWVudCcsICdwcm9kdWN0aW9uJywgJ3Rlc3QnXS5pbmNsdWRlcyhwcm9jZXNzLmVudi5OT0RFX0VOVilcbiAgKSB7XG4gICAgaW52YWxpZFZhcnMucHVzaCgnTk9ERV9FTlYgKG11c3QgYmUgZGV2ZWxvcG1lbnQsIHByb2R1Y3Rpb24sIG9yIHRlc3QpJyk7XG4gIH1cblxuICBpZiAocHJvY2Vzcy5lbnYuUE9SVCAmJiBpc05hTihOdW1iZXIocHJvY2Vzcy5lbnYuUE9SVCkpKSB7XG4gICAgaW52YWxpZFZhcnMucHVzaCgnUE9SVCAobXVzdCBiZSBhIHZhbGlkIG51bWJlciknKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIE9BdXRoIGNsaWVudCBJRHMgKHRoZXkgc2hvdWxkIGJlIHN1YnN0YW50aWFsIHN0cmluZ3MpXG4gIGlmIChcbiAgICBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEICYmXG4gICAgcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRC5sZW5ndGggPCAyMFxuICApIHtcbiAgICBpbnZhbGlkVmFycy5wdXNoKCdHT09HTEVfQ0xJRU5UX0lEIChhcHBlYXJzIHRvIGJlIHRvbyBzaG9ydCknKTtcbiAgfVxuXG4gIGlmIChcbiAgICBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX1NFQ1JFVCAmJlxuICAgIHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVULmxlbmd0aCA8IDIwXG4gICkge1xuICAgIGludmFsaWRWYXJzLnB1c2goJ0dPT0dMRV9DTElFTlRfU0VDUkVUIChhcHBlYXJzIHRvIGJlIHRvbyBzaG9ydCknKTtcbiAgfVxuXG4gIGlmIChcbiAgICBwcm9jZXNzLmVudi5NSUNST1NPRlRfQ0xJRU5UX0lEICYmXG4gICAgcHJvY2Vzcy5lbnYuTUlDUk9TT0ZUX0NMSUVOVF9JRC5sZW5ndGggPCAyMFxuICApIHtcbiAgICBpbnZhbGlkVmFycy5wdXNoKCdNSUNST1NPRlRfQ0xJRU5UX0lEIChhcHBlYXJzIHRvIGJlIHRvbyBzaG9ydCknKTtcbiAgfVxuXG4gIGlmIChcbiAgICBwcm9jZXNzLmVudi5NSUNST1NPRlRfQ0xJRU5UX1NFQ1JFVCAmJlxuICAgIHByb2Nlc3MuZW52Lk1JQ1JPU09GVF9DTElFTlRfU0VDUkVULmxlbmd0aCA8IDIwXG4gICkge1xuICAgIGludmFsaWRWYXJzLnB1c2goJ01JQ1JPU09GVF9DTElFTlRfU0VDUkVUIChhcHBlYXJzIHRvIGJlIHRvbyBzaG9ydCknKTtcbiAgfVxuXG4gIGlmIChwcm9jZXNzLmVudi5KV1RfU0VDUkVUICYmIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQubGVuZ3RoIDwgMzIpIHtcbiAgICBpbnZhbGlkVmFycy5wdXNoKFxuICAgICAgJ0pXVF9TRUNSRVQgKG11c3QgYmUgYXQgbGVhc3QgMzIgY2hhcmFjdGVycyBmb3Igc2VjdXJpdHkpJyxcbiAgICApO1xuICB9XG5cbiAgaWYgKFxuICAgIHByb2Nlc3MuZW52Lk1FU1NBR0VfRU5DUllQVElPTl9LRVkgJiZcbiAgICBwcm9jZXNzLmVudi5NRVNTQUdFX0VOQ1JZUFRJT05fS0VZLmxlbmd0aCA8IDMyXG4gICkge1xuICAgIGludmFsaWRWYXJzLnB1c2goXG4gICAgICAnTUVTU0FHRV9FTkNSWVBUSU9OX0tFWSAobXVzdCBiZSBhdCBsZWFzdCAzMiBjaGFyYWN0ZXJzIGZvciBzZWN1cml0eSknLFxuICAgICk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBTdXBhYmFzZSBjb25maWd1cmF0aW9uXG4gIGlmIChcbiAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkwgJiZcbiAgICAhcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJylcbiAgKSB7XG4gICAgaW52YWxpZFZhcnMucHVzaCgnU1VQQUJBU0VfVVJMIChtdXN0IGJlIGEgdmFsaWQgSFRUUFMgVVJMKScpO1xuICB9XG5cbiAgaWYgKFxuICAgIHByb2Nlc3MuZW52LlNVUEFCQVNFX0FQSV9LRVkgJiZcbiAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9BUElfS0VZLmxlbmd0aCA8IDIwXG4gICkge1xuICAgIGludmFsaWRWYXJzLnB1c2goJ1NVUEFCQVNFX0FQSV9LRVkgKGFwcGVhcnMgdG8gYmUgdG9vIHNob3J0KScpO1xuICB9XG5cbiAgLy8gTG9nIHdhcm5pbmdzIGZvciBtaXNzaW5nIG9wdGlvbmFsIHZhcmlhYmxlcyBpbiBwcm9kdWN0aW9uXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgY29uc3QgcmVjb21tZW5kZWRQcm9kVmFycyA9IFsnRlJPTlRFTkRfVVJMJywgJ0FJX1NFUlZJQ0VfVVJMJ107XG4gICAgY29uc3QgbWlzc2luZ1Byb2RWYXJzID0gcmVjb21tZW5kZWRQcm9kVmFycy5maWx0ZXIoXG4gICAgICAodmFyTmFtZSkgPT4gIXByb2Nlc3MuZW52W3Zhck5hbWVdLFxuICAgICk7XG5cbiAgICBpZiAobWlzc2luZ1Byb2RWYXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICBgUmVjb21tZW5kZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIG1pc3NpbmcgaW4gcHJvZHVjdGlvbjogJHttaXNzaW5nUHJvZFZhcnMuam9pbignLCAnKX1gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvLyBSZXBvcnQgZXJyb3JzXG4gIGlmIChtaXNzaW5nVmFycy5sZW5ndGggPiAwIHx8IGludmFsaWRWYXJzLmxlbmd0aCA+IDApIHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAobWlzc2luZ1ZhcnMubGVuZ3RoID4gMCkge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgIGBNaXNzaW5nIHJlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlczogJHttaXNzaW5nVmFycy5qb2luKCcsICcpfWAsXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChpbnZhbGlkVmFycy5sZW5ndGggPiAwKSB7XG4gICAgICBlcnJvcnMucHVzaChgSW52YWxpZCBlbnZpcm9ubWVudCB2YXJpYWJsZXM6ICR7aW52YWxpZFZhcnMuam9pbignLCAnKX1gKTtcbiAgICB9XG5cbiAgICBsb2dnZXIuZXJyb3IoJ0Vudmlyb25tZW50IHZhbGlkYXRpb24gZmFpbGVkOicpO1xuICAgIGVycm9ycy5mb3JFYWNoKChlcnJvcikgPT4gbG9nZ2VyLmVycm9yKGAgIC0gJHtlcnJvcn1gKSk7XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVudmlyb25tZW50IHZhbGlkYXRpb24gZmFpbGVkOiAke2Vycm9ycy5qb2luKCc7ICcpfWApO1xuICB9XG5cbiAgbG9nZ2VyLmxvZygn4pyFIEVudmlyb25tZW50IHZhcmlhYmxlcyB2YWxpZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgcmV0dXJuIHtcbiAgICBEQVRBQkFTRV9VUkw6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCEsXG4gICAgSldUX1NFQ1JFVDogcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCEsXG4gICAgR09PR0xFX0NMSUVOVF9JRDogcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRCEsXG4gICAgR09PR0xFX0NMSUVOVF9TRUNSRVQ6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUISxcbiAgICBNSUNST1NPRlRfQ0xJRU5UX0lEOiBwcm9jZXNzLmVudi5NSUNST1NPRlRfQ0xJRU5UX0lEISxcbiAgICBNSUNST1NPRlRfQ0xJRU5UX1NFQ1JFVDogcHJvY2Vzcy5lbnYuTUlDUk9TT0ZUX0NMSUVOVF9TRUNSRVQhLFxuICAgIFNVUEFCQVNFX1VSTDogcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMISxcbiAgICBTVVBBQkFTRV9BUElfS0VZOiBwcm9jZXNzLmVudi5TVVBBQkFTRV9BUElfS0VZISxcbiAgICBOT0RFX0VOVjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgYXMgJ2RldmVsb3BtZW50JyB8ICdwcm9kdWN0aW9uJyB8ICd0ZXN0JyxcbiAgICBQT1JUOiBwcm9jZXNzLmVudi5QT1JULFxuICAgIEZST05URU5EX1VSTDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMLFxuICAgIEFJX1NFUlZJQ0VfVVJMOiBwcm9jZXNzLmVudi5BSV9TRVJWSUNFX1VSTCxcbiAgICBKV1RfRVhQSVJFU19JTjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4sXG4gICAgSldUX1JFRlJFU0hfRVhQSVJFU19JTjogcHJvY2Vzcy5lbnYuSldUX1JFRlJFU0hfRVhQSVJFU19JTixcbiAgICBHT09HTEVfQ0FMTEJBQ0tfVVJMOiBwcm9jZXNzLmVudi5HT09HTEVfQ0FMTEJBQ0tfVVJMLFxuICAgIE1JQ1JPU09GVF9DQUxMQkFDS19VUkw6IHByb2Nlc3MuZW52Lk1JQ1JPU09GVF9DQUxMQkFDS19VUkwsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dFbnZpcm9ubWVudEluZm8oKTogdm9pZCB7XG4gIGxvZ2dlci5sb2coXG4gICAgYPCfmoAgU3RhcnRpbmcgYXBwbGljYXRpb24gaW4gJHtwcm9jZXNzLmVudi5OT0RFX0VOViB8fCAndW5rbm93bid9IG1vZGVgLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn5OKIERhdGFiYXNlOiAke3Byb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCA/ICdDb25uZWN0ZWQnIDogJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn5SRIEpXVCBBdXRoZW50aWNhdGlvbjogJHtwcm9jZXNzLmVudi5KV1RfU0VDUkVUID8gJ0NvbmZpZ3VyZWQnIDogJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn5SQIE1lc3NhZ2UgRW5jcnlwdGlvbjogJHtwcm9jZXNzLmVudi5NRVNTQUdFX0VOQ1JZUFRJT05fS0VZID8gJ0NvbmZpZ3VyZWQnIDogJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn5SQIEdvb2dsZSBPQXV0aDogJHtwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEID8gJ0NvbmZpZ3VyZWQnIDogJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn5SQIE1pY3Jvc29mdCBPQXV0aDogJHtwcm9jZXNzLmVudi5NSUNST1NPRlRfQ0xJRU5UX0lEID8gJ0NvbmZpZ3VyZWQnIDogJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn4yQIEZyb250ZW5kIFVSTDogJHtwcm9jZXNzLmVudi5GUk9OVEVORF9VUkwgfHwgJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDwn6SWIEFJIFNlcnZpY2U6ICR7cHJvY2Vzcy5lbnYuQUlfU0VSVklDRV9VUkwgfHwgJ05vdCBjb25maWd1cmVkJ31gLFxuICApO1xuICBsb2dnZXIubG9nKFxuICAgIGDimIHvuI8gU3VwYWJhc2UgU3RvcmFnZTogJHtwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkwgPyAnQ29uZmlndXJlZCcgOiAnTm90IGNvbmZpZ3VyZWQnfWAsXG4gICk7XG59XG4iXSwidmVyc2lvbiI6M30=