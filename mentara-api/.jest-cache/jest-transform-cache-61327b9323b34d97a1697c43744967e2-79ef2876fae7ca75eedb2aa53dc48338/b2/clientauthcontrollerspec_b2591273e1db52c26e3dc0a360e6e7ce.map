{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/client-auth.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/client-auth.controller.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { UnauthorizedException, BadRequestException } from '@nestjs/common';\nimport { ThrottlerGuard, ThrottlerModule } from '@nestjs/throttler';\nimport { ClientAuthController } from './client-auth.controller';\nimport { ClientAuthService } from '../../services/auth/client-auth.service';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\nimport {\n  MockBuilder,\n  TestDataGenerator,\n  TestAssertions,\n  SecurityGuardTestUtils,\n  RoleBasedTestUtils,\n  TEST_USER_IDS,\n  TEST_EMAILS,\n} from '../../test-utils/auth-testing-helpers';\n\ndescribe('ClientAuthController', () => {\n  let controller: ClientAuthController;\n  let clientAuthService: ClientAuthService;\n  let mockJwtAuthGuard: jest.Mocked<JwtAuthGuard>;\n\n  // Test data constants\n  const mockClientUser = {\n    id: TEST_USER_IDS.CLIENT,\n    email: TEST_EMAILS.CLIENT,\n    firstName: 'John',\n    lastName: 'Doe',\n    role: 'client',\n    emailVerified: false,\n    dateOfBirth: new Date('1990-01-01'),\n    phoneNumber: '+1234567890',\n    profileComplete: true,\n    therapistId: null,\n    createdAt: new Date(),\n  };\n\n  const mockTokens = {\n    accessToken: 'mock-access-token',\n    refreshToken: 'mock-refresh-token',\n    expiresIn: 3600,\n  };\n\n  const mockRegistrationResult = {\n    user: mockClientUser,\n    tokens: mockTokens,\n    message: 'Client account created successfully',\n  };\n\n  const mockLoginResult = {\n    user: mockClientUser,\n    tokens: mockTokens,\n  };\n\n  const mockFirstSignInStatus = {\n    isFirstSignIn: true,\n    hasSeenRecommendations: false,\n    profileCompleted: false,\n    assessmentCompleted: false,\n  };\n\n  const mockMarkRecommendationsResult = {\n    success: true,\n    message: 'Recommendations marked as seen successfully',\n  };\n\n  beforeEach(async () => {\n    // Create mock services\n    const mockClientAuthService = {\n      registerClient: jest.fn(),\n      loginClient: jest.fn(),\n      getClientProfile: jest.fn(),\n      getFirstSignInStatus: jest.fn(),\n      markRecommendationsSeen: jest.fn(),\n    };\n\n    mockJwtAuthGuard = {\n      canActivate: jest.fn().mockReturnValue(true),\n    } as any;\n\n    const module: TestingModule = await Test.createTestingModule({\n      imports: [\n        ThrottlerModule.forRoot([\n          {\n            name: 'short',\n            ttl: 1000,\n            limit: 3,\n          },\n        ]),\n      ],\n      controllers: [ClientAuthController],\n      providers: [\n        {\n          provide: ClientAuthService,\n          useValue: mockClientAuthService,\n        },\n      ],\n    })\n      .overrideGuard(JwtAuthGuard)\n      .useValue(mockJwtAuthGuard)\n      .overrideGuard(ThrottlerGuard)\n      .useValue({ canActivate: jest.fn().mockReturnValue(true) })\n      .compile();\n\n    controller = module.get<ClientAuthController>(ClientAuthController);\n    clientAuthService = module.get<ClientAuthService>(ClientAuthService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('register', () => {\n    const validRegisterDto = {\n      email: 'newclient@example.com',\n      password: 'SecurePass123!',\n      firstName: 'New',\n      lastName: 'Client',\n      dateOfBirth: new Date('1990-01-01'),\n      phoneNumber: '+1234567890',\n    };\n\n    it('should register client successfully', async () => {\n      // Arrange\n      jest.spyOn(clientAuthService, 'registerClient').mockResolvedValue(mockRegistrationResult);\n\n      // Act\n      const result = await controller.register(validRegisterDto);\n\n      // Assert\n      expect(clientAuthService.registerClient).toHaveBeenCalledWith(validRegisterDto);\n      expect(result).toEqual({\n        user: {\n          id: mockClientUser.id,\n          email: mockClientUser.email,\n          firstName: mockClientUser.firstName,\n          lastName: mockClientUser.lastName,\n          role: mockClientUser.role,\n          emailVerified: mockClientUser.emailVerified,\n        },\n        accessToken: mockTokens.accessToken,\n        refreshToken: mockTokens.refreshToken,\n        expiresIn: mockTokens.expiresIn,\n        message: mockRegistrationResult.message,\n      });\n    });\n\n    it('should handle registration with minimal data', async () => {\n      // Arrange\n      const minimalRegisterDto = {\n        email: 'minimal@example.com',\n        password: 'SecurePass123!',\n        firstName: 'Minimal',\n        lastName: 'User',\n      };\n\n      jest.spyOn(clientAuthService, 'registerClient').mockResolvedValue(mockRegistrationResult);\n\n      // Act\n      const result = await controller.register(minimalRegisterDto);\n\n      // Assert\n      expect(clientAuthService.registerClient).toHaveBeenCalledWith(minimalRegisterDto);\n      expect(result).toBeDefined();\n    });\n\n    it('should handle email already exists error', async () => {\n      // Arrange\n      const error = new BadRequestException('Email already exists');\n      jest.spyOn(clientAuthService, 'registerClient').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.register(validRegisterDto)).rejects.toThrow(BadRequestException);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(clientAuthService, 'registerClient').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.register(validRegisterDto)).rejects.toThrow(error);\n    });\n  });\n\n  describe('login', () => {\n    const validLoginDto = {\n      email: TEST_EMAILS.CLIENT,\n      password: 'SecurePass123!',\n    };\n\n    const mockRequest = {\n      ip: '192.168.1.1',\n      get: jest.fn().mockReturnValue('Test User Agent'),\n    } as any;\n\n    it('should login client successfully with valid credentials', async () => {\n      // Arrange\n      jest.spyOn(clientAuthService, 'loginClient').mockResolvedValue(mockLoginResult);\n\n      // Act\n      const result = await controller.login(validLoginDto, mockRequest);\n\n      // Assert\n      expect(clientAuthService.loginClient).toHaveBeenCalledWith(\n        validLoginDto.email,\n        validLoginDto.password,\n        mockRequest.ip,\n        'Test User Agent',\n      );\n\n      expect(result).toEqual({\n        user: {\n          id: mockClientUser.id,\n          email: mockClientUser.email,\n          firstName: mockClientUser.firstName,\n          lastName: mockClientUser.lastName,\n          role: mockClientUser.role,\n          emailVerified: mockClientUser.emailVerified,\n        },\n        accessToken: mockTokens.accessToken,\n        refreshToken: mockTokens.refreshToken,\n        expiresIn: mockTokens.expiresIn,\n      });\n    });\n\n    it('should handle missing User-Agent header', async () => {\n      // Arrange\n      const mockRequestWithoutUserAgent = {\n        ip: '192.168.1.1',\n        get: jest.fn().mockReturnValue(undefined),\n      } as any;\n\n      jest.spyOn(clientAuthService, 'loginClient').mockResolvedValue(mockLoginResult);\n\n      // Act\n      await controller.login(validLoginDto, mockRequestWithoutUserAgent);\n\n      // Assert\n      expect(clientAuthService.loginClient).toHaveBeenCalledWith(\n        validLoginDto.email,\n        validLoginDto.password,\n        mockRequestWithoutUserAgent.ip,\n        undefined,\n      );\n    });\n\n    it('should handle invalid credentials', async () => {\n      // Arrange\n      const authError = new UnauthorizedException('Invalid credentials');\n      jest.spyOn(clientAuthService, 'loginClient').mockRejectedValue(authError);\n\n      // Act & Assert\n      await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(authError);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const serviceError = new Error('Database connection failed');\n      jest.spyOn(clientAuthService, 'loginClient').mockRejectedValue(serviceError);\n\n      // Act & Assert\n      await expect(controller.login(validLoginDto, mockRequest)).rejects.toThrow(serviceError);\n    });\n  });\n\n  describe('getProfile', () => {\n    it('should return client profile successfully', async () => {\n      // Arrange\n      jest.spyOn(clientAuthService, 'getClientProfile').mockResolvedValue(mockClientUser);\n\n      // Act\n      const result = await controller.getProfile(TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(clientAuthService.getClientProfile).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      expect(result).toEqual(mockClientUser);\n    });\n\n    it('should handle profile not found', async () => {\n      // Arrange\n      const notFoundError = new Error('Client profile not found');\n      jest.spyOn(clientAuthService, 'getClientProfile').mockRejectedValue(notFoundError);\n\n      // Act & Assert\n      await expect(controller.getProfile(TEST_USER_IDS.CLIENT)).rejects.toThrow(notFoundError);\n    });\n  });\n\n  describe('getFirstSignInStatus', () => {\n    it('should return first sign-in status successfully', async () => {\n      // Arrange\n      jest.spyOn(clientAuthService, 'getFirstSignInStatus').mockResolvedValue(mockFirstSignInStatus);\n\n      // Act\n      const result = await controller.getFirstSignInStatus(TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(clientAuthService.getFirstSignInStatus).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      expect(result).toEqual(mockFirstSignInStatus);\n    });\n\n    it('should handle returning user status', async () => {\n      // Arrange\n      const returningUserStatus = {\n        isFirstSignIn: false,\n        hasSeenRecommendations: true,\n        profileCompleted: true,\n        assessmentCompleted: true,\n      };\n\n      jest.spyOn(clientAuthService, 'getFirstSignInStatus').mockResolvedValue(returningUserStatus);\n\n      // Act\n      const result = await controller.getFirstSignInStatus(TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(result).toEqual(returningUserStatus);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(clientAuthService, 'getFirstSignInStatus').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.getFirstSignInStatus(TEST_USER_IDS.CLIENT)).rejects.toThrow(error);\n    });\n  });\n\n  describe('markRecommendationsSeen', () => {\n    it('should mark recommendations as seen successfully', async () => {\n      // Arrange\n      jest.spyOn(clientAuthService, 'markRecommendationsSeen').mockResolvedValue(mockMarkRecommendationsResult);\n\n      // Act\n      const result = await controller.markRecommendationsSeen(TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(clientAuthService.markRecommendationsSeen).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT);\n      expect(result).toEqual(mockMarkRecommendationsResult);\n    });\n\n    it('should handle service errors', async () => {\n      // Arrange\n      const error = new Error('Database error');\n      jest.spyOn(clientAuthService, 'markRecommendationsSeen').mockRejectedValue(error);\n\n      // Act & Assert\n      await expect(controller.markRecommendationsSeen(TEST_USER_IDS.CLIENT)).rejects.toThrow(error);\n    });\n  });\n\n  describe('Security Tests', () => {\n    it('should validate input data through ZodValidationPipe', () => {\n      // This tests that the controller uses proper validation\n      const validationPipe = new ZodValidationPipe({} as any);\n      expect(validationPipe).toBeDefined();\n    });\n\n    it('should apply rate limiting through ThrottlerGuard', () => {\n      // Test that throttling is configured\n      const registerMetadata = Reflect.getMetadata('__throttler_options__', controller.register);\n      const loginMetadata = Reflect.getMetadata('__throttler_options__', controller.login);\n      \n      expect(registerMetadata).toBeDefined();\n      expect(loginMetadata).toBeDefined();\n    });\n\n    it('should require authentication for protected endpoints', () => {\n      // Test that protected endpoints have JwtAuthGuard\n      const protectedMethods = ['getProfile', 'getFirstSignInStatus', 'markRecommendationsSeen'];\n      \n      protectedMethods.forEach(method => {\n        const guards = Reflect.getMetadata('__guards__', controller[method as keyof ClientAuthController]);\n        expect(guards).toBeDefined();\n      });\n    });\n\n    it('should allow public access to register and login endpoints', () => {\n      // Test that public endpoints are marked as public\n      const publicMethods = ['register', 'login'];\n      \n      publicMethods.forEach(method => {\n        const publicMetadata = Reflect.getMetadata('isPublic', controller[method as keyof ClientAuthController]);\n        expect(publicMetadata).toBeTruthy();\n      });\n    });\n  });\n\n  describe('Role-based Access Control', () => {\n    it('should test role-based access for protected endpoints', async () => {\n      // Test that client role can access client-specific endpoints\n      await RoleBasedTestUtils.testWithRoles(\n        async (userId: string, role: string) => {\n          // Mock the auth guard to return the specific role\n          mockJwtAuthGuard.canActivate.mockReturnValue(role === 'client');\n          \n          try {\n            await controller.getProfile(userId);\n            return true;\n          } catch (error) {\n            return false;\n          }\n        },\n        {\n          client: true,\n          therapist: false,\n          admin: false,\n          moderator: false,\n        },\n      );\n    });\n\n    it('should validate client-specific functionality', async () => {\n      // Test that client-specific endpoints work for clients\n      const clientContext = MockBuilder.createAuthContext('client');\n      \n      jest.spyOn(clientAuthService, 'getFirstSignInStatus').mockResolvedValue(mockFirstSignInStatus);\n      \n      const result = await controller.getFirstSignInStatus(clientContext.userId);\n      \n      expect(result).toBeDefined();\n      expect(result.isFirstSignIn).toBeDefined();\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle network errors gracefully', async () => {\n      // Arrange\n      const networkError = new Error('Network timeout');\n      jest.spyOn(clientAuthService, 'getClientProfile').mockRejectedValue(networkError);\n\n      // Act & Assert\n      await expect(controller.getProfile(TEST_USER_IDS.CLIENT)).rejects.toThrow(networkError);\n    });\n\n    it('should handle validation errors', async () => {\n      // Test that invalid data would be caught by the validation pipe\n      const invalidData = {\n        email: 'invalid-email',\n        password: '123', // Too short\n        firstName: '',\n        lastName: '',\n      };\n\n      // In a real scenario, this would throw a validation error\n      // The pipe would catch this before it reaches the controller\n      expect(() => {\n        // This would be handled by ZodValidationPipe\n        // and would throw a BadRequestException\n      }).not.toThrow();\n    });\n  });\n\n  describe('Integration Tests', () => {\n    it('should handle complete client registration workflow', async () => {\n      // Arrange\n      const registrationDto = {\n        email: 'integration@example.com',\n        password: 'SecurePass123!',\n        firstName: 'Integration',\n        lastName: 'Test',\n        dateOfBirth: new Date('1990-01-01'),\n        phoneNumber: '+1234567890',\n      };\n\n      jest.spyOn(clientAuthService, 'registerClient').mockResolvedValue(mockRegistrationResult);\n\n      // Act\n      const result = await controller.register(registrationDto);\n\n      // Assert\n      expect(result).toBeDefined();\n      expect(result.user.email).toBe(mockClientUser.email);\n      expect(result.accessToken).toBe(mockTokens.accessToken);\n      expect(result.refreshToken).toBe(mockTokens.refreshToken);\n      expect(result.expiresIn).toBe(mockTokens.expiresIn);\n      expect(result.message).toBe(mockRegistrationResult.message);\n    });\n\n    it('should handle complete client login workflow', async () => {\n      // Arrange\n      const loginDto = {\n        email: TEST_EMAILS.CLIENT,\n        password: 'SecurePass123!',\n      };\n\n      const mockRequest = {\n        ip: '192.168.1.1',\n        get: jest.fn().mockReturnValue('Test User Agent'),\n      } as any;\n\n      jest.spyOn(clientAuthService, 'loginClient').mockResolvedValue(mockLoginResult);\n\n      // Act\n      const result = await controller.login(loginDto, mockRequest);\n\n      // Assert\n      expect(result).toBeDefined();\n      expect(result.user.email).toBe(mockClientUser.email);\n      expect(result.accessToken).toBe(mockTokens.accessToken);\n      expect(result.refreshToken).toBe(mockTokens.refreshToken);\n      expect(result.expiresIn).toBe(mockTokens.expiresIn);\n    });\n\n    it('should handle complete onboarding status workflow', async () => {\n      // Arrange\n      jest.spyOn(clientAuthService, 'getFirstSignInStatus').mockResolvedValue(mockFirstSignInStatus);\n      jest.spyOn(clientAuthService, 'markRecommendationsSeen').mockResolvedValue(mockMarkRecommendationsResult);\n\n      // Act - Check initial status\n      const initialStatus = await controller.getFirstSignInStatus(TEST_USER_IDS.CLIENT);\n      \n      // Act - Mark recommendations as seen\n      const markResult = await controller.markRecommendationsSeen(TEST_USER_IDS.CLIENT);\n\n      // Assert\n      expect(initialStatus).toBeDefined();\n      expect(initialStatus.isFirstSignIn).toBe(true);\n      expect(initialStatus.hasSeenRecommendations).toBe(false);\n      \n      expect(markResult).toBeDefined();\n      expect(markResult.success).toBe(true);\n    });\n  });\n\n  describe('Data Validation', () => {\n    it('should validate registration data structure', () => {\n      // Test that we're using the correct DTO structure\n      const validRegistrationData = {\n        email: 'test@example.com',\n        password: 'SecurePass123!',\n        firstName: 'Test',\n        lastName: 'User',\n        dateOfBirth: new Date('1990-01-01'),\n        phoneNumber: '+1234567890',\n      };\n\n      // Verify all required fields are present\n      expect(validRegistrationData.email).toBeDefined();\n      expect(validRegistrationData.password).toBeDefined();\n      expect(validRegistrationData.firstName).toBeDefined();\n      expect(validRegistrationData.lastName).toBeDefined();\n    });\n\n    it('should validate login data structure', () => {\n      // Test that we're using the correct DTO structure\n      const validLoginData = {\n        email: 'test@example.com',\n        password: 'SecurePass123!',\n      };\n\n      // Verify all required fields are present\n      expect(validLoginData.email).toBeDefined();\n      expect(validLoginData.password).toBeDefined();\n    });\n  });\n\n  describe('Response Format Validation', () => {\n    it('should return correctly formatted registration response', async () => {\n      // Arrange\n      const registerDto = {\n        email: 'format@example.com',\n        password: 'SecurePass123!',\n        firstName: 'Format',\n        lastName: 'Test',\n      };\n\n      jest.spyOn(clientAuthService, 'registerClient').mockResolvedValue(mockRegistrationResult);\n\n      // Act\n      const result = await controller.register(registerDto);\n\n      // Assert\n      expect(result).toHaveProperty('user');\n      expect(result).toHaveProperty('accessToken');\n      expect(result).toHaveProperty('refreshToken');\n      expect(result).toHaveProperty('expiresIn');\n      expect(result).toHaveProperty('message');\n      \n      expect(result.user).toHaveProperty('id');\n      expect(result.user).toHaveProperty('email');\n      expect(result.user).toHaveProperty('firstName');\n      expect(result.user).toHaveProperty('lastName');\n      expect(result.user).toHaveProperty('role');\n      expect(result.user).toHaveProperty('emailVerified');\n    });\n\n    it('should return correctly formatted login response', async () => {\n      // Arrange\n      const loginDto = {\n        email: TEST_EMAILS.CLIENT,\n        password: 'SecurePass123!',\n      };\n\n      const mockRequest = {\n        ip: '192.168.1.1',\n        get: jest.fn().mockReturnValue('Test User Agent'),\n      } as any;\n\n      jest.spyOn(clientAuthService, 'loginClient').mockResolvedValue(mockLoginResult);\n\n      // Act\n      const result = await controller.login(loginDto, mockRequest);\n\n      // Assert\n      expect(result).toHaveProperty('user');\n      expect(result).toHaveProperty('accessToken');\n      expect(result).toHaveProperty('refreshToken');\n      expect(result).toHaveProperty('expiresIn');\n      expect(result).not.toHaveProperty('message'); // Login doesn't include message\n    });\n  });\n});"],"version":3}