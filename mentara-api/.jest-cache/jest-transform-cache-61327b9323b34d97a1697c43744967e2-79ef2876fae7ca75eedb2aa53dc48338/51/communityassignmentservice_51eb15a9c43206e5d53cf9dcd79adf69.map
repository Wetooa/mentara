{"version":3,"names":["cov_1x2e811nhh","actualCoverage","common_1","s","require","prisma_client_provider_1","community_configs_1","CommunityAssignmentService","prisma","constructor","f","QUESTIONNAIRE_TO_COMMUNITY_MAP","phobia","burnout","insomnia","ptsd","adhd","alcohol","SEVERITY_THRESHOLD","minimal","mild","moderate","severe","assignCommunitiesToUser","userId","console","log","userAssessment","preAssessment","findFirst","where","clientId","b","scores","severityLevels","assignedCommunities","questionnaire","Object","entries","severity","communitySlug","toLowerCase","community","findUnique","slug","existingMembership","membership","userId_communityId","communityId","id","name","create","data","role","joinedAt","Date","push","error","assignGeneralSupportCommunities","length","generalCommunities","communityName","getRecommendedCommunities","recommendedCommunities","ILLNESS_COMMUNITIES","find","c","bulkAssignCommunities","userIds","results","exports","__decorate","Injectable","PrismaService","_a"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/community-assignment.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { ILLNESS_COMMUNITIES } from '../config/community-configs';\n\ninterface PreAssessmentScores {\n  [key: string]: number;\n}\n\ninterface SeverityLevels {\n  [key: string]: string;\n}\n\n@Injectable()\nexport class CommunityAssignmentService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  /**\n   * Maps questionnaire types to community slugs based on mental health conditions\n   */\n  private readonly QUESTIONNAIRE_TO_COMMUNITY_MAP = {\n    // Depression-related assessments\n    'phq-9': 'depression-support',\n    'mood-disorder': 'depression-support',\n\n    // Anxiety-related assessments\n    'gad-7-anxiety': 'anxiety-warriors',\n    'social-phobia': 'social-anxiety-support',\n    'panic-disorder': 'anxiety-warriors',\n    phobia: 'phobia-support',\n\n    // Stress-related assessments\n    'perceived-stress-scale': 'stress-support',\n    burnout: 'burnout-recovery',\n\n    // Sleep-related assessments\n    insomnia: 'insomnia-support',\n\n    // Trauma-related assessments\n    ptsd: 'ptsd-support',\n\n    // OCD-related assessments\n    'obsessional-compulsive': 'ocd-support',\n\n    // ADHD-related assessments\n    adhd: 'adhd-support',\n\n    // Eating disorder assessments\n    'binge-eating': 'eating-disorder-recovery',\n\n    // Substance use assessments\n    alcohol: 'substance-recovery-support',\n    'drug-abuse': 'substance-recovery-support',\n  };\n\n  /**\n   * Severity thresholds for community assignment\n   * Only assign to communities if severity is moderate or higher\n   */\n  private readonly SEVERITY_THRESHOLD = {\n    minimal: false,\n    mild: false,\n    moderate: true,\n    severe: true,\n    'very-severe': true,\n  };\n\n  /**\n   * Auto-assign communities to a user based on their pre-assessment results\n   */\n  async assignCommunitiesToUser(userId: string): Promise<string[]> {\n    console.log(`üîÑ Auto-assigning communities for user: ${userId}`);\n\n    // Get user's pre-assessment data\n    const userAssessment = await this.prisma.preAssessment.findFirst({\n      where: { clientId: userId },\n    });\n\n    if (!userAssessment) {\n      console.log(`‚ö†Ô∏è  No pre-assessment found for user: ${userId}`);\n      return [];\n    }\n\n    const scores = userAssessment.scores as PreAssessmentScores;\n    const severityLevels = userAssessment.severityLevels as SeverityLevels;\n    const assignedCommunities: string[] = [];\n\n    // Iterate through questionnaire results and assign communities\n    for (const [questionnaire] of Object.entries(scores)) {\n      const severity = severityLevels[questionnaire];\n      const communitySlug = this.QUESTIONNAIRE_TO_COMMUNITY_MAP[questionnaire];\n\n      // Skip if no community mapping or severity is too low\n      if (!communitySlug || !this.SEVERITY_THRESHOLD[severity?.toLowerCase()]) {\n        continue;\n      }\n\n      // Find the community\n      const community = await this.prisma.community.findUnique({\n        where: { slug: communitySlug },\n      });\n\n      if (!community) {\n        console.log(`‚ö†Ô∏è  Community not found for slug: ${communitySlug}`);\n        continue;\n      }\n\n      // Check if user is already a member\n      const existingMembership = await this.prisma.membership.findUnique({\n        where: {\n          userId_communityId: {\n            userId: userId,\n            communityId: community.id,\n          },\n        },\n      });\n\n      if (existingMembership) {\n        console.log(`‚è≠Ô∏è  User already member of: ${community.name}`);\n        continue;\n      }\n\n      // Create membership\n      try {\n        await this.prisma.membership.create({\n          data: {\n            userId: userId,\n            communityId: community.id,\n            role: 'member',\n            joinedAt: new Date(),\n          },\n        });\n\n        assignedCommunities.push(community.name);\n        console.log(\n          `‚úÖ Assigned user to community: ${community.name} (${severity} ${questionnaire})`,\n        );\n      } catch (error) {\n        console.error(\n          `‚ùå Failed to assign community ${community.name}:`,\n          error,\n        );\n      }\n    }\n\n    // Always assign to general support communities\n    await this.assignGeneralSupportCommunities(userId);\n\n    console.log(\n      `üéØ Auto-assignment complete. Assigned ${assignedCommunities.length} communities.`,\n    );\n    return assignedCommunities;\n  }\n\n  /**\n   * Assign user to general support communities regardless of assessment results\n   */\n  private async assignGeneralSupportCommunities(userId: string): Promise<void> {\n    const generalCommunities = ['Support Circle', 'Mindfulness & Meditation'];\n\n    for (const communityName of generalCommunities) {\n      const community = await this.prisma.community.findFirst({\n        where: { name: communityName },\n      });\n\n      if (!community) continue;\n\n      // Check if user is already a member\n      const existingMembership = await this.prisma.membership.findUnique({\n        where: {\n          userId_communityId: {\n            userId: userId,\n            communityId: community.id,\n          },\n        },\n      });\n\n      if (existingMembership) continue;\n\n      try {\n        await this.prisma.membership.create({\n          data: {\n            userId: userId,\n            communityId: community.id,\n            role: 'member',\n            joinedAt: new Date(),\n          },\n        });\n        console.log(`‚úÖ Assigned user to general community: ${community.name}`);\n      } catch (error) {\n        console.error(\n          `‚ùå Failed to assign general community ${community.name}:`,\n          error,\n        );\n      }\n    }\n  }\n\n  /**\n   * Get communities a user should be assigned to based on their assessment (preview mode)\n   */\n  async getRecommendedCommunities(userId: string): Promise<string[]> {\n    const userAssessment = await this.prisma.preAssessment.findFirst({\n      where: { clientId: userId },\n    });\n\n    if (!userAssessment) {\n      return [];\n    }\n\n    const scores = userAssessment.scores as PreAssessmentScores;\n    const severityLevels = userAssessment.severityLevels as SeverityLevels;\n    const recommendedCommunities: string[] = [];\n\n    for (const [questionnaire] of Object.entries(scores)) {\n      const severity = severityLevels[questionnaire];\n      const communitySlug = this.QUESTIONNAIRE_TO_COMMUNITY_MAP[questionnaire];\n\n      if (communitySlug && this.SEVERITY_THRESHOLD[severity?.toLowerCase()]) {\n        const community = ILLNESS_COMMUNITIES.find(\n          (c) => c.slug === communitySlug,\n        );\n        if (community) {\n          recommendedCommunities.push(community.name);\n        }\n      }\n    }\n\n    return recommendedCommunities;\n  }\n\n  /**\n   * Bulk assign communities to multiple users (useful for existing users)\n   */\n  async bulkAssignCommunities(\n    userIds: string[],\n  ): Promise<{ [userId: string]: string[] }> {\n    const results: { [userId: string]: string[] } = {};\n\n    for (const userId of userIds) {\n      try {\n        results[userId] = await this.assignCommunitiesToUser(userId);\n      } catch (error) {\n        console.error(`Error assigning communities to user ${userId}:`, error);\n        results[userId] = [];\n      }\n    }\n\n    return results;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEA;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAFA,MAAAE,QAAA;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAC,wBAAA;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAE,mBAAA;AAAA;AAAA,CAAAN,cAAA,GAAAG,CAAA,QAAAC,OAAA;AAAkE;AAAAJ,cAAA,GAAAG,CAAA;AAW3D,IAAMI,0BAA0B,GAAhC,MAAMA,0BAA0B;EACRC,MAAA;EAA7BC,YAA6BD,MAAqB;IAAA;IAAAR,cAAA,GAAAU,CAAA;IAAAV,cAAA,GAAAG,CAAA;IAArB,KAAAK,MAAM,GAANA,MAAM;EAAkB;EAErD;;;EAGiBG,8BAA8B;EAAA;EAAA,CAAAX,cAAA,GAAAG,CAAA,QAAG;IAChD;IACA,OAAO,EAAE,oBAAoB;IAC7B,eAAe,EAAE,oBAAoB;IAErC;IACA,eAAe,EAAE,kBAAkB;IACnC,eAAe,EAAE,wBAAwB;IACzC,gBAAgB,EAAE,kBAAkB;IACpCS,MAAM,EAAE,gBAAgB;IAExB;IACA,wBAAwB,EAAE,gBAAgB;IAC1CC,OAAO,EAAE,kBAAkB;IAE3B;IACAC,QAAQ,EAAE,kBAAkB;IAE5B;IACAC,IAAI,EAAE,cAAc;IAEpB;IACA,wBAAwB,EAAE,aAAa;IAEvC;IACAC,IAAI,EAAE,cAAc;IAEpB;IACA,cAAc,EAAE,0BAA0B;IAE1C;IACAC,OAAO,EAAE,4BAA4B;IACrC,YAAY,EAAE;GACf;EAED;;;;EAIiBC,kBAAkB;EAAA;EAAA,CAAAlB,cAAA,GAAAG,CAAA,QAAG;IACpCgB,OAAO,EAAE,KAAK;IACdC,IAAI,EAAE,KAAK;IACXC,QAAQ,EAAE,IAAI;IACdC,MAAM,EAAE,IAAI;IACZ,aAAa,EAAE;GAChB;EAED;;;EAGA,MAAMC,uBAAuBA,CAACC,MAAc;IAAA;IAAAxB,cAAA,GAAAU,CAAA;IAAAV,cAAA,GAAAG,CAAA;IAC1CsB,OAAO,CAACC,GAAG,CAAC,2CAA2CF,MAAM,EAAE,CAAC;IAEhE;IACA,MAAMG,cAAc;IAAA;IAAA,CAAA3B,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACK,MAAM,CAACoB,aAAa,CAACC,SAAS,CAAC;MAC/DC,KAAK,EAAE;QAAEC,QAAQ,EAAEP;MAAM;KAC1B,CAAC;IAAC;IAAAxB,cAAA,GAAAG,CAAA;IAEH,IAAI,CAACwB,cAAc,EAAE;MAAA;MAAA3B,cAAA,GAAAgC,CAAA;MAAAhC,cAAA,GAAAG,CAAA;MACnBsB,OAAO,CAACC,GAAG,CAAC,yCAAyCF,MAAM,EAAE,CAAC;MAAC;MAAAxB,cAAA,GAAAG,CAAA;MAC/D,OAAO,EAAE;IACX,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAgC,CAAA;IAAA;IAED,MAAMC,MAAM;IAAA;IAAA,CAAAjC,cAAA,GAAAG,CAAA,QAAGwB,cAAc,CAACM,MAA6B;IAC3D,MAAMC,cAAc;IAAA;IAAA,CAAAlC,cAAA,GAAAG,CAAA,QAAGwB,cAAc,CAACO,cAAgC;IACtE,MAAMC,mBAAmB;IAAA;IAAA,CAAAnC,cAAA,GAAAG,CAAA,QAAa,EAAE;IAExC;IAAA;IAAAH,cAAA,GAAAG,CAAA;IACA,KAAK,MAAM,CAACiC,aAAa,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACL,MAAM,CAAC,EAAE;MACpD,MAAMM,QAAQ;MAAA;MAAA,CAAAvC,cAAA,GAAAG,CAAA,QAAG+B,cAAc,CAACE,aAAa,CAAC;MAC9C,MAAMI,aAAa;MAAA;MAAA,CAAAxC,cAAA,GAAAG,CAAA,QAAG,IAAI,CAACQ,8BAA8B,CAACyB,aAAa,CAAC;MAExE;MAAA;MAAApC,cAAA,GAAAG,CAAA;MACA;MAAI;MAAA,CAAAH,cAAA,GAAAgC,CAAA,YAACQ,aAAa;MAAA;MAAA,CAAAxC,cAAA,GAAAgC,CAAA,WAAI,CAAC,IAAI,CAACd,kBAAkB,CAACqB,QAAQ,EAAEE,WAAW,EAAE,CAAC,GAAE;QAAA;QAAAzC,cAAA,GAAAgC,CAAA;QAAAhC,cAAA,GAAAG,CAAA;QACvE;MACF,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAgC,CAAA;MAAA;MAED;MACA,MAAMU,SAAS;MAAA;MAAA,CAAA1C,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACK,MAAM,CAACkC,SAAS,CAACC,UAAU,CAAC;QACvDb,KAAK,EAAE;UAAEc,IAAI,EAAEJ;QAAa;OAC7B,CAAC;MAAC;MAAAxC,cAAA,GAAAG,CAAA;MAEH,IAAI,CAACuC,SAAS,EAAE;QAAA;QAAA1C,cAAA,GAAAgC,CAAA;QAAAhC,cAAA,GAAAG,CAAA;QACdsB,OAAO,CAACC,GAAG,CAAC,qCAAqCc,aAAa,EAAE,CAAC;QAAC;QAAAxC,cAAA,GAAAG,CAAA;QAClE;MACF,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAgC,CAAA;MAAA;MAED;MACA,MAAMa,kBAAkB;MAAA;MAAA,CAAA7C,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACK,MAAM,CAACsC,UAAU,CAACH,UAAU,CAAC;QACjEb,KAAK,EAAE;UACLiB,kBAAkB,EAAE;YAClBvB,MAAM,EAAEA,MAAM;YACdwB,WAAW,EAAEN,SAAS,CAACO;;;OAG5B,CAAC;MAAC;MAAAjD,cAAA,GAAAG,CAAA;MAEH,IAAI0C,kBAAkB,EAAE;QAAA;QAAA7C,cAAA,GAAAgC,CAAA;QAAAhC,cAAA,GAAAG,CAAA;QACtBsB,OAAO,CAACC,GAAG,CAAC,+BAA+BgB,SAAS,CAACQ,IAAI,EAAE,CAAC;QAAC;QAAAlD,cAAA,GAAAG,CAAA;QAC7D;MACF,CAAC;MAAA;MAAA;QAAAH,cAAA,GAAAgC,CAAA;MAAA;MAED;MAAAhC,cAAA,GAAAG,CAAA;MACA,IAAI;QAAA;QAAAH,cAAA,GAAAG,CAAA;QACF,MAAM,IAAI,CAACK,MAAM,CAACsC,UAAU,CAACK,MAAM,CAAC;UAClCC,IAAI,EAAE;YACJ5B,MAAM,EAAEA,MAAM;YACdwB,WAAW,EAAEN,SAAS,CAACO,EAAE;YACzBI,IAAI,EAAE,QAAQ;YACdC,QAAQ,EAAE,IAAIC,IAAI;;SAErB,CAAC;QAAC;QAAAvD,cAAA,GAAAG,CAAA;QAEHgC,mBAAmB,CAACqB,IAAI,CAACd,SAAS,CAACQ,IAAI,CAAC;QAAC;QAAAlD,cAAA,GAAAG,CAAA;QACzCsB,OAAO,CAACC,GAAG,CACT,iCAAiCgB,SAAS,CAACQ,IAAI,KAAKX,QAAQ,IAAIH,aAAa,GAAG,CACjF;MACH,CAAC,CAAC,OAAOqB,KAAK,EAAE;QAAA;QAAAzD,cAAA,GAAAG,CAAA;QACdsB,OAAO,CAACgC,KAAK,CACX,gCAAgCf,SAAS,CAACQ,IAAI,GAAG,EACjDO,KAAK,CACN;MACH;IACF;IAEA;IAAA;IAAAzD,cAAA,GAAAG,CAAA;IACA,MAAM,IAAI,CAACuD,+BAA+B,CAAClC,MAAM,CAAC;IAAC;IAAAxB,cAAA,GAAAG,CAAA;IAEnDsB,OAAO,CAACC,GAAG,CACT,yCAAyCS,mBAAmB,CAACwB,MAAM,eAAe,CACnF;IAAC;IAAA3D,cAAA,GAAAG,CAAA;IACF,OAAOgC,mBAAmB;EAC5B;EAEA;;;EAGQ,MAAMuB,+BAA+BA,CAAClC,MAAc;IAAA;IAAAxB,cAAA,GAAAU,CAAA;IAC1D,MAAMkD,kBAAkB;IAAA;IAAA,CAAA5D,cAAA,GAAAG,CAAA,QAAG,CAAC,gBAAgB,EAAE,0BAA0B,CAAC;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAE1E,KAAK,MAAM0D,aAAa,IAAID,kBAAkB,EAAE;MAC9C,MAAMlB,SAAS;MAAA;MAAA,CAAA1C,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACK,MAAM,CAACkC,SAAS,CAACb,SAAS,CAAC;QACtDC,KAAK,EAAE;UAAEoB,IAAI,EAAEW;QAAa;OAC7B,CAAC;MAAC;MAAA7D,cAAA,GAAAG,CAAA;MAEH,IAAI,CAACuC,SAAS,EAAE;QAAA;QAAA1C,cAAA,GAAAgC,CAAA;QAAAhC,cAAA,GAAAG,CAAA;QAAA;MAAA,CAAS;MAAA;MAAA;QAAAH,cAAA,GAAAgC,CAAA;MAAA;MAEzB;MACA,MAAMa,kBAAkB;MAAA;MAAA,CAAA7C,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACK,MAAM,CAACsC,UAAU,CAACH,UAAU,CAAC;QACjEb,KAAK,EAAE;UACLiB,kBAAkB,EAAE;YAClBvB,MAAM,EAAEA,MAAM;YACdwB,WAAW,EAAEN,SAAS,CAACO;;;OAG5B,CAAC;MAAC;MAAAjD,cAAA,GAAAG,CAAA;MAEH,IAAI0C,kBAAkB,EAAE;QAAA;QAAA7C,cAAA,GAAAgC,CAAA;QAAAhC,cAAA,GAAAG,CAAA;QAAA;MAAA,CAAS;MAAA;MAAA;QAAAH,cAAA,GAAAgC,CAAA;MAAA;MAAAhC,cAAA,GAAAG,CAAA;MAEjC,IAAI;QAAA;QAAAH,cAAA,GAAAG,CAAA;QACF,MAAM,IAAI,CAACK,MAAM,CAACsC,UAAU,CAACK,MAAM,CAAC;UAClCC,IAAI,EAAE;YACJ5B,MAAM,EAAEA,MAAM;YACdwB,WAAW,EAAEN,SAAS,CAACO,EAAE;YACzBI,IAAI,EAAE,QAAQ;YACdC,QAAQ,EAAE,IAAIC,IAAI;;SAErB,CAAC;QAAC;QAAAvD,cAAA,GAAAG,CAAA;QACHsB,OAAO,CAACC,GAAG,CAAC,yCAAyCgB,SAAS,CAACQ,IAAI,EAAE,CAAC;MACxE,CAAC,CAAC,OAAOO,KAAK,EAAE;QAAA;QAAAzD,cAAA,GAAAG,CAAA;QACdsB,OAAO,CAACgC,KAAK,CACX,wCAAwCf,SAAS,CAACQ,IAAI,GAAG,EACzDO,KAAK,CACN;MACH;IACF;EACF;EAEA;;;EAGA,MAAMK,yBAAyBA,CAACtC,MAAc;IAAA;IAAAxB,cAAA,GAAAU,CAAA;IAC5C,MAAMiB,cAAc;IAAA;IAAA,CAAA3B,cAAA,GAAAG,CAAA,QAAG,MAAM,IAAI,CAACK,MAAM,CAACoB,aAAa,CAACC,SAAS,CAAC;MAC/DC,KAAK,EAAE;QAAEC,QAAQ,EAAEP;MAAM;KAC1B,CAAC;IAAC;IAAAxB,cAAA,GAAAG,CAAA;IAEH,IAAI,CAACwB,cAAc,EAAE;MAAA;MAAA3B,cAAA,GAAAgC,CAAA;MAAAhC,cAAA,GAAAG,CAAA;MACnB,OAAO,EAAE;IACX,CAAC;IAAA;IAAA;MAAAH,cAAA,GAAAgC,CAAA;IAAA;IAED,MAAMC,MAAM;IAAA;IAAA,CAAAjC,cAAA,GAAAG,CAAA,QAAGwB,cAAc,CAACM,MAA6B;IAC3D,MAAMC,cAAc;IAAA;IAAA,CAAAlC,cAAA,GAAAG,CAAA,QAAGwB,cAAc,CAACO,cAAgC;IACtE,MAAM6B,sBAAsB;IAAA;IAAA,CAAA/D,cAAA,GAAAG,CAAA,QAAa,EAAE;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAE5C,KAAK,MAAM,CAACiC,aAAa,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACL,MAAM,CAAC,EAAE;MACpD,MAAMM,QAAQ;MAAA;MAAA,CAAAvC,cAAA,GAAAG,CAAA,QAAG+B,cAAc,CAACE,aAAa,CAAC;MAC9C,MAAMI,aAAa;MAAA;MAAA,CAAAxC,cAAA,GAAAG,CAAA,QAAG,IAAI,CAACQ,8BAA8B,CAACyB,aAAa,CAAC;MAAC;MAAApC,cAAA,GAAAG,CAAA;MAEzE;MAAI;MAAA,CAAAH,cAAA,GAAAgC,CAAA,WAAAQ,aAAa;MAAA;MAAA,CAAAxC,cAAA,GAAAgC,CAAA,WAAI,IAAI,CAACd,kBAAkB,CAACqB,QAAQ,EAAEE,WAAW,EAAE,CAAC,GAAE;QAAA;QAAAzC,cAAA,GAAAgC,CAAA;QACrE,MAAMU,SAAS;QAAA;QAAA,CAAA1C,cAAA,GAAAG,CAAA,QAAGG,mBAAA,CAAA0D,mBAAmB,CAACC,IAAI,CACvCC,CAAC,IAAK;UAAA;UAAAlE,cAAA,GAAAU,CAAA;UAAAV,cAAA,GAAAG,CAAA;UAAA,OAAA+D,CAAC,CAACtB,IAAI,KAAKJ,aAAa;QAAb,CAAa,CAChC;QAAC;QAAAxC,cAAA,GAAAG,CAAA;QACF,IAAIuC,SAAS,EAAE;UAAA;UAAA1C,cAAA,GAAAgC,CAAA;UAAAhC,cAAA,GAAAG,CAAA;UACb4D,sBAAsB,CAACP,IAAI,CAACd,SAAS,CAACQ,IAAI,CAAC;QAC7C,CAAC;QAAA;QAAA;UAAAlD,cAAA,GAAAgC,CAAA;QAAA;MACH,CAAC;MAAA;MAAA;QAAAhC,cAAA,GAAAgC,CAAA;MAAA;IACH;IAAC;IAAAhC,cAAA,GAAAG,CAAA;IAED,OAAO4D,sBAAsB;EAC/B;EAEA;;;EAGA,MAAMI,qBAAqBA,CACzBC,OAAiB;IAAA;IAAApE,cAAA,GAAAU,CAAA;IAEjB,MAAM2D,OAAO;IAAA;IAAA,CAAArE,cAAA,GAAAG,CAAA,QAAmC,EAAE;IAAC;IAAAH,cAAA,GAAAG,CAAA;IAEnD,KAAK,MAAMqB,MAAM,IAAI4C,OAAO,EAAE;MAAA;MAAApE,cAAA,GAAAG,CAAA;MAC5B,IAAI;QAAA;QAAAH,cAAA,GAAAG,CAAA;QACFkE,OAAO,CAAC7C,MAAM,CAAC,GAAG,MAAM,IAAI,CAACD,uBAAuB,CAACC,MAAM,CAAC;MAC9D,CAAC,CAAC,OAAOiC,KAAK,EAAE;QAAA;QAAAzD,cAAA,GAAAG,CAAA;QACdsB,OAAO,CAACgC,KAAK,CAAC,uCAAuCjC,MAAM,GAAG,EAAEiC,KAAK,CAAC;QAAC;QAAAzD,cAAA,GAAAG,CAAA;QACvEkE,OAAO,CAAC7C,MAAM,CAAC,GAAG,EAAE;MACtB;IACF;IAAC;IAAAxB,cAAA,GAAAG,CAAA;IAED,OAAOkE,OAAO;EAChB;CACD;AAAA;AAAArE,cAAA,GAAAG,CAAA;AA5OYmE,OAAA,CAAA/D,0BAAA,GAAAA,0BAAA;AAA0B;AAAAP,cAAA,GAAAG,CAAA;qCAA1BI,0BAA0B,GAAAgE,UAAA,EADtC,IAAArE,QAAA,CAAAsE,UAAU,GAAE,E;;qCAE0BnE,wBAAA,CAAAoE,aAAa;AAAA;AAAA,CAAAzE,cAAA,GAAAgC,CAAA,WAAb3B,wBAAA,CAAAoE,aAAa;AAAA;AAAA,CAAAzE,cAAA,GAAAgC,CAAA,WAAA0C,EAAA;AAAA;AAAA,CAAA1E,cAAA,GAAAgC,CAAA,WAAAK,MAAA,I,EADvC9B,0BAA0B,CA4OtC","ignoreList":[]}