{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/analysis/clinical-insights.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/analysis/clinical-insights.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { PreAssessment } from '@prisma/client';\nimport { QuestionnaireScores, processPreAssessmentAnswers } from '../pre-assessment.utils';\n\nexport interface ClinicalInsight {\n  condition: string;\n  severity: string;\n  score: number;\n  clinicalLevel: 'subclinical' | 'mild' | 'moderate' | 'severe' | 'extreme';\n  confidence: number; // 0-100%\n  riskLevel: 'low' | 'moderate' | 'high' | 'critical';\n  priority: number; // 1-10, higher = more urgent\n  keyIndicators: string[];\n  therapeuticFocus: string[];\n  recommendations: string[];\n}\n\nexport interface ClinicalProfile {\n  primaryConditions: ClinicalInsight[];\n  secondaryConditions: ClinicalInsight[];\n  riskFactors: RiskFactor[];\n  overallRiskLevel: 'low' | 'moderate' | 'high' | 'critical';\n  therapeuticPriorities: string[];\n  treatmentRecommendations: TreatmentRecommendation[];\n  summary: string;\n}\n\nexport interface RiskFactor {\n  type:\n    | 'suicide'\n    | 'self_harm'\n    | 'substance_abuse'\n    | 'psychosis'\n    | 'mania'\n    | 'severe_depression';\n  level: 'low' | 'moderate' | 'high' | 'critical';\n  indicators: string[];\n  urgency: 'immediate' | 'within_week' | 'within_month' | 'routine';\n}\n\nexport interface TreatmentRecommendation {\n  priority: number;\n  condition: string;\n  approach: string[];\n  specialization: string[];\n  urgency: 'immediate' | 'high' | 'moderate' | 'routine';\n  estimatedDuration: string;\n  goals: string[];\n}\n\n@Injectable()\nexport class ClinicalInsightsService {\n  private readonly logger = new Logger(ClinicalInsightsService.name);\n\n  /**\n   * Generate comprehensive clinical insights from pre-assessment data\n   * This is the main analysis function that combines traditional scoring with AI predictions\n   */\n  async generateClinicalProfile(\n    preAssessment: PreAssessment,\n    questionnaires: string[],\n    scores: QuestionnaireScores,\n  ): Promise<ClinicalProfile> {\n    this.logger.log('Generating comprehensive clinical profile');\n\n    try {\n      // Extract and validate core data\n      const severityLevels = this.extractSeverityLevels(preAssessment);\n      const aiPredictions = this.extractAiPredictions(preAssessment);\n\n      // Generate detailed insights for each condition\n      const clinicalInsights = this.generateConditionInsights(\n        questionnaires,\n        scores,\n        severityLevels,\n        aiPredictions,\n      );\n\n      // Categorize conditions by clinical priority\n      const { primaryConditions, secondaryConditions } =\n        this.categorizeConditions(clinicalInsights);\n\n      // Assess risk factors for immediate intervention needs\n      const riskFactors = this.assessRiskFactors(clinicalInsights, scores);\n\n      // Determine overall risk level and treatment urgency\n      const overallRiskLevel = this.calculateOverallRiskLevel(\n        riskFactors,\n        primaryConditions,\n      );\n\n      // Generate therapeutic priorities and treatment plan\n      const therapeuticPriorities =\n        this.generateTherapeuticPriorities(primaryConditions);\n      const treatmentRecommendations = this.generateTreatmentRecommendations(\n        primaryConditions,\n        secondaryConditions,\n        riskFactors,\n      );\n\n      // Create clinical summary\n      const summary = this.generateClinicalSummary(\n        primaryConditions,\n        secondaryConditions,\n        overallRiskLevel,\n      );\n\n      return {\n        primaryConditions,\n        secondaryConditions,\n        riskFactors,\n        overallRiskLevel,\n        therapeuticPriorities,\n        treatmentRecommendations,\n        summary,\n      };\n    } catch (error) {\n      this.logger.error('Error generating clinical profile:', error);\n      throw new Error('Failed to generate clinical insights');\n    }\n  }\n\n  /**\n   * Extract and validate severity levels from pre-assessment\n   */\n  private extractSeverityLevels(\n    preAssessment: PreAssessment,\n  ): Record<string, string> {\n    try {\n      // Access severityLevels from the dedicated field\n      const severityLevels = preAssessment.severityLevels as Record<\n        string,\n        string\n      >;\n      \n      if (severityLevels && typeof severityLevels === 'object') {\n        return severityLevels;\n      }\n      \n      // Fallback: If severityLevels is empty, calculate from answers array\n      const answers = preAssessment.answers as number[];\n      if (Array.isArray(answers) && answers.length === 201) {\n        const { severityLevels: calculatedLevels } = this.processAnswersArray(answers);\n        return calculatedLevels;\n      }\n      \n      this.logger.warn('No severity levels data available, using empty object');\n      return {};\n    } catch (error) {\n      this.logger.error('Error extracting severity levels:', error);\n      return {};\n    }\n  }\n\n  /**\n   * Extract and validate AI predictions from pre-assessment\n   */\n  private extractAiPredictions(\n    preAssessment: PreAssessment,\n  ): Record<string, boolean> {\n    try {\n      // Access aiEstimate from the dedicated field\n      const aiEstimate = preAssessment.aiEstimate as Record<string, boolean>;\n      \n      if (aiEstimate && typeof aiEstimate === 'object') {\n        return aiEstimate;\n      }\n      \n      this.logger.warn('No valid AI predictions available');\n      return {};\n    } catch (error) {\n      this.logger.error('Error extracting AI predictions:', error);\n      return {};\n    }\n  }\n\n  /**\n   * Process flat answers array using utility functions\n   */\n  private processAnswersArray(answers: number[]): {\n    scores: Record<string, number>;\n    severityLevels: Record<string, string>;\n  } {\n    try {\n      return processPreAssessmentAnswers(answers);\n    } catch (error) {\n      this.logger.error('Error processing answers array:', error);\n      return { scores: {}, severityLevels: {} };\n    }\n  }\n\n  /**\n   * Generate detailed clinical insights for each assessed condition\n   */\n  private generateConditionInsights(\n    questionnaires: string[],\n    scores: QuestionnaireScores,\n    severityLevels: Record<string, string>,\n    aiPredictions: Record<string, boolean>,\n  ): ClinicalInsight[] {\n    const insights: ClinicalInsight[] = [];\n\n    for (const questionnaire of questionnaires) {\n      const scoreData = scores[questionnaire];\n      if (!scoreData) {\n        this.logger.debug(`No score data available for questionnaire: ${questionnaire}`);\n        continue;\n      }\n\n      // Validate score data structure\n      if (typeof scoreData.score !== 'number' || !scoreData.severity) {\n        this.logger.warn(`Invalid score data for ${questionnaire}:`, scoreData);\n        continue;\n      }\n\n      const insight = this.createConditionInsight(\n        questionnaire,\n        scoreData,\n        severityLevels[questionnaire],\n        aiPredictions,\n      );\n\n      if (insight) {\n        insights.push(insight);\n        this.logger.debug(`Generated insight for ${questionnaire} with priority ${insight.priority}`);\n      } else {\n        this.logger.warn(`Failed to create insight for questionnaire: ${questionnaire}`);\n      }\n    }\n\n    return insights.sort((a, b) => b.priority - a.priority);\n  }\n\n  /**\n   * Create detailed clinical insight for a specific condition\n   */\n  private createConditionInsight(\n    condition: string,\n    scoreData: { score: number; severity: string },\n    severityLevel: string,\n    aiPredictions: Record<string, boolean>,\n  ): ClinicalInsight | null {\n    try {\n      const clinicalLevel = this.mapToClinicalLevel(severityLevel);\n      const confidence = this.calculateConfidence(\n        scoreData.score,\n        condition,\n        aiPredictions,\n      );\n      const riskLevel = this.assessConditionRisk(\n        condition,\n        clinicalLevel,\n        scoreData.score,\n      );\n      const priority = this.calculatePriority(\n        condition,\n        clinicalLevel,\n        riskLevel,\n      );\n\n      const keyIndicators = this.getKeyIndicators(\n        condition,\n        scoreData.score,\n        clinicalLevel,\n      );\n      const therapeuticFocus = this.getTherapeuticFocus(\n        condition,\n        clinicalLevel,\n      );\n      const recommendations = this.getConditionRecommendations(\n        condition,\n        clinicalLevel,\n        riskLevel,\n      );\n\n      return {\n        condition,\n        severity: severityLevel || 'Unknown',\n        score: scoreData.score,\n        clinicalLevel,\n        confidence,\n        riskLevel,\n        priority,\n        keyIndicators,\n        therapeuticFocus,\n        recommendations,\n      };\n    } catch (error) {\n      this.logger.error(`Error creating insight for ${condition}:`, error);\n      return null;\n    }\n  }\n\n  /**\n   * Map severity labels to standardized clinical levels\n   */\n  private mapToClinicalLevel(\n    severity: string,\n  ): 'subclinical' | 'mild' | 'moderate' | 'severe' | 'extreme' {\n    if (!severity) return 'subclinical';\n\n    const lowerSeverity = severity.toLowerCase();\n\n    if (\n      lowerSeverity.includes('extreme') ||\n      lowerSeverity.includes('very severe')\n    ) {\n      return 'extreme';\n    }\n    if (lowerSeverity.includes('severe')) {\n      return 'severe';\n    }\n    if (lowerSeverity.includes('moderate')) {\n      return 'moderate';\n    }\n    if (lowerSeverity.includes('mild')) {\n      return 'mild';\n    }\n\n    return 'subclinical';\n  }\n\n  /**\n   * Calculate confidence level based on score consistency and AI validation\n   */\n  private calculateConfidence(\n    score: number,\n    condition: string,\n    aiPredictions: Record<string, boolean>,\n  ): number {\n    let confidence = 70; // Base confidence\n\n    // Adjust based on score magnitude (higher scores = higher confidence)\n    if (score > 20) confidence += 20;\n    else if (score > 10) confidence += 10;\n    else if (score < 5) confidence -= 20;\n\n    // Validate against AI predictions if available\n    const aiKey = this.mapConditionToAiKey(condition);\n    if (aiKey && aiPredictions[aiKey] !== undefined) {\n      const aiPositive = aiPredictions[aiKey];\n      const scorePositive = score > 10; // Threshold varies by condition\n\n      if (aiPositive === scorePositive) {\n        confidence += 15; // AI and traditional scoring agree\n      } else {\n        confidence -= 10; // Disagreement between methods\n      }\n    }\n\n    return Math.max(10, Math.min(100, confidence));\n  }\n\n  /**\n   * Map condition names to AI prediction keys\n   */\n  private mapConditionToAiKey(condition: string): string | null {\n    const mappings: Record<string, string> = {\n      Depression: 'Has_Depression',\n      Anxiety: 'Has_Anxiety',\n      PTSD: 'Has_PTSD',\n      'Post-traumatic stress disorder (PTSD)': 'Has_PTSD',\n      'Bipolar disorder (BD)': 'Has_Bipolar',\n      'Obsessive compulsive disorder (OCD)': 'Has_OCD',\n      'ADD / ADHD': 'Has_ADHD',\n      'Social anxiety': 'Has_Social_Anxiety',\n      Panic: 'Has_Panic_Disorder',\n      Phobia: 'Has_Phobias',\n      'Substance or Alcohol Use Issues': 'Has_Substance_Use',\n      'Binge eating / Eating disorders': 'Has_Eating_Disorder',\n    };\n\n    return mappings[condition] || null;\n  }\n\n  /**\n   * Assess risk level for a specific condition\n   */\n  private assessConditionRisk(\n    condition: string,\n    clinicalLevel: string,\n    score: number,\n  ): 'low' | 'moderate' | 'high' | 'critical' {\n    // High-risk conditions that require immediate attention\n    const highRiskConditions = [\n      'Depression',\n      'Bipolar disorder (BD)',\n      'Post-traumatic stress disorder (PTSD)',\n      'Substance or Alcohol Use Issues',\n    ];\n\n    if (clinicalLevel === 'extreme') return 'critical';\n    if (clinicalLevel === 'severe') {\n      return highRiskConditions.includes(condition) ? 'critical' : 'high';\n    }\n    if (clinicalLevel === 'moderate') return 'moderate';\n\n    return 'low';\n  }\n\n  /**\n   * Calculate treatment priority (1-10 scale)\n   */\n  private calculatePriority(\n    condition: string,\n    clinicalLevel: string,\n    riskLevel: string,\n  ): number {\n    let priority = 1;\n\n    // Base priority by clinical level\n    const levelPriorities = {\n      extreme: 10,\n      severe: 8,\n      moderate: 6,\n      mild: 4,\n      subclinical: 2,\n    };\n    priority = levelPriorities[clinicalLevel] || 1;\n\n    // Adjust for condition-specific factors\n    const highPriorityConditions = [\n      'Depression',\n      'Bipolar disorder (BD)',\n      'Post-traumatic stress disorder (PTSD)',\n      'Substance or Alcohol Use Issues',\n    ];\n\n    if (highPriorityConditions.includes(condition)) {\n      priority += 1;\n    }\n\n    // Risk level adjustments\n    if (riskLevel === 'critical') priority = 10;\n    else if (riskLevel === 'high') priority = Math.max(priority, 8);\n\n    return Math.max(1, Math.min(10, priority));\n  }\n\n  /**\n   * Get key clinical indicators for a condition\n   */\n  private getKeyIndicators(\n    condition: string,\n    score: number,\n    clinicalLevel: string,\n  ): string[] {\n    const indicators: Record<string, string[]> = {\n      Depression: [\n        'Persistent low mood and sadness',\n        'Loss of interest in previously enjoyed activities',\n        'Fatigue and decreased energy',\n        'Sleep disturbances',\n        'Appetite changes',\n        'Feelings of worthlessness or guilt',\n        'Difficulty concentrating',\n        'Psychomotor agitation or retardation',\n      ],\n      Anxiety: [\n        'Excessive worry and apprehension',\n        'Restlessness and feeling on edge',\n        'Difficulty concentrating',\n        'Irritability',\n        'Muscle tension',\n        'Sleep difficulties',\n        'Fatigue from worry',\n      ],\n      'Post-traumatic stress disorder (PTSD)': [\n        'Re-experiencing traumatic events',\n        'Avoidance of trauma-related stimuli',\n        'Negative alterations in mood and cognition',\n        'Hypervigilance and exaggerated startle response',\n        'Sleep disturbances and nightmares',\n        'Emotional numbing',\n        'Intrusive thoughts and flashbacks',\n      ],\n      'Bipolar disorder (BD)': [\n        'Mood episodes (manic or depressive)',\n        'Elevated or irritable mood',\n        'Decreased need for sleep during episodes',\n        'Racing thoughts and pressured speech',\n        'Grandiosity or inflated self-esteem',\n        'Distractibility',\n        'Increased goal-directed activity',\n      ],\n    };\n\n    const baseIndicators = indicators[condition] || [\n      `Elevated ${condition.toLowerCase()} symptoms`,\n      'Functional impairment in daily activities',\n      'Distress related to symptoms',\n    ];\n\n    // Filter indicators based on severity\n    if (clinicalLevel === 'mild') return baseIndicators.slice(0, 3);\n    if (clinicalLevel === 'moderate') return baseIndicators.slice(0, 5);\n    return baseIndicators;\n  }\n\n  /**\n   * Get therapeutic focus areas for a condition\n   */\n  private getTherapeuticFocus(\n    condition: string,\n    clinicalLevel: string,\n  ): string[] {\n    const focusAreas: Record<string, string[]> = {\n      Depression: [\n        'Cognitive restructuring and thought challenging',\n        'Behavioral activation and activity scheduling',\n        'Mood monitoring and regulation',\n        'Social support and interpersonal skills',\n      ],\n      Anxiety: [\n        'Anxiety management techniques',\n        'Exposure therapy for specific fears',\n        'Relaxation and mindfulness training',\n        'Cognitive restructuring for worry',\n      ],\n      'Post-traumatic stress disorder (PTSD)': [\n        'Trauma processing and integration',\n        'EMDR or trauma-focused therapy',\n        'Coping skills for triggers',\n        'Safety and stabilization',\n      ],\n      'Bipolar disorder (BD)': [\n        'Mood stabilization techniques',\n        'Medication adherence support',\n        'Trigger identification and management',\n        'Psychoeducation about bipolar disorder',\n      ],\n    };\n\n    return (\n      focusAreas[condition] || [\n        'Symptom management',\n        'Coping strategies development',\n        'Functional improvement',\n      ]\n    );\n  }\n\n  /**\n   * Get specific recommendations for a condition\n   */\n  private getConditionRecommendations(\n    condition: string,\n    clinicalLevel: string,\n    riskLevel: string,\n  ): string[] {\n    const recommendations: string[] = [];\n\n    // Urgency-based recommendations\n    if (riskLevel === 'critical' || clinicalLevel === 'extreme') {\n      recommendations.push('Immediate psychiatric evaluation recommended');\n      recommendations.push('Consider crisis intervention services');\n    }\n\n    // Condition-specific recommendations\n    const conditionRecs: Record<string, string[]> = {\n      Depression: [\n        'Cognitive Behavioral Therapy (CBT) strongly recommended',\n        'Consider medication evaluation with psychiatrist',\n        'Regular mood monitoring and safety planning',\n      ],\n      Anxiety: [\n        'CBT or Acceptance and Commitment Therapy (ACT)',\n        'Mindfulness and relaxation training',\n        'Gradual exposure to anxiety triggers',\n      ],\n      'Post-traumatic stress disorder (PTSD)': [\n        'Trauma-focused therapy (EMDR, CPT, or PE)',\n        'Specialized PTSD treatment program',\n        'Safety planning and stabilization first',\n      ],\n    };\n\n    recommendations.push(\n      ...(conditionRecs[condition] || [\n        'Evidence-based psychotherapy',\n        'Regular monitoring of symptoms',\n        'Psychoeducation about the condition',\n      ]),\n    );\n\n    return recommendations;\n  }\n\n  /**\n   * Categorize conditions into primary and secondary based on severity and risk\n   */\n  private categorizeConditions(insights: ClinicalInsight[]): {\n    primaryConditions: ClinicalInsight[];\n    secondaryConditions: ClinicalInsight[];\n  } {\n    const primaryConditions = insights.filter(\n      (insight) =>\n        insight.priority >= 7 ||\n        insight.riskLevel === 'critical' ||\n        insight.riskLevel === 'high',\n    );\n\n    const secondaryConditions = insights.filter(\n      (insight) =>\n        insight.priority < 7 &&\n        insight.riskLevel !== 'critical' &&\n        insight.riskLevel !== 'high',\n    );\n\n    return { primaryConditions, secondaryConditions };\n  }\n\n  /**\n   * Assess overall risk factors requiring immediate attention\n   */\n  private assessRiskFactors(\n    insights: ClinicalInsight[],\n    scores: QuestionnaireScores,\n  ): RiskFactor[] {\n    const riskFactors: RiskFactor[] = [];\n\n    // Check for suicide/self-harm risk\n    const depressionInsight = insights.find(\n      (i) => i.condition === 'Depression',\n    );\n    if (\n      depressionInsight &&\n      (depressionInsight.clinicalLevel === 'severe' ||\n        depressionInsight.clinicalLevel === 'extreme')\n    ) {\n      riskFactors.push({\n        type: 'suicide',\n        level:\n          depressionInsight.clinicalLevel === 'extreme' ? 'critical' : 'high',\n        indicators: [\n          'Severe depression symptoms',\n          'High risk for suicidal ideation',\n        ],\n        urgency:\n          depressionInsight.clinicalLevel === 'extreme'\n            ? 'immediate'\n            : 'within_week',\n      });\n    }\n\n    // Check for substance abuse risk\n    const substanceInsight = insights.find(\n      (i) =>\n        i.condition.includes('Substance') || i.condition.includes('Alcohol'),\n    );\n    if (substanceInsight && substanceInsight.clinicalLevel !== 'subclinical') {\n      riskFactors.push({\n        type: 'substance_abuse',\n        level: substanceInsight.riskLevel,\n        indicators: [\n          'Problematic substance use patterns',\n          'Risk for dependence',\n        ],\n        urgency:\n          substanceInsight.riskLevel === 'critical'\n            ? 'immediate'\n            : 'within_month',\n      });\n    }\n\n    // Check for mania risk (bipolar)\n    const bipolarInsight = insights.find((i) =>\n      i.condition.includes('Bipolar'),\n    );\n    if (\n      bipolarInsight &&\n      (bipolarInsight.clinicalLevel === 'severe' ||\n        bipolarInsight.clinicalLevel === 'extreme')\n    ) {\n      riskFactors.push({\n        type: 'mania',\n        level: 'high',\n        indicators: ['Manic episode indicators', 'Mood instability'],\n        urgency: 'within_week',\n      });\n    }\n\n    return riskFactors;\n  }\n\n  /**\n   * Calculate overall risk level based on all factors\n   */\n  private calculateOverallRiskLevel(\n    riskFactors: RiskFactor[],\n    primaryConditions: ClinicalInsight[],\n  ): 'low' | 'moderate' | 'high' | 'critical' {\n    // Check for critical risk factors\n    if (\n      riskFactors.some((rf) => rf.level === 'critical') ||\n      primaryConditions.some((pc) => pc.riskLevel === 'critical')\n    ) {\n      return 'critical';\n    }\n\n    // Check for high risk\n    if (\n      riskFactors.some((rf) => rf.level === 'high') ||\n      primaryConditions.some((pc) => pc.riskLevel === 'high')\n    ) {\n      return 'high';\n    }\n\n    // Check for moderate risk\n    if (primaryConditions.some((pc) => pc.riskLevel === 'moderate')) {\n      return 'moderate';\n    }\n\n    return 'low';\n  }\n\n  /**\n   * Generate therapeutic priorities based on primary conditions\n   */\n  private generateTherapeuticPriorities(\n    primaryConditions: ClinicalInsight[],\n  ): string[] {\n    const priorities: string[] = [];\n\n    // Safety first\n    if (primaryConditions.some((pc) => pc.riskLevel === 'critical')) {\n      priorities.push('Crisis intervention and safety planning');\n    }\n\n    // Primary symptoms\n    primaryConditions\n      .sort((a, b) => b.priority - a.priority)\n      .forEach((condition) => {\n        priorities.push(`${condition.condition} management and treatment`);\n      });\n\n    // Functional improvement\n    priorities.push('Functional capacity and quality of life improvement');\n    priorities.push('Long-term relapse prevention');\n\n    return priorities.slice(0, 5); // Top 5 priorities\n  }\n\n  /**\n   * Generate comprehensive treatment recommendations\n   */\n  private generateTreatmentRecommendations(\n    primaryConditions: ClinicalInsight[],\n    secondaryConditions: ClinicalInsight[],\n    riskFactors: RiskFactor[],\n  ): TreatmentRecommendation[] {\n    const recommendations: TreatmentRecommendation[] = [];\n\n    // Primary conditions recommendations\n    primaryConditions.forEach((condition, index) => {\n      recommendations.push({\n        priority: index + 1,\n        condition: condition.condition,\n        approach: this.getRecommendedApproaches(\n          condition.condition,\n          condition.clinicalLevel,\n        ),\n        specialization: [condition.condition, 'Clinical Psychology'],\n        urgency: this.mapRiskToUrgency(condition.riskLevel),\n        estimatedDuration: this.estimateTreatmentDuration(\n          condition.clinicalLevel,\n        ),\n        goals: this.getTherapeuticGoals(\n          condition.condition,\n          condition.clinicalLevel,\n        ),\n      });\n    });\n\n    // Risk-based emergency recommendations\n    riskFactors.forEach((risk) => {\n      if (risk.urgency === 'immediate') {\n        recommendations.unshift({\n          priority: 0, // Highest priority\n          condition: risk.type.replace('_', ' '),\n          approach: ['Crisis Intervention', 'Safety Planning'],\n          specialization: ['Crisis Intervention', 'Emergency Psychology'],\n          urgency: 'immediate',\n          estimatedDuration: 'Immediate assessment',\n          goals: ['Ensure safety', 'Stabilize acute symptoms'],\n        });\n      }\n    });\n\n    return recommendations;\n  }\n\n  /**\n   * Get recommended therapeutic approaches for a condition\n   */\n  private getRecommendedApproaches(\n    condition: string,\n    clinicalLevel: string,\n  ): string[] {\n    const approaches: Record<string, string[]> = {\n      Depression: [\n        'Cognitive Behavioral Therapy (CBT)',\n        'Interpersonal Therapy (IPT)',\n        'Mindfulness-Based Cognitive Therapy',\n      ],\n      Anxiety: [\n        'Cognitive Behavioral Therapy (CBT)',\n        'Acceptance and Commitment Therapy (ACT)',\n        'Exposure Therapy',\n      ],\n      'Post-traumatic stress disorder (PTSD)': [\n        'EMDR',\n        'Cognitive Processing Therapy',\n        'Prolonged Exposure Therapy',\n      ],\n      'Bipolar disorder (BD)': [\n        'Dialectical Behavior Therapy (DBT)',\n        'Cognitive Behavioral Therapy (CBT)',\n        'Psychoeducation',\n      ],\n    };\n\n    return (\n      approaches[condition] || [\n        'Cognitive Behavioral Therapy (CBT)',\n        'Psychodynamic Therapy',\n      ]\n    );\n  }\n\n  /**\n   * Map risk level to treatment urgency\n   */\n  private mapRiskToUrgency(\n    riskLevel: string,\n  ): 'immediate' | 'high' | 'moderate' | 'routine' {\n    const mapping = {\n      critical: 'immediate' as const,\n      high: 'high' as const,\n      moderate: 'moderate' as const,\n      low: 'routine' as const,\n    };\n    return mapping[riskLevel] || 'routine';\n  }\n\n  /**\n   * Estimate treatment duration based on severity\n   */\n  private estimateTreatmentDuration(clinicalLevel: string): string {\n    const durations = {\n      extreme: '12-18 months intensive therapy',\n      severe: '6-12 months regular therapy',\n      moderate: '3-6 months therapy',\n      mild: '2-4 months therapy',\n      subclinical: '1-2 months brief intervention',\n    };\n    return durations[clinicalLevel] || '3-6 months therapy';\n  }\n\n  /**\n   * Get therapeutic goals for a condition\n   */\n  private getTherapeuticGoals(\n    condition: string,\n    clinicalLevel: string,\n  ): string[] {\n    const goals: Record<string, string[]> = {\n      Depression: [\n        'Reduce depressive symptoms',\n        'Improve mood regulation',\n        'Increase behavioral activation',\n        'Enhance coping strategies',\n      ],\n      Anxiety: [\n        'Reduce anxiety symptoms',\n        'Develop relaxation skills',\n        'Increase tolerance for uncertainty',\n        'Improve daily functioning',\n      ],\n    };\n\n    return (\n      goals[condition] || [\n        'Reduce symptom severity',\n        'Improve functional capacity',\n        'Develop coping strategies',\n        'Prevent relapse',\n      ]\n    );\n  }\n\n  /**\n   * Generate clinical summary\n   */\n  private generateClinicalSummary(\n    primaryConditions: ClinicalInsight[],\n    secondaryConditions: ClinicalInsight[],\n    overallRiskLevel: string,\n  ): string {\n    const primaryCount = primaryConditions.length;\n    const secondaryCount = secondaryConditions.length;\n\n    let summary = `Clinical assessment reveals `;\n\n    if (primaryCount > 0) {\n      const primaryNames = primaryConditions.map((c) => c.condition).join(', ');\n      summary += `${primaryCount} primary condition(s) requiring immediate attention: ${primaryNames}. `;\n    }\n\n    if (secondaryCount > 0) {\n      summary += `${secondaryCount} secondary condition(s) identified for ongoing monitoring. `;\n    }\n\n    summary += `Overall risk level: ${overallRiskLevel}. `;\n\n    if (overallRiskLevel === 'critical' || overallRiskLevel === 'high') {\n      summary += 'Immediate professional intervention recommended.';\n    } else if (overallRiskLevel === 'moderate') {\n      summary += 'Regular therapeutic support recommended.';\n    } else {\n      summary += 'Preventive intervention and monitoring recommended.';\n    }\n\n    return summary;\n  }\n}\n"],"version":3}