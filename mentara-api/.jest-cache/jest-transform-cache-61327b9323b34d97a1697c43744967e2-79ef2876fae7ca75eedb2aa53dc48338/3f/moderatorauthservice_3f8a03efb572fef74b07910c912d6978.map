{"version":3,"names":["cov_qccq1hwvx","actualCoverage","common_1","s","require","prisma_client_provider_1","token_service_1","email_verification_service_1","bcrypt","ModeratorAuthService","prisma","tokenService","emailVerificationService","constructor","f","createModeratorAccount","email","password","firstName","lastName","permissions","b","assignedCommunities","existingUser","user","findUnique","where","BadRequestException","hashedPassword","hash","result","$transaction","tx","create","data","role","emailVerified","moderator","userId","id","length","message","loginModerator","ipAddress","userAgent","findFirst","include","UnauthorizedException","lockoutUntil","Date","isPasswordValid","compare","handleFailedLogin","update","failedLoginCount","lastLoginAt","token","generateToken","getModeratorProfile","moderatorCommunities","community","select","name","slug","getModeratorPermissions","getAssignedCommunities","communityIds","Array","isArray","findMany","in","description","createdAt","getModeratorDashboardStats","map","mc","communityId","totalManagedCommunities","totalMembersInManagedCommunities","totalPostsInManagedCommunities","totalReportsInManagedCommunities","Promise","all","count","membership","post","report","status","pendingJoinRequests","newFailedCount","maxAttempts","lockoutDuration","updateData","now","exports","__decorate","Injectable","PrismaService","_a","Object","_b","TokenService","_c","EmailVerificationService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/moderator-auth.service.ts"],"sourcesContent":["import {\n  Injectable,\n  UnauthorizedException,\n  BadRequestException,\n} from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { TokenService } from './token.service';\nimport { EmailVerificationService } from './email-verification.service';\nimport * as bcrypt from 'bcrypt';\n\n@Injectable()\nexport class ModeratorAuthService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly tokenService: TokenService,\n    private readonly emailVerificationService: EmailVerificationService,\n  ) {}\n\n  async createModeratorAccount(\n    email: string,\n    password: string,\n    firstName: string,\n    lastName: string,\n    permissions: string[] = [],\n    assignedCommunities: string[] = [],\n  ) {\n    // Check if user already exists\n    const existingUser = await this.prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (existingUser) {\n      throw new BadRequestException('User with this email already exists');\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(password, 12);\n\n    // Create user and moderator profile in transaction\n    const result = await this.prisma.$transaction(async (tx) => {\n      const user = await tx.user.create({\n        data: {\n          email,\n          password: hashedPassword,\n          firstName,\n          lastName,\n          role: 'moderator',\n          emailVerified: true, // Moderators are pre-verified\n        },\n      });\n\n      const moderator = await tx.moderator.create({\n        data: {\n          userId: user.id,\n          permissions,\n          assignedCommunities:\n            assignedCommunities.length > 0 ? assignedCommunities : [],\n        },\n      });\n\n      return { user, moderator };\n    });\n\n    return {\n      user: result.user,\n      message: 'Moderator account created successfully.',\n    };\n  }\n\n  async loginModerator(\n    email: string,\n    password: string,\n    ipAddress?: string,\n    userAgent?: string,\n  ) {\n    // Find user with moderator role\n    const user = await this.prisma.user.findFirst({\n      where: {\n        email,\n        role: 'moderator',\n      },\n      include: {\n        moderator: true,\n      },\n    });\n\n    if (!user) {\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Check if account is locked\n    if (user.lockoutUntil && user.lockoutUntil > new Date()) {\n      throw new UnauthorizedException(\n        'Account is temporarily locked due to failed login attempts',\n      );\n    }\n\n    // Verify password\n    if (!user.password) {\n      throw new UnauthorizedException('Account setup incomplete');\n    }\n    const isPasswordValid = await bcrypt.compare(password, user.password);\n    if (!isPasswordValid) {\n      // Increment failed login count\n      await this.handleFailedLogin(user.id);\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Reset failed login count and update last login\n    await this.prisma.user.update({\n      where: { id: user.id },\n      data: {\n        failedLoginCount: 0,\n        lockoutUntil: null,\n        lastLoginAt: new Date(),\n      },\n    });\n\n    // Generate single token\n    const { token } = await this.tokenService.generateToken(\n      user.id,\n      user.email,\n      user.role,\n    );\n\n    return {\n      user,\n      token,\n    };\n  }\n\n  async getModeratorProfile(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      include: {\n        moderator: {\n          include: {\n            moderatorCommunities: {\n              include: {\n                community: {\n                  select: {\n                    id: true,\n                    name: true,\n                    slug: true,\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!user || user.role !== 'moderator') {\n      throw new UnauthorizedException('Moderator not found');\n    }\n\n    return user;\n  }\n\n  async getModeratorPermissions(userId: string) {\n    const moderator = await this.prisma.moderator.findUnique({\n      where: { userId },\n      select: {\n        permissions: true,\n        assignedCommunities: true,\n      },\n    });\n\n    if (!moderator) {\n      throw new UnauthorizedException('Moderator not found');\n    }\n\n    return moderator;\n  }\n\n  async getAssignedCommunities(userId: string) {\n    const moderator = await this.prisma.moderator.findUnique({\n      where: { userId },\n      select: {\n        assignedCommunities: true,\n      },\n    });\n\n    if (!moderator) {\n      throw new UnauthorizedException('Moderator not found');\n    }\n\n    // If assignedCommunities is stored as JSON array of community IDs\n    const communityIds = Array.isArray(moderator.assignedCommunities)\n      ? (moderator.assignedCommunities as string[])\n      : [];\n\n    if (communityIds.length === 0) {\n      return [];\n    }\n\n    // Get the actual community data\n    return this.prisma.community.findMany({\n      where: {\n        id: { in: communityIds },\n      },\n      select: {\n        id: true,\n        name: true,\n        slug: true,\n        description: true,\n        createdAt: true,\n      },\n    });\n  }\n\n  async getModeratorDashboardStats(userId: string) {\n    const moderator = await this.prisma.moderator.findUnique({\n      where: { userId },\n      include: {\n        moderatorCommunities: true,\n      },\n    });\n\n    if (!moderator) {\n      throw new UnauthorizedException('Moderator not found');\n    }\n\n    const communityIds = moderator.moderatorCommunities.map(\n      (mc) => mc.communityId,\n    );\n\n    // Get statistics for communities the moderator manages\n    const [\n      totalManagedCommunities,\n      totalMembersInManagedCommunities,\n      totalPostsInManagedCommunities,\n      totalReportsInManagedCommunities,\n    ] = await Promise.all([\n      this.prisma.community.count({\n        where: { id: { in: communityIds } },\n      }),\n      this.prisma.membership.count({\n        where: { communityId: { in: communityIds } },\n      }),\n      this.prisma.post.count(),\n      this.prisma.report.count({\n        where: {\n          status: 'PENDING',\n        },\n      }),\n    ]);\n\n    const pendingJoinRequests = 0; // Simplified - no complex join request system\n\n    return {\n      totalManagedCommunities,\n      totalMembersInManagedCommunities,\n      pendingJoinRequests,\n      totalPostsInManagedCommunities,\n      totalReportsInManagedCommunities,\n    };\n  }\n\n  private async handleFailedLogin(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      select: { failedLoginCount: true },\n    });\n\n    const newFailedCount = (user?.failedLoginCount || 0) + 1;\n    const maxAttempts = 5;\n    const lockoutDuration = 30 * 60 * 1000; // 30 minutes\n\n    const updateData: any = {\n      failedLoginCount: newFailedCount,\n    };\n\n    if (newFailedCount >= maxAttempts) {\n      updateData.lockoutUntil = new Date(Date.now() + lockoutDuration);\n    }\n\n    await this.prisma.user.update({\n      where: { id: userId },\n      data: updateData,\n    });\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}