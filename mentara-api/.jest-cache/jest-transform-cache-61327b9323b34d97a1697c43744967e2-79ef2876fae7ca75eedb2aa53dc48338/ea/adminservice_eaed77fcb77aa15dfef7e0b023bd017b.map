{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/admin.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/admin.service.ts"],"sourcesContent":["import {\n  Injectable,\n  Logger,\n  NotFoundException,\n  ConflictException,\n} from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport {\n  type CreateAdminDto,\n  type UpdateAdminDto,\n  type AdminResponseDto,\n} from 'mentara-commons';\nimport { Prisma } from '@prisma/client';\n\n@Injectable()\nexport class AdminService {\n  private readonly logger = new Logger(AdminService.name);\n\n  constructor(private prisma: PrismaService) {}\n\n  async findAll(): Promise<AdminResponseDto[]> {\n    try {\n      const admins = await this.prisma.admin.findMany({\n        orderBy: { createdAt: 'desc' },\n      });\n\n      return admins.map((admin) => ({\n        userId: admin.userId,\n        permissions: admin.permissions,\n        adminLevel: admin.adminLevel,\n        createdAt: admin.createdAt,\n        updatedAt: admin.updatedAt,\n      }));\n    } catch (error) {\n      this.logger.error('Failed to retrieve admins:', error);\n      throw error;\n    }\n  }\n\n  async findOne(id: string): Promise<AdminResponseDto | null> {\n    try {\n      const admin = await this.prisma.admin.findUnique({\n        where: { userId: id },\n      });\n\n      if (!admin) {\n        return null;\n      }\n\n      return {\n        userId: admin.userId,\n        permissions: admin.permissions,\n        adminLevel: admin.adminLevel,\n        createdAt: admin.createdAt,\n        updatedAt: admin.updatedAt,\n      };\n    } catch (error) {\n      this.logger.error(`Failed to retrieve admin ${id}:`, error);\n      throw error;\n    }\n  }\n\n  async create(data: CreateAdminDto): Promise<AdminResponseDto> {\n    try {\n      // First check if user exists\n      const userExists = await this.prisma.user.findUnique({\n        where: { id: data.userId },\n      });\n\n      if (!userExists) {\n        throw new NotFoundException(`User with ID ${data.userId} not found`);\n      }\n\n      // Check if admin already exists\n      const existingAdmin = await this.prisma.admin.findUnique({\n        where: { userId: data.userId },\n      });\n\n      if (existingAdmin) {\n        throw new ConflictException(`User ${data.userId} is already an admin`);\n      }\n\n      const admin = await this.prisma.admin.create({\n        data: {\n          userId: data.userId,\n          permissions: data.permissions,\n          adminLevel: data.adminLevel ?? 'admin',\n        },\n      });\n\n      this.logger.log(`Created admin for user ${data.userId}`);\n\n      return {\n        userId: admin.userId,\n        permissions: admin.permissions,\n        adminLevel: admin.adminLevel,\n        createdAt: admin.createdAt,\n        updatedAt: admin.updatedAt,\n      };\n    } catch (error) {\n      if (\n        error instanceof NotFoundException ||\n        error instanceof ConflictException\n      ) {\n        throw error;\n      }\n\n      if (error instanceof Prisma.PrismaClientKnownRequestError) {\n        if (error.code === 'P2002') {\n          throw new ConflictException(\n            `User ${data.userId} is already an admin`,\n          );\n        }\n        if (error.code === 'P2003') {\n          throw new NotFoundException(`User with ID ${data.userId} not found`);\n        }\n      }\n\n      this.logger.error('Failed to create admin:', error);\n      throw error;\n    }\n  }\n\n  async update(id: string, data: UpdateAdminDto): Promise<AdminResponseDto> {\n    try {\n      const admin = await this.prisma.admin.update({\n        where: { userId: id },\n        data: {\n          permissions: data.permissions,\n          adminLevel: data.adminLevel,\n        },\n      });\n\n      this.logger.log(`Updated admin ${id}`);\n\n      return {\n        userId: admin.userId,\n        permissions: admin.permissions,\n        adminLevel: admin.adminLevel,\n        createdAt: admin.createdAt,\n        updatedAt: admin.updatedAt,\n      };\n    } catch (error) {\n      if (error instanceof Prisma.PrismaClientKnownRequestError) {\n        if (error.code === 'P2025') {\n          throw new NotFoundException(`Admin with ID ${id} not found`);\n        }\n      }\n\n      this.logger.error(`Failed to update admin ${id}:`, error);\n      throw error;\n    }\n  }\n\n  async remove(id: string): Promise<void> {\n    try {\n      await this.prisma.admin.delete({ where: { userId: id } });\n      this.logger.log(`Deleted admin ${id}`);\n    } catch (error) {\n      if (error instanceof Prisma.PrismaClientKnownRequestError) {\n        if (error.code === 'P2025') {\n          throw new NotFoundException(`Admin with ID ${id} not found`);\n        }\n      }\n\n      this.logger.error(`Failed to delete admin ${id}:`, error);\n      throw error;\n    }\n  }\n\n  // ===== THERAPIST APPLICATION MANAGEMENT =====\n\n  async getAllTherapistApplications(params: {\n    status?: string;\n    page: number;\n    limit: number;\n  }) {\n    try {\n      const { status, page, limit } = params;\n      const skip = (page - 1) * limit;\n\n      const where: any = {};\n      if (status) {\n        where.status = status;\n      }\n\n      const [applications, totalCount] = await Promise.all([\n        this.prisma.therapist.findMany({\n          where,\n          skip,\n          take: limit,\n          orderBy: { submissionDate: 'desc' },\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                email: true,\n                createdAt: true,\n              },\n            },\n            processedByAdmin: {\n              include: {\n                user: {\n                  select: {\n                    firstName: true,\n                    lastName: true,\n                  },\n                },\n              },\n            },\n          },\n        }),\n        this.prisma.therapist.count({ where }),\n      ]);\n\n      return {\n        applications,\n        totalCount,\n        page,\n        totalPages: Math.ceil(totalCount / limit),\n      };\n    } catch (error) {\n      this.logger.error('Failed to retrieve therapist applications:', error);\n      throw error;\n    }\n  }\n\n  async getTherapistApplication(applicationId: string) {\n    try {\n      return await this.prisma.therapist.findUnique({\n        where: { userId: applicationId },\n        include: {\n          user: true,\n          processedByAdmin: {\n            include: {\n              user: {\n                select: {\n                  firstName: true,\n                  lastName: true,\n                },\n              },\n            },\n          },\n        },\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve therapist application:', error);\n      throw error;\n    }\n  }\n\n  async approveTherapistApplication(\n    applicationId: string,\n    adminId: string,\n    notes?: string,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // Update therapist status\n        const therapist = await tx.therapist.update({\n          where: { userId: applicationId },\n          data: {\n            status: 'approved',\n            processedByAdminId: adminId,\n            processingDate: new Date(),\n          },\n        });\n\n        // Update user role\n        await tx.user.update({\n          where: { id: applicationId },\n          data: { role: 'therapist' },\n        });\n\n        // Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'APPROVE_THERAPIST_APPLICATION',\n            entity: 'therapist',\n            entityId: applicationId,\n            metadata: {\n              applicationId,\n              notes,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        return { success: true, therapist };\n      });\n    } catch (error) {\n      this.logger.error('Failed to approve therapist application:', error);\n      throw error;\n    }\n  }\n\n  async rejectTherapistApplication(\n    applicationId: string,\n    adminId: string,\n    reason: string,\n    notes?: string,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // Update therapist status\n        const therapist = await tx.therapist.update({\n          where: { userId: applicationId },\n          data: {\n            status: 'rejected',\n            processedByAdminId: adminId,\n            processingDate: new Date(),\n          },\n        });\n\n        // Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'REJECT_THERAPIST_APPLICATION',\n            entity: 'therapist',\n            entityId: applicationId,\n            metadata: {\n              applicationId,\n              reason,\n              notes,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        return { success: true, therapist, reason };\n      });\n    } catch (error) {\n      this.logger.error('Failed to reject therapist application:', error);\n      throw error;\n    }\n  }\n\n  // ===== USER MANAGEMENT =====\n\n  async getAllUsers(params: {\n    role?: string;\n    page: number;\n    limit: number;\n    search?: string;\n    status?: string;\n    sortBy?: string;\n    sortOrder?: string;\n  }) {\n    try {\n      const { role, page, limit, search, status, sortBy, sortOrder } = params;\n      const skip = (page - 1) * limit;\n\n      const where: any = {};\n      if (role) {\n        where.role = role;\n      }\n      if (search) {\n        where.OR = [\n          { firstName: { contains: search, mode: 'insensitive' } },\n          { lastName: { contains: search, mode: 'insensitive' } },\n          { email: { contains: search, mode: 'insensitive' } },\n        ];\n      }\n      if (status) {\n        if (status === 'active') {\n          where.isActive = true;\n        } else if (status === 'inactive') {\n          where.isActive = false;\n        } else if (status === 'suspended') {\n          where.suspendedAt = { not: null };\n        }\n      }\n\n      // Build orderBy clause\n      const orderBy: any = {};\n      if (\n        sortBy &&\n        ['createdAt', 'firstName', 'lastName', 'email', 'role'].includes(sortBy)\n      ) {\n        orderBy[sortBy] = sortOrder === 'asc' ? 'asc' : 'desc';\n      } else {\n        orderBy.createdAt = 'desc';\n      }\n\n      const [users, totalCount] = await Promise.all([\n        this.prisma.user.findMany({\n          where,\n          skip,\n          take: limit,\n          orderBy,\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            email: true,\n            role: true,\n            isActive: true,\n            isVerified: true,\n            createdAt: true,\n            lastLoginAt: true,\n            suspendedAt: true,\n            suspensionReason: true,\n          },\n        }),\n        this.prisma.user.count({ where }),\n      ]);\n\n      return {\n        users,\n        totalCount,\n        page,\n        totalPages: Math.ceil(totalCount / limit),\n      };\n    } catch (error) {\n      this.logger.error('Failed to retrieve users:', error);\n      throw error;\n    }\n  }\n\n  async getUser(userId: string) {\n    try {\n      return await this.prisma.user.findUnique({\n        where: { id: userId },\n        include: {\n          client: true,\n          therapist: true,\n          admin: true,\n          moderator: true,\n        },\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve user:', error);\n      throw error;\n    }\n  }\n\n  async suspendUser(\n    userId: string,\n    adminId: string,\n    reason: string,\n    duration?: number,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        const suspensionEnd = duration\n          ? new Date(Date.now() + duration * 24 * 60 * 60 * 1000)\n          : null;\n\n        const user = await tx.user.update({\n          where: { id: userId },\n          data: {\n            suspendedAt: new Date(),\n            suspendedBy: adminId,\n            suspensionReason: reason,\n            isActive: false,\n          },\n        });\n\n        // Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'SUSPEND_USER',\n            entity: 'user',\n            entityId: userId,\n            metadata: {\n              userId,\n              reason,\n              duration,\n              suspensionEnd: suspensionEnd?.toISOString(),\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        return { success: true, user };\n      });\n    } catch (error) {\n      this.logger.error('Failed to suspend user:', error);\n      throw error;\n    }\n  }\n\n  async unsuspendUser(userId: string, adminId: string) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        const user = await tx.user.update({\n          where: { id: userId },\n          data: {\n            suspendedAt: null,\n            suspendedBy: null,\n            suspensionReason: null,\n            isActive: true,\n          },\n        });\n\n        // Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'UNSUSPEND_USER',\n            entity: 'user',\n            entityId: userId,\n            metadata: {\n              userId,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        return { success: true, user };\n      });\n    } catch (error) {\n      this.logger.error('Failed to unsuspend user:', error);\n      throw error;\n    }\n  }\n\n  // ===== PLATFORM ANALYTICS =====\n\n  async getPlatformOverview() {\n    try {\n      const [\n        totalUsers,\n        totalClients,\n        totalTherapists,\n        pendingApplications,\n        totalCommunities,\n        totalPosts,\n        totalSessions,\n      ] = await Promise.all([\n        this.prisma.user.count(),\n        this.prisma.client.count(),\n        this.prisma.therapist.count({ where: { status: 'approved' } }),\n        this.prisma.therapist.count({ where: { status: 'pending' } }),\n        this.prisma.community.count(),\n        this.prisma.post.count(),\n        this.prisma.meeting.count(),\n      ]);\n\n      const recentActivity = await this.prisma.user.findMany({\n        take: 10,\n        orderBy: { createdAt: 'desc' },\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          role: true,\n          createdAt: true,\n        },\n      });\n\n      return {\n        overview: {\n          totalUsers,\n          totalClients,\n          totalTherapists,\n          pendingApplications,\n          totalCommunities,\n          totalPosts,\n          totalSessions,\n        },\n        recentActivity,\n      };\n    } catch (error) {\n      this.logger.error('Failed to retrieve platform overview:', error);\n      throw error;\n    }\n  }\n\n  async getMatchingPerformance(startDate?: string, endDate?: string) {\n    try {\n      const start = startDate\n        ? new Date(startDate)\n        : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n      const end = endDate ? new Date(endDate) : new Date();\n\n      const matchingMetrics = await this.prisma.matchHistory.findMany({\n        where: {\n          createdAt: {\n            gte: start,\n            lte: end,\n          },\n        },\n      });\n\n      const totalRecommendations = matchingMetrics.length;\n      const successfulMatches = matchingMetrics.filter(\n        (m) => m.becameClient,\n      ).length;\n      const viewedRecommendations = matchingMetrics.filter(\n        (m) => m.wasViewed,\n      ).length;\n      const contactedTherapists = matchingMetrics.filter(\n        (m) => m.wasContacted,\n      ).length;\n\n      const averageMatchScore =\n        totalRecommendations > 0\n          ? matchingMetrics.reduce((sum, m) => sum + m.totalScore, 0) /\n            totalRecommendations\n          : 0;\n\n      const conversionRate =\n        totalRecommendations > 0\n          ? (successfulMatches / totalRecommendations) * 100\n          : 0;\n\n      const clickThroughRate =\n        totalRecommendations > 0\n          ? (viewedRecommendations / totalRecommendations) * 100\n          : 0;\n\n      return {\n        period: { start, end },\n        metrics: {\n          totalRecommendations,\n          successfulMatches,\n          viewedRecommendations,\n          contactedTherapists,\n          averageMatchScore,\n          conversionRate,\n          clickThroughRate,\n        },\n      };\n    } catch (error) {\n      this.logger.error('Failed to retrieve matching performance:', error);\n      throw error;\n    }\n  }\n\n  // ===== CONTENT MODERATION =====\n\n  async getFlaggedContent(params: {\n    type?: string;\n    page: number;\n    limit: number;\n  }) {\n    try {\n      const { type, page, limit } = params;\n      const skip = (page - 1) * limit;\n\n      // For now, we'll consider posts and comments that might need moderation\n      // In a real system, you'd have a flagging mechanism\n      const flaggedPosts = await this.prisma.post.findMany({\n        where: {\n          // Add conditions for flagged content\n          // For now, let's get recent posts that might need review\n        },\n        skip,\n        take: type === 'comment' ? 0 : limit,\n        orderBy: { createdAt: 'desc' },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n            },\n          },\n          room: {\n            select: {\n              name: true,\n              roomGroup: {\n                select: {\n                  community: {\n                    select: {\n                      name: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      const flaggedComments = await this.prisma.comment.findMany({\n        where: {\n          // Add conditions for flagged content\n        },\n        skip: type === 'post' ? 0 : skip,\n        take: type === 'post' ? 0 : limit,\n        orderBy: { createdAt: 'desc' },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n            },\n          },\n          post: {\n            select: {\n              title: true,\n            },\n          },\n        },\n      });\n\n      return {\n        posts: flaggedPosts,\n        comments: flaggedComments,\n        page,\n        totalItems: flaggedPosts.length + flaggedComments.length,\n      };\n    } catch (error) {\n      this.logger.error('Failed to retrieve flagged content:', error);\n      throw error;\n    }\n  }\n\n  async moderateContent(\n    contentType: string,\n    contentId: string,\n    adminId: string,\n    action: 'approve' | 'remove' | 'flag',\n    reason?: string,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        let moderatedContent;\n\n        if (contentType === 'post') {\n          if (action === 'remove') {\n            moderatedContent = await tx.post.delete({\n              where: { id: contentId },\n            });\n          } else {\n            // For approve/flag, we could add moderation status fields\n            moderatedContent = await tx.post.findUnique({\n              where: { id: contentId },\n            });\n          }\n        } else if (contentType === 'comment') {\n          if (action === 'remove') {\n            moderatedContent = await tx.comment.delete({\n              where: { id: contentId },\n            });\n          } else {\n            moderatedContent = await tx.comment.findUnique({\n              where: { id: contentId },\n            });\n          }\n        }\n\n        // Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action:\n              contentType === 'post' ? 'MODERATE_POST' : 'MODERATE_COMMENT',\n            entity: contentType,\n            entityId: contentId,\n            metadata: {\n              contentId,\n              contentType,\n              moderationAction: action,\n              reason,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        return { success: true, action, moderatedContent };\n      });\n    } catch (error) {\n      this.logger.error('Failed to moderate content:', error);\n      throw error;\n    }\n  }\n}\n"],"version":3}