{"version":3,"names":["cov_6kmhqp7yk","actualCoverage","common_1","s","require","core_1","ROLE_HIERARCHY","client","therapist","moderator","admin","ROLE_PERMISSIONS","RequirePermissions","permissions","f","Reflect","defineMetadata","exports","RequireRole","role","AllowResourceOwner","resourceIdParam","b","RoleBasedAccessGuard","reflector","constructor","canActivate","context","request","switchToHttp","getRequest","user","userRole","userId","requiredPermissions","getAllAndOverride","getHandler","getClass","hasPermission","checkPermissions","ForbiddenException","minimumRole","hasRole","checkRole","resourceOwnerParam","resourceId","params","isOwner","checkResourceOwnership","clientId","body","some","permission","allowedRoles","includes","userRoleLevel","minimumRoleLevel","undefined","path","getUserPermissions","Object","entries","filter","_","roles","map","canAccessResource","resourceOwnerId","hasRolePermission","__decorate","Injectable","Reflector","_a"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/guards/role-based-access.guard.ts"],"sourcesContent":["import {\n  Injectable,\n  CanActivate,\n  ExecutionContext,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\n\n// Define role hierarchy - higher numbers have more permissions\nconst ROLE_HIERARCHY = {\n  client: 0,\n  therapist: 1,\n  moderator: 2,\n  admin: 3,\n};\n\n// Define role-based permissions for different resources\nconst ROLE_PERMISSIONS = {\n  // User management\n  'users:create': ['admin'],\n  'users:read:all': ['admin', 'moderator'],\n  'users:read:own': ['client', 'therapist', 'moderator', 'admin'],\n  'users:update:own': ['client', 'therapist', 'moderator', 'admin'],\n  'users:update:others': ['admin'],\n  'users:delete': ['admin'],\n  'users:deactivate': ['admin', 'moderator'],\n\n  // Therapist management\n  'therapists:create': ['admin'],\n  'therapists:read:all': ['admin', 'moderator'],\n  'therapists:read:public': ['client', 'therapist', 'moderator', 'admin'],\n  'therapists:update:own': ['therapist', 'admin'],\n  'therapists:update:others': ['admin'],\n  'therapists:approve': ['admin'],\n  'therapists:assign': ['admin', 'moderator'],\n\n  // Client management\n  'clients:create': ['admin'],\n  'clients:read:all': ['admin', 'moderator'],\n  'clients:read:assigned': ['therapist'],\n  'clients:read:own': ['client', 'admin'],\n  'clients:update:own': ['client', 'admin'],\n  'clients:update:assigned': ['therapist', 'admin'],\n\n  // Assessment management\n  'assessments:create:own': ['client'],\n  'assessments:read:own': ['client', 'admin'],\n  'assessments:read:assigned': ['therapist'],\n  'assessments:read:all': ['admin', 'moderator'],\n  'assessments:update:own': ['client'],\n  'assessments:delete:own': ['client', 'admin'],\n  'assessments:delete:all': ['admin'],\n\n  // Session management\n  'sessions:create': ['therapist', 'admin'],\n  'sessions:read:own': ['client', 'therapist'],\n  'sessions:read:all': ['admin', 'moderator'],\n  'sessions:update:own': ['therapist'],\n  'sessions:cancel:own': ['client', 'therapist'],\n  'sessions:cancel:all': ['admin'],\n\n  // Messaging\n  'messages:create': ['client', 'therapist'],\n  'messages:read:own': ['client', 'therapist'],\n  'messages:read:all': ['admin', 'moderator'],\n  'messages:moderate': ['moderator', 'admin'],\n\n  // Community management\n  'communities:create': ['admin'],\n  'communities:read:all': ['client', 'therapist', 'moderator', 'admin'],\n  'communities:update': ['admin', 'moderator'],\n  'communities:moderate': ['moderator', 'admin'],\n  'communities:join': ['client', 'therapist'],\n\n  // Content management\n  'posts:create': ['client', 'therapist'],\n  'posts:read:all': ['client', 'therapist', 'moderator', 'admin'],\n  'posts:update:own': ['client', 'therapist'],\n  'posts:delete:own': ['client', 'therapist'],\n  'posts:moderate': ['moderator', 'admin'],\n\n  // File management\n  'files:upload:own': ['client', 'therapist'],\n  'files:read:own': ['client', 'therapist'],\n  'files:read:assigned': ['therapist'],\n  'files:read:all': ['admin'],\n  'files:delete:own': ['client', 'therapist', 'admin'],\n  'files:delete:all': ['admin'],\n\n  // Admin functions\n  'admin:access': ['admin'],\n  'admin:analytics': ['admin', 'moderator'],\n  'admin:audit-logs': ['admin'],\n  'admin:system-config': ['admin'],\n\n  // Billing\n  'billing:create': ['admin'],\n  'billing:read:own': ['client', 'therapist'],\n  'billing:read:all': ['admin'],\n  'billing:update': ['admin'],\n\n  // Notifications\n  'notifications:create': ['admin', 'moderator'],\n  'notifications:read:own': ['client', 'therapist', 'moderator', 'admin'],\n  'notifications:update:own': ['client', 'therapist', 'moderator', 'admin'],\n};\n\n// Decorator to define required permissions\nexport const RequirePermissions = (...permissions: string[]) =>\n  Reflect.defineMetadata('permissions', permissions, Reflect);\n\n// Decorator to define minimum role required\nexport const RequireRole = (role: keyof typeof ROLE_HIERARCHY) =>\n  Reflect.defineMetadata('min_role', role, Reflect);\n\n// Decorator to allow resource owner access\nexport const AllowResourceOwner = (resourceIdParam: string = 'id') =>\n  Reflect.defineMetadata('resource_owner_param', resourceIdParam, Reflect);\n\n@Injectable()\nexport class RoleBasedAccessGuard implements CanActivate {\n  constructor(private reflector: Reflector) {}\n\n  canActivate(context: ExecutionContext): boolean {\n    const request = context.switchToHttp().getRequest();\n    const user = request.user;\n    const userRole = request.userRole || user?.role;\n    const userId = request.userId || user?.userId;\n\n    if (!userRole || !userId) {\n      // If no role or user ID, deny access (unless it's a public route)\n      return false;\n    }\n\n    // Check for required permissions\n    const requiredPermissions = this.reflector.getAllAndOverride<string[]>(\n      'permissions',\n      [context.getHandler(), context.getClass()],\n    );\n\n    if (requiredPermissions) {\n      const hasPermission = this.checkPermissions(\n        userRole,\n        requiredPermissions,\n      );\n      if (!hasPermission) {\n        throw new ForbiddenException('Insufficient permissions');\n      }\n    }\n\n    // Check for minimum role requirement\n    const minimumRole = this.reflector.getAllAndOverride<\n      keyof typeof ROLE_HIERARCHY\n    >('min_role', [context.getHandler(), context.getClass()]);\n\n    if (minimumRole) {\n      const hasRole = this.checkRole(userRole, minimumRole);\n      if (!hasRole) {\n        throw new ForbiddenException(`Minimum role '${minimumRole}' required`);\n      }\n    }\n\n    // Check for resource owner access\n    const resourceOwnerParam = this.reflector.getAllAndOverride<string>(\n      'resource_owner_param',\n      [context.getHandler(), context.getClass()],\n    );\n\n    if (resourceOwnerParam) {\n      const resourceId = request.params[resourceOwnerParam];\n      const isOwner = this.checkResourceOwnership(\n        userId,\n        resourceId,\n        userRole,\n        request,\n      );\n      if (!isOwner) {\n        throw new ForbiddenException('Access denied - not resource owner');\n      }\n    }\n\n    // Special validation for therapist-client relationships\n    if (userRole === 'therapist') {\n      const clientId = request.params.clientId || request.body?.clientId;\n      if (clientId) {\n        // In a real implementation, you'd check the database for the relationship\n        // For now, we'll assume it's valid if the therapist is accessing client data\n        // This should be replaced with actual database validation\n      }\n    }\n\n    return true;\n  }\n\n  private checkPermissions(\n    userRole: string,\n    requiredPermissions: string[],\n  ): boolean {\n    return requiredPermissions.some((permission) => {\n      const allowedRoles = ROLE_PERMISSIONS[permission] || [];\n      return allowedRoles.includes(userRole);\n    });\n  }\n\n  private checkRole(\n    userRole: string,\n    minimumRole: keyof typeof ROLE_HIERARCHY,\n  ): boolean {\n    const userRoleLevel =\n      ROLE_HIERARCHY[userRole as keyof typeof ROLE_HIERARCHY];\n    const minimumRoleLevel = ROLE_HIERARCHY[minimumRole];\n\n    return userRoleLevel !== undefined && userRoleLevel >= minimumRoleLevel;\n  }\n\n  private checkResourceOwnership(\n    userId: string,\n    resourceId: string,\n    userRole: string,\n    request: any,\n  ): boolean {\n    // If no resource ID specified, allow access\n    if (!resourceId) return true;\n\n    // Admin can access any resource\n    if (userRole === 'admin') return true;\n\n    // Check if the resource ID matches the user ID\n    if (resourceId === userId) return true;\n\n    // For therapists, allow access to assigned clients (simplified check)\n    if (userRole === 'therapist') {\n      // In a real implementation, check database for therapist-client relationship\n      return true; // Placeholder\n    }\n\n    // For moderators, allow access to community resources\n    if (userRole === 'moderator') {\n      const path = request.path;\n      if (\n        path.includes('/communities') ||\n        path.includes('/posts') ||\n        path.includes('/comments')\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Helper method to get user permissions for debugging\n  static getUserPermissions(userRole: string): string[] {\n    return Object.entries(ROLE_PERMISSIONS)\n      .filter(([_, roles]) => roles.includes(userRole))\n      .map(([permission]) => permission);\n  }\n\n  // Helper method to check if a user can access a specific resource\n  static canAccessResource(\n    userRole: string,\n    permission: string,\n    userId?: string,\n    resourceOwnerId?: string,\n  ): boolean {\n    const allowedRoles = ROLE_PERMISSIONS[permission] || [];\n    const hasRolePermission = allowedRoles.includes(userRole);\n\n    if (hasRolePermission) return true;\n\n    // Check resource ownership\n    if (userId && resourceOwnerId && userId === resourceOwnerId) {\n      return true;\n    }\n\n    return false;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}