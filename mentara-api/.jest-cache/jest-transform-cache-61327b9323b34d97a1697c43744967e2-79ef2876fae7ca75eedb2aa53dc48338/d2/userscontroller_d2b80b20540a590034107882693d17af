af92965e4bfbe0423609f4d3045d904f
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var UsersController_1;
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsersController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const jwt_auth_guard_1 = require("src/auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("src/auth/decorators/current-user-id.decorator");
const current_user_role_decorator_1 = require("src/auth/decorators/current-user-role.decorator");
const zod_validation_pipe_1 = require("src/common/pipes/zod-validation.pipe");
const validation_1 = require("./validation");
const users_service_1 = require("./users.service");
const supabase_storage_service_1 = require("src/common/services/supabase-storage.service");
const role_utils_1 = require("src/utils/role-utils");
const dto_1 = require("src/common/dto");
let UsersController = UsersController_1 = class UsersController {
    usersService;
    supabaseStorageService;
    roleUtils;
    logger = new common_1.Logger(UsersController_1.name);
    constructor(usersService, supabaseStorageService, roleUtils) {
        this.usersService = usersService;
        this.supabaseStorageService = supabaseStorageService;
        this.roleUtils = roleUtils;
    }
    async findAll(currentUserId, role) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Admin access required');
        }
        try {
            this.logger.log(`Admin ${currentUserId} retrieving all users`);
            const users = await this.usersService.findAll();
            return dto_1.UserResponseDto.fromPrismaUsers(users);
        }
        catch (error) {
            this.logger.error('Failed to fetch users:', error);
            throw new common_1.HttpException(`Failed to fetch users: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async findAllIncludeInactive(currentUserId, role) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Admin access required');
        }
        try {
            this.logger.log(`Admin ${currentUserId} retrieving all users including inactive`);
            const users = await this.usersService.findAllIncludeInactive();
            return dto_1.UserResponseDto.fromPrismaUsers(users);
        }
        catch (error) {
            this.logger.error('Failed to fetch all users:', error);
            throw new common_1.HttpException(`Failed to fetch users: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async findOne(params, currentUserId) {
        try {
            // Users can only view their own profile unless they're admin
            const isAdmin = await this.roleUtils.isUserAdmin(currentUserId);
            if (!isAdmin && params.id !== currentUserId) {
                throw new common_1.ForbiddenException('You can only access your own profile');
            }
            const user = isAdmin
                ? await this.usersService.findOneIncludeInactive(params.id)
                : await this.usersService.findOne(params.id);
            if (!user) {
                throw new common_1.HttpException('User not found', common_1.HttpStatus.NOT_FOUND);
            }
            return dto_1.UserResponseDto.fromPrismaUser(user);
        }
        catch (error) {
            if (error instanceof common_1.ForbiddenException ||
                error instanceof common_1.HttpException) {
                throw error;
            }
            this.logger.error('Failed to fetch user:', error);
            throw new common_1.HttpException(`Failed to fetch user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async update(params, userData, currentUserId, files) {
        try {
            // Users can only update their own profile unless they're admin
            const isAdmin = await this.roleUtils.isUserAdmin(currentUserId);
            if (!isAdmin && params.id !== currentUserId) {
                throw new common_1.ForbiddenException('You can only update your own profile');
            }
            // Handle file uploads if provided
            let avatarUrl;
            let coverImageUrl;
            if (files?.avatar?.[0]) {
                const validation = this.supabaseStorageService.validateFile(files.avatar[0]);
                if (!validation.isValid) {
                    throw new common_1.HttpException(`Avatar validation failed: ${validation.error}`, common_1.HttpStatus.BAD_REQUEST);
                }
                const uploadResult = await this.supabaseStorageService.uploadFile(files.avatar[0], supabase_storage_service_1.SupabaseStorageService.getSupportedBuckets().USER_PROFILES);
                avatarUrl = uploadResult.url;
            }
            if (files?.cover?.[0]) {
                const validation = this.supabaseStorageService.validateFile(files.cover[0]);
                if (!validation.isValid) {
                    throw new common_1.HttpException(`Cover image validation failed: ${validation.error}`, common_1.HttpStatus.BAD_REQUEST);
                }
                const uploadResult = await this.supabaseStorageService.uploadFile(files.cover[0], supabase_storage_service_1.SupabaseStorageService.getSupportedBuckets().USER_PROFILES);
                coverImageUrl = uploadResult.url;
            }
            // Prevent non-admins from changing sensitive fields
            if (!isAdmin) {
                const allowedFields = [
                    'firstName',
                    'middleName',
                    'lastName',
                    'birthDate',
                    'address',
                    'bio',
                    'avatarUrl',
                    'coverImageUrl',
                    'phoneNumber',
                    'timezone',
                    'language',
                    'theme',
                ];
                const sanitizedData = {};
                for (const field of allowedFields) {
                    if (userData[field] !== undefined) {
                        sanitizedData[field] =
                            userData[field];
                    }
                }
                userData = sanitizedData;
            }
            // Add uploaded file URLs to userData
            if (avatarUrl)
                userData.avatarUrl = avatarUrl;
            if (coverImageUrl)
                userData.coverImageUrl = coverImageUrl;
            const updatedUser = await this.usersService.update(params.id, userData);
            return dto_1.UserResponseDto.fromPrismaUser(updatedUser);
        }
        catch (error) {
            if (error instanceof common_1.ForbiddenException) {
                throw error;
            }
            this.logger.error('Failed to update user:', error);
            throw new common_1.HttpException(`Failed to update user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async remove(params, currentUserId) {
        try {
            // Users can only deactivate their own account unless they're admin
            const isAdmin = await this.roleUtils.isUserAdmin(currentUserId);
            if (!isAdmin && params.id !== currentUserId) {
                throw new common_1.ForbiddenException('You can only deactivate your own account');
            }
            this.logger.log(`User/Admin ${currentUserId} deactivating user ${params.id}`);
            await this.usersService.remove(params.id);
            return new dto_1.SuccessMessageDto('User account deactivated successfully');
        }
        catch (error) {
            if (error instanceof common_1.ForbiddenException) {
                throw error;
            }
            this.logger.error('Failed to deactivate user:', error);
            throw new common_1.HttpException(`Failed to deactivate user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async deactivateUser(params, body, currentUserId, role) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Admin access required');
        }
        try {
            this.logger.log(`Admin ${currentUserId} deactivating user ${params.id} with reason: ${body.reason}`);
            await this.usersService.deactivate(params.id, body.reason, currentUserId);
            return new dto_1.SuccessMessageDto('User account deactivated by administrator');
        }
        catch (error) {
            this.logger.error('Failed to deactivate user:', error);
            throw new common_1.HttpException(`Failed to deactivate user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async reactivateUser(params, currentUserId, role) {
        if (role !== 'admin') {
            throw new common_1.ForbiddenException('Admin access required');
        }
        try {
            this.logger.log(`Admin ${currentUserId} reactivating user ${params.id}`);
            await this.usersService.reactivate(params.id);
            return new dto_1.SuccessMessageDto('User account reactivated successfully');
        }
        catch (error) {
            this.logger.error('Failed to reactivate user:', error);
            throw new common_1.HttpException(`Failed to reactivate user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
};
exports.UsersController = UsersController;
__decorate([
    (0, common_1.Get)(),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], UsersController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)('all-including-inactive'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], UsersController.prototype, "findAllIncludeInactive", null);
__decorate([
    (0, common_1.Get)(':id'),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.UserIdParamSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], UsersController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)(':id'),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileFieldsInterceptor)([
        { name: 'avatar', maxCount: 1 },
        { name: 'cover', maxCount: 1 },
    ])),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.UserIdParamSchema))),
    __param(1, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.UpdateUserRequestSchema))),
    __param(2, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(3, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, String, Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], UsersController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)(':id'),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.UserIdParamSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], UsersController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)(':id/deactivate'),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.UserIdParamSchema))),
    __param(1, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.DeactivateUserDtoSchema))),
    __param(2, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(3, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, String, String]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], UsersController.prototype, "deactivateUser", null);
__decorate([
    (0, common_1.Post)(':id/reactivate'),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(validation_1.UserIdParamSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, String]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], UsersController.prototype, "reactivateUser", null);
exports.UsersController = UsersController = UsersController_1 = __decorate([
    (0, common_1.Controller)('users'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof users_service_1.UsersService !== "undefined" && users_service_1.UsersService) === "function" ? _a : Object, typeof (_b = typeof supabase_storage_service_1.SupabaseStorageService !== "undefined" && supabase_storage_service_1.SupabaseStorageService) === "function" ? _b : Object, typeof (_c = typeof role_utils_1.RoleUtils !== "undefined" && role_utils_1.RoleUtils) === "function" ? _c : Object])
], UsersController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3VzZXJzL3VzZXJzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0Fld0I7QUFDeEIsK0RBQWlFO0FBQ2pFLG1FQUE4RDtBQUM5RCw2RkFBOEU7QUFDOUUsaUdBQWtGO0FBQ2xGLDhFQUF5RTtBQUN6RSw2Q0FJc0I7QUFPdEIsbURBQStDO0FBQy9DLDJGQUFzRjtBQUN0RixxREFBaUQ7QUFDakQsd0NBQW9FO0FBSTdELElBQU0sZUFBZSx1QkFBckIsTUFBTSxlQUFlO0lBSVA7SUFDQTtJQUNBO0lBTEYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGlCQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFM0QsWUFDbUIsWUFBMEIsRUFDMUIsc0JBQThDLEVBQzlDLFNBQW9CO1FBRnBCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7UUFDOUMsY0FBUyxHQUFULFNBQVMsQ0FBVztJQUNwQyxDQUFDO0lBR0UsQUFBTixLQUFLLENBQUMsT0FBTyxDQUNNLGFBQXFCLEVBQ25CLElBQVk7UUFFL0IsSUFBSSxJQUFJLEtBQUssT0FBTyxFQUFFLENBQUM7WUFDckIsTUFBTSxJQUFJLDJCQUFrQixDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUNELElBQUksQ0FBQztZQUNILElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsYUFBYSx1QkFBdUIsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNoRCxPQUFPLHFCQUFlLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFL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cEIsV0FBQSxJQUFBLGNBQUssRUFBQyxJQUFJLHVDQUFpQixDQUFDLDhCQUFpQixDQUFDLENBQUMsQ0FBQTtJQUMvQyxXQUFBLElBQUEsYUFBSSxFQUFDLElBQUksdUNBQWlCLENBQUMsb0NBQXVCLENBQUMsQ0FBQyxDQUFBO0lBRXBELFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7SUFDZixXQUFBLElBQUEsNkNBQWUsR0FBRSxDQUFBOzs7d0RBQ2pCLE9BQU8sb0JBQVAsT0FBTztxREFrQlQ7QUFHSztJQURMLElBQUEsYUFBSSxFQUFDLGdCQUFnQixDQUFDO0lBRXBCLFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSx1Q0FBaUIsQ0FBQyw4QkFBaUIsQ0FBQyxDQUFDLENBQUE7SUFDL0MsV0FBQSxJQUFBLHlDQUFhLEdBQUUsQ0FBQTtJQUNmLFdBQUEsSUFBQSw2Q0FBZSxHQUFFLENBQUE7Ozt3REFDakIsT0FBTyxvQkFBUCxPQUFPO3FEQWdCVDswQkFwUlUsZUFBZTtJQUYzQixJQUFBLG1CQUFVLEVBQUMsT0FBTyxDQUFDO0lBQ25CLElBQUEsa0JBQVMsRUFBQyw2QkFBWSxDQUFDO3lEQUtXLDRCQUFZLG9CQUFaLDRCQUFZLG9EQUNGLGlEQUFzQixvQkFBdEIsaURBQXNCLG9EQUNuQyxzQkFBUyxvQkFBVCxzQkFBUztHQU41QixlQUFlLENBcVIzQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdXNlcnMvdXNlcnMuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCb2R5LFxuICBDb250cm9sbGVyLFxuICBEZWxldGUsXG4gIEdldCxcbiAgSHR0cEV4Y2VwdGlvbixcbiAgSHR0cFN0YXR1cyxcbiAgUGFyYW0sXG4gIFB1dCxcbiAgUG9zdCxcbiAgVXNlR3VhcmRzLFxuICBVc2VJbnRlcmNlcHRvcnMsXG4gIFVwbG9hZGVkRmlsZXMsXG4gIExvZ2dlcixcbiAgRm9yYmlkZGVuRXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBGaWxlRmllbGRzSW50ZXJjZXB0b3IgfSBmcm9tICdAbmVzdGpzL3BsYXRmb3JtLWV4cHJlc3MnO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnc3JjL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEN1cnJlbnRVc2VySWQgfSBmcm9tICdzcmMvYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1pZC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJSb2xlIH0gZnJvbSAnc3JjL2F1dGgvZGVjb3JhdG9ycy9jdXJyZW50LXVzZXItcm9sZS5kZWNvcmF0b3InO1xuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICdzcmMvY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHtcbiAgVXNlcklkUGFyYW1TY2hlbWEsXG4gIERlYWN0aXZhdGVVc2VyRHRvU2NoZW1hLFxuICBVcGRhdGVVc2VyUmVxdWVzdFNjaGVtYSxcbn0gZnJvbSAnLi92YWxpZGF0aW9uJztcbmltcG9ydCB0eXBlIHtcbiAgVXNlcklkUGFyYW0sXG4gIERlYWN0aXZhdGVVc2VyRHRvLFxuICBVcGRhdGVVc2VyUmVxdWVzdCxcbiAgVXNlckR0byxcbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBVc2Vyc1NlcnZpY2UgfSBmcm9tICcuL3VzZXJzLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3VwYWJhc2VTdG9yYWdlU2VydmljZSB9IGZyb20gJ3NyYy9jb21tb24vc2VydmljZXMvc3VwYWJhc2Utc3RvcmFnZS5zZXJ2aWNlJztcbmltcG9ydCB7IFJvbGVVdGlscyB9IGZyb20gJ3NyYy91dGlscy9yb2xlLXV0aWxzJztcbmltcG9ydCB7IFVzZXJSZXNwb25zZUR0bywgU3VjY2Vzc01lc3NhZ2VEdG8gfSBmcm9tICdzcmMvY29tbW9uL2R0byc7XG5cbkBDb250cm9sbGVyKCd1c2VycycpXG5AVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbmV4cG9ydCBjbGFzcyBVc2Vyc0NvbnRyb2xsZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoVXNlcnNDb250cm9sbGVyLm5hbWUpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgdXNlcnNTZXJ2aWNlOiBVc2Vyc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBzdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlOiBTdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcm9sZVV0aWxzOiBSb2xlVXRpbHMsXG4gICkge31cblxuICBAR2V0KClcbiAgYXN5bmMgZmluZEFsbChcbiAgICBAQ3VycmVudFVzZXJJZCgpIGN1cnJlbnRVc2VySWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJSb2xlKCkgcm9sZTogc3RyaW5nLFxuICApOiBQcm9taXNlPFVzZXJEdG9bXT4ge1xuICAgIGlmIChyb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgQWRtaW4gJHtjdXJyZW50VXNlcklkfSByZXRyaWV2aW5nIGFsbCB1c2Vyc2ApO1xuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5maW5kQWxsKCk7XG4gICAgICByZXR1cm4gVXNlclJlc3BvbnNlRHRvLmZyb21QcmlzbWFVc2Vycyh1c2Vycyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggdXNlcnM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgIGBGYWlsZWQgdG8gZmV0Y2ggdXNlcnM6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ2FsbC1pbmNsdWRpbmctaW5hY3RpdmUnKVxuICBhc3luYyBmaW5kQWxsSW5jbHVkZUluYWN0aXZlKFxuICAgIEBDdXJyZW50VXNlcklkKCkgY3VycmVudFVzZXJJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSByb2xlOiBzdHJpbmcsXG4gICk6IFByb21pc2U8VXNlckR0b1tdPiB7XG4gICAgaWYgKHJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHRocm93IG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgQWRtaW4gJHtjdXJyZW50VXNlcklkfSByZXRyaWV2aW5nIGFsbCB1c2VycyBpbmNsdWRpbmcgaW5hY3RpdmVgLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgdGhpcy51c2Vyc1NlcnZpY2UuZmluZEFsbEluY2x1ZGVJbmFjdGl2ZSgpO1xuICAgICAgcmV0dXJuIFVzZXJSZXNwb25zZUR0by5mcm9tUHJpc21hVXNlcnModXNlcnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIGFsbCB1c2VyczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgYEZhaWxlZCB0byBmZXRjaCB1c2VyczogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnOmlkJylcbiAgYXN5bmMgZmluZE9uZShcbiAgICBAUGFyYW0obmV3IFpvZFZhbGlkYXRpb25QaXBlKFVzZXJJZFBhcmFtU2NoZW1hKSkgcGFyYW1zOiBVc2VySWRQYXJhbSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIGN1cnJlbnRVc2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxVc2VyRHRvPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZXJzIGNhbiBvbmx5IHZpZXcgdGhlaXIgb3duIHByb2ZpbGUgdW5sZXNzIHRoZXkncmUgYWRtaW5cbiAgICAgIGNvbnN0IGlzQWRtaW4gPSBhd2FpdCB0aGlzLnJvbGVVdGlscy5pc1VzZXJBZG1pbihjdXJyZW50VXNlcklkKTtcblxuICAgICAgaWYgKCFpc0FkbWluICYmIHBhcmFtcy5pZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdZb3UgY2FuIG9ubHkgYWNjZXNzIHlvdXIgb3duIHByb2ZpbGUnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlciA9IGlzQWRtaW5cbiAgICAgICAgPyBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5maW5kT25lSW5jbHVkZUluYWN0aXZlKHBhcmFtcy5pZClcbiAgICAgICAgOiBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5maW5kT25lKHBhcmFtcy5pZCk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnLCBIdHRwU3RhdHVzLk5PVF9GT1VORCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gVXNlclJlc3BvbnNlRHRvLmZyb21QcmlzbWFVc2VyKHVzZXIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRm9yYmlkZGVuRXhjZXB0aW9uIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgSHR0cEV4Y2VwdGlvblxuICAgICAgKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICBgRmFpbGVkIHRvIGZldGNoIHVzZXI6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBQdXQoJzppZCcpXG4gIEBVc2VJbnRlcmNlcHRvcnMoXG4gICAgRmlsZUZpZWxkc0ludGVyY2VwdG9yKFtcbiAgICAgIHsgbmFtZTogJ2F2YXRhcicsIG1heENvdW50OiAxIH0sXG4gICAgICB7IG5hbWU6ICdjb3ZlcicsIG1heENvdW50OiAxIH0sXG4gICAgXSksXG4gIClcbiAgYXN5bmMgdXBkYXRlKFxuICAgIEBQYXJhbShuZXcgWm9kVmFsaWRhdGlvblBpcGUoVXNlcklkUGFyYW1TY2hlbWEpKSBwYXJhbXM6IFVzZXJJZFBhcmFtLFxuICAgIEBCb2R5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShVcGRhdGVVc2VyUmVxdWVzdFNjaGVtYSkpXG4gICAgdXNlckRhdGE6IFVwZGF0ZVVzZXJSZXF1ZXN0LFxuICAgIEBDdXJyZW50VXNlcklkKCkgY3VycmVudFVzZXJJZDogc3RyaW5nLFxuICAgIEBVcGxvYWRlZEZpbGVzKClcbiAgICBmaWxlcz86IHsgYXZhdGFyPzogRXhwcmVzcy5NdWx0ZXIuRmlsZVtdOyBjb3Zlcj86IEV4cHJlc3MuTXVsdGVyLkZpbGVbXSB9LFxuICApOiBQcm9taXNlPFVzZXJEdG8+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXNlcnMgY2FuIG9ubHkgdXBkYXRlIHRoZWlyIG93biBwcm9maWxlIHVubGVzcyB0aGV5J3JlIGFkbWluXG4gICAgICBjb25zdCBpc0FkbWluID0gYXdhaXQgdGhpcy5yb2xlVXRpbHMuaXNVc2VyQWRtaW4oY3VycmVudFVzZXJJZCk7XG5cbiAgICAgIGlmICghaXNBZG1pbiAmJiBwYXJhbXMuaWQgIT09IGN1cnJlbnRVc2VySWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignWW91IGNhbiBvbmx5IHVwZGF0ZSB5b3VyIG93biBwcm9maWxlJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBmaWxlIHVwbG9hZHMgaWYgcHJvdmlkZWRcbiAgICAgIGxldCBhdmF0YXJVcmw6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgIGxldCBjb3ZlckltYWdlVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICAgIGlmIChmaWxlcz8uYXZhdGFyPy5bMF0pIHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMuc3VwYWJhc2VTdG9yYWdlU2VydmljZS52YWxpZGF0ZUZpbGUoXG4gICAgICAgICAgZmlsZXMuYXZhdGFyWzBdLFxuICAgICAgICApO1xuICAgICAgICBpZiAoIXZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAgICAgYEF2YXRhciB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9yfWAsXG4gICAgICAgICAgICBIdHRwU3RhdHVzLkJBRF9SRVFVRVNULFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBsb2FkUmVzdWx0ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLnVwbG9hZEZpbGUoXG4gICAgICAgICAgZmlsZXMuYXZhdGFyWzBdLFxuICAgICAgICAgIFN1cGFiYXNlU3RvcmFnZVNlcnZpY2UuZ2V0U3VwcG9ydGVkQnVja2V0cygpLlVTRVJfUFJPRklMRVMsXG4gICAgICAgICk7XG4gICAgICAgIGF2YXRhclVybCA9IHVwbG9hZFJlc3VsdC51cmw7XG4gICAgICB9XG5cbiAgICAgIGlmIChmaWxlcz8uY292ZXI/LlswXSkge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uID0gdGhpcy5zdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLnZhbGlkYXRlRmlsZShcbiAgICAgICAgICBmaWxlcy5jb3ZlclswXSxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgICAgIGBDb3ZlciBpbWFnZSB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9yfWAsXG4gICAgICAgICAgICBIdHRwU3RhdHVzLkJBRF9SRVFVRVNULFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBsb2FkUmVzdWx0ID0gYXdhaXQgdGhpcy5zdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLnVwbG9hZEZpbGUoXG4gICAgICAgICAgZmlsZXMuY292ZXJbMF0sXG4gICAgICAgICAgU3VwYWJhc2VTdG9yYWdlU2VydmljZS5nZXRTdXBwb3J0ZWRCdWNrZXRzKCkuVVNFUl9QUk9GSUxFUyxcbiAgICAgICAgKTtcbiAgICAgICAgY292ZXJJbWFnZVVybCA9IHVwbG9hZFJlc3VsdC51cmw7XG4gICAgICB9XG5cbiAgICAgIC8vIFByZXZlbnQgbm9uLWFkbWlucyBmcm9tIGNoYW5naW5nIHNlbnNpdGl2ZSBmaWVsZHNcbiAgICAgIGlmICghaXNBZG1pbikge1xuICAgICAgICBjb25zdCBhbGxvd2VkRmllbGRzID0gW1xuICAgICAgICAgICdmaXJzdE5hbWUnLFxuICAgICAgICAgICdtaWRkbGVOYW1lJyxcbiAgICAgICAgICAnbGFzdE5hbWUnLFxuICAgICAgICAgICdiaXJ0aERhdGUnLFxuICAgICAgICAgICdhZGRyZXNzJyxcbiAgICAgICAgICAnYmlvJyxcbiAgICAgICAgICAnYXZhdGFyVXJsJyxcbiAgICAgICAgICAnY292ZXJJbWFnZVVybCcsXG4gICAgICAgICAgJ3Bob25lTnVtYmVyJyxcbiAgICAgICAgICAndGltZXpvbmUnLFxuICAgICAgICAgICdsYW5ndWFnZScsXG4gICAgICAgICAgJ3RoZW1lJyxcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3Qgc2FuaXRpemVkRGF0YTogUGFydGlhbDxVcGRhdGVVc2VyUmVxdWVzdD4gPSB7fTtcblxuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGFsbG93ZWRGaWVsZHMpIHtcbiAgICAgICAgICBpZiAodXNlckRhdGFbZmllbGQgYXMga2V5b2YgVXBkYXRlVXNlclJlcXVlc3RdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIChzYW5pdGl6ZWREYXRhIGFzIGFueSlbZmllbGRdID1cbiAgICAgICAgICAgICAgdXNlckRhdGFbZmllbGQgYXMga2V5b2YgVXBkYXRlVXNlclJlcXVlc3RdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB1c2VyRGF0YSA9IHNhbml0aXplZERhdGEgYXMgVXBkYXRlVXNlclJlcXVlc3Q7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB1cGxvYWRlZCBmaWxlIFVSTHMgdG8gdXNlckRhdGFcbiAgICAgIGlmIChhdmF0YXJVcmwpIHVzZXJEYXRhLmF2YXRhclVybCA9IGF2YXRhclVybDtcbiAgICAgIGlmIChjb3ZlckltYWdlVXJsKSB1c2VyRGF0YS5jb3ZlckltYWdlVXJsID0gY292ZXJJbWFnZVVybDtcblxuICAgICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS51cGRhdGUocGFyYW1zLmlkLCB1c2VyRGF0YSk7XG4gICAgICByZXR1cm4gVXNlclJlc3BvbnNlRHRvLmZyb21QcmlzbWFVc2VyKHVwZGF0ZWRVc2VyKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRm9yYmlkZGVuRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgdXNlcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgYEZhaWxlZCB0byB1cGRhdGUgdXNlcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQERlbGV0ZSgnOmlkJylcbiAgYXN5bmMgcmVtb3ZlKFxuICAgIEBQYXJhbShuZXcgWm9kVmFsaWRhdGlvblBpcGUoVXNlcklkUGFyYW1TY2hlbWEpKSBwYXJhbXM6IFVzZXJJZFBhcmFtLFxuICAgIEBDdXJyZW50VXNlcklkKCkgY3VycmVudFVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPFN1Y2Nlc3NNZXNzYWdlRHRvPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZXJzIGNhbiBvbmx5IGRlYWN0aXZhdGUgdGhlaXIgb3duIGFjY291bnQgdW5sZXNzIHRoZXkncmUgYWRtaW5cbiAgICAgIGNvbnN0IGlzQWRtaW4gPSBhd2FpdCB0aGlzLnJvbGVVdGlscy5pc1VzZXJBZG1pbihjdXJyZW50VXNlcklkKTtcblxuICAgICAgaWYgKCFpc0FkbWluICYmIHBhcmFtcy5pZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKFxuICAgICAgICAgICdZb3UgY2FuIG9ubHkgZGVhY3RpdmF0ZSB5b3VyIG93biBhY2NvdW50JyxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgVXNlci9BZG1pbiAke2N1cnJlbnRVc2VySWR9IGRlYWN0aXZhdGluZyB1c2VyICR7cGFyYW1zLmlkfWAsXG4gICAgICApO1xuICAgICAgYXdhaXQgdGhpcy51c2Vyc1NlcnZpY2UucmVtb3ZlKHBhcmFtcy5pZCk7XG5cbiAgICAgIHJldHVybiBuZXcgU3VjY2Vzc01lc3NhZ2VEdG8oJ1VzZXIgYWNjb3VudCBkZWFjdGl2YXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRm9yYmlkZGVuRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBkZWFjdGl2YXRlIHVzZXI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgIGBGYWlsZWQgdG8gZGVhY3RpdmF0ZSB1c2VyOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWAsXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAUG9zdCgnOmlkL2RlYWN0aXZhdGUnKVxuICBhc3luYyBkZWFjdGl2YXRlVXNlcihcbiAgICBAUGFyYW0obmV3IFpvZFZhbGlkYXRpb25QaXBlKFVzZXJJZFBhcmFtU2NoZW1hKSkgcGFyYW1zOiBVc2VySWRQYXJhbSxcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoRGVhY3RpdmF0ZVVzZXJEdG9TY2hlbWEpKVxuICAgIGJvZHk6IERlYWN0aXZhdGVVc2VyRHRvLFxuICAgIEBDdXJyZW50VXNlcklkKCkgY3VycmVudFVzZXJJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSByb2xlOiBzdHJpbmcsXG4gICk6IFByb21pc2U8U3VjY2Vzc01lc3NhZ2VEdG8+IHtcbiAgICBpZiAocm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBBZG1pbiAke2N1cnJlbnRVc2VySWR9IGRlYWN0aXZhdGluZyB1c2VyICR7cGFyYW1zLmlkfSB3aXRoIHJlYXNvbjogJHtib2R5LnJlYXNvbn1gLFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHRoaXMudXNlcnNTZXJ2aWNlLmRlYWN0aXZhdGUocGFyYW1zLmlkLCBib2R5LnJlYXNvbiwgY3VycmVudFVzZXJJZCk7XG5cbiAgICAgIHJldHVybiBuZXcgU3VjY2Vzc01lc3NhZ2VEdG8oJ1VzZXIgYWNjb3VudCBkZWFjdGl2YXRlZCBieSBhZG1pbmlzdHJhdG9yJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZGVhY3RpdmF0ZSB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICBgRmFpbGVkIHRvIGRlYWN0aXZhdGUgdXNlcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQFBvc3QoJzppZC9yZWFjdGl2YXRlJylcbiAgYXN5bmMgcmVhY3RpdmF0ZVVzZXIoXG4gICAgQFBhcmFtKG5ldyBab2RWYWxpZGF0aW9uUGlwZShVc2VySWRQYXJhbVNjaGVtYSkpIHBhcmFtczogVXNlcklkUGFyYW0sXG4gICAgQEN1cnJlbnRVc2VySWQoKSBjdXJyZW50VXNlcklkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VyUm9sZSgpIHJvbGU6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxTdWNjZXNzTWVzc2FnZUR0bz4ge1xuICAgIGlmIChyb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgQWRtaW4gJHtjdXJyZW50VXNlcklkfSByZWFjdGl2YXRpbmcgdXNlciAke3BhcmFtcy5pZH1gKTtcbiAgICAgIGF3YWl0IHRoaXMudXNlcnNTZXJ2aWNlLnJlYWN0aXZhdGUocGFyYW1zLmlkKTtcblxuICAgICAgcmV0dXJuIG5ldyBTdWNjZXNzTWVzc2FnZUR0bygnVXNlciBhY2NvdW50IHJlYWN0aXZhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJlYWN0aXZhdGUgdXNlcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgYEZhaWxlZCB0byByZWFjdGl2YXRlIHVzZXI6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9