{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { MessagingService } from './messaging.service';\nimport { ClerkAuthGuard } from '../guards/clerk-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport {\n  CreateConversationDto,\n  SendMessageDto,\n  UpdateMessageDto,\n  AddReactionDto,\n  BlockUserDto,\n  SearchMessagesDto,\n} from './dto/messaging.dto';\n\n@Controller('messaging')\n@UseGuards(ClerkAuthGuard)\nexport class MessagingController {\n  constructor(private readonly messagingService: MessagingService) {}\n\n  // Conversation endpoints\n  @Post('conversations')\n  @HttpCode(HttpStatus.CREATED)\n  async createConversation(\n    @CurrentUserId() userId: string,\n    @Body() createConversationDto: CreateConversationDto,\n  ) {\n    return this.messagingService.createConversation(\n      userId,\n      createConversationDto,\n    );\n  }\n\n  @Get('conversations')\n  async getUserConversations(\n    @CurrentUserId() userId: string,\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n  ) {\n    const pageNum = page ? parseInt(page) : 1;\n    const limitNum = limit ? parseInt(limit) : 20;\n    return this.messagingService.getUserConversations(\n      userId,\n      pageNum,\n      limitNum,\n    );\n  }\n\n  @Get('conversations/:conversationId/messages')\n  async getConversationMessages(\n    @CurrentUserId() userId: string,\n    @Param('conversationId') conversationId: string,\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n  ) {\n    const pageNum = page ? parseInt(page) : 1;\n    const limitNum = limit ? parseInt(limit) : 50;\n    return this.messagingService.getConversationMessages(\n      userId,\n      conversationId,\n      pageNum,\n      limitNum,\n    );\n  }\n\n  // Message endpoints\n  @Post('conversations/:conversationId/messages')\n  @HttpCode(HttpStatus.CREATED)\n  async sendMessage(\n    @CurrentUserId() userId: string,\n    @Param('conversationId') conversationId: string,\n    @Body() sendMessageDto: SendMessageDto,\n  ) {\n    return this.messagingService.sendMessage(\n      userId,\n      conversationId,\n      sendMessageDto,\n    );\n  }\n\n  @Put('messages/:messageId')\n  async updateMessage(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Body() updateMessageDto: UpdateMessageDto,\n  ) {\n    return this.messagingService.updateMessage(\n      userId,\n      messageId,\n      updateMessageDto,\n    );\n  }\n\n  @Delete('messages/:messageId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteMessage(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n  ) {\n    return this.messagingService.deleteMessage(userId, messageId);\n  }\n\n  // Read receipts\n  @Post('messages/:messageId/read')\n  @HttpCode(HttpStatus.OK)\n  async markMessageAsRead(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n  ) {\n    return this.messagingService.markMessageAsRead(userId, messageId);\n  }\n\n  // Message reactions\n  @Post('messages/:messageId/reactions')\n  @HttpCode(HttpStatus.CREATED)\n  async addMessageReaction(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Body() addReactionDto: AddReactionDto,\n  ) {\n    return this.messagingService.addMessageReaction(\n      userId,\n      messageId,\n      addReactionDto.emoji,\n    );\n  }\n\n  @Delete('messages/:messageId/reactions/:emoji')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async removeMessageReaction(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Param('emoji') emoji: string,\n  ) {\n    return this.messagingService.removeMessageReaction(\n      userId,\n      messageId,\n      emoji,\n    );\n  }\n\n  // User blocking\n  @Post('block')\n  @HttpCode(HttpStatus.CREATED)\n  async blockUser(\n    @CurrentUserId() userId: string,\n    @Body() blockUserDto: BlockUserDto,\n  ) {\n    return this.messagingService.blockUser(\n      userId,\n      blockUserDto.userId,\n      blockUserDto.reason,\n    );\n  }\n\n  @Delete('block/:blockedUserId')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async unblockUser(\n    @CurrentUserId() userId: string,\n    @Param('blockedUserId') blockedUserId: string,\n  ) {\n    return this.messagingService.unblockUser(userId, blockedUserId);\n  }\n\n  // Search messages\n  @Get('search')\n  async searchMessages(\n    @CurrentUserId() userId: string,\n    @Query() searchDto: SearchMessagesDto,\n  ) {\n    const { query, conversationId, page, limit } = searchDto;\n    const pageNum = page ? parseInt(page) : 1;\n    const limitNum = limit ? parseInt(limit) : 20;\n    return this.messagingService.searchMessages(\n      userId,\n      query,\n      conversationId,\n      pageNum,\n      limitNum,\n    );\n  }\n}\n"],"version":3}