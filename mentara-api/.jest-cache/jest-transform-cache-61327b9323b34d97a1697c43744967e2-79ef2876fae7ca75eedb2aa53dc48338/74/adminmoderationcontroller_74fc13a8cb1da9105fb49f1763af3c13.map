{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-moderation.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-moderation.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  Body,\n  Param,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  Query,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { AdminService } from '../admin.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../../auth/decorators/current-user-role.decorator';\n\n@Controller('admin/moderation')\n@UseGuards(JwtAuthGuard)\nexport class AdminModerationController {\n  private readonly logger = new Logger(AdminModerationController.name);\n\n  constructor(private readonly adminService: AdminService) {}\n\n  @Get('flagged')\n  async getFlaggedContent(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Query('type') type?: string,\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving flagged content`);\n      const pageNum = page ? parseInt(page) : 1;\n      const limitNum = limit ? parseInt(limit) : 10;\n\n      return await this.adminService.getFlaggedContent({\n        type,\n        page: pageNum,\n        limit: limitNum,\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve flagged content:', error);\n      throw new HttpException(\n        'Failed to retrieve flagged content',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':contentType/:contentId/moderate')\n  async moderateContent(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('contentType') contentType: string,\n    @Param('contentId') contentId: string,\n    @Body()\n    moderationData: { action: 'approve' | 'remove' | 'flag'; reason?: string },\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(\n        `Admin ${currentUserId} moderating ${contentType} ${contentId}`,\n      );\n      return await this.adminService.moderateContent(\n        contentType,\n        contentId,\n        currentUserId,\n        moderationData.action,\n        moderationData.reason,\n      );\n    } catch (error) {\n      this.logger.error('Failed to moderate content:', error);\n      throw new HttpException(\n        'Failed to moderate content',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"version":3}