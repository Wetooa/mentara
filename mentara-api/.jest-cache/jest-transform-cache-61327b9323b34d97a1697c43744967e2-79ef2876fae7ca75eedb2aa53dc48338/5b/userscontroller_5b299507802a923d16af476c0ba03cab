06a6a160a0b2b685944404c29f1ed033
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var UsersController_1;
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsersController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const swagger_1 = require("@nestjs/swagger");
const jwt_auth_guard_1 = require("src/auth/guards/jwt-auth.guard");
const admin_auth_guard_1 = require("src/auth/guards/admin-auth.guard");
const admin_only_decorator_1 = require("src/auth/decorators/admin-only.decorator");
const current_user_id_decorator_1 = require("src/auth/decorators/current-user-id.decorator");
const zod_validation_pipe_1 = require("src/common/pipes/zod-validation.pipe");
const mentara_commons_1 = require("mentara-commons");
const users_service_1 = require("./users.service");
const supabase_storage_service_1 = require("src/common/services/supabase-storage.service");
const role_utils_1 = require("src/utils/role-utils");
let UsersController = UsersController_1 = class UsersController {
    usersService;
    supabaseStorageService;
    roleUtils;
    logger = new common_1.Logger(UsersController_1.name);
    constructor(usersService, supabaseStorageService, roleUtils) {
        this.usersService = usersService;
        this.supabaseStorageService = supabaseStorageService;
        this.roleUtils = roleUtils;
    }
    async findAll(currentUserId) {
        try {
            this.logger.log(`Admin ${currentUserId} retrieving all users`);
            return (await this.usersService.findAll());
        }
        catch (error) {
            this.logger.error('Failed to fetch users:', error);
            throw new common_1.HttpException(`Failed to fetch users: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async findAllIncludeInactive(currentUserId) {
        try {
            this.logger.log(`Admin ${currentUserId} retrieving all users including inactive`);
            return (await this.usersService.findAllIncludeInactive());
        }
        catch (error) {
            this.logger.error('Failed to fetch all users:', error);
            throw new common_1.HttpException(`Failed to fetch users: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async findOne(params, currentUserId) {
        try {
            // Users can only view their own profile unless they're admin
            const isAdmin = await this.roleUtils.isUserAdmin(currentUserId);
            if (!isAdmin && params.id !== currentUserId) {
                throw new common_1.ForbiddenException('You can only access your own profile');
            }
            const user = isAdmin
                ? await this.usersService.findOneIncludeInactive(params.id)
                : await this.usersService.findOne(params.id);
            if (!user) {
                throw new common_1.HttpException('User not found', common_1.HttpStatus.NOT_FOUND);
            }
            return user;
        }
        catch (error) {
            if (error instanceof common_1.ForbiddenException ||
                error instanceof common_1.HttpException) {
                throw error;
            }
            this.logger.error('Failed to fetch user:', error);
            throw new common_1.HttpException(`Failed to fetch user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async update(params, userData, currentUserId, files) {
        try {
            // Users can only update their own profile unless they're admin
            const isAdmin = await this.roleUtils.isUserAdmin(currentUserId);
            if (!isAdmin && params.id !== currentUserId) {
                throw new common_1.ForbiddenException('You can only update your own profile');
            }
            // Handle file uploads if provided
            let avatarUrl;
            let coverImageUrl;
            if (files?.avatar?.[0]) {
                const validation = this.supabaseStorageService.validateFile(files.avatar[0]);
                if (!validation.isValid) {
                    throw new common_1.HttpException(`Avatar validation failed: ${validation.error}`, common_1.HttpStatus.BAD_REQUEST);
                }
                const uploadResult = await this.supabaseStorageService.uploadFile(files.avatar[0], supabase_storage_service_1.SupabaseStorageService.getSupportedBuckets().USER_PROFILES);
                avatarUrl = uploadResult.url;
            }
            if (files?.cover?.[0]) {
                const validation = this.supabaseStorageService.validateFile(files.cover[0]);
                if (!validation.isValid) {
                    throw new common_1.HttpException(`Cover image validation failed: ${validation.error}`, common_1.HttpStatus.BAD_REQUEST);
                }
                const uploadResult = await this.supabaseStorageService.uploadFile(files.cover[0], supabase_storage_service_1.SupabaseStorageService.getSupportedBuckets().USER_PROFILES);
                coverImageUrl = uploadResult.url;
            }
            // Prevent non-admins from changing sensitive fields
            if (!isAdmin) {
                const allowedFields = [
                    'firstName',
                    'lastName',
                    'bio',
                    'avatarUrl',
                    'coverImageUrl',
                    'phoneNumber',
                    'timezone',
                    'language',
                    'theme',
                ];
                const sanitizedData = {};
                for (const field of allowedFields) {
                    if (userData[field] !== undefined) {
                        sanitizedData[field] =
                            userData[field];
                    }
                }
                userData = sanitizedData;
            }
            // Add uploaded file URLs to userData
            if (avatarUrl)
                userData.avatarUrl = avatarUrl;
            if (coverImageUrl)
                userData.coverImageUrl = coverImageUrl;
            return (await this.usersService.update(params.id, userData));
        }
        catch (error) {
            if (error instanceof common_1.ForbiddenException) {
                throw error;
            }
            this.logger.error('Failed to update user:', error);
            throw new common_1.HttpException(`Failed to update user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async remove(params, currentUserId) {
        try {
            // Users can only deactivate their own account unless they're admin
            const isAdmin = await this.roleUtils.isUserAdmin(currentUserId);
            if (!isAdmin && params.id !== currentUserId) {
                throw new common_1.ForbiddenException('You can only deactivate your own account');
            }
            this.logger.log(`User/Admin ${currentUserId} deactivating user ${params.id}`);
            await this.usersService.remove(params.id);
            return { message: 'User account deactivated successfully' };
        }
        catch (error) {
            if (error instanceof common_1.ForbiddenException) {
                throw error;
            }
            this.logger.error('Failed to deactivate user:', error);
            throw new common_1.HttpException(`Failed to deactivate user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async deactivateUser(params, body, currentUserId) {
        try {
            this.logger.log(`Admin ${currentUserId} deactivating user ${params.id} with reason: ${body.reason}`);
            await this.usersService.deactivate(params.id, body.reason, currentUserId);
            return { message: 'User account deactivated by administrator' };
        }
        catch (error) {
            this.logger.error('Failed to deactivate user:', error);
            throw new common_1.HttpException(`Failed to deactivate user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
    async reactivateUser(params, currentUserId) {
        try {
            this.logger.log(`Admin ${currentUserId} reactivating user ${params.id}`);
            await this.usersService.reactivate(params.id);
            return { message: 'User account reactivated successfully' };
        }
        catch (error) {
            this.logger.error('Failed to reactivate user:', error);
            throw new common_1.HttpException(`Failed to reactivate user: ${error instanceof Error ? error.message : 'Unknown error'}`, common_1.HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
};
exports.UsersController = UsersController;
__decorate([
    (0, common_1.Get)(),
    (0, common_1.UseGuards)(admin_auth_guard_1.AdminAuthGuard),
    (0, admin_only_decorator_1.AdminOnly)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Get all users',
        description: 'Retrieve all users in the system. Admin access required.'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Users retrieved successfully',
        schema: {
            type: 'array',
            items: {
                type: 'object',
                properties: {
                    id: { type: 'string' },
                    email: { type: 'string' },
                    firstName: { type: 'string' },
                    lastName: { type: 'string' },
                    role: { type: 'string' },
                    createdAt: { type: 'string', format: 'date-time' }
                }
            }
        }
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Unauthorized - Invalid or missing JWT token'
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Forbidden - Admin access required'
    }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], UsersController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)('all-including-inactive'),
    (0, common_1.UseGuards)(admin_auth_guard_1.AdminAuthGuard),
    (0, admin_only_decorator_1.AdminOnly)(),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], UsersController.prototype, "findAllIncludeInactive", null);
__decorate([
    (0, common_1.Get)(':id'),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UserIdParamSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], UsersController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)(':id'),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileFieldsInterceptor)([
        { name: 'avatar', maxCount: 1 },
        { name: 'cover', maxCount: 1 },
    ])),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UserIdParamSchema))),
    __param(1, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UpdateUserRequestSchema))),
    __param(2, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(3, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, String, Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], UsersController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)(':id'),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UserIdParamSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], UsersController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)(':id/deactivate'),
    (0, common_1.UseGuards)(admin_auth_guard_1.AdminAuthGuard),
    (0, admin_only_decorator_1.AdminOnly)(),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UserIdParamSchema))),
    __param(1, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.DeactivateUserDtoSchema))),
    __param(2, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, String]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], UsersController.prototype, "deactivateUser", null);
__decorate([
    (0, common_1.Post)(':id/reactivate'),
    (0, common_1.UseGuards)(admin_auth_guard_1.AdminAuthGuard),
    (0, admin_only_decorator_1.AdminOnly)(),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UserIdParamSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], UsersController.prototype, "reactivateUser", null);
exports.UsersController = UsersController = UsersController_1 = __decorate([
    (0, swagger_1.ApiTags)('users'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('users'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof users_service_1.UsersService !== "undefined" && users_service_1.UsersService) === "function" ? _a : Object, typeof (_b = typeof supabase_storage_service_1.SupabaseStorageService !== "undefined" && supabase_storage_service_1.SupabaseStorageService) === "function" ? _b : Object, typeof (_c = typeof role_utils_1.RoleUtils !== "undefined" && role_utils_1.RoleUtils) === "function" ? _c : Object])
], UsersController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3VzZXJzL3VzZXJzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0Fld0I7QUFDeEIsK0RBQWlFO0FBQ2pFLDZDQVF5QjtBQUN6QixtRUFBOEQ7QUFDOUQsdUVBQWtFO0FBQ2xFLG1GQUFxRTtBQUNyRSw2RkFBOEU7QUFDOUUsOEVBQXlFO0FBQ3pFLHFEQVF5QjtBQUN6QixtREFBK0M7QUFDL0MsMkZBQXNGO0FBQ3RGLHFEQUFpRDtBQU0xQyxJQUFNLGVBQWUsdUJBQXJCLE1BQU0sZUFBZTtJQUlQO0lBQ0E7SUFDQTtJQUxGLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxpQkFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNELFlBQ21CLFlBQTBCLEVBQzFCLHNCQUE4QyxFQUM5QyxTQUFvQjtRQUZwQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLGNBQVMsR0FBVCxTQUFTLENBQVc7SUFDcEMsQ0FBQztJQW1DRSxBQUFOLEtBQUssQ0FBQyxPQUFPLENBQWtCLGFBQXFCO1FBQ2xELElBQUksQ0FBQztZQUNILElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsYUFBYSx1QkFBdUIsQ0FBQyxDQUFDO1lBQy9ELE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQVEsQ0FBQztRQUNwRCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ25ELE1BQU0sSUFBSSxzQkFBYSxDQUNyQiwwQkFBMEIsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZSxF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QixDQUFDLENBQUMsQ0FBQTtJQUMvQyxXQUFBLElBQUEseUNBQWEsR0FBRSxDQUFBOzs7d0RBQ2YsT0FBTyxvQkFBUCxPQUFPOzZDQTJCVDtBQUtLO0lBSEwsSUFBQSxhQUFJLEVBQUMsZ0JBQWdCLENBQUM7SUFDdEIsSUFBQSxrQkFBUyxFQUFDLGlDQUFjLENBQUM7SUFDekIsSUFBQSxnQ0FBUyxHQUFFO0lBRVQsV0FBQSxJQUFBLGNBQUssRUFBQyxJQUFJLHVDQUFpQixDQUFDLG1DQUFpQixDQUFDLENBQUMsQ0FBQTtJQUMvQyxXQUFBLElBQUEsYUFBSSxFQUFDLElBQUksdUNBQWlCLENBQUMseUNBQXVCLENBQUMsQ0FBQyxDQUFBO0lBRXBELFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7Ozt3REFDZixPQUFPLG9CQUFQLE9BQU87cURBZVQ7QUFLSztJQUhMLElBQUEsYUFBSSxFQUFDLGdCQUFnQixDQUFDO0lBQ3RCLElBQUEsa0JBQVMsRUFBQyxpQ0FBYyxDQUFDO0lBQ3pCLElBQUEsZ0NBQVMsR0FBRTtJQUVULFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSx1Q0FBaUIsQ0FBQyxtQ0FBaUIsQ0FBQyxDQUFDLENBQUE7SUFDL0MsV0FBQSxJQUFBLHlDQUFhLEdBQUUsQ0FBQTs7O3dEQUNmLE9BQU8sb0JBQVAsT0FBTztxREFhVDswQkFsU1UsZUFBZTtJQUozQixJQUFBLGlCQUFPLEVBQUMsT0FBTyxDQUFDO0lBQ2hCLElBQUEsdUJBQWEsRUFBQyxVQUFVLENBQUM7SUFDekIsSUFBQSxtQkFBVSxFQUFDLE9BQU8sQ0FBQztJQUNuQixJQUFBLGtCQUFTLEVBQUMsNkJBQVksQ0FBQzt5REFLVyw0QkFBWSxvQkFBWiw0QkFBWSxvREFDRixpREFBc0Isb0JBQXRCLGlEQUFzQixvREFDbkMsc0JBQVMsb0JBQVQsc0JBQVM7R0FONUIsZUFBZSxDQW1TM0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3VzZXJzL3VzZXJzLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQm9keSxcbiAgQ29udHJvbGxlcixcbiAgRGVsZXRlLFxuICBHZXQsXG4gIEh0dHBFeGNlcHRpb24sXG4gIEh0dHBTdGF0dXMsXG4gIFBhcmFtLFxuICBQdXQsXG4gIFBvc3QsXG4gIFVzZUd1YXJkcyxcbiAgVXNlSW50ZXJjZXB0b3JzLFxuICBVcGxvYWRlZEZpbGVzLFxuICBMb2dnZXIsXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgRmlsZUZpZWxkc0ludGVyY2VwdG9yIH0gZnJvbSAnQG5lc3Rqcy9wbGF0Zm9ybS1leHByZXNzJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJvZHksXG4gIEFwaUJlYXJlckF1dGgsXG4gIEFwaVBhcmFtLFxuICBBcGlDb25zdW1lcyxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJ3NyYy9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBBZG1pbkF1dGhHdWFyZCB9IGZyb20gJ3NyYy9hdXRoL2d1YXJkcy9hZG1pbi1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEFkbWluT25seSB9IGZyb20gJ3NyYy9hdXRoL2RlY29yYXRvcnMvYWRtaW4tb25seS5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVzZXJJZCB9IGZyb20gJ3NyYy9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLWlkLmRlY29yYXRvcic7XG5pbXBvcnQgeyBab2RWYWxpZGF0aW9uUGlwZSB9IGZyb20gJ3NyYy9jb21tb24vcGlwZXMvem9kLXZhbGlkYXRpb24ucGlwZSc7XG5pbXBvcnQge1xuICBVc2VySWRQYXJhbVNjaGVtYSxcbiAgRGVhY3RpdmF0ZVVzZXJEdG9TY2hlbWEsXG4gIFVwZGF0ZVVzZXJSZXF1ZXN0U2NoZW1hLFxuICB0eXBlIFVzZXJJZFBhcmFtLFxuICB0eXBlIERlYWN0aXZhdGVVc2VyRHRvLFxuICB0eXBlIFVwZGF0ZVVzZXJSZXF1ZXN0LFxuICB0eXBlIFVzZXIsXG59IGZyb20gJ21lbnRhcmEtY29tbW9ucyc7XG5pbXBvcnQgeyBVc2Vyc1NlcnZpY2UgfSBmcm9tICcuL3VzZXJzLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3VwYWJhc2VTdG9yYWdlU2VydmljZSB9IGZyb20gJ3NyYy9jb21tb24vc2VydmljZXMvc3VwYWJhc2Utc3RvcmFnZS5zZXJ2aWNlJztcbmltcG9ydCB7IFJvbGVVdGlscyB9IGZyb20gJ3NyYy91dGlscy9yb2xlLXV0aWxzJztcblxuQEFwaVRhZ3MoJ3VzZXJzJylcbkBBcGlCZWFyZXJBdXRoKCdKV1QtYXV0aCcpXG5AQ29udHJvbGxlcigndXNlcnMnKVxuQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG5leHBvcnQgY2xhc3MgVXNlcnNDb250cm9sbGVyIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKFVzZXJzQ29udHJvbGxlci5uYW1lKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHVzZXJzU2VydmljZTogVXNlcnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgc3VwYWJhc2VTdG9yYWdlU2VydmljZTogU3VwYWJhc2VTdG9yYWdlU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJvbGVVdGlsczogUm9sZVV0aWxzLFxuICApIHt9XG5cbiAgQEdldCgpXG4gIEBVc2VHdWFyZHMoQWRtaW5BdXRoR3VhcmQpXG4gIEBBZG1pbk9ubHkoKVxuICBAQXBpT3BlcmF0aW9uKHsgXG4gICAgc3VtbWFyeTogJ0dldCBhbGwgdXNlcnMnLFxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmUgYWxsIHVzZXJzIGluIHRoZSBzeXN0ZW0uIEFkbWluIGFjY2VzcyByZXF1aXJlZC4nXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IFxuICAgIHN0YXR1czogMjAwLCBcbiAgICBkZXNjcmlwdGlvbjogJ1VzZXJzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ2FycmF5JyxcbiAgICAgIGl0ZW1zOiB7XG4gICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgaWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICBlbWFpbDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgIGZpcnN0TmFtZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgIGxhc3ROYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgcm9sZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgIGNyZWF0ZWRBdDogeyB0eXBlOiAnc3RyaW5nJywgZm9ybWF0OiAnZGF0ZS10aW1lJyB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IFxuICAgIHN0YXR1czogNDAxLCBcbiAgICBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCAtIEludmFsaWQgb3IgbWlzc2luZyBKV1QgdG9rZW4nIFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBcbiAgICBzdGF0dXM6IDQwMywgXG4gICAgZGVzY3JpcHRpb246ICdGb3JiaWRkZW4gLSBBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnIFxuICB9KVxuICBhc3luYyBmaW5kQWxsKEBDdXJyZW50VXNlcklkKCkgY3VycmVudFVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyW10+IHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2dnZXIubG9nKGBBZG1pbiAke2N1cnJlbnRVc2VySWR9IHJldHJpZXZpbmcgYWxsIHVzZXJzYCk7XG4gICAgICByZXR1cm4gKGF3YWl0IHRoaXMudXNlcnNTZXJ2aWNlLmZpbmRBbGwoKSkgYXMgYW55O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIHVzZXJzOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICBgRmFpbGVkIHRvIGZldGNoIHVzZXJzOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWAsXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAR2V0KCdhbGwtaW5jbHVkaW5nLWluYWN0aXZlJylcbiAgQFVzZUd1YXJkcyhBZG1pbkF1dGhHdWFyZClcbiAgQEFkbWluT25seSgpXG4gIGFzeW5jIGZpbmRBbGxJbmNsdWRlSW5hY3RpdmUoXG4gICAgQEN1cnJlbnRVc2VySWQoKSBjdXJyZW50VXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8VXNlcltdPiB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgYEFkbWluICR7Y3VycmVudFVzZXJJZH0gcmV0cmlldmluZyBhbGwgdXNlcnMgaW5jbHVkaW5nIGluYWN0aXZlYCxcbiAgICAgICk7XG4gICAgICByZXR1cm4gKGF3YWl0IHRoaXMudXNlcnNTZXJ2aWNlLmZpbmRBbGxJbmNsdWRlSW5hY3RpdmUoKSkgYXMgYW55O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIGFsbCB1c2VyczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgYEZhaWxlZCB0byBmZXRjaCB1c2VyczogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnOmlkJylcbiAgYXN5bmMgZmluZE9uZShcbiAgICBAUGFyYW0obmV3IFpvZFZhbGlkYXRpb25QaXBlKFVzZXJJZFBhcmFtU2NoZW1hKSkgcGFyYW1zOiBVc2VySWRQYXJhbSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIGN1cnJlbnRVc2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxVc2VyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZXJzIGNhbiBvbmx5IHZpZXcgdGhlaXIgb3duIHByb2ZpbGUgdW5sZXNzIHRoZXkncmUgYWRtaW5cbiAgICAgIGNvbnN0IGlzQWRtaW4gPSBhd2FpdCB0aGlzLnJvbGVVdGlscy5pc1VzZXJBZG1pbihjdXJyZW50VXNlcklkKTtcblxuICAgICAgaWYgKCFpc0FkbWluICYmIHBhcmFtcy5pZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdZb3UgY2FuIG9ubHkgYWNjZXNzIHlvdXIgb3duIHByb2ZpbGUnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlciA9IGlzQWRtaW5cbiAgICAgICAgPyBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5maW5kT25lSW5jbHVkZUluYWN0aXZlKHBhcmFtcy5pZClcbiAgICAgICAgOiBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5maW5kT25lKHBhcmFtcy5pZCk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnLCBIdHRwU3RhdHVzLk5PVF9GT1VORCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdXNlciBhcyBhbnk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBGb3JiaWRkZW5FeGNlcHRpb24gfHxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBIdHRwRXhjZXB0aW9uXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIHVzZXI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgIGBGYWlsZWQgdG8gZmV0Y2ggdXNlcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQFB1dCgnOmlkJylcbiAgQFVzZUludGVyY2VwdG9ycyhcbiAgICBGaWxlRmllbGRzSW50ZXJjZXB0b3IoW1xuICAgICAgeyBuYW1lOiAnYXZhdGFyJywgbWF4Q291bnQ6IDEgfSxcbiAgICAgIHsgbmFtZTogJ2NvdmVyJywgbWF4Q291bnQ6IDEgfSxcbiAgICBdKSxcbiAgKVxuICBhc3luYyB1cGRhdGUoXG4gICAgQFBhcmFtKG5ldyBab2RWYWxpZGF0aW9uUGlwZShVc2VySWRQYXJhbVNjaGVtYSkpIHBhcmFtczogVXNlcklkUGFyYW0sXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFVwZGF0ZVVzZXJSZXF1ZXN0U2NoZW1hKSlcbiAgICB1c2VyRGF0YTogVXBkYXRlVXNlclJlcXVlc3QsXG4gICAgQEN1cnJlbnRVc2VySWQoKSBjdXJyZW50VXNlcklkOiBzdHJpbmcsXG4gICAgQFVwbG9hZGVkRmlsZXMoKVxuICAgIGZpbGVzPzogeyBhdmF0YXI/OiBFeHByZXNzLk11bHRlci5GaWxlW107IGNvdmVyPzogRXhwcmVzcy5NdWx0ZXIuRmlsZVtdIH0sXG4gICk6IFByb21pc2U8VXNlcj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2VycyBjYW4gb25seSB1cGRhdGUgdGhlaXIgb3duIHByb2ZpbGUgdW5sZXNzIHRoZXkncmUgYWRtaW5cbiAgICAgIGNvbnN0IGlzQWRtaW4gPSBhd2FpdCB0aGlzLnJvbGVVdGlscy5pc1VzZXJBZG1pbihjdXJyZW50VXNlcklkKTtcblxuICAgICAgaWYgKCFpc0FkbWluICYmIHBhcmFtcy5pZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdZb3UgY2FuIG9ubHkgdXBkYXRlIHlvdXIgb3duIHByb2ZpbGUnKTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGZpbGUgdXBsb2FkcyBpZiBwcm92aWRlZFxuICAgICAgbGV0IGF2YXRhclVybDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgbGV0IGNvdmVySW1hZ2VVcmw6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICAgICAgaWYgKGZpbGVzPy5hdmF0YXI/LlswXSkge1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uID0gdGhpcy5zdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLnZhbGlkYXRlRmlsZShcbiAgICAgICAgICBmaWxlcy5hdmF0YXJbMF0sXG4gICAgICAgICk7XG4gICAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgICAgICBgQXZhdGFyIHZhbGlkYXRpb24gZmFpbGVkOiAke3ZhbGlkYXRpb24uZXJyb3J9YCxcbiAgICAgICAgICAgIEh0dHBTdGF0dXMuQkFEX1JFUVVFU1QsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGxvYWRSZXN1bHQgPSBhd2FpdCB0aGlzLnN1cGFiYXNlU3RvcmFnZVNlcnZpY2UudXBsb2FkRmlsZShcbiAgICAgICAgICBmaWxlcy5hdmF0YXJbMF0sXG4gICAgICAgICAgU3VwYWJhc2VTdG9yYWdlU2VydmljZS5nZXRTdXBwb3J0ZWRCdWNrZXRzKCkuVVNFUl9QUk9GSUxFUyxcbiAgICAgICAgKTtcbiAgICAgICAgYXZhdGFyVXJsID0gdXBsb2FkUmVzdWx0LnVybDtcbiAgICAgIH1cblxuICAgICAgaWYgKGZpbGVzPy5jb3Zlcj8uWzBdKSB7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLnN1cGFiYXNlU3RvcmFnZVNlcnZpY2UudmFsaWRhdGVGaWxlKFxuICAgICAgICAgIGZpbGVzLmNvdmVyWzBdLFxuICAgICAgICApO1xuICAgICAgICBpZiAoIXZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAgICAgYENvdmVyIGltYWdlIHZhbGlkYXRpb24gZmFpbGVkOiAke3ZhbGlkYXRpb24uZXJyb3J9YCxcbiAgICAgICAgICAgIEh0dHBTdGF0dXMuQkFEX1JFUVVFU1QsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGxvYWRSZXN1bHQgPSBhd2FpdCB0aGlzLnN1cGFiYXNlU3RvcmFnZVNlcnZpY2UudXBsb2FkRmlsZShcbiAgICAgICAgICBmaWxlcy5jb3ZlclswXSxcbiAgICAgICAgICBTdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLmdldFN1cHBvcnRlZEJ1Y2tldHMoKS5VU0VSX1BST0ZJTEVTLFxuICAgICAgICApO1xuICAgICAgICBjb3ZlckltYWdlVXJsID0gdXBsb2FkUmVzdWx0LnVybDtcbiAgICAgIH1cblxuICAgICAgLy8gUHJldmVudCBub24tYWRtaW5zIGZyb20gY2hhbmdpbmcgc2Vuc2l0aXZlIGZpZWxkc1xuICAgICAgaWYgKCFpc0FkbWluKSB7XG4gICAgICAgIGNvbnN0IGFsbG93ZWRGaWVsZHMgPSBbXG4gICAgICAgICAgJ2ZpcnN0TmFtZScsXG4gICAgICAgICAgJ2xhc3ROYW1lJyxcbiAgICAgICAgICAnYmlvJyxcbiAgICAgICAgICAnYXZhdGFyVXJsJyxcbiAgICAgICAgICAnY292ZXJJbWFnZVVybCcsXG4gICAgICAgICAgJ3Bob25lTnVtYmVyJyxcbiAgICAgICAgICAndGltZXpvbmUnLFxuICAgICAgICAgICdsYW5ndWFnZScsXG4gICAgICAgICAgJ3RoZW1lJyxcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3Qgc2FuaXRpemVkRGF0YTogUGFydGlhbDxVcGRhdGVVc2VyUmVxdWVzdD4gPSB7fTtcblxuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGFsbG93ZWRGaWVsZHMpIHtcbiAgICAgICAgICBpZiAodXNlckRhdGFbZmllbGQgYXMga2V5b2YgVXBkYXRlVXNlclJlcXVlc3RdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIChzYW5pdGl6ZWREYXRhIGFzIGFueSlbZmllbGRdID1cbiAgICAgICAgICAgICAgdXNlckRhdGFbZmllbGQgYXMga2V5b2YgVXBkYXRlVXNlclJlcXVlc3RdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB1c2VyRGF0YSA9IHNhbml0aXplZERhdGEgYXMgVXBkYXRlVXNlclJlcXVlc3Q7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB1cGxvYWRlZCBmaWxlIFVSTHMgdG8gdXNlckRhdGFcbiAgICAgIGlmIChhdmF0YXJVcmwpIHVzZXJEYXRhLmF2YXRhclVybCA9IGF2YXRhclVybDtcbiAgICAgIGlmIChjb3ZlckltYWdlVXJsKSB1c2VyRGF0YS5jb3ZlckltYWdlVXJsID0gY292ZXJJbWFnZVVybDtcblxuICAgICAgcmV0dXJuIChhd2FpdCB0aGlzLnVzZXJzU2VydmljZS51cGRhdGUocGFyYW1zLmlkLCB1c2VyRGF0YSkpIGFzIGFueTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRm9yYmlkZGVuRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgdXNlcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgYEZhaWxlZCB0byB1cGRhdGUgdXNlcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQERlbGV0ZSgnOmlkJylcbiAgYXN5bmMgcmVtb3ZlKFxuICAgIEBQYXJhbShuZXcgWm9kVmFsaWRhdGlvblBpcGUoVXNlcklkUGFyYW1TY2hlbWEpKSBwYXJhbXM6IFVzZXJJZFBhcmFtLFxuICAgIEBDdXJyZW50VXNlcklkKCkgY3VycmVudFVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXNlcnMgY2FuIG9ubHkgZGVhY3RpdmF0ZSB0aGVpciBvd24gYWNjb3VudCB1bmxlc3MgdGhleSdyZSBhZG1pblxuICAgICAgY29uc3QgaXNBZG1pbiA9IGF3YWl0IHRoaXMucm9sZVV0aWxzLmlzVXNlckFkbWluKGN1cnJlbnRVc2VySWQpO1xuXG4gICAgICBpZiAoIWlzQWRtaW4gJiYgcGFyYW1zLmlkICE9PSBjdXJyZW50VXNlcklkKSB7XG4gICAgICAgIHRocm93IG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oXG4gICAgICAgICAgJ1lvdSBjYW4gb25seSBkZWFjdGl2YXRlIHlvdXIgb3duIGFjY291bnQnLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBVc2VyL0FkbWluICR7Y3VycmVudFVzZXJJZH0gZGVhY3RpdmF0aW5nIHVzZXIgJHtwYXJhbXMuaWR9YCxcbiAgICAgICk7XG4gICAgICBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5yZW1vdmUocGFyYW1zLmlkKTtcblxuICAgICAgcmV0dXJuIHsgbWVzc2FnZTogJ1VzZXIgYWNjb3VudCBkZWFjdGl2YXRlZCBzdWNjZXNzZnVsbHknIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEZvcmJpZGRlbkV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZGVhY3RpdmF0ZSB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICBgRmFpbGVkIHRvIGRlYWN0aXZhdGUgdXNlcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQFBvc3QoJzppZC9kZWFjdGl2YXRlJylcbiAgQFVzZUd1YXJkcyhBZG1pbkF1dGhHdWFyZClcbiAgQEFkbWluT25seSgpXG4gIGFzeW5jIGRlYWN0aXZhdGVVc2VyKFxuICAgIEBQYXJhbShuZXcgWm9kVmFsaWRhdGlvblBpcGUoVXNlcklkUGFyYW1TY2hlbWEpKSBwYXJhbXM6IFVzZXJJZFBhcmFtLFxuICAgIEBCb2R5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShEZWFjdGl2YXRlVXNlckR0b1NjaGVtYSkpXG4gICAgYm9keTogRGVhY3RpdmF0ZVVzZXJEdG8sXG4gICAgQEN1cnJlbnRVc2VySWQoKSBjdXJyZW50VXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBBZG1pbiAke2N1cnJlbnRVc2VySWR9IGRlYWN0aXZhdGluZyB1c2VyICR7cGFyYW1zLmlkfSB3aXRoIHJlYXNvbjogJHtib2R5LnJlYXNvbn1gLFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHRoaXMudXNlcnNTZXJ2aWNlLmRlYWN0aXZhdGUocGFyYW1zLmlkLCBib2R5LnJlYXNvbiwgY3VycmVudFVzZXJJZCk7XG5cbiAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICdVc2VyIGFjY291bnQgZGVhY3RpdmF0ZWQgYnkgYWRtaW5pc3RyYXRvcicgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBkZWFjdGl2YXRlIHVzZXI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgIGBGYWlsZWQgdG8gZGVhY3RpdmF0ZSB1c2VyOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWAsXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAUG9zdCgnOmlkL3JlYWN0aXZhdGUnKVxuICBAVXNlR3VhcmRzKEFkbWluQXV0aEd1YXJkKVxuICBAQWRtaW5Pbmx5KClcbiAgYXN5bmMgcmVhY3RpdmF0ZVVzZXIoXG4gICAgQFBhcmFtKG5ldyBab2RWYWxpZGF0aW9uUGlwZShVc2VySWRQYXJhbVNjaGVtYSkpIHBhcmFtczogVXNlcklkUGFyYW0sXG4gICAgQEN1cnJlbnRVc2VySWQoKSBjdXJyZW50VXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBtZXNzYWdlOiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYEFkbWluICR7Y3VycmVudFVzZXJJZH0gcmVhY3RpdmF0aW5nIHVzZXIgJHtwYXJhbXMuaWR9YCk7XG4gICAgICBhd2FpdCB0aGlzLnVzZXJzU2VydmljZS5yZWFjdGl2YXRlKHBhcmFtcy5pZCk7XG5cbiAgICAgIHJldHVybiB7IG1lc3NhZ2U6ICdVc2VyIGFjY291bnQgcmVhY3RpdmF0ZWQgc3VjY2Vzc2Z1bGx5JyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJlYWN0aXZhdGUgdXNlcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgYEZhaWxlZCB0byByZWFjdGl2YXRlIHVzZXI6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9