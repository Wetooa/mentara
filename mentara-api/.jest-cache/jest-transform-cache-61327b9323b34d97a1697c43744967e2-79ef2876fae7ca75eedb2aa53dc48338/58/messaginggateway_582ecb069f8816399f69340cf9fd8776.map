{"version":3,"names":["websockets_1","cov_9q5gr7w5k","s","require","socket_io_1","common_1","prisma_client_provider_1","websocket_auth_service_1","mentara_commons_1","MessagingGateway","MessagingGateway_1","prisma","webSocketAuth","server","logger","Logger","name","userSockets","Map","conversationParticipants","constructor","f","handleConnection","client","log","id","authResult","authenticateSocket","b","warn","emit","message","code","disconnect","userId","userRole","role","isAuthenticated","user","findUnique","where","isActive","select","has","set","Set","get","add","joinUserConversations","subscribeUserToPersonalRoom","timestamp","Date","toISOString","broadcastUserStatus","error","handleDisconnect","delete","size","conversationId","participants","entries","cleanupConnection","handleJoinConversation","data","participation","conversationParticipant","findFirst","join","to","handleLeaveConversation","leave","handleTypingIndicator","isTyping","typingIndicator","upsert","conversationId_userId","create","lastTypingAt","update","deleteMany","broadcastMessage","sendPushNotifications","broadcastMessageUpdate","messageId","broadcastReadReceipt","readAt","broadcastReaction","reaction","conversations","conversation","findMany","some","length","status","include","notificationSettings","deviceTokens","eligibleParticipants","filter","participant","senderId","settings","pushNewMessages","notificationPayload","title","body","content","substring","icon","badge","url","pushPromises","flatMap","map","deviceToken","token","errorMessage","Error","includes","Promise","allSettled","cleanupTypingIndicators","fiveMinutesAgo","now","lt","userRoom","debug","unsubscribeUserFromPersonalRoom","handleJoinCommunity","communityId","membership","communityRoom","handleLeaveCommunity","handleJoinPost","postId","post","room","roomGroup","community","memberships","postRoom","handleLeavePost","getServer","exports","__decorate","WebSocketServer","Server","_c","Object","SubscribeMessage","__param","ConnectedSocket","MessageBody","JoinConversationDto","_d","LeaveConversationDto","_e","TypingIndicatorDto","_f","WebSocketGateway","cors","origin","process","env","FRONTEND_URL","credentials","namespace","PrismaService","_a","_b","WebSocketAuthService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.gateway.ts"],"sourcesContent":["import {\n  WebSocketGateway,\n  WebSocketServer,\n  SubscribeMessage,\n  OnGatewayConnection,\n  OnGatewayDisconnect,\n  ConnectedSocket,\n  MessageBody,\n} from '@nestjs/websockets';\nimport { Server, Socket } from 'socket.io';\nimport { Logger } from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { WebSocketAuthService } from './services/websocket-auth.service';\nimport {\n  JoinConversationDto,\n  LeaveConversationDto,\n  TypingIndicatorDto,\n} from 'mentara-commons';\n\ninterface AuthenticatedSocket extends Socket {\n  userId?: string;\n  userRole?: string;\n  isAuthenticated?: boolean;\n}\n\n@WebSocketGateway({\n  cors: {\n    origin: process.env.FRONTEND_URL || 'http://localhost:3000',\n    credentials: true,\n  },\n  namespace: '/messaging',\n})\nexport class MessagingGateway\n  implements OnGatewayConnection, OnGatewayDisconnect\n{\n  @WebSocketServer()\n  server!: Server;\n\n  private readonly logger = new Logger(MessagingGateway.name);\n  private userSockets = new Map<string, Set<string>>(); // userId -> Set of socket IDs\n  private conversationParticipants = new Map<string, Set<string>>(); // conversationId -> Set of user IDs\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly webSocketAuth: WebSocketAuthService,\n  ) {}\n\n  async handleConnection(client: AuthenticatedSocket) {\n    try {\n      this.logger.log(`New WebSocket connection attempt: ${client.id}`);\n\n      // Authenticate the socket connection using the new auth service\n      const authResult = await this.webSocketAuth.authenticateSocket(client);\n\n      if (!authResult) {\n        this.logger.warn(`Client ${client.id} authentication failed`);\n        client.emit('auth_error', {\n          message: 'Authentication failed. Please provide a valid token.',\n          code: 'AUTH_FAILED',\n        });\n        client.disconnect(true);\n        return;\n      }\n\n      // Attach authenticated user info to socket\n      client.userId = authResult.userId;\n      client.userRole = authResult.role;\n      client.isAuthenticated = true;\n\n      // Verify user exists in database and is active\n      const user = await this.prisma.user.findUnique({\n        where: {\n          id: authResult.userId,\n          isActive: true, // Only allow active users\n        },\n        select: { id: true, role: true, isActive: true },\n      });\n\n      if (!user) {\n        this.logger.warn(`User ${authResult.userId} not found or inactive`);\n        client.emit('auth_error', {\n          message: 'User account not found or inactive',\n          code: 'USER_NOT_FOUND',\n        });\n        client.disconnect(true);\n        return;\n      }\n\n      // Add socket to user's socket set\n      if (!this.userSockets.has(authResult.userId)) {\n        this.userSockets.set(authResult.userId, new Set());\n      }\n      this.userSockets.get(authResult.userId)!.add(client.id);\n\n      // Join user to their conversation rooms\n      await this.joinUserConversations(client, authResult.userId);\n\n      // Subscribe user to their personal notification room\n      await this.subscribeUserToPersonalRoom(client, authResult.userId);\n\n      // Notify successful connection\n      client.emit('authenticated', {\n        userId: authResult.userId,\n        role: user.role,\n        message: 'Successfully authenticated and connected',\n        timestamp: new Date().toISOString(),\n      });\n\n      // Emit user online status to their contacts\n      await this.broadcastUserStatus(authResult.userId, 'online');\n\n      this.logger.log(\n        `User ${authResult.userId} successfully authenticated and connected with socket ${client.id}`,\n      );\n    } catch (error) {\n      this.logger.error(`Connection error for client ${client.id}:`, error);\n      client.emit('connection_error', {\n        message: 'Internal server error during connection',\n        code: 'INTERNAL_ERROR',\n      });\n      client.disconnect(true);\n    }\n  }\n\n  async handleDisconnect(client: AuthenticatedSocket) {\n    try {\n      if (client.userId) {\n        const userSockets = this.userSockets.get(client.userId);\n        if (userSockets) {\n          userSockets.delete(client.id);\n\n          // If no more sockets for this user, remove from tracking\n          if (userSockets.size === 0) {\n            this.userSockets.delete(client.userId);\n\n            // Clean up conversation participants tracking\n            for (const [\n              conversationId,\n              participants,\n            ] of this.conversationParticipants.entries()) {\n              participants.delete(client.userId);\n              // Remove empty conversation sets\n              if (participants.size === 0) {\n                this.conversationParticipants.delete(conversationId);\n              }\n            }\n\n            // Broadcast user offline status to their contacts\n            await this.broadcastUserStatus(client.userId, 'offline');\n          }\n        }\n\n        this.logger.log(\n          `User ${client.userId} disconnected socket ${client.id}`,\n        );\n      }\n\n      // Clean up authentication tracking\n      this.webSocketAuth.cleanupConnection(client.id);\n    } catch (error) {\n      this.logger.error(\n        `Error during disconnect cleanup for socket ${client.id}:`,\n        error,\n      );\n    }\n  }\n\n  @SubscribeMessage('join_conversation')\n  async handleJoinConversation(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: JoinConversationDto,\n  ) {\n    // Authentication guard\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    try {\n      const { conversationId } = data;\n      const userId = client.userId!;\n\n      // Verify user is a participant in this conversation\n      const participation = await this.prisma.conversationParticipant.findFirst(\n        {\n          where: {\n            conversationId,\n            userId,\n            isActive: true,\n          },\n        },\n      );\n\n      if (!participation) {\n        client.emit('error', { message: 'Access denied to this conversation' });\n        return;\n      }\n\n      // Join socket to conversation room\n      void client.join(conversationId);\n\n      // Add user to conversation participants tracking\n      if (!this.conversationParticipants.has(conversationId)) {\n        this.conversationParticipants.set(conversationId, new Set());\n      }\n      this.conversationParticipants.get(conversationId)!.add(userId);\n\n      // Notify other participants that user joined\n      client.to(conversationId).emit('user_joined_conversation', {\n        conversationId,\n        userId,\n      });\n\n      client.emit('conversation_joined', { conversationId });\n      this.logger.log(`User ${userId} joined conversation ${conversationId}`);\n    } catch (error) {\n      this.logger.error('Error joining conversation:', error);\n      client.emit('error', { message: 'Failed to join conversation' });\n    }\n  }\n\n  @SubscribeMessage('leave_conversation')\n  handleLeaveConversation(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: LeaveConversationDto,\n  ) {\n    // Authentication guard\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { conversationId } = data;\n    const userId = client.userId!;\n\n    void client.leave(conversationId);\n\n    // Remove user from conversation participants tracking\n    const participants = this.conversationParticipants.get(conversationId);\n    if (participants) {\n      participants.delete(userId);\n      if (participants.size === 0) {\n        this.conversationParticipants.delete(conversationId);\n      }\n    }\n\n    // Notify other participants that user left\n    client.to(conversationId).emit('user_left_conversation', {\n      conversationId,\n      userId,\n    });\n\n    client.emit('conversation_left', { conversationId });\n    this.logger.log(`User ${userId} left conversation ${conversationId}`);\n  }\n\n  @SubscribeMessage('typing_indicator')\n  async handleTypingIndicator(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: TypingIndicatorDto,\n  ) {\n    // Authentication guard\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { conversationId, isTyping = true } = data;\n    const userId = client.userId!;\n\n    // Update typing indicator in database for persistence\n    if (isTyping) {\n      await this.prisma.typingIndicator.upsert({\n        where: {\n          conversationId_userId: {\n            conversationId,\n            userId,\n          },\n        },\n        create: {\n          conversationId,\n          userId,\n          lastTypingAt: new Date(),\n        },\n        update: {\n          lastTypingAt: new Date(),\n        },\n      });\n    } else {\n      // Remove typing indicator when user stops typing\n      await this.prisma.typingIndicator.deleteMany({\n        where: {\n          conversationId,\n          userId,\n        },\n      });\n    }\n\n    // Broadcast typing indicator to other participants in the conversation\n    client.to(conversationId).emit('typing_indicator', {\n      conversationId,\n      userId,\n      isTyping,\n    });\n  }\n\n  // Broadcast new message to conversation participants\n  broadcastMessage(conversationId: string, message: any) {\n    this.server.to(conversationId).emit('new_message', message);\n\n    // Send push notification to offline users (implement as needed)\n    this.sendPushNotifications(conversationId, message);\n  }\n\n  // Broadcast message update (edit/delete)\n  broadcastMessageUpdate(\n    conversationId: string,\n    messageId: string,\n    update: any,\n  ) {\n    this.server.to(conversationId).emit('message_updated', {\n      messageId,\n      ...update,\n    });\n  }\n\n  // Broadcast read receipt\n  broadcastReadReceipt(\n    conversationId: string,\n    messageId: string,\n    userId: string,\n  ) {\n    this.server.to(conversationId).emit('message_read', {\n      messageId,\n      userId,\n      readAt: new Date(),\n    });\n  }\n\n  // Broadcast message reaction\n  broadcastReaction(conversationId: string, messageId: string, reaction: any) {\n    this.server.to(conversationId).emit('message_reaction', {\n      messageId,\n      reaction,\n    });\n  }\n\n  // Private helper methods\n  // Authentication guard for message handlers\n  private isAuthenticated(client: AuthenticatedSocket): boolean {\n    if (!client.isAuthenticated || !client.userId) {\n      this.logger.warn(\n        `Unauthenticated client ${client.id} attempted to perform action`,\n      );\n      client.emit('auth_error', {\n        message: 'Authentication required for this action',\n        code: 'AUTH_REQUIRED',\n      });\n      return false;\n    }\n    return true;\n  }\n\n  private async joinUserConversations(\n    client: AuthenticatedSocket,\n    userId: string,\n  ) {\n    try {\n      // Get all active conversations for the user\n      const conversations = await this.prisma.conversation.findMany({\n        where: {\n          participants: {\n            some: {\n              userId,\n              isActive: true,\n            },\n          },\n          isActive: true,\n        },\n        select: {\n          id: true,\n        },\n      });\n\n      // Join all conversation rooms\n      for (const conversation of conversations) {\n        void client.join(conversation.id);\n\n        // Add to tracking\n        if (!this.conversationParticipants.has(conversation.id)) {\n          this.conversationParticipants.set(conversation.id, new Set());\n        }\n        this.conversationParticipants.get(conversation.id)!.add(userId);\n      }\n\n      this.logger.log(\n        `User ${userId} joined ${conversations.length} conversation rooms`,\n      );\n    } catch (error) {\n      this.logger.error('Error joining user conversations:', error);\n    }\n  }\n\n  private async broadcastUserStatus(\n    userId: string,\n    status: 'online' | 'offline',\n  ) {\n    // Get all conversations this user participates in\n    const conversations = await this.prisma.conversation.findMany({\n      where: {\n        participants: {\n          some: {\n            userId,\n            isActive: true,\n          },\n        },\n      },\n      select: {\n        id: true,\n      },\n    });\n\n    // Broadcast status to all conversation rooms\n    for (const conversation of conversations) {\n      this.server.to(conversation.id).emit('user_status_changed', {\n        userId,\n        status,\n        timestamp: new Date(),\n      });\n    }\n  }\n\n  private async sendPushNotifications(conversationId: string, message: any) {\n    try {\n      // Get all participants in the conversation except the sender\n      const conversation = await this.prisma.conversation.findUnique({\n        where: { id: conversationId },\n        include: {\n          participants: {\n            include: {\n              user: {\n                include: {\n                  notificationSettings: true,\n                  deviceTokens: true,\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!conversation) {\n        this.logger.warn(\n          `Conversation ${conversationId} not found for push notifications`,\n        );\n        return;\n      }\n\n      // Filter participants who should receive push notifications\n      const eligibleParticipants = conversation.participants.filter(\n        (participant) => {\n          // Don't send to message sender\n          if (participant.userId === message.senderId) {\n            return false;\n          }\n\n          // Check if user has push notifications enabled for messages\n          const settings = participant.user.notificationSettings;\n          if (!settings?.pushNewMessages) {\n            return false;\n          }\n\n          // Check if user has active device tokens for push notifications\n          return (\n            participant.user.deviceTokens &&\n            participant.user.deviceTokens.length > 0\n          );\n        },\n      );\n\n      if (eligibleParticipants.length === 0) {\n        this.logger.log(\n          `No eligible participants for push notifications in conversation ${conversationId}`,\n        );\n        return;\n      }\n\n      // Prepare notification payload\n      const notificationPayload = {\n        title: 'New Message',\n        body:\n          message.content.length > 50\n            ? `${message.content.substring(0, 50)}...`\n            : message.content,\n        icon: '/icon-192x192.png',\n        badge: '/badge-72x72.png',\n        data: {\n          conversationId: conversationId,\n          messageId: message.id,\n          senderId: message.senderId,\n          url: `/user/messages?conversation=${conversationId}`,\n        },\n      };\n\n      // Send push notifications to all eligible participants\n      const pushPromises = eligibleParticipants.flatMap((participant) =>\n        participant.user.deviceTokens.map(async (deviceToken: any) => {\n          try {\n            // Simplified push notification - would implement proper service if available\n            this.logger.log(\n              `Would send push notification to device: ${deviceToken.token}`,\n            );\n\n            this.logger.log(\n              `Push notification sent to user ${participant.userId} for message ${message.id}`,\n            );\n          } catch (error) {\n            const errorMessage =\n              error instanceof Error ? error.message : 'Unknown error';\n            this.logger.error(\n              `Failed to send push notification to user ${participant.userId}: ${errorMessage}`,\n            );\n\n            // If subscription is invalid, remove it\n            if (\n              errorMessage.includes('invalid') ||\n              errorMessage.includes('expired')\n            ) {\n              await this.prisma.deviceToken.delete({\n                where: { id: deviceToken.id },\n              });\n              this.logger.log(\n                `Removed invalid push subscription for user ${participant.userId}`,\n              );\n            }\n          }\n        }),\n      );\n\n      await Promise.allSettled(pushPromises);\n\n      this.logger.log(\n        `Push notification processing completed for conversation ${conversationId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Failed to send push notifications for conversation ${conversationId}:`,\n        error,\n      );\n    }\n  }\n\n  // Clean up old typing indicators (call this periodically)\n  async cleanupTypingIndicators() {\n    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);\n\n    await this.prisma.typingIndicator.deleteMany({\n      where: {\n        lastTypingAt: {\n          lt: fiveMinutesAgo,\n        },\n      },\n    });\n  }\n\n  // Personal room subscription methods for real-time notifications\n  async subscribeUserToPersonalRoom(\n    client: AuthenticatedSocket,\n    userId: string,\n  ) {\n    const userRoom = `user_${userId}`;\n    await client.join(userRoom);\n    this.logger.debug(\n      `User ${userId} subscribed to personal room: ${userRoom}`,\n    );\n  }\n\n  async unsubscribeUserFromPersonalRoom(\n    client: AuthenticatedSocket,\n    userId: string,\n  ) {\n    const userRoom = `user_${userId}`;\n    await client.leave(userRoom);\n    this.logger.debug(\n      `User ${userId} unsubscribed from personal room: ${userRoom}`,\n    );\n  }\n\n  // Community and post room subscriptions for social features\n  @SubscribeMessage('join_community')\n  async handleJoinCommunity(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { communityId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { communityId } = data;\n    const userId = client.userId!;\n\n    try {\n      // Verify user is a member of this community\n      const membership = await this.prisma.membership.findFirst({\n        where: {\n          communityId,\n          userId,\n        },\n      });\n\n      if (!membership) {\n        client.emit('error', { message: 'Access denied to this community' });\n        return;\n      }\n\n      const communityRoom = `community_${communityId}`;\n      await client.join(communityRoom);\n\n      client.emit('community_joined', { communityId });\n      this.logger.log(`User ${userId} joined community room ${communityId}`);\n    } catch (error) {\n      this.logger.error('Error joining community:', error);\n      client.emit('error', { message: 'Failed to join community' });\n    }\n  }\n\n  @SubscribeMessage('leave_community')\n  async handleLeaveCommunity(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { communityId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { communityId } = data;\n    const userId = client.userId!;\n\n    const communityRoom = `community_${communityId}`;\n    await client.leave(communityRoom);\n\n    client.emit('community_left', { communityId });\n    this.logger.log(`User ${userId} left community room ${communityId}`);\n  }\n\n  @SubscribeMessage('join_post')\n  async handleJoinPost(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { postId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { postId } = data;\n    const userId = client.userId!;\n\n    try {\n      // Verify post exists and user has access\n      const post = await this.prisma.post.findFirst({\n        where: {\n          id: postId,\n          room: {\n            roomGroup: {\n              community: {\n                memberships: {\n                  some: {\n                    userId,\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!post) {\n        client.emit('error', { message: 'Access denied to this post' });\n        return;\n      }\n\n      const postRoom = `post_${postId}`;\n      await client.join(postRoom);\n\n      client.emit('post_joined', { postId });\n      this.logger.log(`User ${userId} joined post room ${postId}`);\n    } catch (error) {\n      this.logger.error('Error joining post:', error);\n      client.emit('error', { message: 'Failed to join post' });\n    }\n  }\n\n  @SubscribeMessage('leave_post')\n  async handleLeavePost(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { postId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { postId } = data;\n    const userId = client.userId!;\n\n    const postRoom = `post_${postId}`;\n    await client.leave(postRoom);\n\n    client.emit('post_left', { postId });\n    this.logger.log(`User ${userId} left post room ${postId}`);\n  }\n\n  // Utility method to get server instance for event broadcasting\n  getServer(): Server {\n    return this.server;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}