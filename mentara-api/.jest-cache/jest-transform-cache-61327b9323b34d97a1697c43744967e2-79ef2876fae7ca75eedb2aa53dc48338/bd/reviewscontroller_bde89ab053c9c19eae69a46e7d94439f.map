{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/reviews/reviews.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/reviews/reviews.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { ReviewsService } from './reviews.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport {\n  CreateReviewDtoSchema,\n  UpdateReviewDtoSchema,\n  ModerateReviewDtoSchema,\n  GetReviewsDtoSchema,\n  ReviewIdParamSchema,\n} from './validation';\nimport type {\n  CreateReviewDto,\n  UpdateReviewDto,\n  ModerateReviewDto,\n  GetReviewsDto,\n  ReviewIdParam,\n  ReviewListResponse,\n} from './types';\n\n@Controller('reviews')\n@UseGuards(JwtAuthGuard)\nexport class ReviewsController {\n  constructor(private readonly reviewsService: ReviewsService) {}\n\n  @Post(':meetingId/:therapistId')\n  @HttpCode(HttpStatus.CREATED)\n  async createReview(\n    @Param('meetingId') meetingId: string,\n    @CurrentUserId() clientId: string,\n    @Param('therapistId') therapistId: string,\n    @Body(new ZodValidationPipe(CreateReviewDtoSchema))\n    createReviewDto: CreateReviewDto,\n  ) {\n    return this.reviewsService.createReview(\n      meetingId,\n      clientId,\n      therapistId,\n      createReviewDto,\n    );\n  }\n\n  @Put(':id')\n  async updateReview(\n    @Param('id') reviewId: string,\n    @CurrentUserId() clientId: string,\n    @Body(new ZodValidationPipe(UpdateReviewDtoSchema))\n    updateReviewDto: UpdateReviewDto,\n  ) {\n    return this.reviewsService.updateReview(\n      reviewId,\n      clientId,\n      updateReviewDto,\n    );\n  }\n\n  @Delete(':id')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteReview(\n    @Param('id') reviewId: string,\n    @CurrentUserId() clientId: string,\n  ) {\n    return this.reviewsService.deleteReview(reviewId, clientId);\n  }\n\n  @Get()\n  async getReviews(\n    @Query(new ZodValidationPipe(GetReviewsDtoSchema)) query: GetReviewsDto,\n  ): Promise<ReviewListResponse> {\n    return this.reviewsService.getReviews(query);\n  }\n\n  @Get('therapist/:therapistId')\n  async getTherapistReviews(\n    @Param('therapistId') therapistId: string,\n    @Query(new ZodValidationPipe(GetReviewsDtoSchema))\n    query: Omit<GetReviewsDto, 'therapistId'>,\n  ): Promise<ReviewListResponse> {\n    return this.reviewsService.getTherapistReviews(therapistId, query);\n  }\n\n  @Get('therapist/:therapistId/stats')\n  async getTherapistReviewStats(@Param('therapistId') therapistId: string) {\n    return this.reviewsService.getReviewStats(therapistId);\n  }\n\n  @Post(':id/helpful')\n  @HttpCode(HttpStatus.OK)\n  async markReviewHelpful(\n    @Param('id', new ZodValidationPipe(ReviewIdParamSchema)) reviewId: string,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.reviewsService.markReviewHelpful(reviewId, userId);\n  }\n\n  // Admin/Moderator endpoints\n  @Post(':id/moderate')\n  @HttpCode(HttpStatus.OK)\n  async moderateReview(\n    @Param('id', new ZodValidationPipe(ReviewIdParamSchema)) reviewId: string,\n    @CurrentUserId() moderatorId: string,\n    @CurrentUserRole() userRole: string,\n    @Body(new ZodValidationPipe(ModerateReviewDtoSchema))\n    moderateReviewDto: ModerateReviewDto,\n  ) {\n    // Only allow moderators and admins to moderate reviews\n    if (!['moderator', 'admin'].includes(userRole)) {\n      throw new ForbiddenException('Insufficient permissions');\n    }\n\n    return this.reviewsService.moderateReview(\n      reviewId,\n      moderatorId,\n      moderateReviewDto,\n    );\n  }\n\n  @Get('pending')\n  async getPendingReviews(\n    @CurrentUserRole() userRole: string,\n    @Query(new ZodValidationPipe(GetReviewsDtoSchema)) query: GetReviewsDto,\n  ): Promise<ReviewListResponse> {\n    // Only allow moderators and admins to view pending reviews\n    if (!['moderator', 'admin'].includes(userRole)) {\n      throw new ForbiddenException('Insufficient permissions');\n    }\n\n    return this.reviewsService.getReviews({\n      ...query,\n      status: 'pending',\n    });\n  }\n}\n"],"version":3}