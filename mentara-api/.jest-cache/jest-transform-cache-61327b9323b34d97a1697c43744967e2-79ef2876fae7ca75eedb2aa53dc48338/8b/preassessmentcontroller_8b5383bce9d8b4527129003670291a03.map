{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/pre-assessment.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/pre-assessment/pre-assessment.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Post,\n  Get,\n  Put,\n  Delete,\n  Body,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  InternalServerErrorException,\n  Logger,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { PreAssessmentService } from './pre-assessment.service';\nimport { AiServiceClient } from './services/ai-service.client';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../auth/decorators/current-user-role.decorator';\nimport { CreatePreAssessmentDto } from '../../schema/pre-assessment';\nimport { PreAssessment } from '@prisma/client';\n\n@Controller('pre-assessment')\n@UseGuards(JwtAuthGuard)\nexport class PreAssessmentController {\n  private readonly logger = new Logger(PreAssessmentController.name);\n\n  constructor(\n    private readonly preAssessmentService: PreAssessmentService,\n    private readonly aiServiceClient: AiServiceClient,\n  ) {}\n\n  @Post()\n  @HttpCode(HttpStatus.CREATED)\n  async createPreAssessment(\n    @CurrentUserId() id: string,\n    @Body() data: CreatePreAssessmentDto,\n  ): Promise<PreAssessment> {\n    try {\n      return await this.preAssessmentService.createPreAssessment(id, data);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : error,\n      );\n    }\n  }\n\n  @Get()\n  @HttpCode(HttpStatus.OK)\n  async getPreAssessment(@CurrentUserId() id: string): Promise<PreAssessment> {\n    try {\n      return await this.preAssessmentService.getPreAssessmentByUserId(id);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : error,\n      );\n    }\n  }\n\n  @Put()\n  @HttpCode(HttpStatus.OK)\n  async updatePreAssessment(\n    @CurrentUserId() id: string,\n    @Body() data: Partial<CreatePreAssessmentDto>,\n  ): Promise<PreAssessment> {\n    try {\n      return await this.preAssessmentService.updatePreAssessment(id, data);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : error,\n      );\n    }\n  }\n\n  @Delete()\n  @HttpCode(HttpStatus.OK)\n  async deletePreAssessment(@CurrentUserId() id: string): Promise<null> {\n    try {\n      return await this.preAssessmentService.deletePreAssessment(id);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : error,\n      );\n    }\n  }\n\n  @Get('ai-service/health')\n  async checkAiServiceHealth(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n  ): Promise<{\n    status: string;\n    healthy: boolean;\n    serviceInfo: any;\n    timestamp: string;\n  }> {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} checking AI service health`);\n\n      const healthy = await this.aiServiceClient.healthCheck();\n      const serviceInfo = this.aiServiceClient.getServiceInfo();\n\n      return {\n        status: healthy ? 'healthy' : 'unhealthy',\n        healthy,\n        serviceInfo,\n        timestamp: new Date().toISOString(),\n      };\n    } catch (error) {\n      this.logger.error('AI service health check failed:', error);\n      return {\n        status: 'error',\n        healthy: false,\n        serviceInfo: this.aiServiceClient.getServiceInfo(),\n        timestamp: new Date().toISOString(),\n      };\n    }\n  }\n}\n"],"version":3}