34e41b70eb4209c32cda3ea2690d2139
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var AdminTherapistService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdminTherapistService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const notifications_service_1 = require("../../notifications/notifications.service");
const email_service_1 = require("src/email/email.service");
const crypto = require("crypto");
const bcrypt = require("bcrypt");
let AdminTherapistService = AdminTherapistService_1 = class AdminTherapistService {
    prisma;
    notificationsService;
    emailService;
    logger = new common_1.Logger(AdminTherapistService_1.name);
    constructor(prisma, notificationsService, emailService) {
        this.prisma = prisma;
        this.notificationsService = notificationsService;
        this.emailService = emailService;
    }
    // ===== THERAPIST APPLICATION RETRIEVAL =====
    async getApplications(filters) {
        try {
            const { status = 'PENDING', province, submittedAfter, processedBy, providerType, limit = 50, } = filters;
            const where = {};
            // Apply status filter
            if (status) {
                // Convert filter status to uppercase to match enum values
                where.status = status.toUpperCase();
            }
            // Apply province filter
            if (province) {
                where.province = {
                    contains: province,
                    mode: 'insensitive',
                };
            }
            // Apply date filter
            if (submittedAfter) {
                where.submissionDate = {
                    gte: new Date(submittedAfter),
                };
            }
            // Apply processed by filter
            if (processedBy) {
                where.processedByAdminId = processedBy;
            }
            // Apply provider type filter
            if (providerType) {
                where.providerType = {
                    contains: providerType,
                    mode: 'insensitive',
                };
            }
            const applications = await this.prisma.therapist.findMany({
                where,
                take: limit,
                orderBy: [{ submissionDate: 'desc' }, { createdAt: 'desc' }],
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                            email: true,
                            createdAt: true,
                            lastLoginAt: true,
                        },
                    },
                    processedByAdmin: {
                        include: {
                            user: {
                                select: {
                                    firstName: true,
                                    lastName: true,
                                    email: true,
                                },
                            },
                        },
                    },
                },
            });
            // Calculate summary statistics
            const totalPending = await this.prisma.therapist.count({
                where: { status: 'PENDING' },
            });
            const totalApproved = await this.prisma.therapist.count({
                where: { status: 'APPROVED' },
            });
            const totalRejected = await this.prisma.therapist.count({
                where: { status: 'REJECTED' },
            });
            this.logger.log(`Retrieved ${applications.length} therapist applications with filters: ${JSON.stringify(filters)}`);
            return {
                applications,
                summary: {
                    totalPending,
                    totalApproved,
                    totalRejected,
                    filtered: applications.length,
                },
                filters: filters,
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve pending applications:', error);
            throw error;
        }
    }
    async getPendingApplications(filters) {
        try {
            const { status = 'PENDING', province, submittedAfter, processedBy, providerType, limit = 50, } = filters;
            const where = {};
            // Apply status filter
            if (status) {
                // Convert filter status to uppercase to match enum values
                where.status = status.toUpperCase();
            }
            // Apply province filter
            if (province) {
                where.province = {
                    contains: province,
                    mode: 'insensitive',
                };
            }
            // Apply date filter
            if (submittedAfter) {
                where.submissionDate = {
                    gte: new Date(submittedAfter),
                };
            }
            // Apply processed by filter
            if (processedBy) {
                where.processedByAdminId = processedBy;
            }
            // Apply provider type filter
            if (providerType) {
                where.providerType = {
                    contains: providerType,
                    mode: 'insensitive',
                };
            }
            const applications = await this.prisma.therapist.findMany({
                where,
                take: limit,
                orderBy: [{ submissionDate: 'desc' }, { createdAt: 'desc' }],
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                            email: true,
                            createdAt: true,
                            lastLoginAt: true,
                        },
                    },
                    processedByAdmin: {
                        include: {
                            user: {
                                select: {
                                    firstName: true,
                                    lastName: true,
                                    email: true,
                                },
                            },
                        },
                    },
                },
            });
            // Calculate summary statistics
            const totalPending = await this.prisma.therapist.count({
                where: { status: 'PENDING' },
            });
            const totalApproved = await this.prisma.therapist.count({
                where: { status: 'APPROVED' },
            });
            const totalRejected = await this.prisma.therapist.count({
                where: { status: 'REJECTED' },
            });
            this.logger.log(`Retrieved ${applications.length} therapist applications with filters: ${JSON.stringify(filters)}`);
            return {
                applications,
                summary: {
                    totalPending,
                    totalApproved,
                    totalRejected,
                    filtered: applications.length,
                },
                filters: filters,
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve pending applications:', error);
            throw error;
        }
    }
    async getApplicationDetails(therapistId) {
        try {
            const application = await this.prisma.therapist.findUnique({
                where: { userId: therapistId },
                include: {
                    user: {
                        include: {
                            client: true, // Check if user also has client profile
                        },
                    },
                    processedByAdmin: {
                        include: {
                            user: {
                                select: {
                                    firstName: true,
                                    lastName: true,
                                    email: true,
                                },
                            },
                        },
                    },
                    // Include related data for comprehensive view
                    assignedClients: {
                        take: 5, // Show recent clients if any
                        include: {
                            client: {
                                include: {
                                    user: {
                                        select: {
                                            firstName: true,
                                            lastName: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                    reviews: {
                        take: 5, // Show recent reviews if any
                        include: {
                            client: {
                                include: {
                                    user: {
                                        select: {
                                            firstName: true,
                                            lastName: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                },
            });
            if (!application) {
                throw new common_1.NotFoundException(`Therapist application with ID ${therapistId} not found`);
            }
            // Audit trail removed - not needed for student project
            this.logger.log(`Retrieved detailed application for therapist ${therapistId}`);
            return {
                application,
                statistics: {
                    totalClients: application.assignedClients.length,
                    averageRating: application.reviews.length > 0
                        ? application.reviews.reduce((sum, review) => sum + review.rating, 0) / application.reviews.length
                        : 0,
                    totalReviews: application.reviews.length,
                },
            };
        }
        catch (error) {
            this.logger.error(`Failed to retrieve application details for ${therapistId}:`, error);
            throw error;
        }
    }
    // ===== THERAPIST APPROVAL WORKFLOW =====
    async approveTherapist(therapistId, adminId, approvalData) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // 1. Verify therapist exists and is pending
                const existingTherapist = await tx.therapist.findUnique({
                    where: { userId: therapistId },
                    include: { user: true },
                });
                if (!existingTherapist) {
                    throw new common_1.NotFoundException(`Therapist with ID ${therapistId} not found`);
                }
                if (existingTherapist.status !== 'PENDING') {
                    throw new common_1.ConflictException(`Therapist ${therapistId} is not pending approval (current status: ${existingTherapist.status})`);
                }
                // 2. Update therapist status to approved
                const approvedTherapist = await tx.therapist.update({
                    where: { userId: therapistId },
                    data: {
                        status: 'APPROVED',
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                        licenseVerified: approvalData.verifyLicense || false,
                    },
                });
                // 3. Update user role to therapist
                await tx.user.update({
                    where: { id: therapistId },
                    data: {
                        role: 'therapist',
                        emailVerified: true, // Mark as verified when approved
                    },
                });
                // Audit log removed - not needed for student project
                // 5. Send approval notification
                await this.notificationsService.createTherapistApplicationNotification(therapistId, 'approved');
                // 6. Create custom approval notification if message provided
                if (approvalData.approvalMessage) {
                    await this.notificationsService.create({
                        userId: therapistId,
                        title: 'Welcome to Mentara - Application Approved!',
                        message: approvalData.approvalMessage,
                        type: 'THERAPIST_APPROVED',
                        priority: 'HIGH',
                        actionUrl: '/therapist/dashboard',
                    });
                }
                this.logger.log(`Admin ${adminId} approved therapist application ${therapistId}`);
                return {
                    success: true,
                    therapist: approvedTherapist,
                    message: 'Therapist application approved successfully',
                    approvalData,
                };
            });
        }
        catch (error) {
            this.logger.error(`Failed to approve therapist ${therapistId}:`, error);
            throw error;
        }
    }
    async rejectTherapist(therapistId, adminId, rejectionData) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // 1. Verify therapist exists and can be rejected
                const existingTherapist = await tx.therapist.findUnique({
                    where: { userId: therapistId },
                    include: { user: true },
                });
                if (!existingTherapist) {
                    throw new common_1.NotFoundException(`Therapist with ID ${therapistId} not found`);
                }
                if (existingTherapist.status === 'APPROVED') {
                    throw new common_1.ForbiddenException(`Cannot reject already approved therapist ${therapistId}`);
                }
                // 2. Update therapist status to rejected
                const rejectedTherapist = await tx.therapist.update({
                    where: { userId: therapistId },
                    data: {
                        status: 'REJECTED',
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                    },
                });
                // Audit log removed - not needed for student project
                // 4. Send rejection notification with detailed message
                await this.notificationsService.create({
                    userId: therapistId,
                    title: 'Therapist Application Update',
                    message: `Your therapist application has been reviewed. ${rejectionData.rejectionMessage}`,
                    type: 'THERAPIST_REJECTED',
                    priority: 'HIGH',
                    actionUrl: rejectionData.allowReapplication
                        ? '/therapist/reapply'
                        : '/therapist/application',
                });
                this.logger.log(`Admin ${adminId} rejected therapist application ${therapistId} for reason: ${rejectionData.rejectionReason}`);
                return {
                    success: true,
                    therapist: rejectedTherapist,
                    message: 'Therapist application rejected',
                    rejectionData,
                };
            });
        }
        catch (error) {
            this.logger.error(`Failed to reject therapist ${therapistId}:`, error);
            throw error;
        }
    }
    // ===== THERAPIST STATUS MANAGEMENT =====
    async updateTherapistStatus(therapistId, adminId, statusData) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // 1. Verify therapist exists
                const existingTherapist = await tx.therapist.findUnique({
                    where: { userId: therapistId },
                    include: { user: true },
                });
                if (!existingTherapist) {
                    throw new common_1.NotFoundException(`Therapist with ID ${therapistId} not found`);
                }
                // 2. Validate status transition
                const validTransitions = this.getValidStatusTransitions(existingTherapist.status);
                const upperCaseStatus = statusData.status.toUpperCase();
                if (!validTransitions.includes(upperCaseStatus)) {
                    throw new common_1.BadRequestException(`Invalid status transition from ${existingTherapist.status} to ${upperCaseStatus}`);
                }
                // 3. Update therapist status
                const updatedTherapist = await tx.therapist.update({
                    where: { userId: therapistId },
                    data: {
                        status: upperCaseStatus,
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                    },
                });
                // 4. Update user status if necessary
                const generateRandomPassword = () => {
                    return crypto.randomBytes(8).toString('hex') + 'A1!'; // Ensures uppercase, number, and special char
                };
                // Hash password
                const randomPassword = generateRandomPassword();
                const hashedPassword = await bcrypt.hash(randomPassword, 12);
                if (upperCaseStatus === 'SUSPENDED') {
                    await tx.user.update({
                        where: { id: therapistId },
                        data: {
                            isActive: false,
                            suspendedAt: new Date(),
                            suspendedBy: adminId,
                            suspensionReason: statusData.reason || 'Status updated by admin',
                        },
                    });
                }
                else if (upperCaseStatus === 'APPROVED') {
                    await tx.user.update({
                        where: { id: therapistId },
                        data: {
                            password: hashedPassword,
                            role: 'therapist',
                            isActive: true,
                            suspendedAt: null,
                            suspendedBy: null,
                            suspensionReason: null,
                            emailVerified: true, // Ensure email is verified
                        },
                    });
                }
                // Join the therapist to the community
                if (upperCaseStatus === 'APPROVED') {
                    // Map areas of expertise to community slugs
                    const areasToCommunityMap = {
                        stress: 'stress-support',
                        anxiety: 'anxiety-support',
                        depression: 'depression-support',
                        insomnia: 'insomnia-support',
                        panic: 'panic-disorder-support',
                        bipolar: 'bipolar-disorder-support',
                        ocd: 'ocd-support',
                        ptsd: 'ptsd-support',
                        'social-anxiety': 'social-anxiety-support',
                        phobia: 'phobia-support',
                        burnout: 'burnout-support',
                        'eating-disorder': 'eating-disorders-support',
                        adhd: 'adhd-support',
                        'substance-use': 'substance-use-support',
                        'drug-use': 'drug-use-support',
                    };
                    // Get community IDs based on therapist's areas of expertise
                    const communityMemberships = updatedTherapist.areasOfExpertise
                        .map((area) => areasToCommunityMap[area])
                        .filter(Boolean) // Remove undefined values
                        .map((communitySlug) => ({
                        userId: therapistId,
                        communityId: `dev_comm_${communitySlug}`, // Using the format from your screenshot
                        joinedAt: new Date(),
                    }));
                    // Also add to general support community
                    communityMemberships.push({
                        userId: therapistId,
                        communityId: 'dev_comm_general-support',
                        joinedAt: new Date(),
                    });
                    // Create all memberships
                    if (communityMemberships.length > 0) {
                        await tx.membership.createMany({
                            data: communityMemberships,
                            skipDuplicates: true, // Prevent duplicate memberships
                        });
                    }
                }
                // Audit log removed - not needed for student project
                if (upperCaseStatus === 'APPROVED') {
                    // 5. Send approval email
                    await this.emailService.sendTherapistApproved(existingTherapist.user.email, existingTherapist.user.firstName, 'Welcome to Mentara - Your Therapist Application has been Approved!', randomPassword);
                }
                else if (upperCaseStatus === 'REJECTED') {
                    await this.emailService.sendTherapistDenied(existingTherapist.user.email, existingTherapist.user.firstName, 'Mentara Therapist Application Update');
                }
                // 6. Send status change notification
                const notificationTitle = this.getStatusChangeNotificationTitle(upperCaseStatus.toLowerCase());
                const notificationMessage = this.getStatusChangeNotificationMessage(upperCaseStatus.toLowerCase(), statusData.reason);
                await this.notificationsService.create({
                    userId: therapistId,
                    title: notificationTitle,
                    message: notificationMessage,
                    type: 'THERAPIST_STATUS_UPDATED',
                    priority: upperCaseStatus === 'SUSPENDED' ? 'HIGH' : 'NORMAL',
                    actionUrl: '/therapist/dashboard',
                });
                this.logger.log(`Admin ${adminId} updated therapist ${therapistId} status from ${existingTherapist.status} to ${upperCaseStatus}`);
                return {
                    success: true,
                    therapist: updatedTherapist,
                    previousStatus: existingTherapist.status,
                    newStatus: upperCaseStatus,
                    message: `Therapist status updated to ${upperCaseStatus}`,
                };
            });
        }
        catch (error) {
            this.logger.error(`Failed to update therapist status for ${therapistId}:`, error);
            throw error;
        }
    }
    // ===== ANALYTICS AND REPORTING =====
    async getTherapistApplicationMetrics(startDate, endDate) {
        try {
            const start = startDate
                ? new Date(startDate)
                : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const end = endDate ? new Date(endDate) : new Date();
            const [totalApplications, pendingApplications, approvedApplications, rejectedApplications, recentApplications, processingTimes,] = await Promise.all([
                // Total applications in period
                this.prisma.therapist.count({
                    where: {
                        submissionDate: { gte: start, lte: end },
                    },
                }),
                // Pending applications
                this.prisma.therapist.count({
                    where: {
                        status: 'PENDING',
                        submissionDate: { gte: start, lte: end },
                    },
                }),
                // Approved applications in period
                this.prisma.therapist.count({
                    where: {
                        status: 'APPROVED',
                        processingDate: { gte: start, lte: end },
                    },
                }),
                // Rejected applications in period
                this.prisma.therapist.count({
                    where: {
                        status: 'REJECTED',
                        processingDate: { gte: start, lte: end },
                    },
                }),
                // Recent applications for trend analysis
                this.prisma.therapist.findMany({
                    where: {
                        submissionDate: { gte: start, lte: end },
                    },
                    select: {
                        submissionDate: true,
                        status: true,
                        processingDate: true,
                    },
                    orderBy: { submissionDate: 'desc' },
                }),
                // Processing times for approved/rejected applications
                this.prisma.therapist.findMany({
                    where: {
                        processingDate: { gte: start, lte: end },
                        status: { in: ['APPROVED', 'REJECTED'] },
                    },
                    select: {
                        submissionDate: true,
                        processingDate: true,
                        status: true,
                    },
                }),
            ]);
            // Calculate average processing time
            const averageProcessingTime = processingTimes.reduce((acc, app) => {
                if (app.processingDate && app.submissionDate) {
                    const processingTimeMs = app.processingDate.getTime() - app.submissionDate.getTime();
                    return acc + processingTimeMs / (1000 * 60 * 60 * 24); // Convert to days
                }
                return acc;
            }, 0) / (processingTimes.length || 1);
            // Calculate approval rate
            const processedApplications = approvedApplications + rejectedApplications;
            const approvalRate = processedApplications > 0
                ? (approvedApplications / processedApplications) * 100
                : 0;
            this.logger.log(`Generated therapist application metrics for period ${start} to ${end}`);
            return {
                period: { start, end },
                summary: {
                    totalApplications,
                    pendingApplications,
                    approvedApplications,
                    rejectedApplications,
                    processedApplications,
                },
                metrics: {
                    approvalRate: Math.round(approvalRate * 100) / 100,
                    averageProcessingTimeDays: Math.round(averageProcessingTime * 100) / 100,
                    applicationTrend: this.calculateApplicationTrend(recentApplications),
                },
                recentActivity: recentApplications.slice(0, 10),
            };
        }
        catch (error) {
            this.logger.error('Failed to generate therapist application metrics:', error);
            throw error;
        }
    }
    // ===== HELPER METHODS =====
    getValidStatusTransitions(currentStatus) {
        const transitions = {
            PENDING: ['APPROVED', 'REJECTED', 'UNDER_REVIEW'],
            UNDER_REVIEW: ['APPROVED', 'REJECTED', 'PENDING'],
            APPROVED: ['SUSPENDED', 'UNDER_REVIEW'],
            REJECTED: ['PENDING', 'UNDER_REVIEW'], // Allow resubmission
            SUSPENDED: ['APPROVED', 'REJECTED'],
        };
        return transitions[currentStatus] || [];
    }
    getStatusChangeNotificationTitle(status) {
        const titles = {
            approved: 'Application Approved!',
            rejected: 'Application Status Update',
            suspended: 'Account Suspended',
            under_review: 'Application Under Review',
            pending: 'Application Status Changed',
        };
        return titles[status] || 'Status Update';
    }
    getStatusChangeNotificationMessage(status, reason) {
        const baseMessages = {
            approved: 'Congratulations! Your therapist application has been approved.',
            rejected: 'Your therapist application has been reviewed.',
            suspended: 'Your therapist account has been temporarily suspended.',
            under_review: 'Your application is currently under additional review.',
            pending: 'Your application status has been updated.',
        };
        const baseMessage = baseMessages[status] || 'Your account status has been updated.';
        return reason ? `${baseMessage} Reason: ${reason}` : baseMessage;
    }
    calculateApplicationTrend(applications) {
        if (applications.length < 7)
            return 'stable';
        const now = new Date();
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
        const recentWeekCount = applications.filter((app) => app.submissionDate >= weekAgo).length;
        const previousWeekCount = applications.filter((app) => app.submissionDate >= twoWeeksAgo && app.submissionDate < weekAgo).length;
        if (recentWeekCount > previousWeekCount * 1.1)
            return 'increasing';
        if (recentWeekCount < previousWeekCount * 0.9)
            return 'decreasing';
        return 'stable';
    }
};
exports.AdminTherapistService = AdminTherapistService;
exports.AdminTherapistService = AdminTherapistService = AdminTherapistService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof notifications_service_1.NotificationsService !== "undefined" && notifications_service_1.NotificationsService) === "function" ? _b : Object, typeof (_c = typeof email_service_1.EmailService !== "undefined" && email_service_1.EmailService) === "function" ? _c : Object])
], AdminTherapistService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2FkbWluL3NlcnZpY2VzL2FkbWluLXRoZXJhcGlzdC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBT3dCO0FBQ3hCLG1GQUF1RTtBQUN2RSxxRkFBaUY7QUFRakYsMkRBQXVEO0FBQ3ZELGlDQUFpQztBQUNqQyxpQ0FBaUM7QUFHMUIsSUFBTSxxQkFBcUIsNkJBQTNCLE1BQU0scUJBQXFCO0lBSWI7SUFDQTtJQUNBO0lBTEYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLHVCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWpFLFlBQ21CLE1BQXFCLEVBQ3JCLG9CQUEwQyxFQUMxQyxZQUEwQjtRQUYxQixXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3JCLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFDMUMsaUJBQVksR0FBWixZQUFZLENBQWM7SUFDMUMsQ0FBQztJQUVKLDhDQUE4QztJQUM5QyxLQUFLLENBQUMsZUFBZSxDQUFDLE9BQW1DO1FBQ3ZELElBQUksQ0FBQztZQUNILE1BQU0sRUFDSixNQUFNLEdBQUcsU0FBUyxFQUNsQixRQUFRLEVBQ1IsY0FBYyxFQUNkLFdBQVcsRUFDWCxZQUFZLEVBQ1osS0FBSyxHQUFHLEVBQUUsR0FDWCxHQUFHLE9BQU8sQ0FBQztZQUVaLE1BQU0sS0FBSyxHQUErQixFQUFFLENBQUM7WUFFN0Msc0JBQXNCO1lBQ3RCLElBQUksTUFBTSxFQUFFLENBQUM7Z0JBQ1gsMERBQTBEO2dCQUMxRCxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLEVBQVMsQ0FBQztZQUM3QyxDQUFDO1lBRUQsd0JBQXdCO1lBQ3hCLElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQ2IsS0FBSyxDQUFDLFFBQVEsR0FBRztvQkFDZixRQUFRLEVBQUUsUUFBUTtvQkFDbEIsSUFBSSxFQUFFLGFBQWE7aUJBQ3BCLENBQUM7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QUUsQ0FBQyxHQUFHLENBQUMsY0FBYyxJQUFJLE9BQU8sQ0FDdkMsQ0FBQyxNQUFNLENBQUM7UUFDVCxNQUFNLGlCQUFpQixHQUFHLFlBQVksQ0FBQyxNQUFNLENBQzNDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FDTixHQUFHLENBQUMsY0FBYyxJQUFJLFdBQVcsSUFBSSxHQUFHLENBQUMsY0FBYyxHQUFHLE9BQU8sQ0FDcEUsQ0FBQyxNQUFNLENBQUM7UUFFVCxJQUFJLGVBQWUsR0FBRyxpQkFBaUIsR0FBRyxHQUFHO1lBQUUsT0FBTyxZQUFZLENBQUM7UUFDbkUsSUFBSSxlQUFlLEdBQUcsaUJBQWlCLEdBQUcsR0FBRztZQUFFLE9BQU8sWUFBWSxDQUFDO1FBQ25FLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7Q0FDRixDQUFBO0FBOXpCWSxzREFBcUI7Z0NBQXJCLHFCQUFxQjtJQURqQyxJQUFBLG1CQUFVLEdBQUU7eURBS2dCLHNDQUFhLG9CQUFiLHNDQUFhLG9EQUNDLDRDQUFvQixvQkFBcEIsNENBQW9CLG9EQUM1Qiw0QkFBWSxvQkFBWiw0QkFBWTtHQU5sQyxxQkFBcUIsQ0E4ekJqQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYWRtaW4vc2VydmljZXMvYWRtaW4tdGhlcmFwaXN0LnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSW5qZWN0YWJsZSxcbiAgTG9nZ2VyLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgQ29uZmxpY3RFeGNlcHRpb24sXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbm90aWZpY2F0aW9ucy9ub3RpZmljYXRpb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpc21hIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHtcbiAgdHlwZSBBcHByb3ZlVGhlcmFwaXN0RHRvLFxuICB0eXBlIFJlamVjdFRoZXJhcGlzdER0byxcbiAgdHlwZSBVcGRhdGVUaGVyYXBpc3RTdGF0dXNEdG8sXG4gIHR5cGUgUGVuZGluZ1RoZXJhcGlzdEZpbHRlcnNEdG8sXG59IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IEVtYWlsU2VydmljZSB9IGZyb20gJ3NyYy9lbWFpbC9lbWFpbC5zZXJ2aWNlJztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0ICogYXMgYmNyeXB0IGZyb20gJ2JjcnlwdCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBZG1pblRoZXJhcGlzdFNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoQWRtaW5UaGVyYXBpc3RTZXJ2aWNlLm5hbWUpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJpc21hOiBQcmlzbWFTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbm90aWZpY2F0aW9uc1NlcnZpY2U6IE5vdGlmaWNhdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZW1haWxTZXJ2aWNlOiBFbWFpbFNlcnZpY2UsXG4gICkge31cblxuICAvLyA9PT09PSBUSEVSQVBJU1QgQVBQTElDQVRJT04gUkVUUklFVkFMID09PT09XG4gIGFzeW5jIGdldEFwcGxpY2F0aW9ucyhmaWx0ZXJzOiBQZW5kaW5nVGhlcmFwaXN0RmlsdGVyc0R0bykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHN0YXR1cyA9ICdQRU5ESU5HJyxcbiAgICAgICAgcHJvdmluY2UsXG4gICAgICAgIHN1Ym1pdHRlZEFmdGVyLFxuICAgICAgICBwcm9jZXNzZWRCeSxcbiAgICAgICAgcHJvdmlkZXJUeXBlLFxuICAgICAgICBsaW1pdCA9IDUwLFxuICAgICAgfSA9IGZpbHRlcnM7XG5cbiAgICAgIGNvbnN0IHdoZXJlOiBQcmlzbWEuVGhlcmFwaXN0V2hlcmVJbnB1dCA9IHt9O1xuXG4gICAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyXG4gICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgIC8vIENvbnZlcnQgZmlsdGVyIHN0YXR1cyB0byB1cHBlcmNhc2UgdG8gbWF0Y2ggZW51bSB2YWx1ZXNcbiAgICAgICAgd2hlcmUuc3RhdHVzID0gc3RhdHVzLnRvVXBwZXJDYXNlKCkgYXMgYW55O1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBwcm92aW5jZSBmaWx0ZXJcbiAgICAgIGlmIChwcm92aW5jZSkge1xuICAgICAgICB3aGVyZS5wcm92aW5jZSA9IHtcbiAgICAgICAgICBjb250YWluczogcHJvdmluY2UsXG4gICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQXBwbHkgZGF0ZSBmaWx0ZXJcbiAgICAgIGlmIChzdWJtaXR0ZWRBZnRlcikge1xuICAgICAgICB3aGVyZS5zdWJtaXNzaW9uRGF0ZSA9IHtcbiAgICAgICAgICBndGU6IG5ldyBEYXRlKHN1Ym1pdHRlZEFmdGVyKSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQXBwbHkgcHJvY2Vzc2VkIGJ5IGZpbHRlclxuICAgICAgaWYgKHByb2Nlc3NlZEJ5KSB7XG4gICAgICAgIHdoZXJlLnByb2Nlc3NlZEJ5QWRtaW5JZCA9IHByb2Nlc3NlZEJ5O1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBwcm92aWRlciB0eXBlIGZpbHRlclxuICAgICAgaWYgKHByb3ZpZGVyVHlwZSkge1xuICAgICAgICB3aGVyZS5wcm92aWRlclR5cGUgPSB7XG4gICAgICAgICAgY29udGFpbnM6IHByb3ZpZGVyVHlwZSxcbiAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhcHBsaWNhdGlvbnMgPSBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgdGFrZTogbGltaXQsXG4gICAgICAgIG9yZGVyQnk6IFt7IHN1Ym1pc3Npb25EYXRlOiAnZGVzYycgfSwgeyBjcmVhdGVkQXQ6ICdkZXNjJyB9XSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdExvZ2luQXQ6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvY2Vzc2VkQnlBZG1pbjoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHN1bW1hcnkgc3RhdGlzdGljc1xuICAgICAgY29uc3QgdG90YWxQZW5kaW5nID0gYXdhaXQgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmNvdW50KHtcbiAgICAgICAgd2hlcmU6IHsgc3RhdHVzOiAnUEVORElORycgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b3RhbEFwcHJvdmVkID0gYXdhaXQgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmNvdW50KHtcbiAgICAgICAgd2hlcmU6IHsgc3RhdHVzOiAnQVBQUk9WRUQnIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdG90YWxSZWplY3RlZCA9IGF3YWl0IHRoaXMucHJpc21hLnRoZXJhcGlzdC5jb3VudCh7XG4gICAgICAgIHdoZXJlOiB7IHN0YXR1czogJ1JFSkVDVEVEJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgYFJldHJpZXZlZCAke2FwcGxpY2F0aW9ucy5sZW5ndGh9IHRoZXJhcGlzdCBhcHBsaWNhdGlvbnMgd2l0aCBmaWx0ZXJzOiAke0pTT04uc3RyaW5naWZ5KGZpbHRlcnMpfWAsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHBsaWNhdGlvbnMsXG4gICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICB0b3RhbFBlbmRpbmcsXG4gICAgICAgICAgdG90YWxBcHByb3ZlZCxcbiAgICAgICAgICB0b3RhbFJlamVjdGVkLFxuICAgICAgICAgIGZpbHRlcmVkOiBhcHBsaWNhdGlvbnMubGVuZ3RoLFxuICAgICAgICB9LFxuICAgICAgICBmaWx0ZXJzOiBmaWx0ZXJzLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBwZW5kaW5nIGFwcGxpY2F0aW9uczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRQZW5kaW5nQXBwbGljYXRpb25zKGZpbHRlcnM6IFBlbmRpbmdUaGVyYXBpc3RGaWx0ZXJzRHRvKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgc3RhdHVzID0gJ1BFTkRJTkcnLFxuICAgICAgICBwcm92aW5jZSxcbiAgICAgICAgc3VibWl0dGVkQWZ0ZXIsXG4gICAgICAgIHByb2Nlc3NlZEJ5LFxuICAgICAgICBwcm92aWRlclR5cGUsXG4gICAgICAgIGxpbWl0ID0gNTAsXG4gICAgICB9ID0gZmlsdGVycztcblxuICAgICAgY29uc3Qgd2hlcmU6IFByaXNtYS5UaGVyYXBpc3RXaGVyZUlucHV0ID0ge307XG5cbiAgICAgIC8vIEFwcGx5IHN0YXR1cyBmaWx0ZXJcbiAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgLy8gQ29udmVydCBmaWx0ZXIgc3RhdHVzIHRvIHVwcGVyY2FzZSB0byBtYXRjaCBlbnVtIHZhbHVlc1xuICAgICAgICB3aGVyZS5zdGF0dXMgPSBzdGF0dXMudG9VcHBlckNhc2UoKSBhcyBhbnk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IHByb3ZpbmNlIGZpbHRlclxuICAgICAgaWYgKHByb3ZpbmNlKSB7XG4gICAgICAgIHdoZXJlLnByb3ZpbmNlID0ge1xuICAgICAgICAgIGNvbnRhaW5zOiBwcm92aW5jZSxcbiAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBkYXRlIGZpbHRlclxuICAgICAgaWYgKHN1Ym1pdHRlZEFmdGVyKSB7XG4gICAgICAgIHdoZXJlLnN1Ym1pc3Npb25EYXRlID0ge1xuICAgICAgICAgIGd0ZTogbmV3IERhdGUoc3VibWl0dGVkQWZ0ZXIpLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBwcm9jZXNzZWQgYnkgZmlsdGVyXG4gICAgICBpZiAocHJvY2Vzc2VkQnkpIHtcbiAgICAgICAgd2hlcmUucHJvY2Vzc2VkQnlBZG1pbklkID0gcHJvY2Vzc2VkQnk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IHByb3ZpZGVyIHR5cGUgZmlsdGVyXG4gICAgICBpZiAocHJvdmlkZXJUeXBlKSB7XG4gICAgICAgIHdoZXJlLnByb3ZpZGVyVHlwZSA9IHtcbiAgICAgICAgICBjb250YWluczogcHJvdmlkZXJUeXBlLFxuICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZScsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFwcGxpY2F0aW9ucyA9IGF3YWl0IHRoaXMucHJpc21hLnRoZXJhcGlzdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICB0YWtlOiBsaW1pdCxcbiAgICAgICAgb3JkZXJCeTogW3sgc3VibWlzc2lvbkRhdGU6ICdkZXNjJyB9LCB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1dLFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TG9naW5BdDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwcm9jZXNzZWRCeUFkbWluOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgc3VtbWFyeSBzdGF0aXN0aWNzXG4gICAgICBjb25zdCB0b3RhbFBlbmRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdQRU5ESU5HJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRvdGFsQXBwcm92ZWQgPSBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoe1xuICAgICAgICB3aGVyZTogeyBzdGF0dXM6ICdBUFBST1ZFRCcgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b3RhbFJlamVjdGVkID0gYXdhaXQgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmNvdW50KHtcbiAgICAgICAgd2hlcmU6IHsgc3RhdHVzOiAnUkVKRUNURUQnIH0sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgUmV0cmlldmVkICR7YXBwbGljYXRpb25zLmxlbmd0aH0gdGhlcmFwaXN0IGFwcGxpY2F0aW9ucyB3aXRoIGZpbHRlcnM6ICR7SlNPTi5zdHJpbmdpZnkoZmlsdGVycyl9YCxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcGxpY2F0aW9ucyxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsUGVuZGluZyxcbiAgICAgICAgICB0b3RhbEFwcHJvdmVkLFxuICAgICAgICAgIHRvdGFsUmVqZWN0ZWQsXG4gICAgICAgICAgZmlsdGVyZWQ6IGFwcGxpY2F0aW9ucy5sZW5ndGgsXG4gICAgICAgIH0sXG4gICAgICAgIGZpbHRlcnM6IGZpbHRlcnMsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHBlbmRpbmcgYXBwbGljYXRpb25zOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldEFwcGxpY2F0aW9uRGV0YWlscyh0aGVyYXBpc3RJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFwcGxpY2F0aW9uID0gYXdhaXQgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHRoZXJhcGlzdElkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGNsaWVudDogdHJ1ZSwgLy8gQ2hlY2sgaWYgdXNlciBhbHNvIGhhcyBjbGllbnQgcHJvZmlsZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHByb2Nlc3NlZEJ5QWRtaW46IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIEluY2x1ZGUgcmVsYXRlZCBkYXRhIGZvciBjb21wcmVoZW5zaXZlIHZpZXdcbiAgICAgICAgICBhc3NpZ25lZENsaWVudHM6IHtcbiAgICAgICAgICAgIHRha2U6IDUsIC8vIFNob3cgcmVjZW50IGNsaWVudHMgaWYgYW55XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGNsaWVudDoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJldmlld3M6IHtcbiAgICAgICAgICAgIHRha2U6IDUsIC8vIFNob3cgcmVjZW50IHJldmlld3MgaWYgYW55XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGNsaWVudDoge1xuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghYXBwbGljYXRpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFxuICAgICAgICAgIGBUaGVyYXBpc3QgYXBwbGljYXRpb24gd2l0aCBJRCAke3RoZXJhcGlzdElkfSBub3QgZm91bmRgLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBBdWRpdCB0cmFpbCByZW1vdmVkIC0gbm90IG5lZWRlZCBmb3Igc3R1ZGVudCBwcm9qZWN0XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgYFJldHJpZXZlZCBkZXRhaWxlZCBhcHBsaWNhdGlvbiBmb3IgdGhlcmFwaXN0ICR7dGhlcmFwaXN0SWR9YCxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwcGxpY2F0aW9uLFxuICAgICAgICBzdGF0aXN0aWNzOiB7XG4gICAgICAgICAgdG90YWxDbGllbnRzOiBhcHBsaWNhdGlvbi5hc3NpZ25lZENsaWVudHMubGVuZ3RoLFxuICAgICAgICAgIGF2ZXJhZ2VSYXRpbmc6XG4gICAgICAgICAgICBhcHBsaWNhdGlvbi5yZXZpZXdzLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgPyBhcHBsaWNhdGlvbi5yZXZpZXdzLnJlZHVjZShcbiAgICAgICAgICAgICAgICAgIChzdW0sIHJldmlldykgPT4gc3VtICsgcmV2aWV3LnJhdGluZyxcbiAgICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgKSAvIGFwcGxpY2F0aW9uLnJldmlld3MubGVuZ3RoXG4gICAgICAgICAgICAgIDogMCxcbiAgICAgICAgICB0b3RhbFJldmlld3M6IGFwcGxpY2F0aW9uLnJldmlld3MubGVuZ3RoLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gcmV0cmlldmUgYXBwbGljYXRpb24gZGV0YWlscyBmb3IgJHt0aGVyYXBpc3RJZH06YCxcbiAgICAgICAgZXJyb3IsXG4gICAgICApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT0gVEhFUkFQSVNUIEFQUFJPVkFMIFdPUktGTE9XID09PT09XG5cbiAgYXN5bmMgYXBwcm92ZVRoZXJhcGlzdChcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIGFkbWluSWQ6IHN0cmluZyxcbiAgICBhcHByb3ZhbERhdGE6IEFwcHJvdmVUaGVyYXBpc3REdG8sXG4gICkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAvLyAxLiBWZXJpZnkgdGhlcmFwaXN0IGV4aXN0cyBhbmQgaXMgcGVuZGluZ1xuICAgICAgICBjb25zdCBleGlzdGluZ1RoZXJhcGlzdCA9IGF3YWl0IHR4LnRoZXJhcGlzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHRoZXJhcGlzdElkIH0sXG4gICAgICAgICAgaW5jbHVkZTogeyB1c2VyOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghZXhpc3RpbmdUaGVyYXBpc3QpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oXG4gICAgICAgICAgICBgVGhlcmFwaXN0IHdpdGggSUQgJHt0aGVyYXBpc3RJZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nVGhlcmFwaXN0LnN0YXR1cyAhPT0gJ1BFTkRJTkcnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IENvbmZsaWN0RXhjZXB0aW9uKFxuICAgICAgICAgICAgYFRoZXJhcGlzdCAke3RoZXJhcGlzdElkfSBpcyBub3QgcGVuZGluZyBhcHByb3ZhbCAoY3VycmVudCBzdGF0dXM6ICR7ZXhpc3RpbmdUaGVyYXBpc3Quc3RhdHVzfSlgLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAyLiBVcGRhdGUgdGhlcmFwaXN0IHN0YXR1cyB0byBhcHByb3ZlZFxuICAgICAgICBjb25zdCBhcHByb3ZlZFRoZXJhcGlzdCA9IGF3YWl0IHR4LnRoZXJhcGlzdC51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogdGhlcmFwaXN0SWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzdGF0dXM6ICdBUFBST1ZFRCcsXG4gICAgICAgICAgICBwcm9jZXNzZWRCeUFkbWluSWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBwcm9jZXNzaW5nRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIGxpY2Vuc2VWZXJpZmllZDogYXBwcm92YWxEYXRhLnZlcmlmeUxpY2Vuc2UgfHwgZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gMy4gVXBkYXRlIHVzZXIgcm9sZSB0byB0aGVyYXBpc3RcbiAgICAgICAgYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiB0aGVyYXBpc3RJZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHJvbGU6ICd0aGVyYXBpc3QnLFxuICAgICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSwgLy8gTWFyayBhcyB2ZXJpZmllZCB3aGVuIGFwcHJvdmVkXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQXVkaXQgbG9nIHJlbW92ZWQgLSBub3QgbmVlZGVkIGZvciBzdHVkZW50IHByb2plY3RcblxuICAgICAgICAvLyA1LiBTZW5kIGFwcHJvdmFsIG5vdGlmaWNhdGlvblxuICAgICAgICBhd2FpdCB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZVRoZXJhcGlzdEFwcGxpY2F0aW9uTm90aWZpY2F0aW9uKFxuICAgICAgICAgIHRoZXJhcGlzdElkLFxuICAgICAgICAgICdhcHByb3ZlZCcsXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gNi4gQ3JlYXRlIGN1c3RvbSBhcHByb3ZhbCBub3RpZmljYXRpb24gaWYgbWVzc2FnZSBwcm92aWRlZFxuICAgICAgICBpZiAoYXBwcm92YWxEYXRhLmFwcHJvdmFsTWVzc2FnZSkge1xuICAgICAgICAgIGF3YWl0IHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuY3JlYXRlKHtcbiAgICAgICAgICAgIHVzZXJJZDogdGhlcmFwaXN0SWQsXG4gICAgICAgICAgICB0aXRsZTogJ1dlbGNvbWUgdG8gTWVudGFyYSAtIEFwcGxpY2F0aW9uIEFwcHJvdmVkIScsXG4gICAgICAgICAgICBtZXNzYWdlOiBhcHByb3ZhbERhdGEuYXBwcm92YWxNZXNzYWdlLFxuICAgICAgICAgICAgdHlwZTogJ1RIRVJBUElTVF9BUFBST1ZFRCcsXG4gICAgICAgICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgICAgICAgYWN0aW9uVXJsOiAnL3RoZXJhcGlzdC9kYXNoYm9hcmQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICAgIGBBZG1pbiAke2FkbWluSWR9IGFwcHJvdmVkIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiAke3RoZXJhcGlzdElkfWAsXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIHRoZXJhcGlzdDogYXBwcm92ZWRUaGVyYXBpc3QsXG4gICAgICAgICAgbWVzc2FnZTogJ1RoZXJhcGlzdCBhcHBsaWNhdGlvbiBhcHByb3ZlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgIGFwcHJvdmFsRGF0YSxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIGFwcHJvdmUgdGhlcmFwaXN0ICR7dGhlcmFwaXN0SWR9OmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlamVjdFRoZXJhcGlzdChcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIGFkbWluSWQ6IHN0cmluZyxcbiAgICByZWplY3Rpb25EYXRhOiBSZWplY3RUaGVyYXBpc3REdG8sXG4gICkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAvLyAxLiBWZXJpZnkgdGhlcmFwaXN0IGV4aXN0cyBhbmQgY2FuIGJlIHJlamVjdGVkXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGhlcmFwaXN0ID0gYXdhaXQgdHgudGhlcmFwaXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogdGhlcmFwaXN0SWQgfSxcbiAgICAgICAgICBpbmNsdWRlOiB7IHVzZXI6IHRydWUgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFleGlzdGluZ1RoZXJhcGlzdCkge1xuICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcbiAgICAgICAgICAgIGBUaGVyYXBpc3Qgd2l0aCBJRCAke3RoZXJhcGlzdElkfSBub3QgZm91bmRgLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdUaGVyYXBpc3Quc3RhdHVzID09PSAnQVBQUk9WRUQnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbihcbiAgICAgICAgICAgIGBDYW5ub3QgcmVqZWN0IGFscmVhZHkgYXBwcm92ZWQgdGhlcmFwaXN0ICR7dGhlcmFwaXN0SWR9YCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMi4gVXBkYXRlIHRoZXJhcGlzdCBzdGF0dXMgdG8gcmVqZWN0ZWRcbiAgICAgICAgY29uc3QgcmVqZWN0ZWRUaGVyYXBpc3QgPSBhd2FpdCB0eC50aGVyYXBpc3QudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHRoZXJhcGlzdElkIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgc3RhdHVzOiAnUkVKRUNURUQnLFxuICAgICAgICAgICAgcHJvY2Vzc2VkQnlBZG1pbklkOiBhZG1pbklkLFxuICAgICAgICAgICAgcHJvY2Vzc2luZ0RhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQXVkaXQgbG9nIHJlbW92ZWQgLSBub3QgbmVlZGVkIGZvciBzdHVkZW50IHByb2plY3RcblxuICAgICAgICAvLyA0LiBTZW5kIHJlamVjdGlvbiBub3RpZmljYXRpb24gd2l0aCBkZXRhaWxlZCBtZXNzYWdlXG4gICAgICAgIGF3YWl0IHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuY3JlYXRlKHtcbiAgICAgICAgICB1c2VySWQ6IHRoZXJhcGlzdElkLFxuICAgICAgICAgIHRpdGxlOiAnVGhlcmFwaXN0IEFwcGxpY2F0aW9uIFVwZGF0ZScsXG4gICAgICAgICAgbWVzc2FnZTogYFlvdXIgdGhlcmFwaXN0IGFwcGxpY2F0aW9uIGhhcyBiZWVuIHJldmlld2VkLiAke3JlamVjdGlvbkRhdGEucmVqZWN0aW9uTWVzc2FnZX1gLFxuICAgICAgICAgIHR5cGU6ICdUSEVSQVBJU1RfUkVKRUNURUQnLFxuICAgICAgICAgIHByaW9yaXR5OiAnSElHSCcsXG4gICAgICAgICAgYWN0aW9uVXJsOiByZWplY3Rpb25EYXRhLmFsbG93UmVhcHBsaWNhdGlvblxuICAgICAgICAgICAgPyAnL3RoZXJhcGlzdC9yZWFwcGx5J1xuICAgICAgICAgICAgOiAnL3RoZXJhcGlzdC9hcHBsaWNhdGlvbicsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgICBgQWRtaW4gJHthZG1pbklkfSByZWplY3RlZCB0aGVyYXBpc3QgYXBwbGljYXRpb24gJHt0aGVyYXBpc3RJZH0gZm9yIHJlYXNvbjogJHtyZWplY3Rpb25EYXRhLnJlamVjdGlvblJlYXNvbn1gLFxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICB0aGVyYXBpc3Q6IHJlamVjdGVkVGhlcmFwaXN0LFxuICAgICAgICAgIG1lc3NhZ2U6ICdUaGVyYXBpc3QgYXBwbGljYXRpb24gcmVqZWN0ZWQnLFxuICAgICAgICAgIHJlamVjdGlvbkRhdGEsXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEZhaWxlZCB0byByZWplY3QgdGhlcmFwaXN0ICR7dGhlcmFwaXN0SWR9OmAsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09IFRIRVJBUElTVCBTVEFUVVMgTUFOQUdFTUVOVCA9PT09PVxuXG4gIGFzeW5jIHVwZGF0ZVRoZXJhcGlzdFN0YXR1cyhcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIGFkbWluSWQ6IHN0cmluZyxcbiAgICBzdGF0dXNEYXRhOiBVcGRhdGVUaGVyYXBpc3RTdGF0dXNEdG8sXG4gICkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAvLyAxLiBWZXJpZnkgdGhlcmFwaXN0IGV4aXN0c1xuICAgICAgICBjb25zdCBleGlzdGluZ1RoZXJhcGlzdCA9IGF3YWl0IHR4LnRoZXJhcGlzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHRoZXJhcGlzdElkIH0sXG4gICAgICAgICAgaW5jbHVkZTogeyB1c2VyOiB0cnVlIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghZXhpc3RpbmdUaGVyYXBpc3QpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oXG4gICAgICAgICAgICBgVGhlcmFwaXN0IHdpdGggSUQgJHt0aGVyYXBpc3RJZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMi4gVmFsaWRhdGUgc3RhdHVzIHRyYW5zaXRpb25cbiAgICAgICAgY29uc3QgdmFsaWRUcmFuc2l0aW9ucyA9IHRoaXMuZ2V0VmFsaWRTdGF0dXNUcmFuc2l0aW9ucyhcbiAgICAgICAgICBleGlzdGluZ1RoZXJhcGlzdC5zdGF0dXMsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHVwcGVyQ2FzZVN0YXR1cyA9IHN0YXR1c0RhdGEuc3RhdHVzLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIGlmICghdmFsaWRUcmFuc2l0aW9ucy5pbmNsdWRlcyh1cHBlckNhc2VTdGF0dXMpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICAgICBgSW52YWxpZCBzdGF0dXMgdHJhbnNpdGlvbiBmcm9tICR7ZXhpc3RpbmdUaGVyYXBpc3Quc3RhdHVzfSB0byAke3VwcGVyQ2FzZVN0YXR1c31gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAzLiBVcGRhdGUgdGhlcmFwaXN0IHN0YXR1c1xuICAgICAgICBjb25zdCB1cGRhdGVkVGhlcmFwaXN0ID0gYXdhaXQgdHgudGhlcmFwaXN0LnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgdXNlcklkOiB0aGVyYXBpc3RJZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXR1czogdXBwZXJDYXNlU3RhdHVzIGFzIGFueSxcbiAgICAgICAgICAgIHByb2Nlc3NlZEJ5QWRtaW5JZDogYWRtaW5JZCxcbiAgICAgICAgICAgIHByb2Nlc3NpbmdEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIDQuIFVwZGF0ZSB1c2VyIHN0YXR1cyBpZiBuZWNlc3NhcnlcbiAgICAgICAgY29uc3QgZ2VuZXJhdGVSYW5kb21QYXNzd29yZCA9ICgpOiBzdHJpbmcgPT4ge1xuICAgICAgICAgIHJldHVybiBjcnlwdG8ucmFuZG9tQnl0ZXMoOCkudG9TdHJpbmcoJ2hleCcpICsgJ0ExISc7IC8vIEVuc3VyZXMgdXBwZXJjYXNlLCBudW1iZXIsIGFuZCBzcGVjaWFsIGNoYXJcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBIYXNoIHBhc3N3b3JkXG4gICAgICAgIGNvbnN0IHJhbmRvbVBhc3N3b3JkID0gZ2VuZXJhdGVSYW5kb21QYXNzd29yZCgpO1xuICAgICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHJhbmRvbVBhc3N3b3JkLCAxMik7XG5cbiAgICAgICAgaWYgKHVwcGVyQ2FzZVN0YXR1cyA9PT0gJ1NVU1BFTkRFRCcpIHtcbiAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogdGhlcmFwaXN0SWQgfSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgICAgICAgICBzdXNwZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgc3VzcGVuZGVkQnk6IGFkbWluSWQsXG4gICAgICAgICAgICAgIHN1c3BlbnNpb25SZWFzb246IHN0YXR1c0RhdGEucmVhc29uIHx8ICdTdGF0dXMgdXBkYXRlZCBieSBhZG1pbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHVwcGVyQ2FzZVN0YXR1cyA9PT0gJ0FQUFJPVkVEJykge1xuICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB0aGVyYXBpc3RJZCB9LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgIHJvbGU6ICd0aGVyYXBpc3QnLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgc3VzcGVuZGVkQXQ6IG51bGwsXG4gICAgICAgICAgICAgIHN1c3BlbmRlZEJ5OiBudWxsLFxuICAgICAgICAgICAgICBzdXNwZW5zaW9uUmVhc29uOiBudWxsLFxuICAgICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLCAvLyBFbnN1cmUgZW1haWwgaXMgdmVyaWZpZWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBKb2luIHRoZSB0aGVyYXBpc3QgdG8gdGhlIGNvbW11bml0eVxuICAgICAgICBpZiAodXBwZXJDYXNlU3RhdHVzID09PSAnQVBQUk9WRUQnKSB7XG4gICAgICAgICAgLy8gTWFwIGFyZWFzIG9mIGV4cGVydGlzZSB0byBjb21tdW5pdHkgc2x1Z3NcbiAgICAgICAgICBjb25zdCBhcmVhc1RvQ29tbXVuaXR5TWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgICAgICAgc3RyZXNzOiAnc3RyZXNzLXN1cHBvcnQnLFxuICAgICAgICAgICAgYW54aWV0eTogJ2FueGlldHktc3VwcG9ydCcsXG4gICAgICAgICAgICBkZXByZXNzaW9uOiAnZGVwcmVzc2lvbi1zdXBwb3J0JyxcbiAgICAgICAgICAgIGluc29tbmlhOiAnaW5zb21uaWEtc3VwcG9ydCcsXG4gICAgICAgICAgICBwYW5pYzogJ3BhbmljLWRpc29yZGVyLXN1cHBvcnQnLFxuICAgICAgICAgICAgYmlwb2xhcjogJ2JpcG9sYXItZGlzb3JkZXItc3VwcG9ydCcsXG4gICAgICAgICAgICBvY2Q6ICdvY2Qtc3VwcG9ydCcsXG4gICAgICAgICAgICBwdHNkOiAncHRzZC1zdXBwb3J0JyxcbiAgICAgICAgICAgICdzb2NpYWwtYW54aWV0eSc6ICdzb2NpYWwtYW54aWV0eS1zdXBwb3J0JyxcbiAgICAgICAgICAgIHBob2JpYTogJ3Bob2JpYS1zdXBwb3J0JyxcbiAgICAgICAgICAgIGJ1cm5vdXQ6ICdidXJub3V0LXN1cHBvcnQnLFxuICAgICAgICAgICAgJ2VhdGluZy1kaXNvcmRlcic6ICdlYXRpbmctZGlzb3JkZXJzLXN1cHBvcnQnLFxuICAgICAgICAgICAgYWRoZDogJ2FkaGQtc3VwcG9ydCcsXG4gICAgICAgICAgICAnc3Vic3RhbmNlLXVzZSc6ICdzdWJzdGFuY2UtdXNlLXN1cHBvcnQnLFxuICAgICAgICAgICAgJ2RydWctdXNlJzogJ2RydWctdXNlLXN1cHBvcnQnLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICAvLyBHZXQgY29tbXVuaXR5IElEcyBiYXNlZCBvbiB0aGVyYXBpc3QncyBhcmVhcyBvZiBleHBlcnRpc2VcbiAgICAgICAgICBjb25zdCBjb21tdW5pdHlNZW1iZXJzaGlwcyA9IHVwZGF0ZWRUaGVyYXBpc3QuYXJlYXNPZkV4cGVydGlzZVxuICAgICAgICAgICAgLm1hcCgoYXJlYSkgPT4gYXJlYXNUb0NvbW11bml0eU1hcFthcmVhXSlcbiAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikgLy8gUmVtb3ZlIHVuZGVmaW5lZCB2YWx1ZXNcbiAgICAgICAgICAgIC5tYXAoKGNvbW11bml0eVNsdWcpID0+ICh7XG4gICAgICAgICAgICAgIHVzZXJJZDogdGhlcmFwaXN0SWQsXG4gICAgICAgICAgICAgIGNvbW11bml0eUlkOiBgZGV2X2NvbW1fJHtjb21tdW5pdHlTbHVnfWAsIC8vIFVzaW5nIHRoZSBmb3JtYXQgZnJvbSB5b3VyIHNjcmVlbnNob3RcbiAgICAgICAgICAgICAgam9pbmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAvLyBBbHNvIGFkZCB0byBnZW5lcmFsIHN1cHBvcnQgY29tbXVuaXR5XG4gICAgICAgICAgY29tbXVuaXR5TWVtYmVyc2hpcHMucHVzaCh7XG4gICAgICAgICAgICB1c2VySWQ6IHRoZXJhcGlzdElkLFxuICAgICAgICAgICAgY29tbXVuaXR5SWQ6ICdkZXZfY29tbV9nZW5lcmFsLXN1cHBvcnQnLFxuICAgICAgICAgICAgam9pbmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBDcmVhdGUgYWxsIG1lbWJlcnNoaXBzXG4gICAgICAgICAgaWYgKGNvbW11bml0eU1lbWJlcnNoaXBzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGF3YWl0IHR4Lm1lbWJlcnNoaXAuY3JlYXRlTWFueSh7XG4gICAgICAgICAgICAgIGRhdGE6IGNvbW11bml0eU1lbWJlcnNoaXBzLFxuICAgICAgICAgICAgICBza2lwRHVwbGljYXRlczogdHJ1ZSwgLy8gUHJldmVudCBkdXBsaWNhdGUgbWVtYmVyc2hpcHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEF1ZGl0IGxvZyByZW1vdmVkIC0gbm90IG5lZWRlZCBmb3Igc3R1ZGVudCBwcm9qZWN0XG4gICAgICAgIGlmICh1cHBlckNhc2VTdGF0dXMgPT09ICdBUFBST1ZFRCcpIHtcbiAgICAgICAgICAvLyA1LiBTZW5kIGFwcHJvdmFsIGVtYWlsXG4gICAgICAgICAgYXdhaXQgdGhpcy5lbWFpbFNlcnZpY2Uuc2VuZFRoZXJhcGlzdEFwcHJvdmVkKFxuICAgICAgICAgICAgZXhpc3RpbmdUaGVyYXBpc3QudXNlci5lbWFpbCxcbiAgICAgICAgICAgIGV4aXN0aW5nVGhlcmFwaXN0LnVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgICAgJ1dlbGNvbWUgdG8gTWVudGFyYSAtIFlvdXIgVGhlcmFwaXN0IEFwcGxpY2F0aW9uIGhhcyBiZWVuIEFwcHJvdmVkIScsXG4gICAgICAgICAgICByYW5kb21QYXNzd29yZCxcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHVwcGVyQ2FzZVN0YXR1cyA9PT0gJ1JFSkVDVEVEJykge1xuICAgICAgICAgIGF3YWl0IHRoaXMuZW1haWxTZXJ2aWNlLnNlbmRUaGVyYXBpc3REZW5pZWQoXG4gICAgICAgICAgICBleGlzdGluZ1RoZXJhcGlzdC51c2VyLmVtYWlsLFxuICAgICAgICAgICAgZXhpc3RpbmdUaGVyYXBpc3QudXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgICAnTWVudGFyYSBUaGVyYXBpc3QgQXBwbGljYXRpb24gVXBkYXRlJyxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gNi4gU2VuZCBzdGF0dXMgY2hhbmdlIG5vdGlmaWNhdGlvblxuICAgICAgICBjb25zdCBub3RpZmljYXRpb25UaXRsZSA9IHRoaXMuZ2V0U3RhdHVzQ2hhbmdlTm90aWZpY2F0aW9uVGl0bGUoXG4gICAgICAgICAgdXBwZXJDYXNlU3RhdHVzLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbk1lc3NhZ2UgPSB0aGlzLmdldFN0YXR1c0NoYW5nZU5vdGlmaWNhdGlvbk1lc3NhZ2UoXG4gICAgICAgICAgdXBwZXJDYXNlU3RhdHVzLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgc3RhdHVzRGF0YS5yZWFzb24sXG4gICAgICAgICk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGUoe1xuICAgICAgICAgIHVzZXJJZDogdGhlcmFwaXN0SWQsXG4gICAgICAgICAgdGl0bGU6IG5vdGlmaWNhdGlvblRpdGxlLFxuICAgICAgICAgIG1lc3NhZ2U6IG5vdGlmaWNhdGlvbk1lc3NhZ2UsXG4gICAgICAgICAgdHlwZTogJ1RIRVJBUElTVF9TVEFUVVNfVVBEQVRFRCcsXG4gICAgICAgICAgcHJpb3JpdHk6IHVwcGVyQ2FzZVN0YXR1cyA9PT0gJ1NVU1BFTkRFRCcgPyAnSElHSCcgOiAnTk9STUFMJyxcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvdGhlcmFwaXN0L2Rhc2hib2FyZCcsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgICBgQWRtaW4gJHthZG1pbklkfSB1cGRhdGVkIHRoZXJhcGlzdCAke3RoZXJhcGlzdElkfSBzdGF0dXMgZnJvbSAke2V4aXN0aW5nVGhlcmFwaXN0LnN0YXR1c30gdG8gJHt1cHBlckNhc2VTdGF0dXN9YCxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgdGhlcmFwaXN0OiB1cGRhdGVkVGhlcmFwaXN0LFxuICAgICAgICAgIHByZXZpb3VzU3RhdHVzOiBleGlzdGluZ1RoZXJhcGlzdC5zdGF0dXMsXG4gICAgICAgICAgbmV3U3RhdHVzOiB1cHBlckNhc2VTdGF0dXMsXG4gICAgICAgICAgbWVzc2FnZTogYFRoZXJhcGlzdCBzdGF0dXMgdXBkYXRlZCB0byAke3VwcGVyQ2FzZVN0YXR1c31gLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIHVwZGF0ZSB0aGVyYXBpc3Qgc3RhdHVzIGZvciAke3RoZXJhcGlzdElkfTpgLFxuICAgICAgICBlcnJvcixcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PSBBTkFMWVRJQ1MgQU5EIFJFUE9SVElORyA9PT09PVxuXG4gIGFzeW5jIGdldFRoZXJhcGlzdEFwcGxpY2F0aW9uTWV0cmljcyhzdGFydERhdGU/OiBzdHJpbmcsIGVuZERhdGU/OiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnQgPSBzdGFydERhdGVcbiAgICAgICAgPyBuZXcgRGF0ZShzdGFydERhdGUpXG4gICAgICAgIDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDMwICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBjb25zdCBlbmQgPSBlbmREYXRlID8gbmV3IERhdGUoZW5kRGF0ZSkgOiBuZXcgRGF0ZSgpO1xuXG4gICAgICBjb25zdCBbXG4gICAgICAgIHRvdGFsQXBwbGljYXRpb25zLFxuICAgICAgICBwZW5kaW5nQXBwbGljYXRpb25zLFxuICAgICAgICBhcHByb3ZlZEFwcGxpY2F0aW9ucyxcbiAgICAgICAgcmVqZWN0ZWRBcHBsaWNhdGlvbnMsXG4gICAgICAgIHJlY2VudEFwcGxpY2F0aW9ucyxcbiAgICAgICAgcHJvY2Vzc2luZ1RpbWVzLFxuICAgICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgLy8gVG90YWwgYXBwbGljYXRpb25zIGluIHBlcmlvZFxuICAgICAgICB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdWJtaXNzaW9uRGF0ZTogeyBndGU6IHN0YXJ0LCBsdGU6IGVuZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICAvLyBQZW5kaW5nIGFwcGxpY2F0aW9uc1xuICAgICAgICB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdGF0dXM6ICdQRU5ESU5HJyxcbiAgICAgICAgICAgIHN1Ym1pc3Npb25EYXRlOiB7IGd0ZTogc3RhcnQsIGx0ZTogZW5kIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIC8vIEFwcHJvdmVkIGFwcGxpY2F0aW9ucyBpbiBwZXJpb2RcbiAgICAgICAgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmNvdW50KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgc3RhdHVzOiAnQVBQUk9WRUQnLFxuICAgICAgICAgICAgcHJvY2Vzc2luZ0RhdGU6IHsgZ3RlOiBzdGFydCwgbHRlOiBlbmQgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgLy8gUmVqZWN0ZWQgYXBwbGljYXRpb25zIGluIHBlcmlvZFxuICAgICAgICB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdGF0dXM6ICdSRUpFQ1RFRCcsXG4gICAgICAgICAgICBwcm9jZXNzaW5nRGF0ZTogeyBndGU6IHN0YXJ0LCBsdGU6IGVuZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICAvLyBSZWNlbnQgYXBwbGljYXRpb25zIGZvciB0cmVuZCBhbmFseXNpc1xuICAgICAgICB0aGlzLnByaXNtYS50aGVyYXBpc3QuZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBzdWJtaXNzaW9uRGF0ZTogeyBndGU6IHN0YXJ0LCBsdGU6IGVuZCB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBzdWJtaXNzaW9uRGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgICAgICAgIHByb2Nlc3NpbmdEYXRlOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgb3JkZXJCeTogeyBzdWJtaXNzaW9uRGF0ZTogJ2Rlc2MnIH0sXG4gICAgICAgIH0pLFxuICAgICAgICAvLyBQcm9jZXNzaW5nIHRpbWVzIGZvciBhcHByb3ZlZC9yZWplY3RlZCBhcHBsaWNhdGlvbnNcbiAgICAgICAgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmZpbmRNYW55KHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgcHJvY2Vzc2luZ0RhdGU6IHsgZ3RlOiBzdGFydCwgbHRlOiBlbmQgfSxcbiAgICAgICAgICAgIHN0YXR1czogeyBpbjogWydBUFBST1ZFRCcsICdSRUpFQ1RFRCddIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIHN1Ym1pc3Npb25EYXRlOiB0cnVlLFxuICAgICAgICAgICAgcHJvY2Vzc2luZ0RhdGU6IHRydWUsXG4gICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICBdKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGF2ZXJhZ2UgcHJvY2Vzc2luZyB0aW1lXG4gICAgICBjb25zdCBhdmVyYWdlUHJvY2Vzc2luZ1RpbWUgPVxuICAgICAgICBwcm9jZXNzaW5nVGltZXMucmVkdWNlKChhY2MsIGFwcCkgPT4ge1xuICAgICAgICAgIGlmIChhcHAucHJvY2Vzc2luZ0RhdGUgJiYgYXBwLnN1Ym1pc3Npb25EYXRlKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzaW5nVGltZU1zID1cbiAgICAgICAgICAgICAgYXBwLnByb2Nlc3NpbmdEYXRlLmdldFRpbWUoKSAtIGFwcC5zdWJtaXNzaW9uRGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gYWNjICsgcHJvY2Vzc2luZ1RpbWVNcyAvICgxMDAwICogNjAgKiA2MCAqIDI0KTsgLy8gQ29udmVydCB0byBkYXlzXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIDApIC8gKHByb2Nlc3NpbmdUaW1lcy5sZW5ndGggfHwgMSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBhcHByb3ZhbCByYXRlXG4gICAgICBjb25zdCBwcm9jZXNzZWRBcHBsaWNhdGlvbnMgPSBhcHByb3ZlZEFwcGxpY2F0aW9ucyArIHJlamVjdGVkQXBwbGljYXRpb25zO1xuICAgICAgY29uc3QgYXBwcm92YWxSYXRlID1cbiAgICAgICAgcHJvY2Vzc2VkQXBwbGljYXRpb25zID4gMFxuICAgICAgICAgID8gKGFwcHJvdmVkQXBwbGljYXRpb25zIC8gcHJvY2Vzc2VkQXBwbGljYXRpb25zKSAqIDEwMFxuICAgICAgICAgIDogMDtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgR2VuZXJhdGVkIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiBtZXRyaWNzIGZvciBwZXJpb2QgJHtzdGFydH0gdG8gJHtlbmR9YCxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBlcmlvZDogeyBzdGFydCwgZW5kIH0sXG4gICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICB0b3RhbEFwcGxpY2F0aW9ucyxcbiAgICAgICAgICBwZW5kaW5nQXBwbGljYXRpb25zLFxuICAgICAgICAgIGFwcHJvdmVkQXBwbGljYXRpb25zLFxuICAgICAgICAgIHJlamVjdGVkQXBwbGljYXRpb25zLFxuICAgICAgICAgIHByb2Nlc3NlZEFwcGxpY2F0aW9ucyxcbiAgICAgICAgfSxcbiAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgIGFwcHJvdmFsUmF0ZTogTWF0aC5yb3VuZChhcHByb3ZhbFJhdGUgKiAxMDApIC8gMTAwLFxuICAgICAgICAgIGF2ZXJhZ2VQcm9jZXNzaW5nVGltZURheXM6XG4gICAgICAgICAgICBNYXRoLnJvdW5kKGF2ZXJhZ2VQcm9jZXNzaW5nVGltZSAqIDEwMCkgLyAxMDAsXG4gICAgICAgICAgYXBwbGljYXRpb25UcmVuZDogdGhpcy5jYWxjdWxhdGVBcHBsaWNhdGlvblRyZW5kKHJlY2VudEFwcGxpY2F0aW9ucyksXG4gICAgICAgIH0sXG4gICAgICAgIHJlY2VudEFjdGl2aXR5OiByZWNlbnRBcHBsaWNhdGlvbnMuc2xpY2UoMCwgMTApLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICdGYWlsZWQgdG8gZ2VuZXJhdGUgdGhlcmFwaXN0IGFwcGxpY2F0aW9uIG1ldHJpY3M6JyxcbiAgICAgICAgZXJyb3IsXG4gICAgICApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT0gSEVMUEVSIE1FVEhPRFMgPT09PT1cblxuICBwcml2YXRlIGdldFZhbGlkU3RhdHVzVHJhbnNpdGlvbnMoY3VycmVudFN0YXR1czogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHRyYW5zaXRpb25zID0ge1xuICAgICAgUEVORElORzogWydBUFBST1ZFRCcsICdSRUpFQ1RFRCcsICdVTkRFUl9SRVZJRVcnXSxcbiAgICAgIFVOREVSX1JFVklFVzogWydBUFBST1ZFRCcsICdSRUpFQ1RFRCcsICdQRU5ESU5HJ10sXG4gICAgICBBUFBST1ZFRDogWydTVVNQRU5ERUQnLCAnVU5ERVJfUkVWSUVXJ10sXG4gICAgICBSRUpFQ1RFRDogWydQRU5ESU5HJywgJ1VOREVSX1JFVklFVyddLCAvLyBBbGxvdyByZXN1Ym1pc3Npb25cbiAgICAgIFNVU1BFTkRFRDogWydBUFBST1ZFRCcsICdSRUpFQ1RFRCddLFxuICAgIH07XG5cbiAgICByZXR1cm4gdHJhbnNpdGlvbnNbY3VycmVudFN0YXR1c10gfHwgW107XG4gIH1cblxuICBwcml2YXRlIGdldFN0YXR1c0NoYW5nZU5vdGlmaWNhdGlvblRpdGxlKHN0YXR1czogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCB0aXRsZXMgPSB7XG4gICAgICBhcHByb3ZlZDogJ0FwcGxpY2F0aW9uIEFwcHJvdmVkIScsXG4gICAgICByZWplY3RlZDogJ0FwcGxpY2F0aW9uIFN0YXR1cyBVcGRhdGUnLFxuICAgICAgc3VzcGVuZGVkOiAnQWNjb3VudCBTdXNwZW5kZWQnLFxuICAgICAgdW5kZXJfcmV2aWV3OiAnQXBwbGljYXRpb24gVW5kZXIgUmV2aWV3JyxcbiAgICAgIHBlbmRpbmc6ICdBcHBsaWNhdGlvbiBTdGF0dXMgQ2hhbmdlZCcsXG4gICAgfTtcblxuICAgIHJldHVybiB0aXRsZXNbc3RhdHVzXSB8fCAnU3RhdHVzIFVwZGF0ZSc7XG4gIH1cblxuICBwcml2YXRlIGdldFN0YXR1c0NoYW5nZU5vdGlmaWNhdGlvbk1lc3NhZ2UoXG4gICAgc3RhdHVzOiBzdHJpbmcsXG4gICAgcmVhc29uPzogc3RyaW5nLFxuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IGJhc2VNZXNzYWdlcyA9IHtcbiAgICAgIGFwcHJvdmVkOlxuICAgICAgICAnQ29uZ3JhdHVsYXRpb25zISBZb3VyIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiBoYXMgYmVlbiBhcHByb3ZlZC4nLFxuICAgICAgcmVqZWN0ZWQ6ICdZb3VyIHRoZXJhcGlzdCBhcHBsaWNhdGlvbiBoYXMgYmVlbiByZXZpZXdlZC4nLFxuICAgICAgc3VzcGVuZGVkOiAnWW91ciB0aGVyYXBpc3QgYWNjb3VudCBoYXMgYmVlbiB0ZW1wb3JhcmlseSBzdXNwZW5kZWQuJyxcbiAgICAgIHVuZGVyX3JldmlldzogJ1lvdXIgYXBwbGljYXRpb24gaXMgY3VycmVudGx5IHVuZGVyIGFkZGl0aW9uYWwgcmV2aWV3LicsXG4gICAgICBwZW5kaW5nOiAnWW91ciBhcHBsaWNhdGlvbiBzdGF0dXMgaGFzIGJlZW4gdXBkYXRlZC4nLFxuICAgIH07XG5cbiAgICBjb25zdCBiYXNlTWVzc2FnZSA9XG4gICAgICBiYXNlTWVzc2FnZXNbc3RhdHVzXSB8fCAnWW91ciBhY2NvdW50IHN0YXR1cyBoYXMgYmVlbiB1cGRhdGVkLic7XG4gICAgcmV0dXJuIHJlYXNvbiA/IGAke2Jhc2VNZXNzYWdlfSBSZWFzb246ICR7cmVhc29ufWAgOiBiYXNlTWVzc2FnZTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXBwbGljYXRpb25UcmVuZChcbiAgICBhcHBsaWNhdGlvbnM6IGFueVtdLFxuICApOiAnaW5jcmVhc2luZycgfCAnZGVjcmVhc2luZycgfCAnc3RhYmxlJyB7XG4gICAgaWYgKGFwcGxpY2F0aW9ucy5sZW5ndGggPCA3KSByZXR1cm4gJ3N0YWJsZSc7XG5cbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHdlZWtBZ28gPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgIGNvbnN0IHR3b1dlZWtzQWdvID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIDE0ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgICBjb25zdCByZWNlbnRXZWVrQ291bnQgPSBhcHBsaWNhdGlvbnMuZmlsdGVyKFxuICAgICAgKGFwcCkgPT4gYXBwLnN1Ym1pc3Npb25EYXRlID49IHdlZWtBZ28sXG4gICAgKS5sZW5ndGg7XG4gICAgY29uc3QgcHJldmlvdXNXZWVrQ291bnQgPSBhcHBsaWNhdGlvbnMuZmlsdGVyKFxuICAgICAgKGFwcCkgPT5cbiAgICAgICAgYXBwLnN1Ym1pc3Npb25EYXRlID49IHR3b1dlZWtzQWdvICYmIGFwcC5zdWJtaXNzaW9uRGF0ZSA8IHdlZWtBZ28sXG4gICAgKS5sZW5ndGg7XG5cbiAgICBpZiAocmVjZW50V2Vla0NvdW50ID4gcHJldmlvdXNXZWVrQ291bnQgKiAxLjEpIHJldHVybiAnaW5jcmVhc2luZyc7XG4gICAgaWYgKHJlY2VudFdlZWtDb3VudCA8IHByZXZpb3VzV2Vla0NvdW50ICogMC45KSByZXR1cm4gJ2RlY3JlYXNpbmcnO1xuICAgIHJldHVybiAnc3RhYmxlJztcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9