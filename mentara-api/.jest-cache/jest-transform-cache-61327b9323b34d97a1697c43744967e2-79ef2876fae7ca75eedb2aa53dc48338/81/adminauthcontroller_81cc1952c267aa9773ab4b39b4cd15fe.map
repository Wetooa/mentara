{"version":3,"names":["common_1","cov_rrmakgmsz","s","require","throttler_1","jwt_auth_guard_1","current_user_id_decorator_1","current_user_role_decorator_1","zod_validation_pipe_1","validation_1","admin_auth_service_1","AdminAuthController","adminAuthService","constructor","f","createAdminAccount","currentUserRole","registerDto","b","ForbiddenException","result","email","password","firstName","lastName","adminLevel","permissions","user","id","role","isEmailVerified","emailVerified","createdAt","updatedAt","message","getProfile","userId","getAdminProfile","getPermissions","getAdminPermissions","getDashboardStats","getAdminDashboardStats","exports","__decorate","Post","UseGuards","JwtAuthGuard","Throttle","default","limit","ttl","HttpCode","HttpStatus","CREATED","__param","CurrentUserRole","Body","ZodValidationPipe","RegisterAdminDtoSchema","Get","CurrentUserId","Promise","_b","Object","Controller","AdminAuthService","_a"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/admin-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  Post,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Req,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../decorators/current-user-role.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterAdminDto,\n  LoginDto,\n  AdminAuthResponse,\n} from '../types';\n\n// Import validation schemas from local validation\nimport {\n  RegisterAdminDtoSchema,\n  LoginDtoSchema,\n} from '../validation';\nimport { AdminAuthService } from '../services/admin-auth.service';\nimport { Request } from 'express';\n\n@Controller('auth/admin')\nexport class AdminAuthController {\n  constructor(private readonly adminAuthService: AdminAuthService) {}\n\n  @Post('create-account')\n  @UseGuards(JwtAuthGuard)\n  @Throttle({ default: { limit: 3, ttl: 600000 } }) // 3 admin creations per 10 minutes\n  @HttpCode(HttpStatus.CREATED)\n  async createAdminAccount(\n    @CurrentUserRole() currentUserRole: string,\n    @Body(new ZodValidationPipe(RegisterAdminDtoSchema))\n    registerDto: RegisterAdminDto,\n  ) {\n    // Only super admins can create other admins\n    if (currentUserRole !== 'admin') {\n      throw new ForbiddenException('Only admins can create admin accounts');\n    }\n\n    const result = await this.adminAuthService.createAdminAccount(\n      registerDto.email,\n      registerDto.password,\n      registerDto.firstName,\n      registerDto.lastName,\n      (registerDto as any).adminLevel || 'admin',\n      (registerDto as any).permissions || [],\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName,\n        lastName: result.user.lastName,\n        role: result.user.role as any,\n        isEmailVerified: result.user.emailVerified ?? false,\n        createdAt: result.user.createdAt,\n        updatedAt: result.user.updatedAt,\n      },\n      message: result.message,\n    };\n  }\n\n  // REMOVED: Duplicate login route - use universal /auth/login instead\n  // This was redundant with AuthController.login() which handles all roles\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string): Promise<any> {\n    // TODO: Add AdminProfileResponse schema\n    return this.adminAuthService.getAdminProfile(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('permissions')\n  async getPermissions(@CurrentUserId() userId: string) {\n    return this.adminAuthService.getAdminPermissions(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('dashboard-stats')\n  async getDashboardStats(@CurrentUserId() userId: string) {\n    return this.adminAuthService.getAdminDashboardStats(userId);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,QAAA;AAAA;AAAA,CAAAC,aAAA,GAAAC,CAAA,QAAAC,OAAA;AAWA,MAAAC,WAAA;AAAA;AAAA,CAAAH,aAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAE,gBAAA;AAAA;AAAA,CAAAJ,aAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAG,2BAAA;AAAA;AAAA,CAAAL,aAAA,GAAAC,CAAA,QAAAC,OAAA;AACA,MAAAI,6BAAA;AAAA;AAAA,CAAAN,aAAA,GAAAC,CAAA,QAAAC,OAAA;AAEA,MAAAK,qBAAA;AAAA;AAAA,CAAAP,aAAA,GAAAC,CAAA,QAAAC,OAAA;AAQA;AACA,MAAAM,YAAA;AAAA;AAAA,CAAAR,aAAA,GAAAC,CAAA,QAAAC,OAAA;AAIA,MAAAO,oBAAA;AAAA;AAAA,CAAAT,aAAA,GAAAC,CAAA,QAAAC,OAAA;AAAkE;AAAAF,aAAA,GAAAC,CAAA;AAI3D,IAAMS,mBAAmB,GAAzB,MAAMA,mBAAmB;EACDC,gBAAA;EAA7BC,YAA6BD,gBAAkC;IAAA;IAAAX,aAAA,GAAAa,CAAA;IAAAb,aAAA,GAAAC,CAAA;IAAlC,KAAAU,gBAAgB,GAAhBA,gBAAgB;EAAqB;EAM5D,MAAAG,kBAAkBA,CACHC,eAAuB,EAE1CC,WAA6B;IAAA;IAAAhB,aAAA,GAAAa,CAAA;IAAAb,aAAA,GAAAC,CAAA;IAE7B;IACA,IAAIc,eAAe,KAAK,OAAO,EAAE;MAAA;MAAAf,aAAA,GAAAiB,CAAA;MAAAjB,aAAA,GAAAC,CAAA;MAC/B,MAAM,IAAIF,QAAA,CAAAmB,kBAAkB,CAAC,uCAAuC,CAAC;IACvE,CAAC;IAAA;IAAA;MAAAlB,aAAA,GAAAiB,CAAA;IAAA;IAED,MAAME,MAAM;IAAA;IAAA,CAAAnB,aAAA,GAAAC,CAAA,QAAG,MAAM,IAAI,CAACU,gBAAgB,CAACG,kBAAkB,CAC3DE,WAAW,CAACI,KAAK,EACjBJ,WAAW,CAACK,QAAQ,EACpBL,WAAW,CAACM,SAAS,EACrBN,WAAW,CAACO,QAAQ;IACnB;IAAA,CAAAvB,aAAA,GAAAiB,CAAA,WAAAD,WAAmB,CAACQ,UAAU;IAAA;IAAA,CAAAxB,aAAA,GAAAiB,CAAA,WAAI,OAAO;IACzC;IAAA,CAAAjB,aAAA,GAAAiB,CAAA,WAAAD,WAAmB,CAACS,WAAW;IAAA;IAAA,CAAAzB,aAAA,GAAAiB,CAAA,WAAI,EAAE,EACvC;IAAC;IAAAjB,aAAA,GAAAC,CAAA;IAEF,OAAO;MACLyB,IAAI,EAAE;QACJC,EAAE,EAAER,MAAM,CAACO,IAAI,CAACC,EAAE;QAClBP,KAAK,EAAED,MAAM,CAACO,IAAI,CAACN,KAAK;QACxBE,SAAS,EAAEH,MAAM,CAACO,IAAI,CAACJ,SAAS;QAChCC,QAAQ,EAAEJ,MAAM,CAACO,IAAI,CAACH,QAAQ;QAC9BK,IAAI,EAAET,MAAM,CAACO,IAAI,CAACE,IAAW;QAC7BC,eAAe;QAAE;QAAA,CAAA7B,aAAA,GAAAiB,CAAA,WAAAE,MAAM,CAACO,IAAI,CAACI,aAAa;QAAA;QAAA,CAAA9B,aAAA,GAAAiB,CAAA,WAAI,KAAK;QACnDc,SAAS,EAAEZ,MAAM,CAACO,IAAI,CAACK,SAAS;QAChCC,SAAS,EAAEb,MAAM,CAACO,IAAI,CAACM;OACxB;MACDC,OAAO,EAAEd,MAAM,CAACc;KACjB;EACH;EAEA;EACA;EAIM,MAAAC,UAAUA,CAAkBC,MAAc;IAAA;IAAAnC,aAAA,GAAAa,CAAA;IAAAb,aAAA,GAAAC,CAAA;IAC9C;IACA,OAAO,IAAI,CAACU,gBAAgB,CAACyB,eAAe,CAACD,MAAM,CAAC;EACtD;EAIM,MAAAE,cAAcA,CAAkBF,MAAc;IAAA;IAAAnC,aAAA,GAAAa,CAAA;IAAAb,aAAA,GAAAC,CAAA;IAClD,OAAO,IAAI,CAACU,gBAAgB,CAAC2B,mBAAmB,CAACH,MAAM,CAAC;EAC1D;EAIM,MAAAI,iBAAiBA,CAAkBJ,MAAc;IAAA;IAAAnC,aAAA,GAAAa,CAAA;IAAAb,aAAA,GAAAC,CAAA;IACrD,OAAO,IAAI,CAACU,gBAAgB,CAAC6B,sBAAsB,CAACL,MAAM,CAAC;EAC7D;CACD;AAAA;AAAAnC,aAAA,GAAAC,CAAA;AA9DYwC,OAAA,CAAA/B,mBAAA,GAAAA,mBAAA;AAAmB;AAAAV,aAAA,GAAAC,CAAA;AAOxByC,UAAA,EAJL,IAAA3C,QAAA,CAAA4C,IAAI,EAAC,gBAAgB,CAAC,EACtB,IAAA5C,QAAA,CAAA6C,SAAS,EAACxC,gBAAA,CAAAyC,YAAY,CAAC,EACvB,IAAA1C,WAAA,CAAA2C,QAAQ,EAAC;EAAEC,OAAO,EAAE;IAAEC,KAAK,EAAE,CAAC;IAAEC,GAAG,EAAE;EAAM;AAAE,CAAE,CAAC,CAAC;AAAA,EACjD,IAAAlD,QAAA,CAAAmD,QAAQ,EAACnD,QAAA,CAAAoD,UAAU,CAACC,OAAO,CAAC,EAE1BC,OAAA,QAAA/C,6BAAA,CAAAgD,eAAe,GAAE,GACjBD,OAAA,QAAAtD,QAAA,CAAAwD,IAAI,EAAC,IAAIhD,qBAAA,CAAAiD,iBAAiB,CAAChD,YAAA,CAAAiD,sBAAsB,CAAC,CAAC,G,6LA8BrD;AAAA;AAAAzD,aAAA,GAAAC,CAAA;AAOKyC,UAAA,EAFL,IAAA3C,QAAA,CAAA6C,SAAS,EAACxC,gBAAA,CAAAyC,YAAY,CAAC,EACvB,IAAA9C,QAAA,CAAA2D,GAAG,EAAC,SAAS,CAAC,EACGL,OAAA,QAAAhD,2BAAA,CAAAsD,aAAa,GAAE,G;;oCAAkBC,OAAO;AAAA;AAAA,CAAA5D,aAAA,GAAAiB,CAAA,WAAP2C,OAAO;AAAA;AAAA,CAAA5D,aAAA,GAAAiB,CAAA,WAAA4C,EAAA;AAAA;AAAA,CAAA7D,aAAA,GAAAiB,CAAA,WAAA6C,MAAA,G,oDAGzD;AAAA;AAAA9D,aAAA,GAAAC,CAAA;AAIKyC,UAAA,EAFL,IAAA3C,QAAA,CAAA6C,SAAS,EAACxC,gBAAA,CAAAyC,YAAY,CAAC,EACvB,IAAA9C,QAAA,CAAA2D,GAAG,EAAC,aAAa,CAAC,EACGL,OAAA,QAAAhD,2BAAA,CAAAsD,aAAa,GAAE,G,iLAEpC;AAAA;AAAA3D,aAAA,GAAAC,CAAA;AAIKyC,UAAA,EAFL,IAAA3C,QAAA,CAAA6C,SAAS,EAACxC,gBAAA,CAAAyC,YAAY,CAAC,EACvB,IAAA9C,QAAA,CAAA2D,GAAG,EAAC,iBAAiB,CAAC,EACEL,OAAA,QAAAhD,2BAAA,CAAAsD,aAAa,GAAE,G,oLAEvC;AAAA;AAAA3D,aAAA,GAAAC,CAAA;8BA7DUS,mBAAmB,GAAAgC,UAAA,EAD/B,IAAA3C,QAAA,CAAAgE,UAAU,EAAC,YAAY,CAAC,E;;oCAEwBtD,oBAAA,CAAAuD,gBAAgB;AAAA;AAAA,CAAAhE,aAAA,GAAAiB,CAAA,WAAhBR,oBAAA,CAAAuD,gBAAgB;AAAA;AAAA,CAAAhE,aAAA,GAAAiB,CAAA,WAAAgD,EAAA;AAAA;AAAA,CAAAjE,aAAA,GAAAiB,CAAA,WAAA6C,MAAA,I,EADpDpD,mBAAmB,CA8D/B","ignoreList":[]}