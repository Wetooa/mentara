{"version":3,"names":["common_1","cov_24plvvvvt7","s","require","platform_express_1","jwt_auth_guard_1","current_user_id_decorator_1","supabase_storage_service_1","worksheets_service_1","WorksheetsController","worksheetsService","supabaseStorageService","constructor","f","findAll","clerkId","query","userId","therapistId","status","findById","id","create","createWorksheetDto","files","b","clientId","update","updateWorksheetDto","delete","addSubmission","createSubmissionDto","submitWorksheet","submitWorksheetDto","deleteSubmission","exports","__decorate","Get","__param","CurrentUserId","Query","Param","Post","UseInterceptors","FilesInterceptor","Body","UploadedFiles","Put","Delete","Controller","UseGuards","JwtAuthGuard","WorksheetsService","_a","Object","_b","SupabaseStorageService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/worksheets/worksheets.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  UseInterceptors,\n  UploadedFiles,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { JwtAuthGuard } from 'src/auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from 'src/auth/decorators/current-user-id.decorator';\nimport { SupabaseStorageService } from 'src/common/services/supabase-storage.service';\nimport { WorksheetsService } from './worksheets.service';\nimport { PaginationQuery, FilterQuery } from 'src/types';\nimport type {\n  WorksheetCreateInputDto,\n  WorksheetUpdateInputDto,\n  WorksheetSubmissionCreateInputDto,\n} from './types';\n\n@Controller('worksheets')\n@UseGuards(JwtAuthGuard)\nexport class WorksheetsController {\n  constructor(\n    private readonly worksheetsService: WorksheetsService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  @Get()\n  findAll(\n    @CurrentUserId() clerkId: string,\n    @Query() query: PaginationQuery & FilterQuery,\n  ) {\n    return this.worksheetsService.findAll(\n      query.userId,\n      query.therapistId,\n      query.status,\n    );\n  }\n\n  @Get(':id')\n  findById(@Param('id') id: string) {\n    return this.worksheetsService.findById(id);\n  }\n\n  @Post()\n  @UseInterceptors(FilesInterceptor('files', 5)) // Support up to 5 files\n  create(\n    @CurrentUserId() clerkId: string,\n    @Body()\n    createWorksheetDto: WorksheetCreateInputDto & {\n      clientId: string;\n      therapistId: string;\n    },\n    @UploadedFiles() files: Express.Multer.File[] = [], // Optional files\n  ) {\n    return this.worksheetsService.create(\n      createWorksheetDto,\n      createWorksheetDto.clientId,\n      createWorksheetDto.therapistId,\n      files,\n    );\n  }\n\n  @Put(':id')\n  update(\n    @CurrentUserId() clerkId: string,\n    @Param('id') id: string,\n    @Body() updateWorksheetDto: WorksheetUpdateInputDto,\n  ) {\n    return this.worksheetsService.update(id, updateWorksheetDto);\n  }\n\n  @Delete(':id')\n  delete(@CurrentUserId() clerkId: string, @Param('id') id: string) {\n    return this.worksheetsService.delete(id);\n  }\n\n  @Post('submissions')\n  addSubmission(\n    @CurrentUserId() clerkId: string,\n    @Body() createSubmissionDto: WorksheetSubmissionCreateInputDto,\n  ) {\n    return this.worksheetsService.addSubmission(createSubmissionDto, clerkId);\n  }\n\n  @Post(':id/submit')\n  submitWorksheet(\n    @CurrentUserId() clerkId: string,\n    @Param('id') id: string,\n    @Body() submitWorksheetDto: WorksheetSubmissionCreateInputDto,\n  ) {\n    return this.worksheetsService.submitWorksheet(\n      id,\n      submitWorksheetDto,\n      clerkId,\n    );\n  }\n\n  @Delete('submissions/:id')\n  deleteSubmission(@CurrentUserId() clerkId: string, @Param('id') id: string) {\n    return this.worksheetsService.deleteSubmission(id);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}