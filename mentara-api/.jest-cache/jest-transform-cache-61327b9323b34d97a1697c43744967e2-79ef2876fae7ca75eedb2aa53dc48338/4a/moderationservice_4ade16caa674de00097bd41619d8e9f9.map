{"version":3,"names":["cov_1dv3awz3gs","actualCoverage","common_1","s","require","axios_1","rxjs_1","config_1","ModerationService","ModerationService_1","httpService","configService","logger","Logger","name","moderationApiUrl","enabled","timeout","constructor","f","get","classifyContent","text","context","b","createSafeResult","startTime","Date","now","response","firstValueFrom","post","user_id","userId","user_role","userRole","conversation_id","conversationId","community_id","communityId","timestamp","toISOString","headers","processingTime","result","data","crisisLevel","immediateEscalation","warn","substring","confidence","flags","classification","error","checkCrisisContent","batchClassify","items","map","item","length","healthCheck","status","responseTime","Error","message","getStats","requestCount","averageResponseTime","errorRate","crisisDetections","overrides","mentalHealthContext","createPostContext","createCommentContext","createMessageContext","createTherapyContext","sessionId","exports","__decorate","Injectable","HttpService","_a","Object","_b","ConfigService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/services/moderation.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { HttpService } from '@nestjs/axios';\nimport { firstValueFrom } from 'rxjs';\nimport { ConfigService } from '@nestjs/config';\n\nexport interface ModerationResult {\n  classification: 'safe' | 'toxic' | 'spam' | 'crisis';\n  confidence: number;\n  mentalHealthContext: boolean;\n  crisisLevel?: 'low' | 'medium' | 'high' | 'critical';\n  immediateEscalation?: boolean;\n  flags: string[];\n  processingTime: number;\n}\n\nexport interface ModerationContext {\n  context: string;\n  userId?: string;\n  userRole?: string;\n  conversationId?: string;\n  communityId?: string;\n  timestamp?: Date;\n}\n\n@Injectable()\nexport class ModerationService {\n  private readonly logger = new Logger(ModerationService.name);\n  private readonly moderationApiUrl: string;\n  private readonly enabled: boolean;\n  private readonly timeout: number;\n\n  constructor(\n    private readonly httpService: HttpService,\n    private readonly configService: ConfigService,\n  ) {\n    this.moderationApiUrl = this.configService.get<string>(\n      'MODERATION_API_URL',\n      'http://localhost:5001',\n    );\n    this.enabled = this.configService.get<boolean>('MODERATION_ENABLED', true);\n    this.timeout = this.configService.get<number>('MODERATION_TIMEOUT', 5000);\n  }\n\n  /**\n   * Classify content using the AI moderation service\n   */\n  async classifyContent(\n    text: string,\n    context: ModerationContext,\n  ): Promise<ModerationResult> {\n    if (!this.enabled) {\n      return this.createSafeResult(text);\n    }\n\n    try {\n      const startTime = Date.now();\n\n      const response = await firstValueFrom(\n        this.httpService.post(\n          `${this.moderationApiUrl}/api/v1/classify`,\n          {\n            text,\n            context: context.context,\n            user_id: context.userId,\n            user_role: context.userRole,\n            conversation_id: context.conversationId,\n            community_id: context.communityId,\n            timestamp: context.timestamp?.toISOString(),\n          },\n          {\n            timeout: this.timeout,\n            headers: {\n              'Content-Type': 'application/json',\n            },\n          },\n        ),\n      );\n\n      const processingTime = Date.now() - startTime;\n      const result: ModerationResult = {\n        ...response.data,\n        processingTime,\n      };\n\n      // Log crisis detection for immediate escalation\n      if (result.crisisLevel === 'critical' || result.immediateEscalation) {\n        this.logger.warn(\n          `CRISIS DETECTED: User ${context.userId} in ${context.context}`,\n          {\n            text: text.substring(0, 100),\n            crisisLevel: result.crisisLevel,\n            confidence: result.confidence,\n            flags: result.flags,\n          },\n        );\n      }\n\n      // Log toxic content detection\n      if (result.classification === 'toxic') {\n        this.logger.warn(\n          `TOXIC CONTENT DETECTED: User ${context.userId} in ${context.context}`,\n          {\n            text: text.substring(0, 100),\n            confidence: result.confidence,\n            flags: result.flags,\n          },\n        );\n      }\n\n      return result;\n    } catch (error) {\n      this.logger.error('Moderation service error:', error);\n\n      // Fallback to safe classification if service is unavailable\n      return this.createSafeResult(text, {\n        flags: ['service_unavailable'],\n        processingTime: Date.now() - Date.now(),\n      });\n    }\n  }\n\n  /**\n   * Check if content requires crisis intervention\n   */\n  async checkCrisisContent(\n    text: string,\n    context: ModerationContext,\n  ): Promise<boolean> {\n    const result = await this.classifyContent(text, context);\n    return (\n      result.crisisLevel === 'critical' || (result.immediateEscalation ?? false)\n    );\n  }\n\n  /**\n   * Batch classification for multiple content items\n   */\n  async batchClassify(\n    items: Array<{ text: string; context: ModerationContext }>,\n  ): Promise<ModerationResult[]> {\n    if (!this.enabled) {\n      return items.map((item) => this.createSafeResult(item.text));\n    }\n\n    try {\n      const startTime = Date.now();\n\n      const response = await firstValueFrom(\n        this.httpService.post(\n          `${this.moderationApiUrl}/api/v1/classify/batch`,\n          {\n            items: items.map((item) => ({\n              text: item.text,\n              context: item.context.context,\n              user_id: item.context.userId,\n              user_role: item.context.userRole,\n              conversation_id: item.context.conversationId,\n              community_id: item.context.communityId,\n              timestamp: item.context.timestamp?.toISOString(),\n            })),\n          },\n          {\n            timeout: this.timeout * 2, // Longer timeout for batch processing\n            headers: {\n              'Content-Type': 'application/json',\n            },\n          },\n        ),\n      );\n\n      const processingTime = Date.now() - startTime;\n      return response.data.map((result: any) => ({\n        ...result,\n        processingTime: processingTime / items.length, // Average per item\n      }));\n    } catch (error) {\n      this.logger.error('Batch moderation service error:', error);\n      return items.map((item) => this.createSafeResult(item.text));\n    }\n  }\n\n  /**\n   * Health check for the moderation service\n   */\n  async healthCheck(): Promise<{\n    status: 'healthy' | 'unhealthy' | 'disabled';\n    responseTime?: number;\n    error?: string;\n  }> {\n    if (!this.enabled) {\n      return { status: 'disabled' };\n    }\n\n    try {\n      const startTime = Date.now();\n\n      await firstValueFrom(\n        this.httpService.get(`${this.moderationApiUrl}/health`, {\n          timeout: this.timeout,\n        }),\n      );\n\n      const responseTime = Date.now() - startTime;\n      return { status: 'healthy', responseTime };\n    } catch (error) {\n      this.logger.error('Moderation service health check failed:', error);\n      return {\n        status: 'unhealthy',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      };\n    }\n  }\n\n  /**\n   * Get moderation service statistics\n   */\n  async getStats(): Promise<{\n    requestCount: number;\n    averageResponseTime: number;\n    errorRate: number;\n    crisisDetections: number;\n  }> {\n    if (!this.enabled) {\n      return {\n        requestCount: 0,\n        averageResponseTime: 0,\n        errorRate: 0,\n        crisisDetections: 0,\n      };\n    }\n\n    try {\n      const response = await firstValueFrom(\n        this.httpService.get(`${this.moderationApiUrl}/api/v1/stats`, {\n          timeout: this.timeout,\n        }),\n      );\n\n      return response.data;\n    } catch (error) {\n      this.logger.error('Failed to get moderation stats:', error);\n      return {\n        requestCount: 0,\n        averageResponseTime: 0,\n        errorRate: 100,\n        crisisDetections: 0,\n      };\n    }\n  }\n\n  /**\n   * Create a safe result for fallback scenarios\n   */\n  private createSafeResult(\n    text: string,\n    overrides?: Partial<ModerationResult>,\n  ): ModerationResult {\n    return {\n      classification: 'safe',\n      confidence: 0.5,\n      mentalHealthContext: false,\n      flags: [],\n      processingTime: 0,\n      ...overrides,\n    };\n  }\n\n  /**\n   * Create moderation context for posts\n   */\n  createPostContext(\n    userId: string,\n    userRole: string,\n    communityId?: string,\n  ): ModerationContext {\n    return {\n      context: 'post',\n      userId,\n      userRole,\n      communityId,\n      timestamp: new Date(),\n    };\n  }\n\n  /**\n   * Create moderation context for comments\n   */\n  createCommentContext(\n    userId: string,\n    userRole: string,\n    communityId?: string,\n  ): ModerationContext {\n    return {\n      context: 'comment',\n      userId,\n      userRole,\n      communityId,\n      timestamp: new Date(),\n    };\n  }\n\n  /**\n   * Create moderation context for messages\n   */\n  createMessageContext(\n    userId: string,\n    userRole: string,\n    conversationId: string,\n  ): ModerationContext {\n    return {\n      context: 'message',\n      userId,\n      userRole,\n      conversationId,\n      timestamp: new Date(),\n    };\n  }\n\n  /**\n   * Create moderation context for therapy sessions\n   */\n  createTherapyContext(\n    userId: string,\n    userRole: string,\n    sessionId: string,\n  ): ModerationContext {\n    return {\n      context: 'therapy',\n      userId,\n      userRole,\n      conversationId: sessionId,\n      timestamp: new Date(),\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}