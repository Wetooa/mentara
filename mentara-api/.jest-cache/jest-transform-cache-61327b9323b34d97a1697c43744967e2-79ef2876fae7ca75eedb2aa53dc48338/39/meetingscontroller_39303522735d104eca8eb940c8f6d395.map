{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/meetings/meetings.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/meetings/meetings.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Param,\n  Body,\n  UseGuards,\n  Query,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { MeetingsService } from './meetings.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\n// TODO: Add validation schemas when needed\nimport type {\n  CreateVideoRoomDto,\n  JoinVideoRoomDto,\n  EndVideoCallDto,\n  VideoRoomResponse,\n  VideoCallStatus,\n  UpdateMeetingStatusDto,\n  SaveMeetingSessionDto,\n} from './types';\n\n@Controller('meetings')\n@UseGuards(JwtAuthGuard)\nexport class MeetingsController {\n  constructor(private readonly meetingsService: MeetingsService) {}\n\n  @Get(':id')\n  async getMeeting(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n  ) {\n    return this.meetingsService.getMeetingById(meetingId, userId);\n  }\n\n  @Put(':id/status')\n  @HttpCode(HttpStatus.OK)\n  async updateMeetingStatus(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n    @Body(/* validation disabled */)\n    updateStatusDto: UpdateMeetingStatusDto,\n  ) {\n    return this.meetingsService.updateMeetingStatus(\n      meetingId,\n      userId,\n      updateStatusDto,\n    );\n  }\n\n  // ===== VIDEO CALL INTEGRATION ENDPOINTS =====\n\n  @Post(':id/video-room')\n  @HttpCode(HttpStatus.CREATED)\n  async createVideoRoom(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n    @Body(/* validation disabled */)\n    createRoomDto: CreateVideoRoomDto,\n  ): Promise<VideoRoomResponse> {\n    return this.meetingsService.createVideoRoom(\n      meetingId,\n      userId,\n      createRoomDto,\n    );\n  }\n\n  @Post(':id/join-video')\n  @HttpCode(HttpStatus.OK)\n  async joinVideoRoom(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n    @Body(/* validation disabled */)\n    joinRoomDto: JoinVideoRoomDto,\n  ): Promise<VideoRoomResponse> {\n    return this.meetingsService.joinVideoRoom(meetingId, userId, joinRoomDto);\n  }\n\n  @Get(':id/video-status')\n  @HttpCode(HttpStatus.OK)\n  async getVideoCallStatus(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n  ): Promise<VideoCallStatus> {\n    return this.meetingsService.getVideoCallStatus(meetingId, userId);\n  }\n\n  @Delete(':id/video-room')\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async endVideoCall(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n    @Body(/* validation disabled */)\n    endCallDto: EndVideoCallDto,\n  ): Promise<void> {\n    return this.meetingsService.endVideoCall(meetingId, userId, endCallDto);\n  }\n\n  // Legacy endpoint for backward compatibility\n  @Post(':id/room')\n  async generateMeetingRoom(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n  ) {\n    // Redirect to new video room creation with default settings\n    const defaultCreateDto: CreateVideoRoomDto = {\n      meetingId,\n      roomType: 'consultation',\n      maxParticipants: 2,\n      enableRecording: false,\n      enableChat: true,\n    };\n    return this.meetingsService.createVideoRoom(\n      meetingId,\n      userId,\n      defaultCreateDto,\n    );\n  }\n\n  @Get('upcoming')\n  async getUpcomingMeetings(\n    @CurrentUserId() userId: string,\n    @Query('limit') limit?: number,\n  ) {\n    return this.meetingsService.getUpcomingMeetings(userId, limit);\n  }\n\n  @Get('completed')\n  async getCompletedMeetings(\n    @CurrentUserId() userId: string,\n    @Query('limit') limit?: number,\n  ) {\n    return this.meetingsService.getCompletedMeetings(userId, limit);\n  }\n\n  @Get('cancelled')\n  async getCancelledMeetings(\n    @CurrentUserId() userId: string,\n    @Query('limit') limit?: number,\n  ) {\n    return this.meetingsService.getCancelledMeetings(userId, limit);\n  }\n\n  @Get('in-progress')\n  async getInProgressMeetings(\n    @CurrentUserId() userId: string,\n    @Query('limit') limit?: number,\n  ) {\n    return this.meetingsService.getInProgressMeetings(userId, limit);\n  }\n\n  @Get()\n  async getAllMeetings(\n    @CurrentUserId() userId: string,\n    @Query('status') status?: string,\n    @Query('type') type?: string,\n    @Query('limit') limit?: number,\n    @Query('offset') offset?: number,\n    @Query('dateFrom') dateFrom?: string,\n    @Query('dateTo') dateTo?: string,\n  ) {\n    const queryOptions = {\n      status,\n      type,\n      limit: limit ? Number(limit) : undefined,\n      offset: offset ? Number(offset) : undefined,\n      dateFrom,\n      dateTo,\n    };\n    return this.meetingsService.getAllMeetings(userId, queryOptions);\n  }\n\n  @Post(':id/session')\n  @HttpCode(HttpStatus.CREATED)\n  async saveMeetingSession(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n    @Body(/* validation disabled */)\n    sessionData: SaveMeetingSessionDto,\n  ) {\n    // Validate user has access to this meeting\n    await this.meetingsService.getMeetingById(meetingId, userId);\n\n    return this.meetingsService.saveMeetingSession(\n      meetingId,\n      userId,\n      sessionData,\n    );\n  }\n\n  @Get('analytics/therapist')\n  async getTherapistMeetingAnalytics(\n    @CurrentUserId() userId: string,\n    @Query('startDate') startDate?: string,\n    @Query('endDate') endDate?: string,\n  ) {\n    const dateRange =\n      startDate && endDate\n        ? {\n            start: new Date(startDate),\n            end: new Date(endDate),\n          }\n        : undefined;\n\n    return this.meetingsService.getMeetingAnalytics(userId, dateRange);\n  }\n\n  @Post(':id/emergency-terminate')\n  async emergencyTerminate(\n    @Param('id') meetingId: string,\n    @CurrentUserId() userId: string,\n    @Body() body: { reason: string },\n  ) {\n    return this.meetingsService.emergencyTerminateMeeting(\n      meetingId,\n      body.reason,\n      userId,\n    );\n  }\n}\n"],"version":3}