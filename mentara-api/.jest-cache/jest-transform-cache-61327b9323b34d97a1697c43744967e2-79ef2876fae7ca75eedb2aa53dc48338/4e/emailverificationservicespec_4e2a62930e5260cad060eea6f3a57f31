a30e027006486222ff54e03ffd750fde
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('crypto');
const testing_1 = require("@nestjs/testing");
const email_verification_service_1 = require("./email-verification.service");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const email_service_1 = require("../../services/email.service");
const token_service_1 = require("./token.service");
const common_1 = require("@nestjs/common");
const crypto = require("crypto");
describe('EmailVerificationService', () => {
    let service;
    let prismaService;
    let emailService;
    let tokenService;
    const mockUser = {
        id: 'user-123',
        email: 'test@example.com',
        firstName: 'John',
        emailVerified: false,
        emailVerifyToken: null,
        emailVerifyTokenExp: null,
    };
    const mockVerifiedUser = {
        id: 'user-123',
        email: 'test@example.com',
        firstName: 'John',
        emailVerified: true,
        emailVerifyToken: 'hashed-token',
        emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),
    };
    const mockUserWithToken = {
        id: 'user-123',
        email: 'test@example.com',
        firstName: 'John',
        emailVerified: false,
        emailVerifyToken: 'hashed-token',
        emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),
    };
    const mockTokenData = {
        token: 'raw-token',
        hashedToken: 'hashed-token',
        expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                email_verification_service_1.EmailVerificationService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: {
                        user: {
                            findUnique: jest.fn(),
                            update: jest.fn(),
                            updateMany: jest.fn(),
                        },
                    },
                },
                {
                    provide: email_service_1.EmailService,
                    useValue: {
                        sendGenericEmail: jest.fn(),
                    },
                },
                {
                    provide: token_service_1.TokenService,
                    useValue: {
                        generateEmailVerificationToken: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(email_verification_service_1.EmailVerificationService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
        emailService = module.get(email_service_1.EmailService);
        tokenService = module.get(token_service_1.TokenService);
        // Setup crypto mock
        crypto.createHash.mockImplementation(() => ({
            update: jest.fn().mockReturnThis(),
            digest: jest.fn().mockReturnValue('hashed-token'),
        }));
        // Setup environment variables
        process.env.FRONTEND_URL = 'https://mentara.com';
        process.env.SUPPORT_EMAIL = 'support@mentara.com';
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('sendVerificationEmail', () => {
        it('should send verification email for user without existing token', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);
            prismaService.user.update.mockResolvedValue(mockUser);
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.sendVerificationEmail('user-123');
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: { id: 'user-123' },
                select: {
                    id: true,
                    email: true,
                    firstName: true,
                    emailVerified: true,
                    emailVerifyToken: true,
                    emailVerifyTokenExp: true,
                },
            });
            expect(tokenService.generateEmailVerificationToken).toHaveBeenCalled();
            expect(prismaService.user.update).toHaveBeenCalledWith({
                where: { id: 'user-123' },
                data: {
                    emailVerifyToken: mockTokenData.hashedToken,
                    emailVerifyTokenExp: mockTokenData.expiresAt,
                },
            });
            expect(emailService.sendGenericEmail).toHaveBeenCalledWith({
                to: mockUser.email,
                subject: 'Verify Your Mentara Account',
                template: 'email-verification',
                data: {
                    firstName: mockUser.firstName,
                    verificationUrl: `https://mentara.com/verify-email?token=${mockTokenData.token}`,
                    supportEmail: 'support@mentara.com',
                },
            });
        });
        it('should resend existing valid token without generating new one', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUserWithToken);
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.sendVerificationEmail('user-123');
            expect(tokenService.generateEmailVerificationToken).not.toHaveBeenCalled();
            expect(prismaService.user.update).not.toHaveBeenCalled();
            expect(emailService.sendGenericEmail).toHaveBeenCalledWith({
                to: mockUserWithToken.email,
                subject: 'Verify Your Mentara Account',
                template: 'email-verification',
                data: {
                    firstName: mockUserWithToken.firstName,
                    verificationUrl: `https://mentara.com/verify-email?token=${mockUserWithToken.emailVerifyToken}`,
                    supportEmail: 'support@mentara.com',
                },
            });
        });
        it('should throw NotFoundException for non-existent user', async () => {
            prismaService.user.findUnique.mockResolvedValue(null);
            await expect(service.sendVerificationEmail('non-existent')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw BadRequestException for already verified email', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockVerifiedUser);
            await expect(service.sendVerificationEmail('user-123')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should generate new token when existing token is expired', async () => {
            const userWithExpiredToken = {
                ...mockUserWithToken,
                emailVerifyTokenExp: new Date(Date.now() - 1000),
            };
            prismaService.user.findUnique.mockResolvedValue(userWithExpiredToken);
            tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);
            prismaService.user.update.mockResolvedValue(mockUser);
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.sendVerificationEmail('user-123');
            expect(tokenService.generateEmailVerificationToken).toHaveBeenCalled();
            expect(prismaService.user.update).toHaveBeenCalledWith({
                where: { id: 'user-123' },
                data: {
                    emailVerifyToken: mockTokenData.hashedToken,
                    emailVerifyTokenExp: mockTokenData.expiresAt,
                },
            });
        });
        it('should handle email service failure', async () => {
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);
            prismaService.user.update.mockResolvedValue(mockUser);
            emailService.sendGenericEmail.mockRejectedValue(new Error('Email service error'));
            await expect(service.sendVerificationEmail('user-123')).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('verifyEmail', () => {
        it('should verify email successfully', async () => {
            const token = 'raw-token';
            const userToVerify = {
                id: 'user-123',
                email: 'test@example.com',
                emailVerified: false,
                emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),
            };
            prismaService.user.findUnique.mockResolvedValue(userToVerify);
            prismaService.user.update.mockResolvedValue({
                ...userToVerify,
                emailVerified: true,
            });
            const result = await service.verifyEmail(token);
            expect(result).toEqual({
                success: true,
                message: 'Email verified successfully',
            });
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: { emailVerifyToken: 'hashed-token' },
                select: {
                    id: true,
                    email: true,
                    emailVerified: true,
                    emailVerifyTokenExp: true,
                },
            });
            expect(prismaService.user.update).toHaveBeenCalledWith({
                where: { id: 'user-123' },
                data: {
                    emailVerified: true,
                    emailVerifyToken: null,
                    emailVerifyTokenExp: null,
                    isVerified: true,
                },
            });
        });
        it('should throw BadRequestException for missing token', async () => {
            await expect(service.verifyEmail('')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should throw BadRequestException for invalid token', async () => {
            const token = 'invalid-token';
            prismaService.user.findUnique.mockResolvedValue(null);
            await expect(service.verifyEmail(token)).rejects.toThrow(common_1.BadRequestException);
        });
        it('should return success message for already verified email', async () => {
            const token = 'raw-token';
            const alreadyVerifiedUser = {
                id: 'user-123',
                email: 'test@example.com',
                emailVerified: true,
                emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),
            };
            prismaService.user.findUnique.mockResolvedValue(alreadyVerifiedUser);
            const result = await service.verifyEmail(token);
            expect(result).toEqual({
                success: true,
                message: 'Email already verified',
            });
            expect(prismaService.user.update).not.toHaveBeenCalled();
        });
        it('should handle expired token by cleaning up and throwing error', async () => {
            const token = 'expired-token';
            const userWithExpiredToken = {
                id: 'user-123',
                email: 'test@example.com',
                emailVerified: false,
                emailVerifyTokenExp: new Date(Date.now() - 1000),
            };
            prismaService.user.findUnique.mockResolvedValue(userWithExpiredToken);
            prismaService.user.update.mockResolvedValue(userWithExpiredToken);
            await expect(service.verifyEmail(token)).rejects.toThrow(common_1.BadRequestException);
            expect(prismaService.user.update).toHaveBeenCalledWith({
                where: { id: 'user-123' },
                data: {
                    emailVerifyToken: null,
                    emailVerifyTokenExp: null,
                },
            });
        });
        it('should handle token without expiration date', async () => {
            const token = 'token-without-exp';
            const userWithoutExpiration = {
                id: 'user-123',
                email: 'test@example.com',
                emailVerified: false,
                emailVerifyTokenExp: null,
            };
            prismaService.user.findUnique.mockResolvedValue(userWithoutExpiration);
            prismaService.user.update.mockResolvedValue(userWithoutExpiration);
            await expect(service.verifyEmail(token)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('resendVerificationEmail', () => {
        it('should resend verification email for existing unverified user', async () => {
            const email = 'test@example.com';
            const unverifiedUser = {
                id: 'user-123',
                email: 'test@example.com',
                firstName: 'John',
                emailVerified: false,
            };
            prismaService.user.findUnique.mockResolvedValue(unverifiedUser);
            // Mock the sendVerificationEmail method by setting up the full chain
            prismaService.user.findUnique
                .mockResolvedValueOnce(unverifiedUser)
                .mockResolvedValueOnce(mockUser);
            tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);
            prismaService.user.update.mockResolvedValue(mockUser);
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.resendVerificationEmail(email);
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: { email },
                select: {
                    id: true,
                    email: true,
                    firstName: true,
                    emailVerified: true,
                },
            });
        });
        it('should silently return for non-existent user (security)', async () => {
            const email = 'nonexistent@example.com';
            prismaService.user.findUnique.mockResolvedValue(null);
            await expect(service.resendVerificationEmail(email)).resolves.not.toThrow();
        });
        it('should throw BadRequestException for already verified email', async () => {
            const email = 'verified@example.com';
            const verifiedUser = {
                id: 'user-123',
                email: 'verified@example.com',
                firstName: 'John',
                emailVerified: true,
            };
            prismaService.user.findUnique.mockResolvedValue(verifiedUser);
            await expect(service.resendVerificationEmail(email)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('cleanupExpiredTokens', () => {
        it('should clean up expired verification tokens', async () => {
            prismaService.user.updateMany.mockResolvedValue({ count: 5 });
            await service.cleanupExpiredTokens();
            expect(prismaService.user.updateMany).toHaveBeenCalledWith({
                where: {
                    emailVerifyTokenExp: {
                        lt: expect.any(Date),
                    },
                },
                data: {
                    emailVerifyToken: null,
                    emailVerifyTokenExp: null,
                },
            });
        });
    });
    describe('sendVerificationEmailWithToken (private method)', () => {
        it('should send verification email with correct template data', async () => {
            const email = 'test@example.com';
            const firstName = 'John';
            const token = 'verification-token';
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.sendVerificationEmailWithToken(email, firstName, token);
            expect(emailService.sendGenericEmail).toHaveBeenCalledWith({
                to: email,
                subject: 'Verify Your Mentara Account',
                template: 'email-verification',
                data: {
                    firstName,
                    verificationUrl: `https://mentara.com/verify-email?token=${token}`,
                    supportEmail: 'support@mentara.com',
                },
            });
        });
        it('should use default support email when env variable not set', async () => {
            delete process.env.SUPPORT_EMAIL;
            const email = 'test@example.com';
            const firstName = 'John';
            const token = 'verification-token';
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.sendVerificationEmailWithToken(email, firstName, token);
            expect(emailService.sendGenericEmail).toHaveBeenCalledWith({
                to: email,
                subject: 'Verify Your Mentara Account',
                template: 'email-verification',
                data: {
                    firstName,
                    verificationUrl: `https://mentara.com/verify-email?token=${token}`,
                    supportEmail: 'support@mentara.com',
                },
            });
        });
        it('should handle email service failure and throw BadRequestException', async () => {
            const email = 'test@example.com';
            const firstName = 'John';
            const token = 'verification-token';
            emailService.sendGenericEmail.mockRejectedValue(new Error('Email service error'));
            await expect(service.sendVerificationEmailWithToken(email, firstName, token)).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('crypto hash integration', () => {
        it('should use crypto.createHash for token verification', async () => {
            const token = 'test-token';
            const mockHash = {
                update: jest.fn().mockReturnThis(),
                digest: jest.fn().mockReturnValue('hashed-token'),
            };
            crypto.createHash.mockReturnValue(mockHash);
            prismaService.user.findUnique.mockResolvedValue(null);
            await expect(service.verifyEmail(token)).rejects.toThrow(common_1.BadRequestException);
            expect(crypto.createHash).toHaveBeenCalledWith('sha256');
            expect(mockHash.update).toHaveBeenCalledWith(token);
            expect(mockHash.digest).toHaveBeenCalledWith('hex');
        });
    });
    describe('environment variable handling', () => {
        it('should handle missing FRONTEND_URL', async () => {
            delete process.env.FRONTEND_URL;
            const email = 'test@example.com';
            const firstName = 'John';
            const token = 'verification-token';
            emailService.sendGenericEmail.mockResolvedValue(undefined);
            await service.sendVerificationEmailWithToken(email, firstName, token);
            expect(emailService.sendGenericEmail).toHaveBeenCalledWith({
                to: email,
                subject: 'Verify Your Mentara Account',
                template: 'email-verification',
                data: {
                    firstName,
                    verificationUrl: `undefined/verify-email?token=${token}`,
                    supportEmail: 'support@mentara.com',
                },
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvc2VydmljZXMvZW1haWwtdmVyaWZpY2F0aW9uLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQVdBLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFYcEIsNkNBQXNEO0FBQ3RELDZFQUF3RTtBQUN4RSxtRkFBdUU7QUFDdkUsZ0VBQTREO0FBQzVELG1EQUErQztBQUMvQywyQ0FHd0I7QUFDeEIsaUNBQWlDO0FBSWpDLFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7SUFDeEMsSUFBSSxPQUFpQyxDQUFDO0lBQ3RDLElBQUksYUFBeUMsQ0FBQztJQUM5QyxJQUFJLFlBQXVDLENBQUM7SUFDNUMsSUFBSSxZQUF1QyxDQUFDO0lBRTVDLE1BQU0sUUFBUSxHQUFHO1FBQ2YsRUFBRSxFQUFFLFVBQVU7UUFDZCxLQUFLLEVBQUUsa0JBQWtCO1FBQ3pCLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGdCQUFnQixFQUFFLElBQUk7UUFDdEIsbUJBQW1CLEVBQUUsSUFBSTtLQUMxQixDQUFDO0lBRUYsTUFBTSxnQkFBZ0IsR0FBRztRQUN2QixFQUFFLEVBQUUsVUFBVTtRQUNkLEtBQUssRUFBRSxrQkFBa0I7UUFDekIsU0FBUyxFQUFFLE1BQU07UUFDakIsYUFBYSxFQUFFLElBQUk7UUFDbkIsZ0JBQWdCLEVBQUUsY0FBYztRQUNoQyxtQkFBbUIsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO0tBQ2hFLENBQUM7SUFFRixNQUFNLGlCQUFpQixHQUFHO1FBQ3hCLEVBQUUsRUFBRSxVQUFVO1FBQ2QsS0FBSyxFQUFFLGtCQUFrQjtRQUN6QixTQUFTLEVBQUUsTUFBTTtRQUNqQixhQUFhLEVBQUUsS0FBSztR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QUFJLEVBQUU7WUFDbEQsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztZQUNoQyxNQUFNLEtBQUssR0FBRyxrQkFBa0IsQ0FBQztZQUNqQyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUM7WUFDekIsTUFBTSxLQUFLLEdBQUcsb0JBQW9CLENBQUM7WUFFbkMsWUFBWSxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTNELE1BQU8sT0FBZSxDQUFDLDhCQUE4QixDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFL0UsTUFBTSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUN6RCxFQUFFLEVBQUUsS0FBSztnQkFDVCxPQUFPLEVBQUUsNkJBQTZCO2dCQUN0QyxRQUFRLEVBQUUsb0JBQW9CO2dCQUM5QixJQUFJLEVBQUU7b0JBQ0osU0FBUztvQkFDVCxlQUFlLEVBQUUsZ0NBQWdDLEtBQUssRUFBRTtvQkFDeEQsWUFBWSxFQUFFLHFCQUFxQjtpQkFDcEM7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2F1dGgvc2VydmljZXMvZW1haWwtdmVyaWZpY2F0aW9uLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEVtYWlsVmVyaWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4vZW1haWwtdmVyaWZpY2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IEVtYWlsU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2VtYWlsLnNlcnZpY2UnO1xuaW1wb3J0IHsgVG9rZW5TZXJ2aWNlIH0gZnJvbSAnLi90b2tlbi5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgKiBhcyBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuamVzdC5tb2NrKCdjcnlwdG8nKTtcblxuZGVzY3JpYmUoJ0VtYWlsVmVyaWZpY2F0aW9uU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IEVtYWlsVmVyaWZpY2F0aW9uU2VydmljZTtcbiAgbGV0IHByaXNtYVNlcnZpY2U6IGplc3QuTW9ja2VkPFByaXNtYVNlcnZpY2U+O1xuICBsZXQgZW1haWxTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxFbWFpbFNlcnZpY2U+O1xuICBsZXQgdG9rZW5TZXJ2aWNlOiBqZXN0Lk1vY2tlZDxUb2tlblNlcnZpY2U+O1xuXG4gIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgIGlkOiAndXNlci0xMjMnLFxuICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgZmlyc3ROYW1lOiAnSm9obicsXG4gICAgZW1haWxWZXJpZmllZDogZmFsc2UsXG4gICAgZW1haWxWZXJpZnlUb2tlbjogbnVsbCxcbiAgICBlbWFpbFZlcmlmeVRva2VuRXhwOiBudWxsLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tWZXJpZmllZFVzZXIgPSB7XG4gICAgaWQ6ICd1c2VyLTEyMycsXG4gICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgIGVtYWlsVmVyaWZ5VG9rZW46ICdoYXNoZWQtdG9rZW4nLFxuICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgfTtcblxuICBjb25zdCBtb2NrVXNlcldpdGhUb2tlbiA9IHtcbiAgICBpZDogJ3VzZXItMTIzJyxcbiAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlLFxuICAgIGVtYWlsVmVyaWZ5VG9rZW46ICdoYXNoZWQtdG9rZW4nLFxuICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgfTtcblxuICBjb25zdCBtb2NrVG9rZW5EYXRhID0ge1xuICAgIHRva2VuOiAncmF3LXRva2VuJyxcbiAgICBoYXNoZWRUb2tlbjogJ2hhc2hlZC10b2tlbicsXG4gICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBFbWFpbFZlcmlmaWNhdGlvblNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICAgIHVwZGF0ZU1hbnk6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEVtYWlsU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZToge1xuICAgICAgICAgICAgc2VuZEdlbmVyaWNFbWFpbDogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBUb2tlblNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdlbmVyYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbjogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PEVtYWlsVmVyaWZpY2F0aW9uU2VydmljZT4oRW1haWxWZXJpZmljYXRpb25TZXJ2aWNlKTtcbiAgICBwcmlzbWFTZXJ2aWNlID0gbW9kdWxlLmdldChQcmlzbWFTZXJ2aWNlKTtcbiAgICBlbWFpbFNlcnZpY2UgPSBtb2R1bGUuZ2V0KEVtYWlsU2VydmljZSk7XG4gICAgdG9rZW5TZXJ2aWNlID0gbW9kdWxlLmdldChUb2tlblNlcnZpY2UpO1xuXG4gICAgLy8gU2V0dXAgY3J5cHRvIG1vY2tcbiAgICAoY3J5cHRvLmNyZWF0ZUhhc2ggYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBkaWdlc3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ2hhc2hlZC10b2tlbicpLFxuICAgIH0pKTtcblxuICAgIC8vIFNldHVwIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgIHByb2Nlc3MuZW52LkZST05URU5EX1VSTCA9ICdodHRwczovL21lbnRhcmEuY29tJztcbiAgICBwcm9jZXNzLmVudi5TVVBQT1JUX0VNQUlMID0gJ3N1cHBvcnRAbWVudGFyYS5jb20nO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZW5kVmVyaWZpY2F0aW9uRW1haWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZW5kIHZlcmlmaWNhdGlvbiBlbWFpbCBmb3IgdXNlciB3aXRob3V0IGV4aXN0aW5nIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgdG9rZW5TZXJ2aWNlLmdlbmVyYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVG9rZW5EYXRhKTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgZW1haWxTZXJ2aWNlLnNlbmRHZW5lcmljRW1haWwubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zZW5kVmVyaWZpY2F0aW9uRW1haWwoJ3VzZXItMTIzJyk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICBlbWFpbFZlcmlmeVRva2VuOiB0cnVlLFxuICAgICAgICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHRva2VuU2VydmljZS5nZW5lcmF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBlbWFpbFZlcmlmeVRva2VuOiBtb2NrVG9rZW5EYXRhLmhhc2hlZFRva2VuLFxuICAgICAgICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IG1vY2tUb2tlbkRhdGEuZXhwaXJlc0F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0bzogbW9ja1VzZXIuZW1haWwsXG4gICAgICAgIHN1YmplY3Q6ICdWZXJpZnkgWW91ciBNZW50YXJhIEFjY291bnQnLFxuICAgICAgICB0ZW1wbGF0ZTogJ2VtYWlsLXZlcmlmaWNhdGlvbicsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBmaXJzdE5hbWU6IG1vY2tVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICB2ZXJpZmljYXRpb25Vcmw6IGBodHRwczovL21lbnRhcmEuY29tL3ZlcmlmeS1lbWFpbD90b2tlbj0ke21vY2tUb2tlbkRhdGEudG9rZW59YCxcbiAgICAgICAgICBzdXBwb3J0RW1haWw6ICdzdXBwb3J0QG1lbnRhcmEuY29tJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNlbmQgZXhpc3RpbmcgdmFsaWQgdG9rZW4gd2l0aG91dCBnZW5lcmF0aW5nIG5ldyBvbmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcldpdGhUb2tlbik7XG4gICAgICBlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNlbmRWZXJpZmljYXRpb25FbWFpbCgndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHRva2VuU2VydmljZS5nZW5lcmF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLnVwZGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0bzogbW9ja1VzZXJXaXRoVG9rZW4uZW1haWwsXG4gICAgICAgIHN1YmplY3Q6ICdWZXJpZnkgWW91ciBNZW50YXJhIEFjY291bnQnLFxuICAgICAgICB0ZW1wbGF0ZTogJ2VtYWlsLXZlcmlmaWNhdGlvbicsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBmaXJzdE5hbWU6IG1vY2tVc2VyV2l0aFRva2VuLmZpcnN0TmFtZSxcbiAgICAgICAgICB2ZXJpZmljYXRpb25Vcmw6IGBodHRwczovL21lbnRhcmEuY29tL3ZlcmlmeS1lbWFpbD90b2tlbj0ke21vY2tVc2VyV2l0aFRva2VuLmVtYWlsVmVyaWZ5VG9rZW59YCxcbiAgICAgICAgICBzdXBwb3J0RW1haWw6ICdzdXBwb3J0QG1lbnRhcmEuY29tJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiBmb3Igbm9uLWV4aXN0ZW50IHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkVtYWlsKCdub24tZXhpc3RlbnQnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gZm9yIGFscmVhZHkgdmVyaWZpZWQgZW1haWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVmVyaWZpZWRVc2VyKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkVtYWlsKCd1c2VyLTEyMycpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBuZXcgdG9rZW4gd2hlbiBleGlzdGluZyB0b2tlbiBpcyBleHBpcmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcldpdGhFeHBpcmVkVG9rZW4gPSB7XG4gICAgICAgIC4uLm1vY2tVc2VyV2l0aFRva2VuLFxuICAgICAgICBlbWFpbFZlcmlmeVRva2VuRXhwOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMTAwMCksXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2VyV2l0aEV4cGlyZWRUb2tlbik7XG4gICAgICB0b2tlblNlcnZpY2UuZ2VuZXJhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUb2tlbkRhdGEpO1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICBlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNlbmRWZXJpZmljYXRpb25FbWFpbCgndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHRva2VuU2VydmljZS5nZW5lcmF0ZUVtYWlsVmVyaWZpY2F0aW9uVG9rZW4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBlbWFpbFZlcmlmeVRva2VuOiBtb2NrVG9rZW5EYXRhLmhhc2hlZFRva2VuLFxuICAgICAgICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IG1vY2tUb2tlbkRhdGEuZXhwaXJlc0F0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbWFpbCBzZXJ2aWNlIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICB0b2tlblNlcnZpY2UuZ2VuZXJhdGVFbWFpbFZlcmlmaWNhdGlvblRva2VuLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUb2tlbkRhdGEpO1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICBlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0VtYWlsIHNlcnZpY2UgZXJyb3InKSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnNlbmRWZXJpZmljYXRpb25FbWFpbCgndXNlci0xMjMnKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcmlmeUVtYWlsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmVyaWZ5IGVtYWlsIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3Jhdy10b2tlbic7XG4gICAgICBjb25zdCB1c2VyVG9WZXJpZnkgPSB7XG4gICAgICAgIGlkOiAndXNlci0xMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiBmYWxzZSxcbiAgICAgICAgZW1haWxWZXJpZnlUb2tlbkV4cDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUodXNlclRvVmVyaWZ5KTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi51c2VyVG9WZXJpZnksXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZnlFbWFpbCh0b2tlbik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnRW1haWwgdmVyaWZpZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgZW1haWxWZXJpZnlUb2tlbjogJ2hhc2hlZC10b2tlbicgfSxcbiAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICBlbWFpbFZlcmlmeVRva2VuRXhwOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXNlci0xMjMnIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIGVtYWlsVmVyaWZ5VG9rZW46IG51bGwsXG4gICAgICAgICAgZW1haWxWZXJpZnlUb2tlbkV4cDogbnVsbCxcbiAgICAgICAgICBpc1ZlcmlmaWVkOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gZm9yIG1pc3NpbmcgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS52ZXJpZnlFbWFpbCgnJykpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiBmb3IgaW52YWxpZCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ2ludmFsaWQtdG9rZW4nO1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnZlcmlmeUVtYWlsKHRva2VuKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc3VjY2VzcyBtZXNzYWdlIGZvciBhbHJlYWR5IHZlcmlmaWVkIGVtYWlsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdG9rZW4gPSAncmF3LXRva2VuJztcbiAgICAgIGNvbnN0IGFscmVhZHlWZXJpZmllZFVzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlci0xMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgICBlbWFpbFZlcmlmeVRva2VuRXhwOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShhbHJlYWR5VmVyaWZpZWRVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZnlFbWFpbCh0b2tlbik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnRW1haWwgYWxyZWFkeSB2ZXJpZmllZCcsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UudXNlci51cGRhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBleHBpcmVkIHRva2VuIGJ5IGNsZWFuaW5nIHVwIGFuZCB0aHJvd2luZyBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ2V4cGlyZWQtdG9rZW4nO1xuICAgICAgY29uc3QgdXNlcldpdGhFeHBpcmVkVG9rZW4gPSB7XG4gICAgICAgIGlkOiAndXNlci0xMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiBmYWxzZSxcbiAgICAgICAgZW1haWxWZXJpZnlUb2tlbkV4cDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDEwMDApLFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUodXNlcldpdGhFeHBpcmVkVG9rZW4pO1xuICAgICAgcHJpc21hU2VydmljZS51c2VyLnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2VyV2l0aEV4cGlyZWRUb2tlbik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnZlcmlmeUVtYWlsKHRva2VuKSkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuXG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS51c2VyLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ3VzZXItMTIzJyB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZW1haWxWZXJpZnlUb2tlbjogbnVsbCxcbiAgICAgICAgICBlbWFpbFZlcmlmeVRva2VuRXhwOiBudWxsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0b2tlbiB3aXRob3V0IGV4cGlyYXRpb24gZGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3Rva2VuLXdpdGhvdXQtZXhwJztcbiAgICAgIGNvbnN0IHVzZXJXaXRob3V0RXhwaXJhdGlvbiA9IHtcbiAgICAgICAgaWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIGVtYWlsVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICBlbWFpbFZlcmlmeVRva2VuRXhwOiBudWxsLFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUodXNlcldpdGhvdXRFeHBpcmF0aW9uKTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUodXNlcldpdGhvdXRFeHBpcmF0aW9uKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudmVyaWZ5RW1haWwodG9rZW4pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZXNlbmRWZXJpZmljYXRpb25FbWFpbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc2VuZCB2ZXJpZmljYXRpb24gZW1haWwgZm9yIGV4aXN0aW5nIHVudmVyaWZpZWQgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ3Rlc3RAZXhhbXBsZS5jb20nO1xuICAgICAgY29uc3QgdW52ZXJpZmllZFVzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlci0xMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgZW1haWxWZXJpZmllZDogZmFsc2UsXG4gICAgICB9O1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bnZlcmlmaWVkVXNlcik7XG4gICAgICAvLyBNb2NrIHRoZSBzZW5kVmVyaWZpY2F0aW9uRW1haWwgbWV0aG9kIGJ5IHNldHRpbmcgdXAgdGhlIGZ1bGwgY2hhaW5cbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UodW52ZXJpZmllZFVzZXIpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1VzZXIpO1xuICAgICAgdG9rZW5TZXJ2aWNlLmdlbmVyYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVG9rZW5EYXRhKTtcbiAgICAgIHByaXNtYVNlcnZpY2UudXNlci51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgZW1haWxTZXJ2aWNlLnNlbmRHZW5lcmljRW1haWwubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5yZXNlbmRWZXJpZmljYXRpb25FbWFpbChlbWFpbCk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBlbWFpbCB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzaWxlbnRseSByZXR1cm4gZm9yIG5vbi1leGlzdGVudCB1c2VyIChzZWN1cml0eSknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICdub25leGlzdGVudEBleGFtcGxlLmNvbSc7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UucmVzZW5kVmVyaWZpY2F0aW9uRW1haWwoZW1haWwpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBhbHJlYWR5IHZlcmlmaWVkIGVtYWlsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW1haWwgPSAndmVyaWZpZWRAZXhhbXBsZS5jb20nO1xuICAgICAgY29uc3QgdmVyaWZpZWRVc2VyID0ge1xuICAgICAgICBpZDogJ3VzZXItMTIzJyxcbiAgICAgICAgZW1haWw6ICd2ZXJpZmllZEBleGFtcGxlLmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgcHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUodmVyaWZpZWRVc2VyKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UucmVzZW5kVmVyaWZpY2F0aW9uRW1haWwoZW1haWwpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2xlYW51cEV4cGlyZWRUb2tlbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjbGVhbiB1cCBleHBpcmVkIHZlcmlmaWNhdGlvbiB0b2tlbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIudXBkYXRlTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGNvdW50OiA1IH0pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmNsZWFudXBFeHBpcmVkVG9rZW5zKCk7XG5cbiAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLnVzZXIudXBkYXRlTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IHtcbiAgICAgICAgICAgIGx0OiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBlbWFpbFZlcmlmeVRva2VuOiBudWxsLFxuICAgICAgICAgIGVtYWlsVmVyaWZ5VG9rZW5FeHA6IG51bGwsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NlbmRWZXJpZmljYXRpb25FbWFpbFdpdGhUb2tlbiAocHJpdmF0ZSBtZXRob2QpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCB2ZXJpZmljYXRpb24gZW1haWwgd2l0aCBjb3JyZWN0IHRlbXBsYXRlIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbWFpbCA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbiAgICAgIGNvbnN0IGZpcnN0TmFtZSA9ICdKb2huJztcbiAgICAgIGNvbnN0IHRva2VuID0gJ3ZlcmlmaWNhdGlvbi10b2tlbic7XG5cbiAgICAgIGVtYWlsU2VydmljZS5zZW5kR2VuZXJpY0VtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IChzZXJ2aWNlIGFzIGFueSkuc2VuZFZlcmlmaWNhdGlvbkVtYWlsV2l0aFRva2VuKGVtYWlsLCBmaXJzdE5hbWUsIHRva2VuKTtcblxuICAgICAgZXhwZWN0KGVtYWlsU2VydmljZS5zZW5kR2VuZXJpY0VtYWlsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHRvOiBlbWFpbCxcbiAgICAgICAgc3ViamVjdDogJ1ZlcmlmeSBZb3VyIE1lbnRhcmEgQWNjb3VudCcsXG4gICAgICAgIHRlbXBsYXRlOiAnZW1haWwtdmVyaWZpY2F0aW9uJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZpcnN0TmFtZSxcbiAgICAgICAgICB2ZXJpZmljYXRpb25Vcmw6IGBodHRwczovL21lbnRhcmEuY29tL3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufWAsXG4gICAgICAgICAgc3VwcG9ydEVtYWlsOiAnc3VwcG9ydEBtZW50YXJhLmNvbScsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQgc3VwcG9ydCBlbWFpbCB3aGVuIGVudiB2YXJpYWJsZSBub3Qgc2V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LlNVUFBPUlRfRU1BSUw7XG4gICAgICBjb25zdCBlbWFpbCA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbiAgICAgIGNvbnN0IGZpcnN0TmFtZSA9ICdKb2huJztcbiAgICAgIGNvbnN0IHRva2VuID0gJ3ZlcmlmaWNhdGlvbi10b2tlbic7XG5cbiAgICAgIGVtYWlsU2VydmljZS5zZW5kR2VuZXJpY0VtYWlsLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IChzZXJ2aWNlIGFzIGFueSkuc2VuZFZlcmlmaWNhdGlvbkVtYWlsV2l0aFRva2VuKGVtYWlsLCBmaXJzdE5hbWUsIHRva2VuKTtcblxuICAgICAgZXhwZWN0KGVtYWlsU2VydmljZS5zZW5kR2VuZXJpY0VtYWlsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHRvOiBlbWFpbCxcbiAgICAgICAgc3ViamVjdDogJ1ZlcmlmeSBZb3VyIE1lbnRhcmEgQWNjb3VudCcsXG4gICAgICAgIHRlbXBsYXRlOiAnZW1haWwtdmVyaWZpY2F0aW9uJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZpcnN0TmFtZSxcbiAgICAgICAgICB2ZXJpZmljYXRpb25Vcmw6IGBodHRwczovL21lbnRhcmEuY29tL3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufWAsXG4gICAgICAgICAgc3VwcG9ydEVtYWlsOiAnc3VwcG9ydEBtZW50YXJhLmNvbScsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtYWlsIHNlcnZpY2UgZmFpbHVyZSBhbmQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtYWlsID0gJ3Rlc3RAZXhhbXBsZS5jb20nO1xuICAgICAgY29uc3QgZmlyc3ROYW1lID0gJ0pvaG4nO1xuICAgICAgY29uc3QgdG9rZW4gPSAndmVyaWZpY2F0aW9uLXRva2VuJztcblxuICAgICAgZW1haWxTZXJ2aWNlLnNlbmRHZW5lcmljRW1haWwubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdFbWFpbCBzZXJ2aWNlIGVycm9yJykpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIChzZXJ2aWNlIGFzIGFueSkuc2VuZFZlcmlmaWNhdGlvbkVtYWlsV2l0aFRva2VuKGVtYWlsLCBmaXJzdE5hbWUsIHRva2VuKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3J5cHRvIGhhc2ggaW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1c2UgY3J5cHRvLmNyZWF0ZUhhc2ggZm9yIHRva2VuIHZlcmlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gJ3Rlc3QtdG9rZW4nO1xuICAgICAgY29uc3QgbW9ja0hhc2ggPSB7XG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGRpZ2VzdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnaGFzaGVkLXRva2VuJyksXG4gICAgICB9O1xuXG4gICAgICAoY3J5cHRvLmNyZWF0ZUhhc2ggYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUobW9ja0hhc2gpO1xuXG4gICAgICBwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudmVyaWZ5RW1haWwodG9rZW4pKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG5cbiAgICAgIGV4cGVjdChjcnlwdG8uY3JlYXRlSGFzaCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NoYTI1NicpO1xuICAgICAgZXhwZWN0KG1vY2tIYXNoLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgodG9rZW4pO1xuICAgICAgZXhwZWN0KG1vY2tIYXNoLmRpZ2VzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2hleCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZW52aXJvbm1lbnQgdmFyaWFibGUgaGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBGUk9OVEVORF9VUkwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuRlJPTlRFTkRfVVJMO1xuICAgICAgY29uc3QgZW1haWwgPSAndGVzdEBleGFtcGxlLmNvbSc7XG4gICAgICBjb25zdCBmaXJzdE5hbWUgPSAnSm9obic7XG4gICAgICBjb25zdCB0b2tlbiA9ICd2ZXJpZmljYXRpb24tdG9rZW4nO1xuXG4gICAgICBlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBhd2FpdCAoc2VydmljZSBhcyBhbnkpLnNlbmRWZXJpZmljYXRpb25FbWFpbFdpdGhUb2tlbihlbWFpbCwgZmlyc3ROYW1lLCB0b2tlbik7XG5cbiAgICAgIGV4cGVjdChlbWFpbFNlcnZpY2Uuc2VuZEdlbmVyaWNFbWFpbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0bzogZW1haWwsXG4gICAgICAgIHN1YmplY3Q6ICdWZXJpZnkgWW91ciBNZW50YXJhIEFjY291bnQnLFxuICAgICAgICB0ZW1wbGF0ZTogJ2VtYWlsLXZlcmlmaWNhdGlvbicsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBmaXJzdE5hbWUsXG4gICAgICAgICAgdmVyaWZpY2F0aW9uVXJsOiBgdW5kZWZpbmVkL3ZlcmlmeS1lbWFpbD90b2tlbj0ke3Rva2VufWAsXG4gICAgICAgICAgc3VwcG9ydEVtYWlsOiAnc3VwcG9ydEBtZW50YXJhLmNvbScsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=