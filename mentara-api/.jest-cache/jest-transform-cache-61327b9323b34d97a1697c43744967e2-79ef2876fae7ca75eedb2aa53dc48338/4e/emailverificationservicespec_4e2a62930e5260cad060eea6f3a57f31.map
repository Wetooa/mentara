{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/email-verification.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/email-verification.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { EmailVerificationService } from './email-verification.service';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { EmailService } from '../../services/email.service';\nimport { TokenService } from './token.service';\nimport {\n  BadRequestException,\n  NotFoundException,\n} from '@nestjs/common';\nimport * as crypto from 'crypto';\n\njest.mock('crypto');\n\ndescribe('EmailVerificationService', () => {\n  let service: EmailVerificationService;\n  let prismaService: jest.Mocked<PrismaService>;\n  let emailService: jest.Mocked<EmailService>;\n  let tokenService: jest.Mocked<TokenService>;\n\n  const mockUser = {\n    id: 'user-123',\n    email: 'test@example.com',\n    firstName: 'John',\n    emailVerified: false,\n    emailVerifyToken: null,\n    emailVerifyTokenExp: null,\n  };\n\n  const mockVerifiedUser = {\n    id: 'user-123',\n    email: 'test@example.com',\n    firstName: 'John',\n    emailVerified: true,\n    emailVerifyToken: 'hashed-token',\n    emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),\n  };\n\n  const mockUserWithToken = {\n    id: 'user-123',\n    email: 'test@example.com',\n    firstName: 'John',\n    emailVerified: false,\n    emailVerifyToken: 'hashed-token',\n    emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),\n  };\n\n  const mockTokenData = {\n    token: 'raw-token',\n    hashedToken: 'hashed-token',\n    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000),\n  };\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        EmailVerificationService,\n        {\n          provide: PrismaService,\n          useValue: {\n            user: {\n              findUnique: jest.fn(),\n              update: jest.fn(),\n              updateMany: jest.fn(),\n            },\n          },\n        },\n        {\n          provide: EmailService,\n          useValue: {\n            sendGenericEmail: jest.fn(),\n          },\n        },\n        {\n          provide: TokenService,\n          useValue: {\n            generateEmailVerificationToken: jest.fn(),\n          },\n        },\n      ],\n    }).compile();\n\n    service = module.get<EmailVerificationService>(EmailVerificationService);\n    prismaService = module.get(PrismaService);\n    emailService = module.get(EmailService);\n    tokenService = module.get(TokenService);\n\n    // Setup crypto mock\n    (crypto.createHash as jest.Mock).mockImplementation(() => ({\n      update: jest.fn().mockReturnThis(),\n      digest: jest.fn().mockReturnValue('hashed-token'),\n    }));\n\n    // Setup environment variables\n    process.env.FRONTEND_URL = 'https://mentara.com';\n    process.env.SUPPORT_EMAIL = 'support@mentara.com';\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('sendVerificationEmail', () => {\n    it('should send verification email for user without existing token', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);\n      prismaService.user.update.mockResolvedValue(mockUser);\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await service.sendVerificationEmail('user-123');\n\n      expect(prismaService.user.findUnique).toHaveBeenCalledWith({\n        where: { id: 'user-123' },\n        select: {\n          id: true,\n          email: true,\n          firstName: true,\n          emailVerified: true,\n          emailVerifyToken: true,\n          emailVerifyTokenExp: true,\n        },\n      });\n\n      expect(tokenService.generateEmailVerificationToken).toHaveBeenCalled();\n      expect(prismaService.user.update).toHaveBeenCalledWith({\n        where: { id: 'user-123' },\n        data: {\n          emailVerifyToken: mockTokenData.hashedToken,\n          emailVerifyTokenExp: mockTokenData.expiresAt,\n        },\n      });\n\n      expect(emailService.sendGenericEmail).toHaveBeenCalledWith({\n        to: mockUser.email,\n        subject: 'Verify Your Mentara Account',\n        template: 'email-verification',\n        data: {\n          firstName: mockUser.firstName,\n          verificationUrl: `https://mentara.com/verify-email?token=${mockTokenData.token}`,\n          supportEmail: 'support@mentara.com',\n        },\n      });\n    });\n\n    it('should resend existing valid token without generating new one', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUserWithToken);\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await service.sendVerificationEmail('user-123');\n\n      expect(tokenService.generateEmailVerificationToken).not.toHaveBeenCalled();\n      expect(prismaService.user.update).not.toHaveBeenCalled();\n      expect(emailService.sendGenericEmail).toHaveBeenCalledWith({\n        to: mockUserWithToken.email,\n        subject: 'Verify Your Mentara Account',\n        template: 'email-verification',\n        data: {\n          firstName: mockUserWithToken.firstName,\n          verificationUrl: `https://mentara.com/verify-email?token=${mockUserWithToken.emailVerifyToken}`,\n          supportEmail: 'support@mentara.com',\n        },\n      });\n    });\n\n    it('should throw NotFoundException for non-existent user', async () => {\n      prismaService.user.findUnique.mockResolvedValue(null);\n\n      await expect(service.sendVerificationEmail('non-existent')).rejects.toThrow(\n        NotFoundException,\n      );\n    });\n\n    it('should throw BadRequestException for already verified email', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockVerifiedUser);\n\n      await expect(service.sendVerificationEmail('user-123')).rejects.toThrow(\n        BadRequestException,\n      );\n    });\n\n    it('should generate new token when existing token is expired', async () => {\n      const userWithExpiredToken = {\n        ...mockUserWithToken,\n        emailVerifyTokenExp: new Date(Date.now() - 1000),\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(userWithExpiredToken);\n      tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);\n      prismaService.user.update.mockResolvedValue(mockUser);\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await service.sendVerificationEmail('user-123');\n\n      expect(tokenService.generateEmailVerificationToken).toHaveBeenCalled();\n      expect(prismaService.user.update).toHaveBeenCalledWith({\n        where: { id: 'user-123' },\n        data: {\n          emailVerifyToken: mockTokenData.hashedToken,\n          emailVerifyTokenExp: mockTokenData.expiresAt,\n        },\n      });\n    });\n\n    it('should handle email service failure', async () => {\n      prismaService.user.findUnique.mockResolvedValue(mockUser);\n      tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);\n      prismaService.user.update.mockResolvedValue(mockUser);\n      emailService.sendGenericEmail.mockRejectedValue(new Error('Email service error'));\n\n      await expect(service.sendVerificationEmail('user-123')).rejects.toThrow(\n        BadRequestException,\n      );\n    });\n  });\n\n  describe('verifyEmail', () => {\n    it('should verify email successfully', async () => {\n      const token = 'raw-token';\n      const userToVerify = {\n        id: 'user-123',\n        email: 'test@example.com',\n        emailVerified: false,\n        emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(userToVerify);\n      prismaService.user.update.mockResolvedValue({\n        ...userToVerify,\n        emailVerified: true,\n      });\n\n      const result = await service.verifyEmail(token);\n\n      expect(result).toEqual({\n        success: true,\n        message: 'Email verified successfully',\n      });\n\n      expect(prismaService.user.findUnique).toHaveBeenCalledWith({\n        where: { emailVerifyToken: 'hashed-token' },\n        select: {\n          id: true,\n          email: true,\n          emailVerified: true,\n          emailVerifyTokenExp: true,\n        },\n      });\n\n      expect(prismaService.user.update).toHaveBeenCalledWith({\n        where: { id: 'user-123' },\n        data: {\n          emailVerified: true,\n          emailVerifyToken: null,\n          emailVerifyTokenExp: null,\n          isVerified: true,\n        },\n      });\n    });\n\n    it('should throw BadRequestException for missing token', async () => {\n      await expect(service.verifyEmail('')).rejects.toThrow(BadRequestException);\n    });\n\n    it('should throw BadRequestException for invalid token', async () => {\n      const token = 'invalid-token';\n      prismaService.user.findUnique.mockResolvedValue(null);\n\n      await expect(service.verifyEmail(token)).rejects.toThrow(BadRequestException);\n    });\n\n    it('should return success message for already verified email', async () => {\n      const token = 'raw-token';\n      const alreadyVerifiedUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n        emailVerified: true,\n        emailVerifyTokenExp: new Date(Date.now() + 24 * 60 * 60 * 1000),\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(alreadyVerifiedUser);\n\n      const result = await service.verifyEmail(token);\n\n      expect(result).toEqual({\n        success: true,\n        message: 'Email already verified',\n      });\n\n      expect(prismaService.user.update).not.toHaveBeenCalled();\n    });\n\n    it('should handle expired token by cleaning up and throwing error', async () => {\n      const token = 'expired-token';\n      const userWithExpiredToken = {\n        id: 'user-123',\n        email: 'test@example.com',\n        emailVerified: false,\n        emailVerifyTokenExp: new Date(Date.now() - 1000),\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(userWithExpiredToken);\n      prismaService.user.update.mockResolvedValue(userWithExpiredToken);\n\n      await expect(service.verifyEmail(token)).rejects.toThrow(BadRequestException);\n\n      expect(prismaService.user.update).toHaveBeenCalledWith({\n        where: { id: 'user-123' },\n        data: {\n          emailVerifyToken: null,\n          emailVerifyTokenExp: null,\n        },\n      });\n    });\n\n    it('should handle token without expiration date', async () => {\n      const token = 'token-without-exp';\n      const userWithoutExpiration = {\n        id: 'user-123',\n        email: 'test@example.com',\n        emailVerified: false,\n        emailVerifyTokenExp: null,\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(userWithoutExpiration);\n      prismaService.user.update.mockResolvedValue(userWithoutExpiration);\n\n      await expect(service.verifyEmail(token)).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('resendVerificationEmail', () => {\n    it('should resend verification email for existing unverified user', async () => {\n      const email = 'test@example.com';\n      const unverifiedUser = {\n        id: 'user-123',\n        email: 'test@example.com',\n        firstName: 'John',\n        emailVerified: false,\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(unverifiedUser);\n      // Mock the sendVerificationEmail method by setting up the full chain\n      prismaService.user.findUnique\n        .mockResolvedValueOnce(unverifiedUser)\n        .mockResolvedValueOnce(mockUser);\n      tokenService.generateEmailVerificationToken.mockResolvedValue(mockTokenData);\n      prismaService.user.update.mockResolvedValue(mockUser);\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await service.resendVerificationEmail(email);\n\n      expect(prismaService.user.findUnique).toHaveBeenCalledWith({\n        where: { email },\n        select: {\n          id: true,\n          email: true,\n          firstName: true,\n          emailVerified: true,\n        },\n      });\n    });\n\n    it('should silently return for non-existent user (security)', async () => {\n      const email = 'nonexistent@example.com';\n      prismaService.user.findUnique.mockResolvedValue(null);\n\n      await expect(service.resendVerificationEmail(email)).resolves.not.toThrow();\n    });\n\n    it('should throw BadRequestException for already verified email', async () => {\n      const email = 'verified@example.com';\n      const verifiedUser = {\n        id: 'user-123',\n        email: 'verified@example.com',\n        firstName: 'John',\n        emailVerified: true,\n      };\n\n      prismaService.user.findUnique.mockResolvedValue(verifiedUser);\n\n      await expect(service.resendVerificationEmail(email)).rejects.toThrow(\n        BadRequestException,\n      );\n    });\n  });\n\n  describe('cleanupExpiredTokens', () => {\n    it('should clean up expired verification tokens', async () => {\n      prismaService.user.updateMany.mockResolvedValue({ count: 5 });\n\n      await service.cleanupExpiredTokens();\n\n      expect(prismaService.user.updateMany).toHaveBeenCalledWith({\n        where: {\n          emailVerifyTokenExp: {\n            lt: expect.any(Date),\n          },\n        },\n        data: {\n          emailVerifyToken: null,\n          emailVerifyTokenExp: null,\n        },\n      });\n    });\n  });\n\n  describe('sendVerificationEmailWithToken (private method)', () => {\n    it('should send verification email with correct template data', async () => {\n      const email = 'test@example.com';\n      const firstName = 'John';\n      const token = 'verification-token';\n\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await (service as any).sendVerificationEmailWithToken(email, firstName, token);\n\n      expect(emailService.sendGenericEmail).toHaveBeenCalledWith({\n        to: email,\n        subject: 'Verify Your Mentara Account',\n        template: 'email-verification',\n        data: {\n          firstName,\n          verificationUrl: `https://mentara.com/verify-email?token=${token}`,\n          supportEmail: 'support@mentara.com',\n        },\n      });\n    });\n\n    it('should use default support email when env variable not set', async () => {\n      delete process.env.SUPPORT_EMAIL;\n      const email = 'test@example.com';\n      const firstName = 'John';\n      const token = 'verification-token';\n\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await (service as any).sendVerificationEmailWithToken(email, firstName, token);\n\n      expect(emailService.sendGenericEmail).toHaveBeenCalledWith({\n        to: email,\n        subject: 'Verify Your Mentara Account',\n        template: 'email-verification',\n        data: {\n          firstName,\n          verificationUrl: `https://mentara.com/verify-email?token=${token}`,\n          supportEmail: 'support@mentara.com',\n        },\n      });\n    });\n\n    it('should handle email service failure and throw BadRequestException', async () => {\n      const email = 'test@example.com';\n      const firstName = 'John';\n      const token = 'verification-token';\n\n      emailService.sendGenericEmail.mockRejectedValue(new Error('Email service error'));\n\n      await expect(\n        (service as any).sendVerificationEmailWithToken(email, firstName, token),\n      ).rejects.toThrow(BadRequestException);\n    });\n  });\n\n  describe('crypto hash integration', () => {\n    it('should use crypto.createHash for token verification', async () => {\n      const token = 'test-token';\n      const mockHash = {\n        update: jest.fn().mockReturnThis(),\n        digest: jest.fn().mockReturnValue('hashed-token'),\n      };\n\n      (crypto.createHash as jest.Mock).mockReturnValue(mockHash);\n\n      prismaService.user.findUnique.mockResolvedValue(null);\n\n      await expect(service.verifyEmail(token)).rejects.toThrow(BadRequestException);\n\n      expect(crypto.createHash).toHaveBeenCalledWith('sha256');\n      expect(mockHash.update).toHaveBeenCalledWith(token);\n      expect(mockHash.digest).toHaveBeenCalledWith('hex');\n    });\n  });\n\n  describe('environment variable handling', () => {\n    it('should handle missing FRONTEND_URL', async () => {\n      delete process.env.FRONTEND_URL;\n      const email = 'test@example.com';\n      const firstName = 'John';\n      const token = 'verification-token';\n\n      emailService.sendGenericEmail.mockResolvedValue(undefined);\n\n      await (service as any).sendVerificationEmailWithToken(email, firstName, token);\n\n      expect(emailService.sendGenericEmail).toHaveBeenCalledWith({\n        to: email,\n        subject: 'Verify Your Mentara Account',\n        template: 'email-verification',\n        data: {\n          firstName,\n          verificationUrl: `undefined/verify-email?token=${token}`,\n          supportEmail: 'support@mentara.com',\n        },\n      });\n    });\n  });\n});"],"version":3}