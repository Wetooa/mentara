{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/community-assignment.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/community-assignment.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { CommunityAssignmentService } from './community-assignment.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { ILLNESS_COMMUNITIES } from '../config/community-configs';\n\ndescribe('CommunityAssignmentService', () => {\n  let service: CommunityAssignmentService;\n  let prismaService: jest.Mocked<PrismaService>;\n\n  // Mock data\n  const mockUser = {\n    id: 'user-123',\n    firstName: 'John',\n    lastName: 'Doe',\n    email: 'john.doe@example.com',\n  };\n\n  const mockCommunity = {\n    id: 'community-123',\n    name: 'Depression Support Network',\n    slug: 'depression-support',\n    description: 'A supportive community for depression',\n    imageUrl: 'image.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockAnxietyCommunity = {\n    id: 'community-456',\n    name: 'Anxiety Warriors',\n    slug: 'anxiety-warriors',\n    description: 'A supportive community for anxiety',\n    imageUrl: 'anxiety.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockGeneralCommunity = {\n    id: 'community-789',\n    name: 'Support Circle',\n    slug: 'support-circle',\n    description: 'General support community',\n    imageUrl: 'general.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockMindfulnessCommunity = {\n    id: 'community-101',\n    name: 'Mindfulness & Meditation',\n    slug: 'mindfulness-meditation',\n    description: 'Mindfulness and meditation community',\n    imageUrl: 'mindfulness.jpg',\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockPreAssessment = {\n    id: 'assessment-123',\n    clientId: 'user-123',\n    questionnaires: ['phq-9', 'gad-7-anxiety'],\n    answers: [[1, 2, 3], [4, 5, 6]],\n    answerMatrix: [[1, 2, 3], [4, 5, 6]],\n    scores: {\n      'phq-9': 15, // Moderate depression\n      'gad-7-anxiety': 12, // Moderate anxiety\n      'perceived-stress-scale': 8, // Mild stress\n      'minimal-condition': 2, // Minimal score\n    },\n    severityLevels: {\n      'phq-9': 'moderate',\n      'gad-7-anxiety': 'moderate',\n      'perceived-stress-scale': 'mild',\n      'minimal-condition': 'minimal',\n    },\n    aiEstimate: { hasDepression: true, hasAnxiety: true },\n    createdAt: new Date('2024-01-01'),\n    updatedAt: new Date('2024-01-01'),\n  };\n\n  const mockMembership = {\n    id: 'membership-123',\n    userId: 'user-123',\n    communityId: 'community-123',\n    role: 'member',\n    joinedAt: new Date('2024-01-01'),\n  };\n\n  beforeEach(async () => {\n    const mockPrismaService = {\n      preAssessment: {\n        findFirst: jest.fn(),\n        findUnique: jest.fn(),\n      },\n      community: {\n        findUnique: jest.fn(),\n        findFirst: jest.fn(),\n        findMany: jest.fn(),\n      },\n      membership: {\n        findUnique: jest.fn(),\n        create: jest.fn(),\n        findMany: jest.fn(),\n      },\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        CommunityAssignmentService,\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n      ],\n    }).compile();\n\n    service = module.get<CommunityAssignmentService>(CommunityAssignmentService);\n    prismaService = module.get(PrismaService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  describe('assignCommunitiesToUser', () => {\n    beforeEach(() => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findUnique.mockImplementation((args) => {\n        const slug = args.where.slug;\n        if (slug === 'depression-support') return Promise.resolve(mockCommunity);\n        if (slug === 'anxiety-warriors') return Promise.resolve(mockAnxietyCommunity);\n        return Promise.resolve(null);\n      });\n      prismaService.community.findFirst.mockImplementation((args) => {\n        const name = args.where.name;\n        if (name === 'Support Circle') return Promise.resolve(mockGeneralCommunity);\n        if (name === 'Mindfulness & Meditation') return Promise.resolve(mockMindfulnessCommunity);\n        return Promise.resolve(null);\n      });\n      prismaService.membership.findUnique.mockResolvedValue(null); // No existing memberships\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n    });\n\n    it('should assign communities based on moderate/severe assessment scores', async () => {\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(prismaService.preAssessment.findFirst).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n      });\n\n      // Should find communities for moderate/severe conditions\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'depression-support' },\n      });\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'anxiety-warriors' },\n      });\n\n      // Should create memberships for moderate/severe conditions\n      expect(prismaService.membership.create).toHaveBeenCalledWith({\n        data: {\n          userId: 'user-123',\n          communityId: 'community-123',\n          role: 'member',\n          joinedAt: expect.any(Date),\n        },\n      });\n      expect(prismaService.membership.create).toHaveBeenCalledWith({\n        data: {\n          userId: 'user-123',\n          communityId: 'community-456',\n          role: 'member',\n          joinedAt: expect.any(Date),\n        },\n      });\n\n      // Should also assign general communities\n      expect(prismaService.community.findFirst).toHaveBeenCalledWith({\n        where: { name: 'Support Circle' },\n      });\n      expect(prismaService.community.findFirst).toHaveBeenCalledWith({\n        where: { name: 'Mindfulness & Meditation' },\n      });\n\n      expect(result).toEqual(['Depression Support Network', 'Anxiety Warriors']);\n    });\n\n    it('should not assign communities for mild/minimal severity scores', async () => {\n      const mildAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          'phq-9': 5, // Mild depression\n          'gad-7-anxiety': 3, // Minimal anxiety\n        },\n        severityLevels: {\n          'phq-9': 'mild',\n          'gad-7-anxiety': 'minimal',\n        },\n      };\n      prismaService.preAssessment.findFirst.mockResolvedValue(mildAssessment);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      // Should still query for communities but not create memberships for mild/minimal\n      expect(prismaService.membership.create).toHaveBeenCalledTimes(2); // Only general communities\n      expect(result).toEqual([]);\n    });\n\n    it('should return empty array when no pre-assessment exists', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(null);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).toEqual([]);\n      expect(prismaService.community.findUnique).not.toHaveBeenCalled();\n      expect(prismaService.membership.create).not.toHaveBeenCalled();\n    });\n\n    it('should skip communities that do not exist in database', async () => {\n      const assessmentWithNonExistentCommunity = {\n        ...mockPreAssessment,\n        scores: {\n          'phq-9': 15, // Maps to depression-support\n          'unknown-questionnaire': 20, // No mapping\n        },\n        severityLevels: {\n          'phq-9': 'moderate',\n          'unknown-questionnaire': 'severe',\n        },\n      };\n      prismaService.preAssessment.findFirst.mockResolvedValue(assessmentWithNonExistentCommunity);\n      \n      // Only depression community exists\n      prismaService.community.findUnique.mockImplementation((args) => {\n        if (args.where.slug === 'depression-support') return Promise.resolve(mockCommunity);\n        return Promise.resolve(null);\n      });\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).toEqual(['Depression Support Network']);\n    });\n\n    it('should skip assignment if user is already a member', async () => {\n      // User is already a member of depression community\n      prismaService.membership.findUnique.mockImplementation((args) => {\n        if (\n          args.where.userId_communityId.userId === 'user-123' &&\n          args.where.userId_communityId.communityId === 'community-123'\n        ) {\n          return Promise.resolve(mockMembership);\n        }\n        return Promise.resolve(null);\n      });\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      // Should check for existing membership\n      expect(prismaService.membership.findUnique).toHaveBeenCalledWith({\n        where: {\n          userId_communityId: {\n            userId: 'user-123',\n            communityId: 'community-123',\n          },\n        },\n      });\n\n      // Should not create new membership for depression (already exists)\n      const createCalls = prismaService.membership.create.mock.calls;\n      const depressionAssignment = createCalls.find(call => \n        call[0].data.communityId === 'community-123'\n      );\n      expect(depressionAssignment).toBeUndefined();\n\n      // Should still assign anxiety community and general communities\n      expect(result).toEqual(['Anxiety Warriors']);\n    });\n\n    it('should handle database errors gracefully during membership creation', async () => {\n      prismaService.membership.create.mockRejectedValueOnce(new Error('Database error'));\n\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Failed to assign community'),\n        expect.any(Error)\n      );\n\n      // Should continue with other assignments despite one failure\n      expect(prismaService.membership.create).toHaveBeenCalledTimes(4); // 2 specific + 2 general\n\n      consoleSpy.mockRestore();\n    });\n\n    it('should assign general support communities regardless of assessment results', async () => {\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      // Should assign general communities\n      expect(prismaService.community.findFirst).toHaveBeenCalledWith({\n        where: { name: 'Support Circle' },\n      });\n      expect(prismaService.community.findFirst).toHaveBeenCalledWith({\n        where: { name: 'Mindfulness & Meditation' },\n      });\n\n      // Should create memberships for general communities\n      expect(prismaService.membership.create).toHaveBeenCalledWith({\n        data: {\n          userId: 'user-123',\n          communityId: 'community-789',\n          role: 'member',\n          joinedAt: expect.any(Date),\n        },\n      });\n      expect(prismaService.membership.create).toHaveBeenCalledWith({\n        data: {\n          userId: 'user-123',\n          communityId: 'community-101',\n          role: 'member',\n          joinedAt: expect.any(Date),\n        },\n      });\n    });\n\n    it('should handle all questionnaire mappings correctly', async () => {\n      const comprehensiveAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          'phq-9': 15, // depression-support\n          'gad-7-anxiety': 12, // anxiety-warriors\n          'social-phobia': 10, // social-anxiety-support\n          'panic-disorder': 8, // anxiety-warriors\n          'perceived-stress-scale': 14, // stress-support\n          'burnout': 16, // burnout-recovery\n          'insomnia': 12, // insomnia-support\n          'ptsd': 18, // ptsd-support\n          'obsessional-compulsive': 11, // ocd-support\n          'adhd': 9, // adhd-support\n          'binge-eating': 13, // eating-disorder-recovery\n          'alcohol': 10, // substance-recovery-support\n          'drug-abuse': 15, // substance-recovery-support\n        },\n        severityLevels: {\n          'phq-9': 'moderate',\n          'gad-7-anxiety': 'moderate',\n          'social-phobia': 'moderate',\n          'panic-disorder': 'moderate',\n          'perceived-stress-scale': 'moderate',\n          'burnout': 'severe',\n          'insomnia': 'moderate',\n          'ptsd': 'severe',\n          'obsessional-compulsive': 'moderate',\n          'adhd': 'moderate',\n          'binge-eating': 'moderate',\n          'alcohol': 'moderate',\n          'drug-abuse': 'severe',\n        },\n      };\n\n      prismaService.preAssessment.findFirst.mockResolvedValue(comprehensiveAssessment);\n\n      // Mock all communities exist\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n\n      await service.assignCommunitiesToUser('user-123');\n\n      // Should attempt to find all mapped communities\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'depression-support' },\n      });\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'anxiety-warriors' },\n      });\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'social-anxiety-support' },\n      });\n      expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n        where: { slug: 'stress-support' },\n      });\n    });\n  });\n\n  describe('assignGeneralSupportCommunities', () => {\n    beforeEach(() => {\n      prismaService.community.findFirst.mockImplementation((args) => {\n        const name = args.where.name;\n        if (name === 'Support Circle') return Promise.resolve(mockGeneralCommunity);\n        if (name === 'Mindfulness & Meditation') return Promise.resolve(mockMindfulnessCommunity);\n        return Promise.resolve(null);\n      });\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n    });\n\n    it('should assign both general support communities', async () => {\n      // Call the private method through assignCommunitiesToUser\n      prismaService.preAssessment.findFirst.mockResolvedValue(null); // No assessment\n      \n      await service.assignCommunitiesToUser('user-123');\n\n      expect(prismaService.community.findFirst).toHaveBeenCalledWith({\n        where: { name: 'Support Circle' },\n      });\n      expect(prismaService.community.findFirst).toHaveBeenCalledWith({\n        where: { name: 'Mindfulness & Meditation' },\n      });\n\n      expect(prismaService.membership.create).toHaveBeenCalledTimes(2);\n    });\n\n    it('should skip general communities if user is already a member', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(null);\n      prismaService.membership.findUnique.mockResolvedValue(mockMembership); // Already a member\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(prismaService.membership.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle missing general communities gracefully', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(null);\n      prismaService.community.findFirst.mockResolvedValue(null); // Communities don't exist\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(prismaService.membership.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle errors during general community assignment', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(null);\n      prismaService.membership.create.mockRejectedValue(new Error('Assignment failed'));\n\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Failed to assign general community'),\n        expect.any(Error)\n      );\n\n      consoleSpy.mockRestore();\n    });\n  });\n\n  describe('getRecommendedCommunities', () => {\n    beforeEach(() => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(mockPreAssessment);\n    });\n\n    it('should return recommended communities based on assessment scores', async () => {\n      const result = await service.getRecommendedCommunities('user-123');\n\n      expect(prismaService.preAssessment.findFirst).toHaveBeenCalledWith({\n        where: { clientId: 'user-123' },\n      });\n\n      // Should include communities for moderate/severe conditions\n      expect(result).toContain('Depression Support Network');\n      expect(result).toContain('Anxiety Warriors');\n      expect(result).not.toContain('Stress Support Community'); // mild severity\n    });\n\n    it('should return empty array when no pre-assessment exists', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(null);\n\n      const result = await service.getRecommendedCommunities('user-123');\n\n      expect(result).toEqual([]);\n    });\n\n    it('should filter out communities that are not in ILLNESS_COMMUNITIES config', async () => {\n      const assessmentWithUnknownCommunity = {\n        ...mockPreAssessment,\n        scores: {\n          'unknown-questionnaire': 20, // No mapping in ILLNESS_COMMUNITIES\n        },\n        severityLevels: {\n          'unknown-questionnaire': 'severe',\n        },\n      };\n      prismaService.preAssessment.findFirst.mockResolvedValue(assessmentWithUnknownCommunity);\n\n      const result = await service.getRecommendedCommunities('user-123');\n\n      expect(result).toEqual([]);\n    });\n\n    it('should only include communities for moderate or higher severity', async () => {\n      const mixedSeverityAssessment = {\n        ...mockPreAssessment,\n        scores: {\n          'phq-9': 15, // moderate\n          'gad-7-anxiety': 5, // mild\n          'ptsd': 18, // severe\n        },\n        severityLevels: {\n          'phq-9': 'moderate',\n          'gad-7-anxiety': 'mild',\n          'ptsd': 'severe',\n        },\n      };\n      prismaService.preAssessment.findFirst.mockResolvedValue(mixedSeverityAssessment);\n\n      const result = await service.getRecommendedCommunities('user-123');\n\n      expect(result).toContain('Depression Support Network'); // moderate\n      expect(result).toContain('PTSD Support Network'); // severe\n      expect(result).not.toContain('Anxiety Warriors'); // mild severity\n    });\n  });\n\n  describe('bulkAssignCommunities', () => {\n    it('should assign communities to multiple users', async () => {\n      const userIds = ['user-1', 'user-2', 'user-3'];\n      \n      prismaService.preAssessment.findFirst.mockImplementation((args) => {\n        if (args.where.clientId === 'user-1') return Promise.resolve(mockPreAssessment);\n        if (args.where.clientId === 'user-2') return Promise.resolve(mockPreAssessment);\n        if (args.where.clientId === 'user-3') return Promise.resolve(null); // No assessment\n        return Promise.resolve(null);\n      });\n\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const result = await service.bulkAssignCommunities(userIds);\n\n      expect(result).toHaveProperty('user-1');\n      expect(result).toHaveProperty('user-2');\n      expect(result).toHaveProperty('user-3');\n\n      expect(result['user-1']).toContain('Depression Support Network');\n      expect(result['user-2']).toContain('Depression Support Network');\n      expect(result['user-3']).toEqual([]); // No assessment\n    });\n\n    it('should handle errors for individual users gracefully', async () => {\n      const userIds = ['user-1', 'user-2'];\n      \n      prismaService.preAssessment.findFirst.mockImplementation((args) => {\n        if (args.where.clientId === 'user-1') return Promise.resolve(mockPreAssessment);\n        if (args.where.clientId === 'user-2') return Promise.reject(new Error('Database error'));\n        return Promise.resolve(null);\n      });\n\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\n\n      const result = await service.bulkAssignCommunities(userIds);\n\n      expect(result['user-1']).toContain('Depression Support Network');\n      expect(result['user-2']).toEqual([]); // Error case\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Error assigning communities to user user-2'),\n        expect.any(Error)\n      );\n\n      consoleSpy.mockRestore();\n    });\n\n    it('should handle empty user list', async () => {\n      const result = await service.bulkAssignCommunities([]);\n\n      expect(result).toEqual({});\n      expect(prismaService.preAssessment.findFirst).not.toHaveBeenCalled();\n    });\n\n    it('should process large number of users efficiently', async () => {\n      const userIds = Array.from({ length: 100 }, (_, i) => `user-${i}`);\n      \n      prismaService.preAssessment.findFirst.mockResolvedValue(null); // No assessments\n      \n      const result = await service.bulkAssignCommunities(userIds);\n\n      expect(Object.keys(result)).toHaveLength(100);\n      expect(prismaService.preAssessment.findFirst).toHaveBeenCalledTimes(100);\n    });\n  });\n\n  describe('questionnaire mapping configuration', () => {\n    it('should have correct mapping for depression-related assessments', async () => {\n      const assessments = ['phq-9', 'mood-disorder'];\n      \n      for (const assessment of assessments) {\n        const testAssessment = {\n          ...mockPreAssessment,\n          scores: { [assessment]: 15 },\n          severityLevels: { [assessment]: 'moderate' },\n        };\n        \n        prismaService.preAssessment.findFirst.mockResolvedValue(testAssessment);\n        prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n        prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n        prismaService.membership.findUnique.mockResolvedValue(null);\n        prismaService.membership.create.mockResolvedValue(mockMembership);\n\n        await service.assignCommunitiesToUser('user-123');\n\n        expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n          where: { slug: 'depression-support' },\n        });\n\n        jest.clearAllMocks();\n      }\n    });\n\n    it('should have correct mapping for anxiety-related assessments', async () => {\n      const assessmentMappings = [\n        { assessment: 'gad-7-anxiety', expectedSlug: 'anxiety-warriors' },\n        { assessment: 'social-phobia', expectedSlug: 'social-anxiety-support' },\n        { assessment: 'panic-disorder', expectedSlug: 'anxiety-warriors' },\n        { assessment: 'phobia', expectedSlug: 'phobia-support' },\n      ];\n\n      for (const { assessment, expectedSlug } of assessmentMappings) {\n        const testAssessment = {\n          ...mockPreAssessment,\n          scores: { [assessment]: 15 },\n          severityLevels: { [assessment]: 'moderate' },\n        };\n        \n        prismaService.preAssessment.findFirst.mockResolvedValue(testAssessment);\n        prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n        prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n        prismaService.membership.findUnique.mockResolvedValue(null);\n        prismaService.membership.create.mockResolvedValue(mockMembership);\n\n        await service.assignCommunitiesToUser('user-123');\n\n        expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n          where: { slug: expectedSlug },\n        });\n\n        jest.clearAllMocks();\n      }\n    });\n\n    it('should have correct mapping for other mental health assessments', async () => {\n      const assessmentMappings = [\n        { assessment: 'perceived-stress-scale', expectedSlug: 'stress-support' },\n        { assessment: 'burnout', expectedSlug: 'burnout-recovery' },\n        { assessment: 'insomnia', expectedSlug: 'insomnia-support' },\n        { assessment: 'ptsd', expectedSlug: 'ptsd-support' },\n        { assessment: 'obsessional-compulsive', expectedSlug: 'ocd-support' },\n        { assessment: 'adhd', expectedSlug: 'adhd-support' },\n        { assessment: 'binge-eating', expectedSlug: 'eating-disorder-recovery' },\n        { assessment: 'alcohol', expectedSlug: 'substance-recovery-support' },\n        { assessment: 'drug-abuse', expectedSlug: 'substance-recovery-support' },\n      ];\n\n      for (const { assessment, expectedSlug } of assessmentMappings) {\n        const testAssessment = {\n          ...mockPreAssessment,\n          scores: { [assessment]: 15 },\n          severityLevels: { [assessment]: 'moderate' },\n        };\n        \n        prismaService.preAssessment.findFirst.mockResolvedValue(testAssessment);\n        prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n        prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n        prismaService.membership.findUnique.mockResolvedValue(null);\n        prismaService.membership.create.mockResolvedValue(mockMembership);\n\n        await service.assignCommunitiesToUser('user-123');\n\n        expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n          where: { slug: expectedSlug },\n        });\n\n        jest.clearAllMocks();\n      }\n    });\n  });\n\n  describe('severity threshold configuration', () => {\n    it('should respect severity thresholds for community assignment', async () => {\n      const severityTests = [\n        { severity: 'minimal', shouldAssign: false },\n        { severity: 'mild', shouldAssign: false },\n        { severity: 'moderate', shouldAssign: true },\n        { severity: 'severe', shouldAssign: true },\n        { severity: 'very-severe', shouldAssign: true },\n      ];\n\n      for (const { severity, shouldAssign } of severityTests) {\n        const testAssessment = {\n          ...mockPreAssessment,\n          scores: { 'phq-9': 15 },\n          severityLevels: { 'phq-9': severity },\n        };\n        \n        prismaService.preAssessment.findFirst.mockResolvedValue(testAssessment);\n        prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n        prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n        prismaService.membership.findUnique.mockResolvedValue(null);\n        prismaService.membership.create.mockResolvedValue(mockMembership);\n\n        const result = await service.assignCommunitiesToUser('user-123');\n\n        if (shouldAssign) {\n          expect(result).toContain('Depression Support Network');\n          expect(prismaService.community.findUnique).toHaveBeenCalledWith({\n            where: { slug: 'depression-support' },\n          });\n        } else {\n          expect(result).not.toContain('Depression Support Network');\n        }\n\n        jest.clearAllMocks();\n      }\n    });\n\n    it('should handle case insensitive severity levels', async () => {\n      const testAssessment = {\n        ...mockPreAssessment,\n        scores: { 'phq-9': 15 },\n        severityLevels: { 'phq-9': 'MODERATE' }, // Uppercase\n      };\n      \n      prismaService.preAssessment.findFirst.mockResolvedValue(testAssessment);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).toContain('Depression Support Network');\n    });\n\n    it('should handle undefined severity levels gracefully', async () => {\n      const testAssessment = {\n        ...mockPreAssessment,\n        scores: { 'phq-9': 15 },\n        severityLevels: { 'phq-9': undefined },\n      };\n      \n      prismaService.preAssessment.findFirst.mockResolvedValue(testAssessment);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).not.toContain('Depression Support Network');\n    });\n  });\n\n  describe('edge cases and error handling', () => {\n    it('should handle empty assessment scores', async () => {\n      const emptyAssessment = {\n        ...mockPreAssessment,\n        scores: {},\n        severityLevels: {},\n      };\n      \n      prismaService.preAssessment.findFirst.mockResolvedValue(emptyAssessment);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).toEqual([]);\n      expect(prismaService.community.findUnique).not.toHaveBeenCalled();\n      // Should still assign general communities\n      expect(prismaService.community.findFirst).toHaveBeenCalled();\n    });\n\n    it('should handle null assessment data', async () => {\n      const nullAssessment = {\n        ...mockPreAssessment,\n        scores: null,\n        severityLevels: null,\n      };\n      \n      prismaService.preAssessment.findFirst.mockResolvedValue(nullAssessment);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).toEqual([]);\n    });\n\n    it('should handle database connection errors', async () => {\n      prismaService.preAssessment.findFirst.mockRejectedValue(new Error('Database connection error'));\n\n      await expect(service.assignCommunitiesToUser('user-123')).rejects.toThrow('Database connection error');\n    });\n\n    it('should handle concurrent assignment attempts', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      // Simulate concurrent calls\n      const promises = [\n        service.assignCommunitiesToUser('user-123'),\n        service.assignCommunitiesToUser('user-123'),\n        service.assignCommunitiesToUser('user-123'),\n      ];\n\n      const results = await Promise.all(promises);\n\n      // All calls should complete successfully\n      expect(results).toHaveLength(3);\n      results.forEach(result => {\n        expect(result).toContain('Depression Support Network');\n      });\n    });\n\n    it('should handle very large assessment objects', async () => {\n      const largeScores = {};\n      const largeSeverityLevels = {};\n      \n      // Create large assessment with 1000 entries\n      for (let i = 0; i < 1000; i++) {\n        largeScores[`assessment-${i}`] = 15;\n        largeSeverityLevels[`assessment-${i}`] = 'moderate';\n      }\n      \n      // Add one known assessment\n      largeScores['phq-9'] = 15;\n      largeSeverityLevels['phq-9'] = 'moderate';\n\n      const largeAssessment = {\n        ...mockPreAssessment,\n        scores: largeScores,\n        severityLevels: largeSeverityLevels,\n      };\n      \n      prismaService.preAssessment.findFirst.mockResolvedValue(largeAssessment);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const result = await service.assignCommunitiesToUser('user-123');\n\n      expect(result).toContain('Depression Support Network');\n      // Should handle large data efficiently\n      expect(prismaService.community.findUnique).toHaveBeenCalledTimes(1); // Only for mapped questionnaire\n    });\n  });\n\n  describe('console logging', () => {\n    it('should log assignment progress and results', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(null);\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const consoleSpy = jest.spyOn(console, 'log').mockImplementation();\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Auto-assigning communities for user: user-123')\n      );\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Assigned user to community')\n      );\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Auto-assignment complete')\n      );\n\n      consoleSpy.mockRestore();\n    });\n\n    it('should log when no pre-assessment is found', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(null);\n\n      const consoleSpy = jest.spyOn(console, 'log').mockImplementation();\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('No pre-assessment found for user: user-123')\n      );\n\n      consoleSpy.mockRestore();\n    });\n\n    it('should log when community is not found', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findUnique.mockResolvedValue(null); // Community not found\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n\n      const consoleSpy = jest.spyOn(console, 'log').mockImplementation();\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('Community not found for slug')\n      );\n\n      consoleSpy.mockRestore();\n    });\n\n    it('should log when user is already a member', async () => {\n      prismaService.preAssessment.findFirst.mockResolvedValue(mockPreAssessment);\n      prismaService.community.findUnique.mockResolvedValue(mockCommunity);\n      prismaService.community.findFirst.mockResolvedValue(mockGeneralCommunity);\n      prismaService.membership.findUnique.mockResolvedValue(mockMembership); // Already a member\n      prismaService.membership.create.mockResolvedValue(mockMembership);\n\n      const consoleSpy = jest.spyOn(console, 'log').mockImplementation();\n\n      await service.assignCommunitiesToUser('user-123');\n\n      expect(consoleSpy).toHaveBeenCalledWith(\n        expect.stringContaining('User already member of')\n      );\n\n      consoleSpy.mockRestore();\n    });\n  });\n});"],"version":3}