{"version":3,"names":["websockets_1","cov_9q5gr7w5k","s","require","socket_io_1","common_1","prisma_client_provider_1","websocket_auth_service_1","MessagingGateway","MessagingGateway_1","prisma","webSocketAuth","server","logger","Logger","name","userSockets","Map","conversationParticipants","constructor","f","handleConnection","client","log","id","authResult","authenticateSocket","b","warn","emit","message","code","disconnect","userId","userRole","role","isAuthenticated","user","findUnique","where","isActive","select","has","set","Set","get","add","joinUserConversations","subscribeUserToPersonalRoom","timestamp","Date","toISOString","broadcastUserStatus","error","handleDisconnect","delete","size","conversationId","participants","entries","cleanupConnection","handleJoinConversation","data","participation","conversationParticipant","findFirst","join","to","handleLeaveConversation","leave","handleTypingIndicator","isTyping","typingIndicator","upsert","conversationId_userId","create","lastTypingAt","update","deleteMany","broadcastMessage","sendPushNotifications","broadcastMessageUpdate","messageId","broadcastReadReceipt","readAt","broadcastReaction","reaction","conversations","conversation","findMany","some","length","status","include","eligibleParticipants","filter","participant","senderId","defaultPushNewMessages","notificationPayload","title","body","content","substring","icon","badge","url","pushPromises","map","errorMessage","Error","Promise","allSettled","cleanupTypingIndicators","fiveMinutesAgo","now","lt","userRoom","debug","unsubscribeUserFromPersonalRoom","handleJoinCommunity","communityId","membership","communityRoom","handleLeaveCommunity","handleJoinPost","postId","post","room","roomGroup","community","memberships","postRoom","handleLeavePost","getServer","exports","__decorate","WebSocketServer","Server","_c","Object","SubscribeMessage","__param","ConnectedSocket","MessageBody","WebSocketGateway","cors","origin","process","env","FRONTEND_URL","credentials","namespace","PrismaService","_a","_b","WebSocketAuthService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.gateway.ts"],"sourcesContent":["import {\n  WebSocketGateway,\n  WebSocketServer,\n  SubscribeMessage,\n  OnGatewayConnection,\n  OnGatewayDisconnect,\n  ConnectedSocket,\n  MessageBody,\n} from '@nestjs/websockets';\nimport { Server, Socket } from 'socket.io';\nimport { Logger } from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { WebSocketAuthService } from './services/websocket-auth.service';\nimport type {\n  JoinConversationDto,\n  LeaveConversationDto,\n  TypingIndicatorDto,\n} from './types';\n\ninterface AuthenticatedSocket extends Socket {\n  userId?: string;\n  userRole?: string;\n  isAuthenticated?: boolean;\n}\n\n@WebSocketGateway({\n  cors: {\n    origin: process.env.FRONTEND_URL || 'http://localhost:3000',\n    credentials: true,\n  },\n  namespace: '/messaging',\n})\nexport class MessagingGateway\n  implements OnGatewayConnection, OnGatewayDisconnect\n{\n  @WebSocketServer()\n  server!: Server;\n\n  private readonly logger = new Logger(MessagingGateway.name);\n  private userSockets = new Map<string, Set<string>>(); // userId -> Set of socket IDs\n  private conversationParticipants = new Map<string, Set<string>>(); // conversationId -> Set of user IDs\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly webSocketAuth: WebSocketAuthService,\n  ) {}\n\n  async handleConnection(client: AuthenticatedSocket) {\n    try {\n      this.logger.log(`New WebSocket connection attempt: ${client.id}`);\n\n      // Authenticate the socket connection using the new auth service\n      const authResult = await this.webSocketAuth.authenticateSocket(client);\n\n      if (!authResult) {\n        this.logger.warn(`Client ${client.id} authentication failed`);\n        client.emit('auth_error', {\n          message: 'Authentication failed. Please provide a valid token.',\n          code: 'AUTH_FAILED',\n        });\n        client.disconnect(true);\n        return;\n      }\n\n      // Attach authenticated user info to socket\n      client.userId = authResult.userId;\n      client.userRole = authResult.role;\n      client.isAuthenticated = true;\n\n      // Verify user exists in database and is active\n      const user = await this.prisma.user.findUnique({\n        where: {\n          id: authResult.userId,\n          isActive: true, // Only allow active users\n        },\n        select: { id: true, role: true, isActive: true },\n      });\n\n      if (!user) {\n        this.logger.warn(`User ${authResult.userId} not found or inactive`);\n        client.emit('auth_error', {\n          message: 'User account not found or inactive',\n          code: 'USER_NOT_FOUND',\n        });\n        client.disconnect(true);\n        return;\n      }\n\n      // Add socket to user's socket set\n      if (!this.userSockets.has(authResult.userId)) {\n        this.userSockets.set(authResult.userId, new Set());\n      }\n      this.userSockets.get(authResult.userId)!.add(client.id);\n\n      // Join user to their conversation rooms\n      await this.joinUserConversations(client, authResult.userId);\n\n      // Subscribe user to their personal notification room\n      await this.subscribeUserToPersonalRoom(client, authResult.userId);\n\n      // Notify successful connection\n      client.emit('authenticated', {\n        userId: authResult.userId,\n        role: user.role,\n        message: 'Successfully authenticated and connected',\n        timestamp: new Date().toISOString(),\n      });\n\n      // Emit user online status to their contacts\n      await this.broadcastUserStatus(authResult.userId, 'online');\n\n      this.logger.log(\n        `User ${authResult.userId} successfully authenticated and connected with socket ${client.id}`,\n      );\n    } catch (error) {\n      this.logger.error(`Connection error for client ${client.id}:`, error);\n      client.emit('connection_error', {\n        message: 'Internal server error during connection',\n        code: 'INTERNAL_ERROR',\n      });\n      client.disconnect(true);\n    }\n  }\n\n  async handleDisconnect(client: AuthenticatedSocket) {\n    try {\n      if (client.userId) {\n        const userSockets = this.userSockets.get(client.userId);\n        if (userSockets) {\n          userSockets.delete(client.id);\n\n          // If no more sockets for this user, remove from tracking\n          if (userSockets.size === 0) {\n            this.userSockets.delete(client.userId);\n\n            // Clean up conversation participants tracking\n            for (const [\n              conversationId,\n              participants,\n            ] of this.conversationParticipants.entries()) {\n              participants.delete(client.userId);\n              // Remove empty conversation sets\n              if (participants.size === 0) {\n                this.conversationParticipants.delete(conversationId);\n              }\n            }\n\n            // Broadcast user offline status to their contacts\n            await this.broadcastUserStatus(client.userId, 'offline');\n          }\n        }\n\n        this.logger.log(\n          `User ${client.userId} disconnected socket ${client.id}`,\n        );\n      }\n\n      // Clean up authentication tracking\n      this.webSocketAuth.cleanupConnection(client.id);\n    } catch (error) {\n      this.logger.error(\n        `Error during disconnect cleanup for socket ${client.id}:`,\n        error,\n      );\n    }\n  }\n\n  @SubscribeMessage('join_conversation')\n  async handleJoinConversation(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: JoinConversationDto,\n  ) {\n    // Authentication guard\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    try {\n      const { conversationId } = data;\n      const userId = client.userId!;\n\n      // Verify user is a participant in this conversation\n      const participation = await this.prisma.conversationParticipant.findFirst(\n        {\n          where: {\n            conversationId,\n            userId,\n            isActive: true,\n          },\n        },\n      );\n\n      if (!participation) {\n        client.emit('error', { message: 'Access denied to this conversation' });\n        return;\n      }\n\n      // Join socket to conversation room\n      void client.join(conversationId);\n\n      // Add user to conversation participants tracking\n      if (!this.conversationParticipants.has(conversationId)) {\n        this.conversationParticipants.set(conversationId, new Set());\n      }\n      this.conversationParticipants.get(conversationId)!.add(userId);\n\n      // Notify other participants that user joined\n      client.to(conversationId).emit('user_joined_conversation', {\n        conversationId,\n        userId,\n      });\n\n      client.emit('conversation_joined', { conversationId });\n      this.logger.log(`User ${userId} joined conversation ${conversationId}`);\n    } catch (error) {\n      this.logger.error('Error joining conversation:', error);\n      client.emit('error', { message: 'Failed to join conversation' });\n    }\n  }\n\n  @SubscribeMessage('leave_conversation')\n  handleLeaveConversation(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: LeaveConversationDto,\n  ) {\n    // Authentication guard\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { conversationId } = data;\n    const userId = client.userId!;\n\n    void client.leave(conversationId);\n\n    // Remove user from conversation participants tracking\n    const participants = this.conversationParticipants.get(conversationId);\n    if (participants) {\n      participants.delete(userId);\n      if (participants.size === 0) {\n        this.conversationParticipants.delete(conversationId);\n      }\n    }\n\n    // Notify other participants that user left\n    client.to(conversationId).emit('user_left_conversation', {\n      conversationId,\n      userId,\n    });\n\n    client.emit('conversation_left', { conversationId });\n    this.logger.log(`User ${userId} left conversation ${conversationId}`);\n  }\n\n  @SubscribeMessage('typing_indicator')\n  async handleTypingIndicator(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: TypingIndicatorDto,\n  ) {\n    // Authentication guard\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { conversationId, isTyping = true } = data;\n    const userId = client.userId!;\n\n    // Update typing indicator in database for persistence\n    if (isTyping) {\n      await this.prisma.typingIndicator.upsert({\n        where: {\n          conversationId_userId: {\n            conversationId,\n            userId,\n          },\n        },\n        create: {\n          conversationId,\n          userId,\n          lastTypingAt: new Date(),\n        },\n        update: {\n          lastTypingAt: new Date(),\n        },\n      });\n    } else {\n      // Remove typing indicator when user stops typing\n      await this.prisma.typingIndicator.deleteMany({\n        where: {\n          conversationId,\n          userId,\n        },\n      });\n    }\n\n    // Broadcast typing indicator to other participants in the conversation\n    client.to(conversationId).emit('typing_indicator', {\n      conversationId,\n      userId,\n      isTyping,\n    });\n  }\n\n  // Broadcast new message to conversation participants\n  broadcastMessage(conversationId: string, message: any) {\n    this.server.to(conversationId).emit('new_message', message);\n\n    // Send push notification to offline users (implement as needed)\n    this.sendPushNotifications(conversationId, message);\n  }\n\n  // Broadcast message update (edit/delete)\n  broadcastMessageUpdate(\n    conversationId: string,\n    messageId: string,\n    update: any,\n  ) {\n    this.server.to(conversationId).emit('message_updated', {\n      messageId,\n      ...update,\n    });\n  }\n\n  // Broadcast read receipt\n  broadcastReadReceipt(\n    conversationId: string,\n    messageId: string,\n    userId: string,\n  ) {\n    this.server.to(conversationId).emit('message_read', {\n      messageId,\n      userId,\n      readAt: new Date(),\n    });\n  }\n\n  // Broadcast message reaction\n  broadcastReaction(conversationId: string, messageId: string, reaction: any) {\n    this.server.to(conversationId).emit('message_reaction', {\n      messageId,\n      reaction,\n    });\n  }\n\n  // Private helper methods\n  // Authentication guard for message handlers\n  private isAuthenticated(client: AuthenticatedSocket): boolean {\n    if (!client.isAuthenticated || !client.userId) {\n      this.logger.warn(\n        `Unauthenticated client ${client.id} attempted to perform action`,\n      );\n      client.emit('auth_error', {\n        message: 'Authentication required for this action',\n        code: 'AUTH_REQUIRED',\n      });\n      return false;\n    }\n    return true;\n  }\n\n  private async joinUserConversations(\n    client: AuthenticatedSocket,\n    userId: string,\n  ) {\n    try {\n      // Get all active conversations for the user\n      const conversations = await this.prisma.conversation.findMany({\n        where: {\n          participants: {\n            some: {\n              userId,\n              isActive: true,\n            },\n          },\n          isActive: true,\n        },\n        select: {\n          id: true,\n        },\n      });\n\n      // Join all conversation rooms\n      for (const conversation of conversations) {\n        void client.join(conversation.id);\n\n        // Add to tracking\n        if (!this.conversationParticipants.has(conversation.id)) {\n          this.conversationParticipants.set(conversation.id, new Set());\n        }\n        this.conversationParticipants.get(conversation.id)!.add(userId);\n      }\n\n      this.logger.log(\n        `User ${userId} joined ${conversations.length} conversation rooms`,\n      );\n    } catch (error) {\n      this.logger.error('Error joining user conversations:', error);\n    }\n  }\n\n  private async broadcastUserStatus(\n    userId: string,\n    status: 'online' | 'offline',\n  ) {\n    // Get all conversations this user participates in\n    const conversations = await this.prisma.conversation.findMany({\n      where: {\n        participants: {\n          some: {\n            userId,\n            isActive: true,\n          },\n        },\n      },\n      select: {\n        id: true,\n      },\n    });\n\n    // Broadcast status to all conversation rooms\n    for (const conversation of conversations) {\n      this.server.to(conversation.id).emit('user_status_changed', {\n        userId,\n        status,\n        timestamp: new Date(),\n      });\n    }\n  }\n\n  private async sendPushNotifications(conversationId: string, message: any) {\n    try {\n      // Get all participants in the conversation except the sender\n      const conversation = await this.prisma.conversation.findUnique({\n        where: { id: conversationId },\n        include: {\n          participants: {\n            include: {\n              user: true,\n            },\n          },\n        },\n      });\n\n      if (!conversation) {\n        this.logger.warn(\n          `Conversation ${conversationId} not found for push notifications`,\n        );\n        return;\n      }\n\n      // Filter participants who should receive push notifications\n      const eligibleParticipants = conversation.participants.filter(\n        (participant) => {\n          // Don't send to message sender\n          if (participant.userId === message.senderId) {\n            return false;\n          }\n\n          // Use default notification settings since notificationSettings model doesn't exist\n          // Default to true for push notifications for new messages\n          const defaultPushNewMessages = true;\n          if (!defaultPushNewMessages) {\n            return false;\n          }\n\n          // Note: No device token filtering available (no DeviceToken model)\n          // All participants are considered eligible for alternative notifications\n          return true;\n        },\n      );\n\n      if (eligibleParticipants.length === 0) {\n        this.logger.log(\n          `No eligible participants for push notifications in conversation ${conversationId}`,\n        );\n        return;\n      }\n\n      // Prepare notification payload\n      const notificationPayload = {\n        title: 'New Message',\n        body:\n          message.content.length > 50\n            ? `${message.content.substring(0, 50)}...`\n            : message.content,\n        icon: '/icon-192x192.png',\n        badge: '/badge-72x72.png',\n        data: {\n          conversationId: conversationId,\n          messageId: message.id,\n          senderId: message.senderId,\n          url: `/user/messages?conversation=${conversationId}`,\n        },\n      };\n\n      // Alternative notification approach (no device tokens available)\n      const pushPromises = eligibleParticipants.map(async (participant) => {\n        try {\n          // Log notification attempt (alternative to push notifications)\n          this.logger.log(\n            `Would send push notification to user ${participant.userId} for message ${message.id} (no DeviceToken model available)`,\n          );\n          \n          // Here you could implement WebSocket-based real-time notifications\n          // or other alternative notification methods\n          \n        } catch (error) {\n          const errorMessage =\n            error instanceof Error ? error.message : 'Unknown error';\n          this.logger.error(\n            `Failed to process notification for user ${participant.userId}: ${errorMessage}`,\n          );\n        }\n      });\n\n      await Promise.allSettled(pushPromises);\n\n      this.logger.log(\n        `Push notification processing completed for conversation ${conversationId}`,\n      );\n    } catch (error) {\n      this.logger.error(\n        `Failed to send push notifications for conversation ${conversationId}:`,\n        error,\n      );\n    }\n  }\n\n  // Clean up old typing indicators (call this periodically)\n  async cleanupTypingIndicators() {\n    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);\n\n    await this.prisma.typingIndicator.deleteMany({\n      where: {\n        lastTypingAt: {\n          lt: fiveMinutesAgo,\n        },\n      },\n    });\n  }\n\n  // Personal room subscription methods for real-time notifications\n  async subscribeUserToPersonalRoom(\n    client: AuthenticatedSocket,\n    userId: string,\n  ) {\n    const userRoom = `user_${userId}`;\n    await client.join(userRoom);\n    this.logger.debug(\n      `User ${userId} subscribed to personal room: ${userRoom}`,\n    );\n  }\n\n  async unsubscribeUserFromPersonalRoom(\n    client: AuthenticatedSocket,\n    userId: string,\n  ) {\n    const userRoom = `user_${userId}`;\n    await client.leave(userRoom);\n    this.logger.debug(\n      `User ${userId} unsubscribed from personal room: ${userRoom}`,\n    );\n  }\n\n  // Community and post room subscriptions for social features\n  @SubscribeMessage('join_community')\n  async handleJoinCommunity(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { communityId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { communityId } = data;\n    const userId = client.userId!;\n\n    try {\n      // Verify user is a member of this community\n      const membership = await this.prisma.membership.findFirst({\n        where: {\n          communityId,\n          userId,\n        },\n      });\n\n      if (!membership) {\n        client.emit('error', { message: 'Access denied to this community' });\n        return;\n      }\n\n      const communityRoom = `community_${communityId}`;\n      await client.join(communityRoom);\n\n      client.emit('community_joined', { communityId });\n      this.logger.log(`User ${userId} joined community room ${communityId}`);\n    } catch (error) {\n      this.logger.error('Error joining community:', error);\n      client.emit('error', { message: 'Failed to join community' });\n    }\n  }\n\n  @SubscribeMessage('leave_community')\n  async handleLeaveCommunity(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { communityId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { communityId } = data;\n    const userId = client.userId!;\n\n    const communityRoom = `community_${communityId}`;\n    await client.leave(communityRoom);\n\n    client.emit('community_left', { communityId });\n    this.logger.log(`User ${userId} left community room ${communityId}`);\n  }\n\n  @SubscribeMessage('join_post')\n  async handleJoinPost(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { postId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { postId } = data;\n    const userId = client.userId!;\n\n    try {\n      // Verify post exists and user has access\n      const post = await this.prisma.post.findFirst({\n        where: {\n          id: postId,\n          room: {\n            roomGroup: {\n              community: {\n                memberships: {\n                  some: {\n                    userId,\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!post) {\n        client.emit('error', { message: 'Access denied to this post' });\n        return;\n      }\n\n      const postRoom = `post_${postId}`;\n      await client.join(postRoom);\n\n      client.emit('post_joined', { postId });\n      this.logger.log(`User ${userId} joined post room ${postId}`);\n    } catch (error) {\n      this.logger.error('Error joining post:', error);\n      client.emit('error', { message: 'Failed to join post' });\n    }\n  }\n\n  @SubscribeMessage('leave_post')\n  async handleLeavePost(\n    @ConnectedSocket() client: AuthenticatedSocket,\n    @MessageBody() data: { postId: string },\n  ) {\n    if (!this.isAuthenticated(client)) {\n      return;\n    }\n\n    const { postId } = data;\n    const userId = client.userId!;\n\n    const postRoom = `post_${postId}`;\n    await client.leave(postRoom);\n\n    client.emit('post_left', { postId });\n    this.logger.log(`User ${userId} left post room ${postId}`);\n  }\n\n  // Utility method to get server instance for event broadcasting\n  getServer(): Server {\n    return this.server;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}