46f90f5aa16291a1e0360aa51a08194f
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TherapistRecommendationController = void 0;
const common_1 = require("@nestjs/common");
const therapist_recommendation_service_1 = require("./therapist-recommendation.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../auth/decorators/current-user-id.decorator");
const zod_validation_pipe_1 = require("../common/pipes/zod-validation.pipe");
const swagger_1 = require("@nestjs/swagger");
const commons_1 = require("@mentara/commons");
let TherapistRecommendationController = class TherapistRecommendationController {
    therapistRecommendationService;
    prisma;
    constructor(therapistRecommendationService, prisma) {
        this.therapistRecommendationService = therapistRecommendationService;
        this.prisma = prisma;
    }
    async getRecommendedTherapists(clerkId, query) {
        try {
            const user = await this.prisma.user.findUnique({
                where: { id: clerkId },
            });
            if (!user) {
                throw new common_1.NotFoundException(`User with ID ${clerkId} not found`);
            }
            const request = {
                userId: user.id,
                limit: query.limit,
                includeInactive: query.includeInactive,
                province: query.province,
                maxHourlyRate: query.maxHourlyRate,
            };
            return await this.therapistRecommendationService.getRecommendedTherapists(request);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : error);
        }
    }
    async getCompatibilityAnalysis(clerkId, therapistId) {
        try {
            const user = await this.prisma.user.findUnique({
                where: { id: clerkId },
            });
            if (!user) {
                throw new common_1.NotFoundException(`User with ID ${clerkId} not found`);
            }
            return await this.therapistRecommendationService.getCompatibilityAnalysis(user.id, therapistId);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : error);
        }
    }
    async getWelcomeRecommendations(userId, query) {
        try {
            // Verify user exists and get client status
            const [user, client] = await Promise.all([
                this.prisma.user.findUnique({
                    where: { id: userId },
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        role: true,
                        createdAt: true,
                    },
                }),
                this.prisma.client.findUnique({
                    where: { userId },
                    select: {
                        hasSeenTherapistRecommendations: true,
                        createdAt: true,
                    },
                }),
            ]);
            if (!user) {
                throw new common_1.NotFoundException(`User with ID ${userId} not found`);
            }
            if (!client) {
                throw new common_1.NotFoundException(`Client profile not found for user ${userId}`);
            }
            // Check if this is truly a first-time user (unless forcing refresh)
            const isFirstTime = !client.hasSeenTherapistRecommendations;
            const shouldShowWelcome = isFirstTime || query.forceRefresh;
            if (!shouldShowWelcome) {
                // User has already seen recommendations, redirect to regular recommendations
                return {
                    isFirstTime: false,
                    redirectTo: '/therapist-recommendations',
                    message: 'User has already completed welcome flow',
                    lastSeenAt: client.createdAt,
                };
            }
            // Get personalized welcome recommendations
            const request = {
                userId: user.id,
                limit: query.limit,
                includeInactive: false, // Only active therapists for welcome
                province: query.province,
                maxHourlyRate: undefined, // No rate filter for initial welcome
            };
            const recommendations = await this.therapistRecommendationService.getRecommendedTherapists(request);
            // Enhance recommendations with welcome-specific data
            const enhancedRecommendations = {
                ...recommendations,
                welcomeMessage: this.generateWelcomeMessage(user.firstName, isFirstTime),
                isFirstTime,
                userInfo: {
                    firstName: user.firstName,
                    memberSince: user.createdAt,
                    needsOnboarding: isFirstTime,
                },
                nextSteps: {
                    canSendRequests: true,
                    recommendedActions: [
                        'Browse therapist profiles',
                        'Send requests to therapists you find interesting',
                        'Complete your profile for better matches',
                        'Take the mental health assessment for personalized recommendations',
                    ],
                },
                matchingInsights: {
                    totalAvailableTherapists: recommendations.totalCount,
                    recommendationEngine: 'AI-powered compatibility matching',
                    lastUpdated: new Date(),
                },
            };
            return enhancedRecommendations;
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : error);
        }
    }
    generateWelcomeMessage(firstName, isFirstTime) {
        if (isFirstTime) {
            return `Welcome to Mentara, ${firstName}! We've curated a personalized list of therapists who may be a great fit for you. Take your time browsing through their profiles and don't hesitate to reach out to those who resonate with you.`;
        }
        else {
            return `Welcome back, ${firstName}! Here are some fresh therapist recommendations based on your preferences and our latest matching insights.`;
        }
    }
};
exports.TherapistRecommendationController = TherapistRecommendationController;
__decorate([
    (0, common_1.Get)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get recommended therapists',
        description: 'Retrieve get recommended therapists'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(commons_1.TherapistRecommendationQuerySchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], TherapistRecommendationController.prototype, "getRecommendedTherapists", null);
__decorate([
    (0, common_1.Get)('compatibility/:therapistId'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get compatibility analysis',
        description: 'Retrieve get compatibility analysis'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('therapistId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], TherapistRecommendationController.prototype, "getCompatibilityAnalysis", null);
__decorate([
    (0, common_1.Get)('welcome'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get welcome recommendations',
        description: 'Retrieve get welcome recommendations'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(commons_1.WelcomeRecommendationQuerySchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", Promise)
], TherapistRecommendationController.prototype, "getWelcomeRecommendations", null);
exports.TherapistRecommendationController = TherapistRecommendationController = __decorate([
    (0, swagger_1.ApiTags)('therapist-recommendation'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('therapist-recommendations'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof therapist_recommendation_service_1.TherapistRecommendationService !== "undefined" && therapist_recommendation_service_1.TherapistRecommendationService) === "function" ? _a : Object, typeof (_b = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _b : Object])
], TherapistRecommendationController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC90aGVyYXBpc3QtcmVjb21tZW5kYXRpb24uY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBVXdCO0FBQ3hCLHlGQUFvRjtBQUNwRixnRkFBb0U7QUFDcEUsa0VBQTZEO0FBQzdELDRGQUE2RTtBQUM3RSw2RUFBd0U7QUFDeEUsNkNBUXlCO0FBQ3pCLDhDQVMwQjtBQU1uQixJQUFNLGlDQUFpQyxHQUF2QyxNQUFNLGlDQUFpQztJQUV6QjtJQUNBO0lBRm5CLFlBQ21CLDhCQUE4RCxFQUM5RCxNQUFxQjtRQURyQixtQ0FBOEIsR0FBOUIsOEJBQThCLENBQWdDO1FBQzlELFdBQU0sR0FBTixNQUFNLENBQWU7SUFDckMsQ0FBQztJQWtDRSxBQUFOLEtBQUssQ0FBQyx3QkFBd0IsQ0FDWCxPQUFlLEVBRWhDLEtBQW1DO1FBRW5DLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO2dCQUM3QyxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFO2FBQ3ZCLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDVixNQUFNLElBQUksMEJBQWlCLENBQUMsZ0JBQWdCLE9BQU8sWUFBWSxDQUFDLENBQUM7WUFDbkUsQ0FBQztZQUVELE1BQU0sT0FBTyxHQUFtQztnQkFDOUMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFO2dCQUNmLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsZUFBZSxFQUFFLEtBQUssQ0FBQyxlQUFlO2dCQUN0QyxRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3hCLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTthQUNuQyxDQUFDO1lBQ0YsT0FBTyxNQUFNLElBQUksQ0FBQyw4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LG9CQUE5QixpRUFBOEIsb0RBQ3RELHNDQUFhLG9CQUFiLHNDQUFhO0dBSDdCLGlDQUFpQyxDQXNSN0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC90aGVyYXBpc3QtcmVjb21tZW5kYXRpb24uY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb250cm9sbGVyLFxuICBHZXQsXG4gIFF1ZXJ5LFxuICBQYXJhbSxcbiAgVXNlR3VhcmRzLFxuICBIdHRwQ29kZSxcbiAgSHR0cFN0YXR1cyxcbiAgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbixcbiAgTm90Rm91bmRFeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uU2VydmljZSB9IGZyb20gJy4vdGhlcmFwaXN0LXJlY29tbWVuZGF0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEN1cnJlbnRVc2VySWQgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLWlkLmRlY29yYXRvcic7XG5pbXBvcnQgeyBab2RWYWxpZGF0aW9uUGlwZSB9IGZyb20gJy4uL2NvbW1vbi9waXBlcy96b2QtdmFsaWRhdGlvbi5waXBlJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJvZHksXG4gIEFwaUJlYXJlckF1dGgsXG4gIEFwaVBhcmFtLFxuICBBcGlRdWVyeSxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7XG4gIFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uUmVxdWVzdFNjaGVtYSxcbiAgVGhlcmFwaXN0UmVjb21tZW5kYXRpb25SZXNwb25zZUR0b1NjaGVtYSxcbiAgVGhlcmFwaXN0UmVjb21tZW5kYXRpb25RdWVyeVNjaGVtYSxcbiAgV2VsY29tZVJlY29tbWVuZGF0aW9uUXVlcnlTY2hlbWEsXG4gIHR5cGUgVGhlcmFwaXN0UmVjb21tZW5kYXRpb25SZXF1ZXN0LFxuICB0eXBlIFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uUmVzcG9uc2VEdG8sXG4gIHR5cGUgVGhlcmFwaXN0UmVjb21tZW5kYXRpb25RdWVyeSxcbiAgdHlwZSBXZWxjb21lUmVjb21tZW5kYXRpb25RdWVyeSxcbn0gZnJvbSAnQG1lbnRhcmEvY29tbW9ucyc7XG5cbkBBcGlUYWdzKCd0aGVyYXBpc3QtcmVjb21tZW5kYXRpb24nKVxuQEFwaUJlYXJlckF1dGgoJ0pXVC1hdXRoJylcbkBDb250cm9sbGVyKCd0aGVyYXBpc3QtcmVjb21tZW5kYXRpb25zJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgdGhlcmFwaXN0UmVjb21tZW5kYXRpb25TZXJ2aWNlOiBUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UsXG4gICkge31cblxuICBAR2V0KClcblxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuXG4gICAgc3VtbWFyeTogJ1JldHJpZXZlIGdldCByZWNvbW1lbmRlZCB0aGVyYXBpc3RzJyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSBnZXQgcmVjb21tZW5kZWQgdGhlcmFwaXN0cycgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cblxuICBcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIGdldFJlY29tbWVuZGVkVGhlcmFwaXN0cyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIGNsZXJrSWQ6IHN0cmluZyxcbiAgICBAUXVlcnkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uUXVlcnlTY2hlbWEpKVxuICAgIHF1ZXJ5OiBUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblF1ZXJ5LFxuICApOiBQcm9taXNlPFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uUmVzcG9uc2VEdG8+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjbGVya0lkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihgVXNlciB3aXRoIElEICR7Y2xlcmtJZH0gbm90IGZvdW5kYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uUmVxdWVzdCA9IHtcbiAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICBsaW1pdDogcXVlcnkubGltaXQsXG4gICAgICAgIGluY2x1ZGVJbmFjdGl2ZTogcXVlcnkuaW5jbHVkZUluYWN0aXZlLFxuICAgICAgICBwcm92aW5jZTogcXVlcnkucHJvdmluY2UsXG4gICAgICAgIG1heEhvdXJseVJhdGU6IHF1ZXJ5Lm1heEhvdXJseVJhdGUsXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudGhlcmFwaXN0UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGVkVGhlcmFwaXN0cyhcbiAgICAgICAgcmVxdWVzdCxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3IsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ2NvbXBhdGliaWxpdHkvOnRoZXJhcGlzdElkJylcblxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuXG4gICAgc3VtbWFyeTogJ1JldHJpZXZlIGdldCBjb21wYXRpYmlsaXR5IGFuYWx5c2lzJyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSBnZXQgY29tcGF0aWJpbGl0eSBhbmFseXNpcycgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cblxuICBcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIGdldENvbXBhdGliaWxpdHlBbmFseXNpcyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIGNsZXJrSWQ6IHN0cmluZyxcbiAgICBAUGFyYW0oJ3RoZXJhcGlzdElkJykgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY2xlcmtJZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oYFVzZXIgd2l0aCBJRCAke2NsZXJrSWR9IG5vdCBmb3VuZGApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50aGVyYXBpc3RSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0Q29tcGF0aWJpbGl0eUFuYWx5c2lzKFxuICAgICAgICB1c2VyLmlkLFxuICAgICAgICB0aGVyYXBpc3RJZCxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3IsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ3dlbGNvbWUnKVxuXG5cbiAgQEFwaU9wZXJhdGlvbih7IFxuXG5cbiAgICBzdW1tYXJ5OiAnUmV0cmlldmUgZ2V0IHdlbGNvbWUgcmVjb21tZW5kYXRpb25zJyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSBnZXQgd2VsY29tZSByZWNvbW1lbmRhdGlvbnMnIFxuXG5cbiAgfSlcblxuXG4gIEBBcGlSZXNwb25zZSh7IFxuXG5cbiAgICBzdGF0dXM6IDIwMCwgXG5cblxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBhc3luYyBnZXRXZWxjb21lUmVjb21tZW5kYXRpb25zKFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShXZWxjb21lUmVjb21tZW5kYXRpb25RdWVyeVNjaGVtYSkpXG4gICAgcXVlcnk6IFdlbGNvbWVSZWNvbW1lbmRhdGlvblF1ZXJ5LFxuICApIHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZ5IHVzZXIgZXhpc3RzIGFuZCBnZXQgY2xpZW50IHN0YXR1c1xuICAgICAgY29uc3QgW3VzZXIsIGNsaWVudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHRoaXMucHJpc21hLmNsaWVudC5maW5kVW5pcXVlKHtcbiAgICAgICAgICB3aGVyZTogeyB1c2VySWQgfSxcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICBdKTtcblxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihgVXNlciB3aXRoIElEICR7dXNlcklkfSBub3QgZm91bmRgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFxuICAgICAgICAgIGBDbGllbnQgcHJvZmlsZSBub3QgZm91bmQgZm9yIHVzZXIgJHt1c2VySWR9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyB0cnVseSBhIGZpcnN0LXRpbWUgdXNlciAodW5sZXNzIGZvcmNpbmcgcmVmcmVzaClcbiAgICAgIGNvbnN0IGlzRmlyc3RUaW1lID0gIWNsaWVudC5oYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zO1xuICAgICAgY29uc3Qgc2hvdWxkU2hvd1dlbGNvbWUgPSBpc0ZpcnN0VGltZSB8fCBxdWVyeS5mb3JjZVJlZnJlc2g7XG5cbiAgICAgIGlmICghc2hvdWxkU2hvd1dlbGNvbWUpIHtcbiAgICAgICAgLy8gVXNlciBoYXMgYWxyZWFkeSBzZWVuIHJlY29tbWVuZGF0aW9ucywgcmVkaXJlY3QgdG8gcmVndWxhciByZWNvbW1lbmRhdGlvbnNcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpc0ZpcnN0VGltZTogZmFsc2UsXG4gICAgICAgICAgcmVkaXJlY3RUbzogJy90aGVyYXBpc3QtcmVjb21tZW5kYXRpb25zJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBoYXMgYWxyZWFkeSBjb21wbGV0ZWQgd2VsY29tZSBmbG93JyxcbiAgICAgICAgICBsYXN0U2VlbkF0OiBjbGllbnQuY3JlYXRlZEF0LFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgcGVyc29uYWxpemVkIHdlbGNvbWUgcmVjb21tZW5kYXRpb25zXG4gICAgICBjb25zdCByZXF1ZXN0OiBUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblJlcXVlc3QgPSB7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgbGltaXQ6IHF1ZXJ5LmxpbWl0LFxuICAgICAgICBpbmNsdWRlSW5hY3RpdmU6IGZhbHNlLCAvLyBPbmx5IGFjdGl2ZSB0aGVyYXBpc3RzIGZvciB3ZWxjb21lXG4gICAgICAgIHByb3ZpbmNlOiBxdWVyeS5wcm92aW5jZSxcbiAgICAgICAgbWF4SG91cmx5UmF0ZTogdW5kZWZpbmVkLCAvLyBObyByYXRlIGZpbHRlciBmb3IgaW5pdGlhbCB3ZWxjb21lXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPVxuICAgICAgICBhd2FpdCB0aGlzLnRoZXJhcGlzdFJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRlZFRoZXJhcGlzdHMoXG4gICAgICAgICAgcmVxdWVzdCxcbiAgICAgICAgKTtcblxuICAgICAgLy8gRW5oYW5jZSByZWNvbW1lbmRhdGlvbnMgd2l0aCB3ZWxjb21lLXNwZWNpZmljIGRhdGFcbiAgICAgIGNvbnN0IGVuaGFuY2VkUmVjb21tZW5kYXRpb25zID0ge1xuICAgICAgICAuLi5yZWNvbW1lbmRhdGlvbnMsXG4gICAgICAgIHdlbGNvbWVNZXNzYWdlOiB0aGlzLmdlbmVyYXRlV2VsY29tZU1lc3NhZ2UoXG4gICAgICAgICAgdXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgaXNGaXJzdFRpbWUsXG4gICAgICAgICksXG4gICAgICAgIGlzRmlyc3RUaW1lLFxuICAgICAgICB1c2VySW5mbzoge1xuICAgICAgICAgIGZpcnN0TmFtZTogdXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgbWVtYmVyU2luY2U6IHVzZXIuY3JlYXRlZEF0LFxuICAgICAgICAgIG5lZWRzT25ib2FyZGluZzogaXNGaXJzdFRpbWUsXG4gICAgICAgIH0sXG4gICAgICAgIG5leHRTdGVwczoge1xuICAgICAgICAgIGNhblNlbmRSZXF1ZXN0czogdHJ1ZSxcbiAgICAgICAgICByZWNvbW1lbmRlZEFjdGlvbnM6IFtcbiAgICAgICAgICAgICdCcm93c2UgdGhlcmFwaXN0IHByb2ZpbGVzJyxcbiAgICAgICAgICAgICdTZW5kIHJlcXVlc3RzIHRvIHRoZXJhcGlzdHMgeW91IGZpbmQgaW50ZXJlc3RpbmcnLFxuICAgICAgICAgICAgJ0NvbXBsZXRlIHlvdXIgcHJvZmlsZSBmb3IgYmV0dGVyIG1hdGNoZXMnLFxuICAgICAgICAgICAgJ1Rha2UgdGhlIG1lbnRhbCBoZWFsdGggYXNzZXNzbWVudCBmb3IgcGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAgbWF0Y2hpbmdJbnNpZ2h0czoge1xuICAgICAgICAgIHRvdGFsQXZhaWxhYmxlVGhlcmFwaXN0czogcmVjb21tZW5kYXRpb25zLnRvdGFsQ291bnQsXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25FbmdpbmU6ICdBSS1wb3dlcmVkIGNvbXBhdGliaWxpdHkgbWF0Y2hpbmcnLFxuICAgICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIGVuaGFuY2VkUmVjb21tZW5kYXRpb25zO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IGVycm9yLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlV2VsY29tZU1lc3NhZ2UoXG4gICAgZmlyc3ROYW1lOiBzdHJpbmcsXG4gICAgaXNGaXJzdFRpbWU6IGJvb2xlYW4sXG4gICk6IHN0cmluZyB7XG4gICAgaWYgKGlzRmlyc3RUaW1lKSB7XG4gICAgICByZXR1cm4gYFdlbGNvbWUgdG8gTWVudGFyYSwgJHtmaXJzdE5hbWV9ISBXZSd2ZSBjdXJhdGVkIGEgcGVyc29uYWxpemVkIGxpc3Qgb2YgdGhlcmFwaXN0cyB3aG8gbWF5IGJlIGEgZ3JlYXQgZml0IGZvciB5b3UuIFRha2UgeW91ciB0aW1lIGJyb3dzaW5nIHRocm91Z2ggdGhlaXIgcHJvZmlsZXMgYW5kIGRvbid0IGhlc2l0YXRlIHRvIHJlYWNoIG91dCB0byB0aG9zZSB3aG8gcmVzb25hdGUgd2l0aCB5b3UuYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBXZWxjb21lIGJhY2ssICR7Zmlyc3ROYW1lfSEgSGVyZSBhcmUgc29tZSBmcmVzaCB0aGVyYXBpc3QgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIHlvdXIgcHJlZmVyZW5jZXMgYW5kIG91ciBsYXRlc3QgbWF0Y2hpbmcgaW5zaWdodHMuYDtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==