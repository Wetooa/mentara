38d09d9ad3f9a731479725037c18b720
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const request = require("supertest");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const messaging_module_1 = require("../../messaging/messaging.module");
const database_test_setup_1 = require("../database-test.setup");
const client_1 = require("@prisma/client");
describe('Messaging Integration Tests', () => {
    let app;
    let prisma;
    let moduleRef;
    let clientId;
    let therapistId;
    let conversationId;
    beforeAll(async () => {
        // Setup test database
        prisma = await database_test_setup_1.DatabaseTestSetup.setupTestDatabase();
        moduleRef = await testing_1.Test.createTestingModule({
            imports: [messaging_module_1.MessagingModule],
            providers: [
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: prisma,
                },
            ],
        }).compile();
        app = moduleRef.createNestApplication();
        await app.init();
        // Create test users and conversation
        await setupTestData();
    });
    afterEach(async () => {
        // Clean messages after each test but keep users and conversation
        await prisma.message.deleteMany();
    });
    afterAll(async () => {
        await database_test_setup_1.DatabaseTestSetup.stopContainer();
        await app.close();
        await moduleRef.close();
    });
    async function setupTestData() {
        // Create users
        const clientUser = await prisma.user.create({
            data: {
                id: 'client-msg-123',
                email: 'client.msg@test.com',
                firstName: 'Client',
                lastName: 'User',
                role: 'client',
            },
        });
        clientId = clientUser.id;
        const therapistUser = await prisma.user.create({
            data: {
                id: 'therapist-msg-123',
                email: 'therapist.msg@test.com',
                firstName: 'Therapist',
                lastName: 'User',
                role: 'therapist',
            },
        });
        therapistId = therapistUser.id;
        // Create conversation
        const conversation = await prisma.conversation.create({
            data: {
                id: 'test-conversation-123',
                type: client_1.ConversationType.DIRECT,
            },
        });
        conversationId = conversation.id;
        // Create conversation participants
        await prisma.conversationParticipant.createMany({
            data: [
                {
                    id: 'participant-1',
                    conversationId: conversationId,
                    userId: clientId,
                    joinedAt: new Date(),
                },
                {
                    id: 'participant-2',
                    conversationId: conversationId,
                    userId: therapistId,
                    joinedAt: new Date(),
                },
            ],
        });
    }
    describe('POST /messaging/conversations/:id/messages', () => {
        it('should send a message successfully', async () => {
            const messageData = {
                content: 'Hello, this is a test message',
                messageType: client_1.MessageType.TEXT,
            };
            const response = await request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .send(messageData)
                .expect(201);
            expect(response.body).toMatchObject({
                success: true,
                data: expect.objectContaining({
                    id: expect.any(String),
                    content: 'Hello, this is a test message',
                    senderId: clientId,
                    conversationId: conversationId,
                    messageType: client_1.MessageType.TEXT,
                }),
            });
            // Verify in database
            const message = await prisma.message.findFirst({
                where: { conversationId: conversationId },
            });
            expect(message).toBeTruthy();
            expect(message?.content).toBe('Hello, this is a test message');
            expect(message?.senderId).toBe(clientId);
        });
        it('should reject messages from non-participants', async () => {
            // Create a non-participant user
            const outsiderUser = await prisma.user.create({
                data: {
                    id: 'outsider-123',
                    email: 'outsider@test.com',
                    firstName: 'Outsider',
                    lastName: 'User',
                    role: 'client',
                },
            });
            const messageData = {
                content: 'This should be rejected',
                messageType: client_1.MessageType.TEXT,
            };
            await request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', outsiderUser.id)
                .send(messageData)
                .expect(403);
        });
        it('should validate message content', async () => {
            const invalidMessageData = {
                content: '', // Empty content
                messageType: client_1.MessageType.TEXT,
            };
            await request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .send(invalidMessageData)
                .expect(400);
        });
        it('should handle different message types', async () => {
            const imageMessageData = {
                content: 'image.jpg',
                messageType: 'IMAGE',
                metadata: JSON.stringify({
                    fileName: 'image.jpg',
                    fileSize: 1024,
                    mimeType: 'image/jpeg',
                }),
            };
            const response = await request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .send(imageMessageData)
                .expect(201);
            expect(response.body.data.messageType).toBe('IMAGE');
            expect(JSON.parse(response.body.data.metadata || '{}')).toMatchObject({
                fileName: 'image.jpg',
                fileSize: 1024,
            });
        });
    });
    describe('GET /messaging/conversations/:id/messages', () => {
        beforeEach(async () => {
            // Create test messages
            const messages = [
                {
                    id: 'msg-1',
                    conversationId: conversationId,
                    senderId: clientId,
                    content: 'First message',
                    messageType: client_1.MessageType.TEXT,
                    createdAt: new Date('2024-01-01T10:00:00Z'),
                },
                {
                    id: 'msg-2',
                    conversationId: conversationId,
                    senderId: therapistId,
                    content: 'Second message',
                    messageType: client_1.MessageType.TEXT,
                    createdAt: new Date('2024-01-01T10:01:00Z'),
                },
                {
                    id: 'msg-3',
                    conversationId: conversationId,
                    senderId: clientId,
                    content: 'Third message',
                    messageType: client_1.MessageType.TEXT,
                    createdAt: new Date('2024-01-01T10:02:00Z'),
                },
            ];
            await prisma.message.createMany({ data: messages });
        });
        it('should retrieve conversation messages', async () => {
            const response = await request(app.getHttpServer())
                .get(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .expect(200);
            expect(response.body.success).toBe(true);
            expect(response.body.data).toHaveLength(3);
            // Should be ordered by createdAt desc (newest first)
            const messages = response.body.data;
            expect(messages[0].content).toBe('Third message');
            expect(messages[1].content).toBe('Second message');
            expect(messages[2].content).toBe('First message');
        });
        it('should support pagination', async () => {
            const response = await request(app.getHttpServer())
                .get(`/messaging/conversations/${conversationId}/messages?limit=2&offset=1`)
                .set('x-user-id', clientId)
                .expect(200);
            expect(response.body.data).toHaveLength(2);
            expect(response.body.data[0].content).toBe('Second message');
            expect(response.body.data[1].content).toBe('First message');
        });
        it('should include sender information', async () => {
            const response = await request(app.getHttpServer())
                .get(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .expect(200);
            expect(response.body.data[0]).toMatchObject({
                senderId: clientId,
                sender: expect.objectContaining({
                    id: clientId,
                    firstName: 'Client',
                    lastName: 'User',
                }),
            });
        });
        it('should reject access from non-participants', async () => {
            const outsiderUser = await prisma.user.create({
                data: {
                    id: 'outsider-msg-123',
                    email: 'outsider.msg@test.com',
                    firstName: 'Outsider',
                    lastName: 'User',
                    role: 'client',
                },
            });
            await request(app.getHttpServer())
                .get(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', outsiderUser.id)
                .expect(403);
        });
    });
    describe('PUT /messaging/messages/:id', () => {
        let messageId;
        beforeEach(async () => {
            const message = await prisma.message.create({
                data: {
                    id: 'editable-msg-123',
                    conversationId: conversationId,
                    senderId: clientId,
                    content: 'Original message',
                    messageType: client_1.MessageType.TEXT,
                    createdAt: new Date(),
                },
            });
            messageId = message.id;
        });
        it('should edit own message successfully', async () => {
            const updateData = {
                content: 'Edited message content',
            };
            const response = await request(app.getHttpServer())
                .put(`/messaging/messages/${messageId}`)
                .set('x-user-id', clientId)
                .send(updateData)
                .expect(200);
            expect(response.body).toMatchObject({
                success: true,
                data: expect.objectContaining({
                    id: messageId,
                    content: 'Edited message content',
                    isEdited: true,
                    editedAt: expect.any(String),
                }),
            });
            // Verify in database
            const updatedMessage = await prisma.message.findUnique({
                where: { id: messageId },
            });
            expect(updatedMessage?.content).toBe('Edited message content');
            expect(updatedMessage?.isEdited).toBe(true);
            expect(updatedMessage?.editedAt).toBeTruthy();
        });
        it('should prevent editing others messages', async () => {
            const updateData = {
                content: 'Should not be able to edit this',
            };
            await request(app.getHttpServer())
                .put(`/messaging/messages/${messageId}`)
                .set('x-user-id', therapistId) // Different user
                .send(updateData)
                .expect(403);
        });
        it('should prevent editing old messages', async () => {
            // Create an old message (more than edit time limit)
            const oldMessage = await prisma.message.create({
                data: {
                    id: 'old-msg-123',
                    conversationId: conversationId,
                    senderId: clientId,
                    content: 'Old message',
                    messageType: client_1.MessageType.TEXT,
                    createdAt: new Date(Date.now() - 25 * 60 * 60 * 1000), // 25 hours ago
                },
            });
            const updateData = {
                content: 'Trying to edit old message',
            };
            await request(app.getHttpServer())
                .put(`/messaging/messages/${oldMessage.id}`)
                .set('x-user-id', clientId)
                .send(updateData)
                .expect(400);
        });
    });
    describe('DELETE /messaging/messages/:id', () => {
        let messageId;
        beforeEach(async () => {
            const message = await prisma.message.create({
                data: {
                    id: 'deletable-msg-123',
                    conversationId: conversationId,
                    senderId: clientId,
                    content: 'Message to delete',
                    messageType: client_1.MessageType.TEXT,
                    createdAt: new Date(),
                },
            });
            messageId = message.id;
        });
        it('should delete own message successfully', async () => {
            await request(app.getHttpServer())
                .delete(`/messaging/messages/${messageId}`)
                .set('x-user-id', clientId)
                .expect(200);
            // Verify soft deletion in database
            const deletedMessage = await prisma.message.findUnique({
                where: { id: messageId },
            });
            expect(deletedMessage?.isDeleted).toBe(true);
        });
        it('should prevent deleting others messages', async () => {
            await request(app.getHttpServer())
                .delete(`/messaging/messages/${messageId}`)
                .set('x-user-id', therapistId) // Different user
                .expect(403);
        });
        it('should handle already deleted messages', async () => {
            // First deletion
            await request(app.getHttpServer())
                .delete(`/messaging/messages/${messageId}`)
                .set('x-user-id', clientId)
                .expect(200);
            // Second deletion attempt
            await request(app.getHttpServer())
                .delete(`/messaging/messages/${messageId}`)
                .set('x-user-id', clientId)
                .expect(400);
        });
    });
    describe('Message Read Receipts', () => {
        let messageId;
        beforeEach(async () => {
            const message = await prisma.message.create({
                data: {
                    id: 'readable-msg-123',
                    conversationId: conversationId,
                    senderId: clientId,
                    content: 'Message to mark as read',
                    messageType: client_1.MessageType.TEXT,
                },
            });
            messageId = message.id;
        });
        it('should mark message as read', async () => {
            await request(app.getHttpServer())
                .post(`/messaging/messages/${messageId}/read`)
                .set('x-user-id', therapistId)
                .expect(200);
            // Verify read receipt in database
            const readReceipt = await prisma.messageReadReceipt.findFirst({
                where: {
                    messageId: messageId,
                    userId: therapistId,
                },
            });
            expect(readReceipt).toBeTruthy();
            expect(readReceipt?.readAt).toBeTruthy();
        });
        it('should handle duplicate read receipts', async () => {
            // First read
            await request(app.getHttpServer())
                .post(`/messaging/messages/${messageId}/read`)
                .set('x-user-id', therapistId)
                .expect(200);
            // Second read (should be idempotent)
            await request(app.getHttpServer())
                .post(`/messaging/messages/${messageId}/read`)
                .set('x-user-id', therapistId)
                .expect(200);
            // Should still have only one read receipt
            const readReceipts = await prisma.messageReadReceipt.findMany({
                where: {
                    messageId: messageId,
                    userId: therapistId,
                },
            });
            expect(readReceipts).toHaveLength(1);
        });
        it('should not allow marking own messages as read', async () => {
            await request(app.getHttpServer())
                .post(`/messaging/messages/${messageId}/read`)
                .set('x-user-id', clientId) // Same as sender
                .expect(400);
        });
    });
    describe('Performance and Concurrency', () => {
        it('should handle concurrent message sending', async () => {
            const messagePromises = Array.from({ length: 10 }, (_, i) => request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', i % 2 === 0 ? clientId : therapistId)
                .send({
                content: `Concurrent message ${i}`,
                messageType: client_1.MessageType.TEXT,
            }));
            const results = await Promise.allSettled(messagePromises);
            const successful = results.filter((r) => r.status === 'fulfilled' && r.value.status === 201);
            expect(successful.length).toBe(10); // All should succeed
        });
        it('should maintain message order consistency', async () => {
            // Send messages sequentially
            const messageContents = ['First', 'Second', 'Third', 'Fourth', 'Fifth'];
            for (const content of messageContents) {
                await request(app.getHttpServer())
                    .post(`/messaging/conversations/${conversationId}/messages`)
                    .set('x-user-id', clientId)
                    .send({
                    content: content,
                    messageType: client_1.MessageType.TEXT,
                });
            }
            // Retrieve messages
            const response = await request(app.getHttpServer())
                .get(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .expect(200);
            const messages = response.body.data;
            expect(messages).toHaveLength(5);
            // Should be in reverse chronological order (newest first)
            expect(messages[0].content).toBe('Fifth');
            expect(messages[4].content).toBe('First');
        });
        it('should handle large conversation history efficiently', async () => {
            // Create many messages
            const messages = Array.from({ length: 100 }, (_, i) => ({
                id: `bulk-msg-${i}`,
                conversationId: conversationId,
                senderId: i % 2 === 0 ? clientId : therapistId,
                content: `Bulk message ${i}`,
                messageType: client_1.MessageType.TEXT,
                createdAt: new Date(Date.now() + i * 1000),
            }));
            await prisma.message.createMany({ data: messages });
            const startTime = Date.now();
            const response = await request(app.getHttpServer())
                .get(`/messaging/conversations/${conversationId}/messages?limit=20`)
                .set('x-user-id', clientId)
                .expect(200);
            const endTime = Date.now();
            const duration = endTime - startTime;
            expect(response.body.data).toHaveLength(20);
            expect(duration).toBeLessThan(1000); // Should complete within 1 second
        });
    });
    describe('Edge Cases', () => {
        it('should handle non-existent conversation', async () => {
            await request(app.getHttpServer())
                .get('/messaging/conversations/non-existent-id/messages')
                .set('x-user-id', clientId)
                .expect(404);
        });
        it('should handle non-existent message', async () => {
            await request(app.getHttpServer())
                .put('/messaging/messages/non-existent-id')
                .set('x-user-id', clientId)
                .send({ content: 'Updated content' })
                .expect(404);
        });
        it('should validate message content length', async () => {
            const longContent = 'a'.repeat(10001); // Exceed max length
            await request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .send({
                content: longContent,
                messageType: client_1.MessageType.TEXT,
            })
                .expect(400);
        });
        it('should handle malformed JSON metadata', async () => {
            await request(app.getHttpServer())
                .post(`/messaging/conversations/${conversationId}/messages`)
                .set('x-user-id', clientId)
                .send({
                content: 'Message with invalid metadata',
                messageType: 'FILE',
                metadata: 'invalid-json-string',
            })
                .expect(400);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvaW50ZWdyYXRpb24tdGVzdHMvbWVzc2FnaW5nLmludGVncmF0aW9uLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFFdEQscUNBQXFDO0FBQ3JDLG1GQUF1RTtBQUN2RSx1RUFBbUU7QUFDbkUsZ0VBQTJEO0FBQzNELDJDQUErRDtBQUUvRCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO0lBQzNDLElBQUksR0FBcUIsQ0FBQztJQUMxQixJQUFJLE1BQXFCLENBQUM7SUFDMUIsSUFBSSxTQUF3QixDQUFDO0lBQzdCLElBQUksUUFBZ0IsQ0FBQztJQUNyQixJQUFJLFdBQW1CLENBQUM7SUFDeEIsSUFBSSxjQUFzQixDQUFDO0lBRTNCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixzQkFBc0I7UUFDdEIsTUFBTSxHQUFHLE1BQU0sdUNBQWlCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUVyRCxTQUFTLEdBQUcsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDekMsT0FBTyxFQUFFLENBQUMsa0NBQWUsQ0FBQztZQUMxQixTQUFTLEVBQUU7Z0JBQ1Q7b0JBQ0UsT0FBTyxFQUFFLHNDQUFhO29CQUN0QixRQUFRLEVBQUUsTUFBTTtpQkFDakI7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLEdBQUcsR0FBRyxTQUFTLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUN4QyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVqQixxQ0FBcUM7UUFDckMsTUFBTSxhQUFhLEVBQUUsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixpRUFBaUU7UUFDakUsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BD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QUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxvQkFBb0I7WUFFM0QsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO2lCQUMvQixJQUFJLENBQUMsNEJBQTRCLGNBQWMsV0FBVyxDQUFDO2lCQUMzRCxHQUFHLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQztpQkFDMUIsSUFBSSxDQUFDO2dCQUNKLE9BQU8sRUFBRSxXQUFXO2dCQUNwQixXQUFXLEVBQUUsb0JBQVcsQ0FBQyxJQUFJO2FBQzlCLENBQUM7aUJBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3JELE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQztpQkFDL0IsSUFBSSxDQUFDLDRCQUE0QixjQUFjLFdBQVcsQ0FBQztpQkFDM0QsR0FBRyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUM7aUJBQzFCLElBQUksQ0FBQztnQkFDSixPQUFPLEVBQUUsK0JBQStCO2dCQUN4QyxXQUFXLEVBQUUsTUFBTTtnQkFDbkIsUUFBUSxFQUFFLHFCQUFxQjthQUNoQyxDQUFDO2lCQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvaW50ZWdyYXRpb24tdGVzdHMvbWVzc2FnaW5nLmludGVncmF0aW9uLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBJTmVzdEFwcGxpY2F0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0ICogYXMgcmVxdWVzdCBmcm9tICdzdXBlcnRlc3QnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IE1lc3NhZ2luZ01vZHVsZSB9IGZyb20gJy4uLy4uL21lc3NhZ2luZy9tZXNzYWdpbmcubW9kdWxlJztcbmltcG9ydCB7IERhdGFiYXNlVGVzdFNldHVwIH0gZnJvbSAnLi4vZGF0YWJhc2UtdGVzdC5zZXR1cCc7XG5pbXBvcnQgeyBNZXNzYWdlVHlwZSwgQ29udmVyc2F0aW9uVHlwZSB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuZGVzY3JpYmUoJ01lc3NhZ2luZyBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IGFwcDogSU5lc3RBcHBsaWNhdGlvbjtcbiAgbGV0IHByaXNtYTogUHJpc21hU2VydmljZTtcbiAgbGV0IG1vZHVsZVJlZjogVGVzdGluZ01vZHVsZTtcbiAgbGV0IGNsaWVudElkOiBzdHJpbmc7XG4gIGxldCB0aGVyYXBpc3RJZDogc3RyaW5nO1xuICBsZXQgY29udmVyc2F0aW9uSWQ6IHN0cmluZztcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIFNldHVwIHRlc3QgZGF0YWJhc2VcbiAgICBwcmlzbWEgPSBhd2FpdCBEYXRhYmFzZVRlc3RTZXR1cC5zZXR1cFRlc3REYXRhYmFzZSgpO1xuXG4gICAgbW9kdWxlUmVmID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGltcG9ydHM6IFtNZXNzYWdpbmdNb2R1bGVdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQcmlzbWFTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBwcmlzbWEsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIGFwcCA9IG1vZHVsZVJlZi5jcmVhdGVOZXN0QXBwbGljYXRpb24oKTtcbiAgICBhd2FpdCBhcHAuaW5pdCgpO1xuXG4gICAgLy8gQ3JlYXRlIHRlc3QgdXNlcnMgYW5kIGNvbnZlcnNhdGlvblxuICAgIGF3YWl0IHNldHVwVGVzdERhdGEoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiBtZXNzYWdlcyBhZnRlciBlYWNoIHRlc3QgYnV0IGtlZXAgdXNlcnMgYW5kIGNvbnZlcnNhdGlvblxuICAgIGF3YWl0IHByaXNtYS5tZXNzYWdlLmRlbGV0ZU1hbnkoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IERhdGFiYXNlVGVzdFNldHVwLnN0b3BDb250YWluZXIoKTtcbiAgICBhd2FpdCBhcHAuY2xvc2UoKTtcbiAgICBhd2FpdCBtb2R1bGVSZWYuY2xvc2UoKTtcbiAgfSk7XG5cbiAgYXN5bmMgZnVuY3Rpb24gc2V0dXBUZXN0RGF0YSgpIHtcbiAgICAvLyBDcmVhdGUgdXNlcnNcbiAgICBjb25zdCBjbGllbnRVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaWQ6ICdjbGllbnQtbXNnLTEyMycsXG4gICAgICAgIGVtYWlsOiAnY2xpZW50Lm1zZ0B0ZXN0LmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0NsaWVudCcsXG4gICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBjbGllbnRJZCA9IGNsaWVudFVzZXIuaWQ7XG5cbiAgICBjb25zdCB0aGVyYXBpc3RVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgaWQ6ICd0aGVyYXBpc3QtbXNnLTEyMycsXG4gICAgICAgIGVtYWlsOiAndGhlcmFwaXN0Lm1zZ0B0ZXN0LmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ1RoZXJhcGlzdCcsXG4gICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgIHJvbGU6ICd0aGVyYXBpc3QnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0aGVyYXBpc3RJZCA9IHRoZXJhcGlzdFVzZXIuaWQ7XG5cbiAgICAvLyBDcmVhdGUgY29udmVyc2F0aW9uXG4gICAgY29uc3QgY29udmVyc2F0aW9uID0gYXdhaXQgcHJpc21hLmNvbnZlcnNhdGlvbi5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBpZDogJ3Rlc3QtY29udmVyc2F0aW9uLTEyMycsXG4gICAgICAgIHR5cGU6IENvbnZlcnNhdGlvblR5cGUuRElSRUNULFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBjb252ZXJzYXRpb25JZCA9IGNvbnZlcnNhdGlvbi5pZDtcblxuICAgIC8vIENyZWF0ZSBjb252ZXJzYXRpb24gcGFydGljaXBhbnRzXG4gICAgYXdhaXQgcHJpc21hLmNvbnZlcnNhdGlvblBhcnRpY2lwYW50LmNyZWF0ZU1hbnkoe1xuICAgICAgZGF0YTogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdwYXJ0aWNpcGFudC0xJyxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgdXNlcklkOiBjbGllbnRJZCxcbiAgICAgICAgICBqb2luZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAncGFydGljaXBhbnQtMicsXG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgIHVzZXJJZDogdGhlcmFwaXN0SWQsXG4gICAgICAgICAgam9pbmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLzppZC9tZXNzYWdlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgYSBtZXNzYWdlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VEYXRhID0ge1xuICAgICAgICBjb250ZW50OiAnSGVsbG8sIHRoaXMgaXMgYSB0ZXN0IG1lc3NhZ2UnLFxuICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5zZW5kKG1lc3NhZ2VEYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGlkOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgICAgY29udGVudDogJ0hlbGxvLCB0aGlzIGlzIGEgdGVzdCBtZXNzYWdlJyxcbiAgICAgICAgICBzZW5kZXJJZDogY2xpZW50SWQsXG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWZXJpZnkgaW4gZGF0YWJhc2VcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCBwcmlzbWEubWVzc2FnZS5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogeyBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2U/LmNvbnRlbnQpLnRvQmUoJ0hlbGxvLCB0aGlzIGlzIGEgdGVzdCBtZXNzYWdlJyk7XG4gICAgICBleHBlY3QobWVzc2FnZT8uc2VuZGVySWQpLnRvQmUoY2xpZW50SWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbWVzc2FnZXMgZnJvbSBub24tcGFydGljaXBhbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGEgbm9uLXBhcnRpY2lwYW50IHVzZXJcbiAgICAgIGNvbnN0IG91dHNpZGVyVXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogJ291dHNpZGVyLTEyMycsXG4gICAgICAgICAgZW1haWw6ICdvdXRzaWRlckB0ZXN0LmNvbScsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnT3V0c2lkZXInLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWVzc2FnZURhdGEgPSB7XG4gICAgICAgIGNvbnRlbnQ6ICdUaGlzIHNob3VsZCBiZSByZWplY3RlZCcsXG4gICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgb3V0c2lkZXJVc2VyLmlkKVxuICAgICAgICAuc2VuZChtZXNzYWdlRGF0YSlcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBtZXNzYWdlIGNvbnRlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkTWVzc2FnZURhdGEgPSB7XG4gICAgICAgIGNvbnRlbnQ6ICcnLCAvLyBFbXB0eSBjb250ZW50XG4gICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5zZW5kKGludmFsaWRNZXNzYWdlRGF0YSlcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlmZmVyZW50IG1lc3NhZ2UgdHlwZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbWFnZU1lc3NhZ2VEYXRhID0ge1xuICAgICAgICBjb250ZW50OiAnaW1hZ2UuanBnJyxcbiAgICAgICAgbWVzc2FnZVR5cGU6ICdJTUFHRScsXG4gICAgICAgIG1ldGFkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZmlsZU5hbWU6ICdpbWFnZS5qcGcnLFxuICAgICAgICAgIGZpbGVTaXplOiAxMDI0LFxuICAgICAgICAgIG1pbWVUeXBlOiAnaW1hZ2UvanBlZycsXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnMvJHtjb252ZXJzYXRpb25JZH0vbWVzc2FnZXNgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLnNlbmQoaW1hZ2VNZXNzYWdlRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLm1lc3NhZ2VUeXBlKS50b0JlKCdJTUFHRScpO1xuICAgICAgZXhwZWN0KEpTT04ucGFyc2UocmVzcG9uc2UuYm9keS5kYXRhLm1ldGFkYXRhIHx8ICd7fScpKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgZmlsZU5hbWU6ICdpbWFnZS5qcGcnLFxuICAgICAgICBmaWxlU2l6ZTogMTAyNCxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9tZXNzYWdpbmcvY29udmVyc2F0aW9ucy86aWQvbWVzc2FnZXMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgdGVzdCBtZXNzYWdlc1xuICAgICAgY29uc3QgbWVzc2FnZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ21zZy0xJyxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgc2VuZGVySWQ6IGNsaWVudElkLFxuICAgICAgICAgIGNvbnRlbnQ6ICdGaXJzdCBtZXNzYWdlJyxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDEwOjAwOjAwWicpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdtc2ctMicsXG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgIHNlbmRlcklkOiB0aGVyYXBpc3RJZCxcbiAgICAgICAgICBjb250ZW50OiAnU2Vjb25kIG1lc3NhZ2UnLFxuICAgICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMDFUMTA6MDE6MDBaJyksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ21zZy0zJyxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgc2VuZGVySWQ6IGNsaWVudElkLFxuICAgICAgICAgIGNvbnRlbnQ6ICdUaGlyZCBtZXNzYWdlJyxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDEwOjAyOjAwWicpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgYXdhaXQgcHJpc21hLm1lc3NhZ2UuY3JlYXRlTWFueSh7IGRhdGE6IG1lc3NhZ2VzIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBjb252ZXJzYXRpb24gbWVzc2FnZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmdldChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvSGF2ZUxlbmd0aCgzKTtcblxuICAgICAgLy8gU2hvdWxkIGJlIG9yZGVyZWQgYnkgY3JlYXRlZEF0IGRlc2MgKG5ld2VzdCBmaXJzdClcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gcmVzcG9uc2UuYm9keS5kYXRhO1xuICAgICAgZXhwZWN0KG1lc3NhZ2VzWzBdLmNvbnRlbnQpLnRvQmUoJ1RoaXJkIG1lc3NhZ2UnKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlc1sxXS5jb250ZW50KS50b0JlKCdTZWNvbmQgbWVzc2FnZScpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2VzWzJdLmNvbnRlbnQpLnRvQmUoJ0ZpcnN0IG1lc3NhZ2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3VwcG9ydCBwYWdpbmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoXG4gICAgICAgICAgYC9tZXNzYWdpbmcvY29udmVyc2F0aW9ucy8ke2NvbnZlcnNhdGlvbklkfS9tZXNzYWdlcz9saW1pdD0yJm9mZnNldD0xYCxcbiAgICAgICAgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhWzBdLmNvbnRlbnQpLnRvQmUoJ1NlY29uZCBtZXNzYWdlJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhWzFdLmNvbnRlbnQpLnRvQmUoJ0ZpcnN0IG1lc3NhZ2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSBzZW5kZXIgaW5mb3JtYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmdldChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YVswXSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHNlbmRlcklkOiBjbGllbnRJZCxcbiAgICAgICAgc2VuZGVyOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaWQ6IGNsaWVudElkLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0NsaWVudCcsXG4gICAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGFjY2VzcyBmcm9tIG5vbi1wYXJ0aWNpcGFudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvdXRzaWRlclVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdvdXRzaWRlci1tc2ctMTIzJyxcbiAgICAgICAgICBlbWFpbDogJ291dHNpZGVyLm1zZ0B0ZXN0LmNvbScsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnT3V0c2lkZXInLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZ2V0KGAvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnMvJHtjb252ZXJzYXRpb25JZH0vbWVzc2FnZXNgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBvdXRzaWRlclVzZXIuaWQpXG4gICAgICAgIC5leHBlY3QoNDAzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BVVCAvbWVzc2FnaW5nL21lc3NhZ2VzLzppZCcsICgpID0+IHtcbiAgICBsZXQgbWVzc2FnZUlkOiBzdHJpbmc7XG5cbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCBwcmlzbWEubWVzc2FnZS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdlZGl0YWJsZS1tc2ctMTIzJyxcbiAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uSWQsXG4gICAgICAgICAgc2VuZGVySWQ6IGNsaWVudElkLFxuICAgICAgICAgIGNvbnRlbnQ6ICdPcmlnaW5hbCBtZXNzYWdlJyxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIG1lc3NhZ2VJZCA9IG1lc3NhZ2UuaWQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVkaXQgb3duIG1lc3NhZ2Ugc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgY29udGVudDogJ0VkaXRlZCBtZXNzYWdlIGNvbnRlbnQnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wdXQoYC9tZXNzYWdpbmcvbWVzc2FnZXMvJHttZXNzYWdlSWR9YClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5zZW5kKHVwZGF0ZURhdGEpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaWQ6IG1lc3NhZ2VJZCxcbiAgICAgICAgICBjb250ZW50OiAnRWRpdGVkIG1lc3NhZ2UgY29udGVudCcsXG4gICAgICAgICAgaXNFZGl0ZWQ6IHRydWUsXG4gICAgICAgICAgZWRpdGVkQXQ6IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgLy8gVmVyaWZ5IGluIGRhdGFiYXNlXG4gICAgICBjb25zdCB1cGRhdGVkTWVzc2FnZSA9IGF3YWl0IHByaXNtYS5tZXNzYWdlLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogbWVzc2FnZUlkIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHVwZGF0ZWRNZXNzYWdlPy5jb250ZW50KS50b0JlKCdFZGl0ZWQgbWVzc2FnZSBjb250ZW50Jyk7XG4gICAgICBleHBlY3QodXBkYXRlZE1lc3NhZ2U/LmlzRWRpdGVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRNZXNzYWdlPy5lZGl0ZWRBdCkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGVkaXRpbmcgb3RoZXJzIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgY29udGVudDogJ1Nob3VsZCBub3QgYmUgYWJsZSB0byBlZGl0IHRoaXMnLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucHV0KGAvbWVzc2FnaW5nL21lc3NhZ2VzLyR7bWVzc2FnZUlkfWApXG4gICAgICAgIC5zZXQoJ3gtdXNlci1pZCcsIHRoZXJhcGlzdElkKSAvLyBEaWZmZXJlbnQgdXNlclxuICAgICAgICAuc2VuZCh1cGRhdGVEYXRhKVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgZWRpdGluZyBvbGQgbWVzc2FnZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYW4gb2xkIG1lc3NhZ2UgKG1vcmUgdGhhbiBlZGl0IHRpbWUgbGltaXQpXG4gICAgICBjb25zdCBvbGRNZXNzYWdlID0gYXdhaXQgcHJpc21hLm1lc3NhZ2UuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGlkOiAnb2xkLW1zZy0xMjMnLFxuICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiBjb252ZXJzYXRpb25JZCxcbiAgICAgICAgICBzZW5kZXJJZDogY2xpZW50SWQsXG4gICAgICAgICAgY29udGVudDogJ09sZCBtZXNzYWdlJyxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAyNSAqIDYwICogNjAgKiAxMDAwKSwgLy8gMjUgaG91cnMgYWdvXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgY29udGVudDogJ1RyeWluZyB0byBlZGl0IG9sZCBtZXNzYWdlJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnB1dChgL21lc3NhZ2luZy9tZXNzYWdlcy8ke29sZE1lc3NhZ2UuaWR9YClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5zZW5kKHVwZGF0ZURhdGEpXG4gICAgICAgIC5leHBlY3QoNDAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RFTEVURSAvbWVzc2FnaW5nL21lc3NhZ2VzLzppZCcsICgpID0+IHtcbiAgICBsZXQgbWVzc2FnZUlkOiBzdHJpbmc7XG5cbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBhd2FpdCBwcmlzbWEubWVzc2FnZS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdkZWxldGFibGUtbXNnLTEyMycsXG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgIHNlbmRlcklkOiBjbGllbnRJZCxcbiAgICAgICAgICBjb250ZW50OiAnTWVzc2FnZSB0byBkZWxldGUnLFxuICAgICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgbWVzc2FnZUlkID0gbWVzc2FnZS5pZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVsZXRlIG93biBtZXNzYWdlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmRlbGV0ZShgL21lc3NhZ2luZy9tZXNzYWdlcy8ke21lc3NhZ2VJZH1gKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBWZXJpZnkgc29mdCBkZWxldGlvbiBpbiBkYXRhYmFzZVxuICAgICAgY29uc3QgZGVsZXRlZE1lc3NhZ2UgPSBhd2FpdCBwcmlzbWEubWVzc2FnZS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG1lc3NhZ2VJZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkTWVzc2FnZT8uaXNEZWxldGVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGRlbGV0aW5nIG90aGVycyBtZXNzYWdlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmRlbGV0ZShgL21lc3NhZ2luZy9tZXNzYWdlcy8ke21lc3NhZ2VJZH1gKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCB0aGVyYXBpc3RJZCkgLy8gRGlmZmVyZW50IHVzZXJcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYWxyZWFkeSBkZWxldGVkIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgZGVsZXRpb25cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmRlbGV0ZShgL21lc3NhZ2luZy9tZXNzYWdlcy8ke21lc3NhZ2VJZH1gKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBTZWNvbmQgZGVsZXRpb24gYXR0ZW1wdFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZGVsZXRlKGAvbWVzc2FnaW5nL21lc3NhZ2VzLyR7bWVzc2FnZUlkfWApXG4gICAgICAgIC5zZXQoJ3gtdXNlci1pZCcsIGNsaWVudElkKVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNZXNzYWdlIFJlYWQgUmVjZWlwdHMnLCAoKSA9PiB7XG4gICAgbGV0IG1lc3NhZ2VJZDogc3RyaW5nO1xuXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgcHJpc21hLm1lc3NhZ2UuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGlkOiAncmVhZGFibGUtbXNnLTEyMycsXG4gICAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbklkLFxuICAgICAgICAgIHNlbmRlcklkOiBjbGllbnRJZCxcbiAgICAgICAgICBjb250ZW50OiAnTWVzc2FnZSB0byBtYXJrIGFzIHJlYWQnLFxuICAgICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBtZXNzYWdlSWQgPSBtZXNzYWdlLmlkO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYXJrIG1lc3NhZ2UgYXMgcmVhZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoYC9tZXNzYWdpbmcvbWVzc2FnZXMvJHttZXNzYWdlSWR9L3JlYWRgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCB0aGVyYXBpc3RJZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBWZXJpZnkgcmVhZCByZWNlaXB0IGluIGRhdGFiYXNlXG4gICAgICBjb25zdCByZWFkUmVjZWlwdCA9IGF3YWl0IHByaXNtYS5tZXNzYWdlUmVhZFJlY2VpcHQuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBtZXNzYWdlSWQ6IG1lc3NhZ2VJZCxcbiAgICAgICAgICB1c2VySWQ6IHRoZXJhcGlzdElkLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZWFkUmVjZWlwdCkudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KHJlYWRSZWNlaXB0Py5yZWFkQXQpLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGR1cGxpY2F0ZSByZWFkIHJlY2VpcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgcmVhZFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdChgL21lc3NhZ2luZy9tZXNzYWdlcy8ke21lc3NhZ2VJZH0vcmVhZGApXG4gICAgICAgIC5zZXQoJ3gtdXNlci1pZCcsIHRoZXJhcGlzdElkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIC8vIFNlY29uZCByZWFkIChzaG91bGQgYmUgaWRlbXBvdGVudClcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoYC9tZXNzYWdpbmcvbWVzc2FnZXMvJHttZXNzYWdlSWR9L3JlYWRgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCB0aGVyYXBpc3RJZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBTaG91bGQgc3RpbGwgaGF2ZSBvbmx5IG9uZSByZWFkIHJlY2VpcHRcbiAgICAgIGNvbnN0IHJlYWRSZWNlaXB0cyA9IGF3YWl0IHByaXNtYS5tZXNzYWdlUmVhZFJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG1lc3NhZ2VJZDogbWVzc2FnZUlkLFxuICAgICAgICAgIHVzZXJJZDogdGhlcmFwaXN0SWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlYWRSZWNlaXB0cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgYWxsb3cgbWFya2luZyBvd24gbWVzc2FnZXMgYXMgcmVhZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoYC9tZXNzYWdpbmcvbWVzc2FnZXMvJHttZXNzYWdlSWR9L3JlYWRgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZCkgLy8gU2FtZSBhcyBzZW5kZXJcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgYW5kIENvbmN1cnJlbmN5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgbWVzc2FnZSBzZW5kaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZVByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+XG4gICAgICAgIHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgICAucG9zdChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBpICUgMiA9PT0gMCA/IGNsaWVudElkIDogdGhlcmFwaXN0SWQpXG4gICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgY29udGVudDogYENvbmN1cnJlbnQgbWVzc2FnZSAke2l9YCxcbiAgICAgICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgICAgIH0pLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChtZXNzYWdlUHJvbWlzZXMpO1xuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bCA9IHJlc3VsdHMuZmlsdGVyKFxuICAgICAgICAocikgPT4gci5zdGF0dXMgPT09ICdmdWxmaWxsZWQnICYmIChyLnZhbHVlIGFzIGFueSkuc3RhdHVzID09PSAyMDEsXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc3VjY2Vzc2Z1bC5sZW5ndGgpLnRvQmUoMTApOyAvLyBBbGwgc2hvdWxkIHN1Y2NlZWRcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gbWVzc2FnZSBvcmRlciBjb25zaXN0ZW5jeScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNlbmQgbWVzc2FnZXMgc2VxdWVudGlhbGx5XG4gICAgICBjb25zdCBtZXNzYWdlQ29udGVudHMgPSBbJ0ZpcnN0JywgJ1NlY29uZCcsICdUaGlyZCcsICdGb3VydGgnLCAnRmlmdGgnXTtcblxuICAgICAgZm9yIChjb25zdCBjb250ZW50IG9mIG1lc3NhZ2VDb250ZW50cykge1xuICAgICAgICBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgICAgLnBvc3QoYC9tZXNzYWdpbmcvY29udmVyc2F0aW9ucy8ke2NvbnZlcnNhdGlvbklkfS9tZXNzYWdlc2ApXG4gICAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgY29udGVudDogY29udGVudCxcbiAgICAgICAgICAgIG1lc3NhZ2VUeXBlOiBNZXNzYWdlVHlwZS5URVhULFxuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXRyaWV2ZSBtZXNzYWdlc1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoYC9tZXNzYWdpbmcvY29udmVyc2F0aW9ucy8ke2NvbnZlcnNhdGlvbklkfS9tZXNzYWdlc2ApXG4gICAgICAgIC5zZXQoJ3gtdXNlci1pZCcsIGNsaWVudElkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gcmVzcG9uc2UuYm9keS5kYXRhO1xuICAgICAgZXhwZWN0KG1lc3NhZ2VzKS50b0hhdmVMZW5ndGgoNSk7XG5cbiAgICAgIC8vIFNob3VsZCBiZSBpbiByZXZlcnNlIGNocm9ub2xvZ2ljYWwgb3JkZXIgKG5ld2VzdCBmaXJzdClcbiAgICAgIGV4cGVjdChtZXNzYWdlc1swXS5jb250ZW50KS50b0JlKCdGaWZ0aCcpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2VzWzRdLmNvbnRlbnQpLnRvQmUoJ0ZpcnN0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsYXJnZSBjb252ZXJzYXRpb24gaGlzdG9yeSBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBtYW55IG1lc3NhZ2VzXG4gICAgICBjb25zdCBtZXNzYWdlcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDEwMCB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgaWQ6IGBidWxrLW1zZy0ke2l9YCxcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbklkLFxuICAgICAgICBzZW5kZXJJZDogaSAlIDIgPT09IDAgPyBjbGllbnRJZCA6IHRoZXJhcGlzdElkLFxuICAgICAgICBjb250ZW50OiBgQnVsayBtZXNzYWdlICR7aX1gLFxuICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgaSAqIDEwMDApLFxuICAgICAgfSkpO1xuXG4gICAgICBhd2FpdCBwcmlzbWEubWVzc2FnZS5jcmVhdGVNYW55KHsgZGF0YTogbWVzc2FnZXMgfSk7XG5cbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZ2V0KGAvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnMvJHtjb252ZXJzYXRpb25JZH0vbWVzc2FnZXM/bGltaXQ9MjBgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YSkudG9IYXZlTGVuZ3RoKDIwKTtcbiAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDEwMDApOyAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIDEgc2Vjb25kXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1leGlzdGVudCBjb252ZXJzYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoJy9tZXNzYWdpbmcvY29udmVyc2F0aW9ucy9ub24tZXhpc3RlbnQtaWQvbWVzc2FnZXMnKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLmV4cGVjdCg0MDQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbm9uLWV4aXN0ZW50IG1lc3NhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wdXQoJy9tZXNzYWdpbmcvbWVzc2FnZXMvbm9uLWV4aXN0ZW50LWlkJylcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5zZW5kKHsgY29udGVudDogJ1VwZGF0ZWQgY29udGVudCcgfSlcbiAgICAgICAgLmV4cGVjdCg0MDQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBtZXNzYWdlIGNvbnRlbnQgbGVuZ3RoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9uZ0NvbnRlbnQgPSAnYScucmVwZWF0KDEwMDAxKTsgLy8gRXhjZWVkIG1heCBsZW5ndGhcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdChgL21lc3NhZ2luZy9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L21lc3NhZ2VzYClcbiAgICAgICAgLnNldCgneC11c2VyLWlkJywgY2xpZW50SWQpXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBjb250ZW50OiBsb25nQ29udGVudCxcbiAgICAgICAgICBtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUuVEVYVCxcbiAgICAgICAgfSlcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIEpTT04gbWV0YWRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnMvJHtjb252ZXJzYXRpb25JZH0vbWVzc2FnZXNgKVxuICAgICAgICAuc2V0KCd4LXVzZXItaWQnLCBjbGllbnRJZClcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIGNvbnRlbnQ6ICdNZXNzYWdlIHdpdGggaW52YWxpZCBtZXRhZGF0YScsXG4gICAgICAgICAgbWVzc2FnZVR5cGU6ICdGSUxFJyxcbiAgICAgICAgICBtZXRhZGF0YTogJ2ludmFsaWQtanNvbi1zdHJpbmcnLFxuICAgICAgICB9KVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=