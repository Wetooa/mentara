{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/integration-tests/messaging-system.integration.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/integration-tests/messaging-system.integration.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { INestApplication } from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { DatabaseTestSetup } from '../database-test.setup';\nimport { TestDataGenerator } from '../enhanced-test-helpers';\n\n/**\n * Messaging System Integration Tests\n * \n * Comprehensive testing of the messaging system including conversations,\n * messages, reactions, read receipts, user blocking, and real-time features.\n */\ndescribe('Messaging System Integration', () => {\n  let app: INestApplication;\n  let prisma: PrismaService;\n  let moduleRef: TestingModule;\n\n  // Test users\n  let user1: any, user2: any, user3: any, moderatorUser: any;\n\n  beforeAll(async () => {\n    // Setup test database\n    prisma = await DatabaseTestSetup.setupTestDatabase();\n\n    moduleRef = await Test.createTestingModule({\n      providers: [\n        {\n          provide: PrismaService,\n          useValue: prisma,\n        },\n      ],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n    await app.init();\n\n    // Create test users\n    await setupTestUsers();\n  });\n\n  afterEach(async () => {\n    // Clean messaging data but keep users\n    await cleanMessagingData();\n  });\n\n  afterAll(async () => {\n    await DatabaseTestSetup.stopContainer();\n    await app.close();\n    await moduleRef.close();\n  });\n\n  async function setupTestUsers() {\n    user1 = await prisma.user.create({\n      data: TestDataGenerator.createUser({\n        id: 'msg-user-1',\n        email: 'user1@messaging.com',\n        firstName: 'Alice',\n        lastName: 'Johnson',\n      }),\n    });\n\n    user2 = await prisma.user.create({\n      data: TestDataGenerator.createUser({\n        id: 'msg-user-2', \n        email: 'user2@messaging.com',\n        firstName: 'Bob',\n        lastName: 'Smith',\n      }),\n    });\n\n    user3 = await prisma.user.create({\n      data: TestDataGenerator.createUser({\n        id: 'msg-user-3',\n        email: 'user3@messaging.com',\n        firstName: 'Charlie',\n        lastName: 'Brown',\n      }),\n    });\n\n    moderatorUser = await prisma.user.create({\n      data: TestDataGenerator.createUser({\n        id: 'msg-moderator',\n        email: 'moderator@messaging.com',\n        firstName: 'Moderator',\n        lastName: 'Admin',\n        role: 'moderator',\n      }),\n    });\n  }\n\n  async function cleanMessagingData() {\n    await prisma.typingIndicator.deleteMany();\n    await prisma.messageReaction.deleteMany();\n    await prisma.messageReadReceipt.deleteMany();\n    await prisma.message.deleteMany();\n    await prisma.conversationParticipant.deleteMany();\n    await prisma.conversation.deleteMany();\n    await prisma.userBlock.deleteMany();\n  }\n\n  describe('Direct Conversation Creation and Management', () => {\n    it('should create direct conversation between two users', async () => {\n      // Create direct conversation\n      const conversation = await prisma.conversation.create({\n        data: {\n          type: 'DIRECT',\n          isActive: true,\n          participants: {\n            create: [\n              {\n                userId: user1.id,\n                role: 'MEMBER',\n                isActive: true,\n              },\n              {\n                userId: user2.id,\n                role: 'MEMBER',\n                isActive: true,\n              },\n            ],\n          },\n        },\n        include: {\n          participants: {\n            include: {\n              user: true,\n            },\n          },\n        },\n      });\n\n      // Verify conversation creation\n      expect(conversation.type).toBe('DIRECT');\n      expect(conversation.participants).toHaveLength(2);\n      expect(conversation.participants.map(p => p.userId)).toContain(user1.id);\n      expect(conversation.participants.map(p => p.userId)).toContain(user2.id);\n      expect(conversation.isActive).toBe(true);\n    });\n\n    it('should create group conversation with multiple participants', async () => {\n      // Create group conversation\n      const groupConversation = await prisma.conversation.create({\n        data: {\n          type: 'GROUP',\n          title: 'Support Group Chat',\n          isActive: true,\n          participants: {\n            create: [\n              {\n                userId: user1.id,\n                role: 'ADMIN',\n                isActive: true,\n              },\n              {\n                userId: user2.id,\n                role: 'MEMBER',\n                isActive: true,\n              },\n              {\n                userId: user3.id,\n                role: 'MEMBER',\n                isActive: true,\n              },\n              {\n                userId: moderatorUser.id,\n                role: 'MODERATOR',\n                isActive: true,\n              },\n            ],\n          },\n        },\n        include: {\n          participants: {\n            include: {\n              user: true,\n            },\n          },\n        },\n      });\n\n      // Verify group conversation\n      expect(groupConversation.type).toBe('GROUP');\n      expect(groupConversation.title).toBe('Support Group Chat');\n      expect(groupConversation.participants).toHaveLength(4);\n      \n      const roles = groupConversation.participants.map(p => p.role);\n      expect(roles).toContain('ADMIN');\n      expect(roles).toContain('MODERATOR');\n      expect(roles.filter(r => r === 'MEMBER')).toHaveLength(2);\n    });\n\n    it('should handle participant management in conversations', async () => {\n      // Create initial conversation\n      const conversation = await prisma.conversation.create({\n        data: {\n          type: 'GROUP',\n          title: 'Dynamic Group',\n          isActive: true,\n          participants: {\n            create: [\n              {\n                userId: user1.id,\n                role: 'ADMIN',\n                isActive: true,\n              },\n              {\n                userId: user2.id,\n                role: 'MEMBER',\n                isActive: true,\n              },\n            ],\n          },\n        },\n      });\n\n      // Add new participant\n      const newParticipant = await prisma.conversationParticipant.create({\n        data: {\n          conversationId: conversation.id,\n          userId: user3.id,\n          role: 'MEMBER',\n          isActive: true,\n        },\n      });\n\n      // Mute a participant\n      await prisma.conversationParticipant.update({\n        where: {\n          conversationId_userId: {\n            conversationId: conversation.id,\n            userId: user2.id,\n          },\n        },\n        data: {\n          isMuted: true,\n        },\n      });\n\n      // Remove a participant (set inactive)\n      await prisma.conversationParticipant.update({\n        where: {\n          conversationId_userId: {\n            conversationId: conversation.id,\n            userId: user3.id,\n          },\n        },\n        data: {\n          isActive: false,\n        },\n      });\n\n      // Verify participant changes\n      const updatedConversation = await prisma.conversation.findUnique({\n        where: { id: conversation.id },\n        include: {\n          participants: {\n            include: {\n              user: true,\n            },\n          },\n        },\n      });\n\n      const activeParticipants = updatedConversation?.participants.filter(p => p.isActive);\n      const mutedParticipants = updatedConversation?.participants.filter(p => p.isMuted);\n\n      expect(updatedConversation?.participants).toHaveLength(3);\n      expect(activeParticipants).toHaveLength(2);\n      expect(mutedParticipants).toHaveLength(1);\n    });\n  });\n\n  describe('Message Creation and Threading', () => {\n    let testConversation: any;\n\n    beforeEach(async () => {\n      testConversation = await prisma.conversation.create({\n        data: {\n          type: 'DIRECT',\n          isActive: true,\n          participants: {\n            create: [\n              {\n                userId: user1.id,\n                role: 'MEMBER',\n              },\n              {\n                userId: user2.id,\n                role: 'MEMBER',\n              },\n            ],\n          },\n        },\n      });\n    });\n\n    it('should create and thread messages correctly', async () => {\n      // Create initial message\n      const initialMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'How are you feeling today?',\n          messageType: 'TEXT',\n        },\n      });\n\n      // Create reply to the message\n      const replyMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user2.id,\n          content: 'I am feeling much better, thank you for asking!',\n          messageType: 'TEXT',\n          replyToId: initialMessage.id,\n        },\n      });\n\n      // Create another reply to form a thread\n      const secondReply = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'That is wonderful to hear!',\n          messageType: 'TEXT',\n          replyToId: initialMessage.id,\n        },\n      });\n\n      // Update conversation last message time\n      await prisma.conversation.update({\n        where: { id: testConversation.id },\n        data: { lastMessageAt: new Date() },\n      });\n\n      // Verify message threading\n      const messageThread = await prisma.message.findUnique({\n        where: { id: initialMessage.id },\n        include: {\n          replies: {\n            include: {\n              sender: true,\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n          replyTo: true,\n        },\n      });\n\n      expect(messageThread?.replies).toHaveLength(2);\n      expect(messageThread?.replies[0].content).toContain('feeling much better');\n      expect(messageThread?.replies[1].content).toContain('wonderful to hear');\n      expect(replyMessage.replyToId).toBe(initialMessage.id);\n      expect(secondReply.replyToId).toBe(initialMessage.id);\n    });\n\n    it('should handle different message types', async () => {\n      // Text message\n      const textMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'Hello world!',\n          messageType: 'TEXT',\n        },\n      });\n\n      // Image message\n      const imageMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user2.id,\n          content: 'Check out this photo',\n          messageType: 'IMAGE',\n          attachmentUrl: 'https://example.com/image.jpg',\n          attachmentName: 'photo.jpg',\n          attachmentSize: 1024000,\n        },\n      });\n\n      // File message\n      const fileMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'Here is the document you requested',\n          messageType: 'FILE',\n          attachmentUrl: 'https://example.com/document.pdf',\n          attachmentName: 'therapy-plan.pdf',\n          attachmentSize: 2048000,\n        },\n      });\n\n      // System message\n      const systemMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'User joined the conversation',\n          messageType: 'SYSTEM',\n        },\n      });\n\n      // Verify different message types\n      const messages = await prisma.message.findMany({\n        where: { conversationId: testConversation.id },\n        orderBy: { createdAt: 'asc' },\n      });\n\n      expect(messages).toHaveLength(4);\n      expect(messages[0].messageType).toBe('TEXT');\n      expect(messages[1].messageType).toBe('IMAGE');\n      expect(messages[1].attachmentUrl).toBeTruthy();\n      expect(messages[2].messageType).toBe('FILE');\n      expect(messages[2].attachmentSize).toBe(2048000);\n      expect(messages[3].messageType).toBe('SYSTEM');\n    });\n\n    it('should handle message editing and deletion', async () => {\n      // Create message\n      const message = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'Original message content',\n          messageType: 'TEXT',\n        },\n      });\n\n      // Edit message\n      const editedMessage = await prisma.message.update({\n        where: { id: message.id },\n        data: {\n          content: 'Edited message content',\n          isEdited: true,\n          editedAt: new Date(),\n        },\n      });\n\n      // Soft delete message\n      const deletedMessage = await prisma.message.update({\n        where: { id: message.id },\n        data: {\n          isDeleted: true,\n          content: '[Message deleted]',\n        },\n      });\n\n      expect(editedMessage.isEdited).toBe(true);\n      expect(editedMessage.editedAt).toBeTruthy();\n      expect(deletedMessage.isDeleted).toBe(true);\n      expect(deletedMessage.content).toBe('[Message deleted]');\n    });\n  });\n\n  describe('Message Reactions and Read Receipts', () => {\n    let testConversation: any;\n    let testMessage: any;\n\n    beforeEach(async () => {\n      testConversation = await prisma.conversation.create({\n        data: {\n          type: 'GROUP',\n          title: 'Reaction Test Group',\n          participants: {\n            create: [\n              { userId: user1.id, role: 'MEMBER' },\n              { userId: user2.id, role: 'MEMBER' },\n              { userId: user3.id, role: 'MEMBER' },\n            ],\n          },\n        },\n      });\n\n      testMessage = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'Great news everyone!',\n          messageType: 'TEXT',\n        },\n      });\n    });\n\n    it('should handle message reactions correctly', async () => {\n      // Add reactions from different users\n      const reaction1 = await prisma.messageReaction.create({\n        data: {\n          messageId: testMessage.id,\n          userId: user2.id,\n          emoji: 'ðŸ‘',\n        },\n      });\n\n      const reaction2 = await prisma.messageReaction.create({\n        data: {\n          messageId: testMessage.id,\n          userId: user3.id,\n          emoji: 'ðŸ˜Š',\n        },\n      });\n\n      // User2 adds another reaction\n      const reaction3 = await prisma.messageReaction.create({\n        data: {\n          messageId: testMessage.id,\n          userId: user2.id,\n          emoji: 'ðŸŽ‰',\n        },\n      });\n\n      // Get message with reactions\n      const messageWithReactions = await prisma.message.findUnique({\n        where: { id: testMessage.id },\n        include: {\n          reactions: {\n            include: {\n              user: true,\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n        },\n      });\n\n      expect(messageWithReactions?.reactions).toHaveLength(3);\n      expect(messageWithReactions?.reactions[0].emoji).toBe('ðŸ‘');\n      expect(messageWithReactions?.reactions[1].emoji).toBe('ðŸ˜Š');\n      expect(messageWithReactions?.reactions[2].emoji).toBe('ðŸŽ‰');\n\n      // Verify user2 has two reactions\n      const user2Reactions = messageWithReactions?.reactions.filter(r => r.userId === user2.id);\n      expect(user2Reactions).toHaveLength(2);\n    });\n\n    it('should handle reaction removal', async () => {\n      // Add reaction\n      const reaction = await prisma.messageReaction.create({\n        data: {\n          messageId: testMessage.id,\n          userId: user2.id,\n          emoji: 'ðŸ‘',\n        },\n      });\n\n      // Remove reaction\n      await prisma.messageReaction.delete({\n        where: { id: reaction.id },\n      });\n\n      // Verify reaction removed\n      const messageWithReactions = await prisma.message.findUnique({\n        where: { id: testMessage.id },\n        include: {\n          reactions: true,\n        },\n      });\n\n      expect(messageWithReactions?.reactions).toHaveLength(0);\n    });\n\n    it('should track read receipts correctly', async () => {\n      // Create read receipts for different users\n      const readReceipt1 = await prisma.messageReadReceipt.create({\n        data: {\n          messageId: testMessage.id,\n          userId: user2.id,\n        },\n      });\n\n      const readReceipt2 = await prisma.messageReadReceipt.create({\n        data: {\n          messageId: testMessage.id,\n          userId: user3.id,\n        },\n      });\n\n      // Update participant last read times\n      await prisma.conversationParticipant.updateMany({\n        where: {\n          conversationId: testConversation.id,\n          userId: user2.id,\n        },\n        data: {\n          lastReadAt: new Date(),\n        },\n      });\n\n      // Get message with read receipts\n      const messageWithReceipts = await prisma.message.findUnique({\n        where: { id: testMessage.id },\n        include: {\n          readReceipts: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                },\n              },\n            },\n          },\n        },\n      });\n\n      expect(messageWithReceipts?.readReceipts).toHaveLength(2);\n      expect(messageWithReceipts?.readReceipts.map(r => r.userId)).toContain(user2.id);\n      expect(messageWithReceipts?.readReceipts.map(r => r.userId)).toContain(user3.id);\n    });\n  });\n\n  describe('User Blocking and Privacy', () => {\n    it('should handle user blocking relationships', async () => {\n      // User1 blocks User2\n      const userBlock = await prisma.userBlock.create({\n        data: {\n          blockerId: user1.id,\n          blockedId: user2.id,\n          reason: 'Inappropriate messages',\n        },\n      });\n\n      // Try to create conversation between blocked users\n      const conversation = await prisma.conversation.create({\n        data: {\n          type: 'DIRECT',\n          participants: {\n            create: [\n              { userId: user1.id, role: 'MEMBER' },\n              { userId: user2.id, role: 'MEMBER' },\n            ],\n          },\n        },\n      });\n\n      // This would normally be handled by application logic to prevent messaging\n      // Here we just verify the block relationship exists\n      const blockingRelationship = await prisma.userBlock.findUnique({\n        where: {\n          blockerId_blockedId: {\n            blockerId: user1.id,\n            blockedId: user2.id,\n          },\n        },\n        include: {\n          blocker: true,\n          blocked: true,\n        },\n      });\n\n      expect(blockingRelationship).toBeTruthy();\n      expect(blockingRelationship?.reason).toBe('Inappropriate messages');\n      expect(blockingRelationship?.blockerId).toBe(user1.id);\n      expect(blockingRelationship?.blockedId).toBe(user2.id);\n    });\n\n    it('should handle mutual blocking', async () => {\n      // User1 blocks User2\n      await prisma.userBlock.create({\n        data: {\n          blockerId: user1.id,\n          blockedId: user2.id,\n          reason: 'Harassment',\n        },\n      });\n\n      // User2 blocks User1\n      await prisma.userBlock.create({\n        data: {\n          blockerId: user2.id,\n          blockedId: user1.id,\n          reason: 'Retaliation',\n        },\n      });\n\n      // Check blocking relationships\n      const user1Blocking = await prisma.user.findUnique({\n        where: { id: user1.id },\n        include: {\n          blocking: {\n            include: {\n              blocked: true,\n            },\n          },\n          blockedBy: {\n            include: {\n              blocker: true,\n            },\n          },\n        },\n      });\n\n      expect(user1Blocking?.blocking).toHaveLength(1);\n      expect(user1Blocking?.blockedBy).toHaveLength(1);\n      expect(user1Blocking?.blocking[0].blockedId).toBe(user2.id);\n      expect(user1Blocking?.blockedBy[0].blockerId).toBe(user2.id);\n    });\n\n    it('should handle unblocking users', async () => {\n      // Create block\n      const userBlock = await prisma.userBlock.create({\n        data: {\n          blockerId: user1.id,\n          blockedId: user2.id,\n          reason: 'Misunderstanding',\n        },\n      });\n\n      // Remove block\n      await prisma.userBlock.delete({\n        where: { id: userBlock.id },\n      });\n\n      // Verify block removed\n      const removedBlock = await prisma.userBlock.findUnique({\n        where: {\n          blockerId_blockedId: {\n            blockerId: user1.id,\n            blockedId: user2.id,\n          },\n        },\n      });\n\n      expect(removedBlock).toBeNull();\n    });\n  });\n\n  describe('Real-time Features Simulation', () => {\n    let testConversation: any;\n\n    beforeEach(async () => {\n      testConversation = await prisma.conversation.create({\n        data: {\n          type: 'DIRECT',\n          participants: {\n            create: [\n              { userId: user1.id, role: 'MEMBER' },\n              { userId: user2.id, role: 'MEMBER' },\n            ],\n          },\n        },\n      });\n    });\n\n    it('should handle typing indicators', async () => {\n      // User starts typing\n      const typingIndicator = await prisma.typingIndicator.create({\n        data: {\n          conversationId: testConversation.id,\n          userId: user1.id,\n          isTyping: true,\n        },\n      });\n\n      // Update typing timestamp\n      const updatedIndicator = await prisma.typingIndicator.update({\n        where: { id: typingIndicator.id },\n        data: {\n          lastTypingAt: new Date(),\n        },\n      });\n\n      // User stops typing\n      await prisma.typingIndicator.update({\n        where: { id: typingIndicator.id },\n        data: {\n          isTyping: false,\n        },\n      });\n\n      // Get typing status\n      const typingStatus = await prisma.typingIndicator.findUnique({\n        where: {\n          conversationId_userId: {\n            conversationId: testConversation.id,\n            userId: user1.id,\n          },\n        },\n      });\n\n      expect(typingStatus?.isTyping).toBe(false);\n      expect(typingStatus?.lastTypingAt).toBeTruthy();\n    });\n\n    it('should handle conversation activity updates', async () => {\n      const startTime = new Date();\n\n      // Create message which should update conversation activity\n      const message = await prisma.message.create({\n        data: {\n          conversationId: testConversation.id,\n          senderId: user1.id,\n          content: 'Active conversation!',\n          messageType: 'TEXT',\n        },\n      });\n\n      // Update conversation last message time\n      const updatedConversation = await prisma.conversation.update({\n        where: { id: testConversation.id },\n        data: {\n          lastMessageAt: message.createdAt,\n        },\n      });\n\n      expect(updatedConversation.lastMessageAt).toBeTruthy();\n      expect(new Date(updatedConversation.lastMessageAt!).getTime()).toBeGreaterThan(startTime.getTime());\n    });\n  });\n\n  describe('Complex Messaging Workflows', () => {\n    it('should handle complete messaging workflow', async () => {\n      // 1. Create group conversation\n      const groupConversation = await prisma.conversation.create({\n        data: {\n          type: 'GROUP',\n          title: 'Therapy Support Group',\n          isActive: true,\n          participants: {\n            create: [\n              { userId: user1.id, role: 'ADMIN' },\n              { userId: user2.id, role: 'MEMBER' },\n              { userId: user3.id, role: 'MEMBER' },\n              { userId: moderatorUser.id, role: 'MODERATOR' },\n            ],\n          },\n        },\n      });\n\n      // 2. Create initial message\n      const welcomeMessage = await prisma.message.create({\n        data: {\n          conversationId: groupConversation.id,\n          senderId: user1.id,\n          content: 'Welcome everyone to our support group!',\n          messageType: 'TEXT',\n        },\n      });\n\n      // 3. Add reactions\n      await prisma.messageReaction.createMany({\n        data: [\n          { messageId: welcomeMessage.id, userId: user2.id, emoji: 'ðŸ‘‹' },\n          { messageId: welcomeMessage.id, userId: user3.id, emoji: 'ðŸ˜Š' },\n          { messageId: welcomeMessage.id, userId: moderatorUser.id, emoji: 'ðŸ’œ' },\n        ],\n      });\n\n      // 4. Create threaded responses\n      const response1 = await prisma.message.create({\n        data: {\n          conversationId: groupConversation.id,\n          senderId: user2.id,\n          content: 'Thank you for creating this space!',\n          messageType: 'TEXT',\n          replyToId: welcomeMessage.id,\n        },\n      });\n\n      const response2 = await prisma.message.create({\n        data: {\n          conversationId: groupConversation.id,\n          senderId: user3.id,\n          content: 'Looking forward to our discussions!',\n          messageType: 'TEXT',\n          replyToId: welcomeMessage.id,\n        },\n      });\n\n      // 5. Add read receipts\n      await prisma.messageReadReceipt.createMany({\n        data: [\n          { messageId: welcomeMessage.id, userId: user2.id },\n          { messageId: welcomeMessage.id, userId: user3.id },\n          { messageId: welcomeMessage.id, userId: moderatorUser.id },\n          { messageId: response1.id, userId: user1.id },\n          { messageId: response1.id, userId: user3.id },\n          { messageId: response2.id, userId: user1.id },\n          { messageId: response2.id, userId: user2.id },\n        ],\n      });\n\n      // 6. Update conversation activity\n      await prisma.conversation.update({\n        where: { id: groupConversation.id },\n        data: { lastMessageAt: new Date() },\n      });\n\n      // 7. Verify complete workflow\n      const completeConversation = await prisma.conversation.findUnique({\n        where: { id: groupConversation.id },\n        include: {\n          participants: {\n            include: {\n              user: {\n                select: {\n                  id: true,\n                  firstName: true,\n                  lastName: true,\n                  role: true,\n                },\n              },\n            },\n          },\n          messages: {\n            include: {\n              reactions: {\n                include: {\n                  user: {\n                    select: {\n                      id: true,\n                      firstName: true,\n                    },\n                  },\n                },\n              },\n              readReceipts: {\n                include: {\n                  user: {\n                    select: {\n                      id: true,\n                      firstName: true,\n                    },\n                  },\n                },\n              },\n              replies: {\n                include: {\n                  sender: {\n                    select: {\n                      id: true,\n                      firstName: true,\n                    },\n                  },\n                },\n              },\n            },\n            orderBy: {\n              createdAt: 'asc',\n            },\n          },\n        },\n      });\n\n      // Comprehensive assertions\n      expect(completeConversation?.participants).toHaveLength(4);\n      expect(completeConversation?.messages).toHaveLength(3);\n      expect(completeConversation?.messages[0].reactions).toHaveLength(3);\n      expect(completeConversation?.messages[0].replies).toHaveLength(2);\n      expect(completeConversation?.messages[0].readReceipts).toHaveLength(3);\n      expect(completeConversation?.lastMessageAt).toBeTruthy();\n      \n      // Verify role distribution\n      const roles = completeConversation?.participants.map(p => p.role);\n      expect(roles).toContain('ADMIN');\n      expect(roles).toContain('MODERATOR');\n      expect(roles.filter(r => r === 'MEMBER')).toHaveLength(2);\n    });\n  });\n});"],"version":3}