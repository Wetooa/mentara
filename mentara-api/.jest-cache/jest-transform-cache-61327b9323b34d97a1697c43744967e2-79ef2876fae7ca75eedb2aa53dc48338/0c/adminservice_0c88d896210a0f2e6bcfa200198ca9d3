c626a80320a7c572c887c33c6f482d03
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var AdminService_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AdminService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
let AdminService = AdminService_1 = class AdminService {
    prisma;
    logger = new common_1.Logger(AdminService_1.name);
    constructor(prisma) {
        this.prisma = prisma;
    }
    async findAll() {
        try {
            const admins = await this.prisma.admin.findMany({
                orderBy: { createdAt: 'desc' },
            });
            return admins.map((admin) => ({
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            }));
        }
        catch (error) {
            this.logger.error('Failed to retrieve admins:', error);
            throw error;
        }
    }
    async findOne(id) {
        try {
            const admin = await this.prisma.admin.findUnique({
                where: { userId: id },
            });
            if (!admin) {
                return null;
            }
            return {
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            };
        }
        catch (error) {
            this.logger.error(`Failed to retrieve admin ${id}:`, error);
            throw error;
        }
    }
    async create(data) {
        try {
            // First check if user exists
            const userExists = await this.prisma.user.findUnique({
                where: { id: data.userId },
            });
            if (!userExists) {
                throw new common_1.NotFoundException(`User with ID ${data.userId} not found`);
            }
            // Check if admin already exists
            const existingAdmin = await this.prisma.admin.findUnique({
                where: { userId: data.userId },
            });
            if (existingAdmin) {
                throw new common_1.ConflictException(`User ${data.userId} is already an admin`);
            }
            const admin = await this.prisma.admin.create({
                data: {
                    userId: data.userId,
                    permissions: data.permissions,
                    adminLevel: data.adminLevel ?? 'admin',
                },
            });
            this.logger.log(`Created admin for user ${data.userId}`);
            return {
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            };
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.ConflictException) {
                throw error;
            }
            if (error instanceof client_1.Prisma.PrismaClientKnownRequestError) {
                if (error.code === 'P2002') {
                    throw new common_1.ConflictException(`User ${data.userId} is already an admin`);
                }
                if (error.code === 'P2003') {
                    throw new common_1.NotFoundException(`User with ID ${data.userId} not found`);
                }
            }
            this.logger.error('Failed to create admin:', error);
            throw error;
        }
    }
    async update(id, data) {
        try {
            const admin = await this.prisma.admin.update({
                where: { userId: id },
                data: {
                    permissions: data.permissions,
                    adminLevel: data.adminLevel,
                },
            });
            this.logger.log(`Updated admin ${id}`);
            return {
                userId: admin.userId,
                permissions: admin.permissions,
                adminLevel: admin.adminLevel,
                createdAt: admin.createdAt,
                updatedAt: admin.updatedAt,
            };
        }
        catch (error) {
            if (error instanceof client_1.Prisma.PrismaClientKnownRequestError) {
                if (error.code === 'P2025') {
                    throw new common_1.NotFoundException(`Admin with ID ${id} not found`);
                }
            }
            this.logger.error(`Failed to update admin ${id}:`, error);
            throw error;
        }
    }
    async remove(id) {
        try {
            await this.prisma.admin.delete({ where: { userId: id } });
            this.logger.log(`Deleted admin ${id}`);
        }
        catch (error) {
            if (error instanceof client_1.Prisma.PrismaClientKnownRequestError) {
                if (error.code === 'P2025') {
                    throw new common_1.NotFoundException(`Admin with ID ${id} not found`);
                }
            }
            this.logger.error(`Failed to delete admin ${id}:`, error);
            throw error;
        }
    }
    // ===== THERAPIST APPLICATION MANAGEMENT =====
    async getAllTherapistApplications(params) {
        try {
            const { status, page, limit } = params;
            const skip = (page - 1) * limit;
            const where = {};
            if (status) {
                where.status = status;
            }
            const [applications, totalCount] = await Promise.all([
                this.prisma.therapist.findMany({
                    where,
                    skip,
                    take: limit,
                    orderBy: { submissionDate: 'desc' },
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                email: true,
                                createdAt: true,
                            },
                        },
                        processedByAdmin: {
                            include: {
                                user: {
                                    select: {
                                        firstName: true,
                                        lastName: true,
                                    },
                                },
                            },
                        },
                    },
                }),
                this.prisma.therapist.count({ where }),
            ]);
            return {
                applications,
                totalCount,
                page,
                totalPages: Math.ceil(totalCount / limit),
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve therapist applications:', error);
            throw error;
        }
    }
    async getTherapistApplication(applicationId) {
        try {
            return await this.prisma.therapist.findUnique({
                where: { userId: applicationId },
                include: {
                    user: true,
                    processedByAdmin: {
                        include: {
                            user: {
                                select: {
                                    firstName: true,
                                    lastName: true,
                                },
                            },
                        },
                    },
                },
            });
        }
        catch (error) {
            this.logger.error('Failed to retrieve therapist application:', error);
            throw error;
        }
    }
    async approveTherapistApplication(applicationId, adminId, notes) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // Update therapist status
                const therapist = await tx.therapist.update({
                    where: { userId: applicationId },
                    data: {
                        status: 'approved',
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                    },
                });
                // Update user role
                await tx.user.update({
                    where: { id: applicationId },
                    data: { role: 'therapist' },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'APPROVE_THERAPIST_APPLICATION',
                        entity: 'therapist',
                        entityId: applicationId,
                        metadata: {
                            applicationId,
                            notes,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, therapist };
            });
        }
        catch (error) {
            this.logger.error('Failed to approve therapist application:', error);
            throw error;
        }
    }
    async rejectTherapistApplication(applicationId, adminId, reason, notes) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                // Update therapist status
                const therapist = await tx.therapist.update({
                    where: { userId: applicationId },
                    data: {
                        status: 'rejected',
                        processedByAdminId: adminId,
                        processingDate: new Date(),
                    },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'REJECT_THERAPIST_APPLICATION',
                        entity: 'therapist',
                        entityId: applicationId,
                        metadata: {
                            applicationId,
                            reason,
                            notes,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, therapist, reason };
            });
        }
        catch (error) {
            this.logger.error('Failed to reject therapist application:', error);
            throw error;
        }
    }
    // ===== USER MANAGEMENT =====
    async getAllUsers(params) {
        try {
            const { role, page, limit, search } = params;
            const skip = (page - 1) * limit;
            const where = {};
            if (role) {
                where.role = role;
            }
            if (search) {
                where.OR = [
                    { firstName: { contains: search, mode: 'insensitive' } },
                    { lastName: { contains: search, mode: 'insensitive' } },
                    { email: { contains: search, mode: 'insensitive' } },
                ];
            }
            const [users, totalCount] = await Promise.all([
                this.prisma.user.findMany({
                    where,
                    skip,
                    take: limit,
                    orderBy: { createdAt: 'desc' },
                    select: {
                        id: true,
                        firstName: true,
                        lastName: true,
                        email: true,
                        role: true,
                        isActive: true,
                        isVerified: true,
                        createdAt: true,
                        lastLoginAt: true,
                        suspendedAt: true,
                        suspensionReason: true,
                    },
                }),
                this.prisma.user.count({ where }),
            ]);
            return {
                users,
                totalCount,
                page,
                totalPages: Math.ceil(totalCount / limit),
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve users:', error);
            throw error;
        }
    }
    async getUser(userId) {
        try {
            return await this.prisma.user.findUnique({
                where: { id: userId },
                include: {
                    client: true,
                    therapist: true,
                    admin: true,
                    moderator: true,
                },
            });
        }
        catch (error) {
            this.logger.error('Failed to retrieve user:', error);
            throw error;
        }
    }
    async suspendUser(userId, adminId, reason, duration) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                const suspensionEnd = duration
                    ? new Date(Date.now() + duration * 24 * 60 * 60 * 1000)
                    : null;
                const user = await tx.user.update({
                    where: { id: userId },
                    data: {
                        suspendedAt: new Date(),
                        suspendedBy: adminId,
                        suspensionReason: reason,
                        isActive: false,
                    },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'SUSPEND_USER',
                        entity: 'user',
                        entityId: userId,
                        metadata: {
                            userId,
                            reason,
                            duration,
                            suspensionEnd: suspensionEnd?.toISOString(),
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, user };
            });
        }
        catch (error) {
            this.logger.error('Failed to suspend user:', error);
            throw error;
        }
    }
    async unsuspendUser(userId, adminId) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                const user = await tx.user.update({
                    where: { id: userId },
                    data: {
                        suspendedAt: null,
                        suspendedBy: null,
                        suspensionReason: null,
                        isActive: true,
                    },
                });
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: 'UNSUSPEND_USER',
                        entity: 'user',
                        entityId: userId,
                        metadata: {
                            userId,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, user };
            });
        }
        catch (error) {
            this.logger.error('Failed to unsuspend user:', error);
            throw error;
        }
    }
    // ===== PLATFORM ANALYTICS =====
    async getPlatformOverview() {
        try {
            const [totalUsers, totalClients, totalTherapists, pendingApplications, totalCommunities, totalPosts, totalSessions,] = await Promise.all([
                this.prisma.user.count(),
                this.prisma.client.count(),
                this.prisma.therapist.count({ where: { status: 'approved' } }),
                this.prisma.therapist.count({ where: { status: 'pending' } }),
                this.prisma.community.count(),
                this.prisma.post.count(),
                this.prisma.meeting.count(),
            ]);
            const recentActivity = await this.prisma.user.findMany({
                take: 10,
                orderBy: { createdAt: 'desc' },
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    role: true,
                    createdAt: true,
                },
            });
            return {
                overview: {
                    totalUsers,
                    totalClients,
                    totalTherapists,
                    pendingApplications,
                    totalCommunities,
                    totalPosts,
                    totalSessions,
                },
                recentActivity,
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve platform overview:', error);
            throw error;
        }
    }
    async getMatchingPerformance(startDate, endDate) {
        try {
            const start = startDate
                ? new Date(startDate)
                : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const end = endDate ? new Date(endDate) : new Date();
            const matchingMetrics = await this.prisma.matchHistory.findMany({
                where: {
                    createdAt: {
                        gte: start,
                        lte: end,
                    },
                },
            });
            const totalRecommendations = matchingMetrics.length;
            const successfulMatches = matchingMetrics.filter((m) => m.becameClient).length;
            const viewedRecommendations = matchingMetrics.filter((m) => m.wasViewed).length;
            const contactedTherapists = matchingMetrics.filter((m) => m.wasContacted).length;
            const averageMatchScore = totalRecommendations > 0
                ? matchingMetrics.reduce((sum, m) => sum + m.totalScore, 0) /
                    totalRecommendations
                : 0;
            const conversionRate = totalRecommendations > 0
                ? (successfulMatches / totalRecommendations) * 100
                : 0;
            const clickThroughRate = totalRecommendations > 0
                ? (viewedRecommendations / totalRecommendations) * 100
                : 0;
            return {
                period: { start, end },
                metrics: {
                    totalRecommendations,
                    successfulMatches,
                    viewedRecommendations,
                    contactedTherapists,
                    averageMatchScore,
                    conversionRate,
                    clickThroughRate,
                },
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve matching performance:', error);
            throw error;
        }
    }
    // ===== CONTENT MODERATION =====
    async getFlaggedContent(params) {
        try {
            const { type, page, limit } = params;
            const skip = (page - 1) * limit;
            // For now, we'll consider posts and comments that might need moderation
            // In a real system, you'd have a flagging mechanism
            const flaggedPosts = await this.prisma.post.findMany({
                where: {
                // Add conditions for flagged content
                // For now, let's get recent posts that might need review
                },
                skip,
                take: type === 'comment' ? 0 : limit,
                orderBy: { createdAt: 'desc' },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                        },
                    },
                    room: {
                        select: {
                            name: true,
                            roomGroup: {
                                select: {
                                    community: {
                                        select: {
                                            name: true,
                                        },
                                    },
                                },
                            },
                        },
                    },
                },
            });
            const flaggedComments = await this.prisma.comment.findMany({
                where: {
                // Add conditions for flagged content
                },
                skip: type === 'post' ? 0 : skip,
                take: type === 'post' ? 0 : limit,
                orderBy: { createdAt: 'desc' },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                        },
                    },
                    post: {
                        select: {
                            title: true,
                        },
                    },
                },
            });
            return {
                posts: flaggedPosts,
                comments: flaggedComments,
                page,
                totalItems: flaggedPosts.length + flaggedComments.length,
            };
        }
        catch (error) {
            this.logger.error('Failed to retrieve flagged content:', error);
            throw error;
        }
    }
    async moderateContent(contentType, contentId, adminId, action, reason) {
        try {
            return await this.prisma.$transaction(async (tx) => {
                let moderatedContent;
                if (contentType === 'post') {
                    if (action === 'remove') {
                        moderatedContent = await tx.post.delete({
                            where: { id: contentId },
                        });
                    }
                    else {
                        // For approve/flag, we could add moderation status fields
                        moderatedContent = await tx.post.findUnique({
                            where: { id: contentId },
                        });
                    }
                }
                else if (contentType === 'comment') {
                    if (action === 'remove') {
                        moderatedContent = await tx.comment.delete({
                            where: { id: contentId },
                        });
                    }
                    else {
                        moderatedContent = await tx.comment.findUnique({
                            where: { id: contentId },
                        });
                    }
                }
                // Create audit log
                await tx.auditLog.create({
                    data: {
                        userId: adminId,
                        action: contentType === 'post' ? 'MODERATE_POST' : 'MODERATE_COMMENT',
                        entity: contentType,
                        entityId: contentId,
                        metadata: {
                            contentId,
                            contentType,
                            moderationAction: action,
                            reason,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return { success: true, action, moderatedContent };
            });
        }
        catch (error) {
            this.logger.error('Failed to moderate content:', error);
            throw error;
        }
    }
};
exports.AdminService = AdminService;
exports.AdminService = AdminService = AdminService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [prisma_client_provider_1.PrismaService])
], AdminService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2FkbWluL2FkbWluLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUt3QjtBQUN4QixnRkFBb0U7QUFNcEUsMkNBQXdDO0FBR2pDLElBQU0sWUFBWSxvQkFBbEIsTUFBTSxZQUFZO0lBR0g7SUFGSCxNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsY0FBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXhELFlBQW9CLE1BQXFCO1FBQXJCLFdBQU0sR0FBTixNQUFNLENBQWU7SUFBRyxDQUFDO0lBRTdDLEtBQUssQ0FBQyxPQUFPO1FBQ1gsSUFBSSxDQUFDO1lBQ0gsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7Z0JBQzlDLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUU7YUFDL0IsQ0FBQyxDQUFDO1lBRUgsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM1QixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07Z0JBQ3BCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO2dCQUM1QixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7Z0JBQzFCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUzthQUMzQixDQUFDLENBQUMsQ0FBQztRQUNOLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDdkQsTUFBTSxLQUFLLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBVTtRQUN0QixJQUFJLENBQUM7WUFDSCxNQUFNLEtB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Z0IsRUFBRSxDQUFDO1lBQ3JELENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN4RCxNQUFNLEtBQUssQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQWp1Qlksb0NBQVk7dUJBQVosWUFBWTtJQUR4QixJQUFBLG1CQUFVLEdBQUU7cUNBSWlCLHNDQUFhO0dBSDlCLFlBQVksQ0FpdUJ4QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvYWRtaW4vYWRtaW4uc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBMb2dnZXIsXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBDb25mbGljdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7XG4gIENyZWF0ZUFkbWluRHRvLFxuICBVcGRhdGVBZG1pbkR0byxcbiAgQWRtaW5SZXNwb25zZUR0byxcbn0gZnJvbSAnLi9kdG8vYWRtaW4uZHRvJztcbmltcG9ydCB7IFByaXNtYSB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEFkbWluU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihBZG1pblNlcnZpY2UubmFtZSk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwcmlzbWE6IFByaXNtYVNlcnZpY2UpIHt9XG5cbiAgYXN5bmMgZmluZEFsbCgpOiBQcm9taXNlPEFkbWluUmVzcG9uc2VEdG9bXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZG1pbnMgPSBhd2FpdCB0aGlzLnByaXNtYS5hZG1pbi5maW5kTWFueSh7XG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gYWRtaW5zLm1hcCgoYWRtaW4pID0+ICh7XG4gICAgICAgIHVzZXJJZDogYWRtaW4udXNlcklkLFxuICAgICAgICBwZXJtaXNzaW9uczogYWRtaW4ucGVybWlzc2lvbnMsXG4gICAgICAgIGFkbWluTGV2ZWw6IGFkbWluLmFkbWluTGV2ZWwsXG4gICAgICAgIGNyZWF0ZWRBdDogYWRtaW4uY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IGFkbWluLnVwZGF0ZWRBdCxcbiAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSBhZG1pbnM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmluZE9uZShpZDogc3RyaW5nKTogUHJvbWlzZTxBZG1pblJlc3BvbnNlRHRvIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZG1pbiA9IGF3YWl0IHRoaXMucHJpc21hLmFkbWluLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IGlkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFhZG1pbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcklkOiBhZG1pbi51c2VySWQsXG4gICAgICAgIHBlcm1pc3Npb25zOiBhZG1pbi5wZXJtaXNzaW9ucyxcbiAgICAgICAgYWRtaW5MZXZlbDogYWRtaW4uYWRtaW5MZXZlbCxcbiAgICAgICAgY3JlYXRlZEF0OiBhZG1pbi5jcmVhdGVkQXQsXG4gICAgICAgIHVwZGF0ZWRBdDogYWRtaW4udXBkYXRlZEF0LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEZhaWxlZCB0byByZXRyaWV2ZSBhZG1pbiAke2lkfTpgLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjcmVhdGUoZGF0YTogQ3JlYXRlQWRtaW5EdG8pOiBQcm9taXNlPEFkbWluUmVzcG9uc2VEdG8+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdXNlciBleGlzdHNcbiAgICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogZGF0YS51c2VySWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKGBVc2VyIHdpdGggSUQgJHtkYXRhLnVzZXJJZH0gbm90IGZvdW5kYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGFkbWluIGFscmVhZHkgZXhpc3RzXG4gICAgICBjb25zdCBleGlzdGluZ0FkbWluID0gYXdhaXQgdGhpcy5wcmlzbWEuYWRtaW4uZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZDogZGF0YS51c2VySWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXhpc3RpbmdBZG1pbikge1xuICAgICAgICB0aHJvdyBuZXcgQ29uZmxpY3RFeGNlcHRpb24oYFVzZXIgJHtkYXRhLnVzZXJJZH0gaXMgYWxyZWFkeSBhbiBhZG1pbmApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhZG1pbiA9IGF3YWl0IHRoaXMucHJpc21hLmFkbWluLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkLFxuICAgICAgICAgIHBlcm1pc3Npb25zOiBkYXRhLnBlcm1pc3Npb25zLFxuICAgICAgICAgIGFkbWluTGV2ZWw6IGRhdGEuYWRtaW5MZXZlbCA/PyAnYWRtaW4nLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgQ3JlYXRlZCBhZG1pbiBmb3IgdXNlciAke2RhdGEudXNlcklkfWApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IGFkbWluLnVzZXJJZCxcbiAgICAgICAgcGVybWlzc2lvbnM6IGFkbWluLnBlcm1pc3Npb25zLFxuICAgICAgICBhZG1pbkxldmVsOiBhZG1pbi5hZG1pbkxldmVsLFxuICAgICAgICBjcmVhdGVkQXQ6IGFkbWluLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiBhZG1pbi51cGRhdGVkQXQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFeGNlcHRpb24gfHxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBDb25mbGljdEV4Y2VwdGlvblxuICAgICAgKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBQcmlzbWEuUHJpc21hQ2xpZW50S25vd25SZXF1ZXN0RXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQMjAwMicpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgQ29uZmxpY3RFeGNlcHRpb24oXG4gICAgICAgICAgICBgVXNlciAke2RhdGEudXNlcklkfSBpcyBhbHJlYWR5IGFuIGFkbWluYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUDIwMDMnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKGBVc2VyIHdpdGggSUQgJHtkYXRhLnVzZXJJZH0gbm90IGZvdW5kYCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgYWRtaW46JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGRhdGE6IFVwZGF0ZUFkbWluRHRvKTogUHJvbWlzZTxBZG1pblJlc3BvbnNlRHRvPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFkbWluID0gYXdhaXQgdGhpcy5wcmlzbWEuYWRtaW4udXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBpZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgcGVybWlzc2lvbnM6IGRhdGEucGVybWlzc2lvbnMsXG4gICAgICAgICAgYWRtaW5MZXZlbDogZGF0YS5hZG1pbkxldmVsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgVXBkYXRlZCBhZG1pbiAke2lkfWApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IGFkbWluLnVzZXJJZCxcbiAgICAgICAgcGVybWlzc2lvbnM6IGFkbWluLnBlcm1pc3Npb25zLFxuICAgICAgICBhZG1pbkxldmVsOiBhZG1pbi5hZG1pbkxldmVsLFxuICAgICAgICBjcmVhdGVkQXQ6IGFkbWluLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiBhZG1pbi51cGRhdGVkQXQsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBQcmlzbWEuUHJpc21hQ2xpZW50S25vd25SZXF1ZXN0RXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQMjAyNScpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oYEFkbWluIHdpdGggSUQgJHtpZH0gbm90IGZvdW5kYCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgYWRtaW4gJHtpZH06YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVtb3ZlKGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuYWRtaW4uZGVsZXRlKHsgd2hlcmU6IHsgdXNlcklkOiBpZCB9IH0pO1xuICAgICAgdGhpcy5sb2dnZXIubG9nKGBEZWxldGVkIGFkbWluICR7aWR9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFByaXNtYS5QcmlzbWFDbGllbnRLbm93blJlcXVlc3RFcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1AyMDI1Jykge1xuICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihgQWRtaW4gd2l0aCBJRCAke2lkfSBub3QgZm91bmRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIGRlbGV0ZSBhZG1pbiAke2lkfTpgLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PSBUSEVSQVBJU1QgQVBQTElDQVRJT04gTUFOQUdFTUVOVCA9PT09PVxuXG4gIGFzeW5jIGdldEFsbFRoZXJhcGlzdEFwcGxpY2F0aW9ucyhwYXJhbXM6IHtcbiAgICBzdGF0dXM/OiBzdHJpbmc7XG4gICAgcGFnZTogbnVtYmVyO1xuICAgIGxpbWl0OiBudW1iZXI7XG4gIH0pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBzdGF0dXMsIHBhZ2UsIGxpbWl0IH0gPSBwYXJhbXM7XG4gICAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgICBjb25zdCB3aGVyZTogYW55ID0ge307XG4gICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgIHdoZXJlLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgIH1cblxuICAgICAgY29uc3QgW2FwcGxpY2F0aW9ucywgdG90YWxDb3VudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHRoaXMucHJpc21hLnRoZXJhcGlzdC5maW5kTWFueSh7XG4gICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgc2tpcCxcbiAgICAgICAgICB0YWtlOiBsaW1pdCxcbiAgICAgICAgICBvcmRlckJ5OiB7IHN1Ym1pc3Npb25EYXRlOiAnZGVzYycgfSxcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvY2Vzc2VkQnlBZG1pbjoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICB0aGlzLnByaXNtYS50aGVyYXBpc3QuY291bnQoeyB3aGVyZSB9KSxcbiAgICAgIF0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcHBsaWNhdGlvbnMsXG4gICAgICAgIHRvdGFsQ291bnQsXG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHRvdGFsUGFnZXM6IE1hdGguY2VpbCh0b3RhbENvdW50IC8gbGltaXQpLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSB0aGVyYXBpc3QgYXBwbGljYXRpb25zOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFRoZXJhcGlzdEFwcGxpY2F0aW9uKGFwcGxpY2F0aW9uSWQ6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IGFwcGxpY2F0aW9uSWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgICAgcHJvY2Vzc2VkQnlBZG1pbjoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgdGhlcmFwaXN0IGFwcGxpY2F0aW9uOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFwcHJvdmVUaGVyYXBpc3RBcHBsaWNhdGlvbihcbiAgICBhcHBsaWNhdGlvbklkOiBzdHJpbmcsXG4gICAgYWRtaW5JZDogc3RyaW5nLFxuICAgIG5vdGVzPzogc3RyaW5nLFxuICApIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gVXBkYXRlIHRoZXJhcGlzdCBzdGF0dXNcbiAgICAgICAgY29uc3QgdGhlcmFwaXN0ID0gYXdhaXQgdHgudGhlcmFwaXN0LnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBhcHBsaWNhdGlvbklkIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgICAgICAgcHJvY2Vzc2VkQnlBZG1pbklkOiBhZG1pbklkLFxuICAgICAgICAgICAgcHJvY2Vzc2luZ0RhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHVzZXIgcm9sZVxuICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IGFwcGxpY2F0aW9uSWQgfSxcbiAgICAgICAgICBkYXRhOiB7IHJvbGU6ICd0aGVyYXBpc3QnIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2dcbiAgICAgICAgYXdhaXQgdHguYXVkaXRMb2cuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBhY3Rpb246ICdBUFBST1ZFX1RIRVJBUElTVF9BUFBMSUNBVElPTicsXG4gICAgICAgICAgICBlbnRpdHk6ICd0aGVyYXBpc3QnLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGFwcGxpY2F0aW9uSWQsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBhcHBsaWNhdGlvbklkLFxuICAgICAgICAgICAgICBub3RlcyxcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHRoZXJhcGlzdCB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gYXBwcm92ZSB0aGVyYXBpc3QgYXBwbGljYXRpb246JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVqZWN0VGhlcmFwaXN0QXBwbGljYXRpb24oXG4gICAgYXBwbGljYXRpb25JZDogc3RyaW5nLFxuICAgIGFkbWluSWQ6IHN0cmluZyxcbiAgICByZWFzb246IHN0cmluZyxcbiAgICBub3Rlcz86IHN0cmluZyxcbiAgKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGVyYXBpc3Qgc3RhdHVzXG4gICAgICAgIGNvbnN0IHRoZXJhcGlzdCA9IGF3YWl0IHR4LnRoZXJhcGlzdC51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogYXBwbGljYXRpb25JZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXR1czogJ3JlamVjdGVkJyxcbiAgICAgICAgICAgIHByb2Nlc3NlZEJ5QWRtaW5JZDogYWRtaW5JZCxcbiAgICAgICAgICAgIHByb2Nlc3NpbmdEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2dcbiAgICAgICAgYXdhaXQgdHguYXVkaXRMb2cuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBhY3Rpb246ICdSRUpFQ1RfVEhFUkFQSVNUX0FQUExJQ0FUSU9OJyxcbiAgICAgICAgICAgIGVudGl0eTogJ3RoZXJhcGlzdCcsXG4gICAgICAgICAgICBlbnRpdHlJZDogYXBwbGljYXRpb25JZCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIGFwcGxpY2F0aW9uSWQsXG4gICAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICAgICAgbm90ZXMsXG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0aGVyYXBpc3QsIHJlYXNvbiB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmVqZWN0IHRoZXJhcGlzdCBhcHBsaWNhdGlvbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PSBVU0VSIE1BTkFHRU1FTlQgPT09PT1cblxuICBhc3luYyBnZXRBbGxVc2VycyhwYXJhbXM6IHtcbiAgICByb2xlPzogc3RyaW5nO1xuICAgIHBhZ2U6IG51bWJlcjtcbiAgICBsaW1pdDogbnVtYmVyO1xuICAgIHNlYXJjaD86IHN0cmluZztcbiAgfSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHJvbGUsIHBhZ2UsIGxpbWl0LCBzZWFyY2ggfSA9IHBhcmFtcztcbiAgICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7fTtcbiAgICAgIGlmIChyb2xlKSB7XG4gICAgICAgIHdoZXJlLnJvbGUgPSByb2xlO1xuICAgICAgfVxuICAgICAgaWYgKHNlYXJjaCkge1xuICAgICAgICB3aGVyZS5PUiA9IFtcbiAgICAgICAgICB7IGZpcnN0TmFtZTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiAnaW5zZW5zaXRpdmUnIH0gfSxcbiAgICAgICAgICB7IGxhc3ROYW1lOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6ICdpbnNlbnNpdGl2ZScgfSB9LFxuICAgICAgICAgIHsgZW1haWw6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogJ2luc2Vuc2l0aXZlJyB9IH0sXG4gICAgICAgIF07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IFt1c2VycywgdG90YWxDb3VudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHRoaXMucHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgIHNraXAsXG4gICAgICAgICAgdGFrZTogbGltaXQsXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgaXNWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgIGxhc3RMb2dpbkF0OiB0cnVlLFxuICAgICAgICAgICAgc3VzcGVuZGVkQXQ6IHRydWUsXG4gICAgICAgICAgICBzdXNwZW5zaW9uUmVhc29uOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICB0aGlzLnByaXNtYS51c2VyLmNvdW50KHsgd2hlcmUgfSksXG4gICAgICBdKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcnMsXG4gICAgICAgIHRvdGFsQ291bnQsXG4gICAgICAgIHBhZ2UsXG4gICAgICAgIHRvdGFsUGFnZXM6IE1hdGguY2VpbCh0b3RhbENvdW50IC8gbGltaXQpLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSB1c2VyczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRVc2VyKHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBjbGllbnQ6IHRydWUsXG4gICAgICAgICAgdGhlcmFwaXN0OiB0cnVlLFxuICAgICAgICAgIGFkbWluOiB0cnVlLFxuICAgICAgICAgIG1vZGVyYXRvcjogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHVzZXI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3VzcGVuZFVzZXIoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgYWRtaW5JZDogc3RyaW5nLFxuICAgIHJlYXNvbjogc3RyaW5nLFxuICAgIGR1cmF0aW9uPzogbnVtYmVyLFxuICApIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgY29uc3Qgc3VzcGVuc2lvbkVuZCA9IGR1cmF0aW9uXG4gICAgICAgICAgPyBuZXcgRGF0ZShEYXRlLm5vdygpICsgZHVyYXRpb24gKiAyNCAqIDYwICogNjAgKiAxMDAwKVxuICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzdXNwZW5kZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHN1c3BlbmRlZEJ5OiBhZG1pbklkLFxuICAgICAgICAgICAgc3VzcGVuc2lvblJlYXNvbjogcmVhc29uLFxuICAgICAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2dcbiAgICAgICAgYXdhaXQgdHguYXVkaXRMb2cuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBhY3Rpb246ICdTVVNQRU5EX1VTRVInLFxuICAgICAgICAgICAgZW50aXR5OiAndXNlcicsXG4gICAgICAgICAgICBlbnRpdHlJZDogdXNlcklkLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICByZWFzb24sXG4gICAgICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgICAgICBzdXNwZW5zaW9uRW5kOiBzdXNwZW5zaW9uRW5kPy50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXNlciB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gc3VzcGVuZCB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVuc3VzcGVuZFVzZXIodXNlcklkOiBzdHJpbmcsIGFkbWluSWQ6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdHgudXNlci51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzdXNwZW5kZWRBdDogbnVsbCxcbiAgICAgICAgICAgIHN1c3BlbmRlZEJ5OiBudWxsLFxuICAgICAgICAgICAgc3VzcGVuc2lvblJlYXNvbjogbnVsbCxcbiAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2dcbiAgICAgICAgYXdhaXQgdHguYXVkaXRMb2cuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IGFkbWluSWQsXG4gICAgICAgICAgICBhY3Rpb246ICdVTlNVU1BFTkRfVVNFUicsXG4gICAgICAgICAgICBlbnRpdHk6ICd1c2VyJyxcbiAgICAgICAgICAgIGVudGl0eUlkOiB1c2VySWQsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1c2VyIH07XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1bnN1c3BlbmQgdXNlcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PSBQTEFURk9STSBBTkFMWVRJQ1MgPT09PT1cblxuICBhc3luYyBnZXRQbGF0Zm9ybU92ZXJ2aWV3KCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbXG4gICAgICAgIHRvdGFsVXNlcnMsXG4gICAgICAgIHRvdGFsQ2xpZW50cyxcbiAgICAgICAgdG90YWxUaGVyYXBpc3RzLFxuICAgICAgICBwZW5kaW5nQXBwbGljYXRpb25zLFxuICAgICAgICB0b3RhbENvbW11bml0aWVzLFxuICAgICAgICB0b3RhbFBvc3RzLFxuICAgICAgICB0b3RhbFNlc3Npb25zLFxuICAgICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgdGhpcy5wcmlzbWEudXNlci5jb3VudCgpLFxuICAgICAgICB0aGlzLnByaXNtYS5jbGllbnQuY291bnQoKSxcbiAgICAgICAgdGhpcy5wcmlzbWEudGhlcmFwaXN0LmNvdW50KHsgd2hlcmU6IHsgc3RhdHVzOiAnYXBwcm92ZWQnIH0gfSksXG4gICAgICAgIHRoaXMucHJpc21hLnRoZXJhcGlzdC5jb3VudCh7IHdoZXJlOiB7IHN0YXR1czogJ3BlbmRpbmcnIH0gfSksXG4gICAgICAgIHRoaXMucHJpc21hLmNvbW11bml0eS5jb3VudCgpLFxuICAgICAgICB0aGlzLnByaXNtYS5wb3N0LmNvdW50KCksXG4gICAgICAgIHRoaXMucHJpc21hLm1lZXRpbmcuY291bnQoKSxcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCByZWNlbnRBY3Rpdml0eSA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgICAgICB0YWtlOiAxMCxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgcm9sZTogdHJ1ZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3ZlcnZpZXc6IHtcbiAgICAgICAgICB0b3RhbFVzZXJzLFxuICAgICAgICAgIHRvdGFsQ2xpZW50cyxcbiAgICAgICAgICB0b3RhbFRoZXJhcGlzdHMsXG4gICAgICAgICAgcGVuZGluZ0FwcGxpY2F0aW9ucyxcbiAgICAgICAgICB0b3RhbENvbW11bml0aWVzLFxuICAgICAgICAgIHRvdGFsUG9zdHMsXG4gICAgICAgICAgdG90YWxTZXNzaW9ucyxcbiAgICAgICAgfSxcbiAgICAgICAgcmVjZW50QWN0aXZpdHksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHBsYXRmb3JtIG92ZXJ2aWV3OicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldE1hdGNoaW5nUGVyZm9ybWFuY2Uoc3RhcnREYXRlPzogc3RyaW5nLCBlbmREYXRlPzogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gc3RhcnREYXRlXG4gICAgICAgID8gbmV3IERhdGUoc3RhcnREYXRlKVxuICAgICAgICA6IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgY29uc3QgZW5kID0gZW5kRGF0ZSA/IG5ldyBEYXRlKGVuZERhdGUpIDogbmV3IERhdGUoKTtcblxuICAgICAgY29uc3QgbWF0Y2hpbmdNZXRyaWNzID0gYXdhaXQgdGhpcy5wcmlzbWEubWF0Y2hIaXN0b3J5LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogc3RhcnQsXG4gICAgICAgICAgICBsdGU6IGVuZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRvdGFsUmVjb21tZW5kYXRpb25zID0gbWF0Y2hpbmdNZXRyaWNzLmxlbmd0aDtcbiAgICAgIGNvbnN0IHN1Y2Nlc3NmdWxNYXRjaGVzID0gbWF0Y2hpbmdNZXRyaWNzLmZpbHRlcihcbiAgICAgICAgKG0pID0+IG0uYmVjYW1lQ2xpZW50LFxuICAgICAgKS5sZW5ndGg7XG4gICAgICBjb25zdCB2aWV3ZWRSZWNvbW1lbmRhdGlvbnMgPSBtYXRjaGluZ01ldHJpY3MuZmlsdGVyKFxuICAgICAgICAobSkgPT4gbS53YXNWaWV3ZWQsXG4gICAgICApLmxlbmd0aDtcbiAgICAgIGNvbnN0IGNvbnRhY3RlZFRoZXJhcGlzdHMgPSBtYXRjaGluZ01ldHJpY3MuZmlsdGVyKFxuICAgICAgICAobSkgPT4gbS53YXNDb250YWN0ZWQsXG4gICAgICApLmxlbmd0aDtcblxuICAgICAgY29uc3QgYXZlcmFnZU1hdGNoU2NvcmUgPVxuICAgICAgICB0b3RhbFJlY29tbWVuZGF0aW9ucyA+IDBcbiAgICAgICAgICA/IG1hdGNoaW5nTWV0cmljcy5yZWR1Y2UoKHN1bSwgbSkgPT4gc3VtICsgbS50b3RhbFNjb3JlLCAwKSAvXG4gICAgICAgICAgICB0b3RhbFJlY29tbWVuZGF0aW9uc1xuICAgICAgICAgIDogMDtcblxuICAgICAgY29uc3QgY29udmVyc2lvblJhdGUgPVxuICAgICAgICB0b3RhbFJlY29tbWVuZGF0aW9ucyA+IDBcbiAgICAgICAgICA/IChzdWNjZXNzZnVsTWF0Y2hlcyAvIHRvdGFsUmVjb21tZW5kYXRpb25zKSAqIDEwMFxuICAgICAgICAgIDogMDtcblxuICAgICAgY29uc3QgY2xpY2tUaHJvdWdoUmF0ZSA9XG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zID4gMFxuICAgICAgICAgID8gKHZpZXdlZFJlY29tbWVuZGF0aW9ucyAvIHRvdGFsUmVjb21tZW5kYXRpb25zKSAqIDEwMFxuICAgICAgICAgIDogMDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGVyaW9kOiB7IHN0YXJ0LCBlbmQgfSxcbiAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zLFxuICAgICAgICAgIHN1Y2Nlc3NmdWxNYXRjaGVzLFxuICAgICAgICAgIHZpZXdlZFJlY29tbWVuZGF0aW9ucyxcbiAgICAgICAgICBjb250YWN0ZWRUaGVyYXBpc3RzLFxuICAgICAgICAgIGF2ZXJhZ2VNYXRjaFNjb3JlLFxuICAgICAgICAgIGNvbnZlcnNpb25SYXRlLFxuICAgICAgICAgIGNsaWNrVGhyb3VnaFJhdGUsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIG1hdGNoaW5nIHBlcmZvcm1hbmNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09IENPTlRFTlQgTU9ERVJBVElPTiA9PT09PVxuXG4gIGFzeW5jIGdldEZsYWdnZWRDb250ZW50KHBhcmFtczoge1xuICAgIHR5cGU/OiBzdHJpbmc7XG4gICAgcGFnZTogbnVtYmVyO1xuICAgIGxpbWl0OiBudW1iZXI7XG4gIH0pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB0eXBlLCBwYWdlLCBsaW1pdCB9ID0gcGFyYW1zO1xuICAgICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcblxuICAgICAgLy8gRm9yIG5vdywgd2UnbGwgY29uc2lkZXIgcG9zdHMgYW5kIGNvbW1lbnRzIHRoYXQgbWlnaHQgbmVlZCBtb2RlcmF0aW9uXG4gICAgICAvLyBJbiBhIHJlYWwgc3lzdGVtLCB5b3UnZCBoYXZlIGEgZmxhZ2dpbmcgbWVjaGFuaXNtXG4gICAgICBjb25zdCBmbGFnZ2VkUG9zdHMgPSBhd2FpdCB0aGlzLnByaXNtYS5wb3N0LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAvLyBBZGQgY29uZGl0aW9ucyBmb3IgZmxhZ2dlZCBjb250ZW50XG4gICAgICAgICAgLy8gRm9yIG5vdywgbGV0J3MgZ2V0IHJlY2VudCBwb3N0cyB0aGF0IG1pZ2h0IG5lZWQgcmV2aWV3XG4gICAgICAgIH0sXG4gICAgICAgIHNraXAsXG4gICAgICAgIHRha2U6IHR5cGUgPT09ICdjb21tZW50JyA/IDAgOiBsaW1pdCxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJvb206IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICByb29tR3JvdXA6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgIGNvbW11bml0eToge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGZsYWdnZWRDb21tZW50cyA9IGF3YWl0IHRoaXMucHJpc21hLmNvbW1lbnQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIC8vIEFkZCBjb25kaXRpb25zIGZvciBmbGFnZ2VkIGNvbnRlbnRcbiAgICAgICAgfSxcbiAgICAgICAgc2tpcDogdHlwZSA9PT0gJ3Bvc3QnID8gMCA6IHNraXAsXG4gICAgICAgIHRha2U6IHR5cGUgPT09ICdwb3N0JyA/IDAgOiBsaW1pdCxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvc3Q6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3N0czogZmxhZ2dlZFBvc3RzLFxuICAgICAgICBjb21tZW50czogZmxhZ2dlZENvbW1lbnRzLFxuICAgICAgICBwYWdlLFxuICAgICAgICB0b3RhbEl0ZW1zOiBmbGFnZ2VkUG9zdHMubGVuZ3RoICsgZmxhZ2dlZENvbW1lbnRzLmxlbmd0aCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgZmxhZ2dlZCBjb250ZW50OicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIG1vZGVyYXRlQ29udGVudChcbiAgICBjb250ZW50VHlwZTogc3RyaW5nLFxuICAgIGNvbnRlbnRJZDogc3RyaW5nLFxuICAgIGFkbWluSWQ6IHN0cmluZyxcbiAgICBhY3Rpb246ICdhcHByb3ZlJyB8ICdyZW1vdmUnIHwgJ2ZsYWcnLFxuICAgIHJlYXNvbj86IHN0cmluZyxcbiAgKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIGxldCBtb2RlcmF0ZWRDb250ZW50O1xuXG4gICAgICAgIGlmIChjb250ZW50VHlwZSA9PT0gJ3Bvc3QnKSB7XG4gICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ3JlbW92ZScpIHtcbiAgICAgICAgICAgIG1vZGVyYXRlZENvbnRlbnQgPSBhd2FpdCB0eC5wb3N0LmRlbGV0ZSh7XG4gICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBjb250ZW50SWQgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGb3IgYXBwcm92ZS9mbGFnLCB3ZSBjb3VsZCBhZGQgbW9kZXJhdGlvbiBzdGF0dXMgZmllbGRzXG4gICAgICAgICAgICBtb2RlcmF0ZWRDb250ZW50ID0gYXdhaXQgdHgucG9zdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlbnRJZCB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnRUeXBlID09PSAnY29tbWVudCcpIHtcbiAgICAgICAgICBpZiAoYWN0aW9uID09PSAncmVtb3ZlJykge1xuICAgICAgICAgICAgbW9kZXJhdGVkQ29udGVudCA9IGF3YWl0IHR4LmNvbW1lbnQuZGVsZXRlKHtcbiAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGNvbnRlbnRJZCB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1vZGVyYXRlZENvbnRlbnQgPSBhd2FpdCB0eC5jb21tZW50LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgICB3aGVyZTogeyBpZDogY29udGVudElkIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgYXVkaXQgbG9nXG4gICAgICAgIGF3YWl0IHR4LmF1ZGl0TG9nLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiBhZG1pbklkLFxuICAgICAgICAgICAgYWN0aW9uOlxuICAgICAgICAgICAgICBjb250ZW50VHlwZSA9PT0gJ3Bvc3QnID8gJ01PREVSQVRFX1BPU1QnIDogJ01PREVSQVRFX0NPTU1FTlQnLFxuICAgICAgICAgICAgZW50aXR5OiBjb250ZW50VHlwZSxcbiAgICAgICAgICAgIGVudGl0eUlkOiBjb250ZW50SWQsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBjb250ZW50SWQsXG4gICAgICAgICAgICAgIGNvbnRlbnRUeXBlLFxuICAgICAgICAgICAgICBtb2RlcmF0aW9uQWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGFjdGlvbiwgbW9kZXJhdGVkQ29udGVudCB9O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gbW9kZXJhdGUgY29udGVudDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==