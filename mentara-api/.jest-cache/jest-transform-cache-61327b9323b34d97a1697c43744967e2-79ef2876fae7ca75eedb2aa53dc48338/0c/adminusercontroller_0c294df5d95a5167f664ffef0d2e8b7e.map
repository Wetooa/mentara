{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-user.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/controllers/admin-user.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  UseGuards,\n  HttpException,\n  HttpStatus,\n  Logger,\n  Query,\n  Param,\n  Body,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { AdminService } from '../admin.service';\nimport { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../../auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\nimport { AdminUserQuerySchema } from '../validation/admin.schemas';\nimport type { AdminUserQuery } from '../types';\n\n@Controller('admin/users')\n@UseGuards(JwtAuthGuard)\nexport class AdminUserController {\n  private readonly logger = new Logger(AdminUserController.name);\n\n  constructor(private readonly adminService: AdminService) {}\n\n  @Get()\n  async getAllUsers(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Query(new ZodValidationPipe(AdminUserQuerySchema)) query: AdminUserQuery,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving users`);\n\n      return await this.adminService.getAllUsers({\n        role: query.role,\n        page: query.page || 1,\n        limit: query.limit || 10,\n        search: query.search,\n        status: query.status,\n        sortBy: query.sortBy,\n        sortOrder: query.sortOrder,\n      });\n    } catch (error) {\n      this.logger.error('Failed to retrieve users:', error);\n      throw new HttpException(\n        'Failed to retrieve users',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Get(':id')\n  async getUser(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('id') userId: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} retrieving user ${userId}`);\n      const user = await this.adminService.getUser(userId);\n\n      if (!user) {\n        throw new HttpException('User not found', HttpStatus.NOT_FOUND);\n      }\n\n      return user;\n    } catch (error) {\n      if (error instanceof HttpException) {\n        throw error;\n      }\n      this.logger.error('Failed to retrieve user:', error);\n      throw new HttpException(\n        'Failed to retrieve user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':id/suspend')\n  async suspendUser(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('id') userId: string,\n    @Body() suspensionData: { reason: string; duration?: number },\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} suspending user ${userId}`);\n      return await this.adminService.suspendUser(\n        userId,\n        currentUserId,\n        suspensionData.reason,\n        suspensionData.duration,\n      );\n    } catch (error) {\n      this.logger.error('Failed to suspend user:', error);\n      throw new HttpException(\n        'Failed to suspend user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n\n  @Put(':id/unsuspend')\n  async unsuspendUser(\n    @CurrentUserId() currentUserId: string,\n    @CurrentUserRole() role: string,\n    @Param('id') userId: string,\n  ) {\n    if (role !== 'admin') {\n      throw new ForbiddenException('Admin access required');\n    }\n    try {\n      this.logger.log(`Admin ${currentUserId} unsuspending user ${userId}`);\n      return await this.adminService.unsuspendUser(userId, currentUserId);\n    } catch (error) {\n      this.logger.error('Failed to unsuspend user:', error);\n      throw new HttpException(\n        'Failed to unsuspend user',\n        HttpStatus.INTERNAL_SERVER_ERROR,\n      );\n    }\n  }\n}\n"],"version":3}