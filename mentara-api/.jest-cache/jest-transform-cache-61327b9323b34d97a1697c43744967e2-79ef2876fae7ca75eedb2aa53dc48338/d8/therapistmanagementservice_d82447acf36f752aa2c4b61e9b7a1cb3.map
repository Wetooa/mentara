{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/therapist-management.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/therapist-management.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  InternalServerErrorException,\n} from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { Prisma } from '@prisma/client';\nimport { Decimal } from '@prisma/client/runtime/library';\n// Removed import - using local types instead\ninterface TherapistResponse {\n  id: string;\n  firstName: string;\n  lastName: string;\n  specialties: string[];\n  isActive: boolean;\n}\n\ninterface ClientResponse {\n  id: string;\n  firstName: string;\n  lastName: string;\n}\n\ninterface TherapistUpdateDto {\n  specialties?: string[];\n  isActive?: boolean;\n  mobile?: string;\n  province?: string;\n  hourlyRate?: any;\n  areasOfExpertise?: string[];\n  languagesOffered?: string[];\n  preferredSessionLength?: number[];\n  // Allow any other properties\n  [key: string]: any;\n}\n\n@Injectable()\nexport class TherapistManagementService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  private calculateYearsOfExperience(startDate: Date): number {\n    const now = new Date();\n    let years = now.getFullYear() - startDate.getFullYear();\n    if (\n      now.getMonth() < startDate.getMonth() ||\n      (now.getMonth() === startDate.getMonth() &&\n        now.getDate() < startDate.getDate())\n    ) {\n      years--;\n    }\n    return years;\n  }\n\n  async getTherapistProfile(userId: string): Promise<any> {\n    try {\n      const therapist = await this.prisma.therapist.findUniqueOrThrow({\n        where: { userId },\n        include: {\n          user: true,\n          therapistAvailabilities: true,\n          worksheets: true,\n          meetings: true,\n          assignedClients: true,\n        },\n      });\n      return {\n        ...therapist,\n        treatmentSuccessRates:\n          (therapist.treatmentSuccessRates as Record<string, any>) || {},\n        hourlyRate: therapist.hourlyRate,\n      };\n    } catch (error) {\n      console.error(\n        'Error retrieving therapist profile:',\n        error instanceof Error ? error.message : error,\n      );\n      throw new InternalServerErrorException(\n        'Failed to retrieve therapist profile',\n      );\n    }\n  }\n\n  async updateTherapistProfile(\n    userId: string,\n    data: TherapistUpdateDto,\n  ): Promise<any> {\n    try {\n      // Update therapist profile data\n      const therapistData: any = {};\n      if (data.mobile !== undefined) therapistData.mobile = data.mobile;\n      if (data.province !== undefined) therapistData.province = data.province;\n      if (data.providerType !== undefined)\n        therapistData.providerType = data.providerType;\n      if (data.professionalLicenseType !== undefined)\n        therapistData.professionalLicenseType = data.professionalLicenseType;\n      if (data.isPRCLicensed !== undefined)\n        therapistData.isPRCLicensed = data.isPRCLicensed;\n      if (data.prcLicenseNumber !== undefined)\n        therapistData.prcLicenseNumber = data.prcLicenseNumber;\n      if (data.expirationDateOfLicense !== undefined)\n        therapistData.expirationDateOfLicense = data.expirationDateOfLicense;\n      if (data.practiceStartDate !== undefined)\n        therapistData.practiceStartDate = data.practiceStartDate;\n      if (data.areasOfExpertise !== undefined)\n        therapistData.areasOfExpertise = data.areasOfExpertise;\n      if (data.assessmentTools !== undefined)\n        therapistData.assessmentTools = data.assessmentTools;\n      if (data.therapeuticApproachesUsedList !== undefined)\n        therapistData.therapeuticApproachesUsedList =\n          data.therapeuticApproachesUsedList;\n      if (data.languagesOffered !== undefined)\n        therapistData.languagesOffered = data.languagesOffered;\n      if (data.providedOnlineTherapyBefore !== undefined)\n        therapistData.providedOnlineTherapyBefore =\n          data.providedOnlineTherapyBefore;\n      if (data.comfortableUsingVideoConferencing !== undefined)\n        therapistData.comfortableUsingVideoConferencing =\n          data.comfortableUsingVideoConferencing;\n      if (data.preferredSessionLength !== undefined)\n        therapistData.preferredSessionLength = data.preferredSessionLength;\n      if (data.privateConfidentialSpace !== undefined)\n        therapistData.privateConfidentialSpace = data.privateConfidentialSpace;\n      if (data.compliesWithDataPrivacyAct !== undefined)\n        therapistData.compliesWithDataPrivacyAct =\n          data.compliesWithDataPrivacyAct;\n      if (data.professionalLiabilityInsurance !== undefined)\n        therapistData.professionalLiabilityInsurance =\n          data.professionalLiabilityInsurance;\n      if (data.complaintsOrDisciplinaryActions !== undefined)\n        therapistData.complaintsOrDisciplinaryActions =\n          data.complaintsOrDisciplinaryActions;\n      if (data.willingToAbideByPlatformGuidelines !== undefined)\n        therapistData.willingToAbideByPlatformGuidelines =\n          data.willingToAbideByPlatformGuidelines;\n      if (data.expertise !== undefined)\n        therapistData.expertise = data.expertise;\n      if (data.approaches !== undefined)\n        therapistData.approaches = data.approaches;\n      if (data.languages !== undefined)\n        therapistData.languages = data.languages;\n      if (data.illnessSpecializations !== undefined)\n        therapistData.illnessSpecializations = data.illnessSpecializations;\n      if (data.acceptTypes !== undefined)\n        therapistData.acceptTypes = data.acceptTypes;\n      if (data.treatmentSuccessRates !== undefined)\n        therapistData.treatmentSuccessRates = data.treatmentSuccessRates;\n      if (data.sessionLength !== undefined)\n        therapistData.sessionLength = data.sessionLength;\n      if (data.hourlyRate !== undefined)\n        therapistData.hourlyRate = new Decimal(data.hourlyRate);\n\n      const updatedTherapist = await this.prisma.therapist.update({\n        where: { userId },\n        data: therapistData,\n        include: {\n          user: true,\n        },\n      });\n      return {\n        ...updatedTherapist,\n        treatmentSuccessRates:\n          (updatedTherapist.treatmentSuccessRates as Record<string, any>) || {},\n        hourlyRate: updatedTherapist.hourlyRate,\n      };\n    } catch (error) {\n      console.error(\n        'Error updating therapist profile:',\n        error instanceof Error ? error.message : error,\n      );\n      throw new InternalServerErrorException(\n        'Failed to update therapist profile',\n      );\n    }\n  }\n\n  async getAssignedPatients(therapistId: string): Promise<any[]> {\n    try {\n      const therapist = await this.prisma.therapist.findUniqueOrThrow({\n        where: { userId: therapistId },\n      });\n\n      // Find all clients assigned to this therapist\n      const assignedClients = await this.prisma.clientTherapist.findMany({\n        where: { therapistId: therapist.userId, status: 'active' },\n        include: { client: { include: { user: true } } },\n      });\n\n      return assignedClients.map((ct) => ({\n        ...ct.client,\n        user: ct.client.user,\n      }));\n    } catch (error) {\n      console.error(\n        'Error retrieving assigned patients:',\n        error instanceof Error ? error.message : error,\n      );\n\n      throw new InternalServerErrorException(\n        'Failed to retrieve assigned patients',\n      );\n    }\n  }\n\n  async getAllClients(therapistId: string): Promise<any[]> {\n    try {\n      // Find all clients assigned to this therapist\n      const assignedClients = await this.prisma.clientTherapist.findMany({\n        where: { therapistId: therapistId, status: 'active' },\n        include: { client: { include: { user: true } } },\n      });\n\n      return assignedClients.map((ct) => ({\n        ...ct.client,\n      }));\n    } catch (error) {\n      console.error(\n        'Error retrieving all clients:',\n        error instanceof Error ? error.message : error,\n      );\n      throw new InternalServerErrorException('Failed to retrieve all clients');\n    }\n  }\n\n  async getClientById(therapistId: string, clientId: string): Promise<any> {\n    try {\n      // Find the specific client assigned to this therapist\n      const assignedClient = await this.prisma.clientTherapist.findFirst({\n        where: { therapistId: therapistId, clientId: clientId },\n        include: { client: { include: { user: true } } },\n      });\n      if (!assignedClient) {\n        throw new NotFoundException('Client not found');\n      }\n\n      return assignedClient.client;\n    } catch (error) {\n      console.error(\n        'Error retrieving client by ID:',\n        error instanceof Error ? error.message : error,\n      );\n      throw new InternalServerErrorException('Failed to retrieve client by ID');\n    }\n  }\n\n  async getProfile(therapistId: string): Promise<any> {\n    try {\n      const therapist = await this.prisma.therapist.findUniqueOrThrow({\n        where: { userId: therapistId },\n        include: {\n          user: true,\n        },\n      });\n      return {\n        ...therapist,\n        treatmentSuccessRates:\n          (therapist.treatmentSuccessRates as Record<string, any>) || {},\n        hourlyRate: therapist.hourlyRate,\n      };\n    } catch (error) {\n      console.error(\n        'Error retrieving therapist profile:',\n        error instanceof Error ? error.message : error,\n      );\n      throw new InternalServerErrorException(\n        'Failed to retrieve therapist profile',\n      );\n    }\n  }\n\n  async updateProfile(\n    therapistId: string,\n    data: Prisma.TherapistUpdateInput,\n  ): Promise<any> {\n    try {\n      const updatedTherapist = await this.prisma.therapist.update({\n        where: { userId: therapistId },\n        data,\n        include: {\n          user: true,\n        },\n      });\n      return {\n        ...updatedTherapist,\n        treatmentSuccessRates:\n          (updatedTherapist.treatmentSuccessRates as Record<string, any>) || {},\n        hourlyRate: updatedTherapist.hourlyRate,\n      };\n    } catch (error) {\n      console.error(\n        'Error updating therapist profile:',\n        error instanceof Error ? error.message : error,\n      );\n      throw new InternalServerErrorException(\n        'Failed to update therapist profile',\n      );\n    }\n  }\n}\n"],"version":3}