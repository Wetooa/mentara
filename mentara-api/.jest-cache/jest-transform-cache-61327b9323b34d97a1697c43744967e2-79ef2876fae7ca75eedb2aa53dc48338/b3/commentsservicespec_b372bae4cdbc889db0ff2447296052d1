c011fbb3725ef4aa7895b709b66a2954
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const comments_service_1 = require("./comments.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const client_1 = require("@prisma/client");
const test_utils_1 = require("../test-utils");
describe('CommentsService', () => {
    let service;
    let prismaService;
    beforeEach(async () => {
        const mockPrisma = (0, test_utils_1.createMockPrismaService)();
        const module = await testing_1.Test.createTestingModule({
            providers: [
                comments_service_1.CommentsService,
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: mockPrisma,
                },
            ],
        }).compile();
        service = module.get(comments_service_1.CommentsService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('findUserById', () => {
        it('should return user when found', async () => {
            const mockUser = {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                email: 'john@example.com',
            };
            prismaService.user.findUnique.mockResolvedValue(mockUser);
            const result = await service.findUserById(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockUser);
            expect(prismaService.user.findUnique).toHaveBeenCalledWith({
                where: { id: test_utils_1.TEST_USER_IDS.CLIENT },
            });
        });
        it('should return null when user not found', async () => {
            prismaService.user.findUnique.mockResolvedValue(null);
            const result = await service.findUserById('non-existent-id');
            expect(result).toBeNull();
        });
        it('should re-throw NotFoundException', async () => {
            prismaService.user.findUnique.mockRejectedValue(new common_1.NotFoundException('User not found'));
            await expect(service.findUserById(test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should wrap database errors in InternalServerErrorException', async () => {
            prismaService.user.findUnique.mockRejectedValue(new Error('Database error'));
            await expect(service.findUserById(test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('findAll', () => {
        const mockComments = [
            {
                id: 'comment-1',
                content: 'First comment',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                postId: 'post-1',
                user: {
                    id: test_utils_1.TEST_USER_IDS.CLIENT,
                    firstName: 'John',
                    lastName: 'Doe',
                    avatarUrl: 'avatar.jpg',
                },
                post: {
                    id: 'post-1',
                    title: 'Test Post',
                },
                replies: [],
                hearts: [],
                _count: {
                    replies: 0,
                    hearts: 2,
                },
            },
        ];
        it('should return all comments without user hearts when no userId provided', async () => {
            prismaService.comment.findMany.mockResolvedValue(mockComments);
            const result = await service.findAll();
            expect(result).toEqual(mockComments);
            expect(prismaService.comment.findMany).toHaveBeenCalledWith({
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                    post: {
                        select: {
                            id: true,
                            title: true,
                        },
                    },
                    replies: {
                        include: {
                            user: {
                                select: {
                                    id: true,
                                    firstName: true,
                                    lastName: true,
                                    avatarUrl: true,
                                },
                            },
                        },
                        orderBy: {
                            createdAt: 'asc',
                        },
                    },
                    hearts: false,
                    _count: {
                        select: {
                            replies: true,
                            hearts: true,
                        },
                    },
                },
                orderBy: {
                    createdAt: 'desc',
                },
            });
        });
        it('should return comments with user hearts when userId provided', async () => {
            prismaService.comment.findMany.mockResolvedValue(mockComments);
            const result = await service.findAll(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockComments);
            expect(prismaService.comment.findMany).toHaveBeenCalledWith({
                include: expect.objectContaining({
                    hearts: {
                        where: {
                            userId: test_utils_1.TEST_USER_IDS.CLIENT,
                        },
                    },
                }),
                orderBy: {
                    createdAt: 'desc',
                },
            });
        });
        it('should handle database errors', async () => {
            prismaService.comment.findMany.mockRejectedValue(new Error('Database error'));
            await expect(service.findAll()).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('findOne', () => {
        const mockComment = {
            id: 'comment-1',
            content: 'Test comment',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
            },
            replies: [],
            hearts: [
                { id: 'heart-1', userId: test_utils_1.TEST_USER_IDS.CLIENT },
                { id: 'heart-2', userId: 'user-2' },
            ],
        };
        it('should return comment with hearts count and files', async () => {
            const mockFiles = [
                {
                    id: 'attachment-1',
                    commentId: 'comment-1',
                    url: '/api/files/file-1',
                    type: 'image/jpeg',
                },
            ];
            prismaService.comment.findUnique.mockResolvedValue(mockComment);
            jest.spyOn(service, 'getCommentAttachments').mockResolvedValue(mockFiles);
            const result = await service.findOne('comment-1');
            expect(result).toEqual({
                ...mockComment,
                hearts: 2, // Count instead of array
                files: mockFiles,
            });
            expect(service.getCommentAttachments).toHaveBeenCalledWith('comment-1');
        });
        it('should throw NotFoundException when comment not found', async () => {
            prismaService.comment.findUnique.mockResolvedValue(null);
            await expect(service.findOne('non-existent-id')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should handle database errors', async () => {
            prismaService.comment.findUnique.mockRejectedValue(new Error('Database error'));
            await expect(service.findOne('comment-1')).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('findByPostId', () => {
        const mockComments = [
            {
                id: 'comment-1',
                content: 'Comment on post',
                postId: 'post-1',
                user: { firstName: 'John', lastName: 'Doe' },
                replies: [],
                hearts: [],
                _count: { replies: 0, hearts: 1 },
            },
        ];
        it('should return comments for specific post', async () => {
            prismaService.comment.findMany.mockResolvedValue(mockComments);
            const result = await service.findByPostId('post-1');
            expect(result).toEqual(mockComments);
            expect(prismaService.comment.findMany).toHaveBeenCalledWith({
                where: { postId: 'post-1' },
                include: expect.objectContaining({
                    hearts: false,
                }),
                orderBy: { createdAt: 'desc' },
            });
        });
        it('should include user hearts when userId provided', async () => {
            prismaService.comment.findMany.mockResolvedValue(mockComments);
            await service.findByPostId('post-1', test_utils_1.TEST_USER_IDS.CLIENT);
            expect(prismaService.comment.findMany).toHaveBeenCalledWith({
                where: { postId: 'post-1' },
                include: expect.objectContaining({
                    hearts: {
                        where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                    },
                }),
                orderBy: { createdAt: 'desc' },
            });
        });
    });
    describe('create', () => {
        const mockCommentData = {
            postId: 'post-1',
            content: 'New comment',
        };
        const mockCreatedComment = {
            id: 'comment-1',
            content: 'New comment',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            postId: 'post-1',
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
            },
            hearts: [],
        };
        it('should create comment successfully', async () => {
            const mockFiles = [];
            prismaService.comment.create.mockResolvedValue(mockCreatedComment);
            jest.spyOn(service, 'getCommentAttachments').mockResolvedValue(mockFiles);
            const result = await service.create(mockCommentData, test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual({
                ...mockCreatedComment,
                hearts: 0, // Count instead of array
                files: mockFiles,
            });
            expect(prismaService.comment.create).toHaveBeenCalledWith({
                data: {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    postId: 'post-1',
                    content: 'New comment',
                },
                include: {
                    user: true,
                    hearts: true,
                },
            });
        });
        it('should handle creation errors', async () => {
            prismaService.comment.create.mockRejectedValue(new Error('Creation failed'));
            await expect(service.create(mockCommentData, test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('update', () => {
        const mockUpdateData = {
            postId: 'post-1',
            content: 'Updated comment',
        };
        const mockComment = {
            id: 'comment-1',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
        };
        const mockUpdatedComment = {
            id: 'comment-1',
            content: 'Updated comment',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
            user: {
                id: test_utils_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                avatarUrl: 'avatar.jpg',
            },
            hearts: [],
        };
        it('should update comment successfully', async () => {
            const mockFiles = [];
            prismaService.comment.findUnique.mockResolvedValue(mockComment);
            prismaService.comment.update.mockResolvedValue(mockUpdatedComment);
            jest.spyOn(service, 'getCommentAttachments').mockResolvedValue(mockFiles);
            const result = await service.update('comment-1', mockUpdateData, test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual({
                ...mockUpdatedComment,
                hearts: 0,
                files: mockFiles,
            });
            expect(prismaService.comment.update).toHaveBeenCalledWith({
                where: { id: 'comment-1', userId: test_utils_1.TEST_USER_IDS.CLIENT },
                data: { content: 'Updated comment' },
                include: {
                    user: {
                        select: {
                            id: true,
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                    hearts: true,
                },
            });
        });
        it('should throw NotFoundException when comment not found', async () => {
            prismaService.comment.findUnique.mockResolvedValue(null);
            await expect(service.update('non-existent-id', mockUpdateData, test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw ForbiddenException when user is not comment owner', async () => {
            const otherUserComment = {
                id: 'comment-1',
                userId: 'other-user-id',
            };
            prismaService.comment.findUnique.mockResolvedValue(otherUserComment);
            await expect(service.update('comment-1', mockUpdateData, test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('remove', () => {
        const mockComment = {
            id: 'comment-1',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
        };
        const mockDeletedComment = {
            id: 'comment-1',
            content: 'Deleted comment',
            userId: test_utils_1.TEST_USER_IDS.CLIENT,
        };
        it('should delete comment successfully', async () => {
            prismaService.comment.findUnique.mockResolvedValue(mockComment);
            prismaService.comment.delete.mockResolvedValue(mockDeletedComment);
            const result = await service.remove('comment-1', test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockDeletedComment);
            expect(prismaService.comment.delete).toHaveBeenCalledWith({
                where: { id: 'comment-1' },
            });
        });
        it('should throw NotFoundException when comment not found', async () => {
            prismaService.comment.findUnique.mockResolvedValue(null);
            await expect(service.remove('non-existent-id', test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw ForbiddenException when user is not comment owner', async () => {
            const otherUserComment = {
                id: 'comment-1',
                userId: 'other-user-id',
            };
            prismaService.comment.findUnique.mockResolvedValue(otherUserComment);
            await expect(service.remove('comment-1', test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    describe('findByUserId', () => {
        const mockUserComments = [
            {
                id: 'comment-1',
                content: 'User comment',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                user: { firstName: 'John', lastName: 'Doe' },
                post: { id: 'post-1', title: 'Test Post' },
                replies: [],
                _count: { replies: 0, hearts: 1 },
            },
        ];
        it('should return comments by user ID', async () => {
            prismaService.comment.findMany.mockResolvedValue(mockUserComments);
            const result = await service.findByUserId(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockUserComments);
            expect(prismaService.comment.findMany).toHaveBeenCalledWith({
                where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                include: expect.objectContaining({
                    user: { select: expect.any(Object) },
                    post: { select: expect.any(Object) },
                    replies: { include: expect.any(Object) },
                    _count: { select: expect.any(Object) },
                }),
                orderBy: { createdAt: 'desc' },
            });
        });
    });
    describe('Heart functionality', () => {
        describe('heartComment', () => {
            it('should add heart when not already hearted', async () => {
                prismaService.commentHeart.findUnique.mockResolvedValue(null);
                prismaService.commentHeart.create.mockResolvedValue({
                    id: 'heart-1',
                    commentId: 'comment-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                });
                const result = await service.heartComment('comment-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ hearted: true });
                expect(prismaService.commentHeart.create).toHaveBeenCalledWith({
                    data: {
                        commentId: 'comment-1',
                        userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    },
                });
            });
            it('should remove heart when already hearted', async () => {
                const existingHeart = {
                    id: 'heart-1',
                    commentId: 'comment-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                };
                prismaService.commentHeart.findUnique.mockResolvedValue(existingHeart);
                prismaService.commentHeart.delete.mockResolvedValue(existingHeart);
                const result = await service.heartComment('comment-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ hearted: false });
                expect(prismaService.commentHeart.delete).toHaveBeenCalledWith({
                    where: {
                        commentId_userId: {
                            commentId: 'comment-1',
                            userId: test_utils_1.TEST_USER_IDS.CLIENT,
                        },
                    },
                });
            });
            it('should handle database errors', async () => {
                prismaService.commentHeart.findUnique.mockRejectedValue(new Error('Database error'));
                await expect(service.heartComment('comment-1', test_utils_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
            });
        });
        describe('isCommentHeartedByUser', () => {
            it('should return true when comment is hearted', async () => {
                const existingHeart = {
                    id: 'heart-1',
                    commentId: 'comment-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                };
                prismaService.commentHeart.findUnique.mockResolvedValue(existingHeart);
                const result = await service.isCommentHeartedByUser('comment-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toBe(true);
            });
            it('should return false when comment is not hearted', async () => {
                prismaService.commentHeart.findUnique.mockResolvedValue(null);
                const result = await service.isCommentHeartedByUser('comment-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toBe(false);
            });
        });
    });
    describe('Reply functionality', () => {
        describe('createReply', () => {
            const mockReplyData = {
                content: 'Test reply',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                commentId: 'comment-1',
            };
            const mockCreatedReply = {
                id: 'reply-1',
                content: 'Test reply',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                commentId: 'comment-1',
                user: {
                    id: test_utils_1.TEST_USER_IDS.CLIENT,
                    firstName: 'John',
                    lastName: 'Doe',
                    avatarUrl: 'avatar.jpg',
                },
                comment: {
                    id: 'comment-1',
                    content: 'Original comment',
                },
                hearts: [],
            };
            it('should create reply successfully', async () => {
                prismaService.reply.create.mockResolvedValue(mockCreatedReply);
                const result = await service.createReply(mockReplyData);
                expect(result).toEqual(mockCreatedReply);
                expect(prismaService.reply.create).toHaveBeenCalledWith({
                    data: mockReplyData,
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                        comment: true,
                        hearts: true,
                    },
                });
            });
            it('should handle creation errors', async () => {
                prismaService.reply.create.mockRejectedValue(new Error('Creation failed'));
                await expect(service.createReply(mockReplyData)).rejects.toThrow(common_1.InternalServerErrorException);
            });
        });
        describe('findRepliesByCommentId', () => {
            const mockReplies = [
                {
                    id: 'reply-1',
                    content: 'First reply',
                    commentId: 'comment-1',
                    user: { firstName: 'John', lastName: 'Doe' },
                    hearts: [],
                    _count: { hearts: 0 },
                },
            ];
            it('should return replies without user hearts when no userId provided', async () => {
                prismaService.reply.findMany.mockResolvedValue(mockReplies);
                const result = await service.findRepliesByCommentId('comment-1');
                expect(result).toEqual(mockReplies);
                expect(prismaService.reply.findMany).toHaveBeenCalledWith({
                    where: { commentId: 'comment-1' },
                    include: {
                        user: {
                            select: {
                                id: true,
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                        hearts: true,
                        _count: {
                            select: { hearts: true },
                        },
                    },
                    orderBy: { createdAt: 'asc' },
                });
            });
            it('should return replies with user hearts when userId provided', async () => {
                prismaService.reply.findMany.mockResolvedValue(mockReplies);
                await service.findRepliesByCommentId('comment-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(prismaService.reply.findMany).toHaveBeenCalledWith({
                    where: { commentId: 'comment-1' },
                    include: expect.objectContaining({
                        hearts: {
                            where: { userId: test_utils_1.TEST_USER_IDS.CLIENT },
                        },
                    }),
                    orderBy: { createdAt: 'asc' },
                });
            });
        });
        describe('heartReply', () => {
            it('should add heart to reply when not already hearted', async () => {
                prismaService.replyHeart.findUnique.mockResolvedValue(null);
                prismaService.replyHeart.create.mockResolvedValue({
                    id: 'heart-1',
                    replyId: 'reply-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                });
                const result = await service.heartReply('reply-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ hearted: true });
                expect(prismaService.replyHeart.create).toHaveBeenCalledWith({
                    data: {
                        replyId: 'reply-1',
                        userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    },
                });
            });
            it('should remove heart from reply when already hearted', async () => {
                const existingHeart = {
                    id: 'heart-1',
                    replyId: 'reply-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                };
                prismaService.replyHeart.findUnique.mockResolvedValue(existingHeart);
                prismaService.replyHeart.delete.mockResolvedValue(existingHeart);
                const result = await service.heartReply('reply-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ hearted: false });
                expect(prismaService.replyHeart.delete).toHaveBeenCalledWith({
                    where: {
                        replyId_userId: {
                            replyId: 'reply-1',
                            userId: test_utils_1.TEST_USER_IDS.CLIENT,
                        },
                    },
                });
            });
        });
        describe('isReplyHeartedByUser', () => {
            it('should return true when reply is hearted', async () => {
                const existingHeart = {
                    id: 'heart-1',
                    replyId: 'reply-1',
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                };
                prismaService.replyHeart.findUnique.mockResolvedValue(existingHeart);
                const result = await service.isReplyHeartedByUser('reply-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toBe(true);
            });
            it('should return false when reply is not hearted', async () => {
                prismaService.replyHeart.findUnique.mockResolvedValue(null);
                const result = await service.isReplyHeartedByUser('reply-1', test_utils_1.TEST_USER_IDS.CLIENT);
                expect(result).toBe(false);
            });
        });
    });
    describe('File attachment functionality', () => {
        describe('Comment attachments', () => {
            describe('attachFilesToComment', () => {
                it('should attach files to comment with default purpose', async () => {
                    const fileIds = ['file-1', 'file-2'];
                    const expectedData = [
                        {
                            fileId: 'file-1',
                            entityType: client_1.AttachmentEntityType.COMMENT,
                            entityId: 'comment-1',
                            purpose: client_1.AttachmentPurpose.MEDIA,
                            order: 0,
                        },
                        {
                            fileId: 'file-2',
                            entityType: client_1.AttachmentEntityType.COMMENT,
                            entityId: 'comment-1',
                            purpose: client_1.AttachmentPurpose.MEDIA,
                            order: 1,
                        },
                    ];
                    prismaService.fileAttachment.createMany.mockResolvedValue({
                        count: 2,
                    });
                    const result = await service.attachFilesToComment('comment-1', fileIds);
                    expect(result).toEqual({ count: 2 });
                    expect(prismaService.fileAttachment.createMany).toHaveBeenCalledWith({
                        data: expectedData,
                    });
                });
                it('should attach files with custom purpose', async () => {
                    const fileIds = ['file-1'];
                    await service.attachFilesToComment('comment-1', fileIds, client_1.AttachmentPurpose.DOCUMENT);
                    expect(prismaService.fileAttachment.createMany).toHaveBeenCalledWith({
                        data: [
                            expect.objectContaining({
                                purpose: client_1.AttachmentPurpose.DOCUMENT,
                            }),
                        ],
                    });
                });
            });
            describe('getCommentAttachments', () => {
                it('should return formatted comment attachments', async () => {
                    const mockAttachments = [
                        {
                            id: 'attachment-1',
                            entityId: 'comment-1',
                            file: {
                                id: 'file-1',
                                storageUrl: 'https://storage.com/file-1.jpg',
                                mimeType: 'image/jpeg',
                            },
                        },
                        {
                            id: 'attachment-2',
                            entityId: 'comment-1',
                            file: {
                                id: 'file-2',
                                storageUrl: null,
                                mimeType: 'image/png',
                            },
                        },
                    ];
                    prismaService.fileAttachment.findMany.mockResolvedValue(mockAttachments);
                    const result = await service.getCommentAttachments('comment-1');
                    expect(result).toEqual([
                        {
                            id: 'attachment-1',
                            commentId: 'comment-1',
                            url: 'https://storage.com/file-1.jpg',
                            type: 'image/jpeg',
                        },
                        {
                            id: 'attachment-2',
                            commentId: 'comment-1',
                            url: '/api/files/file-2',
                            type: 'image/png',
                        },
                    ]);
                    expect(prismaService.fileAttachment.findMany).toHaveBeenCalledWith({
                        where: {
                            entityType: client_1.AttachmentEntityType.COMMENT,
                            entityId: 'comment-1',
                        },
                        include: {
                            file: true,
                        },
                        orderBy: { order: 'asc' },
                    });
                });
            });
            describe('removeCommentAttachment', () => {
                it('should remove comment attachment', async () => {
                    prismaService.fileAttachment.deleteMany.mockResolvedValue({
                        count: 1,
                    });
                    const result = await service.removeCommentAttachment('comment-1', 'file-1');
                    expect(result).toEqual({ count: 1 });
                    expect(prismaService.fileAttachment.deleteMany).toHaveBeenCalledWith({
                        where: {
                            entityType: client_1.AttachmentEntityType.COMMENT,
                            entityId: 'comment-1',
                            fileId: 'file-1',
                        },
                    });
                });
            });
        });
        describe('Reply attachments', () => {
            describe('attachFilesToReply', () => {
                it('should attach files to reply', async () => {
                    const fileIds = ['file-1'];
                    const expectedData = [
                        {
                            fileId: 'file-1',
                            entityType: client_1.AttachmentEntityType.REPLY,
                            entityId: 'reply-1',
                            purpose: client_1.AttachmentPurpose.MEDIA,
                            order: 0,
                        },
                    ];
                    prismaService.fileAttachment.createMany.mockResolvedValue({
                        count: 1,
                    });
                    const result = await service.attachFilesToReply('reply-1', fileIds);
                    expect(result).toEqual({ count: 1 });
                    expect(prismaService.fileAttachment.createMany).toHaveBeenCalledWith({
                        data: expectedData,
                    });
                });
            });
            describe('getReplyAttachments', () => {
                it('should return reply attachments', async () => {
                    const mockAttachments = [
                        {
                            id: 'attachment-1',
                            entityId: 'reply-1',
                            file: {
                                id: 'file-1',
                                storageUrl: 'storage-url',
                                mimeType: 'image/jpeg',
                            },
                        },
                    ];
                    prismaService.fileAttachment.findMany.mockResolvedValue(mockAttachments);
                    const result = await service.getReplyAttachments('reply-1');
                    expect(result).toEqual(mockAttachments);
                    expect(prismaService.fileAttachment.findMany).toHaveBeenCalledWith({
                        where: {
                            entityType: client_1.AttachmentEntityType.REPLY,
                            entityId: 'reply-1',
                        },
                        include: {
                            file: true,
                        },
                        orderBy: { order: 'asc' },
                    });
                });
            });
            describe('removeReplyAttachment', () => {
                it('should remove reply attachment', async () => {
                    prismaService.fileAttachment.deleteMany.mockResolvedValue({
                        count: 1,
                    });
                    const result = await service.removeReplyAttachment('reply-1', 'file-1');
                    expect(result).toEqual({ count: 1 });
                    expect(prismaService.fileAttachment.deleteMany).toHaveBeenCalledWith({
                        where: {
                            entityType: client_1.AttachmentEntityType.REPLY,
                            entityId: 'reply-1',
                            fileId: 'file-1',
                        },
                    });
                });
            });
        });
    });
    describe('Error handling', () => {
        it('should handle non-Error objects in catch blocks', async () => {
            prismaService.comment.findMany.mockRejectedValue('String error');
            await expect(service.findAll()).rejects.toThrow(common_1.InternalServerErrorException);
        });
        it('should re-throw ForbiddenException from database operations', async () => {
            prismaService.comment.findMany.mockRejectedValue(new common_1.ForbiddenException('Access denied'));
            await expect(service.findAll()).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle complex database operations errors', async () => {
            prismaService.reply.create.mockRejectedValue(new Error('Complex database error'));
            await expect(service.createReply({
                content: 'Test',
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                commentId: 'comment-1',
            })).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW1lbnRzL2NvbW1lbnRzLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCwyQ0FJd0I7QUFDeEIseURBQXFEO0FBQ3JELGdGQUFvRTtBQUNwRSwyQ0FBeUU7QUFDekUsOENBQXVFO0FBRXZFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsSUFBSSxPQUF3QixDQUFDO0lBQzdCLElBQUksYUFBeUMsQ0FBQztJQUU5QyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxVQUFVLEdBQUcsSUFBQSxvQ0FBdUIsR0FBRSxDQUFDO1FBRTdDLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1Qsa0NBQWU7Z0JBQ2Y7b0JBQ0UsT0FBTyxFQUFFLHNDQUFhO29CQUN0QixRQUFRLEVBQUUsVUFBVTtpQkFDckI7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFrQixrQ0FBZSxDQUFDLENBQUM7UUFDdkQsYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsc0NBQWEsQ0FBQyxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1FBQzVCLEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3QyxNQUFNLFFBQVEsR0FBRztnQkFDZixFQUFFLEVBQUUsMEJBQWEsQ0FBQyxNQUFNO2dCQUN4QixTQUFTLEVBQUUsTUFBTTtnQkFDakIsUUFBUSxFQUFFLEtBQUs7Z0JB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QUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFvQixDQUFDLGlCQUFpQixDQUN6RCxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUNwQyxDQUFDO1lBRUYsTUFBTSxNQUFNLENBQ1YsT0FBTyxDQUFDLFdBQVcsQ0FBQztnQkFDbEIsT0FBTyxFQUFFLE1BQU07Z0JBQ2YsTUFBTSxFQUFFLDBCQUFhLENBQUMsTUFBTTtnQkFDNUIsU0FBUyxFQUFFLFdBQVc7YUFDdkIsQ0FBQyxDQUNILENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxxQ0FBNEIsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvY29tbWVudHMvY29tbWVudHMuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHtcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQ29tbWVudHNTZXJ2aWNlIH0gZnJvbSAnLi9jb21tZW50cy5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBBdHRhY2htZW50RW50aXR5VHlwZSwgQXR0YWNobWVudFB1cnBvc2UgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5pbXBvcnQgeyBjcmVhdGVNb2NrUHJpc21hU2VydmljZSwgVEVTVF9VU0VSX0lEUyB9IGZyb20gJy4uL3Rlc3QtdXRpbHMnO1xuXG5kZXNjcmliZSgnQ29tbWVudHNTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogQ29tbWVudHNTZXJ2aWNlO1xuICBsZXQgcHJpc21hU2VydmljZTogamVzdC5Nb2NrZWQ8UHJpc21hU2VydmljZT47XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1ByaXNtYSA9IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlKCk7XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIENvbW1lbnRzU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFByaXNtYVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQcmlzbWEsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbW1lbnRzU2VydmljZT4oQ29tbWVudHNTZXJ2aWNlKTtcbiAgICBwcmlzbWFTZXJ2aWNlID0gbW9kdWxlLmdldChQcmlzbWFTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRVc2VyQnlJZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIHdoZW4gZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgICBlbWFpbDogJ2pvaG5AZXhhbXBsZS5jb20nLFxuICAgICAgfTtcblxuICAgICAgKHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRVc2VyQnlJZChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UudXNlci5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIHdoZW4gdXNlciBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAocHJpc21hU2VydmljZS51c2VyLmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kVXNlckJ5SWQoJ25vbi1leGlzdGVudC1pZCcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZS10aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGZvdW5kJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kVXNlckJ5SWQoVEVTVF9VU0VSX0lEUy5DTElFTlQpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd3JhcCBkYXRhYmFzZSBlcnJvcnMgaW4gSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLnVzZXIuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0RhdGFiYXNlIGVycm9yJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kVXNlckJ5SWQoVEVTVF9VU0VSX0lEUy5DTElFTlQpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEFsbCcsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQ29tbWVudHMgPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnY29tbWVudC0xJyxcbiAgICAgICAgY29udGVudDogJ0ZpcnN0IGNvbW1lbnQnLFxuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBwb3N0SWQ6ICdwb3N0LTEnLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICAgICAgICBhdmF0YXJVcmw6ICdhdmF0YXIuanBnJyxcbiAgICAgICAgfSxcbiAgICAgICAgcG9zdDoge1xuICAgICAgICAgIGlkOiAncG9zdC0xJyxcbiAgICAgICAgICB0aXRsZTogJ1Rlc3QgUG9zdCcsXG4gICAgICAgIH0sXG4gICAgICAgIHJlcGxpZXM6IFtdLFxuICAgICAgICBoZWFydHM6IFtdLFxuICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICByZXBsaWVzOiAwLFxuICAgICAgICAgIGhlYXJ0czogMixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFsbCBjb21tZW50cyB3aXRob3V0IHVzZXIgaGVhcnRzIHdoZW4gbm8gdXNlcklkIHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrQ29tbWVudHMsXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ29tbWVudHMpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9zdDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICB0aXRsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXBsaWVzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgICAgIGNyZWF0ZWRBdDogJ2FzYycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGVhcnRzOiBmYWxzZSxcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICByZXBsaWVzOiB0cnVlLFxuICAgICAgICAgICAgICBoZWFydHM6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tbWVudHMgd2l0aCB1c2VyIGhlYXJ0cyB3aGVuIHVzZXJJZCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0NvbW1lbnRzLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQWxsKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ29tbWVudHMpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBpbmNsdWRlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaGVhcnRzOiB7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgb3JkZXJCeToge1xuICAgICAgICAgIGNyZWF0ZWRBdDogJ2Rlc2MnLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAocHJpc21hU2VydmljZS5jb21tZW50LmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmZpbmRBbGwoKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRPbmUnLCAoKSA9PiB7XG4gICAgY29uc3QgbW9ja0NvbW1lbnQgPSB7XG4gICAgICBpZDogJ2NvbW1lbnQtMScsXG4gICAgICBjb250ZW50OiAnVGVzdCBjb21tZW50JyxcbiAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgZmlyc3ROYW1lOiAnSm9obicsXG4gICAgICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICAgIH0sXG4gICAgICByZXBsaWVzOiBbXSxcbiAgICAgIGhlYXJ0czogW1xuICAgICAgICB7IGlkOiAnaGVhcnQtMScsIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfSxcbiAgICAgICAgeyBpZDogJ2hlYXJ0LTInLCB1c2VySWQ6ICd1c2VyLTInIH0sXG4gICAgICBdLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tZW50IHdpdGggaGVhcnRzIGNvdW50IGFuZCBmaWxlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGaWxlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnYXR0YWNobWVudC0xJyxcbiAgICAgICAgICBjb21tZW50SWQ6ICdjb21tZW50LTEnLFxuICAgICAgICAgIHVybDogJy9hcGkvZmlsZXMvZmlsZS0xJyxcbiAgICAgICAgICB0eXBlOiAnaW1hZ2UvanBlZycsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICAocHJpc21hU2VydmljZS5jb21tZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0NvbW1lbnQsXG4gICAgICApO1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAnZ2V0Q29tbWVudEF0dGFjaG1lbnRzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ZpbGVzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kT25lKCdjb21tZW50LTEnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIC4uLm1vY2tDb21tZW50LFxuICAgICAgICBoZWFydHM6IDIsIC8vIENvdW50IGluc3RlYWQgb2YgYXJyYXlcbiAgICAgICAgZmlsZXM6IG1vY2tGaWxlcyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0Q29tbWVudEF0dGFjaG1lbnRzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY29tbWVudC0xJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gY29tbWVudCBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAocHJpc21hU2VydmljZS5jb21tZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZmluZE9uZSgnbm9uLWV4aXN0ZW50LWlkJykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmZpbmRPbmUoJ2NvbW1lbnQtMScpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEJ5UG9zdElkJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tDb21tZW50cyA9IFtcbiAgICAgIHtcbiAgICAgICAgaWQ6ICdjb21tZW50LTEnLFxuICAgICAgICBjb250ZW50OiAnQ29tbWVudCBvbiBwb3N0JyxcbiAgICAgICAgcG9zdElkOiAncG9zdC0xJyxcbiAgICAgICAgdXNlcjogeyBmaXJzdE5hbWU6ICdKb2huJywgbGFzdE5hbWU6ICdEb2UnIH0sXG4gICAgICAgIHJlcGxpZXM6IFtdLFxuICAgICAgICBoZWFydHM6IFtdLFxuICAgICAgICBfY291bnQ6IHsgcmVwbGllczogMCwgaGVhcnRzOiAxIH0sXG4gICAgICB9LFxuICAgIF07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tZW50cyBmb3Igc3BlY2lmaWMgcG9zdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0NvbW1lbnRzLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQnlQb3N0SWQoJ3Bvc3QtMScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tZW50cyk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5jb21tZW50LmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IHBvc3RJZDogJ3Bvc3QtMScgfSxcbiAgICAgICAgaW5jbHVkZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGhlYXJ0czogZmFsc2UsXG4gICAgICAgIH0pLFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSB1c2VyIGhlYXJ0cyB3aGVuIHVzZXJJZCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnQuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0NvbW1lbnRzLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5maW5kQnlQb3N0SWQoJ3Bvc3QtMScsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBwb3N0SWQ6ICdwb3N0LTEnIH0sXG4gICAgICAgIGluY2x1ZGU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBoZWFydHM6IHtcbiAgICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGUnLCAoKSA9PiB7XG4gICAgY29uc3QgbW9ja0NvbW1lbnREYXRhID0ge1xuICAgICAgcG9zdElkOiAncG9zdC0xJyxcbiAgICAgIGNvbnRlbnQ6ICdOZXcgY29tbWVudCcsXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tDcmVhdGVkQ29tbWVudCA9IHtcbiAgICAgIGlkOiAnY29tbWVudC0xJyxcbiAgICAgIGNvbnRlbnQ6ICdOZXcgY29tbWVudCcsXG4gICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgcG9zdElkOiAncG9zdC0xJyxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgfSxcbiAgICAgIGhlYXJ0czogW10sXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbW1lbnQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZpbGVzID0gW107XG5cbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnQuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDcmVhdGVkQ29tbWVudCxcbiAgICAgICk7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdnZXRDb21tZW50QXR0YWNobWVudHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmlsZXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShcbiAgICAgICAgbW9ja0NvbW1lbnREYXRhLFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICAuLi5tb2NrQ3JlYXRlZENvbW1lbnQsXG4gICAgICAgIGhlYXJ0czogMCwgLy8gQ291bnQgaW5zdGVhZCBvZiBhcnJheVxuICAgICAgICBmaWxlczogbW9ja0ZpbGVzLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocHJpc21hU2VydmljZS5jb21tZW50LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBwb3N0SWQ6ICdwb3N0LTEnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdOZXcgY29tbWVudCcsXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgICAgIGhlYXJ0czogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY3JlYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdDcmVhdGlvbiBmYWlsZWQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jcmVhdGUobW9ja0NvbW1lbnREYXRhLCBURVNUX1VTRVJfSURTLkNMSUVOVCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrVXBkYXRlRGF0YSA9IHtcbiAgICAgIHBvc3RJZDogJ3Bvc3QtMScsXG4gICAgICBjb250ZW50OiAnVXBkYXRlZCBjb21tZW50JyxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9ja0NvbW1lbnQgPSB7XG4gICAgICBpZDogJ2NvbW1lbnQtMScsXG4gICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgIH07XG5cbiAgICBjb25zdCBtb2NrVXBkYXRlZENvbW1lbnQgPSB7XG4gICAgICBpZDogJ2NvbW1lbnQtMScsXG4gICAgICBjb250ZW50OiAnVXBkYXRlZCBjb21tZW50JyxcbiAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgZmlyc3ROYW1lOiAnSm9obicsXG4gICAgICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICAgICAgYXZhdGFyVXJsOiAnYXZhdGFyLmpwZycsXG4gICAgICB9LFxuICAgICAgaGVhcnRzOiBbXSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgY29tbWVudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRmlsZXMgPSBbXTtcblxuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDb21tZW50LFxuICAgICAgKTtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnQudXBkYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tVcGRhdGVkQ29tbWVudCxcbiAgICAgICk7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdnZXRDb21tZW50QXR0YWNobWVudHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmlsZXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwZGF0ZShcbiAgICAgICAgJ2NvbW1lbnQtMScsXG4gICAgICAgIG1vY2tVcGRhdGVEYXRhLFxuICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICAuLi5tb2NrVXBkYXRlZENvbW1lbnQsXG4gICAgICAgIGhlYXJ0czogMCxcbiAgICAgICAgZmlsZXM6IG1vY2tGaWxlcyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6ICdjb21tZW50LTEnLCB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgIGRhdGE6IHsgY29udGVudDogJ1VwZGF0ZWQgY29tbWVudCcgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYXJ0czogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiB3aGVuIGNvbW1lbnQgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS51cGRhdGUoJ25vbi1leGlzdGVudC1pZCcsIG1vY2tVcGRhdGVEYXRhLCBURVNUX1VTRVJfSURTLkNMSUVOVCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiB3aGVuIHVzZXIgaXMgbm90IGNvbW1lbnQgb3duZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvdGhlclVzZXJDb21tZW50ID0ge1xuICAgICAgICBpZDogJ2NvbW1lbnQtMScsXG4gICAgICAgIHVzZXJJZDogJ290aGVyLXVzZXItaWQnLFxuICAgICAgfTtcblxuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG90aGVyVXNlckNvbW1lbnQsXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UudXBkYXRlKCdjb21tZW50LTEnLCBtb2NrVXBkYXRlRGF0YSwgVEVTVF9VU0VSX0lEUy5DTElFTlQpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlbW92ZScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQ29tbWVudCA9IHtcbiAgICAgIGlkOiAnY29tbWVudC0xJyxcbiAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tEZWxldGVkQ29tbWVudCA9IHtcbiAgICAgIGlkOiAnY29tbWVudC0xJyxcbiAgICAgIGNvbnRlbnQ6ICdEZWxldGVkIGNvbW1lbnQnLFxuICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgY29tbWVudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAocHJpc21hU2VydmljZS5jb21tZW50LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0NvbW1lbnQsXG4gICAgICApO1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5kZWxldGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0RlbGV0ZWRDb21tZW50LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5yZW1vdmUoJ2NvbW1lbnQtMScsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRGVsZXRlZENvbW1lbnQpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6ICdjb21tZW50LTEnIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBjb21tZW50IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UucmVtb3ZlKCdub24tZXhpc3RlbnQtaWQnLCBURVNUX1VTRVJfSURTLkNMSUVOVCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiB3aGVuIHVzZXIgaXMgbm90IGNvbW1lbnQgb3duZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvdGhlclVzZXJDb21tZW50ID0ge1xuICAgICAgICBpZDogJ2NvbW1lbnQtMScsXG4gICAgICAgIHVzZXJJZDogJ290aGVyLXVzZXItaWQnLFxuICAgICAgfTtcblxuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG90aGVyVXNlckNvbW1lbnQsXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UucmVtb3ZlKCdjb21tZW50LTEnLCBURVNUX1VTRVJfSURTLkNMSUVOVCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEJ5VXNlcklkJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tVc2VyQ29tbWVudHMgPSBbXG4gICAgICB7XG4gICAgICAgIGlkOiAnY29tbWVudC0xJyxcbiAgICAgICAgY29udGVudDogJ1VzZXIgY29tbWVudCcsXG4gICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIHVzZXI6IHsgZmlyc3ROYW1lOiAnSm9obicsIGxhc3ROYW1lOiAnRG9lJyB9LFxuICAgICAgICBwb3N0OiB7IGlkOiAncG9zdC0xJywgdGl0bGU6ICdUZXN0IFBvc3QnIH0sXG4gICAgICAgIHJlcGxpZXM6IFtdLFxuICAgICAgICBfY291bnQ6IHsgcmVwbGllczogMCwgaGVhcnRzOiAxIH0sXG4gICAgICB9LFxuICAgIF07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tZW50cyBieSB1c2VyIElEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrVXNlckNvbW1lbnRzLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQnlVc2VySWQoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc2VyQ29tbWVudHMpO1xuICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5UIH0sXG4gICAgICAgIGluY2x1ZGU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB1c2VyOiB7IHNlbGVjdDogZXhwZWN0LmFueShPYmplY3QpIH0sXG4gICAgICAgICAgcG9zdDogeyBzZWxlY3Q6IGV4cGVjdC5hbnkoT2JqZWN0KSB9LFxuICAgICAgICAgIHJlcGxpZXM6IHsgaW5jbHVkZTogZXhwZWN0LmFueShPYmplY3QpIH0sXG4gICAgICAgICAgX2NvdW50OiB7IHNlbGVjdDogZXhwZWN0LmFueShPYmplY3QpIH0sXG4gICAgICAgIH0pLFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hlYXJ0IGZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2hlYXJ0Q29tbWVudCcsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYWRkIGhlYXJ0IHdoZW4gbm90IGFscmVhZHkgaGVhcnRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudEhlYXJ0LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBudWxsLFxuICAgICAgICApO1xuICAgICAgICAocHJpc21hU2VydmljZS5jb21tZW50SGVhcnQuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGlkOiAnaGVhcnQtMScsXG4gICAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmhlYXJ0Q29tbWVudChcbiAgICAgICAgICAnY29tbWVudC0xJyxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgaGVhcnRlZDogdHJ1ZSB9KTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuY29tbWVudEhlYXJ0LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGNvbW1lbnRJZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmVtb3ZlIGhlYXJ0IHdoZW4gYWxyZWFkeSBoZWFydGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBleGlzdGluZ0hlYXJ0ID0ge1xuICAgICAgICAgIGlkOiAnaGVhcnQtMScsXG4gICAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLmNvbW1lbnRIZWFydC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgZXhpc3RpbmdIZWFydCxcbiAgICAgICAgKTtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudEhlYXJ0LmRlbGV0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4aXN0aW5nSGVhcnQsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5oZWFydENvbW1lbnQoXG4gICAgICAgICAgJ2NvbW1lbnQtMScsXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGhlYXJ0ZWQ6IGZhbHNlIH0pO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5jb21tZW50SGVhcnQuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGNvbW1lbnRJZF91c2VySWQ6IHtcbiAgICAgICAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5jb21tZW50SGVhcnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICAgIG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSxcbiAgICAgICAgKTtcblxuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgc2VydmljZS5oZWFydENvbW1lbnQoJ2NvbW1lbnQtMScsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSxcbiAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbik7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdpc0NvbW1lbnRIZWFydGVkQnlVc2VyJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIGNvbW1lbnQgaXMgaGVhcnRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydCA9IHtcbiAgICAgICAgICBpZDogJ2hlYXJ0LTEnLFxuICAgICAgICAgIGNvbW1lbnRJZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5jb21tZW50SGVhcnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4aXN0aW5nSGVhcnQsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5pc0NvbW1lbnRIZWFydGVkQnlVc2VyKFxuICAgICAgICAgICdjb21tZW50LTEnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBjb21tZW50IGlzIG5vdCBoZWFydGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5jb21tZW50SGVhcnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIG51bGwsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5pc0NvbW1lbnRIZWFydGVkQnlVc2VyKFxuICAgICAgICAgICdjb21tZW50LTEnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZXBseSBmdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdjcmVhdGVSZXBseScsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXBseURhdGEgPSB7XG4gICAgICAgIGNvbnRlbnQ6ICdUZXN0IHJlcGx5JyxcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tDcmVhdGVkUmVwbHkgPSB7XG4gICAgICAgIGlkOiAncmVwbHktMScsXG4gICAgICAgIGNvbnRlbnQ6ICdUZXN0IHJlcGx5JyxcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgICAgYXZhdGFyVXJsOiAnYXZhdGFyLmpwZycsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbW1lbnQ6IHtcbiAgICAgICAgICBpZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgY29udGVudDogJ09yaWdpbmFsIGNvbW1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICBoZWFydHM6IFtdLFxuICAgICAgfTtcblxuICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcmVwbHkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5yZXBseS5jcmVhdGUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBtb2NrQ3JlYXRlZFJlcGx5LFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY3JlYXRlUmVwbHkobW9ja1JlcGx5RGF0YSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ3JlYXRlZFJlcGx5KTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucmVwbHkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgZGF0YTogbW9ja1JlcGx5RGF0YSxcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tbWVudDogdHJ1ZSxcbiAgICAgICAgICAgIGhlYXJ0czogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjcmVhdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnJlcGx5LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICAgIG5ldyBFcnJvcignQ3JlYXRpb24gZmFpbGVkJyksXG4gICAgICAgICk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY3JlYXRlUmVwbHkobW9ja1JlcGx5RGF0YSkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmluZFJlcGxpZXNCeUNvbW1lbnRJZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXBsaWVzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICBjb250ZW50OiAnRmlyc3QgcmVwbHknLFxuICAgICAgICAgIGNvbW1lbnRJZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgdXNlcjogeyBmaXJzdE5hbWU6ICdKb2huJywgbGFzdE5hbWU6ICdEb2UnIH0sXG4gICAgICAgICAgaGVhcnRzOiBbXSxcbiAgICAgICAgICBfY291bnQ6IHsgaGVhcnRzOiAwIH0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiByZXBsaWVzIHdpdGhvdXQgdXNlciBoZWFydHMgd2hlbiBubyB1c2VySWQgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnJlcGx5LmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbW9ja1JlcGxpZXMsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kUmVwbGllc0J5Q29tbWVudElkKCdjb21tZW50LTEnKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXBsaWVzKTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucmVwbHkuZmluZE1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICB3aGVyZTogeyBjb21tZW50SWQ6ICdjb21tZW50LTEnIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhlYXJ0czogdHJ1ZSxcbiAgICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHsgaGVhcnRzOiB0cnVlIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlcGxpZXMgd2l0aCB1c2VyIGhlYXJ0cyB3aGVuIHVzZXJJZCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucmVwbHkuZmluZE1hbnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBtb2NrUmVwbGllcyxcbiAgICAgICAgKTtcblxuICAgICAgICBhd2FpdCBzZXJ2aWNlLmZpbmRSZXBsaWVzQnlDb21tZW50SWQoJ2NvbW1lbnQtMScsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5yZXBseS5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIHdoZXJlOiB7IGNvbW1lbnRJZDogJ2NvbW1lbnQtMScgfSxcbiAgICAgICAgICBpbmNsdWRlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBoZWFydHM6IHtcbiAgICAgICAgICAgICAgd2hlcmU6IHsgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2FzYycgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdoZWFydFJlcGx5JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBhZGQgaGVhcnQgdG8gcmVwbHkgd2hlbiBub3QgYWxyZWFkeSBoZWFydGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAocHJpc21hU2VydmljZS5yZXBseUhlYXJ0LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBudWxsLFxuICAgICAgICApO1xuICAgICAgICAocHJpc21hU2VydmljZS5yZXBseUhlYXJ0LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBpZDogJ2hlYXJ0LTEnLFxuICAgICAgICAgIHJlcGx5SWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmhlYXJ0UmVwbHkoXG4gICAgICAgICAgJ3JlcGx5LTEnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBoZWFydGVkOiB0cnVlIH0pO1xuICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5yZXBseUhlYXJ0LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHJlcGx5SWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZW1vdmUgaGVhcnQgZnJvbSByZXBseSB3aGVuIGFscmVhZHkgaGVhcnRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydCA9IHtcbiAgICAgICAgICBpZDogJ2hlYXJ0LTEnLFxuICAgICAgICAgIHJlcGx5SWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICB9O1xuXG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnJlcGx5SGVhcnQuZmluZFVuaXF1ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICAgIGV4aXN0aW5nSGVhcnQsXG4gICAgICAgICk7XG4gICAgICAgIChwcmlzbWFTZXJ2aWNlLnJlcGx5SGVhcnQuZGVsZXRlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgZXhpc3RpbmdIZWFydCxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmhlYXJ0UmVwbHkoXG4gICAgICAgICAgJ3JlcGx5LTEnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBoZWFydGVkOiBmYWxzZSB9KTtcbiAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UucmVwbHlIZWFydC5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgcmVwbHlJZF91c2VySWQ6IHtcbiAgICAgICAgICAgICAgcmVwbHlJZDogJ3JlcGx5LTEnLFxuICAgICAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2lzUmVwbHlIZWFydGVkQnlVc2VyJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIHJlcGx5IGlzIGhlYXJ0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnQgPSB7XG4gICAgICAgICAgaWQ6ICdoZWFydC0xJyxcbiAgICAgICAgICByZXBseUlkOiAncmVwbHktMScsXG4gICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgfTtcblxuICAgICAgICAocHJpc21hU2VydmljZS5yZXBseUhlYXJ0LmZpbmRVbmlxdWUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgICBleGlzdGluZ0hlYXJ0LFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuaXNSZXBseUhlYXJ0ZWRCeVVzZXIoXG4gICAgICAgICAgJ3JlcGx5LTEnLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICApO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiByZXBseSBpcyBub3QgaGVhcnRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKHByaXNtYVNlcnZpY2UucmVwbHlIZWFydC5maW5kVW5pcXVlIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgICAgbnVsbCxcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmlzUmVwbHlIZWFydGVkQnlVc2VyKFxuICAgICAgICAgICdyZXBseS0xJyxcbiAgICAgICAgICBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRmlsZSBhdHRhY2htZW50IGZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ0NvbW1lbnQgYXR0YWNobWVudHMnLCAoKSA9PiB7XG4gICAgICBkZXNjcmliZSgnYXR0YWNoRmlsZXNUb0NvbW1lbnQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgYXR0YWNoIGZpbGVzIHRvIGNvbW1lbnQgd2l0aCBkZWZhdWx0IHB1cnBvc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgZmlsZUlkcyA9IFsnZmlsZS0xJywgJ2ZpbGUtMiddO1xuICAgICAgICAgIGNvbnN0IGV4cGVjdGVkRGF0YSA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZmlsZUlkOiAnZmlsZS0xJyxcbiAgICAgICAgICAgICAgZW50aXR5VHlwZTogQXR0YWNobWVudEVudGl0eVR5cGUuQ09NTUVOVCxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6ICdjb21tZW50LTEnLFxuICAgICAgICAgICAgICBwdXJwb3NlOiBBdHRhY2htZW50UHVycG9zZS5NRURJQSxcbiAgICAgICAgICAgICAgb3JkZXI6IDAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmaWxlSWQ6ICdmaWxlLTInLFxuICAgICAgICAgICAgICBlbnRpdHlUeXBlOiBBdHRhY2htZW50RW50aXR5VHlwZS5DT01NRU5ULFxuICAgICAgICAgICAgICBlbnRpdHlJZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgICAgIHB1cnBvc2U6IEF0dGFjaG1lbnRQdXJwb3NlLk1FRElBLFxuICAgICAgICAgICAgICBvcmRlcjogMSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXTtcblxuICAgICAgICAgIChcbiAgICAgICAgICAgIHByaXNtYVNlcnZpY2UuZmlsZUF0dGFjaG1lbnQuY3JlYXRlTWFueSBhcyBqZXN0Lk1vY2tcbiAgICAgICAgICApLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGNvdW50OiAyLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdHRhY2hGaWxlc1RvQ29tbWVudChcbiAgICAgICAgICAgICdjb21tZW50LTEnLFxuICAgICAgICAgICAgZmlsZUlkcyxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGNvdW50OiAyIH0pO1xuICAgICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmZpbGVBdHRhY2htZW50LmNyZWF0ZU1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICAgIGRhdGE6IGV4cGVjdGVkRGF0YSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhdHRhY2ggZmlsZXMgd2l0aCBjdXN0b20gcHVycG9zZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBmaWxlSWRzID0gWydmaWxlLTEnXTtcblxuICAgICAgICAgIGF3YWl0IHNlcnZpY2UuYXR0YWNoRmlsZXNUb0NvbW1lbnQoXG4gICAgICAgICAgICAnY29tbWVudC0xJyxcbiAgICAgICAgICAgIGZpbGVJZHMsXG4gICAgICAgICAgICBBdHRhY2htZW50UHVycG9zZS5ET0NVTUVOVCxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuZmlsZUF0dGFjaG1lbnQuY3JlYXRlTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgICAgZGF0YTogW1xuICAgICAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgICAgcHVycG9zZTogQXR0YWNobWVudFB1cnBvc2UuRE9DVU1FTlQsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ2dldENvbW1lbnRBdHRhY2htZW50cycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZm9ybWF0dGVkIGNvbW1lbnQgYXR0YWNobWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbW9ja0F0dGFjaG1lbnRzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogJ2F0dGFjaG1lbnQtMScsXG4gICAgICAgICAgICAgIGVudGl0eUlkOiAnY29tbWVudC0xJyxcbiAgICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGlkOiAnZmlsZS0xJyxcbiAgICAgICAgICAgICAgICBzdG9yYWdlVXJsOiAnaHR0cHM6Ly9zdG9yYWdlLmNvbS9maWxlLTEuanBnJyxcbiAgICAgICAgICAgICAgICBtaW1lVHlwZTogJ2ltYWdlL2pwZWcnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgaWQ6ICdhdHRhY2htZW50LTInLFxuICAgICAgICAgICAgICBlbnRpdHlJZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgICAgIGZpbGU6IHtcbiAgICAgICAgICAgICAgICBpZDogJ2ZpbGUtMicsXG4gICAgICAgICAgICAgICAgc3RvcmFnZVVybDogbnVsbCxcbiAgICAgICAgICAgICAgICBtaW1lVHlwZTogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF07XG5cbiAgICAgICAgICAoXG4gICAgICAgICAgICBwcmlzbWFTZXJ2aWNlLmZpbGVBdHRhY2htZW50LmZpbmRNYW55IGFzIGplc3QuTW9ja1xuICAgICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0F0dGFjaG1lbnRzKTtcblxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0Q29tbWVudEF0dGFjaG1lbnRzKCdjb21tZW50LTEnKTtcblxuICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpZDogJ2F0dGFjaG1lbnQtMScsXG4gICAgICAgICAgICAgIGNvbW1lbnRJZDogJ2NvbW1lbnQtMScsXG4gICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vc3RvcmFnZS5jb20vZmlsZS0xLmpwZycsXG4gICAgICAgICAgICAgIHR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAnYXR0YWNobWVudC0yJyxcbiAgICAgICAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgICAgICAgICAgdXJsOiAnL2FwaS9maWxlcy9maWxlLTInLFxuICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2UvcG5nJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSk7XG5cbiAgICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5maWxlQXR0YWNobWVudC5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgZW50aXR5VHlwZTogQXR0YWNobWVudEVudGl0eVR5cGUuQ09NTUVOVCxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6ICdjb21tZW50LTEnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgZmlsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IG9yZGVyOiAnYXNjJyB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgncmVtb3ZlQ29tbWVudEF0dGFjaG1lbnQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmVtb3ZlIGNvbW1lbnQgYXR0YWNobWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAoXG4gICAgICAgICAgICBwcmlzbWFTZXJ2aWNlLmZpbGVBdHRhY2htZW50LmRlbGV0ZU1hbnkgYXMgamVzdC5Nb2NrXG4gICAgICAgICAgKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVtb3ZlQ29tbWVudEF0dGFjaG1lbnQoXG4gICAgICAgICAgICAnY29tbWVudC0xJyxcbiAgICAgICAgICAgICdmaWxlLTEnLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgY291bnQ6IDEgfSk7XG4gICAgICAgICAgZXhwZWN0KHByaXNtYVNlcnZpY2UuZmlsZUF0dGFjaG1lbnQuZGVsZXRlTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgZW50aXR5VHlwZTogQXR0YWNobWVudEVudGl0eVR5cGUuQ09NTUVOVCxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6ICdjb21tZW50LTEnLFxuICAgICAgICAgICAgICBmaWxlSWQ6ICdmaWxlLTEnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdSZXBseSBhdHRhY2htZW50cycsICgpID0+IHtcbiAgICAgIGRlc2NyaWJlKCdhdHRhY2hGaWxlc1RvUmVwbHknLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgYXR0YWNoIGZpbGVzIHRvIHJlcGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGZpbGVJZHMgPSBbJ2ZpbGUtMSddO1xuICAgICAgICAgIGNvbnN0IGV4cGVjdGVkRGF0YSA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZmlsZUlkOiAnZmlsZS0xJyxcbiAgICAgICAgICAgICAgZW50aXR5VHlwZTogQXR0YWNobWVudEVudGl0eVR5cGUuUkVQTFksXG4gICAgICAgICAgICAgIGVudGl0eUlkOiAncmVwbHktMScsXG4gICAgICAgICAgICAgIHB1cnBvc2U6IEF0dGFjaG1lbnRQdXJwb3NlLk1FRElBLFxuICAgICAgICAgICAgICBvcmRlcjogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXTtcblxuICAgICAgICAgIChcbiAgICAgICAgICAgIHByaXNtYVNlcnZpY2UuZmlsZUF0dGFjaG1lbnQuY3JlYXRlTWFueSBhcyBqZXN0Lk1vY2tcbiAgICAgICAgICApLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdHRhY2hGaWxlc1RvUmVwbHkoJ3JlcGx5LTEnLCBmaWxlSWRzKTtcblxuICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBjb3VudDogMSB9KTtcbiAgICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5maWxlQXR0YWNobWVudC5jcmVhdGVNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgICBkYXRhOiBleHBlY3RlZERhdGEsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdnZXRSZXBseUF0dGFjaG1lbnRzJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiByZXBseSBhdHRhY2htZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBtb2NrQXR0YWNobWVudHMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAnYXR0YWNobWVudC0xJyxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgIGlkOiAnZmlsZS0xJyxcbiAgICAgICAgICAgICAgICBzdG9yYWdlVXJsOiAnc3RvcmFnZS11cmwnLFxuICAgICAgICAgICAgICAgIG1pbWVUeXBlOiAnaW1hZ2UvanBlZycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF07XG5cbiAgICAgICAgICAoXG4gICAgICAgICAgICBwcmlzbWFTZXJ2aWNlLmZpbGVBdHRhY2htZW50LmZpbmRNYW55IGFzIGplc3QuTW9ja1xuICAgICAgICAgICkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0F0dGFjaG1lbnRzKTtcblxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0UmVwbHlBdHRhY2htZW50cygncmVwbHktMScpO1xuXG4gICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQXR0YWNobWVudHMpO1xuICAgICAgICAgIGV4cGVjdChwcmlzbWFTZXJ2aWNlLmZpbGVBdHRhY2htZW50LmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBlbnRpdHlUeXBlOiBBdHRhY2htZW50RW50aXR5VHlwZS5SRVBMWSxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIGZpbGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBvcmRlcjogJ2FzYycgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3JlbW92ZVJlcGx5QXR0YWNobWVudCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZW1vdmUgcmVwbHkgYXR0YWNobWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAoXG4gICAgICAgICAgICBwcmlzbWFTZXJ2aWNlLmZpbGVBdHRhY2htZW50LmRlbGV0ZU1hbnkgYXMgamVzdC5Nb2NrXG4gICAgICAgICAgKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVtb3ZlUmVwbHlBdHRhY2htZW50KFxuICAgICAgICAgICAgJ3JlcGx5LTEnLFxuICAgICAgICAgICAgJ2ZpbGUtMScsXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBjb3VudDogMSB9KTtcbiAgICAgICAgICBleHBlY3QocHJpc21hU2VydmljZS5maWxlQXR0YWNobWVudC5kZWxldGVNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBlbnRpdHlUeXBlOiBBdHRhY2htZW50RW50aXR5VHlwZS5SRVBMWSxcbiAgICAgICAgICAgICAgZW50aXR5SWQ6ICdyZXBseS0xJyxcbiAgICAgICAgICAgICAgZmlsZUlkOiAnZmlsZS0xJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBub24tRXJyb3Igb2JqZWN0cyBpbiBjYXRjaCBibG9ja3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAocHJpc21hU2VydmljZS5jb21tZW50LmZpbmRNYW55IGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgICdTdHJpbmcgZXJyb3InLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZmluZEFsbCgpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZS10aHJvdyBGb3JiaWRkZW5FeGNlcHRpb24gZnJvbSBkYXRhYmFzZSBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHByaXNtYVNlcnZpY2UuY29tbWVudC5maW5kTWFueSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdBY2Nlc3MgZGVuaWVkJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBkYXRhYmFzZSBvcGVyYXRpb25zIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcmlzbWFTZXJ2aWNlLnJlcGx5LmNyZWF0ZSBhcyBqZXN0Lk1vY2spLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0NvbXBsZXggZGF0YWJhc2UgZXJyb3InKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jcmVhdGVSZXBseSh7XG4gICAgICAgICAgY29udGVudDogJ1Rlc3QnLFxuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgY29tbWVudElkOiAnY29tbWVudC0xJyxcbiAgICAgICAgfSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==