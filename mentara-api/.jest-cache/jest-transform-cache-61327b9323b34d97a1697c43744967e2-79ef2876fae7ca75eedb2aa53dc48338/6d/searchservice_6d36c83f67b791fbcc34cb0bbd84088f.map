{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.service.ts"],"sourcesContent":["import { Injectable, InternalServerErrorException } from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\n\n@Injectable()\nexport class SearchService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  async searchTherapists(\n    query: string,\n    filters?: {\n      province?: string;\n      location?: string;\n      expertise?: string[];\n      specialties?: string[];\n      maxHourlyRate?: number;\n      minExperience?: number;\n      experienceYears?: number;\n      rating?: number;\n      gender?: string;\n      languages?: string[];\n      availability?: any;\n      verifiedOnly?: boolean;\n      priceRange?: { min?: number; max?: number };\n    },\n  ) {\n    try {\n      const where: any = {\n        status: 'APPROVED',\n        OR: [\n          {\n            user: {\n              firstName: { contains: query, mode: 'insensitive' },\n            },\n          },\n          {\n            user: {\n              lastName: { contains: query, mode: 'insensitive' },\n            },\n          },\n          {\n            user: {\n              bio: { contains: query, mode: 'insensitive' },\n            },\n          },\n          {\n            expertise: { hasSome: [query] },\n          },\n        ],\n      };\n\n      if (filters) {\n        if (filters.province) {\n          where.province = filters.province;\n        }\n        if (filters.expertise && filters.expertise.length > 0) {\n          where.expertise = { hasSome: filters.expertise };\n        }\n        if (filters.maxHourlyRate) {\n          where.hourlyRate = { lte: filters.maxHourlyRate };\n        }\n        if (filters.minExperience) {\n          where.yearsOfExperience = { gte: filters.minExperience };\n        }\n      }\n\n      return this.prisma.therapist.findMany({\n        where,\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n              bio: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search therapists: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async searchPosts(query: string, communityId?: string, userId?: string) {\n    try {\n      const where: any = {\n        OR: [\n          { title: { contains: query, mode: 'insensitive' } },\n          { content: { contains: query, mode: 'insensitive' } },\n        ],\n      };\n\n      // If userId is provided, filter posts to only include those from communities the user is a member of\n      if (userId) {\n        where.room = {\n          roomGroup: {\n            community: {\n              memberships: {\n                some: {\n                  userId: userId,\n                },\n              },\n            },\n          },\n        };\n      }\n\n      // If specific communityId is provided, further filter by that community\n      if (communityId) {\n        if (where.room) {\n          where.room.roomGroup.community.id = communityId;\n        } else {\n          where.room = {\n            roomGroup: {\n              community: {\n                id: communityId,\n              },\n            },\n          };\n        }\n      }\n\n      return this.prisma.post.findMany({\n        where,\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          room: {\n            include: {\n              roomGroup: {\n                include: {\n                  community: {\n                    select: {\n                      id: true,\n                      name: true,\n                      slug: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              hearts: true,\n              comments: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search posts: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async searchComments(query: string, communityId?: string, userId?: string) {\n    try {\n      const where: any = {\n        content: { contains: query, mode: 'insensitive' },\n      };\n\n      // If userId is provided, filter comments to only include those from posts in communities the user is a member of\n      if (userId) {\n        where.post = {\n          room: {\n            roomGroup: {\n              community: {\n                memberships: {\n                  some: {\n                    userId: userId,\n                  },\n                },\n              },\n            },\n          },\n        };\n      }\n\n      // If specific communityId is provided, further filter by that community\n      if (communityId) {\n        if (where.post) {\n          where.post.room.roomGroup.community.id = communityId;\n        } else {\n          where.post = {\n            room: {\n              roomGroup: {\n                community: {\n                  id: communityId,\n                },\n              },\n            },\n          };\n        }\n      }\n\n      return this.prisma.comment.findMany({\n        where,\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n              role: true,\n            },\n          },\n          post: {\n            select: {\n              id: true,\n              title: true,\n              userId: true,\n              room: {\n                include: {\n                  roomGroup: {\n                    include: {\n                      community: {\n                        select: {\n                          id: true,\n                          name: true,\n                          slug: true,\n                        },\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n          _count: {\n            select: {\n              hearts: true,\n              children: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search comments: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async searchCommunities(query: string) {\n    try {\n      return this.prisma.community.findMany({\n        where: {\n          OR: [\n            { name: { contains: query, mode: 'insensitive' } },\n            { description: { contains: query, mode: 'insensitive' } },\n          ],\n        },\n        include: {\n          _count: {\n            select: {\n              memberships: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search communities: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async searchUsers(query: string, role?: string) {\n    try {\n      const where: any = {\n        OR: [\n          { firstName: { contains: query, mode: 'insensitive' } },\n          { lastName: { contains: query, mode: 'insensitive' } },\n          { email: { contains: query, mode: 'insensitive' } },\n        ],\n      };\n\n      if (role) {\n        where.role = role;\n      }\n\n      return this.prisma.user.findMany({\n        where,\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n          avatarUrl: true,\n          role: true,\n          createdAt: true,\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search users: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async searchWorksheets(query: string, userId?: string, role?: 'client' | 'therapist') {\n    try {\n      const where: any = {\n        OR: [\n          { title: { contains: query, mode: 'insensitive' } },\n          { instructions: { contains: query, mode: 'insensitive' } },\n        ],\n      };\n\n      // Filter by user role (client can only see their own worksheets)\n      if (role === 'client' && userId) {\n        where.clientId = userId;\n      } else if (role === 'therapist' && userId) {\n        where.therapistId = userId;\n      }\n\n      return this.prisma.worksheet.findMany({\n        where,\n        include: {\n          client: {\n            select: {\n              userId: true,\n              user: {\n                select: {\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n          },\n          therapist: {\n            select: {\n              userId: true,\n              user: {\n                select: {\n                  firstName: true,\n                  lastName: true,\n                  avatarUrl: true,\n                },\n              },\n            },\n          },\n          submission: {\n            select: {\n              id: true,\n              submittedAt: true,\n              feedback: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search worksheets: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async searchMessages(query: string, userId: string) {\n    try {\n      const whereClause: any = {\n        AND: [\n          {\n            content: {\n              contains: query,\n              mode: 'insensitive',\n            },\n          },\n          {\n            isDeleted: false,\n          },\n          {\n            conversation: {\n              participants: {\n                some: {\n                  userId,\n                  isActive: true,\n                },\n              },\n            },\n          },\n        ],\n      };\n\n      return this.prisma.message.findMany({\n        where: whereClause,\n        include: {\n          sender: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          conversation: {\n            select: {\n              id: true,\n              type: true,\n              title: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 20,\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to search messages: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async globalSearch(\n    query: string,\n    types?:\n      | ('therapists' | 'posts' | 'communities' | 'users' | 'worksheets' | 'messages')[],\n    userId?: string,\n    userRole?: 'client' | 'therapist' | 'moderator' | 'admin',\n  ) {\n    try {\n      const results: any = {};\n\n      // Default to all types if none specified\n      const defaultTypes = ['therapists', 'posts', 'communities', 'users', 'worksheets', 'messages'];\n      const typesArray = types && types.length > 0 ? types : defaultTypes;\n\n      if (typesArray.includes('therapists')) {\n        results.therapists = await this.searchTherapists(query);\n      }\n\n      if (typesArray.includes('posts')) {\n        results.posts = await this.searchPosts(query, undefined, userId);\n      }\n\n      // Add comments search (always filtered by user communities if userId is provided)\n      if (userId) {\n        results.comments = await this.searchComments(query, undefined, userId);\n      }\n\n      if (typesArray.includes('communities')) {\n        results.communities = await this.searchCommunities(query);\n      }\n\n      if (typesArray.includes('users')) {\n        results.users = await this.searchUsers(query);\n      }\n\n      if (typesArray.includes('worksheets')) {\n        // Only search worksheets if user has appropriate permissions\n        if (userRole === 'client' || userRole === 'therapist') {\n          results.worksheets = await this.searchWorksheets(query, userId, userRole);\n        } else if (userRole === 'moderator' || userRole === 'admin') {\n          // Admins and moderators can see all worksheets\n          results.worksheets = await this.searchWorksheets(query);\n        }\n      }\n\n      if (typesArray.includes('messages') && userId) {\n        // Messages are always private to the user\n        results.messages = await this.searchMessages(query, userId);\n      }\n\n      return results;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to perform global search: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n}\n"],"version":3}