{"version":3,"names":["common_1","cov_1rtdurqkpn","s","require","throttler_1","jwt_auth_guard_1","current_user_id_decorator_1","public_decorator_1","zod_validation_pipe_1","validation_1","client_auth_service_1","ClientAuthController","clientAuthService","constructor","f","register","registerDto","result","registerClient","user","id","email","firstName","b","lastName","role","isEmailVerified","emailVerified","createdAt","updatedAt","token","tokens","accessToken","message","getProfile","userId","getClientProfile","getFirstSignInStatus","markRecommendationsSeen","verifyOtp","verifyDto","verifyRegistrationOtp","otpCode","resendOtp","resendDto","resendRegistrationOtp","exports","__decorate","Public","Throttle","default","limit","ttl","Post","HttpCode","HttpStatus","CREATED","__param","Body","ZodValidationPipe","RegisterClientDtoSchema","Promise","_b","Object","UseGuards","JwtAuthGuard","Get","CurrentUserId","_c","OK","_d","_e","VerifyRegistrationOtpDtoSchema","_f","ResendRegistrationOtpDtoSchema","_g","Controller","ClientAuthService","_a"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/client-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Post,\n  UseGuards,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterClientDto,\n  VerifyRegistrationOtpDto,\n  ResendRegistrationOtpDto,\n  ClientAuthResponse,\n  ClientProfileResponse,\n  OnboardingStatusResponse,\n  EmailResponse,\n} from '../types';\nimport type { SuccessResponse } from '../../types/global';\n\n// Import validation schemas from local validation\nimport {\n  RegisterClientDtoSchema,\n  VerifyRegistrationOtpDtoSchema,\n  ResendRegistrationOtpDtoSchema,\n} from '../validation';\nimport { ClientAuthService } from '../services/client-auth.service';\nimport { Request } from 'express';\n\n@Controller('auth/client')\nexport class ClientAuthController {\n  constructor(private readonly clientAuthService: ClientAuthService) {}\n\n  @Public()\n  @Throttle({ default: { limit: 5, ttl: 300000 } }) // 5 registrations per 5 minutes\n  @Post('register')\n  @HttpCode(HttpStatus.CREATED)\n  async register(\n    @Body(new ZodValidationPipe(RegisterClientDtoSchema))\n    registerDto: RegisterClientDto,\n  ): Promise<ClientAuthResponse> {\n    const result = await this.clientAuthService.registerClient(registerDto);\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName || '',\n        lastName: result.user.lastName || '',\n        role: result.user.role as any,\n        isEmailVerified: result.user.emailVerified ?? false,\n        createdAt: result.user.createdAt,\n        updatedAt: result.user.updatedAt,\n      },\n      token: result.tokens.accessToken, // Single JWT token\n      message: result.message,\n    };\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(\n    @CurrentUserId() userId: string,\n  ): Promise<ClientProfileResponse> {\n    return this.clientAuthService.getClientProfile(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('first-sign-in-status')\n  @HttpCode(HttpStatus.OK)\n  async getFirstSignInStatus(\n    @CurrentUserId() userId: string,\n  ): Promise<OnboardingStatusResponse> {\n    return this.clientAuthService.getFirstSignInStatus(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Post('mark-recommendations-seen')\n  @HttpCode(HttpStatus.OK)\n  async markRecommendationsSeen(\n    @CurrentUserId() userId: string,\n  ): Promise<SuccessResponse> {\n    return this.clientAuthService.markRecommendationsSeen(userId);\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 10, ttl: 300000 } }) // 10 attempts per 5 minutes\n  @Post('verify-otp')\n  @HttpCode(HttpStatus.OK)\n  async verifyOtp(\n    @Body(new ZodValidationPipe(VerifyRegistrationOtpDtoSchema))\n    verifyDto: VerifyRegistrationOtpDto,\n  ): Promise<EmailResponse> {\n    return this.clientAuthService.verifyRegistrationOtp(\n      verifyDto.email,\n      verifyDto.otpCode,\n    );\n  }\n\n  @Public()\n  @Throttle({ default: { limit: 5, ttl: 300000 } }) // 5 resends per 5 minutes\n  @Post('resend-otp')\n  @HttpCode(HttpStatus.OK)\n  async resendOtp(\n    @Body(new ZodValidationPipe(ResendRegistrationOtpDtoSchema))\n    resendDto: ResendRegistrationOtpDto,\n  ): Promise<EmailResponse> {\n    return this.clientAuthService.resendRegistrationOtp(resendDto.email);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}