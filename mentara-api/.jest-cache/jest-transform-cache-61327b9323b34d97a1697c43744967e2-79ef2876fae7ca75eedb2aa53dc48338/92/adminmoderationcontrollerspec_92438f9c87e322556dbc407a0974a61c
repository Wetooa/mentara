751171328eb7294dc8829f73f356a75d
"use strict";
/**
 * Comprehensive Test Suite for AdminModerationController
 * Tests admin moderation functionality including content review and AI moderation service integration
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const admin_moderation_controller_1 = require("./admin-moderation.controller");
const admin_service_1 = require("../admin.service");
const moderation_service_1 = require("../../common/services/moderation.service");
const jwt_auth_guard_1 = require("../../auth/guards/jwt-auth.guard");
const admin_auth_guard_1 = require("../../auth/guards/admin-auth.guard");
const enhanced_test_helpers_1 = require("../../test-utils/enhanced-test-helpers");
const index_1 = require("../../test-utils/index");
describe('AdminModerationController', () => {
    let controller;
    let adminService;
    let moderationService;
    let module;
    // Mock AdminService
    const mockAdminService = {
        getFlaggedContent: jest.fn(),
        moderateContent: jest.fn(),
    };
    // Mock ModerationService
    const mockModerationService = {
        healthCheck: jest.fn(),
        getStats: jest.fn(),
        classifyContent: jest.fn(),
        checkCrisisContent: jest.fn(),
        batchClassify: jest.fn(),
    };
    // Mock Guards
    const mockJwtAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    const mockAdminAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    // Test data
    const mockFlaggedContent = {
        content: [
            {
                id: 'post_123456789',
                type: 'post',
                content: 'This post contains inappropriate content',
                authorId: index_1.TEST_USER_IDS.CLIENT,
                authorName: 'John Doe',
                communityId: 'community_123',
                communityName: 'Anxiety Support',
                flaggedAt: new Date('2024-02-14T10:00:00Z'),
                flaggedBy: index_1.TEST_USER_IDS.MODERATOR,
                flagReason: 'Inappropriate content',
                flagCount: 3,
                status: 'pending',
                priority: 'medium',
                aiConfidence: 0.85,
                aiTags: ['inappropriate', 'offensive'],
            },
            {
                id: 'comment_987654321',
                type: 'comment',
                content: 'This comment violates community guidelines',
                authorId: index_1.TEST_USER_IDS.CLIENT,
                authorName: 'Jane Smith',
                parentPostId: 'post_parent_123',
                flaggedAt: new Date('2024-02-14T11:00:00Z'),
                flaggedBy: 'system',
                flagReason: 'Automated detection',
                flagCount: 1,
                status: 'pending',
                priority: 'high',
                aiConfidence: 0.92,
                aiTags: ['harassment', 'toxic'],
            },
        ],
        pagination: {
            page: 1,
            limit: 10,
            total: 2,
            totalPages: 1,
        },
        summary: {
            totalFlagged: 2,
            pendingReview: 2,
            approved: 0,
            removed: 0,
            highPriority: 1,
            mediumPriority: 1,
            lowPriority: 0,
        },
    };
    const mockModerationServiceHealth = {
        status: 'healthy',
        uptime: 3600000, // 1 hour
        lastCheck: new Date(),
        services: {
            ai_classifier: { status: 'healthy', responseTime: 120 },
            crisis_detector: { status: 'healthy', responseTime: 95 },
            toxicity_filter: { status: 'healthy', responseTime: 80 },
        },
        version: '1.2.3',
        capabilities: [
            'text_classification',
            'crisis_detection',
            'toxicity_filtering',
            'batch_processing',
        ],
    };
    const mockModerationStats = {
        totalProcessed: 15420,
        today: {
            processed: 234,
            flagged: 23,
            crisis: 3,
            approved: 186,
            removed: 25,
        },
        thisWeek: {
            processed: 1654,
            flagged: 156,
            crisis: 18,
            approved: 1245,
            removed: 235,
        },
        accuracy: {
            overall: 94.7,
            crisis_detection: 98.2,
            toxicity_detection: 92.1,
            false_positives: 3.8,
            false_negatives: 1.5,
        },
        performance: {
            averageResponseTime: 85, // ms
            throughput: 150, // requests per minute
            errorRate: 0.2, // percentage
        },
    };
    const mockClassificationResult = {
        confidence: 0.87,
        categories: ['inappropriate', 'offensive'],
        severity: 'medium',
        shouldFlag: true,
        crisisLevel: 'none',
        immediateEscalation: false,
        explanation: 'Content contains inappropriate language and offensive remarks',
        suggestedAction: 'flag_for_review',
        metadata: {
            processingTime: 120,
            modelVersion: '2.1.0',
            confidence_breakdown: {
                inappropriate: 0.89,
                offensive: 0.85,
                harassment: 0.12,
                toxic: 0.34,
            },
        },
    };
    beforeEach(async () => {
        module = await testing_1.Test.createTestingModule({
            controllers: [admin_moderation_controller_1.AdminModerationController],
            providers: [
                {
                    provide: admin_service_1.AdminService,
                    useValue: mockAdminService,
                },
                {
                    provide: moderation_service_1.ModerationService,
                    useValue: mockModerationService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(admin_auth_guard_1.AdminAuthGuard)
            .useValue(mockAdminAuthGuard)
            .compile();
        controller = module.get(admin_moderation_controller_1.AdminModerationController);
        adminService = module.get(admin_service_1.AdminService);
        moderationService = module.get(moderation_service_1.ModerationService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Controller Initialization', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have adminService and moderationService injected', () => {
            expect(adminService).toBeDefined();
            expect(moderationService).toBeDefined();
        });
    });
    describe('Security Guards', () => {
        it('should be protected by JwtAuthGuard and AdminAuthGuard', () => {
            const guards = Reflect.getMetadata('__guards__', admin_moderation_controller_1.AdminModerationController);
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
            expect(guards).toContain(admin_auth_guard_1.AdminAuthGuard);
        });
        it('should have proper route decorators', () => {
            const controllerMetadata = Reflect.getMetadata('path', admin_moderation_controller_1.AdminModerationController);
            expect(controllerMetadata).toBe('admin/moderation');
        });
        it('should have AdminOnly decorators on all methods', () => {
            const methods = [
                'getFlaggedContent',
                'moderateContent',
                'getServiceHealthStatus',
                'getServiceStats',
                'testClassification',
                'testCrisisDetection',
                'testBatchClassification',
            ];
            methods.forEach(method => {
                const metadata = Reflect.getMetadata('admin_only', controller[method]);
                expect(metadata).toBeTruthy();
            });
        });
    });
    describe('GET /admin/moderation/flagged', () => {
        it('should get flagged content with default pagination', async () => {
            mockAdminService.getFlaggedContent.mockResolvedValue(mockFlaggedContent);
            const result = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN);
            expect(result).toEqual(mockFlaggedContent);
            expect(adminService.getFlaggedContent).toHaveBeenCalledWith({
                type: undefined,
                page: 1,
                limit: 10,
            });
        });
        it('should get flagged content with custom parameters', async () => {
            mockAdminService.getFlaggedContent.mockResolvedValue(mockFlaggedContent);
            const result = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN, 'post', '2', '20');
            expect(result).toEqual(mockFlaggedContent);
            expect(adminService.getFlaggedContent).toHaveBeenCalledWith({
                type: 'post',
                page: 2,
                limit: 20,
            });
        });
        it('should filter by content type', async () => {
            const contentTypes = ['post', 'comment', 'message', 'profile'];
            for (const type of contentTypes) {
                const filteredContent = {
                    ...mockFlaggedContent,
                    content: mockFlaggedContent.content.filter(item => item.type === type),
                };
                mockAdminService.getFlaggedContent.mockResolvedValue(filteredContent);
                const result = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN, type);
                expect(adminService.getFlaggedContent).toHaveBeenCalledWith(expect.objectContaining({ type }));
            }
        });
        it('should handle invalid pagination parameters', async () => {
            mockAdminService.getFlaggedContent.mockResolvedValue(mockFlaggedContent);
            // Test with invalid string values that should be converted
            const result = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN, undefined, 'invalid', 'invalid');
            expect(adminService.getFlaggedContent).toHaveBeenCalledWith({
                type: undefined,
                page: NaN,
                limit: NaN,
            });
        });
        it('should handle empty flagged content', async () => {
            const emptyContent = {
                content: [],
                pagination: { page: 1, limit: 10, total: 0, totalPages: 0 },
                summary: { totalFlagged: 0, pendingReview: 0, approved: 0, removed: 0, highPriority: 0, mediumPriority: 0, lowPriority: 0 },
            };
            mockAdminService.getFlaggedContent.mockResolvedValue(emptyContent);
            const result = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN);
            expect(result.content).toHaveLength(0);
            expect(result.summary.totalFlagged).toBe(0);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database query failed');
            mockAdminService.getFlaggedContent.mockRejectedValue(serviceError);
            await expect(controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
            await expect(controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow('Failed to retrieve flagged content');
        });
        it('should log admin actions', async () => {
            const logSpy = jest.spyOn(controller['logger'], 'log');
            mockAdminService.getFlaggedContent.mockResolvedValue(mockFlaggedContent);
            await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN);
            expect(logSpy).toHaveBeenCalledWith(`Admin ${index_1.TEST_USER_IDS.ADMIN} retrieving flagged content`);
        });
    });
    describe('PUT /admin/moderation/:contentType/:contentId/moderate', () => {
        const contentType = 'post';
        const contentId = 'post_123456789';
        const moderationData = {
            action: 'remove',
            reason: 'Violates community guidelines',
        };
        it('should moderate content successfully', async () => {
            const moderatedContent = {
                id: contentId,
                type: contentType,
                status: 'removed',
                moderatedBy: index_1.TEST_USER_IDS.ADMIN,
                moderatedAt: new Date(),
                action: moderationData.action,
                reason: moderationData.reason,
            };
            mockAdminService.moderateContent.mockResolvedValue(moderatedContent);
            const result = await controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, contentType, contentId, moderationData);
            expect(result).toEqual(moderatedContent);
            expect(adminService.moderateContent).toHaveBeenCalledWith(contentType, contentId, index_1.TEST_USER_IDS.ADMIN, moderationData.action, moderationData.reason);
        });
        it('should handle all moderation actions', async () => {
            const actions = ['approve', 'remove', 'flag'];
            for (const action of actions) {
                const data = { action, reason: `Test ${action} action` };
                const moderatedContent = {
                    id: contentId,
                    type: contentType,
                    status: action === 'approve' ? 'approved' : action === 'remove' ? 'removed' : 'flagged',
                    action,
                };
                mockAdminService.moderateContent.mockResolvedValue(moderatedContent);
                const result = await controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, contentType, contentId, data);
                expect(result.action).toBe(action);
            }
        });
        it('should handle different content types', async () => {
            const contentTypes = ['post', 'comment', 'message', 'profile'];
            for (const type of contentTypes) {
                const moderatedContent = {
                    id: contentId,
                    type,
                    status: 'approved',
                    action: 'approve',
                };
                mockAdminService.moderateContent.mockResolvedValue(moderatedContent);
                const result = await controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, type, contentId, { action: 'approve' });
                expect(result.type).toBe(type);
                expect(adminService.moderateContent).toHaveBeenCalledWith(type, contentId, index_1.TEST_USER_IDS.ADMIN, 'approve', undefined);
            }
        });
        it('should handle moderation without reason', async () => {
            const dataWithoutReason = { action: 'approve' };
            const moderatedContent = {
                id: contentId,
                type: contentType,
                status: 'approved',
                action: 'approve',
            };
            mockAdminService.moderateContent.mockResolvedValue(moderatedContent);
            const result = await controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, contentType, contentId, dataWithoutReason);
            expect(result).toEqual(moderatedContent);
            expect(adminService.moderateContent).toHaveBeenCalledWith(contentType, contentId, index_1.TEST_USER_IDS.ADMIN, 'approve', undefined);
        });
        it('should handle content not found', async () => {
            const notFoundError = new Error('Content not found');
            mockAdminService.moderateContent.mockRejectedValue(notFoundError);
            await expect(controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, contentType, 'non-existent-id', moderationData)).rejects.toThrow(common_1.HttpException);
        });
        it('should log admin actions', async () => {
            const logSpy = jest.spyOn(controller['logger'], 'log');
            const moderatedContent = { id: contentId, status: 'removed' };
            mockAdminService.moderateContent.mockResolvedValue(moderatedContent);
            await controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, contentType, contentId, moderationData);
            expect(logSpy).toHaveBeenCalledWith(`Admin ${index_1.TEST_USER_IDS.ADMIN} moderating ${contentType} ${contentId}`);
        });
    });
    describe('GET /admin/moderation/service/health', () => {
        it('should get service health status successfully', async () => {
            mockModerationService.healthCheck.mockResolvedValue(mockModerationServiceHealth);
            const result = await controller.getServiceHealthStatus();
            expect(result).toEqual(mockModerationServiceHealth);
            expect(moderationService.healthCheck).toHaveBeenCalledWith();
        });
        it('should validate health response structure', async () => {
            mockModerationService.healthCheck.mockResolvedValue(mockModerationServiceHealth);
            const result = await controller.getServiceHealthStatus();
            expect(result).toHaveProperty('status');
            expect(result).toHaveProperty('uptime');
            expect(result).toHaveProperty('services');
            expect(result).toHaveProperty('capabilities');
            expect(Array.isArray(result.capabilities)).toBe(true);
            expect(typeof result.uptime).toBe('number');
        });
        it('should handle unhealthy service status', async () => {
            const unhealthyStatus = {
                ...mockModerationServiceHealth,
                status: 'unhealthy',
                services: {
                    ai_classifier: { status: 'unhealthy', responseTime: 5000, error: 'Timeout' },
                    crisis_detector: { status: 'healthy', responseTime: 95 },
                    toxicity_filter: { status: 'degraded', responseTime: 800 },
                },
            };
            mockModerationService.healthCheck.mockResolvedValue(unhealthyStatus);
            const result = await controller.getServiceHealthStatus();
            expect(result.status).toBe('unhealthy');
            expect(result.services.ai_classifier.status).toBe('unhealthy');
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Health check failed');
            mockModerationService.healthCheck.mockRejectedValue(serviceError);
            await expect(controller.getServiceHealthStatus()).rejects.toThrow(common_1.HttpException);
            await expect(controller.getServiceHealthStatus()).rejects.toThrow('Failed to get moderation service health');
        });
    });
    describe('GET /admin/moderation/service/stats', () => {
        it('should get service statistics successfully', async () => {
            mockModerationService.getStats.mockResolvedValue(mockModerationStats);
            const result = await controller.getServiceStats();
            expect(result).toEqual(mockModerationStats);
            expect(moderationService.getStats).toHaveBeenCalledWith();
        });
        it('should validate stats response structure', async () => {
            mockModerationService.getStats.mockResolvedValue(mockModerationStats);
            const result = await controller.getServiceStats();
            expect(result).toHaveProperty('totalProcessed');
            expect(result).toHaveProperty('today');
            expect(result).toHaveProperty('thisWeek');
            expect(result).toHaveProperty('accuracy');
            expect(result).toHaveProperty('performance');
            expect(typeof result.totalProcessed).toBe('number');
            expect(typeof result.accuracy.overall).toBe('number');
            expect(typeof result.performance.averageResponseTime).toBe('number');
        });
        it('should handle empty statistics', async () => {
            const emptyStats = {
                totalProcessed: 0,
                today: { processed: 0, flagged: 0, crisis: 0, approved: 0, removed: 0 },
                thisWeek: { processed: 0, flagged: 0, crisis: 0, approved: 0, removed: 0 },
                accuracy: { overall: 0, crisis_detection: 0, toxicity_detection: 0, false_positives: 0, false_negatives: 0 },
                performance: { averageResponseTime: 0, throughput: 0, errorRate: 0 },
            };
            mockModerationService.getStats.mockResolvedValue(emptyStats);
            const result = await controller.getServiceStats();
            expect(result.totalProcessed).toBe(0);
            expect(result.today.processed).toBe(0);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Stats service unavailable');
            mockModerationService.getStats.mockRejectedValue(serviceError);
            await expect(controller.getServiceStats()).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('POST /admin/moderation/service/test-classify', () => {
        const testData = {
            text: 'This is test content that might be inappropriate',
            context: 'community_post',
        };
        it('should test content classification successfully', async () => {
            mockModerationService.classifyContent.mockResolvedValue(mockClassificationResult);
            const result = await controller.testClassification(index_1.TEST_USER_IDS.ADMIN, testData);
            expect(result.result).toEqual(mockClassificationResult);
            expect(result.testInfo.testedBy).toBe(index_1.TEST_USER_IDS.ADMIN);
            expect(result.testInfo.inputText).toBe(testData.text);
            expect(result.testInfo.inputContext).toBe(testData.context);
        });
        it('should handle different content types for classification', async () => {
            const contentTypes = ['community_post', 'private_message', 'profile_text', 'comment'];
            for (const context of contentTypes) {
                const data = { ...testData, context };
                mockModerationService.classifyContent.mockResolvedValue(mockClassificationResult);
                const result = await controller.testClassification(index_1.TEST_USER_IDS.ADMIN, data);
                expect(moderationService.classifyContent).toHaveBeenCalledWith(data.text, expect.objectContaining({
                    context: data.context,
                    userId: index_1.TEST_USER_IDS.ADMIN,
                    userRole: 'admin',
                }));
            }
        });
        it('should handle various text content', async () => {
            const testTexts = [
                'This is appropriate content',
                'This content contains mild profanity',
                'This content is extremely inappropriate and offensive',
                'Help me, I am in crisis',
                'Normal therapeutic discussion about anxiety',
            ];
            for (const text of testTexts) {
                const data = { text, context: 'community_post' };
                const classificationResult = {
                    ...mockClassificationResult,
                    severity: text.includes('crisis') ? 'high' : text.includes('inappropriate') ? 'medium' : 'low',
                    crisisLevel: text.includes('crisis') ? 'high' : 'none',
                };
                mockModerationService.classifyContent.mockResolvedValue(classificationResult);
                const result = await controller.testClassification(index_1.TEST_USER_IDS.ADMIN, data);
                expect(result.result.severity).toBeDefined();
                expect(result.testInfo.inputText).toBe(text);
            }
        });
        it('should handle classification errors', async () => {
            const classificationError = new Error('AI service unavailable');
            mockModerationService.classifyContent.mockRejectedValue(classificationError);
            await expect(controller.testClassification(index_1.TEST_USER_IDS.ADMIN, testData)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('POST /admin/moderation/service/test-crisis', () => {
        const crisisTestData = {
            text: 'I am having thoughts of self-harm and need help',
            context: 'private_message',
        };
        it('should test crisis detection successfully', async () => {
            const crisisResult = {
                ...mockClassificationResult,
                crisisLevel: 'high',
                immediateEscalation: true,
            };
            mockModerationService.checkCrisisContent.mockResolvedValue(true);
            mockModerationService.classifyContent.mockResolvedValue(crisisResult);
            const result = await controller.testCrisisDetection(index_1.TEST_USER_IDS.ADMIN, crisisTestData);
            expect(result.isCrisis).toBe(true);
            expect(result.crisisLevel).toBe('high');
            expect(result.immediateEscalation).toBe(true);
            expect(result.fullResult).toEqual(crisisResult);
            expect(result.testInfo.testedBy).toBe(index_1.TEST_USER_IDS.ADMIN);
        });
        it('should handle non-crisis content', async () => {
            const normalTestData = {
                text: 'I am feeling better after our session',
                context: 'community_post',
            };
            const normalResult = {
                ...mockClassificationResult,
                crisisLevel: 'none',
                immediateEscalation: false,
            };
            mockModerationService.checkCrisisContent.mockResolvedValue(false);
            mockModerationService.classifyContent.mockResolvedValue(normalResult);
            const result = await controller.testCrisisDetection(index_1.TEST_USER_IDS.ADMIN, normalTestData);
            expect(result.isCrisis).toBe(false);
            expect(result.crisisLevel).toBe('none');
            expect(result.immediateEscalation).toBe(false);
        });
        it('should handle different crisis levels', async () => {
            const crisisLevels = ['none', 'low', 'medium', 'high', 'critical'];
            for (const level of crisisLevels) {
                const testData = { text: `Crisis level ${level} content`, context: 'private_message' };
                const isCrisis = level !== 'none';
                const result = {
                    ...mockClassificationResult,
                    crisisLevel: level,
                    immediateEscalation: ['high', 'critical'].includes(level),
                };
                mockModerationService.checkCrisisContent.mockResolvedValue(isCrisis);
                mockModerationService.classifyContent.mockResolvedValue(result);
                const testResult = await controller.testCrisisDetection(index_1.TEST_USER_IDS.ADMIN, testData);
                expect(testResult.crisisLevel).toBe(level);
                expect(testResult.isCrisis).toBe(isCrisis);
            }
        });
        it('should handle crisis detection errors', async () => {
            const crisisError = new Error('Crisis detection service failed');
            mockModerationService.checkCrisisContent.mockRejectedValue(crisisError);
            await expect(controller.testCrisisDetection(index_1.TEST_USER_IDS.ADMIN, crisisTestData)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('POST /admin/moderation/service/test-batch', () => {
        const batchTestData = {
            items: [
                { text: 'This is appropriate content', context: 'community_post' },
                { text: 'This contains inappropriate language', context: 'comment' },
                { text: 'Crisis content requiring immediate attention', context: 'private_message' },
            ],
        };
        it('should test batch classification successfully', async () => {
            const batchResults = [
                { ...mockClassificationResult, severity: 'low', shouldFlag: false },
                { ...mockClassificationResult, severity: 'medium', shouldFlag: true },
                { ...mockClassificationResult, severity: 'high', shouldFlag: true, crisisLevel: 'high' },
            ];
            mockModerationService.batchClassify.mockResolvedValue(batchResults);
            const result = await controller.testBatchClassification(index_1.TEST_USER_IDS.ADMIN, batchTestData);
            expect(result.results).toEqual(batchResults);
            expect(result.testInfo.testedBy).toBe(index_1.TEST_USER_IDS.ADMIN);
            expect(result.testInfo.itemCount).toBe(3);
            expect(moderationService.batchClassify).toHaveBeenCalledWith(expect.arrayContaining([
                expect.objectContaining({
                    text: batchTestData.items[0].text,
                    context: expect.objectContaining({
                        context: batchTestData.items[0].context,
                        userId: index_1.TEST_USER_IDS.ADMIN,
                        userRole: 'admin',
                    }),
                }),
            ]));
        });
        it('should handle empty batch', async () => {
            const emptyBatch = { items: [] };
            mockModerationService.batchClassify.mockResolvedValue([]);
            const result = await controller.testBatchClassification(index_1.TEST_USER_IDS.ADMIN, emptyBatch);
            expect(result.results).toEqual([]);
            expect(result.testInfo.itemCount).toBe(0);
        });
        it('should handle large batches', async () => {
            const largeBatch = {
                items: Array.from({ length: 50 }, (_, i) => ({
                    text: `Test content item ${i + 1}`,
                    context: 'community_post',
                })),
            };
            const largeBatchResults = Array.from({ length: 50 }, () => mockClassificationResult);
            mockModerationService.batchClassify.mockResolvedValue(largeBatchResults);
            const result = await controller.testBatchClassification(index_1.TEST_USER_IDS.ADMIN, largeBatch);
            expect(result.results).toHaveLength(50);
            expect(result.testInfo.itemCount).toBe(50);
        });
        it('should handle batch processing errors', async () => {
            const batchError = new Error('Batch processing failed');
            mockModerationService.batchClassify.mockRejectedValue(batchError);
            await expect(controller.testBatchClassification(index_1.TEST_USER_IDS.ADMIN, batchTestData)).rejects.toThrow(common_1.HttpException);
        });
        it('should handle mixed content types in batch', async () => {
            const mixedBatch = {
                items: [
                    { text: 'Community post content', context: 'community_post' },
                    { text: 'Private message content', context: 'private_message' },
                    { text: 'Comment content', context: 'comment' },
                    { text: 'Profile description', context: 'profile_text' },
                ],
            };
            const mixedResults = mixedBatch.items.map(() => mockClassificationResult);
            mockModerationService.batchClassify.mockResolvedValue(mixedResults);
            const result = await controller.testBatchClassification(index_1.TEST_USER_IDS.ADMIN, mixedBatch);
            expect(result.results).toHaveLength(4);
            expect(moderationService.batchClassify).toHaveBeenCalledWith(expect.arrayContaining([
                expect.objectContaining({
                    context: expect.objectContaining({ context: 'community_post' }),
                }),
                expect.objectContaining({
                    context: expect.objectContaining({ context: 'private_message' }),
                }),
                expect.objectContaining({
                    context: expect.objectContaining({ context: 'comment' }),
                }),
                expect.objectContaining({
                    context: expect.objectContaining({ context: 'profile_text' }),
                }),
            ]));
        });
    });
    describe('Error Handling', () => {
        it('should handle service unavailable scenarios', async () => {
            const serviceError = new Error('Service temporarily unavailable');
            mockAdminService.getFlaggedContent.mockRejectedValue(serviceError);
            await expect(controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN)).rejects.toThrow(common_1.HttpException);
        });
        it('should handle AI service integration errors', async () => {
            const aiServiceError = new Error('AI service timeout');
            mockModerationService.classifyContent.mockRejectedValue(aiServiceError);
            await expect(controller.testClassification(index_1.TEST_USER_IDS.ADMIN, { text: 'test', context: 'test' })).rejects.toThrow(common_1.HttpException);
        });
        it('should handle database errors gracefully', async () => {
            const dbError = new Error('Database connection failed');
            mockAdminService.moderateContent.mockRejectedValue(dbError);
            await expect(controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, 'post', 'post_123', { action: 'approve' })).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('Response Format Validation', () => {
        it('should return properly formatted flagged content response', async () => {
            mockAdminService.getFlaggedContent.mockResolvedValue(mockFlaggedContent);
            const result = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN);
            expect(result).toHaveProperty('content');
            expect(result).toHaveProperty('pagination');
            expect(result).toHaveProperty('summary');
            expect(Array.isArray(result.content)).toBe(true);
            result.content.forEach((item) => {
                enhanced_test_helpers_1.TestAssertions.expectValidEntity(item, ['id', 'type', 'content', 'authorId', 'flaggedAt']);
                expect(['pending', 'approved', 'removed']).toContain(item.status);
                expect(['low', 'medium', 'high']).toContain(item.priority);
            });
        });
        it('should return properly formatted health check response', async () => {
            mockModerationService.healthCheck.mockResolvedValue(mockModerationServiceHealth);
            const result = await controller.getServiceHealthStatus();
            expect(result).toHaveProperty('status');
            expect(result).toHaveProperty('services');
            expect(typeof result.uptime).toBe('number');
            Object.values(result.services).forEach((service) => {
                expect(service).toHaveProperty('status');
                expect(service).toHaveProperty('responseTime');
            });
        });
        it('should return properly formatted classification test response', async () => {
            mockModerationService.classifyContent.mockResolvedValue(mockClassificationResult);
            const result = await controller.testClassification(index_1.TEST_USER_IDS.ADMIN, {
                text: 'test',
                context: 'test',
            });
            expect(result).toHaveProperty('result');
            expect(result).toHaveProperty('testInfo');
            expect(result.result).toHaveProperty('confidence');
            expect(result.result).toHaveProperty('categories');
            expect(result.result).toHaveProperty('severity');
            expect(typeof result.result.confidence).toBe('number');
            expect(Array.isArray(result.result.categories)).toBe(true);
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete moderation workflow', async () => {
            // Get flagged content
            mockAdminService.getFlaggedContent.mockResolvedValue(mockFlaggedContent);
            const flaggedContent = await controller.getFlaggedContent(index_1.TEST_USER_IDS.ADMIN);
            expect(flaggedContent.content).toHaveLength(2);
            // Test classify content
            mockModerationService.classifyContent.mockResolvedValue(mockClassificationResult);
            const classification = await controller.testClassification(index_1.TEST_USER_IDS.ADMIN, {
                text: flaggedContent.content[0].content,
                context: 'community_post',
            });
            expect(classification.result.shouldFlag).toBeDefined();
            // Moderate content
            const moderatedContent = { id: 'post_123', status: 'removed' };
            mockAdminService.moderateContent.mockResolvedValue(moderatedContent);
            const moderation = await controller.moderateContent(index_1.TEST_USER_IDS.ADMIN, 'post', 'post_123', { action: 'remove', reason: 'Inappropriate content' });
            expect(moderation.status).toBe('removed');
        });
        it('should handle service health monitoring workflow', async () => {
            // Check service health
            mockModerationService.healthCheck.mockResolvedValue(mockModerationServiceHealth);
            const health = await controller.getServiceHealthStatus();
            expect(health.status).toBe('healthy');
            // Get service statistics
            mockModerationService.getStats.mockResolvedValue(mockModerationStats);
            const stats = await controller.getServiceStats();
            expect(stats.totalProcessed).toBeGreaterThan(0);
            // Test crisis detection
            mockModerationService.checkCrisisContent.mockResolvedValue(true);
            mockModerationService.classifyContent.mockResolvedValue({
                ...mockClassificationResult,
                crisisLevel: 'high',
            });
            const crisisTest = await controller.testCrisisDetection(index_1.TEST_USER_IDS.ADMIN, {
                text: 'I need help urgently',
                context: 'private_message',
            });
            expect(crisisTest.isCrisis).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2FkbWluL2NvbnRyb2xsZXJzL2FkbWluLW1vZGVyYXRpb24uY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsNkNBQXNEO0FBQ3RELDJDQUF1SDtBQUN2SCwrRUFBMEU7QUFDMUUsb0RBQWdEO0FBQ2hELGlGQUFnRztBQUNoRyxxRUFBZ0U7QUFDaEUseUVBQW9FO0FBRXBFLGtGQUF3RztBQUN4RyxrREFBb0U7QUFFcEUsUUFBUSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxJQUFJLFVBQXFDLENBQUM7SUFDMUMsSUFBSSxZQUEwQixDQUFDO0lBQy9CLElBQUksaUJBQW9DLENBQUM7SUFDekMsSUFBSSxNQUFxQixDQUFDO0lBRTFCLG9CQUFvQjtJQUNwQixNQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDNUIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDM0IsQ0FBQztJQUVGLHlCQUF5QjtJQUN6QixNQUFNLHFCQUFxQixHQUFHO1FBQzVCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ25CLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzFCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDN0IsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDekIsQ0FBQztJQUVGLGNBQWM7SUFDZCxNQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQztLQUM3QyxDQUFDO0lBRUYsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUs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QUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9hZG1pbi9jb250cm9sbGVycy9hZG1pbi1tb2RlcmF0aW9uLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbXByZWhlbnNpdmUgVGVzdCBTdWl0ZSBmb3IgQWRtaW5Nb2RlcmF0aW9uQ29udHJvbGxlclxuICogVGVzdHMgYWRtaW4gbW9kZXJhdGlvbiBmdW5jdGlvbmFsaXR5IGluY2x1ZGluZyBjb250ZW50IHJldmlldyBhbmQgQUkgbW9kZXJhdGlvbiBzZXJ2aWNlIGludGVncmF0aW9uXG4gKi9cblxuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXhjZXB0aW9uLCBOb3RGb3VuZEV4Y2VwdGlvbiwgRm9yYmlkZGVuRXhjZXB0aW9uLCBIdHRwRXhjZXB0aW9uLCBIdHRwU3RhdHVzIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQWRtaW5Nb2RlcmF0aW9uQ29udHJvbGxlciB9IGZyb20gJy4vYWRtaW4tbW9kZXJhdGlvbi5jb250cm9sbGVyJztcbmltcG9ydCB7IEFkbWluU2VydmljZSB9IGZyb20gJy4uL2FkbWluLnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9kZXJhdGlvblNlcnZpY2UsIE1vZGVyYXRpb25Db250ZXh0IH0gZnJvbSAnLi4vLi4vY29tbW9uL3NlcnZpY2VzL21vZGVyYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi8uLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBBZG1pbkF1dGhHdWFyZCB9IGZyb20gJy4uLy4uL2F1dGgvZ3VhcmRzL2FkbWluLWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgU2VjdXJpdHlHdWFyZFRlc3RVdGlscywgUm9sZUJhc2VkVGVzdFV0aWxzIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQgeyBNb2NrQnVpbGRlciwgVGVzdERhdGFHZW5lcmF0b3IsIFRlc3RBc3NlcnRpb25zIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9lbmhhbmNlZC10ZXN0LWhlbHBlcnMnO1xuaW1wb3J0IHsgVEVTVF9VU0VSX0lEUywgVEVTVF9FTUFJTFMgfSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2luZGV4JztcblxuZGVzY3JpYmUoJ0FkbWluTW9kZXJhdGlvbkNvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBBZG1pbk1vZGVyYXRpb25Db250cm9sbGVyO1xuICBsZXQgYWRtaW5TZXJ2aWNlOiBBZG1pblNlcnZpY2U7XG4gIGxldCBtb2RlcmF0aW9uU2VydmljZTogTW9kZXJhdGlvblNlcnZpY2U7XG4gIGxldCBtb2R1bGU6IFRlc3RpbmdNb2R1bGU7XG5cbiAgLy8gTW9jayBBZG1pblNlcnZpY2VcbiAgY29uc3QgbW9ja0FkbWluU2VydmljZSA9IHtcbiAgICBnZXRGbGFnZ2VkQ29udGVudDogamVzdC5mbigpLFxuICAgIG1vZGVyYXRlQ29udGVudDogamVzdC5mbigpLFxuICB9O1xuXG4gIC8vIE1vY2sgTW9kZXJhdGlvblNlcnZpY2VcbiAgY29uc3QgbW9ja01vZGVyYXRpb25TZXJ2aWNlID0ge1xuICAgIGhlYWx0aENoZWNrOiBqZXN0LmZuKCksXG4gICAgZ2V0U3RhdHM6IGplc3QuZm4oKSxcbiAgICBjbGFzc2lmeUNvbnRlbnQ6IGplc3QuZm4oKSxcbiAgICBjaGVja0NyaXNpc0NvbnRlbnQ6IGplc3QuZm4oKSxcbiAgICBiYXRjaENsYXNzaWZ5OiBqZXN0LmZuKCksXG4gIH07XG5cbiAgLy8gTW9jayBHdWFyZHNcbiAgY29uc3QgbW9ja0p3dEF1dGhHdWFyZCA9IHtcbiAgICBjYW5BY3RpdmF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgfTtcblxuICBjb25zdCBtb2NrQWRtaW5BdXRoR3VhcmQgPSB7XG4gICAgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSksXG4gIH07XG5cbiAgLy8gVGVzdCBkYXRhXG4gIGNvbnN0IG1vY2tGbGFnZ2VkQ29udGVudCA9IHtcbiAgICBjb250ZW50OiBbXG4gICAgICB7XG4gICAgICAgIGlkOiAncG9zdF8xMjM0NTY3ODknLFxuICAgICAgICB0eXBlOiAncG9zdCcsXG4gICAgICAgIGNvbnRlbnQ6ICdUaGlzIHBvc3QgY29udGFpbnMgaW5hcHByb3ByaWF0ZSBjb250ZW50JyxcbiAgICAgICAgYXV0aG9ySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBhdXRob3JOYW1lOiAnSm9obiBEb2UnLFxuICAgICAgICBjb21tdW5pdHlJZDogJ2NvbW11bml0eV8xMjMnLFxuICAgICAgICBjb21tdW5pdHlOYW1lOiAnQW54aWV0eSBTdXBwb3J0JyxcbiAgICAgICAgZmxhZ2dlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMi0xNFQxMDowMDowMFonKSxcbiAgICAgICAgZmxhZ2dlZEJ5OiBURVNUX1VTRVJfSURTLk1PREVSQVRPUixcbiAgICAgICAgZmxhZ1JlYXNvbjogJ0luYXBwcm9wcmlhdGUgY29udGVudCcsXG4gICAgICAgIGZsYWdDb3VudDogMyxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgYWlDb25maWRlbmNlOiAwLjg1LFxuICAgICAgICBhaVRhZ3M6IFsnaW5hcHByb3ByaWF0ZScsICdvZmZlbnNpdmUnXSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAnY29tbWVudF85ODc2NTQzMjEnLFxuICAgICAgICB0eXBlOiAnY29tbWVudCcsXG4gICAgICAgIGNvbnRlbnQ6ICdUaGlzIGNvbW1lbnQgdmlvbGF0ZXMgY29tbXVuaXR5IGd1aWRlbGluZXMnLFxuICAgICAgICBhdXRob3JJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGF1dGhvck5hbWU6ICdKYW5lIFNtaXRoJyxcbiAgICAgICAgcGFyZW50UG9zdElkOiAncG9zdF9wYXJlbnRfMTIzJyxcbiAgICAgICAgZmxhZ2dlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMi0xNFQxMTowMDowMFonKSxcbiAgICAgICAgZmxhZ2dlZEJ5OiAnc3lzdGVtJyxcbiAgICAgICAgZmxhZ1JlYXNvbjogJ0F1dG9tYXRlZCBkZXRlY3Rpb24nLFxuICAgICAgICBmbGFnQ291bnQ6IDEsXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICBhaUNvbmZpZGVuY2U6IDAuOTIsXG4gICAgICAgIGFpVGFnczogWydoYXJhc3NtZW50JywgJ3RveGljJ10sXG4gICAgICB9LFxuICAgIF0sXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgcGFnZTogMSxcbiAgICAgIGxpbWl0OiAxMCxcbiAgICAgIHRvdGFsOiAyLFxuICAgICAgdG90YWxQYWdlczogMSxcbiAgICB9LFxuICAgIHN1bW1hcnk6IHtcbiAgICAgIHRvdGFsRmxhZ2dlZDogMixcbiAgICAgIHBlbmRpbmdSZXZpZXc6IDIsXG4gICAgICBhcHByb3ZlZDogMCxcbiAgICAgIHJlbW92ZWQ6IDAsXG4gICAgICBoaWdoUHJpb3JpdHk6IDEsXG4gICAgICBtZWRpdW1Qcmlvcml0eTogMSxcbiAgICAgIGxvd1ByaW9yaXR5OiAwLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgbW9ja01vZGVyYXRpb25TZXJ2aWNlSGVhbHRoID0ge1xuICAgIHN0YXR1czogJ2hlYWx0aHknLFxuICAgIHVwdGltZTogMzYwMDAwMCwgLy8gMSBob3VyXG4gICAgbGFzdENoZWNrOiBuZXcgRGF0ZSgpLFxuICAgIHNlcnZpY2VzOiB7XG4gICAgICBhaV9jbGFzc2lmaWVyOiB7IHN0YXR1czogJ2hlYWx0aHknLCByZXNwb25zZVRpbWU6IDEyMCB9LFxuICAgICAgY3Jpc2lzX2RldGVjdG9yOiB7IHN0YXR1czogJ2hlYWx0aHknLCByZXNwb25zZVRpbWU6IDk1IH0sXG4gICAgICB0b3hpY2l0eV9maWx0ZXI6IHsgc3RhdHVzOiAnaGVhbHRoeScsIHJlc3BvbnNlVGltZTogODAgfSxcbiAgICB9LFxuICAgIHZlcnNpb246ICcxLjIuMycsXG4gICAgY2FwYWJpbGl0aWVzOiBbXG4gICAgICAndGV4dF9jbGFzc2lmaWNhdGlvbicsXG4gICAgICAnY3Jpc2lzX2RldGVjdGlvbicsXG4gICAgICAndG94aWNpdHlfZmlsdGVyaW5nJyxcbiAgICAgICdiYXRjaF9wcm9jZXNzaW5nJyxcbiAgICBdLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tNb2RlcmF0aW9uU3RhdHMgPSB7XG4gICAgdG90YWxQcm9jZXNzZWQ6IDE1NDIwLFxuICAgIHRvZGF5OiB7XG4gICAgICBwcm9jZXNzZWQ6IDIzNCxcbiAgICAgIGZsYWdnZWQ6IDIzLFxuICAgICAgY3Jpc2lzOiAzLFxuICAgICAgYXBwcm92ZWQ6IDE4NixcbiAgICAgIHJlbW92ZWQ6IDI1LFxuICAgIH0sXG4gICAgdGhpc1dlZWs6IHtcbiAgICAgIHByb2Nlc3NlZDogMTY1NCxcbiAgICAgIGZsYWdnZWQ6IDE1NixcbiAgICAgIGNyaXNpczogMTgsXG4gICAgICBhcHByb3ZlZDogMTI0NSxcbiAgICAgIHJlbW92ZWQ6IDIzNSxcbiAgICB9LFxuICAgIGFjY3VyYWN5OiB7XG4gICAgICBvdmVyYWxsOiA5NC43LFxuICAgICAgY3Jpc2lzX2RldGVjdGlvbjogOTguMixcbiAgICAgIHRveGljaXR5X2RldGVjdGlvbjogOTIuMSxcbiAgICAgIGZhbHNlX3Bvc2l0aXZlczogMy44LFxuICAgICAgZmFsc2VfbmVnYXRpdmVzOiAxLjUsXG4gICAgfSxcbiAgICBwZXJmb3JtYW5jZToge1xuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogODUsIC8vIG1zXG4gICAgICB0aHJvdWdocHV0OiAxNTAsIC8vIHJlcXVlc3RzIHBlciBtaW51dGVcbiAgICAgIGVycm9yUmF0ZTogMC4yLCAvLyBwZXJjZW50YWdlXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQgPSB7XG4gICAgY29uZmlkZW5jZTogMC44NyxcbiAgICBjYXRlZ29yaWVzOiBbJ2luYXBwcm9wcmlhdGUnLCAnb2ZmZW5zaXZlJ10sXG4gICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxuICAgIHNob3VsZEZsYWc6IHRydWUsXG4gICAgY3Jpc2lzTGV2ZWw6ICdub25lJyxcbiAgICBpbW1lZGlhdGVFc2NhbGF0aW9uOiBmYWxzZSxcbiAgICBleHBsYW5hdGlvbjogJ0NvbnRlbnQgY29udGFpbnMgaW5hcHByb3ByaWF0ZSBsYW5ndWFnZSBhbmQgb2ZmZW5zaXZlIHJlbWFya3MnLFxuICAgIHN1Z2dlc3RlZEFjdGlvbjogJ2ZsYWdfZm9yX3JldmlldycsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIHByb2Nlc3NpbmdUaW1lOiAxMjAsXG4gICAgICBtb2RlbFZlcnNpb246ICcyLjEuMCcsXG4gICAgICBjb25maWRlbmNlX2JyZWFrZG93bjoge1xuICAgICAgICBpbmFwcHJvcHJpYXRlOiAwLjg5LFxuICAgICAgICBvZmZlbnNpdmU6IDAuODUsXG4gICAgICAgIGhhcmFzc21lbnQ6IDAuMTIsXG4gICAgICAgIHRveGljOiAwLjM0LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIG1vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW0FkbWluTW9kZXJhdGlvbkNvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBBZG1pblNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tBZG1pblNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBNb2RlcmF0aW9uU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja01vZGVyYXRpb25TZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KVxuICAgICAgLm92ZXJyaWRlR3VhcmQoSnd0QXV0aEd1YXJkKVxuICAgICAgLnVzZVZhbHVlKG1vY2tKd3RBdXRoR3VhcmQpXG4gICAgICAub3ZlcnJpZGVHdWFyZChBZG1pbkF1dGhHdWFyZClcbiAgICAgIC51c2VWYWx1ZShtb2NrQWRtaW5BdXRoR3VhcmQpXG4gICAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8QWRtaW5Nb2RlcmF0aW9uQ29udHJvbGxlcj4oQWRtaW5Nb2RlcmF0aW9uQ29udHJvbGxlcik7XG4gICAgYWRtaW5TZXJ2aWNlID0gbW9kdWxlLmdldDxBZG1pblNlcnZpY2U+KEFkbWluU2VydmljZSk7XG4gICAgbW9kZXJhdGlvblNlcnZpY2UgPSBtb2R1bGUuZ2V0PE1vZGVyYXRpb25TZXJ2aWNlPihNb2RlcmF0aW9uU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb250cm9sbGVyIEluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGFkbWluU2VydmljZSBhbmQgbW9kZXJhdGlvblNlcnZpY2UgaW5qZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vZGVyYXRpb25TZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgR3VhcmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgcHJvdGVjdGVkIGJ5IEp3dEF1dGhHdWFyZCBhbmQgQWRtaW5BdXRoR3VhcmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBndWFyZHMgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdfX2d1YXJkc19fJywgQWRtaW5Nb2RlcmF0aW9uQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoZ3VhcmRzKS50b0NvbnRhaW4oSnd0QXV0aEd1YXJkKTtcbiAgICAgIGV4cGVjdChndWFyZHMpLnRvQ29udGFpbihBZG1pbkF1dGhHdWFyZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgcHJvcGVyIHJvdXRlIGRlY29yYXRvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250cm9sbGVyTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdwYXRoJywgQWRtaW5Nb2RlcmF0aW9uQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoY29udHJvbGxlck1ldGFkYXRhKS50b0JlKCdhZG1pbi9tb2RlcmF0aW9uJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgQWRtaW5Pbmx5IGRlY29yYXRvcnMgb24gYWxsIG1ldGhvZHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRob2RzID0gW1xuICAgICAgICAnZ2V0RmxhZ2dlZENvbnRlbnQnLFxuICAgICAgICAnbW9kZXJhdGVDb250ZW50JyxcbiAgICAgICAgJ2dldFNlcnZpY2VIZWFsdGhTdGF0dXMnLFxuICAgICAgICAnZ2V0U2VydmljZVN0YXRzJyxcbiAgICAgICAgJ3Rlc3RDbGFzc2lmaWNhdGlvbicsXG4gICAgICAgICd0ZXN0Q3Jpc2lzRGV0ZWN0aW9uJyxcbiAgICAgICAgJ3Rlc3RCYXRjaENsYXNzaWZpY2F0aW9uJyxcbiAgICAgIF07XG4gICAgICBcbiAgICAgIG1ldGhvZHMuZm9yRWFjaChtZXRob2QgPT4ge1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ2FkbWluX29ubHknLCBjb250cm9sbGVyW21ldGhvZCBhcyBrZXlvZiBBZG1pbk1vZGVyYXRpb25Db250cm9sbGVyXSk7XG4gICAgICAgIGV4cGVjdChtZXRhZGF0YSkudG9CZVRydXRoeSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHRVQgL2FkbWluL21vZGVyYXRpb24vZmxhZ2dlZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBmbGFnZ2VkIGNvbnRlbnQgd2l0aCBkZWZhdWx0IHBhZ2luYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmdldEZsYWdnZWRDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tGbGFnZ2VkQ29udGVudCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0RmxhZ2dlZENvbnRlbnQoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0ZsYWdnZWRDb250ZW50KTtcbiAgICAgIGV4cGVjdChhZG1pblNlcnZpY2UuZ2V0RmxhZ2dlZENvbnRlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdHlwZTogdW5kZWZpbmVkLFxuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBsaW1pdDogMTAsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IGZsYWdnZWQgY29udGVudCB3aXRoIGN1c3RvbSBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FkbWluU2VydmljZS5nZXRGbGFnZ2VkQ29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmxhZ2dlZENvbnRlbnQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldEZsYWdnZWRDb250ZW50KFRFU1RfVVNFUl9JRFMuQURNSU4sICdwb3N0JywgJzInLCAnMjAnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrRmxhZ2dlZENvbnRlbnQpO1xuICAgICAgZXhwZWN0KGFkbWluU2VydmljZS5nZXRGbGFnZ2VkQ29udGVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0eXBlOiAncG9zdCcsXG4gICAgICAgIHBhZ2U6IDIsXG4gICAgICAgIGxpbWl0OiAyMCxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgY29udGVudCB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudFR5cGVzID0gWydwb3N0JywgJ2NvbW1lbnQnLCAnbWVzc2FnZScsICdwcm9maWxlJ107XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgdHlwZSBvZiBjb250ZW50VHlwZXMpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyZWRDb250ZW50ID0ge1xuICAgICAgICAgIC4uLm1vY2tGbGFnZ2VkQ29udGVudCxcbiAgICAgICAgICBjb250ZW50OiBtb2NrRmxhZ2dlZENvbnRlbnQuY29udGVudC5maWx0ZXIoaXRlbSA9PiBpdGVtLnR5cGUgPT09IHR5cGUpLFxuICAgICAgICB9O1xuICAgICAgICBtb2NrQWRtaW5TZXJ2aWNlLmdldEZsYWdnZWRDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKGZpbHRlcmVkQ29udGVudCk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRGbGFnZ2VkQ29udGVudChURVNUX1VTRVJfSURTLkFETUlOLCB0eXBlKTtcblxuICAgICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLmdldEZsYWdnZWRDb250ZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHR5cGUgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgcGFnaW5hdGlvbiBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FkbWluU2VydmljZS5nZXRGbGFnZ2VkQ29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmxhZ2dlZENvbnRlbnQpO1xuXG4gICAgICAvLyBUZXN0IHdpdGggaW52YWxpZCBzdHJpbmcgdmFsdWVzIHRoYXQgc2hvdWxkIGJlIGNvbnZlcnRlZFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRGbGFnZ2VkQ29udGVudChURVNUX1VTRVJfSURTLkFETUlOLCB1bmRlZmluZWQsICdpbnZhbGlkJywgJ2ludmFsaWQnKTtcblxuICAgICAgZXhwZWN0KGFkbWluU2VydmljZS5nZXRGbGFnZ2VkQ29udGVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0eXBlOiB1bmRlZmluZWQsXG4gICAgICAgIHBhZ2U6IE5hTixcbiAgICAgICAgbGltaXQ6IE5hTixcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgZmxhZ2dlZCBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW1wdHlDb250ZW50ID0ge1xuICAgICAgICBjb250ZW50OiBbXSxcbiAgICAgICAgcGFnaW5hdGlvbjogeyBwYWdlOiAxLCBsaW1pdDogMTAsIHRvdGFsOiAwLCB0b3RhbFBhZ2VzOiAwIH0sXG4gICAgICAgIHN1bW1hcnk6IHsgdG90YWxGbGFnZ2VkOiAwLCBwZW5kaW5nUmV2aWV3OiAwLCBhcHByb3ZlZDogMCwgcmVtb3ZlZDogMCwgaGlnaFByaW9yaXR5OiAwLCBtZWRpdW1Qcmlvcml0eTogMCwgbG93UHJpb3JpdHk6IDAgfSxcbiAgICAgIH07XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmdldEZsYWdnZWRDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKGVtcHR5Q29udGVudCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0RmxhZ2dlZENvbnRlbnQoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGVudCkudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdW1tYXJ5LnRvdGFsRmxhZ2dlZCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBxdWVyeSBmYWlsZWQnKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZ2V0RmxhZ2dlZENvbnRlbnQubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0RmxhZ2dlZENvbnRlbnQoVEVTVF9VU0VSX0lEUy5BRE1JTikpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldEZsYWdnZWRDb250ZW50KFRFU1RfVVNFUl9JRFMuQURNSU4pKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byByZXRyaWV2ZSBmbGFnZ2VkIGNvbnRlbnQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGFkbWluIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dTcHkgPSBqZXN0LnNweU9uKGNvbnRyb2xsZXJbJ2xvZ2dlciddLCAnbG9nJyk7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLmdldEZsYWdnZWRDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tGbGFnZ2VkQ29udGVudCk7XG5cbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZ2V0RmxhZ2dlZENvbnRlbnQoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG5cbiAgICAgIGV4cGVjdChsb2dTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGBBZG1pbiAke1RFU1RfVVNFUl9JRFMuQURNSU59IHJldHJpZXZpbmcgZmxhZ2dlZCBjb250ZW50YCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQVVQgL2FkbWluL21vZGVyYXRpb24vOmNvbnRlbnRUeXBlLzpjb250ZW50SWQvbW9kZXJhdGUnLCAoKSA9PiB7XG4gICAgY29uc3QgY29udGVudFR5cGUgPSAncG9zdCc7XG4gICAgY29uc3QgY29udGVudElkID0gJ3Bvc3RfMTIzNDU2Nzg5JztcbiAgICBjb25zdCBtb2RlcmF0aW9uRGF0YSA9IHtcbiAgICAgIGFjdGlvbjogJ3JlbW92ZScgYXMgY29uc3QsXG4gICAgICByZWFzb246ICdWaW9sYXRlcyBjb21tdW5pdHkgZ3VpZGVsaW5lcycsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgbW9kZXJhdGUgY29udGVudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2RlcmF0ZWRDb250ZW50ID0ge1xuICAgICAgICBpZDogY29udGVudElkLFxuICAgICAgICB0eXBlOiBjb250ZW50VHlwZSxcbiAgICAgICAgc3RhdHVzOiAncmVtb3ZlZCcsXG4gICAgICAgIG1vZGVyYXRlZEJ5OiBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICBtb2RlcmF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgYWN0aW9uOiBtb2RlcmF0aW9uRGF0YS5hY3Rpb24sXG4gICAgICAgIHJlYXNvbjogbW9kZXJhdGlvbkRhdGEucmVhc29uLFxuICAgICAgfTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UubW9kZXJhdGVDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vZGVyYXRlZENvbnRlbnQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLm1vZGVyYXRlQ29udGVudChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICAgY29udGVudFR5cGUsXG4gICAgICAgIGNvbnRlbnRJZCxcbiAgICAgICAgbW9kZXJhdGlvbkRhdGFcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9kZXJhdGVkQ29udGVudCk7XG4gICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLm1vZGVyYXRlQ29udGVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGNvbnRlbnRUeXBlLFxuICAgICAgICBjb250ZW50SWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgIG1vZGVyYXRpb25EYXRhLmFjdGlvbixcbiAgICAgICAgbW9kZXJhdGlvbkRhdGEucmVhc29uXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYWxsIG1vZGVyYXRpb24gYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFjdGlvbnMgPSBbJ2FwcHJvdmUnLCAncmVtb3ZlJywgJ2ZsYWcnXSBhcyBjb25zdDtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBhY3Rpb24gb2YgYWN0aW9ucykge1xuICAgICAgICBjb25zdCBkYXRhID0geyBhY3Rpb24sIHJlYXNvbjogYFRlc3QgJHthY3Rpb259IGFjdGlvbmAgfTtcbiAgICAgICAgY29uc3QgbW9kZXJhdGVkQ29udGVudCA9IHtcbiAgICAgICAgICBpZDogY29udGVudElkLFxuICAgICAgICAgIHR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgICAgIHN0YXR1czogYWN0aW9uID09PSAnYXBwcm92ZScgPyAnYXBwcm92ZWQnIDogYWN0aW9uID09PSAncmVtb3ZlJyA/ICdyZW1vdmVkJyA6ICdmbGFnZ2VkJyxcbiAgICAgICAgICBhY3Rpb24sXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tBZG1pblNlcnZpY2UubW9kZXJhdGVDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vZGVyYXRlZENvbnRlbnQpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubW9kZXJhdGVDb250ZW50KFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgICAgY29udGVudFR5cGUsXG4gICAgICAgICAgY29udGVudElkLFxuICAgICAgICAgIGRhdGFcbiAgICAgICAgKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LmFjdGlvbikudG9CZShhY3Rpb24pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlmZmVyZW50IGNvbnRlbnQgdHlwZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZW50VHlwZXMgPSBbJ3Bvc3QnLCAnY29tbWVudCcsICdtZXNzYWdlJywgJ3Byb2ZpbGUnXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCB0eXBlIG9mIGNvbnRlbnRUeXBlcykge1xuICAgICAgICBjb25zdCBtb2RlcmF0ZWRDb250ZW50ID0ge1xuICAgICAgICAgIGlkOiBjb250ZW50SWQsXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICBzdGF0dXM6ICdhcHByb3ZlZCcsXG4gICAgICAgICAgYWN0aW9uOiAnYXBwcm92ZScsXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tBZG1pblNlcnZpY2UubW9kZXJhdGVDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vZGVyYXRlZENvbnRlbnQpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubW9kZXJhdGVDb250ZW50KFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICBjb250ZW50SWQsXG4gICAgICAgICAgeyBhY3Rpb246ICdhcHByb3ZlJyB9XG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC50eXBlKS50b0JlKHR5cGUpO1xuICAgICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLm1vZGVyYXRlQ29udGVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICBjb250ZW50SWQsXG4gICAgICAgICAgVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICAgICAnYXBwcm92ZScsXG4gICAgICAgICAgdW5kZWZpbmVkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtb2RlcmF0aW9uIHdpdGhvdXQgcmVhc29uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGF0YVdpdGhvdXRSZWFzb24gPSB7IGFjdGlvbjogJ2FwcHJvdmUnIGFzIGNvbnN0IH07XG4gICAgICBjb25zdCBtb2RlcmF0ZWRDb250ZW50ID0ge1xuICAgICAgICBpZDogY29udGVudElkLFxuICAgICAgICB0eXBlOiBjb250ZW50VHlwZSxcbiAgICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgICBhY3Rpb246ICdhcHByb3ZlJyxcbiAgICAgIH07XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLm1vZGVyYXRlQ29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2RlcmF0ZWRDb250ZW50KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5tb2RlcmF0ZUNvbnRlbnQoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgIGNvbnRlbnRUeXBlLFxuICAgICAgICBjb250ZW50SWQsXG4gICAgICAgIGRhdGFXaXRob3V0UmVhc29uXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vZGVyYXRlZENvbnRlbnQpO1xuICAgICAgZXhwZWN0KGFkbWluU2VydmljZS5tb2RlcmF0ZUNvbnRlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjb250ZW50VHlwZSxcbiAgICAgICAgY29udGVudElkLFxuICAgICAgICBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICAnYXBwcm92ZScsXG4gICAgICAgIHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbnRlbnQgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignQ29udGVudCBub3QgZm91bmQnKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UubW9kZXJhdGVDb250ZW50Lm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIubW9kZXJhdGVDb250ZW50KFRFU1RfVVNFUl9JRFMuQURNSU4sIGNvbnRlbnRUeXBlLCAnbm9uLWV4aXN0ZW50LWlkJywgbW9kZXJhdGlvbkRhdGEpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbG9nIGFkbWluIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dTcHkgPSBqZXN0LnNweU9uKGNvbnRyb2xsZXJbJ2xvZ2dlciddLCAnbG9nJyk7XG4gICAgICBjb25zdCBtb2RlcmF0ZWRDb250ZW50ID0geyBpZDogY29udGVudElkLCBzdGF0dXM6ICdyZW1vdmVkJyB9O1xuICAgICAgbW9ja0FkbWluU2VydmljZS5tb2RlcmF0ZUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUobW9kZXJhdGVkQ29udGVudCk7XG5cbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIubW9kZXJhdGVDb250ZW50KFRFU1RfVVNFUl9JRFMuQURNSU4sIGNvbnRlbnRUeXBlLCBjb250ZW50SWQsIG1vZGVyYXRpb25EYXRhKTtcblxuICAgICAgZXhwZWN0KGxvZ1NweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoYEFkbWluICR7VEVTVF9VU0VSX0lEUy5BRE1JTn0gbW9kZXJhdGluZyAke2NvbnRlbnRUeXBlfSAke2NvbnRlbnRJZH1gKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYWRtaW4vbW9kZXJhdGlvbi9zZXJ2aWNlL2hlYWx0aCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBzZXJ2aWNlIGhlYWx0aCBzdGF0dXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmhlYWx0aENoZWNrLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0aW9uU2VydmljZUhlYWx0aCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0U2VydmljZUhlYWx0aFN0YXR1cygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNb2RlcmF0aW9uU2VydmljZUhlYWx0aCk7XG4gICAgICBleHBlY3QobW9kZXJhdGlvblNlcnZpY2UuaGVhbHRoQ2hlY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGhlYWx0aCByZXNwb25zZSBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTW9kZXJhdGlvblNlcnZpY2UuaGVhbHRoQ2hlY2subW9ja1Jlc29sdmVkVmFsdWUobW9ja01vZGVyYXRpb25TZXJ2aWNlSGVhbHRoKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRTZXJ2aWNlSGVhbHRoU3RhdHVzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdzdGF0dXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd1cHRpbWUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdzZXJ2aWNlcycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NhcGFiaWxpdGllcycpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LmNhcGFiaWxpdGllcykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC51cHRpbWUpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5oZWFsdGh5IHNlcnZpY2Ugc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdW5oZWFsdGh5U3RhdHVzID0ge1xuICAgICAgICAuLi5tb2NrTW9kZXJhdGlvblNlcnZpY2VIZWFsdGgsXG4gICAgICAgIHN0YXR1czogJ3VuaGVhbHRoeScsXG4gICAgICAgIHNlcnZpY2VzOiB7XG4gICAgICAgICAgYWlfY2xhc3NpZmllcjogeyBzdGF0dXM6ICd1bmhlYWx0aHknLCByZXNwb25zZVRpbWU6IDUwMDAsIGVycm9yOiAnVGltZW91dCcgfSxcbiAgICAgICAgICBjcmlzaXNfZGV0ZWN0b3I6IHsgc3RhdHVzOiAnaGVhbHRoeScsIHJlc3BvbnNlVGltZTogOTUgfSxcbiAgICAgICAgICB0b3hpY2l0eV9maWx0ZXI6IHsgc3RhdHVzOiAnZGVncmFkZWQnLCByZXNwb25zZVRpbWU6IDgwMCB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5oZWFsdGhDaGVjay5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmhlYWx0aHlTdGF0dXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFNlcnZpY2VIZWFsdGhTdGF0dXMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoJ3VuaGVhbHRoeScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZXJ2aWNlcy5haV9jbGFzc2lmaWVyLnN0YXR1cykudG9CZSgndW5oZWFsdGh5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignSGVhbHRoIGNoZWNrIGZhaWxlZCcpO1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmhlYWx0aENoZWNrLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFNlcnZpY2VIZWFsdGhTdGF0dXMoKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0U2VydmljZUhlYWx0aFN0YXR1cygpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBnZXQgbW9kZXJhdGlvbiBzZXJ2aWNlIGhlYWx0aCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hZG1pbi9tb2RlcmF0aW9uL3NlcnZpY2Uvc3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgc2VydmljZSBzdGF0aXN0aWNzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5nZXRTdGF0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdGlvblN0YXRzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRTZXJ2aWNlU3RhdHMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTW9kZXJhdGlvblN0YXRzKTtcbiAgICAgIGV4cGVjdChtb2RlcmF0aW9uU2VydmljZS5nZXRTdGF0cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgc3RhdHMgcmVzcG9uc2Ugc3RydWN0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmdldFN0YXRzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0aW9uU3RhdHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFNlcnZpY2VTdGF0cygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndG90YWxQcm9jZXNzZWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd0b2RheScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3RoaXNXZWVrJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnYWNjdXJhY3knKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdwZXJmb3JtYW5jZScpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQudG90YWxQcm9jZXNzZWQpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuYWNjdXJhY3kub3ZlcmFsbCkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5wZXJmb3JtYW5jZS5hdmVyYWdlUmVzcG9uc2VUaW1lKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbXB0eVN0YXRzID0ge1xuICAgICAgICB0b3RhbFByb2Nlc3NlZDogMCxcbiAgICAgICAgdG9kYXk6IHsgcHJvY2Vzc2VkOiAwLCBmbGFnZ2VkOiAwLCBjcmlzaXM6IDAsIGFwcHJvdmVkOiAwLCByZW1vdmVkOiAwIH0sXG4gICAgICAgIHRoaXNXZWVrOiB7IHByb2Nlc3NlZDogMCwgZmxhZ2dlZDogMCwgY3Jpc2lzOiAwLCBhcHByb3ZlZDogMCwgcmVtb3ZlZDogMCB9LFxuICAgICAgICBhY2N1cmFjeTogeyBvdmVyYWxsOiAwLCBjcmlzaXNfZGV0ZWN0aW9uOiAwLCB0b3hpY2l0eV9kZXRlY3Rpb246IDAsIGZhbHNlX3Bvc2l0aXZlczogMCwgZmFsc2VfbmVnYXRpdmVzOiAwIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7IGF2ZXJhZ2VSZXNwb25zZVRpbWU6IDAsIHRocm91Z2hwdXQ6IDAsIGVycm9yUmF0ZTogMCB9LFxuICAgICAgfTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5nZXRTdGF0cy5tb2NrUmVzb2x2ZWRWYWx1ZShlbXB0eVN0YXRzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRTZXJ2aWNlU3RhdHMoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFByb2Nlc3NlZCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG9kYXkucHJvY2Vzc2VkKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ1N0YXRzIHNlcnZpY2UgdW5hdmFpbGFibGUnKTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5nZXRTdGF0cy5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRTZXJ2aWNlU3RhdHMoKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUE9TVCAvYWRtaW4vbW9kZXJhdGlvbi9zZXJ2aWNlL3Rlc3QtY2xhc3NpZnknLCAoKSA9PiB7XG4gICAgY29uc3QgdGVzdERhdGEgPSB7XG4gICAgICB0ZXh0OiAnVGhpcyBpcyB0ZXN0IGNvbnRlbnQgdGhhdCBtaWdodCBiZSBpbmFwcHJvcHJpYXRlJyxcbiAgICAgIGNvbnRleHQ6ICdjb21tdW5pdHlfcG9zdCcsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgdGVzdCBjb250ZW50IGNsYXNzaWZpY2F0aW9uIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jbGFzc2lmeUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsYXNzaWZpY2F0aW9uUmVzdWx0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci50ZXN0Q2xhc3NpZmljYXRpb24oVEVTVF9VU0VSX0lEUy5BRE1JTiwgdGVzdERhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdCkudG9FcXVhbChtb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0SW5mby50ZXN0ZWRCeSkudG9CZShURVNUX1VTRVJfSURTLkFETUlOKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGVzdEluZm8uaW5wdXRUZXh0KS50b0JlKHRlc3REYXRhLnRleHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0SW5mby5pbnB1dENvbnRleHQpLnRvQmUodGVzdERhdGEuY29udGV4dCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkaWZmZXJlbnQgY29udGVudCB0eXBlcyBmb3IgY2xhc3NpZmljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZW50VHlwZXMgPSBbJ2NvbW11bml0eV9wb3N0JywgJ3ByaXZhdGVfbWVzc2FnZScsICdwcm9maWxlX3RleHQnLCAnY29tbWVudCddO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGNvbnRleHQgb2YgY29udGVudFR5cGVzKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7IC4uLnRlc3REYXRhLCBjb250ZXh0IH07XG4gICAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jbGFzc2lmeUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NsYXNzaWZpY2F0aW9uUmVzdWx0KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnRlc3RDbGFzc2lmaWNhdGlvbihURVNUX1VTRVJfSURTLkFETUlOLCBkYXRhKTtcblxuICAgICAgICBleHBlY3QobW9kZXJhdGlvblNlcnZpY2UuY2xhc3NpZnlDb250ZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBkYXRhLnRleHQsXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgY29udGV4dDogZGF0YS5jb250ZXh0LFxuICAgICAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkFETUlOLFxuICAgICAgICAgICAgdXNlclJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZhcmlvdXMgdGV4dCBjb250ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFRleHRzID0gW1xuICAgICAgICAnVGhpcyBpcyBhcHByb3ByaWF0ZSBjb250ZW50JyxcbiAgICAgICAgJ1RoaXMgY29udGVudCBjb250YWlucyBtaWxkIHByb2Zhbml0eScsXG4gICAgICAgICdUaGlzIGNvbnRlbnQgaXMgZXh0cmVtZWx5IGluYXBwcm9wcmlhdGUgYW5kIG9mZmVuc2l2ZScsXG4gICAgICAgICdIZWxwIG1lLCBJIGFtIGluIGNyaXNpcycsXG4gICAgICAgICdOb3JtYWwgdGhlcmFwZXV0aWMgZGlzY3Vzc2lvbiBhYm91dCBhbnhpZXR5JyxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGV4dCBvZiB0ZXN0VGV4dHMpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHsgdGV4dCwgY29udGV4dDogJ2NvbW11bml0eV9wb3N0JyB9O1xuICAgICAgICBjb25zdCBjbGFzc2lmaWNhdGlvblJlc3VsdCA9IHtcbiAgICAgICAgICAuLi5tb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQsXG4gICAgICAgICAgc2V2ZXJpdHk6IHRleHQuaW5jbHVkZXMoJ2NyaXNpcycpID8gJ2hpZ2gnIDogdGV4dC5pbmNsdWRlcygnaW5hcHByb3ByaWF0ZScpID8gJ21lZGl1bScgOiAnbG93JyxcbiAgICAgICAgICBjcmlzaXNMZXZlbDogdGV4dC5pbmNsdWRlcygnY3Jpc2lzJykgPyAnaGlnaCcgOiAnbm9uZScsXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jbGFzc2lmeUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUoY2xhc3NpZmljYXRpb25SZXN1bHQpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudGVzdENsYXNzaWZpY2F0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIGRhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0LnNldmVyaXR5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnRlc3RJbmZvLmlucHV0VGV4dCkudG9CZSh0ZXh0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNsYXNzaWZpY2F0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uRXJyb3IgPSBuZXcgRXJyb3IoJ0FJIHNlcnZpY2UgdW5hdmFpbGFibGUnKTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jbGFzc2lmeUNvbnRlbnQubW9ja1JlamVjdGVkVmFsdWUoY2xhc3NpZmljYXRpb25FcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci50ZXN0Q2xhc3NpZmljYXRpb24oVEVTVF9VU0VSX0lEUy5BRE1JTiwgdGVzdERhdGEpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2FkbWluL21vZGVyYXRpb24vc2VydmljZS90ZXN0LWNyaXNpcycsICgpID0+IHtcbiAgICBjb25zdCBjcmlzaXNUZXN0RGF0YSA9IHtcbiAgICAgIHRleHQ6ICdJIGFtIGhhdmluZyB0aG91Z2h0cyBvZiBzZWxmLWhhcm0gYW5kIG5lZWQgaGVscCcsXG4gICAgICBjb250ZXh0OiAncHJpdmF0ZV9tZXNzYWdlJyxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCB0ZXN0IGNyaXNpcyBkZXRlY3Rpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3Jpc2lzUmVzdWx0ID0ge1xuICAgICAgICAuLi5tb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQsXG4gICAgICAgIGNyaXNpc0xldmVsOiAnaGlnaCcsXG4gICAgICAgIGltbWVkaWF0ZUVzY2FsYXRpb246IHRydWUsXG4gICAgICB9O1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmNoZWNrQ3Jpc2lzQ29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jbGFzc2lmeUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUoY3Jpc2lzUmVzdWx0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci50ZXN0Q3Jpc2lzRGV0ZWN0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIGNyaXNpc1Rlc3REYXRhKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc0NyaXNpcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3Jpc2lzTGV2ZWwpLnRvQmUoJ2hpZ2gnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaW1tZWRpYXRlRXNjYWxhdGlvbikudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZnVsbFJlc3VsdCkudG9FcXVhbChjcmlzaXNSZXN1bHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0SW5mby50ZXN0ZWRCeSkudG9CZShURVNUX1VTRVJfSURTLkFETUlOKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1jcmlzaXMgY29udGVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vcm1hbFRlc3REYXRhID0ge1xuICAgICAgICB0ZXh0OiAnSSBhbSBmZWVsaW5nIGJldHRlciBhZnRlciBvdXIgc2Vzc2lvbicsXG4gICAgICAgIGNvbnRleHQ6ICdjb21tdW5pdHlfcG9zdCcsXG4gICAgICB9O1xuICAgICAgY29uc3Qgbm9ybWFsUmVzdWx0ID0ge1xuICAgICAgICAuLi5tb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQsXG4gICAgICAgIGNyaXNpc0xldmVsOiAnbm9uZScsXG4gICAgICAgIGltbWVkaWF0ZUVzY2FsYXRpb246IGZhbHNlLFxuICAgICAgfTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jaGVja0NyaXNpc0NvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmNsYXNzaWZ5Q29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShub3JtYWxSZXN1bHQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnRlc3RDcmlzaXNEZXRlY3Rpb24oVEVTVF9VU0VSX0lEUy5BRE1JTiwgbm9ybWFsVGVzdERhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzQ3Jpc2lzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3Jpc2lzTGV2ZWwpLnRvQmUoJ25vbmUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaW1tZWRpYXRlRXNjYWxhdGlvbikudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkaWZmZXJlbnQgY3Jpc2lzIGxldmVscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNyaXNpc0xldmVscyA9IFsnbm9uZScsICdsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnLCAnY3JpdGljYWwnXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBsZXZlbCBvZiBjcmlzaXNMZXZlbHMpIHtcbiAgICAgICAgY29uc3QgdGVzdERhdGEgPSB7IHRleHQ6IGBDcmlzaXMgbGV2ZWwgJHtsZXZlbH0gY29udGVudGAsIGNvbnRleHQ6ICdwcml2YXRlX21lc3NhZ2UnIH07XG4gICAgICAgIGNvbnN0IGlzQ3Jpc2lzID0gbGV2ZWwgIT09ICdub25lJztcbiAgICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICAgIC4uLm1vY2tDbGFzc2lmaWNhdGlvblJlc3VsdCxcbiAgICAgICAgICBjcmlzaXNMZXZlbDogbGV2ZWwsXG4gICAgICAgICAgaW1tZWRpYXRlRXNjYWxhdGlvbjogWydoaWdoJywgJ2NyaXRpY2FsJ10uaW5jbHVkZXMobGV2ZWwpLFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmNoZWNrQ3Jpc2lzQ29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShpc0NyaXNpcyk7XG4gICAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jbGFzc2lmeUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUocmVzdWx0KTtcblxuICAgICAgICBjb25zdCB0ZXN0UmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci50ZXN0Q3Jpc2lzRGV0ZWN0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIHRlc3REYXRhKTtcblxuICAgICAgICBleHBlY3QodGVzdFJlc3VsdC5jcmlzaXNMZXZlbCkudG9CZShsZXZlbCk7XG4gICAgICAgIGV4cGVjdCh0ZXN0UmVzdWx0LmlzQ3Jpc2lzKS50b0JlKGlzQ3Jpc2lzKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNyaXNpcyBkZXRlY3Rpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3Jpc2lzRXJyb3IgPSBuZXcgRXJyb3IoJ0NyaXNpcyBkZXRlY3Rpb24gc2VydmljZSBmYWlsZWQnKTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jaGVja0NyaXNpc0NvbnRlbnQubW9ja1JlamVjdGVkVmFsdWUoY3Jpc2lzRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIudGVzdENyaXNpc0RldGVjdGlvbihURVNUX1VTRVJfSURTLkFETUlOLCBjcmlzaXNUZXN0RGF0YSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUE9TVCAvYWRtaW4vbW9kZXJhdGlvbi9zZXJ2aWNlL3Rlc3QtYmF0Y2gnLCAoKSA9PiB7XG4gICAgY29uc3QgYmF0Y2hUZXN0RGF0YSA9IHtcbiAgICAgIGl0ZW1zOiBbXG4gICAgICAgIHsgdGV4dDogJ1RoaXMgaXMgYXBwcm9wcmlhdGUgY29udGVudCcsIGNvbnRleHQ6ICdjb21tdW5pdHlfcG9zdCcgfSxcbiAgICAgICAgeyB0ZXh0OiAnVGhpcyBjb250YWlucyBpbmFwcHJvcHJpYXRlIGxhbmd1YWdlJywgY29udGV4dDogJ2NvbW1lbnQnIH0sXG4gICAgICAgIHsgdGV4dDogJ0NyaXNpcyBjb250ZW50IHJlcXVpcmluZyBpbW1lZGlhdGUgYXR0ZW50aW9uJywgY29udGV4dDogJ3ByaXZhdGVfbWVzc2FnZScgfSxcbiAgICAgIF0sXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgdGVzdCBiYXRjaCBjbGFzc2lmaWNhdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBiYXRjaFJlc3VsdHMgPSBbXG4gICAgICAgIHsgLi4ubW9ja0NsYXNzaWZpY2F0aW9uUmVzdWx0LCBzZXZlcml0eTogJ2xvdycsIHNob3VsZEZsYWc6IGZhbHNlIH0sXG4gICAgICAgIHsgLi4ubW9ja0NsYXNzaWZpY2F0aW9uUmVzdWx0LCBzZXZlcml0eTogJ21lZGl1bScsIHNob3VsZEZsYWc6IHRydWUgfSxcbiAgICAgICAgeyAuLi5tb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQsIHNldmVyaXR5OiAnaGlnaCcsIHNob3VsZEZsYWc6IHRydWUsIGNyaXNpc0xldmVsOiAnaGlnaCcgfSxcbiAgICAgIF07XG4gICAgICBtb2NrTW9kZXJhdGlvblNlcnZpY2UuYmF0Y2hDbGFzc2lmeS5tb2NrUmVzb2x2ZWRWYWx1ZShiYXRjaFJlc3VsdHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnRlc3RCYXRjaENsYXNzaWZpY2F0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIGJhdGNoVGVzdERhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMpLnRvRXF1YWwoYmF0Y2hSZXN1bHRzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGVzdEluZm8udGVzdGVkQnkpLnRvQmUoVEVTVF9VU0VSX0lEUy5BRE1JTik7XG4gICAgICBleHBlY3QocmVzdWx0LnRlc3RJbmZvLml0ZW1Db3VudCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChtb2RlcmF0aW9uU2VydmljZS5iYXRjaENsYXNzaWZ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdGV4dDogYmF0Y2hUZXN0RGF0YS5pdGVtc1swXS50ZXh0LFxuICAgICAgICAgICAgY29udGV4dDogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBjb250ZXh0OiBiYXRjaFRlc3REYXRhLml0ZW1zWzBdLmNvbnRleHQsXG4gICAgICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5BRE1JTixcbiAgICAgICAgICAgICAgdXNlclJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgXSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBiYXRjaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtcHR5QmF0Y2ggPSB7IGl0ZW1zOiBbXSB9O1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmJhdGNoQ2xhc3NpZnkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnRlc3RCYXRjaENsYXNzaWZpY2F0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIGVtcHR5QmF0Y2gpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0SW5mby5pdGVtQ291bnQpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsYXJnZSBiYXRjaGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGFyZ2VCYXRjaCA9IHtcbiAgICAgICAgaXRlbXM6IEFycmF5LmZyb20oeyBsZW5ndGg6IDUwIH0sIChfLCBpKSA9PiAoe1xuICAgICAgICAgIHRleHQ6IGBUZXN0IGNvbnRlbnQgaXRlbSAke2kgKyAxfWAsXG4gICAgICAgICAgY29udGV4dDogJ2NvbW11bml0eV9wb3N0JyxcbiAgICAgICAgfSkpLFxuICAgICAgfTtcbiAgICAgIGNvbnN0IGxhcmdlQmF0Y2hSZXN1bHRzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNTAgfSwgKCkgPT4gbW9ja0NsYXNzaWZpY2F0aW9uUmVzdWx0KTtcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5iYXRjaENsYXNzaWZ5Lm1vY2tSZXNvbHZlZFZhbHVlKGxhcmdlQmF0Y2hSZXN1bHRzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci50ZXN0QmF0Y2hDbGFzc2lmaWNhdGlvbihURVNUX1VTRVJfSURTLkFETUlOLCBsYXJnZUJhdGNoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzKS50b0hhdmVMZW5ndGgoNTApO1xuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0SW5mby5pdGVtQ291bnQpLnRvQmUoNTApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmF0Y2ggcHJvY2Vzc2luZyBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBiYXRjaEVycm9yID0gbmV3IEVycm9yKCdCYXRjaCBwcm9jZXNzaW5nIGZhaWxlZCcpO1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmJhdGNoQ2xhc3NpZnkubW9ja1JlamVjdGVkVmFsdWUoYmF0Y2hFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci50ZXN0QmF0Y2hDbGFzc2lmaWNhdGlvbihURVNUX1VTRVJfSURTLkFETUlOLCBiYXRjaFRlc3REYXRhKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXhlZCBjb250ZW50IHR5cGVzIGluIGJhdGNoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWl4ZWRCYXRjaCA9IHtcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7IHRleHQ6ICdDb21tdW5pdHkgcG9zdCBjb250ZW50JywgY29udGV4dDogJ2NvbW11bml0eV9wb3N0JyB9LFxuICAgICAgICAgIHsgdGV4dDogJ1ByaXZhdGUgbWVzc2FnZSBjb250ZW50JywgY29udGV4dDogJ3ByaXZhdGVfbWVzc2FnZScgfSxcbiAgICAgICAgICB7IHRleHQ6ICdDb21tZW50IGNvbnRlbnQnLCBjb250ZXh0OiAnY29tbWVudCcgfSxcbiAgICAgICAgICB7IHRleHQ6ICdQcm9maWxlIGRlc2NyaXB0aW9uJywgY29udGV4dDogJ3Byb2ZpbGVfdGV4dCcgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG4gICAgICBjb25zdCBtaXhlZFJlc3VsdHMgPSBtaXhlZEJhdGNoLml0ZW1zLm1hcCgoKSA9PiBtb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQpO1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmJhdGNoQ2xhc3NpZnkubW9ja1Jlc29sdmVkVmFsdWUobWl4ZWRSZXN1bHRzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci50ZXN0QmF0Y2hDbGFzc2lmaWNhdGlvbihURVNUX1VTRVJfSURTLkFETUlOLCBtaXhlZEJhdGNoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzKS50b0hhdmVMZW5ndGgoNCk7XG4gICAgICBleHBlY3QobW9kZXJhdGlvblNlcnZpY2UuYmF0Y2hDbGFzc2lmeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW1xuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgY29udGV4dDogJ2NvbW11bml0eV9wb3N0JyB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBjb250ZXh0OiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGNvbnRleHQ6ICdwcml2YXRlX21lc3NhZ2UnIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgY29udGV4dDogJ2NvbW1lbnQnIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgY29udGV4dDogJ3Byb2ZpbGVfdGV4dCcgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSB1bmF2YWlsYWJsZSBzY2VuYXJpb3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ1NlcnZpY2UgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUnKTtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZ2V0RmxhZ2dlZENvbnRlbnQubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0RmxhZ2dlZENvbnRlbnQoVEVTVF9VU0VSX0lEUy5BRE1JTikpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIEFJIHNlcnZpY2UgaW50ZWdyYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWlTZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0FJIHNlcnZpY2UgdGltZW91dCcpO1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmNsYXNzaWZ5Q29udGVudC5tb2NrUmVqZWN0ZWRWYWx1ZShhaVNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci50ZXN0Q2xhc3NpZmljYXRpb24oVEVTVF9VU0VSX0lEUy5BRE1JTiwgeyB0ZXh0OiAndGVzdCcsIGNvbnRleHQ6ICd0ZXN0JyB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coSHR0cEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRiRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBtb2NrQWRtaW5TZXJ2aWNlLm1vZGVyYXRlQ29udGVudC5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLm1vZGVyYXRlQ29udGVudChURVNUX1VTRVJfSURTLkFETUlOLCAncG9zdCcsICdwb3N0XzEyMycsIHsgYWN0aW9uOiAnYXBwcm92ZScgfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzcG9uc2UgRm9ybWF0IFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIGZsYWdnZWQgY29udGVudCByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBZG1pblNlcnZpY2UuZ2V0RmxhZ2dlZENvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ZsYWdnZWRDb250ZW50KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRGbGFnZ2VkQ29udGVudChURVNUX1VTRVJfSURTLkFETUlOKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NvbnRlbnQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdwYWdpbmF0aW9uJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc3VtbWFyeScpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LmNvbnRlbnQpKS50b0JlKHRydWUpO1xuICAgICAgcmVzdWx0LmNvbnRlbnQuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBUZXN0QXNzZXJ0aW9ucy5leHBlY3RWYWxpZEVudGl0eShpdGVtLCBbJ2lkJywgJ3R5cGUnLCAnY29udGVudCcsICdhdXRob3JJZCcsICdmbGFnZ2VkQXQnXSk7XG4gICAgICAgIGV4cGVjdChbJ3BlbmRpbmcnLCAnYXBwcm92ZWQnLCAncmVtb3ZlZCddKS50b0NvbnRhaW4oaXRlbS5zdGF0dXMpO1xuICAgICAgICBleHBlY3QoWydsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnXSkudG9Db250YWluKGl0ZW0ucHJpb3JpdHkpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXJseSBmb3JtYXR0ZWQgaGVhbHRoIGNoZWNrIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmhlYWx0aENoZWNrLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0aW9uU2VydmljZUhlYWx0aCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0U2VydmljZUhlYWx0aFN0YXR1cygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc2VydmljZXMnKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnVwdGltZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBPYmplY3QudmFsdWVzKHJlc3VsdC5zZXJ2aWNlcykuZm9yRWFjaCgoc2VydmljZTogYW55KSA9PiB7XG4gICAgICAgIGV4cGVjdChzZXJ2aWNlKS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJyk7XG4gICAgICAgIGV4cGVjdChzZXJ2aWNlKS50b0hhdmVQcm9wZXJ0eSgncmVzcG9uc2VUaW1lJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3Blcmx5IGZvcm1hdHRlZCBjbGFzc2lmaWNhdGlvbiB0ZXN0IHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmNsYXNzaWZ5Q29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2xhc3NpZmljYXRpb25SZXN1bHQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnRlc3RDbGFzc2lmaWNhdGlvbihURVNUX1VTRVJfSURTLkFETUlOLCB7XG4gICAgICAgIHRleHQ6ICd0ZXN0JyxcbiAgICAgICAgY29udGV4dDogJ3Rlc3QnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyZXN1bHQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd0ZXN0SW5mbycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdjb25maWRlbmNlJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NhdGVnb3JpZXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc2V2ZXJpdHknKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnJlc3VsdC5jb25maWRlbmNlKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdC5yZXN1bHQuY2F0ZWdvcmllcykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBtb2RlcmF0aW9uIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2V0IGZsYWdnZWQgY29udGVudFxuICAgICAgbW9ja0FkbWluU2VydmljZS5nZXRGbGFnZ2VkQ29udGVudC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmxhZ2dlZENvbnRlbnQpO1xuICAgICAgY29uc3QgZmxhZ2dlZENvbnRlbnQgPSBhd2FpdCBjb250cm9sbGVyLmdldEZsYWdnZWRDb250ZW50KFRFU1RfVVNFUl9JRFMuQURNSU4pO1xuICAgICAgZXhwZWN0KGZsYWdnZWRDb250ZW50LmNvbnRlbnQpLnRvSGF2ZUxlbmd0aCgyKTtcblxuICAgICAgLy8gVGVzdCBjbGFzc2lmeSBjb250ZW50XG4gICAgICBtb2NrTW9kZXJhdGlvblNlcnZpY2UuY2xhc3NpZnlDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDbGFzc2lmaWNhdGlvblJlc3VsdCk7XG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGF3YWl0IGNvbnRyb2xsZXIudGVzdENsYXNzaWZpY2F0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIHtcbiAgICAgICAgdGV4dDogZmxhZ2dlZENvbnRlbnQuY29udGVudFswXS5jb250ZW50LFxuICAgICAgICBjb250ZXh0OiAnY29tbXVuaXR5X3Bvc3QnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoY2xhc3NpZmljYXRpb24ucmVzdWx0LnNob3VsZEZsYWcpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIE1vZGVyYXRlIGNvbnRlbnRcbiAgICAgIGNvbnN0IG1vZGVyYXRlZENvbnRlbnQgPSB7IGlkOiAncG9zdF8xMjMnLCBzdGF0dXM6ICdyZW1vdmVkJyB9O1xuICAgICAgbW9ja0FkbWluU2VydmljZS5tb2RlcmF0ZUNvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUobW9kZXJhdGVkQ29udGVudCk7XG4gICAgICBjb25zdCBtb2RlcmF0aW9uID0gYXdhaXQgY29udHJvbGxlci5tb2RlcmF0ZUNvbnRlbnQoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQURNSU4sXG4gICAgICAgICdwb3N0JyxcbiAgICAgICAgJ3Bvc3RfMTIzJyxcbiAgICAgICAgeyBhY3Rpb246ICdyZW1vdmUnLCByZWFzb246ICdJbmFwcHJvcHJpYXRlIGNvbnRlbnQnIH1cbiAgICAgICk7XG4gICAgICBleHBlY3QobW9kZXJhdGlvbi5zdGF0dXMpLnRvQmUoJ3JlbW92ZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgaGVhbHRoIG1vbml0b3Jpbmcgd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDaGVjayBzZXJ2aWNlIGhlYWx0aFxuICAgICAgbW9ja01vZGVyYXRpb25TZXJ2aWNlLmhlYWx0aENoZWNrLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNb2RlcmF0aW9uU2VydmljZUhlYWx0aCk7XG4gICAgICBjb25zdCBoZWFsdGggPSBhd2FpdCBjb250cm9sbGVyLmdldFNlcnZpY2VIZWFsdGhTdGF0dXMoKTtcbiAgICAgIGV4cGVjdChoZWFsdGguc3RhdHVzKS50b0JlKCdoZWFsdGh5Jyk7XG5cbiAgICAgIC8vIEdldCBzZXJ2aWNlIHN0YXRpc3RpY3NcbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5nZXRTdGF0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTW9kZXJhdGlvblN0YXRzKTtcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgY29udHJvbGxlci5nZXRTZXJ2aWNlU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFByb2Nlc3NlZCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICAvLyBUZXN0IGNyaXNpcyBkZXRlY3Rpb25cbiAgICAgIG1vY2tNb2RlcmF0aW9uU2VydmljZS5jaGVja0NyaXNpc0NvbnRlbnQubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrTW9kZXJhdGlvblNlcnZpY2UuY2xhc3NpZnlDb250ZW50Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0NsYXNzaWZpY2F0aW9uUmVzdWx0LFxuICAgICAgICBjcmlzaXNMZXZlbDogJ2hpZ2gnLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmlzaXNUZXN0ID0gYXdhaXQgY29udHJvbGxlci50ZXN0Q3Jpc2lzRGV0ZWN0aW9uKFRFU1RfVVNFUl9JRFMuQURNSU4sIHtcbiAgICAgICAgdGV4dDogJ0kgbmVlZCBoZWxwIHVyZ2VudGx5JyxcbiAgICAgICAgY29udGV4dDogJ3ByaXZhdGVfbWVzc2FnZScsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChjcmlzaXNUZXN0LmlzQ3Jpc2lzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==