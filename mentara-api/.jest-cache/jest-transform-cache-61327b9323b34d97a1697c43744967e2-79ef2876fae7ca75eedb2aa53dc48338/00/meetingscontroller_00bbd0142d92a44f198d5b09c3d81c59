8578d6a490f48692822ae7d7f5812b4b
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingsController = void 0;
const common_1 = require("@nestjs/common");
const meetings_service_1 = require("./meetings.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../auth/decorators/current-user-id.decorator");
const zod_validation_pipe_1 = require("../common/pipes/zod-validation.pipe");
const swagger_1 = require("@nestjs/swagger");
const mentara_commons_1 = require("mentara-commons");
let MeetingsController = class MeetingsController {
    meetingsService;
    constructor(meetingsService) {
        this.meetingsService = meetingsService;
    }
    async getMeeting(meetingId, userId) {
        return this.meetingsService.getMeetingById(meetingId, userId);
    }
    async updateMeetingStatus(meetingId, userId, updateStatusDto) {
        return this.meetingsService.updateMeetingStatus(meetingId, userId, updateStatusDto);
    }
    // ===== VIDEO CALL INTEGRATION ENDPOINTS =====
    async createVideoRoom(meetingId, userId, createRoomDto) {
        return this.meetingsService.createVideoRoom(meetingId, userId, createRoomDto);
    }
    async joinVideoRoom(meetingId, userId, joinRoomDto) {
        return this.meetingsService.joinVideoRoom(meetingId, userId, joinRoomDto);
    }
    async getVideoCallStatus(meetingId, userId) {
        return this.meetingsService.getVideoCallStatus(meetingId, userId);
    }
    async endVideoCall(meetingId, userId, endCallDto) {
        return this.meetingsService.endVideoCall(meetingId, userId, endCallDto);
    }
    // Legacy endpoint for backward compatibility
    async generateMeetingRoom(meetingId, userId) {
        // Redirect to new video room creation with default settings
        const defaultCreateDto = {
            meetingId,
            roomType: 'video',
            maxParticipants: 2,
            enableRecording: false,
            enableChat: true,
        };
        return this.meetingsService.createVideoRoom(meetingId, userId, defaultCreateDto);
    }
    async getUpcomingMeetings(userId, limit) {
        return this.meetingsService.getUpcomingMeetings(userId, limit);
    }
    async saveMeetingSession(meetingId, userId, sessionData) {
        // Validate user has access to this meeting
        await this.meetingsService.getMeetingById(meetingId, userId);
        return this.meetingsService.saveMeetingSession(meetingId, userId, sessionData);
    }
    async getTherapistMeetingAnalytics(userId, startDate, endDate) {
        const dateRange = startDate && endDate
            ? {
                start: new Date(startDate),
                end: new Date(endDate),
            }
            : undefined;
        return this.meetingsService.getMeetingAnalytics(userId, dateRange);
    }
    async emergencyTerminate(meetingId, userId, body) {
        return this.meetingsService.emergencyTerminateMeeting(meetingId, body.reason, userId);
    }
};
exports.MeetingsController = MeetingsController;
__decorate([
    (0, common_1.Get)(':id'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get meeting',
        description: 'Retrieve get meeting',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "getMeeting", null);
__decorate([
    (0, common_1.Put)(':id/status'),
    (0, swagger_1.ApiOperation)({
        summary: 'Update update meeting status',
        description: 'Update update meeting status',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Updated successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.UpdateMeetingStatusDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_b = typeof mentara_commons_1.UpdateMeetingStatusDto !== "undefined" && mentara_commons_1.UpdateMeetingStatusDto) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "updateMeetingStatus", null);
__decorate([
    (0, common_1.Post)(':id/video-room'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create create video room',
        description: 'Create create video room',
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.CreateVideoRoomDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_c = typeof mentara_commons_1.CreateVideoRoomDto !== "undefined" && mentara_commons_1.CreateVideoRoomDto) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], MeetingsController.prototype, "createVideoRoom", null);
__decorate([
    (0, common_1.Post)(':id/join-video'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create join video room',
        description: 'Create join video room',
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.JoinVideoRoomDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_e = typeof mentara_commons_1.JoinVideoRoomDto !== "undefined" && mentara_commons_1.JoinVideoRoomDto) === "function" ? _e : Object]),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], MeetingsController.prototype, "joinVideoRoom", null);
__decorate([
    (0, common_1.Get)(':id/video-status'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get video call status',
        description: 'Retrieve get video call status',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], MeetingsController.prototype, "getVideoCallStatus", null);
__decorate([
    (0, common_1.Delete)(':id/video-room'),
    (0, swagger_1.ApiOperation)({
        summary: 'Delete end video call',
        description: 'Delete end video call',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Deleted successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.NO_CONTENT),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.EndVideoCallDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_h = typeof mentara_commons_1.EndVideoCallDto !== "undefined" && mentara_commons_1.EndVideoCallDto) === "function" ? _h : Object]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], MeetingsController.prototype, "endVideoCall", null);
__decorate([
    (0, common_1.Post)(':id/room'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create generate meeting room',
        description: 'Create generate meeting room',
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "generateMeetingRoom", null);
__decorate([
    (0, common_1.Get)('upcoming'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get upcoming meetings',
        description: 'Retrieve get upcoming meetings',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)('limit')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Number]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "getUpcomingMeetings", null);
__decorate([
    (0, common_1.Post)(':id/session'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create save meeting session',
        description: 'Create save meeting session',
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.Body)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.SaveMeetingSessionDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_k = typeof mentara_commons_1.SaveMeetingSessionDto !== "undefined" && mentara_commons_1.SaveMeetingSessionDto) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "saveMeetingSession", null);
__decorate([
    (0, common_1.Get)('analytics/therapist'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get therapist meeting analytics',
        description: 'Retrieve get therapist meeting analytics',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)('startDate')),
    __param(2, (0, common_1.Query)('endDate')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, String]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "getTherapistMeetingAnalytics", null);
__decorate([
    (0, common_1.Post)(':id/emergency-terminate'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create emergency terminate',
        description: 'Create emergency terminate',
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully',
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, Object]),
    __metadata("design:returntype", Promise)
], MeetingsController.prototype, "emergencyTerminate", null);
exports.MeetingsController = MeetingsController = __decorate([
    (0, swagger_1.ApiTags)('meetings'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('meetings'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof meetings_service_1.MeetingsService !== "undefined" && meetings_service_1.MeetingsService) === "function" ? _a : Object])
], MeetingsController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQVl3QjtBQUN4Qix5REFBcUQ7QUFDckQsa0VBQTZEO0FBQzdELDRGQUE2RTtBQUM3RSw2RUFBd0U7QUFDeEUsNkNBUXlCO0FBQ3pCLHFEQWF5QjtBQU1sQixJQUFNLGtCQUFrQixHQUF4QixNQUFNLGtCQUFrQjtJQUNBO0lBQTdCLFlBQTZCLGVBQWdDO1FBQWhDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtJQUFHLENBQUM7SUFjM0QsQUFBTixLQUFLLENBQUMsVUFBVSxDQUNELFNBQWlCLEVBQ2IsTUFBYztRQUUvQixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBZUssQUFBTixLQUFLLENBQUMsbUJBQW1CLENBQ1YsU0FBaUIsRUFDYixNQUFjLEVBRS9CLGVBQXVDO1FBRXZDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxtQkFBbUIsQ0FDN0MsU0FBUyxFQUNULE1BQU0sRUFDTixlQUFlLENBQ2hCLENBQUM7SUFDSixDQUFDO0lBRUQsK0NBQStDO0lBZXpDLEFBQU4sS0FBSyxDQUFDLGVBQWUsQ0FDTixTQUFpQixFQUNiLE1BQWMsRUFFL0IsYUFBaUM7UUFFakMsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLGVBQWUsQ0FDekMsU0FBUyxFQUNULE1BQU0sRUFDTixhQUFhLENBQ2QsQ0FBQztJQUNKLENBQUM7SUFlSyxBQUFOLEtBQUssQ0FBQyxhQUFhLENBQ0osU0FBaUIsRUFDYixNQUFjLEVBRS9CLFdBQTZCO1FBRTdCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBZUss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WCxNQUFNLEVBQUUsR0FBRztRQUVYLFdBQVcsRUFBRSx3QkFBd0I7S0FDdEMsQ0FBQztJQUNELElBQUEscUJBQVcsRUFBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxDQUFDO0lBRXZELFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7SUFDZixXQUFBLElBQUEsY0FBSyxFQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQ2xCLFdBQUEsSUFBQSxjQUFLLEVBQUMsU0FBUyxDQUFDLENBQUE7Ozs7c0VBV2xCO0FBY0s7SUFaTCxJQUFBLGFBQUksRUFBQyx5QkFBeUIsQ0FBQztJQUMvQixJQUFBLHNCQUFZLEVBQUM7UUFDWixPQUFPLEVBQUUsNEJBQTRCO1FBRXJDLFdBQVcsRUFBRSw0QkFBNEI7S0FDMUMsQ0FBQztJQUNELElBQUEscUJBQVcsRUFBQztRQUNYLE1BQU0sRUFBRSxHQUFHO1FBRVgsV0FBVyxFQUFFLHNCQUFzQjtLQUNwQyxDQUFDO0lBQ0QsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLENBQUM7SUFFdkQsV0FBQSxJQUFBLGNBQUssRUFBQyxJQUFJLENBQUMsQ0FBQTtJQUNYLFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7SUFDZixXQUFBLElBQUEsYUFBSSxHQUFFLENBQUE7Ozs7NERBT1I7NkJBOVFVLGtCQUFrQjtJQUo5QixJQUFBLGlCQUFPLEVBQUMsVUFBVSxDQUFDO0lBQ25CLElBQUEsdUJBQWEsRUFBQyxVQUFVLENBQUM7SUFDekIsSUFBQSxtQkFBVSxFQUFDLFVBQVUsQ0FBQztJQUN0QixJQUFBLGtCQUFTLEVBQUMsNkJBQVksQ0FBQzt5REFFd0Isa0NBQWUsb0JBQWYsa0NBQWU7R0FEbEQsa0JBQWtCLENBK1E5QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbWVldGluZ3MvbWVldGluZ3MuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb250cm9sbGVyLFxuICBHZXQsXG4gIFBvc3QsXG4gIFB1dCxcbiAgRGVsZXRlLFxuICBQYXJhbSxcbiAgQm9keSxcbiAgVXNlR3VhcmRzLFxuICBRdWVyeSxcbiAgSHR0cENvZGUsXG4gIEh0dHBTdGF0dXMsXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IE1lZXRpbmdzU2VydmljZSB9IGZyb20gJy4vbWVldGluZ3Muc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBDdXJyZW50VXNlcklkIH0gZnJvbSAnLi4vYXV0aC9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci1pZC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICcuLi9jb21tb24vcGlwZXMvem9kLXZhbGlkYXRpb24ucGlwZSc7XG5pbXBvcnQge1xuICBBcGlUYWdzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVJlc3BvbnNlLFxuICBBcGlCb2R5LFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlQYXJhbSxcbiAgQXBpUXVlcnksXG59IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5pbXBvcnQge1xuICBDcmVhdGVWaWRlb1Jvb21EdG8sXG4gIENyZWF0ZVZpZGVvUm9vbUR0b1NjaGVtYSxcbiAgSm9pblZpZGVvUm9vbUR0byxcbiAgSm9pblZpZGVvUm9vbUR0b1NjaGVtYSxcbiAgRW5kVmlkZW9DYWxsRHRvLFxuICBFbmRWaWRlb0NhbGxEdG9TY2hlbWEsXG4gIFZpZGVvUm9vbVJlc3BvbnNlLFxuICBWaWRlb0NhbGxTdGF0dXMsXG4gIFVwZGF0ZU1lZXRpbmdTdGF0dXNEdG8sXG4gIFVwZGF0ZU1lZXRpbmdTdGF0dXNEdG9TY2hlbWEsXG4gIFNhdmVNZWV0aW5nU2Vzc2lvbkR0byxcbiAgU2F2ZU1lZXRpbmdTZXNzaW9uRHRvU2NoZW1hLFxufSBmcm9tICdtZW50YXJhLWNvbW1vbnMnO1xuXG5AQXBpVGFncygnbWVldGluZ3MnKVxuQEFwaUJlYXJlckF1dGgoJ0pXVC1hdXRoJylcbkBDb250cm9sbGVyKCdtZWV0aW5ncycpXG5AVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbmV4cG9ydCBjbGFzcyBNZWV0aW5nc0NvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IG1lZXRpbmdzU2VydmljZTogTWVldGluZ3NTZXJ2aWNlKSB7fVxuXG4gIEBHZXQoJzppZCcpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdSZXRyaWV2ZSBnZXQgbWVldGluZycsXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlIGdldCBtZWV0aW5nJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcblxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcbiAgYXN5bmMgZ2V0TWVldGluZyhcbiAgICBAUGFyYW0oJ2lkJykgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkKG1lZXRpbmdJZCwgdXNlcklkKTtcbiAgfVxuXG4gIEBQdXQoJzppZC9zdGF0dXMnKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnVXBkYXRlIHVwZGF0ZSBtZWV0aW5nIHN0YXR1cycsXG5cbiAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZSB1cGRhdGUgbWVldGluZyBzdGF0dXMnLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuXG4gICAgZGVzY3JpcHRpb246ICdVcGRhdGVkIHN1Y2Nlc3NmdWxseScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHVwZGF0ZU1lZXRpbmdTdGF0dXMoXG4gICAgQFBhcmFtKCdpZCcpIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFVwZGF0ZU1lZXRpbmdTdGF0dXNEdG9TY2hlbWEpKVxuICAgIHVwZGF0ZVN0YXR1c0R0bzogVXBkYXRlTWVldGluZ1N0YXR1c0R0byxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubWVldGluZ3NTZXJ2aWNlLnVwZGF0ZU1lZXRpbmdTdGF0dXMoXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICB1cGRhdGVTdGF0dXNEdG8sXG4gICAgKTtcbiAgfVxuXG4gIC8vID09PT09IFZJREVPIENBTEwgSU5URUdSQVRJT04gRU5EUE9JTlRTID09PT09XG5cbiAgQFBvc3QoJzppZC92aWRlby1yb29tJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0NyZWF0ZSBjcmVhdGUgdmlkZW8gcm9vbScsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZSBjcmVhdGUgdmlkZW8gcm9vbScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDEsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5DUkVBVEVEKVxuICBhc3luYyBjcmVhdGVWaWRlb1Jvb20oXG4gICAgQFBhcmFtKCdpZCcpIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKENyZWF0ZVZpZGVvUm9vbUR0b1NjaGVtYSkpXG4gICAgY3JlYXRlUm9vbUR0bzogQ3JlYXRlVmlkZW9Sb29tRHRvLFxuICApOiBQcm9taXNlPFZpZGVvUm9vbVJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMubWVldGluZ3NTZXJ2aWNlLmNyZWF0ZVZpZGVvUm9vbShcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNyZWF0ZVJvb21EdG8sXG4gICAgKTtcbiAgfVxuXG4gIEBQb3N0KCc6aWQvam9pbi12aWRlbycpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdDcmVhdGUgam9pbiB2aWRlbyByb29tJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIGpvaW4gdmlkZW8gcm9vbScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDEsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgam9pblZpZGVvUm9vbShcbiAgICBAUGFyYW0oJ2lkJykgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoSm9pblZpZGVvUm9vbUR0b1NjaGVtYSkpXG4gICAgam9pblJvb21EdG86IEpvaW5WaWRlb1Jvb21EdG8sXG4gICk6IFByb21pc2U8VmlkZW9Sb29tUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5tZWV0aW5nc1NlcnZpY2Uuam9pblZpZGVvUm9vbShtZWV0aW5nSWQsIHVzZXJJZCwgam9pblJvb21EdG8pO1xuICB9XG5cbiAgQEdldCgnOmlkL3ZpZGVvLXN0YXR1cycpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdSZXRyaWV2ZSBnZXQgdmlkZW8gY2FsbCBzdGF0dXMnLFxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSBnZXQgdmlkZW8gY2FsbCBzdGF0dXMnLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgZ2V0VmlkZW9DYWxsU3RhdHVzKFxuICAgIEBQYXJhbSgnaWQnKSBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPFZpZGVvQ2FsbFN0YXR1cz4ge1xuICAgIHJldHVybiB0aGlzLm1lZXRpbmdzU2VydmljZS5nZXRWaWRlb0NhbGxTdGF0dXMobWVldGluZ0lkLCB1c2VySWQpO1xuICB9XG5cbiAgQERlbGV0ZSgnOmlkL3ZpZGVvLXJvb20nKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnRGVsZXRlIGVuZCB2aWRlbyBjYWxsJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnRGVsZXRlIGVuZCB2aWRlbyBjYWxsJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcblxuICAgIGRlc2NyaXB0aW9uOiAnRGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk5PX0NPTlRFTlQpXG4gIGFzeW5jIGVuZFZpZGVvQ2FsbChcbiAgICBAUGFyYW0oJ2lkJykgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUoRW5kVmlkZW9DYWxsRHRvU2NoZW1hKSlcbiAgICBlbmRDYWxsRHRvOiBFbmRWaWRlb0NhbGxEdG8sXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLm1lZXRpbmdzU2VydmljZS5lbmRWaWRlb0NhbGwobWVldGluZ0lkLCB1c2VySWQsIGVuZENhbGxEdG8pO1xuICB9XG5cbiAgLy8gTGVnYWN5IGVuZHBvaW50IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gIEBQb3N0KCc6aWQvcm9vbScpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdDcmVhdGUgZ2VuZXJhdGUgbWVldGluZyByb29tJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIGdlbmVyYXRlIG1lZXRpbmcgcm9vbScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDEsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBhc3luYyBnZW5lcmF0ZU1lZXRpbmdSb29tKFxuICAgIEBQYXJhbSgnaWQnKSBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICAvLyBSZWRpcmVjdCB0byBuZXcgdmlkZW8gcm9vbSBjcmVhdGlvbiB3aXRoIGRlZmF1bHQgc2V0dGluZ3NcbiAgICBjb25zdCBkZWZhdWx0Q3JlYXRlRHRvOiBDcmVhdGVWaWRlb1Jvb21EdG8gPSB7XG4gICAgICBtZWV0aW5nSWQsXG4gICAgICByb29tVHlwZTogJ3ZpZGVvJyxcbiAgICAgIG1heFBhcnRpY2lwYW50czogMixcbiAgICAgIGVuYWJsZVJlY29yZGluZzogZmFsc2UsXG4gICAgICBlbmFibGVDaGF0OiB0cnVlLFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMubWVldGluZ3NTZXJ2aWNlLmNyZWF0ZVZpZGVvUm9vbShcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGRlZmF1bHRDcmVhdGVEdG8sXG4gICAgKTtcbiAgfVxuXG4gIEBHZXQoJ3VwY29taW5nJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ1JldHJpZXZlIGdldCB1cGNvbWluZyBtZWV0aW5ncycsXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlIGdldCB1cGNvbWluZyBtZWV0aW5ncycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIGFzeW5jIGdldFVwY29taW5nTWVldGluZ3MoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAUXVlcnkoJ2xpbWl0JykgbGltaXQ/OiBudW1iZXIsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1lZXRpbmdzU2VydmljZS5nZXRVcGNvbWluZ01lZXRpbmdzKHVzZXJJZCwgbGltaXQpO1xuICB9XG5cbiAgQFBvc3QoJzppZC9zZXNzaW9uJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0NyZWF0ZSBzYXZlIG1lZXRpbmcgc2Vzc2lvbicsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZSBzYXZlIG1lZXRpbmcgc2Vzc2lvbicsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDEsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5DUkVBVEVEKVxuICBhc3luYyBzYXZlTWVldGluZ1Nlc3Npb24oXG4gICAgQFBhcmFtKCdpZCcpIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQEJvZHkobmV3IFpvZFZhbGlkYXRpb25QaXBlKFNhdmVNZWV0aW5nU2Vzc2lvbkR0b1NjaGVtYSkpXG4gICAgc2Vzc2lvbkRhdGE6IFNhdmVNZWV0aW5nU2Vzc2lvbkR0byxcbiAgKSB7XG4gICAgLy8gVmFsaWRhdGUgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgbWVldGluZ1xuICAgIGF3YWl0IHRoaXMubWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkKG1lZXRpbmdJZCwgdXNlcklkKTtcblxuICAgIHJldHVybiB0aGlzLm1lZXRpbmdzU2VydmljZS5zYXZlTWVldGluZ1Nlc3Npb24oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICBzZXNzaW9uRGF0YSxcbiAgICApO1xuICB9XG5cbiAgQEdldCgnYW5hbHl0aWNzL3RoZXJhcGlzdCcpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdSZXRyaWV2ZSBnZXQgdGhlcmFwaXN0IG1lZXRpbmcgYW5hbHl0aWNzJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmUgZ2V0IHRoZXJhcGlzdCBtZWV0aW5nIGFuYWx5dGljcycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIGFzeW5jIGdldFRoZXJhcGlzdE1lZXRpbmdBbmFseXRpY3MoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAUXVlcnkoJ3N0YXJ0RGF0ZScpIHN0YXJ0RGF0ZT86IHN0cmluZyxcbiAgICBAUXVlcnkoJ2VuZERhdGUnKSBlbmREYXRlPzogc3RyaW5nLFxuICApIHtcbiAgICBjb25zdCBkYXRlUmFuZ2UgPVxuICAgICAgc3RhcnREYXRlICYmIGVuZERhdGVcbiAgICAgICAgPyB7XG4gICAgICAgICAgICBzdGFydDogbmV3IERhdGUoc3RhcnREYXRlKSxcbiAgICAgICAgICAgIGVuZDogbmV3IERhdGUoZW5kRGF0ZSksXG4gICAgICAgICAgfVxuICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgIHJldHVybiB0aGlzLm1lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQW5hbHl0aWNzKHVzZXJJZCwgZGF0ZVJhbmdlKTtcbiAgfVxuXG4gIEBQb3N0KCc6aWQvZW1lcmdlbmN5LXRlcm1pbmF0ZScpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdDcmVhdGUgZW1lcmdlbmN5IHRlcm1pbmF0ZScsXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZSBlbWVyZ2VuY3kgdGVybWluYXRlJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMSxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG4gIGFzeW5jIGVtZXJnZW5jeVRlcm1pbmF0ZShcbiAgICBAUGFyYW0oJ2lkJykgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQm9keSgpIGJvZHk6IHsgcmVhc29uOiBzdHJpbmcgfSxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubWVldGluZ3NTZXJ2aWNlLmVtZXJnZW5jeVRlcm1pbmF0ZU1lZXRpbmcoXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICBib2R5LnJlYXNvbixcbiAgICAgIHVzZXJJZCxcbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=