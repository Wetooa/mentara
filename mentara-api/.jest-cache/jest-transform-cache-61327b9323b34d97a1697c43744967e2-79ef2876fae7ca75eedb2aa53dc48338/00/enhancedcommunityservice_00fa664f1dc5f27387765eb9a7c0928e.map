{"version":3,"names":["cov_1gjybg8vyz","actualCoverage","common_1","s","require","prisma_client_provider_1","event_emitter_1","EnhancedCommunityService","EnhancedCommunityService_1","prisma","eventEmitter","logger","Logger","name","constructor","f","searchCommunities","filters","userId","page","b","limit","offset","where","orderBy","query","OR","contains","mode","description","hasDescription","undefined","not","hasImage","imageUrl","communities","community","findMany","include","_count","select","memberships","id","skip","take","filteredCommunities","filter","memberCount","minMembers","maxMembers","pendingRequests","searchResults","map","postCount","commentCount","lastActivityAt","membershipStatus","length","includes","slug","recentActivity","createdAt","tags","applySorting","sortBy","sortOrder","facets","calculateSearchFacets","total","count","totalPages","Math","ceil","error","getCommunityDetails","communityId","findUnique","roomGroups","rooms","posts","user","firstName","lastName","avatarUrl","comments","hearts","moderatorCommunities","moderator","NotFoundException","now","Date","oneWeekAgo","getTime","oneMonthAgo","communityRoomIds","flatMap","rg","r","totalComments","weeklyPosts","weeklyComments","weeklyMembers","activeMembers","topContributors","Promise","all","comment","post","roomId","in","gte","membership","joinedAt","updatedAt","getTopContributors","userPermissions","canPost","canComment","canModerate","checkModerationPermissions","stats","totalPosts","reduce","roomTotal","room","postsThisWeek","commentsThisWeek","newMembersThisWeek","recentPosts","sort","a","slice","title","content","author","heartCount","moderators","mc","assignedAt","getTrendingCommunities","timeframe","timeframeMs","startDate","previousStartDate","trendingCommunities","allPosts","trendingData","calculateTrendingData","sum","latest","scoreA","growthRate","activityScore","engagementRate","scoreB","getSimilarCommunities","context","excludeJoined","maxResults","refCommunity","memberCommunities","Map","forEach","userMembership","get","set","sortedCommunities","Array","from","entries","communityIds","userCommunityIds","userMemberships","m","similarCommunities","ascending","activityA","activityB","localeCompare","memberRanges","range","min","max","memberRangeCounts","lte","commonTags","currentMembers","previousMembers","lt","totalInteractions","retentionRate","roomIds","contributors","some","scoredContributors","contributor","contributionScore","Number","role","moderatorCommunity","findFirst","moderatorId","exports","__decorate","Injectable","PrismaService","_a","Object","_b","EventEmitter2"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/services/enhanced-community.service.ts"],"sourcesContent":["import {\n  Injectable,\n  Logger,\n  BadRequestException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { EventEmitter2 } from '@nestjs/event-emitter';\n\nexport interface CommunitySearchFilters {\n  query?: string;\n  tags?: string[];\n  minMembers?: number;\n  maxMembers?: number;\n  sortBy?: 'relevance' | 'members' | 'activity' | 'newest' | 'alphabetical';\n  sortOrder?: 'asc' | 'desc';\n  hasDescription?: boolean;\n  hasImage?: boolean;\n  membershipRequired?: boolean;\n}\n\nexport interface CommunitySearchResult {\n  id: string;\n  name: string;\n  slug: string;\n  description: string;\n  imageUrl: string;\n  memberCount: number;\n  recentActivity: {\n    postCount: number;\n    commentCount: number;\n    lastActivityAt: Date | null;\n  };\n  compatibility?: {\n    score: number;\n    reasoning: string;\n  };\n  membershipStatus: 'member' | 'pending' | 'none';\n  createdAt: Date;\n  tags?: string[];\n}\n\nexport interface EnhancedCommunityDetails {\n  id: string;\n  name: string;\n  slug: string;\n  description: string;\n  imageUrl: string;\n  createdAt: Date;\n  updatedAt: Date;\n  memberCount: number;\n  stats: {\n    totalPosts: number;\n    totalComments: number;\n    activeMembers: number;\n    recentActivity: {\n      postsThisWeek: number;\n      commentsThisWeek: number;\n      newMembersThisWeek: number;\n    };\n  };\n  recentPosts: {\n    id: string;\n    title: string;\n    content: string;\n    author: {\n      id: string;\n      firstName: string;\n      lastName: string;\n      avatarUrl?: string;\n    };\n    createdAt: Date;\n    heartCount: number;\n    commentCount: number;\n  }[];\n  topContributors: {\n    id: string;\n    firstName: string;\n    lastName: string;\n    avatarUrl?: string;\n    contributionScore: number;\n    postCount: number;\n    commentCount: number;\n  }[];\n  moderators: {\n    id: string;\n    firstName: string;\n    lastName: string;\n    avatarUrl?: string;\n    assignedAt: Date;\n  }[];\n  membershipStatus: 'member' | 'pending' | 'none';\n  userPermissions: {\n    canPost: boolean;\n    canComment: boolean;\n    canModerate: boolean;\n  };\n}\n\nexport interface CommunityTrendingData {\n  growthRate: number; // percentage growth in members\n  activityScore: number; // based on posts, comments, hearts\n  engagementRate: number; // comments per post ratio\n  retentionRate: number; // members active in last 30 days\n}\n\ninterface CommunityRecommendationContext {\n  userId: string;\n  includeSimilar?: boolean;\n  excludeJoined?: boolean;\n  maxResults?: number;\n}\n\n@Injectable()\nexport class EnhancedCommunityService {\n  private readonly logger = new Logger(EnhancedCommunityService.name);\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly eventEmitter: EventEmitter2,\n  ) {}\n\n  /**\n   * Advanced community search with filtering and ranking\n   */\n  async searchCommunities(\n    filters: CommunitySearchFilters,\n    userId?: string,\n    page = 1,\n    limit = 20,\n  ): Promise<{\n    communities: CommunitySearchResult[];\n    total: number;\n    page: number;\n    limit: number;\n    totalPages: number;\n    facets: {\n      memberRanges: { range: string; count: number }[];\n      commonTags: { tag: string; count: number }[];\n    };\n  }> {\n    try {\n      const offset = (page - 1) * limit;\n\n      // Build the search query\n      const where: any = {};\n      const orderBy: any = [];\n\n      // Text search\n      if (filters.query) {\n        where.OR = [\n          { name: { contains: filters.query, mode: 'insensitive' } },\n          { description: { contains: filters.query, mode: 'insensitive' } },\n        ];\n      }\n\n      // Filter by description/image presence\n      if (filters.hasDescription !== undefined) {\n        where.description = filters.hasDescription ? { not: '' } : '';\n      }\n      if (filters.hasImage !== undefined) {\n        where.imageUrl = filters.hasImage ? { not: '' } : '';\n      }\n\n      // Get communities with member counts and recent activity\n      const communities = await this.prisma.community.findMany({\n        where,\n        include: {\n          _count: {\n            select: {\n              memberships: true,\n            },\n          },\n          memberships: userId\n            ? {\n                where: { userId },\n                select: { id: true },\n              }\n            : false,\n        },\n        skip: offset,\n        take: limit,\n      });\n\n      // Apply member count filters and calculate activity\n      const filteredCommunities = communities.filter((community) => {\n        const memberCount = community._count.memberships;\n\n        if (filters.minMembers && memberCount < filters.minMembers)\n          return false;\n        if (filters.maxMembers && memberCount > filters.maxMembers)\n          return false;\n\n        return true;\n      });\n\n      // Join requests removed - simplified community system\n      const pendingRequests: string[] = [];\n\n      // Transform to search results\n      const searchResults: CommunitySearchResult[] = filteredCommunities.map(\n        (community) => {\n          const memberCount = community._count.memberships;\n          const postCount = 0; // Posts are in rooms, not direct community relation\n          const commentCount = 0; // Comments are in posts in rooms\n          const lastActivityAt = null; // Activity tracking simplified\n\n          // Determine membership status\n          let membershipStatus: 'member' | 'pending' | 'none' = 'none';\n          if (userId) {\n            if (community.memberships && community.memberships.length > 0) {\n              membershipStatus = 'member';\n            } else if (pendingRequests.includes(community.id)) {\n              membershipStatus = 'pending';\n            }\n          }\n\n          return {\n            id: community.id,\n            name: community.name,\n            slug: community.slug,\n            description: community.description,\n            imageUrl: community.imageUrl,\n            memberCount,\n            recentActivity: {\n              postCount,\n              commentCount,\n              lastActivityAt,\n            },\n            membershipStatus,\n            createdAt: community.createdAt,\n            tags: [], // Could be implemented with a tags system\n          };\n        },\n      );\n\n      // Apply sorting\n      this.applySorting(searchResults, filters.sortBy, filters.sortOrder);\n\n      // Calculate facets for filtering UI\n      const facets = await this.calculateSearchFacets(where);\n\n      // Get total count for pagination\n      const total = await this.prisma.community.count({ where });\n\n      return {\n        communities: searchResults,\n        total,\n        page,\n        limit,\n        totalPages: Math.ceil(total / limit),\n        facets,\n      };\n    } catch (error) {\n      this.logger.error(`Error searching communities:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get enhanced community details with comprehensive stats\n   */\n  async getCommunityDetails(\n    communityId: string,\n    userId?: string,\n  ): Promise<EnhancedCommunityDetails> {\n    try {\n      const community = await this.prisma.community.findUnique({\n        where: { id: communityId },\n        include: {\n          _count: {\n            select: {\n              memberships: true,\n            },\n          },\n          roomGroups: {\n            include: {\n              rooms: {\n                include: {\n                  posts: {\n                    include: {\n                      user: {\n                        select: {\n                          id: true,\n                          firstName: true,\n                          lastName: true,\n                          avatarUrl: true,\n                        },\n                      },\n                      _count: {\n                        select: {\n                          comments: true,\n                          hearts: true,\n                        },\n                      },\n                    },\n                    orderBy: { createdAt: 'desc' },\n                    take: 5,\n                  },\n                },\n              },\n            },\n          },\n          moderatorCommunities: {\n            include: {\n              moderator: {\n                include: {\n                  user: {\n                    select: {\n                      id: true,\n                      firstName: true,\n                      lastName: true,\n                      avatarUrl: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n          memberships: userId\n            ? {\n                where: { userId },\n                select: { id: true },\n              }\n            : false,\n        },\n      });\n\n      if (!community) {\n        throw new NotFoundException(`Community ${communityId} not found`);\n      }\n\n      // Calculate time ranges\n      const now = new Date();\n      const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n      const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n      // Get all posts from this community's rooms for statistics\n      const communityRoomIds = community.roomGroups.flatMap((rg) =>\n        rg.rooms.map((r) => r.id),\n      );\n\n      // Get detailed statistics\n      const [\n        totalComments,\n        weeklyPosts,\n        weeklyComments,\n        weeklyMembers,\n        activeMembers,\n        topContributors,\n      ] = await Promise.all([\n        this.prisma.comment.count({\n          where: {\n            post: { roomId: { in: communityRoomIds } },\n          },\n        }),\n        this.prisma.post.count({\n          where: {\n            roomId: { in: communityRoomIds },\n            createdAt: { gte: oneWeekAgo },\n          },\n        }),\n        this.prisma.comment.count({\n          where: {\n            post: { roomId: { in: communityRoomIds } },\n            createdAt: { gte: oneWeekAgo },\n          },\n        }),\n        this.prisma.membership.count({\n          where: {\n            communityId,\n            joinedAt: { gte: oneWeekAgo },\n          },\n        }),\n        this.prisma.membership.count({\n          where: {\n            communityId,\n            user: {\n              updatedAt: { gte: oneMonthAgo }, // Use updatedAt as proxy for activity\n            },\n          },\n        }),\n        this.getTopContributors(communityId, 5),\n      ]);\n\n      // Determine membership status and permissions\n      let membershipStatus: 'member' | 'pending' | 'none' = 'none';\n      let userPermissions = {\n        canPost: false,\n        canComment: false,\n        canModerate: false,\n      };\n\n      if (userId) {\n        const membership = community.memberships?.[0];\n        if (membership) {\n          membershipStatus = 'member';\n\n          // Check if user can moderate based on global role and community moderator assignment\n          const canModerate = await this.checkModerationPermissions(userId, communityId);\n\n          userPermissions = {\n            canPost: true,\n            canComment: true,\n            canModerate,\n          };\n        } else {\n          // Join requests removed - users are automatically assigned communities\n          // No pending status since users get immediate membership\n          membershipStatus = 'none';\n        }\n      }\n\n      return {\n        id: community.id,\n        name: community.name,\n        slug: community.slug,\n        description: community.description,\n        imageUrl: community.imageUrl,\n        createdAt: community.createdAt,\n        updatedAt: community.updatedAt,\n        memberCount: community._count.memberships,\n        stats: {\n          totalPosts: community.roomGroups.reduce(\n            (total, rg) =>\n              total +\n              rg.rooms.reduce(\n                (roomTotal, room) => roomTotal + room.posts.length,\n                0,\n              ),\n            0,\n          ),\n          totalComments,\n          activeMembers,\n          recentActivity: {\n            postsThisWeek: weeklyPosts,\n            commentsThisWeek: weeklyComments,\n            newMembersThisWeek: weeklyMembers,\n          },\n        },\n        recentPosts: community.roomGroups\n          .flatMap((rg) => rg.rooms.flatMap((room) => room.posts))\n          .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\n          .slice(0, 5)\n          .map((post) => ({\n            id: post.id,\n            title: post.title,\n            content: post.content,\n            author: post.user\n              ? {\n                  id: post.user.id,\n                  firstName: post.user.firstName,\n                  lastName: post.user.lastName,\n                  avatarUrl: post.user.avatarUrl || undefined,\n                }\n              : {\n                  id: 'unknown',\n                  firstName: 'Unknown',\n                  lastName: 'User',\n                  avatarUrl: undefined,\n                },\n            createdAt: post.createdAt,\n            heartCount: post._count.hearts,\n            commentCount: post._count.comments,\n          })),\n        topContributors,\n        moderators: community.moderatorCommunities.map((mc) => ({\n          id: mc.moderator.user.id,\n          firstName: mc.moderator.user.firstName,\n          lastName: mc.moderator.user.lastName,\n          avatarUrl: mc.moderator.user.avatarUrl || undefined,\n          assignedAt: mc.assignedAt,\n        })),\n        membershipStatus,\n        userPermissions,\n      };\n    } catch (error) {\n      this.logger.error(\n        `Error getting community details for ${communityId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Get trending communities based on growth and activity\n   */\n  async getTrendingCommunities(\n    limit = 10,\n    timeframe: 'week' | 'month' = 'week',\n  ): Promise<\n    (CommunitySearchResult & { trendingData: CommunityTrendingData })[]\n  > {\n    try {\n      const now = new Date();\n      const timeframeMs =\n        timeframe === 'week'\n          ? 7 * 24 * 60 * 60 * 1000\n          : 30 * 24 * 60 * 60 * 1000;\n      const startDate = new Date(now.getTime() - timeframeMs);\n      const previousStartDate = new Date(startDate.getTime() - timeframeMs);\n\n      const communities = await this.prisma.community.findMany({\n        include: {\n          _count: {\n            select: { memberships: true },\n          },\n          memberships: {\n            where: {\n              joinedAt: { gte: startDate },\n            },\n            select: { joinedAt: true },\n          },\n          roomGroups: {\n            include: {\n              rooms: {\n                include: {\n                  posts: {\n                    where: {\n                      createdAt: { gte: startDate },\n                    },\n                    include: {\n                      _count: {\n                        select: { comments: true, hearts: true },\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      // Calculate trending data for each community\n      const trendingCommunities = await Promise.all(\n        communities.map(async (community) => {\n          const allPosts = community.roomGroups.flatMap((rg) =>\n            rg.rooms.flatMap((room) => room.posts),\n          );\n\n          const trendingData = await this.calculateTrendingData(\n            { ...community, posts: allPosts },\n            startDate,\n            previousStartDate,\n          );\n\n          return {\n            id: community.id,\n            name: community.name,\n            slug: community.slug,\n            description: community.description,\n            imageUrl: community.imageUrl,\n            memberCount: community._count.memberships,\n            recentActivity: {\n              postCount: allPosts.length,\n              commentCount: allPosts.reduce(\n                (sum, post) => sum + post._count.comments,\n                0,\n              ),\n              lastActivityAt:\n                allPosts.length > 0\n                  ? allPosts.reduce(\n                      (latest, post) =>\n                        post.createdAt > latest ? post.createdAt : latest,\n                      allPosts[0].createdAt,\n                    )\n                  : null,\n            },\n            membershipStatus: 'none' as const,\n            createdAt: community.createdAt,\n            trendingData,\n          };\n        }),\n      );\n\n      // Sort by trending score (combination of growth rate and activity)\n      trendingCommunities.sort((a, b) => {\n        const scoreA =\n          a.trendingData.growthRate * 0.4 +\n          a.trendingData.activityScore * 0.4 +\n          a.trendingData.engagementRate * 0.2;\n        const scoreB =\n          b.trendingData.growthRate * 0.4 +\n          b.trendingData.activityScore * 0.4 +\n          b.trendingData.engagementRate * 0.2;\n        return scoreB - scoreA;\n      });\n\n      return trendingCommunities.slice(0, limit);\n    } catch (error) {\n      this.logger.error(`Error getting trending communities:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get similar communities based on user activity and preferences\n   */\n  async getSimilarCommunities(\n    communityId: string,\n    context: CommunityRecommendationContext,\n  ): Promise<CommunitySearchResult[]> {\n    try {\n      const { userId, excludeJoined = true, maxResults = 5 } = context;\n\n      // Get the reference community\n      const refCommunity = await this.prisma.community.findUnique({\n        where: { id: communityId },\n        include: {\n          memberships: {\n            include: {\n              user: {\n                include: {\n                  memberships: {\n                    include: { community: true },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!refCommunity) {\n        throw new NotFoundException(`Community ${communityId} not found`);\n      }\n\n      // Find communities that other members of this community have joined\n      const memberCommunities = new Map<string, number>();\n\n      refCommunity.memberships.forEach((membership) => {\n        if (membership.user) {\n          membership.user.memberships.forEach((userMembership) => {\n            if (userMembership.communityId !== communityId) {\n              const count =\n                memberCommunities.get(userMembership.communityId) || 0;\n              memberCommunities.set(userMembership.communityId, count + 1);\n            }\n          });\n        }\n      });\n\n      // Sort by overlap count and get top communities\n      const sortedCommunities = Array.from(memberCommunities.entries())\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, maxResults * 2); // Get more to filter out joined ones\n\n      // Get community details\n      const communityIds = sortedCommunities.map(([id]) => id);\n      const communities = await this.prisma.community.findMany({\n        where: { id: { in: communityIds } },\n        include: {\n          _count: { select: { memberships: true } },\n          roomGroups: {\n            include: {\n              rooms: {\n                include: {\n                  _count: { select: { posts: true } },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      // Get user's joined communities if excluding them\n      let userCommunityIds: string[] = [];\n      if (excludeJoined && userId) {\n        const userMemberships = await this.prisma.membership.findMany({\n          where: { userId },\n          select: { communityId: true },\n        });\n        userCommunityIds = userMemberships.map((m) => m.communityId);\n      }\n\n      // Filter and format results\n      const similarCommunities = communities\n        .filter((community) => !userCommunityIds.includes(community.id))\n        .map((community) => ({\n          id: community.id,\n          name: community.name,\n          slug: community.slug,\n          description: community.description,\n          imageUrl: community.imageUrl,\n          memberCount: community._count.memberships,\n          recentActivity: {\n            postCount: community.roomGroups.reduce(\n              (total, rg) =>\n                total +\n                rg.rooms.reduce(\n                  (roomTotal, room) => roomTotal + room._count.posts,\n                  0,\n                ),\n              0,\n            ),\n            commentCount: 0, // Could be calculated if needed\n            lastActivityAt: null,\n          },\n          membershipStatus: 'none' as const,\n          createdAt: community.createdAt,\n        }))\n        .slice(0, maxResults);\n\n      return similarCommunities;\n    } catch (error) {\n      this.logger.error(\n        `Error getting similar communities for ${communityId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Private helper methods\n   */\n  private applySorting(\n    communities: CommunitySearchResult[],\n    sortBy: string = 'relevance',\n    sortOrder: string = 'desc',\n  ): void {\n    const ascending = sortOrder === 'asc';\n\n    switch (sortBy) {\n      case 'members':\n        communities.sort((a, b) =>\n          ascending\n            ? a.memberCount - b.memberCount\n            : b.memberCount - a.memberCount,\n        );\n        break;\n\n      case 'activity':\n        communities.sort((a, b) => {\n          const activityA =\n            a.recentActivity.postCount + a.recentActivity.commentCount;\n          const activityB =\n            b.recentActivity.postCount + b.recentActivity.commentCount;\n          return ascending ? activityA - activityB : activityB - activityA;\n        });\n        break;\n\n      case 'newest':\n        communities.sort((a, b) =>\n          ascending\n            ? a.createdAt.getTime() - b.createdAt.getTime()\n            : b.createdAt.getTime() - a.createdAt.getTime(),\n        );\n        break;\n\n      case 'alphabetical':\n        communities.sort((a, b) =>\n          ascending\n            ? a.name.localeCompare(b.name)\n            : b.name.localeCompare(a.name),\n        );\n        break;\n\n      default: // relevance\n        // Default sorting by member count for now\n        communities.sort((a, b) => b.memberCount - a.memberCount);\n        break;\n    }\n  }\n\n  private async calculateSearchFacets(where: any): Promise<{\n    memberRanges: { range: string; count: number }[];\n    commonTags: { tag: string; count: number }[];\n  }> {\n    try {\n      // Calculate member range distribution\n      const memberRanges = [\n        { range: '1-10', min: 1, max: 10 },\n        { range: '11-50', min: 11, max: 50 },\n        { range: '51-100', min: 51, max: 100 },\n        { range: '101-500', min: 101, max: 500 },\n        { range: '500+', min: 501, max: 999999 },\n      ];\n\n      const memberRangeCounts = await Promise.all(\n        memberRanges.map(async (range) => {\n          const count = await this.prisma.community.count({\n            where: {\n              ...where,\n              memberships: {\n                _count: {\n                  gte: range.min,\n                  ...(range.max < 999999 ? { lte: range.max } : {}),\n                },\n              },\n            },\n          });\n          return { range: range.range, count };\n        }),\n      );\n\n      return {\n        memberRanges: memberRangeCounts,\n        commonTags: [], // Could be implemented with a tag system\n      };\n    } catch (error) {\n      this.logger.error('Error calculating search facets:', error);\n      return {\n        memberRanges: [],\n        commonTags: [],\n      };\n    }\n  }\n\n  private async calculateTrendingData(\n    community: any,\n    startDate: Date,\n    previousStartDate: Date,\n  ): Promise<CommunityTrendingData> {\n    try {\n      // Calculate growth rate\n      const currentMembers = community.memberships.length;\n      const previousMembers = await this.prisma.membership.count({\n        where: {\n          communityId: community.id,\n          joinedAt: {\n            gte: previousStartDate,\n            lt: startDate,\n          },\n        },\n      });\n\n      const growthRate =\n        previousMembers > 0\n          ? ((currentMembers - previousMembers) / previousMembers) * 100\n          : currentMembers > 0\n            ? 100\n            : 0;\n\n      // Calculate activity score\n      const totalInteractions = community.posts.reduce(\n        (sum: number, post: any) =>\n          sum + post._count.comments + post._count.hearts,\n        0,\n      );\n      const activityScore = Math.min(\n        (totalInteractions / Math.max(community._count.memberships, 1)) * 10,\n        100,\n      );\n\n      // Calculate engagement rate\n      const totalPosts = community.posts.length;\n      const totalComments = community.posts.reduce(\n        (sum: number, post: any) => sum + post._count.comments,\n        0,\n      );\n      const engagementRate =\n        totalPosts > 0 ? (totalComments / totalPosts) * 10 : 0;\n\n      // Calculate retention rate (simplified)\n      const retentionRate = Math.min(\n        (currentMembers / Math.max(community._count.memberships, 1)) * 100,\n        100,\n      );\n\n      return {\n        growthRate: Math.max(0, growthRate),\n        activityScore: Math.max(0, activityScore),\n        engagementRate: Math.max(0, engagementRate),\n        retentionRate: Math.max(0, retentionRate),\n      };\n    } catch (error) {\n      this.logger.error('Error calculating trending data:', error);\n      return {\n        growthRate: 0,\n        activityScore: 0,\n        engagementRate: 0,\n        retentionRate: 0,\n      };\n    }\n  }\n\n  private async getTopContributors(\n    communityId: string,\n    limit: number,\n  ): Promise<\n    {\n      id: string;\n      firstName: string;\n      lastName: string;\n      avatarUrl?: string;\n      contributionScore: number;\n      postCount: number;\n      commentCount: number;\n    }[]\n  > {\n    try {\n      // Get room IDs for this community\n      const community = await this.prisma.community.findUnique({\n        where: { id: communityId },\n        include: {\n          roomGroups: {\n            include: {\n              rooms: { select: { id: true } },\n            },\n          },\n        },\n      });\n\n      if (!community) return [];\n\n      const roomIds = community.roomGroups.flatMap((rg) =>\n        rg.rooms.map((r) => r.id),\n      );\n\n      // Get users with their contribution counts\n      const contributors = await this.prisma.user.findMany({\n        where: {\n          memberships: {\n            some: { communityId },\n          },\n        },\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          avatarUrl: true,\n          _count: {\n            select: {\n              posts: {\n                where: { roomId: { in: roomIds } },\n              },\n              comments: {\n                where: {\n                  post: { roomId: { in: roomIds } },\n                },\n              },\n            },\n          },\n        },\n        take: limit * 2, // Get more to calculate scores\n      });\n\n      // Calculate contribution scores and sort\n      const scoredContributors = contributors\n        .map((contributor) => {\n          const postCount = contributor._count.posts;\n          const commentCount = contributor._count.comments;\n          const contributionScore = postCount * 3 + commentCount * 1; // Posts worth more than comments\n\n          return {\n            id: contributor.id,\n            firstName: contributor.firstName,\n            lastName: contributor.lastName,\n            avatarUrl: contributor.avatarUrl || undefined,\n            contributionScore,\n            postCount: Number(postCount),\n            commentCount: Number(commentCount),\n          };\n        })\n        .filter((contributor) => contributor.contributionScore > 0)\n        .sort((a, b) => b.contributionScore - a.contributionScore)\n        .slice(0, limit);\n\n      return scoredContributors;\n    } catch (error) {\n      this.logger.error(\n        `Error getting top contributors for community ${communityId}:`,\n        error,\n      );\n      return [];\n    }\n  }\n\n  /**\n   * Check if user can moderate a specific community\n   */\n  private async checkModerationPermissions(\n    userId: string,\n    communityId: string,\n  ): Promise<boolean> {\n    try {\n      // Check if user is a global admin\n      const user = await this.prisma.user.findUnique({\n        where: { id: userId },\n        select: { role: true },\n      });\n\n      if (user?.role === 'admin') {\n        return true; // Global admins can moderate all communities\n      }\n\n      // Check if user is assigned as a moderator for this specific community\n      const moderatorCommunity = await this.prisma.moderatorCommunity.findFirst({\n        where: {\n          moderatorId: userId,\n          communityId,\n        },\n      });\n\n      return !!moderatorCommunity;\n    } catch (error) {\n      this.logger.error(\n        `Error checking moderation permissions for user ${userId} in community ${communityId}:`,\n        error,\n      );\n      return false;\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}