ad68230b9057d10b53d3040d9f80cef5
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationsController = void 0;
const common_1 = require("@nestjs/common");
const notifications_service_1 = require("./notifications.service");
const jwt_auth_guard_1 = require("src/auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("src/auth/decorators/current-user-id.decorator");
const zod_validation_pipe_1 = require("src/common/pipes/zod-validation.pipe");
const commons_1 = require("@mentara/commons");
const swagger_1 = require("@nestjs/swagger");
let NotificationsController = class NotificationsController {
    notificationsService;
    constructor(notificationsService) {
        this.notificationsService = notificationsService;
    }
    create(body, userId) {
        return this.notificationsService.create({
            ...body,
            userId,
            scheduledFor: body.scheduledFor ? new Date(body.scheduledFor) : undefined,
        });
    }
    findAll(userId, query) {
        return this.notificationsService.findAll(userId, query.isRead, query.type, query.priority);
    }
    getUnreadCount(userId) {
        return this.notificationsService.getUnreadCount(userId);
    }
    getNotificationSettings(userId) {
        return this.notificationsService.getNotificationSettings(userId);
    }
    updateNotificationSettings(body, userId) {
        return this.notificationsService.updateNotificationSettings(userId, body);
    }
    findOne(id) {
        return this.notificationsService.findOne(id);
    }
    markAsRead(id) {
        return this.notificationsService.markAsRead(id);
    }
    markAllAsRead(userId) {
        return this.notificationsService.markAllAsRead(userId);
    }
    remove(id) {
        return this.notificationsService.delete(id);
    }
    // Helper endpoints for creating specific notification types
    createAppointmentReminder(body, userId) {
        return this.notificationsService.createAppointmentReminder(userId, body.appointmentId, new Date(body.appointmentTime), body.therapistName);
    }
    createMessageNotification(body, userId) {
        return this.notificationsService.createMessageNotification(userId, body.senderId, body.senderName, body.conversationId);
    }
    createWorksheetAssignedNotification(body, userId) {
        return this.notificationsService.createWorksheetAssignedNotification(userId, body.worksheetId, body.worksheetTitle, body.therapistName);
    }
    createTherapistApplicationNotification(body, userId) {
        return this.notificationsService.createTherapistApplicationNotification(userId, body.status);
    }
    createReviewRequestNotification(body, userId) {
        return this.notificationsService.createReviewRequestNotification(userId, body.therapistId, body.therapistName, body.sessionId);
    }
    createCommunityPostNotification(body, userId) {
        return this.notificationsService.createCommunityPostNotification(userId, body.postId, body.communityName, body.authorName);
    }
};
exports.NotificationsController = NotificationsController;
__decorate([
    (0, common_1.Post)(),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "create", null);
__decorate([
    (0, common_1.Get)(),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(commons_1.NotificationQuerySchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)('unread-count'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "getUnreadCount", null);
__decorate([
    (0, common_1.Get)('settings'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "getNotificationSettings", null);
__decorate([
    (0, common_1.Patch)('settings'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "updateNotificationSettings", null);
__decorate([
    (0, common_1.Get)(':id'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "findOne", null);
__decorate([
    (0, common_1.Patch)(':id/read'),
    (0, swagger_1.ApiOperation)({
        summary: 'Mark notification as read',
        description: 'Mark a specific notification as read',
    }),
    (0, swagger_1.ApiParam)({ name: 'id', description: 'Notification ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Notification marked as read' }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Notification not found' }),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "markAsRead", null);
__decorate([
    (0, common_1.Patch)('mark-all-read'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "markAllAsRead", null);
__decorate([
    (0, common_1.Delete)(':id'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)('appointment-reminder'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createAppointmentReminder", null);
__decorate([
    (0, common_1.Post)('message-notification'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createMessageNotification", null);
__decorate([
    (0, common_1.Post)('worksheet-assigned'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createWorksheetAssignedNotification", null);
__decorate([
    (0, common_1.Post)('therapist-application'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createTherapistApplicationNotification", null);
__decorate([
    (0, common_1.Post)('review-request'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createReviewRequestNotification", null);
__decorate([
    (0, common_1.Post)('community-post'),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", void 0)
], NotificationsController.prototype, "createCommunityPostNotification", null);
exports.NotificationsController = NotificationsController = __decorate([
    (0, swagger_1.ApiTags)('notifications'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('notifications'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof notifications_service_1.NotificationsService !== "undefined" && notifications_service_1.NotificationsService) === "function" ? _a : Object])
], NotificationsController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9ucy5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FVd0I7QUFDeEIsbUVBQStEO0FBQy9ELG1FQUE4RDtBQUM5RCw2RkFBOEU7QUFDOUUsOEVBQXlFO0FBQ3pFLDhDQUcwQjtBQUUxQiw2Q0FReUI7QUFNbEIsSUFBTSx1QkFBdUIsR0FBN0IsTUFBTSx1QkFBdUI7SUFDTDtJQUE3QixZQUE2QixvQkFBMEM7UUFBMUMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtJQUFHLENBQUM7SUFHM0UsTUFBTSxDQUVKLElBUUMsRUFDZ0IsTUFBYztRQUUvQixPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUM7WUFDdEMsR0FBRyxJQUFJO1lBQ1AsTUFBTTtZQUNOLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7U0FDMUUsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUdELE9BQU8sQ0FDWSxNQUFjLEVBRS9CLEtBQXdCO1FBRXhCLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FDdEMsTUFBTSxFQUNOLEtBQUssQ0FBQyxNQUFNLEVBQ1osS0FBSyxDQUFDLElBQUksRUFDVixLQUFLLENBQUMsUUFBUSxDQUNmLENBQUM7SUFDSixDQUFDO0lBR0QsY0FBYyxDQUFrQixNQUFjO1FBQzVDLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBR0QsdUJBQXVCLENBQWtCLE1BQWM7UUFDckQsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkUs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QUFJLEVBQUMsc0JBQXNCLENBQUM7SUFFMUIsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBO0lBTU4sV0FBQSxJQUFBLHlDQUFhLEdBQUUsQ0FBQTs7Ozt3RUFRakI7QUFHRDtJQURDLElBQUEsYUFBSSxFQUFDLHNCQUFzQixDQUFDO0lBRTFCLFdBQUEsSUFBQSxhQUFJLEdBQUUsQ0FBQTtJQU1OLFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7Ozs7d0VBUWpCO0FBR0Q7SUFEQyxJQUFBLGFBQUksRUFBQyxvQkFBb0IsQ0FBQztJQUV4QixXQUFBLElBQUEsYUFBSSxHQUFFLENBQUE7SUFNTixXQUFBLElBQUEseUNBQWEsR0FBRSxDQUFBOzs7O2tGQVFqQjtBQUdEO0lBREMsSUFBQSxhQUFJLEVBQUMsdUJBQXVCLENBQUM7SUFFM0IsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBO0lBSU4sV0FBQSxJQUFBLHlDQUFhLEdBQUUsQ0FBQTs7OztxRkFNakI7QUFHRDtJQURDLElBQUEsYUFBSSxFQUFDLGdCQUFnQixDQUFDO0lBRXBCLFdBQUEsSUFBQSxhQUFJLEdBQUUsQ0FBQTtJQU1OLFdBQUEsSUFBQSx5Q0FBYSxHQUFFLENBQUE7Ozs7OEVBUWpCO0FBR0Q7SUFEQyxJQUFBLGFBQUksRUFBQyxnQkFBZ0IsQ0FBQztJQUVwQixXQUFBLElBQUEsYUFBSSxHQUFFLENBQUE7SUFNTixXQUFBLElBQUEseUNBQWEsR0FBRSxDQUFBOzs7OzhFQVFqQjtrQ0E3TVUsdUJBQXVCO0lBSm5DLElBQUEsaUJBQU8sRUFBQyxlQUFlLENBQUM7SUFDeEIsSUFBQSx1QkFBYSxFQUFDLFVBQVUsQ0FBQztJQUN6QixJQUFBLG1CQUFVLEVBQUMsZUFBZSxDQUFDO0lBQzNCLElBQUEsa0JBQVMsRUFBQyw2QkFBWSxDQUFDO3lEQUU2Qiw0Q0FBb0Isb0JBQXBCLDRDQUFvQjtHQUQ1RCx1QkFBdUIsQ0E4TW5DIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9ub3RpZmljYXRpb25zL25vdGlmaWNhdGlvbnMuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb250cm9sbGVyLFxuICBHZXQsXG4gIFBvc3QsXG4gIEJvZHksXG4gIFBhdGNoLFxuICBQYXJhbSxcbiAgRGVsZXRlLFxuICBRdWVyeSxcbiAgVXNlR3VhcmRzLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25zU2VydmljZSB9IGZyb20gJy4vbm90aWZpY2F0aW9ucy5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJ3NyYy9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBDdXJyZW50VXNlcklkIH0gZnJvbSAnc3JjL2F1dGgvZGVjb3JhdG9ycy9jdXJyZW50LXVzZXItaWQuZGVjb3JhdG9yJztcbmltcG9ydCB7IFpvZFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnc3JjL2NvbW1vbi9waXBlcy96b2QtdmFsaWRhdGlvbi5waXBlJztcbmltcG9ydCB7XG4gIE5vdGlmaWNhdGlvblF1ZXJ5U2NoZW1hLFxuICB0eXBlIE5vdGlmaWNhdGlvblF1ZXJ5LFxufSBmcm9tICdAbWVudGFyYS9jb21tb25zJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblR5cGUsIE5vdGlmaWNhdGlvblByaW9yaXR5IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHtcbiAgQXBpVGFncyxcbiAgQXBpT3BlcmF0aW9uLFxuICBBcGlSZXNwb25zZSxcbiAgQXBpQm9keSxcbiAgQXBpQmVhcmVyQXV0aCxcbiAgQXBpUGFyYW0sXG4gIEFwaVF1ZXJ5LFxufSBmcm9tICdAbmVzdGpzL3N3YWdnZXInO1xuXG5AQXBpVGFncygnbm90aWZpY2F0aW9ucycpXG5AQXBpQmVhcmVyQXV0aCgnSldULWF1dGgnKVxuQENvbnRyb2xsZXIoJ25vdGlmaWNhdGlvbnMnKVxuQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uc0NvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IG5vdGlmaWNhdGlvbnNTZXJ2aWNlOiBOb3RpZmljYXRpb25zU2VydmljZSkge31cblxuICBAUG9zdCgpXG4gIGNyZWF0ZShcbiAgICBAQm9keSgpXG4gICAgYm9keToge1xuICAgICAgdGl0bGU6IHN0cmluZztcbiAgICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICAgIHR5cGU6IE5vdGlmaWNhdGlvblR5cGU7XG4gICAgICBwcmlvcml0eT86IE5vdGlmaWNhdGlvblByaW9yaXR5O1xuICAgICAgZGF0YT86IGFueTtcbiAgICAgIGFjdGlvblVybD86IHN0cmluZztcbiAgICAgIHNjaGVkdWxlZEZvcj86IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICAuLi5ib2R5LFxuICAgICAgdXNlcklkLFxuICAgICAgc2NoZWR1bGVkRm9yOiBib2R5LnNjaGVkdWxlZEZvciA/IG5ldyBEYXRlKGJvZHkuc2NoZWR1bGVkRm9yKSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcbiAgfVxuXG4gIEBHZXQoKVxuICBmaW5kQWxsKFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShOb3RpZmljYXRpb25RdWVyeVNjaGVtYSkpXG4gICAgcXVlcnk6IE5vdGlmaWNhdGlvblF1ZXJ5LFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5maW5kQWxsKFxuICAgICAgdXNlcklkLFxuICAgICAgcXVlcnkuaXNSZWFkLFxuICAgICAgcXVlcnkudHlwZSxcbiAgICAgIHF1ZXJ5LnByaW9yaXR5LFxuICAgICk7XG4gIH1cblxuICBAR2V0KCd1bnJlYWQtY291bnQnKVxuICBnZXRVbnJlYWRDb3VudChAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuZ2V0VW5yZWFkQ291bnQodXNlcklkKTtcbiAgfVxuXG4gIEBHZXQoJ3NldHRpbmdzJylcbiAgZ2V0Tm90aWZpY2F0aW9uU2V0dGluZ3MoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmdldE5vdGlmaWNhdGlvblNldHRpbmdzKHVzZXJJZCk7XG4gIH1cblxuICBAUGF0Y2goJ3NldHRpbmdzJylcbiAgdXBkYXRlTm90aWZpY2F0aW9uU2V0dGluZ3MoXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIGVtYWlsQXBwb2ludG1lbnRSZW1pbmRlcnM/OiBib29sZWFuO1xuICAgICAgZW1haWxOZXdNZXNzYWdlcz86IGJvb2xlYW47XG4gICAgICBlbWFpbFdvcmtzaGVldFVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgZW1haWxTeXN0ZW1VcGRhdGVzPzogYm9vbGVhbjtcbiAgICAgIGVtYWlsTWFya2V0aW5nPzogYm9vbGVhbjtcbiAgICAgIHB1c2hBcHBvaW50bWVudFJlbWluZGVycz86IGJvb2xlYW47XG4gICAgICBwdXNoTmV3TWVzc2FnZXM/OiBib29sZWFuO1xuICAgICAgcHVzaFdvcmtzaGVldFVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgcHVzaFN5c3RlbVVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgaW5BcHBNZXNzYWdlcz86IGJvb2xlYW47XG4gICAgICBpbkFwcFVwZGF0ZXM/OiBib29sZWFuO1xuICAgICAgcXVpZXRIb3Vyc0VuYWJsZWQ/OiBib29sZWFuO1xuICAgICAgcXVpZXRIb3Vyc1N0YXJ0Pzogc3RyaW5nO1xuICAgICAgcXVpZXRIb3Vyc0VuZD86IHN0cmluZztcbiAgICAgIHF1aWV0SG91cnNUaW1lem9uZT86IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLnVwZGF0ZU5vdGlmaWNhdGlvblNldHRpbmdzKHVzZXJJZCwgYm9keSk7XG4gIH1cblxuICBAR2V0KCc6aWQnKVxuICBmaW5kT25lKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuZmluZE9uZShpZCk7XG4gIH1cblxuICBAUGF0Y2goJzppZC9yZWFkJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ01hcmsgbm90aWZpY2F0aW9uIGFzIHJlYWQnLFxuICAgIGRlc2NyaXB0aW9uOiAnTWFyayBhIHNwZWNpZmljIG5vdGlmaWNhdGlvbiBhcyByZWFkJyxcbiAgfSlcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2lkJywgZGVzY3JpcHRpb246ICdOb3RpZmljYXRpb24gSUQnIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ05vdGlmaWNhdGlvbiBtYXJrZWQgYXMgcmVhZCcgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwNCwgZGVzY3JpcHRpb246ICdOb3RpZmljYXRpb24gbm90IGZvdW5kJyB9KVxuICBtYXJrQXNSZWFkKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UubWFya0FzUmVhZChpZCk7XG4gIH1cblxuICBAUGF0Y2goJ21hcmstYWxsLXJlYWQnKVxuICBtYXJrQWxsQXNSZWFkKEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5tYXJrQWxsQXNSZWFkKHVzZXJJZCk7XG4gIH1cblxuICBARGVsZXRlKCc6aWQnKVxuICByZW1vdmUoQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5kZWxldGUoaWQpO1xuICB9XG5cbiAgLy8gSGVscGVyIGVuZHBvaW50cyBmb3IgY3JlYXRpbmcgc3BlY2lmaWMgbm90aWZpY2F0aW9uIHR5cGVzXG5cbiAgQFBvc3QoJ2FwcG9pbnRtZW50LXJlbWluZGVyJylcbiAgY3JlYXRlQXBwb2ludG1lbnRSZW1pbmRlcihcbiAgICBAQm9keSgpXG4gICAgYm9keToge1xuICAgICAgYXBwb2ludG1lbnRJZDogc3RyaW5nO1xuICAgICAgYXBwb2ludG1lbnRUaW1lOiBzdHJpbmc7XG4gICAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmc7XG4gICAgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5jcmVhdGVBcHBvaW50bWVudFJlbWluZGVyKFxuICAgICAgdXNlcklkLFxuICAgICAgYm9keS5hcHBvaW50bWVudElkLFxuICAgICAgbmV3IERhdGUoYm9keS5hcHBvaW50bWVudFRpbWUpLFxuICAgICAgYm9keS50aGVyYXBpc3ROYW1lLFxuICAgICk7XG4gIH1cblxuICBAUG9zdCgnbWVzc2FnZS1ub3RpZmljYXRpb24nKVxuICBjcmVhdGVNZXNzYWdlTm90aWZpY2F0aW9uKFxuICAgIEBCb2R5KClcbiAgICBib2R5OiB7XG4gICAgICBzZW5kZXJJZDogc3RyaW5nO1xuICAgICAgc2VuZGVyTmFtZTogc3RyaW5nO1xuICAgICAgY29udmVyc2F0aW9uSWQ6IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZU1lc3NhZ2VOb3RpZmljYXRpb24oXG4gICAgICB1c2VySWQsXG4gICAgICBib2R5LnNlbmRlcklkLFxuICAgICAgYm9keS5zZW5kZXJOYW1lLFxuICAgICAgYm9keS5jb252ZXJzYXRpb25JZCxcbiAgICApO1xuICB9XG5cbiAgQFBvc3QoJ3dvcmtzaGVldC1hc3NpZ25lZCcpXG4gIGNyZWF0ZVdvcmtzaGVldEFzc2lnbmVkTm90aWZpY2F0aW9uKFxuICAgIEBCb2R5KClcbiAgICBib2R5OiB7XG4gICAgICB3b3Jrc2hlZXRJZDogc3RyaW5nO1xuICAgICAgd29ya3NoZWV0VGl0bGU6IHN0cmluZztcbiAgICAgIHRoZXJhcGlzdE5hbWU6IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZVdvcmtzaGVldEFzc2lnbmVkTm90aWZpY2F0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgYm9keS53b3Jrc2hlZXRJZCxcbiAgICAgIGJvZHkud29ya3NoZWV0VGl0bGUsXG4gICAgICBib2R5LnRoZXJhcGlzdE5hbWUsXG4gICAgKTtcbiAgfVxuXG4gIEBQb3N0KCd0aGVyYXBpc3QtYXBwbGljYXRpb24nKVxuICBjcmVhdGVUaGVyYXBpc3RBcHBsaWNhdGlvbk5vdGlmaWNhdGlvbihcbiAgICBAQm9keSgpXG4gICAgYm9keToge1xuICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnIHwgJ3JlamVjdGVkJztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZVRoZXJhcGlzdEFwcGxpY2F0aW9uTm90aWZpY2F0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgYm9keS5zdGF0dXMsXG4gICAgKTtcbiAgfVxuXG4gIEBQb3N0KCdyZXZpZXctcmVxdWVzdCcpXG4gIGNyZWF0ZVJldmlld1JlcXVlc3ROb3RpZmljYXRpb24oXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIHRoZXJhcGlzdElkOiBzdHJpbmc7XG4gICAgICB0aGVyYXBpc3ROYW1lOiBzdHJpbmc7XG4gICAgICBzZXNzaW9uSWQ6IHN0cmluZztcbiAgICB9LFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmNyZWF0ZVJldmlld1JlcXVlc3ROb3RpZmljYXRpb24oXG4gICAgICB1c2VySWQsXG4gICAgICBib2R5LnRoZXJhcGlzdElkLFxuICAgICAgYm9keS50aGVyYXBpc3ROYW1lLFxuICAgICAgYm9keS5zZXNzaW9uSWQsXG4gICAgKTtcbiAgfVxuXG4gIEBQb3N0KCdjb21tdW5pdHktcG9zdCcpXG4gIGNyZWF0ZUNvbW11bml0eVBvc3ROb3RpZmljYXRpb24oXG4gICAgQEJvZHkoKVxuICAgIGJvZHk6IHtcbiAgICAgIHBvc3RJZDogc3RyaW5nO1xuICAgICAgY29tbXVuaXR5TmFtZTogc3RyaW5nO1xuICAgICAgYXV0aG9yTmFtZTogc3RyaW5nO1xuICAgIH0sXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uc1NlcnZpY2UuY3JlYXRlQ29tbXVuaXR5UG9zdE5vdGlmaWNhdGlvbihcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJvZHkucG9zdElkLFxuICAgICAgYm9keS5jb21tdW5pdHlOYW1lLFxuICAgICAgYm9keS5hdXRob3JOYW1lLFxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==