54304203494788403c9543f932a8da6a
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TherapistRecommendationService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TherapistRecommendationService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const advanced_matching_service_1 = require("./services/advanced-matching.service");
const compatibility_analysis_service_1 = require("./services/compatibility-analysis.service");
const pre_assessment_service_1 = require("../pre-assessment/pre-assessment.service");
let TherapistRecommendationService = TherapistRecommendationService_1 = class TherapistRecommendationService {
    prisma;
    advancedMatching;
    compatibilityAnalysis;
    preAssessmentService;
    logger = new common_1.Logger(TherapistRecommendationService_1.name);
    constructor(prisma, advancedMatching, compatibilityAnalysis, preAssessmentService) {
        this.prisma = prisma;
        this.advancedMatching = advancedMatching;
        this.compatibilityAnalysis = compatibilityAnalysis;
        this.preAssessmentService = preAssessmentService;
    }
    calculateYearsOfExperience(startDate) {
        const now = new Date();
        let years = now.getFullYear() - startDate.getFullYear();
        if (now.getMonth() < startDate.getMonth() ||
            (now.getMonth() === startDate.getMonth() &&
                now.getDate() < startDate.getDate())) {
            years--;
        }
        return years;
    }
    async getRecommendedTherapists(request) {
        // Input validation
        if (!request?.userId) {
            throw new common_1.BadRequestException('User ID is required');
        }
        if (request.limit && (request.limit < 1 || request.limit > 100)) {
            throw new common_1.BadRequestException('Limit must be between 1 and 100');
        }
        this.logger.log(`Getting enhanced recommendations for user ${request.userId} with limit ${request.limit || 10}`);
        try {
            // Get user's comprehensive data including preferences
            const user = await this.prisma.client.findUnique({
                where: { userId: request.userId },
                include: {
                    preAssessment: true,
                    user: true,
                },
            });
            if (!user) {
                this.logger.warn(`User not found: ${request.userId}`);
                throw new common_1.NotFoundException('User not found');
            }
            // Handle users without pre-assessment more gracefully
            if (!user.preAssessment) {
                this.logger.warn(`No pre-assessment found for user: ${request.userId}, using basic recommendations`);
                // Provide basic recommendations for users without pre-assessment
                return await this.getBasicTherapistRecommendations(request, user);
            }
            // Get comprehensive clinical analysis for enhanced matching
            let clinicalAnalysis;
            try {
                clinicalAnalysis =
                    await this.preAssessmentService.getComprehensiveClinicalAnalysis(request.userId);
                this.logger.log(`Enhanced clinical insights available: ${clinicalAnalysis.clinicalProfile.primaryConditions.length} primary conditions`);
            }
            catch (analysisError) {
                this.logger.warn('Advanced clinical analysis unavailable, using basic assessment:', analysisError);
                clinicalAnalysis = null;
            }
            // Extract user conditions and severity levels
            const userConditions = this.extractUserConditions(user.preAssessment);
            // Extract severity levels from the answers JSON field
            const answers = user.preAssessment.answers;
            const severityLevels = answers?.severityLevels;
            // Enhanced therapist filtering based on clinical insights
            const therapistWhere = {
                status: 'APPROVED',
                ...(request.province && { province: request.province }),
                ...(request.maxHourlyRate && {
                    hourlyRate: { lte: request.maxHourlyRate },
                }),
            };
            // Apply enhanced filtering based on clinical analysis
            if (clinicalAnalysis?.treatmentPlan?.therapistCriteria) {
                const criteria = clinicalAnalysis.treatmentPlan.therapistCriteria;
                // Filter by required specializations
                if (criteria.requiredSpecializations.length > 0) {
                    therapistWhere.OR = criteria.requiredSpecializations.map((spec) => ({
                        expertise: { has: spec },
                    }));
                }
                // Filter by experience level
                if (criteria.experienceLevel !== 'any') {
                    const minYears = {
                        intermediate: 3,
                        senior: 7,
                        expert: 12,
                    }[criteria.experienceLevel] || 0;
                    therapistWhere.yearsOfExperience = { gte: minYears };
                }
            }
            // Fetch therapists with comprehensive data
            const therapists = await this.prisma.therapist.findMany({
                where: therapistWhere,
                orderBy: { createdAt: 'desc' },
                take: Math.min(request.limit ?? 10, 50), // Increase limit for better filtering
                include: {
                    user: true,
                    reviews: {
                        select: {
                            rating: true,
                        },
                    },
                },
            });
            // Use advanced matching algorithm with proper error handling and logging
            const therapistScores = [];
            let advancedMatchingFailures = 0;
            for (const therapist of therapists) {
                try {
                    // Cast user to proper type now that we've validated all required fields exist
                    const clientForMatching = {
                        ...user,
                        preAssessment: user.preAssessment,
                        user: user.user,
                    };
                    const therapistForMatching = {
                        ...therapist,
                        user: therapist.user,
                        reviews: therapist.reviews || [],
                    };
                    const score = await this.advancedMatching.calculateAdvancedMatch(clientForMatching, therapistForMatching);
                    therapistScores.push(score);
                }
                catch (error) {
                    advancedMatchingFailures++;
                    // Log detailed error information for debugging
                    this.logger.error(`Advanced matching failed for therapist ${therapist.userId}`, {
                        error: error instanceof Error ? error.message : String(error),
                        stack: error instanceof Error ? error.stack : undefined,
                        therapistId: therapist.userId,
                        userId: request.userId,
                    });
                    // Fallback to basic scoring with clear indication this is a fallback
                    try {
                        const basicScore = this.calculateMatchScore(therapist, userConditions);
                        const therapistForMatching = {
                            ...therapist,
                            user: therapist.user,
                            reviews: therapist.reviews || [],
                        };
                        therapistScores.push({
                            therapist: therapistForMatching,
                            totalScore: basicScore,
                            breakdown: {
                                conditionScore: Math.round(basicScore * 0.6),
                                approachScore: 0,
                                experienceScore: Math.round(basicScore * 0.4),
                                reviewScore: 0,
                                logisticsScore: 0,
                            },
                            matchExplanation: {
                                primaryMatches: this.getPrimaryConditions(userConditions),
                                secondaryMatches: this.getSecondaryConditions(userConditions),
                                approachMatches: [],
                                experienceYears: this.calculateYearsOfExperience(therapist.practiceStartDate),
                                averageRating: 0,
                                totalReviews: 0,
                                successRates: {},
                            },
                        });
                        this.logger.warn(`Using basic scoring fallback for therapist ${therapist.userId} due to advanced matching failure`);
                    }
                    catch (basicScoringError) {
                        // If even basic scoring fails, log and skip this therapist
                        this.logger.error(`Both advanced and basic scoring failed for therapist ${therapist.userId}`, {
                            advancedError: error instanceof Error ? error.message : String(error),
                            basicError: basicScoringError instanceof Error
                                ? basicScoringError.message
                                : String(basicScoringError),
                            therapistId: therapist.userId,
                            userId: request.userId,
                        });
                        // Skip this therapist entirely
                        continue;
                    }
                }
            }
            // Log summary of matching performance
            this.logger.log(`Matching completed for user ${request.userId}: ${therapistScores.length} successful matches, ${advancedMatchingFailures} fallbacks`);
            // Sort by total score descending
            const sortedTherapistScores = therapistScores.sort((a, b) => b.totalScore - a.totalScore);
            // Take only the requested number of results
            const finalResults = sortedTherapistScores.slice(0, request.limit ?? 10);
            // Track recommendation analytics - removed due to missing MatchingAnalyticsService
            // Transform to expected format with enhanced insights
            const therapistsWithScores = finalResults.map((score) => {
                const therapistData = {
                    ...score.therapist,
                    matchScore: score.totalScore,
                    scoreBreakdown: score.breakdown,
                    matchExplanation: score.matchExplanation,
                };
                // Add clinical insights if available
                if (clinicalAnalysis) {
                    therapistData.clinicalMatch = {
                        urgencyAlignment: this.assessUrgencyAlignment(score.therapist, clinicalAnalysis),
                        specializationMatch: this.assessSpecializationMatch(score.therapist, clinicalAnalysis),
                        experienceAdequacy: this.assessExperienceAdequacy(score.therapist, clinicalAnalysis),
                        approachCompatibility: this.assessApproachCompatibility(score.therapist, clinicalAnalysis),
                    };
                }
                return therapistData;
            });
            // Determine primary and secondary conditions (enhanced if clinical analysis available)
            const primaryConditions = clinicalAnalysis
                ? clinicalAnalysis.clinicalProfile.primaryConditions.map((pc) => pc.condition)
                : this.getPrimaryConditions(userConditions);
            const secondaryConditions = clinicalAnalysis
                ? clinicalAnalysis.clinicalProfile.secondaryConditions.map((sc) => sc.condition)
                : this.getSecondaryConditions(userConditions);
            return {
                totalCount: therapistsWithScores.length,
                userConditions: Object.keys(userConditions),
                therapists: therapistsWithScores,
                matchCriteria: {
                    primaryConditions,
                    secondaryConditions,
                    severityLevels,
                    ...(clinicalAnalysis && {
                        riskLevel: clinicalAnalysis.riskAssessment.overallRisk,
                        urgencyLevel: clinicalAnalysis.treatmentPlan.therapistCriteria.urgencyLevel,
                        requiredSpecializations: clinicalAnalysis.treatmentPlan.therapistCriteria
                            .requiredSpecializations,
                        preferredApproaches: clinicalAnalysis.treatmentPlan.therapistCriteria
                            .preferredApproaches,
                    }),
                },
                clinicalInsights: clinicalAnalysis
                    ? {
                        overallRiskLevel: clinicalAnalysis.clinicalProfile.overallRiskLevel,
                        primaryConditionsCount: clinicalAnalysis.clinicalProfile.primaryConditions.length,
                        therapeuticPriorities: clinicalAnalysis.clinicalProfile.therapeuticPriorities.slice(0, 3),
                        recommendedSessionFrequency: clinicalAnalysis.treatmentPlan.therapistCriteria
                            .sessionFrequency,
                    }
                    : null,
                page: 1,
                pageSize: request.limit ?? 10,
            };
        }
        catch (error) {
            // Handle specific error types with appropriate logging and responses
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.BadRequestException) {
                // Re-throw validation and not found errors as-is
                throw error;
            }
            // Log unexpected errors with full context
            this.logger.error(`Unexpected error in getRecommendedTherapists for user ${request.userId}`, {
                error: error instanceof Error ? error.message : String(error),
                stack: error instanceof Error ? error.stack : undefined,
                userId: request.userId,
                requestParams: {
                    limit: request.limit,
                    province: request.province,
                    maxHourlyRate: request.maxHourlyRate,
                },
            });
            // Provide generic error message to client while logging specifics
            throw new common_1.InternalServerErrorException('Failed to get therapist recommendations. Please try again later.');
        }
    }
    /**
     * Get basic therapist recommendations for users without pre-assessment
     */
    async getBasicTherapistRecommendations(request, user) {
        this.logger.log(`Getting basic recommendations for user ${request.userId} (no pre-assessment)`);
        try {
            // Basic therapist filtering without clinical analysis
            const therapistWhere = {
                status: 'APPROVED',
                ...(request.province && { province: request.province }),
                ...(request.maxHourlyRate && {
                    hourlyRate: { lte: request.maxHourlyRate },
                }),
            };
            // Fetch therapists with basic data
            const therapists = await this.prisma.therapist.findMany({
                where: therapistWhere,
                orderBy: [
                    { createdAt: 'desc' },
                    { yearsOfExperience: 'desc' },
                ],
                take: Math.min(request.limit ?? 10, 20),
                include: {
                    user: true,
                    reviews: {
                        select: {
                            rating: true,
                        },
                    },
                },
            });
            this.logger.log(`Found ${therapists.length} approved therapists for basic recommendations`);
            if (therapists.length === 0) {
                this.logger.warn('No approved therapists found in database');
                return {
                    totalCount: 0,
                    recommendations: [],
                    message: 'No therapists available at this time. Please try again later.',
                    userConditions: [],
                    therapists: [],
                    matchCriteria: {
                        primaryConditions: [],
                        secondaryConditions: [],
                        severityLevels: {},
                    },
                    clinicalInsights: null,
                    page: 1,
                    pageSize: request.limit ?? 10,
                };
            }
            // Calculate basic scores based on experience and ratings
            const therapistsWithScores = therapists.map((therapist, index) => {
                const experienceYears = therapist.yearsOfExperience ||
                    this.calculateYearsOfExperience(therapist.practiceStartDate);
                const reviews = therapist.reviews || [];
                const averageRating = reviews.length > 0 ?
                    reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length : 0;
                // Basic scoring: experience (60%) + rating (40%)
                const experienceScore = Math.min(experienceYears * 10, 60);
                const ratingScore = averageRating * 8;
                const totalScore = experienceScore + ratingScore;
                return {
                    ...therapist,
                    userId: therapist.userId, // Ensure userId is available as id
                    id: therapist.userId,
                    matchScore: Math.round(totalScore),
                    score: Math.round(totalScore),
                    rank: index + 1,
                    experience: experienceYears,
                    rating: averageRating,
                    totalReviews: reviews.length,
                    // Add frontend-expected fields
                    firstName: therapist.user.firstName,
                    lastName: therapist.user.lastName,
                    specialties: therapist.expertise || [],
                    bio: `${experienceYears} years of experience in mental health therapy`,
                    scoreBreakdown: {
                        conditionScore: 0,
                        approachScore: 0,
                        experienceScore: Math.round(experienceScore),
                        reviewScore: Math.round(ratingScore),
                        logisticsScore: 20, // Base logistics score
                    },
                    matchExplanation: {
                        primaryMatches: [],
                        secondaryMatches: [],
                        approachMatches: [],
                        experienceYears,
                        averageRating,
                        totalReviews: reviews.length,
                        successRates: {},
                    },
                };
            });
            // Sort by score descending
            const sortedTherapists = therapistsWithScores
                .sort((a, b) => b.matchScore - a.matchScore)
                .slice(0, request.limit ?? 10);
            return {
                totalCount: sortedTherapists.length,
                recommendations: sortedTherapists, // Frontend expects this field
                userConditions: [],
                therapists: sortedTherapists,
                matchCriteria: {
                    primaryConditions: [],
                    secondaryConditions: [],
                    severityLevels: {},
                    note: 'Basic recommendations - complete your mental health assessment for personalized matches',
                },
                clinicalInsights: null,
                page: 1,
                pageSize: request.limit ?? 10,
                welcomeMessage: `Hello ${user.user.firstName}! We've found some great therapists for you. Complete your mental health assessment to get personalized recommendations.`,
                isFirstTime: true,
                userInfo: {
                    firstName: user.user.firstName,
                    memberSince: user.user.createdAt,
                    needsOnboarding: true,
                },
                nextSteps: {
                    canSendRequests: true,
                    recommendedActions: [
                        'Complete your mental health assessment for better matches',
                        'Browse therapist profiles',
                        'Send requests to therapists you find interesting',
                        'Complete your profile for improved recommendations',
                    ],
                },
                matchingInsights: {
                    totalAvailableTherapists: sortedTherapists.length,
                    totalAvailableCommunities: 0,
                    recommendationEngine: 'Basic experience and rating-based matching',
                    lastUpdated: new Date(),
                },
            };
        }
        catch (error) {
            this.logger.error(`Error in getBasicTherapistRecommendations for user ${request.userId}`, {
                error: error instanceof Error ? error.message : String(error),
                stack: error instanceof Error ? error.stack : undefined,
            });
            // Return safe fallback
            return {
                totalCount: 0,
                recommendations: [],
                userConditions: [],
                therapists: [],
                matchCriteria: {
                    primaryConditions: [],
                    secondaryConditions: [],
                    severityLevels: {},
                },
                clinicalInsights: null,
                page: 1,
                pageSize: request.limit ?? 10,
                error: 'Unable to load therapist recommendations at this time',
            };
        }
    }
    /**
     * Get detailed compatibility analysis between a client and therapist
     */
    async getCompatibilityAnalysis(clientId, therapistId) {
        const client = await this.prisma.client.findUnique({
            where: { userId: clientId },
            include: {
                preAssessment: true,
                user: true,
            },
        });
        const therapist = await this.prisma.therapist.findUnique({
            where: { userId: therapistId },
            include: {
                user: true,
                reviews: {
                    select: {
                        rating: true,
                    },
                },
            },
        });
        if (!client || !therapist) {
            throw new common_1.NotFoundException('Client or therapist not found');
        }
        if (!client.preAssessment) {
            throw new common_1.NotFoundException('No pre-assessment found for client');
        }
        const compatibility = await this.compatibilityAnalysis.analyzeCompatibility(client, // Safe because we verified preAssessment exists above
        therapist);
        // Track compatibility analysis - removed due to missing MatchingAnalyticsService
        return compatibility;
    }
    extractUserConditions(preAssessment) {
        const conditions = {};
        // Extract data from the answers JSON field
        const answers = preAssessment.answers;
        const severityLevels = answers?.severityLevels;
        const questionnaires = answers?.questionnaires;
        if (questionnaires && severityLevels) {
            questionnaires.forEach((q) => {
                if (severityLevels[q]) {
                    conditions[q] = severityLevels[q];
                }
            });
        }
        return conditions;
    }
    calculateMatchScore(therapist, userConditions) {
        let score = 0;
        const expertise = therapist.expertise || [];
        Object.keys(userConditions).forEach((condition) => {
            if (expertise.includes(condition))
                score += 20;
        });
        score += Math.min(this.calculateYearsOfExperience(therapist.practiceStartDate) * 2, 20);
        // Add base score for experience
        score += therapist.yearsOfExperience ? therapist.yearsOfExperience * 2 : 0;
        return score;
    }
    getPrimaryConditions(userConditions) {
        return Object.entries(userConditions)
            .filter(([, severity]) => this.getSeverityWeight(severity) >= 4)
            .map(([condition]) => condition);
    }
    getSecondaryConditions(userConditions) {
        return Object.entries(userConditions)
            .filter(([, severity]) => {
            const weight = this.getSeverityWeight(severity);
            return weight >= 2 && weight < 4;
        })
            .map(([condition]) => condition);
    }
    getSeverityWeight(severity) {
        const severityWeights = {
            Minimal: 1,
            Mild: 2,
            Moderate: 3,
            'Moderately Severe': 4,
            Severe: 5,
            'Very Severe': 5,
            Extreme: 5,
            Low: 1,
            High: 4,
            Substantial: 4,
            Subclinical: 1,
            Clinical: 4,
            None: 0,
            Subthreshold: 2,
            Positive: 4,
            Negative: 0,
        };
        return severityWeights[severity] || 1;
    }
    /**
     * Assess how well therapist's availability aligns with client's urgency needs
     */
    assessUrgencyAlignment(therapist, clinicalAnalysis) {
        const urgencyLevel = clinicalAnalysis.treatmentPlan.therapistCriteria.urgencyLevel;
        const riskLevel = clinicalAnalysis.riskAssessment.overallRisk;
        let score = 70; // Base score
        let reasoning = 'Standard availability alignment';
        // Check if therapist can handle urgent cases
        if (urgencyLevel === 'immediate' || riskLevel === 'critical') {
            if (therapist.acceptsEmergencyAppointments ||
                therapist.hasImmediateAvailability) {
                score = 95;
                reasoning =
                    'Excellent for crisis intervention - immediate availability';
            }
            else {
                score = 30;
                reasoning = 'May not be suitable for immediate intervention needs';
            }
        }
        else if (urgencyLevel === 'high') {
            if (therapist.weeklyAvailability || therapist.flexibleScheduling) {
                score = 85;
                reasoning = 'Good availability for urgent therapeutic needs';
            }
        }
        return { score, reasoning };
    }
    /**
     * Assess therapist's specialization match with client's conditions
     */
    assessSpecializationMatch(therapist, clinicalAnalysis) {
        const requiredSpecs = clinicalAnalysis.treatmentPlan.therapistCriteria.requiredSpecializations;
        const therapistSpecs = [
            ...(therapist.expertise || []),
            ...(therapist.illnessSpecializations || []),
        ];
        const matchedSpecs = requiredSpecs.filter((req) => therapistSpecs.some((spec) => spec.toLowerCase().includes(req.toLowerCase()) ||
            req.toLowerCase().includes(spec.toLowerCase())));
        const matchRatio = requiredSpecs.length > 0 ? matchedSpecs.length / requiredSpecs.length : 1;
        const score = Math.round(matchRatio * 100);
        let reasoning = `Matches ${matchedSpecs.length}/${requiredSpecs.length} required specializations`;
        if (score >= 80)
            reasoning = 'Excellent specialization match';
        else if (score >= 60)
            reasoning = 'Good specialization alignment';
        else if (score >= 40)
            reasoning = 'Partial specialization match';
        else
            reasoning = 'Limited specialization match';
        return {
            score,
            matchedSpecializations: matchedSpecs,
            reasoning,
        };
    }
    /**
     * Assess if therapist has adequate experience for client's needs
     */
    assessExperienceAdequacy(therapist, clinicalAnalysis) {
        const requiredLevel = clinicalAnalysis.treatmentPlan.therapistCriteria.experienceLevel;
        const therapistYears = therapist.yearsOfExperience ||
            this.calculateYearsOfExperience(therapist.practiceStartDate);
        const requiredYears = {
            any: 0,
            intermediate: 3,
            senior: 7,
            expert: 12,
        }[requiredLevel] || 0;
        if (therapistYears >= requiredYears) {
            const score = Math.min(100, 70 + (therapistYears - requiredYears) * 3);
            return {
                score,
                reasoning: `${therapistYears} years experience meets ${requiredLevel} level requirement`,
            };
        }
        else {
            const score = Math.max(20, (therapistYears / requiredYears) * 60);
            return {
                score,
                reasoning: `${therapistYears} years experience below ${requiredLevel} level (${requiredYears}+ years)`,
            };
        }
    }
    /**
     * Assess therapist's therapeutic approach compatibility
     */
    assessApproachCompatibility(therapist, clinicalAnalysis) {
        const preferredApproaches = clinicalAnalysis.treatmentPlan.therapistCriteria.preferredApproaches;
        const therapistApproaches = [
            ...(therapist.approaches || []),
            ...(therapist.therapeuticApproachesUsedList || []),
        ];
        const matchedApproaches = preferredApproaches.filter((pref) => therapistApproaches.some((approach) => approach.toLowerCase().includes(pref.toLowerCase()) ||
            pref.toLowerCase().includes(approach.toLowerCase())));
        const matchRatio = preferredApproaches.length > 0
            ? matchedApproaches.length / preferredApproaches.length
            : 0.7;
        const score = Math.round(matchRatio * 100);
        let reasoning = `Matches ${matchedApproaches.length}/${preferredApproaches.length} preferred approaches`;
        if (score >= 80)
            reasoning = 'Excellent therapeutic approach match';
        else if (score >= 60)
            reasoning = 'Good approach compatibility';
        else if (score >= 40)
            reasoning = 'Some approach alignment';
        else
            reasoning = 'Limited approach match - may still be effective';
        return {
            score,
            matchedApproaches,
            reasoning,
        };
    }
};
exports.TherapistRecommendationService = TherapistRecommendationService;
exports.TherapistRecommendationService = TherapistRecommendationService = TherapistRecommendationService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof advanced_matching_service_1.AdvancedMatchingService !== "undefined" && advanced_matching_service_1.AdvancedMatchingService) === "function" ? _b : Object, typeof (_c = typeof compatibility_analysis_service_1.CompatibilityAnalysisService !== "undefined" && compatibility_analysis_service_1.CompatibilityAnalysisService) === "function" ? _c : Object, typeof (_d = typeof pre_assessment_service_1.PreAssessmentService !== "undefined" && pre_assessment_service_1.PreAssessmentService) === "function" ? _d : Object])
], TherapistRecommendationService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC90aGVyYXBpc3QtcmVjb21tZW5kYXRpb24uc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLDJDQU13QjtBQUN4QixnRkFBb0U7QUFNcEUsb0ZBSzhDO0FBQzlDLDhGQUF5RjtBQUN6RixxRkFBZ0Y7QUFTekUsSUFBTSw4QkFBOEIsc0NBQXBDLE1BQU0sOEJBQThCO0lBSXRCO0lBQ0E7SUFDQTtJQUNBO0lBTkYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGdDQUE4QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTFFLFlBQ21CLE1BQXFCLEVBQ3JCLGdCQUF5QyxFQUN6QyxxQkFBbUQsRUFDbkQsb0JBQTBDO1FBSDFDLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF5QjtRQUN6QywwQkFBcUIsR0FBckIscUJBQXFCLENBQThCO1FBQ25ELHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7SUFDMUQsQ0FBQztJQUVJLDBCQUEwQixDQUFDLFNBQWU7UUFDaEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsV0FBVyxFQUFFLEdBQUcsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3hELElBQ0UsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLFNBQVMsQ0FBQyxRQUFRLEVBQUU7WUFDckMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEtBQUssU0FBUyxDQUFDLFFBQVEsRUFBRTtnQkFDdEMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUN0QyxDQUFDO1lBQ0QsS0FBSyxFQUFFLENBQUM7UUFDVixDQUFDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsS0FBSyxDQUFD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QkFBOEIsQ0FvMEIxQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdGhlcmFwaXN0L3RoZXJhcGlzdC1yZWNvbW1lbmRhdGlvbi5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEluamVjdGFibGUsXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICBMb2dnZXIsXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFByaXNtYVNlcnZpY2UgfSBmcm9tICcuLi9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBQcmVBc3Nlc3NtZW50LCBUaGVyYXBpc3QsIFVzZXIsIFJldmlldywgUHJpc21hIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHR5cGUge1xuICBUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblJlcXVlc3QsXG4gIFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uUmVzcG9uc2UsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHtcbiAgQWR2YW5jZWRNYXRjaGluZ1NlcnZpY2UsXG4gIFRoZXJhcGlzdFNjb3JlLFxuICBDbGllbnRGb3JNYXRjaGluZyxcbiAgVGhlcmFwaXN0Rm9yTWF0Y2hpbmcsXG59IGZyb20gJy4vc2VydmljZXMvYWR2YW5jZWQtbWF0Y2hpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBDb21wYXRpYmlsaXR5QW5hbHlzaXNTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9jb21wYXRpYmlsaXR5LWFuYWx5c2lzLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJlQXNzZXNzbWVudFNlcnZpY2UgfSBmcm9tICcuLi9wcmUtYXNzZXNzbWVudC9wcmUtYXNzZXNzbWVudC5zZXJ2aWNlJztcblxuLy8gRGVmaW5lIHRoZSB0eXBlIGZvciB0aGVyYXBpc3Qgd2l0aCBpbmNsdWRlZCByZWxhdGlvbnNcbnR5cGUgVGhlcmFwaXN0V2l0aFJlbGF0aW9ucyA9IFRoZXJhcGlzdCAmIHtcbiAgdXNlcjogVXNlcjtcbiAgcmV2aWV3czogUGljazxSZXZpZXcsICdyYXRpbmcnPltdO1xufTtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRoZXJhcGlzdFJlY29tbWVuZGF0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblNlcnZpY2UubmFtZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcmlzbWE6IFByaXNtYVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBhZHZhbmNlZE1hdGNoaW5nOiBBZHZhbmNlZE1hdGNoaW5nU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbXBhdGliaWxpdHlBbmFseXNpczogQ29tcGF0aWJpbGl0eUFuYWx5c2lzU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByZUFzc2Vzc21lbnRTZXJ2aWNlOiBQcmVBc3Nlc3NtZW50U2VydmljZSxcbiAgKSB7fVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlWWVhcnNPZkV4cGVyaWVuY2Uoc3RhcnREYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGxldCB5ZWFycyA9IG5vdy5nZXRGdWxsWWVhcigpIC0gc3RhcnREYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgaWYgKFxuICAgICAgbm93LmdldE1vbnRoKCkgPCBzdGFydERhdGUuZ2V0TW9udGgoKSB8fFxuICAgICAgKG5vdy5nZXRNb250aCgpID09PSBzdGFydERhdGUuZ2V0TW9udGgoKSAmJlxuICAgICAgICBub3cuZ2V0RGF0ZSgpIDwgc3RhcnREYXRlLmdldERhdGUoKSlcbiAgICApIHtcbiAgICAgIHllYXJzLS07XG4gICAgfVxuICAgIHJldHVybiB5ZWFycztcbiAgfVxuXG4gIGFzeW5jIGdldFJlY29tbWVuZGVkVGhlcmFwaXN0cyhcbiAgICByZXF1ZXN0OiBUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblJlcXVlc3QsXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gSW5wdXQgdmFsaWRhdGlvblxuICAgIGlmICghcmVxdWVzdD8udXNlcklkKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignVXNlciBJRCBpcyByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGlmIChyZXF1ZXN0LmxpbWl0ICYmIChyZXF1ZXN0LmxpbWl0IDwgMSB8fCByZXF1ZXN0LmxpbWl0ID4gMTAwKSkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0xpbWl0IG11c3QgYmUgYmV0d2VlbiAxIGFuZCAxMDAnKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgR2V0dGluZyBlbmhhbmNlZCByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgJHtyZXF1ZXN0LnVzZXJJZH0gd2l0aCBsaW1pdCAke3JlcXVlc3QubGltaXQgfHwgMTB9YCxcbiAgICApO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCB1c2VyJ3MgY29tcHJlaGVuc2l2ZSBkYXRhIGluY2x1ZGluZyBwcmVmZXJlbmNlc1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMucHJpc21hLmNsaWVudC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkOiByZXF1ZXN0LnVzZXJJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgcHJlQXNzZXNzbWVudDogdHJ1ZSxcbiAgICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKGBVc2VyIG5vdCBmb3VuZDogJHtyZXF1ZXN0LnVzZXJJZH1gKTtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgdXNlcnMgd2l0aG91dCBwcmUtYXNzZXNzbWVudCBtb3JlIGdyYWNlZnVsbHlcbiAgICAgIGlmICghdXNlci5wcmVBc3Nlc3NtZW50KSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oYE5vIHByZS1hc3Nlc3NtZW50IGZvdW5kIGZvciB1c2VyOiAke3JlcXVlc3QudXNlcklkfSwgdXNpbmcgYmFzaWMgcmVjb21tZW5kYXRpb25zYCk7XG4gICAgICAgIFxuICAgICAgICAvLyBQcm92aWRlIGJhc2ljIHJlY29tbWVuZGF0aW9ucyBmb3IgdXNlcnMgd2l0aG91dCBwcmUtYXNzZXNzbWVudFxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRCYXNpY1RoZXJhcGlzdFJlY29tbWVuZGF0aW9ucyhyZXF1ZXN0LCB1c2VyKTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGNvbXByZWhlbnNpdmUgY2xpbmljYWwgYW5hbHlzaXMgZm9yIGVuaGFuY2VkIG1hdGNoaW5nXG4gICAgICBsZXQgY2xpbmljYWxBbmFseXNpcztcbiAgICAgIHRyeSB7XG4gICAgICAgIGNsaW5pY2FsQW5hbHlzaXMgPVxuICAgICAgICAgIGF3YWl0IHRoaXMucHJlQXNzZXNzbWVudFNlcnZpY2UuZ2V0Q29tcHJlaGVuc2l2ZUNsaW5pY2FsQW5hbHlzaXMoXG4gICAgICAgICAgICByZXF1ZXN0LnVzZXJJZCxcbiAgICAgICAgICApO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgICAgYEVuaGFuY2VkIGNsaW5pY2FsIGluc2lnaHRzIGF2YWlsYWJsZTogJHtjbGluaWNhbEFuYWx5c2lzLmNsaW5pY2FsUHJvZmlsZS5wcmltYXJ5Q29uZGl0aW9ucy5sZW5ndGh9IHByaW1hcnkgY29uZGl0aW9uc2AsXG4gICAgICAgICk7XG4gICAgICB9IGNhdGNoIChhbmFseXNpc0Vycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgJ0FkdmFuY2VkIGNsaW5pY2FsIGFuYWx5c2lzIHVuYXZhaWxhYmxlLCB1c2luZyBiYXNpYyBhc3Nlc3NtZW50OicsXG4gICAgICAgICAgYW5hbHlzaXNFcnJvcixcbiAgICAgICAgKTtcbiAgICAgICAgY2xpbmljYWxBbmFseXNpcyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIEV4dHJhY3QgdXNlciBjb25kaXRpb25zIGFuZCBzZXZlcml0eSBsZXZlbHNcbiAgICAgIGNvbnN0IHVzZXJDb25kaXRpb25zID0gdGhpcy5leHRyYWN0VXNlckNvbmRpdGlvbnModXNlci5wcmVBc3Nlc3NtZW50KTtcbiAgICAgIC8vIEV4dHJhY3Qgc2V2ZXJpdHkgbGV2ZWxzIGZyb20gdGhlIGFuc3dlcnMgSlNPTiBmaWVsZFxuICAgICAgY29uc3QgYW5zd2VycyA9IHVzZXIucHJlQXNzZXNzbWVudC5hbnN3ZXJzIGFzIGFueTtcbiAgICAgIGNvbnN0IHNldmVyaXR5TGV2ZWxzID0gYW5zd2Vycz8uc2V2ZXJpdHlMZXZlbHMgYXMgUmVjb3JkPFxuICAgICAgICBzdHJpbmcsXG4gICAgICAgIHN0cmluZ1xuICAgICAgPjtcblxuICAgICAgLy8gRW5oYW5jZWQgdGhlcmFwaXN0IGZpbHRlcmluZyBiYXNlZCBvbiBjbGluaWNhbCBpbnNpZ2h0c1xuICAgICAgY29uc3QgdGhlcmFwaXN0V2hlcmU6IGFueSA9IHtcbiAgICAgICAgc3RhdHVzOiAnQVBQUk9WRUQnLFxuICAgICAgICAuLi4ocmVxdWVzdC5wcm92aW5jZSAmJiB7IHByb3ZpbmNlOiByZXF1ZXN0LnByb3ZpbmNlIH0pLFxuICAgICAgICAuLi4ocmVxdWVzdC5tYXhIb3VybHlSYXRlICYmIHtcbiAgICAgICAgICBob3VybHlSYXRlOiB7IGx0ZTogcmVxdWVzdC5tYXhIb3VybHlSYXRlIH0sXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgLy8gQXBwbHkgZW5oYW5jZWQgZmlsdGVyaW5nIGJhc2VkIG9uIGNsaW5pY2FsIGFuYWx5c2lzXG4gICAgICBpZiAoY2xpbmljYWxBbmFseXNpcz8udHJlYXRtZW50UGxhbj8udGhlcmFwaXN0Q3JpdGVyaWEpIHtcbiAgICAgICAgY29uc3QgY3JpdGVyaWEgPSBjbGluaWNhbEFuYWx5c2lzLnRyZWF0bWVudFBsYW4udGhlcmFwaXN0Q3JpdGVyaWE7XG5cbiAgICAgICAgLy8gRmlsdGVyIGJ5IHJlcXVpcmVkIHNwZWNpYWxpemF0aW9uc1xuICAgICAgICBpZiAoY3JpdGVyaWEucmVxdWlyZWRTcGVjaWFsaXphdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoZXJhcGlzdFdoZXJlLk9SID0gY3JpdGVyaWEucmVxdWlyZWRTcGVjaWFsaXphdGlvbnMubWFwKChzcGVjKSA9PiAoe1xuICAgICAgICAgICAgZXhwZXJ0aXNlOiB7IGhhczogc3BlYyB9LFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbHRlciBieSBleHBlcmllbmNlIGxldmVsXG4gICAgICAgIGlmIChjcml0ZXJpYS5leHBlcmllbmNlTGV2ZWwgIT09ICdhbnknKSB7XG4gICAgICAgICAgY29uc3QgbWluWWVhcnMgPVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpbnRlcm1lZGlhdGU6IDMsXG4gICAgICAgICAgICAgIHNlbmlvcjogNyxcbiAgICAgICAgICAgICAgZXhwZXJ0OiAxMixcbiAgICAgICAgICAgIH1bY3JpdGVyaWEuZXhwZXJpZW5jZUxldmVsXSB8fCAwO1xuXG4gICAgICAgICAgdGhlcmFwaXN0V2hlcmUueWVhcnNPZkV4cGVyaWVuY2UgPSB7IGd0ZTogbWluWWVhcnMgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBGZXRjaCB0aGVyYXBpc3RzIHdpdGggY29tcHJlaGVuc2l2ZSBkYXRhXG4gICAgICBjb25zdCB0aGVyYXBpc3RzOiBUaGVyYXBpc3RXaXRoUmVsYXRpb25zW10gPSBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogdGhlcmFwaXN0V2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogTWF0aC5taW4ocmVxdWVzdC5saW1pdCA/PyAxMCwgNTApLCAvLyBJbmNyZWFzZSBsaW1pdCBmb3IgYmV0dGVyIGZpbHRlcmluZ1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICByZXZpZXdzOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgcmF0aW5nOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVzZSBhZHZhbmNlZCBtYXRjaGluZyBhbGdvcml0aG0gd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcgYW5kIGxvZ2dpbmdcbiAgICAgIGNvbnN0IHRoZXJhcGlzdFNjb3JlczogVGhlcmFwaXN0U2NvcmVbXSA9IFtdO1xuICAgICAgbGV0IGFkdmFuY2VkTWF0Y2hpbmdGYWlsdXJlcyA9IDA7XG5cbiAgICAgIGZvciAoY29uc3QgdGhlcmFwaXN0IG9mIHRoZXJhcGlzdHMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBDYXN0IHVzZXIgdG8gcHJvcGVyIHR5cGUgbm93IHRoYXQgd2UndmUgdmFsaWRhdGVkIGFsbCByZXF1aXJlZCBmaWVsZHMgZXhpc3RcbiAgICAgICAgICBjb25zdCBjbGllbnRGb3JNYXRjaGluZzogQ2xpZW50Rm9yTWF0Y2hpbmcgPSB7XG4gICAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgICAgcHJlQXNzZXNzbWVudDogdXNlci5wcmVBc3Nlc3NtZW50LFxuICAgICAgICAgICAgdXNlcjogdXNlci51c2VyLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCB0aGVyYXBpc3RGb3JNYXRjaGluZzogVGhlcmFwaXN0Rm9yTWF0Y2hpbmcgPSB7XG4gICAgICAgICAgICAuLi50aGVyYXBpc3QsXG4gICAgICAgICAgICB1c2VyOiB0aGVyYXBpc3QudXNlcixcbiAgICAgICAgICAgIHJldmlld3M6IHRoZXJhcGlzdC5yZXZpZXdzIHx8IFtdLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCBzY29yZSA9IGF3YWl0IHRoaXMuYWR2YW5jZWRNYXRjaGluZy5jYWxjdWxhdGVBZHZhbmNlZE1hdGNoKFxuICAgICAgICAgICAgY2xpZW50Rm9yTWF0Y2hpbmcsXG4gICAgICAgICAgICB0aGVyYXBpc3RGb3JNYXRjaGluZyxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhlcmFwaXN0U2NvcmVzLnB1c2goc2NvcmUpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGFkdmFuY2VkTWF0Y2hpbmdGYWlsdXJlcysrO1xuXG4gICAgICAgICAgLy8gTG9nIGRldGFpbGVkIGVycm9yIGluZm9ybWF0aW9uIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgIGBBZHZhbmNlZCBtYXRjaGluZyBmYWlsZWQgZm9yIHRoZXJhcGlzdCAke3RoZXJhcGlzdC51c2VySWR9YCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgICAgc3RhY2s6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgdGhlcmFwaXN0SWQ6IHRoZXJhcGlzdC51c2VySWQsXG4gICAgICAgICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBGYWxsYmFjayB0byBiYXNpYyBzY29yaW5nIHdpdGggY2xlYXIgaW5kaWNhdGlvbiB0aGlzIGlzIGEgZmFsbGJhY2tcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYmFzaWNTY29yZSA9IHRoaXMuY2FsY3VsYXRlTWF0Y2hTY29yZShcbiAgICAgICAgICAgICAgdGhlcmFwaXN0LFxuICAgICAgICAgICAgICB1c2VyQ29uZGl0aW9ucyxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IHRoZXJhcGlzdEZvck1hdGNoaW5nOiBUaGVyYXBpc3RGb3JNYXRjaGluZyA9IHtcbiAgICAgICAgICAgICAgLi4udGhlcmFwaXN0LFxuICAgICAgICAgICAgICB1c2VyOiB0aGVyYXBpc3QudXNlcixcbiAgICAgICAgICAgICAgcmV2aWV3czogdGhlcmFwaXN0LnJldmlld3MgfHwgW10sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGVyYXBpc3RTY29yZXMucHVzaCh7XG4gICAgICAgICAgICAgIHRoZXJhcGlzdDogdGhlcmFwaXN0Rm9yTWF0Y2hpbmcsXG4gICAgICAgICAgICAgIHRvdGFsU2NvcmU6IGJhc2ljU2NvcmUsXG4gICAgICAgICAgICAgIGJyZWFrZG93bjoge1xuICAgICAgICAgICAgICAgIGNvbmRpdGlvblNjb3JlOiBNYXRoLnJvdW5kKGJhc2ljU2NvcmUgKiAwLjYpLFxuICAgICAgICAgICAgICAgIGFwcHJvYWNoU2NvcmU6IDAsXG4gICAgICAgICAgICAgICAgZXhwZXJpZW5jZVNjb3JlOiBNYXRoLnJvdW5kKGJhc2ljU2NvcmUgKiAwLjQpLFxuICAgICAgICAgICAgICAgIHJldmlld1Njb3JlOiAwLFxuICAgICAgICAgICAgICAgIGxvZ2lzdGljc1Njb3JlOiAwLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBtYXRjaEV4cGxhbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgcHJpbWFyeU1hdGNoZXM6IHRoaXMuZ2V0UHJpbWFyeUNvbmRpdGlvbnModXNlckNvbmRpdGlvbnMpLFxuICAgICAgICAgICAgICAgIHNlY29uZGFyeU1hdGNoZXM6IHRoaXMuZ2V0U2Vjb25kYXJ5Q29uZGl0aW9ucyh1c2VyQ29uZGl0aW9ucyksXG4gICAgICAgICAgICAgICAgYXBwcm9hY2hNYXRjaGVzOiBbXSxcbiAgICAgICAgICAgICAgICBleHBlcmllbmNlWWVhcnM6IHRoaXMuY2FsY3VsYXRlWWVhcnNPZkV4cGVyaWVuY2UoXG4gICAgICAgICAgICAgICAgICB0aGVyYXBpc3QucHJhY3RpY2VTdGFydERhdGUsXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBhdmVyYWdlUmF0aW5nOiAwLFxuICAgICAgICAgICAgICAgIHRvdGFsUmV2aWV3czogMCxcbiAgICAgICAgICAgICAgICBzdWNjZXNzUmF0ZXM6IHt9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgICAgIGBVc2luZyBiYXNpYyBzY29yaW5nIGZhbGxiYWNrIGZvciB0aGVyYXBpc3QgJHt0aGVyYXBpc3QudXNlcklkfSBkdWUgdG8gYWR2YW5jZWQgbWF0Y2hpbmcgZmFpbHVyZWAsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGJhc2ljU2NvcmluZ0Vycm9yKSB7XG4gICAgICAgICAgICAvLyBJZiBldmVuIGJhc2ljIHNjb3JpbmcgZmFpbHMsIGxvZyBhbmQgc2tpcCB0aGlzIHRoZXJhcGlzdFxuICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICAgIGBCb3RoIGFkdmFuY2VkIGFuZCBiYXNpYyBzY29yaW5nIGZhaWxlZCBmb3IgdGhlcmFwaXN0ICR7dGhlcmFwaXN0LnVzZXJJZH1gLFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYWR2YW5jZWRFcnJvcjpcbiAgICAgICAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgICAgICBiYXNpY0Vycm9yOlxuICAgICAgICAgICAgICAgICAgYmFzaWNTY29yaW5nRXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgICAgICAgICAgICA/IGJhc2ljU2NvcmluZ0Vycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgOiBTdHJpbmcoYmFzaWNTY29yaW5nRXJyb3IpLFxuICAgICAgICAgICAgICAgIHRoZXJhcGlzdElkOiB0aGVyYXBpc3QudXNlcklkLFxuICAgICAgICAgICAgICAgIHVzZXJJZDogcmVxdWVzdC51c2VySWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLy8gU2tpcCB0aGlzIHRoZXJhcGlzdCBlbnRpcmVseVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIExvZyBzdW1tYXJ5IG9mIG1hdGNoaW5nIHBlcmZvcm1hbmNlXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBNYXRjaGluZyBjb21wbGV0ZWQgZm9yIHVzZXIgJHtyZXF1ZXN0LnVzZXJJZH06ICR7dGhlcmFwaXN0U2NvcmVzLmxlbmd0aH0gc3VjY2Vzc2Z1bCBtYXRjaGVzLCAke2FkdmFuY2VkTWF0Y2hpbmdGYWlsdXJlc30gZmFsbGJhY2tzYCxcbiAgICAgICk7XG5cbiAgICAgIC8vIFNvcnQgYnkgdG90YWwgc2NvcmUgZGVzY2VuZGluZ1xuICAgICAgY29uc3Qgc29ydGVkVGhlcmFwaXN0U2NvcmVzID0gdGhlcmFwaXN0U2NvcmVzLnNvcnQoXG4gICAgICAgIChhLCBiKSA9PiBiLnRvdGFsU2NvcmUgLSBhLnRvdGFsU2NvcmUsXG4gICAgICApO1xuXG4gICAgICAvLyBUYWtlIG9ubHkgdGhlIHJlcXVlc3RlZCBudW1iZXIgb2YgcmVzdWx0c1xuICAgICAgY29uc3QgZmluYWxSZXN1bHRzID0gc29ydGVkVGhlcmFwaXN0U2NvcmVzLnNsaWNlKDAsIHJlcXVlc3QubGltaXQgPz8gMTApO1xuXG4gICAgICAvLyBUcmFjayByZWNvbW1lbmRhdGlvbiBhbmFseXRpY3MgLSByZW1vdmVkIGR1ZSB0byBtaXNzaW5nIE1hdGNoaW5nQW5hbHl0aWNzU2VydmljZVxuXG4gICAgICAvLyBUcmFuc2Zvcm0gdG8gZXhwZWN0ZWQgZm9ybWF0IHdpdGggZW5oYW5jZWQgaW5zaWdodHNcbiAgICAgIGNvbnN0IHRoZXJhcGlzdHNXaXRoU2NvcmVzID0gZmluYWxSZXN1bHRzLm1hcCgoc2NvcmUpID0+IHtcbiAgICAgICAgY29uc3QgdGhlcmFwaXN0RGF0YTogYW55ID0ge1xuICAgICAgICAgIC4uLnNjb3JlLnRoZXJhcGlzdCxcbiAgICAgICAgICBtYXRjaFNjb3JlOiBzY29yZS50b3RhbFNjb3JlLFxuICAgICAgICAgIHNjb3JlQnJlYWtkb3duOiBzY29yZS5icmVha2Rvd24sXG4gICAgICAgICAgbWF0Y2hFeHBsYW5hdGlvbjogc2NvcmUubWF0Y2hFeHBsYW5hdGlvbixcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBZGQgY2xpbmljYWwgaW5zaWdodHMgaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmIChjbGluaWNhbEFuYWx5c2lzKSB7XG4gICAgICAgICAgdGhlcmFwaXN0RGF0YS5jbGluaWNhbE1hdGNoID0ge1xuICAgICAgICAgICAgdXJnZW5jeUFsaWdubWVudDogdGhpcy5hc3Nlc3NVcmdlbmN5QWxpZ25tZW50KFxuICAgICAgICAgICAgICBzY29yZS50aGVyYXBpc3QsXG4gICAgICAgICAgICAgIGNsaW5pY2FsQW5hbHlzaXMsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgc3BlY2lhbGl6YXRpb25NYXRjaDogdGhpcy5hc3Nlc3NTcGVjaWFsaXphdGlvbk1hdGNoKFxuICAgICAgICAgICAgICBzY29yZS50aGVyYXBpc3QsXG4gICAgICAgICAgICAgIGNsaW5pY2FsQW5hbHlzaXMsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgZXhwZXJpZW5jZUFkZXF1YWN5OiB0aGlzLmFzc2Vzc0V4cGVyaWVuY2VBZGVxdWFjeShcbiAgICAgICAgICAgICAgc2NvcmUudGhlcmFwaXN0LFxuICAgICAgICAgICAgICBjbGluaWNhbEFuYWx5c2lzLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGFwcHJvYWNoQ29tcGF0aWJpbGl0eTogdGhpcy5hc3Nlc3NBcHByb2FjaENvbXBhdGliaWxpdHkoXG4gICAgICAgICAgICAgIHNjb3JlLnRoZXJhcGlzdCxcbiAgICAgICAgICAgICAgY2xpbmljYWxBbmFseXNpcyxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGVyYXBpc3REYXRhO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIERldGVybWluZSBwcmltYXJ5IGFuZCBzZWNvbmRhcnkgY29uZGl0aW9ucyAoZW5oYW5jZWQgaWYgY2xpbmljYWwgYW5hbHlzaXMgYXZhaWxhYmxlKVxuICAgICAgY29uc3QgcHJpbWFyeUNvbmRpdGlvbnMgPSBjbGluaWNhbEFuYWx5c2lzXG4gICAgICAgID8gY2xpbmljYWxBbmFseXNpcy5jbGluaWNhbFByb2ZpbGUucHJpbWFyeUNvbmRpdGlvbnMubWFwKFxuICAgICAgICAgICAgKHBjKSA9PiBwYy5jb25kaXRpb24sXG4gICAgICAgICAgKVxuICAgICAgICA6IHRoaXMuZ2V0UHJpbWFyeUNvbmRpdGlvbnModXNlckNvbmRpdGlvbnMpO1xuXG4gICAgICBjb25zdCBzZWNvbmRhcnlDb25kaXRpb25zID0gY2xpbmljYWxBbmFseXNpc1xuICAgICAgICA/IGNsaW5pY2FsQW5hbHlzaXMuY2xpbmljYWxQcm9maWxlLnNlY29uZGFyeUNvbmRpdGlvbnMubWFwKFxuICAgICAgICAgICAgKHNjKSA9PiBzYy5jb25kaXRpb24sXG4gICAgICAgICAgKVxuICAgICAgICA6IHRoaXMuZ2V0U2Vjb25kYXJ5Q29uZGl0aW9ucyh1c2VyQ29uZGl0aW9ucyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsQ291bnQ6IHRoZXJhcGlzdHNXaXRoU2NvcmVzLmxlbmd0aCxcbiAgICAgICAgdXNlckNvbmRpdGlvbnM6IE9iamVjdC5rZXlzKHVzZXJDb25kaXRpb25zKSxcbiAgICAgICAgdGhlcmFwaXN0czogdGhlcmFwaXN0c1dpdGhTY29yZXMsXG4gICAgICAgIG1hdGNoQ3JpdGVyaWE6IHtcbiAgICAgICAgICBwcmltYXJ5Q29uZGl0aW9ucyxcbiAgICAgICAgICBzZWNvbmRhcnlDb25kaXRpb25zLFxuICAgICAgICAgIHNldmVyaXR5TGV2ZWxzLFxuICAgICAgICAgIC4uLihjbGluaWNhbEFuYWx5c2lzICYmIHtcbiAgICAgICAgICAgIHJpc2tMZXZlbDogY2xpbmljYWxBbmFseXNpcy5yaXNrQXNzZXNzbWVudC5vdmVyYWxsUmlzayxcbiAgICAgICAgICAgIHVyZ2VuY3lMZXZlbDpcbiAgICAgICAgICAgICAgY2xpbmljYWxBbmFseXNpcy50cmVhdG1lbnRQbGFuLnRoZXJhcGlzdENyaXRlcmlhLnVyZ2VuY3lMZXZlbCxcbiAgICAgICAgICAgIHJlcXVpcmVkU3BlY2lhbGl6YXRpb25zOlxuICAgICAgICAgICAgICBjbGluaWNhbEFuYWx5c2lzLnRyZWF0bWVudFBsYW4udGhlcmFwaXN0Q3JpdGVyaWFcbiAgICAgICAgICAgICAgICAucmVxdWlyZWRTcGVjaWFsaXphdGlvbnMsXG4gICAgICAgICAgICBwcmVmZXJyZWRBcHByb2FjaGVzOlxuICAgICAgICAgICAgICBjbGluaWNhbEFuYWx5c2lzLnRyZWF0bWVudFBsYW4udGhlcmFwaXN0Q3JpdGVyaWFcbiAgICAgICAgICAgICAgICAucHJlZmVycmVkQXBwcm9hY2hlcyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgY2xpbmljYWxJbnNpZ2h0czogY2xpbmljYWxBbmFseXNpc1xuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBvdmVyYWxsUmlza0xldmVsOlxuICAgICAgICAgICAgICAgIGNsaW5pY2FsQW5hbHlzaXMuY2xpbmljYWxQcm9maWxlLm92ZXJhbGxSaXNrTGV2ZWwsXG4gICAgICAgICAgICAgIHByaW1hcnlDb25kaXRpb25zQ291bnQ6XG4gICAgICAgICAgICAgICAgY2xpbmljYWxBbmFseXNpcy5jbGluaWNhbFByb2ZpbGUucHJpbWFyeUNvbmRpdGlvbnMubGVuZ3RoLFxuICAgICAgICAgICAgICB0aGVyYXBldXRpY1ByaW9yaXRpZXM6XG4gICAgICAgICAgICAgICAgY2xpbmljYWxBbmFseXNpcy5jbGluaWNhbFByb2ZpbGUudGhlcmFwZXV0aWNQcmlvcml0aWVzLnNsaWNlKFxuICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAgIDMsXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgcmVjb21tZW5kZWRTZXNzaW9uRnJlcXVlbmN5OlxuICAgICAgICAgICAgICAgIGNsaW5pY2FsQW5hbHlzaXMudHJlYXRtZW50UGxhbi50aGVyYXBpc3RDcml0ZXJpYVxuICAgICAgICAgICAgICAgICAgLnNlc3Npb25GcmVxdWVuY3ksXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiBudWxsLFxuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBwYWdlU2l6ZTogcmVxdWVzdC5saW1pdCA/PyAxMCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEhhbmRsZSBzcGVjaWZpYyBlcnJvciB0eXBlcyB3aXRoIGFwcHJvcHJpYXRlIGxvZ2dpbmcgYW5kIHJlc3BvbnNlc1xuICAgICAgaWYgKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgQmFkUmVxdWVzdEV4Y2VwdGlvblxuICAgICAgKSB7XG4gICAgICAgIC8vIFJlLXRocm93IHZhbGlkYXRpb24gYW5kIG5vdCBmb3VuZCBlcnJvcnMgYXMtaXNcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIC8vIExvZyB1bmV4cGVjdGVkIGVycm9ycyB3aXRoIGZ1bGwgY29udGV4dFxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBVbmV4cGVjdGVkIGVycm9yIGluIGdldFJlY29tbWVuZGVkVGhlcmFwaXN0cyBmb3IgdXNlciAke3JlcXVlc3QudXNlcklkfWAsXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgICAgIHN0YWNrOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQsXG4gICAgICAgICAgdXNlcklkOiByZXF1ZXN0LnVzZXJJZCxcbiAgICAgICAgICByZXF1ZXN0UGFyYW1zOiB7XG4gICAgICAgICAgICBsaW1pdDogcmVxdWVzdC5saW1pdCxcbiAgICAgICAgICAgIHByb3ZpbmNlOiByZXF1ZXN0LnByb3ZpbmNlLFxuICAgICAgICAgICAgbWF4SG91cmx5UmF0ZTogcmVxdWVzdC5tYXhIb3VybHlSYXRlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICAvLyBQcm92aWRlIGdlbmVyaWMgZXJyb3IgbWVzc2FnZSB0byBjbGllbnQgd2hpbGUgbG9nZ2luZyBzcGVjaWZpY3NcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRmFpbGVkIHRvIGdldCB0aGVyYXBpc3QgcmVjb21tZW5kYXRpb25zLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYmFzaWMgdGhlcmFwaXN0IHJlY29tbWVuZGF0aW9ucyBmb3IgdXNlcnMgd2l0aG91dCBwcmUtYXNzZXNzbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRCYXNpY1RoZXJhcGlzdFJlY29tbWVuZGF0aW9ucyhcbiAgICByZXF1ZXN0OiBUaGVyYXBpc3RSZWNvbW1lbmRhdGlvblJlcXVlc3QsXG4gICAgdXNlcjogYW55LFxuICApOiBQcm9taXNlPGFueT4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgIGBHZXR0aW5nIGJhc2ljIHJlY29tbWVuZGF0aW9ucyBmb3IgdXNlciAke3JlcXVlc3QudXNlcklkfSAobm8gcHJlLWFzc2Vzc21lbnQpYCxcbiAgICApO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEJhc2ljIHRoZXJhcGlzdCBmaWx0ZXJpbmcgd2l0aG91dCBjbGluaWNhbCBhbmFseXNpc1xuICAgICAgY29uc3QgdGhlcmFwaXN0V2hlcmU6IGFueSA9IHtcbiAgICAgICAgc3RhdHVzOiAnQVBQUk9WRUQnLFxuICAgICAgICAuLi4ocmVxdWVzdC5wcm92aW5jZSAmJiB7IHByb3ZpbmNlOiByZXF1ZXN0LnByb3ZpbmNlIH0pLFxuICAgICAgICAuLi4ocmVxdWVzdC5tYXhIb3VybHlSYXRlICYmIHtcbiAgICAgICAgICBob3VybHlSYXRlOiB7IGx0ZTogcmVxdWVzdC5tYXhIb3VybHlSYXRlIH0sXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgLy8gRmV0Y2ggdGhlcmFwaXN0cyB3aXRoIGJhc2ljIGRhdGFcbiAgICAgIGNvbnN0IHRoZXJhcGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZTogdGhlcmFwaXN0V2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IFtcbiAgICAgICAgICB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgICAgeyB5ZWFyc09mRXhwZXJpZW5jZTogJ2Rlc2MnIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHRha2U6IE1hdGgubWluKHJlcXVlc3QubGltaXQgPz8gMTAsIDIwKSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgICAgcmV2aWV3czoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHJhdGluZzogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coYEZvdW5kICR7dGhlcmFwaXN0cy5sZW5ndGh9IGFwcHJvdmVkIHRoZXJhcGlzdHMgZm9yIGJhc2ljIHJlY29tbWVuZGF0aW9uc2ApO1xuXG4gICAgICBpZiAodGhlcmFwaXN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybignTm8gYXBwcm92ZWQgdGhlcmFwaXN0cyBmb3VuZCBpbiBkYXRhYmFzZScpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRvdGFsQ291bnQ6IDAsXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgICAgICBtZXNzYWdlOiAnTm8gdGhlcmFwaXN0cyBhdmFpbGFibGUgYXQgdGhpcyB0aW1lLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gICAgICAgICAgdXNlckNvbmRpdGlvbnM6IFtdLFxuICAgICAgICAgIHRoZXJhcGlzdHM6IFtdLFxuICAgICAgICAgIG1hdGNoQ3JpdGVyaWE6IHtcbiAgICAgICAgICAgIHByaW1hcnlDb25kaXRpb25zOiBbXSxcbiAgICAgICAgICAgIHNlY29uZGFyeUNvbmRpdGlvbnM6IFtdLFxuICAgICAgICAgICAgc2V2ZXJpdHlMZXZlbHM6IHt9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xpbmljYWxJbnNpZ2h0czogbnVsbCxcbiAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgIHBhZ2VTaXplOiByZXF1ZXN0LmxpbWl0ID8/IDEwLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgYmFzaWMgc2NvcmVzIGJhc2VkIG9uIGV4cGVyaWVuY2UgYW5kIHJhdGluZ3NcbiAgICAgIGNvbnN0IHRoZXJhcGlzdHNXaXRoU2NvcmVzID0gdGhlcmFwaXN0cy5tYXAoKHRoZXJhcGlzdCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgZXhwZXJpZW5jZVllYXJzID0gdGhlcmFwaXN0LnllYXJzT2ZFeHBlcmllbmNlIHx8IFxuICAgICAgICAgIHRoaXMuY2FsY3VsYXRlWWVhcnNPZkV4cGVyaWVuY2UodGhlcmFwaXN0LnByYWN0aWNlU3RhcnREYXRlKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHJldmlld3MgPSB0aGVyYXBpc3QucmV2aWV3cyB8fCBbXTtcbiAgICAgICAgY29uc3QgYXZlcmFnZVJhdGluZyA9IHJldmlld3MubGVuZ3RoID4gMCA/IFxuICAgICAgICAgIHJldmlld3MucmVkdWNlKChzdW0sIHIpID0+IHN1bSArIHIucmF0aW5nLCAwKSAvIHJldmlld3MubGVuZ3RoIDogMDtcbiAgICAgICAgXG4gICAgICAgIC8vIEJhc2ljIHNjb3Jpbmc6IGV4cGVyaWVuY2UgKDYwJSkgKyByYXRpbmcgKDQwJSlcbiAgICAgICAgY29uc3QgZXhwZXJpZW5jZVNjb3JlID0gTWF0aC5taW4oZXhwZXJpZW5jZVllYXJzICogMTAsIDYwKTtcbiAgICAgICAgY29uc3QgcmF0aW5nU2NvcmUgPSBhdmVyYWdlUmF0aW5nICogODtcbiAgICAgICAgY29uc3QgdG90YWxTY29yZSA9IGV4cGVyaWVuY2VTY29yZSArIHJhdGluZ1Njb3JlO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4udGhlcmFwaXN0LFxuICAgICAgICAgIHVzZXJJZDogdGhlcmFwaXN0LnVzZXJJZCwgLy8gRW5zdXJlIHVzZXJJZCBpcyBhdmFpbGFibGUgYXMgaWRcbiAgICAgICAgICBpZDogdGhlcmFwaXN0LnVzZXJJZCxcbiAgICAgICAgICBtYXRjaFNjb3JlOiBNYXRoLnJvdW5kKHRvdGFsU2NvcmUpLFxuICAgICAgICAgIHNjb3JlOiBNYXRoLnJvdW5kKHRvdGFsU2NvcmUpLFxuICAgICAgICAgIHJhbms6IGluZGV4ICsgMSxcbiAgICAgICAgICBleHBlcmllbmNlOiBleHBlcmllbmNlWWVhcnMsXG4gICAgICAgICAgcmF0aW5nOiBhdmVyYWdlUmF0aW5nLFxuICAgICAgICAgIHRvdGFsUmV2aWV3czogcmV2aWV3cy5sZW5ndGgsXG4gICAgICAgICAgLy8gQWRkIGZyb250ZW5kLWV4cGVjdGVkIGZpZWxkc1xuICAgICAgICAgIGZpcnN0TmFtZTogdGhlcmFwaXN0LnVzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiB0aGVyYXBpc3QudXNlci5sYXN0TmFtZSxcbiAgICAgICAgICBzcGVjaWFsdGllczogdGhlcmFwaXN0LmV4cGVydGlzZSB8fCBbXSxcbiAgICAgICAgICBiaW86IGAke2V4cGVyaWVuY2VZZWFyc30geWVhcnMgb2YgZXhwZXJpZW5jZSBpbiBtZW50YWwgaGVhbHRoIHRoZXJhcHlgLFxuICAgICAgICAgIHNjb3JlQnJlYWtkb3duOiB7XG4gICAgICAgICAgICBjb25kaXRpb25TY29yZTogMCxcbiAgICAgICAgICAgIGFwcHJvYWNoU2NvcmU6IDAsXG4gICAgICAgICAgICBleHBlcmllbmNlU2NvcmU6IE1hdGgucm91bmQoZXhwZXJpZW5jZVNjb3JlKSxcbiAgICAgICAgICAgIHJldmlld1Njb3JlOiBNYXRoLnJvdW5kKHJhdGluZ1Njb3JlKSxcbiAgICAgICAgICAgIGxvZ2lzdGljc1Njb3JlOiAyMCwgLy8gQmFzZSBsb2dpc3RpY3Mgc2NvcmVcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1hdGNoRXhwbGFuYXRpb246IHtcbiAgICAgICAgICAgIHByaW1hcnlNYXRjaGVzOiBbXSxcbiAgICAgICAgICAgIHNlY29uZGFyeU1hdGNoZXM6IFtdLFxuICAgICAgICAgICAgYXBwcm9hY2hNYXRjaGVzOiBbXSxcbiAgICAgICAgICAgIGV4cGVyaWVuY2VZZWFycyxcbiAgICAgICAgICAgIGF2ZXJhZ2VSYXRpbmcsXG4gICAgICAgICAgICB0b3RhbFJldmlld3M6IHJldmlld3MubGVuZ3RoLFxuICAgICAgICAgICAgc3VjY2Vzc1JhdGVzOiB7fSxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNvcnQgYnkgc2NvcmUgZGVzY2VuZGluZ1xuICAgICAgY29uc3Qgc29ydGVkVGhlcmFwaXN0cyA9IHRoZXJhcGlzdHNXaXRoU2NvcmVzXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLm1hdGNoU2NvcmUgLSBhLm1hdGNoU2NvcmUpXG4gICAgICAgIC5zbGljZSgwLCByZXF1ZXN0LmxpbWl0ID8/IDEwKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG90YWxDb3VudDogc29ydGVkVGhlcmFwaXN0cy5sZW5ndGgsXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogc29ydGVkVGhlcmFwaXN0cywgLy8gRnJvbnRlbmQgZXhwZWN0cyB0aGlzIGZpZWxkXG4gICAgICAgIHVzZXJDb25kaXRpb25zOiBbXSxcbiAgICAgICAgdGhlcmFwaXN0czogc29ydGVkVGhlcmFwaXN0cyxcbiAgICAgICAgbWF0Y2hDcml0ZXJpYToge1xuICAgICAgICAgIHByaW1hcnlDb25kaXRpb25zOiBbXSxcbiAgICAgICAgICBzZWNvbmRhcnlDb25kaXRpb25zOiBbXSxcbiAgICAgICAgICBzZXZlcml0eUxldmVsczoge30sXG4gICAgICAgICAgbm90ZTogJ0Jhc2ljIHJlY29tbWVuZGF0aW9ucyAtIGNvbXBsZXRlIHlvdXIgbWVudGFsIGhlYWx0aCBhc3Nlc3NtZW50IGZvciBwZXJzb25hbGl6ZWQgbWF0Y2hlcycsXG4gICAgICAgIH0sXG4gICAgICAgIGNsaW5pY2FsSW5zaWdodHM6IG51bGwsXG4gICAgICAgIHBhZ2U6IDEsXG4gICAgICAgIHBhZ2VTaXplOiByZXF1ZXN0LmxpbWl0ID8/IDEwLFxuICAgICAgICB3ZWxjb21lTWVzc2FnZTogYEhlbGxvICR7dXNlci51c2VyLmZpcnN0TmFtZX0hIFdlJ3ZlIGZvdW5kIHNvbWUgZ3JlYXQgdGhlcmFwaXN0cyBmb3IgeW91LiBDb21wbGV0ZSB5b3VyIG1lbnRhbCBoZWFsdGggYXNzZXNzbWVudCB0byBnZXQgcGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9ucy5gLFxuICAgICAgICBpc0ZpcnN0VGltZTogdHJ1ZSxcbiAgICAgICAgdXNlckluZm86IHtcbiAgICAgICAgICBmaXJzdE5hbWU6IHVzZXIudXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgbWVtYmVyU2luY2U6IHVzZXIudXNlci5jcmVhdGVkQXQsXG4gICAgICAgICAgbmVlZHNPbmJvYXJkaW5nOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBuZXh0U3RlcHM6IHtcbiAgICAgICAgICBjYW5TZW5kUmVxdWVzdHM6IHRydWUsXG4gICAgICAgICAgcmVjb21tZW5kZWRBY3Rpb25zOiBbXG4gICAgICAgICAgICAnQ29tcGxldGUgeW91ciBtZW50YWwgaGVhbHRoIGFzc2Vzc21lbnQgZm9yIGJldHRlciBtYXRjaGVzJyxcbiAgICAgICAgICAgICdCcm93c2UgdGhlcmFwaXN0IHByb2ZpbGVzJyxcbiAgICAgICAgICAgICdTZW5kIHJlcXVlc3RzIHRvIHRoZXJhcGlzdHMgeW91IGZpbmQgaW50ZXJlc3RpbmcnLFxuICAgICAgICAgICAgJ0NvbXBsZXRlIHlvdXIgcHJvZmlsZSBmb3IgaW1wcm92ZWQgcmVjb21tZW5kYXRpb25zJyxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBtYXRjaGluZ0luc2lnaHRzOiB7XG4gICAgICAgICAgdG90YWxBdmFpbGFibGVUaGVyYXBpc3RzOiBzb3J0ZWRUaGVyYXBpc3RzLmxlbmd0aCxcbiAgICAgICAgICB0b3RhbEF2YWlsYWJsZUNvbW11bml0aWVzOiAwLFxuICAgICAgICAgIHJlY29tbWVuZGF0aW9uRW5naW5lOiAnQmFzaWMgZXhwZXJpZW5jZSBhbmQgcmF0aW5nLWJhc2VkIG1hdGNoaW5nJyxcbiAgICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJyb3IgaW4gZ2V0QmFzaWNUaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgJHtyZXF1ZXN0LnVzZXJJZH1gLFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgLy8gUmV0dXJuIHNhZmUgZmFsbGJhY2tcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsQ291bnQ6IDAsXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXG4gICAgICAgIHVzZXJDb25kaXRpb25zOiBbXSxcbiAgICAgICAgdGhlcmFwaXN0czogW10sXG4gICAgICAgIG1hdGNoQ3JpdGVyaWE6IHtcbiAgICAgICAgICBwcmltYXJ5Q29uZGl0aW9uczogW10sXG4gICAgICAgICAgc2Vjb25kYXJ5Q29uZGl0aW9uczogW10sXG4gICAgICAgICAgc2V2ZXJpdHlMZXZlbHM6IHt9LFxuICAgICAgICB9LFxuICAgICAgICBjbGluaWNhbEluc2lnaHRzOiBudWxsLFxuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBwYWdlU2l6ZTogcmVxdWVzdC5saW1pdCA/PyAxMCxcbiAgICAgICAgZXJyb3I6ICdVbmFibGUgdG8gbG9hZCB0aGVyYXBpc3QgcmVjb21tZW5kYXRpb25zIGF0IHRoaXMgdGltZScsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZGV0YWlsZWQgY29tcGF0aWJpbGl0eSBhbmFseXNpcyBiZXR3ZWVuIGEgY2xpZW50IGFuZCB0aGVyYXBpc3RcbiAgICovXG4gIGFzeW5jIGdldENvbXBhdGliaWxpdHlBbmFseXNpcyhjbGllbnRJZDogc3RyaW5nLCB0aGVyYXBpc3RJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgdGhpcy5wcmlzbWEuY2xpZW50LmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkOiBjbGllbnRJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBwcmVBc3Nlc3NtZW50OiB0cnVlLFxuICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHRoZXJhcGlzdDogVGhlcmFwaXN0V2l0aFJlbGF0aW9ucyB8IG51bGwgPSBhd2FpdCB0aGlzLnByaXNtYS50aGVyYXBpc3QuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyB1c2VySWQ6IHRoZXJhcGlzdElkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgIHJldmlld3M6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIHJhdGluZzogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghY2xpZW50IHx8ICF0aGVyYXBpc3QpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ2xpZW50IG9yIHRoZXJhcGlzdCBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWNsaWVudC5wcmVBc3Nlc3NtZW50KSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ05vIHByZS1hc3Nlc3NtZW50IGZvdW5kIGZvciBjbGllbnQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gYXdhaXQgdGhpcy5jb21wYXRpYmlsaXR5QW5hbHlzaXMuYW5hbHl6ZUNvbXBhdGliaWxpdHkoXG4gICAgICBjbGllbnQgYXMgYW55LCAvLyBTYWZlIGJlY2F1c2Ugd2UgdmVyaWZpZWQgcHJlQXNzZXNzbWVudCBleGlzdHMgYWJvdmVcbiAgICAgIHRoZXJhcGlzdCxcbiAgICApO1xuXG4gICAgLy8gVHJhY2sgY29tcGF0aWJpbGl0eSBhbmFseXNpcyAtIHJlbW92ZWQgZHVlIHRvIG1pc3NpbmcgTWF0Y2hpbmdBbmFseXRpY3NTZXJ2aWNlXG5cbiAgICByZXR1cm4gY29tcGF0aWJpbGl0eTtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdFVzZXJDb25kaXRpb25zKFxuICAgIHByZUFzc2Vzc21lbnQ6IFByZUFzc2Vzc21lbnQsXG4gICk6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4ge1xuICAgIGNvbnN0IGNvbmRpdGlvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICAvLyBFeHRyYWN0IGRhdGEgZnJvbSB0aGUgYW5zd2VycyBKU09OIGZpZWxkXG4gICAgY29uc3QgYW5zd2VycyA9IHByZUFzc2Vzc21lbnQuYW5zd2VycyBhcyBhbnk7XG4gICAgY29uc3Qgc2V2ZXJpdHlMZXZlbHMgPSBhbnN3ZXJzPy5zZXZlcml0eUxldmVscyBhcyBSZWNvcmQ8XG4gICAgICBzdHJpbmcsXG4gICAgICBzdHJpbmdcbiAgICA+O1xuICAgIGNvbnN0IHF1ZXN0aW9ubmFpcmVzID0gYW5zd2Vycz8ucXVlc3Rpb25uYWlyZXMgYXMgc3RyaW5nW107XG4gICAgXG4gICAgaWYgKHF1ZXN0aW9ubmFpcmVzICYmIHNldmVyaXR5TGV2ZWxzKSB7XG4gICAgICBxdWVzdGlvbm5haXJlcy5mb3JFYWNoKChxKSA9PiB7XG4gICAgICAgIGlmIChzZXZlcml0eUxldmVsc1txXSkge1xuICAgICAgICAgIGNvbmRpdGlvbnNbcV0gPSBzZXZlcml0eUxldmVsc1txXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBjb25kaXRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVNYXRjaFNjb3JlKFxuICAgIHRoZXJhcGlzdDogYW55LFxuICAgIHVzZXJDb25kaXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LFxuICApOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDA7XG4gICAgY29uc3QgZXhwZXJ0aXNlID0gKHRoZXJhcGlzdC5leHBlcnRpc2UgYXMgc3RyaW5nW10pIHx8IFtdO1xuICAgIE9iamVjdC5rZXlzKHVzZXJDb25kaXRpb25zKS5mb3JFYWNoKChjb25kaXRpb24pID0+IHtcbiAgICAgIGlmIChleHBlcnRpc2UuaW5jbHVkZXMoY29uZGl0aW9uKSkgc2NvcmUgKz0gMjA7XG4gICAgfSk7XG4gICAgc2NvcmUgKz0gTWF0aC5taW4oXG4gICAgICB0aGlzLmNhbGN1bGF0ZVllYXJzT2ZFeHBlcmllbmNlKHRoZXJhcGlzdC5wcmFjdGljZVN0YXJ0RGF0ZSkgKiAyLFxuICAgICAgMjAsXG4gICAgKTtcbiAgICAvLyBBZGQgYmFzZSBzY29yZSBmb3IgZXhwZXJpZW5jZVxuICAgIHNjb3JlICs9IHRoZXJhcGlzdC55ZWFyc09mRXhwZXJpZW5jZSA/IHRoZXJhcGlzdC55ZWFyc09mRXhwZXJpZW5jZSAqIDIgOiAwO1xuICAgIHJldHVybiBzY29yZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UHJpbWFyeUNvbmRpdGlvbnMoXG4gICAgdXNlckNvbmRpdGlvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXG4gICk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXModXNlckNvbmRpdGlvbnMpXG4gICAgICAuZmlsdGVyKChbLCBzZXZlcml0eV0pID0+IHRoaXMuZ2V0U2V2ZXJpdHlXZWlnaHQoc2V2ZXJpdHkpID49IDQpXG4gICAgICAubWFwKChbY29uZGl0aW9uXSkgPT4gY29uZGl0aW9uKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2Vjb25kYXJ5Q29uZGl0aW9ucyhcbiAgICB1c2VyQ29uZGl0aW9uczogUmVjb3JkPHN0cmluZywgc3RyaW5nPixcbiAgKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBPYmplY3QuZW50cmllcyh1c2VyQ29uZGl0aW9ucylcbiAgICAgIC5maWx0ZXIoKFssIHNldmVyaXR5XSkgPT4ge1xuICAgICAgICBjb25zdCB3ZWlnaHQgPSB0aGlzLmdldFNldmVyaXR5V2VpZ2h0KHNldmVyaXR5KTtcbiAgICAgICAgcmV0dXJuIHdlaWdodCA+PSAyICYmIHdlaWdodCA8IDQ7XG4gICAgICB9KVxuICAgICAgLm1hcCgoW2NvbmRpdGlvbl0pID0+IGNvbmRpdGlvbik7XG4gIH1cblxuICBwcml2YXRlIGdldFNldmVyaXR5V2VpZ2h0KHNldmVyaXR5OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IHNldmVyaXR5V2VpZ2h0czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgICAgIE1pbmltYWw6IDEsXG4gICAgICBNaWxkOiAyLFxuICAgICAgTW9kZXJhdGU6IDMsXG4gICAgICAnTW9kZXJhdGVseSBTZXZlcmUnOiA0LFxuICAgICAgU2V2ZXJlOiA1LFxuICAgICAgJ1ZlcnkgU2V2ZXJlJzogNSxcbiAgICAgIEV4dHJlbWU6IDUsXG4gICAgICBMb3c6IDEsXG4gICAgICBIaWdoOiA0LFxuICAgICAgU3Vic3RhbnRpYWw6IDQsXG4gICAgICBTdWJjbGluaWNhbDogMSxcbiAgICAgIENsaW5pY2FsOiA0LFxuICAgICAgTm9uZTogMCxcbiAgICAgIFN1YnRocmVzaG9sZDogMixcbiAgICAgIFBvc2l0aXZlOiA0LFxuICAgICAgTmVnYXRpdmU6IDAsXG4gICAgfTtcbiAgICByZXR1cm4gc2V2ZXJpdHlXZWlnaHRzW3NldmVyaXR5XSB8fCAxO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VzcyBob3cgd2VsbCB0aGVyYXBpc3QncyBhdmFpbGFiaWxpdHkgYWxpZ25zIHdpdGggY2xpZW50J3MgdXJnZW5jeSBuZWVkc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3Nlc3NVcmdlbmN5QWxpZ25tZW50KFxuICAgIHRoZXJhcGlzdDogYW55LFxuICAgIGNsaW5pY2FsQW5hbHlzaXM6IGFueSxcbiAgKToge1xuICAgIHNjb3JlOiBudW1iZXI7XG4gICAgcmVhc29uaW5nOiBzdHJpbmc7XG4gIH0ge1xuICAgIGNvbnN0IHVyZ2VuY3lMZXZlbCA9XG4gICAgICBjbGluaWNhbEFuYWx5c2lzLnRyZWF0bWVudFBsYW4udGhlcmFwaXN0Q3JpdGVyaWEudXJnZW5jeUxldmVsO1xuICAgIGNvbnN0IHJpc2tMZXZlbCA9IGNsaW5pY2FsQW5hbHlzaXMucmlza0Fzc2Vzc21lbnQub3ZlcmFsbFJpc2s7XG5cbiAgICBsZXQgc2NvcmUgPSA3MDsgLy8gQmFzZSBzY29yZVxuICAgIGxldCByZWFzb25pbmcgPSAnU3RhbmRhcmQgYXZhaWxhYmlsaXR5IGFsaWdubWVudCc7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyYXBpc3QgY2FuIGhhbmRsZSB1cmdlbnQgY2FzZXNcbiAgICBpZiAodXJnZW5jeUxldmVsID09PSAnaW1tZWRpYXRlJyB8fCByaXNrTGV2ZWwgPT09ICdjcml0aWNhbCcpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhlcmFwaXN0LmFjY2VwdHNFbWVyZ2VuY3lBcHBvaW50bWVudHMgfHxcbiAgICAgICAgdGhlcmFwaXN0Lmhhc0ltbWVkaWF0ZUF2YWlsYWJpbGl0eVxuICAgICAgKSB7XG4gICAgICAgIHNjb3JlID0gOTU7XG4gICAgICAgIHJlYXNvbmluZyA9XG4gICAgICAgICAgJ0V4Y2VsbGVudCBmb3IgY3Jpc2lzIGludGVydmVudGlvbiAtIGltbWVkaWF0ZSBhdmFpbGFiaWxpdHknO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2NvcmUgPSAzMDtcbiAgICAgICAgcmVhc29uaW5nID0gJ01heSBub3QgYmUgc3VpdGFibGUgZm9yIGltbWVkaWF0ZSBpbnRlcnZlbnRpb24gbmVlZHMnO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodXJnZW5jeUxldmVsID09PSAnaGlnaCcpIHtcbiAgICAgIGlmICh0aGVyYXBpc3Qud2Vla2x5QXZhaWxhYmlsaXR5IHx8IHRoZXJhcGlzdC5mbGV4aWJsZVNjaGVkdWxpbmcpIHtcbiAgICAgICAgc2NvcmUgPSA4NTtcbiAgICAgICAgcmVhc29uaW5nID0gJ0dvb2QgYXZhaWxhYmlsaXR5IGZvciB1cmdlbnQgdGhlcmFwZXV0aWMgbmVlZHMnO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IHNjb3JlLCByZWFzb25pbmcgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3Nlc3MgdGhlcmFwaXN0J3Mgc3BlY2lhbGl6YXRpb24gbWF0Y2ggd2l0aCBjbGllbnQncyBjb25kaXRpb25zXG4gICAqL1xuICBwcml2YXRlIGFzc2Vzc1NwZWNpYWxpemF0aW9uTWF0Y2goXG4gICAgdGhlcmFwaXN0OiBhbnksXG4gICAgY2xpbmljYWxBbmFseXNpczogYW55LFxuICApOiB7XG4gICAgc2NvcmU6IG51bWJlcjtcbiAgICBtYXRjaGVkU3BlY2lhbGl6YXRpb25zOiBzdHJpbmdbXTtcbiAgICByZWFzb25pbmc6IHN0cmluZztcbiAgfSB7XG4gICAgY29uc3QgcmVxdWlyZWRTcGVjcyA9XG4gICAgICBjbGluaWNhbEFuYWx5c2lzLnRyZWF0bWVudFBsYW4udGhlcmFwaXN0Q3JpdGVyaWEucmVxdWlyZWRTcGVjaWFsaXphdGlvbnM7XG4gICAgY29uc3QgdGhlcmFwaXN0U3BlY3MgPSBbXG4gICAgICAuLi4odGhlcmFwaXN0LmV4cGVydGlzZSB8fCBbXSksXG4gICAgICAuLi4odGhlcmFwaXN0LmlsbG5lc3NTcGVjaWFsaXphdGlvbnMgfHwgW10pLFxuICAgIF07XG5cbiAgICBjb25zdCBtYXRjaGVkU3BlY3MgPSByZXF1aXJlZFNwZWNzLmZpbHRlcigocmVxKSA9PlxuICAgICAgdGhlcmFwaXN0U3BlY3Muc29tZShcbiAgICAgICAgKHNwZWMpID0+XG4gICAgICAgICAgc3BlYy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHJlcS50b0xvd2VyQ2FzZSgpKSB8fFxuICAgICAgICAgIHJlcS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNwZWMudG9Mb3dlckNhc2UoKSksXG4gICAgICApLFxuICAgICk7XG5cbiAgICBjb25zdCBtYXRjaFJhdGlvID1cbiAgICAgIHJlcXVpcmVkU3BlY3MubGVuZ3RoID4gMCA/IG1hdGNoZWRTcGVjcy5sZW5ndGggLyByZXF1aXJlZFNwZWNzLmxlbmd0aCA6IDE7XG4gICAgY29uc3Qgc2NvcmUgPSBNYXRoLnJvdW5kKG1hdGNoUmF0aW8gKiAxMDApO1xuXG4gICAgbGV0IHJlYXNvbmluZyA9IGBNYXRjaGVzICR7bWF0Y2hlZFNwZWNzLmxlbmd0aH0vJHtyZXF1aXJlZFNwZWNzLmxlbmd0aH0gcmVxdWlyZWQgc3BlY2lhbGl6YXRpb25zYDtcbiAgICBpZiAoc2NvcmUgPj0gODApIHJlYXNvbmluZyA9ICdFeGNlbGxlbnQgc3BlY2lhbGl6YXRpb24gbWF0Y2gnO1xuICAgIGVsc2UgaWYgKHNjb3JlID49IDYwKSByZWFzb25pbmcgPSAnR29vZCBzcGVjaWFsaXphdGlvbiBhbGlnbm1lbnQnO1xuICAgIGVsc2UgaWYgKHNjb3JlID49IDQwKSByZWFzb25pbmcgPSAnUGFydGlhbCBzcGVjaWFsaXphdGlvbiBtYXRjaCc7XG4gICAgZWxzZSByZWFzb25pbmcgPSAnTGltaXRlZCBzcGVjaWFsaXphdGlvbiBtYXRjaCc7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2NvcmUsXG4gICAgICBtYXRjaGVkU3BlY2lhbGl6YXRpb25zOiBtYXRjaGVkU3BlY3MsXG4gICAgICByZWFzb25pbmcsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3Nlc3MgaWYgdGhlcmFwaXN0IGhhcyBhZGVxdWF0ZSBleHBlcmllbmNlIGZvciBjbGllbnQncyBuZWVkc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3Nlc3NFeHBlcmllbmNlQWRlcXVhY3koXG4gICAgdGhlcmFwaXN0OiBhbnksXG4gICAgY2xpbmljYWxBbmFseXNpczogYW55LFxuICApOiB7XG4gICAgc2NvcmU6IG51bWJlcjtcbiAgICByZWFzb25pbmc6IHN0cmluZztcbiAgfSB7XG4gICAgY29uc3QgcmVxdWlyZWRMZXZlbCA9XG4gICAgICBjbGluaWNhbEFuYWx5c2lzLnRyZWF0bWVudFBsYW4udGhlcmFwaXN0Q3JpdGVyaWEuZXhwZXJpZW5jZUxldmVsO1xuICAgIGNvbnN0IHRoZXJhcGlzdFllYXJzID1cbiAgICAgIHRoZXJhcGlzdC55ZWFyc09mRXhwZXJpZW5jZSB8fFxuICAgICAgdGhpcy5jYWxjdWxhdGVZZWFyc09mRXhwZXJpZW5jZSh0aGVyYXBpc3QucHJhY3RpY2VTdGFydERhdGUpO1xuXG4gICAgY29uc3QgcmVxdWlyZWRZZWFycyA9XG4gICAgICB7XG4gICAgICAgIGFueTogMCxcbiAgICAgICAgaW50ZXJtZWRpYXRlOiAzLFxuICAgICAgICBzZW5pb3I6IDcsXG4gICAgICAgIGV4cGVydDogMTIsXG4gICAgICB9W3JlcXVpcmVkTGV2ZWxdIHx8IDA7XG5cbiAgICBpZiAodGhlcmFwaXN0WWVhcnMgPj0gcmVxdWlyZWRZZWFycykge1xuICAgICAgY29uc3Qgc2NvcmUgPSBNYXRoLm1pbigxMDAsIDcwICsgKHRoZXJhcGlzdFllYXJzIC0gcmVxdWlyZWRZZWFycykgKiAzKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNjb3JlLFxuICAgICAgICByZWFzb25pbmc6IGAke3RoZXJhcGlzdFllYXJzfSB5ZWFycyBleHBlcmllbmNlIG1lZXRzICR7cmVxdWlyZWRMZXZlbH0gbGV2ZWwgcmVxdWlyZW1lbnRgLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc2NvcmUgPSBNYXRoLm1heCgyMCwgKHRoZXJhcGlzdFllYXJzIC8gcmVxdWlyZWRZZWFycykgKiA2MCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzY29yZSxcbiAgICAgICAgcmVhc29uaW5nOiBgJHt0aGVyYXBpc3RZZWFyc30geWVhcnMgZXhwZXJpZW5jZSBiZWxvdyAke3JlcXVpcmVkTGV2ZWx9IGxldmVsICgke3JlcXVpcmVkWWVhcnN9KyB5ZWFycylgLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXNzZXNzIHRoZXJhcGlzdCdzIHRoZXJhcGV1dGljIGFwcHJvYWNoIGNvbXBhdGliaWxpdHlcbiAgICovXG4gIHByaXZhdGUgYXNzZXNzQXBwcm9hY2hDb21wYXRpYmlsaXR5KFxuICAgIHRoZXJhcGlzdDogYW55LFxuICAgIGNsaW5pY2FsQW5hbHlzaXM6IGFueSxcbiAgKToge1xuICAgIHNjb3JlOiBudW1iZXI7XG4gICAgbWF0Y2hlZEFwcHJvYWNoZXM6IHN0cmluZ1tdO1xuICAgIHJlYXNvbmluZzogc3RyaW5nO1xuICB9IHtcbiAgICBjb25zdCBwcmVmZXJyZWRBcHByb2FjaGVzID1cbiAgICAgIGNsaW5pY2FsQW5hbHlzaXMudHJlYXRtZW50UGxhbi50aGVyYXBpc3RDcml0ZXJpYS5wcmVmZXJyZWRBcHByb2FjaGVzO1xuICAgIGNvbnN0IHRoZXJhcGlzdEFwcHJvYWNoZXMgPSBbXG4gICAgICAuLi4odGhlcmFwaXN0LmFwcHJvYWNoZXMgfHwgW10pLFxuICAgICAgLi4uKHRoZXJhcGlzdC50aGVyYXBldXRpY0FwcHJvYWNoZXNVc2VkTGlzdCB8fCBbXSksXG4gICAgXTtcblxuICAgIGNvbnN0IG1hdGNoZWRBcHByb2FjaGVzID0gcHJlZmVycmVkQXBwcm9hY2hlcy5maWx0ZXIoKHByZWYpID0+XG4gICAgICB0aGVyYXBpc3RBcHByb2FjaGVzLnNvbWUoXG4gICAgICAgIChhcHByb2FjaCkgPT5cbiAgICAgICAgICBhcHByb2FjaC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHByZWYudG9Mb3dlckNhc2UoKSkgfHxcbiAgICAgICAgICBwcmVmLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoYXBwcm9hY2gudG9Mb3dlckNhc2UoKSksXG4gICAgICApLFxuICAgICk7XG5cbiAgICBjb25zdCBtYXRjaFJhdGlvID1cbiAgICAgIHByZWZlcnJlZEFwcHJvYWNoZXMubGVuZ3RoID4gMFxuICAgICAgICA/IG1hdGNoZWRBcHByb2FjaGVzLmxlbmd0aCAvIHByZWZlcnJlZEFwcHJvYWNoZXMubGVuZ3RoXG4gICAgICAgIDogMC43O1xuICAgIGNvbnN0IHNjb3JlID0gTWF0aC5yb3VuZChtYXRjaFJhdGlvICogMTAwKTtcblxuICAgIGxldCByZWFzb25pbmcgPSBgTWF0Y2hlcyAke21hdGNoZWRBcHByb2FjaGVzLmxlbmd0aH0vJHtwcmVmZXJyZWRBcHByb2FjaGVzLmxlbmd0aH0gcHJlZmVycmVkIGFwcHJvYWNoZXNgO1xuICAgIGlmIChzY29yZSA+PSA4MCkgcmVhc29uaW5nID0gJ0V4Y2VsbGVudCB0aGVyYXBldXRpYyBhcHByb2FjaCBtYXRjaCc7XG4gICAgZWxzZSBpZiAoc2NvcmUgPj0gNjApIHJlYXNvbmluZyA9ICdHb29kIGFwcHJvYWNoIGNvbXBhdGliaWxpdHknO1xuICAgIGVsc2UgaWYgKHNjb3JlID49IDQwKSByZWFzb25pbmcgPSAnU29tZSBhcHByb2FjaCBhbGlnbm1lbnQnO1xuICAgIGVsc2UgcmVhc29uaW5nID0gJ0xpbWl0ZWQgYXBwcm9hY2ggbWF0Y2ggLSBtYXkgc3RpbGwgYmUgZWZmZWN0aXZlJztcblxuICAgIHJldHVybiB7XG4gICAgICBzY29yZSxcbiAgICAgIG1hdGNoZWRBcHByb2FjaGVzLFxuICAgICAgcmVhc29uaW5nLFxuICAgIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==