{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/search/search.controller.ts"],"sourcesContent":["import { Controller, Get, Query, UseGuards, Req } from '@nestjs/common';\nimport { SearchService } from './search.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport {\n  SearchTherapistsQueryDtoSchema,\n  SearchPostsQueryDtoSchema,\n  SearchCommunitiesQueryDtoSchema,\n  SearchUsersQueryDtoSchema,\n  GlobalSearchQueryDtoSchema,\n} from './validation/search.schemas';\nimport type {\n  SearchTherapistsQueryDto,\n  SearchPostsQueryDto,\n  SearchCommunitiesQueryDto,\n  SearchUsersQueryDto,\n  GlobalSearchQueryDto,\n} from './types';\n\n@Controller('search')\n@UseGuards(JwtAuthGuard)\nexport class SearchController {\n  constructor(private readonly searchService: SearchService) {}\n\n  @Get('therapists')\n  searchTherapists(\n    @Query(new ZodValidationPipe(SearchTherapistsQueryDtoSchema))\n    query: SearchTherapistsQueryDto,\n  ) {\n    return this.searchService.searchTherapists(query.query || '', {\n      location: query.location,\n      specialties: query.specialties,\n      priceRange: query.priceRange,\n      experienceYears: query.experienceYears,\n      rating: query.rating,\n      gender: query.gender,\n      languages: query.languages,\n      availability: query.availability,\n      verifiedOnly: query.verifiedOnly,\n      // Map maxHourlyRate from priceRange.max for backward compatibility\n      maxHourlyRate: query.priceRange?.max,\n    });\n  }\n\n  @Get('posts')\n  searchPosts(\n    @Query(new ZodValidationPipe(SearchPostsQueryDtoSchema))\n    query: SearchPostsQueryDto,\n  ) {\n    return this.searchService.searchPosts(query.query, query.communityId);\n  }\n\n  @Get('communities')\n  searchCommunities(\n    @Query(new ZodValidationPipe(SearchCommunitiesQueryDtoSchema))\n    query: SearchCommunitiesQueryDto,\n  ) {\n    return this.searchService.searchCommunities(query.query);\n  }\n\n  @Get('users')\n  searchUsers(\n    @Query(new ZodValidationPipe(SearchUsersQueryDtoSchema))\n    query: SearchUsersQueryDto,\n  ) {\n    return this.searchService.searchUsers(query.query, query.role);\n  }\n\n  @Get('global')\n  globalSearch(\n    @Query(new ZodValidationPipe(GlobalSearchQueryDtoSchema))\n    query: GlobalSearchQueryDto,\n    @Req() req: any, // Get user from request\n  ) {\n    // Include worksheets and messages in supported types\n    const supportedTypes = query.types?.filter((type) =>\n      ['users', 'therapists', 'posts', 'communities', 'worksheets', 'messages'].includes(type),\n    ) as ('users' | 'therapists' | 'posts' | 'communities' | 'worksheets' | 'messages')[] | undefined;\n\n    // Extract user information from the request\n    const userId = req.userId;\n    const userRole = req.userRole;\n\n    return this.searchService.globalSearch(\n      query.query, \n      supportedTypes, \n      userId, \n      userRole\n    );\n  }\n}\n"],"version":3}