{"version":3,"names":["cov_1x2e811nhh","actualCoverage","common_1","s","require","prisma_client_provider_1","community_configs_1","CommunityAssignmentService","prisma","constructor","f","QUESTIONNAIRE_TO_COMMUNITY_MAP","phobia","burnout","insomnia","ptsd","adhd","alcohol","SEVERITY_THRESHOLD","minimal","mild","moderate","severe","assignCommunitiesToUser","userId","console","log","userAssessment","preAssessment","findFirst","where","clientId","select","answers","b","assessmentData","scores","severityLevels","assignedCommunities","questionnaire","Object","entries","severity","communitySlug","toLowerCase","community","findUnique","slug","existingMembership","membership","userId_communityId","communityId","id","name","create","data","joinedAt","Date","push","error","assignGeneralSupportCommunities","length","generalCommunities","communityName","getRecommendedCommunities","recommendedCommunities","ILLNESS_COMMUNITIES","find","c","bulkAssignCommunities","userIds","results","exports","__decorate","Injectable","PrismaService","_a"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/community-assignment.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { ILLNESS_COMMUNITIES } from '../config/community-configs';\n\ninterface PreAssessmentScores {\n  [key: string]: number;\n}\n\ninterface SeverityLevels {\n  [key: string]: string;\n}\n\n@Injectable()\nexport class CommunityAssignmentService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  /**\n   * Maps questionnaire types to community slugs based on mental health conditions\n   */\n  private readonly QUESTIONNAIRE_TO_COMMUNITY_MAP = {\n    // Depression-related assessments\n    'phq-9': 'depression-support',\n    'mood-disorder': 'depression-support',\n\n    // Anxiety-related assessments\n    'gad-7-anxiety': 'anxiety-warriors',\n    'social-phobia': 'social-anxiety-support',\n    'panic-disorder': 'anxiety-warriors',\n    phobia: 'phobia-support',\n\n    // Stress-related assessments\n    'perceived-stress-scale': 'stress-support',\n    burnout: 'burnout-recovery',\n\n    // Sleep-related assessments\n    insomnia: 'insomnia-support',\n\n    // Trauma-related assessments\n    ptsd: 'ptsd-support',\n\n    // OCD-related assessments\n    'obsessional-compulsive': 'ocd-support',\n\n    // ADHD-related assessments\n    adhd: 'adhd-support',\n\n    // Eating disorder assessments\n    'binge-eating': 'eating-disorder-recovery',\n\n    // Substance use assessments\n    alcohol: 'substance-recovery-support',\n    'drug-abuse': 'substance-recovery-support',\n  };\n\n  /**\n   * Severity thresholds for community assignment\n   * Only assign to communities if severity is moderate or higher\n   */\n  private readonly SEVERITY_THRESHOLD = {\n    minimal: false,\n    mild: false,\n    moderate: true,\n    severe: true,\n    'very-severe': true,\n  };\n\n  /**\n   * Auto-assign communities to a user based on their pre-assessment results\n   */\n  async assignCommunitiesToUser(userId: string): Promise<string[]> {\n    console.log(`üîÑ Auto-assigning communities for user: ${userId}`);\n\n    // Get user's pre-assessment data\n    const userAssessment = await this.prisma.preAssessment.findFirst({\n      where: { clientId: userId },\n      select: {\n        answers: true,\n      },\n    });\n\n    if (!userAssessment) {\n      console.log(`‚ö†Ô∏è  No pre-assessment found for user: ${userId}`);\n      return [];\n    }\n\n    // Extract scores and severity levels from answers JSON\n    const assessmentData = userAssessment.answers as any;\n    if (!assessmentData || typeof assessmentData !== 'object') {\n      console.log(`‚ö†Ô∏è  Invalid assessment data for user: ${userId}`);\n      return [];\n    }\n\n    const scores = assessmentData.scores as PreAssessmentScores;\n    const severityLevels = assessmentData.severityLevels as SeverityLevels;\n\n    if (!scores || !severityLevels) {\n      console.log(`‚ö†Ô∏è  Missing scores or severity levels for user: ${userId}`);\n      return [];\n    }\n    const assignedCommunities: string[] = [];\n\n    // Iterate through questionnaire results and assign communities\n    for (const [questionnaire] of Object.entries(scores)) {\n      const severity = severityLevels[questionnaire];\n      const communitySlug = this.QUESTIONNAIRE_TO_COMMUNITY_MAP[questionnaire];\n\n      // Skip if no community mapping or severity is too low\n      if (!communitySlug || !this.SEVERITY_THRESHOLD[severity?.toLowerCase()]) {\n        continue;\n      }\n\n      // Find the community\n      const community = await this.prisma.community.findUnique({\n        where: { slug: communitySlug },\n      });\n\n      if (!community) {\n        console.log(`‚ö†Ô∏è  Community not found for slug: ${communitySlug}`);\n        continue;\n      }\n\n      // Check if user is already a member\n      const existingMembership = await this.prisma.membership.findUnique({\n        where: {\n          userId_communityId: {\n            userId: userId,\n            communityId: community.id,\n          },\n        },\n      });\n\n      if (existingMembership) {\n        console.log(`‚è≠Ô∏è  User already member of: ${community.name}`);\n        continue;\n      }\n\n      // Create membership\n      try {\n        await this.prisma.membership.create({\n          data: {\n            userId: userId,\n            communityId: community.id,\n            joinedAt: new Date(),\n          },\n        });\n\n        assignedCommunities.push(community.name);\n        console.log(\n          `‚úÖ Assigned user to community: ${community.name} (${severity} ${questionnaire})`,\n        );\n      } catch (error) {\n        console.error(\n          `‚ùå Failed to assign community ${community.name}:`,\n          error,\n        );\n      }\n    }\n\n    // Always assign to general support communities\n    await this.assignGeneralSupportCommunities(userId);\n\n    console.log(\n      `üéØ Auto-assignment complete. Assigned ${assignedCommunities.length} communities.`,\n    );\n    return assignedCommunities;\n  }\n\n  /**\n   * Assign user to general support communities regardless of assessment results\n   */\n  private async assignGeneralSupportCommunities(userId: string): Promise<void> {\n    const generalCommunities = ['Support Circle', 'Mindfulness & Meditation'];\n\n    for (const communityName of generalCommunities) {\n      const community = await this.prisma.community.findFirst({\n        where: { name: communityName },\n      });\n\n      if (!community) continue;\n\n      // Check if user is already a member\n      const existingMembership = await this.prisma.membership.findUnique({\n        where: {\n          userId_communityId: {\n            userId: userId,\n            communityId: community.id,\n          },\n        },\n      });\n\n      if (existingMembership) continue;\n\n      try {\n        await this.prisma.membership.create({\n          data: {\n            userId: userId,\n            communityId: community.id,\n            joinedAt: new Date(),\n          },\n        });\n        console.log(`‚úÖ Assigned user to general community: ${community.name}`);\n      } catch (error) {\n        console.error(\n          `‚ùå Failed to assign general community ${community.name}:`,\n          error,\n        );\n      }\n    }\n  }\n\n  /**\n   * Get communities a user should be assigned to based on their assessment (preview mode)\n   */\n  async getRecommendedCommunities(userId: string): Promise<string[]> {\n    const userAssessment = await this.prisma.preAssessment.findFirst({\n      where: { clientId: userId },\n      select: {\n        answers: true,\n      },\n    });\n\n    if (!userAssessment) {\n      return [];\n    }\n\n    // Extract scores and severity levels from answers JSON\n    const assessmentData = userAssessment.answers as any;\n    if (!assessmentData || typeof assessmentData !== 'object') {\n      return [];\n    }\n\n    const scores = assessmentData.scores as PreAssessmentScores;\n    const severityLevels = assessmentData.severityLevels as SeverityLevels;\n\n    if (!scores || !severityLevels) {\n      return [];\n    }\n    const recommendedCommunities: string[] = [];\n\n    for (const [questionnaire] of Object.entries(scores)) {\n      const severity = severityLevels[questionnaire];\n      const communitySlug = this.QUESTIONNAIRE_TO_COMMUNITY_MAP[questionnaire];\n\n      if (communitySlug && this.SEVERITY_THRESHOLD[severity?.toLowerCase()]) {\n        const community = ILLNESS_COMMUNITIES.find(\n          (c) => c.slug === communitySlug,\n        );\n        if (community) {\n          recommendedCommunities.push(community.name);\n        }\n      }\n    }\n\n    return recommendedCommunities;\n  }\n\n  /**\n   * Bulk assign communities to multiple users (useful for existing users)\n   */\n  async bulkAssignCommunities(\n    userIds: string[],\n  ): Promise<{ [userId: string]: string[] }> {\n    const results: { [userId: string]: string[] } = {};\n\n    for (const userId of userIds) {\n      try {\n        results[userId] = await this.assignCommunitiesToUser(userId);\n      } catch (error) {\n        console.error(`Error assigning communities to user ${userId}:`, error);\n        results[userId] = [];\n      }\n    }\n\n    return results;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}