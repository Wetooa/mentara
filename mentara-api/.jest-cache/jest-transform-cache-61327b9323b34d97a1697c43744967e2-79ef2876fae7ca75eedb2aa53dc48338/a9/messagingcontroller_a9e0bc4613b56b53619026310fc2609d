dfc8e219a6b86f882c4a3e445094c83a
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MessagingController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const messaging_service_1 = require("./messaging.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../auth/decorators/current-user-id.decorator");
const swagger_1 = require("@nestjs/swagger");
const supabase_storage_service_1 = require("../common/services/supabase-storage.service");
const mentara_commons_1 = require("mentara-commons");
let MessagingController = class MessagingController {
    messagingService;
    supabaseStorageService;
    constructor(messagingService, supabaseStorageService) {
        this.messagingService = messagingService;
        this.supabaseStorageService = supabaseStorageService;
    }
    // Conversation endpoints
    async createConversation(userId, createConversationDto) {
        return this.messagingService.createConversation(userId, createConversationDto);
    }
    async getUserConversations(userId, params) {
        return this.messagingService.getUserConversations(userId, params.page || 1, params.limit || 20);
    }
    async getConversationMessages(userId, conversationId, params) {
        const pageNum = params.page || 1;
        const limitNum = params.limit || 50;
        return this.messagingService.getConversationMessages(userId, conversationId, pageNum, limitNum);
    }
    // Message endpoints
    async sendMessage(userId, conversationId, sendMessageDto, files = []) {
        // Validate and upload files if provided
        const fileResults = [];
        if (files && files.length > 0) {
            for (const file of files) {
                const validation = this.supabaseStorageService.validateFile(file);
                if (!validation.isValid) {
                    throw new common_1.HttpException(`File validation failed: ${validation.error}`, common_1.HttpStatus.BAD_REQUEST);
                }
            }
            // Upload files to Supabase
            const uploadResults = await this.supabaseStorageService.uploadFiles(files, supabase_storage_service_1.SupabaseStorageService.getSupportedBuckets().MESSAGES);
            fileResults.push(...uploadResults);
        }
        return this.messagingService.sendMessage(userId, conversationId, sendMessageDto, fileResults.map((f) => f.url), fileResults.map((f) => f.filename), files.map((f) => f.size));
    }
    async updateMessage(userId, messageId, updateMessageDto) {
        return this.messagingService.updateMessage(userId, messageId, updateMessageDto);
    }
    async deleteMessage(userId, messageId) {
        return this.messagingService.deleteMessage(userId, messageId);
    }
    // Read receipts
    async markMessageAsRead(userId, messageId) {
        return this.messagingService.markMessageAsRead(userId, messageId);
    }
    // Message reactions
    async addMessageReaction(userId, messageId, addReactionDto) {
        return this.messagingService.addMessageReaction(userId, messageId, addReactionDto.emoji);
    }
    async removeMessageReaction(userId, messageId, emoji) {
        return this.messagingService.removeMessageReaction(userId, messageId, emoji);
    }
    // User blocking
    async blockUser(userId, blockUserDto) {
        return this.messagingService.blockUser(userId, blockUserDto.userId, blockUserDto.reason);
    }
    async unblockUser(userId, blockedUserId) {
        return this.messagingService.unblockUser(userId, blockedUserId);
    }
    // Search messages
    async searchMessages(userId, searchDto) {
        const { query, conversationId, page, limit } = searchDto;
        const pageNum = page ? Number(page) : 1;
        const limitNum = limit ? Number(limit) : 20;
        return this.messagingService.searchMessages(userId, query, conversationId, pageNum, limitNum);
    }
};
exports.MessagingController = MessagingController;
__decorate([
    (0, common_1.Post)('conversations'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create create conversation',
        description: 'Create create conversation'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_c = typeof mentara_commons_1.CreateConversationDto !== "undefined" && mentara_commons_1.CreateConversationDto) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "createConversation", null);
__decorate([
    (0, common_1.Get)('conversations'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get user conversations',
        description: 'Retrieve get user conversations'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_d = typeof mentara_commons_1.ConversationListParams !== "undefined" && mentara_commons_1.ConversationListParams) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "getUserConversations", null);
__decorate([
    (0, common_1.Get)('conversations/:conversationId/messages'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get conversation messages',
        description: 'Retrieve get conversation messages'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('conversationId')),
    __param(2, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_e = typeof mentara_commons_1.ConversationListParams !== "undefined" && mentara_commons_1.ConversationListParams) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "getConversationMessages", null);
__decorate([
    (0, common_1.Post)('conversations/:conversationId/messages'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create send message',
        description: 'Create send message'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.UseInterceptors)((0, platform_express_1.FilesInterceptor)('files', 3)) // Support up to 3 files
    ,
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('conversationId')),
    __param(2, (0, common_1.Body)()),
    __param(3, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_f = typeof mentara_commons_1.SendMessageDto !== "undefined" && mentara_commons_1.SendMessageDto) === "function" ? _f : Object, Array]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "sendMessage", null);
__decorate([
    (0, common_1.Put)('messages/:messageId'),
    (0, swagger_1.ApiOperation)({
        summary: 'Update update message',
        description: 'Update update message'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Updated successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('messageId')),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_g = typeof mentara_commons_1.UpdateMessageDto !== "undefined" && mentara_commons_1.UpdateMessageDto) === "function" ? _g : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "updateMessage", null);
__decorate([
    (0, common_1.Delete)('messages/:messageId'),
    (0, swagger_1.ApiOperation)({
        summary: 'Delete delete message',
        description: 'Delete delete message'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Deleted successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.NO_CONTENT),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('messageId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "deleteMessage", null);
__decorate([
    (0, common_1.Post)('messages/:messageId/read'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create mark message as read',
        description: 'Create mark message as read'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('messageId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "markMessageAsRead", null);
__decorate([
    (0, common_1.Post)('messages/:messageId/reactions'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create add message reaction',
        description: 'Create add message reaction'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('messageId')),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, typeof (_h = typeof mentara_commons_1.AddReactionDto !== "undefined" && mentara_commons_1.AddReactionDto) === "function" ? _h : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "addMessageReaction", null);
__decorate([
    (0, common_1.Delete)('messages/:messageId/reactions/:emoji'),
    (0, swagger_1.ApiOperation)({
        summary: 'Delete remove message reaction',
        description: 'Delete remove message reaction'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Deleted successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.NO_CONTENT),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('messageId')),
    __param(2, (0, common_1.Param)('emoji')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, String]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "removeMessageReaction", null);
__decorate([
    (0, common_1.Post)('block'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create block user',
        description: 'Create block user'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_j = typeof mentara_commons_1.BlockUserDto !== "undefined" && mentara_commons_1.BlockUserDto) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "blockUser", null);
__decorate([
    (0, common_1.Delete)('block/:blockedUserId'),
    (0, swagger_1.ApiOperation)({
        summary: 'Delete unblock user',
        description: 'Delete unblock user'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Deleted successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    (0, common_1.HttpCode)(common_1.HttpStatus.NO_CONTENT),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Param)('blockedUserId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "unblockUser", null);
__decorate([
    (0, common_1.Get)('search'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve search messages',
        description: 'Retrieve search messages'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_k = typeof mentara_commons_1.SearchMessagesDto !== "undefined" && mentara_commons_1.SearchMessagesDto) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], MessagingController.prototype, "searchMessages", null);
exports.MessagingController = MessagingController = __decorate([
    (0, swagger_1.ApiTags)('messaging'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('messaging'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof messaging_service_1.MessagingService !== "undefined" && messaging_service_1.MessagingService) === "function" ? _a : Object, typeof (_b = typeof supabase_storage_service_1.SupabaseStorageService !== "undefined" && supabase_storage_service_1.SupabaseStorageService) === "function" ? _b : Object])
], MessagingController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9tZXNzYWdpbmcuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBZXdCO0FBQ3hCLCtEQUE0RDtBQUM1RCwyREFBdUQ7QUFDdkQsa0VBQTZEO0FBQzdELDRGQUE2RTtBQUM3RSw2Q0FReUI7QUFDekIsMEZBR3FEO0FBQ3JELHFEQVF5QjtBQU1sQixJQUFNLG1CQUFtQixHQUF6QixNQUFNLG1CQUFtQjtJQUVYO0lBQ0E7SUFGbkIsWUFDbUIsZ0JBQWtDLEVBQ2xDLHNCQUE4QztRQUQ5QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7SUFDOUQsQ0FBQztJQUVKLHlCQUF5QjtJQXVCbkIsQUFBTixLQUFLLENBQUMsa0JBQWtCLENBQ0wsTUFBYyxFQUN2QixxQkFBNEM7UUFFcEQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLENBQzdDLE1BQU0sRUFDTixxQkFBcUIsQ0FDdEIsQ0FBQztJQUNKLENBQUM7SUFpQ0ssQUFBTixLQUFLLENBQUMsb0JBQW9CLENBQ1AsTUFBYyxFQUN0QixNQUE4QjtRQUV2QyxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FDL0MsTUFBTSxFQUNOLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUNoQixNQUFNLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FDbkIsQ0FBQztJQUNKLENBQUM7SUFpQ0ssQUFBTixLQUFLLENBQUMsdUJBQXVCLENBQ1YsTUFBYyxFQUNOLGNBQXNCLEVBQ3RDLE1BQThCO1FBRXZDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxD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WCxXQUFXLEVBQUUsd0JBQXdCO0tBRXRDLENBQUM7SUFFRCxJQUFBLHFCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsQ0FBQztJQUl2RCxXQUFBLElBQUEseUNBQWEsR0FBRSxDQUFBO0lBQ2YsV0FBQSxJQUFBLGNBQUssR0FBRSxDQUFBOztpRUFBWSxtQ0FBaUIsb0JBQWpCLG1DQUFpQjs7eURBWXRDOzhCQXhlVSxtQkFBbUI7SUFKL0IsSUFBQSxpQkFBTyxFQUFDLFdBQVcsQ0FBQztJQUNwQixJQUFBLHVCQUFhLEVBQUMsVUFBVSxDQUFDO0lBQ3pCLElBQUEsbUJBQVUsRUFBQyxXQUFXLENBQUM7SUFDdkIsSUFBQSxrQkFBUyxFQUFDLDZCQUFZLENBQUM7eURBR2Usb0NBQWdCLG9CQUFoQixvQ0FBZ0Isb0RBQ1YsaURBQXNCLG9CQUF0QixpREFBc0I7R0FIdEQsbUJBQW1CLENBeWUvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvbWVzc2FnaW5nL21lc3NhZ2luZy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUG9zdCxcbiAgUHV0LFxuICBEZWxldGUsXG4gIFBhcmFtLFxuICBRdWVyeSxcbiAgQm9keSxcbiAgVXNlR3VhcmRzLFxuICBVc2VJbnRlcmNlcHRvcnMsXG4gIFVwbG9hZGVkRmlsZXMsXG4gIEh0dHBDb2RlLFxuICBIdHRwU3RhdHVzLFxuICBIdHRwRXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBGaWxlc0ludGVyY2VwdG9yIH0gZnJvbSAnQG5lc3Rqcy9wbGF0Zm9ybS1leHByZXNzJztcbmltcG9ydCB7IE1lc3NhZ2luZ1NlcnZpY2UgfSBmcm9tICcuL21lc3NhZ2luZy5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEN1cnJlbnRVc2VySWQgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLWlkLmRlY29yYXRvcic7XG5pbXBvcnQge1xuICBBcGlUYWdzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVJlc3BvbnNlLFxuICBBcGlCb2R5LFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlQYXJhbSxcbiAgQXBpUXVlcnksXG59IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5pbXBvcnQge1xuICBTdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLFxuICBGaWxlVXBsb2FkUmVzdWx0LFxufSBmcm9tICcuLi9jb21tb24vc2VydmljZXMvc3VwYWJhc2Utc3RvcmFnZS5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIENyZWF0ZUNvbnZlcnNhdGlvbkR0byxcbiAgU2VuZE1lc3NhZ2VEdG8sXG4gIFVwZGF0ZU1lc3NhZ2VEdG8sXG4gIEFkZFJlYWN0aW9uRHRvLFxuICBCbG9ja1VzZXJEdG8sXG4gIFNlYXJjaE1lc3NhZ2VzRHRvLFxuICBDb252ZXJzYXRpb25MaXN0UGFyYW1zLFxufSBmcm9tICdtZW50YXJhLWNvbW1vbnMnO1xuXG5AQXBpVGFncygnbWVzc2FnaW5nJylcbkBBcGlCZWFyZXJBdXRoKCdKV1QtYXV0aCcpXG5AQ29udHJvbGxlcignbWVzc2FnaW5nJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIE1lc3NhZ2luZ0NvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1lc3NhZ2luZ1NlcnZpY2U6IE1lc3NhZ2luZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBzdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlOiBTdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLFxuICApIHt9XG5cbiAgLy8gQ29udmVyc2F0aW9uIGVuZHBvaW50c1xuICBAUG9zdCgnY29udmVyc2F0aW9ucycpXG5cbiAgQEFwaU9wZXJhdGlvbih7IFxuXG4gICAgc3VtbWFyeTogJ0NyZWF0ZSBjcmVhdGUgY29udmVyc2F0aW9uJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIGNyZWF0ZSBjb252ZXJzYXRpb24nIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cbiAgICBzdGF0dXM6IDIwMSwgXG5cbiAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyBcblxuICB9KVxuXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcblxuICBcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuQ1JFQVRFRClcbiAgYXN5bmMgY3JlYXRlQ29udmVyc2F0aW9uKFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQEJvZHkoKSBjcmVhdGVDb252ZXJzYXRpb25EdG86IENyZWF0ZUNvbnZlcnNhdGlvbkR0byxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnaW5nU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24oXG4gICAgICB1c2VySWQsXG4gICAgICBjcmVhdGVDb252ZXJzYXRpb25EdG8sXG4gICAgKTtcbiAgfVxuXG4gIEBHZXQoJ2NvbnZlcnNhdGlvbnMnKVxuXG5cbiAgQEFwaU9wZXJhdGlvbih7IFxuXG5cbiAgICBzdW1tYXJ5OiAnUmV0cmlldmUgZ2V0IHVzZXIgY29udmVyc2F0aW9ucycsXG5cblxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmUgZ2V0IHVzZXIgY29udmVyc2F0aW9ucycgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cblxuICBcbiAgYXN5bmMgZ2V0VXNlckNvbnZlcnNhdGlvbnMoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAUXVlcnkoKSBwYXJhbXM6IENvbnZlcnNhdGlvbkxpc3RQYXJhbXMsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2luZ1NlcnZpY2UuZ2V0VXNlckNvbnZlcnNhdGlvbnMoXG4gICAgICB1c2VySWQsXG4gICAgICBwYXJhbXMucGFnZSB8fCAxLFxuICAgICAgcGFyYW1zLmxpbWl0IHx8IDIwLFxuICAgICk7XG4gIH1cblxuICBAR2V0KCdjb252ZXJzYXRpb25zLzpjb252ZXJzYXRpb25JZC9tZXNzYWdlcycpXG5cblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cblxuICAgIHN1bW1hcnk6ICdSZXRyaWV2ZSBnZXQgY29udmVyc2F0aW9uIG1lc3NhZ2VzJyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSBnZXQgY29udmVyc2F0aW9uIG1lc3NhZ2VzJyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBcblxuXG4gICAgc3RhdHVzOiAyMDAsIFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknIFxuXG5cbiAgfSlcblxuXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcblxuXG4gIFxuICBhc3luYyBnZXRDb252ZXJzYXRpb25NZXNzYWdlcyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBQYXJhbSgnY29udmVyc2F0aW9uSWQnKSBjb252ZXJzYXRpb25JZDogc3RyaW5nLFxuICAgIEBRdWVyeSgpIHBhcmFtczogQ29udmVyc2F0aW9uTGlzdFBhcmFtcyxcbiAgKSB7XG4gICAgY29uc3QgcGFnZU51bSA9IHBhcmFtcy5wYWdlIHx8IDE7XG4gICAgY29uc3QgbGltaXROdW0gPSBwYXJhbXMubGltaXQgfHwgNTA7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnaW5nU2VydmljZS5nZXRDb252ZXJzYXRpb25NZXNzYWdlcyhcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgcGFnZU51bSxcbiAgICAgIGxpbWl0TnVtLFxuICAgICk7XG4gIH1cblxuICAvLyBNZXNzYWdlIGVuZHBvaW50c1xuICBAUG9zdCgnY29udmVyc2F0aW9ucy86Y29udmVyc2F0aW9uSWQvbWVzc2FnZXMnKVxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuICAgIHN1bW1hcnk6ICdDcmVhdGUgc2VuZCBtZXNzYWdlJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIHNlbmQgbWVzc2FnZScgXG5cbiAgfSlcblxuICBAQXBpUmVzcG9uc2UoeyBcblxuICAgIHN0YXR1czogMjAxLCBcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlZCBzdWNjZXNzZnVsbHknIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG4gIFxuICBAVXNlSW50ZXJjZXB0b3JzKEZpbGVzSW50ZXJjZXB0b3IoJ2ZpbGVzJywgMykpIC8vIFN1cHBvcnQgdXAgdG8gMyBmaWxlc1xuICBASHR0cENvZGUoSHR0cFN0YXR1cy5DUkVBVEVEKVxuICBhc3luYyBzZW5kTWVzc2FnZShcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBQYXJhbSgnY29udmVyc2F0aW9uSWQnKSBjb252ZXJzYXRpb25JZDogc3RyaW5nLFxuICAgIEBCb2R5KCkgc2VuZE1lc3NhZ2VEdG86IFNlbmRNZXNzYWdlRHRvLFxuICAgIEBVcGxvYWRlZEZpbGVzKCkgZmlsZXM6IEV4cHJlc3MuTXVsdGVyLkZpbGVbXSA9IFtdLCAvLyBPcHRpb25hbCBmaWxlc1xuICApIHtcbiAgICAvLyBWYWxpZGF0ZSBhbmQgdXBsb2FkIGZpbGVzIGlmIHByb3ZpZGVkXG4gICAgY29uc3QgZmlsZVJlc3VsdHM6IEZpbGVVcGxvYWRSZXN1bHRbXSA9IFtdO1xuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMuc3VwYWJhc2VTdG9yYWdlU2VydmljZS52YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oXG4gICAgICAgICAgICBgRmlsZSB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9yfWAsXG4gICAgICAgICAgICBIdHRwU3RhdHVzLkJBRF9SRVFVRVNULFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVXBsb2FkIGZpbGVzIHRvIFN1cGFiYXNlXG4gICAgICBjb25zdCB1cGxvYWRSZXN1bHRzID0gYXdhaXQgdGhpcy5zdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLnVwbG9hZEZpbGVzKFxuICAgICAgICBmaWxlcyxcbiAgICAgICAgU3VwYWJhc2VTdG9yYWdlU2VydmljZS5nZXRTdXBwb3J0ZWRCdWNrZXRzKCkuTUVTU0FHRVMsXG4gICAgICApO1xuICAgICAgZmlsZVJlc3VsdHMucHVzaCguLi51cGxvYWRSZXN1bHRzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5tZXNzYWdpbmdTZXJ2aWNlLnNlbmRNZXNzYWdlKFxuICAgICAgdXNlcklkLFxuICAgICAgY29udmVyc2F0aW9uSWQsXG4gICAgICBzZW5kTWVzc2FnZUR0byxcbiAgICAgIGZpbGVSZXN1bHRzLm1hcCgoZikgPT4gZi51cmwpLFxuICAgICAgZmlsZVJlc3VsdHMubWFwKChmKSA9PiBmLmZpbGVuYW1lKSxcbiAgICAgIGZpbGVzLm1hcCgoZikgPT4gZi5zaXplKSxcbiAgICApO1xuICB9XG5cbiAgQFB1dCgnbWVzc2FnZXMvOm1lc3NhZ2VJZCcpXG5cblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cblxuICAgIHN1bW1hcnk6ICdVcGRhdGUgdXBkYXRlIG1lc3NhZ2UnLFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZSB1cGRhdGUgbWVzc2FnZScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdVcGRhdGVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIGFzeW5jIHVwZGF0ZU1lc3NhZ2UoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAUGFyYW0oJ21lc3NhZ2VJZCcpIG1lc3NhZ2VJZDogc3RyaW5nLFxuICAgIEBCb2R5KCkgdXBkYXRlTWVzc2FnZUR0bzogVXBkYXRlTWVzc2FnZUR0byxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMubWVzc2FnaW5nU2VydmljZS51cGRhdGVNZXNzYWdlKFxuICAgICAgdXNlcklkLFxuICAgICAgbWVzc2FnZUlkLFxuICAgICAgdXBkYXRlTWVzc2FnZUR0byxcbiAgICApO1xuICB9XG5cbiAgQERlbGV0ZSgnbWVzc2FnZXMvOm1lc3NhZ2VJZCcpXG5cblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cblxuICAgIHN1bW1hcnk6ICdEZWxldGUgZGVsZXRlIG1lc3NhZ2UnLFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ0RlbGV0ZSBkZWxldGUgbWVzc2FnZScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk5PX0NPTlRFTlQpXG4gIGFzeW5jIGRlbGV0ZU1lc3NhZ2UoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAUGFyYW0oJ21lc3NhZ2VJZCcpIG1lc3NhZ2VJZDogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdpbmdTZXJ2aWNlLmRlbGV0ZU1lc3NhZ2UodXNlcklkLCBtZXNzYWdlSWQpO1xuICB9XG5cbiAgLy8gUmVhZCByZWNlaXB0c1xuICBAUG9zdCgnbWVzc2FnZXMvOm1lc3NhZ2VJZC9yZWFkJylcblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cbiAgICBzdW1tYXJ5OiAnQ3JlYXRlIG1hcmsgbWVzc2FnZSBhcyByZWFkJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIG1hcmsgbWVzc2FnZSBhcyByZWFkJyBcblxuICB9KVxuXG4gIEBBcGlSZXNwb25zZSh7IFxuXG4gICAgc3RhdHVzOiAyMDEsIFxuXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGVkIHN1Y2Nlc3NmdWxseScgXG5cbiAgfSlcblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cbiAgXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBhc3luYyBtYXJrTWVzc2FnZUFzUmVhZChcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBQYXJhbSgnbWVzc2FnZUlkJykgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2luZ1NlcnZpY2UubWFya01lc3NhZ2VBc1JlYWQodXNlcklkLCBtZXNzYWdlSWQpO1xuICB9XG5cbiAgLy8gTWVzc2FnZSByZWFjdGlvbnNcbiAgQFBvc3QoJ21lc3NhZ2VzLzptZXNzYWdlSWQvcmVhY3Rpb25zJylcblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cbiAgICBzdW1tYXJ5OiAnQ3JlYXRlIGFkZCBtZXNzYWdlIHJlYWN0aW9uJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIGFkZCBtZXNzYWdlIHJlYWN0aW9uJyBcblxuICB9KVxuXG4gIEBBcGlSZXNwb25zZSh7IFxuXG4gICAgc3RhdHVzOiAyMDEsIFxuXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGVkIHN1Y2Nlc3NmdWxseScgXG5cbiAgfSlcblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cbiAgXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLkNSRUFURUQpXG4gIGFzeW5jIGFkZE1lc3NhZ2VSZWFjdGlvbihcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBQYXJhbSgnbWVzc2FnZUlkJykgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICAgQEJvZHkoKSBhZGRSZWFjdGlvbkR0bzogQWRkUmVhY3Rpb25EdG8sXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2luZ1NlcnZpY2UuYWRkTWVzc2FnZVJlYWN0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgbWVzc2FnZUlkLFxuICAgICAgYWRkUmVhY3Rpb25EdG8uZW1vamksXG4gICAgKTtcbiAgfVxuXG4gIEBEZWxldGUoJ21lc3NhZ2VzLzptZXNzYWdlSWQvcmVhY3Rpb25zLzplbW9qaScpXG5cblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cblxuICAgIHN1bW1hcnk6ICdEZWxldGUgcmVtb3ZlIG1lc3NhZ2UgcmVhY3Rpb24nLFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ0RlbGV0ZSByZW1vdmUgbWVzc2FnZSByZWFjdGlvbicgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk5PX0NPTlRFTlQpXG4gIGFzeW5jIHJlbW92ZU1lc3NhZ2VSZWFjdGlvbihcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBQYXJhbSgnbWVzc2FnZUlkJykgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICAgQFBhcmFtKCdlbW9qaScpIGVtb2ppOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2luZ1NlcnZpY2UucmVtb3ZlTWVzc2FnZVJlYWN0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgbWVzc2FnZUlkLFxuICAgICAgZW1vamksXG4gICAgKTtcbiAgfVxuXG4gIC8vIFVzZXIgYmxvY2tpbmdcbiAgQFBvc3QoJ2Jsb2NrJylcblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cbiAgICBzdW1tYXJ5OiAnQ3JlYXRlIGJsb2NrIHVzZXInLFxuXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGUgYmxvY2sgdXNlcicgXG5cbiAgfSlcblxuICBAQXBpUmVzcG9uc2UoeyBcblxuICAgIHN0YXR1czogMjAxLCBcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlZCBzdWNjZXNzZnVsbHknIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG4gIFxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5DUkVBVEVEKVxuICBhc3luYyBibG9ja1VzZXIoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQm9keSgpIGJsb2NrVXNlckR0bzogQmxvY2tVc2VyRHRvLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdpbmdTZXJ2aWNlLmJsb2NrVXNlcihcbiAgICAgIHVzZXJJZCxcbiAgICAgIGJsb2NrVXNlckR0by51c2VySWQsXG4gICAgICBibG9ja1VzZXJEdG8ucmVhc29uLFxuICAgICk7XG4gIH1cblxuICBARGVsZXRlKCdibG9jay86YmxvY2tlZFVzZXJJZCcpXG5cblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cblxuICAgIHN1bW1hcnk6ICdEZWxldGUgdW5ibG9jayB1c2VyJyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGUgdW5ibG9jayB1c2VyJyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBcblxuXG4gICAgc3RhdHVzOiAyMDAsIFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ0RlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cblxuICBcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuTk9fQ09OVEVOVClcbiAgYXN5bmMgdW5ibG9ja1VzZXIoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAUGFyYW0oJ2Jsb2NrZWRVc2VySWQnKSBibG9ja2VkVXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2luZ1NlcnZpY2UudW5ibG9ja1VzZXIodXNlcklkLCBibG9ja2VkVXNlcklkKTtcbiAgfVxuXG4gIC8vIFNlYXJjaCBtZXNzYWdlc1xuICBAR2V0KCdzZWFyY2gnKVxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuICAgIHN1bW1hcnk6ICdSZXRyaWV2ZSBzZWFyY2ggbWVzc2FnZXMnLFxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZSBzZWFyY2ggbWVzc2FnZXMnIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cbiAgICBzdGF0dXM6IDIwMCwgXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG4gIFxuICBhc3luYyBzZWFyY2hNZXNzYWdlcyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBRdWVyeSgpIHNlYXJjaER0bzogU2VhcmNoTWVzc2FnZXNEdG8sXG4gICkge1xuICAgIGNvbnN0IHsgcXVlcnksIGNvbnZlcnNhdGlvbklkLCBwYWdlLCBsaW1pdCB9ID0gc2VhcmNoRHRvO1xuICAgIGNvbnN0IHBhZ2VOdW0gPSBwYWdlID8gTnVtYmVyKHBhZ2UpIDogMTtcbiAgICBjb25zdCBsaW1pdE51bSA9IGxpbWl0ID8gTnVtYmVyKGxpbWl0KSA6IDIwO1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2luZ1NlcnZpY2Uuc2VhcmNoTWVzc2FnZXMoXG4gICAgICB1c2VySWQsXG4gICAgICBxdWVyeSxcbiAgICAgIGNvbnZlcnNhdGlvbklkLFxuICAgICAgcGFnZU51bSxcbiAgICAgIGxpbWl0TnVtLFxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==