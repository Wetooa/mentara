{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/messaging/messaging.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Param,\n  Query,\n  Body,\n  UseGuards,\n  UseInterceptors,\n  UploadedFiles,\n  HttpCode,\n  HttpStatus,\n  HttpException,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { MessagingService } from './messaging.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBody,\n  ApiBearerAuth,\n  ApiParam,\n  ApiQuery,\n} from '@nestjs/swagger';\nimport {\n  SupabaseStorageService,\n  FileUploadResult,\n} from '../common/services/supabase-storage.service';\nimport {\n  CreateConversationDto,\n  SendMessageDto,\n  UpdateMessageDto,\n  AddReactionDto,\n  BlockUserDto,\n  SearchMessagesDto,\n  ConversationListParams,\n} from 'mentara-commons';\n\n@ApiTags('messaging')\n@ApiBearerAuth('JWT-auth')\n@Controller('messaging')\n@UseGuards(JwtAuthGuard)\nexport class MessagingController {\n  constructor(\n    private readonly messagingService: MessagingService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  // Conversation endpoints\n  @Post('conversations')\n  @ApiOperation({\n    summary: 'Create create conversation',\n\n    description: 'Create create conversation',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.CREATED)\n  async createConversation(\n    @CurrentUserId() userId: string,\n    @Body() createConversationDto: CreateConversationDto,\n  ) {\n    return this.messagingService.createConversation(\n      userId,\n      createConversationDto,\n    );\n  }\n\n  @Get('conversations')\n  @ApiOperation({\n    summary: 'Retrieve get user conversations',\n\n    description: 'Retrieve get user conversations',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async getUserConversations(\n    @CurrentUserId() userId: string,\n    @Query() params: ConversationListParams,\n  ) {\n    return this.messagingService.getUserConversations(\n      userId,\n      params.page || 1,\n      params.limit || 20,\n    );\n  }\n\n  @Get('conversations/:conversationId/messages')\n  @ApiOperation({\n    summary: 'Retrieve get conversation messages',\n\n    description: 'Retrieve get conversation messages',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async getConversationMessages(\n    @CurrentUserId() userId: string,\n    @Param('conversationId') conversationId: string,\n    @Query() params: ConversationListParams,\n  ) {\n    const pageNum = params.page || 1;\n    const limitNum = params.limit || 50;\n    return this.messagingService.getConversationMessages(\n      userId,\n      conversationId,\n      pageNum,\n      limitNum,\n    );\n  }\n\n  // Message endpoints\n  @Post('conversations/:conversationId/messages')\n  @ApiOperation({\n    summary: 'Create send message',\n\n    description: 'Create send message',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @UseInterceptors(FilesInterceptor('files', 3)) // Support up to 3 files\n  @HttpCode(HttpStatus.CREATED)\n  async sendMessage(\n    @CurrentUserId() userId: string,\n    @Param('conversationId') conversationId: string,\n    @Body() sendMessageDto: SendMessageDto,\n    @UploadedFiles() files: Express.Multer.File[] = [], // Optional files\n  ) {\n    // Validate and upload files if provided\n    const fileResults: FileUploadResult[] = [];\n    if (files && files.length > 0) {\n      for (const file of files) {\n        const validation = this.supabaseStorageService.validateFile(file);\n        if (!validation.isValid) {\n          throw new HttpException(\n            `File validation failed: ${validation.error}`,\n            HttpStatus.BAD_REQUEST,\n          );\n        }\n      }\n\n      // Upload files to Supabase\n      const uploadResults = await this.supabaseStorageService.uploadFiles(\n        files,\n        SupabaseStorageService.getSupportedBuckets().MESSAGES,\n      );\n      fileResults.push(...uploadResults);\n    }\n\n    return this.messagingService.sendMessage(\n      userId,\n      conversationId,\n      sendMessageDto,\n      fileResults.map((f) => f.url),\n      fileResults.map((f) => f.filename),\n      files.map((f) => f.size),\n    );\n  }\n\n  @Put('messages/:messageId')\n  @ApiOperation({\n    summary: 'Update update message',\n\n    description: 'Update update message',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Updated successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async updateMessage(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Body() updateMessageDto: UpdateMessageDto,\n  ) {\n    return this.messagingService.updateMessage(\n      userId,\n      messageId,\n      updateMessageDto,\n    );\n  }\n\n  @Delete('messages/:messageId')\n  @ApiOperation({\n    summary: 'Delete delete message',\n\n    description: 'Delete delete message',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Deleted successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async deleteMessage(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n  ) {\n    return this.messagingService.deleteMessage(userId, messageId);\n  }\n\n  // Read receipts\n  @Post('messages/:messageId/read')\n  @ApiOperation({\n    summary: 'Create mark message as read',\n\n    description: 'Create mark message as read',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.OK)\n  async markMessageAsRead(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n  ) {\n    return this.messagingService.markMessageAsRead(userId, messageId);\n  }\n\n  // Message reactions\n  @Post('messages/:messageId/reactions')\n  @ApiOperation({\n    summary: 'Create add message reaction',\n\n    description: 'Create add message reaction',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.CREATED)\n  async addMessageReaction(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Body() addReactionDto: AddReactionDto,\n  ) {\n    return this.messagingService.addMessageReaction(\n      userId,\n      messageId,\n      addReactionDto.emoji,\n    );\n  }\n\n  @Delete('messages/:messageId/reactions/:emoji')\n  @ApiOperation({\n    summary: 'Delete remove message reaction',\n\n    description: 'Delete remove message reaction',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Deleted successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async removeMessageReaction(\n    @CurrentUserId() userId: string,\n    @Param('messageId') messageId: string,\n    @Param('emoji') emoji: string,\n  ) {\n    return this.messagingService.removeMessageReaction(\n      userId,\n      messageId,\n      emoji,\n    );\n  }\n\n  // User blocking\n  @Post('block')\n  @ApiOperation({\n    summary: 'Create block user',\n\n    description: 'Create block user',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.CREATED)\n  async blockUser(\n    @CurrentUserId() userId: string,\n    @Body() blockUserDto: BlockUserDto,\n  ) {\n    return this.messagingService.blockUser(\n      userId,\n      blockUserDto.userId,\n      blockUserDto.reason,\n    );\n  }\n\n  @Delete('block/:blockedUserId')\n  @ApiOperation({\n    summary: 'Delete unblock user',\n\n    description: 'Delete unblock user',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Deleted successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async unblockUser(\n    @CurrentUserId() userId: string,\n    @Param('blockedUserId') blockedUserId: string,\n  ) {\n    return this.messagingService.unblockUser(userId, blockedUserId);\n  }\n\n  // Search messages\n  @Get('search')\n  @ApiOperation({\n    summary: 'Retrieve search messages',\n\n    description: 'Retrieve search messages',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async searchMessages(\n    @CurrentUserId() userId: string,\n    @Query() searchDto: SearchMessagesDto,\n  ) {\n    const { query, conversationId, page, limit } = searchDto;\n    const pageNum = page ? Number(page) : 1;\n    const limitNum = limit ? Number(limit) : 20;\n    return this.messagingService.searchMessages(\n      userId,\n      query,\n      conversationId,\n      pageNum,\n      limitNum,\n    );\n  }\n}\n"],"version":3}