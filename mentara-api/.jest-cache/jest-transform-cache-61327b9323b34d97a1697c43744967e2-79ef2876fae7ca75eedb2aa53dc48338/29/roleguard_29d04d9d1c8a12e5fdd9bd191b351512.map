{"version":3,"names":["cov_varkgy9jv","actualCoverage","common_1","s","require","core_1","roles_decorator_1","RoleGuard","reflector","constructor","f","canActivate","context","requiredRoles","getAllAndOverride","ROLES_KEY","getHandler","getClass","b","user","switchToHttp","getRequest","ForbiddenException","hasRole","some","role","join","exports","__decorate","Injectable","Reflector","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/guards/role.guard.ts"],"sourcesContent":["import {\n  Injectable,\n  CanActivate,\n  ExecutionContext,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { ROLES_KEY } from '../decorators/roles.decorator';\n\n@Injectable()\nexport class RoleGuard implements CanActivate {\n  constructor(private reflector: Reflector) {}\n\n  canActivate(context: ExecutionContext): boolean {\n    const requiredRoles = this.reflector.getAllAndOverride<string[]>(ROLES_KEY, [\n      context.getHandler(),\n      context.getClass(),\n    ]);\n    \n    if (!requiredRoles) {\n      return true;\n    }\n\n    const { user } = context.switchToHttp().getRequest();\n    \n    if (!user) {\n      throw new ForbiddenException('User not authenticated');\n    }\n\n    const hasRole = requiredRoles.some((role) => user.role === role);\n    \n    if (!hasRole) {\n      throw new ForbiddenException(\n        `Access denied. Required roles: ${requiredRoles.join(', ')}. User role: ${user.role}`\n      );\n    }\n\n    return true;\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAOA;IAAAA,aAAA,YAAAA,CAAA;MAAA,OA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","ignoreList":[]}