41cbcd6431d7c99213c40966870a60ff
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const communities_controller_1 = require("./communities.controller");
const communities_service_1 = require("./communities.service");
const community_assignment_service_1 = require("./community-assignment.service");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const auth_testing_helpers_1 = require("../test-utils/auth-testing-helpers");
const test_utils_1 = require("../test-utils");
describe('CommunitiesController', () => {
    let controller;
    let communitiesService;
    let communityAssignmentService;
    let prismaService;
    let mockJwtAuthGuard;
    // Mock data
    const mockCommunity = {
        id: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
        name: 'Anxiety Support',
        description: 'A supportive community for anxiety management',
        slug: 'anxiety-support',
        imageUrl: 'https://example.com/anxiety-support.jpg',
        isPrivate: false,
        memberCount: 150,
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockCommunities = [mockCommunity];
    const mockCommunityWithMembers = {
        ...mockCommunity,
        members: [
            {
                id: auth_testing_helpers_1.TEST_USER_IDS.CLIENT,
                firstName: 'John',
                lastName: 'Doe',
                role: 'member',
                joinedAt: new Date(),
            },
            {
                id: auth_testing_helpers_1.TEST_USER_IDS.THERAPIST,
                firstName: 'Dr. Jane',
                lastName: 'Smith',
                role: 'moderator',
                joinedAt: new Date(),
            },
        ],
    };
    const mockCommunityWithRoomGroups = {
        ...mockCommunity,
        roomGroups: [
            {
                id: 'room-group-1',
                name: 'General',
                order: 1,
                communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT,
                rooms: [
                    {
                        id: 'room-1',
                        name: 'General Chat',
                        order: 1,
                        postingRole: 'member',
                        roomGroupId: 'room-group-1',
                    },
                    {
                        id: 'room-2',
                        name: 'Resources',
                        order: 2,
                        postingRole: 'moderator',
                        roomGroupId: 'room-group-1',
                    },
                ],
            },
        ],
    };
    const mockCommunityStats = {
        memberCount: 150,
        postCount: 500,
        activeMembers: 75,
        totalMembers: 1000,
        totalPosts: 5000,
        activeCommunities: 10,
        illnessCommunities: [
            { name: 'Anxiety Support', memberCount: 150 },
            { name: 'Depression Help', memberCount: 120 },
        ],
    };
    const mockCreateCommunityDto = {
        name: 'New Community',
        description: 'A new community for testing',
        slug: 'new-community',
        imageUrl: 'https://example.com/new-community.jpg',
        isPrivate: false,
    };
    const mockUpdateCommunityDto = {
        name: 'Updated Community',
        description: 'An updated community description',
    };
    beforeEach(async () => {
        // Create mock services
        const mockCommunitiesService = {
            findAll: jest.fn(),
            getStats: jest.fn(),
            findBySlug: jest.fn(),
            findOne: jest.fn(),
            getMembers: jest.fn(),
            createCommunity: jest.fn(),
            update: jest.fn(),
            remove: jest.fn(),
            joinCommunity: jest.fn(),
            leaveCommunity: jest.fn(),
            findByUserId: jest.fn(),
            findAllWithStructure: jest.fn(),
            findOneWithStructure: jest.fn(),
            createRoomGroup: jest.fn(),
            createRoom: jest.fn(),
            findRoomsByGroup: jest.fn(),
        };
        const mockCommunityAssignmentService = {
            assignCommunitiesToUser: jest.fn(),
            getRecommendedCommunities: jest.fn(),
            bulkAssignCommunities: jest.fn(),
        };
        mockJwtAuthGuard = {
            canActivate: jest.fn().mockReturnValue(true),
        };
        const module = await testing_1.Test.createTestingModule({
            controllers: [communities_controller_1.CommunitiesController],
            providers: [
                {
                    provide: communities_service_1.CommunitiesService,
                    useValue: mockCommunitiesService,
                },
                {
                    provide: community_assignment_service_1.CommunityAssignmentService,
                    useValue: mockCommunityAssignmentService,
                },
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: (0, test_utils_1.createMockPrismaService)(),
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .compile();
        controller = module.get(communities_controller_1.CommunitiesController);
        communitiesService = module.get(communities_service_1.CommunitiesService);
        communityAssignmentService = module.get(community_assignment_service_1.CommunityAssignmentService);
        prismaService = module.get(prisma_client_provider_1.PrismaService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('findAll', () => {
        it('should return all communities', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findAll').mockResolvedValue(mockCommunities);
            // Act
            const result = await controller.findAll();
            // Assert
            expect(communitiesService.findAll).toHaveBeenCalled();
            expect(result).toEqual(mockCommunities);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(communitiesService, 'findAll').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.findAll()).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('getStats', () => {
        it('should return community statistics', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'getStats').mockResolvedValue(mockCommunityStats);
            // Act
            const result = await controller.getStats();
            // Assert
            expect(communitiesService.getStats).toHaveBeenCalled();
            expect(result).toEqual(mockCommunityStats);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(communitiesService, 'getStats').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.getStats()).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('findBySlug', () => {
        it('should return community by slug', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findBySlug').mockResolvedValue(mockCommunity);
            // Act
            const result = await controller.findBySlug('anxiety-support');
            // Assert
            expect(communitiesService.findBySlug).toHaveBeenCalledWith('anxiety-support');
            expect(result).toEqual(mockCommunity);
        });
        it('should throw NotFoundException when community not found', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findBySlug').mockResolvedValue(null);
            // Act & Assert
            await expect(controller.findBySlug('non-existent')).rejects.toThrow(common_1.InternalServerErrorException);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(communitiesService, 'findBySlug').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.findBySlug('anxiety-support')).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('findOne', () => {
        it('should return community by ID', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findOne').mockResolvedValue(mockCommunity);
            // Act
            const result = await controller.findOne(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(communitiesService.findOne).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            expect(result).toEqual(mockCommunity);
        });
        it('should throw NotFoundException when community not found', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findOne').mockResolvedValue(null);
            // Act & Assert
            await expect(controller.findOne('non-existent')).rejects.toThrow(common_1.InternalServerErrorException);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(communitiesService, 'findOne').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.findOne(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('getMembers', () => {
        it('should return community members with default pagination', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'getMembers').mockResolvedValue(mockCommunityWithMembers);
            // Act
            const result = await controller.getMembers(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(communitiesService.getMembers).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, 50, 0);
            expect(result).toEqual(mockCommunityWithMembers);
        });
        it('should return community members with custom pagination', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'getMembers').mockResolvedValue(mockCommunityWithMembers);
            // Act
            const result = await controller.getMembers(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, '20', '10');
            // Assert
            expect(communitiesService.getMembers).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, 20, 10);
            expect(result).toEqual(mockCommunityWithMembers);
        });
        it('should handle invalid pagination parameters', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'getMembers').mockResolvedValue(mockCommunityWithMembers);
            // Act & Assert
            await expect(controller.getMembers(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, 'invalid', 'invalid')).rejects.toThrow(common_1.InternalServerErrorException);
        });
        it('should clamp pagination values within bounds', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'getMembers').mockResolvedValue(mockCommunityWithMembers);
            // Act
            await controller.getMembers(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, '200', '-10');
            // Assert
            expect(communitiesService.getMembers).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, 100, 0);
        });
    });
    describe('create', () => {
        it('should create community successfully', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'createCommunity').mockResolvedValue(mockCommunity);
            // Act
            const result = await controller.create(mockCreateCommunityDto);
            // Assert
            expect(communitiesService.createCommunity).toHaveBeenCalledWith(mockCreateCommunityDto);
            expect(result).toEqual(mockCommunity);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Community creation failed');
            jest.spyOn(communitiesService, 'createCommunity').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.create(mockCreateCommunityDto)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('update', () => {
        it('should update community successfully', async () => {
            // Arrange
            const updatedCommunity = { ...mockCommunity, ...mockUpdateCommunityDto };
            jest.spyOn(communitiesService, 'update').mockResolvedValue(updatedCommunity);
            // Act
            const result = await controller.update(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, mockUpdateCommunityDto);
            // Assert
            expect(communitiesService.update).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, mockUpdateCommunityDto);
            expect(result).toEqual(updatedCommunity);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Community update failed');
            jest.spyOn(communitiesService, 'update').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.update(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, mockUpdateCommunityDto)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('remove', () => {
        it('should remove community successfully', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'remove').mockResolvedValue(mockCommunity);
            // Act
            const result = await controller.remove(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(communitiesService.remove).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            expect(result).toEqual(mockCommunity);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Community removal failed');
            jest.spyOn(communitiesService, 'remove').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.remove(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('joinCommunity', () => {
        it('should join community successfully', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'joinCommunity').mockResolvedValue(undefined);
            // Act
            const result = await controller.joinCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            // Assert
            expect(communitiesService.joinCommunity).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual({ joined: true });
        });
        it('should handle known exceptions properly', async () => {
            // Arrange
            const conflictError = new common_1.ConflictException('User already member');
            jest.spyOn(communitiesService, 'joinCommunity').mockRejectedValue(conflictError);
            // Act & Assert
            await expect(controller.joinCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.ConflictException);
        });
        it('should wrap unknown errors in InternalServerErrorException', async () => {
            // Arrange
            const unknownError = new Error('Unknown error');
            jest.spyOn(communitiesService, 'joinCommunity').mockRejectedValue(unknownError);
            // Act & Assert
            await expect(controller.joinCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('leaveCommunity', () => {
        it('should leave community successfully', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'leaveCommunity').mockResolvedValue(undefined);
            // Act
            const result = await controller.leaveCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            // Assert
            expect(communitiesService.leaveCommunity).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual({ left: true });
        });
        it('should handle known exceptions properly', async () => {
            // Arrange
            const notFoundError = new common_1.NotFoundException('User not a member');
            jest.spyOn(communitiesService, 'leaveCommunity').mockRejectedValue(notFoundError);
            // Act & Assert
            await expect(controller.leaveCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.NotFoundException);
        });
        it('should wrap unknown errors in InternalServerErrorException', async () => {
            // Arrange
            const unknownError = new Error('Unknown error');
            jest.spyOn(communitiesService, 'leaveCommunity').mockRejectedValue(unknownError);
            // Act & Assert
            await expect(controller.leaveCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('findByUserId', () => {
        it('should return communities for user', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findByUserId').mockResolvedValue(mockCommunities);
            // Act
            const result = await controller.findByUserId(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            // Assert
            expect(communitiesService.findByUserId).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockCommunities);
        });
        it('should handle service errors', async () => {
            // Arrange
            const error = new Error('Database error');
            jest.spyOn(communitiesService, 'findByUserId').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.findByUserId(auth_testing_helpers_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('getAllWithStructure', () => {
        it('should return all communities with structure', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findAllWithStructure').mockResolvedValue([mockCommunityWithRoomGroups]);
            // Act
            const result = await controller.getAllWithStructure();
            // Assert
            expect(communitiesService.findAllWithStructure).toHaveBeenCalled();
            expect(result).toEqual([mockCommunityWithRoomGroups]);
        });
    });
    describe('getOneWithStructure', () => {
        it('should return community with structure', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findOneWithStructure').mockResolvedValue(mockCommunityWithRoomGroups);
            // Act
            const result = await controller.getOneWithStructure(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(communitiesService.findOneWithStructure).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            expect(result).toEqual(mockCommunityWithRoomGroups);
        });
    });
    describe('createRoomGroup', () => {
        const roomGroupDto = { name: 'New Room Group', order: 1 };
        const mockRoomGroup = { id: 'room-group-2', ...roomGroupDto, communityId: auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT };
        it('should create room group successfully', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'createRoomGroup').mockResolvedValue(mockRoomGroup);
            // Act
            const result = await controller.createRoomGroup(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, roomGroupDto);
            // Assert
            expect(communitiesService.createRoomGroup).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, roomGroupDto.name, roomGroupDto.order);
            expect(result).toEqual(mockRoomGroup);
        });
    });
    describe('createRoom', () => {
        const roomDto = { name: 'New Room', order: 1 };
        const mockRoom = { id: 'room-3', ...roomDto, roomGroupId: 'room-group-1' };
        it('should create room successfully', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'createRoom').mockResolvedValue(mockRoom);
            // Act
            const result = await controller.createRoom('room-group-1', roomDto);
            // Assert
            expect(communitiesService.createRoom).toHaveBeenCalledWith('room-group-1', roomDto.name, roomDto.order);
            expect(result).toEqual(mockRoom);
        });
    });
    describe('getRoomsByGroup', () => {
        const mockRooms = [
            { id: 'room-1', name: 'Room 1', order: 1, roomGroupId: 'room-group-1' },
            { id: 'room-2', name: 'Room 2', order: 2, roomGroupId: 'room-group-1' },
        ];
        it('should return rooms by group', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findRoomsByGroup').mockResolvedValue(mockRooms);
            // Act
            const result = await controller.getRoomsByGroup('room-group-1');
            // Assert
            expect(communitiesService.findRoomsByGroup).toHaveBeenCalledWith('room-group-1');
            expect(result).toEqual(mockRooms);
        });
    });
    describe('Community Assignment Features', () => {
        describe('assignCommunitiesToMe', () => {
            it('should assign communities to current user', async () => {
                // Arrange
                const assignedCommunities = [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP];
                jest.spyOn(communityAssignmentService, 'assignCommunitiesToUser').mockResolvedValue(assignedCommunities);
                // Act
                const result = await controller.assignCommunitiesToMe(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
                // Assert
                expect(communityAssignmentService.assignCommunitiesToUser).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ assignedCommunities });
            });
            it('should handle service errors', async () => {
                // Arrange
                const error = new Error('Assignment failed');
                jest.spyOn(communityAssignmentService, 'assignCommunitiesToUser').mockRejectedValue(error);
                // Act & Assert
                await expect(controller.assignCommunitiesToMe(auth_testing_helpers_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(common_1.InternalServerErrorException);
            });
        });
        describe('assignCommunitiesToUser', () => {
            it('should assign communities to specific user', async () => {
                // Arrange
                const assignedCommunities = [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT];
                jest.spyOn(communityAssignmentService, 'assignCommunitiesToUser').mockResolvedValue(assignedCommunities);
                // Act
                const result = await controller.assignCommunitiesToUser(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
                // Assert
                expect(communityAssignmentService.assignCommunitiesToUser).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ assignedCommunities });
            });
        });
        describe('getMyRecommendedCommunities', () => {
            it('should return recommended communities for user', async () => {
                // Arrange
                const recommendedCommunities = [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP];
                jest.spyOn(communityAssignmentService, 'getRecommendedCommunities').mockResolvedValue(recommendedCommunities);
                // Act
                const result = await controller.getMyRecommendedCommunities(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
                // Assert
                expect(communityAssignmentService.getRecommendedCommunities).toHaveBeenCalledWith(auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
                expect(result).toEqual({ recommendedCommunities });
            });
        });
        describe('bulkAssignCommunities', () => {
            it('should bulk assign communities to multiple users', async () => {
                // Arrange
                const userIds = [auth_testing_helpers_1.TEST_USER_IDS.CLIENT, auth_testing_helpers_1.TEST_USER_IDS.THERAPIST];
                const bulkResults = {
                    [auth_testing_helpers_1.TEST_USER_IDS.CLIENT]: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT],
                    [auth_testing_helpers_1.TEST_USER_IDS.THERAPIST]: [auth_testing_helpers_1.TEST_COMMUNITY_IDS.DEPRESSION_HELP],
                };
                jest.spyOn(communityAssignmentService, 'bulkAssignCommunities').mockResolvedValue(bulkResults);
                // Act
                const result = await controller.bulkAssignCommunities({ userIds });
                // Assert
                expect(communityAssignmentService.bulkAssignCommunities).toHaveBeenCalledWith(userIds);
                expect(result).toEqual({ results: bulkResults });
            });
            it('should handle service errors', async () => {
                // Arrange
                const error = new Error('Bulk assignment failed');
                jest.spyOn(communityAssignmentService, 'bulkAssignCommunities').mockRejectedValue(error);
                // Act & Assert
                await expect(controller.bulkAssignCommunities({ userIds: [auth_testing_helpers_1.TEST_USER_IDS.CLIENT] })).rejects.toThrow(common_1.InternalServerErrorException);
            });
        });
    });
    describe('Security and Authorization', () => {
        it('should have proper guards applied', () => {
            // Test that JwtAuthGuard is applied at controller level
            const guards = Reflect.getMetadata('__guards__', communities_controller_1.CommunitiesController);
            expect(guards).toBeDefined();
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
        });
        it('should test role-based access for admin endpoints', async () => {
            // Test that admin/moderator endpoints have proper role decorators
            const adminMethods = ['create', 'update', 'remove', 'createRoomGroup', 'createRoom'];
            adminMethods.forEach(method => {
                const roles = Reflect.getMetadata('roles', controller[method]);
                expect(roles).toBeDefined();
                expect(roles).toContain('moderator');
            });
        });
        it('should test role-based access for user endpoints', async () => {
            // Test that user endpoints have proper role decorators
            const userMethods = ['joinCommunity', 'leaveCommunity'];
            userMethods.forEach(method => {
                const roles = Reflect.getMetadata('roles', controller[method]);
                expect(roles).toBeDefined();
                expect(roles).toContain('client');
            });
        });
    });
    describe('Error Handling', () => {
        it('should handle InternalServerErrorException properly', async () => {
            // Arrange
            const error = new common_1.InternalServerErrorException('Internal error');
            jest.spyOn(communitiesService, 'findAll').mockRejectedValue(error);
            // Act & Assert
            await expect(controller.findAll()).rejects.toThrow(common_1.InternalServerErrorException);
        });
        it('should wrap unknown errors in InternalServerErrorException', async () => {
            // Arrange
            const unknownError = new Error('Unknown error');
            jest.spyOn(communitiesService, 'findAll').mockRejectedValue(unknownError);
            // Act & Assert
            await expect(controller.findAll()).rejects.toThrow(common_1.InternalServerErrorException);
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete community creation workflow', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'createCommunity').mockResolvedValue(mockCommunity);
            // Act
            const result = await controller.create(mockCreateCommunityDto);
            // Assert
            expect(result).toBeDefined();
            expect(result.name).toBe(mockCommunity.name);
            expect(result.description).toBe(mockCommunity.description);
            expect(result.slug).toBe(mockCommunity.slug);
        });
        it('should handle complete community join workflow', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'joinCommunity').mockResolvedValue(undefined);
            // Act
            const result = await controller.joinCommunity(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT, auth_testing_helpers_1.TEST_USER_IDS.CLIENT);
            // Assert
            expect(result).toBeDefined();
            expect(result.joined).toBe(true);
        });
        it('should handle complete community structure workflow', async () => {
            // Arrange
            jest.spyOn(communitiesService, 'findOneWithStructure').mockResolvedValue(mockCommunityWithRoomGroups);
            // Act
            const result = await controller.getOneWithStructure(auth_testing_helpers_1.TEST_COMMUNITY_IDS.ANXIETY_SUPPORT);
            // Assert
            expect(result).toBeDefined();
            expect(result.roomGroups).toBeDefined();
            expect(result.roomGroups.length).toBeGreaterThan(0);
            expect(result.roomGroups[0].rooms).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbW11bml0aWVzLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCwyQ0FLd0I7QUFDeEIscUVBQWlFO0FBQ2pFLCtEQUEyRDtBQUMzRCxpRkFBNEU7QUFDNUUsZ0ZBQW9FO0FBQ3BFLGtFQUE2RDtBQUU3RCw2RUFRNEM7QUFDNUMsOENBQXdEO0FBRXhELFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDckMsSUFBSSxVQUFpQyxDQUFDO0lBQ3RDLElBQUksa0JBQXNDLENBQUM7SUFDM0MsSUFBSSwwQkFBc0QsQ0FBQztJQUMzRCxJQUFJLGFBQTRCLENBQUM7SUFDakMsSUFBSSxnQkFBMkMsQ0FBQztJQUVoRCxZQUFZO0lBQ1osTUFBTSxhQUFhLEdBQUc7UUFDcEIsRUFBRSxFQUFFLHlDQUFrQixDQUFDLGVBQWU7UUFDdEMsSUFBSSxFQUFFLGlCQUFpQjtRQUN2QixXQUFXLEVBQUUsK0NBQStDO1FBQzVELElBQUksRUFBRSxpQkFBaUI7UUFDdkIsUUFBUSxFQUFFLHlDQUF5QztRQUNuRCxTQUFTLEVBQUUsS0FBSztRQUNoQixXQUFXLEVBQUUsR0FBRztRQUNoQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7UUFDckIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO0tBQ3RCLENBQUM7SUFFRixNQUFNLGVBQWUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRXhDLE1BQU0sd0JBQXdCLEdBQUc7UUFDL0IsR0FBRyxhQUFhO1FBQ2hCLE9BQU8sRUFBRTtZQUNQO2dCQUNFLEVBQUUsRUFBRSxvQ0FBYSxDQUFDLE1BQU07Z0JBQ3hCLFNBQVMsRUFBRSxNQUFNO2dCQUNqQixRQUFRLEVBQUUsS0FBSztnQkFDZixJQUFJLEVBQUUsUUFBUTtnQkFDZCxRQUFRLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDckI7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QyxNQUFNLENBQUMsQ0FBQztZQUV4RyxTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25FLFVBQVU7WUFDVixJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixFQUFFLHNCQUFzQixDQUFDLENBQUMsaUJBQWlCLENBQUMsMkJBQTJCLENBQUMsQ0FBQztZQUV0RyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsbUJBQW1CLENBQUMseUNBQWtCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFeEYsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3QixNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRCxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbW11bml0aWVzLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7XG4gIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBDb25mbGljdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQ29tbXVuaXRpZXNDb250cm9sbGVyIH0gZnJvbSAnLi9jb21tdW5pdGllcy5jb250cm9sbGVyJztcbmltcG9ydCB7IENvbW11bml0aWVzU2VydmljZSB9IGZyb20gJy4vY29tbXVuaXRpZXMuc2VydmljZSc7XG5pbXBvcnQgeyBDb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSB9IGZyb20gJy4vY29tbXVuaXR5LWFzc2lnbm1lbnQuc2VydmljZSc7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnLi4vYXV0aC9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgUm9sZXMgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvcm9sZXMuZGVjb3JhdG9yJztcbmltcG9ydCB7XG4gIE1vY2tCdWlsZGVyLFxuICBUZXN0RGF0YUdlbmVyYXRvcixcbiAgVGVzdEFzc2VydGlvbnMsXG4gIFNlY3VyaXR5R3VhcmRUZXN0VXRpbHMsXG4gIFJvbGVCYXNlZFRlc3RVdGlscyxcbiAgVEVTVF9VU0VSX0lEUyxcbiAgVEVTVF9DT01NVU5JVFlfSURTLFxufSBmcm9tICcuLi90ZXN0LXV0aWxzL2F1dGgtdGVzdGluZy1oZWxwZXJzJztcbmltcG9ydCB7IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vdGVzdC11dGlscyc7XG5cbmRlc2NyaWJlKCdDb21tdW5pdGllc0NvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBDb21tdW5pdGllc0NvbnRyb2xsZXI7XG4gIGxldCBjb21tdW5pdGllc1NlcnZpY2U6IENvbW11bml0aWVzU2VydmljZTtcbiAgbGV0IGNvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlOiBDb21tdW5pdHlBc3NpZ25tZW50U2VydmljZTtcbiAgbGV0IHByaXNtYVNlcnZpY2U6IFByaXNtYVNlcnZpY2U7XG4gIGxldCBtb2NrSnd0QXV0aEd1YXJkOiBqZXN0Lk1vY2tlZDxKd3RBdXRoR3VhcmQ+O1xuXG4gIC8vIE1vY2sgZGF0YVxuICBjb25zdCBtb2NrQ29tbXVuaXR5ID0ge1xuICAgIGlkOiBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgIG5hbWU6ICdBbnhpZXR5IFN1cHBvcnQnLFxuICAgIGRlc2NyaXB0aW9uOiAnQSBzdXBwb3J0aXZlIGNvbW11bml0eSBmb3IgYW54aWV0eSBtYW5hZ2VtZW50JyxcbiAgICBzbHVnOiAnYW54aWV0eS1zdXBwb3J0JyxcbiAgICBpbWFnZVVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vYW54aWV0eS1zdXBwb3J0LmpwZycsXG4gICAgaXNQcml2YXRlOiBmYWxzZSxcbiAgICBtZW1iZXJDb3VudDogMTUwLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja0NvbW11bml0aWVzID0gW21vY2tDb21tdW5pdHldO1xuXG4gIGNvbnN0IG1vY2tDb21tdW5pdHlXaXRoTWVtYmVycyA9IHtcbiAgICAuLi5tb2NrQ29tbXVuaXR5LFxuICAgIG1lbWJlcnM6IFtcbiAgICAgIHtcbiAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgbGFzdE5hbWU6ICdEb2UnLFxuICAgICAgICByb2xlOiAnbWVtYmVyJyxcbiAgICAgICAgam9pbmVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgIGZpcnN0TmFtZTogJ0RyLiBKYW5lJyxcbiAgICAgICAgbGFzdE5hbWU6ICdTbWl0aCcsXG4gICAgICAgIHJvbGU6ICdtb2RlcmF0b3InLFxuICAgICAgICBqb2luZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ29tbXVuaXR5V2l0aFJvb21Hcm91cHMgPSB7XG4gICAgLi4ubW9ja0NvbW11bml0eSxcbiAgICByb29tR3JvdXBzOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiAncm9vbS1ncm91cC0xJyxcbiAgICAgICAgbmFtZTogJ0dlbmVyYWwnLFxuICAgICAgICBvcmRlcjogMSxcbiAgICAgICAgY29tbXVuaXR5SWQ6IFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsXG4gICAgICAgIHJvb21zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdyb29tLTEnLFxuICAgICAgICAgICAgbmFtZTogJ0dlbmVyYWwgQ2hhdCcsXG4gICAgICAgICAgICBvcmRlcjogMSxcbiAgICAgICAgICAgIHBvc3RpbmdSb2xlOiAnbWVtYmVyJyxcbiAgICAgICAgICAgIHJvb21Hcm91cElkOiAncm9vbS1ncm91cC0xJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAncm9vbS0yJyxcbiAgICAgICAgICAgIG5hbWU6ICdSZXNvdXJjZXMnLFxuICAgICAgICAgICAgb3JkZXI6IDIsXG4gICAgICAgICAgICBwb3N0aW5nUm9sZTogJ21vZGVyYXRvcicsXG4gICAgICAgICAgICByb29tR3JvdXBJZDogJ3Jvb20tZ3JvdXAtMScsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ29tbXVuaXR5U3RhdHMgPSB7XG4gICAgbWVtYmVyQ291bnQ6IDE1MCxcbiAgICBwb3N0Q291bnQ6IDUwMCxcbiAgICBhY3RpdmVNZW1iZXJzOiA3NSxcbiAgICB0b3RhbE1lbWJlcnM6IDEwMDAsXG4gICAgdG90YWxQb3N0czogNTAwMCxcbiAgICBhY3RpdmVDb21tdW5pdGllczogMTAsXG4gICAgaWxsbmVzc0NvbW11bml0aWVzOiBbXG4gICAgICB7IG5hbWU6ICdBbnhpZXR5IFN1cHBvcnQnLCBtZW1iZXJDb3VudDogMTUwIH0sXG4gICAgICB7IG5hbWU6ICdEZXByZXNzaW9uIEhlbHAnLCBtZW1iZXJDb3VudDogMTIwIH0sXG4gICAgXSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ3JlYXRlQ29tbXVuaXR5RHRvID0ge1xuICAgIG5hbWU6ICdOZXcgQ29tbXVuaXR5JyxcbiAgICBkZXNjcmlwdGlvbjogJ0EgbmV3IGNvbW11bml0eSBmb3IgdGVzdGluZycsXG4gICAgc2x1ZzogJ25ldy1jb21tdW5pdHknLFxuICAgIGltYWdlVXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9uZXctY29tbXVuaXR5LmpwZycsXG4gICAgaXNQcml2YXRlOiBmYWxzZSxcbiAgfTtcblxuICBjb25zdCBtb2NrVXBkYXRlQ29tbXVuaXR5RHRvID0ge1xuICAgIG5hbWU6ICdVcGRhdGVkIENvbW11bml0eScsXG4gICAgZGVzY3JpcHRpb246ICdBbiB1cGRhdGVkIGNvbW11bml0eSBkZXNjcmlwdGlvbicsXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIG1vY2sgc2VydmljZXNcbiAgICBjb25zdCBtb2NrQ29tbXVuaXRpZXNTZXJ2aWNlID0ge1xuICAgICAgZmluZEFsbDogamVzdC5mbigpLFxuICAgICAgZ2V0U3RhdHM6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeVNsdWc6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICAgIGdldE1lbWJlcnM6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZUNvbW11bml0eTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICByZW1vdmU6IGplc3QuZm4oKSxcbiAgICAgIGpvaW5Db21tdW5pdHk6IGplc3QuZm4oKSxcbiAgICAgIGxlYXZlQ29tbXVuaXR5OiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlVc2VySWQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRBbGxXaXRoU3RydWN0dXJlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kT25lV2l0aFN0cnVjdHVyZTogamVzdC5mbigpLFxuICAgICAgY3JlYXRlUm9vbUdyb3VwOiBqZXN0LmZuKCksXG4gICAgICBjcmVhdGVSb29tOiBqZXN0LmZuKCksXG4gICAgICBmaW5kUm9vbXNCeUdyb3VwOiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIGNvbnN0IG1vY2tDb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSA9IHtcbiAgICAgIGFzc2lnbkNvbW11bml0aWVzVG9Vc2VyOiBqZXN0LmZuKCksXG4gICAgICBnZXRSZWNvbW1lbmRlZENvbW11bml0aWVzOiBqZXN0LmZuKCksXG4gICAgICBidWxrQXNzaWduQ29tbXVuaXRpZXM6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgbW9ja0p3dEF1dGhHdWFyZCA9IHtcbiAgICAgIGNhbkFjdGl2YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICAgIH0gYXMgYW55O1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGNvbnRyb2xsZXJzOiBbQ29tbXVuaXRpZXNDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ29tbXVuaXRpZXNTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29tbXVuaXRpZXNTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tDb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFByaXNtYVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IGNyZWF0ZU1vY2tQcmlzbWFTZXJ2aWNlKCksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gICAgICAub3ZlcnJpZGVHdWFyZChKd3RBdXRoR3VhcmQpXG4gICAgICAudXNlVmFsdWUobW9ja0p3dEF1dGhHdWFyZClcbiAgICAgIC5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxDb21tdW5pdGllc0NvbnRyb2xsZXI+KENvbW11bml0aWVzQ29udHJvbGxlcik7XG4gICAgY29tbXVuaXRpZXNTZXJ2aWNlID0gbW9kdWxlLmdldDxDb21tdW5pdGllc1NlcnZpY2U+KENvbW11bml0aWVzU2VydmljZSk7XG4gICAgY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlPihDb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSk7XG4gICAgcHJpc21hU2VydmljZSA9IG1vZHVsZS5nZXQ8UHJpc21hU2VydmljZT4oUHJpc21hU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kQWxsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFsbCBjb21tdW5pdGllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZmluZEFsbCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdGllcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5maW5kQWxsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tdW5pdGllcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpO1xuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdmaW5kQWxsJykubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRBbGwoKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tbXVuaXR5IHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2dldFN0YXRzJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbW11bml0eVN0YXRzKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFN0YXRzKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5nZXRTdGF0cykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ29tbXVuaXR5U3RhdHMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKTtcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZ2V0U3RhdHMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0U3RhdHMoKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEJ5U2x1ZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tdW5pdHkgYnkgc2x1ZycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZmluZEJ5U2x1ZycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdHkpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZEJ5U2x1ZygnYW54aWV0eS1zdXBwb3J0Jyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5maW5kQnlTbHVnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnYW54aWV0eS1zdXBwb3J0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tdW5pdHkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiB3aGVuIGNvbW11bml0eSBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2ZpbmRCeVNsdWcnKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kQnlTbHVnKCdub24tZXhpc3RlbnQnKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKTtcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZmluZEJ5U2x1ZycpLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kQnlTbHVnKCdhbnhpZXR5LXN1cHBvcnQnKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZE9uZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tdW5pdHkgYnkgSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2ZpbmRPbmUnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXR5KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NvbW11bml0eSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gY29tbXVuaXR5IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZmluZE9uZScpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRPbmUoJ25vbi1leGlzdGVudCcpKS5yZWplY3RzLnRvVGhyb3coSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpO1xuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdmaW5kT25lJykubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRPbmUoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCkpLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldE1lbWJlcnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tbXVuaXR5IG1lbWJlcnMgd2l0aCBkZWZhdWx0IHBhZ2luYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2dldE1lbWJlcnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXR5V2l0aE1lbWJlcnMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0TWVtYmVycyhURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JUKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoY29tbXVuaXRpZXNTZXJ2aWNlLmdldE1lbWJlcnMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIDUwLCAwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NvbW11bml0eVdpdGhNZW1iZXJzKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbW11bml0eSBtZW1iZXJzIHdpdGggY3VzdG9tIHBhZ2luYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2dldE1lbWJlcnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXR5V2l0aE1lbWJlcnMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0TWVtYmVycyhURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULCAnMjAnLCAnMTAnKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoY29tbXVuaXRpZXNTZXJ2aWNlLmdldE1lbWJlcnMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIDIwLCAxMCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tdW5pdHlXaXRoTWVtYmVycyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIHBhZ2luYXRpb24gcGFyYW1ldGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZ2V0TWVtYmVycycpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdHlXaXRoTWVtYmVycyk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0TWVtYmVycyhURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULCAnaW52YWxpZCcsICdpbnZhbGlkJykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsYW1wIHBhZ2luYXRpb24gdmFsdWVzIHdpdGhpbiBib3VuZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2dldE1lbWJlcnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXR5V2l0aE1lbWJlcnMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZ2V0TWVtYmVycyhURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULCAnMjAwJywgJy0xMCcpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2UuZ2V0TWVtYmVycykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgMTAwLCAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjb21tdW5pdHkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdjcmVhdGVDb21tdW5pdHknKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXR5KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShtb2NrQ3JlYXRlQ29tbXVuaXR5RHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoY29tbXVuaXRpZXNTZXJ2aWNlLmNyZWF0ZUNvbW11bml0eSkudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja0NyZWF0ZUNvbW11bml0eUR0byk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tdW5pdHkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignQ29tbXVuaXR5IGNyZWF0aW9uIGZhaWxlZCcpO1xuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdjcmVhdGVDb21tdW5pdHknKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuY3JlYXRlKG1vY2tDcmVhdGVDb21tdW5pdHlEdG8pKS5yZWplY3RzLnRvVGhyb3coSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgY29tbXVuaXR5IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHVwZGF0ZWRDb21tdW5pdHkgPSB7IC4uLm1vY2tDb21tdW5pdHksIC4uLm1vY2tVcGRhdGVDb21tdW5pdHlEdG8gfTtcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAndXBkYXRlJykubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZENvbW11bml0eSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGUoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgbW9ja1VwZGF0ZUNvbW11bml0eUR0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIG1vY2tVcGRhdGVDb21tdW5pdHlEdG8pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1cGRhdGVkQ29tbXVuaXR5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0NvbW11bml0eSB1cGRhdGUgZmFpbGVkJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ3VwZGF0ZScpLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci51cGRhdGUoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgbW9ja1VwZGF0ZUNvbW11bml0eUR0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZW1vdmUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgY29tbXVuaXR5IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAncmVtb3ZlJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbW11bml0eSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZW1vdmUoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5yZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ29tbXVuaXR5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0NvbW11bml0eSByZW1vdmFsIGZhaWxlZCcpO1xuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdyZW1vdmUnKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIucmVtb3ZlKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQpKS5yZWplY3RzLnRvVGhyb3coSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdqb2luQ29tbXVuaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgam9pbiBjb21tdW5pdHkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdqb2luQ29tbXVuaXR5JykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmpvaW5Db21tdW5pdHkoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2Uuam9pbkNvbW11bml0eSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGpvaW5lZDogdHJ1ZSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGtub3duIGV4Y2VwdGlvbnMgcHJvcGVybHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjb25mbGljdEVycm9yID0gbmV3IENvbmZsaWN0RXhjZXB0aW9uKCdVc2VyIGFscmVhZHkgbWVtYmVyJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2pvaW5Db21tdW5pdHknKS5tb2NrUmVqZWN0ZWRWYWx1ZShjb25mbGljdEVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5qb2luQ29tbXVuaXR5KFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBDb25mbGljdEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHdyYXAgdW5rbm93biBlcnJvcnMgaW4gSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHVua25vd25FcnJvciA9IG5ldyBFcnJvcignVW5rbm93biBlcnJvcicpO1xuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdqb2luQ29tbXVuaXR5JykubW9ja1JlamVjdGVkVmFsdWUodW5rbm93bkVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5qb2luQ29tbXVuaXR5KFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xlYXZlQ29tbXVuaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbGVhdmUgY29tbXVuaXR5IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnbGVhdmVDb21tdW5pdHknKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIubGVhdmVDb21tdW5pdHkoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2UubGVhdmVDb21tdW5pdHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBsZWZ0OiB0cnVlIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUga25vd24gZXhjZXB0aW9ucyBwcm9wZXJseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5vdEZvdW5kRXJyb3IgPSBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGEgbWVtYmVyJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2xlYXZlQ29tbXVuaXR5JykubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIubGVhdmVDb21tdW5pdHkoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd3JhcCB1bmtub3duIGVycm9ycyBpbiBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdW5rbm93bkVycm9yID0gbmV3IEVycm9yKCdVbmtub3duIGVycm9yJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2xlYXZlQ29tbXVuaXR5JykubW9ja1JlamVjdGVkVmFsdWUodW5rbm93bkVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5sZWF2ZUNvbW11bml0eShURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULCBURVNUX1VTRVJfSURTLkNMSUVOVCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kQnlVc2VySWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tbXVuaXRpZXMgZm9yIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2ZpbmRCeVVzZXJJZCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdGllcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQnlVc2VySWQoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2UuZmluZEJ5VXNlcklkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tdW5pdGllcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpO1xuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdmaW5kQnlVc2VySWQnKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZmluZEJ5VXNlcklkKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0QWxsV2l0aFN0cnVjdHVyZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgY29tbXVuaXRpZXMgd2l0aCBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2ZpbmRBbGxXaXRoU3RydWN0dXJlJykubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tDb21tdW5pdHlXaXRoUm9vbUdyb3Vwc10pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QWxsV2l0aFN0cnVjdHVyZSgpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2UuZmluZEFsbFdpdGhTdHJ1Y3R1cmUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW21vY2tDb21tdW5pdHlXaXRoUm9vbUdyb3Vwc10pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0T25lV2l0aFN0cnVjdHVyZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb21tdW5pdHkgd2l0aCBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2ZpbmRPbmVXaXRoU3RydWN0dXJlJykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbW11bml0eVdpdGhSb29tR3JvdXBzKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldE9uZVdpdGhTdHJ1Y3R1cmUoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5maW5kT25lV2l0aFN0cnVjdHVyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDb21tdW5pdHlXaXRoUm9vbUdyb3Vwcyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVSb29tR3JvdXAnLCAoKSA9PiB7XG4gICAgY29uc3Qgcm9vbUdyb3VwRHRvID0geyBuYW1lOiAnTmV3IFJvb20gR3JvdXAnLCBvcmRlcjogMSB9O1xuICAgIGNvbnN0IG1vY2tSb29tR3JvdXAgPSB7IGlkOiAncm9vbS1ncm91cC0yJywgLi4ucm9vbUdyb3VwRHRvLCBjb21tdW5pdHlJZDogVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVCB9O1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgcm9vbSBncm91cCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2NyZWF0ZVJvb21Hcm91cCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSb29tR3JvdXApO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlUm9vbUdyb3VwKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIHJvb21Hcm91cER0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNvbW11bml0aWVzU2VydmljZS5jcmVhdGVSb29tR3JvdXApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULFxuICAgICAgICByb29tR3JvdXBEdG8ubmFtZSxcbiAgICAgICAgcm9vbUdyb3VwRHRvLm9yZGVyLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jvb21Hcm91cCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVSb29tJywgKCkgPT4ge1xuICAgIGNvbnN0IHJvb21EdG8gPSB7IG5hbWU6ICdOZXcgUm9vbScsIG9yZGVyOiAxIH07XG4gICAgY29uc3QgbW9ja1Jvb20gPSB7IGlkOiAncm9vbS0zJywgLi4ucm9vbUR0bywgcm9vbUdyb3VwSWQ6ICdyb29tLWdyb3VwLTEnIH07XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSByb29tIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnY3JlYXRlUm9vbScpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSb29tKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZVJvb20oJ3Jvb20tZ3JvdXAtMScsIHJvb21EdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2UuY3JlYXRlUm9vbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Jvb20tZ3JvdXAtMScsIHJvb21EdG8ubmFtZSwgcm9vbUR0by5vcmRlcik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSb29tKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFJvb21zQnlHcm91cCcsICgpID0+IHtcbiAgICBjb25zdCBtb2NrUm9vbXMgPSBbXG4gICAgICB7IGlkOiAncm9vbS0xJywgbmFtZTogJ1Jvb20gMScsIG9yZGVyOiAxLCByb29tR3JvdXBJZDogJ3Jvb20tZ3JvdXAtMScgfSxcbiAgICAgIHsgaWQ6ICdyb29tLTInLCBuYW1lOiAnUm9vbSAyJywgb3JkZXI6IDIsIHJvb21Hcm91cElkOiAncm9vbS1ncm91cC0xJyB9LFxuICAgIF07XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiByb29tcyBieSBncm91cCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZmluZFJvb21zQnlHcm91cCcpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSb29tcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRSb29tc0J5R3JvdXAoJ3Jvb20tZ3JvdXAtMScpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjb21tdW5pdGllc1NlcnZpY2UuZmluZFJvb21zQnlHcm91cCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Jvb20tZ3JvdXAtMScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUm9vbXMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29tbXVuaXR5IEFzc2lnbm1lbnQgRmVhdHVyZXMnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2Fzc2lnbkNvbW11bml0aWVzVG9NZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYXNzaWduIGNvbW11bml0aWVzIHRvIGN1cnJlbnQgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZVxuICAgICAgICBjb25zdCBhc3NpZ25lZENvbW11bml0aWVzID0gW1RFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIFRFU1RfQ09NTVVOSVRZX0lEUy5ERVBSRVNTSU9OX0hFTFBdO1xuICAgICAgICBqZXN0LnNweU9uKGNvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlLCAnYXNzaWduQ29tbXVuaXRpZXNUb1VzZXInKS5tb2NrUmVzb2x2ZWRWYWx1ZShhc3NpZ25lZENvbW11bml0aWVzKTtcblxuICAgICAgICAvLyBBY3RcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5hc3NpZ25Db21tdW5pdGllc1RvTWUoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAgIC8vIEFzc2VydFxuICAgICAgICBleHBlY3QoY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UuYXNzaWduQ29tbXVuaXRpZXNUb1VzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IGFzc2lnbmVkQ29tbXVuaXRpZXMgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0Fzc2lnbm1lbnQgZmFpbGVkJyk7XG4gICAgICAgIGplc3Quc3B5T24oY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UsICdhc3NpZ25Db21tdW5pdGllc1RvVXNlcicpLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuYXNzaWduQ29tbXVuaXRpZXNUb01lKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYXNzaWduQ29tbXVuaXRpZXNUb1VzZXInLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGFzc2lnbiBjb21tdW5pdGllcyB0byBzcGVjaWZpYyB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlXG4gICAgICAgIGNvbnN0IGFzc2lnbmVkQ29tbXVuaXRpZXMgPSBbVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVF07XG4gICAgICAgIGplc3Quc3B5T24oY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UsICdhc3NpZ25Db21tdW5pdGllc1RvVXNlcicpLm1vY2tSZXNvbHZlZFZhbHVlKGFzc2lnbmVkQ29tbXVuaXRpZXMpO1xuXG4gICAgICAgIC8vIEFjdFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmFzc2lnbkNvbW11bml0aWVzVG9Vc2VyKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgICAvLyBBc3NlcnRcbiAgICAgICAgZXhwZWN0KGNvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlLmFzc2lnbkNvbW11bml0aWVzVG9Vc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLkNMSUVOVCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBhc3NpZ25lZENvbW11bml0aWVzIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0TXlSZWNvbW1lbmRlZENvbW11bml0aWVzJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gcmVjb21tZW5kZWQgY29tbXVuaXRpZXMgZm9yIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgY29uc3QgcmVjb21tZW5kZWRDb21tdW5pdGllcyA9IFtURVNUX0NPTU1VTklUWV9JRFMuQU5YSUVUWV9TVVBQT1JULCBURVNUX0NPTU1VTklUWV9JRFMuREVQUkVTU0lPTl9IRUxQXTtcbiAgICAgICAgamVzdC5zcHlPbihjb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSwgJ2dldFJlY29tbWVuZGVkQ29tbXVuaXRpZXMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShyZWNvbW1lbmRlZENvbW11bml0aWVzKTtcblxuICAgICAgICAvLyBBY3RcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRNeVJlY29tbWVuZGVkQ29tbXVuaXRpZXMoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICAgIC8vIEFzc2VydFxuICAgICAgICBleHBlY3QoY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UuZ2V0UmVjb21tZW5kZWRDb21tdW5pdGllcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgcmVjb21tZW5kZWRDb21tdW5pdGllcyB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2J1bGtBc3NpZ25Db21tdW5pdGllcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYnVsayBhc3NpZ24gY29tbXVuaXRpZXMgdG8gbXVsdGlwbGUgdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgY29uc3QgdXNlcklkcyA9IFtURVNUX1VTRVJfSURTLkNMSUVOVCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1RdO1xuICAgICAgICBjb25zdCBidWxrUmVzdWx0cyA9IHtcbiAgICAgICAgICBbVEVTVF9VU0VSX0lEUy5DTElFTlRdOiBbVEVTVF9DT01NVU5JVFlfSURTLkFOWElFVFlfU1VQUE9SVF0sXG4gICAgICAgICAgW1RFU1RfVVNFUl9JRFMuVEhFUkFQSVNUXTogW1RFU1RfQ09NTVVOSVRZX0lEUy5ERVBSRVNTSU9OX0hFTFBdLFxuICAgICAgICB9O1xuICAgICAgICBqZXN0LnNweU9uKGNvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlLCAnYnVsa0Fzc2lnbkNvbW11bml0aWVzJykubW9ja1Jlc29sdmVkVmFsdWUoYnVsa1Jlc3VsdHMpO1xuXG4gICAgICAgIC8vIEFjdFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmJ1bGtBc3NpZ25Db21tdW5pdGllcyh7IHVzZXJJZHMgfSk7XG5cbiAgICAgICAgLy8gQXNzZXJ0XG4gICAgICAgIGV4cGVjdChjb21tdW5pdHlBc3NpZ25tZW50U2VydmljZS5idWxrQXNzaWduQ29tbXVuaXRpZXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJJZHMpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgcmVzdWx0czogYnVsa1Jlc3VsdHMgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2VcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0J1bGsgYXNzaWdubWVudCBmYWlsZWQnKTtcbiAgICAgICAgamVzdC5zcHlPbihjb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSwgJ2J1bGtBc3NpZ25Db21tdW5pdGllcycpLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuYnVsa0Fzc2lnbkNvbW11bml0aWVzKHsgdXNlcklkczogW1RFU1RfVVNFUl9JRFMuQ0xJRU5UXSB9KSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAgIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlY3VyaXR5IGFuZCBBdXRob3JpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGF2ZSBwcm9wZXIgZ3VhcmRzIGFwcGxpZWQnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHRoYXQgSnd0QXV0aEd1YXJkIGlzIGFwcGxpZWQgYXQgY29udHJvbGxlciBsZXZlbFxuICAgICAgY29uc3QgZ3VhcmRzID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgnX19ndWFyZHNfXycsIENvbW11bml0aWVzQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoZ3VhcmRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGd1YXJkcykudG9Db250YWluKEp3dEF1dGhHdWFyZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRlc3Qgcm9sZS1iYXNlZCBhY2Nlc3MgZm9yIGFkbWluIGVuZHBvaW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBhZG1pbi9tb2RlcmF0b3IgZW5kcG9pbnRzIGhhdmUgcHJvcGVyIHJvbGUgZGVjb3JhdG9yc1xuICAgICAgY29uc3QgYWRtaW5NZXRob2RzID0gWydjcmVhdGUnLCAndXBkYXRlJywgJ3JlbW92ZScsICdjcmVhdGVSb29tR3JvdXAnLCAnY3JlYXRlUm9vbSddO1xuICAgICAgXG4gICAgICBhZG1pbk1ldGhvZHMuZm9yRWFjaChtZXRob2QgPT4ge1xuICAgICAgICBjb25zdCByb2xlcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ3JvbGVzJywgY29udHJvbGxlclttZXRob2QgYXMga2V5b2YgQ29tbXVuaXRpZXNDb250cm9sbGVyXSk7XG4gICAgICAgIGV4cGVjdChyb2xlcykudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJvbGVzKS50b0NvbnRhaW4oJ21vZGVyYXRvcicpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRlc3Qgcm9sZS1iYXNlZCBhY2Nlc3MgZm9yIHVzZXIgZW5kcG9pbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IHVzZXIgZW5kcG9pbnRzIGhhdmUgcHJvcGVyIHJvbGUgZGVjb3JhdG9yc1xuICAgICAgY29uc3QgdXNlck1ldGhvZHMgPSBbJ2pvaW5Db21tdW5pdHknLCAnbGVhdmVDb21tdW5pdHknXTtcbiAgICAgIFxuICAgICAgdXNlck1ldGhvZHMuZm9yRWFjaChtZXRob2QgPT4ge1xuICAgICAgICBjb25zdCByb2xlcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ3JvbGVzJywgY29udHJvbGxlclttZXRob2QgYXMga2V5b2YgQ29tbXVuaXRpZXNDb250cm9sbGVyXSk7XG4gICAgICAgIGV4cGVjdChyb2xlcykudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJvbGVzKS50b0NvbnRhaW4oJ2NsaWVudCcpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uIHByb3Blcmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbignSW50ZXJuYWwgZXJyb3InKTtcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnZmluZEFsbCcpLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5maW5kQWxsKCkpLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd3JhcCB1bmtub3duIGVycm9ycyBpbiBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgdW5rbm93bkVycm9yID0gbmV3IEVycm9yKCdVbmtub3duIGVycm9yJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbW11bml0aWVzU2VydmljZSwgJ2ZpbmRBbGwnKS5tb2NrUmVqZWN0ZWRWYWx1ZSh1bmtub3duRXJyb3IpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRBbGwoKSkucmVqZWN0cy50b1Rocm93KEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYXRpb24gVGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxldGUgY29tbXVuaXR5IGNyZWF0aW9uIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdjcmVhdGVDb21tdW5pdHknKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tbXVuaXR5KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShtb2NrQ3JlYXRlQ29tbXVuaXR5RHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50b0JlKG1vY2tDb21tdW5pdHkubmFtZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS50b0JlKG1vY2tDb21tdW5pdHkuZGVzY3JpcHRpb24pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zbHVnKS50b0JlKG1vY2tDb21tdW5pdHkuc2x1Zyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBjb21tdW5pdHkgam9pbiB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGplc3Quc3B5T24oY29tbXVuaXRpZXNTZXJ2aWNlLCAnam9pbkNvbW11bml0eScpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5qb2luQ29tbXVuaXR5KFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5qb2luZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBjb21tdW5pdHkgc3RydWN0dXJlIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgamVzdC5zcHlPbihjb21tdW5pdGllc1NlcnZpY2UsICdmaW5kT25lV2l0aFN0cnVjdHVyZScpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb21tdW5pdHlXaXRoUm9vbUdyb3Vwcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRPbmVXaXRoU3RydWN0dXJlKFRFU1RfQ09NTVVOSVRZX0lEUy5BTlhJRVRZX1NVUFBPUlQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJvb21Hcm91cHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJvb21Hcm91cHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJvb21Hcm91cHNbMF0ucm9vbXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9