4d2993607eaf7d008a42cf0a93399e2d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TEST_TIMEOUT = void 0;
// Mock external dependencies
jest.mock('axios');
jest.mock('@clerk/backend', () => ({
    clerkClient: {
        users: {
            getUser: jest.fn(),
            updateUser: jest.fn(),
            deleteUser: jest.fn(),
        },
    },
    createClerkClient: jest.fn(),
}));
require("reflect-metadata");
// Global test setup for unit tests
beforeAll(async () => {
    // Set test environment variables
    process.env.NODE_ENV = 'test';
    process.env.DATABASE_URL =
        process.env.TEST_DATABASE_URL ||
            'postgresql://test:test@localhost:5432/mentara_test';
    // Disable external services in tests
    process.env.DISABLE_CLERK_WEBHOOK = 'true';
    process.env.DISABLE_EMAIL_SERVICE = 'true';
    process.env.DISABLE_AI_SERVICE = 'true';
    // Test-specific configurations
    process.env.JWT_SECRET = 'test-jwt-secret-key';
    process.env.ENCRYPTION_KEY = 'test-encryption-key-32-chars!!';
});
// Note: File upload and AI service mocks will be added per-test as needed
// This prevents global module resolution issues when dependencies aren't installed
// Enhanced console mocking with test insights
const originalConsole = { ...console };
global.console = {
    ...console,
    // Suppress console.log during tests unless explicitly needed
    log: jest.fn((message) => {
        if (process.env.DEBUG_TESTS === 'true') {
            originalConsole.log('[TEST DEBUG]', message);
        }
    }),
    debug: jest.fn(),
    info: jest.fn(),
    warn: (message) => {
        if (process.env.SHOW_WARNINGS === 'true') {
            originalConsole.warn('[TEST WARN]', message);
        }
    },
    error: originalConsole.error, // Always show errors
};
// Setup global test timeout
jest.setTimeout(10000);
// Enhanced cleanup after each test
afterEach(async () => {
    jest.clearAllMocks();
    jest.clearAllTimers();
    // Reset environment variables that might have been modified
    delete process.env.TEST_USER_ID;
    delete process.env.TEST_ROLE;
});
// Global cleanup
afterAll(async () => {
    // Clean up any remaining async operations
    await new Promise(resolve => setTimeout(resolve, 100));
});
// Test environment validation
if (process.env.JEST_TEST_TYPE === 'integration' &&
    !process.env.DATABASE_URL?.includes('test')) {
    throw new Error('Integration tests must use a test database. DATABASE_URL must contain "test"');
}
// Prevent tests from running against production database
if (process.env.DATABASE_URL?.includes('prod')) {
    throw new Error('Tests cannot run against production database!');
}
// Enhanced test timeouts with categories
exports.TEST_TIMEOUT = {
    UNIT: 5000,
    INTEGRATION: 15000,
    E2E: 30000,
    DATABASE: 20000,
    ASYNC_OPERATION: 10000,
};
// Test performance tracking
const testStartTimes = new Map();
beforeEach(() => {
    const testName = expect.getState().currentTestName;
    testStartTimes.set(testName, Date.now());
});
afterEach(() => {
    const testName = expect.getState().currentTestName;
    const startTime = testStartTimes.get(testName);
    if (startTime && process.env.TRACK_TEST_PERFORMANCE === 'true') {
        const duration = Date.now() - startTime;
        if (duration > 1000) {
            console.warn(`Slow test detected: ${testName} took ${duration}ms`);
        }
    }
    testStartTimes.delete(testName);
});
// Global error handlers for unhandled promises
process.on('unhandledRejection', (reason, promise) => {
    console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
process.on('uncaughtException', (error) => {
    console.error('Uncaught Exception:', error);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvamVzdC5zZXR1cC50cyIsIm1hcHBpbmdzIjoiOzs7QUFvQkEsNkJBQTZCO0FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLFdBQVcsRUFBRTtRQUNYLEtBQUssRUFBRTtZQUNMLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2xCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3JCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ3RCO0tBQ0Y7SUFDRCxpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQzdCLENBQUMsQ0FBQyxDQUFDO0FBL0JKLDRCQUEwQjtBQUUxQixtQ0FBbUM7QUFDbkMsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO0lBQ25CLGlDQUFpQztJQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUM7SUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZO1FBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCO1lBQzdCLG9EQUFvRCxDQUFDO0lBRXZELHFDQUFxQztJQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixHQUFHLE1BQU0sQ0FBQztJQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixHQUFHLE1BQU0sQ0FBQztJQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixHQUFHLE1BQU0sQ0FBQztJQUV4QywrQkFBK0I7SUFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcscUJBQXFCLENBQUM7SUFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsZ0NBQWdDLENBQUM7QUFDaEUs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QU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxlQUFlLENBQUM7SUFDbkQsTUFBTSxTQUFTLEdBQUcsY0FBYyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMvQyxJQUFJLFNBQVMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixLQUFLLE1BQU0sRUFBRSxDQUFDO1FBQy9ELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7UUFDeEMsSUFBSSxRQUFRLEdBQUcsSUFBSSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsUUFBUSxTQUFTLFFBQVEsSUFBSSxDQUFDLENBQUM7UUFDckUsQ0FBQztJQUNILENBQUM7SUFDRCxjQUFjLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsQ0FBQyxDQUFDO0FBRUgsK0NBQStDO0FBQy9DLE9BQU8sQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7SUFDbkQsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3ZFLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ3hDLE9BQU8sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDOUMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvamVzdC5zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuXG4vLyBHbG9iYWwgdGVzdCBzZXR1cCBmb3IgdW5pdCB0ZXN0c1xuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gU2V0IHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xuICBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPVxuICAgIHByb2Nlc3MuZW52LlRFU1RfREFUQUJBU0VfVVJMIHx8XG4gICAgJ3Bvc3RncmVzcWw6Ly90ZXN0OnRlc3RAbG9jYWxob3N0OjU0MzIvbWVudGFyYV90ZXN0JztcbiAgXG4gIC8vIERpc2FibGUgZXh0ZXJuYWwgc2VydmljZXMgaW4gdGVzdHNcbiAgcHJvY2Vzcy5lbnYuRElTQUJMRV9DTEVSS19XRUJIT09LID0gJ3RydWUnO1xuICBwcm9jZXNzLmVudi5ESVNBQkxFX0VNQUlMX1NFUlZJQ0UgPSAndHJ1ZSc7XG4gIHByb2Nlc3MuZW52LkRJU0FCTEVfQUlfU0VSVklDRSA9ICd0cnVlJztcbiAgXG4gIC8vIFRlc3Qtc3BlY2lmaWMgY29uZmlndXJhdGlvbnNcbiAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCA9ICd0ZXN0LWp3dC1zZWNyZXQta2V5JztcbiAgcHJvY2Vzcy5lbnYuRU5DUllQVElPTl9LRVkgPSAndGVzdC1lbmNyeXB0aW9uLWtleS0zMi1jaGFycyEhJztcbn0pO1xuXG4vLyBNb2NrIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCdheGlvcycpO1xuamVzdC5tb2NrKCdAY2xlcmsvYmFja2VuZCcsICgpID0+ICh7XG4gIGNsZXJrQ2xpZW50OiB7XG4gICAgdXNlcnM6IHtcbiAgICAgIGdldFVzZXI6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVVzZXI6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZVVzZXI6IGplc3QuZm4oKSxcbiAgICB9LFxuICB9LFxuICBjcmVhdGVDbGVya0NsaWVudDogamVzdC5mbigpLFxufSkpO1xuXG4vLyBOb3RlOiBGaWxlIHVwbG9hZCBhbmQgQUkgc2VydmljZSBtb2NrcyB3aWxsIGJlIGFkZGVkIHBlci10ZXN0IGFzIG5lZWRlZFxuLy8gVGhpcyBwcmV2ZW50cyBnbG9iYWwgbW9kdWxlIHJlc29sdXRpb24gaXNzdWVzIHdoZW4gZGVwZW5kZW5jaWVzIGFyZW4ndCBpbnN0YWxsZWRcblxuLy8gRW5oYW5jZWQgY29uc29sZSBtb2NraW5nIHdpdGggdGVzdCBpbnNpZ2h0c1xuY29uc3Qgb3JpZ2luYWxDb25zb2xlID0geyAuLi5jb25zb2xlIH07XG5nbG9iYWwuY29uc29sZSA9IHtcbiAgLi4uY29uc29sZSxcbiAgLy8gU3VwcHJlc3MgY29uc29sZS5sb2cgZHVyaW5nIHRlc3RzIHVubGVzcyBleHBsaWNpdGx5IG5lZWRlZFxuICBsb2c6IGplc3QuZm4oKG1lc3NhZ2UpID0+IHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuREVCVUdfVEVTVFMgPT09ICd0cnVlJykge1xuICAgICAgb3JpZ2luYWxDb25zb2xlLmxvZygnW1RFU1QgREVCVUddJywgbWVzc2FnZSk7XG4gICAgfVxuICB9KSxcbiAgZGVidWc6IGplc3QuZm4oKSxcbiAgaW5mbzogamVzdC5mbigpLFxuICB3YXJuOiAobWVzc2FnZSkgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5TSE9XX1dBUk5JTkdTID09PSAndHJ1ZScpIHtcbiAgICAgIG9yaWdpbmFsQ29uc29sZS53YXJuKCdbVEVTVCBXQVJOXScsIG1lc3NhZ2UpO1xuICAgIH1cbiAgfSxcbiAgZXJyb3I6IG9yaWdpbmFsQ29uc29sZS5lcnJvciwgLy8gQWx3YXlzIHNob3cgZXJyb3JzXG59O1xuXG4vLyBTZXR1cCBnbG9iYWwgdGVzdCB0aW1lb3V0XG5qZXN0LnNldFRpbWVvdXQoMTAwMDApO1xuXG4vLyBFbmhhbmNlZCBjbGVhbnVwIGFmdGVyIGVhY2ggdGVzdFxuYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbiAgXG4gIC8vIFJlc2V0IGVudmlyb25tZW50IHZhcmlhYmxlcyB0aGF0IG1pZ2h0IGhhdmUgYmVlbiBtb2RpZmllZFxuICBkZWxldGUgcHJvY2Vzcy5lbnYuVEVTVF9VU0VSX0lEO1xuICBkZWxldGUgcHJvY2Vzcy5lbnYuVEVTVF9ST0xFO1xufSk7XG5cbi8vIEdsb2JhbCBjbGVhbnVwXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gIC8vIENsZWFuIHVwIGFueSByZW1haW5pbmcgYXN5bmMgb3BlcmF0aW9uc1xuICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG59KTtcblxuLy8gVGVzdCBlbnZpcm9ubWVudCB2YWxpZGF0aW9uXG5pZiAoXG4gIHByb2Nlc3MuZW52LkpFU1RfVEVTVF9UWVBFID09PSAnaW50ZWdyYXRpb24nICYmXG4gICFwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw/LmluY2x1ZGVzKCd0ZXN0Jylcbikge1xuICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgJ0ludGVncmF0aW9uIHRlc3RzIG11c3QgdXNlIGEgdGVzdCBkYXRhYmFzZS4gREFUQUJBU0VfVVJMIG11c3QgY29udGFpbiBcInRlc3RcIicsXG4gICk7XG59XG5cbi8vIFByZXZlbnQgdGVzdHMgZnJvbSBydW5uaW5nIGFnYWluc3QgcHJvZHVjdGlvbiBkYXRhYmFzZVxuaWYgKHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTD8uaW5jbHVkZXMoJ3Byb2QnKSkge1xuICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgJ1Rlc3RzIGNhbm5vdCBydW4gYWdhaW5zdCBwcm9kdWN0aW9uIGRhdGFiYXNlIScsXG4gICk7XG59XG5cbi8vIEdsb2JhbCB0ZXN0IGNvbnN0YW50c1xuZGVjbGFyZSBnbG9iYWwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5hbWVzcGFjZVxuICBuYW1lc3BhY2UgTm9kZUpTIHtcbiAgICBpbnRlcmZhY2UgR2xvYmFsIHtcbiAgICAgIHRlc3REYjogYW55O1xuICAgICAgdGVzdEZhY3Rvcnk6IGFueTtcbiAgICB9XG4gIH1cbn1cblxuLy8gRW5oYW5jZWQgdGVzdCB0aW1lb3V0cyB3aXRoIGNhdGVnb3JpZXNcbmV4cG9ydCBjb25zdCBURVNUX1RJTUVPVVQgPSB7XG4gIFVOSVQ6IDUwMDAsXG4gIElOVEVHUkFUSU9OOiAxNTAwMCxcbiAgRTJFOiAzMDAwMCxcbiAgREFUQUJBU0U6IDIwMDAwLFxuICBBU1lOQ19PUEVSQVRJT046IDEwMDAwLFxufTtcblxuLy8gVGVzdCBwZXJmb3JtYW5jZSB0cmFja2luZ1xuY29uc3QgdGVzdFN0YXJ0VGltZXMgPSBuZXcgTWFwKCk7XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICBjb25zdCB0ZXN0TmFtZSA9IGV4cGVjdC5nZXRTdGF0ZSgpLmN1cnJlbnRUZXN0TmFtZTtcbiAgdGVzdFN0YXJ0VGltZXMuc2V0KHRlc3ROYW1lLCBEYXRlLm5vdygpKTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBjb25zdCB0ZXN0TmFtZSA9IGV4cGVjdC5nZXRTdGF0ZSgpLmN1cnJlbnRUZXN0TmFtZTtcbiAgY29uc3Qgc3RhcnRUaW1lID0gdGVzdFN0YXJ0VGltZXMuZ2V0KHRlc3ROYW1lKTtcbiAgaWYgKHN0YXJ0VGltZSAmJiBwcm9jZXNzLmVudi5UUkFDS19URVNUX1BFUkZPUk1BTkNFID09PSAndHJ1ZScpIHtcbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgaWYgKGR1cmF0aW9uID4gMTAwMCkge1xuICAgICAgY29uc29sZS53YXJuKGBTbG93IHRlc3QgZGV0ZWN0ZWQ6ICR7dGVzdE5hbWV9IHRvb2sgJHtkdXJhdGlvbn1tc2ApO1xuICAgIH1cbiAgfVxuICB0ZXN0U3RhcnRUaW1lcy5kZWxldGUodGVzdE5hbWUpO1xufSk7XG5cbi8vIEdsb2JhbCBlcnJvciBoYW5kbGVycyBmb3IgdW5oYW5kbGVkIHByb21pc2VzXG5wcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAocmVhc29uLCBwcm9taXNlKSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoJ1VuaGFuZGxlZCBSZWplY3Rpb24gYXQ6JywgcHJvbWlzZSwgJ3JlYXNvbjonLCByZWFzb24pO1xufSk7XG5cbnByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycm9yKSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoJ1VuY2F1Z2h0IEV4Y2VwdGlvbjonLCBlcnJvcik7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==