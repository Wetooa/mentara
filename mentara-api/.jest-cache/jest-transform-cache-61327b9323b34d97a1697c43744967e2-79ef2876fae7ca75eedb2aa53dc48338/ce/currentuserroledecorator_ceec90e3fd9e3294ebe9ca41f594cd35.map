{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/decorators/current-user-role.decorator.ts","mappings":";;;AAAA,2CAA6E;AAE7E,iFAAqE;AACrE,uBAAqB;AAER,QAAA,eAAe,GAAG,IAAA,6BAAoB,EACjD,KAAK,EAAE,CAAC,EAAE,OAAyB,EAAE,EAAE;IACrC,MAAM,OAAO,GAAG,OAAO,CAAC,YAAY,EAAE,CAAC,UAAU,EAAW,CAAC;IAC7D,MAAM,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC;IAE/B,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,OAAO,IAAI,CAAC;IACd,CAAC;IAED,oEAAoE;IACpE,IAAI,OAAO,CAAC,QAAQ,EAAE,CAAC;QACrB,OAAO,OAAO,CAAC,QAAQ,CAAC;IAC1B,CAAC;IAED,0DAA0D;IAC1D,IAAI,CAAC;QACH,MAAM,MAAM,GAAG,IAAI,sCAAa,EAAE,CAAC;QACnC,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,KAAK,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE;YACtB,MAAM,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE;SACvB,CAAC,CAAC;QAEH,MAAM,MAAM,CAAC,WAAW,EAAE,CAAC;QAC3B,OAAO,IAAI,EAAE,IAAI,IAAI,IAAI,CAAC;IAC5B,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CACX,wCAAwC,EACxC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAC/C,CAAC;QACF,OAAO,IAAI,CAAC;IACd,CAAC;AACH,CAAC,CACF,CAAC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/decorators/current-user-role.decorator.ts"],"sourcesContent":["import { createParamDecorator, type ExecutionContext } from '@nestjs/common';\nimport { type Request } from 'express';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport '../../types';\n\nexport const CurrentUserRole = createParamDecorator(\n  async (_, context: ExecutionContext) => {\n    const request = context.switchToHttp().getRequest<Request>();\n    const clerkId = request.userId;\n\n    if (!clerkId) {\n      return null;\n    }\n\n    // First, check if role was extracted from JWT token by JwtAuthGuard\n    if (request.userRole) {\n      return request.userRole;\n    }\n\n    // Fallback to database lookup for backwards compatibility\n    try {\n      const prisma = new PrismaService();\n      const user = await prisma.user.findUnique({\n        where: { id: clerkId },\n        select: { role: true },\n      });\n\n      await prisma.$disconnect();\n      return user?.role ?? null;\n    } catch (error) {\n      console.error(\n        'Error getting user role from database:',\n        error instanceof Error ? error.message : error,\n      );\n      return null;\n    }\n  },\n);\n"],"version":3}