c192eb03fa2af1ca706634fbb09ab272
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MatchingAnalyticsService = void 0;
const common_1 = require("@nestjs/common");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
let MatchingAnalyticsService = class MatchingAnalyticsService {
    prisma;
    constructor(prisma) {
        this.prisma = prisma;
    }
    /**
     * Track a recommendation being made
     */
    async trackRecommendation(clientId, therapistScores, algorithmVersion = 'advanced_v1.0') {
        try {
            const matchHistoryRecords = therapistScores.map((score, index) => ({
                clientId,
                therapistId: score.therapist.userId,
                totalScore: score.totalScore,
                conditionScore: Math.round(score.breakdown.conditionScore),
                approachScore: Math.round(score.breakdown.approachScore),
                experienceScore: Math.round(score.breakdown.experienceScore),
                reviewScore: Math.round(score.breakdown.reviewScore),
                logisticsScore: Math.round(score.breakdown.logisticsScore),
                primaryMatches: score.matchExplanation.primaryMatches,
                secondaryMatches: score.matchExplanation.secondaryMatches,
                approachMatches: score.matchExplanation.approachMatches,
                recommendationRank: index + 1,
                totalRecommendations: therapistScores.length,
                recommendationAlgorithm: algorithmVersion,
            }));
            await this.prisma.matchHistory.createMany({
                data: matchHistoryRecords,
                skipDuplicates: true,
            });
        }
        catch (error) {
            console.error('Failed to track recommendation:', error);
            // Don't throw - analytics shouldn't break the recommendation flow
        }
    }
    /**
     * Track compatibility analysis
     */
    async trackCompatibilityAnalysis(clientId, therapistId, compatibility, analysisVersion = '1.0') {
        try {
            await this.prisma.clientCompatibility.upsert({
                where: {
                    clientId_therapistId: {
                        clientId,
                        therapistId,
                    },
                },
                update: {
                    personalityCompatibility: compatibility.personalityCompatibility.overallCompatibility,
                    sessionCompatibility: compatibility.sessionCompatibility.overallCompatibility,
                    demographicCompatibility: compatibility.demographicCompatibility.overallCompatibility,
                    overallCompatibility: compatibility.overallCompatibilityScore,
                    communicationStyleScore: compatibility.personalityCompatibility.communicationStyle,
                    personalityMatchScore: compatibility.personalityCompatibility.personalityMatch,
                    culturalCompatibilityScore: compatibility.personalityCompatibility.culturalCompatibility,
                    formatMatchScore: compatibility.sessionCompatibility.formatMatch,
                    durationMatchScore: compatibility.sessionCompatibility.durationMatch,
                    frequencyMatchScore: compatibility.sessionCompatibility.frequencyMatch,
                    schedulingCompatibilityScore: compatibility.sessionCompatibility.schedulingCompatibility,
                    ageCompatibilityScore: compatibility.demographicCompatibility.ageCompatibility,
                    genderCompatibilityScore: compatibility.demographicCompatibility.genderCompatibility,
                    languageCompatibilityScore: compatibility.demographicCompatibility.languageCompatibility,
                    strengths: compatibility.compatibilityFactors.strengths,
                    concerns: compatibility.compatibilityFactors.concerns,
                    recommendations: compatibility.compatibilityFactors.recommendations,
                    analysisVersion,
                    updatedAt: new Date(),
                },
                create: {
                    clientId,
                    therapistId,
                    personalityCompatibility: compatibility.personalityCompatibility.overallCompatibility,
                    sessionCompatibility: compatibility.sessionCompatibility.overallCompatibility,
                    demographicCompatibility: compatibility.demographicCompatibility.overallCompatibility,
                    overallCompatibility: compatibility.overallCompatibilityScore,
                    communicationStyleScore: compatibility.personalityCompatibility.communicationStyle,
                    personalityMatchScore: compatibility.personalityCompatibility.personalityMatch,
                    culturalCompatibilityScore: compatibility.personalityCompatibility.culturalCompatibility,
                    formatMatchScore: compatibility.sessionCompatibility.formatMatch,
                    durationMatchScore: compatibility.sessionCompatibility.durationMatch,
                    frequencyMatchScore: compatibility.sessionCompatibility.frequencyMatch,
                    schedulingCompatibilityScore: compatibility.sessionCompatibility.schedulingCompatibility,
                    ageCompatibilityScore: compatibility.demographicCompatibility.ageCompatibility,
                    genderCompatibilityScore: compatibility.demographicCompatibility.genderCompatibility,
                    languageCompatibilityScore: compatibility.demographicCompatibility.languageCompatibility,
                    strengths: compatibility.compatibilityFactors.strengths,
                    concerns: compatibility.compatibilityFactors.concerns,
                    recommendations: compatibility.compatibilityFactors.recommendations,
                    analysisVersion,
                },
            });
        }
        catch (error) {
            console.error('Failed to track compatibility analysis:', error);
        }
    }
    /**
     * Track when a user views a therapist recommendation
     */
    async trackRecommendationView(clientId, therapistId) {
        try {
            await this.prisma.matchHistory.updateMany({
                where: {
                    clientId,
                    therapistId,
                    wasViewed: false,
                },
                data: {
                    wasViewed: true,
                    updatedAt: new Date(),
                },
            });
        }
        catch (error) {
            console.error('Failed to track recommendation view:', error);
        }
    }
    /**
     * Track when a user contacts a therapist
     */
    async trackTherapistContact(clientId, therapistId) {
        try {
            await this.prisma.matchHistory.updateMany({
                where: {
                    clientId,
                    therapistId,
                    wasContacted: false,
                },
                data: {
                    wasContacted: true,
                    updatedAt: new Date(),
                },
            });
        }
        catch (error) {
            console.error('Failed to track therapist contact:', error);
        }
    }
    /**
     * Track when a recommendation becomes an actual client-therapist relationship
     */
    async trackSuccessfulMatch(clientId, therapistId) {
        try {
            await this.prisma.matchHistory.updateMany({
                where: {
                    clientId,
                    therapistId,
                    becameClient: false,
                },
                data: {
                    becameClient: true,
                    updatedAt: new Date(),
                },
            });
        }
        catch (error) {
            console.error('Failed to track successful match:', error);
        }
    }
    /**
     * Track recommendation feedback from users
     */
    async recordRecommendationFeedback(clientId, therapistId, feedback) {
        try {
            const matchHistory = await this.prisma.matchHistory.findFirst({
                where: { clientId, therapistId },
                orderBy: { createdAt: 'desc' },
            });
            await this.prisma.recommendationFeedback.create({
                data: {
                    clientId,
                    therapistId,
                    matchHistoryId: matchHistory?.id,
                    relevanceScore: feedback.relevanceScore,
                    accuracyScore: feedback.accuracyScore,
                    helpfulnessScore: feedback.helpfulnessScore,
                    feedbackText: feedback.feedbackText,
                    selectedTherapist: feedback.selectedTherapist || false,
                    reasonNotSelected: feedback.reasonNotSelected,
                },
            });
        }
        catch (error) {
            console.error('Failed to record recommendation feedback:', error);
        }
    }
    /**
     * Get algorithm performance metrics for a time period
     */
    async getAlgorithmPerformance(algorithmName, startDate, endDate) {
        try {
            const matchHistory = await this.prisma.matchHistory.findMany({
                where: {
                    recommendationAlgorithm: algorithmName,
                    createdAt: {
                        gte: startDate,
                        lte: endDate,
                    },
                },
            });
            const totalRecommendations = matchHistory.length;
            const successfulMatches = matchHistory.filter((m) => m.becameClient).length;
            const viewedRecommendations = matchHistory.filter((m) => m.wasViewed).length;
            const contactedTherapists = matchHistory.filter((m) => m.wasContacted).length;
            const averageMatchScore = totalRecommendations > 0
                ? matchHistory.reduce((sum, m) => sum + m.totalScore, 0) /
                    totalRecommendations
                : 0;
            // Get satisfaction scores from feedback
            const feedbackData = await this.prisma.recommendationFeedback.findMany({
                where: {
                    createdAt: {
                        gte: startDate,
                        lte: endDate,
                    },
                    overallSatisfaction: {
                        not: null,
                    },
                },
            });
            const averageSatisfactionScore = feedbackData.length > 0
                ? feedbackData.reduce((sum, f) => sum + (f.overallSatisfaction || 0), 0) / feedbackData.length
                : 0;
            const clickThroughRate = totalRecommendations > 0
                ? (viewedRecommendations / totalRecommendations) * 100
                : 0;
            const conversionRate = totalRecommendations > 0
                ? (successfulMatches / totalRecommendations) * 100
                : 0;
            // Retention rate calculation would require session data
            const retentionRate = 0; // Placeholder - implement based on session tracking
            return {
                totalRecommendations,
                successfulMatches,
                averageMatchScore,
                averageSatisfactionScore,
                clickThroughRate,
                conversionRate,
                retentionRate,
            };
        }
        catch (error) {
            console.error('Failed to get algorithm performance:', error);
            throw error;
        }
    }
    /**
     * Store algorithm performance snapshot
     */
    async storePerformanceSnapshot(algorithmName, version, metrics, periodStart, periodEnd) {
        try {
            await this.prisma.algorithmPerformance.create({
                data: {
                    algorithmName,
                    version,
                    totalRecommendations: metrics.totalRecommendations,
                    successfulMatches: metrics.successfulMatches,
                    averageMatchScore: metrics.averageMatchScore,
                    averageSatisfactionScore: metrics.averageSatisfactionScore,
                    clickThroughRate: metrics.clickThroughRate,
                    conversionRate: metrics.conversionRate,
                    retentionRate: metrics.retentionRate,
                    periodStart,
                    periodEnd,
                },
            });
        }
        catch (error) {
            console.error('Failed to store performance snapshot:', error);
        }
    }
    /**
     * Get top performing therapists by recommendation success
     */
    async getTopPerformingTherapists(limit = 10, startDate, endDate) {
        try {
            const whereClause = {
                becameClient: true,
            };
            if (startDate && endDate) {
                whereClause.createdAt = {
                    gte: startDate,
                    lte: endDate,
                };
            }
            const topTherapists = await this.prisma.matchHistory.groupBy({
                by: ['therapistId'],
                where: whereClause,
                _count: {
                    id: true,
                },
                _avg: {
                    totalScore: true,
                    clientSatisfactionScore: true,
                },
                orderBy: {
                    _count: {
                        id: 'desc',
                    },
                },
                take: limit,
            });
            // Enrich with therapist data
            const enrichedData = await Promise.all(topTherapists.map(async (therapist) => {
                const therapistData = await this.prisma.therapist.findUnique({
                    where: { userId: therapist.therapistId },
                    include: { user: true },
                });
                return {
                    therapist: therapistData,
                    successfulMatches: therapist._count.id,
                    averageMatchScore: therapist._avg.totalScore || 0,
                    averageSatisfactionScore: therapist._avg.clientSatisfactionScore || 0,
                };
            }));
            return enrichedData;
        }
        catch (error) {
            console.error('Failed to get top performing therapists:', error);
            throw error;
        }
    }
    /**
     * Get matching insights for improving the algorithm
     */
    async getMatchingInsights(startDate, endDate) {
        try {
            // Most successful condition matches
            const conditionMatches = await this.prisma.matchHistory.findMany({
                where: {
                    becameClient: true,
                    createdAt: {
                        gte: startDate,
                        lte: endDate,
                    },
                },
                select: {
                    primaryMatches: true,
                    secondaryMatches: true,
                    totalScore: true,
                },
            });
            // Most successful approach matches
            const approachMatches = await this.prisma.matchHistory.findMany({
                where: {
                    becameClient: true,
                    createdAt: {
                        gte: startDate,
                        lte: endDate,
                    },
                },
                select: {
                    approachMatches: true,
                    totalScore: true,
                },
            });
            // Score distribution analysis
            const scoreDistribution = await this.prisma.matchHistory.groupBy({
                by: ['totalScore'],
                where: {
                    createdAt: {
                        gte: startDate,
                        lte: endDate,
                    },
                },
                _count: {
                    id: true,
                },
                orderBy: {
                    totalScore: 'asc',
                },
            });
            return {
                conditionMatches,
                approachMatches,
                scoreDistribution,
            };
        }
        catch (error) {
            console.error('Failed to get matching insights:', error);
            throw error;
        }
    }
};
exports.MatchingAnalyticsService = MatchingAnalyticsService;
exports.MatchingAnalyticsService = MatchingAnalyticsService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [prisma_client_provider_1.PrismaService])
], MatchingAnalyticsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9zZXJ2aWNlcy9tYXRjaGluZy1hbmFseXRpY3Muc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBNEM7QUFDNUMsbUZBQXVFO0FBdUJoRSxJQUFNLHdCQUF3QixHQUE5QixNQUFNLHdCQUF3QjtJQUNOO0lBQTdCLFlBQTZCLE1BQXFCO1FBQXJCLFdBQU0sR0FBTixNQUFNLENBQWU7SUFBRyxDQUFDO0lBRXREOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUN2QixRQUFnQixFQUNoQixlQUFpQyxFQUNqQyxtQkFBMkIsZUFBZTtRQUUxQyxJQUFJLENBQUM7WUFDSCxNQUFNLG1CQUFtQixHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUNqRSxRQUFRO2dCQUNSLFdBQVcsRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQU07Z0JBQ25DLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtnQkFDNUIsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUM7Z0JBQzFELGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDO2dCQUN4RCxlQUFlLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQztnQkFDNUQsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUM7Z0JBQ3BELGNBQWMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDO2dCQUMxRCxjQUFjLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGNB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QUFnQjtnQkFDaEIsZUFBZTtnQkFDZixpQkFBaUI7YUFDbEIsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN6RCxNQUFNLEtBQUssQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQWhlWSw0REFBd0I7bUNBQXhCLHdCQUF3QjtJQURwQyxJQUFBLG1CQUFVLEdBQUU7cUNBRTBCLHNDQUFhO0dBRHZDLHdCQUF3QixDQWdlcEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9zZXJ2aWNlcy9tYXRjaGluZy1hbmFseXRpY3Muc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uLy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IFRoZXJhcGlzdFNjb3JlIH0gZnJvbSAnLi9hZHZhbmNlZC1tYXRjaGluZy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbXBhdGliaWxpdHlBbmFseXNpcyB9IGZyb20gJy4vY29tcGF0aWJpbGl0eS1hbmFseXNpcy5zZXJ2aWNlJztcblxuZXhwb3J0IGludGVyZmFjZSBNYXRjaGluZ01ldHJpY3Mge1xuICB0b3RhbFJlY29tbWVuZGF0aW9uczogbnVtYmVyO1xuICBzdWNjZXNzZnVsTWF0Y2hlczogbnVtYmVyO1xuICBhdmVyYWdlTWF0Y2hTY29yZTogbnVtYmVyO1xuICBhdmVyYWdlU2F0aXNmYWN0aW9uU2NvcmU6IG51bWJlcjtcbiAgY2xpY2tUaHJvdWdoUmF0ZTogbnVtYmVyO1xuICBjb252ZXJzaW9uUmF0ZTogbnVtYmVyO1xuICByZXRlbnRpb25SYXRlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjb21tZW5kYXRpb25QZXJmb3JtYW5jZSB7XG4gIGFsZ29yaXRobU5hbWU6IHN0cmluZztcbiAgdmVyc2lvbjogc3RyaW5nO1xuICBtZXRyaWNzOiBNYXRjaGluZ01ldHJpY3M7XG4gIHBlcmlvZFN0YXJ0OiBEYXRlO1xuICBwZXJpb2RFbmQ6IERhdGU7XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNYXRjaGluZ0FuYWx5dGljc1NlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHByaXNtYTogUHJpc21hU2VydmljZSkge31cblxuICAvKipcbiAgICogVHJhY2sgYSByZWNvbW1lbmRhdGlvbiBiZWluZyBtYWRlXG4gICAqL1xuICBhc3luYyB0cmFja1JlY29tbWVuZGF0aW9uKFxuICAgIGNsaWVudElkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0U2NvcmVzOiBUaGVyYXBpc3RTY29yZVtdLFxuICAgIGFsZ29yaXRobVZlcnNpb246IHN0cmluZyA9ICdhZHZhbmNlZF92MS4wJyxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1hdGNoSGlzdG9yeVJlY29yZHMgPSB0aGVyYXBpc3RTY29yZXMubWFwKChzY29yZSwgaW5kZXgpID0+ICh7XG4gICAgICAgIGNsaWVudElkLFxuICAgICAgICB0aGVyYXBpc3RJZDogc2NvcmUudGhlcmFwaXN0LnVzZXJJZCxcbiAgICAgICAgdG90YWxTY29yZTogc2NvcmUudG90YWxTY29yZSxcbiAgICAgICAgY29uZGl0aW9uU2NvcmU6IE1hdGgucm91bmQoc2NvcmUuYnJlYWtkb3duLmNvbmRpdGlvblNjb3JlKSxcbiAgICAgICAgYXBwcm9hY2hTY29yZTogTWF0aC5yb3VuZChzY29yZS5icmVha2Rvd24uYXBwcm9hY2hTY29yZSksXG4gICAgICAgIGV4cGVyaWVuY2VTY29yZTogTWF0aC5yb3VuZChzY29yZS5icmVha2Rvd24uZXhwZXJpZW5jZVNjb3JlKSxcbiAgICAgICAgcmV2aWV3U2NvcmU6IE1hdGgucm91bmQoc2NvcmUuYnJlYWtkb3duLnJldmlld1Njb3JlKSxcbiAgICAgICAgbG9naXN0aWNzU2NvcmU6IE1hdGgucm91bmQoc2NvcmUuYnJlYWtkb3duLmxvZ2lzdGljc1Njb3JlKSxcbiAgICAgICAgcHJpbWFyeU1hdGNoZXM6IHNjb3JlLm1hdGNoRXhwbGFuYXRpb24ucHJpbWFyeU1hdGNoZXMsXG4gICAgICAgIHNlY29uZGFyeU1hdGNoZXM6IHNjb3JlLm1hdGNoRXhwbGFuYXRpb24uc2Vjb25kYXJ5TWF0Y2hlcyxcbiAgICAgICAgYXBwcm9hY2hNYXRjaGVzOiBzY29yZS5tYXRjaEV4cGxhbmF0aW9uLmFwcHJvYWNoTWF0Y2hlcyxcbiAgICAgICAgcmVjb21tZW5kYXRpb25SYW5rOiBpbmRleCArIDEsXG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zOiB0aGVyYXBpc3RTY29yZXMubGVuZ3RoLFxuICAgICAgICByZWNvbW1lbmRhdGlvbkFsZ29yaXRobTogYWxnb3JpdGhtVmVyc2lvbixcbiAgICAgIH0pKTtcblxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEubWF0Y2hIaXN0b3J5LmNyZWF0ZU1hbnkoe1xuICAgICAgICBkYXRhOiBtYXRjaEhpc3RvcnlSZWNvcmRzLFxuICAgICAgICBza2lwRHVwbGljYXRlczogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdHJhY2sgcmVjb21tZW5kYXRpb246JywgZXJyb3IpO1xuICAgICAgLy8gRG9uJ3QgdGhyb3cgLSBhbmFseXRpY3Mgc2hvdWxkbid0IGJyZWFrIHRoZSByZWNvbW1lbmRhdGlvbiBmbG93XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRyYWNrIGNvbXBhdGliaWxpdHkgYW5hbHlzaXNcbiAgICovXG4gIGFzeW5jIHRyYWNrQ29tcGF0aWJpbGl0eUFuYWx5c2lzKFxuICAgIGNsaWVudElkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICBjb21wYXRpYmlsaXR5OiBDb21wYXRpYmlsaXR5QW5hbHlzaXMsXG4gICAgYW5hbHlzaXNWZXJzaW9uOiBzdHJpbmcgPSAnMS4wJyxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMucHJpc21hLmNsaWVudENvbXBhdGliaWxpdHkudXBzZXJ0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjbGllbnRJZF90aGVyYXBpc3RJZDoge1xuICAgICAgICAgICAgY2xpZW50SWQsXG4gICAgICAgICAgICB0aGVyYXBpc3RJZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICBwZXJzb25hbGl0eUNvbXBhdGliaWxpdHk6XG4gICAgICAgICAgICBjb21wYXRpYmlsaXR5LnBlcnNvbmFsaXR5Q29tcGF0aWJpbGl0eS5vdmVyYWxsQ29tcGF0aWJpbGl0eSxcbiAgICAgICAgICBzZXNzaW9uQ29tcGF0aWJpbGl0eTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkub3ZlcmFsbENvbXBhdGliaWxpdHksXG4gICAgICAgICAgZGVtb2dyYXBoaWNDb21wYXRpYmlsaXR5OlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5kZW1vZ3JhcGhpY0NvbXBhdGliaWxpdHkub3ZlcmFsbENvbXBhdGliaWxpdHksXG4gICAgICAgICAgb3ZlcmFsbENvbXBhdGliaWxpdHk6IGNvbXBhdGliaWxpdHkub3ZlcmFsbENvbXBhdGliaWxpdHlTY29yZSxcbiAgICAgICAgICBjb21tdW5pY2F0aW9uU3R5bGVTY29yZTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkucGVyc29uYWxpdHlDb21wYXRpYmlsaXR5LmNvbW11bmljYXRpb25TdHlsZSxcbiAgICAgICAgICBwZXJzb25hbGl0eU1hdGNoU2NvcmU6XG4gICAgICAgICAgICBjb21wYXRpYmlsaXR5LnBlcnNvbmFsaXR5Q29tcGF0aWJpbGl0eS5wZXJzb25hbGl0eU1hdGNoLFxuICAgICAgICAgIGN1bHR1cmFsQ29tcGF0aWJpbGl0eVNjb3JlOlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5wZXJzb25hbGl0eUNvbXBhdGliaWxpdHkuY3VsdHVyYWxDb21wYXRpYmlsaXR5LFxuICAgICAgICAgIGZvcm1hdE1hdGNoU2NvcmU6IGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkuZm9ybWF0TWF0Y2gsXG4gICAgICAgICAgZHVyYXRpb25NYXRjaFNjb3JlOiBjb21wYXRpYmlsaXR5LnNlc3Npb25Db21wYXRpYmlsaXR5LmR1cmF0aW9uTWF0Y2gsXG4gICAgICAgICAgZnJlcXVlbmN5TWF0Y2hTY29yZTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkuZnJlcXVlbmN5TWF0Y2gsXG4gICAgICAgICAgc2NoZWR1bGluZ0NvbXBhdGliaWxpdHlTY29yZTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkuc2NoZWR1bGluZ0NvbXBhdGliaWxpdHksXG4gICAgICAgICAgYWdlQ29tcGF0aWJpbGl0eVNjb3JlOlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5kZW1vZ3JhcGhpY0NvbXBhdGliaWxpdHkuYWdlQ29tcGF0aWJpbGl0eSxcbiAgICAgICAgICBnZW5kZXJDb21wYXRpYmlsaXR5U2NvcmU6XG4gICAgICAgICAgICBjb21wYXRpYmlsaXR5LmRlbW9ncmFwaGljQ29tcGF0aWJpbGl0eS5nZW5kZXJDb21wYXRpYmlsaXR5LFxuICAgICAgICAgIGxhbmd1YWdlQ29tcGF0aWJpbGl0eVNjb3JlOlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5kZW1vZ3JhcGhpY0NvbXBhdGliaWxpdHkubGFuZ3VhZ2VDb21wYXRpYmlsaXR5LFxuICAgICAgICAgIHN0cmVuZ3RoczogY29tcGF0aWJpbGl0eS5jb21wYXRpYmlsaXR5RmFjdG9ycy5zdHJlbmd0aHMsXG4gICAgICAgICAgY29uY2VybnM6IGNvbXBhdGliaWxpdHkuY29tcGF0aWJpbGl0eUZhY3RvcnMuY29uY2VybnMsXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBjb21wYXRpYmlsaXR5LmNvbXBhdGliaWxpdHlGYWN0b3JzLnJlY29tbWVuZGF0aW9ucyxcbiAgICAgICAgICBhbmFseXNpc1ZlcnNpb24sXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICBjbGllbnRJZCxcbiAgICAgICAgICB0aGVyYXBpc3RJZCxcbiAgICAgICAgICBwZXJzb25hbGl0eUNvbXBhdGliaWxpdHk6XG4gICAgICAgICAgICBjb21wYXRpYmlsaXR5LnBlcnNvbmFsaXR5Q29tcGF0aWJpbGl0eS5vdmVyYWxsQ29tcGF0aWJpbGl0eSxcbiAgICAgICAgICBzZXNzaW9uQ29tcGF0aWJpbGl0eTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkub3ZlcmFsbENvbXBhdGliaWxpdHksXG4gICAgICAgICAgZGVtb2dyYXBoaWNDb21wYXRpYmlsaXR5OlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5kZW1vZ3JhcGhpY0NvbXBhdGliaWxpdHkub3ZlcmFsbENvbXBhdGliaWxpdHksXG4gICAgICAgICAgb3ZlcmFsbENvbXBhdGliaWxpdHk6IGNvbXBhdGliaWxpdHkub3ZlcmFsbENvbXBhdGliaWxpdHlTY29yZSxcbiAgICAgICAgICBjb21tdW5pY2F0aW9uU3R5bGVTY29yZTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkucGVyc29uYWxpdHlDb21wYXRpYmlsaXR5LmNvbW11bmljYXRpb25TdHlsZSxcbiAgICAgICAgICBwZXJzb25hbGl0eU1hdGNoU2NvcmU6XG4gICAgICAgICAgICBjb21wYXRpYmlsaXR5LnBlcnNvbmFsaXR5Q29tcGF0aWJpbGl0eS5wZXJzb25hbGl0eU1hdGNoLFxuICAgICAgICAgIGN1bHR1cmFsQ29tcGF0aWJpbGl0eVNjb3JlOlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5wZXJzb25hbGl0eUNvbXBhdGliaWxpdHkuY3VsdHVyYWxDb21wYXRpYmlsaXR5LFxuICAgICAgICAgIGZvcm1hdE1hdGNoU2NvcmU6IGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkuZm9ybWF0TWF0Y2gsXG4gICAgICAgICAgZHVyYXRpb25NYXRjaFNjb3JlOiBjb21wYXRpYmlsaXR5LnNlc3Npb25Db21wYXRpYmlsaXR5LmR1cmF0aW9uTWF0Y2gsXG4gICAgICAgICAgZnJlcXVlbmN5TWF0Y2hTY29yZTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkuZnJlcXVlbmN5TWF0Y2gsXG4gICAgICAgICAgc2NoZWR1bGluZ0NvbXBhdGliaWxpdHlTY29yZTpcbiAgICAgICAgICAgIGNvbXBhdGliaWxpdHkuc2Vzc2lvbkNvbXBhdGliaWxpdHkuc2NoZWR1bGluZ0NvbXBhdGliaWxpdHksXG4gICAgICAgICAgYWdlQ29tcGF0aWJpbGl0eVNjb3JlOlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5kZW1vZ3JhcGhpY0NvbXBhdGliaWxpdHkuYWdlQ29tcGF0aWJpbGl0eSxcbiAgICAgICAgICBnZW5kZXJDb21wYXRpYmlsaXR5U2NvcmU6XG4gICAgICAgICAgICBjb21wYXRpYmlsaXR5LmRlbW9ncmFwaGljQ29tcGF0aWJpbGl0eS5nZW5kZXJDb21wYXRpYmlsaXR5LFxuICAgICAgICAgIGxhbmd1YWdlQ29tcGF0aWJpbGl0eVNjb3JlOlxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eS5kZW1vZ3JhcGhpY0NvbXBhdGliaWxpdHkubGFuZ3VhZ2VDb21wYXRpYmlsaXR5LFxuICAgICAgICAgIHN0cmVuZ3RoczogY29tcGF0aWJpbGl0eS5jb21wYXRpYmlsaXR5RmFjdG9ycy5zdHJlbmd0aHMsXG4gICAgICAgICAgY29uY2VybnM6IGNvbXBhdGliaWxpdHkuY29tcGF0aWJpbGl0eUZhY3RvcnMuY29uY2VybnMsXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBjb21wYXRpYmlsaXR5LmNvbXBhdGliaWxpdHlGYWN0b3JzLnJlY29tbWVuZGF0aW9ucyxcbiAgICAgICAgICBhbmFseXNpc1ZlcnNpb24sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHRyYWNrIGNvbXBhdGliaWxpdHkgYW5hbHlzaXM6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFjayB3aGVuIGEgdXNlciB2aWV3cyBhIHRoZXJhcGlzdCByZWNvbW1lbmRhdGlvblxuICAgKi9cbiAgYXN5bmMgdHJhY2tSZWNvbW1lbmRhdGlvblZpZXcoXG4gICAgY2xpZW50SWQ6IHN0cmluZyxcbiAgICB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEubWF0Y2hIaXN0b3J5LnVwZGF0ZU1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNsaWVudElkLFxuICAgICAgICAgIHRoZXJhcGlzdElkLFxuICAgICAgICAgIHdhc1ZpZXdlZDogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3YXNWaWV3ZWQ6IHRydWUsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB0cmFjayByZWNvbW1lbmRhdGlvbiB2aWV3OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVHJhY2sgd2hlbiBhIHVzZXIgY29udGFjdHMgYSB0aGVyYXBpc3RcbiAgICovXG4gIGFzeW5jIHRyYWNrVGhlcmFwaXN0Q29udGFjdChcbiAgICBjbGllbnRJZDogc3RyaW5nLFxuICAgIHRoZXJhcGlzdElkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkudXBkYXRlTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2xpZW50SWQsXG4gICAgICAgICAgdGhlcmFwaXN0SWQsXG4gICAgICAgICAgd2FzQ29udGFjdGVkOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHdhc0NvbnRhY3RlZDogdHJ1ZSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHRyYWNrIHRoZXJhcGlzdCBjb250YWN0OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVHJhY2sgd2hlbiBhIHJlY29tbWVuZGF0aW9uIGJlY29tZXMgYW4gYWN0dWFsIGNsaWVudC10aGVyYXBpc3QgcmVsYXRpb25zaGlwXG4gICAqL1xuICBhc3luYyB0cmFja1N1Y2Nlc3NmdWxNYXRjaChcbiAgICBjbGllbnRJZDogc3RyaW5nLFxuICAgIHRoZXJhcGlzdElkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkudXBkYXRlTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2xpZW50SWQsXG4gICAgICAgICAgdGhlcmFwaXN0SWQsXG4gICAgICAgICAgYmVjYW1lQ2xpZW50OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGJlY2FtZUNsaWVudDogdHJ1ZSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHRyYWNrIHN1Y2Nlc3NmdWwgbWF0Y2g6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFjayByZWNvbW1lbmRhdGlvbiBmZWVkYmFjayBmcm9tIHVzZXJzXG4gICAqL1xuICBhc3luYyByZWNvcmRSZWNvbW1lbmRhdGlvbkZlZWRiYWNrKFxuICAgIGNsaWVudElkOiBzdHJpbmcsXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICBmZWVkYmFjazoge1xuICAgICAgcmVsZXZhbmNlU2NvcmU6IG51bWJlcjtcbiAgICAgIGFjY3VyYWN5U2NvcmU6IG51bWJlcjtcbiAgICAgIGhlbHBmdWxuZXNzU2NvcmU6IG51bWJlcjtcbiAgICAgIGZlZWRiYWNrVGV4dD86IHN0cmluZztcbiAgICAgIHNlbGVjdGVkVGhlcmFwaXN0PzogYm9vbGVhbjtcbiAgICAgIHJlYXNvbk5vdFNlbGVjdGVkPzogc3RyaW5nO1xuICAgIH0sXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtYXRjaEhpc3RvcnkgPSBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHsgY2xpZW50SWQsIHRoZXJhcGlzdElkIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5yZWNvbW1lbmRhdGlvbkZlZWRiYWNrLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBjbGllbnRJZCxcbiAgICAgICAgICB0aGVyYXBpc3RJZCxcbiAgICAgICAgICBtYXRjaEhpc3RvcnlJZDogbWF0Y2hIaXN0b3J5Py5pZCxcbiAgICAgICAgICByZWxldmFuY2VTY29yZTogZmVlZGJhY2sucmVsZXZhbmNlU2NvcmUsXG4gICAgICAgICAgYWNjdXJhY3lTY29yZTogZmVlZGJhY2suYWNjdXJhY3lTY29yZSxcbiAgICAgICAgICBoZWxwZnVsbmVzc1Njb3JlOiBmZWVkYmFjay5oZWxwZnVsbmVzc1Njb3JlLFxuICAgICAgICAgIGZlZWRiYWNrVGV4dDogZmVlZGJhY2suZmVlZGJhY2tUZXh0LFxuICAgICAgICAgIHNlbGVjdGVkVGhlcmFwaXN0OiBmZWVkYmFjay5zZWxlY3RlZFRoZXJhcGlzdCB8fCBmYWxzZSxcbiAgICAgICAgICByZWFzb25Ob3RTZWxlY3RlZDogZmVlZGJhY2sucmVhc29uTm90U2VsZWN0ZWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHJlY29yZCByZWNvbW1lbmRhdGlvbiBmZWVkYmFjazonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGdvcml0aG0gcGVyZm9ybWFuY2UgbWV0cmljcyBmb3IgYSB0aW1lIHBlcmlvZFxuICAgKi9cbiAgYXN5bmMgZ2V0QWxnb3JpdGhtUGVyZm9ybWFuY2UoXG4gICAgYWxnb3JpdGhtTmFtZTogc3RyaW5nLFxuICAgIHN0YXJ0RGF0ZTogRGF0ZSxcbiAgICBlbmREYXRlOiBEYXRlLFxuICApOiBQcm9taXNlPE1hdGNoaW5nTWV0cmljcz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtYXRjaEhpc3RvcnkgPSBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHJlY29tbWVuZGF0aW9uQWxnb3JpdGhtOiBhbGdvcml0aG1OYW1lLFxuICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgZ3RlOiBzdGFydERhdGUsXG4gICAgICAgICAgICBsdGU6IGVuZERhdGUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b3RhbFJlY29tbWVuZGF0aW9ucyA9IG1hdGNoSGlzdG9yeS5sZW5ndGg7XG4gICAgICBjb25zdCBzdWNjZXNzZnVsTWF0Y2hlcyA9IG1hdGNoSGlzdG9yeS5maWx0ZXIoXG4gICAgICAgIChtKSA9PiBtLmJlY2FtZUNsaWVudCxcbiAgICAgICkubGVuZ3RoO1xuICAgICAgY29uc3Qgdmlld2VkUmVjb21tZW5kYXRpb25zID0gbWF0Y2hIaXN0b3J5LmZpbHRlcihcbiAgICAgICAgKG0pID0+IG0ud2FzVmlld2VkLFxuICAgICAgKS5sZW5ndGg7XG4gICAgICBjb25zdCBjb250YWN0ZWRUaGVyYXBpc3RzID0gbWF0Y2hIaXN0b3J5LmZpbHRlcihcbiAgICAgICAgKG0pID0+IG0ud2FzQ29udGFjdGVkLFxuICAgICAgKS5sZW5ndGg7XG5cbiAgICAgIGNvbnN0IGF2ZXJhZ2VNYXRjaFNjb3JlID1cbiAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnMgPiAwXG4gICAgICAgICAgPyBtYXRjaEhpc3RvcnkucmVkdWNlKChzdW0sIG0pID0+IHN1bSArIG0udG90YWxTY29yZSwgMCkgL1xuICAgICAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnNcbiAgICAgICAgICA6IDA7XG5cbiAgICAgIC8vIEdldCBzYXRpc2ZhY3Rpb24gc2NvcmVzIGZyb20gZmVlZGJhY2tcbiAgICAgIGNvbnN0IGZlZWRiYWNrRGF0YSA9IGF3YWl0IHRoaXMucHJpc21hLnJlY29tbWVuZGF0aW9uRmVlZGJhY2suZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgZ3RlOiBzdGFydERhdGUsXG4gICAgICAgICAgICBsdGU6IGVuZERhdGUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdmVyYWxsU2F0aXNmYWN0aW9uOiB7XG4gICAgICAgICAgICBub3Q6IG51bGwsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBhdmVyYWdlU2F0aXNmYWN0aW9uU2NvcmUgPVxuICAgICAgICBmZWVkYmFja0RhdGEubGVuZ3RoID4gMFxuICAgICAgICAgID8gZmVlZGJhY2tEYXRhLnJlZHVjZShcbiAgICAgICAgICAgICAgKHN1bSwgZikgPT4gc3VtICsgKGYub3ZlcmFsbFNhdGlzZmFjdGlvbiB8fCAwKSxcbiAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICkgLyBmZWVkYmFja0RhdGEubGVuZ3RoXG4gICAgICAgICAgOiAwO1xuXG4gICAgICBjb25zdCBjbGlja1Rocm91Z2hSYXRlID1cbiAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnMgPiAwXG4gICAgICAgICAgPyAodmlld2VkUmVjb21tZW5kYXRpb25zIC8gdG90YWxSZWNvbW1lbmRhdGlvbnMpICogMTAwXG4gICAgICAgICAgOiAwO1xuXG4gICAgICBjb25zdCBjb252ZXJzaW9uUmF0ZSA9XG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zID4gMFxuICAgICAgICAgID8gKHN1Y2Nlc3NmdWxNYXRjaGVzIC8gdG90YWxSZWNvbW1lbmRhdGlvbnMpICogMTAwXG4gICAgICAgICAgOiAwO1xuXG4gICAgICAvLyBSZXRlbnRpb24gcmF0ZSBjYWxjdWxhdGlvbiB3b3VsZCByZXF1aXJlIHNlc3Npb24gZGF0YVxuICAgICAgY29uc3QgcmV0ZW50aW9uUmF0ZSA9IDA7IC8vIFBsYWNlaG9sZGVyIC0gaW1wbGVtZW50IGJhc2VkIG9uIHNlc3Npb24gdHJhY2tpbmdcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnMsXG4gICAgICAgIHN1Y2Nlc3NmdWxNYXRjaGVzLFxuICAgICAgICBhdmVyYWdlTWF0Y2hTY29yZSxcbiAgICAgICAgYXZlcmFnZVNhdGlzZmFjdGlvblNjb3JlLFxuICAgICAgICBjbGlja1Rocm91Z2hSYXRlLFxuICAgICAgICBjb252ZXJzaW9uUmF0ZSxcbiAgICAgICAgcmV0ZW50aW9uUmF0ZSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgYWxnb3JpdGhtIHBlcmZvcm1hbmNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBhbGdvcml0aG0gcGVyZm9ybWFuY2Ugc25hcHNob3RcbiAgICovXG4gIGFzeW5jIHN0b3JlUGVyZm9ybWFuY2VTbmFwc2hvdChcbiAgICBhbGdvcml0aG1OYW1lOiBzdHJpbmcsXG4gICAgdmVyc2lvbjogc3RyaW5nLFxuICAgIG1ldHJpY3M6IE1hdGNoaW5nTWV0cmljcyxcbiAgICBwZXJpb2RTdGFydDogRGF0ZSxcbiAgICBwZXJpb2RFbmQ6IERhdGUsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5hbGdvcml0aG1QZXJmb3JtYW5jZS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgYWxnb3JpdGhtTmFtZSxcbiAgICAgICAgICB2ZXJzaW9uLFxuICAgICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zOiBtZXRyaWNzLnRvdGFsUmVjb21tZW5kYXRpb25zLFxuICAgICAgICAgIHN1Y2Nlc3NmdWxNYXRjaGVzOiBtZXRyaWNzLnN1Y2Nlc3NmdWxNYXRjaGVzLFxuICAgICAgICAgIGF2ZXJhZ2VNYXRjaFNjb3JlOiBtZXRyaWNzLmF2ZXJhZ2VNYXRjaFNjb3JlLFxuICAgICAgICAgIGF2ZXJhZ2VTYXRpc2ZhY3Rpb25TY29yZTogbWV0cmljcy5hdmVyYWdlU2F0aXNmYWN0aW9uU2NvcmUsXG4gICAgICAgICAgY2xpY2tUaHJvdWdoUmF0ZTogbWV0cmljcy5jbGlja1Rocm91Z2hSYXRlLFxuICAgICAgICAgIGNvbnZlcnNpb25SYXRlOiBtZXRyaWNzLmNvbnZlcnNpb25SYXRlLFxuICAgICAgICAgIHJldGVudGlvblJhdGU6IG1ldHJpY3MucmV0ZW50aW9uUmF0ZSxcbiAgICAgICAgICBwZXJpb2RTdGFydCxcbiAgICAgICAgICBwZXJpb2RFbmQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHN0b3JlIHBlcmZvcm1hbmNlIHNuYXBzaG90OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRvcCBwZXJmb3JtaW5nIHRoZXJhcGlzdHMgYnkgcmVjb21tZW5kYXRpb24gc3VjY2Vzc1xuICAgKi9cbiAgYXN5bmMgZ2V0VG9wUGVyZm9ybWluZ1RoZXJhcGlzdHMoXG4gICAgbGltaXQ6IG51bWJlciA9IDEwLFxuICAgIHN0YXJ0RGF0ZT86IERhdGUsXG4gICAgZW5kRGF0ZT86IERhdGUsXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB3aGVyZUNsYXVzZTogYW55ID0ge1xuICAgICAgICBiZWNhbWVDbGllbnQ6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBpZiAoc3RhcnREYXRlICYmIGVuZERhdGUpIHtcbiAgICAgICAgd2hlcmVDbGF1c2UuY3JlYXRlZEF0ID0ge1xuICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgICAgIGx0ZTogZW5kRGF0ZSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG9wVGhlcmFwaXN0cyA9IGF3YWl0IHRoaXMucHJpc21hLm1hdGNoSGlzdG9yeS5ncm91cEJ5KHtcbiAgICAgICAgYnk6IFsndGhlcmFwaXN0SWQnXSxcbiAgICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgX2F2Zzoge1xuICAgICAgICAgIHRvdGFsU2NvcmU6IHRydWUsXG4gICAgICAgICAgY2xpZW50U2F0aXNmYWN0aW9uU2NvcmU6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIGlkOiAnZGVzYycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdGFrZTogbGltaXQsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW5yaWNoIHdpdGggdGhlcmFwaXN0IGRhdGFcbiAgICAgIGNvbnN0IGVucmljaGVkRGF0YSA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICB0b3BUaGVyYXBpc3RzLm1hcChhc3luYyAodGhlcmFwaXN0KSA9PiB7XG4gICAgICAgICAgY29uc3QgdGhlcmFwaXN0RGF0YSA9IGF3YWl0IHRoaXMucHJpc21hLnRoZXJhcGlzdC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IHVzZXJJZDogdGhlcmFwaXN0LnRoZXJhcGlzdElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7IHVzZXI6IHRydWUgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aGVyYXBpc3Q6IHRoZXJhcGlzdERhdGEsXG4gICAgICAgICAgICBzdWNjZXNzZnVsTWF0Y2hlczogdGhlcmFwaXN0Ll9jb3VudC5pZCxcbiAgICAgICAgICAgIGF2ZXJhZ2VNYXRjaFNjb3JlOiB0aGVyYXBpc3QuX2F2Zy50b3RhbFNjb3JlIHx8IDAsXG4gICAgICAgICAgICBhdmVyYWdlU2F0aXNmYWN0aW9uU2NvcmU6XG4gICAgICAgICAgICAgIHRoZXJhcGlzdC5fYXZnLmNsaWVudFNhdGlzZmFjdGlvblNjb3JlIHx8IDAsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSksXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gZW5yaWNoZWREYXRhO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHRvcCBwZXJmb3JtaW5nIHRoZXJhcGlzdHM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtYXRjaGluZyBpbnNpZ2h0cyBmb3IgaW1wcm92aW5nIHRoZSBhbGdvcml0aG1cbiAgICovXG4gIGFzeW5jIGdldE1hdGNoaW5nSW5zaWdodHMoc3RhcnREYXRlOiBEYXRlLCBlbmREYXRlOiBEYXRlKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIE1vc3Qgc3VjY2Vzc2Z1bCBjb25kaXRpb24gbWF0Y2hlc1xuICAgICAgY29uc3QgY29uZGl0aW9uTWF0Y2hlcyA9IGF3YWl0IHRoaXMucHJpc21hLm1hdGNoSGlzdG9yeS5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgYmVjYW1lQ2xpZW50OiB0cnVlLFxuICAgICAgICAgIGNyZWF0ZWRBdDoge1xuICAgICAgICAgICAgZ3RlOiBzdGFydERhdGUsXG4gICAgICAgICAgICBsdGU6IGVuZERhdGUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgcHJpbWFyeU1hdGNoZXM6IHRydWUsXG4gICAgICAgICAgc2Vjb25kYXJ5TWF0Y2hlczogdHJ1ZSxcbiAgICAgICAgICB0b3RhbFNjb3JlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIE1vc3Qgc3VjY2Vzc2Z1bCBhcHByb2FjaCBtYXRjaGVzXG4gICAgICBjb25zdCBhcHByb2FjaE1hdGNoZXMgPSBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGJlY2FtZUNsaWVudDogdHJ1ZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgICAgICAgbHRlOiBlbmREYXRlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGFwcHJvYWNoTWF0Y2hlczogdHJ1ZSxcbiAgICAgICAgICB0b3RhbFNjb3JlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNjb3JlIGRpc3RyaWJ1dGlvbiBhbmFseXNpc1xuICAgICAgY29uc3Qgc2NvcmVEaXN0cmlidXRpb24gPSBhd2FpdCB0aGlzLnByaXNtYS5tYXRjaEhpc3RvcnkuZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3RvdGFsU2NvcmUnXSxcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgICAgICAgbHRlOiBlbmREYXRlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIF9jb3VudDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgdG90YWxTY29yZTogJ2FzYycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29uZGl0aW9uTWF0Y2hlcyxcbiAgICAgICAgYXBwcm9hY2hNYXRjaGVzLFxuICAgICAgICBzY29yZURpc3RyaWJ1dGlvbixcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgbWF0Y2hpbmcgaW5zaWdodHM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=