d2de4f386f10eebf9264492d8a9cd84b
"use strict";
/**
 * Comprehensive Test Suite for MeetingsController
 * Tests meeting management, video room functionality, and session handling
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const meetings_controller_1 = require("./meetings.controller");
const meetings_service_1 = require("./meetings.service");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const enhanced_test_helpers_1 = require("../test-utils/enhanced-test-helpers");
const index_1 = require("../test-utils/index");
describe('MeetingsController', () => {
    let controller;
    let meetingsService;
    let module;
    // Mock MeetingsService
    const mockMeetingsService = {
        getMeetingById: jest.fn(),
        updateMeetingStatus: jest.fn(),
        createVideoRoom: jest.fn(),
        joinVideoRoom: jest.fn(),
        getVideoCallStatus: jest.fn(),
        endVideoCall: jest.fn(),
        getUpcomingMeetings: jest.fn(),
        saveMeetingSession: jest.fn(),
        getMeetingAnalytics: jest.fn(),
        emergencyTerminateMeeting: jest.fn(),
    };
    // Mock JwtAuthGuard
    const mockJwtAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    // Test data
    const mockMeeting = {
        id: 'meeting_123456789',
        title: 'Therapy Session',
        description: 'Initial consultation session',
        startTime: new Date('2024-02-15T10:00:00Z'),
        endTime: new Date('2024-02-15T11:00:00Z'),
        status: 'scheduled',
        clientId: index_1.TEST_USER_IDS.CLIENT,
        therapistId: index_1.TEST_USER_IDS.THERAPIST,
        meetingType: 'video',
        duration: 60,
        isEmergency: false,
        notes: '',
        recordingEnabled: false,
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockVideoRoomResponse = {
        roomId: 'room_abc123456789',
        roomUrl: 'https://video.example.com/room/abc123456789',
        token: 'video_token_xyz987654321',
        meetingId: mockMeeting.id,
        participantId: 'participant_123',
        expiresAt: new Date(Date.now() + 3600000), // 1 hour from now
        roomSettings: {
            maxParticipants: 2,
            enableRecording: false,
            enableChat: true,
            enableScreenShare: true,
        },
    };
    const mockVideoCallStatus = {
        meetingId: mockMeeting.id,
        status: 'active',
        roomId: 'room_abc123456789',
        participants: [
            {
                userId: index_1.TEST_USER_IDS.CLIENT,
                name: 'Client User',
                role: 'client',
                joinedAt: new Date(),
                isAudioEnabled: true,
                isVideoEnabled: true,
            },
            {
                userId: index_1.TEST_USER_IDS.THERAPIST,
                name: 'Dr. Therapist',
                role: 'therapist',
                joinedAt: new Date(),
                isAudioEnabled: true,
                isVideoEnabled: true,
            },
        ],
        duration: 1800, // 30 minutes
        startedAt: new Date(Date.now() - 1800000),
    };
    const mockUpcomingMeetings = [
        mockMeeting,
        {
            ...mockMeeting,
            id: 'meeting_987654321',
            title: 'Follow-up Session',
            startTime: new Date('2024-02-16T14:00:00Z'),
            endTime: new Date('2024-02-16T15:00:00Z'),
        },
    ];
    const mockMeetingAnalytics = {
        totalMeetings: 25,
        completedMeetings: 23,
        cancelledMeetings: 2,
        averageDuration: 55.8,
        totalDuration: 1395,
        meetingsByType: {
            video: 20,
            audio: 3,
            inPerson: 2,
        },
        monthlyStats: [
            { month: '2024-01', count: 12, duration: 720 },
            { month: '2024-02', count: 13, duration: 675 },
        ],
        clientRetention: 92.5,
        averageRating: 4.8,
    };
    beforeEach(async () => {
        module = await testing_1.Test.createTestingModule({
            controllers: [meetings_controller_1.MeetingsController],
            providers: [
                {
                    provide: meetings_service_1.MeetingsService,
                    useValue: mockMeetingsService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .compile();
        controller = module.get(meetings_controller_1.MeetingsController);
        meetingsService = module.get(meetings_service_1.MeetingsService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Controller Initialization', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have meetingsService injected', () => {
            expect(meetingsService).toBeDefined();
        });
    });
    describe('Security Guards', () => {
        it('should be protected by JwtAuthGuard', () => {
            const guards = Reflect.getMetadata('__guards__', meetings_controller_1.MeetingsController);
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
        });
        it('should have proper route decorators', () => {
            const controllerMetadata = Reflect.getMetadata('path', meetings_controller_1.MeetingsController);
            expect(controllerMetadata).toBe('meetings');
        });
    });
    describe('GET /meetings/:id', () => {
        const meetingId = 'meeting_123456789';
        it('should get meeting by id successfully', async () => {
            mockMeetingsService.getMeetingById.mockResolvedValue(mockMeeting);
            const result = await controller.getMeeting(meetingId, index_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockMeeting);
            expect(meetingsService.getMeetingById).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.CLIENT);
        });
        it('should handle meeting not found', async () => {
            const notFoundError = new common_1.NotFoundException('Meeting not found');
            mockMeetingsService.getMeetingById.mockRejectedValue(notFoundError);
            await expect(controller.getMeeting('non-existent-id', index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(notFoundError);
        });
        it('should handle access denied', async () => {
            const forbiddenError = new common_1.ForbiddenException('Access denied to meeting');
            mockMeetingsService.getMeetingById.mockRejectedValue(forbiddenError);
            await expect(controller.getMeeting(meetingId, 'unauthorized-user')).rejects.toThrow(forbiddenError);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database connection failed');
            mockMeetingsService.getMeetingById.mockRejectedValue(serviceError);
            await expect(controller.getMeeting(meetingId, index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(serviceError);
        });
    });
    describe('PUT /meetings/:id/status', () => {
        const meetingId = 'meeting_123456789';
        const updateStatusDto = {
            status: 'in-progress',
            notes: 'Meeting started on time',
        };
        it('should update meeting status successfully', async () => {
            const updatedMeeting = { ...mockMeeting, status: 'in-progress', notes: updateStatusDto.notes };
            mockMeetingsService.updateMeetingStatus.mockResolvedValue(updatedMeeting);
            const result = await controller.updateMeetingStatus(meetingId, index_1.TEST_USER_IDS.THERAPIST, updateStatusDto);
            expect(result).toEqual(updatedMeeting);
            expect(meetingsService.updateMeetingStatus).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST, updateStatusDto);
        });
        it('should handle all valid status transitions', async () => {
            const statusOptions = ['scheduled', 'in-progress', 'completed', 'cancelled', 'no-show'];
            for (const status of statusOptions) {
                const dto = { status, notes: `Status changed to ${status}` };
                const updatedMeeting = { ...mockMeeting, status };
                mockMeetingsService.updateMeetingStatus.mockResolvedValue(updatedMeeting);
                const result = await controller.updateMeetingStatus(meetingId, index_1.TEST_USER_IDS.THERAPIST, dto);
                expect(result.status).toBe(status);
            }
        });
        it('should handle meeting not found', async () => {
            const notFoundError = new common_1.NotFoundException('Meeting not found');
            mockMeetingsService.updateMeetingStatus.mockRejectedValue(notFoundError);
            await expect(controller.updateMeetingStatus(meetingId, index_1.TEST_USER_IDS.THERAPIST, updateStatusDto)).rejects.toThrow(notFoundError);
        });
        it('should handle unauthorized status update', async () => {
            const forbiddenError = new common_1.ForbiddenException('Only therapist can update meeting status');
            mockMeetingsService.updateMeetingStatus.mockRejectedValue(forbiddenError);
            await expect(controller.updateMeetingStatus(meetingId, index_1.TEST_USER_IDS.CLIENT, updateStatusDto)).rejects.toThrow(forbiddenError);
        });
        it('should handle validation errors', async () => {
            const validationError = new common_1.BadRequestException('Invalid status value');
            mockMeetingsService.updateMeetingStatus.mockRejectedValue(validationError);
            await expect(controller.updateMeetingStatus(meetingId, index_1.TEST_USER_IDS.THERAPIST, { status: 'invalid-status' })).rejects.toThrow(validationError);
        });
    });
    describe('POST /meetings/:id/video-room', () => {
        const meetingId = 'meeting_123456789';
        const createRoomDto = {
            meetingId,
            roomType: 'video',
            maxParticipants: 2,
            enableRecording: false,
            enableChat: true,
        };
        it('should create video room successfully', async () => {
            mockMeetingsService.createVideoRoom.mockResolvedValue(mockVideoRoomResponse);
            const result = await controller.createVideoRoom(meetingId, index_1.TEST_USER_IDS.THERAPIST, createRoomDto);
            expect(result).toEqual(mockVideoRoomResponse);
            expect(meetingsService.createVideoRoom).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST, createRoomDto);
        });
        it('should handle room creation with different settings', async () => {
            const customDto = {
                ...createRoomDto,
                maxParticipants: 4,
                enableRecording: true,
                enableChat: false,
            };
            const customResponse = {
                ...mockVideoRoomResponse,
                roomSettings: {
                    maxParticipants: 4,
                    enableRecording: true,
                    enableChat: false,
                    enableScreenShare: true,
                },
            };
            mockMeetingsService.createVideoRoom.mockResolvedValue(customResponse);
            const result = await controller.createVideoRoom(meetingId, index_1.TEST_USER_IDS.THERAPIST, customDto);
            expect(result.roomSettings.maxParticipants).toBe(4);
            expect(result.roomSettings.enableRecording).toBe(true);
            expect(result.roomSettings.enableChat).toBe(false);
        });
        it('should handle meeting not found', async () => {
            const notFoundError = new common_1.NotFoundException('Meeting not found');
            mockMeetingsService.createVideoRoom.mockRejectedValue(notFoundError);
            await expect(controller.createVideoRoom('non-existent-id', index_1.TEST_USER_IDS.THERAPIST, createRoomDto)).rejects.toThrow(notFoundError);
        });
        it('should handle video service unavailable', async () => {
            const serviceError = new Error('Video service temporarily unavailable');
            mockMeetingsService.createVideoRoom.mockRejectedValue(serviceError);
            await expect(controller.createVideoRoom(meetingId, index_1.TEST_USER_IDS.THERAPIST, createRoomDto)).rejects.toThrow(serviceError);
        });
        it('should handle duplicate room creation', async () => {
            const duplicateError = new common_1.BadRequestException('Video room already exists for this meeting');
            mockMeetingsService.createVideoRoom.mockRejectedValue(duplicateError);
            await expect(controller.createVideoRoom(meetingId, index_1.TEST_USER_IDS.THERAPIST, createRoomDto)).rejects.toThrow(duplicateError);
        });
    });
    describe('POST /meetings/:id/join-video', () => {
        const meetingId = 'meeting_123456789';
        const joinRoomDto = {
            roomId: 'room_abc123456789',
            participantName: 'Client User',
            audioEnabled: true,
            videoEnabled: true,
        };
        it('should join video room successfully', async () => {
            mockMeetingsService.joinVideoRoom.mockResolvedValue(mockVideoRoomResponse);
            const result = await controller.joinVideoRoom(meetingId, index_1.TEST_USER_IDS.CLIENT, joinRoomDto);
            expect(result).toEqual(mockVideoRoomResponse);
            expect(meetingsService.joinVideoRoom).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.CLIENT, joinRoomDto);
        });
        it('should handle joining with different media settings', async () => {
            const audioOnlyDto = {
                ...joinRoomDto,
                audioEnabled: true,
                videoEnabled: false,
            };
            mockMeetingsService.joinVideoRoom.mockResolvedValue(mockVideoRoomResponse);
            const result = await controller.joinVideoRoom(meetingId, index_1.TEST_USER_IDS.CLIENT, audioOnlyDto);
            expect(result).toEqual(mockVideoRoomResponse);
            expect(meetingsService.joinVideoRoom).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.CLIENT, audioOnlyDto);
        });
        it('should handle room not found', async () => {
            const notFoundError = new common_1.NotFoundException('Video room not found');
            mockMeetingsService.joinVideoRoom.mockRejectedValue(notFoundError);
            await expect(controller.joinVideoRoom(meetingId, index_1.TEST_USER_IDS.CLIENT, joinRoomDto)).rejects.toThrow(notFoundError);
        });
        it('should handle room capacity exceeded', async () => {
            const capacityError = new common_1.BadRequestException('Room capacity exceeded');
            mockMeetingsService.joinVideoRoom.mockRejectedValue(capacityError);
            await expect(controller.joinVideoRoom(meetingId, index_1.TEST_USER_IDS.CLIENT, joinRoomDto)).rejects.toThrow(capacityError);
        });
        it('should handle participant already in room', async () => {
            const duplicateError = new common_1.BadRequestException('Participant already in room');
            mockMeetingsService.joinVideoRoom.mockRejectedValue(duplicateError);
            await expect(controller.joinVideoRoom(meetingId, index_1.TEST_USER_IDS.CLIENT, joinRoomDto)).rejects.toThrow(duplicateError);
        });
    });
    describe('GET /meetings/:id/video-status', () => {
        const meetingId = 'meeting_123456789';
        it('should get video call status successfully', async () => {
            mockMeetingsService.getVideoCallStatus.mockResolvedValue(mockVideoCallStatus);
            const result = await controller.getVideoCallStatus(meetingId, index_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockVideoCallStatus);
            expect(meetingsService.getVideoCallStatus).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.CLIENT);
        });
        it('should handle video call not active', async () => {
            const inactiveStatus = {
                ...mockVideoCallStatus,
                status: 'ended',
                participants: [],
                duration: 3600,
            };
            mockMeetingsService.getVideoCallStatus.mockResolvedValue(inactiveStatus);
            const result = await controller.getVideoCallStatus(meetingId, index_1.TEST_USER_IDS.CLIENT);
            expect(result.status).toBe('ended');
            expect(result.participants).toHaveLength(0);
        });
        it('should handle meeting not found', async () => {
            const notFoundError = new common_1.NotFoundException('Meeting not found');
            mockMeetingsService.getVideoCallStatus.mockRejectedValue(notFoundError);
            await expect(controller.getVideoCallStatus('non-existent-id', index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(notFoundError);
        });
        it('should handle no video room for meeting', async () => {
            const noRoomError = new common_1.NotFoundException('No video room found for this meeting');
            mockMeetingsService.getVideoCallStatus.mockRejectedValue(noRoomError);
            await expect(controller.getVideoCallStatus(meetingId, index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(noRoomError);
        });
    });
    describe('DELETE /meetings/:id/video-room', () => {
        const meetingId = 'meeting_123456789';
        const endCallDto = {
            reason: 'session-completed',
            duration: 3600,
            recordingUrl: 'https://recordings.example.com/session_123.mp4',
        };
        it('should end video call successfully', async () => {
            mockMeetingsService.endVideoCall.mockResolvedValue(undefined);
            await controller.endVideoCall(meetingId, index_1.TEST_USER_IDS.THERAPIST, endCallDto);
            expect(meetingsService.endVideoCall).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST, endCallDto);
        });
        it('should handle ending call with different reasons', async () => {
            const reasons = ['session-completed', 'technical-issues', 'emergency', 'participant-left'];
            mockMeetingsService.endVideoCall.mockResolvedValue(undefined);
            for (const reason of reasons) {
                const dto = { ...endCallDto, reason };
                await controller.endVideoCall(meetingId, index_1.TEST_USER_IDS.THERAPIST, dto);
                expect(meetingsService.endVideoCall).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST, dto);
            }
        });
        it('should handle video call not active', async () => {
            const notActiveError = new common_1.BadRequestException('Video call is not active');
            mockMeetingsService.endVideoCall.mockRejectedValue(notActiveError);
            await expect(controller.endVideoCall(meetingId, index_1.TEST_USER_IDS.THERAPIST, endCallDto)).rejects.toThrow(notActiveError);
        });
        it('should handle unauthorized end call', async () => {
            const forbiddenError = new common_1.ForbiddenException('Only meeting participants can end the call');
            mockMeetingsService.endVideoCall.mockRejectedValue(forbiddenError);
            await expect(controller.endVideoCall(meetingId, 'unauthorized-user', endCallDto)).rejects.toThrow(forbiddenError);
        });
    });
    describe('POST /meetings/:id/room (Legacy)', () => {
        const meetingId = 'meeting_123456789';
        it('should generate meeting room using legacy endpoint', async () => {
            mockMeetingsService.createVideoRoom.mockResolvedValue(mockVideoRoomResponse);
            const result = await controller.generateMeetingRoom(meetingId, index_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockVideoRoomResponse);
            expect(meetingsService.createVideoRoom).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST, {
                meetingId,
                roomType: 'video',
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
            });
        });
        it('should handle legacy endpoint errors', async () => {
            const serviceError = new Error('Video service unavailable');
            mockMeetingsService.createVideoRoom.mockRejectedValue(serviceError);
            await expect(controller.generateMeetingRoom(meetingId, index_1.TEST_USER_IDS.THERAPIST)).rejects.toThrow(serviceError);
        });
    });
    describe('GET /meetings/upcoming', () => {
        it('should get upcoming meetings successfully', async () => {
            mockMeetingsService.getUpcomingMeetings.mockResolvedValue(mockUpcomingMeetings);
            const result = await controller.getUpcomingMeetings(index_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual(mockUpcomingMeetings);
            expect(meetingsService.getUpcomingMeetings).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT, undefined);
        });
        it('should get upcoming meetings with limit', async () => {
            const limitedMeetings = [mockUpcomingMeetings[0]];
            mockMeetingsService.getUpcomingMeetings.mockResolvedValue(limitedMeetings);
            const result = await controller.getUpcomingMeetings(index_1.TEST_USER_IDS.CLIENT, 1);
            expect(result).toEqual(limitedMeetings);
            expect(result).toHaveLength(1);
            expect(meetingsService.getUpcomingMeetings).toHaveBeenCalledWith(index_1.TEST_USER_IDS.CLIENT, 1);
        });
        it('should handle no upcoming meetings', async () => {
            mockMeetingsService.getUpcomingMeetings.mockResolvedValue([]);
            const result = await controller.getUpcomingMeetings(index_1.TEST_USER_IDS.CLIENT);
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database query failed');
            mockMeetingsService.getUpcomingMeetings.mockRejectedValue(serviceError);
            await expect(controller.getUpcomingMeetings(index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(serviceError);
        });
    });
    describe('POST /meetings/:id/session', () => {
        const meetingId = 'meeting_123456789';
        const sessionData = {
            duration: 3600,
            notes: 'Productive session with good progress',
            outcomes: ['anxiety-reduced', 'coping-strategies-discussed'],
            nextSteps: 'Continue with breathing exercises',
            clientMood: 'improved',
            therapistNotes: 'Client showed significant improvement',
        };
        it('should save meeting session successfully', async () => {
            const savedSession = {
                id: 'session_123456789',
                meetingId,
                ...sessionData,
                createdAt: new Date(),
            };
            mockMeetingsService.getMeetingById.mockResolvedValue(mockMeeting);
            mockMeetingsService.saveMeetingSession.mockResolvedValue(savedSession);
            const result = await controller.saveMeetingSession(meetingId, index_1.TEST_USER_IDS.THERAPIST, sessionData);
            expect(result).toEqual(savedSession);
            expect(meetingsService.getMeetingById).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST);
            expect(meetingsService.saveMeetingSession).toHaveBeenCalledWith(meetingId, index_1.TEST_USER_IDS.THERAPIST, sessionData);
        });
        it('should validate meeting access before saving session', async () => {
            const forbiddenError = new common_1.ForbiddenException('Access denied to meeting');
            mockMeetingsService.getMeetingById.mockRejectedValue(forbiddenError);
            await expect(controller.saveMeetingSession(meetingId, 'unauthorized-user', sessionData)).rejects.toThrow(forbiddenError);
            expect(meetingsService.saveMeetingSession).not.toHaveBeenCalled();
        });
        it('should handle session data validation errors', async () => {
            const validationError = new common_1.BadRequestException('Invalid session data');
            mockMeetingsService.getMeetingById.mockResolvedValue(mockMeeting);
            mockMeetingsService.saveMeetingSession.mockRejectedValue(validationError);
            await expect(controller.saveMeetingSession(meetingId, index_1.TEST_USER_IDS.THERAPIST, { duration: -1 })).rejects.toThrow(validationError);
        });
    });
    describe('GET /meetings/analytics/therapist', () => {
        it('should get therapist meeting analytics successfully', async () => {
            mockMeetingsService.getMeetingAnalytics.mockResolvedValue(mockMeetingAnalytics);
            const result = await controller.getTherapistMeetingAnalytics(index_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockMeetingAnalytics);
            expect(meetingsService.getMeetingAnalytics).toHaveBeenCalledWith(index_1.TEST_USER_IDS.THERAPIST, undefined);
        });
        it('should get analytics with date range', async () => {
            const startDate = '2024-01-01';
            const endDate = '2024-01-31';
            const dateRangeAnalytics = {
                ...mockMeetingAnalytics,
                totalMeetings: 12,
                monthlyStats: [{ month: '2024-01', count: 12, duration: 720 }],
            };
            mockMeetingsService.getMeetingAnalytics.mockResolvedValue(dateRangeAnalytics);
            const result = await controller.getTherapistMeetingAnalytics(index_1.TEST_USER_IDS.THERAPIST, startDate, endDate);
            expect(result).toEqual(dateRangeAnalytics);
            expect(meetingsService.getMeetingAnalytics).toHaveBeenCalledWith(index_1.TEST_USER_IDS.THERAPIST, {
                start: new Date(startDate),
                end: new Date(endDate),
            });
        });
        it('should handle invalid date format', async () => {
            await expect(controller.getTherapistMeetingAnalytics(index_1.TEST_USER_IDS.THERAPIST, 'invalid-date', '2024-01-31')).rejects.toThrow();
        });
        it('should handle therapist with no meetings', async () => {
            const emptyAnalytics = {
                totalMeetings: 0,
                completedMeetings: 0,
                cancelledMeetings: 0,
                averageDuration: 0,
                totalDuration: 0,
                meetingsByType: { video: 0, audio: 0, inPerson: 0 },
                monthlyStats: [],
                clientRetention: 0,
                averageRating: 0,
            };
            mockMeetingsService.getMeetingAnalytics.mockResolvedValue(emptyAnalytics);
            const result = await controller.getTherapistMeetingAnalytics(index_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(emptyAnalytics);
            expect(result.totalMeetings).toBe(0);
        });
    });
    describe('POST /meetings/:id/emergency-terminate', () => {
        const meetingId = 'meeting_123456789';
        const emergencyData = { reason: 'Medical emergency reported by client' };
        it('should emergency terminate meeting successfully', async () => {
            const terminationResult = {
                meetingId,
                terminatedAt: new Date(),
                reason: emergencyData.reason,
                terminatedBy: index_1.TEST_USER_IDS.THERAPIST,
                emergencyProtocolActivated: true,
            };
            mockMeetingsService.emergencyTerminateMeeting.mockResolvedValue(terminationResult);
            const result = await controller.emergencyTerminate(meetingId, index_1.TEST_USER_IDS.THERAPIST, emergencyData);
            expect(result).toEqual(terminationResult);
            expect(meetingsService.emergencyTerminateMeeting).toHaveBeenCalledWith(meetingId, emergencyData.reason, index_1.TEST_USER_IDS.THERAPIST);
        });
        it('should handle different emergency reasons', async () => {
            const emergencyReasons = [
                'Medical emergency',
                'Safety concern',
                'Technical failure',
                'Inappropriate behavior',
                'System malfunction',
            ];
            for (const reason of emergencyReasons) {
                const data = { reason };
                const terminationResult = {
                    meetingId,
                    terminatedAt: new Date(),
                    reason,
                    terminatedBy: index_1.TEST_USER_IDS.THERAPIST,
                    emergencyProtocolActivated: true,
                };
                mockMeetingsService.emergencyTerminateMeeting.mockResolvedValue(terminationResult);
                const result = await controller.emergencyTerminate(meetingId, index_1.TEST_USER_IDS.THERAPIST, data);
                expect(result.reason).toBe(reason);
            }
        });
        it('should handle meeting not found', async () => {
            const notFoundError = new common_1.NotFoundException('Meeting not found');
            mockMeetingsService.emergencyTerminateMeeting.mockRejectedValue(notFoundError);
            await expect(controller.emergencyTerminate('non-existent-id', index_1.TEST_USER_IDS.THERAPIST, emergencyData)).rejects.toThrow(notFoundError);
        });
        it('should handle meeting already terminated', async () => {
            const alreadyTerminatedError = new common_1.BadRequestException('Meeting already terminated');
            mockMeetingsService.emergencyTerminateMeeting.mockRejectedValue(alreadyTerminatedError);
            await expect(controller.emergencyTerminate(meetingId, index_1.TEST_USER_IDS.THERAPIST, emergencyData)).rejects.toThrow(alreadyTerminatedError);
        });
    });
    describe('Error Handling', () => {
        it('should handle service unavailable scenarios', async () => {
            const serviceError = new Error('Service temporarily unavailable');
            mockMeetingsService.getMeetingById.mockRejectedValue(serviceError);
            await expect(controller.getMeeting('meeting_123', index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(serviceError);
        });
        it('should handle video service integration errors', async () => {
            const videoServiceError = new Error('Video service API timeout');
            mockMeetingsService.createVideoRoom.mockRejectedValue(videoServiceError);
            await expect(controller.createVideoRoom('meeting_123', index_1.TEST_USER_IDS.THERAPIST, {
                meetingId: 'meeting_123',
                roomType: 'video',
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
            })).rejects.toThrow(videoServiceError);
        });
        it('should handle database connection errors', async () => {
            const dbError = new Error('Database connection failed');
            mockMeetingsService.getUpcomingMeetings.mockRejectedValue(dbError);
            await expect(controller.getUpcomingMeetings(index_1.TEST_USER_IDS.CLIENT)).rejects.toThrow(dbError);
        });
    });
    describe('Response Format Validation', () => {
        it('should return properly formatted meeting response', async () => {
            mockMeetingsService.getMeetingById.mockResolvedValue(mockMeeting);
            const result = await controller.getMeeting('meeting_123', index_1.TEST_USER_IDS.CLIENT);
            enhanced_test_helpers_1.TestAssertions.expectValidEntity(result, ['id', 'title', 'startTime', 'endTime', 'status']);
            expect(result.id).toBe(mockMeeting.id);
            expect(typeof result.duration).toBe('number');
            expect(typeof result.isEmergency).toBe('boolean');
        });
        it('should return properly formatted video room response', async () => {
            mockMeetingsService.createVideoRoom.mockResolvedValue(mockVideoRoomResponse);
            const result = await controller.createVideoRoom('meeting_123', index_1.TEST_USER_IDS.THERAPIST, {
                meetingId: 'meeting_123',
                roomType: 'video',
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
            });
            expect(result).toHaveProperty('roomId');
            expect(result).toHaveProperty('roomUrl');
            expect(result).toHaveProperty('token');
            expect(result).toHaveProperty('roomSettings');
            expect(typeof result.roomSettings.maxParticipants).toBe('number');
            expect(typeof result.roomSettings.enableRecording).toBe('boolean');
        });
        it('should return properly formatted analytics response', async () => {
            mockMeetingsService.getMeetingAnalytics.mockResolvedValue(mockMeetingAnalytics);
            const result = await controller.getTherapistMeetingAnalytics(index_1.TEST_USER_IDS.THERAPIST);
            expect(result).toHaveProperty('totalMeetings');
            expect(result).toHaveProperty('completedMeetings');
            expect(result).toHaveProperty('averageDuration');
            expect(result).toHaveProperty('meetingsByType');
            expect(Array.isArray(result.monthlyStats)).toBe(true);
            expect(typeof result.clientRetention).toBe('number');
            expect(typeof result.averageRating).toBe('number');
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete meeting lifecycle', async () => {
            // Get meeting
            mockMeetingsService.getMeetingById.mockResolvedValue(mockMeeting);
            const meeting = await controller.getMeeting('meeting_123', index_1.TEST_USER_IDS.THERAPIST);
            expect(meeting).toBeDefined();
            // Create video room
            mockMeetingsService.createVideoRoom.mockResolvedValue(mockVideoRoomResponse);
            const videoRoom = await controller.createVideoRoom('meeting_123', index_1.TEST_USER_IDS.THERAPIST, {
                meetingId: 'meeting_123',
                roomType: 'video',
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
            });
            expect(videoRoom.roomId).toBeDefined();
            // Update status to in-progress
            mockMeetingsService.updateMeetingStatus.mockResolvedValue({ ...mockMeeting, status: 'in-progress' });
            const updatedMeeting = await controller.updateMeetingStatus('meeting_123', index_1.TEST_USER_IDS.THERAPIST, {
                status: 'in-progress',
            });
            expect(updatedMeeting.status).toBe('in-progress');
            // Save session data
            mockMeetingsService.getMeetingById.mockResolvedValue(mockMeeting);
            mockMeetingsService.saveMeetingSession.mockResolvedValue({
                id: 'session_123',
                meetingId: 'meeting_123',
                duration: 3600,
                notes: 'Session completed',
            });
            const session = await controller.saveMeetingSession('meeting_123', index_1.TEST_USER_IDS.THERAPIST, {
                duration: 3600,
                notes: 'Session completed',
            });
            expect(session.id).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQUVILDZDQUFzRDtBQUN0RCwyQ0FBdUg7QUFDdkgsK0RBQTJEO0FBQzNELHlEQUFxRDtBQUNyRCxrRUFBNkQ7QUFHN0QsK0VBQXFHO0FBQ3JHLCtDQUFpRTtBQUVqRSxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2xDLElBQUksVUFBOEIsQ0FBQztJQUNuQyxJQUFJLGVBQWdDLENBQUM7SUFDckMsSUFBSSxNQUFxQixDQUFDO0lBRTFCLHVCQUF1QjtJQUN2QixNQUFNLG1CQUFtQixHQUFHO1FBQzFCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3pCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDOUIsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDMUIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDeEIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM3QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN2QixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzlCLGtCQUFrQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDN0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM5Qix5QkFBeUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3JDLENBQUM7SUFFRixvQkFBb0I7SUFDcEIsTUFBTSxnQkFBZ0IsR0FBRztRQUN2QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7S0FDN0MsQ0FBQztJQUVGLFlBQVk7SUFDWixNQUFNLFdBQVcsR0FBRztRQUNsQixFQUFFLEVBQUUs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bUIsQ0FBQyxhQUFhLEVBQUUscUJBQWEsQ0FBQyxTQUFTLEVBQUU7Z0JBQ2xHLE1BQU0sRUFBRSxhQUFhO2FBQ3RCLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRWxELG9CQUFvQjtZQUNwQixtQkFBbUIsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEUsbUJBQW1CLENBQUMsa0JBQWtCLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3ZELEVBQUUsRUFBRSxhQUFhO2dCQUNqQixTQUFTLEVBQUUsYUFBYTtnQkFDeEIsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsS0FBSyxFQUFFLG1CQUFtQjthQUMzQixDQUFDLENBQUM7WUFDSCxNQUFNLE9BQU8sR0FBRyxNQUFNLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLEVBQUUscUJBQWEsQ0FBQyxTQUFTLEVBQUU7Z0JBQzFGLFFBQVEsRUFBRSxJQUFJO2dCQUNkLEtBQUssRUFBRSxtQkFBbUI7YUFDM0IsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbXByZWhlbnNpdmUgVGVzdCBTdWl0ZSBmb3IgTWVldGluZ3NDb250cm9sbGVyXG4gKiBUZXN0cyBtZWV0aW5nIG1hbmFnZW1lbnQsIHZpZGVvIHJvb20gZnVuY3Rpb25hbGl0eSwgYW5kIHNlc3Npb24gaGFuZGxpbmdcbiAqL1xuXG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEJhZFJlcXVlc3RFeGNlcHRpb24sIE5vdEZvdW5kRXhjZXB0aW9uLCBGb3JiaWRkZW5FeGNlcHRpb24sIEh0dHBFeGNlcHRpb24sIEh0dHBTdGF0dXMgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBNZWV0aW5nc0NvbnRyb2xsZXIgfSBmcm9tICcuL21lZXRpbmdzLmNvbnRyb2xsZXInO1xuaW1wb3J0IHsgTWVldGluZ3NTZXJ2aWNlIH0gZnJvbSAnLi9tZWV0aW5ncy5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFpvZFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnLi4vY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHsgU2VjdXJpdHlHdWFyZFRlc3RVdGlscywgUm9sZUJhc2VkVGVzdFV0aWxzIH0gZnJvbSAnLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQgeyBNb2NrQnVpbGRlciwgVGVzdERhdGFHZW5lcmF0b3IsIFRlc3RBc3NlcnRpb25zIH0gZnJvbSAnLi4vdGVzdC11dGlscy9lbmhhbmNlZC10ZXN0LWhlbHBlcnMnO1xuaW1wb3J0IHsgVEVTVF9VU0VSX0lEUywgVEVTVF9FTUFJTFMgfSBmcm9tICcuLi90ZXN0LXV0aWxzL2luZGV4JztcblxuZGVzY3JpYmUoJ01lZXRpbmdzQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IE1lZXRpbmdzQ29udHJvbGxlcjtcbiAgbGV0IG1lZXRpbmdzU2VydmljZTogTWVldGluZ3NTZXJ2aWNlO1xuICBsZXQgbW9kdWxlOiBUZXN0aW5nTW9kdWxlO1xuXG4gIC8vIE1vY2sgTWVldGluZ3NTZXJ2aWNlXG4gIGNvbnN0IG1vY2tNZWV0aW5nc1NlcnZpY2UgPSB7XG4gICAgZ2V0TWVldGluZ0J5SWQ6IGplc3QuZm4oKSxcbiAgICB1cGRhdGVNZWV0aW5nU3RhdHVzOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlVmlkZW9Sb29tOiBqZXN0LmZuKCksXG4gICAgam9pblZpZGVvUm9vbTogamVzdC5mbigpLFxuICAgIGdldFZpZGVvQ2FsbFN0YXR1czogamVzdC5mbigpLFxuICAgIGVuZFZpZGVvQ2FsbDogamVzdC5mbigpLFxuICAgIGdldFVwY29taW5nTWVldGluZ3M6IGplc3QuZm4oKSxcbiAgICBzYXZlTWVldGluZ1Nlc3Npb246IGplc3QuZm4oKSxcbiAgICBnZXRNZWV0aW5nQW5hbHl0aWNzOiBqZXN0LmZuKCksXG4gICAgZW1lcmdlbmN5VGVybWluYXRlTWVldGluZzogamVzdC5mbigpLFxuICB9O1xuXG4gIC8vIE1vY2sgSnd0QXV0aEd1YXJkXG4gIGNvbnN0IG1vY2tKd3RBdXRoR3VhcmQgPSB7XG4gICAgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSksXG4gIH07XG5cbiAgLy8gVGVzdCBkYXRhXG4gIGNvbnN0IG1vY2tNZWV0aW5nID0ge1xuICAgIGlkOiAnbWVldGluZ18xMjM0NTY3ODknLFxuICAgIHRpdGxlOiAnVGhlcmFweSBTZXNzaW9uJyxcbiAgICBkZXNjcmlwdGlvbjogJ0luaXRpYWwgY29uc3VsdGF0aW9uIHNlc3Npb24nLFxuICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjQtMDItMTVUMTA6MDA6MDBaJyksXG4gICAgZW5kVGltZTogbmV3IERhdGUoJzIwMjQtMDItMTVUMTE6MDA6MDBaJyksXG4gICAgc3RhdHVzOiAnc2NoZWR1bGVkJyxcbiAgICBjbGllbnRJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgdGhlcmFwaXN0SWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgIG1lZXRpbmdUeXBlOiAndmlkZW8nLFxuICAgIGR1cmF0aW9uOiA2MCxcbiAgICBpc0VtZXJnZW5jeTogZmFsc2UsXG4gICAgbm90ZXM6ICcnLFxuICAgIHJlY29yZGluZ0VuYWJsZWQ6IGZhbHNlLFxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1ZpZGVvUm9vbVJlc3BvbnNlID0ge1xuICAgIHJvb21JZDogJ3Jvb21fYWJjMTIzNDU2Nzg5JyxcbiAgICByb29tVXJsOiAnaHR0cHM6Ly92aWRlby5leGFtcGxlLmNvbS9yb29tL2FiYzEyMzQ1Njc4OScsXG4gICAgdG9rZW46ICd2aWRlb190b2tlbl94eXo5ODc2NTQzMjEnLFxuICAgIG1lZXRpbmdJZDogbW9ja01lZXRpbmcuaWQsXG4gICAgcGFydGljaXBhbnRJZDogJ3BhcnRpY2lwYW50XzEyMycsXG4gICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzYwMDAwMCksIC8vIDEgaG91ciBmcm9tIG5vd1xuICAgIHJvb21TZXR0aW5nczoge1xuICAgICAgbWF4UGFydGljaXBhbnRzOiAyLFxuICAgICAgZW5hYmxlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgIGVuYWJsZUNoYXQ6IHRydWUsXG4gICAgICBlbmFibGVTY3JlZW5TaGFyZTogdHJ1ZSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IG1vY2tWaWRlb0NhbGxTdGF0dXMgPSB7XG4gICAgbWVldGluZ0lkOiBtb2NrTWVldGluZy5pZCxcbiAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgIHJvb21JZDogJ3Jvb21fYWJjMTIzNDU2Nzg5JyxcbiAgICBwYXJ0aWNpcGFudHM6IFtcbiAgICAgIHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgbmFtZTogJ0NsaWVudCBVc2VyJyxcbiAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIGpvaW5lZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBpc0F1ZGlvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgaXNWaWRlb0VuYWJsZWQ6IHRydWUsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBuYW1lOiAnRHIuIFRoZXJhcGlzdCcsXG4gICAgICAgIHJvbGU6ICd0aGVyYXBpc3QnLFxuICAgICAgICBqb2luZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgaXNBdWRpb0VuYWJsZWQ6IHRydWUsXG4gICAgICAgIGlzVmlkZW9FbmFibGVkOiB0cnVlLFxuICAgICAgfSxcbiAgICBdLFxuICAgIGR1cmF0aW9uOiAxODAwLCAvLyAzMCBtaW51dGVzXG4gICAgc3RhcnRlZEF0OiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMTgwMDAwMCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1VwY29taW5nTWVldGluZ3MgPSBbXG4gICAgbW9ja01lZXRpbmcsXG4gICAge1xuICAgICAgLi4ubW9ja01lZXRpbmcsXG4gICAgICBpZDogJ21lZXRpbmdfOTg3NjU0MzIxJyxcbiAgICAgIHRpdGxlOiAnRm9sbG93LXVwIFNlc3Npb24nLFxuICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgnMjAyNC0wMi0xNlQxNDowMDowMFonKSxcbiAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKCcyMDI0LTAyLTE2VDE1OjAwOjAwWicpLFxuICAgIH0sXG4gIF07XG5cbiAgY29uc3QgbW9ja01lZXRpbmdBbmFseXRpY3MgPSB7XG4gICAgdG90YWxNZWV0aW5nczogMjUsXG4gICAgY29tcGxldGVkTWVldGluZ3M6IDIzLFxuICAgIGNhbmNlbGxlZE1lZXRpbmdzOiAyLFxuICAgIGF2ZXJhZ2VEdXJhdGlvbjogNTUuOCxcbiAgICB0b3RhbER1cmF0aW9uOiAxMzk1LFxuICAgIG1lZXRpbmdzQnlUeXBlOiB7XG4gICAgICB2aWRlbzogMjAsXG4gICAgICBhdWRpbzogMyxcbiAgICAgIGluUGVyc29uOiAyLFxuICAgIH0sXG4gICAgbW9udGhseVN0YXRzOiBbXG4gICAgICB7IG1vbnRoOiAnMjAyNC0wMScsIGNvdW50OiAxMiwgZHVyYXRpb246IDcyMCB9LFxuICAgICAgeyBtb250aDogJzIwMjQtMDInLCBjb3VudDogMTMsIGR1cmF0aW9uOiA2NzUgfSxcbiAgICBdLFxuICAgIGNsaWVudFJldGVudGlvbjogOTIuNSxcbiAgICBhdmVyYWdlUmF0aW5nOiA0LjgsXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgbW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGNvbnRyb2xsZXJzOiBbTWVldGluZ3NDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogTWVldGluZ3NTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrTWVldGluZ3NTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KVxuICAgICAgLm92ZXJyaWRlR3VhcmQoSnd0QXV0aEd1YXJkKVxuICAgICAgLnVzZVZhbHVlKG1vY2tKd3RBdXRoR3VhcmQpXG4gICAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8TWVldGluZ3NDb250cm9sbGVyPihNZWV0aW5nc0NvbnRyb2xsZXIpO1xuICAgIG1lZXRpbmdzU2VydmljZSA9IG1vZHVsZS5nZXQ8TWVldGluZ3NTZXJ2aWNlPihNZWV0aW5nc1NlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29udHJvbGxlciBJbml0aWFsaXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY29udHJvbGxlcikudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGF2ZSBtZWV0aW5nc1NlcnZpY2UgaW5qZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QobWVldGluZ3NTZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgR3VhcmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgcHJvdGVjdGVkIGJ5IEp3dEF1dGhHdWFyZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGd1YXJkcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fZ3VhcmRzX18nLCBNZWV0aW5nc0NvbnRyb2xsZXIpO1xuICAgICAgZXhwZWN0KGd1YXJkcykudG9Db250YWluKEp3dEF1dGhHdWFyZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgcHJvcGVyIHJvdXRlIGRlY29yYXRvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250cm9sbGVyTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdwYXRoJywgTWVldGluZ3NDb250cm9sbGVyKTtcbiAgICAgIGV4cGVjdChjb250cm9sbGVyTWV0YWRhdGEpLnRvQmUoJ21lZXRpbmdzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHRVQgL21lZXRpbmdzLzppZCcsICgpID0+IHtcbiAgICBjb25zdCBtZWV0aW5nSWQgPSAnbWVldGluZ18xMjM0NTY3ODknO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgbWVldGluZyBieSBpZCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5nKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRNZWV0aW5nKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tNZWV0aW5nKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UuZ2V0TWVldGluZ0J5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWVldGluZyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZWV0aW5nIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQnlJZC5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0TWVldGluZygnbm9uLWV4aXN0ZW50LWlkJywgVEVTVF9VU0VSX0lEUy5DTElFTlQpKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhY2Nlc3MgZGVuaWVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZm9yYmlkZGVuRXJyb3IgPSBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdBY2Nlc3MgZGVuaWVkIHRvIG1lZXRpbmcnKTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZ2V0TWVldGluZ0J5SWQubW9ja1JlamVjdGVkVmFsdWUoZm9yYmlkZGVuRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRNZWV0aW5nKG1lZXRpbmdJZCwgJ3VuYXV0aG9yaXplZC11c2VyJykpLnJlamVjdHMudG9UaHJvdyhmb3JiaWRkZW5FcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZ2V0TWVldGluZ0J5SWQubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0TWVldGluZyhtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQVVQgL21lZXRpbmdzLzppZC9zdGF0dXMnLCAoKSA9PiB7XG4gICAgY29uc3QgbWVldGluZ0lkID0gJ21lZXRpbmdfMTIzNDU2Nzg5JztcbiAgICBjb25zdCB1cGRhdGVTdGF0dXNEdG8gPSB7XG4gICAgICBzdGF0dXM6ICdpbi1wcm9ncmVzcycgYXMgY29uc3QsXG4gICAgICBub3RlczogJ01lZXRpbmcgc3RhcnRlZCBvbiB0aW1lJyxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgbWVldGluZyBzdGF0dXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlZE1lZXRpbmcgPSB7IC4uLm1vY2tNZWV0aW5nLCBzdGF0dXM6ICdpbi1wcm9ncmVzcycsIG5vdGVzOiB1cGRhdGVTdGF0dXNEdG8ubm90ZXMgfTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UudXBkYXRlTWVldGluZ1N0YXR1cy5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkTWVldGluZyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlTWVldGluZ1N0YXR1cyhtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCB1cGRhdGVTdGF0dXNEdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRNZWV0aW5nKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UudXBkYXRlTWVldGluZ1N0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgIHVwZGF0ZVN0YXR1c0R0byxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhbGwgdmFsaWQgc3RhdHVzIHRyYW5zaXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdHVzT3B0aW9ucyA9IFsnc2NoZWR1bGVkJywgJ2luLXByb2dyZXNzJywgJ2NvbXBsZXRlZCcsICdjYW5jZWxsZWQnLCAnbm8tc2hvdyddO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IHN0YXR1cyBvZiBzdGF0dXNPcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGR0byA9IHsgc3RhdHVzLCBub3RlczogYFN0YXR1cyBjaGFuZ2VkIHRvICR7c3RhdHVzfWAgfTtcbiAgICAgICAgY29uc3QgdXBkYXRlZE1lZXRpbmcgPSB7IC4uLm1vY2tNZWV0aW5nLCBzdGF0dXMgfTtcbiAgICAgICAgbW9ja01lZXRpbmdzU2VydmljZS51cGRhdGVNZWV0aW5nU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHVwZGF0ZWRNZWV0aW5nKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZU1lZXRpbmdTdGF0dXMobWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgZHRvKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZShzdGF0dXMpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWVldGluZyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZWV0aW5nIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS51cGRhdGVNZWV0aW5nU3RhdHVzLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIudXBkYXRlTWVldGluZ1N0YXR1cyhtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCB1cGRhdGVTdGF0dXNEdG8pXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuYXV0aG9yaXplZCBzdGF0dXMgdXBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZm9yYmlkZGVuRXJyb3IgPSBuZXcgRm9yYmlkZGVuRXhjZXB0aW9uKCdPbmx5IHRoZXJhcGlzdCBjYW4gdXBkYXRlIG1lZXRpbmcgc3RhdHVzJyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLnVwZGF0ZU1lZXRpbmdTdGF0dXMubW9ja1JlamVjdGVkVmFsdWUoZm9yYmlkZGVuRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIudXBkYXRlTWVldGluZ1N0YXR1cyhtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCB1cGRhdGVTdGF0dXNEdG8pXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhmb3JiaWRkZW5FcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2YWxpZGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdJbnZhbGlkIHN0YXR1cyB2YWx1ZScpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS51cGRhdGVNZWV0aW5nU3RhdHVzLm1vY2tSZWplY3RlZFZhbHVlKHZhbGlkYXRpb25FcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci51cGRhdGVNZWV0aW5nU3RhdHVzKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIHsgc3RhdHVzOiAnaW52YWxpZC1zdGF0dXMnIGFzIGFueSB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3codmFsaWRhdGlvbkVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL21lZXRpbmdzLzppZC92aWRlby1yb29tJywgKCkgPT4ge1xuICAgIGNvbnN0IG1lZXRpbmdJZCA9ICdtZWV0aW5nXzEyMzQ1Njc4OSc7XG4gICAgY29uc3QgY3JlYXRlUm9vbUR0byA9IHtcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHJvb21UeXBlOiAndmlkZW8nIGFzIGNvbnN0LFxuICAgICAgbWF4UGFydGljaXBhbnRzOiAyLFxuICAgICAgZW5hYmxlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgIGVuYWJsZUNoYXQ6IHRydWUsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHZpZGVvIHJvb20gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5jcmVhdGVWaWRlb1Jvb20ubW9ja1Jlc29sdmVkVmFsdWUobW9ja1ZpZGVvUm9vbVJlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVWaWRlb1Jvb20obWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgY3JlYXRlUm9vbUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1ZpZGVvUm9vbVJlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UuY3JlYXRlVmlkZW9Sb29tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgY3JlYXRlUm9vbUR0byxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByb29tIGNyZWF0aW9uIHdpdGggZGlmZmVyZW50IHNldHRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tRHRvID0ge1xuICAgICAgICAuLi5jcmVhdGVSb29tRHRvLFxuICAgICAgICBtYXhQYXJ0aWNpcGFudHM6IDQsXG4gICAgICAgIGVuYWJsZVJlY29yZGluZzogdHJ1ZSxcbiAgICAgICAgZW5hYmxlQ2hhdDogZmFsc2UsXG4gICAgICB9O1xuICAgICAgY29uc3QgY3VzdG9tUmVzcG9uc2UgPSB7XG4gICAgICAgIC4uLm1vY2tWaWRlb1Jvb21SZXNwb25zZSxcbiAgICAgICAgcm9vbVNldHRpbmdzOiB7XG4gICAgICAgICAgbWF4UGFydGljaXBhbnRzOiA0LFxuICAgICAgICAgIGVuYWJsZVJlY29yZGluZzogdHJ1ZSxcbiAgICAgICAgICBlbmFibGVDaGF0OiBmYWxzZSxcbiAgICAgICAgICBlbmFibGVTY3JlZW5TaGFyZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmNyZWF0ZVZpZGVvUm9vbS5tb2NrUmVzb2x2ZWRWYWx1ZShjdXN0b21SZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlVmlkZW9Sb29tKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIGN1c3RvbUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucm9vbVNldHRpbmdzLm1heFBhcnRpY2lwYW50cykudG9CZSg0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQucm9vbVNldHRpbmdzLmVuYWJsZVJlY29yZGluZykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucm9vbVNldHRpbmdzLmVuYWJsZUNoYXQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWVldGluZyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZWV0aW5nIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5jcmVhdGVWaWRlb1Jvb20ubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVWaWRlb1Jvb20oJ25vbi1leGlzdGVudC1pZCcsIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCBjcmVhdGVSb29tRHRvKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2aWRlbyBzZXJ2aWNlIHVuYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdWaWRlbyBzZXJ2aWNlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlJyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmNyZWF0ZVZpZGVvUm9vbS5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlVmlkZW9Sb29tKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIGNyZWF0ZVJvb21EdG8pXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhzZXJ2aWNlRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZHVwbGljYXRlIHJvb20gY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkdXBsaWNhdGVFcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdWaWRlbyByb29tIGFscmVhZHkgZXhpc3RzIGZvciB0aGlzIG1lZXRpbmcnKTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuY3JlYXRlVmlkZW9Sb29tLm1vY2tSZWplY3RlZFZhbHVlKGR1cGxpY2F0ZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZVZpZGVvUm9vbShtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCBjcmVhdGVSb29tRHRvKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coZHVwbGljYXRlRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUE9TVCAvbWVldGluZ3MvOmlkL2pvaW4tdmlkZW8nLCAoKSA9PiB7XG4gICAgY29uc3QgbWVldGluZ0lkID0gJ21lZXRpbmdfMTIzNDU2Nzg5JztcbiAgICBjb25zdCBqb2luUm9vbUR0byA9IHtcbiAgICAgIHJvb21JZDogJ3Jvb21fYWJjMTIzNDU2Nzg5JyxcbiAgICAgIHBhcnRpY2lwYW50TmFtZTogJ0NsaWVudCBVc2VyJyxcbiAgICAgIGF1ZGlvRW5hYmxlZDogdHJ1ZSxcbiAgICAgIHZpZGVvRW5hYmxlZDogdHJ1ZSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBqb2luIHZpZGVvIHJvb20gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5qb2luVmlkZW9Sb29tLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tWaWRlb1Jvb21SZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuam9pblZpZGVvUm9vbShtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBqb2luUm9vbUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1ZpZGVvUm9vbVJlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2Uuam9pblZpZGVvUm9vbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgIGpvaW5Sb29tRHRvLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGpvaW5pbmcgd2l0aCBkaWZmZXJlbnQgbWVkaWEgc2V0dGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhdWRpb09ubHlEdG8gPSB7XG4gICAgICAgIC4uLmpvaW5Sb29tRHRvLFxuICAgICAgICBhdWRpb0VuYWJsZWQ6IHRydWUsXG4gICAgICAgIHZpZGVvRW5hYmxlZDogZmFsc2UsXG4gICAgICB9O1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5qb2luVmlkZW9Sb29tLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tWaWRlb1Jvb21SZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuam9pblZpZGVvUm9vbShtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBhdWRpb09ubHlEdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tWaWRlb1Jvb21SZXNwb25zZSk7XG4gICAgICBleHBlY3QobWVldGluZ3NTZXJ2aWNlLmpvaW5WaWRlb1Jvb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICBhdWRpb09ubHlEdG8sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcm9vbSBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdWaWRlbyByb29tIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5qb2luVmlkZW9Sb29tLm1vY2tSZWplY3RlZFZhbHVlKG5vdEZvdW5kRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuam9pblZpZGVvUm9vbShtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBqb2luUm9vbUR0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KG5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcm9vbSBjYXBhY2l0eSBleGNlZWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNhcGFjaXR5RXJyb3IgPSBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignUm9vbSBjYXBhY2l0eSBleGNlZWRlZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5qb2luVmlkZW9Sb29tLm1vY2tSZWplY3RlZFZhbHVlKGNhcGFjaXR5RXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuam9pblZpZGVvUm9vbShtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBqb2luUm9vbUR0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGNhcGFjaXR5RXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGFydGljaXBhbnQgYWxyZWFkeSBpbiByb29tJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZHVwbGljYXRlRXJyb3IgPSBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignUGFydGljaXBhbnQgYWxyZWFkeSBpbiByb29tJyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmpvaW5WaWRlb1Jvb20ubW9ja1JlamVjdGVkVmFsdWUoZHVwbGljYXRlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuam9pblZpZGVvUm9vbShtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCBqb2luUm9vbUR0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGR1cGxpY2F0ZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvbWVldGluZ3MvOmlkL3ZpZGVvLXN0YXR1cycsICgpID0+IHtcbiAgICBjb25zdCBtZWV0aW5nSWQgPSAnbWVldGluZ18xMjM0NTY3ODknO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdmlkZW8gY2FsbCBzdGF0dXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRWaWRlb0NhbGxTdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1ZpZGVvQ2FsbFN0YXR1cyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VmlkZW9DYWxsU3RhdHVzKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tWaWRlb0NhbGxTdGF0dXMpO1xuICAgICAgZXhwZWN0KG1lZXRpbmdzU2VydmljZS5nZXRWaWRlb0NhbGxTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmlkZW8gY2FsbCBub3QgYWN0aXZlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW5hY3RpdmVTdGF0dXMgPSB7XG4gICAgICAgIC4uLm1vY2tWaWRlb0NhbGxTdGF0dXMsXG4gICAgICAgIHN0YXR1czogJ2VuZGVkJyxcbiAgICAgICAgcGFydGljaXBhbnRzOiBbXSxcbiAgICAgICAgZHVyYXRpb246IDM2MDAsXG4gICAgICB9O1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRWaWRlb0NhbGxTdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUoaW5hY3RpdmVTdGF0dXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFZpZGVvQ2FsbFN0YXR1cyhtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoJ2VuZGVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBhcnRpY2lwYW50cykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWVldGluZyBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZWV0aW5nIG5vdCBmb3VuZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRWaWRlb0NhbGxTdGF0dXMubW9ja1JlamVjdGVkVmFsdWUobm90Rm91bmRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRWaWRlb0NhbGxTdGF0dXMoJ25vbi1leGlzdGVudC1pZCcsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3cobm90Rm91bmRFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBubyB2aWRlbyByb29tIGZvciBtZWV0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm9Sb29tRXJyb3IgPSBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ05vIHZpZGVvIHJvb20gZm91bmQgZm9yIHRoaXMgbWVldGluZycpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRWaWRlb0NhbGxTdGF0dXMubW9ja1JlamVjdGVkVmFsdWUobm9Sb29tRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0VmlkZW9DYWxsU3RhdHVzKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5DTElFTlQpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhub1Jvb21FcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdERUxFVEUgL21lZXRpbmdzLzppZC92aWRlby1yb29tJywgKCkgPT4ge1xuICAgIGNvbnN0IG1lZXRpbmdJZCA9ICdtZWV0aW5nXzEyMzQ1Njc4OSc7XG4gICAgY29uc3QgZW5kQ2FsbER0byA9IHtcbiAgICAgIHJlYXNvbjogJ3Nlc3Npb24tY29tcGxldGVkJyxcbiAgICAgIGR1cmF0aW9uOiAzNjAwLFxuICAgICAgcmVjb3JkaW5nVXJsOiAnaHR0cHM6Ly9yZWNvcmRpbmdzLmV4YW1wbGUuY29tL3Nlc3Npb25fMTIzLm1wNCcsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgZW5kIHZpZGVvIGNhbGwgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5lbmRWaWRlb0NhbGwubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgY29udHJvbGxlci5lbmRWaWRlb0NhbGwobWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgZW5kQ2FsbER0byk7XG5cbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UuZW5kVmlkZW9DYWxsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgZW5kQ2FsbER0byxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbmRpbmcgY2FsbCB3aXRoIGRpZmZlcmVudCByZWFzb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVhc29ucyA9IFsnc2Vzc2lvbi1jb21wbGV0ZWQnLCAndGVjaG5pY2FsLWlzc3VlcycsICdlbWVyZ2VuY3knLCAncGFydGljaXBhbnQtbGVmdCddO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5lbmRWaWRlb0NhbGwubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgZm9yIChjb25zdCByZWFzb24gb2YgcmVhc29ucykge1xuICAgICAgICBjb25zdCBkdG8gPSB7IC4uLmVuZENhbGxEdG8sIHJlYXNvbiB9O1xuICAgICAgICBcbiAgICAgICAgYXdhaXQgY29udHJvbGxlci5lbmRWaWRlb0NhbGwobWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgZHRvKTtcblxuICAgICAgICBleHBlY3QobWVldGluZ3NTZXJ2aWNlLmVuZFZpZGVvQ2FsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAgIGR0byxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZpZGVvIGNhbGwgbm90IGFjdGl2ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdEFjdGl2ZUVycm9yID0gbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1ZpZGVvIGNhbGwgaXMgbm90IGFjdGl2ZScpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5lbmRWaWRlb0NhbGwubW9ja1JlamVjdGVkVmFsdWUobm90QWN0aXZlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZW5kVmlkZW9DYWxsKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIGVuZENhbGxEdG8pXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhub3RBY3RpdmVFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmF1dGhvcml6ZWQgZW5kIGNhbGwnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmb3JiaWRkZW5FcnJvciA9IG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ09ubHkgbWVldGluZyBwYXJ0aWNpcGFudHMgY2FuIGVuZCB0aGUgY2FsbCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5lbmRWaWRlb0NhbGwubW9ja1JlamVjdGVkVmFsdWUoZm9yYmlkZGVuRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZW5kVmlkZW9DYWxsKG1lZXRpbmdJZCwgJ3VuYXV0aG9yaXplZC11c2VyJywgZW5kQ2FsbER0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGZvcmJpZGRlbkVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL21lZXRpbmdzLzppZC9yb29tIChMZWdhY3kpJywgKCkgPT4ge1xuICAgIGNvbnN0IG1lZXRpbmdJZCA9ICdtZWV0aW5nXzEyMzQ1Njc4OSc7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIG1lZXRpbmcgcm9vbSB1c2luZyBsZWdhY3kgZW5kcG9pbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmNyZWF0ZVZpZGVvUm9vbS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVmlkZW9Sb29tUmVzcG9uc2UpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdlbmVyYXRlTWVldGluZ1Jvb20obWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1ZpZGVvUm9vbVJlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UuY3JlYXRlVmlkZW9Sb29tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAge1xuICAgICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgICByb29tVHlwZTogJ3ZpZGVvJyxcbiAgICAgICAgICBtYXhQYXJ0aWNpcGFudHM6IDIsXG4gICAgICAgICAgZW5hYmxlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgICAgICBlbmFibGVDaGF0OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxlZ2FjeSBlbmRwb2ludCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ1ZpZGVvIHNlcnZpY2UgdW5hdmFpbGFibGUnKTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuY3JlYXRlVmlkZW9Sb29tLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZW5lcmF0ZU1lZXRpbmdSb29tKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhzZXJ2aWNlRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9tZWV0aW5ncy91cGNvbWluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCB1cGNvbWluZyBtZWV0aW5ncyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldFVwY29taW5nTWVldGluZ3MubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VwY29taW5nTWVldGluZ3MpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVwY29taW5nTWVldGluZ3MoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVcGNvbWluZ01lZXRpbmdzKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UuZ2V0VXBjb21pbmdNZWV0aW5ncykudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5DTElFTlQsIHVuZGVmaW5lZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB1cGNvbWluZyBtZWV0aW5ncyB3aXRoIGxpbWl0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGltaXRlZE1lZXRpbmdzID0gW21vY2tVcGNvbWluZ01lZXRpbmdzWzBdXTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZ2V0VXBjb21pbmdNZWV0aW5ncy5tb2NrUmVzb2x2ZWRWYWx1ZShsaW1pdGVkTWVldGluZ3MpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVwY29taW5nTWVldGluZ3MoVEVTVF9VU0VSX0lEUy5DTElFTlQsIDEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGxpbWl0ZWRNZWV0aW5ncyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QobWVldGluZ3NTZXJ2aWNlLmdldFVwY29taW5nTWVldGluZ3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuQ0xJRU5ULCAxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vIHVwY29taW5nIG1lZXRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRVcGNvbWluZ01lZXRpbmdzLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVcGNvbWluZ01lZXRpbmdzKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcnkgZmFpbGVkJyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldFVwY29taW5nTWVldGluZ3MubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0VXBjb21pbmdNZWV0aW5ncyhURVNUX1VTRVJfSURTLkNMSUVOVCkpLnJlamVjdHMudG9UaHJvdyhzZXJ2aWNlRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUE9TVCAvbWVldGluZ3MvOmlkL3Nlc3Npb24nLCAoKSA9PiB7XG4gICAgY29uc3QgbWVldGluZ0lkID0gJ21lZXRpbmdfMTIzNDU2Nzg5JztcbiAgICBjb25zdCBzZXNzaW9uRGF0YSA9IHtcbiAgICAgIGR1cmF0aW9uOiAzNjAwLFxuICAgICAgbm90ZXM6ICdQcm9kdWN0aXZlIHNlc3Npb24gd2l0aCBnb29kIHByb2dyZXNzJyxcbiAgICAgIG91dGNvbWVzOiBbJ2FueGlldHktcmVkdWNlZCcsICdjb3Bpbmctc3RyYXRlZ2llcy1kaXNjdXNzZWQnXSxcbiAgICAgIG5leHRTdGVwczogJ0NvbnRpbnVlIHdpdGggYnJlYXRoaW5nIGV4ZXJjaXNlcycsXG4gICAgICBjbGllbnRNb29kOiAnaW1wcm92ZWQnLFxuICAgICAgdGhlcmFwaXN0Tm90ZXM6ICdDbGllbnQgc2hvd2VkIHNpZ25pZmljYW50IGltcHJvdmVtZW50JyxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBzYXZlIG1lZXRpbmcgc2Vzc2lvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzYXZlZFNlc3Npb24gPSB7XG4gICAgICAgIGlkOiAnc2Vzc2lvbl8xMjM0NTY3ODknLFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIC4uLnNlc3Npb25EYXRhLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTWVldGluZyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLnNhdmVNZWV0aW5nU2Vzc2lvbi5tb2NrUmVzb2x2ZWRWYWx1ZShzYXZlZFNlc3Npb24pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnNhdmVNZWV0aW5nU2Vzc2lvbihtZWV0aW5nSWQsIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCBzZXNzaW9uRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoc2F2ZWRTZXNzaW9uKTtcbiAgICAgIGV4cGVjdChtZWV0aW5nc1NlcnZpY2UuZ2V0TWVldGluZ0J5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QpO1xuICAgICAgZXhwZWN0KG1lZXRpbmdzU2VydmljZS5zYXZlTWVldGluZ1Nlc3Npb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBzZXNzaW9uRGF0YSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzIGJlZm9yZSBzYXZpbmcgc2Vzc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZvcmJpZGRlbkVycm9yID0gbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignQWNjZXNzIGRlbmllZCB0byBtZWV0aW5nJyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkLm1vY2tSZWplY3RlZFZhbHVlKGZvcmJpZGRlbkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLnNhdmVNZWV0aW5nU2Vzc2lvbihtZWV0aW5nSWQsICd1bmF1dGhvcml6ZWQtdXNlcicsIHNlc3Npb25EYXRhKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coZm9yYmlkZGVuRXJyb3IpO1xuXG4gICAgICBleHBlY3QobWVldGluZ3NTZXJ2aWNlLnNhdmVNZWV0aW5nU2Vzc2lvbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlc3Npb24gZGF0YSB2YWxpZGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdJbnZhbGlkIHNlc3Npb24gZGF0YScpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTWVldGluZyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLnNhdmVNZWV0aW5nU2Vzc2lvbi5tb2NrUmVqZWN0ZWRWYWx1ZSh2YWxpZGF0aW9uRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuc2F2ZU1lZXRpbmdTZXNzaW9uKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIHsgZHVyYXRpb246IC0xIH0gYXMgYW55KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3codmFsaWRhdGlvbkVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvbWVldGluZ3MvYW5hbHl0aWNzL3RoZXJhcGlzdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCB0aGVyYXBpc3QgbWVldGluZyBhbmFseXRpY3Mgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQW5hbHl0aWNzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5nQW5hbHl0aWNzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRUaGVyYXBpc3RNZWV0aW5nQW5hbHl0aWNzKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrTWVldGluZ0FuYWx5dGljcyk7XG4gICAgICBleHBlY3QobWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdBbmFseXRpY3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCB1bmRlZmluZWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgYW5hbHl0aWNzIHdpdGggZGF0ZSByYW5nZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9ICcyMDI0LTAxLTAxJztcbiAgICAgIGNvbnN0IGVuZERhdGUgPSAnMjAyNC0wMS0zMSc7XG4gICAgICBjb25zdCBkYXRlUmFuZ2VBbmFseXRpY3MgPSB7XG4gICAgICAgIC4uLm1vY2tNZWV0aW5nQW5hbHl0aWNzLFxuICAgICAgICB0b3RhbE1lZXRpbmdzOiAxMixcbiAgICAgICAgbW9udGhseVN0YXRzOiBbeyBtb250aDogJzIwMjQtMDEnLCBjb3VudDogMTIsIGR1cmF0aW9uOiA3MjAgfV0sXG4gICAgICB9O1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQW5hbHl0aWNzLm1vY2tSZXNvbHZlZFZhbHVlKGRhdGVSYW5nZUFuYWx5dGljcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VGhlcmFwaXN0TWVldGluZ0FuYWx5dGljcyhURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgc3RhcnREYXRlLCBlbmREYXRlKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChkYXRlUmFuZ2VBbmFseXRpY3MpO1xuICAgICAgZXhwZWN0KG1lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQW5hbHl0aWNzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgIHtcbiAgICAgICAgICBzdGFydDogbmV3IERhdGUoc3RhcnREYXRlKSxcbiAgICAgICAgICBlbmQ6IG5ldyBEYXRlKGVuZERhdGUpLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgZGF0ZSBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0VGhlcmFwaXN0TWVldGluZ0FuYWx5dGljcyhURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgJ2ludmFsaWQtZGF0ZScsICcyMDI0LTAxLTMxJylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aGVyYXBpc3Qgd2l0aCBubyBtZWV0aW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVtcHR5QW5hbHl0aWNzID0ge1xuICAgICAgICB0b3RhbE1lZXRpbmdzOiAwLFxuICAgICAgICBjb21wbGV0ZWRNZWV0aW5nczogMCxcbiAgICAgICAgY2FuY2VsbGVkTWVldGluZ3M6IDAsXG4gICAgICAgIGF2ZXJhZ2VEdXJhdGlvbjogMCxcbiAgICAgICAgdG90YWxEdXJhdGlvbjogMCxcbiAgICAgICAgbWVldGluZ3NCeVR5cGU6IHsgdmlkZW86IDAsIGF1ZGlvOiAwLCBpblBlcnNvbjogMCB9LFxuICAgICAgICBtb250aGx5U3RhdHM6IFtdLFxuICAgICAgICBjbGllbnRSZXRlbnRpb246IDAsXG4gICAgICAgIGF2ZXJhZ2VSYXRpbmc6IDAsXG4gICAgICB9O1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRNZWV0aW5nQW5hbHl0aWNzLm1vY2tSZXNvbHZlZFZhbHVlKGVtcHR5QW5hbHl0aWNzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRUaGVyYXBpc3RNZWV0aW5nQW5hbHl0aWNzKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChlbXB0eUFuYWx5dGljcyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsTWVldGluZ3MpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQT1NUIC9tZWV0aW5ncy86aWQvZW1lcmdlbmN5LXRlcm1pbmF0ZScsICgpID0+IHtcbiAgICBjb25zdCBtZWV0aW5nSWQgPSAnbWVldGluZ18xMjM0NTY3ODknO1xuICAgIGNvbnN0IGVtZXJnZW5jeURhdGEgPSB7IHJlYXNvbjogJ01lZGljYWwgZW1lcmdlbmN5IHJlcG9ydGVkIGJ5IGNsaWVudCcgfTtcblxuICAgIGl0KCdzaG91bGQgZW1lcmdlbmN5IHRlcm1pbmF0ZSBtZWV0aW5nIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlcm1pbmF0aW9uUmVzdWx0ID0ge1xuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIHRlcm1pbmF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgcmVhc29uOiBlbWVyZ2VuY3lEYXRhLnJlYXNvbixcbiAgICAgICAgdGVybWluYXRlZEJ5OiBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgZW1lcmdlbmN5UHJvdG9jb2xBY3RpdmF0ZWQ6IHRydWUsXG4gICAgICB9O1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5lbWVyZ2VuY3lUZXJtaW5hdGVNZWV0aW5nLm1vY2tSZXNvbHZlZFZhbHVlKHRlcm1pbmF0aW9uUmVzdWx0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5lbWVyZ2VuY3lUZXJtaW5hdGUobWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgZW1lcmdlbmN5RGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodGVybWluYXRpb25SZXN1bHQpO1xuICAgICAgZXhwZWN0KG1lZXRpbmdzU2VydmljZS5lbWVyZ2VuY3lUZXJtaW5hdGVNZWV0aW5nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBlbWVyZ2VuY3lEYXRhLnJlYXNvbixcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlmZmVyZW50IGVtZXJnZW5jeSByZWFzb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW1lcmdlbmN5UmVhc29ucyA9IFtcbiAgICAgICAgJ01lZGljYWwgZW1lcmdlbmN5JyxcbiAgICAgICAgJ1NhZmV0eSBjb25jZXJuJyxcbiAgICAgICAgJ1RlY2huaWNhbCBmYWlsdXJlJyxcbiAgICAgICAgJ0luYXBwcm9wcmlhdGUgYmVoYXZpb3InLFxuICAgICAgICAnU3lzdGVtIG1hbGZ1bmN0aW9uJyxcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgcmVhc29uIG9mIGVtZXJnZW5jeVJlYXNvbnMpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHsgcmVhc29uIH07XG4gICAgICAgIGNvbnN0IHRlcm1pbmF0aW9uUmVzdWx0ID0ge1xuICAgICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgICB0ZXJtaW5hdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgcmVhc29uLFxuICAgICAgICAgIHRlcm1pbmF0ZWRCeTogVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICAgICAgZW1lcmdlbmN5UHJvdG9jb2xBY3RpdmF0ZWQ6IHRydWUsXG4gICAgICAgIH07XG4gICAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZW1lcmdlbmN5VGVybWluYXRlTWVldGluZy5tb2NrUmVzb2x2ZWRWYWx1ZSh0ZXJtaW5hdGlvblJlc3VsdCk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5lbWVyZ2VuY3lUZXJtaW5hdGUobWVldGluZ0lkLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgZGF0YSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5yZWFzb24pLnRvQmUocmVhc29uKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1lZXRpbmcgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignTWVldGluZyBub3QgZm91bmQnKTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZW1lcmdlbmN5VGVybWluYXRlTWVldGluZy5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmVtZXJnZW5jeVRlcm1pbmF0ZSgnbm9uLWV4aXN0ZW50LWlkJywgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIGVtZXJnZW5jeURhdGEpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1lZXRpbmcgYWxyZWFkeSB0ZXJtaW5hdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYWxyZWFkeVRlcm1pbmF0ZWRFcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdNZWV0aW5nIGFscmVhZHkgdGVybWluYXRlZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5lbWVyZ2VuY3lUZXJtaW5hdGVNZWV0aW5nLm1vY2tSZWplY3RlZFZhbHVlKGFscmVhZHlUZXJtaW5hdGVkRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZW1lcmdlbmN5VGVybWluYXRlKG1lZXRpbmdJZCwgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIGVtZXJnZW5jeURhdGEpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhhbHJlYWR5VGVybWluYXRlZEVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgdW5hdmFpbGFibGUgc2NlbmFyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdTZXJ2aWNlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlJyk7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldE1lZXRpbmcoJ21lZXRpbmdfMTIzJywgVEVTVF9VU0VSX0lEUy5DTElFTlQpKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZpZGVvIHNlcnZpY2UgaW50ZWdyYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmlkZW9TZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ1ZpZGVvIHNlcnZpY2UgQVBJIHRpbWVvdXQnKTtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuY3JlYXRlVmlkZW9Sb29tLm1vY2tSZWplY3RlZFZhbHVlKHZpZGVvU2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmNyZWF0ZVZpZGVvUm9vbSgnbWVldGluZ18xMjMnLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwge1xuICAgICAgICAgIG1lZXRpbmdJZDogJ21lZXRpbmdfMTIzJyxcbiAgICAgICAgICByb29tVHlwZTogJ3ZpZGVvJyxcbiAgICAgICAgICBtYXhQYXJ0aWNpcGFudHM6IDIsXG4gICAgICAgICAgZW5hYmxlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgICAgICBlbmFibGVDaGF0OiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3codmlkZW9TZXJ2aWNlRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYkVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5nZXRVcGNvbWluZ01lZXRpbmdzLm1vY2tSZWplY3RlZFZhbHVlKGRiRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRVcGNvbWluZ01lZXRpbmdzKFRFU1RfVVNFUl9JRFMuQ0xJRU5UKSkucmVqZWN0cy50b1Rocm93KGRiRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzcG9uc2UgRm9ybWF0IFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIG1lZXRpbmcgcmVzcG9uc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5nKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRNZWV0aW5nKCdtZWV0aW5nXzEyMycsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcblxuICAgICAgVGVzdEFzc2VydGlvbnMuZXhwZWN0VmFsaWRFbnRpdHkocmVzdWx0LCBbJ2lkJywgJ3RpdGxlJywgJ3N0YXJ0VGltZScsICdlbmRUaW1lJywgJ3N0YXR1cyddKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaWQpLnRvQmUobW9ja01lZXRpbmcuaWQpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuZHVyYXRpb24pLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuaXNFbWVyZ2VuY3kpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3Blcmx5IGZvcm1hdHRlZCB2aWRlbyByb29tIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5jcmVhdGVWaWRlb1Jvb20ubW9ja1Jlc29sdmVkVmFsdWUobW9ja1ZpZGVvUm9vbVJlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVWaWRlb1Jvb20oJ21lZXRpbmdfMTIzJywgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIHtcbiAgICAgICAgbWVldGluZ0lkOiAnbWVldGluZ18xMjMnLFxuICAgICAgICByb29tVHlwZTogJ3ZpZGVvJyxcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiAyLFxuICAgICAgICBlbmFibGVSZWNvcmRpbmc6IGZhbHNlLFxuICAgICAgICBlbmFibGVDaGF0OiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyb29tSWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyb29tVXJsJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndG9rZW4nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyb29tU2V0dGluZ3MnKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnJvb21TZXR0aW5ncy5tYXhQYXJ0aWNpcGFudHMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQucm9vbVNldHRpbmdzLmVuYWJsZVJlY29yZGluZykudG9CZSgnYm9vbGVhbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIGFuYWx5dGljcyByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZ2V0TWVldGluZ0FuYWx5dGljcy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrTWVldGluZ0FuYWx5dGljcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VGhlcmFwaXN0TWVldGluZ0FuYWx5dGljcyhURVNUX1VTRVJfSURTLlRIRVJBUElTVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbE1lZXRpbmdzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnY29tcGxldGVkTWVldGluZ3MnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdhdmVyYWdlRHVyYXRpb24nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdtZWV0aW5nc0J5VHlwZScpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0Lm1vbnRobHlTdGF0cykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5jbGllbnRSZXRlbnRpb24pLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuYXZlcmFnZVJhdGluZykudG9CZSgnbnVtYmVyJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSBtZWV0aW5nIGxpZmVjeWNsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdldCBtZWV0aW5nXG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmdldE1lZXRpbmdCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZWV0aW5nKTtcbiAgICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCBjb250cm9sbGVyLmdldE1lZXRpbmcoJ21lZXRpbmdfMTIzJywgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QpO1xuICAgICAgZXhwZWN0KG1lZXRpbmcpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIENyZWF0ZSB2aWRlbyByb29tXG4gICAgICBtb2NrTWVldGluZ3NTZXJ2aWNlLmNyZWF0ZVZpZGVvUm9vbS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVmlkZW9Sb29tUmVzcG9uc2UpO1xuICAgICAgY29uc3QgdmlkZW9Sb29tID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVWaWRlb1Jvb20oJ21lZXRpbmdfMTIzJywgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIHtcbiAgICAgICAgbWVldGluZ0lkOiAnbWVldGluZ18xMjMnLFxuICAgICAgICByb29tVHlwZTogJ3ZpZGVvJyxcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiAyLFxuICAgICAgICBlbmFibGVSZWNvcmRpbmc6IGZhbHNlLFxuICAgICAgICBlbmFibGVDaGF0OiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QodmlkZW9Sb29tLnJvb21JZCkudG9CZURlZmluZWQoKTtcblxuICAgICAgLy8gVXBkYXRlIHN0YXR1cyB0byBpbi1wcm9ncmVzc1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS51cGRhdGVNZWV0aW5nU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja01lZXRpbmcsIHN0YXR1czogJ2luLXByb2dyZXNzJyB9KTtcbiAgICAgIGNvbnN0IHVwZGF0ZWRNZWV0aW5nID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVNZWV0aW5nU3RhdHVzKCdtZWV0aW5nXzEyMycsIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCB7XG4gICAgICAgIHN0YXR1czogJ2luLXByb2dyZXNzJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRNZWV0aW5nLnN0YXR1cykudG9CZSgnaW4tcHJvZ3Jlc3MnKTtcblxuICAgICAgLy8gU2F2ZSBzZXNzaW9uIGRhdGFcbiAgICAgIG1vY2tNZWV0aW5nc1NlcnZpY2UuZ2V0TWVldGluZ0J5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja01lZXRpbmcpO1xuICAgICAgbW9ja01lZXRpbmdzU2VydmljZS5zYXZlTWVldGluZ1Nlc3Npb24ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Nlc3Npb25fMTIzJyxcbiAgICAgICAgbWVldGluZ0lkOiAnbWVldGluZ18xMjMnLFxuICAgICAgICBkdXJhdGlvbjogMzYwMCxcbiAgICAgICAgbm90ZXM6ICdTZXNzaW9uIGNvbXBsZXRlZCcsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBjb250cm9sbGVyLnNhdmVNZWV0aW5nU2Vzc2lvbignbWVldGluZ18xMjMnLCBURVNUX1VTRVJfSURTLlRIRVJBUElTVCwge1xuICAgICAgICBkdXJhdGlvbjogMzYwMCxcbiAgICAgICAgbm90ZXM6ICdTZXNzaW9uIGNvbXBsZXRlZCcsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzZXNzaW9uLmlkKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==