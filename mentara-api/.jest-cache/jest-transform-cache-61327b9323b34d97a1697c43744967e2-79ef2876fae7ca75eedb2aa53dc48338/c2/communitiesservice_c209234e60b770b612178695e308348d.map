{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/communities.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/communities.service.ts"],"sourcesContent":["import {\n  Injectable,\n  ConflictException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { RoomGroup, Room } from '@prisma/client';\nimport type {\n  CommunityCreateInputDto,\n  CommunityUpdateInputDto,\n  CommunityResponse,\n  CommunityStatsResponse,\n} from './types';\n\n// Extended response interfaces for complex operations\nexport interface CommunityWithMembersResponse extends CommunityResponse {\n  members: any[];\n}\n\nexport interface CommunityWithRoomGroupsResponse extends CommunityResponse {\n  roomGroups: Array<{\n    id: string;\n    name: string;\n    order: number;\n    communityId: string;\n    rooms: Array<{\n      id: string;\n      name: string;\n      order: number;\n      postingRole: string;\n      roomGroupId: string;\n    }>;\n  }>;\n}\n\n@Injectable()\nexport class CommunitiesService {\n  constructor(private readonly prisma: PrismaService) {}\n\n  async findAllWithStructure(): Promise<CommunityWithRoomGroupsResponse[]> {\n    return await this.prisma.community.findMany({\n      orderBy: { createdAt: 'desc' },\n      include: {\n        roomGroups: {\n          include: {\n            rooms: true,\n          },\n        },\n      },\n    });\n  }\n\n  async findOneWithStructure(\n    id: string,\n  ): Promise<CommunityWithRoomGroupsResponse | null> {\n    return await this.prisma.community.findUniqueOrThrow({\n      where: { id },\n      include: {\n        roomGroups: {\n          include: {\n            rooms: true,\n          },\n        },\n      },\n    });\n  }\n\n  async createRoomGroup(\n    communityId: string,\n    name: string,\n    order: number,\n  ): Promise<RoomGroup> {\n    try {\n      return await this.prisma.roomGroup.create({\n        data: {\n          name,\n          order,\n          community: {\n            connect: {\n              id: communityId,\n            },\n          },\n        },\n      });\n    } catch (error) {\n      throw new ConflictException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async createRoom(\n    roomGroupId: string,\n    name: string,\n    order: number,\n  ): Promise<Room> {\n    return await this.prisma.room.create({\n      data: {\n        name,\n        order,\n        roomGroupId,\n      },\n    });\n  }\n\n  async findRoomsByGroup(roomGroupId: string): Promise<Room[]> {\n    return await this.prisma.room.findMany({\n      where: { roomGroupId },\n      orderBy: { order: 'asc' },\n    });\n  }\n\n  async findAll(): Promise<CommunityResponse[]> {\n    const communities = await this.prisma.community.findMany({\n      orderBy: { createdAt: 'desc' },\n    });\n\n    return communities.map((community) => community);\n  }\n\n  async findOne(id: string): Promise<CommunityResponse | null> {\n    const community = await this.prisma.community.findUnique({\n      where: { id },\n    });\n    if (!community) return null;\n    return community;\n  }\n\n  async findBySlug(slug: string): Promise<CommunityResponse | null> {\n    const community = await this.prisma.community.findUnique({\n      where: { slug },\n    });\n    if (!community) return null;\n    return community;\n  }\n\n  async createCommunity(\n    data: CommunityCreateInputDto,\n  ): Promise<CommunityResponse> {\n    const community = await this.prisma.community.create({\n      data: {\n        name: data.name,\n        slug:\n          (data as any).slug ||\n          data.name?.toLowerCase().replace(/\\s+/g, '-') ||\n          'untitled',\n        description: data.description,\n        imageUrl: (data as any).imageUrl || null,\n      },\n    });\n    return community;\n  }\n\n  async update(\n    id: string,\n    data: CommunityUpdateInputDto,\n  ): Promise<CommunityResponse> {\n    const community = await this.prisma.community.update({\n      where: { id },\n      data: {\n        name: data.name,\n        slug:\n          (data as any).slug ||\n          data.name?.toLowerCase().replace(/\\s+/g, '-') ||\n          'untitled',\n        description: data.description,\n        imageUrl: (data as any).imageUrl || null,\n      },\n    });\n    return community;\n  }\n\n  async remove(id: string): Promise<CommunityResponse> {\n    const community = await this.prisma.community.delete({\n      where: { id },\n    });\n    return community;\n  }\n\n  async findByUserId(userId: string): Promise<CommunityResponse[]> {\n    const memberships = await this.prisma.membership.findMany({\n      where: { userId },\n      include: {\n        community: true,\n      },\n    });\n    return memberships.map((membership) => membership.community);\n  }\n\n  async joinCommunity(\n    communityId: string,\n    userId: string,\n    role: string = 'MEMBER',\n  ): Promise<void> {\n    const existingMembership = await this.prisma.membership.findFirst({\n      where: {\n        communityId,\n        userId,\n      },\n    });\n\n    if (existingMembership) {\n      throw new ConflictException('User is already a member of this community');\n    }\n\n    await this.prisma.membership.create({\n      data: {\n        userId,\n        communityId,\n      },\n    });\n  }\n\n  async leaveCommunity(communityId: string, userId: string): Promise<void> {\n    const membership = await this.prisma.membership.findFirstOrThrow({\n      where: {\n        communityId,\n        userId,\n      },\n    });\n    await this.prisma.membership.delete({\n      where: { id: membership.id },\n    });\n  }\n\n  async getMembers(\n    communityId: string,\n    limit: number = 50,\n    offset: number = 0,\n  ): Promise<CommunityWithMembersResponse> {\n    const community = await this.prisma.community.findUnique({\n      where: { id: communityId },\n      include: {\n        memberships: {\n          skip: offset,\n          take: limit,\n          include: {\n            user: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n                avatarUrl: true,\n              },\n            },\n          },\n          orderBy: { joinedAt: 'desc' },\n        },\n      },\n    });\n    if (!community) {\n      throw new NotFoundException('Community not found');\n    }\n    return {\n      ...community,\n      members: community.memberships\n        .filter(\n          (membership) =>\n            membership.userId !== null && membership.user !== null,\n        )\n        .map((membership) => ({\n          ...membership,\n          userId: membership.userId!,\n          user: membership.user!,\n        })),\n    };\n  }\n\n  async getStats(): Promise<CommunityStatsResponse> {\n    const [totalMembers, totalPosts, activeCommunities] = await Promise.all([\n      this.prisma.membership.count(),\n      this.prisma.post.count(),\n      this.prisma.community.count(),\n    ]);\n\n    return {\n      totalMembers,\n      totalPosts,\n      activeCommunities,\n      illnessCommunities: [],\n    };\n  }\n\n  // New methods for community posts and content management\n\n  async getMyMemberships(userId: string) {\n    return await this.prisma.membership.findMany({\n      where: { userId },\n      include: {\n        community: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            description: true,\n            imageUrl: true,\n          },\n        },\n      },\n      orderBy: { joinedAt: 'desc' },\n    });\n  }\n\n  async getPostsByRoom(roomId: string, page: number = 1, limit: number = 20) {\n    const skip = (page - 1) * limit;\n    \n    const [posts, total] = await Promise.all([\n      this.prisma.post.findMany({\n        where: { roomId },\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              avatarUrl: true,\n            },\n          },\n          hearts: {\n            select: {\n              id: true,\n              userId: true,\n              postId: true,\n            },\n          },\n          _count: {\n            select: {\n              hearts: true,\n              comments: true,\n            },\n          },\n        },\n        orderBy: { createdAt: 'desc' },\n        skip,\n        take: limit,\n      }),\n      this.prisma.post.count({ where: { roomId } }),\n    ]);\n\n    return {\n      posts,\n      pagination: {\n        total,\n        page,\n        limit,\n      },\n    };\n  }\n\n  async createPost(\n    title: string, \n    content: string, \n    roomId: string, \n    userId: string,\n    attachmentUrls: string[] = [],\n    attachmentNames: string[] = [],\n    attachmentSizes: number[] = [],\n  ) {\n    // First verify the room exists and user has access\n    const room = await this.prisma.room.findUniqueOrThrow({\n      where: { id: roomId },\n      include: {\n        roomGroup: {\n          include: {\n            community: {\n              include: {\n                memberships: {\n                  where: { userId },\n                },\n              },\n            },\n          },\n        },\n      },\n    });\n\n    // Check if user is a member of the community\n    if (room.roomGroup.community.memberships.length === 0) {\n      throw new ConflictException('User is not a member of this community');\n    }\n\n    // Check posting permissions based on room posting role\n    const user = await this.prisma.user.findUniqueOrThrow({\n      where: { id: userId },\n      select: { role: true },\n    });\n\n    const canPost = this.checkPostingPermission(room.postingRole, user.role);\n    if (!canPost) {\n      throw new ConflictException('User does not have permission to post in this room');\n    }\n\n    return await this.prisma.post.create({\n      data: {\n        title,\n        content,\n        roomId,\n        userId,\n        attachmentUrls,\n        attachmentNames,\n        attachmentSizes,\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        hearts: {\n          select: {\n            id: true,\n            userId: true,\n            postId: true,\n          },\n        },\n        _count: {\n          select: {\n            hearts: true,\n            comments: true,\n          },\n        },\n      },\n    });\n  }\n\n  private checkPostingPermission(roomPostingRole: string, userRole: string): boolean {\n    const roleHierarchy = {\n      'client': 0,\n      'therapist': 1,\n      'moderator': 2,\n      'admin': 3,\n    };\n\n    const userRoleLevel = roleHierarchy[userRole as keyof typeof roleHierarchy] ?? 0;\n\n    switch (roomPostingRole) {\n      case 'member':\n        return userRoleLevel >= 0;\n      case 'therapist':\n        return userRoleLevel >= 1;\n      case 'moderator':\n        return userRoleLevel >= 2;\n      case 'admin':\n        return userRoleLevel >= 3;\n      default:\n        return userRoleLevel >= 0;\n    }\n  }\n\n  async heartPost(postId: string, userId: string) {\n    // Check if heart already exists\n    const existingHeart = await this.prisma.postHeart.findUnique({\n      where: {\n        postId_userId: {\n          postId,\n          userId,\n        },\n      },\n    });\n\n    if (existingHeart) {\n      throw new ConflictException('Post already hearted by this user');\n    }\n\n    return await this.prisma.postHeart.create({\n      data: {\n        postId,\n        userId,\n      },\n    });\n  }\n\n  async unheartPost(postId: string, userId: string) {\n    const heart = await this.prisma.postHeart.findUnique({\n      where: {\n        postId_userId: {\n          postId,\n          userId,\n        },\n      },\n    });\n\n    if (!heart) {\n      throw new NotFoundException('Heart not found');\n    }\n\n    return await this.prisma.postHeart.delete({\n      where: {\n        postId_userId: {\n          postId,\n          userId,\n        },\n      },\n    });\n  }\n\n  async getJoinedCommunities(userId: string): Promise<CommunityWithRoomGroupsResponse[]> {\n    const memberships = await this.prisma.membership.findMany({\n      where: { userId },\n      include: {\n        community: {\n          include: {\n            roomGroups: {\n              include: {\n                rooms: true,\n              },\n              orderBy: { order: 'asc' },\n            },\n          },\n        },\n      },\n      orderBy: { joinedAt: 'desc' },\n    });\n\n    return memberships.map(membership => membership.community);\n  }\n\n  async getRecommendedCommunities(userId: string): Promise<CommunityWithRoomGroupsResponse[]> {\n    // For now, return communities the user is not yet a member of\n    // This can be enhanced with actual recommendation logic later\n    const userCommunityIds = await this.prisma.membership.findMany({\n      where: { userId },\n      select: { communityId: true },\n    });\n\n    const excludeIds = userCommunityIds.map(m => m.communityId);\n\n    return await this.prisma.community.findMany({\n      where: {\n        id: {\n          notIn: excludeIds,\n        },\n      },\n      include: {\n        roomGroups: {\n          include: {\n            rooms: true,\n          },\n          orderBy: { order: 'asc' },\n        },\n      },\n      take: 5,\n      orderBy: { createdAt: 'desc' },\n    });\n  }\n\n  async getRecentActivity(userId: string) {\n    // Get recent posts from communities the user is a member of\n    const userCommunityIds = await this.prisma.membership.findMany({\n      where: { userId },\n      select: { communityId: true },\n    });\n\n    const communityIds = userCommunityIds.map(m => m.communityId);\n\n    const recentPosts = await this.prisma.post.findMany({\n      where: {\n        room: {\n          roomGroup: {\n            communityId: {\n              in: communityIds,\n            },\n          },\n        },\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            avatarUrl: true,\n          },\n        },\n        room: {\n          include: {\n            roomGroup: {\n              include: {\n                community: {\n                  select: {\n                    id: true,\n                    name: true,\n                  },\n                },\n              },\n            },\n          },\n        },\n        _count: {\n          select: {\n            hearts: true,\n            comments: true,\n          },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n      take: 10,\n    });\n\n    return recentPosts\n      .filter(post => post.room) // Filter out posts without rooms\n      .map(post => ({\n        type: 'post',\n        id: post.id,\n        title: post.title,\n        content: post.content,\n        createdAt: post.createdAt,\n        user: post.user,\n        community: post.room!.roomGroup.community,\n        _count: post._count,\n      }));\n  }\n}\n"],"version":3}