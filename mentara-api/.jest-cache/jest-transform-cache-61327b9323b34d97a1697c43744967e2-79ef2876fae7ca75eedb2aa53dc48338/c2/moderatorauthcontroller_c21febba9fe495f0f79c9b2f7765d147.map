{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/moderator-auth.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/moderator-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  Post,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Req,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../decorators/current-user-role.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterModeratorDto,\n  LoginDto,\n} from '../types';\n\n// Import validation schemas from local validation\nimport {\n  RegisterModeratorDtoSchema,\n  LoginDtoSchema,\n} from '../validation';\nimport { ModeratorAuthService } from '../services/moderator-auth.service';\nimport { Request } from 'express';\n\n@Controller('auth/moderator')\nexport class ModeratorAuthController {\n  constructor(private readonly moderatorAuthService: ModeratorAuthService) {}\n\n  @Post('create-account')\n  @UseGuards(JwtAuthGuard)\n  @Throttle({ default: { limit: 5, ttl: 600000 } }) // 5 moderator creations per 10 minutes\n  @HttpCode(HttpStatus.CREATED)\n  async createModeratorAccount(\n    @CurrentUserRole() currentUserRole: string,\n    @Body(new ZodValidationPipe(RegisterModeratorDtoSchema))\n    registerDto: RegisterModeratorDto,\n  ) {\n    // Only admins can create moderators\n    if (currentUserRole !== 'admin') {\n      throw new ForbiddenException('Only admins can create moderator accounts');\n    }\n\n    const result = await this.moderatorAuthService.createModeratorAccount(\n      registerDto.email,\n      registerDto.password,\n      registerDto.firstName,\n      registerDto.lastName,\n      (registerDto as any).permissions || [],\n      (registerDto as any).assignedCommunities || [],\n    );\n\n    return {\n      user: {\n        id: result.user.id,\n        email: result.user.email,\n        firstName: result.user.firstName,\n        lastName: result.user.lastName,\n        role: result.user.role,\n        emailVerified: result.user.emailVerified,\n      },\n      message: result.message,\n    };\n  }\n\n  // REMOVED: Duplicate login route - use universal /auth/login instead\n  // This was redundant with AuthController.login() which handles all roles\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getModeratorProfile(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('permissions')\n  async getPermissions(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getModeratorPermissions(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('assigned-communities')\n  async getAssignedCommunities(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getAssignedCommunities(userId);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Get('dashboard-stats')\n  async getDashboardStats(@CurrentUserId() userId: string) {\n    return this.moderatorAuthService.getModeratorDashboardStats(userId);\n  }\n}\n"],"version":3}