{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/booking.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/booking.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  Param,\n  Post,\n  Put,\n  Query,\n  UseGuards,\n  UnauthorizedException,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from '../auth/decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../auth/decorators/current-user-role.decorator';\nimport { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';\nimport { BookingService } from './booking.service';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBody,\n  ApiBearerAuth,\n  ApiParam,\n  ApiQuery,\n} from '@nestjs/swagger';\nimport {\n  TherapistAvailabilityCreateDto,\n  TherapistAvailabilityUpdateDto,\n  MeetingCreateDto,\n  MeetingUpdateDto,\n  BookingMeetingParamsDtoSchema,\n  AvailabilityParamsDtoSchema,\n  GetAvailableSlotsQueryDtoSchema,\n  type BookingMeetingParamsDto,\n  type AvailabilityParamsDto,\n  type GetAvailableSlotsQueryDto,\n} from 'mentara-commons';\n\n@ApiTags('booking')\n@ApiBearerAuth('JWT-auth')\n@Controller('booking')\n@UseGuards(JwtAuthGuard)\nexport class BookingController {\n  constructor(private readonly bookingService: BookingService) {}\n\n  // Meeting endpoints\n  @Post('meetings')\n  @ApiOperation({\n    summary: 'Create create meeting',\n\n    description: 'Create create meeting',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async createMeeting(\n    @Body() createMeetingDto: MeetingCreateDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    // Only clients can book meetings, but we'll validate the relationship in the service\n    if (role !== 'client') {\n      throw new ForbiddenException('Only clients can book meetings');\n    }\n    return this.bookingService.createMeeting(createMeetingDto, userId);\n  }\n\n  @Get('meetings')\n  @ApiOperation({\n    summary: 'Retrieve get meetings',\n\n    description: 'Retrieve get meetings',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async getMeetings(\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.getMeetings(userId, role);\n  }\n\n  @Get('meetings/:id')\n  @ApiOperation({\n    summary: 'Retrieve get meeting',\n\n    description: 'Retrieve get meeting',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async getMeeting(\n    @Param(new ZodValidationPipe(BookingMeetingParamsDtoSchema))\n    params: BookingMeetingParamsDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.getMeeting(params.id, userId, role);\n  }\n\n  @Put('meetings/:id')\n  @ApiOperation({\n    summary: 'Update update meeting',\n\n    description: 'Update update meeting',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Updated successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async updateMeeting(\n    @Param(new ZodValidationPipe(BookingMeetingParamsDtoSchema))\n    params: BookingMeetingParamsDto,\n    @Body() updateMeetingDto: MeetingUpdateDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.updateMeeting(\n      params.id,\n      updateMeetingDto,\n      userId,\n      role,\n    );\n  }\n\n  @Delete('meetings/:id/cancel')\n  @ApiOperation({\n    summary: 'Delete cancel meeting',\n\n    description: 'Delete cancel meeting',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Deleted successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async cancelMeeting(\n    @Param(new ZodValidationPipe(BookingMeetingParamsDtoSchema))\n    params: BookingMeetingParamsDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.cancelMeeting(params.id, userId, role);\n  }\n\n  // Availability endpoints (therapist only)\n  @Post('availability')\n  @ApiOperation({\n    summary: 'Create create availability',\n\n    description: 'Create create availability',\n  })\n  @ApiResponse({\n    status: 201,\n\n    description: 'Created successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async createAvailability(\n    @Body() createAvailabilityDto: TherapistAvailabilityCreateDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can manage availability',\n      );\n    }\n    return this.bookingService.createAvailability(\n      createAvailabilityDto,\n      therapistId,\n    );\n  }\n\n  @Get('availability')\n  @ApiOperation({\n    summary: 'Retrieve get availability',\n\n    description: 'Retrieve get availability',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async getAvailability(\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can view their availability',\n      );\n    }\n    return this.bookingService.getAvailability(therapistId);\n  }\n\n  @Put('availability/:id')\n  @ApiOperation({\n    summary: 'Update update availability',\n\n    description: 'Update update availability',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Updated successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async updateAvailability(\n    @Param(new ZodValidationPipe(AvailabilityParamsDtoSchema))\n    params: AvailabilityParamsDto,\n    @Body() updateAvailabilityDto: TherapistAvailabilityUpdateDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can update availability',\n      );\n    }\n    return this.bookingService.updateAvailability(\n      params.id,\n      updateAvailabilityDto,\n      therapistId,\n    );\n  }\n\n  @Delete('availability/:id')\n  @ApiOperation({\n    summary: 'Delete delete availability',\n\n    description: 'Delete delete availability',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Deleted successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  async deleteAvailability(\n    @Param(new ZodValidationPipe(AvailabilityParamsDtoSchema))\n    params: AvailabilityParamsDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can delete availability',\n      );\n    }\n    return this.bookingService.deleteAvailability(params.id, therapistId);\n  }\n\n  // Duration endpoints (public)\n  @Get('durations')\n  @ApiOperation({\n    summary: 'Retrieve get available slots',\n\n    description: 'Retrieve get available slots',\n  })\n  @ApiResponse({\n    status: 200,\n\n    description: 'Retrieved successfully',\n  })\n  @ApiResponse({ status: 401, description: 'Unauthorized' })\n  getDurations() {\n    return this.bookingService.getDurations();\n  }\n\n  // Available slots endpoint\n  @Get('slots')\n  async getAvailableSlots(\n    @Query(new ZodValidationPipe(GetAvailableSlotsQueryDtoSchema))\n    query: GetAvailableSlotsQueryDto,\n  ) {\n    return this.bookingService.getAvailableSlots(query.therapistId, query.date);\n  }\n}\n"],"version":3}