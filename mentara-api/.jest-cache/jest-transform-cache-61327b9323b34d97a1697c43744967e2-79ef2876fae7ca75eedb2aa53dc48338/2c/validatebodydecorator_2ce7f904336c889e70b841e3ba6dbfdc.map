{"version":3,"names":["cov_28egmf8c7h","actualCoverage","s","common_1","require","mentara_commons_1","exports","ValidatedBody","createParamDecorator","schema","ctx","f","request","switchToHttp","getRequest","body","b","Error","result","validateSchema","success","errorMessage","formatValidationErrors","errors","BadRequestException","data","ValidatedQuery","query","processedQuery","Object","entries","forEach","key","value","undefined","isNaN","Number","ValidatedParams","params"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/decorators/validate-body.decorator.ts"],"sourcesContent":["import {\n  createParamDecorator,\n  ExecutionContext,\n  BadRequestException,\n} from '@nestjs/common';\nimport { z } from 'zod';\nimport { validateSchema, formatValidationErrors } from 'mentara-commons';\n\n// Body validation decorator that validates request body using Zod schemas\nexport const ValidatedBody = createParamDecorator(\n  (schema: any, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    const body = request.body;\n\n    if (!schema) {\n      throw new Error('Schema is required for ValidatedBody decorator');\n    }\n\n    const result = validateSchema(schema, body);\n\n    if (!result.success) {\n      const errorMessage = formatValidationErrors(result.errors);\n      throw new BadRequestException(`Validation failed: ${errorMessage}`);\n    }\n\n    return result.data;\n  },\n);\n\n// Query validation decorator for query parameters\nexport const ValidatedQuery = createParamDecorator(\n  (schema: any, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    const query = request.query;\n\n    if (!schema) {\n      throw new Error('Schema is required for ValidatedQuery decorator');\n    }\n\n    // Convert query parameters to appropriate types\n    const processedQuery: Record<string, any> = {};\n    Object.entries(query).forEach(([key, value]) => {\n      if (typeof value === 'string') {\n        // Try to coerce string values\n        if (value === 'true') {\n          processedQuery[key] = true;\n        } else if (value === 'false') {\n          processedQuery[key] = false;\n        } else if (value === 'null') {\n          processedQuery[key] = null;\n        } else if (value === 'undefined') {\n          processedQuery[key] = undefined;\n        } else if (!isNaN(Number(value)) && value !== '') {\n          processedQuery[key] = Number(value);\n        } else {\n          processedQuery[key] = value;\n        }\n      } else {\n        processedQuery[key] = value;\n      }\n    });\n\n    const result = validateSchema(schema, processedQuery);\n\n    if (!result.success) {\n      const errorMessage = formatValidationErrors(result.errors);\n      throw new BadRequestException(`Query validation failed: ${errorMessage}`);\n    }\n\n    return result.data;\n  },\n);\n\n// Params validation decorator for path parameters\nexport const ValidatedParams = createParamDecorator(\n  (schema: any, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    const params = request.params;\n\n    if (!schema) {\n      throw new Error('Schema is required for ValidatedParams decorator');\n    }\n\n    const result = validateSchema(schema, params);\n\n    if (!result.success) {\n      const errorMessage = formatValidationErrors(result.errors);\n      throw new BadRequestException(\n        `Path parameter validation failed: ${errorMessage}`,\n      );\n    }\n\n    return result.data;\n  },\n);\n"],"mappings":"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","ignoreList":[]}