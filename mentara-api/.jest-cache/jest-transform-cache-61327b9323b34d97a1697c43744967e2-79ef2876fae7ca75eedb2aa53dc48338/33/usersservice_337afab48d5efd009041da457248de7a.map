{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/users/users.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/users/users.service.ts"],"sourcesContent":["import { Injectable, InternalServerErrorException } from '@nestjs/common';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { User, Prisma } from '@prisma/client';\nimport { UserRole } from 'src/utils/role-utils';\nimport { EventBusService } from '../common/events/event-bus.service';\nimport {\n  UserRegisteredEvent,\n  UserProfileUpdatedEvent,\n  UserDeactivatedEvent,\n  UserReactivatedEvent,\n} from '../common/events/user-events';\n\n@Injectable()\nexport class UsersService {\n  constructor(\n    private prisma: PrismaService,\n    private eventBus: EventBusService,\n  ) {}\n\n  async findById(id: string): Promise<User | null> {\n    return await this.prisma.user.findUnique({\n      where: {\n        id,\n        isActive: true, // Only return active users by default\n      },\n    });\n  }\n\n  async findByIdIncludeInactive(id: string): Promise<User | null> {\n    // For administrative purposes - can see inactive users\n    return await this.prisma.user.findUnique({\n      where: { id },\n    });\n  }\n\n  async findAll(): Promise<User[]> {\n    try {\n      return await this.prisma.user.findMany({\n        where: { isActive: true },\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findOne(id: string): Promise<User | null> {\n    try {\n      return await this.prisma.user.findUnique({\n        where: {\n          id,\n          isActive: true, // Only return active users\n        },\n        include: { therapist: true },\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findOneIncludeInactive(id: string): Promise<User | null> {\n    // For administrative purposes\n    try {\n      return await this.prisma.user.findUnique({\n        where: { id },\n        include: {\n          therapist: true,\n          client: true,\n          admin: true,\n          moderator: true,\n        },\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async findByRole(role: string): Promise<User[]> {\n    return await this.prisma.user.findMany({\n      where: {\n        role,\n        isActive: true, // Only return active users\n      },\n    });\n  }\n\n  async findAllIncludeInactive(): Promise<User[]> {\n    // For administrative purposes - include inactive users\n    try {\n      return await this.prisma.user.findMany({\n        orderBy: { createdAt: 'desc' },\n      });\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : String(error),\n      );\n    }\n  }\n\n  async update(id: string, data: Prisma.UserUpdateInput): Promise<User> {\n    try {\n      // Get previous values for audit trail\n      const previousUser = await this.findById(id);\n      if (!previousUser) {\n        throw new InternalServerErrorException('User not found');\n      }\n\n      const updatedUser = await this.prisma.user.update({\n        where: { id },\n        data,\n      });\n\n      // Publish profile updated event\n      await this.eventBus.emit(\n        new UserProfileUpdatedEvent({\n          userId: id,\n          updatedFields: Object.keys(data),\n          previousValues: this.extractUserFields(previousUser),\n          newValues: this.extractUserFields(updatedUser),\n        }),\n      );\n\n      return updatedUser;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to update user: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async remove(id: string): Promise<User> {\n    try {\n      // Implement soft delete for HIPAA compliance\n      const deactivatedUser = await this.prisma.user.update({\n        where: { id },\n        data: {\n          isActive: false,\n          suspendedAt: new Date(),\n          suspensionReason: 'Account deactivated by user',\n          // Keep all data intact for compliance\n        },\n      });\n\n      // Publish user deactivation event\n      await this.eventBus.emit(\n        new UserDeactivatedEvent({\n          userId: id,\n          reason: 'Account deactivated by user',\n          deactivatedBy: id, // Self-deactivation\n          isTemporary: false,\n        }),\n      );\n\n      return deactivatedUser;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to deactivate user: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async deactivate(\n    id: string,\n    reason?: string,\n    deactivatedBy?: string,\n  ): Promise<User> {\n    try {\n      // Administrative deactivation with audit trail\n      const deactivatedUser = await this.prisma.user.update({\n        where: { id },\n        data: {\n          isActive: false,\n          suspendedAt: new Date(),\n          suspendedBy: deactivatedBy,\n          suspensionReason: reason || 'Account deactivated by administrator',\n        },\n      });\n\n      // Publish user deactivation event\n      await this.eventBus.emit(\n        new UserDeactivatedEvent({\n          userId: id,\n          reason: reason || 'Account deactivated by administrator',\n          deactivatedBy: deactivatedBy || 'system',\n          isTemporary: true, // Administrative deactivations are typically temporary\n        }),\n      );\n\n      return deactivatedUser;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to deactivate user: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async reactivate(id: string, reactivatedBy?: string): Promise<User> {\n    try {\n      // Get user info for calculating inactive duration\n      const user = await this.findByIdIncludeInactive(id);\n      if (!user) {\n        throw new InternalServerErrorException('User not found');\n      }\n\n      const inactiveDuration = user.suspendedAt\n        ? Math.floor(\n            (Date.now() - user.suspendedAt.getTime()) / (1000 * 60 * 60 * 24),\n          )\n        : 0;\n\n      const reactivatedUser = await this.prisma.user.update({\n        where: { id },\n        data: {\n          isActive: true,\n          suspendedAt: null,\n          suspendedBy: null,\n          suspensionReason: null,\n        },\n      });\n\n      // Publish user reactivation event\n      await this.eventBus.emit(\n        new UserReactivatedEvent({\n          userId: id,\n          reactivatedBy: reactivatedBy || 'system',\n          inactiveDuration,\n        }),\n      );\n\n      return reactivatedUser;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to reactivate user: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  async permanentDelete(id: string): Promise<User> {\n    // Only for extreme cases with proper authorization\n    // This should only be called by super admins after proper data retention period\n    return await this.prisma.user.delete({\n      where: { id },\n    });\n  }\n\n  async getUserRole(id: string): Promise<UserRole | null> {\n    const user = await this.prisma.user.findUnique({\n      where: { id },\n      select: { role: true },\n    });\n    return (user?.role as UserRole) || null;\n  }\n\n  // Add a user creation method that publishes events\n  async create(data: Prisma.UserCreateInput): Promise<User> {\n    try {\n      const newUser = await this.prisma.user.create({\n        data,\n      });\n\n      // Publish user registration event\n      await this.eventBus.emit(\n        new UserRegisteredEvent({\n          userId: newUser.id,\n          email: newUser.email,\n          firstName: newUser.firstName,\n          lastName: newUser.lastName,\n          role: newUser.role as 'client' | 'therapist' | 'moderator' | 'admin',\n          registrationMethod: 'email', // Default, can be enhanced later\n        }),\n      );\n\n      return newUser;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        `Failed to create user: ${error instanceof Error ? error.message : String(error)}`,\n      );\n    }\n  }\n\n  // Helper method to extract relevant user fields for events\n  private extractUserFields(user: User): Record<string, any> {\n    return {\n      id: user.id,\n      email: user.email,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      middleName: user.middleName,\n      role: user.role,\n      isActive: user.isActive,\n      avatarUrl: user.avatarUrl,\n      birthDate: user.birthDate,\n      address: user.address,\n      // Remove unsupported properties - these don't exist in User model\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt,\n    };\n  }\n}\n"],"version":3}