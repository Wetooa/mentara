f16df9c5cced557f64f1c56be9577443
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const therapist_client_controller_1 = require("./therapist-client.controller");
const therapist_management_service_1 = require("../therapist-management.service");
const test_utils_1 = require("../../test-utils");
const enhanced_test_helpers_1 = require("../../test-utils/enhanced-test-helpers");
describe('TherapistClientController', () => {
    let controller;
    let therapistManagementService;
    const mockTherapistManagementService = {
        getAssignedPatients: jest.fn(),
        getAllClients: jest.fn(),
        getClientById: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [therapist_client_controller_1.TherapistClientController],
            providers: [
                {
                    provide: therapist_management_service_1.TherapistManagementService,
                    useValue: mockTherapistManagementService,
                },
            ],
        }).compile();
        controller = module.get(therapist_client_controller_1.TherapistClientController);
        therapistManagementService = module.get(therapist_management_service_1.TherapistManagementService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('getAssignedPatients', () => {
        it('should return assigned patients for therapist', async () => {
            const mockClients = [
                {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        id: test_utils_1.TEST_USER_IDS.CLIENT,
                        role: 'client',
                    }),
                    hasSeenTherapistRecommendations: true,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                },
                {
                    userId: 'client-2-user',
                    user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        id: 'client-2-user',
                        role: 'client',
                        firstName: 'Jane',
                        lastName: 'Smith',
                    }),
                    hasSeenTherapistRecommendations: false,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                },
            ];
            therapistManagementService.getAssignedPatients.mockResolvedValue(mockClients);
            const result = await controller.getAssignedPatients(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(therapistManagementService.getAssignedPatients).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockClients);
            expect(result).toHaveLength(2);
            expect(result[0]).toHaveProperty('userId', test_utils_1.TEST_USER_IDS.CLIENT);
        });
        it('should return empty array when therapist has no assigned patients', async () => {
            therapistManagementService.getAssignedPatients.mockResolvedValue([]);
            const result = await controller.getAssignedPatients(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(therapistManagementService.getAssignedPatients).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle unauthorized therapist access', async () => {
            therapistManagementService.getAssignedPatients.mockRejectedValue(new common_1.ForbiddenException('Not authorized to access this data'));
            await expect(controller.getAssignedPatients('unauthorized-therapist-id')).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle therapist not found', async () => {
            therapistManagementService.getAssignedPatients.mockRejectedValue(new common_1.NotFoundException('Therapist not found'));
            await expect(controller.getAssignedPatients('non-existent-therapist')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should handle service errors gracefully', async () => {
            therapistManagementService.getAssignedPatients.mockRejectedValue(new Error('Database connection failed'));
            await expect(controller.getAssignedPatients(test_utils_1.TEST_USER_IDS.THERAPIST)).rejects.toThrow('Database connection failed');
        });
    });
    describe('getAllClients', () => {
        it('should return all available clients for therapist', async () => {
            const mockAllClients = [
                {
                    userId: test_utils_1.TEST_USER_IDS.CLIENT,
                    user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        id: test_utils_1.TEST_USER_IDS.CLIENT,
                        role: 'client',
                    }),
                    hasSeenTherapistRecommendations: true,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                },
                {
                    userId: 'client-3-user',
                    user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        id: 'client-3-user',
                        role: 'client',
                        firstName: 'Bob',
                        lastName: 'Wilson',
                    }),
                    hasSeenTherapistRecommendations: true,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                },
            ];
            therapistManagementService.getAllClients.mockResolvedValue(mockAllClients);
            const result = await controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(therapistManagementService.getAllClients).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual(mockAllClients);
            expect(result).toHaveLength(2);
            // Verify client data structure
            expect(result[0]).toHaveProperty('userId', test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result[1]).toHaveProperty('userId', 'client-3-user');
        });
        it('should handle therapist with access to no clients', async () => {
            therapistManagementService.getAllClients.mockResolvedValue([]);
            const result = await controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result).toEqual([]);
            expect(result).toHaveLength(0);
        });
        it('should handle unauthorized access to client list', async () => {
            therapistManagementService.getAllClients.mockRejectedValue(new common_1.ForbiddenException('Insufficient permissions to view all clients'));
            await expect(controller.getAllClients('unauthorized-user')).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle database errors during client retrieval', async () => {
            therapistManagementService.getAllClients.mockRejectedValue(new Error('Query timeout'));
            await expect(controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST)).rejects.toThrow('Query timeout');
        });
        it('should return clients with complete profile information', async () => {
            const mockCompleteClient = {
                userId: 'complete-client-user',
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    role: 'client',
                    firstName: 'Complete',
                    lastName: 'Profile',
                    email: 'complete@example.com',
                    isActive: true,
                    isVerified: true,
                }),
                hasSeenTherapistRecommendations: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            therapistManagementService.getAllClients.mockResolvedValue([
                mockCompleteClient,
            ]);
            const result = await controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST);
            expect(result[0]).toHaveProperty('user');
            expect(result[0].user).toHaveProperty('firstName', 'Complete');
            expect(result[0].user).toHaveProperty('isActive', true);
            expect(result[0]).toHaveProperty('hasSeenTherapistRecommendations', true);
        });
    });
    describe('getClientById', () => {
        const clientId = 'specific-client-id';
        it('should return specific client by ID', async () => {
            const mockClient = {
                userId: test_utils_1.TEST_USER_IDS.CLIENT,
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    id: test_utils_1.TEST_USER_IDS.CLIENT,
                    role: 'client',
                    firstName: 'Specific',
                    lastName: 'Client',
                }),
                hasSeenTherapistRecommendations: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            therapistManagementService.getClientById.mockResolvedValue(mockClient);
            const result = await controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, clientId);
            expect(therapistManagementService.getClientById).toHaveBeenCalledWith(test_utils_1.TEST_USER_IDS.THERAPIST, clientId);
            expect(result).toEqual(mockClient);
            expect(result.userId).toBe(test_utils_1.TEST_USER_IDS.CLIENT);
            expect(result.user.firstName).toBe('Specific');
        });
        it('should handle client not found', async () => {
            therapistManagementService.getClientById.mockRejectedValue(new common_1.NotFoundException('Client not found'));
            await expect(controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'non-existent-client')).rejects.toThrow(common_1.NotFoundException);
        });
        it('should handle unauthorized access to specific client', async () => {
            therapistManagementService.getClientById.mockRejectedValue(new common_1.ForbiddenException('Not authorized to access this client'));
            await expect(controller.getClientById('unauthorized-therapist', clientId)).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle invalid client ID format', async () => {
            therapistManagementService.getClientById.mockRejectedValue(new common_1.BadRequestException('Invalid client ID format'));
            await expect(controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'invalid-id-format')).rejects.toThrow(common_1.BadRequestException);
        });
        it('should validate therapist-client relationship', async () => {
            const restrictedClient = {
                id: clientId,
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    role: 'client',
                    firstName: 'Restricted',
                    lastName: 'Access',
                }),
                therapistId: 'different-therapist-id', // Different therapist
                status: 'active',
            };
            therapistManagementService.getClientById.mockRejectedValue(new common_1.ForbiddenException('Client is not assigned to this therapist'));
            await expect(controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, clientId)).rejects.toThrow(common_1.ForbiddenException);
        });
        it('should handle database connection issues', async () => {
            therapistManagementService.getClientById.mockRejectedValue(new Error('Database connection lost'));
            await expect(controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, clientId)).rejects.toThrow('Database connection lost');
        });
        it('should return client with detailed relationship data', async () => {
            const detailedClient = {
                userId: 'detailed-client-user',
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    role: 'client',
                    firstName: 'Detailed',
                    lastName: 'Client',
                    email: 'detailed@example.com',
                }),
                hasSeenTherapistRecommendations: true,
                createdAt: new Date('2024-01-15'),
                updatedAt: new Date('2024-01-20'),
            };
            therapistManagementService.getClientById.mockResolvedValue(detailedClient);
            const result = await controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, clientId);
            expect(result).toHaveProperty('createdAt');
            expect(result).toHaveProperty('updatedAt');
            expect(result.createdAt).toBeInstanceOf(Date);
            expect(result.user.email).toBe('detailed@example.com');
        });
    });
    describe('Controller Integration Tests', () => {
        it('should handle complete client management workflow', async () => {
            const workflowClientId = 'workflow-client';
            // 1. Get all clients
            const allClients = [
                {
                    userId: 'workflow-user-id',
                    user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        id: 'workflow-user-id',
                        role: 'client',
                    }),
                    hasSeenTherapistRecommendations: false,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                },
            ];
            therapistManagementService.getAllClients.mockResolvedValue(allClients);
            // 2. Get assigned patients (empty initially)
            therapistManagementService.getAssignedPatients.mockResolvedValue([]);
            // 3. Get specific client details
            const specificClient = {
                userId: 'workflow-user-id',
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    id: 'workflow-user-id',
                    role: 'client',
                }),
                hasSeenTherapistRecommendations: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            therapistManagementService.getClientById.mockResolvedValue(specificClient);
            // Execute workflow
            const allClientsResult = await controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST);
            const assignedResult = await controller.getAssignedPatients(test_utils_1.TEST_USER_IDS.THERAPIST);
            const specificResult = await controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, workflowClientId);
            expect(allClientsResult).toHaveLength(1);
            expect(assignedResult).toHaveLength(0);
            expect(specificResult).toHaveProperty('userId', 'workflow-user-id');
            expect(specificResult.hasSeenTherapistRecommendations).toBe(true);
        });
        it('should maintain consistent client data across endpoints', async () => {
            const consistentClientId = 'consistent-client';
            const baseClientData = {
                userId: 'consistent-user-id',
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    id: 'consistent-user-id',
                    firstName: 'Consistent',
                    lastName: 'Client',
                    role: 'client',
                }),
                hasSeenTherapistRecommendations: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            // Set up consistent responses
            therapistManagementService.getAllClients.mockResolvedValue([
                baseClientData,
            ]);
            therapistManagementService.getAssignedPatients.mockResolvedValue([
                baseClientData,
            ]);
            therapistManagementService.getClientById.mockResolvedValue(baseClientData);
            // Execute all endpoints
            const allClients = await controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST);
            const assignedClients = await controller.getAssignedPatients(test_utils_1.TEST_USER_IDS.THERAPIST);
            const specificClient = await controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, consistentClientId);
            // Verify consistency
            expect(allClients[0].user.firstName).toBe('Consistent');
            expect(assignedClients[0].user.firstName).toBe('Consistent');
            expect(specificClient.user.firstName).toBe('Consistent');
            expect(allClients[0].userId).toBe('consistent-user-id');
            expect(assignedClients[0].userId).toBe('consistent-user-id');
            expect(specificClient.userId).toBe('consistent-user-id');
        });
    });
    describe('Error Handling and Edge Cases', () => {
        it('should handle null or undefined client data gracefully', async () => {
            therapistManagementService.getClientById.mockResolvedValue(null);
            const result = await controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'null-client');
            expect(result).toBeNull();
        });
        it('should handle malformed client responses', async () => {
            const malformedClient = {
                userId: 'malformed-user',
                // Missing required fields
                user: null,
                hasSeenTherapistRecommendations: undefined,
            };
            therapistManagementService.getClientById.mockResolvedValue(malformedClient);
            const result = await controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'malformed');
            expect(result.userId).toBe('malformed-user');
            expect(result.user).toBeNull();
        });
        it('should handle service timeout errors', async () => {
            therapistManagementService.getAllClients.mockRejectedValue(new Error('Operation timed out'));
            await expect(controller.getAllClients(test_utils_1.TEST_USER_IDS.THERAPIST)).rejects.toThrow('Operation timed out');
        });
        it('should handle concurrent requests appropriately', async () => {
            const concurrentClientData = {
                userId: 'concurrent-user',
                user: enhanced_test_helpers_1.TestDataGenerator.createUser({ role: 'client' }),
                hasSeenTherapistRecommendations: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            therapistManagementService.getClientById.mockResolvedValue(concurrentClientData);
            // Simulate concurrent requests
            const promises = [
                controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'concurrent-client'),
                controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'concurrent-client'),
                controller.getClientById(test_utils_1.TEST_USER_IDS.THERAPIST, 'concurrent-client'),
            ];
            const results = await Promise.all(promises);
            expect(results).toHaveLength(3);
            expect(results.every((r) => r.userId === 'concurrent-user')).toBe(true);
            expect(therapistManagementService.getClientById).toHaveBeenCalledTimes(3);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3RoZXJhcGlzdC9jb250cm9sbGVycy90aGVyYXBpc3QtY2xpZW50LmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCwyQ0FLd0I7QUFDeEIsK0VBQTBFO0FBQzFFLGtGQUE2RTtBQUM3RSxpREFBMEU7QUFDMUUsa0ZBR2dEO0FBRWhELFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7SUFDekMsSUFBSSxVQUFxQyxDQUFDO0lBQzFDLElBQUksMEJBQW1FLENBQUM7SUFFeEUsTUFBTSw4QkFBOEIsR0FBRztRQUNyQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzlCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3pCLENBQUM7SUFFRixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFdBQVcsRUFBRSxDQUFDLHVEQUF5QixDQUFDO1lBQ3hDLFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxPQUFPLEVBQUUseURBQTBCO29CQUNuQyxRQUFRLEVBQUUsOEJBQThCO2lCQUN6QzthQUNGO1NBQ0YsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsVUFBVSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQ3JCLHVEQUF5QixDQUMxQixDQUFDO1FBQ0YsMEJBQTBCLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyx5REFBMEIsQ0FBQyxDQUFDO0lBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFB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QUFpQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEUsTUFBTSxDQUFDLDBCQUEwQixDQUFDLGFBQWEsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdGhlcmFwaXN0L2NvbnRyb2xsZXJzL3RoZXJhcGlzdC1jbGllbnQuY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHtcbiAgSHR0cFN0YXR1cyxcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIEZvcmJpZGRlbkV4Y2VwdGlvbixcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVGhlcmFwaXN0Q2xpZW50Q29udHJvbGxlciB9IGZyb20gJy4vdGhlcmFwaXN0LWNsaWVudC5jb250cm9sbGVyJztcbmltcG9ydCB7IFRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlIH0gZnJvbSAnLi4vdGhlcmFwaXN0LW1hbmFnZW1lbnQuc2VydmljZSc7XG5pbXBvcnQgeyBjcmVhdGVNb2NrUHJpc21hU2VydmljZSwgVEVTVF9VU0VSX0lEUyB9IGZyb20gJy4uLy4uL3Rlc3QtdXRpbHMnO1xuaW1wb3J0IHtcbiAgVGVzdERhdGFHZW5lcmF0b3IsXG4gIFRlc3RBc3NlcnRpb25zLFxufSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2VuaGFuY2VkLXRlc3QtaGVscGVycyc7XG5cbmRlc2NyaWJlKCdUaGVyYXBpc3RDbGllbnRDb250cm9sbGVyJywgKCkgPT4ge1xuICBsZXQgY29udHJvbGxlcjogVGhlcmFwaXN0Q2xpZW50Q29udHJvbGxlcjtcbiAgbGV0IHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxUaGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZT47XG5cbiAgY29uc3QgbW9ja1RoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlID0ge1xuICAgIGdldEFzc2lnbmVkUGF0aWVudHM6IGplc3QuZm4oKSxcbiAgICBnZXRBbGxDbGllbnRzOiBqZXN0LmZuKCksXG4gICAgZ2V0Q2xpZW50QnlJZDogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW1RoZXJhcGlzdENsaWVudENvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBUaGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1RoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxUaGVyYXBpc3RDbGllbnRDb250cm9sbGVyPihcbiAgICAgIFRoZXJhcGlzdENsaWVudENvbnRyb2xsZXIsXG4gICAgKTtcbiAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZSA9IG1vZHVsZS5nZXQoVGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0QXNzaWduZWRQYXRpZW50cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhc3NpZ25lZCBwYXRpZW50cyBmb3IgdGhlcmFwaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NsaWVudHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHVzZXI6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogdHJ1ZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiAnY2xpZW50LTItdXNlcicsXG4gICAgICAgICAgdXNlcjogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICBpZDogJ2NsaWVudC0yLXVzZXInLFxuICAgICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgICAgICBmaXJzdE5hbWU6ICdKYW5lJyxcbiAgICAgICAgICAgIGxhc3ROYW1lOiAnU21pdGgnLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IGZhbHNlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBc3NpZ25lZFBhdGllbnRzLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtb2NrQ2xpZW50cyBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldEFzc2lnbmVkUGF0aWVudHMoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KFxuICAgICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBc3NpZ25lZFBhdGllbnRzLFxuICAgICAgKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChURVNUX1VTRVJfSURTLlRIRVJBUElTVCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDbGllbnRzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0pLnRvSGF2ZVByb3BlcnR5KCd1c2VySWQnLCBURVNUX1VTRVJfSURTLkNMSUVOVCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIHRoZXJhcGlzdCBoYXMgbm8gYXNzaWduZWQgcGF0aWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBc3NpZ25lZFBhdGllbnRzLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBc3NpZ25lZFBhdGllbnRzKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QXNzaWduZWRQYXRpZW50cyxcbiAgICAgICkudG9IYXZlQmVlbkNhbGxlZFdpdGgoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmF1dGhvcml6ZWQgdGhlcmFwaXN0IGFjY2VzcycsIGFzeW5jICgpID0+IHtcbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFzc2lnbmVkUGF0aWVudHMubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIGRhdGEnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRBc3NpZ25lZFBhdGllbnRzKCd1bmF1dGhvcml6ZWQtdGhlcmFwaXN0LWlkJyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdGhlcmFwaXN0IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFzc2lnbmVkUGF0aWVudHMubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVGhlcmFwaXN0IG5vdCBmb3VuZCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldEFzc2lnbmVkUGF0aWVudHMoJ25vbi1leGlzdGVudC10aGVyYXBpc3QnKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBc3NpZ25lZFBhdGllbnRzLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0QXNzaWduZWRQYXRpZW50cyhURVNUX1VTRVJfSURTLlRIRVJBUElTVCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEFsbENsaWVudHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYWxsIGF2YWlsYWJsZSBjbGllbnRzIGZvciB0aGVyYXBpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQWxsQ2xpZW50cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgdXNlcjogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICBpZDogVEVTVF9VU0VSX0lEUy5DTElFTlQsXG4gICAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6ICdjbGllbnQtMy11c2VyJyxcbiAgICAgICAgICB1c2VyOiBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVVc2VyKHtcbiAgICAgICAgICAgIGlkOiAnY2xpZW50LTMtdXNlcicsXG4gICAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICAgIGZpcnN0TmFtZTogJ0JvYicsXG4gICAgICAgICAgICBsYXN0TmFtZTogJ1dpbHNvbicsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogdHJ1ZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QWxsQ2xpZW50cy5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgbW9ja0FsbENsaWVudHMgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBbGxDbGllbnRzKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUKTtcblxuICAgICAgZXhwZWN0KHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFsbENsaWVudHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tBbGxDbGllbnRzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcblxuICAgICAgLy8gVmVyaWZ5IGNsaWVudCBkYXRhIHN0cnVjdHVyZVxuICAgICAgZXhwZWN0KHJlc3VsdFswXSkudG9IYXZlUHJvcGVydHkoJ3VzZXJJZCcsIFRFU1RfVVNFUl9JRFMuQ0xJRU5UKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMV0pLnRvSGF2ZVByb3BlcnR5KCd1c2VySWQnLCAnY2xpZW50LTMtdXNlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdGhlcmFwaXN0IHdpdGggYWNjZXNzIHRvIG5vIGNsaWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBbGxDbGllbnRzLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBbGxDbGllbnRzKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmF1dGhvcml6ZWQgYWNjZXNzIHRvIGNsaWVudCBsaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QWxsQ2xpZW50cy5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIHZpZXcgYWxsIGNsaWVudHMnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRBbGxDbGllbnRzKCd1bmF1dGhvcml6ZWQtdXNlcicpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBkdXJpbmcgY2xpZW50IHJldHJpZXZhbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFsbENsaWVudHMubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBFcnJvcignUXVlcnkgdGltZW91dCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldEFsbENsaWVudHMoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ1F1ZXJ5IHRpbWVvdXQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNsaWVudHMgd2l0aCBjb21wbGV0ZSBwcm9maWxlIGluZm9ybWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NvbXBsZXRlQ2xpZW50ID0ge1xuICAgICAgICB1c2VySWQ6ICdjb21wbGV0ZS1jbGllbnQtdXNlcicsXG4gICAgICAgIHVzZXI6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0NvbXBsZXRlJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1Byb2ZpbGUnLFxuICAgICAgICAgIGVtYWlsOiAnY29tcGxldGVAZXhhbXBsZS5jb20nLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIGlzVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgIH0pLFxuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFsbENsaWVudHMubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICBtb2NrQ29tcGxldGVDbGllbnQgYXMgYW55LFxuICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QWxsQ2xpZW50cyhURVNUX1VTRVJfSURTLlRIRVJBUElTVCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRbMF0pLnRvSGF2ZVByb3BlcnR5KCd1c2VyJyk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLnVzZXIpLnRvSGF2ZVByb3BlcnR5KCdmaXJzdE5hbWUnLCAnQ29tcGxldGUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0udXNlcikudG9IYXZlUHJvcGVydHkoJ2lzQWN0aXZlJywgdHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdKS50b0hhdmVQcm9wZXJ0eSgnaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9ucycsIHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0Q2xpZW50QnlJZCcsICgpID0+IHtcbiAgICBjb25zdCBjbGllbnRJZCA9ICdzcGVjaWZpYy1jbGllbnQtaWQnO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc3BlY2lmaWMgY2xpZW50IGJ5IElEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NsaWVudCA9IHtcbiAgICAgICAgdXNlcklkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICAgICAgdXNlcjogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgaWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ1NwZWNpZmljJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ0NsaWVudCcsXG4gICAgICAgIH0pLFxuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldENsaWVudEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tDbGllbnQgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgY2xpZW50SWQsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QodGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0Q2xpZW50QnlJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICBjbGllbnRJZCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDbGllbnQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VySWQpLnRvQmUoVEVTVF9VU0VSX0lEUy5DTElFTlQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLmZpcnN0TmFtZSkudG9CZSgnU3BlY2lmaWMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNsaWVudCBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRDbGllbnRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0NsaWVudCBub3QgZm91bmQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFxuICAgICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICAgICdub24tZXhpc3RlbnQtY2xpZW50JyxcbiAgICAgICAgKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gc3BlY2lmaWMgY2xpZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0Q2xpZW50QnlJZC5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignTm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgY2xpZW50JyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0Q2xpZW50QnlJZCgndW5hdXRob3JpemVkLXRoZXJhcGlzdCcsIGNsaWVudElkKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KEZvcmJpZGRlbkV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGNsaWVudCBJRCBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRDbGllbnRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignSW52YWxpZCBjbGllbnQgSUQgZm9ybWF0JyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2V0Q2xpZW50QnlJZChURVNUX1VTRVJfSURTLlRIRVJBUElTVCwgJ2ludmFsaWQtaWQtZm9ybWF0JyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdGhlcmFwaXN0LWNsaWVudCByZWxhdGlvbnNoaXAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN0cmljdGVkQ2xpZW50ID0ge1xuICAgICAgICBpZDogY2xpZW50SWQsXG4gICAgICAgIHVzZXI6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ1Jlc3RyaWN0ZWQnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnQWNjZXNzJyxcbiAgICAgICAgfSksXG4gICAgICAgIHRoZXJhcGlzdElkOiAnZGlmZmVyZW50LXRoZXJhcGlzdC1pZCcsIC8vIERpZmZlcmVudCB0aGVyYXBpc3RcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgIH07XG5cbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldENsaWVudEJ5SWQubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBGb3JiaWRkZW5FeGNlcHRpb24oJ0NsaWVudCBpcyBub3QgYXNzaWduZWQgdG8gdGhpcyB0aGVyYXBpc3QnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULCBjbGllbnRJZCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhGb3JiaWRkZW5FeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgY29ubmVjdGlvbiBpc3N1ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRDbGllbnRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gbG9zdCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldENsaWVudEJ5SWQoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsIGNsaWVudElkKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBjb25uZWN0aW9uIGxvc3QnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNsaWVudCB3aXRoIGRldGFpbGVkIHJlbGF0aW9uc2hpcCBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGV0YWlsZWRDbGllbnQgPSB7XG4gICAgICAgIHVzZXJJZDogJ2RldGFpbGVkLWNsaWVudC11c2VyJyxcbiAgICAgICAgdXNlcjogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnRGV0YWlsZWQnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnQ2xpZW50JyxcbiAgICAgICAgICBlbWFpbDogJ2RldGFpbGVkQGV4YW1wbGUuY29tJyxcbiAgICAgICAgfSksXG4gICAgICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IHRydWUsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDEtMTUnKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgnMjAyNC0wMS0yMCcpLFxuICAgICAgfTtcblxuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0Q2xpZW50QnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgZGV0YWlsZWRDbGllbnQgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgY2xpZW50SWQsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnY3JlYXRlZEF0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndXBkYXRlZEF0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNyZWF0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIuZW1haWwpLnRvQmUoJ2RldGFpbGVkQGV4YW1wbGUuY29tJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb250cm9sbGVyIEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXRlIGNsaWVudCBtYW5hZ2VtZW50IHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd29ya2Zsb3dDbGllbnRJZCA9ICd3b3JrZmxvdy1jbGllbnQnO1xuXG4gICAgICAvLyAxLiBHZXQgYWxsIGNsaWVudHNcbiAgICAgIGNvbnN0IGFsbENsaWVudHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6ICd3b3JrZmxvdy11c2VyLWlkJyxcbiAgICAgICAgICB1c2VyOiBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVVc2VyKHtcbiAgICAgICAgICAgIGlkOiAnd29ya2Zsb3ctdXNlci1pZCcsXG4gICAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiBmYWxzZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgXTtcbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldEFsbENsaWVudHMubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIGFsbENsaWVudHMgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gMi4gR2V0IGFzc2lnbmVkIHBhdGllbnRzIChlbXB0eSBpbml0aWFsbHkpXG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBc3NpZ25lZFBhdGllbnRzLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgLy8gMy4gR2V0IHNwZWNpZmljIGNsaWVudCBkZXRhaWxzXG4gICAgICBjb25zdCBzcGVjaWZpY0NsaWVudCA9IHtcbiAgICAgICAgdXNlcklkOiAnd29ya2Zsb3ctdXNlci1pZCcsXG4gICAgICAgIHVzZXI6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgIGlkOiAnd29ya2Zsb3ctdXNlci1pZCcsXG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIH0pLFxuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRDbGllbnRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBzcGVjaWZpY0NsaWVudCBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICAvLyBFeGVjdXRlIHdvcmtmbG93XG4gICAgICBjb25zdCBhbGxDbGllbnRzUmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRBbGxDbGllbnRzKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG4gICAgICBjb25zdCBhc3NpZ25lZFJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QXNzaWduZWRQYXRpZW50cyhcbiAgICAgICAgVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsXG4gICAgICApO1xuICAgICAgY29uc3Qgc3BlY2lmaWNSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldENsaWVudEJ5SWQoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgICB3b3JrZmxvd0NsaWVudElkLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGFsbENsaWVudHNSZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChhc3NpZ25lZFJlc3VsdCkudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgZXhwZWN0KHNwZWNpZmljUmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndXNlcklkJywgJ3dvcmtmbG93LXVzZXItaWQnKTtcbiAgICAgIGV4cGVjdChzcGVjaWZpY1Jlc3VsdC5oYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBjb25zaXN0ZW50IGNsaWVudCBkYXRhIGFjcm9zcyBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25zaXN0ZW50Q2xpZW50SWQgPSAnY29uc2lzdGVudC1jbGllbnQnO1xuICAgICAgY29uc3QgYmFzZUNsaWVudERhdGEgPSB7XG4gICAgICAgIHVzZXJJZDogJ2NvbnNpc3RlbnQtdXNlci1pZCcsXG4gICAgICAgIHVzZXI6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgIGlkOiAnY29uc2lzdGVudC11c2VyLWlkJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdDb25zaXN0ZW50JyxcbiAgICAgICAgICBsYXN0TmFtZTogJ0NsaWVudCcsXG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgIH0pLFxuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIC8vIFNldCB1cCBjb25zaXN0ZW50IHJlc3BvbnNlc1xuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QWxsQ2xpZW50cy5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIGJhc2VDbGllbnREYXRhIGFzIGFueSxcbiAgICAgIF0pO1xuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0QXNzaWduZWRQYXRpZW50cy5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIGJhc2VDbGllbnREYXRhIGFzIGFueSxcbiAgICAgIF0pO1xuICAgICAgdGhlcmFwaXN0TWFuYWdlbWVudFNlcnZpY2UuZ2V0Q2xpZW50QnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShcbiAgICAgICAgYmFzZUNsaWVudERhdGEgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gRXhlY3V0ZSBhbGwgZW5kcG9pbnRzXG4gICAgICBjb25zdCBhbGxDbGllbnRzID0gYXdhaXQgY29udHJvbGxlci5nZXRBbGxDbGllbnRzKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICk7XG4gICAgICBjb25zdCBhc3NpZ25lZENsaWVudHMgPSBhd2FpdCBjb250cm9sbGVyLmdldEFzc2lnbmVkUGF0aWVudHMoXG4gICAgICAgIFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNULFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHNwZWNpZmljQ2xpZW50ID0gYXdhaXQgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgY29uc2lzdGVudENsaWVudElkLFxuICAgICAgKTtcblxuICAgICAgLy8gVmVyaWZ5IGNvbnNpc3RlbmN5XG4gICAgICBleHBlY3QoYWxsQ2xpZW50c1swXS51c2VyLmZpcnN0TmFtZSkudG9CZSgnQ29uc2lzdGVudCcpO1xuICAgICAgZXhwZWN0KGFzc2lnbmVkQ2xpZW50c1swXS51c2VyLmZpcnN0TmFtZSkudG9CZSgnQ29uc2lzdGVudCcpO1xuICAgICAgZXhwZWN0KHNwZWNpZmljQ2xpZW50LnVzZXIuZmlyc3ROYW1lKS50b0JlKCdDb25zaXN0ZW50Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChhbGxDbGllbnRzWzBdLnVzZXJJZCkudG9CZSgnY29uc2lzdGVudC11c2VyLWlkJyk7XG4gICAgICBleHBlY3QoYXNzaWduZWRDbGllbnRzWzBdLnVzZXJJZCkudG9CZSgnY29uc2lzdGVudC11c2VyLWlkJyk7XG4gICAgICBleHBlY3Qoc3BlY2lmaWNDbGllbnQudXNlcklkKS50b0JlKCdjb25zaXN0ZW50LXVzZXItaWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nIGFuZCBFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgb3IgdW5kZWZpbmVkIGNsaWVudCBkYXRhIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRDbGllbnRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ251bGwtY2xpZW50JyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgY2xpZW50IHJlc3BvbnNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1hbGZvcm1lZENsaWVudCA9IHtcbiAgICAgICAgdXNlcklkOiAnbWFsZm9ybWVkLXVzZXInLFxuICAgICAgICAvLyBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgICB1c2VyOiBudWxsLFxuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB1bmRlZmluZWQsXG4gICAgICB9O1xuXG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRDbGllbnRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKFxuICAgICAgICBtYWxmb3JtZWRDbGllbnQgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRDbGllbnRCeUlkKFxuICAgICAgICBURVNUX1VTRVJfSURTLlRIRVJBUElTVCxcbiAgICAgICAgJ21hbGZvcm1lZCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnVzZXJJZCkudG9CZSgnbWFsZm9ybWVkLXVzZXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlcikudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgdGltZW91dCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGVyYXBpc3RNYW5hZ2VtZW50U2VydmljZS5nZXRBbGxDbGllbnRzLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ09wZXJhdGlvbiB0aW1lZCBvdXQnKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRBbGxDbGllbnRzKFRFU1RfVVNFUl9JRFMuVEhFUkFQSVNUKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdPcGVyYXRpb24gdGltZWQgb3V0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHJlcXVlc3RzIGFwcHJvcHJpYXRlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25jdXJyZW50Q2xpZW50RGF0YSA9IHtcbiAgICAgICAgdXNlcklkOiAnY29uY3VycmVudC11c2VyJyxcbiAgICAgICAgdXNlcjogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7IHJvbGU6ICdjbGllbnQnIH0pLFxuICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldENsaWVudEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIGNvbmN1cnJlbnRDbGllbnREYXRhIGFzIGFueSxcbiAgICAgICk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIGNvbmN1cnJlbnQgcmVxdWVzdHNcbiAgICAgIGNvbnN0IHByb21pc2VzID0gW1xuICAgICAgICBjb250cm9sbGVyLmdldENsaWVudEJ5SWQoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsICdjb25jdXJyZW50LWNsaWVudCcpLFxuICAgICAgICBjb250cm9sbGVyLmdldENsaWVudEJ5SWQoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsICdjb25jdXJyZW50LWNsaWVudCcpLFxuICAgICAgICBjb250cm9sbGVyLmdldENsaWVudEJ5SWQoVEVTVF9VU0VSX0lEUy5USEVSQVBJU1QsICdjb25jdXJyZW50LWNsaWVudCcpLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzLmV2ZXJ5KChyKSA9PiByLnVzZXJJZCA9PT0gJ2NvbmN1cnJlbnQtdXNlcicpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRoZXJhcGlzdE1hbmFnZW1lbnRTZXJ2aWNlLmdldENsaWVudEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==