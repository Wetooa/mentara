c0de69eaaec4a2adb6e3a6ba3db3f212
"use strict";
/**
 * Comprehensive Test Suite for CommunityRecommendationController
 * Tests community recommendation functionality with role-based access control
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const community_recommendation_controller_1 = require("./community-recommendation.controller");
const community_recommendation_service_1 = require("../services/community-recommendation.service");
const jwt_auth_guard_1 = require("../../auth/guards/jwt-auth.guard");
const role_based_access_guard_1 = require("../../auth/guards/role-based-access.guard");
const enhanced_test_helpers_1 = require("../../test-utils/enhanced-test-helpers");
const index_1 = require("../../test-utils/index");
describe('CommunityRecommendationController', () => {
    let controller;
    let communityRecommendationService;
    let module;
    // Mock CommunityRecommendationService
    const mockCommunityRecommendationService = {
        generateRecommendationsForUser: jest.fn(),
        getUserRecommendations: jest.fn(),
        getRecommendationById: jest.fn(),
        handleRecommendationInteraction: jest.fn(),
        getRecommendationStats: jest.fn(),
    };
    // Mock Guards
    const mockJwtAuthGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    const mockRoleBasedAccessGuard = {
        canActivate: jest.fn().mockReturnValue(true),
    };
    // Test data
    const mockUser = {
        id: index_1.TEST_USER_IDS.CLIENT,
        email: index_1.TEST_EMAILS.CLIENT,
        role: 'client',
    };
    const mockCommunity = {
        id: 'community_123456789',
        name: 'Anxiety Support Group',
        slug: 'anxiety-support',
        description: 'A supportive community for those dealing with anxiety disorders',
        imageUrl: 'https://example.com/images/anxiety-community.jpg',
        memberCount: 1247,
        isPublic: true,
        moderatorId: index_1.TEST_USER_IDS.MODERATOR,
        createdAt: new Date('2024-01-01T00:00:00Z'),
        updatedAt: new Date('2024-02-14T10:00:00Z'),
    };
    const mockRecommendation = {
        id: 'recommendation_123456789',
        userId: index_1.TEST_USER_IDS.CLIENT,
        communityId: 'community_123456789',
        community: mockCommunity,
        score: 0.87,
        reasoning: 'Based on your anxiety assessment scores and preference for group support, this community would be highly beneficial for your mental health journey.',
        assessmentScores: {
            anxiety: 6.8,
            depression: 3.2,
            stress: 7.1,
            socialAnxiety: 5.9,
        },
        status: 'pending',
        createdAt: new Date('2024-02-14T10:00:00Z'),
        updatedAt: new Date('2024-02-14T10:00:00Z'),
        interactionDate: null,
    };
    const mockRecommendationsList = [
        mockRecommendation,
        {
            ...mockRecommendation,
            id: 'recommendation_987654321',
            communityId: 'community_987654321',
            community: {
                ...mockCommunity,
                id: 'community_987654321',
                name: 'Depression Recovery',
                slug: 'depression-recovery',
                description: 'Support for depression recovery and mental wellness',
                memberCount: 892,
            },
            score: 0.74,
            reasoning: 'Your depression scores indicate this community could provide valuable peer support.',
            assessmentScores: {
                anxiety: 4.1,
                depression: 7.3,
                stress: 5.8,
                socialAnxiety: 3.2,
            },
            status: 'joined',
            interactionDate: new Date('2024-02-10T14:30:00Z'),
        },
        {
            ...mockRecommendation,
            id: 'recommendation_456789123',
            communityId: 'community_456789123',
            community: {
                ...mockCommunity,
                id: 'community_456789123',
                name: 'Mindfulness & Meditation',
                slug: 'mindfulness-meditation',
                description: 'Practice mindfulness and meditation techniques together',
                memberCount: 2156,
            },
            score: 0.65,
            reasoning: 'Mindfulness practices can help with stress management based on your assessment.',
            status: 'dismissed',
            interactionDate: new Date('2024-02-08T09:15:00Z'),
        },
    ];
    const mockRecommendationStats = {
        totalRecommendations: 156,
        acceptedRecommendations: 89,
        rejectedRecommendations: 23,
        pendingRecommendations: 44,
        averageCompatibilityScore: 0.76,
        topCommunities: [
            {
                communityId: 'community_123456789',
                communityName: 'Anxiety Support Group',
                acceptanceRate: 0.83,
                totalRecommendations: 67,
            },
            {
                communityId: 'community_987654321',
                communityName: 'Depression Recovery',
                acceptanceRate: 0.78,
                totalRecommendations: 54,
            },
        ],
        weeklyTrends: {
            generated: 23,
            accepted: 18,
            rejected: 3,
            pending: 2,
        },
        categoryPerformance: {
            anxiety: { averageScore: 0.82, acceptanceRate: 0.85 },
            depression: { averageScore: 0.79, acceptanceRate: 0.81 },
            stress: { averageScore: 0.74, acceptanceRate: 0.76 },
            addiction: { averageScore: 0.71, acceptanceRate: 0.73 },
        },
    };
    beforeEach(async () => {
        module = await testing_1.Test.createTestingModule({
            controllers: [community_recommendation_controller_1.CommunityRecommendationController],
            providers: [
                {
                    provide: community_recommendation_service_1.CommunityRecommendationService,
                    useValue: mockCommunityRecommendationService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue(mockJwtAuthGuard)
            .overrideGuard(role_based_access_guard_1.RoleBasedAccessGuard)
            .useValue(mockRoleBasedAccessGuard)
            .compile();
        controller = module.get(community_recommendation_controller_1.CommunityRecommendationController);
        communityRecommendationService = module.get(community_recommendation_service_1.CommunityRecommendationService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('Controller Initialization', () => {
        it('should be defined', () => {
            expect(controller).toBeDefined();
        });
        it('should have communityRecommendationService injected', () => {
            expect(communityRecommendationService).toBeDefined();
        });
    });
    describe('Security Guards', () => {
        it('should be protected by JwtAuthGuard and RoleBasedAccessGuard', () => {
            const guards = Reflect.getMetadata('__guards__', community_recommendation_controller_1.CommunityRecommendationController);
            expect(guards).toContain(jwt_auth_guard_1.JwtAuthGuard);
            expect(guards).toContain(role_based_access_guard_1.RoleBasedAccessGuard);
        });
        it('should have proper route decorators', () => {
            const controllerMetadata = Reflect.getMetadata('path', community_recommendation_controller_1.CommunityRecommendationController);
            expect(controllerMetadata).toBe('communities/recommendations');
        });
    });
    describe('POST /communities/recommendations/generate', () => {
        const generateDto = { force: false };
        beforeEach(() => {
            mockCommunityRecommendationService.generateRecommendationsForUser.mockResolvedValue(undefined);
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue(mockRecommendationsList);
        });
        it('should generate recommendations successfully', async () => {
            const result = await controller.generateRecommendations(mockUser, generateDto);
            expect(result).toEqual({
                success: true,
                data: mockRecommendationsList,
                message: `Generated ${mockRecommendationsList.length} recommendations`,
            });
            expect(communityRecommendationService.generateRecommendationsForUser).toHaveBeenCalledWith(mockUser.id, generateDto.force);
            expect(communityRecommendationService.getUserRecommendations).toHaveBeenCalledWith(mockUser.id);
        });
        it('should handle forced regeneration', async () => {
            const forcedDto = { force: true };
            const result = await controller.generateRecommendations(mockUser, forcedDto);
            expect(result.success).toBe(true);
            expect(communityRecommendationService.generateRecommendationsForUser).toHaveBeenCalledWith(mockUser.id, true);
        });
        it('should handle empty recommendations', async () => {
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue([]);
            const result = await controller.generateRecommendations(mockUser, generateDto);
            expect(result).toEqual({
                success: true,
                data: [],
                message: 'Generated 0 recommendations',
            });
        });
        it('should handle service errors during generation', async () => {
            const serviceError = new Error('Failed to generate recommendations');
            mockCommunityRecommendationService.generateRecommendationsForUser.mockRejectedValue(serviceError);
            await expect(controller.generateRecommendations(mockUser, generateDto)).rejects.toThrow(serviceError);
        });
        it('should handle service errors during retrieval', async () => {
            const retrievalError = new Error('Failed to retrieve recommendations');
            mockCommunityRecommendationService.getUserRecommendations.mockRejectedValue(retrievalError);
            await expect(controller.generateRecommendations(mockUser, generateDto)).rejects.toThrow(retrievalError);
        });
    });
    describe('GET /communities/recommendations/me', () => {
        beforeEach(() => {
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue(mockRecommendationsList);
        });
        it('should get user recommendations successfully', async () => {
            const query = {};
            const result = await controller.getUserRecommendations(mockUser, query);
            expect(result).toEqual({
                success: true,
                data: mockRecommendationsList,
                message: 'Recommendations retrieved successfully',
            });
            expect(communityRecommendationService.getUserRecommendations).toHaveBeenCalledWith(mockUser.id);
        });
        it('should filter by status - pending', async () => {
            const query = { status: 'pending' };
            const result = await controller.getUserRecommendations(mockUser, query);
            const expectedFiltered = mockRecommendationsList.filter(rec => rec.status === 'pending');
            expect(result.data).toEqual(expectedFiltered);
        });
        it('should filter by status - accepted', async () => {
            const query = { status: 'accepted' };
            const result = await controller.getUserRecommendations(mockUser, query);
            const expectedFiltered = mockRecommendationsList.filter(rec => rec.status === 'joined');
            expect(result.data).toEqual(expectedFiltered);
        });
        it('should filter by status - rejected', async () => {
            const query = { status: 'rejected' };
            const result = await controller.getUserRecommendations(mockUser, query);
            const expectedFiltered = mockRecommendationsList.filter(rec => rec.status === 'dismissed');
            expect(result.data).toEqual(expectedFiltered);
        });
        it('should sort by compatibility score - descending', async () => {
            const query = { sortBy: 'compatibility', sortOrder: 'desc' };
            const result = await controller.getUserRecommendations(mockUser, query);
            const sortedData = result.data;
            expect(sortedData[0].score).toBeGreaterThanOrEqual(sortedData[1].score);
        });
        it('should sort by compatibility score - ascending', async () => {
            const query = { sortBy: 'compatibility', sortOrder: 'asc' };
            const result = await controller.getUserRecommendations(mockUser, query);
            const sortedData = result.data;
            expect(sortedData[0].score).toBeLessThanOrEqual(sortedData[sortedData.length - 1].score);
        });
        it('should sort by created date', async () => {
            const query = { sortBy: 'created', sortOrder: 'desc' };
            const result = await controller.getUserRecommendations(mockUser, query);
            expect(result.success).toBe(true);
            expect(Array.isArray(result.data)).toBe(true);
        });
        it('should sort by updated date', async () => {
            const query = { sortBy: 'updated', sortOrder: 'desc' };
            const result = await controller.getUserRecommendations(mockUser, query);
            expect(result.success).toBe(true);
            expect(Array.isArray(result.data)).toBe(true);
        });
        it('should handle combined filtering and sorting', async () => {
            const query = {
                status: 'pending',
                sortBy: 'compatibility',
                sortOrder: 'desc',
            };
            const result = await controller.getUserRecommendations(mockUser, query);
            const resultData = result.data;
            expect(resultData.every(rec => rec.status === 'pending')).toBe(true);
        });
        it('should handle empty recommendations', async () => {
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue([]);
            const result = await controller.getUserRecommendations(mockUser, {});
            expect(result.data).toEqual([]);
            expect(result.success).toBe(true);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Failed to retrieve user recommendations');
            mockCommunityRecommendationService.getUserRecommendations.mockRejectedValue(serviceError);
            await expect(controller.getUserRecommendations(mockUser, {})).rejects.toThrow(serviceError);
        });
    });
    describe('GET /communities/recommendations/:recommendationId', () => {
        const recommendationId = 'recommendation_123456789';
        it('should get recommendation details successfully', async () => {
            mockCommunityRecommendationService.getRecommendationById.mockResolvedValue(mockRecommendation);
            const result = await controller.getRecommendationDetails(mockUser, recommendationId);
            expect(result).toEqual({
                success: true,
                data: mockRecommendation,
                message: 'Recommendation details retrieved successfully',
            });
            expect(communityRecommendationService.getRecommendationById).toHaveBeenCalledWith(recommendationId);
        });
        it('should handle recommendation not found', async () => {
            const notFoundError = new Error('Recommendation not found');
            mockCommunityRecommendationService.getRecommendationById.mockRejectedValue(notFoundError);
            await expect(controller.getRecommendationDetails(mockUser, 'non-existent-id')).rejects.toThrow(notFoundError);
        });
        it('should handle invalid UUID format', async () => {
            const invalidId = 'invalid-uuid';
            await expect(controller.getRecommendationDetails(mockUser, invalidId)).rejects.toThrow();
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Database connection failed');
            mockCommunityRecommendationService.getRecommendationById.mockRejectedValue(serviceError);
            await expect(controller.getRecommendationDetails(mockUser, recommendationId)).rejects.toThrow(serviceError);
        });
    });
    describe('PUT /communities/recommendations/:recommendationId/interact', () => {
        const recommendationId = 'recommendation_123456789';
        it('should handle accept interaction successfully', async () => {
            const interactionDto = { action: 'accept' };
            mockCommunityRecommendationService.handleRecommendationInteraction.mockResolvedValue(undefined);
            const result = await controller.handleRecommendationInteraction(mockUser, recommendationId, interactionDto);
            expect(result).toEqual({
                success: true,
                message: 'Recommendation accepted successfully',
            });
            expect(communityRecommendationService.handleRecommendationInteraction).toHaveBeenCalledWith({
                recommendationId,
                action: 'accept',
                userId: mockUser.id,
            });
        });
        it('should handle reject interaction successfully', async () => {
            const interactionDto = { action: 'reject' };
            mockCommunityRecommendationService.handleRecommendationInteraction.mockResolvedValue(undefined);
            const result = await controller.handleRecommendationInteraction(mockUser, recommendationId, interactionDto);
            expect(result).toEqual({
                success: true,
                message: 'Recommendation rejected successfully',
            });
            expect(communityRecommendationService.handleRecommendationInteraction).toHaveBeenCalledWith({
                recommendationId,
                action: 'reject',
                userId: mockUser.id,
            });
        });
        it('should handle dismiss interaction successfully', async () => {
            const interactionDto = { action: 'dismiss' };
            mockCommunityRecommendationService.handleRecommendationInteraction.mockResolvedValue(undefined);
            const result = await controller.handleRecommendationInteraction(mockUser, recommendationId, interactionDto);
            expect(result).toEqual({
                success: true,
                message: 'Recommendation dismissed successfully',
            });
        });
        it('should handle recommendation not found', async () => {
            const interactionDto = { action: 'accept' };
            const notFoundError = new Error('Recommendation not found');
            mockCommunityRecommendationService.handleRecommendationInteraction.mockRejectedValue(notFoundError);
            await expect(controller.handleRecommendationInteraction(mockUser, 'non-existent-id', interactionDto)).rejects.toThrow(notFoundError);
        });
        it('should handle already interacted recommendation', async () => {
            const interactionDto = { action: 'accept' };
            const alreadyInteractedError = new Error('Recommendation already interacted with');
            mockCommunityRecommendationService.handleRecommendationInteraction.mockRejectedValue(alreadyInteractedError);
            await expect(controller.handleRecommendationInteraction(mockUser, recommendationId, interactionDto)).rejects.toThrow(alreadyInteractedError);
        });
        it('should handle service errors', async () => {
            const interactionDto = { action: 'accept' };
            const serviceError = new Error('Database update failed');
            mockCommunityRecommendationService.handleRecommendationInteraction.mockRejectedValue(serviceError);
            await expect(controller.handleRecommendationInteraction(mockUser, recommendationId, interactionDto)).rejects.toThrow(serviceError);
        });
    });
    describe('POST /communities/recommendations/refresh', () => {
        beforeEach(() => {
            mockCommunityRecommendationService.generateRecommendationsForUser.mockResolvedValue(undefined);
        });
        it('should refresh recommendations successfully', async () => {
            const result = await controller.refreshRecommendations(mockUser);
            expect(result).toEqual({
                success: true,
                message: 'Recommendations refreshed successfully',
            });
            expect(communityRecommendationService.generateRecommendationsForUser).toHaveBeenCalledWith(mockUser.id, true);
        });
        it('should handle service errors during refresh', async () => {
            const serviceError = new Error('Failed to refresh recommendations');
            mockCommunityRecommendationService.generateRecommendationsForUser.mockRejectedValue(serviceError);
            await expect(controller.refreshRecommendations(mockUser)).rejects.toThrow(serviceError);
        });
        it('should always force refresh', async () => {
            await controller.refreshRecommendations(mockUser);
            expect(communityRecommendationService.generateRecommendationsForUser).toHaveBeenCalledWith(mockUser.id, true);
        });
    });
    describe('GET /communities/recommendations/stats/me', () => {
        beforeEach(() => {
            mockCommunityRecommendationService.getRecommendationStats.mockResolvedValue(mockRecommendationStats);
        });
        it('should get user recommendation stats successfully', async () => {
            const result = await controller.getUserRecommendationStats(mockUser);
            expect(result).toEqual({
                success: true,
                data: mockRecommendationStats,
                message: 'User recommendation statistics retrieved successfully',
            });
            expect(communityRecommendationService.getRecommendationStats).toHaveBeenCalledWith();
        });
        it('should validate stats response structure', async () => {
            const result = await controller.getUserRecommendationStats(mockUser);
            expect(result.data).toHaveProperty('totalRecommendations');
            expect(result.data).toHaveProperty('acceptedRecommendations');
            expect(result.data).toHaveProperty('rejectedRecommendations');
            expect(result.data).toHaveProperty('pendingRecommendations');
            expect(result.data).toHaveProperty('averageCompatibilityScore');
            expect(result.data).toHaveProperty('topCommunities');
            expect(Array.isArray(result.data.topCommunities)).toBe(true);
        });
        it('should handle empty stats', async () => {
            const emptyStats = {
                totalRecommendations: 0,
                acceptedRecommendations: 0,
                rejectedRecommendations: 0,
                pendingRecommendations: 0,
                averageCompatibilityScore: 0,
                topCommunities: [],
                weeklyTrends: { generated: 0, accepted: 0, rejected: 0, pending: 0 },
                categoryPerformance: {},
            };
            mockCommunityRecommendationService.getRecommendationStats.mockResolvedValue(emptyStats);
            const result = await controller.getUserRecommendationStats(mockUser);
            expect(result.data.totalRecommendations).toBe(0);
            expect(result.data.topCommunities).toEqual([]);
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Failed to retrieve recommendation stats');
            mockCommunityRecommendationService.getRecommendationStats.mockRejectedValue(serviceError);
            await expect(controller.getUserRecommendationStats(mockUser)).rejects.toThrow(serviceError);
        });
    });
    describe('GET /communities/recommendations/stats/global', () => {
        beforeEach(() => {
            mockCommunityRecommendationService.getRecommendationStats.mockResolvedValue(mockRecommendationStats);
        });
        it('should get global recommendation stats successfully', async () => {
            const result = await controller.getGlobalRecommendationStats();
            expect(result).toEqual({
                success: true,
                data: mockRecommendationStats,
                message: 'Global recommendation statistics retrieved successfully',
            });
            expect(communityRecommendationService.getRecommendationStats).toHaveBeenCalledWith();
        });
        it('should validate global stats response structure', async () => {
            const result = await controller.getGlobalRecommendationStats();
            expect(result.data).toHaveProperty('totalRecommendations');
            expect(result.data).toHaveProperty('weeklyTrends');
            expect(result.data).toHaveProperty('categoryPerformance');
            expect(typeof result.data.totalRecommendations).toBe('number');
            expect(typeof result.data.averageCompatibilityScore).toBe('number');
        });
        it('should handle service errors', async () => {
            const serviceError = new Error('Failed to retrieve global recommendation stats');
            mockCommunityRecommendationService.getRecommendationStats.mockRejectedValue(serviceError);
            await expect(controller.getGlobalRecommendationStats()).rejects.toThrow(serviceError);
        });
    });
    describe('Role-Based Access Control', () => {
        it('should allow all authenticated users to access user endpoints', () => {
            const userEndpoints = [
                'generateRecommendations',
                'getUserRecommendations',
                'getRecommendationDetails',
                'handleRecommendationInteraction',
                'refreshRecommendations',
                'getUserRecommendationStats',
            ];
            userEndpoints.forEach(endpoint => {
                const metadata = Reflect.getMetadata('roles', controller[endpoint]);
                expect(metadata).toContain('client');
                expect(metadata).toContain('therapist');
                expect(metadata).toContain('moderator');
                expect(metadata).toContain('admin');
            });
        });
        it('should restrict global stats to admin and moderator only', () => {
            const metadata = Reflect.getMetadata('roles', controller.getGlobalRecommendationStats);
            expect(metadata).toContain('admin');
            expect(metadata).toContain('moderator');
            expect(metadata).not.toContain('client');
            expect(metadata).not.toContain('therapist');
        });
    });
    describe('Response Format Validation', () => {
        it('should return properly formatted generate response', async () => {
            mockCommunityRecommendationService.generateRecommendationsForUser.mockResolvedValue(undefined);
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue(mockRecommendationsList);
            const result = await controller.generateRecommendations(mockUser, { force: false });
            expect(result).toHaveProperty('success');
            expect(result).toHaveProperty('data');
            expect(result).toHaveProperty('message');
            expect(result.success).toBe(true);
            expect(Array.isArray(result.data)).toBe(true);
            expect(typeof result.message).toBe('string');
        });
        it('should return properly formatted recommendations list', async () => {
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue(mockRecommendationsList);
            const result = await controller.getUserRecommendations(mockUser, {});
            expect(result.data).toBeInstanceOf(Array);
            result.data.forEach((recommendation) => {
                enhanced_test_helpers_1.TestAssertions.expectValidEntity(recommendation, ['id', 'userId', 'communityId', 'score']);
                expect(recommendation.score).toBeGreaterThanOrEqual(0);
                expect(recommendation.score).toBeLessThanOrEqual(1);
                expect(recommendation.community).toHaveProperty('id');
                expect(recommendation.community).toHaveProperty('name');
            });
        });
        it('should return properly formatted recommendation details', async () => {
            mockCommunityRecommendationService.getRecommendationById.mockResolvedValue(mockRecommendation);
            const result = await controller.getRecommendationDetails(mockUser, 'recommendation_123456789');
            enhanced_test_helpers_1.TestAssertions.expectValidEntity(result.data, ['id', 'userId', 'communityId', 'score', 'reasoning']);
            expect(result.data.community).toBeDefined();
            expect(result.data.assessmentScores).toBeDefined();
            expect(typeof result.data.score).toBe('number');
            expect(typeof result.data.reasoning).toBe('string');
        });
        it('should return properly formatted stats response', async () => {
            mockCommunityRecommendationService.getRecommendationStats.mockResolvedValue(mockRecommendationStats);
            const result = await controller.getUserRecommendationStats(mockUser);
            enhanced_test_helpers_1.TestAssertions.expectValidEntity(result.data, [
                'totalRecommendations',
                'acceptedRecommendations',
                'rejectedRecommendations',
                'pendingRecommendations',
                'averageCompatibilityScore',
                'topCommunities',
            ]);
            expect(Array.isArray(result.data.topCommunities)).toBe(true);
            expect(typeof result.data.totalRecommendations).toBe('number');
            expect(typeof result.data.averageCompatibilityScore).toBe('number');
        });
    });
    describe('Error Handling', () => {
        it('should handle service unavailable scenarios', async () => {
            const serviceError = new Error('Recommendation service temporarily unavailable');
            mockCommunityRecommendationService.getUserRecommendations.mockRejectedValue(serviceError);
            await expect(controller.getUserRecommendations(mockUser, {})).rejects.toThrow(serviceError);
        });
        it('should handle database connection errors', async () => {
            const dbError = new Error('Database connection failed');
            mockCommunityRecommendationService.generateRecommendationsForUser.mockRejectedValue(dbError);
            await expect(controller.generateRecommendations(mockUser, { force: false })).rejects.toThrow(dbError);
        });
        it('should handle validation errors', async () => {
            const validationError = new Error('Invalid recommendation data');
            mockCommunityRecommendationService.handleRecommendationInteraction.mockRejectedValue(validationError);
            await expect(controller.handleRecommendationInteraction(mockUser, 'recommendation_123', { action: 'accept' })).rejects.toThrow(validationError);
        });
        it('should handle concurrent interaction attempts', async () => {
            const concurrencyError = new Error('Recommendation interaction already in progress');
            mockCommunityRecommendationService.handleRecommendationInteraction.mockRejectedValue(concurrencyError);
            await expect(controller.handleRecommendationInteraction(mockUser, 'recommendation_123', { action: 'accept' })).rejects.toThrow(concurrencyError);
        });
    });
    describe('Integration Tests', () => {
        it('should handle complete recommendation workflow', async () => {
            // Generate recommendations
            mockCommunityRecommendationService.generateRecommendationsForUser.mockResolvedValue(undefined);
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue(mockRecommendationsList);
            const generateResult = await controller.generateRecommendations(mockUser, { force: false });
            expect(generateResult.success).toBe(true);
            // Get user recommendations
            const userRecommendations = await controller.getUserRecommendations(mockUser, {});
            expect(userRecommendations.data).toHaveLength(3);
            // Get recommendation details
            mockCommunityRecommendationService.getRecommendationById.mockResolvedValue(mockRecommendation);
            const details = await controller.getRecommendationDetails(mockUser, mockRecommendation.id);
            expect(details.data.id).toBe(mockRecommendation.id);
            // Interact with recommendation
            mockCommunityRecommendationService.handleRecommendationInteraction.mockResolvedValue(undefined);
            const interaction = await controller.handleRecommendationInteraction(mockUser, mockRecommendation.id, { action: 'accept' });
            expect(interaction.success).toBe(true);
            // Get updated stats
            mockCommunityRecommendationService.getRecommendationStats.mockResolvedValue(mockRecommendationStats);
            const stats = await controller.getUserRecommendationStats(mockUser);
            expect(stats.data.totalRecommendations).toBeGreaterThan(0);
        });
        it('should handle filtering and sorting workflow', async () => {
            mockCommunityRecommendationService.getUserRecommendations.mockResolvedValue(mockRecommendationsList);
            // Get pending recommendations
            const pendingResult = await controller.getUserRecommendations(mockUser, { status: 'pending' });
            expect(pendingResult.data.every((rec) => rec.status === 'pending')).toBe(true);
            // Get recommendations sorted by compatibility
            const sortedResult = await controller.getUserRecommendations(mockUser, {
                sortBy: 'compatibility',
                sortOrder: 'desc',
            });
            expect(sortedResult.success).toBe(true);
            // Get accepted recommendations
            const acceptedResult = await controller.getUserRecommendations(mockUser, { status: 'accepted' });
            expect(acceptedResult.data.every((rec) => rec.status === 'joined')).toBe(true);
        });
        it('should handle admin analytics workflow', async () => {
            mockCommunityRecommendationService.getRecommendationStats.mockResolvedValue(mockRecommendationStats);
            // Get global stats
            const globalStats = await controller.getGlobalRecommendationStats();
            expect(globalStats.data.totalRecommendations).toBeGreaterThan(0);
            expect(globalStats.data.categoryPerformance).toBeDefined();
            // Verify detailed metrics
            expect(globalStats.data.weeklyTrends).toBeDefined();
            expect(globalStats.data.topCommunities).toBeInstanceOf(Array);
            expect(globalStats.data.averageCompatibilityScore).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbnRyb2xsZXJzL2NvbW11bml0eS1yZWNvbW1lbmRhdGlvbi5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCw2Q0FBc0Q7QUFFdEQsK0ZBQTBGO0FBQzFGLG1HQUE4RjtBQUM5RixxRUFBZ0U7QUFDaEUsdUZBQWlGO0FBRWpGLGtGQUF3RztBQUN4RyxrREFBb0U7QUFFcEUsUUFBUSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtJQUNqRCxJQUFJLFVBQTZDLENBQUM7SUFDbEQsSUFBSSw4QkFBOEQsQ0FBQztJQUNuRSxJQUFJLE1BQXFCLENBQUM7SUFFMUIsc0NBQXNDO0lBQ3RDLE1BQU0sa0NBQWtDLEdBQUc7UUFDekMsOEJBQThCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN6QyxzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pDLHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEMsK0JBQStCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUMxQyxzQkFBc0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2xDLENBQUM7SUFFRixjQUFjO0lBQ2QsTUFBTSxnQkFBZ0IsR0FBRztRQUN2QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7S0FDN0MsQ0FBQztJQUVGLE1BQU0sd0JBQXdCLEdBQUc7UUFDL0IsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO0tBQzdDLENBQUM7SUFFRixZQUFZO0lBQ1osTUFBTSxRQUFRLEdBQUc7UUFDZixFQUFFLEVBQUUscUJBQWEsQ0FBQyxNQUFNO1FBQ3hCLEtBQUssRUFBRSxtQkFBVyxDQUFDLE1BQU07UUFDekIsSUFBSSxFQUFFLFFBQVE7S0FDZixDQUFDO0lBRUYsTUFBTSxhQUFhLEdBQUc7UUFDcEIsRUFBRSxFQUFFLHFCQUFxQjtRQUN6QixJQUFJLEVBQUUsdUJBQXVCO1FBQzdCLElBQUksRUFBRSxpQkFBaUI7UUFDdkIsV0FBVyxFQUFFLGlFQUFpRTtRQUM5RSxRQUFRLEVBQUUsa0RBQWtEO1FBQzVELFdBQVcsRUFBRSxJQUFJO1FBQ2pCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsV0FBVyxFQUFFLHFCQUFhLENBQUMsU0FBUztRQUNwQyxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUM7UUFDM0MsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDO0tBQzVDLENBQUM7SUFFRixNQUFNLGtCQUFrQixHQUFHO1FBQ3pCLEVBQUUsRUFBRSwwQkFBMEI7UUFDOUIsTUFBTSxFQUFFLHFCQUFhLENBQUMsTUFBTTtRQUM1QixXQUFXLEVBQUUscUJBQXFCO1FBQ2xDLFNBQVMsRUFBRSxhQUFhO1FBQ3hCLEtBQUssRUFBRSxJQUFJO1FBQ1gsU0FBUyxFQUFFLHFKQUFxSjtRQUNoSyxnQkFBZ0IsRUFBRTtZQUNoQixPQUFPLEVBQUUsR0FBRztZQUNaLFVBQVUsRUFBRSxHQUFHO1lBQ2YsTUFBTSxFQUFFLEdBQUc7WUFDWCxhQUFhLEVBQUUsR0FBRztTQUNuQjtRQUNELE1BQU0sRUFBRSxTQUFTO1FBQ2pCLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztRQUMzQyxTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUM7UUFDM0MsZUFBZSxFQUFFLElBQUk7S0FDdEIsQ0FBQztJQUVGLE1BQU0sdUJBQXVCLEdBQUc7UUFDOUIsa0JBQWtCO1FBQ2xCO1lBQ0UsR0FBRyxrQkFBa0I7WUFDckIsRUFBRSxFQUFFLDBCQUEwQjtZQUM5QixXQUFXLEVBQUUscUJBQXFCO1lBQ2xDLFNBQVMsRUFBRTtnQkFDVCxHQUFHLGFBQWE7Z0JBQ2hCLEVBQUUsRUFBRSxxQkFBcUI7Z0JBQ3pCLElBQUksRUFBRSxxQkFBcUI7Z0JBQzNCLElBQUksRUFBRSxxQkFBcUI7Z0JBQzNCLFdBQVcsRUFBRSxxREFBcUQ7Z0JBQ2xFLFdBQVcsRUFBRSxHQUFHO2FBQ2pCO1lBQ0QsS0FBSyxFQUFFLElBQUk7WUFDWCxTQUFTLEVBQUUscUZBQXFGO1lBQ2hHLGdCQUFnQixFQUFFO2dCQUNoQixPQUFPLEVBQUUsR0FBRztnQkFDWixVQUFVLEVBQUUsR0FBRztnQkFDZixNQUFNLEVBQUUsR0FBRztnQkFDWCxhQUFhLEVBQUUsR0FBRzthQUNuQjtZQUNELE1BQU0sRUFBRSxRQUFRO1lBQ2hCLGVBQWUsRUFBRSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztTQUNsRDtRQUNEO1lBQ0UsR0FBRyxrQkFBa0I7WUFDckIsRUFBRSxFQUFFLDBCQUEwQjtZQUM5QixXQUFXLEVBQUUscUJBQXFCO1lBQ2xDLFNBQVMsRUFBRTtnQkFDVCxHQUFHLGFBQWE7Z0JBQ2hCLEVBQUUsRUFBRSxxQkFBcUI7Z0JBQ3pCLElBQUksRUFBRSwwQkFBMEI7Z0JBQ2hDLElBQUksRUFBRSx3QkFBd0I7Z0JBQzlCLFdBQVcsRUFBRSx5REFBeUQ7Z0JBQ3RFLFdBQVcsRUFBRSxJQUFJO2FBQ2xCO1lBQ0QsS0FBSyxFQUFFLElBQUk7WUFDWCxTQUFTLEVBQUUsaUZBQWlGO1lBQzVGLE1BQU0sRUFBRSxXQUFXO1lBQ25CLGVBQWUsRUFBRSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztTQUNsRDtLQUNGLENBQUM7SUFFRixNQUFNLHVCQUF1QixHQUFHO1FBQzlCLG9CQUFvQixFQUFFLEdBQUc7UUFDekIsdUJBQXVCLEVBQUUsRUFBRTtRQUMzQix1QkFBdUIsRUFBRSxFQUFFO1FBQzNCLHNCQUFzQixFQUFFLEVBQUU7UUFDMUIseUJBQXlCLEVBQUUsSUFBSTtRQUMvQixjQUFjLEVBQUU7WUFDZDtnQkFDRSxXQUFXLEVBQUUscUJBQXFCO2dCQUNsQyxhQUFhLEVBQUUsdUJBQXVCO2dCQUN0QyxjQUFjLEVBQUUsSUFBSTtnQkFDcEIsb0JBQW9CLEVBQUUsRUFBRTthQUN6QjtZQUNEO2dCQUNFLFdBQVcsRUFBRSxxQkFBcUI7Z0JBQ2xDLGFBQWEsRUFBRSxxQkFBcUI7Z0JBQ3BDLGNBQWMsRUFBRSxJQUFJO2dCQUNwQixvQkFBb0IsRUFBRSxFQUFFO2FBQ3pCO1NBQ0Y7UUFDRCxZQUFZLEVBQUU7WUFDWixTQUFTLEVBQUUsRUFBRTtZQUNiLFFBQVEsRUFBRSxFQUFFO1lBQ1osUUFBUSxFQUFFLENBQUM7WUFDWCxPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsbUJBQW1CLEVBQUU7WUFDbkIsT0FBTyxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFO1lBQ3JELFVBQVUsRUFBRSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRTtZQUN4RCxNQUFNLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUU7WUFDcEQsU0FBUyxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFO1NBQ3hEO0tBQ0YsQ0FBQztJQUVGLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLEdBQUcsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDdEMsV0FBVyxFQUFFLENBQUMsdUVBQWlDLENBQUM7WUFDaEQsU0FBUyxFQUFFO2dCQUNUO29CQUNFLE9BQU8sRUFBRSxpRUFBOEI7b0JBQ3ZDLFFBQVEsRUFBRSxrQ0FBa0M7aUJBQzdDO2FBQ0Y7U0FDRixDQUFDO2FBQ0MsYUFBYSxDQUFDLDZCQUFZLENBQUM7YUFDM0IsUUFBUSxDQUFDLGdCQUFnQixDQUFDO2FBQzFCLGFBQWEsQ0FBQyw4Q0FBb0IsQ0FBQzthQUNuQyxRQUFRLENBQUMsd0JBQXdCLENBQUM7YUFDbEMsT0FBTyxFQUFFLENBQUM7UUFFYixVQUFVLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBb0MsdUVBQWlDLENBQUMsQ0FBQztRQUM5Riw4QkFBOEIsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFpQyxpRUFBOEIsQ0FBQyxDQUFDO0lBQzlHLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDekMsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtZQUMzQixNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsR0FBRyxFQUFFO1lBQzdELE1BQU0sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQy9CLEVBQUUsQ0FBQyw4REFBOEQsRUFBRSxHQUFHLEVBQUU7WUFDdEUsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsdUVBQWlDLENBQUMsQ0FBQztZQUNwRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLDZCQUFZLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLDhDQUFvQixDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzdDLE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsdUVBQWlDLENBQUMsQ0FBQztZQUMxRixNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUNqRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDRDQUE0QyxFQUFFLEdBQUcsRUFBRTtRQUMxRCxNQUFNLFdBQVcsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUVyQyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2Qsa0NBQWtDLENBQUMsOEJBQThCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDL0Ysa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUN2RyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFFL0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDckIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsSUFBSSxFQUFFLHVCQUF1QjtnQkFDN0IsT0FBTyxFQUFFLGFBQWEsdUJBQXVCLENBQUMsTUFBTSxrQkFBa0I7YUFDdkUsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLDhCQUE4QixDQUFDLDhCQUE4QixDQUFDLENBQUMsb0JBQW9CLENBQ3hGLFFBQVEsQ0FBQyxFQUFFLEVBQ1gsV0FBVyxDQUFDLEtBQUssQ0FDbEIsQ0FBQztZQUNGLE1BQU0sQ0FBQyw4QkFBOEIsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsRyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRCxNQUFNLFNBQVMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUVsQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFN0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLDhCQUE4QixDQUFDLDhCQUE4QixDQUFDLENBQUMsb0JBQW9CLENBQ3hGLFFBQVEsQ0FBQyxFQUFFLEVBQ1gsSUFBSSxDQUNMLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxrQ0FBa0MsQ0FBQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVoRixNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFFL0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDckIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsT0FBTyxFQUFFLDZCQUE2QjthQUN2QyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1lBQ3JFLGtDQUFrQyxDQUFDLDhCQUE4QixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRWxHLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQzFELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLGNBQWMsR0FBRyxJQUFJLEtBQUssQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1lBQ3ZFLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBRTVGLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQzFELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtRQUNuRCxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2Qsa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUN2RyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7WUFFakIsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRXhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQ3JCLE9BQU8sRUFBRSxJQUFJO2dCQUNiLElBQUksRUFBRSx1QkFBdUI7Z0JBQzdCLE9BQU8sRUFBRSx3Q0FBd0M7YUFDbEQsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLDhCQUE4QixDQUFDLHNCQUFzQixDQUFDLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xHLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pELE1BQU0sS0FBSyxHQUFHLEVBQUUsTUFBTSxFQUFFLFNBQWtCLEVBQUUsQ0FBQztZQUU3QyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFeEUsTUFBTSxnQkFBZ0IsR0FBRyx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDO1lBQ3pGLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxLQUFLLEdBQUcsRUFBRSxNQUFNLEVBQUUsVUFBbUIsRUFBRSxDQUFDO1lBRTlDLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV4RSxNQUFNLGdCQUFnQixHQUFHLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssUUFBUSxDQUFDLENBQUM7WUFDeEYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLEtBQUssR0FBRyxFQUFFLE1BQU0sRUFBRSxVQUFtQixFQUFFLENBQUM7WUFFOUMsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRXhFLE1BQU0sZ0JBQWdCLEdBQUcsdUJBQXVCLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sS0FBSyxXQUFXLENBQUMsQ0FBQztZQUMzRixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELE1BQU0sS0FBSyxHQUFHLEVBQUUsTUFBTSxFQUFFLGVBQXdCLEVBQUUsU0FBUyxFQUFFLE1BQWUsRUFBRSxDQUFDO1lBRS9FLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV4RSxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBc0MsQ0FBQztZQUNqRSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLHNCQUFzQixDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxNQUFNLEtBQUssR0FBRyxFQUFFLE1BQU0sRUFBRSxlQUF3QixFQUFFLFNBQVMsRUFBRSxLQUFjLEVBQUUsQ0FBQztZQUU5RSxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFeEUsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLElBQXNDLENBQUM7WUFDakUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzRixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMzQyxNQUFNLEtBQUssR0FBRyxFQUFFLE1BQU0sRUFBRSxTQUFrQixFQUFFLFNBQVMsRUFBRSxNQUFlLEVBQUUsQ0FBQztZQUV6RSxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFeEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNDLE1BQU0sS0FBSyxHQUFHLEVBQUUsTUFBTSxFQUFFLFNBQWtCLEVBQUUsU0FBUyxFQUFFLE1BQWUsRUFBRSxDQUFDO1lBRXpFLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV4RSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUQsTUFBTSxLQUFLLEdBQUc7Z0JBQ1osTUFBTSxFQUFFLFNBQWtCO2dCQUMxQixNQUFNLEVBQUUsZUFBd0I7Z0JBQ2hDLFNBQVMsRUFBRSxNQUFlO2FBQzNCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFeEUsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLElBQXNDLENBQUM7WUFDakUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25ELGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRWhGLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUVyRSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1QyxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1lBQzFFLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTFGLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQ2hELENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG9EQUFvRCxFQUFFLEdBQUcsRUFBRTtRQUNsRSxNQUFNLGdCQUFnQixHQUFHLDBCQUEwQixDQUFDO1FBRXBELEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxrQ0FBa0MsQ0FBQyxxQkFBcUIsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBRS9GLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHdCQUF3QixDQUFDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXJGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQ3JCLE9BQU8sRUFBRSxJQUFJO2dCQUNiLElBQUksRUFBRSxrQkFBa0I7Z0JBQ3hCLE9BQU8sRUFBRSwrQ0FBK0M7YUFDekQsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLDhCQUE4QixDQUFDLHFCQUFxQixDQUFDLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUN0RyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RCxNQUFNLGFBQWEsR0FBRyxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQzVELGtDQUFrQyxDQUFDLHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTFGLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyx3QkFBd0IsQ0FBQyxRQUFRLEVBQUUsaUJBQWlCLENBQUMsQ0FDakUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pELE1BQU0sU0FBUyxHQUFHLGNBQWMsQ0FBQztZQUVqQyxNQUFNLE1BQU0sQ0FDVixVQUFVLENBQUMsd0JBQXdCLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUN6RCxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1QyxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBQzdELGtDQUFrQyxDQUFDLHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXpGLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyx3QkFBd0IsQ0FBQyxRQUFRLEVBQUUsZ0JBQWdCLENBQUMsQ0FDaEUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNkRBQTZELEVBQUUsR0FBRyxFQUFFO1FBQzNFLE1BQU0sZ0JBQWdCLEdBQUcsMEJBQTBCLENBQUM7UUFFcEQsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELE1BQU0sY0FBYyxHQUFHLEVBQUUsTUFBTSxFQUFFLFFBQWlCLEVBQUUsQ0FBQztZQUNyRCxrQ0FBa0MsQ0FBQywrQkFBK0IsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVoRyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQywrQkFBK0IsQ0FDN0QsUUFBUSxFQUNSLGdCQUFnQixFQUNoQixjQUFjLENBQ2YsQ0FBQztZQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQ3JCLE9BQU8sRUFBRSxJQUFJO2dCQUNiLE9BQU8sRUFBRSxzQ0FBc0M7YUFDaEQsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLDhCQUE4QixDQUFDLCtCQUErQixDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQzFGLGdCQUFnQjtnQkFDaEIsTUFBTSxFQUFFLFFBQVE7Z0JBQ2hCLE1BQU0sRUFBRSxRQUFRLENBQUMsRUFBRTthQUNwQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLGNBQWMsR0FBRyxFQUFFLE1BQU0sRUFBRSxRQUFpQixFQUFFLENBQUM7WUFDckQsa0NBQWtDLENBQUMsK0JBQStCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFaEcsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsK0JBQStCLENBQzdELFFBQVEsRUFDUixnQkFBZ0IsRUFDaEIsY0FBYyxDQUNmLENBQUM7WUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUNyQixPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUsc0NBQXNDO2FBQ2hELENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyw4QkFBOEIsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUMxRixnQkFBZ0I7Z0JBQ2hCLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixNQUFNLEVBQUUsUUFBUSxDQUFDLEVBQUU7YUFDcEIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0RBQWdELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUQsTUFBTSxjQUFjLEdBQUcsRUFBRSxNQUFNLEVBQUUsU0FBa0IsRUFBRSxDQUFDO1lBQ3RELGtDQUFrQyxDQUFDLCtCQUErQixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRWhHLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLCtCQUErQixDQUM3RCxRQUFRLEVBQ1IsZ0JBQWdCLEVBQ2hCLGNBQWMsQ0FDZixDQUFDO1lBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDckIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsT0FBTyxFQUFFLHVDQUF1QzthQUNqRCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RCxNQUFNLGNBQWMsR0FBRyxFQUFFLE1BQU0sRUFBRSxRQUFpQixFQUFFLENBQUM7WUFDckQsTUFBTSxhQUFhLEdBQUcsSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUM1RCxrQ0FBa0MsQ0FBQywrQkFBK0IsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUVwRyxNQUFNLE1BQU0sQ0FDVixVQUFVLENBQUMsK0JBQStCLENBQUMsUUFBUSxFQUFFLGlCQUFpQixFQUFFLGNBQWMsQ0FBQyxDQUN4RixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaURBQWlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsTUFBTSxjQUFjLEdBQUcsRUFBRSxNQUFNLEVBQUUsUUFBaUIsRUFBRSxDQUFDO1lBQ3JELE1BQU0sc0JBQXNCLEdBQUcsSUFBSSxLQUFLLENBQUMsd0NBQXdDLENBQUMsQ0FBQztZQUNuRixrQ0FBa0MsQ0FBQywrQkFBK0IsQ0FBQyxpQkFBaUIsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBRTdHLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQywrQkFBK0IsQ0FBQyxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxDQUFDLENBQ3ZGLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVDLE1BQU0sY0FBYyxHQUFHLEVBQUUsTUFBTSxFQUFFLFFBQWlCLEVBQUUsQ0FBQztZQUNyRCxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ3pELGtDQUFrQyxDQUFDLCtCQUErQixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRW5HLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQywrQkFBK0IsQ0FBQyxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxDQUFDLENBQ3ZGLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtRQUN6RCxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2Qsa0NBQWtDLENBQUMsOEJBQThCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDakcsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFakUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDckIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsT0FBTyxFQUFFLHdDQUF3QzthQUNsRCxDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsOEJBQThCLENBQUMsOEJBQThCLENBQUMsQ0FBQyxvQkFBb0IsQ0FDeEYsUUFBUSxDQUFDLEVBQUUsRUFDWCxJQUFJLENBQ0wsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELE1BQU0sWUFBWSxHQUFHLElBQUksS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7WUFDcEUsa0NBQWtDLENBQUMsOEJBQThCLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFbEcsTUFBTSxNQUFNLENBQ1YsVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxDQUM1QyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0MsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbEQsTUFBTSxDQUFDLDhCQUE4QixDQUFDLDhCQUE4QixDQUFDLENBQUMsb0JBQW9CLENBQ3hGLFFBQVEsQ0FBQyxFQUFFLEVBQ1gsSUFBSSxDQUNMLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtRQUN6RCxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2Qsa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUN2RyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRSxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQywwQkFBMEIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVyRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUNyQixPQUFPLEVBQUUsSUFBSTtnQkFDYixJQUFJLEVBQUUsdUJBQXVCO2dCQUM3QixPQUFPLEVBQUUsdURBQXVEO2FBQ2pFLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyw4QkFBOEIsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDdkYsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsMEJBQTBCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFckUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBQzlELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLHlCQUF5QixDQUFDLENBQUM7WUFDOUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUM3RCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDckQsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6QyxNQUFNLFVBQVUsR0FBRztnQkFDakIsb0JBQW9CLEVBQUUsQ0FBQztnQkFDdkIsdUJBQXVCLEVBQUUsQ0FBQztnQkFDMUIsdUJBQXVCLEVBQUUsQ0FBQztnQkFDMUIsc0JBQXNCLEVBQUUsQ0FBQztnQkFDekIseUJBQXlCLEVBQUUsQ0FBQztnQkFDNUIsY0FBYyxFQUFFLEVBQUU7Z0JBQ2xCLFlBQVksRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUU7Z0JBQ3BFLG1CQUFtQixFQUFFLEVBQUU7YUFDeEIsQ0FBQztZQUNGLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRXhGLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLDBCQUEwQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRXJFLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1QyxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1lBQzFFLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTFGLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQywwQkFBMEIsQ0FBQyxRQUFRLENBQUMsQ0FDaEQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsK0NBQStDLEVBQUUsR0FBRyxFQUFFO1FBQzdELFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxrQ0FBa0MsQ0FBQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ3ZHLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25FLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLDRCQUE0QixFQUFFLENBQUM7WUFFL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDckIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsSUFBSSxFQUFFLHVCQUF1QjtnQkFDN0IsT0FBTyxFQUFFLHlEQUF5RDthQUNuRSxDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsOEJBQThCLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQ3ZGLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLDRCQUE0QixFQUFFLENBQUM7WUFFL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDL0QsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1QyxNQUFNLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyxnREFBZ0QsQ0FBQyxDQUFDO1lBQ2pGLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTFGLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyw0QkFBNEIsRUFBRSxDQUMxQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDekMsRUFBRSxDQUFDLCtEQUErRCxFQUFFLEdBQUcsRUFBRTtZQUN2RSxNQUFNLGFBQWEsR0FBRztnQkFDcEIseUJBQXlCO2dCQUN6Qix3QkFBd0I7Z0JBQ3hCLDBCQUEwQjtnQkFDMUIsaUNBQWlDO2dCQUNqQyx3QkFBd0I7Z0JBQ3hCLDRCQUE0QjthQUM3QixDQUFDO1lBRUYsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLFFBQW1ELENBQUMsQ0FBQyxDQUFDO2dCQUMvRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNyQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUN4QyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUN4QyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMERBQTBELEVBQUUsR0FBRyxFQUFFO1lBQ2xFLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBQ3ZGLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtRQUMxQyxFQUFFLENBQUMsb0RBQW9ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEUsa0NBQWtDLENBQUMsOEJBQThCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDL0Ysa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUVyRyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUVwRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRSxrQ0FBa0MsQ0FBQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBRXJHLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUVyRSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGNBQW1CLEVBQUUsRUFBRTtnQkFDMUMsc0NBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUMzRixNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN2RCxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNwRCxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5REFBeUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RSxrQ0FBa0MsQ0FBQyxxQkFBcUIsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBRS9GLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLHdCQUF3QixDQUFDLFFBQVEsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1lBRS9GLHNDQUFjLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbkQsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaURBQWlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0Qsa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUVyRyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQywwQkFBMEIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVyRSxzQ0FBYyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUU7Z0JBQzVDLHNCQUFzQjtnQkFDdEIseUJBQXlCO2dCQUN6Qix5QkFBeUI7Z0JBQ3pCLHdCQUF3QjtnQkFDeEIsMkJBQTJCO2dCQUMzQixnQkFBZ0I7YUFDakIsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3RCxNQUFNLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELE1BQU0sWUFBWSxHQUFHLElBQUksS0FBSyxDQUFDLGdEQUFnRCxDQUFDLENBQUM7WUFDakYsa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFMUYsTUFBTSxNQUFNLENBQ1YsVUFBVSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FDaEQsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hELE1BQU0sT0FBTyxHQUFHLElBQUksS0FBSyxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDeEQsa0NBQWtDLENBQUMsOEJBQThCLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFN0YsTUFBTSxNQUFNLENBQ1YsVUFBVSxDQUFDLHVCQUF1QixDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUMvRCxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0MsTUFBTSxlQUFlLEdBQUcsSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztZQUNqRSxrQ0FBa0MsQ0FBQywrQkFBK0IsQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUV0RyxNQUFNLE1BQU0sQ0FDVixVQUFVLENBQUMsK0JBQStCLENBQ3hDLFFBQVEsRUFDUixvQkFBb0IsRUFDcEIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLENBQ3JCLENBQ0YsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxLQUFLLENBQUMsZ0RBQWdELENBQUMsQ0FBQztZQUNyRixrQ0FBa0MsQ0FBQywrQkFBK0IsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXZHLE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQywrQkFBK0IsQ0FDeEMsUUFBUSxFQUNSLG9CQUFvQixFQUNwQixFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FDckIsQ0FDRixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsZ0RBQWdELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUQsMkJBQTJCO1lBQzNCLGtDQUFrQyxDQUFDLDhCQUE4QixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQy9GLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDckcsTUFBTSxjQUFjLEdBQUcsTUFBTSxVQUFVLENBQUMsdUJBQXVCLENBQUMsUUFBUSxFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDNUYsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFMUMsMkJBQTJCO1lBQzNCLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ2xGLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFakQsNkJBQTZCO1lBQzdCLGtDQUFrQyxDQUFDLHFCQUFxQixDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDL0YsTUFBTSxPQUFPLEdBQUcsTUFBTSxVQUFVLENBQUMsd0JBQXdCLENBQUMsUUFBUSxFQUFFLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzNGLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVwRCwrQkFBK0I7WUFDL0Isa0NBQWtDLENBQUMsK0JBQStCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDaEcsTUFBTSxXQUFXLEdBQUcsTUFBTSxVQUFVLENBQUMsK0JBQStCLENBQ2xFLFFBQVEsRUFDUixrQkFBa0IsQ0FBQyxFQUFFLEVBQ3JCLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUNyQixDQUFDO1lBQ0YsTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFdkMsb0JBQW9CO1lBQ3BCLGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDckcsTUFBTSxLQUFLLEdBQUcsTUFBTSxVQUFVLENBQUMsMEJBQTBCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsOENBQThDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDNUQsa0NBQWtDLENBQUMsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUVyRyw4QkFBOEI7WUFDOUIsTUFBTSxhQUFhLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFDL0YsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXBGLDhDQUE4QztZQUM5QyxNQUFNLFlBQVksR0FBRyxNQUFNLFVBQVUsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3JFLE1BQU0sRUFBRSxlQUFlO2dCQUN2QixTQUFTLEVBQUUsTUFBTTthQUNsQixDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV4QywrQkFBK0I7WUFDL0IsTUFBTSxjQUFjLEdBQUcsTUFBTSxVQUFVLENBQUMsc0JBQXNCLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7WUFDakcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RGLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RELGtDQUFrQyxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFFckcsbUJBQW1CO1lBQ25CLE1BQU0sV0FBVyxHQUFHLE1BQU0sVUFBVSxDQUFDLDRCQUE0QixFQUFFLENBQUM7WUFDcEUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUUzRCwwQkFBMEI7WUFDMUIsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDcEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlELE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvY29tbXVuaXRpZXMvY29udHJvbGxlcnMvY29tbXVuaXR5LXJlY29tbWVuZGF0aW9uLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvbXByZWhlbnNpdmUgVGVzdCBTdWl0ZSBmb3IgQ29tbXVuaXR5UmVjb21tZW5kYXRpb25Db250cm9sbGVyXG4gKiBUZXN0cyBjb21tdW5pdHkgcmVjb21tZW5kYXRpb24gZnVuY3Rpb25hbGl0eSB3aXRoIHJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2xcbiAqL1xuXG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEJhZFJlcXVlc3RFeGNlcHRpb24sIE5vdEZvdW5kRXhjZXB0aW9uLCBGb3JiaWRkZW5FeGNlcHRpb24sIEh0dHBFeGNlcHRpb24sIEh0dHBTdGF0dXMgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBDb21tdW5pdHlSZWNvbW1lbmRhdGlvbkNvbnRyb2xsZXIgfSBmcm9tICcuL2NvbW11bml0eS1yZWNvbW1lbmRhdGlvbi5jb250cm9sbGVyJztcbmltcG9ydCB7IENvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NvbW11bml0eS1yZWNvbW1lbmRhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uLy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFJvbGVCYXNlZEFjY2Vzc0d1YXJkIH0gZnJvbSAnLi4vLi4vYXV0aC9ndWFyZHMvcm9sZS1iYXNlZC1hY2Nlc3MuZ3VhcmQnO1xuaW1wb3J0IHsgU2VjdXJpdHlHdWFyZFRlc3RVdGlscywgUm9sZUJhc2VkVGVzdFV0aWxzIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9hdXRoLXRlc3RpbmctaGVscGVycyc7XG5pbXBvcnQgeyBNb2NrQnVpbGRlciwgVGVzdERhdGFHZW5lcmF0b3IsIFRlc3RBc3NlcnRpb25zIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9lbmhhbmNlZC10ZXN0LWhlbHBlcnMnO1xuaW1wb3J0IHsgVEVTVF9VU0VSX0lEUywgVEVTVF9FTUFJTFMgfSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2luZGV4JztcblxuZGVzY3JpYmUoJ0NvbW11bml0eVJlY29tbWVuZGF0aW9uQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IENvbW11bml0eVJlY29tbWVuZGF0aW9uQ29udHJvbGxlcjtcbiAgbGV0IGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZTogQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlO1xuICBsZXQgbW9kdWxlOiBUZXN0aW5nTW9kdWxlO1xuXG4gIC8vIE1vY2sgQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlXG4gIGNvbnN0IG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UgPSB7XG4gICAgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyOiBqZXN0LmZuKCksXG4gICAgZ2V0VXNlclJlY29tbWVuZGF0aW9uczogamVzdC5mbigpLFxuICAgIGdldFJlY29tbWVuZGF0aW9uQnlJZDogamVzdC5mbigpLFxuICAgIGhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb246IGplc3QuZm4oKSxcbiAgICBnZXRSZWNvbW1lbmRhdGlvblN0YXRzOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgLy8gTW9jayBHdWFyZHNcbiAgY29uc3QgbW9ja0p3dEF1dGhHdWFyZCA9IHtcbiAgICBjYW5BY3RpdmF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgfTtcblxuICBjb25zdCBtb2NrUm9sZUJhc2VkQWNjZXNzR3VhcmQgPSB7XG4gICAgY2FuQWN0aXZhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSksXG4gIH07XG5cbiAgLy8gVGVzdCBkYXRhXG4gIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgIGlkOiBURVNUX1VTRVJfSURTLkNMSUVOVCxcbiAgICBlbWFpbDogVEVTVF9FTUFJTFMuQ0xJRU5ULFxuICAgIHJvbGU6ICdjbGllbnQnLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tDb21tdW5pdHkgPSB7XG4gICAgaWQ6ICdjb21tdW5pdHlfMTIzNDU2Nzg5JyxcbiAgICBuYW1lOiAnQW54aWV0eSBTdXBwb3J0IEdyb3VwJyxcbiAgICBzbHVnOiAnYW54aWV0eS1zdXBwb3J0JyxcbiAgICBkZXNjcmlwdGlvbjogJ0Egc3VwcG9ydGl2ZSBjb21tdW5pdHkgZm9yIHRob3NlIGRlYWxpbmcgd2l0aCBhbnhpZXR5IGRpc29yZGVycycsXG4gICAgaW1hZ2VVcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2ltYWdlcy9hbnhpZXR5LWNvbW11bml0eS5qcGcnLFxuICAgIG1lbWJlckNvdW50OiAxMjQ3LFxuICAgIGlzUHVibGljOiB0cnVlLFxuICAgIG1vZGVyYXRvcklkOiBURVNUX1VTRVJfSURTLk1PREVSQVRPUixcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDAwOjAwOjAwWicpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDItMTRUMTA6MDA6MDBaJyksXG4gIH07XG5cbiAgY29uc3QgbW9ja1JlY29tbWVuZGF0aW9uID0ge1xuICAgIGlkOiAncmVjb21tZW5kYXRpb25fMTIzNDU2Nzg5JyxcbiAgICB1c2VySWQ6IFRFU1RfVVNFUl9JRFMuQ0xJRU5ULFxuICAgIGNvbW11bml0eUlkOiAnY29tbXVuaXR5XzEyMzQ1Njc4OScsXG4gICAgY29tbXVuaXR5OiBtb2NrQ29tbXVuaXR5LFxuICAgIHNjb3JlOiAwLjg3LFxuICAgIHJlYXNvbmluZzogJ0Jhc2VkIG9uIHlvdXIgYW54aWV0eSBhc3Nlc3NtZW50IHNjb3JlcyBhbmQgcHJlZmVyZW5jZSBmb3IgZ3JvdXAgc3VwcG9ydCwgdGhpcyBjb21tdW5pdHkgd291bGQgYmUgaGlnaGx5IGJlbmVmaWNpYWwgZm9yIHlvdXIgbWVudGFsIGhlYWx0aCBqb3VybmV5LicsXG4gICAgYXNzZXNzbWVudFNjb3Jlczoge1xuICAgICAgYW54aWV0eTogNi44LFxuICAgICAgZGVwcmVzc2lvbjogMy4yLFxuICAgICAgc3RyZXNzOiA3LjEsXG4gICAgICBzb2NpYWxBbnhpZXR5OiA1LjksXG4gICAgfSxcbiAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDI0LTAyLTE0VDEwOjAwOjAwWicpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoJzIwMjQtMDItMTRUMTA6MDA6MDBaJyksXG4gICAgaW50ZXJhY3Rpb25EYXRlOiBudWxsLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tSZWNvbW1lbmRhdGlvbnNMaXN0ID0gW1xuICAgIG1vY2tSZWNvbW1lbmRhdGlvbixcbiAgICB7XG4gICAgICAuLi5tb2NrUmVjb21tZW5kYXRpb24sXG4gICAgICBpZDogJ3JlY29tbWVuZGF0aW9uXzk4NzY1NDMyMScsXG4gICAgICBjb21tdW5pdHlJZDogJ2NvbW11bml0eV85ODc2NTQzMjEnLFxuICAgICAgY29tbXVuaXR5OiB7XG4gICAgICAgIC4uLm1vY2tDb21tdW5pdHksXG4gICAgICAgIGlkOiAnY29tbXVuaXR5Xzk4NzY1NDMyMScsXG4gICAgICAgIG5hbWU6ICdEZXByZXNzaW9uIFJlY292ZXJ5JyxcbiAgICAgICAgc2x1ZzogJ2RlcHJlc3Npb24tcmVjb3ZlcnknLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1N1cHBvcnQgZm9yIGRlcHJlc3Npb24gcmVjb3ZlcnkgYW5kIG1lbnRhbCB3ZWxsbmVzcycsXG4gICAgICAgIG1lbWJlckNvdW50OiA4OTIsXG4gICAgICB9LFxuICAgICAgc2NvcmU6IDAuNzQsXG4gICAgICByZWFzb25pbmc6ICdZb3VyIGRlcHJlc3Npb24gc2NvcmVzIGluZGljYXRlIHRoaXMgY29tbXVuaXR5IGNvdWxkIHByb3ZpZGUgdmFsdWFibGUgcGVlciBzdXBwb3J0LicsXG4gICAgICBhc3Nlc3NtZW50U2NvcmVzOiB7XG4gICAgICAgIGFueGlldHk6IDQuMSxcbiAgICAgICAgZGVwcmVzc2lvbjogNy4zLFxuICAgICAgICBzdHJlc3M6IDUuOCxcbiAgICAgICAgc29jaWFsQW54aWV0eTogMy4yLFxuICAgICAgfSxcbiAgICAgIHN0YXR1czogJ2pvaW5lZCcsXG4gICAgICBpbnRlcmFjdGlvbkRhdGU6IG5ldyBEYXRlKCcyMDI0LTAyLTEwVDE0OjMwOjAwWicpLFxuICAgIH0sXG4gICAge1xuICAgICAgLi4ubW9ja1JlY29tbWVuZGF0aW9uLFxuICAgICAgaWQ6ICdyZWNvbW1lbmRhdGlvbl80NTY3ODkxMjMnLFxuICAgICAgY29tbXVuaXR5SWQ6ICdjb21tdW5pdHlfNDU2Nzg5MTIzJyxcbiAgICAgIGNvbW11bml0eToge1xuICAgICAgICAuLi5tb2NrQ29tbXVuaXR5LFxuICAgICAgICBpZDogJ2NvbW11bml0eV80NTY3ODkxMjMnLFxuICAgICAgICBuYW1lOiAnTWluZGZ1bG5lc3MgJiBNZWRpdGF0aW9uJyxcbiAgICAgICAgc2x1ZzogJ21pbmRmdWxuZXNzLW1lZGl0YXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1ByYWN0aWNlIG1pbmRmdWxuZXNzIGFuZCBtZWRpdGF0aW9uIHRlY2huaXF1ZXMgdG9nZXRoZXInLFxuICAgICAgICBtZW1iZXJDb3VudDogMjE1NixcbiAgICAgIH0sXG4gICAgICBzY29yZTogMC42NSxcbiAgICAgIHJlYXNvbmluZzogJ01pbmRmdWxuZXNzIHByYWN0aWNlcyBjYW4gaGVscCB3aXRoIHN0cmVzcyBtYW5hZ2VtZW50IGJhc2VkIG9uIHlvdXIgYXNzZXNzbWVudC4nLFxuICAgICAgc3RhdHVzOiAnZGlzbWlzc2VkJyxcbiAgICAgIGludGVyYWN0aW9uRGF0ZTogbmV3IERhdGUoJzIwMjQtMDItMDhUMDk6MTU6MDBaJyksXG4gICAgfSxcbiAgXTtcblxuICBjb25zdCBtb2NrUmVjb21tZW5kYXRpb25TdGF0cyA9IHtcbiAgICB0b3RhbFJlY29tbWVuZGF0aW9uczogMTU2LFxuICAgIGFjY2VwdGVkUmVjb21tZW5kYXRpb25zOiA4OSxcbiAgICByZWplY3RlZFJlY29tbWVuZGF0aW9uczogMjMsXG4gICAgcGVuZGluZ1JlY29tbWVuZGF0aW9uczogNDQsXG4gICAgYXZlcmFnZUNvbXBhdGliaWxpdHlTY29yZTogMC43NixcbiAgICB0b3BDb21tdW5pdGllczogW1xuICAgICAge1xuICAgICAgICBjb21tdW5pdHlJZDogJ2NvbW11bml0eV8xMjM0NTY3ODknLFxuICAgICAgICBjb21tdW5pdHlOYW1lOiAnQW54aWV0eSBTdXBwb3J0IEdyb3VwJyxcbiAgICAgICAgYWNjZXB0YW5jZVJhdGU6IDAuODMsXG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zOiA2NyxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGNvbW11bml0eUlkOiAnY29tbXVuaXR5Xzk4NzY1NDMyMScsXG4gICAgICAgIGNvbW11bml0eU5hbWU6ICdEZXByZXNzaW9uIFJlY292ZXJ5JyxcbiAgICAgICAgYWNjZXB0YW5jZVJhdGU6IDAuNzgsXG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zOiA1NCxcbiAgICAgIH0sXG4gICAgXSxcbiAgICB3ZWVrbHlUcmVuZHM6IHtcbiAgICAgIGdlbmVyYXRlZDogMjMsXG4gICAgICBhY2NlcHRlZDogMTgsXG4gICAgICByZWplY3RlZDogMyxcbiAgICAgIHBlbmRpbmc6IDIsXG4gICAgfSxcbiAgICBjYXRlZ29yeVBlcmZvcm1hbmNlOiB7XG4gICAgICBhbnhpZXR5OiB7IGF2ZXJhZ2VTY29yZTogMC44MiwgYWNjZXB0YW5jZVJhdGU6IDAuODUgfSxcbiAgICAgIGRlcHJlc3Npb246IHsgYXZlcmFnZVNjb3JlOiAwLjc5LCBhY2NlcHRhbmNlUmF0ZTogMC44MSB9LFxuICAgICAgc3RyZXNzOiB7IGF2ZXJhZ2VTY29yZTogMC43NCwgYWNjZXB0YW5jZVJhdGU6IDAuNzYgfSxcbiAgICAgIGFkZGljdGlvbjogeyBhdmVyYWdlU2NvcmU6IDAuNzEsIGFjY2VwdGFuY2VSYXRlOiAwLjczIH0sXG4gICAgfSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBtb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgY29udHJvbGxlcnM6IFtDb21tdW5pdHlSZWNvbW1lbmRhdGlvbkNvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gICAgICAub3ZlcnJpZGVHdWFyZChKd3RBdXRoR3VhcmQpXG4gICAgICAudXNlVmFsdWUobW9ja0p3dEF1dGhHdWFyZClcbiAgICAgIC5vdmVycmlkZUd1YXJkKFJvbGVCYXNlZEFjY2Vzc0d1YXJkKVxuICAgICAgLnVzZVZhbHVlKG1vY2tSb2xlQmFzZWRBY2Nlc3NHdWFyZClcbiAgICAgIC5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxDb21tdW5pdHlSZWNvbW1lbmRhdGlvbkNvbnRyb2xsZXI+KENvbW11bml0eVJlY29tbWVuZGF0aW9uQ29udHJvbGxlcik7XG4gICAgY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlID0gbW9kdWxlLmdldDxDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2U+KENvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb250cm9sbGVyIEluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZSBpbmplY3RlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWN1cml0eSBHdWFyZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBiZSBwcm90ZWN0ZWQgYnkgSnd0QXV0aEd1YXJkIGFuZCBSb2xlQmFzZWRBY2Nlc3NHdWFyZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGd1YXJkcyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoJ19fZ3VhcmRzX18nLCBDb21tdW5pdHlSZWNvbW1lbmRhdGlvbkNvbnRyb2xsZXIpO1xuICAgICAgZXhwZWN0KGd1YXJkcykudG9Db250YWluKEp3dEF1dGhHdWFyZCk7XG4gICAgICBleHBlY3QoZ3VhcmRzKS50b0NvbnRhaW4oUm9sZUJhc2VkQWNjZXNzR3VhcmQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIHByb3BlciByb3V0ZSBkZWNvcmF0b3JzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29udHJvbGxlck1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgncGF0aCcsIENvbW11bml0eVJlY29tbWVuZGF0aW9uQ29udHJvbGxlcik7XG4gICAgICBleHBlY3QoY29udHJvbGxlck1ldGFkYXRhKS50b0JlKCdjb21tdW5pdGllcy9yZWNvbW1lbmRhdGlvbnMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucy9nZW5lcmF0ZScsICgpID0+IHtcbiAgICBjb25zdCBnZW5lcmF0ZUR0byA9IHsgZm9yY2U6IGZhbHNlIH07XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uc0xpc3QpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSByZWNvbW1lbmRhdGlvbnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgZ2VuZXJhdGVEdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogbW9ja1JlY29tbWVuZGF0aW9uc0xpc3QsXG4gICAgICAgIG1lc3NhZ2U6IGBHZW5lcmF0ZWQgJHttb2NrUmVjb21tZW5kYXRpb25zTGlzdC5sZW5ndGh9IHJlY29tbWVuZGF0aW9uc2AsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uc0ZvclVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBtb2NrVXNlci5pZCxcbiAgICAgICAgZ2VuZXJhdGVEdG8uZm9yY2UsXG4gICAgICApO1xuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXNlci5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBmb3JjZWQgcmVnZW5lcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZm9yY2VkRHRvID0geyBmb3JjZTogdHJ1ZSB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCBmb3JjZWREdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIG1vY2tVc2VyLmlkLFxuICAgICAgICB0cnVlLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHJlY29tbWVuZGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIGdlbmVyYXRlRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgICBtZXNzYWdlOiAnR2VuZXJhdGVkIDAgcmVjb21tZW5kYXRpb25zJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMgZHVyaW5nIGdlbmVyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBnZW5lcmF0ZSByZWNvbW1lbmRhdGlvbnMnKTtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgZ2VuZXJhdGVEdG8pXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhzZXJ2aWNlRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMgZHVyaW5nIHJldHJpZXZhbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJldHJpZXZhbEVycm9yID0gbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgcmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMubW9ja1JlamVjdGVkVmFsdWUocmV0cmlldmFsRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIGdlbmVyYXRlRHRvKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3cocmV0cmlldmFsRXJyb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9jb21tdW5pdGllcy9yZWNvbW1lbmRhdGlvbnMvbWUnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uc0xpc3QpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdXNlciByZWNvbW1lbmRhdGlvbnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSB7fTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCBxdWVyeSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBtb2NrUmVjb21tZW5kYXRpb25zTGlzdCxcbiAgICAgICAgbWVzc2FnZTogJ1JlY29tbWVuZGF0aW9ucyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXNlci5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBieSBzdGF0dXMgLSBwZW5kaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSB7IHN0YXR1czogJ3BlbmRpbmcnIGFzIGNvbnN0IH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgcXVlcnkpO1xuXG4gICAgICBjb25zdCBleHBlY3RlZEZpbHRlcmVkID0gbW9ja1JlY29tbWVuZGF0aW9uc0xpc3QuZmlsdGVyKHJlYyA9PiByZWMuc3RhdHVzID09PSAncGVuZGluZycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0VxdWFsKGV4cGVjdGVkRmlsdGVyZWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgc3RhdHVzIC0gYWNjZXB0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHsgc3RhdHVzOiAnYWNjZXB0ZWQnIGFzIGNvbnN0IH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgcXVlcnkpO1xuXG4gICAgICBjb25zdCBleHBlY3RlZEZpbHRlcmVkID0gbW9ja1JlY29tbWVuZGF0aW9uc0xpc3QuZmlsdGVyKHJlYyA9PiByZWMuc3RhdHVzID09PSAnam9pbmVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvRXF1YWwoZXhwZWN0ZWRGaWx0ZXJlZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBieSBzdGF0dXMgLSByZWplY3RlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBzdGF0dXM6ICdyZWplY3RlZCcgYXMgY29uc3QgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCBxdWVyeSk7XG5cbiAgICAgIGNvbnN0IGV4cGVjdGVkRmlsdGVyZWQgPSBtb2NrUmVjb21tZW5kYXRpb25zTGlzdC5maWx0ZXIocmVjID0+IHJlYy5zdGF0dXMgPT09ICdkaXNtaXNzZWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbChleHBlY3RlZEZpbHRlcmVkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc29ydCBieSBjb21wYXRpYmlsaXR5IHNjb3JlIC0gZGVzY2VuZGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0geyBzb3J0Qnk6ICdjb21wYXRpYmlsaXR5JyBhcyBjb25zdCwgc29ydE9yZGVyOiAnZGVzYycgYXMgY29uc3QgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCBxdWVyeSk7XG5cbiAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSByZXN1bHQuZGF0YSBhcyB0eXBlb2YgbW9ja1JlY29tbWVuZGF0aW9uc0xpc3Q7XG4gICAgICBleHBlY3Qoc29ydGVkRGF0YVswXS5zY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChzb3J0ZWREYXRhWzFdLnNjb3JlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc29ydCBieSBjb21wYXRpYmlsaXR5IHNjb3JlIC0gYXNjZW5kaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSB7IHNvcnRCeTogJ2NvbXBhdGliaWxpdHknIGFzIGNvbnN0LCBzb3J0T3JkZXI6ICdhc2MnIGFzIGNvbnN0IH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgcXVlcnkpO1xuXG4gICAgICBjb25zdCBzb3J0ZWREYXRhID0gcmVzdWx0LmRhdGEgYXMgdHlwZW9mIG1vY2tSZWNvbW1lbmRhdGlvbnNMaXN0O1xuICAgICAgZXhwZWN0KHNvcnRlZERhdGFbMF0uc2NvcmUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoc29ydGVkRGF0YVtzb3J0ZWREYXRhLmxlbmd0aCAtIDFdLnNjb3JlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc29ydCBieSBjcmVhdGVkIGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHsgc29ydEJ5OiAnY3JlYXRlZCcgYXMgY29uc3QsIHNvcnRPcmRlcjogJ2Rlc2MnIGFzIGNvbnN0IH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgcXVlcnkpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQuZGF0YSkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNvcnQgYnkgdXBkYXRlZCBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSB7IHNvcnRCeTogJ3VwZGF0ZWQnIGFzIGNvbnN0LCBzb3J0T3JkZXI6ICdkZXNjJyBhcyBjb25zdCB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHF1ZXJ5KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LmRhdGEpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tYmluZWQgZmlsdGVyaW5nIGFuZCBzb3J0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnIGFzIGNvbnN0LFxuICAgICAgICBzb3J0Qnk6ICdjb21wYXRpYmlsaXR5JyBhcyBjb25zdCxcbiAgICAgICAgc29ydE9yZGVyOiAnZGVzYycgYXMgY29uc3QsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHF1ZXJ5KTtcblxuICAgICAgY29uc3QgcmVzdWx0RGF0YSA9IHJlc3VsdC5kYXRhIGFzIHR5cGVvZiBtb2NrUmVjb21tZW5kYXRpb25zTGlzdDtcbiAgICAgIGV4cGVjdChyZXN1bHREYXRhLmV2ZXJ5KHJlYyA9PiByZWMuc3RhdHVzID09PSAncGVuZGluZycpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgcmVjb21tZW5kYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCB7fSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHVzZXIgcmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHt9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvY29tbXVuaXRpZXMvcmVjb21tZW5kYXRpb25zLzpyZWNvbW1lbmRhdGlvbklkJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uSWQgPSAncmVjb21tZW5kYXRpb25fMTIzNDU2Nzg5JztcblxuICAgIGl0KCdzaG91bGQgZ2V0IHJlY29tbWVuZGF0aW9uIGRldGFpbHMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRSZWNvbW1lbmRhdGlvbkRldGFpbHMobW9ja1VzZXIsIHJlY29tbWVuZGF0aW9uSWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogbW9ja1JlY29tbWVuZGF0aW9uLFxuICAgICAgICBtZXNzYWdlOiAnUmVjb21tZW5kYXRpb24gZGV0YWlscyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHJlY29tbWVuZGF0aW9uSWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmVjb21tZW5kYXRpb24gbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm90Rm91bmRFcnJvciA9IG5ldyBFcnJvcignUmVjb21tZW5kYXRpb24gbm90IGZvdW5kJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uQnlJZC5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uRGV0YWlscyhtb2NrVXNlciwgJ25vbi1leGlzdGVudC1pZCcpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhub3RGb3VuZEVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgVVVJRCBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkSWQgPSAnaW52YWxpZC11dWlkJztcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uRGV0YWlscyhtb2NrVXNlciwgaW52YWxpZElkKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uRGV0YWlscyhtb2NrVXNlciwgcmVjb21tZW5kYXRpb25JZClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQVVQgL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucy86cmVjb21tZW5kYXRpb25JZC9pbnRlcmFjdCcsICgpID0+IHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbklkID0gJ3JlY29tbWVuZGF0aW9uXzEyMzQ1Njc4OSc7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBhY2NlcHQgaW50ZXJhY3Rpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW50ZXJhY3Rpb25EdG8gPSB7IGFjdGlvbjogJ2FjY2VwdCcgYXMgY29uc3QgfTtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24oXG4gICAgICAgIG1vY2tVc2VyLFxuICAgICAgICByZWNvbW1lbmRhdGlvbklkLFxuICAgICAgICBpbnRlcmFjdGlvbkR0byxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnUmVjb21tZW5kYXRpb24gYWNjZXB0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHJlY29tbWVuZGF0aW9uSWQsXG4gICAgICAgIGFjdGlvbjogJ2FjY2VwdCcsXG4gICAgICAgIHVzZXJJZDogbW9ja1VzZXIuaWQsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHJlamVjdCBpbnRlcmFjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnRlcmFjdGlvbkR0byA9IHsgYWN0aW9uOiAncmVqZWN0JyBhcyBjb25zdCB9O1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbihcbiAgICAgICAgbW9ja1VzZXIsXG4gICAgICAgIHJlY29tbWVuZGF0aW9uSWQsXG4gICAgICAgIGludGVyYWN0aW9uRHRvLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdSZWNvbW1lbmRhdGlvbiByZWplY3RlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgcmVjb21tZW5kYXRpb25JZCxcbiAgICAgICAgYWN0aW9uOiAncmVqZWN0JyxcbiAgICAgICAgdXNlcklkOiBtb2NrVXNlci5pZCxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGlzbWlzcyBpbnRlcmFjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnRlcmFjdGlvbkR0byA9IHsgYWN0aW9uOiAnZGlzbWlzcycgYXMgY29uc3QgfTtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24oXG4gICAgICAgIG1vY2tVc2VyLFxuICAgICAgICByZWNvbW1lbmRhdGlvbklkLFxuICAgICAgICBpbnRlcmFjdGlvbkR0byxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnUmVjb21tZW5kYXRpb24gZGlzbWlzc2VkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHJlY29tbWVuZGF0aW9uIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludGVyYWN0aW9uRHRvID0geyBhY3Rpb246ICdhY2NlcHQnIGFzIGNvbnN0IH07XG4gICAgICBjb25zdCBub3RGb3VuZEVycm9yID0gbmV3IEVycm9yKCdSZWNvbW1lbmRhdGlvbiBub3QgZm91bmQnKTtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbi5tb2NrUmVqZWN0ZWRWYWx1ZShub3RGb3VuZEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24obW9ja1VzZXIsICdub24tZXhpc3RlbnQtaWQnLCBpbnRlcmFjdGlvbkR0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KG5vdEZvdW5kRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYWxyZWFkeSBpbnRlcmFjdGVkIHJlY29tbWVuZGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW50ZXJhY3Rpb25EdG8gPSB7IGFjdGlvbjogJ2FjY2VwdCcgYXMgY29uc3QgfTtcbiAgICAgIGNvbnN0IGFscmVhZHlJbnRlcmFjdGVkRXJyb3IgPSBuZXcgRXJyb3IoJ1JlY29tbWVuZGF0aW9uIGFscmVhZHkgaW50ZXJhY3RlZCB3aXRoJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24ubW9ja1JlamVjdGVkVmFsdWUoYWxyZWFkeUludGVyYWN0ZWRFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKG1vY2tVc2VyLCByZWNvbW1lbmRhdGlvbklkLCBpbnRlcmFjdGlvbkR0bylcbiAgICAgICkucmVqZWN0cy50b1Rocm93KGFscmVhZHlJbnRlcmFjdGVkRXJyb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnRlcmFjdGlvbkR0byA9IHsgYWN0aW9uOiAnYWNjZXB0JyBhcyBjb25zdCB9O1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdEYXRhYmFzZSB1cGRhdGUgZmFpbGVkJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24ubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24obW9ja1VzZXIsIHJlY29tbWVuZGF0aW9uSWQsIGludGVyYWN0aW9uRHRvKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucy9yZWZyZXNoJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uc0ZvclVzZXIubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVmcmVzaCByZWNvbW1lbmRhdGlvbnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZWZyZXNoUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdSZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChjb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgbW9ja1VzZXIuaWQsXG4gICAgICAgIHRydWUsIC8vIGZvcmNlIHJlZnJlc2hcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9ycyBkdXJpbmcgcmVmcmVzaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlZnJlc2ggcmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlci5tb2NrUmVqZWN0ZWRWYWx1ZShzZXJ2aWNlRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIucmVmcmVzaFJlY29tbWVuZGF0aW9ucyhtb2NrVXNlcilcbiAgICAgICkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsd2F5cyBmb3JjZSByZWZyZXNoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY29udHJvbGxlci5yZWZyZXNoUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyKTtcblxuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uc0ZvclVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBtb2NrVXNlci5pZCxcbiAgICAgICAgdHJ1ZSwgLy8gc2hvdWxkIGFsd2F5cyBiZSB0cnVlIGZvciByZWZyZXNoXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9jb21tdW5pdGllcy9yZWNvbW1lbmRhdGlvbnMvc3RhdHMvbWUnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uU3RhdHMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdXNlciByZWNvbW1lbmRhdGlvbiBzdGF0cyBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVzZXJSZWNvbW1lbmRhdGlvblN0YXRzKG1vY2tVc2VyKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IG1vY2tSZWNvbW1lbmRhdGlvblN0YXRzLFxuICAgICAgICBtZXNzYWdlOiAnVXNlciByZWNvbW1lbmRhdGlvbiBzdGF0aXN0aWNzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHN0YXRzIHJlc3BvbnNlIHN0cnVjdHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9uU3RhdHMobW9ja1VzZXIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbFJlY29tbWVuZGF0aW9ucycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgnYWNjZXB0ZWRSZWNvbW1lbmRhdGlvbnMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ3JlamVjdGVkUmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCdwZW5kaW5nUmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCdhdmVyYWdlQ29tcGF0aWJpbGl0eVNjb3JlJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd0b3BDb21tdW5pdGllcycpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LmRhdGEudG9wQ29tbXVuaXRpZXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RhdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbXB0eVN0YXRzID0ge1xuICAgICAgICB0b3RhbFJlY29tbWVuZGF0aW9uczogMCxcbiAgICAgICAgYWNjZXB0ZWRSZWNvbW1lbmRhdGlvbnM6IDAsXG4gICAgICAgIHJlamVjdGVkUmVjb21tZW5kYXRpb25zOiAwLFxuICAgICAgICBwZW5kaW5nUmVjb21tZW5kYXRpb25zOiAwLFxuICAgICAgICBhdmVyYWdlQ29tcGF0aWJpbGl0eVNjb3JlOiAwLFxuICAgICAgICB0b3BDb21tdW5pdGllczogW10sXG4gICAgICAgIHdlZWtseVRyZW5kczogeyBnZW5lcmF0ZWQ6IDAsIGFjY2VwdGVkOiAwLCByZWplY3RlZDogMCwgcGVuZGluZzogMCB9LFxuICAgICAgICBjYXRlZ29yeVBlcmZvcm1hbmNlOiB7fSxcbiAgICAgIH07XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMubW9ja1Jlc29sdmVkVmFsdWUoZW1wdHlTdGF0cyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9uU3RhdHMobW9ja1VzZXIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEudG90YWxSZWNvbW1lbmRhdGlvbnMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEudG9wQ29tbXVuaXRpZXMpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlRXJyb3IgPSBuZXcgRXJyb3IoJ0ZhaWxlZCB0byByZXRyaWV2ZSByZWNvbW1lbmRhdGlvbiBzdGF0cycpO1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvblN0YXRzLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25TdGF0cyhtb2NrVXNlcilcbiAgICAgICkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHRVQgL2NvbW11bml0aWVzL3JlY29tbWVuZGF0aW9ucy9zdGF0cy9nbG9iYWwnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uU3RhdHMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgZ2xvYmFsIHJlY29tbWVuZGF0aW9uIHN0YXRzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0R2xvYmFsUmVjb21tZW5kYXRpb25TdGF0cygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogbW9ja1JlY29tbWVuZGF0aW9uU3RhdHMsXG4gICAgICAgIG1lc3NhZ2U6ICdHbG9iYWwgcmVjb21tZW5kYXRpb24gc3RhdGlzdGljcyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvblN0YXRzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBnbG9iYWwgc3RhdHMgcmVzcG9uc2Ugc3RydWN0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRHbG9iYWxSZWNvbW1lbmRhdGlvblN0YXRzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ3RvdGFsUmVjb21tZW5kYXRpb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd3ZWVrbHlUcmVuZHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ2NhdGVnb3J5UGVyZm9ybWFuY2UnKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmRhdGEudG90YWxSZWNvbW1lbmRhdGlvbnMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuZGF0YS5hdmVyYWdlQ29tcGF0aWJpbGl0eVNjb3JlKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VydmljZUVycm9yID0gbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgZ2xvYmFsIHJlY29tbWVuZGF0aW9uIHN0YXRzJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMubW9ja1JlamVjdGVkVmFsdWUoc2VydmljZUVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldEdsb2JhbFJlY29tbWVuZGF0aW9uU3RhdHMoKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coc2VydmljZUVycm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JvbGUtQmFzZWQgQWNjZXNzIENvbnRyb2wnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhbGwgYXV0aGVudGljYXRlZCB1c2VycyB0byBhY2Nlc3MgdXNlciBlbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyRW5kcG9pbnRzID0gW1xuICAgICAgICAnZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMnLFxuICAgICAgICAnZ2V0VXNlclJlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICdnZXRSZWNvbW1lbmRhdGlvbkRldGFpbHMnLFxuICAgICAgICAnaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbicsXG4gICAgICAgICdyZWZyZXNoUmVjb21tZW5kYXRpb25zJyxcbiAgICAgICAgJ2dldFVzZXJSZWNvbW1lbmRhdGlvblN0YXRzJyxcbiAgICAgIF07XG5cbiAgICAgIHVzZXJFbmRwb2ludHMuZm9yRWFjaChlbmRwb2ludCA9PiB7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgncm9sZXMnLCBjb250cm9sbGVyW2VuZHBvaW50IGFzIGtleW9mIENvbW11bml0eVJlY29tbWVuZGF0aW9uQ29udHJvbGxlcl0pO1xuICAgICAgICBleHBlY3QobWV0YWRhdGEpLnRvQ29udGFpbignY2xpZW50Jyk7XG4gICAgICAgIGV4cGVjdChtZXRhZGF0YSkudG9Db250YWluKCd0aGVyYXBpc3QnKTtcbiAgICAgICAgZXhwZWN0KG1ldGFkYXRhKS50b0NvbnRhaW4oJ21vZGVyYXRvcicpO1xuICAgICAgICBleHBlY3QobWV0YWRhdGEpLnRvQ29udGFpbignYWRtaW4nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXN0cmljdCBnbG9iYWwgc3RhdHMgdG8gYWRtaW4gYW5kIG1vZGVyYXRvciBvbmx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdyb2xlcycsIGNvbnRyb2xsZXIuZ2V0R2xvYmFsUmVjb21tZW5kYXRpb25TdGF0cyk7XG4gICAgICBleHBlY3QobWV0YWRhdGEpLnRvQ29udGFpbignYWRtaW4nKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YSkudG9Db250YWluKCdtb2RlcmF0b3InKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YSkubm90LnRvQ29udGFpbignY2xpZW50Jyk7XG4gICAgICBleHBlY3QobWV0YWRhdGEpLm5vdC50b0NvbnRhaW4oJ3RoZXJhcGlzdCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzcG9uc2UgRm9ybWF0IFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIGdlbmVyYXRlIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uc0ZvclVzZXIubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVjb21tZW5kYXRpb25zTGlzdCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHsgZm9yY2U6IGZhbHNlIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc3VjY2VzcycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2RhdGEnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQuZGF0YSkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5tZXNzYWdlKS50b0JlKCdzdHJpbmcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3Blcmx5IGZvcm1hdHRlZCByZWNvbW1lbmRhdGlvbnMgbGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVjb21tZW5kYXRpb25zTGlzdCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwge30pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICAgIHJlc3VsdC5kYXRhLmZvckVhY2goKHJlY29tbWVuZGF0aW9uOiBhbnkpID0+IHtcbiAgICAgICAgVGVzdEFzc2VydGlvbnMuZXhwZWN0VmFsaWRFbnRpdHkocmVjb21tZW5kYXRpb24sIFsnaWQnLCAndXNlcklkJywgJ2NvbW11bml0eUlkJywgJ3Njb3JlJ10pO1xuICAgICAgICBleHBlY3QocmVjb21tZW5kYXRpb24uc2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5zY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbCgxKTtcbiAgICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uLmNvbW11bml0eSkudG9IYXZlUHJvcGVydHkoJ2lkJyk7XG4gICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5jb21tdW5pdHkpLnRvSGF2ZVByb3BlcnR5KCduYW1lJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3Blcmx5IGZvcm1hdHRlZCByZWNvbW1lbmRhdGlvbiBkZXRhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRSZWNvbW1lbmRhdGlvbkRldGFpbHMobW9ja1VzZXIsICdyZWNvbW1lbmRhdGlvbl8xMjM0NTY3ODknKTtcblxuICAgICAgVGVzdEFzc2VydGlvbnMuZXhwZWN0VmFsaWRFbnRpdHkocmVzdWx0LmRhdGEsIFsnaWQnLCAndXNlcklkJywgJ2NvbW11bml0eUlkJywgJ3Njb3JlJywgJ3JlYXNvbmluZyddKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5jb21tdW5pdHkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEuYXNzZXNzbWVudFNjb3JlcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmRhdGEuc2NvcmUpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuZGF0YS5yZWFzb25pbmcpLnRvQmUoJ3N0cmluZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvcGVybHkgZm9ybWF0dGVkIHN0YXRzIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvblN0YXRzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZWNvbW1lbmRhdGlvblN0YXRzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25TdGF0cyhtb2NrVXNlcik7XG5cbiAgICAgIFRlc3RBc3NlcnRpb25zLmV4cGVjdFZhbGlkRW50aXR5KHJlc3VsdC5kYXRhLCBbXG4gICAgICAgICd0b3RhbFJlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICdhY2NlcHRlZFJlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICdyZWplY3RlZFJlY29tbWVuZGF0aW9ucycsXG4gICAgICAgICdwZW5kaW5nUmVjb21tZW5kYXRpb25zJyxcbiAgICAgICAgJ2F2ZXJhZ2VDb21wYXRpYmlsaXR5U2NvcmUnLFxuICAgICAgICAndG9wQ29tbXVuaXRpZXMnLFxuICAgICAgXSk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQuZGF0YS50b3BDb21tdW5pdGllcykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5kYXRhLnRvdGFsUmVjb21tZW5kYXRpb25zKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmRhdGEuYXZlcmFnZUNvbXBhdGliaWxpdHlTY29yZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIHVuYXZhaWxhYmxlIHNjZW5hcmlvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VFcnJvciA9IG5ldyBFcnJvcignUmVjb21tZW5kYXRpb24gc2VydmljZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZScpO1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRVc2VyUmVjb21tZW5kYXRpb25zLm1vY2tSZWplY3RlZFZhbHVlKHNlcnZpY2VFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCB7fSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KHNlcnZpY2VFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBjb25uZWN0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRiRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlci5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCB7IGZvcmNlOiBmYWxzZSB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coZGJFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2YWxpZGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBFcnJvcignSW52YWxpZCByZWNvbW1lbmRhdGlvbiBkYXRhJyk7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24ubW9ja1JlamVjdGVkVmFsdWUodmFsaWRhdGlvbkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmhhbmRsZVJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb24oXG4gICAgICAgICAgbW9ja1VzZXIsXG4gICAgICAgICAgJ3JlY29tbWVuZGF0aW9uXzEyMycsXG4gICAgICAgICAgeyBhY3Rpb246ICdhY2NlcHQnIH0sXG4gICAgICAgIClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KHZhbGlkYXRpb25FcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IGludGVyYWN0aW9uIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29uY3VycmVuY3lFcnJvciA9IG5ldyBFcnJvcignUmVjb21tZW5kYXRpb24gaW50ZXJhY3Rpb24gYWxyZWFkeSBpbiBwcm9ncmVzcycpO1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uLm1vY2tSZWplY3RlZFZhbHVlKGNvbmN1cnJlbmN5RXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbihcbiAgICAgICAgICBtb2NrVXNlcixcbiAgICAgICAgICAncmVjb21tZW5kYXRpb25fMTIzJyxcbiAgICAgICAgICB7IGFjdGlvbjogJ2FjY2VwdCcgfSxcbiAgICAgICAgKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coY29uY3VycmVuY3lFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSByZWNvbW1lbmRhdGlvbiB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdlbmVyYXRlIHJlY29tbWVuZGF0aW9uc1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uc0ZvclVzZXIubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVjb21tZW5kYXRpb25zTGlzdCk7XG4gICAgICBjb25zdCBnZW5lcmF0ZVJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHsgZm9yY2U6IGZhbHNlIH0pO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIEdldCB1c2VyIHJlY29tbWVuZGF0aW9uc1xuICAgICAgY29uc3QgdXNlclJlY29tbWVuZGF0aW9ucyA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwge30pO1xuICAgICAgZXhwZWN0KHVzZXJSZWNvbW1lbmRhdGlvbnMuZGF0YSkudG9IYXZlTGVuZ3RoKDMpO1xuXG4gICAgICAvLyBHZXQgcmVjb21tZW5kYXRpb24gZGV0YWlsc1xuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5nZXRSZWNvbW1lbmRhdGlvbkJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uKTtcbiAgICAgIGNvbnN0IGRldGFpbHMgPSBhd2FpdCBjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uRGV0YWlscyhtb2NrVXNlciwgbW9ja1JlY29tbWVuZGF0aW9uLmlkKTtcbiAgICAgIGV4cGVjdChkZXRhaWxzLmRhdGEuaWQpLnRvQmUobW9ja1JlY29tbWVuZGF0aW9uLmlkKTtcblxuICAgICAgLy8gSW50ZXJhY3Qgd2l0aCByZWNvbW1lbmRhdGlvblxuICAgICAgbW9ja0NvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICBjb25zdCBpbnRlcmFjdGlvbiA9IGF3YWl0IGNvbnRyb2xsZXIuaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbihcbiAgICAgICAgbW9ja1VzZXIsXG4gICAgICAgIG1vY2tSZWNvbW1lbmRhdGlvbi5pZCxcbiAgICAgICAgeyBhY3Rpb246ICdhY2NlcHQnIH0sXG4gICAgICApO1xuICAgICAgZXhwZWN0KGludGVyYWN0aW9uLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIEdldCB1cGRhdGVkIHN0YXRzXG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uU3RhdHMpO1xuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBjb250cm9sbGVyLmdldFVzZXJSZWNvbW1lbmRhdGlvblN0YXRzKG1vY2tVc2VyKTtcbiAgICAgIGV4cGVjdChzdGF0cy5kYXRhLnRvdGFsUmVjb21tZW5kYXRpb25zKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBmaWx0ZXJpbmcgYW5kIHNvcnRpbmcgd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlY29tbWVuZGF0aW9uc0xpc3QpO1xuXG4gICAgICAvLyBHZXQgcGVuZGluZyByZWNvbW1lbmRhdGlvbnNcbiAgICAgIGNvbnN0IHBlbmRpbmdSZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFVzZXJSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHsgc3RhdHVzOiAncGVuZGluZycgfSk7XG4gICAgICBleHBlY3QocGVuZGluZ1Jlc3VsdC5kYXRhLmV2ZXJ5KChyZWM6IGFueSkgPT4gcmVjLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gR2V0IHJlY29tbWVuZGF0aW9ucyBzb3J0ZWQgYnkgY29tcGF0aWJpbGl0eVxuICAgICAgY29uc3Qgc29ydGVkUmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRVc2VyUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCB7XG4gICAgICAgIHNvcnRCeTogJ2NvbXBhdGliaWxpdHknLFxuICAgICAgICBzb3J0T3JkZXI6ICdkZXNjJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHNvcnRlZFJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBHZXQgYWNjZXB0ZWQgcmVjb21tZW5kYXRpb25zXG4gICAgICBjb25zdCBhY2NlcHRlZFJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgeyBzdGF0dXM6ICdhY2NlcHRlZCcgfSk7XG4gICAgICBleHBlY3QoYWNjZXB0ZWRSZXN1bHQuZGF0YS5ldmVyeSgocmVjOiBhbnkpID0+IHJlYy5zdGF0dXMgPT09ICdqb2luZWQnKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGFkbWluIGFuYWx5dGljcyB3b3JrZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0UmVjb21tZW5kYXRpb25TdGF0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVjb21tZW5kYXRpb25TdGF0cyk7XG5cbiAgICAgIC8vIEdldCBnbG9iYWwgc3RhdHNcbiAgICAgIGNvbnN0IGdsb2JhbFN0YXRzID0gYXdhaXQgY29udHJvbGxlci5nZXRHbG9iYWxSZWNvbW1lbmRhdGlvblN0YXRzKCk7XG4gICAgICBleHBlY3QoZ2xvYmFsU3RhdHMuZGF0YS50b3RhbFJlY29tbWVuZGF0aW9ucykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KGdsb2JhbFN0YXRzLmRhdGEuY2F0ZWdvcnlQZXJmb3JtYW5jZSkudG9CZURlZmluZWQoKTtcblxuICAgICAgLy8gVmVyaWZ5IGRldGFpbGVkIG1ldHJpY3NcbiAgICAgIGV4cGVjdChnbG9iYWxTdGF0cy5kYXRhLndlZWtseVRyZW5kcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChnbG9iYWxTdGF0cy5kYXRhLnRvcENvbW11bml0aWVzKS50b0JlSW5zdGFuY2VPZihBcnJheSk7XG4gICAgICBleHBlY3QoZ2xvYmFsU3RhdHMuZGF0YS5hdmVyYWdlQ29tcGF0aWJpbGl0eVNjb3JlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9