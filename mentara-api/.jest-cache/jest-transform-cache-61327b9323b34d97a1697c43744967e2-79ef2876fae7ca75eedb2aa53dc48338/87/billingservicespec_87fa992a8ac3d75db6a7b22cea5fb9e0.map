{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { NotFoundException, BadRequestException } from '@nestjs/common';\nimport { BillingService } from './billing.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport {\n  SubscriptionStatus,\n  SubscriptionTier,\n  BillingCycle,\n  PaymentStatus,\n  PaymentMethodType,\n  InvoiceStatus,\n  DiscountType,\n} from '@prisma/client';\nimport { createMockPrismaService, TEST_USER_IDS } from '../test-utils';\n\ndescribe('BillingService', () => {\n  let service: BillingService;\n  let prismaService: jest.Mocked<PrismaService>;\n\n  beforeEach(async () => {\n    const mockPrisma = createMockPrismaService();\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        BillingService,\n        {\n          provide: PrismaService,\n          useValue: mockPrisma,\n        },\n      ],\n    }).compile();\n\n    service = module.get<BillingService>(BillingService);\n    prismaService = module.get(PrismaService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Subscription Management', () => {\n    describe('createSubscription', () => {\n      const mockPlan = {\n        id: 'plan-id',\n        name: 'Premium Plan',\n        tier: SubscriptionTier.PREMIUM,\n        monthlyPrice: 29.99,\n        yearlyPrice: 299.99,\n      };\n\n      const mockSubscriptionData = {\n        userId: TEST_USER_IDS.CLIENT,\n        planId: 'plan-id',\n        billingCycle: BillingCycle.MONTHLY,\n      };\n\n      it('should successfully create a monthly subscription', async () => {\n        const expectedSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          planId: 'plan-id',\n          tier: SubscriptionTier.PREMIUM,\n          billingCycle: BillingCycle.MONTHLY,\n          amount: 29.99,\n          status: SubscriptionStatus.ACTIVE,\n          plan: mockPlan,\n          defaultPaymentMethod: null,\n        };\n\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue(\n          expectedSubscription,\n        );\n\n        const result = await service.createSubscription(mockSubscriptionData);\n\n        expect(result).toEqual(expectedSubscription);\n        expect(prismaService.subscription.create).toHaveBeenCalledWith({\n          data: expect.objectContaining({\n            userId: TEST_USER_IDS.CLIENT,\n            planId: 'plan-id',\n            tier: SubscriptionTier.PREMIUM,\n            billingCycle: BillingCycle.MONTHLY,\n            amount: 29.99,\n            status: SubscriptionStatus.ACTIVE,\n          }),\n          include: {\n            plan: true,\n            defaultPaymentMethod: true,\n          },\n        });\n      });\n\n      it('should successfully create a yearly subscription', async () => {\n        const yearlyData = {\n          ...mockSubscriptionData,\n          billingCycle: BillingCycle.YEARLY,\n        };\n\n        const expectedSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          amount: 299.99,\n          billingCycle: BillingCycle.YEARLY,\n        };\n\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue(\n          expectedSubscription,\n        );\n\n        const result = await service.createSubscription(yearlyData);\n\n        expect(result.amount).toBe(299.99);\n        expect(result.billingCycle).toBe(BillingCycle.YEARLY);\n      });\n\n      it('should create subscription with trial period', async () => {\n        const trialStart = new Date();\n        const trialEnd = new Date();\n        trialEnd.setDate(trialEnd.getDate() + 14);\n\n        const trialData = {\n          ...mockSubscriptionData,\n          trialStart,\n          trialEnd,\n        };\n\n        const expectedSubscription = {\n          id: 'subscription-id',\n          status: SubscriptionStatus.TRIALING,\n          trialStart,\n          trialEnd,\n        };\n\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue(\n          expectedSubscription,\n        );\n\n        const result = await service.createSubscription(trialData);\n\n        expect(result.status).toBe(SubscriptionStatus.TRIALING);\n        expect(prismaService.subscription.create).toHaveBeenCalledWith({\n          data: expect.objectContaining({\n            status: SubscriptionStatus.TRIALING,\n            trialStart,\n            trialEnd,\n          }),\n          include: expect.any(Object),\n        });\n      });\n\n      it('should throw NotFoundException when plan does not exist', async () => {\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(null);\n\n        await expect(\n          service.createSubscription(mockSubscriptionData),\n        ).rejects.toThrow(NotFoundException);\n\n        expect(prismaService.subscription.create).not.toHaveBeenCalled();\n      });\n    });\n\n    describe('findUserSubscription', () => {\n      it('should return user subscription with included data', async () => {\n        const mockSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          plan: { name: 'Premium Plan' },\n          defaultPaymentMethod: { cardLast4: '4242' },\n          invoices: [{ id: 'invoice-1' }],\n        };\n\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(\n          mockSubscription,\n        );\n\n        const result = await service.findUserSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result).toEqual(mockSubscription);\n        expect(prismaService.subscription.findUnique).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT },\n          include: {\n            plan: true,\n            defaultPaymentMethod: true,\n            invoices: {\n              orderBy: { createdAt: 'desc' },\n              take: 5,\n            },\n          },\n        });\n      });\n\n      it('should return null when subscription does not exist', async () => {\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(\n          null,\n        );\n\n        const result = await service.findUserSubscription('non-existent-user');\n\n        expect(result).toBeNull();\n      });\n    });\n\n    describe('updateSubscription', () => {\n      const mockSubscription = {\n        id: 'subscription-id',\n        userId: TEST_USER_IDS.CLIENT,\n        planId: 'old-plan-id',\n      };\n\n      const mockNewPlan = {\n        id: 'new-plan-id',\n        tier: SubscriptionTier.ENTERPRISE,\n        monthlyPrice: 99.99,\n        yearlyPrice: 999.99,\n      };\n\n      it('should successfully update subscription plan', async () => {\n        const updateData = {\n          planId: 'new-plan-id',\n          billingCycle: BillingCycle.MONTHLY,\n        };\n\n        const updatedSubscription = {\n          ...mockSubscription,\n          planId: 'new-plan-id',\n          tier: SubscriptionTier.ENTERPRISE,\n          amount: 99.99,\n        };\n\n        jest\n          .spyOn(service, 'findUserSubscription')\n          .mockResolvedValue(mockSubscription as any);\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockNewPlan);\n        (prismaService.subscription.update as jest.Mock).mockResolvedValue(\n          updatedSubscription,\n        );\n\n        const result = await service.updateSubscription(\n          TEST_USER_IDS.CLIENT,\n          updateData,\n        );\n\n        expect(result).toEqual(updatedSubscription);\n        expect(prismaService.subscription.update).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT },\n          data: expect.objectContaining({\n            planId: 'new-plan-id',\n            tier: SubscriptionTier.ENTERPRISE,\n            amount: 99.99,\n            billingCycle: BillingCycle.MONTHLY,\n          }),\n          include: expect.any(Object),\n        });\n      });\n\n      it('should throw NotFoundException when subscription does not exist', async () => {\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(null);\n\n        await expect(\n          service.updateSubscription('non-existent-user', {\n            planId: 'new-plan',\n          }),\n        ).rejects.toThrow(NotFoundException);\n      });\n\n      it('should throw NotFoundException when new plan does not exist', async () => {\n        jest\n          .spyOn(service, 'findUserSubscription')\n          .mockResolvedValue(mockSubscription as any);\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(null);\n\n        await expect(\n          service.updateSubscription(TEST_USER_IDS.CLIENT, {\n            planId: 'non-existent-plan',\n          }),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n\n    describe('cancelSubscription', () => {\n      it('should cancel subscription by updating status', async () => {\n        const canceledSubscription = {\n          id: 'subscription-id',\n          status: SubscriptionStatus.CANCELED,\n        };\n\n        jest\n          .spyOn(service, 'updateSubscription')\n          .mockResolvedValue(canceledSubscription as any);\n\n        const result = await service.cancelSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result.status).toBe(SubscriptionStatus.CANCELED);\n        expect(service.updateSubscription).toHaveBeenCalledWith(\n          TEST_USER_IDS.CLIENT,\n          {\n            status: SubscriptionStatus.CANCELED,\n          },\n        );\n      });\n    });\n  });\n\n  describe('Subscription Plans', () => {\n    describe('createSubscriptionPlan', () => {\n      it('should successfully create a subscription plan', async () => {\n        const planData = {\n          name: 'Premium Plan',\n          description: 'Full access plan',\n          tier: SubscriptionTier.PREMIUM,\n          monthlyPrice: 29.99,\n          yearlyPrice: 299.99,\n          features: { sessions: 'unlimited', storage: '100GB' },\n          limits: { clients: 50 },\n          trialDays: 14,\n        };\n\n        const expectedPlan = {\n          id: 'plan-id',\n          ...planData,\n        };\n\n        (prismaService.subscriptionPlan.create as jest.Mock).mockResolvedValue(\n          expectedPlan,\n        );\n\n        const result = await service.createSubscriptionPlan(planData);\n\n        expect(result).toEqual(expectedPlan);\n        expect(prismaService.subscriptionPlan.create).toHaveBeenCalledWith({\n          data: planData,\n        });\n      });\n    });\n\n    describe('findAllPlans', () => {\n      it('should return active plans by default', async () => {\n        const mockPlans = [\n          { id: 'plan-1', name: 'Basic', monthlyPrice: 9.99 },\n          { id: 'plan-2', name: 'Premium', monthlyPrice: 29.99 },\n        ];\n\n        (\n          prismaService.subscriptionPlan.findMany as jest.Mock\n        ).mockResolvedValue(mockPlans);\n\n        const result = await service.findAllPlans();\n\n        expect(result).toEqual(mockPlans);\n        expect(prismaService.subscriptionPlan.findMany).toHaveBeenCalledWith({\n          where: { isActive: true },\n          orderBy: { monthlyPrice: 'asc' },\n        });\n      });\n\n      it('should return inactive plans when specified', async () => {\n        await service.findAllPlans(false);\n\n        expect(prismaService.subscriptionPlan.findMany).toHaveBeenCalledWith({\n          where: { isActive: false },\n          orderBy: { monthlyPrice: 'asc' },\n        });\n      });\n    });\n\n    describe('updatePlan', () => {\n      it('should successfully update plan', async () => {\n        const updateData = {\n          name: 'Updated Plan',\n          monthlyPrice: 39.99,\n          features: { newFeature: true },\n        };\n\n        const updatedPlan = {\n          id: 'plan-id',\n          ...updateData,\n        };\n\n        (prismaService.subscriptionPlan.update as jest.Mock).mockResolvedValue(\n          updatedPlan,\n        );\n\n        const result = await service.updatePlan('plan-id', updateData);\n\n        expect(result).toEqual(updatedPlan);\n        expect(prismaService.subscriptionPlan.update).toHaveBeenCalledWith({\n          where: { id: 'plan-id' },\n          data: updateData,\n        });\n      });\n    });\n  });\n\n  describe('Payment Methods', () => {\n    describe('createPaymentMethod', () => {\n      it('should create payment method and set as default', async () => {\n        const paymentMethodData = {\n          userId: TEST_USER_IDS.CLIENT,\n          type: PaymentMethodType.CARD,\n          cardLast4: '4242',\n          cardBrand: 'visa',\n          cardExpMonth: 12,\n          cardExpYear: 2025,\n          isDefault: true,\n        };\n\n        const expectedPaymentMethod = {\n          id: 'payment-method-id',\n          ...paymentMethodData,\n        };\n\n        (prismaService.paymentMethod.updateMany as jest.Mock).mockResolvedValue(\n          { count: 1 },\n        );\n        (prismaService.paymentMethod.create as jest.Mock).mockResolvedValue(\n          expectedPaymentMethod,\n        );\n\n        const result = await service.createPaymentMethod(paymentMethodData);\n\n        expect(result).toEqual(expectedPaymentMethod);\n        expect(prismaService.paymentMethod.updateMany).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT, isDefault: true },\n          data: { isDefault: false },\n        });\n        expect(prismaService.paymentMethod.create).toHaveBeenCalledWith({\n          data: paymentMethodData,\n        });\n      });\n\n      it('should create payment method without setting as default', async () => {\n        const paymentMethodData = {\n          userId: TEST_USER_IDS.CLIENT,\n          type: PaymentMethodType.CARD,\n          cardLast4: '4242',\n        };\n\n        (prismaService.paymentMethod.create as jest.Mock).mockResolvedValue(\n          paymentMethodData,\n        );\n\n        await service.createPaymentMethod(paymentMethodData);\n\n        expect(prismaService.paymentMethod.updateMany).not.toHaveBeenCalled();\n      });\n    });\n\n    describe('findUserPaymentMethods', () => {\n      it('should return user payment methods ordered by default and creation date', async () => {\n        const mockPaymentMethods = [\n          { id: 'pm-1', isDefault: true, cardLast4: '4242' },\n          { id: 'pm-2', isDefault: false, cardLast4: '1234' },\n        ];\n\n        (prismaService.paymentMethod.findMany as jest.Mock).mockResolvedValue(\n          mockPaymentMethods,\n        );\n\n        const result = await service.findUserPaymentMethods(\n          TEST_USER_IDS.CLIENT,\n        );\n\n        expect(result).toEqual(mockPaymentMethods);\n        expect(prismaService.paymentMethod.findMany).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT, isActive: true },\n          orderBy: [{ isDefault: 'desc' }, { createdAt: 'desc' }],\n        });\n      });\n    });\n\n    describe('updatePaymentMethod', () => {\n      const mockPaymentMethod = {\n        id: 'payment-method-id',\n        userId: TEST_USER_IDS.CLIENT,\n      };\n\n      it('should successfully update payment method', async () => {\n        const updateData = { isDefault: true };\n        const updatedPaymentMethod = { ...mockPaymentMethod, ...updateData };\n\n        (prismaService.paymentMethod.findUnique as jest.Mock).mockResolvedValue(\n          mockPaymentMethod,\n        );\n        (prismaService.paymentMethod.updateMany as jest.Mock).mockResolvedValue(\n          { count: 1 },\n        );\n        (prismaService.paymentMethod.update as jest.Mock).mockResolvedValue(\n          updatedPaymentMethod,\n        );\n\n        const result = await service.updatePaymentMethod(\n          'payment-method-id',\n          updateData,\n        );\n\n        expect(result).toEqual(updatedPaymentMethod);\n        expect(prismaService.paymentMethod.updateMany).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT, isDefault: true },\n          data: { isDefault: false },\n        });\n      });\n\n      it('should throw NotFoundException when payment method does not exist', async () => {\n        (prismaService.paymentMethod.findUnique as jest.Mock).mockResolvedValue(\n          null,\n        );\n\n        await expect(\n          service.updatePaymentMethod('non-existent-id', { isDefault: true }),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n\n    describe('deletePaymentMethod', () => {\n      it('should soft delete payment method by setting isActive to false', async () => {\n        const deactivatedPaymentMethod = {\n          id: 'payment-method-id',\n          isActive: false,\n        };\n\n        (prismaService.paymentMethod.update as jest.Mock).mockResolvedValue(\n          deactivatedPaymentMethod,\n        );\n\n        const result = await service.deletePaymentMethod('payment-method-id');\n\n        expect(result).toEqual(deactivatedPaymentMethod);\n        expect(prismaService.paymentMethod.update).toHaveBeenCalledWith({\n          where: { id: 'payment-method-id' },\n          data: { isActive: false },\n        });\n      });\n    });\n  });\n\n  describe('Payments', () => {\n    describe('createPayment', () => {\n      it('should create payment with default values', async () => {\n        const paymentData = {\n          amount: 29.99,\n          paymentMethodId: 'payment-method-id',\n          subscriptionId: 'subscription-id',\n          description: 'Monthly subscription',\n        };\n\n        const expectedPayment = {\n          id: 'payment-id',\n          ...paymentData,\n          status: PaymentStatus.PENDING,\n          currency: 'USD',\n          paymentMethod: { cardLast4: '4242' },\n          subscription: { tier: SubscriptionTier.PREMIUM },\n          invoice: null,\n        };\n\n        (prismaService.payment.create as jest.Mock).mockResolvedValue(\n          expectedPayment,\n        );\n\n        const result = await service.createPayment(paymentData);\n\n        expect(result).toEqual(expectedPayment);\n        expect(prismaService.payment.create).toHaveBeenCalledWith({\n          data: {\n            ...paymentData,\n            status: PaymentStatus.PENDING,\n            currency: 'USD',\n          },\n          include: {\n            paymentMethod: true,\n            subscription: true,\n            invoice: true,\n          },\n        });\n      });\n\n      it('should create payment with custom currency', async () => {\n        const paymentData = {\n          amount: 25.99,\n          currency: 'EUR',\n        };\n\n        (prismaService.payment.create as jest.Mock).mockResolvedValue({\n          id: 'payment-id',\n          currency: 'EUR',\n        });\n\n        await service.createPayment(paymentData);\n\n        expect(prismaService.payment.create).toHaveBeenCalledWith({\n          data: expect.objectContaining({\n            currency: 'EUR',\n          }),\n          include: expect.any(Object),\n        });\n      });\n    });\n\n    describe('updatePaymentStatus', () => {\n      it('should update payment status to succeeded', async () => {\n        const updatedPayment = {\n          id: 'payment-id',\n          status: PaymentStatus.SUCCEEDED,\n          processedAt: expect.any(Date),\n        };\n\n        (prismaService.payment.update as jest.Mock).mockResolvedValue(\n          updatedPayment,\n        );\n\n        const result = await service.updatePaymentStatus(\n          'payment-id',\n          PaymentStatus.SUCCEEDED,\n        );\n\n        expect(result).toEqual(updatedPayment);\n        expect(prismaService.payment.update).toHaveBeenCalledWith({\n          where: { id: 'payment-id' },\n          data: {\n            status: PaymentStatus.SUCCEEDED,\n            processedAt: expect.any(Date),\n          },\n        });\n      });\n\n      it('should update payment status to failed with metadata', async () => {\n        const metadata = {\n          failureCode: 'card_declined',\n          failureMessage: 'Your card was declined.',\n        };\n\n        const updatedPayment = {\n          id: 'payment-id',\n          status: PaymentStatus.FAILED,\n          failedAt: expect.any(Date),\n          failureCode: 'card_declined',\n          failureMessage: 'Your card was declined.',\n        };\n\n        (prismaService.payment.update as jest.Mock).mockResolvedValue(\n          updatedPayment,\n        );\n\n        const result = await service.updatePaymentStatus(\n          'payment-id',\n          PaymentStatus.FAILED,\n          metadata,\n        );\n\n        expect(result).toEqual(updatedPayment);\n        expect(prismaService.payment.update).toHaveBeenCalledWith({\n          where: { id: 'payment-id' },\n          data: {\n            status: PaymentStatus.FAILED,\n            failedAt: expect.any(Date),\n            failureCode: 'card_declined',\n            failureMessage: 'Your card was declined.',\n          },\n        });\n      });\n    });\n\n    describe('findPayments', () => {\n      it('should return payments with filters', async () => {\n        const mockPayments = [\n          { id: 'payment-1', status: PaymentStatus.SUCCEEDED },\n          { id: 'payment-2', status: PaymentStatus.SUCCEEDED },\n        ];\n\n        const startDate = new Date('2024-01-01');\n        const endDate = new Date('2024-01-31');\n\n        (prismaService.payment.findMany as jest.Mock).mockResolvedValue(\n          mockPayments,\n        );\n\n        const result = await service.findPayments(\n          'subscription-id',\n          PaymentStatus.SUCCEEDED,\n          startDate,\n          endDate,\n        );\n\n        expect(result).toEqual(mockPayments);\n        expect(prismaService.payment.findMany).toHaveBeenCalledWith({\n          where: {\n            subscriptionId: 'subscription-id',\n            status: PaymentStatus.SUCCEEDED,\n            createdAt: {\n              gte: startDate,\n              lte: endDate,\n            },\n          },\n          include: {\n            paymentMethod: true,\n            subscription: true,\n            invoice: true,\n          },\n          orderBy: { createdAt: 'desc' },\n        });\n      });\n    });\n  });\n\n  describe('Invoices', () => {\n    describe('createInvoice', () => {\n      it('should create invoice with calculated total', async () => {\n        const invoiceData = {\n          subscriptionId: 'subscription-id',\n          subtotal: 100,\n          taxAmount: 10,\n          discountAmount: 5,\n          dueDate: new Date('2024-02-01'),\n        };\n\n        const expectedInvoice = {\n          id: 'invoice-id',\n          ...invoiceData,\n          number: 'INV-2024-000001',\n          total: 105, // 100 + 10 - 5\n          amountDue: 105,\n          status: InvoiceStatus.OPEN,\n        };\n\n        // Mock generateInvoiceNumber\n        jest\n          .spyOn(service as any, 'generateInvoiceNumber')\n          .mockResolvedValue('INV-2024-000001');\n        (prismaService.invoice.create as jest.Mock).mockResolvedValue(\n          expectedInvoice,\n        );\n\n        const result = await service.createInvoice(invoiceData);\n\n        expect(result).toEqual(expectedInvoice);\n        expect(prismaService.invoice.create).toHaveBeenCalledWith({\n          data: {\n            ...invoiceData,\n            number: 'INV-2024-000001',\n            total: 105,\n            amountDue: 105,\n            status: InvoiceStatus.OPEN,\n          },\n          include: {\n            subscription: true,\n            lineItems: true,\n          },\n        });\n      });\n    });\n\n    describe('findInvoices', () => {\n      it('should return invoices with filters', async () => {\n        const mockInvoices = [\n          { id: 'invoice-1', status: InvoiceStatus.OPEN },\n          { id: 'invoice-2', status: InvoiceStatus.PAID },\n        ];\n\n        (prismaService.invoice.findMany as jest.Mock).mockResolvedValue(\n          mockInvoices,\n        );\n\n        const result = await service.findInvoices(\n          'subscription-id',\n          InvoiceStatus.OPEN,\n        );\n\n        expect(result).toEqual(mockInvoices);\n        expect(prismaService.invoice.findMany).toHaveBeenCalledWith({\n          where: {\n            subscriptionId: 'subscription-id',\n            status: InvoiceStatus.OPEN,\n          },\n          include: {\n            subscription: {\n              include: { user: true },\n            },\n            lineItems: true,\n            payments: true,\n          },\n          orderBy: { createdAt: 'desc' },\n        });\n      });\n    });\n\n    describe('markInvoiceAsPaid', () => {\n      it('should mark invoice as paid when fully paid', async () => {\n        const mockInvoice = {\n          id: 'invoice-id',\n          total: 100,\n          payments: [\n            { amount: 60, status: PaymentStatus.SUCCEEDED },\n            { amount: 40, status: PaymentStatus.SUCCEEDED },\n          ],\n        };\n\n        const updatedInvoice = {\n          ...mockInvoice,\n          status: InvoiceStatus.PAID,\n          amountPaid: 100,\n          paidAt: expect.any(Date),\n        };\n\n        (prismaService.invoice.findUnique as jest.Mock).mockResolvedValue(\n          mockInvoice,\n        );\n        (prismaService.invoice.update as jest.Mock).mockResolvedValue(\n          updatedInvoice,\n        );\n\n        const result = await service.markInvoiceAsPaid('invoice-id');\n\n        expect(result).toEqual(updatedInvoice);\n        expect(prismaService.invoice.update).toHaveBeenCalledWith({\n          where: { id: 'invoice-id' },\n          data: {\n            status: InvoiceStatus.PAID,\n            amountPaid: 100,\n            paidAt: expect.any(Date),\n          },\n        });\n      });\n\n      it('should keep invoice open when partially paid', async () => {\n        const mockInvoice = {\n          id: 'invoice-id',\n          total: 100,\n          payments: [\n            { amount: 30, status: PaymentStatus.SUCCEEDED },\n            { amount: 20, status: PaymentStatus.FAILED },\n          ],\n        };\n\n        (prismaService.invoice.findUnique as jest.Mock).mockResolvedValue(\n          mockInvoice,\n        );\n        (prismaService.invoice.update as jest.Mock).mockResolvedValue({\n          ...mockInvoice,\n          status: InvoiceStatus.OPEN,\n          amountPaid: 30,\n        });\n\n        const result = await service.markInvoiceAsPaid('invoice-id');\n\n        expect(result.status).toBe(InvoiceStatus.OPEN);\n        expect(result.amountPaid).toBe(30);\n      });\n\n      it('should throw NotFoundException when invoice does not exist', async () => {\n        (prismaService.invoice.findUnique as jest.Mock).mockResolvedValue(null);\n\n        await expect(\n          service.markInvoiceAsPaid('non-existent-id'),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n  });\n\n  describe('Discounts', () => {\n    describe('createDiscount', () => {\n      it('should create discount with default valid from date', async () => {\n        const discountData = {\n          code: 'SAVE20',\n          name: '20% Off',\n          type: DiscountType.PERCENTAGE,\n          percentOff: 20,\n        };\n\n        const expectedDiscount = {\n          id: 'discount-id',\n          ...discountData,\n          validFrom: expect.any(Date),\n        };\n\n        (prismaService.discount.create as jest.Mock).mockResolvedValue(\n          expectedDiscount,\n        );\n\n        const result = await service.createDiscount(discountData);\n\n        expect(result).toEqual(expectedDiscount);\n        expect(prismaService.discount.create).toHaveBeenCalledWith({\n          data: {\n            ...discountData,\n            validFrom: expect.any(Date),\n          },\n        });\n      });\n    });\n\n    describe('validateDiscount', () => {\n      const mockDiscount = {\n        id: 'discount-id',\n        code: 'SAVE20',\n        isActive: true,\n        validUntil: new Date('2024-12-31'),\n        maxUses: 100,\n        currentUses: 50,\n        maxUsesPerUser: 1,\n        minAmount: 50,\n        redemptions: [],\n      };\n\n      it('should return valid discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue(\n          mockDiscount,\n        );\n\n        const result = await service.validateDiscount(\n          'SAVE20',\n          TEST_USER_IDS.CLIENT,\n          100,\n        );\n\n        expect(result).toEqual(mockDiscount);\n      });\n\n      it('should throw BadRequestException for invalid discount code', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue(\n          null,\n        );\n\n        await expect(\n          service.validateDiscount('INVALID', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException for inactive discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          isActive: false,\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException for expired discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          validUntil: new Date('2020-01-01'), // Expired\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException when max uses reached', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          maxUses: 50,\n          currentUses: 50, // Reached limit\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException when user has already used discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          redemptions: [{ userId: TEST_USER_IDS.CLIENT }], // User already used\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException when amount is below minimum', async () => {\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 25), // Below min of 50\n        ).rejects.toThrow(BadRequestException);\n      });\n    });\n\n    describe('redeemDiscount', () => {\n      it('should redeem discount in transaction', async () => {\n        const mockTransaction = {\n          ...createMockPrismaService(),\n          discountRedemption: {\n            create: jest.fn(),\n          },\n          discount: {\n            update: jest.fn(),\n          },\n        };\n\n        (prismaService.$transaction as jest.Mock).mockImplementation(\n          async (callback) => {\n            return callback(mockTransaction);\n          },\n        );\n\n        await service.redeemDiscount('discount-id', TEST_USER_IDS.CLIENT, 20);\n\n        expect(mockTransaction.discountRedemption.create).toHaveBeenCalledWith({\n          data: {\n            discountId: 'discount-id',\n            userId: TEST_USER_IDS.CLIENT,\n            amountSaved: 20,\n          },\n        });\n\n        expect(mockTransaction.discount.update).toHaveBeenCalledWith({\n          where: { id: 'discount-id' },\n          data: {\n            currentUses: { increment: 1 },\n          },\n        });\n      });\n    });\n  });\n\n  describe('Usage Records', () => {\n    describe('recordUsage', () => {\n      it('should create usage record with default date', async () => {\n        const usageData = {\n          subscriptionId: 'subscription-id',\n          feature: 'api_calls',\n          quantity: 100,\n          unit: 'requests',\n          metadata: { endpoint: '/api/users' },\n        };\n\n        const expectedUsage = {\n          id: 'usage-id',\n          ...usageData,\n          usageDate: expect.any(Date),\n        };\n\n        (prismaService.usageRecord.create as jest.Mock).mockResolvedValue(\n          expectedUsage,\n        );\n\n        const result = await service.recordUsage(usageData);\n\n        expect(result).toEqual(expectedUsage);\n        expect(prismaService.usageRecord.create).toHaveBeenCalledWith({\n          data: {\n            ...usageData,\n            usageDate: expect.any(Date),\n          },\n        });\n      });\n    });\n\n    describe('getUsageRecords', () => {\n      it('should return usage records with filters', async () => {\n        const mockUsageRecords = [\n          { id: 'usage-1', feature: 'api_calls', quantity: 100 },\n          { id: 'usage-2', feature: 'api_calls', quantity: 50 },\n        ];\n\n        const startDate = new Date('2024-01-01');\n        const endDate = new Date('2024-01-31');\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(\n          mockUsageRecords,\n        );\n\n        const result = await service.getUsageRecords(\n          'subscription-id',\n          'api_calls',\n          startDate,\n          endDate,\n        );\n\n        expect(result).toEqual(mockUsageRecords);\n        expect(prismaService.usageRecord.findMany).toHaveBeenCalledWith({\n          where: {\n            subscriptionId: 'subscription-id',\n            feature: 'api_calls',\n            usageDate: {\n              gte: startDate,\n              lte: endDate,\n            },\n          },\n          orderBy: { usageDate: 'desc' },\n        });\n      });\n    });\n  });\n\n  describe('Helper Methods', () => {\n    describe('generateInvoiceNumber', () => {\n      it('should generate first invoice number for year', async () => {\n        (prismaService.invoice.findFirst as jest.Mock).mockResolvedValue(null);\n\n        const result = await (service as any).generateInvoiceNumber();\n\n        const currentYear = new Date().getFullYear();\n        expect(result).toBe(`INV-${currentYear}-000001`);\n      });\n\n      it('should increment from last invoice number', async () => {\n        const currentYear = new Date().getFullYear();\n        const lastInvoice = {\n          number: `INV-${currentYear}-000005`,\n        };\n\n        (prismaService.invoice.findFirst as jest.Mock).mockResolvedValue(\n          lastInvoice,\n        );\n\n        const result = await (service as any).generateInvoiceNumber();\n\n        expect(result).toBe(`INV-${currentYear}-000006`);\n      });\n\n      it('should handle invalid invoice number format', async () => {\n        const lastInvoice = {\n          number: 'INVALID-FORMAT',\n        };\n\n        (prismaService.invoice.findFirst as jest.Mock).mockResolvedValue(\n          lastInvoice,\n        );\n\n        const result = await (service as any).generateInvoiceNumber();\n\n        const currentYear = new Date().getFullYear();\n        expect(result).toBe(`INV-${currentYear}-000001`);\n      });\n    });\n\n    describe('getBillingStatistics', () => {\n      it('should return billing statistics', async () => {\n        const mockStats = {\n          totalRevenue: { _sum: { amount: 10000 } },\n          activeSubscriptions: 25,\n          trialSubscriptions: 5,\n          canceledSubscriptions: 10,\n          subscriptionsByTier: [\n            { tier: SubscriptionTier.BASIC, _count: { tier: 10 } },\n            { tier: SubscriptionTier.PREMIUM, _count: { tier: 15 } },\n          ],\n        };\n\n        (prismaService.payment.aggregate as jest.Mock).mockResolvedValue(\n          mockStats.totalRevenue,\n        );\n        (prismaService.subscription.count as jest.Mock)\n          .mockResolvedValueOnce(mockStats.activeSubscriptions)\n          .mockResolvedValueOnce(mockStats.trialSubscriptions)\n          .mockResolvedValueOnce(mockStats.canceledSubscriptions);\n        (prismaService.subscription.groupBy as jest.Mock).mockResolvedValue(\n          mockStats.subscriptionsByTier,\n        );\n\n        const result = await service.getBillingStatistics();\n\n        expect(result).toEqual({\n          totalRevenue: 10000,\n          activeSubscriptions: 25,\n          trialSubscriptions: 5,\n          canceledSubscriptions: 10,\n          subscriptionsByTier: mockStats.subscriptionsByTier,\n        });\n      });\n\n      it('should handle null revenue sum', async () => {\n        (prismaService.payment.aggregate as jest.Mock).mockResolvedValue({\n          _sum: { amount: null },\n        });\n        (prismaService.subscription.count as jest.Mock).mockResolvedValue(0);\n        (prismaService.subscription.groupBy as jest.Mock).mockResolvedValue([]);\n\n        const result = await service.getBillingStatistics();\n\n        expect(result.totalRevenue).toBe(0);\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle database errors in createSubscription', async () => {\n      (\n        prismaService.subscriptionPlan.findUnique as jest.Mock\n      ).mockResolvedValue({\n        id: 'plan-id',\n        monthlyPrice: 29.99,\n      });\n      (prismaService.subscription.create as jest.Mock).mockRejectedValue(\n        new Error('Database error'),\n      );\n\n      await expect(\n        service.createSubscription({\n          userId: TEST_USER_IDS.CLIENT,\n          planId: 'plan-id',\n        }),\n      ).rejects.toThrow('Database error');\n    });\n\n    it('should handle database errors in payment operations', async () => {\n      (prismaService.payment.create as jest.Mock).mockRejectedValue(\n        new Error('Payment creation failed'),\n      );\n\n      await expect(\n        service.createPayment({\n          amount: 29.99,\n        }),\n      ).rejects.toThrow('Payment creation failed');\n    });\n\n    it('should handle transaction errors in discount redemption', async () => {\n      prismaService.$transaction.mockRejectedValue(\n        new Error('Transaction failed'),\n      );\n\n      await expect(\n        service.redeemDiscount('discount-id', TEST_USER_IDS.CLIENT, 20),\n      ).rejects.toThrow('Transaction failed');\n    });\n  });\n});\n"],"version":3}