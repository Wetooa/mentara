3ac5964a94009fa9d318804472677a0f
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CommunityRecommendationController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const jwt_auth_guard_1 = require("../../auth/guards/jwt-auth.guard");
const role_based_access_guard_1 = require("../../auth/guards/role-based-access.guard");
const roles_decorator_1 = require("../../auth/decorators/roles.decorator");
const get_user_decorator_1 = require("../../decorators/get-user.decorator");
const community_recommendation_service_1 = require("../services/community-recommendation.service");
const validate_body_decorator_1 = require("../../common/decorators/validate-body.decorator");
const mentara_commons_1 = require("mentara-commons");
let CommunityRecommendationController = class CommunityRecommendationController {
    communityRecommendationService;
    constructor(communityRecommendationService) {
        this.communityRecommendationService = communityRecommendationService;
    }
    async generateRecommendations(user, dto) {
        try {
            await this.communityRecommendationService.generateRecommendationsForUser(user.id, dto.force);
            const recommendations = await this.communityRecommendationService.getUserRecommendations(user.id);
            return {
                success: true,
                data: recommendations,
                message: `Generated ${recommendations.length} recommendations`,
            };
        }
        catch (error) {
            throw error;
        }
    }
    async getUserRecommendations(user, query) {
        try {
            let recommendations = await this.communityRecommendationService.getUserRecommendations(user.id);
            // Apply status filter if provided
            if (query.status) {
                recommendations = recommendations.filter((rec) => {
                    if (query.status === 'pending')
                        return rec.status === 'pending';
                    if (query.status === 'accepted')
                        return rec.status === 'joined';
                    if (query.status === 'rejected')
                        return rec.status === 'dismissed';
                    return true;
                });
            }
            // Apply sorting if provided
            if (query.sortBy) {
                recommendations.sort((a, b) => {
                    let aValue, bValue;
                    switch (query.sortBy) {
                        case 'compatibility':
                            aValue = a.score;
                            bValue = b.score;
                            break;
                        case 'created':
                            aValue = new Date(a.createdAt || 0);
                            bValue = new Date(b.createdAt || 0);
                            break;
                        case 'updated':
                            aValue = new Date(a.updatedAt || 0);
                            bValue = new Date(b.updatedAt || 0);
                            break;
                        default:
                            aValue = a.score;
                            bValue = b.score;
                    }
                    const order = query.sortOrder === 'asc' ? 1 : -1;
                    return aValue > bValue ? order : aValue < bValue ? -order : 0;
                });
            }
            return {
                success: true,
                data: recommendations,
                message: 'Recommendations retrieved successfully',
            };
        }
        catch (error) {
            throw error;
        }
    }
    async getRecommendationDetails(user, recommendationId) {
        try {
            const recommendation = await this.communityRecommendationService.getRecommendationById(recommendationId);
            return {
                success: true,
                data: recommendation,
                message: 'Recommendation details retrieved successfully',
            };
        }
        catch (error) {
            throw error;
        }
    }
    async handleRecommendationInteraction(user, recommendationId, dto) {
        try {
            await this.communityRecommendationService.handleRecommendationInteraction({
                recommendationId,
                action: dto.action,
                userId: user.id,
            });
            return {
                success: true,
                message: `Recommendation ${dto.action}ed successfully`,
            };
        }
        catch (error) {
            throw error;
        }
    }
    async refreshRecommendations(user) {
        try {
            await this.communityRecommendationService.generateRecommendationsForUser(user.id, true);
            return {
                success: true,
                message: 'Recommendations refreshed successfully',
            };
        }
        catch (error) {
            throw error;
        }
    }
    async getUserRecommendationStats(user) {
        try {
            const stats = await this.communityRecommendationService.getRecommendationStats();
            return {
                success: true,
                data: stats,
                message: 'User recommendation statistics retrieved successfully',
            };
        }
        catch (error) {
            throw error;
        }
    }
    async getGlobalRecommendationStats() {
        try {
            const stats = await this.communityRecommendationService.getRecommendationStats();
            return {
                success: true,
                data: stats,
                message: 'Global recommendation statistics retrieved successfully',
            };
        }
        catch (error) {
            throw error;
        }
    }
};
exports.CommunityRecommendationController = CommunityRecommendationController;
__decorate([
    (0, common_1.Post)('generate'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, swagger_1.ApiOperation)({
        summary: 'Generate community recommendations for current user',
        description: 'Generates personalized community recommendations based on user assessment scores',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Recommendations generated successfully',
        schema: {
            type: 'object',
            properties: {
                success: { type: 'boolean' },
                data: {
                    type: 'array',
                    items: {
                        type: 'object',
                        properties: {
                            id: { type: 'string' },
                            userId: { type: 'string' },
                            community: {
                                type: 'object',
                                properties: {
                                    id: { type: 'string' },
                                    name: { type: 'string' },
                                    slug: { type: 'string' },
                                    description: { type: 'string' },
                                    imageUrl: { type: 'string' },
                                    memberCount: { type: 'number' },
                                },
                            },
                            compatibilityScore: { type: 'number' },
                            reasoning: { type: 'string' },
                            assessmentScores: { type: 'object' },
                            isAccepted: { type: 'boolean', nullable: true },
                            createdAt: { type: 'string', format: 'date-time' },
                            updatedAt: { type: 'string', format: 'date-time' },
                        },
                    },
                },
                message: { type: 'string' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 404,
        description: 'User not found',
    }),
    (0, swagger_1.ApiResponse)({
        status: 500,
        description: 'Internal server error',
    }),
    __param(0, (0, get_user_decorator_1.GetUser)()),
    __param(1, (0, validate_body_decorator_1.ValidatedBody)(mentara_commons_1.GenerateRecommendationsDtoSchema)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object]),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "generateRecommendations", null);
__decorate([
    (0, common_1.Get)('me'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get current user recommendations',
        description: 'Retrieves all community recommendations for the current user',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'status',
        required: false,
        enum: ['pending', 'accepted', 'rejected'],
        description: 'Filter by recommendation status',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'sortBy',
        required: false,
        enum: ['compatibility', 'created', 'updated'],
        description: 'Sort recommendations by field',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'sortOrder',
        required: false,
        enum: ['asc', 'desc'],
        description: 'Sort order',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'User recommendations retrieved successfully',
    }),
    __param(0, (0, get_user_decorator_1.GetUser)()),
    __param(1, (0, validate_body_decorator_1.ValidatedQuery)(mentara_commons_1.RecommendationQueryDtoSchema)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object]),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "getUserRecommendations", null);
__decorate([
    (0, common_1.Get)(':recommendationId'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get recommendation details',
        description: 'Retrieves detailed information about a specific recommendation',
    }),
    (0, swagger_1.ApiParam)({
        name: 'recommendationId',
        type: 'string',
        format: 'uuid',
        description: 'Unique identifier of the recommendation',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Recommendation details retrieved successfully',
    }),
    (0, swagger_1.ApiResponse)({
        status: 404,
        description: 'Recommendation not found',
    }),
    __param(0, (0, get_user_decorator_1.GetUser)()),
    __param(1, (0, common_1.Param)('recommendationId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "getRecommendationDetails", null);
__decorate([
    (0, common_1.Put)(':recommendationId/interact'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, swagger_1.ApiOperation)({
        summary: 'Interact with recommendation',
        description: 'Accept or reject a community recommendation',
    }),
    (0, swagger_1.ApiParam)({
        name: 'recommendationId',
        type: 'string',
        format: 'uuid',
        description: 'Unique identifier of the recommendation',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Recommendation interaction processed successfully',
    }),
    (0, swagger_1.ApiResponse)({
        status: 404,
        description: 'Recommendation not found',
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Invalid interaction action',
    }),
    __param(0, (0, get_user_decorator_1.GetUser)()),
    __param(1, (0, common_1.Param)('recommendationId', common_1.ParseUUIDPipe)),
    __param(2, (0, validate_body_decorator_1.ValidatedBody)(mentara_commons_1.RecommendationInteractionDtoSchema)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, Object]),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "handleRecommendationInteraction", null);
__decorate([
    (0, common_1.Post)('refresh'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, swagger_1.ApiOperation)({
        summary: 'Refresh user recommendations',
        description: 'Regenerates recommendations based on updated assessment data',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Recommendations refreshed successfully',
    }),
    __param(0, (0, get_user_decorator_1.GetUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "refreshRecommendations", null);
__decorate([
    (0, common_1.Get)('stats/me'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get user recommendation statistics',
        description: 'Retrieves recommendation statistics for the current user',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'User recommendation statistics retrieved successfully',
        schema: {
            type: 'object',
            properties: {
                success: { type: 'boolean' },
                data: {
                    type: 'object',
                    properties: {
                        totalRecommendations: { type: 'number' },
                        acceptedRecommendations: { type: 'number' },
                        rejectedRecommendations: { type: 'number' },
                        pendingRecommendations: { type: 'number' },
                        averageCompatibilityScore: { type: 'number' },
                        topCommunities: {
                            type: 'array',
                            items: {
                                type: 'object',
                                properties: {
                                    communityId: { type: 'string' },
                                    communityName: { type: 'string' },
                                    acceptanceRate: { type: 'number' },
                                    totalRecommendations: { type: 'number' },
                                },
                            },
                        },
                    },
                },
            },
        },
    }),
    __param(0, (0, get_user_decorator_1.GetUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "getUserRecommendationStats", null);
__decorate([
    (0, common_1.Get)('stats/global'),
    (0, roles_decorator_1.Roles)('admin', 'moderator'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get global recommendation statistics',
        description: 'Retrieves platform-wide recommendation statistics (admin/moderator only)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Global recommendation statistics retrieved successfully',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Insufficient permissions',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], CommunityRecommendationController.prototype, "getGlobalRecommendationStats", null);
exports.CommunityRecommendationController = CommunityRecommendationController = __decorate([
    (0, swagger_1.ApiTags)('Community Recommendations'),
    (0, swagger_1.ApiTags)('community-recommendation'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('communities/recommendations'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, role_based_access_guard_1.RoleBasedAccessGuard),
    (0, swagger_1.ApiBearerAuth)(),
    __metadata("design:paramtypes", [typeof (_a = typeof community_recommendation_service_1.CommunityRecommendationService !== "undefined" && community_recommendation_service_1.CommunityRecommendationService) === "function" ? _a : Object])
], CommunityRecommendationController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbnRyb2xsZXJzL2NvbW11bml0eS1yZWNvbW1lbmRhdGlvbi5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FZd0I7QUFDeEIsNkNBT3lCO0FBQ3pCLHFFQUFnRTtBQUNoRSx1RkFBaUY7QUFDakYsMkVBQThEO0FBQzlELDRFQUE4RDtBQUM5RCxtR0FBOEY7QUFDOUYsNkZBR3lEO0FBQ3pELHFEQU95QjtBQVFsQixJQUFNLGlDQUFpQyxHQUF2QyxNQUFNLGlDQUFpQztJQUV6QjtJQURuQixZQUNtQiw4QkFBOEQ7UUFBOUQsbUNBQThCLEdBQTlCLDhCQUE4QixDQUFnQztJQUM5RSxDQUFDO0lBd0RFLEFBQU4sS0FBSyxDQUFDLHVCQUF1QixDQUNoQixJQUFTLEVBRXBCLEdBQStCO1FBRS9CLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxDQUFDLDhCQUE4QixDQUFDLDhCQUE4QixDQUN0RSxJQUFJLENBQUMsRUFBRSxFQUNQLEdBQUcsQ0FBQyxLQUFLLENBQ1YsQ0FBQztZQUVGLE1BQU0sZUFBZSxHQUNuQixNQUFNLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxzQkFBc0IsQ0FDOUQsSUFBSSxDQUFDLEVBQUUsQ0FDUixDQUFDO1lBRUosT0FBTztnQkFDTCxPQUFPLEVBQUUsSUFBSTtnQkFDYixJQUFJLEVBQUUsZUFBZTtnQkFDckIsT0FBTyxFQUFFLGFBQWEsZUFBZSxDQUFDLE1BQU0sa0JBQWtCO2FBQy9ELENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUE4QkssQUFBTixLQUFLLENBQUMsc0JBQXNCLENBQ2YsSUFBUyxFQUMwQixLQUE2QjtRQUUzRSxJQUFJLENBQUM7WUFDSCxJQUFJLGVBQWUsR0FDakIsTUFBTSxJ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dkUsQ0FBQztJQUNELElBQUEscUJBQVcsRUFBQztRQUNYLE1BQU0sRUFBRSxHQUFHO1FBQ1gsV0FBVyxFQUFFLDBCQUEwQjtLQUN4QyxDQUFDOzs7O3FGQWNEOzRDQWpYVSxpQ0FBaUM7SUFON0MsSUFBQSxpQkFBTyxFQUFDLDJCQUEyQixDQUFDO0lBQ3BDLElBQUEsaUJBQU8sRUFBQywwQkFBMEIsQ0FBQztJQUNuQyxJQUFBLHVCQUFhLEVBQUMsVUFBVSxDQUFDO0lBQ3pCLElBQUEsbUJBQVUsRUFBQyw2QkFBNkIsQ0FBQztJQUN6QyxJQUFBLGtCQUFTLEVBQUMsNkJBQVksRUFBRSw4Q0FBb0IsQ0FBQztJQUM3QyxJQUFBLHVCQUFhLEdBQUU7eURBR3FDLGlFQUE4QixvQkFBOUIsaUVBQThCO0dBRnRFLGlDQUFpQyxDQWtYN0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbnRyb2xsZXJzL2NvbW11bml0eS1yZWNvbW1lbmRhdGlvbi5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUG9zdCxcbiAgUHV0LFxuICBQYXJhbSxcbiAgQm9keSxcbiAgUXVlcnksXG4gIFVzZUd1YXJkcyxcbiAgSHR0cFN0YXR1cyxcbiAgSHR0cENvZGUsXG4gIFBhcnNlVVVJRFBpcGUsXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaVBhcmFtLFxuICBBcGlRdWVyeSxcbiAgQXBpQmVhcmVyQXV0aCxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uLy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFJvbGVCYXNlZEFjY2Vzc0d1YXJkIH0gZnJvbSAnLi4vLi4vYXV0aC9ndWFyZHMvcm9sZS1iYXNlZC1hY2Nlc3MuZ3VhcmQnO1xuaW1wb3J0IHsgUm9sZXMgfSBmcm9tICcuLi8uLi9hdXRoL2RlY29yYXRvcnMvcm9sZXMuZGVjb3JhdG9yJztcbmltcG9ydCB7IEdldFVzZXIgfSBmcm9tICcuLi8uLi9kZWNvcmF0b3JzL2dldC11c2VyLmRlY29yYXRvcic7XG5pbXBvcnQgeyBDb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jb21tdW5pdHktcmVjb21tZW5kYXRpb24uc2VydmljZSc7XG5pbXBvcnQge1xuICBWYWxpZGF0ZWRCb2R5LFxuICBWYWxpZGF0ZWRRdWVyeSxcbn0gZnJvbSAnLi4vLi4vY29tbW9uL2RlY29yYXRvcnMvdmFsaWRhdGUtYm9keS5kZWNvcmF0b3InO1xuaW1wb3J0IHtcbiAgR2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNEdG9TY2hlbWEsXG4gIFJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb25EdG9TY2hlbWEsXG4gIFJlY29tbWVuZGF0aW9uUXVlcnlEdG9TY2hlbWEsXG4gIHR5cGUgR2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNEdG8sXG4gIHR5cGUgUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbkR0byxcbiAgdHlwZSBSZWNvbW1lbmRhdGlvblF1ZXJ5RHRvLFxufSBmcm9tICdtZW50YXJhLWNvbW1vbnMnO1xuXG5AQXBpVGFncygnQ29tbXVuaXR5IFJlY29tbWVuZGF0aW9ucycpXG5AQXBpVGFncygnY29tbXVuaXR5LXJlY29tbWVuZGF0aW9uJylcbkBBcGlCZWFyZXJBdXRoKCdKV1QtYXV0aCcpXG5AQ29udHJvbGxlcignY29tbXVuaXRpZXMvcmVjb21tZW5kYXRpb25zJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlQmFzZWRBY2Nlc3NHdWFyZClcbkBBcGlCZWFyZXJBdXRoKClcbmV4cG9ydCBjbGFzcyBDb21tdW5pdHlSZWNvbW1lbmRhdGlvbkNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZTogQ29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLFxuICApIHt9XG5cbiAgQFBvc3QoJ2dlbmVyYXRlJylcbiAgQFJvbGVzKCdjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnR2VuZXJhdGUgY29tbXVuaXR5IHJlY29tbWVuZGF0aW9ucyBmb3IgY3VycmVudCB1c2VyJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdHZW5lcmF0ZXMgcGVyc29uYWxpemVkIGNvbW11bml0eSByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gdXNlciBhc3Nlc3NtZW50IHNjb3JlcycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdSZWNvbW1lbmRhdGlvbnMgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgc3VjY2VzczogeyB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHR5cGU6ICdhcnJheScsXG4gICAgICAgICAgaXRlbXM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICBpZDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICB1c2VySWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgY29tbXVuaXR5OiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgaWQ6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgICAgIG5hbWU6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgICAgIHNsdWc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgICAgICBpbWFnZVVybDogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgICAgICAgICAgICAgbWVtYmVyQ291bnQ6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjb21wYXRpYmlsaXR5U2NvcmU6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgICAgcmVhc29uaW5nOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgIGFzc2Vzc21lbnRTY29yZXM6IHsgdHlwZTogJ29iamVjdCcgfSxcbiAgICAgICAgICAgICAgaXNBY2NlcHRlZDogeyB0eXBlOiAnYm9vbGVhbicsIG51bGxhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgIGNyZWF0ZWRBdDogeyB0eXBlOiAnc3RyaW5nJywgZm9ybWF0OiAnZGF0ZS10aW1lJyB9LFxuICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHsgdHlwZTogJ3N0cmluZycsIGZvcm1hdDogJ2RhdGUtdGltZScgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZTogeyB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDA0LFxuICAgIGRlc2NyaXB0aW9uOiAnVXNlciBub3QgZm91bmQnLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNTAwLFxuICAgIGRlc2NyaXB0aW9uOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgfSlcbiAgYXN5bmMgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoXG4gICAgQEdldFVzZXIoKSB1c2VyOiBhbnksXG4gICAgQFZhbGlkYXRlZEJvZHkoR2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNEdG9TY2hlbWEpXG4gICAgZHRvOiBHZW5lcmF0ZVJlY29tbWVuZGF0aW9uc0R0byxcbiAgKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9yVXNlcihcbiAgICAgICAgdXNlci5pZCxcbiAgICAgICAgZHRvLmZvcmNlLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25zID1cbiAgICAgICAgYXdhaXQgdGhpcy5jb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhcbiAgICAgICAgICB1c2VyLmlkLFxuICAgICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZWNvbW1lbmRhdGlvbnMsXG4gICAgICAgIG1lc3NhZ2U6IGBHZW5lcmF0ZWQgJHtyZWNvbW1lbmRhdGlvbnMubGVuZ3RofSByZWNvbW1lbmRhdGlvbnNgLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnbWUnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0dldCBjdXJyZW50IHVzZXIgcmVjb21tZW5kYXRpb25zJyxcbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlcyBhbGwgY29tbXVuaXR5IHJlY29tbWVuZGF0aW9ucyBmb3IgdGhlIGN1cnJlbnQgdXNlcicsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ3N0YXR1cycsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGVudW06IFsncGVuZGluZycsICdhY2NlcHRlZCcsICdyZWplY3RlZCddLFxuICAgIGRlc2NyaXB0aW9uOiAnRmlsdGVyIGJ5IHJlY29tbWVuZGF0aW9uIHN0YXR1cycsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ3NvcnRCeScsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIGVudW06IFsnY29tcGF0aWJpbGl0eScsICdjcmVhdGVkJywgJ3VwZGF0ZWQnXSxcbiAgICBkZXNjcmlwdGlvbjogJ1NvcnQgcmVjb21tZW5kYXRpb25zIGJ5IGZpZWxkJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnc29ydE9yZGVyJyxcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZW51bTogWydhc2MnLCAnZGVzYyddLFxuICAgIGRlc2NyaXB0aW9uOiAnU29ydCBvcmRlcicsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdVc2VyIHJlY29tbWVuZGF0aW9ucyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgYXN5bmMgZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhcbiAgICBAR2V0VXNlcigpIHVzZXI6IGFueSxcbiAgICBAVmFsaWRhdGVkUXVlcnkoUmVjb21tZW5kYXRpb25RdWVyeUR0b1NjaGVtYSkgcXVlcnk6IFJlY29tbWVuZGF0aW9uUXVlcnlEdG8sXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBsZXQgcmVjb21tZW5kYXRpb25zID1cbiAgICAgICAgYXdhaXQgdGhpcy5jb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0VXNlclJlY29tbWVuZGF0aW9ucyhcbiAgICAgICAgICB1c2VyLmlkLFxuICAgICAgICApO1xuXG4gICAgICAvLyBBcHBseSBzdGF0dXMgZmlsdGVyIGlmIHByb3ZpZGVkXG4gICAgICBpZiAocXVlcnkuc3RhdHVzKSB7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucyA9IHJlY29tbWVuZGF0aW9ucy5maWx0ZXIoKHJlYykgPT4ge1xuICAgICAgICAgIGlmIChxdWVyeS5zdGF0dXMgPT09ICdwZW5kaW5nJykgcmV0dXJuIHJlYy5zdGF0dXMgPT09ICdwZW5kaW5nJztcbiAgICAgICAgICBpZiAocXVlcnkuc3RhdHVzID09PSAnYWNjZXB0ZWQnKSByZXR1cm4gcmVjLnN0YXR1cyA9PT0gJ2pvaW5lZCc7XG4gICAgICAgICAgaWYgKHF1ZXJ5LnN0YXR1cyA9PT0gJ3JlamVjdGVkJykgcmV0dXJuIHJlYy5zdGF0dXMgPT09ICdkaXNtaXNzZWQnO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQXBwbHkgc29ydGluZyBpZiBwcm92aWRlZFxuICAgICAgaWYgKHF1ZXJ5LnNvcnRCeSkge1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgIGxldCBhVmFsdWU6IGFueSwgYlZhbHVlOiBhbnk7XG5cbiAgICAgICAgICBzd2l0Y2ggKHF1ZXJ5LnNvcnRCeSkge1xuICAgICAgICAgICAgY2FzZSAnY29tcGF0aWJpbGl0eSc6XG4gICAgICAgICAgICAgIGFWYWx1ZSA9IGEuc2NvcmU7XG4gICAgICAgICAgICAgIGJWYWx1ZSA9IGIuc2NvcmU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY3JlYXRlZCc6XG4gICAgICAgICAgICAgIGFWYWx1ZSA9IG5ldyBEYXRlKGEuY3JlYXRlZEF0IHx8IDApO1xuICAgICAgICAgICAgICBiVmFsdWUgPSBuZXcgRGF0ZShiLmNyZWF0ZWRBdCB8fCAwKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd1cGRhdGVkJzpcbiAgICAgICAgICAgICAgYVZhbHVlID0gbmV3IERhdGUoYS51cGRhdGVkQXQgfHwgMCk7XG4gICAgICAgICAgICAgIGJWYWx1ZSA9IG5ldyBEYXRlKGIudXBkYXRlZEF0IHx8IDApO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGFWYWx1ZSA9IGEuc2NvcmU7XG4gICAgICAgICAgICAgIGJWYWx1ZSA9IGIuc2NvcmU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3Qgb3JkZXIgPSBxdWVyeS5zb3J0T3JkZXIgPT09ICdhc2MnID8gMSA6IC0xO1xuICAgICAgICAgIHJldHVybiBhVmFsdWUgPiBiVmFsdWUgPyBvcmRlciA6IGFWYWx1ZSA8IGJWYWx1ZSA/IC1vcmRlciA6IDA7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZWNvbW1lbmRhdGlvbnMsXG4gICAgICAgIG1lc3NhZ2U6ICdSZWNvbW1lbmRhdGlvbnMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBAR2V0KCc6cmVjb21tZW5kYXRpb25JZCcpXG4gIEBSb2xlcygnY2xpZW50JywgJ3RoZXJhcGlzdCcsICdtb2RlcmF0b3InLCAnYWRtaW4nKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnR2V0IHJlY29tbWVuZGF0aW9uIGRldGFpbHMnLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ1JldHJpZXZlcyBkZXRhaWxlZCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIHJlY29tbWVuZGF0aW9uJyxcbiAgfSlcbiAgQEFwaVBhcmFtKHtcbiAgICBuYW1lOiAncmVjb21tZW5kYXRpb25JZCcsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZm9ybWF0OiAndXVpZCcsXG4gICAgZGVzY3JpcHRpb246ICdVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgcmVjb21tZW5kYXRpb24nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnUmVjb21tZW5kYXRpb24gZGV0YWlscyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwNCxcbiAgICBkZXNjcmlwdGlvbjogJ1JlY29tbWVuZGF0aW9uIG5vdCBmb3VuZCcsXG4gIH0pXG4gIGFzeW5jIGdldFJlY29tbWVuZGF0aW9uRGV0YWlscyhcbiAgICBAR2V0VXNlcigpIHVzZXI6IGFueSxcbiAgICBAUGFyYW0oJ3JlY29tbWVuZGF0aW9uSWQnLCBQYXJzZVVVSURQaXBlKSByZWNvbW1lbmRhdGlvbklkOiBzdHJpbmcsXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbiA9XG4gICAgICAgIGF3YWl0IHRoaXMuY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uQnlJZChcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbklkLFxuICAgICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZWNvbW1lbmRhdGlvbixcbiAgICAgICAgbWVzc2FnZTogJ1JlY29tbWVuZGF0aW9uIGRldGFpbHMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBAUHV0KCc6cmVjb21tZW5kYXRpb25JZC9pbnRlcmFjdCcpXG4gIEBSb2xlcygnY2xpZW50JywgJ3RoZXJhcGlzdCcsICdtb2RlcmF0b3InLCAnYWRtaW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0ludGVyYWN0IHdpdGggcmVjb21tZW5kYXRpb24nLFxuICAgIGRlc2NyaXB0aW9uOiAnQWNjZXB0IG9yIHJlamVjdCBhIGNvbW11bml0eSByZWNvbW1lbmRhdGlvbicsXG4gIH0pXG4gIEBBcGlQYXJhbSh7XG4gICAgbmFtZTogJ3JlY29tbWVuZGF0aW9uSWQnLFxuICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgIGZvcm1hdDogJ3V1aWQnLFxuICAgIGRlc2NyaXB0aW9uOiAnVW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIHJlY29tbWVuZGF0aW9uJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1JlY29tbWVuZGF0aW9uIGludGVyYWN0aW9uIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDA0LFxuICAgIGRlc2NyaXB0aW9uOiAnUmVjb21tZW5kYXRpb24gbm90IGZvdW5kJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0ludmFsaWQgaW50ZXJhY3Rpb24gYWN0aW9uJyxcbiAgfSlcbiAgYXN5bmMgaGFuZGxlUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbihcbiAgICBAR2V0VXNlcigpIHVzZXI6IGFueSxcbiAgICBAUGFyYW0oJ3JlY29tbWVuZGF0aW9uSWQnLCBQYXJzZVVVSURQaXBlKSByZWNvbW1lbmRhdGlvbklkOiBzdHJpbmcsXG4gICAgQFZhbGlkYXRlZEJvZHkoUmVjb21tZW5kYXRpb25JbnRlcmFjdGlvbkR0b1NjaGVtYSlcbiAgICBkdG86IFJlY29tbWVuZGF0aW9uSW50ZXJhY3Rpb25EdG8sXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbW11bml0eVJlY29tbWVuZGF0aW9uU2VydmljZS5oYW5kbGVSZWNvbW1lbmRhdGlvbkludGVyYWN0aW9uKFxuICAgICAgICB7XG4gICAgICAgICAgcmVjb21tZW5kYXRpb25JZCxcbiAgICAgICAgICBhY3Rpb246IGR0by5hY3Rpb24sXG4gICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogYFJlY29tbWVuZGF0aW9uICR7ZHRvLmFjdGlvbn1lZCBzdWNjZXNzZnVsbHlgLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgQFBvc3QoJ3JlZnJlc2gnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdSZWZyZXNoIHVzZXIgcmVjb21tZW5kYXRpb25zJyxcbiAgICBkZXNjcmlwdGlvbjogJ1JlZ2VuZXJhdGVzIHJlY29tbWVuZGF0aW9ucyBiYXNlZCBvbiB1cGRhdGVkIGFzc2Vzc21lbnQgZGF0YScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdSZWNvbW1lbmRhdGlvbnMgcmVmcmVzaGVkIHN1Y2Nlc3NmdWxseScsXG4gIH0pXG4gIGFzeW5jIHJlZnJlc2hSZWNvbW1lbmRhdGlvbnMoQEdldFVzZXIoKSB1c2VyOiBhbnkpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JVc2VyKFxuICAgICAgICB1c2VyLmlkLFxuICAgICAgICB0cnVlLCAvLyBmb3JjZSByZWZyZXNoXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnUmVjb21tZW5kYXRpb25zIHJlZnJlc2hlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnc3RhdHMvbWUnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0dldCB1c2VyIHJlY29tbWVuZGF0aW9uIHN0YXRpc3RpY3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmVzIHJlY29tbWVuZGF0aW9uIHN0YXRpc3RpY3MgZm9yIHRoZSBjdXJyZW50IHVzZXInLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnVXNlciByZWNvbW1lbmRhdGlvbiBzdGF0aXN0aWNzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHN1Y2Nlc3M6IHsgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICB0b3RhbFJlY29tbWVuZGF0aW9uczogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgYWNjZXB0ZWRSZWNvbW1lbmRhdGlvbnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgIHJlamVjdGVkUmVjb21tZW5kYXRpb25zOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBwZW5kaW5nUmVjb21tZW5kYXRpb25zOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICBhdmVyYWdlQ29tcGF0aWJpbGl0eVNjb3JlOiB7IHR5cGU6ICdudW1iZXInIH0sXG4gICAgICAgICAgICB0b3BDb21tdW5pdGllczoge1xuICAgICAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgIGNvbW11bml0eUlkOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgICAgICBjb21tdW5pdHlOYW1lOiB7IHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICAgICAgICAgICAgICBhY2NlcHRhbmNlUmF0ZTogeyB0eXBlOiAnbnVtYmVyJyB9LFxuICAgICAgICAgICAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnM6IHsgdHlwZTogJ251bWJlcicgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBhc3luYyBnZXRVc2VyUmVjb21tZW5kYXRpb25TdGF0cyhAR2V0VXNlcigpIHVzZXI6IGFueSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGF0cyA9XG4gICAgICAgIGF3YWl0IHRoaXMuY29tbXVuaXR5UmVjb21tZW5kYXRpb25TZXJ2aWNlLmdldFJlY29tbWVuZGF0aW9uU3RhdHMoKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogc3RhdHMsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIHJlY29tbWVuZGF0aW9uIHN0YXRpc3RpY3MgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBAR2V0KCdzdGF0cy9nbG9iYWwnKVxuICBAUm9sZXMoJ2FkbWluJywgJ21vZGVyYXRvcicpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdHZXQgZ2xvYmFsIHJlY29tbWVuZGF0aW9uIHN0YXRpc3RpY3MnLFxuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ1JldHJpZXZlcyBwbGF0Zm9ybS13aWRlIHJlY29tbWVuZGF0aW9uIHN0YXRpc3RpY3MgKGFkbWluL21vZGVyYXRvciBvbmx5KScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdHbG9iYWwgcmVjb21tZW5kYXRpb24gc3RhdGlzdGljcyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMyxcbiAgICBkZXNjcmlwdGlvbjogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycsXG4gIH0pXG4gIGFzeW5jIGdldEdsb2JhbFJlY29tbWVuZGF0aW9uU3RhdHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXRzID1cbiAgICAgICAgYXdhaXQgdGhpcy5jb21tdW5pdHlSZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0UmVjb21tZW5kYXRpb25TdGF0cygpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBzdGF0cyxcbiAgICAgICAgbWVzc2FnZTogJ0dsb2JhbCByZWNvbW1lbmRhdGlvbiBzdGF0aXN0aWNzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=