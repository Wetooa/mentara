{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/worksheets/worksheets.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/worksheets/worksheets.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Delete,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  UseInterceptors,\n  UploadedFiles,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { JwtAuthGuard } from 'src/auth/guards/jwt-auth.guard';\nimport { CurrentUserId } from 'src/auth/decorators/current-user-id.decorator';\nimport { SupabaseStorageService } from 'src/common/services/supabase-storage.service';\nimport { WorksheetsService } from './worksheets.service';\nimport { PaginationQuery, FilterQuery } from 'src/types';\nimport type {\n  WorksheetCreateInputDto,\n  WorksheetUpdateInputDto,\n  WorksheetSubmissionCreateInputDto,\n} from './types';\n\n@Controller('worksheets')\n@UseGuards(JwtAuthGuard)\nexport class WorksheetsController {\n  constructor(\n    private readonly worksheetsService: WorksheetsService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  @Get()\n  findAll(\n    @CurrentUserId() clerkId: string,\n    @Query() query: PaginationQuery & FilterQuery & { isCompleted?: boolean; limit?: number },\n  ) {\n    // Convert isCompleted boolean to status string for service compatibility\n    let status: string | undefined = query.status;\n    if (query.isCompleted !== undefined) {\n      status = query.isCompleted ? 'SUBMITTED' : 'ASSIGNED';\n    }\n\n    return this.worksheetsService.findAll(\n      query.userId,\n      query.therapistId,\n      status,\n      query.limit,\n    );\n  }\n\n  @Get(':id')\n  findById(@Param('id') id: string) {\n    return this.worksheetsService.findById(id);\n  }\n\n  @Post()\n  @UseInterceptors(FilesInterceptor('files', 5)) // Support up to 5 files\n  create(\n    @CurrentUserId() clerkId: string,\n    @Body()\n    createWorksheetDto: WorksheetCreateInputDto & {\n      clientId: string;\n      therapistId: string;\n    },\n    @UploadedFiles() files: Express.Multer.File[] = [], // Optional files\n  ) {\n    return this.worksheetsService.create(\n      createWorksheetDto,\n      createWorksheetDto.clientId,\n      createWorksheetDto.therapistId,\n      files,\n    );\n  }\n\n  @Put(':id')\n  update(\n    @CurrentUserId() clerkId: string,\n    @Param('id') id: string,\n    @Body() updateWorksheetDto: WorksheetUpdateInputDto,\n  ) {\n    return this.worksheetsService.update(id, updateWorksheetDto);\n  }\n\n  @Delete(':id')\n  delete(@CurrentUserId() clerkId: string, @Param('id') id: string) {\n    return this.worksheetsService.delete(id);\n  }\n\n  @Post('submissions')\n  addSubmission(\n    @CurrentUserId() clerkId: string,\n    @Body() createSubmissionDto: WorksheetSubmissionCreateInputDto,\n  ) {\n    return this.worksheetsService.addSubmission(createSubmissionDto, clerkId);\n  }\n\n  @Post(':id/submit')\n  submitWorksheet(\n    @CurrentUserId() clerkId: string,\n    @Param('id') id: string,\n    @Body() submitWorksheetDto: WorksheetSubmissionCreateInputDto,\n  ) {\n    return this.worksheetsService.submitWorksheet(\n      id,\n      submitWorksheetDto,\n      clerkId,\n    );\n  }\n\n  @Delete('submissions/:id')\n  deleteSubmission(@CurrentUserId() clerkId: string, @Param('id') id: string) {\n    return this.worksheetsService.deleteSubmission(id);\n  }\n}\n"],"version":3}