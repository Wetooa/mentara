82b5943ff03b2fdacede23b5acee8226
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var MeetingsService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeetingsService = void 0;
const common_1 = require("@nestjs/common");
const jwt_1 = require("@nestjs/jwt");
const prisma_client_provider_1 = require("../providers/prisma-client.provider");
const event_bus_service_1 = require("../common/events/event-bus.service");
const booking_events_1 = require("../common/events/booking-events");
let MeetingsService = MeetingsService_1 = class MeetingsService {
    prisma;
    eventBus;
    jwtService;
    logger = new common_1.Logger(MeetingsService_1.name);
    constructor(prisma, eventBus, jwtService) {
        this.prisma = prisma;
        this.eventBus = eventBus;
        this.jwtService = jwtService;
    }
    /**
     * Get meeting details with access validation
     */
    async getMeetingById(meetingId, userId) {
        const meeting = await this.prisma.meeting.findFirst({
            where: {
                id: meetingId,
                OR: [{ clientId: userId }, { therapistId: userId }],
            },
            include: {
                client: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                email: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                therapist: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                email: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
            },
        });
        if (!meeting) {
            throw new common_1.NotFoundException('Meeting not found or access denied');
        }
        return meeting;
    }
    /**
     * Get user's upcoming meetings
     */
    async getUpcomingMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        // This follows REST API best practices: return 200 with empty array rather than 404
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return {
                meetings: [],
                total: 0,
            };
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: { in: ['SCHEDULED', 'CONFIRMED'] },
                startTime: { gte: new Date() },
            },
            include: {
                client: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
                therapist: {
                    include: {
                        user: {
                            select: {
                                firstName: true,
                                lastName: true,
                                avatarUrl: true,
                            },
                        },
                    },
                },
            },
            orderBy: { startTime: 'asc' },
            take: limit,
        });
        this.logger.log(`Found ${meetings.length} upcoming meetings for user ${userId}`);
        return {
            meetings,
            total: meetings.length,
        };
    }
    /**
     * Generate meeting room URL/token (for integration with video platforms)
     */
    async generateMeetingRoom(meetingId, userId) {
        await this.getMeetingById(meetingId, userId);
        // In a real implementation, this would integrate with video platforms like:
        // - Zoom SDK
        // - WebRTC/Jitsi
        // - Twilio Video
        // - Agora
        const roomUrl = `${process.env.FRONTEND_URL}/meeting/${meetingId}`;
        const roomToken = this.generateRoomToken(meetingId, userId, 'host');
        // Update meeting with room URL
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: { meetingUrl: roomUrl },
        });
        return {
            roomUrl,
            roomToken,
            meetingId,
            expires: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours
        };
    }
    /**
     * Validate meeting access for WebSocket connections
     */
    async validateMeetingAccess(meetingId, userId) {
        try {
            const meeting = await this.prisma.meeting.findFirst({
                where: {
                    id: meetingId,
                    OR: [{ clientId: userId }, { therapistId: userId }],
                    status: { in: ['SCHEDULED', 'CONFIRMED', 'IN_PROGRESS'] },
                },
            });
            return !!meeting;
        }
        catch (error) {
            this.logger.error('Failed to validate meeting access:', error);
            return false;
        }
    }
    /**
     * Get meeting analytics for therapists
     */
    async getMeetingAnalytics(therapistId, dateRange) {
        const whereClause = {
            therapistId,
            status: 'COMPLETED',
        };
        if (dateRange) {
            whereClause.startTime = {
                gte: dateRange.start,
                lte: dateRange.end,
            };
        }
        const meetings = await this.prisma.meeting.findMany({
            where: whereClause,
            include: {
                meetingNotes: true,
            },
        });
        const analytics = {
            totalMeetings: meetings.length,
            totalDuration: meetings.reduce((sum, m) => sum + m.duration, 0),
            averageDuration: meetings.length > 0
                ? meetings.reduce((sum, m) => sum + m.duration, 0) / meetings.length
                : 0,
            meetingsByType: {
                video: meetings.filter((m) => m.meetingType === 'video').length,
                audio: meetings.filter((m) => m.meetingType === 'audio').length,
                chat: meetings.filter((m) => m.meetingType === 'chat').length,
            },
            completionRate: (meetings.filter((m) => m.status === 'COMPLETED').length /
                meetings.length) *
                100,
        };
        return analytics;
    }
    /**
     * Generate secure room access token using JWT
     */
    generateRoomToken(meetingId, userId, role) {
        const payload = {
            sub: userId,
            meetingId,
            role: role || 'participant',
            type: 'meeting_access',
            iat: Math.floor(Date.now() / 1000),
        };
        // Generate JWT with 24-hour expiration for meeting tokens
        return this.jwtService.sign(payload, {
            expiresIn: '24h',
            issuer: 'mentara-meetings',
            subject: userId,
        });
    }
    /**
     * Validate and decode room access token
     */
    validateRoomToken(token) {
        try {
            const decoded = this.jwtService.verify(token, {
                issuer: 'mentara-meetings',
            });
            if (decoded.type !== 'meeting_access') {
                return null;
            }
            return {
                userId: decoded.sub,
                meetingId: decoded.meetingId,
                role: decoded.role,
            };
        }
        catch (error) {
            this.logger.warn(`Invalid room token: ${error instanceof Error ? error.message : String(error)}`);
            return null;
        }
    }
    /**
     * Handle emergency meeting termination
     */
    async emergencyTerminateMeeting(meetingId, reason, terminatedBy) {
        const meeting = await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'CANCELLED',
            },
        });
        // Add emergency termination note
        await this.prisma.meetingNotes.create({
            data: {
                id: `note_${Date.now()}`,
                meetingId,
                notes: `Emergency termination: ${reason}. Terminated by: ${terminatedBy}`,
            },
        });
        void this.eventBus.emit(new booking_events_1.MeetingEmergencyTerminatedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            terminatedBy,
            terminatedAt: new Date(),
            reason,
        }));
        this.logger.warn(`Emergency termination of meeting ${meetingId}: ${reason}`);
        return meeting;
    }
    // ===== VIDEO CALL INTEGRATION METHODS =====
    /**
     * Create a video room for a meeting
     */
    async createVideoRoom(meetingId, userId, createRoomDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        if (meeting.status !== 'SCHEDULED' && meeting.status !== 'CONFIRMED') {
            throw new common_1.BadRequestException('Meeting must be scheduled or confirmed to create video room');
        }
        // Update meeting status to IN_PROGRESS
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: { status: 'IN_PROGRESS' },
        });
        // Generate video room data (in production, integrate with actual video service like Twilio/Zoom)
        const roomId = `room_${meetingId}_${Date.now()}`;
        const accessToken = this.generateRoomToken(meetingId, userId, 'host');
        const participantToken = this.generateRoomToken(meetingId, userId, 'participant');
        const videoRoomResponse = {
            roomId,
            meetingId,
            joinUrl: `https://video.mentara.app/room/${roomId}`,
            roomUrl: `https://video.mentara.app/room/${roomId}`, // Replace with actual video service URL
            accessToken,
            participantToken,
            roomConfig: {
                maxParticipants: createRoomDto.maxParticipants,
                enableRecording: createRoomDto.enableRecording,
                enableChat: createRoomDto.enableChat,
                recordingActive: false,
            },
            participants: [],
            roomSettings: {
                maxParticipants: createRoomDto.maxParticipants || 2,
                recordingEnabled: createRoomDto.recordingEnabled || false,
                screenShareEnabled: createRoomDto.screenShareEnabled || true,
                chatEnabled: createRoomDto.chatEnabled || true,
                waitingRoomEnabled: createRoomDto.waitingRoomEnabled || false,
            },
            expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours
            participantCount: 1,
            status: 'waiting',
            createdAt: new Date().toISOString(),
        };
        // Emit meeting started event
        void this.eventBus.emit(new booking_events_1.MeetingStartedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            startedAt: new Date(),
            actualStartTime: new Date(),
            scheduledStartTime: meeting.startTime,
        }));
        this.logger.log(`Video room created for meeting ${meetingId}`);
        return videoRoomResponse;
    }
    /**
     * Join an existing video room
     */
    async joinVideoRoom(meetingId, userId, joinRoomDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        if (meeting.status !== 'IN_PROGRESS') {
            throw new common_1.BadRequestException('Meeting must be in progress to join video room');
        }
        // Generate participant credentials
        const roomId = `room_${meetingId}_${Date.now()}`;
        const accessToken = this.generateRoomToken(meetingId, userId, joinRoomDto.role);
        const participantToken = this.generateRoomToken(meetingId, userId, joinRoomDto.role);
        const videoRoomResponse = {
            roomId,
            meetingId,
            joinUrl: `https://video.mentara.app/room/${roomId}`,
            roomUrl: `https://video.mentara.app/room/${roomId}`,
            accessToken,
            participantToken,
            roomConfig: {
                maxParticipants: 2,
                enableRecording: false,
                enableChat: true,
                recordingActive: false,
            },
            participants: [],
            roomSettings: {
                maxParticipants: 2,
                recordingEnabled: false,
                screenShareEnabled: true,
                chatEnabled: true,
                waitingRoomEnabled: false,
            },
            expiresAt: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(),
            participantCount: 2,
            status: 'active',
            createdAt: new Date().toISOString(),
        };
        this.logger.log(`User ${userId} joined video room for meeting ${meetingId}`);
        return videoRoomResponse;
    }
    /**
     * Get video call status
     */
    async getVideoCallStatus(meetingId, userId) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        // Mock video call status (in production, fetch from actual video service)
        const videoCallStatus = {
            meetingId,
            roomId: `room_${meetingId}`,
            isActive: meeting.status === 'IN_PROGRESS',
            participantCount: 2, // Client + Therapist
            status: meeting.status === 'IN_PROGRESS' ? 'active' : 'waiting',
            participants: [
                {
                    userId: meeting.clientId,
                    id: meeting.clientId,
                    name: 'Client', // In production, fetch actual user names
                    role: 'client',
                    joinedAt: meeting.startTime.toISOString(),
                    isHost: false,
                    audioEnabled: true,
                    videoEnabled: true,
                    connectionStatus: 'connected',
                },
                {
                    userId: meeting.therapistId,
                    id: meeting.therapistId,
                    name: 'Therapist',
                    role: 'therapist',
                    joinedAt: meeting.startTime.toISOString(),
                    isHost: true,
                    audioEnabled: true,
                    videoEnabled: true,
                    connectionStatus: 'connected',
                },
            ],
            startedAt: meeting.startTime.toISOString(),
            endedAt: meeting.status === 'COMPLETED'
                ? new Date(meeting.startTime.getTime() + meeting.duration * 60000).toISOString()
                : undefined,
            duration: meeting.status === 'COMPLETED' ? meeting.duration : undefined,
        };
        return videoCallStatus;
    }
    /**
     * End video call
     */
    async endVideoCall(meetingId, userId, endCallDto) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        // Update meeting status to completed
        await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: 'COMPLETED',
            },
        });
        // Save session summary if provided
        if (endCallDto.duration || endCallDto.reason || endCallDto.participantFeedback) {
            await this.prisma.meetingNotes.create({
                data: {
                    id: `notes_${meetingId}_${Date.now()}`,
                    meetingId,
                    notes: JSON.stringify({
                        sessionType: 'REGULAR_THERAPY',
                        duration: endCallDto.duration,
                        endReason: endCallDto.reason,
                        audioQuality: endCallDto.participantFeedback?.audioQuality,
                        videoQuality: endCallDto.participantFeedback?.videoQuality,
                        overallExperience: endCallDto.participantFeedback?.overallExperience,
                        issues: endCallDto.participantFeedback?.issues,
                        platform: 'video',
                        endTime: new Date().toISOString(),
                    }),
                },
            });
        }
        // Emit meeting completed event
        void this.eventBus.emit(new booking_events_1.MeetingCompletedEvent({
            meetingId,
            clientId: meeting.clientId,
            therapistId: meeting.therapistId,
            completedAt: new Date(),
            actualDuration: endCallDto.duration || meeting.duration,
            scheduledDuration: meeting.duration,
        }));
        this.logger.log(`Video call ended for meeting ${meetingId}: ${endCallDto.reason}`);
    }
    /**
     * Updated method to use new DTOs
     */
    async updateMeetingStatus(meetingId, userId, updateStatusDto) {
        const meeting = await this.getMeetingById(meetingId, userId);
        const updatedMeeting = await this.prisma.meeting.update({
            where: { id: meetingId },
            data: {
                status: updateStatusDto.status.toUpperCase(),
            },
        });
        // Emit appropriate events based on status
        switch (updateStatusDto.status) {
            case 'confirmed':
                void this.eventBus.emit(new booking_events_1.MeetingConfirmedEvent({
                    meetingId,
                    clientId: meeting.clientId,
                    therapistId: meeting.therapistId,
                    confirmedAt: new Date(),
                    startTime: meeting.startTime,
                    duration: meeting.duration,
                }));
                break;
            case 'cancelled':
                void this.eventBus.emit(new booking_events_1.MeetingCancelledEvent({
                    meetingId,
                    clientId: meeting.clientId,
                    therapistId: meeting.therapistId,
                    cancelledBy: userId,
                    cancelledAt: new Date(),
                    cancellationReason: updateStatusDto.reason,
                    originalStartTime: meeting.startTime,
                }));
                break;
        }
        this.logger.log(`Meeting ${meetingId} status updated to ${updateStatusDto.status}`);
        return updatedMeeting;
    }
    /**
     * Updated method to use new DTOs
     */
    async saveMeetingSession(meetingId, userId, sessionData) {
        // Validate meeting access
        const meeting = await this.getMeetingById(meetingId, userId);
        const session = await this.prisma.meetingNotes.create({
            data: {
                id: `session_${meetingId}_${Date.now()}`,
                meetingId,
                notes: JSON.stringify({
                    sessionType: 'REGULAR_THERAPY',
                    startTime: sessionData.sessionData?.startedAt ? new Date(sessionData.sessionData.startedAt).toISOString() : new Date().toISOString(),
                    endTime: sessionData.sessionData?.endedAt ? new Date(sessionData.sessionData.endedAt).toISOString() : new Date().toISOString(),
                    duration: sessionData.sessionData?.duration || sessionData.duration,
                    status: 'COMPLETED',
                    platform: 'video',
                    sessionNotes: sessionData.sessionNotes,
                    clientProgress: sessionData.clientProgress,
                    followUpActions: sessionData.followUpActions,
                    quality: sessionData.sessionData?.quality,
                    issues: sessionData.sessionData?.issues || [],
                }),
            },
        });
        this.logger.log(`Session data saved for meeting ${meetingId}`);
        return session;
    }
    /**
     * Get user's completed meetings
     */
    async getCompletedMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: 'COMPLETED',
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get user's cancelled meetings
     */
    async getCancelledMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: { in: ['CANCELLED', 'NO_SHOW'] },
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get user's in-progress meetings
     */
    async getInProgressMeetings(userId, limit = 10) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const meetings = await this.prisma.meeting.findMany({
            where: {
                OR: [{ clientId: userId }, { therapistId: userId }],
                status: 'IN_PROGRESS',
            },
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: limit,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Get all meetings with filtering options
     */
    async getAllMeetings(userId, queryOptions) {
        // First validate that user exists
        const userExists = await this.prisma.user.findUnique({
            where: { id: userId },
            include: {
                client: { select: { userId: true } },
                therapist: { select: { userId: true } },
            },
        });
        if (!userExists) {
            this.logger.warn(`User not found: ${userId}`);
            throw new common_1.NotFoundException('User not found');
        }
        // If user exists but is not a client or therapist, return empty meetings
        if (!userExists.client && !userExists.therapist) {
            this.logger.log(`User ${userId} is not a client or therapist, returning empty meetings`);
            return [];
        }
        const whereClause = {
            OR: [{ clientId: userId }, { therapistId: userId }],
        };
        // Add status filter
        if (queryOptions.status) {
            whereClause.status = queryOptions.status.toUpperCase();
        }
        // Add date range filter
        if (queryOptions.dateFrom || queryOptions.dateTo) {
            whereClause.startTime = {};
            if (queryOptions.dateFrom) {
                whereClause.startTime.gte = new Date(queryOptions.dateFrom);
            }
            if (queryOptions.dateTo) {
                whereClause.startTime.lte = new Date(queryOptions.dateTo);
            }
        }
        const meetings = await this.prisma.meeting.findMany({
            where: whereClause,
            include: this.getMeetingIncludeOptions(),
            orderBy: { startTime: 'desc' },
            take: queryOptions.limit || 20,
            skip: queryOptions.offset || 0,
        });
        return this.transformMeetings(meetings);
    }
    /**
     * Helper method to get consistent meeting include options
     */
    getMeetingIncludeOptions() {
        return {
            client: {
                include: {
                    user: {
                        select: {
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                },
            },
            therapist: {
                include: {
                    user: {
                        select: {
                            firstName: true,
                            lastName: true,
                            avatarUrl: true,
                        },
                    },
                },
            },
        };
    }
    /**
     * Helper method to transform meetings data
     */
    transformMeetings(meetings) {
        return meetings.map(meeting => ({
            id: meeting.id,
            title: meeting.title,
            description: meeting.description,
            status: meeting.status,
            startTime: meeting.startTime,
            endTime: meeting.endTime,
            duration: meeting.duration,
            meetingType: meeting.meetingType,
            meetingUrl: meeting.meetingUrl,
            client: meeting.client,
            therapist: meeting.therapist,
            createdAt: meeting.createdAt,
            updatedAt: meeting.updatedAt,
        }));
    }
};
exports.MeetingsService = MeetingsService;
exports.MeetingsService = MeetingsService = MeetingsService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _a : Object, typeof (_b = typeof event_bus_service_1.EventBusService !== "undefined" && event_bus_service_1.EventBusService) === "function" ? _b : Object, typeof (_c = typeof jwt_1.JwtService !== "undefined" && jwt_1.JwtService) === "function" ? _c : Object])
], MeetingsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FNd0I7QUFDeEIscUNBQXlDO0FBQ3pDLGdGQUFvRTtBQUNwRSwwRUFBcUU7QUFDckUsb0VBTXlDO0FBNEJsQyxJQUFNLGVBQWUsdUJBQXJCLE1BQU0sZUFBZTtJQUlQO0lBQ0E7SUFDQTtJQUxGLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxpQkFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTNELFlBQ21CLE1BQXFCLEVBQ3JCLFFBQXlCLEVBQ3pCLFVBQXNCO1FBRnRCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtJQUN0QyxDQUFDO0lBRUo7O09BRUc7SUFDSCxLQUFLLENBQUMsY0FBYyxDQUFDLFNBQWlCLEVBQUUsTUFBYztRQUNwRCxNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQztZQUNsRCxLQUFLLEVBQUU7Z0JBQ0wsRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLENBQUM7YUFDcEQ7WUFDRCxPQUFPLEVBQUU7Z0JBQ1AsTUFBTSxFQUFFO29CQUNOLE9BQU8sRUFBRTt3QkFDUCxJQUFJLEVBQUU7NEJBQ0osTUFBTSxFQUFFO2dDQUNOLFNBQVMsRUFBRSxJQUFJO2dDQUNmLFFBQVEsRUFBRSxJQUFJO2dDQUNkLEtBQUssRUFBRSxJQUFJO2dDQUNYLFNBQVMsRUFBRSxJQUFJOzZCQUNoQjt5QkFDRjtxQkFDRjtpQkFDRjtnQkFDRCxTQUFTLEVBQUU7b0JBQ1QsT0FBTyxFQUFFO3dCQUNQLElBQUks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QzlCLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRTtZQUNkLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztZQUNwQixXQUFXLEVBQUUsT0FBTyxDQUFDLFdBQVc7WUFDaEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO1lBQ3RCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztZQUM1QixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87WUFDeEIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1lBQzFCLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztZQUNoQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVU7WUFDOUIsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO1lBQ3RCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztZQUM1QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7WUFDNUIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1NBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ04sQ0FBQztDQUNGLENBQUE7QUE5MkJZLDBDQUFlOzBCQUFmLGVBQWU7SUFEM0IsSUFBQSxtQkFBVSxHQUFFO3lEQUtnQixzQ0FBYSxvQkFBYixzQ0FBYSxvREFDWCxtQ0FBZSxvQkFBZixtQ0FBZSxvREFDYixnQkFBVSxvQkFBVixnQkFBVTtHQU45QixlQUFlLENBODJCM0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lZXRpbmdzL21lZXRpbmdzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSW5qZWN0YWJsZSxcbiAgTG9nZ2VyLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgRm9yYmlkZGVuRXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBKd3RTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9qd3QnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJy4uL3Byb3ZpZGVycy9wcmlzbWEtY2xpZW50LnByb3ZpZGVyJztcbmltcG9ydCB7IEV2ZW50QnVzU2VydmljZSB9IGZyb20gJy4uL2NvbW1vbi9ldmVudHMvZXZlbnQtYnVzLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgTWVldGluZ0NvbmZpcm1lZEV2ZW50LFxuICBNZWV0aW5nU3RhcnRlZEV2ZW50LFxuICBNZWV0aW5nQ29tcGxldGVkRXZlbnQsXG4gIE1lZXRpbmdDYW5jZWxsZWRFdmVudCxcbiAgTWVldGluZ0VtZXJnZW5jeVRlcm1pbmF0ZWRFdmVudCxcbn0gZnJvbSAnLi4vY29tbW9uL2V2ZW50cy9ib29raW5nLWV2ZW50cyc7XG5pbXBvcnQgdHlwZSB7XG4gIENyZWF0ZVZpZGVvUm9vbUR0byxcbiAgSm9pblZpZGVvUm9vbUR0byxcbiAgRW5kVmlkZW9DYWxsRHRvLFxuICBWaWRlb1Jvb21SZXNwb25zZSxcbiAgVmlkZW9DYWxsU3RhdHVzLFxuICBVcGRhdGVNZWV0aW5nU3RhdHVzRHRvLFxuICBTYXZlTWVldGluZ1Nlc3Npb25EdG8sXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lZXRpbmdTZXNzaW9uRGF0YSB7XG4gIG1lZXRpbmdJZDogc3RyaW5nO1xuICBzdGFydFRpbWU6IERhdGU7XG4gIGVuZFRpbWU/OiBEYXRlO1xuICBwYXJ0aWNpcGFudENvdW50OiBudW1iZXI7XG4gIGR1cmF0aW9uOiBudW1iZXI7IC8vIGFjdHVhbCBkdXJhdGlvbiBpbiBtaW51dGVzXG4gIHJlY29yZGluZ1VybD86IHN0cmluZztcbiAgY2hhdE1lc3NhZ2VzPzogYW55W107XG4gIHRlY2hJc3N1ZXM/OiBzdHJpbmdbXTtcbiAgcXVhbGl0eT86IHtcbiAgICB2aWRlb1F1YWxpdHk6ICdwb29yJyB8ICdmYWlyJyB8ICdnb29kJyB8ICdleGNlbGxlbnQnO1xuICAgIGF1ZGlvUXVhbGl0eTogJ3Bvb3InIHwgJ2ZhaXInIHwgJ2dvb2QnIHwgJ2V4Y2VsbGVudCc7XG4gICAgY29ubmVjdGlvblN0YWJpbGl0eTogJ3Bvb3InIHwgJ2ZhaXInIHwgJ2dvb2QnIHwgJ2V4Y2VsbGVudCc7XG4gIH07XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNZWV0aW5nc1NlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoTWVldGluZ3NTZXJ2aWNlLm5hbWUpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJpc21hOiBQcmlzbWFTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZXZlbnRCdXM6IEV2ZW50QnVzU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGp3dFNlcnZpY2U6IEp3dFNlcnZpY2UsXG4gICkge31cblxuICAvKipcbiAgICogR2V0IG1lZXRpbmcgZGV0YWlscyB3aXRoIGFjY2VzcyB2YWxpZGF0aW9uXG4gICAqL1xuICBhc3luYyBnZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IG1lZXRpbmdJZCxcbiAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFtZWV0aW5nKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ01lZXRpbmcgbm90IGZvdW5kIG9yIGFjY2VzcyBkZW5pZWQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWVldGluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlcidzIHVwY29taW5nIG1lZXRpbmdzXG4gICAqL1xuICBhc3luYyBnZXRVcGNvbWluZ01lZXRpbmdzKHVzZXJJZDogc3RyaW5nLCBsaW1pdCA9IDEwKSB7XG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFVzZXIgbm90IGZvdW5kOiAke3VzZXJJZH1gKTtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyBJZiB1c2VyIGV4aXN0cyBidXQgaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuIGVtcHR5IG1lZXRpbmdzXG4gICAgLy8gVGhpcyBmb2xsb3dzIFJFU1QgQVBJIGJlc3QgcHJhY3RpY2VzOiByZXR1cm4gMjAwIHdpdGggZW1wdHkgYXJyYXkgcmF0aGVyIHRoYW4gNDA0XG4gICAgaWYgKCF1c2VyRXhpc3RzLmNsaWVudCAmJiAhdXNlckV4aXN0cy50aGVyYXBpc3QpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgVXNlciAke3VzZXJJZH0gaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuaW5nIGVtcHR5IG1lZXRpbmdzYCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZWV0aW5nczogW10sXG4gICAgICAgIHRvdGFsOiAwLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgICBzdGF0dXM6IHsgaW46IFsnU0NIRURVTEVEJywgJ0NPTkZJUk1FRCddIH0sXG4gICAgICAgIHN0YXJ0VGltZTogeyBndGU6IG5ldyBEYXRlKCkgfSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGNsaWVudDoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF2YXRhclVybDogdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIG9yZGVyQnk6IHsgc3RhcnRUaW1lOiAnYXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYEZvdW5kICR7bWVldGluZ3MubGVuZ3RofSB1cGNvbWluZyBtZWV0aW5ncyBmb3IgdXNlciAke3VzZXJJZH1gKTtcblxuICAgIHJldHVybiB7XG4gICAgICBtZWV0aW5ncyxcbiAgICAgIHRvdGFsOiBtZWV0aW5ncy5sZW5ndGgsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBtZWV0aW5nIHJvb20gVVJML3Rva2VuIChmb3IgaW50ZWdyYXRpb24gd2l0aCB2aWRlbyBwbGF0Zm9ybXMpXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZU1lZXRpbmdSb29tKG1lZXRpbmdJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIHZpZGVvIHBsYXRmb3JtcyBsaWtlOlxuICAgIC8vIC0gWm9vbSBTREtcbiAgICAvLyAtIFdlYlJUQy9KaXRzaVxuICAgIC8vIC0gVHdpbGlvIFZpZGVvXG4gICAgLy8gLSBBZ29yYVxuXG4gICAgY29uc3Qgcm9vbVVybCA9IGAke3Byb2Nlc3MuZW52LkZST05URU5EX1VSTH0vbWVldGluZy8ke21lZXRpbmdJZH1gO1xuICAgIGNvbnN0IHJvb21Ub2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4obWVldGluZ0lkLCB1c2VySWQsICdob3N0Jyk7XG5cbiAgICAvLyBVcGRhdGUgbWVldGluZyB3aXRoIHJvb20gVVJMXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmdJZCB9LFxuICAgICAgZGF0YTogeyBtZWV0aW5nVXJsOiByb29tVXJsIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcm9vbVVybCxcbiAgICAgIHJvb21Ub2tlbixcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIGV4cGlyZXM6IG5ldyBEYXRlKERhdGUubm93KCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKSwgLy8gMjQgaG91cnNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzIGZvciBXZWJTb2NrZXQgY29ubmVjdGlvbnNcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlTWVldGluZ0FjY2VzcyhcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgaWQ6IG1lZXRpbmdJZCxcbiAgICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICAgICAgc3RhdHVzOiB7IGluOiBbJ1NDSEVEVUxFRCcsICdDT05GSVJNRUQnLCAnSU5fUFJPR1JFU1MnXSB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiAhIW1lZXRpbmc7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gdmFsaWRhdGUgbWVldGluZyBhY2Nlc3M6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbWVldGluZyBhbmFseXRpY3MgZm9yIHRoZXJhcGlzdHNcbiAgICovXG4gIGFzeW5jIGdldE1lZXRpbmdBbmFseXRpY3MoXG4gICAgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICBkYXRlUmFuZ2U/OiB7IHN0YXJ0OiBEYXRlOyBlbmQ6IERhdGUgfSxcbiAgKSB7XG4gICAgY29uc3Qgd2hlcmVDbGF1c2U6IGFueSA9IHtcbiAgICAgIHRoZXJhcGlzdElkLFxuICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICB9O1xuXG4gICAgaWYgKGRhdGVSYW5nZSkge1xuICAgICAgd2hlcmVDbGF1c2Uuc3RhcnRUaW1lID0ge1xuICAgICAgICBndGU6IGRhdGVSYW5nZS5zdGFydCxcbiAgICAgICAgbHRlOiBkYXRlUmFuZ2UuZW5kLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBtZWV0aW5nTm90ZXM6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYW5hbHl0aWNzID0ge1xuICAgICAgdG90YWxNZWV0aW5nczogbWVldGluZ3MubGVuZ3RoLFxuICAgICAgdG90YWxEdXJhdGlvbjogbWVldGluZ3MucmVkdWNlKChzdW0sIG0pID0+IHN1bSArIG0uZHVyYXRpb24sIDApLFxuICAgICAgYXZlcmFnZUR1cmF0aW9uOlxuICAgICAgICBtZWV0aW5ncy5sZW5ndGggPiAwXG4gICAgICAgICAgPyBtZWV0aW5ncy5yZWR1Y2UoKHN1bSwgbSkgPT4gc3VtICsgbS5kdXJhdGlvbiwgMCkgLyBtZWV0aW5ncy5sZW5ndGhcbiAgICAgICAgICA6IDAsXG4gICAgICBtZWV0aW5nc0J5VHlwZToge1xuICAgICAgICB2aWRlbzogbWVldGluZ3MuZmlsdGVyKChtKSA9PiBtLm1lZXRpbmdUeXBlID09PSAndmlkZW8nKS5sZW5ndGgsXG4gICAgICAgIGF1ZGlvOiBtZWV0aW5ncy5maWx0ZXIoKG0pID0+IG0ubWVldGluZ1R5cGUgPT09ICdhdWRpbycpLmxlbmd0aCxcbiAgICAgICAgY2hhdDogbWVldGluZ3MuZmlsdGVyKChtKSA9PiBtLm1lZXRpbmdUeXBlID09PSAnY2hhdCcpLmxlbmd0aCxcbiAgICAgIH0sXG4gICAgICBjb21wbGV0aW9uUmF0ZTpcbiAgICAgICAgKG1lZXRpbmdzLmZpbHRlcigobSkgPT4gbS5zdGF0dXMgPT09ICdDT01QTEVURUQnKS5sZW5ndGggL1xuICAgICAgICAgIG1lZXRpbmdzLmxlbmd0aCkgKlxuICAgICAgICAxMDAsXG4gICAgfTtcblxuICAgIHJldHVybiBhbmFseXRpY3M7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgc2VjdXJlIHJvb20gYWNjZXNzIHRva2VuIHVzaW5nIEpXVFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJvb21Ub2tlbihcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICByb2xlPzogc3RyaW5nLFxuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBzdWI6IHVzZXJJZCxcbiAgICAgIG1lZXRpbmdJZCxcbiAgICAgIHJvbGU6IHJvbGUgfHwgJ3BhcnRpY2lwYW50JyxcbiAgICAgIHR5cGU6ICdtZWV0aW5nX2FjY2VzcycsXG4gICAgICBpYXQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLFxuICAgIH07XG5cbiAgICAvLyBHZW5lcmF0ZSBKV1Qgd2l0aCAyNC1ob3VyIGV4cGlyYXRpb24gZm9yIG1lZXRpbmcgdG9rZW5zXG4gICAgcmV0dXJuIHRoaXMuand0U2VydmljZS5zaWduKHBheWxvYWQsIHtcbiAgICAgIGV4cGlyZXNJbjogJzI0aCcsXG4gICAgICBpc3N1ZXI6ICdtZW50YXJhLW1lZXRpbmdzJyxcbiAgICAgIHN1YmplY3Q6IHVzZXJJZCxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhbmQgZGVjb2RlIHJvb20gYWNjZXNzIHRva2VuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlUm9vbVRva2VuKFxuICAgIHRva2VuOiBzdHJpbmcsXG4gICk6IHsgdXNlcklkOiBzdHJpbmc7IG1lZXRpbmdJZDogc3RyaW5nOyByb2xlOiBzdHJpbmcgfSB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkZWNvZGVkID0gdGhpcy5qd3RTZXJ2aWNlLnZlcmlmeSh0b2tlbiwge1xuICAgICAgICBpc3N1ZXI6ICdtZW50YXJhLW1lZXRpbmdzJyxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZGVjb2RlZC50eXBlICE9PSAnbWVldGluZ19hY2Nlc3MnKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1c2VySWQ6IGRlY29kZWQuc3ViLFxuICAgICAgICBtZWV0aW5nSWQ6IGRlY29kZWQubWVldGluZ0lkLFxuICAgICAgICByb2xlOiBkZWNvZGVkLnJvbGUsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICBgSW52YWxpZCByb29tIHRva2VuOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgZW1lcmdlbmN5IG1lZXRpbmcgdGVybWluYXRpb25cbiAgICovXG4gIGFzeW5jIGVtZXJnZW5jeVRlcm1pbmF0ZU1lZXRpbmcoXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgcmVhc29uOiBzdHJpbmcsXG4gICAgdGVybWluYXRlZEJ5OiBzdHJpbmcsXG4gICkge1xuICAgIGNvbnN0IG1lZXRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN0YXR1czogJ0NBTkNFTExFRCcsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQWRkIGVtZXJnZW5jeSB0ZXJtaW5hdGlvbiBub3RlXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZ05vdGVzLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlkOiBgbm90ZV8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICBub3RlczogYEVtZXJnZW5jeSB0ZXJtaW5hdGlvbjogJHtyZWFzb259LiBUZXJtaW5hdGVkIGJ5OiAke3Rlcm1pbmF0ZWRCeX1gLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgbmV3IE1lZXRpbmdFbWVyZ2VuY3lUZXJtaW5hdGVkRXZlbnQoe1xuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgdGVybWluYXRlZEJ5LFxuICAgICAgICB0ZXJtaW5hdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHJlYXNvbixcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgYEVtZXJnZW5jeSB0ZXJtaW5hdGlvbiBvZiBtZWV0aW5nICR7bWVldGluZ0lkfTogJHtyZWFzb259YCxcbiAgICApO1xuICAgIHJldHVybiBtZWV0aW5nO1xuICB9XG5cbiAgLy8gPT09PT0gVklERU8gQ0FMTCBJTlRFR1JBVElPTiBNRVRIT0RTID09PT09XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHZpZGVvIHJvb20gZm9yIGEgbWVldGluZ1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlVmlkZW9Sb29tKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGNyZWF0ZVJvb21EdG86IENyZWF0ZVZpZGVvUm9vbUR0byxcbiAgKTogUHJvbWlzZTxWaWRlb1Jvb21SZXNwb25zZT4ge1xuICAgIC8vIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzXG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgaWYgKG1lZXRpbmcuc3RhdHVzICE9PSAnU0NIRURVTEVEJyAmJiBtZWV0aW5nLnN0YXR1cyAhPT0gJ0NPTkZJUk1FRCcpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICAnTWVldGluZyBtdXN0IGJlIHNjaGVkdWxlZCBvciBjb25maXJtZWQgdG8gY3JlYXRlIHZpZGVvIHJvb20nLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgbWVldGluZyBzdGF0dXMgdG8gSU5fUFJPR1JFU1NcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7IHN0YXR1czogJ0lOX1BST0dSRVNTJyB9LFxuICAgIH0pO1xuXG4gICAgLy8gR2VuZXJhdGUgdmlkZW8gcm9vbSBkYXRhIChpbiBwcm9kdWN0aW9uLCBpbnRlZ3JhdGUgd2l0aCBhY3R1YWwgdmlkZW8gc2VydmljZSBsaWtlIFR3aWxpby9ab29tKVxuICAgIGNvbnN0IHJvb21JZCA9IGByb29tXyR7bWVldGluZ0lkfV8ke0RhdGUubm93KCl9YDtcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4obWVldGluZ0lkLCB1c2VySWQsICdob3N0Jyk7XG4gICAgY29uc3QgcGFydGljaXBhbnRUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICAncGFydGljaXBhbnQnLFxuICAgICk7XG5cbiAgICBjb25zdCB2aWRlb1Jvb21SZXNwb25zZTogVmlkZW9Sb29tUmVzcG9uc2UgPSB7XG4gICAgICByb29tSWQsXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICBqb2luVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsXG4gICAgICByb29tVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsIC8vIFJlcGxhY2Ugd2l0aCBhY3R1YWwgdmlkZW8gc2VydmljZSBVUkxcbiAgICAgIGFjY2Vzc1Rva2VuLFxuICAgICAgcGFydGljaXBhbnRUb2tlbixcbiAgICAgIHJvb21Db25maWc6IHtcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiBjcmVhdGVSb29tRHRvLm1heFBhcnRpY2lwYW50cyxcbiAgICAgICAgZW5hYmxlUmVjb3JkaW5nOiBjcmVhdGVSb29tRHRvLmVuYWJsZVJlY29yZGluZyxcbiAgICAgICAgZW5hYmxlQ2hhdDogY3JlYXRlUm9vbUR0by5lbmFibGVDaGF0LFxuICAgICAgICByZWNvcmRpbmdBY3RpdmU6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIHBhcnRpY2lwYW50czogW10sXG4gICAgICByb29tU2V0dGluZ3M6IHtcbiAgICAgICAgbWF4UGFydGljaXBhbnRzOiBjcmVhdGVSb29tRHRvLm1heFBhcnRpY2lwYW50cyB8fCAyLFxuICAgICAgICByZWNvcmRpbmdFbmFibGVkOiBjcmVhdGVSb29tRHRvLnJlY29yZGluZ0VuYWJsZWQgfHwgZmFsc2UsXG4gICAgICAgIHNjcmVlblNoYXJlRW5hYmxlZDogY3JlYXRlUm9vbUR0by5zY3JlZW5TaGFyZUVuYWJsZWQgfHwgdHJ1ZSxcbiAgICAgICAgY2hhdEVuYWJsZWQ6IGNyZWF0ZVJvb21EdG8uY2hhdEVuYWJsZWQgfHwgdHJ1ZSxcbiAgICAgICAgd2FpdGluZ1Jvb21FbmFibGVkOiBjcmVhdGVSb29tRHRvLndhaXRpbmdSb29tRW5hYmxlZCB8fCBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCksIC8vIDQgaG91cnNcbiAgICAgIHBhcnRpY2lwYW50Q291bnQ6IDEsXG4gICAgICBzdGF0dXM6ICd3YWl0aW5nJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG5cbiAgICAvLyBFbWl0IG1lZXRpbmcgc3RhcnRlZCBldmVudFxuICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgbmV3IE1lZXRpbmdTdGFydGVkRXZlbnQoe1xuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBhY3R1YWxTdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIHNjaGVkdWxlZFN0YXJ0VGltZTogbWVldGluZy5zdGFydFRpbWUsXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBWaWRlbyByb29tIGNyZWF0ZWQgZm9yIG1lZXRpbmcgJHttZWV0aW5nSWR9YCk7XG4gICAgcmV0dXJuIHZpZGVvUm9vbVJlc3BvbnNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEpvaW4gYW4gZXhpc3RpbmcgdmlkZW8gcm9vbVxuICAgKi9cbiAgYXN5bmMgam9pblZpZGVvUm9vbShcbiAgICBtZWV0aW5nSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBqb2luUm9vbUR0bzogSm9pblZpZGVvUm9vbUR0byxcbiAgKTogUHJvbWlzZTxWaWRlb1Jvb21SZXNwb25zZT4ge1xuICAgIC8vIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzXG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgaWYgKG1lZXRpbmcuc3RhdHVzICE9PSAnSU5fUFJPR1JFU1MnKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgJ01lZXRpbmcgbXVzdCBiZSBpbiBwcm9ncmVzcyB0byBqb2luIHZpZGVvIHJvb20nLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBwYXJ0aWNpcGFudCBjcmVkZW50aWFsc1xuICAgIGNvbnN0IHJvb21JZCA9IGByb29tXyR7bWVldGluZ0lkfV8ke0RhdGUubm93KCl9YDtcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICBqb2luUm9vbUR0by5yb2xlLFxuICAgICk7XG4gICAgY29uc3QgcGFydGljaXBhbnRUb2tlbiA9IHRoaXMuZ2VuZXJhdGVSb29tVG9rZW4oXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICB1c2VySWQsXG4gICAgICBqb2luUm9vbUR0by5yb2xlLFxuICAgICk7XG5cbiAgICBjb25zdCB2aWRlb1Jvb21SZXNwb25zZTogVmlkZW9Sb29tUmVzcG9uc2UgPSB7XG4gICAgICByb29tSWQsXG4gICAgICBtZWV0aW5nSWQsXG4gICAgICBqb2luVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsXG4gICAgICByb29tVXJsOiBgaHR0cHM6Ly92aWRlby5tZW50YXJhLmFwcC9yb29tLyR7cm9vbUlkfWAsXG4gICAgICBhY2Nlc3NUb2tlbixcbiAgICAgIHBhcnRpY2lwYW50VG9rZW4sXG4gICAgICByb29tQ29uZmlnOiB7XG4gICAgICAgIG1heFBhcnRpY2lwYW50czogMixcbiAgICAgICAgZW5hYmxlUmVjb3JkaW5nOiBmYWxzZSxcbiAgICAgICAgZW5hYmxlQ2hhdDogdHJ1ZSxcbiAgICAgICAgcmVjb3JkaW5nQWN0aXZlOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBwYXJ0aWNpcGFudHM6IFtdLFxuICAgICAgcm9vbVNldHRpbmdzOiB7XG4gICAgICAgIG1heFBhcnRpY2lwYW50czogMixcbiAgICAgICAgcmVjb3JkaW5nRW5hYmxlZDogZmFsc2UsXG4gICAgICAgIHNjcmVlblNoYXJlRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY2hhdEVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHdhaXRpbmdSb29tRW5hYmxlZDogZmFsc2UsXG4gICAgICB9LFxuICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgcGFydGljaXBhbnRDb3VudDogMixcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFVzZXIgJHt1c2VySWR9IGpvaW5lZCB2aWRlbyByb29tIGZvciBtZWV0aW5nICR7bWVldGluZ0lkfWAsXG4gICAgKTtcbiAgICByZXR1cm4gdmlkZW9Sb29tUmVzcG9uc2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZpZGVvIGNhbGwgc3RhdHVzXG4gICAqL1xuICBhc3luYyBnZXRWaWRlb0NhbGxTdGF0dXMoXG4gICAgbWVldGluZ0lkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8VmlkZW9DYWxsU3RhdHVzPiB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICAvLyBNb2NrIHZpZGVvIGNhbGwgc3RhdHVzIChpbiBwcm9kdWN0aW9uLCBmZXRjaCBmcm9tIGFjdHVhbCB2aWRlbyBzZXJ2aWNlKVxuICAgIGNvbnN0IHZpZGVvQ2FsbFN0YXR1czogVmlkZW9DYWxsU3RhdHVzID0ge1xuICAgICAgbWVldGluZ0lkLFxuICAgICAgcm9vbUlkOiBgcm9vbV8ke21lZXRpbmdJZH1gLFxuICAgICAgaXNBY3RpdmU6IG1lZXRpbmcuc3RhdHVzID09PSAnSU5fUFJPR1JFU1MnLFxuICAgICAgcGFydGljaXBhbnRDb3VudDogMiwgLy8gQ2xpZW50ICsgVGhlcmFwaXN0XG4gICAgICBzdGF0dXM6IG1lZXRpbmcuc3RhdHVzID09PSAnSU5fUFJPR1JFU1MnID8gJ2FjdGl2ZScgOiAnd2FpdGluZycsXG4gICAgICBwYXJ0aWNpcGFudHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgICBpZDogbWVldGluZy5jbGllbnRJZCxcbiAgICAgICAgICBuYW1lOiAnQ2xpZW50JywgLy8gSW4gcHJvZHVjdGlvbiwgZmV0Y2ggYWN0dWFsIHVzZXIgbmFtZXNcbiAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICBqb2luZWRBdDogbWVldGluZy5zdGFydFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBpc0hvc3Q6IGZhbHNlLFxuICAgICAgICAgIGF1ZGlvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICB2aWRlb0VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Nvbm5lY3RlZCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgICAgaWQ6IG1lZXRpbmcudGhlcmFwaXN0SWQsXG4gICAgICAgICAgbmFtZTogJ1RoZXJhcGlzdCcsXG4gICAgICAgICAgcm9sZTogJ3RoZXJhcGlzdCcsXG4gICAgICAgICAgam9pbmVkQXQ6IG1lZXRpbmcuc3RhcnRUaW1lLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgaXNIb3N0OiB0cnVlLFxuICAgICAgICAgIGF1ZGlvRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICB2aWRlb0VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgY29ubmVjdGlvblN0YXR1czogJ2Nvbm5lY3RlZCcsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgc3RhcnRlZEF0OiBtZWV0aW5nLnN0YXJ0VGltZS50b0lTT1N0cmluZygpLFxuICAgICAgZW5kZWRBdDpcbiAgICAgICAgbWVldGluZy5zdGF0dXMgPT09ICdDT01QTEVURUQnXG4gICAgICAgICAgPyBuZXcgRGF0ZShcbiAgICAgICAgICAgICAgbWVldGluZy5zdGFydFRpbWUuZ2V0VGltZSgpICsgbWVldGluZy5kdXJhdGlvbiAqIDYwMDAwLFxuICAgICAgICAgICAgKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBkdXJhdGlvbjogbWVldGluZy5zdGF0dXMgPT09ICdDT01QTEVURUQnID8gbWVldGluZy5kdXJhdGlvbiA6IHVuZGVmaW5lZCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHZpZGVvQ2FsbFN0YXR1cztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmQgdmlkZW8gY2FsbFxuICAgKi9cbiAgYXN5bmMgZW5kVmlkZW9DYWxsKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGVuZENhbGxEdG86IEVuZFZpZGVvQ2FsbER0byxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gVmFsaWRhdGUgbWVldGluZyBhY2Nlc3NcbiAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdGhpcy5nZXRNZWV0aW5nQnlJZChtZWV0aW5nSWQsIHVzZXJJZCk7XG5cbiAgICAvLyBVcGRhdGUgbWVldGluZyBzdGF0dXMgdG8gY29tcGxldGVkXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmdJZCB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFNhdmUgc2Vzc2lvbiBzdW1tYXJ5IGlmIHByb3ZpZGVkXG4gICAgaWYgKGVuZENhbGxEdG8uZHVyYXRpb24gfHwgZW5kQ2FsbER0by5yZWFzb24gfHwgZW5kQ2FsbER0by5wYXJ0aWNpcGFudEZlZWRiYWNrKSB7XG4gICAgICBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nTm90ZXMuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGlkOiBgbm90ZXNfJHttZWV0aW5nSWR9XyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgIG1lZXRpbmdJZCxcbiAgICAgICAgICBub3RlczogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgc2Vzc2lvblR5cGU6ICdSRUdVTEFSX1RIRVJBUFknLFxuICAgICAgICAgICAgZHVyYXRpb246IGVuZENhbGxEdG8uZHVyYXRpb24sXG4gICAgICAgICAgICBlbmRSZWFzb246IGVuZENhbGxEdG8ucmVhc29uLFxuICAgICAgICAgICAgYXVkaW9RdWFsaXR5OiBlbmRDYWxsRHRvLnBhcnRpY2lwYW50RmVlZGJhY2s/LmF1ZGlvUXVhbGl0eSxcbiAgICAgICAgICAgIHZpZGVvUXVhbGl0eTogZW5kQ2FsbER0by5wYXJ0aWNpcGFudEZlZWRiYWNrPy52aWRlb1F1YWxpdHksXG4gICAgICAgICAgICBvdmVyYWxsRXhwZXJpZW5jZTogZW5kQ2FsbER0by5wYXJ0aWNpcGFudEZlZWRiYWNrPy5vdmVyYWxsRXhwZXJpZW5jZSxcbiAgICAgICAgICAgIGlzc3VlczogZW5kQ2FsbER0by5wYXJ0aWNpcGFudEZlZWRiYWNrPy5pc3N1ZXMsXG4gICAgICAgICAgICBwbGF0Zm9ybTogJ3ZpZGVvJyxcbiAgICAgICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEVtaXQgbWVldGluZyBjb21wbGV0ZWQgZXZlbnRcbiAgICB2b2lkIHRoaXMuZXZlbnRCdXMuZW1pdChcbiAgICAgIG5ldyBNZWV0aW5nQ29tcGxldGVkRXZlbnQoe1xuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIGNsaWVudElkOiBtZWV0aW5nLmNsaWVudElkLFxuICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgY29tcGxldGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIGFjdHVhbER1cmF0aW9uOiBlbmRDYWxsRHRvLmR1cmF0aW9uIHx8IG1lZXRpbmcuZHVyYXRpb24sXG4gICAgICAgIHNjaGVkdWxlZER1cmF0aW9uOiBtZWV0aW5nLmR1cmF0aW9uLFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgIGBWaWRlbyBjYWxsIGVuZGVkIGZvciBtZWV0aW5nICR7bWVldGluZ0lkfTogJHtlbmRDYWxsRHRvLnJlYXNvbn1gLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlZCBtZXRob2QgdG8gdXNlIG5ldyBEVE9zXG4gICAqL1xuICBhc3luYyB1cGRhdGVNZWV0aW5nU3RhdHVzKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVwZGF0ZVN0YXR1c0R0bzogVXBkYXRlTWVldGluZ1N0YXR1c0R0byxcbiAgKSB7XG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgY29uc3QgdXBkYXRlZE1lZXRpbmcgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogbWVldGluZ0lkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN0YXR1czogdXBkYXRlU3RhdHVzRHRvLnN0YXR1cy50b1VwcGVyQ2FzZSgpIGFzIGFueSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBFbWl0IGFwcHJvcHJpYXRlIGV2ZW50cyBiYXNlZCBvbiBzdGF0dXNcbiAgICBzd2l0Y2ggKHVwZGF0ZVN0YXR1c0R0by5zdGF0dXMpIHtcbiAgICAgIGNhc2UgJ2NvbmZpcm1lZCc6XG4gICAgICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgICAgIG5ldyBNZWV0aW5nQ29uZmlybWVkRXZlbnQoe1xuICAgICAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICAgICAgY2xpZW50SWQ6IG1lZXRpbmcuY2xpZW50SWQsXG4gICAgICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgICAgIGNvbmZpcm1lZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgc3RhcnRUaW1lOiBtZWV0aW5nLnN0YXJ0VGltZSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBtZWV0aW5nLmR1cmF0aW9uLFxuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NhbmNlbGxlZCc6XG4gICAgICAgIHZvaWQgdGhpcy5ldmVudEJ1cy5lbWl0KFxuICAgICAgICAgIG5ldyBNZWV0aW5nQ2FuY2VsbGVkRXZlbnQoe1xuICAgICAgICAgICAgbWVldGluZ0lkLFxuICAgICAgICAgICAgY2xpZW50SWQ6IG1lZXRpbmcuY2xpZW50SWQsXG4gICAgICAgICAgICB0aGVyYXBpc3RJZDogbWVldGluZy50aGVyYXBpc3RJZCxcbiAgICAgICAgICAgIGNhbmNlbGxlZEJ5OiB1c2VySWQsXG4gICAgICAgICAgICBjYW5jZWxsZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogdXBkYXRlU3RhdHVzRHRvLnJlYXNvbixcbiAgICAgICAgICAgIG9yaWdpbmFsU3RhcnRUaW1lOiBtZWV0aW5nLnN0YXJ0VGltZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYE1lZXRpbmcgJHttZWV0aW5nSWR9IHN0YXR1cyB1cGRhdGVkIHRvICR7dXBkYXRlU3RhdHVzRHRvLnN0YXR1c31gLFxuICAgICk7XG4gICAgcmV0dXJuIHVwZGF0ZWRNZWV0aW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZWQgbWV0aG9kIHRvIHVzZSBuZXcgRFRPc1xuICAgKi9cbiAgYXN5bmMgc2F2ZU1lZXRpbmdTZXNzaW9uKFxuICAgIG1lZXRpbmdJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHNlc3Npb25EYXRhOiBTYXZlTWVldGluZ1Nlc3Npb25EdG8sXG4gICkge1xuICAgIC8vIFZhbGlkYXRlIG1lZXRpbmcgYWNjZXNzXG4gICAgY29uc3QgbWVldGluZyA9IGF3YWl0IHRoaXMuZ2V0TWVldGluZ0J5SWQobWVldGluZ0lkLCB1c2VySWQpO1xuXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmdOb3Rlcy5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBpZDogYHNlc3Npb25fJHttZWV0aW5nSWR9XyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICBtZWV0aW5nSWQsXG4gICAgICAgIG5vdGVzOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc2Vzc2lvblR5cGU6ICdSRUdVTEFSX1RIRVJBUFknLFxuICAgICAgICAgIHN0YXJ0VGltZTogc2Vzc2lvbkRhdGEuc2Vzc2lvbkRhdGE/LnN0YXJ0ZWRBdCA/IG5ldyBEYXRlKHNlc3Npb25EYXRhLnNlc3Npb25EYXRhLnN0YXJ0ZWRBdCkudG9JU09TdHJpbmcoKSA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBlbmRUaW1lOiBzZXNzaW9uRGF0YS5zZXNzaW9uRGF0YT8uZW5kZWRBdCA/IG5ldyBEYXRlKHNlc3Npb25EYXRhLnNlc3Npb25EYXRhLmVuZGVkQXQpLnRvSVNPU3RyaW5nKCkgOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgZHVyYXRpb246IHNlc3Npb25EYXRhLnNlc3Npb25EYXRhPy5kdXJhdGlvbiB8fCBzZXNzaW9uRGF0YS5kdXJhdGlvbixcbiAgICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgICAgIHBsYXRmb3JtOiAndmlkZW8nLFxuICAgICAgICAgIHNlc3Npb25Ob3Rlczogc2Vzc2lvbkRhdGEuc2Vzc2lvbk5vdGVzLFxuICAgICAgICAgIGNsaWVudFByb2dyZXNzOiBzZXNzaW9uRGF0YS5jbGllbnRQcm9ncmVzcyxcbiAgICAgICAgICBmb2xsb3dVcEFjdGlvbnM6IHNlc3Npb25EYXRhLmZvbGxvd1VwQWN0aW9ucyxcbiAgICAgICAgICBxdWFsaXR5OiBzZXNzaW9uRGF0YS5zZXNzaW9uRGF0YT8ucXVhbGl0eSxcbiAgICAgICAgICBpc3N1ZXM6IHNlc3Npb25EYXRhLnNlc3Npb25EYXRhPy5pc3N1ZXMgfHwgW10sXG4gICAgICAgIH0pLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMubG9nZ2VyLmxvZyhgU2Vzc2lvbiBkYXRhIHNhdmVkIGZvciBtZWV0aW5nICR7bWVldGluZ0lkfWApO1xuICAgIHJldHVybiBzZXNzaW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB1c2VyJ3MgY29tcGxldGVkIG1lZXRpbmdzXG4gICAqL1xuICBhc3luYyBnZXRDb21wbGV0ZWRNZWV0aW5ncyh1c2VySWQ6IHN0cmluZywgbGltaXQgPSAxMCkge1xuICAgIC8vIEZpcnN0IHZhbGlkYXRlIHRoYXQgdXNlciBleGlzdHNcbiAgICBjb25zdCB1c2VyRXhpc3RzID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1c2VyRXhpc3RzKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGBVc2VyIG5vdCBmb3VuZDogJHt1c2VySWR9YCk7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdXNlciBleGlzdHMgYnV0IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybiBlbXB0eSBtZWV0aW5nc1xuICAgIGlmICghdXNlckV4aXN0cy5jbGllbnQgJiYgIXVzZXJFeGlzdHMudGhlcmFwaXN0KSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYFVzZXIgJHt1c2VySWR9IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybmluZyBlbXB0eSBtZWV0aW5nc2ApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBtZWV0aW5ncyA9IGF3YWl0IHRoaXMucHJpc21hLm1lZXRpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgICAgICBzdGF0dXM6ICdDT01QTEVURUQnLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHRoaXMuZ2V0TWVldGluZ0luY2x1ZGVPcHRpb25zKCksXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogJ2Rlc2MnIH0sXG4gICAgICB0YWtlOiBsaW1pdCxcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybU1lZXRpbmdzKG1lZXRpbmdzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlcidzIGNhbmNlbGxlZCBtZWV0aW5nc1xuICAgKi9cbiAgYXN5bmMgZ2V0Q2FuY2VsbGVkTWVldGluZ3ModXNlcklkOiBzdHJpbmcsIGxpbWl0ID0gMTApIHtcbiAgICAvLyBGaXJzdCB2YWxpZGF0ZSB0aGF0IHVzZXIgZXhpc3RzXG4gICAgY29uc3QgdXNlckV4aXN0cyA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGNsaWVudDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgICAgdGhlcmFwaXN0OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlckV4aXN0cykge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihgVXNlciBub3QgZm91bmQ6ICR7dXNlcklkfWApO1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdVc2VyIG5vdCBmb3VuZCcpO1xuICAgIH1cblxuICAgIC8vIElmIHVzZXIgZXhpc3RzIGJ1dCBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm4gZW1wdHkgbWVldGluZ3NcbiAgICBpZiAoIXVzZXJFeGlzdHMuY2xpZW50ICYmICF1c2VyRXhpc3RzLnRoZXJhcGlzdCkge1xuICAgICAgdGhpcy5sb2dnZXIubG9nKGBVc2VyICR7dXNlcklkfSBpcyBub3QgYSBjbGllbnQgb3IgdGhlcmFwaXN0LCByZXR1cm5pbmcgZW1wdHkgbWVldGluZ3NgKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIE9SOiBbeyBjbGllbnRJZDogdXNlcklkIH0sIHsgdGhlcmFwaXN0SWQ6IHVzZXJJZCB9XSxcbiAgICAgICAgc3RhdHVzOiB7IGluOiBbJ0NBTkNFTExFRCcsICdOT19TSE9XJ10gfSxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB0aGlzLmdldE1lZXRpbmdJbmNsdWRlT3B0aW9ucygpLFxuICAgICAgb3JkZXJCeTogeyBzdGFydFRpbWU6ICdkZXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHVzZXIncyBpbi1wcm9ncmVzcyBtZWV0aW5nc1xuICAgKi9cbiAgYXN5bmMgZ2V0SW5Qcm9ncmVzc01lZXRpbmdzKHVzZXJJZDogc3RyaW5nLCBsaW1pdCA9IDEwKSB7XG4gICAgLy8gRmlyc3QgdmFsaWRhdGUgdGhhdCB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBjbGllbnQ6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICAgIHRoZXJhcGlzdDogeyBzZWxlY3Q6IHsgdXNlcklkOiB0cnVlIH0gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFVzZXIgbm90IGZvdW5kOiAke3VzZXJJZH1gKTtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG5cbiAgICAvLyBJZiB1c2VyIGV4aXN0cyBidXQgaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuIGVtcHR5IG1lZXRpbmdzXG4gICAgaWYgKCF1c2VyRXhpc3RzLmNsaWVudCAmJiAhdXNlckV4aXN0cy50aGVyYXBpc3QpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgVXNlciAke3VzZXJJZH0gaXMgbm90IGEgY2xpZW50IG9yIHRoZXJhcGlzdCwgcmV0dXJuaW5nIGVtcHR5IG1lZXRpbmdzYCk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IG1lZXRpbmdzID0gYXdhaXQgdGhpcy5wcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBPUjogW3sgY2xpZW50SWQ6IHVzZXJJZCB9LCB7IHRoZXJhcGlzdElkOiB1c2VySWQgfV0sXG4gICAgICAgIHN0YXR1czogJ0lOX1BST0dSRVNTJyxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB0aGlzLmdldE1lZXRpbmdJbmNsdWRlT3B0aW9ucygpLFxuICAgICAgb3JkZXJCeTogeyBzdGFydFRpbWU6ICdkZXNjJyB9LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBtZWV0aW5ncyB3aXRoIGZpbHRlcmluZyBvcHRpb25zXG4gICAqL1xuICBhc3luYyBnZXRBbGxNZWV0aW5ncyh1c2VySWQ6IHN0cmluZywgcXVlcnlPcHRpb25zOiB7XG4gICAgc3RhdHVzPzogc3RyaW5nO1xuICAgIHR5cGU/OiBzdHJpbmc7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIGRhdGVGcm9tPzogc3RyaW5nO1xuICAgIGRhdGVUbz86IHN0cmluZztcbiAgfSkge1xuICAgIC8vIEZpcnN0IHZhbGlkYXRlIHRoYXQgdXNlciBleGlzdHNcbiAgICBjb25zdCB1c2VyRXhpc3RzID0gYXdhaXQgdGhpcy5wcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgY2xpZW50OiB7IHNlbGVjdDogeyB1c2VySWQ6IHRydWUgfSB9LFxuICAgICAgICB0aGVyYXBpc3Q6IHsgc2VsZWN0OiB7IHVzZXJJZDogdHJ1ZSB9IH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCF1c2VyRXhpc3RzKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGBVc2VyIG5vdCBmb3VuZDogJHt1c2VySWR9YCk7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdXNlciBleGlzdHMgYnV0IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybiBlbXB0eSBtZWV0aW5nc1xuICAgIGlmICghdXNlckV4aXN0cy5jbGllbnQgJiYgIXVzZXJFeGlzdHMudGhlcmFwaXN0KSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYFVzZXIgJHt1c2VySWR9IGlzIG5vdCBhIGNsaWVudCBvciB0aGVyYXBpc3QsIHJldHVybmluZyBlbXB0eSBtZWV0aW5nc2ApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB3aGVyZUNsYXVzZTogYW55ID0ge1xuICAgICAgT1I6IFt7IGNsaWVudElkOiB1c2VySWQgfSwgeyB0aGVyYXBpc3RJZDogdXNlcklkIH1dLFxuICAgIH07XG5cbiAgICAvLyBBZGQgc3RhdHVzIGZpbHRlclxuICAgIGlmIChxdWVyeU9wdGlvbnMuc3RhdHVzKSB7XG4gICAgICB3aGVyZUNsYXVzZS5zdGF0dXMgPSBxdWVyeU9wdGlvbnMuc3RhdHVzLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGRhdGUgcmFuZ2UgZmlsdGVyXG4gICAgaWYgKHF1ZXJ5T3B0aW9ucy5kYXRlRnJvbSB8fCBxdWVyeU9wdGlvbnMuZGF0ZVRvKSB7XG4gICAgICB3aGVyZUNsYXVzZS5zdGFydFRpbWUgPSB7fTtcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMuZGF0ZUZyb20pIHtcbiAgICAgICAgd2hlcmVDbGF1c2Uuc3RhcnRUaW1lLmd0ZSA9IG5ldyBEYXRlKHF1ZXJ5T3B0aW9ucy5kYXRlRnJvbSk7XG4gICAgICB9XG4gICAgICBpZiAocXVlcnlPcHRpb25zLmRhdGVUbykge1xuICAgICAgICB3aGVyZUNsYXVzZS5zdGFydFRpbWUubHRlID0gbmV3IERhdGUocXVlcnlPcHRpb25zLmRhdGVUbyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCB0aGlzLnByaXNtYS5tZWV0aW5nLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiB3aGVyZUNsYXVzZSxcbiAgICAgIGluY2x1ZGU6IHRoaXMuZ2V0TWVldGluZ0luY2x1ZGVPcHRpb25zKCksXG4gICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogJ2Rlc2MnIH0sXG4gICAgICB0YWtlOiBxdWVyeU9wdGlvbnMubGltaXQgfHwgMjAsXG4gICAgICBza2lwOiBxdWVyeU9wdGlvbnMub2Zmc2V0IHx8IDAsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NZWV0aW5ncyhtZWV0aW5ncyk7XG4gIH1cblxuXG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgdG8gZ2V0IGNvbnNpc3RlbnQgbWVldGluZyBpbmNsdWRlIG9wdGlvbnNcbiAgICovXG4gIHByaXZhdGUgZ2V0TWVldGluZ0luY2x1ZGVPcHRpb25zKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjbGllbnQ6IHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdGhlcmFwaXN0OiB7XG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgdG8gdHJhbnNmb3JtIG1lZXRpbmdzIGRhdGFcbiAgICovXG4gIHByaXZhdGUgdHJhbnNmb3JtTWVldGluZ3MobWVldGluZ3M6IGFueVtdKSB7XG4gICAgcmV0dXJuIG1lZXRpbmdzLm1hcChtZWV0aW5nID0+ICh7XG4gICAgICBpZDogbWVldGluZy5pZCxcbiAgICAgIHRpdGxlOiBtZWV0aW5nLnRpdGxlLFxuICAgICAgZGVzY3JpcHRpb246IG1lZXRpbmcuZGVzY3JpcHRpb24sXG4gICAgICBzdGF0dXM6IG1lZXRpbmcuc3RhdHVzLFxuICAgICAgc3RhcnRUaW1lOiBtZWV0aW5nLnN0YXJ0VGltZSxcbiAgICAgIGVuZFRpbWU6IG1lZXRpbmcuZW5kVGltZSxcbiAgICAgIGR1cmF0aW9uOiBtZWV0aW5nLmR1cmF0aW9uLFxuICAgICAgbWVldGluZ1R5cGU6IG1lZXRpbmcubWVldGluZ1R5cGUsXG4gICAgICBtZWV0aW5nVXJsOiBtZWV0aW5nLm1lZXRpbmdVcmwsXG4gICAgICBjbGllbnQ6IG1lZXRpbmcuY2xpZW50LFxuICAgICAgdGhlcmFwaXN0OiBtZWV0aW5nLnRoZXJhcGlzdCxcbiAgICAgIGNyZWF0ZWRBdDogbWVldGluZy5jcmVhdGVkQXQsXG4gICAgICB1cGRhdGVkQXQ6IG1lZXRpbmcudXBkYXRlZEF0LFxuICAgIH0pKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9