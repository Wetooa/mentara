502c824d141c0927d46ca48b5a9e15b1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const message_encryption_service_1 = require("./message-encryption.service");
const common_1 = require("@nestjs/common");
const crypto = require("crypto");
describe('MessageEncryptionService', () => {
    let service;
    let originalEnv;
    beforeEach(async () => {
        // Save original environment
        originalEnv = process.env;
        // Set a test encryption key
        process.env.MESSAGE_ENCRYPTION_KEY = crypto.randomBytes(32).toString('hex');
        const module = await testing_1.Test.createTestingModule({
            providers: [message_encryption_service_1.MessageEncryptionService],
        }).compile();
        service = module.get(message_encryption_service_1.MessageEncryptionService);
    });
    afterEach(() => {
        // Restore original environment
        process.env = originalEnv;
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('Service Initialization', () => {
        it('should initialize encryption keys on construction', () => {
            expect(service.isEncryptionAvailable()).toBe(true);
            const status = service.getEncryptionStatus();
            expect(status.keyCount).toBe(3);
            expect(status.availableKeyTypes).toEqual(['default', 'therapy', 'support']);
            expect(status.algorithm).toBe('aes-256-gcm');
            expect(status.isConfigured).toBe(true);
        });
        it('should initialize with random key when no environment key is set', () => {
            delete process.env.MESSAGE_ENCRYPTION_KEY;
            // Create a new service instance
            const newService = new message_encryption_service_1.MessageEncryptionService();
            expect(newService.isEncryptionAvailable()).toBe(true);
            expect(newService.getEncryptionStatus().keyCount).toBe(3);
        });
        it('should log successful key initialization', () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            // Create a new service instance to trigger initialization
            new message_encryption_service_1.MessageEncryptionService();
            expect(loggerSpy).toHaveBeenCalledWith('Message encryption keys initialized');
        });
    });
    describe('encryptMessage', () => {
        it('should encrypt a message with default key', async () => {
            const testMessage = 'Hello, this is a test message';
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
            const encrypted = await service.encryptMessage(testMessage);
            expect(encrypted).toBeDefined();
            expect(encrypted.encryptedContent).toBeTruthy();
            expect(encrypted.iv).toBeTruthy();
            expect(encrypted.authTag).toBeTruthy();
            expect(encrypted.keyId).toBe('default');
            expect(encrypted.encryptedContent).not.toBe(testMessage);
            expect(loggerSpy).toHaveBeenCalledWith(`Message encrypted with default key (length: ${testMessage.length} chars)`);
        });
        it('should encrypt a message with therapy key', async () => {
            const testMessage = 'Confidential therapy session notes';
            const encrypted = await service.encryptMessage(testMessage, 'therapy');
            expect(encrypted.keyId).toBe('therapy');
            expect(encrypted.encryptedContent).toBeTruthy();
            expect(encrypted.iv).toBeTruthy();
            expect(encrypted.authTag).toBeTruthy();
        });
        it('should encrypt a message with support key', async () => {
            const testMessage = 'Support conversation content';
            const encrypted = await service.encryptMessage(testMessage, 'support');
            expect(encrypted.keyId).toBe('support');
            expect(encrypted.encryptedContent).toBeTruthy();
            expect(encrypted.iv).toBeTruthy();
            expect(encrypted.authTag).toBeTruthy();
        });
        it('should use default key when invalid conversation type is provided', async () => {
            const testMessage = 'Test message';
            const encrypted = await service.encryptMessage(testMessage, 'invalid');
            expect(encrypted.keyId).toBe('invalid');
            expect(encrypted.encryptedContent).toBeTruthy();
        });
        it('should generate unique IV for each encryption', async () => {
            const testMessage = 'Same message content';
            const encrypted1 = await service.encryptMessage(testMessage);
            const encrypted2 = await service.encryptMessage(testMessage);
            expect(encrypted1.iv).not.toBe(encrypted2.iv);
            expect(encrypted1.encryptedContent).not.toBe(encrypted2.encryptedContent);
            expect(encrypted1.authTag).not.toBe(encrypted2.authTag);
        });
        it('should encrypt empty string', async () => {
            const encrypted = await service.encryptMessage('');
            expect(encrypted).toBeDefined();
            expect(encrypted.encryptedContent).toBeTruthy();
            expect(encrypted.iv).toBeTruthy();
            expect(encrypted.authTag).toBeTruthy();
        });
        it('should encrypt very long messages', async () => {
            const longMessage = 'A'.repeat(10000);
            const encrypted = await service.encryptMessage(longMessage);
            expect(encrypted).toBeDefined();
            expect(encrypted.encryptedContent).toBeTruthy();
            expect(encrypted.iv).toBeTruthy();
            expect(encrypted.authTag).toBeTruthy();
        });
        it('should encrypt unicode characters', async () => {
            const unicodeMessage = 'Test ðŸš€ emoji and special chars: Ã¤Ã¶Ã¼ Ã± ä¸­æ–‡';
            const encrypted = await service.encryptMessage(unicodeMessage);
            expect(encrypted).toBeDefined();
            expect(encrypted.encryptedContent).toBeTruthy();
        });
        it('should handle encryption errors gracefully', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            // Mock crypto.createCipheriv to throw an error
            const originalCreateCipheriv = crypto.createCipheriv;
            jest.spyOn(crypto, 'createCipheriv').mockImplementation(() => {
                throw new Error('Crypto error');
            });
            await expect(service.encryptMessage('test')).rejects.toThrow('Failed to encrypt message');
            expect(loggerSpy).toHaveBeenCalledWith('Message encryption failed:', expect.any(Error));
            // Restore the original function
            crypto.createCipheriv = originalCreateCipheriv;
        });
    });
    describe('decryptMessage', () => {
        it('should decrypt a message encrypted with default key', async () => {
            const testMessage = 'Hello, this is a test message';
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'debug');
            const encrypted = await service.encryptMessage(testMessage);
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe(testMessage);
            expect(decrypted.decryptedAt).toBeInstanceOf(Date);
            expect(loggerSpy).toHaveBeenCalledWith(`Message decrypted with default key (length: ${testMessage.length} chars)`);
        });
        it('should decrypt a message encrypted with therapy key', async () => {
            const testMessage = 'Confidential therapy session notes';
            const encrypted = await service.encryptMessage(testMessage, 'therapy');
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe(testMessage);
            expect(decrypted.decryptedAt).toBeInstanceOf(Date);
        });
        it('should decrypt a message encrypted with support key', async () => {
            const testMessage = 'Support conversation content';
            const encrypted = await service.encryptMessage(testMessage, 'support');
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe(testMessage);
            expect(decrypted.decryptedAt).toBeInstanceOf(Date);
        });
        it('should decrypt empty string', async () => {
            const encrypted = await service.encryptMessage('');
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe('');
            expect(decrypted.decryptedAt).toBeInstanceOf(Date);
        });
        it('should decrypt very long messages', async () => {
            const longMessage = 'A'.repeat(10000);
            const encrypted = await service.encryptMessage(longMessage);
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe(longMessage);
        });
        it('should decrypt unicode characters', async () => {
            const unicodeMessage = 'Test ðŸš€ emoji and special chars: Ã¤Ã¶Ã¼ Ã± ä¸­æ–‡';
            const encrypted = await service.encryptMessage(unicodeMessage);
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe(unicodeMessage);
        });
        it('should fail to decrypt with tampered encrypted content', async () => {
            const testMessage = 'Test message';
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            const encrypted = await service.encryptMessage(testMessage);
            // Tamper with the encrypted content
            encrypted.encryptedContent = encrypted.encryptedContent.slice(0, -2) + '00';
            await expect(service.decryptMessage(encrypted)).rejects.toThrow('Failed to decrypt message - content may be corrupted');
            expect(loggerSpy).toHaveBeenCalledWith('Message decryption failed:', expect.any(Error));
        });
        it('should fail to decrypt with tampered IV', async () => {
            const testMessage = 'Test message';
            const encrypted = await service.encryptMessage(testMessage);
            // Tamper with the IV
            encrypted.iv = encrypted.iv.slice(0, -2) + '00';
            await expect(service.decryptMessage(encrypted)).rejects.toThrow('Failed to decrypt message - content may be corrupted');
        });
        it('should fail to decrypt with tampered auth tag', async () => {
            const testMessage = 'Test message';
            const encrypted = await service.encryptMessage(testMessage);
            // Tamper with the auth tag
            encrypted.authTag = encrypted.authTag.slice(0, -2) + '00';
            await expect(service.decryptMessage(encrypted)).rejects.toThrow('Failed to decrypt message - content may be corrupted');
        });
        it('should use default key when keyId is not found', async () => {
            const testMessage = 'Test message';
            const encrypted = await service.encryptMessage(testMessage);
            // Use a non-existent key ID
            encrypted.keyId = 'nonexistent';
            const decrypted = await service.decryptMessage(encrypted);
            expect(decrypted.content).toBe(testMessage);
        });
        it('should fail to decrypt with invalid hex values', async () => {
            const invalidEncrypted = {
                encryptedContent: 'invalid-hex',
                iv: 'invalid-hex',
                authTag: 'invalid-hex',
                keyId: 'default',
            };
            await expect(service.decryptMessage(invalidEncrypted)).rejects.toThrow('Failed to decrypt message - content may be corrupted');
        });
    });
    describe('getConversationType', () => {
        it('should return therapy for therapist-client conversations', () => {
            const participants = [
                { role: 'therapist' },
                { role: 'client' }
            ];
            const type = service.getConversationType(participants);
            expect(type).toBe('therapy');
        });
        it('should return therapy for conversations with therapist, client, and others', () => {
            const participants = [
                { role: 'therapist' },
                { role: 'client' },
                { role: 'moderator' }
            ];
            const type = service.getConversationType(participants);
            expect(type).toBe('therapy');
        });
        it('should return support for conversations with moderator (but no therapy)', () => {
            const participants = [
                { role: 'moderator' },
                { role: 'client' }
            ];
            const type = service.getConversationType(participants);
            expect(type).toBe('support');
        });
        it('should return support for conversations with only moderator', () => {
            const participants = [
                { role: 'moderator' }
            ];
            const type = service.getConversationType(participants);
            expect(type).toBe('support');
        });
        it('should return default for regular user conversations', () => {
            const participants = [
                { role: 'client' },
                { role: 'client' }
            ];
            const type = service.getConversationType(participants);
            expect(type).toBe('default');
        });
        it('should return default for conversations with unknown roles', () => {
            const participants = [
                { role: 'unknown' },
                { role: 'other' }
            ];
            const type = service.getConversationType(participants);
            expect(type).toBe('default');
        });
        it('should return default for empty participants array', () => {
            const participants = [];
            const type = service.getConversationType(participants);
            expect(type).toBe('default');
        });
    });
    describe('validateMessageIntegrity', () => {
        it('should validate integrity of valid encrypted message', async () => {
            const testMessage = 'Test message for integrity validation';
            const encrypted = await service.encryptMessage(testMessage);
            const isValid = await service.validateMessageIntegrity(encrypted);
            expect(isValid).toBe(true);
        });
        it('should detect tampered encrypted content', async () => {
            const testMessage = 'Test message';
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'warn');
            const encrypted = await service.encryptMessage(testMessage);
            // Tamper with the encrypted content
            encrypted.encryptedContent = encrypted.encryptedContent.slice(0, -2) + '00';
            const isValid = await service.validateMessageIntegrity(encrypted);
            expect(isValid).toBe(false);
            expect(loggerSpy).toHaveBeenCalledWith('Message integrity validation failed:', expect.any(Error));
        });
        it('should detect tampered IV', async () => {
            const testMessage = 'Test message';
            const encrypted = await service.encryptMessage(testMessage);
            // Tamper with the IV
            encrypted.iv = encrypted.iv.slice(0, -2) + '00';
            const isValid = await service.validateMessageIntegrity(encrypted);
            expect(isValid).toBe(false);
        });
        it('should detect tampered auth tag', async () => {
            const testMessage = 'Test message';
            const encrypted = await service.encryptMessage(testMessage);
            // Tamper with the auth tag
            encrypted.authTag = encrypted.authTag.slice(0, -2) + '00';
            const isValid = await service.validateMessageIntegrity(encrypted);
            expect(isValid).toBe(false);
        });
        it('should handle invalid hex values gracefully', async () => {
            const invalidEncrypted = {
                encryptedContent: 'invalid-hex',
                iv: 'invalid-hex',
                authTag: 'invalid-hex',
                keyId: 'default',
            };
            const isValid = await service.validateMessageIntegrity(invalidEncrypted);
            expect(isValid).toBe(false);
        });
    });
    describe('batchEncryptMessages', () => {
        it('should encrypt multiple messages successfully', async () => {
            const messages = [
                { content: 'Message 1' },
                { content: 'Message 2', conversationType: 'therapy' },
                { content: 'Message 3', conversationType: 'support' },
            ];
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            const results = await service.batchEncryptMessages(messages);
            expect(results).toHaveLength(3);
            expect(results[0].keyId).toBe('default');
            expect(results[1].keyId).toBe('therapy');
            expect(results[2].keyId).toBe('support');
            expect(results.every(r => r.encryptedContent !== '')).toBe(true);
            expect(loggerSpy).toHaveBeenCalledWith('Batch encrypted 3 messages');
        });
        it('should handle empty messages array', async () => {
            const messages = [];
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'log');
            const results = await service.batchEncryptMessages(messages);
            expect(results).toHaveLength(0);
            expect(loggerSpy).toHaveBeenCalledWith('Batch encrypted 0 messages');
        });
        it('should handle encryption failures gracefully', async () => {
            const messages = [
                { content: 'Valid message' },
                { content: 'Message that will fail' },
            ];
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'error');
            // Mock the service to fail on the second message
            const originalEncrypt = service.encryptMessage;
            jest.spyOn(service, 'encryptMessage').mockImplementation(async (content, type) => {
                if (content === 'Message that will fail') {
                    throw new Error('Encryption failed');
                }
                return originalEncrypt.call(service, content, type);
            });
            const results = await service.batchEncryptMessages(messages);
            expect(results).toHaveLength(2);
            expect(results[0].encryptedContent).toBeTruthy();
            expect(results[1].encryptedContent).toBe('');
            expect(results[1].keyId).toBe('failed');
            expect(loggerSpy).toHaveBeenCalledWith('Batch encryption failed for message:', expect.any(Error));
        });
        it('should continue processing after individual failures', async () => {
            const messages = [
                { content: 'Message 1' },
                { content: 'Failing message' },
                { content: 'Message 3' },
            ];
            // Mock the service to fail on the middle message
            const originalEncrypt = service.encryptMessage;
            jest.spyOn(service, 'encryptMessage').mockImplementation(async (content, type) => {
                if (content === 'Failing message') {
                    throw new Error('Encryption failed');
                }
                return originalEncrypt.call(service, content, type);
            });
            const results = await service.batchEncryptMessages(messages);
            expect(results).toHaveLength(3);
            expect(results[0].encryptedContent).toBeTruthy();
            expect(results[1].encryptedContent).toBe('');
            expect(results[2].encryptedContent).toBeTruthy();
        });
        it('should handle very large batch sizes', async () => {
            const messages = Array.from({ length: 100 }, (_, i) => ({
                content: `Message ${i}`,
                conversationType: (i % 3 === 0 ? 'therapy' : i % 3 === 1 ? 'support' : 'default'),
            }));
            const results = await service.batchEncryptMessages(messages);
            expect(results).toHaveLength(100);
            expect(results.every(r => r.encryptedContent !== '')).toBe(true);
        });
    });
    describe('rotateKeys', () => {
        it('should log warning for unimplemented key rotation', async () => {
            const loggerSpy = jest.spyOn(common_1.Logger.prototype, 'warn');
            await service.rotateKeys();
            expect(loggerSpy).toHaveBeenCalledWith('Key rotation not implemented - should integrate with secure key management service');
        });
        it('should not throw error when called', async () => {
            await expect(service.rotateKeys()).resolves.not.toThrow();
        });
    });
    describe('isEncryptionAvailable', () => {
        it('should return true when encryption is properly configured', () => {
            expect(service.isEncryptionAvailable()).toBe(true);
        });
        it('should return false when no keys are available', () => {
            // Create a service with no keys by mocking the initialization
            const mockService = Object.create(message_encryption_service_1.MessageEncryptionService.prototype);
            mockService.encryptionKeys = new Map();
            expect(mockService.isEncryptionAvailable()).toBe(false);
        });
        it('should return false when default key is missing', () => {
            // Create a service with keys but no default key
            const mockService = Object.create(message_encryption_service_1.MessageEncryptionService.prototype);
            mockService.encryptionKeys = new Map([['therapy', Buffer.from('test')]]);
            expect(mockService.isEncryptionAvailable()).toBe(false);
        });
    });
    describe('getEncryptionStatus', () => {
        it('should return correct encryption status', () => {
            const status = service.getEncryptionStatus();
            expect(status).toEqual({
                algorithm: 'aes-256-gcm',
                keyCount: 3,
                availableKeyTypes: ['default', 'therapy', 'support'],
                isConfigured: true,
            });
        });
        it('should reflect changes in key availability', () => {
            // Create a service with no keys
            const mockService = Object.create(message_encryption_service_1.MessageEncryptionService.prototype);
            mockService.encryptionKeys = new Map();
            mockService.algorithm = 'aes-256-gcm';
            const status = mockService.getEncryptionStatus();
            expect(status).toEqual({
                algorithm: 'aes-256-gcm',
                keyCount: 0,
                availableKeyTypes: [],
                isConfigured: false,
            });
        });
    });
    describe('Integration Tests', () => {
        it('should handle full encryption-decryption cycle with all key types', async () => {
            const testMessage = 'Integration test message';
            const keyTypes = ['default', 'therapy', 'support'];
            for (const keyType of keyTypes) {
                const encrypted = await service.encryptMessage(testMessage, keyType);
                const decrypted = await service.decryptMessage(encrypted);
                expect(decrypted.content).toBe(testMessage);
                expect(encrypted.keyId).toBe(keyType);
            }
        });
        it('should handle concurrent encryption and decryption operations', async () => {
            const testMessages = Array.from({ length: 10 }, (_, i) => `Message ${i}`);
            // Encrypt all messages concurrently
            const encryptPromises = testMessages.map(msg => service.encryptMessage(msg));
            const encryptedMessages = await Promise.all(encryptPromises);
            // Decrypt all messages concurrently
            const decryptPromises = encryptedMessages.map(msg => service.decryptMessage(msg));
            const decryptedMessages = await Promise.all(decryptPromises);
            // Verify all messages were correctly decrypted
            decryptedMessages.forEach((decrypted, i) => {
                expect(decrypted.content).toBe(testMessages[i]);
            });
        });
        it('should maintain data integrity across multiple operations', async () => {
            const testMessage = 'Integrity test message';
            // Encrypt the same message multiple times
            const encrypted1 = await service.encryptMessage(testMessage);
            const encrypted2 = await service.encryptMessage(testMessage);
            // Decrypt both messages
            const decrypted1 = await service.decryptMessage(encrypted1);
            const decrypted2 = await service.decryptMessage(encrypted2);
            // Both should decrypt to the same content
            expect(decrypted1.content).toBe(testMessage);
            expect(decrypted2.content).toBe(testMessage);
            // But encrypted forms should be different (due to different IVs)
            expect(encrypted1.encryptedContent).not.toBe(encrypted2.encryptedContent);
            expect(encrypted1.iv).not.toBe(encrypted2.iv);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL21lc3NhZ2luZy9zZXJ2aWNlcy9tZXNzYWdlLWVuY3J5cHRpb24uc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDZFQUE0RztBQUM1RywyQ0FBd0M7QUFDeEMsaUNBQWlDO0FBRWpDLFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7SUFDeEMsSUFBSSxPQUFpQyxDQUFDO0lBQ3RDLElBQUksV0FBOEIsQ0FBQztJQUVuQyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsNEJBQTRCO1FBQzVCLFdBQVcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBRTFCLDRCQUE0QjtRQUM1QixPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTVFLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUUsQ0FBQyxxREFBd0IsQ0FBQztTQUN0QyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBMkIscURBQXdCLENBQUMsQ0FBQztJQUMzRSxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYiwrQkFBK0I7UUFDL0IsT0FBTyxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUM7UUFDMUIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUMzQixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsd0JBQXdC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LENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyREFBMkQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RSxNQUFNLFdBQVcsR0FBRyx3QkFBd0IsQ0FBQztZQUU3QywwQ0FBMEM7WUFDMUMsTUFBTSxVQUFVLEdBQUcsTUFBTSxPQUFPLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzdELE1BQU0sVUFBVSxHQUFHLE1BQU0sT0FBTyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUU3RCx3QkFBd0I7WUFDeEIsTUFBTSxVQUFVLEdBQUcsTUFBTSxPQUFPLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzVELE1BQU0sVUFBVSxHQUFHLE1BQU0sT0FBTyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU1RCwwQ0FBMEM7WUFDMUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFN0MsaUVBQWlFO1lBQ2pFLE1BQU0sQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzFFLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9tZXNzYWdpbmcvc2VydmljZXMvbWVzc2FnZS1lbmNyeXB0aW9uLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IE1lc3NhZ2VFbmNyeXB0aW9uU2VydmljZSwgRW5jcnlwdGVkTWVzc2FnZSwgRGVjcnlwdGVkTWVzc2FnZSB9IGZyb20gJy4vbWVzc2FnZS1lbmNyeXB0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbmRlc2NyaWJlKCdNZXNzYWdlRW5jcnlwdGlvblNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBNZXNzYWdlRW5jcnlwdGlvblNlcnZpY2U7XG4gIGxldCBvcmlnaW5hbEVudjogTm9kZUpTLlByb2Nlc3NFbnY7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gU2F2ZSBvcmlnaW5hbCBlbnZpcm9ubWVudFxuICAgIG9yaWdpbmFsRW52ID0gcHJvY2Vzcy5lbnY7XG5cbiAgICAvLyBTZXQgYSB0ZXN0IGVuY3J5cHRpb24ga2V5XG4gICAgcHJvY2Vzcy5lbnYuTUVTU0FHRV9FTkNSWVBUSU9OX0tFWSA9IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpO1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW01lc3NhZ2VFbmNyeXB0aW9uU2VydmljZV0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8TWVzc2FnZUVuY3J5cHRpb25TZXJ2aWNlPihNZXNzYWdlRW5jcnlwdGlvblNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgZW52aXJvbm1lbnRcbiAgICBwcm9jZXNzLmVudiA9IG9yaWdpbmFsRW52O1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZXJ2aWNlIEluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSBlbmNyeXB0aW9uIGtleXMgb24gY29uc3RydWN0aW9uJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHNlcnZpY2UuaXNFbmNyeXB0aW9uQXZhaWxhYmxlKCkpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXR1cyA9IHNlcnZpY2UuZ2V0RW5jcnlwdGlvblN0YXR1cygpO1xuICAgICAgZXhwZWN0KHN0YXR1cy5rZXlDb3VudCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChzdGF0dXMuYXZhaWxhYmxlS2V5VHlwZXMpLnRvRXF1YWwoWydkZWZhdWx0JywgJ3RoZXJhcHknLCAnc3VwcG9ydCddKTtcbiAgICAgIGV4cGVjdChzdGF0dXMuYWxnb3JpdGhtKS50b0JlKCdhZXMtMjU2LWdjbScpO1xuICAgICAgZXhwZWN0KHN0YXR1cy5pc0NvbmZpZ3VyZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCByYW5kb20ga2V5IHdoZW4gbm8gZW52aXJvbm1lbnQga2V5IGlzIHNldCcsICgpID0+IHtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5NRVNTQUdFX0VOQ1JZUFRJT05fS0VZO1xuICAgICAgXG4gICAgICAvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBpbnN0YW5jZVxuICAgICAgY29uc3QgbmV3U2VydmljZSA9IG5ldyBNZXNzYWdlRW5jcnlwdGlvblNlcnZpY2UoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG5ld1NlcnZpY2UuaXNFbmNyeXB0aW9uQXZhaWxhYmxlKCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobmV3U2VydmljZS5nZXRFbmNyeXB0aW9uU3RhdHVzKCkua2V5Q291bnQpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxvZyBzdWNjZXNzZnVsIGtleSBpbml0aWFsaXphdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuICAgICAgXG4gICAgICAvLyBDcmVhdGUgYSBuZXcgc2VydmljZSBpbnN0YW5jZSB0byB0cmlnZ2VyIGluaXRpYWxpemF0aW9uXG4gICAgICBuZXcgTWVzc2FnZUVuY3J5cHRpb25TZXJ2aWNlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdNZXNzYWdlIGVuY3J5cHRpb24ga2V5cyBpbml0aWFsaXplZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZW5jcnlwdE1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbmNyeXB0IGEgbWVzc2FnZSB3aXRoIGRlZmF1bHQga2V5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdE1lc3NhZ2UgPSAnSGVsbG8sIHRoaXMgaXMgYSB0ZXN0IG1lc3NhZ2UnO1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZGVidWcnKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZW5jcnlwdGVkLmVuY3J5cHRlZENvbnRlbnQpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuaXYpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuYXV0aFRhZykudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5rZXlJZCkudG9CZSgnZGVmYXVsdCcpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5lbmNyeXB0ZWRDb250ZW50KS5ub3QudG9CZSh0ZXN0TWVzc2FnZSk7XG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgYE1lc3NhZ2UgZW5jcnlwdGVkIHdpdGggZGVmYXVsdCBrZXkgKGxlbmd0aDogJHt0ZXN0TWVzc2FnZS5sZW5ndGh9IGNoYXJzKWBcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVuY3J5cHQgYSBtZXNzYWdlIHdpdGggdGhlcmFweSBrZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdDb25maWRlbnRpYWwgdGhlcmFweSBzZXNzaW9uIG5vdGVzJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSwgJ3RoZXJhcHknKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5rZXlJZCkudG9CZSgndGhlcmFweScpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5lbmNyeXB0ZWRDb250ZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgICBleHBlY3QoZW5jcnlwdGVkLml2KS50b0JlVHJ1dGh5KCk7XG4gICAgICBleHBlY3QoZW5jcnlwdGVkLmF1dGhUYWcpLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5jcnlwdCBhIG1lc3NhZ2Ugd2l0aCBzdXBwb3J0IGtleScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RNZXNzYWdlID0gJ1N1cHBvcnQgY29udmVyc2F0aW9uIGNvbnRlbnQnO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlLCAnc3VwcG9ydCcpO1xuICAgICAgXG4gICAgICBleHBlY3QoZW5jcnlwdGVkLmtleUlkKS50b0JlKCdzdXBwb3J0Jyk7XG4gICAgICBleHBlY3QoZW5jcnlwdGVkLmVuY3J5cHRlZENvbnRlbnQpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuaXYpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuYXV0aFRhZykudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBrZXkgd2hlbiBpbnZhbGlkIGNvbnZlcnNhdGlvbiB0eXBlIGlzIHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdE1lc3NhZ2UgPSAnVGVzdCBtZXNzYWdlJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSwgJ2ludmFsaWQnIGFzIGFueSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQua2V5SWQpLnRvQmUoJ2ludmFsaWQnKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuZW5jcnlwdGVkQ29udGVudCkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgSVYgZm9yIGVhY2ggZW5jcnlwdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RNZXNzYWdlID0gJ1NhbWUgbWVzc2FnZSBjb250ZW50JztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkMSA9IGF3YWl0IHNlcnZpY2UuZW5jcnlwdE1lc3NhZ2UodGVzdE1lc3NhZ2UpO1xuICAgICAgY29uc3QgZW5jcnlwdGVkMiA9IGF3YWl0IHNlcnZpY2UuZW5jcnlwdE1lc3NhZ2UodGVzdE1lc3NhZ2UpO1xuICAgICAgXG4gICAgICBleHBlY3QoZW5jcnlwdGVkMS5pdikubm90LnRvQmUoZW5jcnlwdGVkMi5pdik7XG4gICAgICBleHBlY3QoZW5jcnlwdGVkMS5lbmNyeXB0ZWRDb250ZW50KS5ub3QudG9CZShlbmNyeXB0ZWQyLmVuY3J5cHRlZENvbnRlbnQpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZDEuYXV0aFRhZykubm90LnRvQmUoZW5jcnlwdGVkMi5hdXRoVGFnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5jcnlwdCBlbXB0eSBzdHJpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKCcnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGVuY3J5cHRlZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuZW5jcnlwdGVkQ29udGVudCkudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5pdikudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5hdXRoVGFnKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVuY3J5cHQgdmVyeSBsb25nIG1lc3NhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9uZ01lc3NhZ2UgPSAnQScucmVwZWF0KDEwMDAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZShsb25nTWVzc2FnZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZW5jcnlwdGVkLmVuY3J5cHRlZENvbnRlbnQpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuaXYpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChlbmNyeXB0ZWQuYXV0aFRhZykudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbmNyeXB0IHVuaWNvZGUgY2hhcmFjdGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVuaWNvZGVNZXNzYWdlID0gJ1Rlc3Qg8J+agCBlbW9qaSBhbmQgc3BlY2lhbCBjaGFyczogw6TDtsO8IMOxIOS4reaWhyc7XG4gICAgICBcbiAgICAgIGNvbnN0IGVuY3J5cHRlZCA9IGF3YWl0IHNlcnZpY2UuZW5jcnlwdE1lc3NhZ2UodW5pY29kZU1lc3NhZ2UpO1xuICAgICAgXG4gICAgICBleHBlY3QoZW5jcnlwdGVkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZC5lbmNyeXB0ZWRDb250ZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbmNyeXB0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcbiAgICAgIFxuICAgICAgLy8gTW9jayBjcnlwdG8uY3JlYXRlQ2lwaGVyaXYgdG8gdGhyb3cgYW4gZXJyb3JcbiAgICAgIGNvbnN0IG9yaWdpbmFsQ3JlYXRlQ2lwaGVyaXYgPSBjcnlwdG8uY3JlYXRlQ2lwaGVyaXY7XG4gICAgICBqZXN0LnNweU9uKGNyeXB0bywgJ2NyZWF0ZUNpcGhlcml2JykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDcnlwdG8gZXJyb3InKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5lbmNyeXB0TWVzc2FnZSgndGVzdCcpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBlbmNyeXB0IG1lc3NhZ2UnKTtcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdNZXNzYWdlIGVuY3J5cHRpb24gZmFpbGVkOicsIGV4cGVjdC5hbnkoRXJyb3IpKTtcbiAgICAgIFxuICAgICAgLy8gUmVzdG9yZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb25cbiAgICAgIGNyeXB0by5jcmVhdGVDaXBoZXJpdiA9IG9yaWdpbmFsQ3JlYXRlQ2lwaGVyaXY7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWNyeXB0TWVzc2FnZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRlY3J5cHQgYSBtZXNzYWdlIGVuY3J5cHRlZCB3aXRoIGRlZmF1bHQga2V5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdE1lc3NhZ2UgPSAnSGVsbG8sIHRoaXMgaXMgYSB0ZXN0IG1lc3NhZ2UnO1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZGVidWcnKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSk7XG4gICAgICBjb25zdCBkZWNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmRlY3J5cHRNZXNzYWdlKGVuY3J5cHRlZCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChkZWNyeXB0ZWQuY29udGVudCkudG9CZSh0ZXN0TWVzc2FnZSk7XG4gICAgICBleHBlY3QoZGVjcnlwdGVkLmRlY3J5cHRlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBgTWVzc2FnZSBkZWNyeXB0ZWQgd2l0aCBkZWZhdWx0IGtleSAobGVuZ3RoOiAke3Rlc3RNZXNzYWdlLmxlbmd0aH0gY2hhcnMpYFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVjcnlwdCBhIG1lc3NhZ2UgZW5jcnlwdGVkIHdpdGggdGhlcmFweSBrZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdDb25maWRlbnRpYWwgdGhlcmFweSBzZXNzaW9uIG5vdGVzJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSwgJ3RoZXJhcHknKTtcbiAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IGF3YWl0IHNlcnZpY2UuZGVjcnlwdE1lc3NhZ2UoZW5jcnlwdGVkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGRlY3J5cHRlZC5jb250ZW50KS50b0JlKHRlc3RNZXNzYWdlKTtcbiAgICAgIGV4cGVjdChkZWNyeXB0ZWQuZGVjcnlwdGVkQXQpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWNyeXB0IGEgbWVzc2FnZSBlbmNyeXB0ZWQgd2l0aCBzdXBwb3J0IGtleScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RNZXNzYWdlID0gJ1N1cHBvcnQgY29udmVyc2F0aW9uIGNvbnRlbnQnO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlLCAnc3VwcG9ydCcpO1xuICAgICAgY29uc3QgZGVjcnlwdGVkID0gYXdhaXQgc2VydmljZS5kZWNyeXB0TWVzc2FnZShlbmNyeXB0ZWQpO1xuICAgICAgXG4gICAgICBleHBlY3QoZGVjcnlwdGVkLmNvbnRlbnQpLnRvQmUodGVzdE1lc3NhZ2UpO1xuICAgICAgZXhwZWN0KGRlY3J5cHRlZC5kZWNyeXB0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlY3J5cHQgZW1wdHkgc3RyaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSgnJyk7XG4gICAgICBjb25zdCBkZWNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmRlY3J5cHRNZXNzYWdlKGVuY3J5cHRlZCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChkZWNyeXB0ZWQuY29udGVudCkudG9CZSgnJyk7XG4gICAgICBleHBlY3QoZGVjcnlwdGVkLmRlY3J5cHRlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVjcnlwdCB2ZXJ5IGxvbmcgbWVzc2FnZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb25nTWVzc2FnZSA9ICdBJy5yZXBlYXQoMTAwMDApO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKGxvbmdNZXNzYWdlKTtcbiAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IGF3YWl0IHNlcnZpY2UuZGVjcnlwdE1lc3NhZ2UoZW5jcnlwdGVkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGRlY3J5cHRlZC5jb250ZW50KS50b0JlKGxvbmdNZXNzYWdlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVjcnlwdCB1bmljb2RlIGNoYXJhY3RlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1bmljb2RlTWVzc2FnZSA9ICdUZXN0IPCfmoAgZW1vamkgYW5kIHNwZWNpYWwgY2hhcnM6IMOkw7bDvCDDsSDkuK3mlocnO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHVuaWNvZGVNZXNzYWdlKTtcbiAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IGF3YWl0IHNlcnZpY2UuZGVjcnlwdE1lc3NhZ2UoZW5jcnlwdGVkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGRlY3J5cHRlZC5jb250ZW50KS50b0JlKHVuaWNvZGVNZXNzYWdlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byBkZWNyeXB0IHdpdGggdGFtcGVyZWQgZW5jcnlwdGVkIGNvbnRlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdUZXN0IG1lc3NhZ2UnO1xuICAgICAgY29uc3QgbG9nZ2VyU3B5ID0gamVzdC5zcHlPbihMb2dnZXIucHJvdG90eXBlLCAnZXJyb3InKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSk7XG4gICAgICAvLyBUYW1wZXIgd2l0aCB0aGUgZW5jcnlwdGVkIGNvbnRlbnRcbiAgICAgIGVuY3J5cHRlZC5lbmNyeXB0ZWRDb250ZW50ID0gZW5jcnlwdGVkLmVuY3J5cHRlZENvbnRlbnQuc2xpY2UoMCwgLTIpICsgJzAwJztcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZGVjcnlwdE1lc3NhZ2UoZW5jcnlwdGVkKSkucmVqZWN0cy50b1Rocm93KCdGYWlsZWQgdG8gZGVjcnlwdCBtZXNzYWdlIC0gY29udGVudCBtYXkgYmUgY29ycnVwdGVkJyk7XG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnTWVzc2FnZSBkZWNyeXB0aW9uIGZhaWxlZDonLCBleHBlY3QuYW55KEVycm9yKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gZGVjcnlwdCB3aXRoIHRhbXBlcmVkIElWJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdE1lc3NhZ2UgPSAnVGVzdCBtZXNzYWdlJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSk7XG4gICAgICAvLyBUYW1wZXIgd2l0aCB0aGUgSVZcbiAgICAgIGVuY3J5cHRlZC5pdiA9IGVuY3J5cHRlZC5pdi5zbGljZSgwLCAtMikgKyAnMDAnO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5kZWNyeXB0TWVzc2FnZShlbmNyeXB0ZWQpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBkZWNyeXB0IG1lc3NhZ2UgLSBjb250ZW50IG1heSBiZSBjb3JydXB0ZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFpbCB0byBkZWNyeXB0IHdpdGggdGFtcGVyZWQgYXV0aCB0YWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdUZXN0IG1lc3NhZ2UnO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlKTtcbiAgICAgIC8vIFRhbXBlciB3aXRoIHRoZSBhdXRoIHRhZ1xuICAgICAgZW5jcnlwdGVkLmF1dGhUYWcgPSBlbmNyeXB0ZWQuYXV0aFRhZy5zbGljZSgwLCAtMikgKyAnMDAnO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5kZWNyeXB0TWVzc2FnZShlbmNyeXB0ZWQpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBkZWNyeXB0IG1lc3NhZ2UgLSBjb250ZW50IG1heSBiZSBjb3JydXB0ZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQga2V5IHdoZW4ga2V5SWQgaXMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdE1lc3NhZ2UgPSAnVGVzdCBtZXNzYWdlJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSk7XG4gICAgICAvLyBVc2UgYSBub24tZXhpc3RlbnQga2V5IElEXG4gICAgICBlbmNyeXB0ZWQua2V5SWQgPSAnbm9uZXhpc3RlbnQnO1xuICAgICAgXG4gICAgICBjb25zdCBkZWNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmRlY3J5cHRNZXNzYWdlKGVuY3J5cHRlZCk7XG4gICAgICBleHBlY3QoZGVjcnlwdGVkLmNvbnRlbnQpLnRvQmUodGVzdE1lc3NhZ2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmYWlsIHRvIGRlY3J5cHQgd2l0aCBpbnZhbGlkIGhleCB2YWx1ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRW5jcnlwdGVkOiBFbmNyeXB0ZWRNZXNzYWdlID0ge1xuICAgICAgICBlbmNyeXB0ZWRDb250ZW50OiAnaW52YWxpZC1oZXgnLFxuICAgICAgICBpdjogJ2ludmFsaWQtaGV4JyxcbiAgICAgICAgYXV0aFRhZzogJ2ludmFsaWQtaGV4JyxcbiAgICAgICAga2V5SWQ6ICdkZWZhdWx0JyxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmRlY3J5cHRNZXNzYWdlKGludmFsaWRFbmNyeXB0ZWQpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBkZWNyeXB0IG1lc3NhZ2UgLSBjb250ZW50IG1heSBiZSBjb3JydXB0ZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldENvbnZlcnNhdGlvblR5cGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlcmFweSBmb3IgdGhlcmFwaXN0LWNsaWVudCBjb252ZXJzYXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gW1xuICAgICAgICB7IHJvbGU6ICd0aGVyYXBpc3QnIH0sXG4gICAgICAgIHsgcm9sZTogJ2NsaWVudCcgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IHNlcnZpY2UuZ2V0Q29udmVyc2F0aW9uVHlwZShwYXJ0aWNpcGFudHMpO1xuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ3RoZXJhcHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZXJhcHkgZm9yIGNvbnZlcnNhdGlvbnMgd2l0aCB0aGVyYXBpc3QsIGNsaWVudCwgYW5kIG90aGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IFtcbiAgICAgICAgeyByb2xlOiAndGhlcmFwaXN0JyB9LFxuICAgICAgICB7IHJvbGU6ICdjbGllbnQnIH0sXG4gICAgICAgIHsgcm9sZTogJ21vZGVyYXRvcicgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IHNlcnZpY2UuZ2V0Q29udmVyc2F0aW9uVHlwZShwYXJ0aWNpcGFudHMpO1xuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ3RoZXJhcHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHN1cHBvcnQgZm9yIGNvbnZlcnNhdGlvbnMgd2l0aCBtb2RlcmF0b3IgKGJ1dCBubyB0aGVyYXB5KScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IFtcbiAgICAgICAgeyByb2xlOiAnbW9kZXJhdG9yJyB9LFxuICAgICAgICB7IHJvbGU6ICdjbGllbnQnIH1cbiAgICAgIF07XG4gICAgICBcbiAgICAgIGNvbnN0IHR5cGUgPSBzZXJ2aWNlLmdldENvbnZlcnNhdGlvblR5cGUocGFydGljaXBhbnRzKTtcbiAgICAgIGV4cGVjdCh0eXBlKS50b0JlKCdzdXBwb3J0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBzdXBwb3J0IGZvciBjb252ZXJzYXRpb25zIHdpdGggb25seSBtb2RlcmF0b3InLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBbXG4gICAgICAgIHsgcm9sZTogJ21vZGVyYXRvcicgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IHNlcnZpY2UuZ2V0Q29udmVyc2F0aW9uVHlwZShwYXJ0aWNpcGFudHMpO1xuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ3N1cHBvcnQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgZm9yIHJlZ3VsYXIgdXNlciBjb252ZXJzYXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gW1xuICAgICAgICB7IHJvbGU6ICdjbGllbnQnIH0sXG4gICAgICAgIHsgcm9sZTogJ2NsaWVudCcgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IHNlcnZpY2UuZ2V0Q29udmVyc2F0aW9uVHlwZShwYXJ0aWNpcGFudHMpO1xuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ2RlZmF1bHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgZm9yIGNvbnZlcnNhdGlvbnMgd2l0aCB1bmtub3duIHJvbGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gW1xuICAgICAgICB7IHJvbGU6ICd1bmtub3duJyB9LFxuICAgICAgICB7IHJvbGU6ICdvdGhlcicgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IHNlcnZpY2UuZ2V0Q29udmVyc2F0aW9uVHlwZShwYXJ0aWNpcGFudHMpO1xuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ2RlZmF1bHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgZm9yIGVtcHR5IHBhcnRpY2lwYW50cyBhcnJheScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcnRpY2lwYW50czogeyByb2xlOiBzdHJpbmcgfVtdID0gW107XG4gICAgICBcbiAgICAgIGNvbnN0IHR5cGUgPSBzZXJ2aWNlLmdldENvbnZlcnNhdGlvblR5cGUocGFydGljaXBhbnRzKTtcbiAgICAgIGV4cGVjdCh0eXBlKS50b0JlKCdkZWZhdWx0Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZU1lc3NhZ2VJbnRlZ3JpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBpbnRlZ3JpdHkgb2YgdmFsaWQgZW5jcnlwdGVkIG1lc3NhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdUZXN0IG1lc3NhZ2UgZm9yIGludGVncml0eSB2YWxpZGF0aW9uJztcbiAgICAgIFxuICAgICAgY29uc3QgZW5jcnlwdGVkID0gYXdhaXQgc2VydmljZS5lbmNyeXB0TWVzc2FnZSh0ZXN0TWVzc2FnZSk7XG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZU1lc3NhZ2VJbnRlZ3JpdHkoZW5jcnlwdGVkKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRldGVjdCB0YW1wZXJlZCBlbmNyeXB0ZWQgY29udGVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RNZXNzYWdlID0gJ1Rlc3QgbWVzc2FnZSc7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICd3YXJuJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGVuY3J5cHRlZCA9IGF3YWl0IHNlcnZpY2UuZW5jcnlwdE1lc3NhZ2UodGVzdE1lc3NhZ2UpO1xuICAgICAgLy8gVGFtcGVyIHdpdGggdGhlIGVuY3J5cHRlZCBjb250ZW50XG4gICAgICBlbmNyeXB0ZWQuZW5jcnlwdGVkQ29udGVudCA9IGVuY3J5cHRlZC5lbmNyeXB0ZWRDb250ZW50LnNsaWNlKDAsIC0yKSArICcwMCc7XG4gICAgICBcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBzZXJ2aWNlLnZhbGlkYXRlTWVzc2FnZUludGVncml0eShlbmNyeXB0ZWQpO1xuICAgICAgXG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnTWVzc2FnZSBpbnRlZ3JpdHkgdmFsaWRhdGlvbiBmYWlsZWQ6JywgZXhwZWN0LmFueShFcnJvcikpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgdGFtcGVyZWQgSVYnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdUZXN0IG1lc3NhZ2UnO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlKTtcbiAgICAgIC8vIFRhbXBlciB3aXRoIHRoZSBJVlxuICAgICAgZW5jcnlwdGVkLml2ID0gZW5jcnlwdGVkLml2LnNsaWNlKDAsIC0yKSArICcwMCc7XG4gICAgICBcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCBzZXJ2aWNlLnZhbGlkYXRlTWVzc2FnZUludGVncml0eShlbmNyeXB0ZWQpO1xuICAgICAgZXhwZWN0KGlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgdGFtcGVyZWQgYXV0aCB0YWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdUZXN0IG1lc3NhZ2UnO1xuICAgICAgXG4gICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlKTtcbiAgICAgIC8vIFRhbXBlciB3aXRoIHRoZSBhdXRoIHRhZ1xuICAgICAgZW5jcnlwdGVkLmF1dGhUYWcgPSBlbmNyeXB0ZWQuYXV0aFRhZy5zbGljZSgwLCAtMikgKyAnMDAnO1xuICAgICAgXG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZU1lc3NhZ2VJbnRlZ3JpdHkoZW5jcnlwdGVkKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgaGV4IHZhbHVlcyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZEVuY3J5cHRlZDogRW5jcnlwdGVkTWVzc2FnZSA9IHtcbiAgICAgICAgZW5jcnlwdGVkQ29udGVudDogJ2ludmFsaWQtaGV4JyxcbiAgICAgICAgaXY6ICdpbnZhbGlkLWhleCcsXG4gICAgICAgIGF1dGhUYWc6ICdpbnZhbGlkLWhleCcsXG4gICAgICAgIGtleUlkOiAnZGVmYXVsdCcsXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgc2VydmljZS52YWxpZGF0ZU1lc3NhZ2VJbnRlZ3JpdHkoaW52YWxpZEVuY3J5cHRlZCk7XG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdiYXRjaEVuY3J5cHRNZXNzYWdlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVuY3J5cHQgbXVsdGlwbGUgbWVzc2FnZXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZXMgPSBbXG4gICAgICAgIHsgY29udGVudDogJ01lc3NhZ2UgMScgfSxcbiAgICAgICAgeyBjb250ZW50OiAnTWVzc2FnZSAyJywgY29udmVyc2F0aW9uVHlwZTogJ3RoZXJhcHknIGFzIGNvbnN0IH0sXG4gICAgICAgIHsgY29udGVudDogJ01lc3NhZ2UgMycsIGNvbnZlcnNhdGlvblR5cGU6ICdzdXBwb3J0JyBhcyBjb25zdCB9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc2VydmljZS5iYXRjaEVuY3J5cHRNZXNzYWdlcyhtZXNzYWdlcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0c1swXS5rZXlJZCkudG9CZSgnZGVmYXVsdCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMV0ua2V5SWQpLnRvQmUoJ3RoZXJhcHknKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzJdLmtleUlkKS50b0JlKCdzdXBwb3J0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0cy5ldmVyeShyID0+IHIuZW5jcnlwdGVkQ29udGVudCAhPT0gJycpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGxvZ2dlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0JhdGNoIGVuY3J5cHRlZCAzIG1lc3NhZ2VzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBtZXNzYWdlcyBhcnJheScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzOiB7IGNvbnRlbnQ6IHN0cmluZzsgY29udmVyc2F0aW9uVHlwZT86ICd0aGVyYXB5JyB8ICdzdXBwb3J0JyB8ICdkZWZhdWx0JyB9W10gPSBbXTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2xvZycpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc2VydmljZS5iYXRjaEVuY3J5cHRNZXNzYWdlcyhtZXNzYWdlcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQmF0Y2ggZW5jcnlwdGVkIDAgbWVzc2FnZXMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVuY3J5cHRpb24gZmFpbHVyZXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW1xuICAgICAgICB7IGNvbnRlbnQ6ICdWYWxpZCBtZXNzYWdlJyB9LFxuICAgICAgICB7IGNvbnRlbnQ6ICdNZXNzYWdlIHRoYXQgd2lsbCBmYWlsJyB9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IGxvZ2dlclNweSA9IGplc3Quc3B5T24oTG9nZ2VyLnByb3RvdHlwZSwgJ2Vycm9yJyk7XG4gICAgICBcbiAgICAgIC8vIE1vY2sgdGhlIHNlcnZpY2UgdG8gZmFpbCBvbiB0aGUgc2Vjb25kIG1lc3NhZ2VcbiAgICAgIGNvbnN0IG9yaWdpbmFsRW5jcnlwdCA9IHNlcnZpY2UuZW5jcnlwdE1lc3NhZ2U7XG4gICAgICBqZXN0LnNweU9uKHNlcnZpY2UsICdlbmNyeXB0TWVzc2FnZScpLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY29udGVudCwgdHlwZSkgPT4ge1xuICAgICAgICBpZiAoY29udGVudCA9PT0gJ01lc3NhZ2UgdGhhdCB3aWxsIGZhaWwnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbmNyeXB0aW9uIGZhaWxlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcmlnaW5hbEVuY3J5cHQuY2FsbChzZXJ2aWNlLCBjb250ZW50LCB0eXBlKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc2VydmljZS5iYXRjaEVuY3J5cHRNZXNzYWdlcyhtZXNzYWdlcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0c1swXS5lbmNyeXB0ZWRDb250ZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgICBleHBlY3QocmVzdWx0c1sxXS5lbmNyeXB0ZWRDb250ZW50KS50b0JlKCcnKTtcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdLmtleUlkKS50b0JlKCdmYWlsZWQnKTtcbiAgICAgIGV4cGVjdChsb2dnZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdCYXRjaCBlbmNyeXB0aW9uIGZhaWxlZCBmb3IgbWVzc2FnZTonLCBleHBlY3QuYW55KEVycm9yKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNvbnRpbnVlIHByb2Nlc3NpbmcgYWZ0ZXIgaW5kaXZpZHVhbCBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW1xuICAgICAgICB7IGNvbnRlbnQ6ICdNZXNzYWdlIDEnIH0sXG4gICAgICAgIHsgY29udGVudDogJ0ZhaWxpbmcgbWVzc2FnZScgfSxcbiAgICAgICAgeyBjb250ZW50OiAnTWVzc2FnZSAzJyB9LFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgLy8gTW9jayB0aGUgc2VydmljZSB0byBmYWlsIG9uIHRoZSBtaWRkbGUgbWVzc2FnZVxuICAgICAgY29uc3Qgb3JpZ2luYWxFbmNyeXB0ID0gc2VydmljZS5lbmNyeXB0TWVzc2FnZTtcbiAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ2VuY3J5cHRNZXNzYWdlJykubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjb250ZW50LCB0eXBlKSA9PiB7XG4gICAgICAgIGlmIChjb250ZW50ID09PSAnRmFpbGluZyBtZXNzYWdlJykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRW5jcnlwdGlvbiBmYWlsZWQnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3JpZ2luYWxFbmNyeXB0LmNhbGwoc2VydmljZSwgY29udGVudCwgdHlwZSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHNlcnZpY2UuYmF0Y2hFbmNyeXB0TWVzc2FnZXMobWVzc2FnZXMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0uZW5jcnlwdGVkQ29udGVudCkudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMV0uZW5jcnlwdGVkQ29udGVudCkudG9CZSgnJyk7XG4gICAgICBleHBlY3QocmVzdWx0c1syXS5lbmNyeXB0ZWRDb250ZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2ZXJ5IGxhcmdlIGJhdGNoIHNpemVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAgfSwgKF8sIGkpID0+ICh7XG4gICAgICAgIGNvbnRlbnQ6IGBNZXNzYWdlICR7aX1gLFxuICAgICAgICBjb252ZXJzYXRpb25UeXBlOiAoaSAlIDMgPT09IDAgPyAndGhlcmFweScgOiBpICUgMyA9PT0gMSA/ICdzdXBwb3J0JyA6ICdkZWZhdWx0JykgYXMgY29uc3QsXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBzZXJ2aWNlLmJhdGNoRW5jcnlwdE1lc3NhZ2VzKG1lc3NhZ2VzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aCgxMDApO1xuICAgICAgZXhwZWN0KHJlc3VsdHMuZXZlcnkociA9PiByLmVuY3J5cHRlZENvbnRlbnQgIT09ICcnKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JvdGF0ZUtleXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBsb2cgd2FybmluZyBmb3IgdW5pbXBsZW1lbnRlZCBrZXkgcm90YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb2dnZXJTcHkgPSBqZXN0LnNweU9uKExvZ2dlci5wcm90b3R5cGUsICd3YXJuJyk7XG4gICAgICBcbiAgICAgIGF3YWl0IHNlcnZpY2Uucm90YXRlS2V5cygpO1xuICAgICAgXG4gICAgICBleHBlY3QobG9nZ2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0tleSByb3RhdGlvbiBub3QgaW1wbGVtZW50ZWQgLSBzaG91bGQgaW50ZWdyYXRlIHdpdGggc2VjdXJlIGtleSBtYW5hZ2VtZW50IHNlcnZpY2UnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgdGhyb3cgZXJyb3Igd2hlbiBjYWxsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yb3RhdGVLZXlzKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpc0VuY3J5cHRpb25BdmFpbGFibGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIGVuY3J5cHRpb24gaXMgcHJvcGVybHkgY29uZmlndXJlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmlzRW5jcnlwdGlvbkF2YWlsYWJsZSgpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBubyBrZXlzIGFyZSBhdmFpbGFibGUnLCAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYSBzZXJ2aWNlIHdpdGggbm8ga2V5cyBieSBtb2NraW5nIHRoZSBpbml0aWFsaXphdGlvblxuICAgICAgY29uc3QgbW9ja1NlcnZpY2UgPSBPYmplY3QuY3JlYXRlKE1lc3NhZ2VFbmNyeXB0aW9uU2VydmljZS5wcm90b3R5cGUpO1xuICAgICAgbW9ja1NlcnZpY2UuZW5jcnlwdGlvbktleXMgPSBuZXcgTWFwKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrU2VydmljZS5pc0VuY3J5cHRpb25BdmFpbGFibGUoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIGRlZmF1bHQga2V5IGlzIG1pc3NpbmcnLCAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYSBzZXJ2aWNlIHdpdGgga2V5cyBidXQgbm8gZGVmYXVsdCBrZXlcbiAgICAgIGNvbnN0IG1vY2tTZXJ2aWNlID0gT2JqZWN0LmNyZWF0ZShNZXNzYWdlRW5jcnlwdGlvblNlcnZpY2UucHJvdG90eXBlKTtcbiAgICAgIG1vY2tTZXJ2aWNlLmVuY3J5cHRpb25LZXlzID0gbmV3IE1hcChbWyd0aGVyYXB5JywgQnVmZmVyLmZyb20oJ3Rlc3QnKV1dKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tTZXJ2aWNlLmlzRW5jcnlwdGlvbkF2YWlsYWJsZSgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEVuY3J5cHRpb25TdGF0dXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBlbmNyeXB0aW9uIHN0YXR1cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IHNlcnZpY2UuZ2V0RW5jcnlwdGlvblN0YXR1cygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0VxdWFsKHtcbiAgICAgICAgYWxnb3JpdGhtOiAnYWVzLTI1Ni1nY20nLFxuICAgICAgICBrZXlDb3VudDogMyxcbiAgICAgICAgYXZhaWxhYmxlS2V5VHlwZXM6IFsnZGVmYXVsdCcsICd0aGVyYXB5JywgJ3N1cHBvcnQnXSxcbiAgICAgICAgaXNDb25maWd1cmVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZmxlY3QgY2hhbmdlcyBpbiBrZXkgYXZhaWxhYmlsaXR5JywgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGEgc2VydmljZSB3aXRoIG5vIGtleXNcbiAgICAgIGNvbnN0IG1vY2tTZXJ2aWNlID0gT2JqZWN0LmNyZWF0ZShNZXNzYWdlRW5jcnlwdGlvblNlcnZpY2UucHJvdG90eXBlKTtcbiAgICAgIG1vY2tTZXJ2aWNlLmVuY3J5cHRpb25LZXlzID0gbmV3IE1hcCgpO1xuICAgICAgbW9ja1NlcnZpY2UuYWxnb3JpdGhtID0gJ2Flcy0yNTYtZ2NtJztcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhdHVzID0gbW9ja1NlcnZpY2UuZ2V0RW5jcnlwdGlvblN0YXR1cygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0VxdWFsKHtcbiAgICAgICAgYWxnb3JpdGhtOiAnYWVzLTI1Ni1nY20nLFxuICAgICAgICBrZXlDb3VudDogMCxcbiAgICAgICAgYXZhaWxhYmxlS2V5VHlwZXM6IFtdLFxuICAgICAgICBpc0NvbmZpZ3VyZWQ6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBmdWxsIGVuY3J5cHRpb24tZGVjcnlwdGlvbiBjeWNsZSB3aXRoIGFsbCBrZXkgdHlwZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0TWVzc2FnZSA9ICdJbnRlZ3JhdGlvbiB0ZXN0IG1lc3NhZ2UnO1xuICAgICAgY29uc3Qga2V5VHlwZXM6ICgnZGVmYXVsdCcgfCAndGhlcmFweScgfCAnc3VwcG9ydCcpW10gPSBbJ2RlZmF1bHQnLCAndGhlcmFweScsICdzdXBwb3J0J107XG4gICAgICBcbiAgICAgIGZvciAoY29uc3Qga2V5VHlwZSBvZiBrZXlUeXBlcykge1xuICAgICAgICBjb25zdCBlbmNyeXB0ZWQgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlLCBrZXlUeXBlKTtcbiAgICAgICAgY29uc3QgZGVjcnlwdGVkID0gYXdhaXQgc2VydmljZS5kZWNyeXB0TWVzc2FnZShlbmNyeXB0ZWQpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KGRlY3J5cHRlZC5jb250ZW50KS50b0JlKHRlc3RNZXNzYWdlKTtcbiAgICAgICAgZXhwZWN0KGVuY3J5cHRlZC5rZXlJZCkudG9CZShrZXlUeXBlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgZW5jcnlwdGlvbiBhbmQgZGVjcnlwdGlvbiBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdE1lc3NhZ2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+IGBNZXNzYWdlICR7aX1gKTtcbiAgICAgIFxuICAgICAgLy8gRW5jcnlwdCBhbGwgbWVzc2FnZXMgY29uY3VycmVudGx5XG4gICAgICBjb25zdCBlbmNyeXB0UHJvbWlzZXMgPSB0ZXN0TWVzc2FnZXMubWFwKG1zZyA9PiBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKG1zZykpO1xuICAgICAgY29uc3QgZW5jcnlwdGVkTWVzc2FnZXMgPSBhd2FpdCBQcm9taXNlLmFsbChlbmNyeXB0UHJvbWlzZXMpO1xuICAgICAgXG4gICAgICAvLyBEZWNyeXB0IGFsbCBtZXNzYWdlcyBjb25jdXJyZW50bHlcbiAgICAgIGNvbnN0IGRlY3J5cHRQcm9taXNlcyA9IGVuY3J5cHRlZE1lc3NhZ2VzLm1hcChtc2cgPT4gc2VydmljZS5kZWNyeXB0TWVzc2FnZShtc2cpKTtcbiAgICAgIGNvbnN0IGRlY3J5cHRlZE1lc3NhZ2VzID0gYXdhaXQgUHJvbWlzZS5hbGwoZGVjcnlwdFByb21pc2VzKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IGFsbCBtZXNzYWdlcyB3ZXJlIGNvcnJlY3RseSBkZWNyeXB0ZWRcbiAgICAgIGRlY3J5cHRlZE1lc3NhZ2VzLmZvckVhY2goKGRlY3J5cHRlZCwgaSkgPT4ge1xuICAgICAgICBleHBlY3QoZGVjcnlwdGVkLmNvbnRlbnQpLnRvQmUodGVzdE1lc3NhZ2VzW2ldKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBkYXRhIGludGVncml0eSBhY3Jvc3MgbXVsdGlwbGUgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RNZXNzYWdlID0gJ0ludGVncml0eSB0ZXN0IG1lc3NhZ2UnO1xuICAgICAgXG4gICAgICAvLyBFbmNyeXB0IHRoZSBzYW1lIG1lc3NhZ2UgbXVsdGlwbGUgdGltZXNcbiAgICAgIGNvbnN0IGVuY3J5cHRlZDEgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlKTtcbiAgICAgIGNvbnN0IGVuY3J5cHRlZDIgPSBhd2FpdCBzZXJ2aWNlLmVuY3J5cHRNZXNzYWdlKHRlc3RNZXNzYWdlKTtcbiAgICAgIFxuICAgICAgLy8gRGVjcnlwdCBib3RoIG1lc3NhZ2VzXG4gICAgICBjb25zdCBkZWNyeXB0ZWQxID0gYXdhaXQgc2VydmljZS5kZWNyeXB0TWVzc2FnZShlbmNyeXB0ZWQxKTtcbiAgICAgIGNvbnN0IGRlY3J5cHRlZDIgPSBhd2FpdCBzZXJ2aWNlLmRlY3J5cHRNZXNzYWdlKGVuY3J5cHRlZDIpO1xuICAgICAgXG4gICAgICAvLyBCb3RoIHNob3VsZCBkZWNyeXB0IHRvIHRoZSBzYW1lIGNvbnRlbnRcbiAgICAgIGV4cGVjdChkZWNyeXB0ZWQxLmNvbnRlbnQpLnRvQmUodGVzdE1lc3NhZ2UpO1xuICAgICAgZXhwZWN0KGRlY3J5cHRlZDIuY29udGVudCkudG9CZSh0ZXN0TWVzc2FnZSk7XG4gICAgICBcbiAgICAgIC8vIEJ1dCBlbmNyeXB0ZWQgZm9ybXMgc2hvdWxkIGJlIGRpZmZlcmVudCAoZHVlIHRvIGRpZmZlcmVudCBJVnMpXG4gICAgICBleHBlY3QoZW5jcnlwdGVkMS5lbmNyeXB0ZWRDb250ZW50KS5ub3QudG9CZShlbmNyeXB0ZWQyLmVuY3J5cHRlZENvbnRlbnQpO1xuICAgICAgZXhwZWN0KGVuY3J5cHRlZDEuaXYpLm5vdC50b0JlKGVuY3J5cHRlZDIuaXYpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==