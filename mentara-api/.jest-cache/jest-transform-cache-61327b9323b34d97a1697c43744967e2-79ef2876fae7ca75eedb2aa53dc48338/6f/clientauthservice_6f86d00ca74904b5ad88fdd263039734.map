{"version":3,"names":["cov_1tiu4tf2jx","actualCoverage","common_1","s","require","prisma_client_provider_1","token_service_1","email_verification_service_1","bcrypt","ClientAuthService","prisma","tokenService","emailVerificationService","constructor","f","registerClient","registerDto","existingUser","user","findUnique","where","email","b","BadRequestException","hashedPassword","hash","password","result","$transaction","tx","create","data","firstName","lastName","middleName","undefined","birthDate","Date","address","avatarUrl","role","emailVerified","client","userId","id","hasSeenTherapistRecommendations","tokens","generateTokenPair","sendVerificationEmail","message","loginClient","ipAddress","userAgent","findFirst","include","UnauthorizedException","lockoutUntil","isPasswordValid","compare","handleFailedLogin","update","failedLoginCount","lastLoginAt","getClientProfile","assignedTherapists","therapist","select","getFirstSignInStatus","markRecommendationsSeen","newFailedCount","maxAttempts","lockoutDuration","updateData","now","exports","__decorate","Injectable","PrismaService","_a","Object","_b","TokenService","_c","EmailVerificationService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/client-auth.service.ts"],"sourcesContent":["import {\n  Injectable,\n  UnauthorizedException,\n  BadRequestException,\n} from '@nestjs/common';\nimport { RegisterClientDto } from 'mentara-commons';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { TokenService } from './token.service';\nimport { EmailVerificationService } from './email-verification.service';\nimport * as bcrypt from 'bcrypt';\n\n@Injectable()\nexport class ClientAuthService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly tokenService: TokenService,\n    private readonly emailVerificationService: EmailVerificationService,\n  ) {}\n\n  async registerClient(registerDto: RegisterClientDto) {\n    // Check if user already exists\n    const existingUser = await this.prisma.user.findUnique({\n      where: { email: registerDto.email },\n    });\n\n    if (existingUser) {\n      throw new BadRequestException('User with this email already exists');\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(registerDto.password, 12);\n\n    // Create user and client profile in transaction\n    const result = await this.prisma.$transaction(async (tx) => {\n      const user = await tx.user.create({\n        data: {\n          email: registerDto.email,\n          password: hashedPassword,\n          firstName: registerDto.firstName,\n          lastName: registerDto.lastName,\n          middleName: registerDto.middleName || undefined,\n          birthDate: registerDto.birthDate\n            ? new Date(registerDto.birthDate)\n            : undefined,\n          address: registerDto.address || undefined,\n          avatarUrl: registerDto.avatarUrl || undefined,\n          role: 'client',\n          emailVerified: false,\n        },\n      });\n\n      const client = await tx.client.create({\n        data: {\n          userId: user.id,\n          hasSeenTherapistRecommendations:\n            registerDto.hasSeenTherapistRecommendations || false,\n        },\n      });\n\n      return { user, client };\n    });\n\n    // Generate tokens\n    const tokens = await this.tokenService.generateTokenPair(\n      result.user.id,\n      result.user.email,\n      result.user.role,\n    );\n\n    // Send verification email\n    await this.emailVerificationService.sendVerificationEmail(result.user.id);\n\n    return {\n      user: result.user,\n      tokens,\n      message:\n        'Client registration successful. Please check your email for verification.',\n    };\n  }\n\n  async loginClient(\n    email: string,\n    password: string,\n    ipAddress?: string,\n    userAgent?: string,\n  ) {\n    // Find user with client role\n    const user = await this.prisma.user.findFirst({\n      where: {\n        email,\n        role: 'client',\n      },\n      include: {\n        client: true,\n      },\n    });\n\n    if (!user) {\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Check if account is locked\n    if (user.lockoutUntil && user.lockoutUntil > new Date()) {\n      throw new UnauthorizedException(\n        'Account is temporarily locked due to failed login attempts',\n      );\n    }\n\n    // Verify password\n    if (!user.password) {\n      throw new UnauthorizedException('Account setup incomplete');\n    }\n    const isPasswordValid = await bcrypt.compare(password, user.password);\n    if (!isPasswordValid) {\n      // Increment failed login count\n      await this.handleFailedLogin(user.id);\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Reset failed login count and update last login\n    await this.prisma.user.update({\n      where: { id: user.id },\n      data: {\n        failedLoginCount: 0,\n        lockoutUntil: null,\n        lastLoginAt: new Date(),\n      },\n    });\n\n    // Generate tokens\n    const tokens = await this.tokenService.generateTokenPair(\n      user.id,\n      user.email,\n      user.role,\n      ipAddress,\n      userAgent,\n    );\n\n    return {\n      user,\n      tokens,\n    };\n  }\n\n  async getClientProfile(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      include: {\n        client: {\n          include: {\n            assignedTherapists: {\n              include: {\n                therapist: {\n                  include: {\n                    user: {\n                      select: {\n                        id: true,\n                        firstName: true,\n                        lastName: true,\n                        email: true,\n                        avatarUrl: true,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!user || user.role !== 'client') {\n      throw new UnauthorizedException('Client not found');\n    }\n\n    return user;\n  }\n\n  async getFirstSignInStatus(userId: string) {\n    const client = await this.prisma.client.findUnique({\n      where: { userId },\n      select: {\n        hasSeenTherapistRecommendations: true,\n      },\n    });\n\n    if (!client) {\n      throw new UnauthorizedException('Client not found');\n    }\n\n    return {\n      hasSeenTherapistRecommendations: client.hasSeenTherapistRecommendations,\n    };\n  }\n\n  async markRecommendationsSeen(userId: string) {\n    const client = await this.prisma.client.findUnique({\n      where: { userId },\n    });\n\n    if (!client) {\n      throw new UnauthorizedException('Client not found');\n    }\n\n    await this.prisma.client.update({\n      where: { userId },\n      data: {\n        hasSeenTherapistRecommendations: true,\n      },\n    });\n\n    return {\n      message: 'Recommendations marked as seen',\n    };\n  }\n\n  private async handleFailedLogin(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      select: { failedLoginCount: true },\n    });\n\n    const newFailedCount = (user?.failedLoginCount || 0) + 1;\n    const maxAttempts = 5;\n    const lockoutDuration = 30 * 60 * 1000; // 30 minutes\n\n    const updateData: any = {\n      failedLoginCount: newFailedCount,\n    };\n\n    if (newFailedCount >= maxAttempts) {\n      updateData.lockoutUntil = new Date(Date.now() + lockoutDuration);\n    }\n\n    await this.prisma.user.update({\n      where: { id: userId },\n      data: updateData,\n    });\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}