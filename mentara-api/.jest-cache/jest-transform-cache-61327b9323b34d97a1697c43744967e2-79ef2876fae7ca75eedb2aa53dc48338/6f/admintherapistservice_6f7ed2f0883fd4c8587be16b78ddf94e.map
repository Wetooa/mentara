{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/services/admin-therapist.service.ts","mappings":";;;;;;;;;;;;;;AAAA,2CAOwB;AACxB,mFAAuE;AACvE,qFAAiF;AAU1E,IAAM,qBAAqB,6BAA3B,MAAM,qBAAqB;IAIb;IACA;IAJF,MAAM,GAAG,IAAI,eAAM,CAAC,uBAAqB,CAAC,IAAI,CAAC,CAAC;IAEjE,YACmB,MAAqB,EACrB,oBAA0C;QAD1C,WAAM,GAAN,MAAM,CAAe;QACrB,yBAAoB,GAApB,oBAAoB,CAAsB;IAC1D,CAAC;IAEJ,8CAA8C;IAE9C,KAAK,CAAC,sBAAsB,CAAC,OAAmC;QAC9D,IAAI,CAAC;YACH,MAAM,EACJ,MAAM,GAAG,SAAS,EAClB,QAAQ,EACR,cAAc,EACd,WAAW,EACX,YAAY,EACZ,KAAK,GAAG,EAAE,GACX,GAAG,OAAO,CAAC;YAEZ,MAAM,KAAK,GAA+B,EAAE,CAAC;YAE7C,sBAAsB;YACtB,IAAI,MAAM,EAAE,CAAC;gBACX,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;YACxB,CAAC;YAED,wBAAwB;YACxB,IAAI,QAAQ,EAAE,CAAC;gBACb,KAAK,CAAC,QAAQ,GAAG;oBACf,QAAQ,EAAE,QAAQ;oBAClB,IAAI,EAAE,aAAa;iBACpB,CAAC;YACJ,CAAC;YAED,oBAAoB;YACpB,IAAI,cAAc,EAAE,CAAC;gBACnB,KAAK,CAAC,cAAc,GAAG;oBACrB,GAAG,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC;iBAC9B,CAAC;YACJ,CAAC;YAED,4BAA4B;YAC5B,IAAI,WAAW,EAAE,CAAC;gBAChB,KAAK,CAAC,kBAAkB,GAAG,WAAW,CAAC;YACzC,CAAC;YAED,6BAA6B;YAC7B,IAAI,YAAY,EAAE,CAAC;gBACjB,KAAK,CAAC,YAAY,GAAG;oBACnB,QAAQ,EAAE,YAAY;oBACtB,IAAI,EAAE,aAAa;iBACpB,CAAC;YACJ,CAAC;YAED,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;gBACxD,KAAK;gBACL,IAAI,EAAE,KAAK;gBACX,OAAO,EAAE,CAAC,EAAE,cAAc,EAAE,MAAM,EAAE,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,CAAC;gBAC5D,OAAO,EAAE;oBACP,IAAI,EAAE;wBACJ,MAAM,EAAE;4BACN,EAAE,EAAE,IAAI;4BACR,SAAS,EAAE,IAAI;4BACf,QAAQ,EAAE,IAAI;4BACd,KAAK,EAAE,IAAI;4BACX,SAAS,EAAE,IAAI;4BACf,WAAW,EAAE,IAAI;yBAClB;qBACF;oBACD,gBAAgB,EAAE;wBAChB,OAAO,EAAE;4BACP,IAAI,EAAE;gCACJ,MAAM,EAAE;oCACN,SAAS,EAAE,IAAI;oCACf,QAAQ,EAAE,IAAI;oCACd,KAAK,EAAE,IAAI;iCACZ;6BACF;yBACF;qBACF;iBACF;aACF,CAAC,CAAC;YAEH,+BAA+B;YAC/B,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;gBACrD,KAAK,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE;aAC7B,CAAC,CAAC;YAEH,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;gBACtD,KAAK,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE;aAC9B,CAAC,CAAC;YAEH,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;gBACtD,KAAK,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE;aAC9B,CAAC,CAAC;YAEH,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,aAAa,YAAY,CAAC,MAAM,yCAAyC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,CACnG,CAAC;YAEF,OAAO;gBACL,YAAY;gBACZ,OAAO,EAAE;oBACP,YAAY;oBACZ,aAAa;oBACb,aAAa;oBACb,QAAQ,EAAE,YAAY,CAAC,MAAM;iBAC9B;gBACD,OAAO,EAAE,OAAO;aACjB,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;YACrE,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,KAAK,CAAC,qBAAqB,CAAC,WAAmB;QAC7C,IAAI,CAAC;YACH,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC;gBACzD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;gBAC9B,OAAO,EAAE;oBACP,IAAI,EAAE;wBACJ,OAAO,EAAE;4BACP,MAAM,EAAE,IAAI,EAAE,wCAAwC;yBACvD;qBACF;oBACD,gBAAgB,EAAE;wBAChB,OAAO,EAAE;4BACP,IAAI,EAAE;gCACJ,MAAM,EAAE;oCACN,SAAS,EAAE,IAAI;oCACf,QAAQ,EAAE,IAAI;oCACd,KAAK,EAAE,IAAI;iCACZ;6BACF;yBACF;qBACF;oBACD,8CAA8C;oBAC9C,eAAe,EAAE;wBACf,IAAI,EAAE,CAAC,EAAE,6BAA6B;wBACtC,OAAO,EAAE;4BACP,MAAM,EAAE;gCACN,OAAO,EAAE;oCACP,IAAI,EAAE;wCACJ,MAAM,EAAE;4CACN,SAAS,EAAE,IAAI;4CACf,QAAQ,EAAE,IAAI;yCACf;qCACF;iCACF;6BACF;yBACF;qBACF;oBACD,OAAO,EAAE;wBACP,IAAI,EAAE,CAAC,EAAE,6BAA6B;wBACtC,OAAO,EAAE;4BACP,MAAM,EAAE;gCACN,OAAO,EAAE;oCACP,IAAI,EAAE;wCACJ,MAAM,EAAE;4CACN,SAAS,EAAE,IAAI;4CACf,QAAQ,EAAE,IAAI;yCACf;qCACF;iCACF;6BACF;yBACF;qBACF;iBACF;aACF,CAAC,CAAC;YAEH,IAAI,CAAC,WAAW,EAAE,CAAC;gBACjB,MAAM,IAAI,0BAAiB,CACzB,iCAAiC,WAAW,YAAY,CACzD,CAAC;YACJ,CAAC;YAED,qCAAqC;YACrC,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;gBACrD,KAAK,EAAE;oBACL,MAAM,EAAE,WAAW;oBACnB,QAAQ,EAAE,WAAW;iBACtB;gBACD,OAAO,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE;gBAC9B,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE;oBACP,IAAI,EAAE;wBACJ,MAAM,EAAE;4BACN,SAAS,EAAE,IAAI;4BACf,QAAQ,EAAE,IAAI;4BACd,KAAK,EAAE,IAAI;yBACZ;qBACF;iBACF;aACF,CAAC,CAAC;YAEH,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,gDAAgD,WAAW,EAAE,CAC9D,CAAC;YAEF,OAAO;gBACL,WAAW;gBACX,UAAU;gBACV,UAAU,EAAE;oBACV,YAAY,EAAE,WAAW,CAAC,eAAe,CAAC,MAAM;oBAChD,aAAa,EACX,WAAW,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;wBAC5B,CAAC,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,CACxB,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,EACpC,CAAC,CACF,GAAG,WAAW,CAAC,OAAO,CAAC,MAAM;wBAChC,CAAC,CAAC,CAAC;oBACP,YAAY,EAAE,WAAW,CAAC,OAAO,CAAC,MAAM;iBACzC;aACF,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,8CAA8C,WAAW,GAAG,EAC5D,KAAK,CACN,CAAC;YACF,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,0CAA0C;IAE1C,KAAK,CAAC,gBAAgB,CACpB,WAAmB,EACnB,OAAe,EACf,YAAiC;QAEjC,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE;gBACjD,4CAA4C;gBAC5C,MAAM,iBAAiB,GAAG,MAAM,EAAE,CAAC,SAAS,CAAC,UAAU,CAAC;oBACtD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;oBAC9B,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE;iBACxB,CAAC,CAAC;gBAEH,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACvB,MAAM,IAAI,0BAAiB,CACzB,qBAAqB,WAAW,YAAY,CAC7C,CAAC;gBACJ,CAAC;gBAED,IAAI,iBAAiB,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;oBAC3C,MAAM,IAAI,0BAAiB,CACzB,aAAa,WAAW,6CAA6C,iBAAiB,CAAC,MAAM,GAAG,CACjG,CAAC;gBACJ,CAAC;gBAED,yCAAyC;gBACzC,MAAM,iBAAiB,GAAG,MAAM,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC;oBAClD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;oBAC9B,IAAI,EAAE;wBACJ,MAAM,EAAE,UAAU;wBAClB,kBAAkB,EAAE,OAAO;wBAC3B,cAAc,EAAE,IAAI,IAAI,EAAE;wBAC1B,eAAe,EAAE,YAAY,CAAC,aAAa,IAAI,KAAK;qBACrD;iBACF,CAAC,CAAC;gBAEH,mCAAmC;gBACnC,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;oBACnB,KAAK,EAAE,EAAE,EAAE,EAAE,WAAW,EAAE;oBAC1B,IAAI,EAAE;wBACJ,IAAI,EAAE,WAAW;wBACjB,UAAU,EAAE,IAAI,EAAE,iCAAiC;qBACpD;iBACF,CAAC,CAAC;gBAEH,sBAAsB;gBACtB,MAAM,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;oBACvB,IAAI,EAAE;wBACJ,MAAM,EAAE,OAAO;wBACf,MAAM,EAAE,+BAA+B;wBACvC,MAAM,EAAE,WAAW;wBACnB,QAAQ,EAAE,WAAW;wBACrB,QAAQ,EAAE;4BACR,WAAW;4BACX,eAAe,EAAE,YAAY,CAAC,eAAe;4BAC7C,aAAa,EAAE,YAAY,CAAC,aAAa;4BACzC,uBAAuB,EAAE,YAAY,CAAC,uBAAuB;4BAC7D,OAAO;4BACP,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;yBACpC;qBACF;iBACF,CAAC,CAAC;gBAEH,gCAAgC;gBAChC,MAAM,IAAI,CAAC,oBAAoB,CAAC,sCAAsC,CACpE,WAAW,EACX,UAAU,CACX,CAAC;gBAEF,6DAA6D;gBAC7D,IAAI,YAAY,CAAC,eAAe,EAAE,CAAC;oBACjC,MAAM,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;wBACrC,MAAM,EAAE,WAAW;wBACnB,KAAK,EAAE,4CAA4C;wBACnD,OAAO,EAAE,YAAY,CAAC,eAAe;wBACrC,IAAI,EAAE,oBAAoB;wBAC1B,QAAQ,EAAE,MAAM;wBAChB,SAAS,EAAE,sBAAsB;qBAClC,CAAC,CAAC;gBACL,CAAC;gBAED,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,SAAS,OAAO,mCAAmC,WAAW,EAAE,CACjE,CAAC;gBAEF,OAAO;oBACL,OAAO,EAAE,IAAI;oBACb,SAAS,EAAE,iBAAiB;oBAC5B,OAAO,EAAE,6CAA6C;oBACtD,YAAY;iBACb,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,WAAW,GAAG,EAAE,KAAK,CAAC,CAAC;YACxE,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,KAAK,CAAC,eAAe,CACnB,WAAmB,EACnB,OAAe,EACf,aAAiC;QAEjC,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE;gBACjD,iDAAiD;gBACjD,MAAM,iBAAiB,GAAG,MAAM,EAAE,CAAC,SAAS,CAAC,UAAU,CAAC;oBACtD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;oBAC9B,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE;iBACxB,CAAC,CAAC;gBAEH,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACvB,MAAM,IAAI,0BAAiB,CACzB,qBAAqB,WAAW,YAAY,CAC7C,CAAC;gBACJ,CAAC;gBAED,IAAI,iBAAiB,CAAC,MAAM,KAAK,UAAU,EAAE,CAAC;oBAC5C,MAAM,IAAI,2BAAkB,CAC1B,4CAA4C,WAAW,EAAE,CAC1D,CAAC;gBACJ,CAAC;gBAED,yCAAyC;gBACzC,MAAM,iBAAiB,GAAG,MAAM,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC;oBAClD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;oBAC9B,IAAI,EAAE;wBACJ,MAAM,EAAE,UAAU;wBAClB,kBAAkB,EAAE,OAAO;wBAC3B,cAAc,EAAE,IAAI,IAAI,EAAE;qBAC3B;iBACF,CAAC,CAAC;gBAEH,sBAAsB;gBACtB,MAAM,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;oBACvB,IAAI,EAAE;wBACJ,MAAM,EAAE,OAAO;wBACf,MAAM,EAAE,8BAA8B;wBACtC,MAAM,EAAE,WAAW;wBACnB,QAAQ,EAAE,WAAW;wBACrB,QAAQ,EAAE;4BACR,WAAW;4BACX,eAAe,EAAE,aAAa,CAAC,eAAe;4BAC9C,gBAAgB,EAAE,aAAa,CAAC,gBAAgB;4BAChD,kBAAkB,EAAE,aAAa,CAAC,kBAAkB;4BACpD,OAAO;4BACP,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;yBACpC;qBACF;iBACF,CAAC,CAAC;gBAEH,uDAAuD;gBACvD,MAAM,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBACrC,MAAM,EAAE,WAAW;oBACnB,KAAK,EAAE,8BAA8B;oBACrC,OAAO,EAAE,iDAAiD,aAAa,CAAC,gBAAgB,EAAE;oBAC1F,IAAI,EAAE,oBAAoB;oBAC1B,QAAQ,EAAE,MAAM;oBAChB,SAAS,EAAE,aAAa,CAAC,kBAAkB;wBACzC,CAAC,CAAC,oBAAoB;wBACtB,CAAC,CAAC,wBAAwB;iBAC7B,CAAC,CAAC;gBAEH,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,SAAS,OAAO,mCAAmC,WAAW,gBAAgB,aAAa,CAAC,eAAe,EAAE,CAC9G,CAAC;gBAEF,OAAO;oBACL,OAAO,EAAE,IAAI;oBACb,SAAS,EAAE,iBAAiB;oBAC5B,OAAO,EAAE,gCAAgC;oBACzC,aAAa;iBACd,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,8BAA8B,WAAW,GAAG,EAAE,KAAK,CAAC,CAAC;YACvE,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,0CAA0C;IAE1C,KAAK,CAAC,qBAAqB,CACzB,WAAmB,EACnB,OAAe,EACf,UAAoC;QAEpC,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE;gBACjD,6BAA6B;gBAC7B,MAAM,iBAAiB,GAAG,MAAM,EAAE,CAAC,SAAS,CAAC,UAAU,CAAC;oBACtD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;oBAC9B,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE;iBACxB,CAAC,CAAC;gBAEH,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACvB,MAAM,IAAI,0BAAiB,CACzB,qBAAqB,WAAW,YAAY,CAC7C,CAAC;gBACJ,CAAC;gBAED,gCAAgC;gBAChC,MAAM,gBAAgB,GAAG,IAAI,CAAC,yBAAyB,CACrD,iBAAiB,CAAC,MAAM,CACzB,CAAC;gBACF,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC;oBAClD,MAAM,IAAI,4BAAmB,CAC3B,kCAAkC,iBAAiB,CAAC,MAAM,OAAO,UAAU,CAAC,MAAM,EAAE,CACrF,CAAC;gBACJ,CAAC;gBAED,6BAA6B;gBAC7B,MAAM,gBAAgB,GAAG,MAAM,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC;oBACjD,KAAK,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;oBAC9B,IAAI,EAAE;wBACJ,MAAM,EAAE,UAAU,CAAC,MAAM;wBACzB,kBAAkB,EAAE,OAAO;wBAC3B,cAAc,EAAE,IAAI,IAAI,EAAE;qBAC3B;iBACF,CAAC,CAAC;gBAEH,qCAAqC;gBACrC,IAAI,UAAU,CAAC,MAAM,KAAK,WAAW,EAAE,CAAC;oBACtC,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;wBACnB,KAAK,EAAE,EAAE,EAAE,EAAE,WAAW,EAAE;wBAC1B,IAAI,EAAE;4BACJ,QAAQ,EAAE,KAAK;4BACf,WAAW,EAAE,IAAI,IAAI,EAAE;4BACvB,WAAW,EAAE,OAAO;4BACpB,gBAAgB,EAAE,UAAU,CAAC,MAAM,IAAI,yBAAyB;yBACjE;qBACF,CAAC,CAAC;gBACL,CAAC;qBAAM,IAAI,UAAU,CAAC,MAAM,KAAK,UAAU,EAAE,CAAC;oBAC5C,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC;wBACnB,KAAK,EAAE,EAAE,EAAE,EAAE,WAAW,EAAE;wBAC1B,IAAI,EAAE;4BACJ,IAAI,EAAE,WAAW;4BACjB,QAAQ,EAAE,IAAI;4BACd,WAAW,EAAE,IAAI;4BACjB,WAAW,EAAE,IAAI;4BACjB,gBAAgB,EAAE,IAAI;yBACvB;qBACF,CAAC,CAAC;gBACL,CAAC;gBAED,sBAAsB;gBACtB,MAAM,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;oBACvB,IAAI,EAAE;wBACJ,MAAM,EAAE,OAAO;wBACf,MAAM,EAAE,yBAAyB;wBACjC,MAAM,EAAE,WAAW;wBACnB,QAAQ,EAAE,WAAW;wBACrB,QAAQ,EAAE;4BACR,WAAW;4BACX,cAAc,EAAE,iBAAiB,CAAC,MAAM;4BACxC,SAAS,EAAE,UAAU,CAAC,MAAM;4BAC5B,MAAM,EAAE,UAAU,CAAC,MAAM;4BACzB,OAAO;4BACP,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;yBACpC;qBACF;iBACF,CAAC,CAAC;gBAEH,qCAAqC;gBACrC,MAAM,iBAAiB,GAAG,IAAI,CAAC,gCAAgC,CAC7D,UAAU,CAAC,MAAM,CAClB,CAAC;gBACF,MAAM,mBAAmB,GAAG,IAAI,CAAC,kCAAkC,CACjE,UAAU,CAAC,MAAM,EACjB,UAAU,CAAC,MAAM,CAClB,CAAC;gBAEF,MAAM,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBACrC,MAAM,EAAE,WAAW;oBACnB,KAAK,EAAE,iBAAiB;oBACxB,OAAO,EAAE,mBAAmB;oBAC5B,IAAI,EAAE,0BAA0B;oBAChC,QAAQ,EAAE,UAAU,CAAC,MAAM,KAAK,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ;oBAC/D,SAAS,EAAE,sBAAsB;iBAClC,CAAC,CAAC;gBAEH,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,SAAS,OAAO,sBAAsB,WAAW,gBAAgB,iBAAiB,CAAC,MAAM,OAAO,UAAU,CAAC,MAAM,EAAE,CACpH,CAAC;gBAEF,OAAO;oBACL,OAAO,EAAE,IAAI;oBACb,SAAS,EAAE,gBAAgB;oBAC3B,cAAc,EAAE,iBAAiB,CAAC,MAAM;oBACxC,SAAS,EAAE,UAAU,CAAC,MAAM;oBAC5B,OAAO,EAAE,+BAA+B,UAAU,CAAC,MAAM,EAAE;iBAC5D,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,yCAAyC,WAAW,GAAG,EACvD,KAAK,CACN,CAAC;YACF,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,sCAAsC;IAEtC,KAAK,CAAC,8BAA8B,CAAC,SAAkB,EAAE,OAAgB;QACvE,IAAI,CAAC;YACH,MAAM,KAAK,GAAG,SAAS;gBACrB,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC;gBACrB,CAAC,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;YACpD,MAAM,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE,CAAC;YAErD,MAAM,CACJ,iBAAiB,EACjB,mBAAmB,EACnB,oBAAoB,EACpB,oBAAoB,EACpB,kBAAkB,EAClB,eAAe,EAChB,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;gBACpB,+BAA+B;gBAC/B,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;oBAC1B,KAAK,EAAE;wBACL,cAAc,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE;qBACzC;iBACF,CAAC;gBACF,uBAAuB;gBACvB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;oBAC1B,KAAK,EAAE;wBACL,MAAM,EAAE,SAAS;wBACjB,cAAc,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE;qBACzC;iBACF,CAAC;gBACF,kCAAkC;gBAClC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;oBAC1B,KAAK,EAAE;wBACL,MAAM,EAAE,UAAU;wBAClB,cAAc,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE;qBACzC;iBACF,CAAC;gBACF,kCAAkC;gBAClC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC;oBAC1B,KAAK,EAAE;wBACL,MAAM,EAAE,UAAU;wBAClB,cAAc,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE;qBACzC;iBACF,CAAC;gBACF,yCAAyC;gBACzC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;oBAC7B,KAAK,EAAE;wBACL,cAAc,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE;qBACzC;oBACD,MAAM,EAAE;wBACN,cAAc,EAAE,IAAI;wBACpB,MAAM,EAAE,IAAI;wBACZ,cAAc,EAAE,IAAI;qBACrB;oBACD,OAAO,EAAE,EAAE,cAAc,EAAE,MAAM,EAAE;iBACpC,CAAC;gBACF,sDAAsD;gBACtD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;oBAC7B,KAAK,EAAE;wBACL,cAAc,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE;wBACxC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE;qBACzC;oBACD,MAAM,EAAE;wBACN,cAAc,EAAE,IAAI;wBACpB,cAAc,EAAE,IAAI;wBACpB,MAAM,EAAE,IAAI;qBACb;iBACF,CAAC;aACH,CAAC,CAAC;YAEH,oCAAoC;YACpC,MAAM,qBAAqB,GACzB,eAAe,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;gBAClC,IAAI,GAAG,CAAC,cAAc,IAAI,GAAG,CAAC,cAAc,EAAE,CAAC;oBAC7C,MAAM,gBAAgB,GACpB,GAAG,CAAC,cAAc,CAAC,OAAO,EAAE,GAAG,GAAG,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;oBAC9D,OAAO,GAAG,GAAG,gBAAgB,GAAG,CAAC,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC,kBAAkB;gBAC3E,CAAC;gBACD,OAAO,GAAG,CAAC;YACb,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC;YAExC,0BAA0B;YAC1B,MAAM,qBAAqB,GAAG,oBAAoB,GAAG,oBAAoB,CAAC;YAC1E,MAAM,YAAY,GAChB,qBAAqB,GAAG,CAAC;gBACvB,CAAC,CAAC,CAAC,oBAAoB,GAAG,qBAAqB,CAAC,GAAG,GAAG;gBACtD,CAAC,CAAC,CAAC,CAAC;YAER,IAAI,CAAC,MAAM,CAAC,GAAG,CACb,sDAAsD,KAAK,OAAO,GAAG,EAAE,CACxE,CAAC;YAEF,OAAO;gBACL,MAAM,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE;gBACtB,OAAO,EAAE;oBACP,iBAAiB;oBACjB,mBAAmB;oBACnB,oBAAoB;oBACpB,oBAAoB;oBACpB,qBAAqB;iBACtB;gBACD,OAAO,EAAE;oBACP,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,GAAG,CAAC,GAAG,GAAG;oBAClD,yBAAyB,EACvB,IAAI,CAAC,KAAK,CAAC,qBAAqB,GAAG,GAAG,CAAC,GAAG,GAAG;oBAC/C,gBAAgB,EAAE,IAAI,CAAC,yBAAyB,CAAC,kBAAkB,CAAC;iBACrE;gBACD,cAAc,EAAE,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;aAChD,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,mDAAmD,EACnD,KAAK,CACN,CAAC;YACF,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,6BAA6B;IAErB,yBAAyB,CAAC,aAAqB;QACrD,MAAM,WAAW,GAAG;YAClB,OAAO,EAAE,CAAC,UAAU,EAAE,UAAU,EAAE,cAAc,CAAC;YACjD,YAAY,EAAE,CAAC,UAAU,EAAE,UAAU,EAAE,SAAS,CAAC;YACjD,QAAQ,EAAE,CAAC,WAAW,EAAE,cAAc,CAAC;YACvC,QAAQ,EAAE,CAAC,SAAS,EAAE,cAAc,CAAC,EAAE,qBAAqB;YAC5D,SAAS,EAAE,CAAC,UAAU,EAAE,UAAU,CAAC;SACpC,CAAC;QAEF,OAAO,WAAW,CAAC,aAAa,CAAC,IAAI,EAAE,CAAC;IAC1C,CAAC;IAEO,gCAAgC,CAAC,MAAc;QACrD,MAAM,MAAM,GAAG;YACb,QAAQ,EAAE,uBAAuB;YACjC,QAAQ,EAAE,2BAA2B;YACrC,SAAS,EAAE,mBAAmB;YAC9B,YAAY,EAAE,0BAA0B;YACxC,OAAO,EAAE,4BAA4B;SACtC,CAAC;QAEF,OAAO,MAAM,CAAC,MAAM,CAAC,IAAI,eAAe,CAAC;IAC3C,CAAC;IAEO,kCAAkC,CACxC,MAAc,EACd,MAAe;QAEf,MAAM,YAAY,GAAG;YACnB,QAAQ,EACN,gEAAgE;YAClE,QAAQ,EAAE,+CAA+C;YACzD,SAAS,EAAE,wDAAwD;YACnE,YAAY,EAAE,wDAAwD;YACtE,OAAO,EAAE,2CAA2C;SACrD,CAAC;QAEF,MAAM,WAAW,GACf,YAAY,CAAC,MAAM,CAAC,IAAI,uCAAuC,CAAC;QAClE,OAAO,MAAM,CAAC,CAAC,CAAC,GAAG,WAAW,YAAY,MAAM,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC;IACnE,CAAC;IAEO,yBAAyB,CAC/B,YAAmB;QAEnB,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC;YAAE,OAAO,QAAQ,CAAC;QAE7C,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;QACvB,MAAM,OAAO,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;QAClE,MAAM,WAAW,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;QAEvE,MAAM,eAAe,GAAG,YAAY,CAAC,MAAM,CACzC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,cAAc,IAAI,OAAO,CACvC,CAAC,MAAM,CAAC;QACT,MAAM,iBAAiB,GAAG,YAAY,CAAC,MAAM,CAC3C,CAAC,GAAG,EAAE,EAAE,CACN,GAAG,CAAC,cAAc,IAAI,WAAW,IAAI,GAAG,CAAC,cAAc,GAAG,OAAO,CACpE,CAAC,MAAM,CAAC;QAET,IAAI,eAAe,GAAG,iBAAiB,GAAG,GAAG;YAAE,OAAO,YAAY,CAAC;QACnE,IAAI,eAAe,GAAG,iBAAiB,GAAG,GAAG;YAAE,OAAO,YAAY,CAAC;QACnE,OAAO,QAAQ,CAAC;IAClB,CAAC;CACF,CAAA;AAzsBY,sDAAqB;gCAArB,qBAAqB;IADjC,IAAA,mBAAU,GAAE;yDAKgB,sCAAa,oBAAb,sCAAa,oDACC,4CAAoB,oBAApB,4CAAoB;GALlD,qBAAqB,CAysBjC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/admin/services/admin-therapist.service.ts"],"sourcesContent":["import {\n  Injectable,\n  Logger,\n  NotFoundException,\n  ConflictException,\n  BadRequestException,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { NotificationsService } from '../../notifications/notifications.service';\nimport { Prisma } from '@prisma/client';\nimport {\n  type ApproveTherapistDto,\n  type RejectTherapistDto,\n  type UpdateTherapistStatusDto,\n  type PendingTherapistFiltersDto,\n} from 'mentara-commons';\n\n@Injectable()\nexport class AdminTherapistService {\n  private readonly logger = new Logger(AdminTherapistService.name);\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly notificationsService: NotificationsService,\n  ) {}\n\n  // ===== THERAPIST APPLICATION RETRIEVAL =====\n\n  async getPendingApplications(filters: PendingTherapistFiltersDto) {\n    try {\n      const {\n        status = 'pending',\n        province,\n        submittedAfter,\n        processedBy,\n        providerType,\n        limit = 50,\n      } = filters;\n\n      const where: Prisma.TherapistWhereInput = {};\n\n      // Apply status filter\n      if (status) {\n        where.status = status;\n      }\n\n      // Apply province filter\n      if (province) {\n        where.province = {\n          contains: province,\n          mode: 'insensitive',\n        };\n      }\n\n      // Apply date filter\n      if (submittedAfter) {\n        where.submissionDate = {\n          gte: new Date(submittedAfter),\n        };\n      }\n\n      // Apply processed by filter\n      if (processedBy) {\n        where.processedByAdminId = processedBy;\n      }\n\n      // Apply provider type filter\n      if (providerType) {\n        where.providerType = {\n          contains: providerType,\n          mode: 'insensitive',\n        };\n      }\n\n      const applications = await this.prisma.therapist.findMany({\n        where,\n        take: limit,\n        orderBy: [{ submissionDate: 'desc' }, { createdAt: 'desc' }],\n        include: {\n          user: {\n            select: {\n              id: true,\n              firstName: true,\n              lastName: true,\n              email: true,\n              createdAt: true,\n              lastLoginAt: true,\n            },\n          },\n          processedByAdmin: {\n            include: {\n              user: {\n                select: {\n                  firstName: true,\n                  lastName: true,\n                  email: true,\n                },\n              },\n            },\n          },\n        },\n      });\n\n      // Calculate summary statistics\n      const totalPending = await this.prisma.therapist.count({\n        where: { status: 'pending' },\n      });\n\n      const totalApproved = await this.prisma.therapist.count({\n        where: { status: 'approved' },\n      });\n\n      const totalRejected = await this.prisma.therapist.count({\n        where: { status: 'rejected' },\n      });\n\n      this.logger.log(\n        `Retrieved ${applications.length} therapist applications with filters: ${JSON.stringify(filters)}`,\n      );\n\n      return {\n        applications,\n        summary: {\n          totalPending,\n          totalApproved,\n          totalRejected,\n          filtered: applications.length,\n        },\n        filters: filters,\n      };\n    } catch (error) {\n      this.logger.error('Failed to retrieve pending applications:', error);\n      throw error;\n    }\n  }\n\n  async getApplicationDetails(therapistId: string) {\n    try {\n      const application = await this.prisma.therapist.findUnique({\n        where: { userId: therapistId },\n        include: {\n          user: {\n            include: {\n              client: true, // Check if user also has client profile\n            },\n          },\n          processedByAdmin: {\n            include: {\n              user: {\n                select: {\n                  firstName: true,\n                  lastName: true,\n                  email: true,\n                },\n              },\n            },\n          },\n          // Include related data for comprehensive view\n          assignedClients: {\n            take: 5, // Show recent clients if any\n            include: {\n              client: {\n                include: {\n                  user: {\n                    select: {\n                      firstName: true,\n                      lastName: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n          reviews: {\n            take: 5, // Show recent reviews if any\n            include: {\n              client: {\n                include: {\n                  user: {\n                    select: {\n                      firstName: true,\n                      lastName: true,\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      });\n\n      if (!application) {\n        throw new NotFoundException(\n          `Therapist application with ID ${therapistId} not found`,\n        );\n      }\n\n      // Get audit trail for this therapist\n      const auditTrail = await this.prisma.auditLog.findMany({\n        where: {\n          entity: 'therapist',\n          entityId: therapistId,\n        },\n        orderBy: { createdAt: 'desc' },\n        take: 10,\n        include: {\n          user: {\n            select: {\n              firstName: true,\n              lastName: true,\n              email: true,\n            },\n          },\n        },\n      });\n\n      this.logger.log(\n        `Retrieved detailed application for therapist ${therapistId}`,\n      );\n\n      return {\n        application,\n        auditTrail,\n        statistics: {\n          totalClients: application.assignedClients.length,\n          averageRating:\n            application.reviews.length > 0\n              ? application.reviews.reduce(\n                  (sum, review) => sum + review.rating,\n                  0,\n                ) / application.reviews.length\n              : 0,\n          totalReviews: application.reviews.length,\n        },\n      };\n    } catch (error) {\n      this.logger.error(\n        `Failed to retrieve application details for ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== THERAPIST APPROVAL WORKFLOW =====\n\n  async approveTherapist(\n    therapistId: string,\n    adminId: string,\n    approvalData: ApproveTherapistDto,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // 1. Verify therapist exists and is pending\n        const existingTherapist = await tx.therapist.findUnique({\n          where: { userId: therapistId },\n          include: { user: true },\n        });\n\n        if (!existingTherapist) {\n          throw new NotFoundException(\n            `Therapist with ID ${therapistId} not found`,\n          );\n        }\n\n        if (existingTherapist.status !== 'pending') {\n          throw new ConflictException(\n            `Therapist ${therapistId} is not pending approval (current status: ${existingTherapist.status})`,\n          );\n        }\n\n        // 2. Update therapist status to approved\n        const approvedTherapist = await tx.therapist.update({\n          where: { userId: therapistId },\n          data: {\n            status: 'approved',\n            processedByAdminId: adminId,\n            processingDate: new Date(),\n            licenseVerified: approvalData.verifyLicense || false,\n          },\n        });\n\n        // 3. Update user role to therapist\n        await tx.user.update({\n          where: { id: therapistId },\n          data: {\n            role: 'therapist',\n            isVerified: true, // Mark as verified when approved\n          },\n        });\n\n        // 4. Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'APPROVE_THERAPIST_APPLICATION',\n            entity: 'therapist',\n            entityId: therapistId,\n            metadata: {\n              therapistId,\n              approvalMessage: approvalData.approvalMessage,\n              verifyLicense: approvalData.verifyLicense,\n              grantSpecialPermissions: approvalData.grantSpecialPermissions,\n              adminId,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        // 5. Send approval notification\n        await this.notificationsService.createTherapistApplicationNotification(\n          therapistId,\n          'approved',\n        );\n\n        // 6. Create custom approval notification if message provided\n        if (approvalData.approvalMessage) {\n          await this.notificationsService.create({\n            userId: therapistId,\n            title: 'Welcome to Mentara - Application Approved!',\n            message: approvalData.approvalMessage,\n            type: 'THERAPIST_APPROVED',\n            priority: 'HIGH',\n            actionUrl: '/therapist/dashboard',\n          });\n        }\n\n        this.logger.log(\n          `Admin ${adminId} approved therapist application ${therapistId}`,\n        );\n\n        return {\n          success: true,\n          therapist: approvedTherapist,\n          message: 'Therapist application approved successfully',\n          approvalData,\n        };\n      });\n    } catch (error) {\n      this.logger.error(`Failed to approve therapist ${therapistId}:`, error);\n      throw error;\n    }\n  }\n\n  async rejectTherapist(\n    therapistId: string,\n    adminId: string,\n    rejectionData: RejectTherapistDto,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // 1. Verify therapist exists and can be rejected\n        const existingTherapist = await tx.therapist.findUnique({\n          where: { userId: therapistId },\n          include: { user: true },\n        });\n\n        if (!existingTherapist) {\n          throw new NotFoundException(\n            `Therapist with ID ${therapistId} not found`,\n          );\n        }\n\n        if (existingTherapist.status === 'approved') {\n          throw new ForbiddenException(\n            `Cannot reject already approved therapist ${therapistId}`,\n          );\n        }\n\n        // 2. Update therapist status to rejected\n        const rejectedTherapist = await tx.therapist.update({\n          where: { userId: therapistId },\n          data: {\n            status: 'rejected',\n            processedByAdminId: adminId,\n            processingDate: new Date(),\n          },\n        });\n\n        // 3. Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'REJECT_THERAPIST_APPLICATION',\n            entity: 'therapist',\n            entityId: therapistId,\n            metadata: {\n              therapistId,\n              rejectionReason: rejectionData.rejectionReason,\n              rejectionMessage: rejectionData.rejectionMessage,\n              allowReapplication: rejectionData.allowReapplication,\n              adminId,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        // 4. Send rejection notification with detailed message\n        await this.notificationsService.create({\n          userId: therapistId,\n          title: 'Therapist Application Update',\n          message: `Your therapist application has been reviewed. ${rejectionData.rejectionMessage}`,\n          type: 'THERAPIST_REJECTED',\n          priority: 'HIGH',\n          actionUrl: rejectionData.allowReapplication\n            ? '/therapist/reapply'\n            : '/therapist/application',\n        });\n\n        this.logger.log(\n          `Admin ${adminId} rejected therapist application ${therapistId} for reason: ${rejectionData.rejectionReason}`,\n        );\n\n        return {\n          success: true,\n          therapist: rejectedTherapist,\n          message: 'Therapist application rejected',\n          rejectionData,\n        };\n      });\n    } catch (error) {\n      this.logger.error(`Failed to reject therapist ${therapistId}:`, error);\n      throw error;\n    }\n  }\n\n  // ===== THERAPIST STATUS MANAGEMENT =====\n\n  async updateTherapistStatus(\n    therapistId: string,\n    adminId: string,\n    statusData: UpdateTherapistStatusDto,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // 1. Verify therapist exists\n        const existingTherapist = await tx.therapist.findUnique({\n          where: { userId: therapistId },\n          include: { user: true },\n        });\n\n        if (!existingTherapist) {\n          throw new NotFoundException(\n            `Therapist with ID ${therapistId} not found`,\n          );\n        }\n\n        // 2. Validate status transition\n        const validTransitions = this.getValidStatusTransitions(\n          existingTherapist.status,\n        );\n        if (!validTransitions.includes(statusData.status)) {\n          throw new BadRequestException(\n            `Invalid status transition from ${existingTherapist.status} to ${statusData.status}`,\n          );\n        }\n\n        // 3. Update therapist status\n        const updatedTherapist = await tx.therapist.update({\n          where: { userId: therapistId },\n          data: {\n            status: statusData.status,\n            processedByAdminId: adminId,\n            processingDate: new Date(),\n          },\n        });\n\n        // 4. Update user status if necessary\n        if (statusData.status === 'suspended') {\n          await tx.user.update({\n            where: { id: therapistId },\n            data: {\n              isActive: false,\n              suspendedAt: new Date(),\n              suspendedBy: adminId,\n              suspensionReason: statusData.reason || 'Status updated by admin',\n            },\n          });\n        } else if (statusData.status === 'approved') {\n          await tx.user.update({\n            where: { id: therapistId },\n            data: {\n              role: 'therapist',\n              isActive: true,\n              suspendedAt: null,\n              suspendedBy: null,\n              suspensionReason: null,\n            },\n          });\n        }\n\n        // 5. Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: adminId,\n            action: 'UPDATE_THERAPIST_STATUS',\n            entity: 'therapist',\n            entityId: therapistId,\n            metadata: {\n              therapistId,\n              previousStatus: existingTherapist.status,\n              newStatus: statusData.status,\n              reason: statusData.reason,\n              adminId,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        // 6. Send status change notification\n        const notificationTitle = this.getStatusChangeNotificationTitle(\n          statusData.status,\n        );\n        const notificationMessage = this.getStatusChangeNotificationMessage(\n          statusData.status,\n          statusData.reason,\n        );\n\n        await this.notificationsService.create({\n          userId: therapistId,\n          title: notificationTitle,\n          message: notificationMessage,\n          type: 'THERAPIST_STATUS_UPDATED',\n          priority: statusData.status === 'suspended' ? 'HIGH' : 'NORMAL',\n          actionUrl: '/therapist/dashboard',\n        });\n\n        this.logger.log(\n          `Admin ${adminId} updated therapist ${therapistId} status from ${existingTherapist.status} to ${statusData.status}`,\n        );\n\n        return {\n          success: true,\n          therapist: updatedTherapist,\n          previousStatus: existingTherapist.status,\n          newStatus: statusData.status,\n          message: `Therapist status updated to ${statusData.status}`,\n        };\n      });\n    } catch (error) {\n      this.logger.error(\n        `Failed to update therapist status for ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== ANALYTICS AND REPORTING =====\n\n  async getTherapistApplicationMetrics(startDate?: string, endDate?: string) {\n    try {\n      const start = startDate\n        ? new Date(startDate)\n        : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n      const end = endDate ? new Date(endDate) : new Date();\n\n      const [\n        totalApplications,\n        pendingApplications,\n        approvedApplications,\n        rejectedApplications,\n        recentApplications,\n        processingTimes,\n      ] = await Promise.all([\n        // Total applications in period\n        this.prisma.therapist.count({\n          where: {\n            submissionDate: { gte: start, lte: end },\n          },\n        }),\n        // Pending applications\n        this.prisma.therapist.count({\n          where: {\n            status: 'pending',\n            submissionDate: { gte: start, lte: end },\n          },\n        }),\n        // Approved applications in period\n        this.prisma.therapist.count({\n          where: {\n            status: 'approved',\n            processingDate: { gte: start, lte: end },\n          },\n        }),\n        // Rejected applications in period\n        this.prisma.therapist.count({\n          where: {\n            status: 'rejected',\n            processingDate: { gte: start, lte: end },\n          },\n        }),\n        // Recent applications for trend analysis\n        this.prisma.therapist.findMany({\n          where: {\n            submissionDate: { gte: start, lte: end },\n          },\n          select: {\n            submissionDate: true,\n            status: true,\n            processingDate: true,\n          },\n          orderBy: { submissionDate: 'desc' },\n        }),\n        // Processing times for approved/rejected applications\n        this.prisma.therapist.findMany({\n          where: {\n            processingDate: { gte: start, lte: end },\n            status: { in: ['approved', 'rejected'] },\n          },\n          select: {\n            submissionDate: true,\n            processingDate: true,\n            status: true,\n          },\n        }),\n      ]);\n\n      // Calculate average processing time\n      const averageProcessingTime =\n        processingTimes.reduce((acc, app) => {\n          if (app.processingDate && app.submissionDate) {\n            const processingTimeMs =\n              app.processingDate.getTime() - app.submissionDate.getTime();\n            return acc + processingTimeMs / (1000 * 60 * 60 * 24); // Convert to days\n          }\n          return acc;\n        }, 0) / (processingTimes.length || 1);\n\n      // Calculate approval rate\n      const processedApplications = approvedApplications + rejectedApplications;\n      const approvalRate =\n        processedApplications > 0\n          ? (approvedApplications / processedApplications) * 100\n          : 0;\n\n      this.logger.log(\n        `Generated therapist application metrics for period ${start} to ${end}`,\n      );\n\n      return {\n        period: { start, end },\n        summary: {\n          totalApplications,\n          pendingApplications,\n          approvedApplications,\n          rejectedApplications,\n          processedApplications,\n        },\n        metrics: {\n          approvalRate: Math.round(approvalRate * 100) / 100,\n          averageProcessingTimeDays:\n            Math.round(averageProcessingTime * 100) / 100,\n          applicationTrend: this.calculateApplicationTrend(recentApplications),\n        },\n        recentActivity: recentApplications.slice(0, 10),\n      };\n    } catch (error) {\n      this.logger.error(\n        'Failed to generate therapist application metrics:',\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== HELPER METHODS =====\n\n  private getValidStatusTransitions(currentStatus: string): string[] {\n    const transitions = {\n      pending: ['approved', 'rejected', 'under_review'],\n      under_review: ['approved', 'rejected', 'pending'],\n      approved: ['suspended', 'under_review'],\n      rejected: ['pending', 'under_review'], // Allow resubmission\n      suspended: ['approved', 'rejected'],\n    };\n\n    return transitions[currentStatus] || [];\n  }\n\n  private getStatusChangeNotificationTitle(status: string): string {\n    const titles = {\n      approved: 'Application Approved!',\n      rejected: 'Application Status Update',\n      suspended: 'Account Suspended',\n      under_review: 'Application Under Review',\n      pending: 'Application Status Changed',\n    };\n\n    return titles[status] || 'Status Update';\n  }\n\n  private getStatusChangeNotificationMessage(\n    status: string,\n    reason?: string,\n  ): string {\n    const baseMessages = {\n      approved:\n        'Congratulations! Your therapist application has been approved.',\n      rejected: 'Your therapist application has been reviewed.',\n      suspended: 'Your therapist account has been temporarily suspended.',\n      under_review: 'Your application is currently under additional review.',\n      pending: 'Your application status has been updated.',\n    };\n\n    const baseMessage =\n      baseMessages[status] || 'Your account status has been updated.';\n    return reason ? `${baseMessage} Reason: ${reason}` : baseMessage;\n  }\n\n  private calculateApplicationTrend(\n    applications: any[],\n  ): 'increasing' | 'decreasing' | 'stable' {\n    if (applications.length < 7) return 'stable';\n\n    const now = new Date();\n    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);\n\n    const recentWeekCount = applications.filter(\n      (app) => app.submissionDate >= weekAgo,\n    ).length;\n    const previousWeekCount = applications.filter(\n      (app) =>\n        app.submissionDate >= twoWeeksAgo && app.submissionDate < weekAgo,\n    ).length;\n\n    if (recentWeekCount > previousWeekCount * 1.1) return 'increasing';\n    if (recentWeekCount < previousWeekCount * 0.9) return 'decreasing';\n    return 'stable';\n  }\n}\n"],"version":3}