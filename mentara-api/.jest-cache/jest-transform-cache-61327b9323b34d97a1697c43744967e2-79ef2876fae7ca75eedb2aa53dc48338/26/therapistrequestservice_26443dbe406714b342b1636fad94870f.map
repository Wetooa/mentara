{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/services/therapist-request.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/services/therapist-request.service.ts"],"sourcesContent":["import {\n  Injectable,\n  Logger,\n  NotFoundException,\n  ConflictException,\n  BadRequestException,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { NotificationsService } from '../../notifications/notifications.service';\nimport { Prisma } from '@prisma/client';\nimport {\n  type TherapistRequestResponseDto,\n  type TherapistRequestFiltersDto,\n  type BulkTherapistActionDto,\n} from 'mentara-commons';\n\n@Injectable()\nexport class TherapistRequestService {\n  private readonly logger = new Logger(TherapistRequestService.name);\n\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly notificationsService: NotificationsService,\n  ) {}\n\n  // ===== RETRIEVING THERAPIST REQUESTS =====\n\n  async getTherapistRequests(\n    therapistId: string,\n    filters: TherapistRequestFiltersDto,\n  ) {\n    try {\n      const {\n        status,\n        priority,\n        clientId,\n        requestedAfter,\n        requestedBefore,\n        respondedAfter,\n        respondedBefore,\n        page = 1,\n        limit = 20,\n        sortBy = 'requestedAt',\n        sortOrder = 'desc',\n        includeExpired = false,\n      } = filters;\n\n      const skip = (page - 1) * limit;\n      const where: Prisma.ClientTherapistRequestWhereInput = {\n        therapistId,\n      };\n\n      // Apply filters\n      if (status) where.status = status;\n      if (priority) where.priority = priority;\n      if (clientId) where.clientId = clientId;\n      if (requestedAfter) where.requestedAt = { gte: new Date(requestedAfter) };\n      if (requestedBefore) {\n        where.requestedAt = {\n          ...(typeof where.requestedAt === 'object' ? where.requestedAt : {}),\n          lte: new Date(requestedBefore),\n        };\n      }\n      if (respondedAfter) where.respondedAt = { gte: new Date(respondedAfter) };\n      if (respondedBefore) {\n        where.respondedAt = {\n          ...(typeof where.respondedAt === 'object' ? where.respondedAt : {}),\n          lte: new Date(respondedBefore),\n        };\n      }\n\n      // Exclude expired requests unless specifically requested\n      if (!includeExpired) {\n        where.status = { not: 'EXPIRED' };\n      }\n\n      const [requests, totalCount] = await Promise.all([\n        this.prisma.clientTherapistRequest.findMany({\n          where,\n          skip,\n          take: limit,\n          orderBy: { [sortBy]: sortOrder },\n          include: {\n            client: {\n              include: {\n                user: {\n                  select: {\n                    firstName: true,\n                    lastName: true,\n                    avatarUrl: true,\n                    createdAt: true,\n                  },\n                },\n              },\n            },\n          },\n        }),\n        this.prisma.clientTherapistRequest.count({ where }),\n      ]);\n\n      // Get summary statistics\n      const [pendingCount, highPriorityCount] = await Promise.all([\n        this.prisma.clientTherapistRequest.count({\n          where: { therapistId, status: 'PENDING' },\n        }),\n        this.prisma.clientTherapistRequest.count({\n          where: {\n            therapistId,\n            status: 'PENDING',\n            priority: { in: ['HIGH', 'URGENT'] },\n          },\n        }),\n      ]);\n\n      this.logger.log(\n        `Retrieved ${requests.length} requests for therapist ${therapistId}`,\n      );\n\n      return {\n        requests,\n        pagination: {\n          page,\n          limit,\n          totalCount,\n          totalPages: Math.ceil(totalCount / limit),\n        },\n        summary: {\n          pendingCount,\n          highPriorityCount,\n          filteredCount: requests.length,\n        },\n        filters,\n      };\n    } catch (error) {\n      this.logger.error(\n        `Failed to retrieve requests for therapist ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== ACCEPTING CLIENT REQUESTS =====\n\n  async acceptClientRequest(\n    requestId: string,\n    therapistId: string,\n    responseDto: TherapistRequestResponseDto,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // 1. Verify request exists and belongs to therapist\n        const existingRequest = await tx.clientTherapistRequest.findUnique({\n          where: { id: requestId },\n          include: {\n            client: {\n              include: {\n                user: {\n                  select: {\n                    firstName: true,\n                    lastName: true,\n                    email: true,\n                  },\n                },\n              },\n            },\n            therapist: {\n              include: {\n                user: {\n                  select: {\n                    firstName: true,\n                    lastName: true,\n                  },\n                },\n              },\n            },\n          },\n        });\n\n        if (!existingRequest) {\n          throw new NotFoundException(`Request with ID ${requestId} not found`);\n        }\n\n        if (existingRequest.therapistId !== therapistId) {\n          throw new ForbiddenException(\n            'You can only respond to your own requests',\n          );\n        }\n\n        if (existingRequest.status !== 'PENDING') {\n          throw new BadRequestException(\n            `Cannot accept request with status ${existingRequest.status}`,\n          );\n        }\n\n        // 2. Check if request has expired\n        if (\n          existingRequest.expiresAt &&\n          existingRequest.expiresAt < new Date()\n        ) {\n          await tx.clientTherapistRequest.update({\n            where: { id: requestId },\n            data: { status: 'EXPIRED', respondedAt: new Date() },\n          });\n          throw new BadRequestException(\n            'Request has expired and cannot be accepted',\n          );\n        }\n\n        // 3. Verify therapist is still approved and active\n        const therapist = await tx.therapist.findUnique({\n          where: { userId: therapistId },\n          include: { user: true },\n        });\n\n        if (\n          !therapist ||\n          therapist.status !== 'approved' ||\n          !therapist.user.isActive\n        ) {\n          throw new BadRequestException(\n            'Therapist is not currently approved or active',\n          );\n        }\n\n        // 4. Check for existing client-therapist relationship\n        const existingRelationship = await tx.clientTherapist.findFirst({\n          where: {\n            clientId: existingRequest.clientId,\n            therapistId,\n            status: 'active',\n          },\n        });\n\n        if (existingRelationship) {\n          throw new ConflictException(\n            'Client already has an active relationship with this therapist',\n          );\n        }\n\n        // 5. Update request status to accepted\n        const acceptedRequest = await tx.clientTherapistRequest.update({\n          where: { id: requestId },\n          data: {\n            status: 'ACCEPTED',\n            respondedAt: new Date(),\n            therapistResponse: responseDto.response,\n          },\n        });\n\n        // 6. Create client-therapist relationship\n        const clientTherapistRelationship = await tx.clientTherapist.create({\n          data: {\n            clientId: existingRequest.clientId,\n            therapistId,\n            status: 'active',\n            assignedAt: new Date(),\n            notes: `Relationship started from accepted request. ${responseDto.schedulingMessage || ''}`,\n          },\n        });\n\n        // 7. Send acceptance notification to client\n        await this.notificationsService.create({\n          userId: existingRequest.clientId,\n          title: 'Therapist Request Accepted!',\n          message: `${existingRequest.therapist.user.firstName} ${existingRequest.therapist.user.lastName} has accepted your therapy request. ${responseDto.response}`,\n          type: 'THERAPIST_REQUEST_ACCEPTED',\n          priority: 'HIGH',\n          actionUrl: `/client/therapists/${therapistId}`,\n          data: {\n            requestId,\n            therapistId,\n            relationshipId: clientTherapistRelationship.id,\n            response: responseDto.response,\n            schedulingMessage: responseDto.schedulingMessage,\n          },\n        });\n\n        // 8. Send additional scheduling notification if provided\n        if (responseDto.schedulingMessage) {\n          await this.notificationsService.create({\n            userId: existingRequest.clientId,\n            title: 'Scheduling Information',\n            message: responseDto.schedulingMessage,\n            type: 'SCHEDULING_INFO',\n            priority: 'NORMAL',\n            actionUrl: `/client/therapists/${therapistId}/schedule`,\n          });\n        }\n\n        // 9. Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: therapistId,\n            action: 'ACCEPT_CLIENT_REQUEST',\n            entity: 'client_therapist_request',\n            entityId: requestId,\n            metadata: {\n              requestId,\n              clientId: existingRequest.clientId,\n              relationshipId: clientTherapistRelationship.id,\n              hasSchedulingMessage: !!responseDto.schedulingMessage,\n              preferredContactMethod: responseDto.preferredContactMethod,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        this.logger.log(\n          `Therapist ${therapistId} accepted request ${requestId} from client ${existingRequest.clientId}`,\n        );\n\n        return {\n          success: true,\n          request: acceptedRequest,\n          relationship: clientTherapistRelationship,\n          message: 'Client request accepted successfully',\n          nextSteps: {\n            scheduleSession: responseDto.schedulingMessage\n              ? 'Contact information provided'\n              : 'Schedule first session',\n            clientNotified: true,\n            relationshipEstablished: true,\n          },\n        };\n      });\n    } catch (error) {\n      this.logger.error(\n        `Failed to accept request ${requestId} for therapist ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== DECLINING CLIENT REQUESTS =====\n\n  async declineClientRequest(\n    requestId: string,\n    therapistId: string,\n    responseDto: TherapistRequestResponseDto,\n  ) {\n    try {\n      return await this.prisma.$transaction(async (tx) => {\n        // 1. Verify request exists and belongs to therapist\n        const existingRequest = await tx.clientTherapistRequest.findUnique({\n          where: { id: requestId },\n          include: {\n            client: {\n              include: {\n                user: {\n                  select: {\n                    firstName: true,\n                    lastName: true,\n                  },\n                },\n              },\n            },\n            therapist: {\n              include: {\n                user: {\n                  select: {\n                    firstName: true,\n                    lastName: true,\n                  },\n                },\n              },\n            },\n          },\n        });\n\n        if (!existingRequest) {\n          throw new NotFoundException(`Request with ID ${requestId} not found`);\n        }\n\n        if (existingRequest.therapistId !== therapistId) {\n          throw new ForbiddenException(\n            'You can only respond to your own requests',\n          );\n        }\n\n        if (existingRequest.status !== 'PENDING') {\n          throw new BadRequestException(\n            `Cannot decline request with status ${existingRequest.status}`,\n          );\n        }\n\n        // 2. Update request status to declined\n        const declinedRequest = await tx.clientTherapistRequest.update({\n          where: { id: requestId },\n          data: {\n            status: 'DECLINED',\n            respondedAt: new Date(),\n            therapistResponse: responseDto.response,\n          },\n        });\n\n        // 3. Send decline notification to client\n        await this.notificationsService.create({\n          userId: existingRequest.clientId,\n          title: 'Therapist Request Update',\n          message: `${existingRequest.therapist.user.firstName} ${existingRequest.therapist.user.lastName} has responded to your therapy request. ${responseDto.response}`,\n          type: 'THERAPIST_REQUEST_DECLINED',\n          priority: 'NORMAL',\n          actionUrl: '/client/therapists/browse',\n          data: {\n            requestId,\n            therapistId,\n            response: responseDto.response,\n          },\n        });\n\n        // 4. Provide alternative recommendations if therapist suggests\n        if (responseDto.acceptNewClients === false) {\n          await this.notificationsService.create({\n            userId: existingRequest.clientId,\n            title: 'Alternative Therapist Recommendations',\n            message:\n              'We can help you find other qualified therapists who may be a good fit.',\n            type: 'ALTERNATIVE_RECOMMENDATIONS',\n            priority: 'NORMAL',\n            actionUrl: '/client/therapists/recommendations',\n          });\n        }\n\n        // 5. Create audit log\n        await tx.auditLog.create({\n          data: {\n            userId: therapistId,\n            action: 'DECLINE_CLIENT_REQUEST',\n            entity: 'client_therapist_request',\n            entityId: requestId,\n            metadata: {\n              requestId,\n              clientId: existingRequest.clientId,\n              acceptNewClients: responseDto.acceptNewClients,\n              preferredContactMethod: responseDto.preferredContactMethod,\n              timestamp: new Date().toISOString(),\n            },\n          },\n        });\n\n        this.logger.log(\n          `Therapist ${therapistId} declined request ${requestId} from client ${existingRequest.clientId}`,\n        );\n\n        return {\n          success: true,\n          request: declinedRequest,\n          message: 'Client request declined',\n          providedAlternatives: responseDto.acceptNewClients === false,\n        };\n      });\n    } catch (error) {\n      this.logger.error(\n        `Failed to decline request ${requestId} for therapist ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== BULK ACTIONS =====\n\n  async performBulkAction(\n    therapistId: string,\n    actionDto: BulkTherapistActionDto,\n  ) {\n    try {\n      const { requestIds, action, response } = actionDto;\n\n      const results = {\n        successful: [] as any[],\n        failed: [] as any[],\n        totalProcessed: 0,\n      };\n\n      // Process requests sequentially to avoid conflicts\n      for (const requestId of requestIds) {\n        try {\n          let result;\n\n          switch (action) {\n            case 'accept':\n              if (!response) {\n                throw new BadRequestException(\n                  'Response message required for accept action',\n                );\n              }\n              result = await this.acceptClientRequest(requestId, therapistId, {\n                response,\n                acceptNewClients: true,\n                preferredContactMethod: 'platform',\n              });\n              break;\n\n            case 'decline':\n              if (!response) {\n                throw new BadRequestException(\n                  'Response message required for decline action',\n                );\n              }\n              result = await this.declineClientRequest(requestId, therapistId, {\n                response,\n                acceptNewClients: true,\n                preferredContactMethod: 'platform',\n              });\n              break;\n\n            case 'mark_reviewed':\n              // Custom action to mark as reviewed without accepting/declining\n              result = await this.markRequestAsReviewed(requestId, therapistId);\n              break;\n\n            default:\n              throw new BadRequestException(`Invalid action: ${action}`);\n          }\n\n          results.successful.push({\n            requestId,\n            action,\n            status: 'completed',\n          });\n          results.totalProcessed++;\n        } catch (error) {\n          results.failed.push({\n            requestId,\n            action,\n            error: error instanceof Error ? error.message : 'Unknown error',\n          });\n          this.logger.warn(\n            `Failed to ${action} request ${requestId}: ${error instanceof Error ? error.message : 'Unknown error'}`,\n          );\n        }\n      }\n\n      this.logger.log(\n        `Therapist ${therapistId} performed bulk ${action}: ${results.totalProcessed} successful, ${results.failed.length} failed`,\n      );\n\n      return {\n        success: true,\n        results,\n        summary: {\n          totalRequested: requestIds.length,\n          totalProcessed: results.totalProcessed,\n          totalFailed: results.failed.length,\n          action,\n        },\n      };\n    } catch (error) {\n      this.logger.error(\n        `Failed to perform bulk action for therapist ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== STATISTICS AND ANALYTICS =====\n\n  async getTherapistRequestStatistics(therapistId: string) {\n    try {\n      const [\n        totalReceived,\n        pending,\n        accepted,\n        declined,\n        expired,\n        recentRequests,\n        activeRelationships,\n      ] = await Promise.all([\n        // Total requests received\n        this.prisma.clientTherapistRequest.count({\n          where: { therapistId },\n        }),\n        // Pending requests\n        this.prisma.clientTherapistRequest.count({\n          where: { therapistId, status: 'PENDING' },\n        }),\n        // Accepted requests\n        this.prisma.clientTherapistRequest.count({\n          where: { therapistId, status: 'ACCEPTED' },\n        }),\n        // Declined requests\n        this.prisma.clientTherapistRequest.count({\n          where: { therapistId, status: 'DECLINED' },\n        }),\n        // Expired requests\n        this.prisma.clientTherapistRequest.count({\n          where: { therapistId, status: 'EXPIRED' },\n        }),\n        // Recent requests for response time calculation\n        this.prisma.clientTherapistRequest.findMany({\n          where: {\n            therapistId,\n            respondedAt: { not: null },\n          },\n          select: {\n            requestedAt: true,\n            respondedAt: true,\n          },\n          orderBy: { respondedAt: 'desc' },\n          take: 20,\n        }),\n        // Active client relationships\n        this.prisma.clientTherapist.count({\n          where: { therapistId, status: 'active' },\n        }),\n      ]);\n\n      // Calculate acceptance rate\n      const totalResponded = accepted + declined;\n      const acceptanceRate =\n        totalResponded > 0 ? (accepted / totalResponded) * 100 : 0;\n\n      // Calculate average response time\n      const responseTimes = recentRequests\n        .filter((req) => req.respondedAt)\n        .map((req) => {\n          const responseTime =\n            req.respondedAt!.getTime() - req.requestedAt.getTime();\n          return responseTime / (1000 * 60 * 60); // Convert to hours\n        });\n\n      const averageResponseTime =\n        responseTimes.length > 0\n          ? responseTimes.reduce((sum, time) => sum + time, 0) /\n            responseTimes.length\n          : 0;\n\n      // Get last request and response dates\n      const lastRequest = await this.prisma.clientTherapistRequest.findFirst({\n        where: { therapistId },\n        orderBy: { requestedAt: 'desc' },\n        select: { requestedAt: true },\n      });\n\n      const lastResponse = await this.prisma.clientTherapistRequest.findFirst({\n        where: { therapistId, respondedAt: { not: null } },\n        orderBy: { respondedAt: 'desc' },\n        select: { respondedAt: true },\n      });\n\n      this.logger.log(\n        `Generated request statistics for therapist ${therapistId}`,\n      );\n\n      return {\n        totalReceived,\n        pending,\n        accepted,\n        declined,\n        expired,\n        activeRelationships,\n        acceptanceRate: Math.round(acceptanceRate * 100) / 100,\n        averageResponseTime: Math.round(averageResponseTime * 100) / 100,\n        lastRequestAt: lastRequest?.requestedAt || null,\n        lastResponseAt: lastResponse?.respondedAt || null,\n      };\n    } catch (error) {\n      this.logger.error(\n        `Failed to generate statistics for therapist ${therapistId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  // ===== UTILITY METHODS =====\n\n  private async markRequestAsReviewed(requestId: string, therapistId: string) {\n    // Custom method for marking requests as reviewed without formal response\n    const request = await this.prisma.clientTherapistRequest.findUnique({\n      where: { id: requestId },\n    });\n\n    if (!request || request.therapistId !== therapistId) {\n      throw new NotFoundException(\n        `Request ${requestId} not found or not accessible`,\n      );\n    }\n\n    // This could update a custom \"reviewed\" field if it existed in the schema\n    // For now, we'll just log the review action\n    await this.prisma.auditLog.create({\n      data: {\n        userId: therapistId,\n        action: 'REVIEW_CLIENT_REQUEST',\n        entity: 'client_therapist_request',\n        entityId: requestId,\n        metadata: {\n          requestId,\n          reviewedAt: new Date().toISOString(),\n        },\n      },\n    });\n\n    return {\n      success: true,\n      requestId,\n      message: 'Request marked as reviewed',\n    };\n  }\n}\n"],"version":3}