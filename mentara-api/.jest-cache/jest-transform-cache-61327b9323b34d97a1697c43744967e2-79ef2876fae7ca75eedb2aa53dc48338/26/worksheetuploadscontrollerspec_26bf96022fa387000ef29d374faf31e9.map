{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/worksheets/worksheet-uploads.controller.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/worksheets/worksheet-uploads.controller.spec.ts"],"sourcesContent":["/**\n * Comprehensive Test Suite for WorksheetUploadsController\n * Tests file upload functionality for worksheet materials and submissions\n */\n\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { BadRequestException, HttpException } from '@nestjs/common';\nimport { WorksheetUploadsController } from './worksheet-uploads.controller';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { SupabaseStorageService } from '../common/services/supabase-storage.service';\nimport { SecurityGuardTestUtils, RoleBasedTestUtils } from '../test-utils/auth-testing-helpers';\nimport { MockBuilder, TestDataGenerator, TestAssertions } from '../test-utils/enhanced-test-helpers';\nimport { TEST_USER_IDS, TEST_EMAILS } from '../test-utils/index';\n\ndescribe('WorksheetUploadsController', () => {\n  let controller: WorksheetUploadsController;\n  let prismaService: PrismaService;\n  let supabaseStorageService: SupabaseStorageService;\n  let module: TestingModule;\n\n  // Mock PrismaService\n  const mockPrismaService = {\n    worksheet: {\n      findUnique: jest.fn(),\n      update: jest.fn(),\n    },\n  };\n\n  // Mock SupabaseStorageService\n  const mockSupabaseStorageService = {\n    validateFile: jest.fn(),\n    uploadFile: jest.fn(),\n    deleteFile: jest.fn(),\n    getFileUrl: jest.fn(),\n  };\n\n  // Mock static method\n  const mockGetSupportedBuckets = jest.fn().mockReturnValue({\n    WORKSHEETS: 'worksheets',\n    MATERIALS: 'materials',\n    SUBMISSIONS: 'submissions',\n  });\n\n  // Test data\n  const mockWorksheet = {\n    id: 'worksheet_123456789',\n    title: 'Anxiety Management Worksheet',\n    description: 'Weekly exercises for managing anxiety',\n    content: 'Complete the following exercises...',\n    status: 'assigned',\n    clientId: TEST_USER_IDS.CLIENT,\n    therapistId: TEST_USER_IDS.THERAPIST,\n    materialUrls: [],\n    materialNames: [],\n    materialSizes: [],\n    submissionUrls: [],\n    submissionNames: [],\n    submissionSizes: [],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n\n  const mockFile = {\n    fieldname: 'file',\n    originalname: 'worksheet-material.pdf',\n    encoding: '7bit',\n    mimetype: 'application/pdf',\n    buffer: Buffer.from('fake pdf content'),\n    size: 1024000,\n  } as Express.Multer.File;\n\n  const mockUploadResult = {\n    filename: 'unique-filename-123.pdf',\n    url: 'https://storage.example.com/worksheets/unique-filename-123.pdf',\n    size: 1024000,\n    contentType: 'application/pdf',\n  };\n\n  const mockValidation = {\n    isValid: true,\n    error: null,\n  };\n\n  beforeEach(async () => {\n    // Mock the static method\n    jest.spyOn(SupabaseStorageService, 'getSupportedBuckets').mockImplementation(\n      mockGetSupportedBuckets\n    );\n\n    module = await Test.createTestingModule({\n      controllers: [WorksheetUploadsController],\n      providers: [\n        {\n          provide: PrismaService,\n          useValue: mockPrismaService,\n        },\n        {\n          provide: SupabaseStorageService,\n          useValue: mockSupabaseStorageService,\n        },\n      ],\n    }).compile();\n\n    controller = module.get<WorksheetUploadsController>(WorksheetUploadsController);\n    prismaService = module.get<PrismaService>(PrismaService);\n    supabaseStorageService = module.get<SupabaseStorageService>(SupabaseStorageService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Controller Initialization', () => {\n    it('should be defined', () => {\n      expect(controller).toBeDefined();\n    });\n\n    it('should have all services injected', () => {\n      expect(prismaService).toBeDefined();\n      expect(supabaseStorageService).toBeDefined();\n    });\n  });\n\n  describe('POST /worksheets/upload', () => {\n    beforeEach(() => {\n      mockPrismaService.worksheet.findUnique.mockResolvedValue(mockWorksheet);\n      mockSupabaseStorageService.validateFile.mockReturnValue(mockValidation);\n      mockSupabaseStorageService.uploadFile.mockResolvedValue(mockUploadResult);\n      mockPrismaService.worksheet.update.mockResolvedValue({\n        ...mockWorksheet,\n        materialUrls: [mockUploadResult.url],\n        materialNames: [mockFile.originalname],\n        materialSizes: [mockFile.size],\n      });\n    });\n\n    describe('Material Upload', () => {\n      it('should upload material file successfully', async () => {\n        const result = await controller.uploadFile(\n          mockFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result).toEqual({\n          id: mockUploadResult.filename,\n          filename: mockFile.originalname,\n          url: mockUploadResult.url,\n          fileSize: mockFile.size,\n          fileType: mockFile.mimetype,\n        });\n\n        expect(prismaService.worksheet.findUnique).toHaveBeenCalledWith({\n          where: { id: 'worksheet_123456789' },\n        });\n\n        expect(supabaseStorageService.validateFile).toHaveBeenCalledWith(\n          mockFile,\n          5 * 1024 * 1024,\n          [\n            'application/pdf',\n            'application/msword',\n            'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n            'text/plain',\n            'image/jpeg',\n            'image/png',\n          ]\n        );\n\n        expect(supabaseStorageService.uploadFile).toHaveBeenCalledWith(\n          mockFile,\n          'worksheets'\n        );\n\n        expect(prismaService.worksheet.update).toHaveBeenCalledWith({\n          where: { id: 'worksheet_123456789' },\n          data: {\n            materialUrls: { push: mockUploadResult.url },\n            materialNames: { push: mockFile.originalname },\n            materialSizes: { push: mockFile.size },\n          },\n        });\n      });\n\n      it('should handle PDF file upload', async () => {\n        const pdfFile = {\n          ...mockFile,\n          originalname: 'guide.pdf',\n          mimetype: 'application/pdf',\n        };\n\n        const result = await controller.uploadFile(\n          pdfFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result.filename).toBe('guide.pdf');\n        expect(result.fileType).toBe('application/pdf');\n      });\n\n      it('should handle DOCX file upload', async () => {\n        const docxFile = {\n          ...mockFile,\n          originalname: 'template.docx',\n          mimetype: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        };\n\n        const result = await controller.uploadFile(\n          docxFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result.filename).toBe('template.docx');\n        expect(result.fileType).toBe('application/vnd.openxmlformats-officedocument.wordprocessingml.document');\n      });\n\n      it('should handle image file upload', async () => {\n        const imageFile = {\n          ...mockFile,\n          originalname: 'diagram.png',\n          mimetype: 'image/png',\n        };\n\n        const result = await controller.uploadFile(\n          imageFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result.filename).toBe('diagram.png');\n        expect(result.fileType).toBe('image/png');\n      });\n    });\n\n    describe('Submission Upload', () => {\n      it('should upload submission file successfully', async () => {\n        const submissionUpdate = {\n          ...mockWorksheet,\n          submissionUrls: [mockUploadResult.url],\n          submissionNames: [mockFile.originalname],\n          submissionSizes: [mockFile.size],\n        };\n        mockPrismaService.worksheet.update.mockResolvedValue(submissionUpdate);\n\n        const result = await controller.uploadFile(\n          mockFile,\n          'worksheet_123456789',\n          'submission'\n        );\n\n        expect(result).toEqual({\n          id: mockUploadResult.filename,\n          filename: mockFile.originalname,\n          url: mockUploadResult.url,\n          fileSize: mockFile.size,\n          fileType: mockFile.mimetype,\n        });\n\n        expect(prismaService.worksheet.update).toHaveBeenCalledWith({\n          where: { id: 'worksheet_123456789' },\n          data: {\n            submissionUrls: { push: mockUploadResult.url },\n            submissionNames: { push: mockFile.originalname },\n            submissionSizes: { push: mockFile.size },\n          },\n        });\n      });\n\n      it('should handle text file submissions', async () => {\n        const textFile = {\n          ...mockFile,\n          originalname: 'notes.txt',\n          mimetype: 'text/plain',\n        };\n\n        const result = await controller.uploadFile(\n          textFile,\n          'worksheet_123456789',\n          'submission'\n        );\n\n        expect(result.filename).toBe('notes.txt');\n        expect(result.fileType).toBe('text/plain');\n      });\n    });\n\n    describe('Input Validation', () => {\n      it('should throw error when no file is uploaded', async () => {\n        await expect(\n          controller.uploadFile(null as any, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(new BadRequestException('No file uploaded'));\n      });\n\n      it('should throw error when worksheetId is missing', async () => {\n        await expect(\n          controller.uploadFile(mockFile, '', 'material')\n        ).rejects.toThrow(new BadRequestException('Worksheet ID is required'));\n\n        await expect(\n          controller.uploadFile(mockFile, null as any, 'material')\n        ).rejects.toThrow(new BadRequestException('Worksheet ID is required'));\n      });\n\n      it('should throw error when type is missing', async () => {\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', '' as any)\n        ).rejects.toThrow(new BadRequestException('Type must be either \"material\" or \"submission\"'));\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', null as any)\n        ).rejects.toThrow(new BadRequestException('Type must be either \"material\" or \"submission\"'));\n      });\n\n      it('should throw error when type is invalid', async () => {\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'invalid' as any)\n        ).rejects.toThrow(new BadRequestException('Type must be either \"material\" or \"submission\"'));\n      });\n    });\n\n    describe('Worksheet Validation', () => {\n      it('should throw error when worksheet does not exist', async () => {\n        mockPrismaService.worksheet.findUnique.mockResolvedValue(null);\n\n        await expect(\n          controller.uploadFile(mockFile, 'nonexistent-worksheet', 'material')\n        ).rejects.toThrow(new BadRequestException('Worksheet with ID nonexistent-worksheet not found'));\n      });\n\n      it('should handle database errors during worksheet lookup', async () => {\n        const dbError = new Error('Database connection failed');\n        mockPrismaService.worksheet.findUnique.mockRejectedValue(dbError);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(HttpException);\n      });\n    });\n\n    describe('File Validation', () => {\n      it('should reject files that fail validation', async () => {\n        const invalidValidation = {\n          isValid: false,\n          error: 'File size exceeds limit',\n        };\n        mockSupabaseStorageService.validateFile.mockReturnValue(invalidValidation);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(new BadRequestException('File validation failed: File size exceeds limit'));\n      });\n\n      it('should reject unsupported file types', async () => {\n        const unsupportedValidation = {\n          isValid: false,\n          error: 'Unsupported file type',\n        };\n        mockSupabaseStorageService.validateFile.mockReturnValue(unsupportedValidation);\n\n        const unsupportedFile = {\n          ...mockFile,\n          originalname: 'malware.exe',\n          mimetype: 'application/x-executable',\n        };\n\n        await expect(\n          controller.uploadFile(unsupportedFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(new BadRequestException('File validation failed: Unsupported file type'));\n      });\n\n      it('should reject files that are too large', async () => {\n        const oversizedValidation = {\n          isValid: false,\n          error: 'File size exceeds 5MB limit',\n        };\n        mockSupabaseStorageService.validateFile.mockReturnValue(oversizedValidation);\n\n        const largeFile = {\n          ...mockFile,\n          size: 10 * 1024 * 1024, // 10MB\n        };\n\n        await expect(\n          controller.uploadFile(largeFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(new BadRequestException('File validation failed: File size exceeds 5MB limit'));\n      });\n\n      it('should validate against correct mime types', async () => {\n        await controller.uploadFile(mockFile, 'worksheet_123456789', 'material');\n\n        expect(supabaseStorageService.validateFile).toHaveBeenCalledWith(\n          mockFile,\n          5 * 1024 * 1024, // 5MB limit\n          [\n            'application/pdf',\n            'application/msword',\n            'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n            'text/plain',\n            'image/jpeg',\n            'image/png',\n          ]\n        );\n      });\n    });\n\n    describe('Storage Upload', () => {\n      it('should handle storage upload errors', async () => {\n        const uploadError = new Error('Storage service unavailable');\n        mockSupabaseStorageService.uploadFile.mockRejectedValue(uploadError);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(HttpException);\n      });\n\n      it('should upload to correct bucket', async () => {\n        await controller.uploadFile(mockFile, 'worksheet_123456789', 'material');\n\n        expect(supabaseStorageService.uploadFile).toHaveBeenCalledWith(\n          mockFile,\n          'worksheets'\n        );\n      });\n\n      it('should handle storage bucket configuration errors', async () => {\n        mockGetSupportedBuckets.mockReturnValue({});\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(HttpException);\n      });\n    });\n\n    describe('Database Updates', () => {\n      it('should handle database update errors for materials', async () => {\n        const updateError = new Error('Database update failed');\n        mockPrismaService.worksheet.update.mockRejectedValue(updateError);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(HttpException);\n      });\n\n      it('should handle database update errors for submissions', async () => {\n        const updateError = new Error('Database update failed');\n        mockPrismaService.worksheet.update.mockRejectedValue(updateError);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'submission')\n        ).rejects.toThrow(HttpException);\n      });\n\n      it('should update material arrays correctly', async () => {\n        await controller.uploadFile(mockFile, 'worksheet_123456789', 'material');\n\n        expect(prismaService.worksheet.update).toHaveBeenCalledWith({\n          where: { id: 'worksheet_123456789' },\n          data: {\n            materialUrls: { push: mockUploadResult.url },\n            materialNames: { push: mockFile.originalname },\n            materialSizes: { push: mockFile.size },\n          },\n        });\n      });\n\n      it('should update submission arrays correctly', async () => {\n        await controller.uploadFile(mockFile, 'worksheet_123456789', 'submission');\n\n        expect(prismaService.worksheet.update).toHaveBeenCalledWith({\n          where: { id: 'worksheet_123456789' },\n          data: {\n            submissionUrls: { push: mockUploadResult.url },\n            submissionNames: { push: mockFile.originalname },\n            submissionSizes: { push: mockFile.size },\n          },\n        });\n      });\n    });\n\n    describe('Response Format', () => {\n      it('should return properly formatted response', async () => {\n        const result = await controller.uploadFile(\n          mockFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result).toHaveProperty('id');\n        expect(result).toHaveProperty('filename');\n        expect(result).toHaveProperty('url');\n        expect(result).toHaveProperty('fileSize');\n        expect(result).toHaveProperty('fileType');\n\n        expect(result.id).toBe(mockUploadResult.filename);\n        expect(result.filename).toBe(mockFile.originalname);\n        expect(result.url).toBe(mockUploadResult.url);\n        expect(result.fileSize).toBe(mockFile.size);\n        expect(result.fileType).toBe(mockFile.mimetype);\n      });\n\n      it('should maintain filename integrity', async () => {\n        const specialFile = {\n          ...mockFile,\n          originalname: 'special-chars-file_name (1).pdf',\n        };\n\n        const result = await controller.uploadFile(\n          specialFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result.filename).toBe('special-chars-file_name (1).pdf');\n      });\n\n      it('should handle unicode filenames', async () => {\n        const unicodeFile = {\n          ...mockFile,\n          originalname: 'مستند-عربي.pdf',\n        };\n\n        const result = await controller.uploadFile(\n          unicodeFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        expect(result.filename).toBe('مستند-عربي.pdf');\n      });\n    });\n\n    describe('Error Handling', () => {\n      it('should preserve BadRequestException errors', async () => {\n        const badRequestError = new BadRequestException('Custom validation error');\n        mockSupabaseStorageService.validateFile.mockImplementation(() => {\n          throw badRequestError;\n        });\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(badRequestError);\n      });\n\n      it('should wrap other errors in HttpException', async () => {\n        const genericError = new Error('Unexpected error');\n        mockSupabaseStorageService.uploadFile.mockRejectedValue(genericError);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(HttpException);\n\n        try {\n          await controller.uploadFile(mockFile, 'worksheet_123456789', 'material');\n        } catch (error) {\n          expect(error).toBeInstanceOf(HttpException);\n          expect(error.message).toContain('Failed to upload file: Unexpected error');\n        }\n      });\n\n      it('should handle errors without error message', async () => {\n        const nonErrorObject = 'string error';\n        mockSupabaseStorageService.uploadFile.mockRejectedValue(nonErrorObject);\n\n        await expect(\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        ).rejects.toThrow(HttpException);\n\n        try {\n          await controller.uploadFile(mockFile, 'worksheet_123456789', 'material');\n        } catch (error) {\n          expect(error).toBeInstanceOf(HttpException);\n          expect(error.message).toContain('Failed to upload file: Unknown error');\n        }\n      });\n    });\n\n    describe('Multiple File Types', () => {\n      const fileTypes = [\n        {\n          name: 'PDF document',\n          file: { ...mockFile, originalname: 'document.pdf', mimetype: 'application/pdf' },\n        },\n        {\n          name: 'Word document',\n          file: { ...mockFile, originalname: 'document.docx', mimetype: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' },\n        },\n        {\n          name: 'Text file',\n          file: { ...mockFile, originalname: 'notes.txt', mimetype: 'text/plain' },\n        },\n        {\n          name: 'JPEG image',\n          file: { ...mockFile, originalname: 'image.jpg', mimetype: 'image/jpeg' },\n        },\n        {\n          name: 'PNG image',\n          file: { ...mockFile, originalname: 'diagram.png', mimetype: 'image/png' },\n        },\n      ];\n\n      fileTypes.forEach(({ name, file }) => {\n        it(`should handle ${name} upload correctly`, async () => {\n          const result = await controller.uploadFile(\n            file,\n            'worksheet_123456789',\n            'material'\n          );\n\n          expect(result.filename).toBe(file.originalname);\n          expect(result.fileType).toBe(file.mimetype);\n        });\n      });\n    });\n\n    describe('Integration Scenarios', () => {\n      it('should handle complete upload workflow', async () => {\n        const result = await controller.uploadFile(\n          mockFile,\n          'worksheet_123456789',\n          'material'\n        );\n\n        // Verify the complete flow\n        expect(prismaService.worksheet.findUnique).toHaveBeenCalledTimes(1);\n        expect(supabaseStorageService.validateFile).toHaveBeenCalledTimes(1);\n        expect(supabaseStorageService.uploadFile).toHaveBeenCalledTimes(1);\n        expect(prismaService.worksheet.update).toHaveBeenCalledTimes(1);\n\n        // Verify result format\n        expect(result).toEqual({\n          id: mockUploadResult.filename,\n          filename: mockFile.originalname,\n          url: mockUploadResult.url,\n          fileSize: mockFile.size,\n          fileType: mockFile.mimetype,\n        });\n      });\n\n      it('should handle concurrent uploads gracefully', async () => {\n        const promises = Array(3).fill(null).map(() =>\n          controller.uploadFile(mockFile, 'worksheet_123456789', 'material')\n        );\n\n        const results = await Promise.all(promises);\n\n        expect(results).toHaveLength(3);\n        results.forEach(result => {\n          expect(result.filename).toBe(mockFile.originalname);\n        });\n      });\n    });\n  });\n});"],"version":3}