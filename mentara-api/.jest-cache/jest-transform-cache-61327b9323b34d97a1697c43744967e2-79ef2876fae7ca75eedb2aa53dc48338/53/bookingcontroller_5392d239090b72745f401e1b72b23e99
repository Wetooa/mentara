6dcb12f6e6fc48cf4d00e63f21198b23
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.BookingController = void 0;
const common_1 = require("@nestjs/common");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const current_user_id_decorator_1 = require("../auth/decorators/current-user-id.decorator");
const current_user_role_decorator_1 = require("../auth/decorators/current-user-role.decorator");
const zod_validation_pipe_1 = require("../common/pipes/zod-validation.pipe");
const booking_service_1 = require("./booking.service");
const swagger_1 = require("@nestjs/swagger");
const mentara_commons_1 = require("mentara-commons");
let BookingController = class BookingController {
    bookingService;
    constructor(bookingService) {
        this.bookingService = bookingService;
    }
    // Meeting endpoints
    async createMeeting(createMeetingDto, userId, role) {
        // Only clients can book meetings, but we'll validate the relationship in the service
        if (role !== 'client') {
            throw new common_1.ForbiddenException('Only clients can book meetings');
        }
        return this.bookingService.createMeeting(createMeetingDto, userId);
    }
    async getMeetings(userId, role) {
        return this.bookingService.getMeetings(userId, role);
    }
    async getMeeting(params, userId, role) {
        return this.bookingService.getMeeting(params.id, userId, role);
    }
    async updateMeeting(params, updateMeetingDto, userId, role) {
        return this.bookingService.updateMeeting(params.id, updateMeetingDto, userId, role);
    }
    async cancelMeeting(params, userId, role) {
        return this.bookingService.cancelMeeting(params.id, userId, role);
    }
    // Availability endpoints (therapist only)
    async createAvailability(createAvailabilityDto, therapistId, role) {
        if (role !== 'therapist') {
            throw new common_1.UnauthorizedException('Only therapists can manage availability');
        }
        return this.bookingService.createAvailability(createAvailabilityDto, therapistId);
    }
    async getAvailability(therapistId, role) {
        if (role !== 'therapist') {
            throw new common_1.UnauthorizedException('Only therapists can view their availability');
        }
        return this.bookingService.getAvailability(therapistId);
    }
    async updateAvailability(params, updateAvailabilityDto, therapistId, role) {
        if (role !== 'therapist') {
            throw new common_1.UnauthorizedException('Only therapists can update availability');
        }
        return this.bookingService.updateAvailability(params.id, updateAvailabilityDto, therapistId);
    }
    async deleteAvailability(params, therapistId, role) {
        if (role !== 'therapist') {
            throw new common_1.UnauthorizedException('Only therapists can delete availability');
        }
        return this.bookingService.deleteAvailability(params.id, therapistId);
    }
    // Duration endpoints (public)
    getDurations() {
        return this.bookingService.getDurations();
    }
    // Available slots endpoint
    async getAvailableSlots(query) {
        return this.bookingService.getAvailableSlots(query.therapistId, query.date);
    }
};
exports.BookingController = BookingController;
__decorate([
    (0, common_1.Post)('meetings'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create create meeting',
        description: 'Create create meeting'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof mentara_commons_1.MeetingCreateDto !== "undefined" && mentara_commons_1.MeetingCreateDto) === "function" ? _b : Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "createMeeting", null);
__decorate([
    (0, common_1.Get)('meetings'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get meetings',
        description: 'Retrieve get meetings'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "getMeetings", null);
__decorate([
    (0, common_1.Get)('meetings/:id'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get meeting',
        description: 'Retrieve get meeting'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.BookingMeetingParamsDtoSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "getMeeting", null);
__decorate([
    (0, common_1.Put)('meetings/:id'),
    (0, swagger_1.ApiOperation)({
        summary: 'Update update meeting',
        description: 'Update update meeting'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Updated successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.BookingMeetingParamsDtoSchema))),
    __param(1, (0, common_1.Body)()),
    __param(2, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(3, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_c = typeof mentara_commons_1.MeetingUpdateDto !== "undefined" && mentara_commons_1.MeetingUpdateDto) === "function" ? _c : Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "updateMeeting", null);
__decorate([
    (0, common_1.Delete)('meetings/:id/cancel'),
    (0, swagger_1.ApiOperation)({
        summary: 'Delete cancel meeting',
        description: 'Delete cancel meeting'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Deleted successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.BookingMeetingParamsDtoSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "cancelMeeting", null);
__decorate([
    (0, common_1.Post)('availability'),
    (0, swagger_1.ApiOperation)({
        summary: 'Create create availability',
        description: 'Create create availability'
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Created successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof mentara_commons_1.TherapistAvailabilityCreateDto !== "undefined" && mentara_commons_1.TherapistAvailabilityCreateDto) === "function" ? _d : Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "createAvailability", null);
__decorate([
    (0, common_1.Get)('availability'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get availability',
        description: 'Retrieve get availability'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(1, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "getAvailability", null);
__decorate([
    (0, common_1.Put)('availability/:id'),
    (0, swagger_1.ApiOperation)({
        summary: 'Update update availability',
        description: 'Update update availability'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Updated successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.AvailabilityParamsDtoSchema))),
    __param(1, (0, common_1.Body)()),
    __param(2, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(3, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_e = typeof mentara_commons_1.TherapistAvailabilityUpdateDto !== "undefined" && mentara_commons_1.TherapistAvailabilityUpdateDto) === "function" ? _e : Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "updateAvailability", null);
__decorate([
    (0, common_1.Delete)('availability/:id'),
    (0, swagger_1.ApiOperation)({
        summary: 'Delete delete availability',
        description: 'Delete delete availability'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Deleted successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __param(0, (0, common_1.Param)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.AvailabilityParamsDtoSchema))),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, current_user_role_decorator_1.CurrentUserRole)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, String]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "deleteAvailability", null);
__decorate([
    (0, common_1.Get)('durations'),
    (0, swagger_1.ApiOperation)({
        summary: 'Retrieve get available slots',
        description: 'Retrieve get available slots'
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Retrieved successfully'
    }),
    (0, swagger_1.ApiResponse)({ status: 401, description: 'Unauthorized' }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], BookingController.prototype, "getDurations", null);
__decorate([
    (0, common_1.Get)('slots'),
    __param(0, (0, common_1.Query)(new zod_validation_pipe_1.ZodValidationPipe(mentara_commons_1.GetAvailableSlotsQueryDtoSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Promise)
], BookingController.prototype, "getAvailableSlots", null);
exports.BookingController = BookingController = __decorate([
    (0, swagger_1.ApiTags)('booking'),
    (0, swagger_1.ApiBearerAuth)('JWT-auth'),
    (0, common_1.Controller)('booking'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof booking_service_1.BookingService !== "undefined" && booking_service_1.BookingService) === "function" ? _a : Object])
], BookingController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2Jvb2tpbmcvYm9va2luZy5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FZd0I7QUFDeEIsa0VBQTZEO0FBQzdELDRGQUE2RTtBQUM3RSxnR0FBaUY7QUFDakYsNkVBQXdFO0FBQ3hFLHVEQUFtRDtBQUNuRCw2Q0FReUI7QUFDekIscURBV3lCO0FBTWxCLElBQU0saUJBQWlCLEdBQXZCLE1BQU0saUJBQWlCO0lBQ0M7SUFBN0IsWUFBNkIsY0FBOEI7UUFBOUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO0lBQUcsQ0FBQztJQUUvRCxvQkFBb0I7SUFzQmQsQUFBTixLQUFLLENBQUMsYUFBYSxDQUNULGdCQUFrQyxFQUN6QixNQUFjLEVBQ1osSUFBWTtRQUUvQixxRkFBcUY7UUFDckYsSUFBSSxJQUFJLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDdEIsTUFBTSxJQUFJLDJCQUFrQixDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDakUsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQWlDSyxBQUFOLEtBQUssQ0FBQyxXQUFXLENBQ0UsTUFBYyxFQUNaLElBQVk7UUFFL0IsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQWlDSyxBQUFOLEtBQUssQ0FBQyxVQUFVLENBRWQsTUFBK0IsRUFDZCxNQUFjLEVBQ1osSUFBWTtRQUUvQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFpQ0ssQUFBTixLQUFLLENBQUMsYUFBYSxDQUVqQixNQUErQixF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QUFDLElBQUksdUNBQWlCLENBQUMsaURBQStCLENBQUMsQ0FBQyxDQUFBOzs7OzBEQUkvRDs0QkExWlUsaUJBQWlCO0lBSjdCLElBQUEsaUJBQU8sRUFBQyxTQUFTLENBQUM7SUFDbEIsSUFBQSx1QkFBYSxFQUFDLFVBQVUsQ0FBQztJQUN6QixJQUFBLG1CQUFVLEVBQUMsU0FBUyxDQUFDO0lBQ3JCLElBQUEsa0JBQVMsRUFBQyw2QkFBWSxDQUFDO3lEQUV1QixnQ0FBYyxvQkFBZCxnQ0FBYztHQURoRCxpQkFBaUIsQ0EyWjdCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3dldG9vYS9Eb2N1bWVudHMvY29kZS9wcm9qZWN0cy9tZW50YXJhL21lbnRhcmEtYXBpL3NyYy9ib29raW5nL2Jvb2tpbmcuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCb2R5LFxuICBDb250cm9sbGVyLFxuICBEZWxldGUsXG4gIEdldCxcbiAgUGFyYW0sXG4gIFBvc3QsXG4gIFB1dCxcbiAgUXVlcnksXG4gIFVzZUd1YXJkcyxcbiAgVW5hdXRob3JpemVkRXhjZXB0aW9uLFxuICBGb3JiaWRkZW5FeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IEN1cnJlbnRVc2VySWQgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLWlkLmRlY29yYXRvcic7XG5pbXBvcnQgeyBDdXJyZW50VXNlclJvbGUgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLXJvbGUuZGVjb3JhdG9yJztcbmltcG9ydCB7IFpvZFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnLi4vY29tbW9uL3BpcGVzL3pvZC12YWxpZGF0aW9uLnBpcGUnO1xuaW1wb3J0IHsgQm9va2luZ1NlcnZpY2UgfSBmcm9tICcuL2Jvb2tpbmcuc2VydmljZSc7XG5pbXBvcnQge1xuICBBcGlUYWdzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVJlc3BvbnNlLFxuICBBcGlCb2R5LFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlQYXJhbSxcbiAgQXBpUXVlcnksXG59IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5pbXBvcnQge1xuICBUaGVyYXBpc3RBdmFpbGFiaWxpdHlDcmVhdGVEdG8sXG4gIFRoZXJhcGlzdEF2YWlsYWJpbGl0eVVwZGF0ZUR0byxcbiAgTWVldGluZ0NyZWF0ZUR0byxcbiAgTWVldGluZ1VwZGF0ZUR0byxcbiAgQm9va2luZ01lZXRpbmdQYXJhbXNEdG9TY2hlbWEsXG4gIEF2YWlsYWJpbGl0eVBhcmFtc0R0b1NjaGVtYSxcbiAgR2V0QXZhaWxhYmxlU2xvdHNRdWVyeUR0b1NjaGVtYSxcbiAgdHlwZSBCb29raW5nTWVldGluZ1BhcmFtc0R0byxcbiAgdHlwZSBBdmFpbGFiaWxpdHlQYXJhbXNEdG8sXG4gIHR5cGUgR2V0QXZhaWxhYmxlU2xvdHNRdWVyeUR0byxcbn0gZnJvbSAnbWVudGFyYS1jb21tb25zJztcblxuQEFwaVRhZ3MoJ2Jvb2tpbmcnKVxuQEFwaUJlYXJlckF1dGgoJ0pXVC1hdXRoJylcbkBDb250cm9sbGVyKCdib29raW5nJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxuZXhwb3J0IGNsYXNzIEJvb2tpbmdDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBib29raW5nU2VydmljZTogQm9va2luZ1NlcnZpY2UpIHt9XG5cbiAgLy8gTWVldGluZyBlbmRwb2ludHNcbiAgQFBvc3QoJ21lZXRpbmdzJylcblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cbiAgICBzdW1tYXJ5OiAnQ3JlYXRlIGNyZWF0ZSBtZWV0aW5nJyxcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIGNyZWF0ZSBtZWV0aW5nJyBcblxuICB9KVxuXG4gIEBBcGlSZXNwb25zZSh7IFxuXG4gICAgc3RhdHVzOiAyMDEsIFxuXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGVkIHN1Y2Nlc3NmdWxseScgXG5cbiAgfSlcblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cbiAgXG4gIGFzeW5jIGNyZWF0ZU1lZXRpbmcoXG4gICAgQEJvZHkoKSBjcmVhdGVNZWV0aW5nRHRvOiBNZWV0aW5nQ3JlYXRlRHRvLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VyUm9sZSgpIHJvbGU6IHN0cmluZyxcbiAgKSB7XG4gICAgLy8gT25seSBjbGllbnRzIGNhbiBib29rIG1lZXRpbmdzLCBidXQgd2UnbGwgdmFsaWRhdGUgdGhlIHJlbGF0aW9uc2hpcCBpbiB0aGUgc2VydmljZVxuICAgIGlmIChyb2xlICE9PSAnY2xpZW50Jykge1xuICAgICAgdGhyb3cgbmV3IEZvcmJpZGRlbkV4Y2VwdGlvbignT25seSBjbGllbnRzIGNhbiBib29rIG1lZXRpbmdzJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmJvb2tpbmdTZXJ2aWNlLmNyZWF0ZU1lZXRpbmcoY3JlYXRlTWVldGluZ0R0bywgdXNlcklkKTtcbiAgfVxuXG4gIEBHZXQoJ21lZXRpbmdzJylcblxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuXG4gICAgc3VtbWFyeTogJ1JldHJpZXZlIGdldCBtZWV0aW5ncycsXG5cblxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmUgZ2V0IG1lZXRpbmdzJyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBcblxuXG4gICAgc3RhdHVzOiAyMDAsIFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknIFxuXG5cbiAgfSlcblxuXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcblxuXG4gIFxuICBhc3luYyBnZXRNZWV0aW5ncyhcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSByb2xlOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmJvb2tpbmdTZXJ2aWNlLmdldE1lZXRpbmdzKHVzZXJJZCwgcm9sZSk7XG4gIH1cblxuICBAR2V0KCdtZWV0aW5ncy86aWQnKVxuXG5cbiAgQEFwaU9wZXJhdGlvbih7IFxuXG5cbiAgICBzdW1tYXJ5OiAnUmV0cmlldmUgZ2V0IG1lZXRpbmcnLFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlIGdldCBtZWV0aW5nJyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBcblxuXG4gICAgc3RhdHVzOiAyMDAsIFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknIFxuXG5cbiAgfSlcblxuXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcblxuXG4gIFxuICBhc3luYyBnZXRNZWV0aW5nKFxuICAgIEBQYXJhbShuZXcgWm9kVmFsaWRhdGlvblBpcGUoQm9va2luZ01lZXRpbmdQYXJhbXNEdG9TY2hlbWEpKVxuICAgIHBhcmFtczogQm9va2luZ01lZXRpbmdQYXJhbXNEdG8sXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJSb2xlKCkgcm9sZTogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ib29raW5nU2VydmljZS5nZXRNZWV0aW5nKHBhcmFtcy5pZCwgdXNlcklkLCByb2xlKTtcbiAgfVxuXG4gIEBQdXQoJ21lZXRpbmdzLzppZCcpXG5cblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cblxuICAgIHN1bW1hcnk6ICdVcGRhdGUgdXBkYXRlIG1lZXRpbmcnLFxuXG5cbiAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZSB1cGRhdGUgbWVldGluZycgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdVcGRhdGVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIGFzeW5jIHVwZGF0ZU1lZXRpbmcoXG4gICAgQFBhcmFtKG5ldyBab2RWYWxpZGF0aW9uUGlwZShCb29raW5nTWVldGluZ1BhcmFtc0R0b1NjaGVtYSkpXG4gICAgcGFyYW1zOiBCb29raW5nTWVldGluZ1BhcmFtc0R0byxcbiAgICBAQm9keSgpIHVwZGF0ZU1lZXRpbmdEdG86IE1lZXRpbmdVcGRhdGVEdG8sXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJSb2xlKCkgcm9sZTogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ib29raW5nU2VydmljZS51cGRhdGVNZWV0aW5nKFxuICAgICAgcGFyYW1zLmlkLFxuICAgICAgdXBkYXRlTWVldGluZ0R0byxcbiAgICAgIHVzZXJJZCxcbiAgICAgIHJvbGUsXG4gICAgKTtcbiAgfVxuXG4gIEBEZWxldGUoJ21lZXRpbmdzLzppZC9jYW5jZWwnKVxuXG5cbiAgQEFwaU9wZXJhdGlvbih7IFxuXG5cbiAgICBzdW1tYXJ5OiAnRGVsZXRlIGNhbmNlbCBtZWV0aW5nJyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGUgY2FuY2VsIG1lZXRpbmcnIFxuXG5cbiAgfSlcblxuXG4gIEBBcGlSZXNwb25zZSh7IFxuXG5cbiAgICBzdGF0dXM6IDIwMCwgXG5cblxuICAgIGRlc2NyaXB0aW9uOiAnRGVsZXRlZCBzdWNjZXNzZnVsbHknIFxuXG5cbiAgfSlcblxuXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAxLCBkZXNjcmlwdGlvbjogJ1VuYXV0aG9yaXplZCcgfSlcblxuXG4gIFxuICBhc3luYyBjYW5jZWxNZWV0aW5nKFxuICAgIEBQYXJhbShuZXcgWm9kVmFsaWRhdGlvblBpcGUoQm9va2luZ01lZXRpbmdQYXJhbXNEdG9TY2hlbWEpKVxuICAgIHBhcmFtczogQm9va2luZ01lZXRpbmdQYXJhbXNEdG8sXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJSb2xlKCkgcm9sZTogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ib29raW5nU2VydmljZS5jYW5jZWxNZWV0aW5nKHBhcmFtcy5pZCwgdXNlcklkLCByb2xlKTtcbiAgfVxuXG4gIC8vIEF2YWlsYWJpbGl0eSBlbmRwb2ludHMgKHRoZXJhcGlzdCBvbmx5KVxuICBAUG9zdCgnYXZhaWxhYmlsaXR5JylcblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cbiAgICBzdW1tYXJ5OiAnQ3JlYXRlIGNyZWF0ZSBhdmFpbGFiaWxpdHknLFxuXG4gICAgZGVzY3JpcHRpb246ICdDcmVhdGUgY3JlYXRlIGF2YWlsYWJpbGl0eScgXG5cbiAgfSlcblxuICBAQXBpUmVzcG9uc2UoeyBcblxuICAgIHN0YXR1czogMjAxLCBcblxuICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlZCBzdWNjZXNzZnVsbHknIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG4gIFxuICBhc3luYyBjcmVhdGVBdmFpbGFiaWxpdHkoXG4gICAgQEJvZHkoKSBjcmVhdGVBdmFpbGFiaWxpdHlEdG86IFRoZXJhcGlzdEF2YWlsYWJpbGl0eUNyZWF0ZUR0byxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHRoZXJhcGlzdElkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VyUm9sZSgpIHJvbGU6IHN0cmluZyxcbiAgKSB7XG4gICAgaWYgKHJvbGUgIT09ICd0aGVyYXBpc3QnKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFxuICAgICAgICAnT25seSB0aGVyYXBpc3RzIGNhbiBtYW5hZ2UgYXZhaWxhYmlsaXR5JyxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmJvb2tpbmdTZXJ2aWNlLmNyZWF0ZUF2YWlsYWJpbGl0eShcbiAgICAgIGNyZWF0ZUF2YWlsYWJpbGl0eUR0byxcbiAgICAgIHRoZXJhcGlzdElkLFxuICAgICk7XG4gIH1cblxuICBAR2V0KCdhdmFpbGFiaWxpdHknKVxuXG5cbiAgQEFwaU9wZXJhdGlvbih7IFxuXG5cbiAgICBzdW1tYXJ5OiAnUmV0cmlldmUgZ2V0IGF2YWlsYWJpbGl0eScsXG5cblxuICAgIGRlc2NyaXB0aW9uOiAnUmV0cmlldmUgZ2V0IGF2YWlsYWJpbGl0eScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdSZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyBcblxuXG4gIH0pXG5cblxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMSwgZGVzY3JpcHRpb246ICdVbmF1dGhvcml6ZWQnIH0pXG5cblxuICBcbiAgYXN5bmMgZ2V0QXZhaWxhYmlsaXR5KFxuICAgIEBDdXJyZW50VXNlcklkKCkgdGhlcmFwaXN0SWQ6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXJSb2xlKCkgcm9sZTogc3RyaW5nLFxuICApIHtcbiAgICBpZiAocm9sZSAhPT0gJ3RoZXJhcGlzdCcpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oXG4gICAgICAgICdPbmx5IHRoZXJhcGlzdHMgY2FuIHZpZXcgdGhlaXIgYXZhaWxhYmlsaXR5JyxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmJvb2tpbmdTZXJ2aWNlLmdldEF2YWlsYWJpbGl0eSh0aGVyYXBpc3RJZCk7XG4gIH1cblxuICBAUHV0KCdhdmFpbGFiaWxpdHkvOmlkJylcblxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuXG4gICAgc3VtbWFyeTogJ1VwZGF0ZSB1cGRhdGUgYXZhaWxhYmlsaXR5JyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdVcGRhdGUgdXBkYXRlIGF2YWlsYWJpbGl0eScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdVcGRhdGVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIGFzeW5jIHVwZGF0ZUF2YWlsYWJpbGl0eShcbiAgICBAUGFyYW0obmV3IFpvZFZhbGlkYXRpb25QaXBlKEF2YWlsYWJpbGl0eVBhcmFtc0R0b1NjaGVtYSkpXG4gICAgcGFyYW1zOiBBdmFpbGFiaWxpdHlQYXJhbXNEdG8sXG4gICAgQEJvZHkoKSB1cGRhdGVBdmFpbGFiaWxpdHlEdG86IFRoZXJhcGlzdEF2YWlsYWJpbGl0eVVwZGF0ZUR0byxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHRoZXJhcGlzdElkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VyUm9sZSgpIHJvbGU6IHN0cmluZyxcbiAgKSB7XG4gICAgaWYgKHJvbGUgIT09ICd0aGVyYXBpc3QnKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFxuICAgICAgICAnT25seSB0aGVyYXBpc3RzIGNhbiB1cGRhdGUgYXZhaWxhYmlsaXR5JyxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmJvb2tpbmdTZXJ2aWNlLnVwZGF0ZUF2YWlsYWJpbGl0eShcbiAgICAgIHBhcmFtcy5pZCxcbiAgICAgIHVwZGF0ZUF2YWlsYWJpbGl0eUR0byxcbiAgICAgIHRoZXJhcGlzdElkLFxuICAgICk7XG4gIH1cblxuICBARGVsZXRlKCdhdmFpbGFiaWxpdHkvOmlkJylcblxuXG4gIEBBcGlPcGVyYXRpb24oeyBcblxuXG4gICAgc3VtbWFyeTogJ0RlbGV0ZSBkZWxldGUgYXZhaWxhYmlsaXR5JyxcblxuXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGUgZGVsZXRlIGF2YWlsYWJpbGl0eScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cblxuICAgIHN0YXR1czogMjAwLCBcblxuXG4gICAgZGVzY3JpcHRpb246ICdEZWxldGVkIHN1Y2Nlc3NmdWxseScgXG5cblxuICB9KVxuXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG5cbiAgXG4gIGFzeW5jIGRlbGV0ZUF2YWlsYWJpbGl0eShcbiAgICBAUGFyYW0obmV3IFpvZFZhbGlkYXRpb25QaXBlKEF2YWlsYWJpbGl0eVBhcmFtc0R0b1NjaGVtYSkpXG4gICAgcGFyYW1zOiBBdmFpbGFiaWxpdHlQYXJhbXNEdG8sXG4gICAgQEN1cnJlbnRVc2VySWQoKSB0aGVyYXBpc3RJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlclJvbGUoKSByb2xlOiBzdHJpbmcsXG4gICkge1xuICAgIGlmIChyb2xlICE9PSAndGhlcmFwaXN0Jykge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcbiAgICAgICAgJ09ubHkgdGhlcmFwaXN0cyBjYW4gZGVsZXRlIGF2YWlsYWJpbGl0eScsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5ib29raW5nU2VydmljZS5kZWxldGVBdmFpbGFiaWxpdHkocGFyYW1zLmlkLCB0aGVyYXBpc3RJZCk7XG4gIH1cblxuICAvLyBEdXJhdGlvbiBlbmRwb2ludHMgKHB1YmxpYylcbiAgQEdldCgnZHVyYXRpb25zJylcblxuICBAQXBpT3BlcmF0aW9uKHsgXG5cbiAgICBzdW1tYXJ5OiAnUmV0cmlldmUgZ2V0IGF2YWlsYWJsZSBzbG90cycsXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlIGdldCBhdmFpbGFibGUgc2xvdHMnIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgXG5cbiAgICBzdGF0dXM6IDIwMCwgXG5cbiAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlZCBzdWNjZXNzZnVsbHknIFxuXG4gIH0pXG5cbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDEsIGRlc2NyaXB0aW9uOiAnVW5hdXRob3JpemVkJyB9KVxuXG4gIFxuICBnZXREdXJhdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuYm9va2luZ1NlcnZpY2UuZ2V0RHVyYXRpb25zKCk7XG4gIH1cblxuICAvLyBBdmFpbGFibGUgc2xvdHMgZW5kcG9pbnRcbiAgQEdldCgnc2xvdHMnKVxuICBhc3luYyBnZXRBdmFpbGFibGVTbG90cyhcbiAgICBAUXVlcnkobmV3IFpvZFZhbGlkYXRpb25QaXBlKEdldEF2YWlsYWJsZVNsb3RzUXVlcnlEdG9TY2hlbWEpKVxuICAgIHF1ZXJ5OiBHZXRBdmFpbGFibGVTbG90c1F1ZXJ5RHRvLFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5ib29raW5nU2VydmljZS5nZXRBdmFpbGFibGVTbG90cyhxdWVyeS50aGVyYXBpc3RJZCwgcXVlcnkuZGF0ZSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==