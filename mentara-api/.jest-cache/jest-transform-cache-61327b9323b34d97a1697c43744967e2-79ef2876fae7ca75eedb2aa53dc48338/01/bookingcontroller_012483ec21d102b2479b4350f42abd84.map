{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/booking.controller.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/booking/booking.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  Param,\n  Post,\n  Put,\n  Query,\n  UseGuards,\n  UnauthorizedException,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { ClerkAuthGuard } from '../guards/clerk-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { CurrentUserRole } from '../decorators/current-user-role.decorator';\nimport { BookingService } from './booking.service';\nimport {\n  TherapistAvailabilityCreateDto,\n  TherapistAvailabilityUpdateDto,\n  MeetingCreateDto,\n  MeetingUpdateDto,\n} from '../../schema/booking';\n\n@Controller('booking')\n@UseGuards(ClerkAuthGuard)\nexport class BookingController {\n  constructor(private readonly bookingService: BookingService) {}\n\n  // Meeting endpoints\n  @Post('meetings')\n  async createMeeting(\n    @Body() createMeetingDto: MeetingCreateDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    // Only clients can book meetings, but we'll validate the relationship in the service\n    if (role !== 'client') {\n      throw new ForbiddenException('Only clients can book meetings');\n    }\n    return this.bookingService.createMeeting(createMeetingDto, userId);\n  }\n\n  @Get('meetings')\n  async getMeetings(\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.getMeetings(userId, role);\n  }\n\n  @Get('meetings/:id')\n  async getMeeting(\n    @Param('id') id: string,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.getMeeting(id, userId, role);\n  }\n\n  @Put('meetings/:id')\n  async updateMeeting(\n    @Param('id') id: string,\n    @Body() updateMeetingDto: MeetingUpdateDto,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.updateMeeting(\n      id,\n      updateMeetingDto,\n      userId,\n      role,\n    );\n  }\n\n  @Delete('meetings/:id/cancel')\n  async cancelMeeting(\n    @Param('id') id: string,\n    @CurrentUserId() userId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    return this.bookingService.cancelMeeting(id, userId, role);\n  }\n\n  // Availability endpoints (therapist only)\n  @Post('availability')\n  async createAvailability(\n    @Body() createAvailabilityDto: TherapistAvailabilityCreateDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can manage availability',\n      );\n    }\n    return this.bookingService.createAvailability(\n      createAvailabilityDto,\n      therapistId,\n    );\n  }\n\n  @Get('availability')\n  async getAvailability(\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can view their availability',\n      );\n    }\n    return this.bookingService.getAvailability(therapistId);\n  }\n\n  @Put('availability/:id')\n  async updateAvailability(\n    @Param('id') id: string,\n    @Body() updateAvailabilityDto: TherapistAvailabilityUpdateDto,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can update availability',\n      );\n    }\n    return this.bookingService.updateAvailability(\n      id,\n      updateAvailabilityDto,\n      therapistId,\n    );\n  }\n\n  @Delete('availability/:id')\n  async deleteAvailability(\n    @Param('id') id: string,\n    @CurrentUserId() therapistId: string,\n    @CurrentUserRole() role: string,\n  ) {\n    if (role !== 'therapist') {\n      throw new UnauthorizedException(\n        'Only therapists can delete availability',\n      );\n    }\n    return this.bookingService.deleteAvailability(id, therapistId);\n  }\n\n  // Duration endpoints (public)\n  @Get('durations')\n  getDurations() {\n    return this.bookingService.getDurations();\n  }\n\n  // Available slots endpoint\n  @Get('slots')\n  async getAvailableSlots(\n    @Query('therapistId') therapistId: string,\n    @Query('date') date: string,\n  ) {\n    return this.bookingService.getAvailableSlots(therapistId, date);\n  }\n}\n"],"version":3}