63bb006f6854f4c2da378cf8d799b9a7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const prisma_client_provider_1 = require("../../providers/prisma-client.provider");
const database_test_setup_1 = require("../database-test.setup");
const enhanced_test_helpers_1 = require("../enhanced-test-helpers");
/**
 * Database Transactions Integration Tests
 *
 * Comprehensive testing of transaction integrity, rollback scenarios,
 * constraint validation, and concurrent transaction handling.
 */
describe('Database Transactions Integration', () => {
    let app;
    let prisma;
    let moduleRef;
    beforeAll(async () => {
        // Setup test database
        prisma = await database_test_setup_1.DatabaseTestSetup.setupTestDatabase();
        moduleRef = await testing_1.Test.createTestingModule({
            providers: [
                {
                    provide: prisma_client_provider_1.PrismaService,
                    useValue: prisma,
                },
            ],
        }).compile();
        app = moduleRef.createNestApplication();
        await app.init();
    });
    afterEach(async () => {
        // Clean database after each test
        await database_test_setup_1.DatabaseTestSetup.cleanupDatabase();
    });
    afterAll(async () => {
        await database_test_setup_1.DatabaseTestSetup.stopContainer();
        await app.close();
        await moduleRef.close();
    });
    describe('Multi-Model Transaction Integrity', () => {
        it('should successfully commit complex multi-model transaction', async () => {
            const result = await prisma.$transaction(async (tx) => {
                // 1. Create user
                const user = await tx.user.create({
                    data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        email: 'transaction-success@test.com',
                        firstName: 'Transaction',
                        lastName: 'Success',
                        role: 'client',
                    }),
                });
                // 2. Create client profile
                const client = await tx.client.create({
                    data: {
                        userId: user.id,
                        hasSeenTherapistRecommendations: false,
                    },
                });
                // 3. Create notification settings
                const notificationSettings = await tx.notificationSettings.create({
                    data: {
                        userId: user.id,
                        emailNotifications: true,
                        pushNotifications: true,
                        smsNotifications: false,
                        marketingEmails: false,
                    },
                });
                // 4. Create pre-assessment
                const preAssessment = await tx.preAssessment.create({
                    data: {
                        userId: user.id,
                        questionnaires: {
                            PHQ9: [1, 2, 1, 0, 2, 1, 3, 2, 1],
                            GAD7: [2, 1, 3, 2, 1, 2, 3],
                        },
                        scores: {
                            depression: 15,
                            anxiety: 12,
                        },
                        severityLevels: {
                            depression: 'moderate',
                            anxiety: 'mild',
                        },
                        status: 'COMPLETED',
                    },
                });
                // 5. Create user activity
                const userActivity = await tx.userActivity.create({
                    data: {
                        userId: user.id,
                        activityType: 'account_creation',
                        activityData: {
                            registrationSource: 'web',
                            completedSteps: ['profile', 'assessment'],
                        },
                    },
                });
                // 6. Create audit log
                const auditLog = await tx.auditLog.create({
                    data: {
                        userId: user.id,
                        action: 'USER_REGISTRATION',
                        entity: 'User',
                        entityId: user.id,
                        details: {
                            registrationCompleted: true,
                            assessmentCompleted: true,
                        },
                        severity: 'INFO',
                    },
                });
                return {
                    user,
                    client,
                    notificationSettings,
                    preAssessment,
                    userActivity,
                    auditLog,
                };
            });
            // Verify all entities were created
            expect(result.user.email).toBe('transaction-success@test.com');
            expect(result.client.userId).toBe(result.user.id);
            expect(result.notificationSettings.emailNotifications).toBe(true);
            expect(result.preAssessment.status).toBe('COMPLETED');
            expect(result.userActivity.activityType).toBe('account_creation');
            expect(result.auditLog.action).toBe('USER_REGISTRATION');
            // Verify data persistence after transaction
            const persistedUser = await prisma.user.findUnique({
                where: { id: result.user.id },
                include: {
                    client: true,
                    notificationSettings: true,
                    preAssessment: true,
                    activities: true,
                    auditLogs: true,
                },
            });
            expect(persistedUser).toBeTruthy();
            expect(persistedUser?.client).toBeTruthy();
            expect(persistedUser?.notificationSettings).toBeTruthy();
            expect(persistedUser?.preAssessment).toBeTruthy();
            expect(persistedUser?.activities).toHaveLength(1);
            expect(persistedUser?.auditLogs).toHaveLength(1);
        });
        it('should rollback transaction on constraint violation', async () => {
            const transactionFunction = async () => {
                return await prisma.$transaction(async (tx) => {
                    // 1. Create first user successfully
                    const user1 = await tx.user.create({
                        data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                            email: 'rollback-test@test.com',
                            firstName: 'First',
                            lastName: 'User',
                        }),
                    });
                    // 2. Create client for first user
                    const client1 = await tx.client.create({
                        data: {
                            userId: user1.id,
                            hasSeenTherapistRecommendations: false,
                        },
                    });
                    // 3. Create notification settings
                    const settings1 = await tx.notificationSettings.create({
                        data: {
                            userId: user1.id,
                            emailNotifications: true,
                            pushNotifications: true,
                        },
                    });
                    // 4. Attempt to create user with duplicate email (should fail)
                    const user2 = await tx.user.create({
                        data: {
                            id: 'duplicate-user',
                            email: 'rollback-test@test.com', // Duplicate email
                            firstName: 'Duplicate',
                            lastName: 'User',
                            role: 'client',
                        },
                    });
                    return { user1, client1, settings1, user2 };
                });
            };
            // Transaction should fail due to unique constraint violation
            await expect(transactionFunction()).rejects.toThrow();
            // Verify no data was persisted
            const users = await prisma.user.findMany({
                where: {
                    email: 'rollback-test@test.com',
                },
            });
            const clients = await prisma.client.findMany({
                where: {
                    user: {
                        email: 'rollback-test@test.com',
                    },
                },
            });
            const settings = await prisma.notificationSettings.findMany({
                where: {
                    user: {
                        email: 'rollback-test@test.com',
                    },
                },
            });
            expect(users).toHaveLength(0);
            expect(clients).toHaveLength(0);
            expect(settings).toHaveLength(0);
        });
        it('should handle nested transaction rollback in complex scenarios', async () => {
            const nestedTransactionFunction = async () => {
                return await prisma.$transaction(async (tx) => {
                    // Create therapist user and profile
                    const therapistUser = await tx.user.create({
                        data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                            email: 'nested-therapist@test.com',
                            role: 'therapist',
                        }),
                    });
                    const therapist = await tx.therapist.create({
                        data: {
                            userId: therapistUser.id,
                            mobile: '+1234567890',
                            province: 'Ontario',
                            providerType: 'Clinical Psychologist',
                            professionalLicenseType: 'Licensed',
                            isPRCLicensed: 'yes',
                            prcLicenseNumber: 'PRC123456',
                            practiceStartDate: new Date('2020-01-01'),
                            yearsOfExperience: 5,
                            areasOfExpertise: ['Anxiety'],
                            assessmentTools: ['PHQ-9'],
                            therapeuticApproachesUsedList: ['CBT'],
                            languagesOffered: ['English'],
                            providedOnlineTherapyBefore: true,
                            comfortableUsingVideoConferencing: true,
                            preferredSessionLength: [60],
                            acceptTypes: ['Individual'],
                            status: 'approved',
                            hourlyRate: 150,
                            expirationDateOfLicense: new Date('2025-01-01'),
                            compliesWithDataPrivacyAct: true,
                            willingToAbideByPlatformGuidelines: true,
                            treatmentSuccessRates: {},
                            sessionLength: '60 minutes',
                        },
                    });
                    // Create client user and profile
                    const clientUser = await tx.user.create({
                        data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                            email: 'nested-client@test.com',
                            role: 'client',
                        }),
                    });
                    const client = await tx.client.create({
                        data: {
                            userId: clientUser.id,
                            hasSeenTherapistRecommendations: true,
                        },
                    });
                    // Create meeting
                    const meeting = await tx.meeting.create({
                        data: {
                            clientId: client.userId,
                            therapistId: therapist.userId,
                            startTime: new Date('2024-12-01T10:00:00Z'),
                            duration: 60,
                            status: 'SCHEDULED',
                            meetingType: 'video',
                        },
                    });
                    // Create session log
                    const sessionLog = await tx.sessionLog.create({
                        data: {
                            clientId: client.userId,
                            meetingId: meeting.id,
                            sessionDate: new Date('2024-12-01T10:00:00Z'),
                            duration: 60,
                            sessionType: 'Individual',
                            notes: 'Initial session notes',
                            mood: 'neutral',
                            progress: 'good',
                        },
                    });
                    // Attempt to create duplicate meeting at same time (should fail)
                    const duplicateMeeting = await tx.meeting.create({
                        data: {
                            clientId: client.userId,
                            therapistId: therapist.userId,
                            startTime: new Date('2024-12-01T10:00:00Z'), // Same time
                            duration: 60,
                            status: 'SCHEDULED',
                            meetingType: 'video',
                        },
                    });
                    return {
                        therapistUser,
                        therapist,
                        clientUser,
                        client,
                        meeting,
                        sessionLog,
                        duplicateMeeting,
                    };
                });
            };
            // Transaction should fail (assuming business logic prevents double booking)
            await expect(nestedTransactionFunction()).rejects.toThrow();
            // Verify complete rollback
            const therapists = await prisma.therapist.findMany({
                where: {
                    user: {
                        email: 'nested-therapist@test.com',
                    },
                },
            });
            const clients = await prisma.client.findMany({
                where: {
                    user: {
                        email: 'nested-client@test.com',
                    },
                },
            });
            const meetings = await prisma.meeting.findMany({
                where: {
                    client: {
                        user: {
                            email: 'nested-client@test.com',
                        },
                    },
                },
            });
            expect(therapists).toHaveLength(0);
            expect(clients).toHaveLength(0);
            expect(meetings).toHaveLength(0);
        });
    });
    describe('Constraint Validation and Cascade Deletion', () => {
        it('should enforce foreign key constraints properly', async () => {
            // Attempt to create client with non-existent user ID
            const invalidClientCreation = async () => {
                return await prisma.client.create({
                    data: {
                        userId: 'non-existent-user-id',
                        hasSeenTherapistRecommendations: false,
                    },
                });
            };
            await expect(invalidClientCreation()).rejects.toThrow();
            // Attempt to create message with non-existent conversation ID
            const user = await prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser(),
            });
            const invalidMessageCreation = async () => {
                return await prisma.message.create({
                    data: {
                        conversationId: 'non-existent-conversation-id',
                        senderId: user.id,
                        content: 'This should fail',
                        messageType: 'TEXT',
                    },
                });
            };
            await expect(invalidMessageCreation()).rejects.toThrow();
        });
        it('should handle cascade deletion correctly across related models', async () => {
            // Create complete user hierarchy
            const user = await prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    email: 'cascade@test.com',
                    role: 'client',
                }),
            });
            const client = await prisma.client.create({
                data: {
                    userId: user.id,
                    hasSeenTherapistRecommendations: false,
                },
            });
            // Create related entities
            const [notificationSettings, preAssessment, userActivity, auditLog, medicalHistory, clientPreference,] = await Promise.all([
                prisma.notificationSettings.create({
                    data: {
                        userId: user.id,
                        emailNotifications: true,
                        pushNotifications: true,
                    },
                }),
                prisma.preAssessment.create({
                    data: {
                        userId: user.id,
                        questionnaires: { PHQ9: [1, 2, 3] },
                        scores: { depression: 10 },
                        severityLevels: { depression: 'mild' },
                        status: 'COMPLETED',
                    },
                }),
                prisma.userActivity.create({
                    data: {
                        userId: user.id,
                        activityType: 'login',
                        activityData: { timestamp: new Date().toISOString() },
                    },
                }),
                prisma.auditLog.create({
                    data: {
                        userId: user.id,
                        action: 'USER_LOGIN',
                        entity: 'User',
                        entityId: user.id,
                        details: { ip: '127.0.0.1' },
                        severity: 'INFO',
                    },
                }),
                prisma.clientMedicalHistory.create({
                    data: {
                        clientId: client.userId,
                        condition: 'Anxiety',
                        notes: 'Test condition',
                    },
                }),
                prisma.clientPreference.create({
                    data: {
                        clientId: client.userId,
                        key: 'session_time',
                        value: 'morning',
                    },
                }),
            ]);
            // Get IDs before deletion
            const relatedIds = {
                notificationSettings: notificationSettings.id,
                preAssessment: preAssessment.id,
                userActivity: userActivity.id,
                auditLog: auditLog.id,
                medicalHistory: medicalHistory.id,
                clientPreference: clientPreference.id,
            };
            // Delete user - should cascade to all related entities
            await prisma.user.delete({
                where: { id: user.id },
            });
            // Verify cascade deletion
            const checkResults = await Promise.allSettled([
                prisma.user.findUnique({ where: { id: user.id } }),
                prisma.client.findUnique({ where: { userId: user.id } }),
                prisma.notificationSettings.findUnique({ where: { id: relatedIds.notificationSettings } }),
                prisma.preAssessment.findUnique({ where: { id: relatedIds.preAssessment } }),
                prisma.userActivity.findUnique({ where: { id: relatedIds.userActivity } }),
                prisma.auditLog.findUnique({ where: { id: relatedIds.auditLog } }),
                prisma.clientMedicalHistory.findUnique({ where: { id: relatedIds.medicalHistory } }),
                prisma.clientPreference.findUnique({ where: { id: relatedIds.clientPreference } }),
            ]);
            // All should be null (deleted)
            checkResults.forEach(result => {
                expect(result.status).toBe('fulfilled');
                if (result.status === 'fulfilled') {
                    expect(result.value).toBeNull();
                }
            });
        });
        it('should handle unique constraint violations gracefully', async () => {
            // Create user with unique email
            const user1 = await prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    email: 'unique@test.com',
                    firstName: 'First',
                }),
            });
            // Attempt to create another user with same email
            const duplicateEmailAttempt = async () => {
                return await prisma.user.create({
                    data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        email: 'unique@test.com', // Duplicate email
                        firstName: 'Second',
                    }),
                });
            };
            await expect(duplicateEmailAttempt()).rejects.toThrow();
            // Create conversation participant
            const conversation = await prisma.conversation.create({
                data: {
                    type: 'DIRECT',
                    isActive: true,
                },
            });
            const participant1 = await prisma.conversationParticipant.create({
                data: {
                    conversationId: conversation.id,
                    userId: user1.id,
                    role: 'MEMBER',
                },
            });
            // Attempt to create duplicate participant
            const duplicateParticipantAttempt = async () => {
                return await prisma.conversationParticipant.create({
                    data: {
                        conversationId: conversation.id,
                        userId: user1.id, // Duplicate combination
                        role: 'ADMIN',
                    },
                });
            };
            await expect(duplicateParticipantAttempt()).rejects.toThrow();
        });
    });
    describe('Concurrent Transaction Handling', () => {
        it('should handle concurrent user creation correctly', async () => {
            const concurrentUsers = Array.from({ length: 10 }, (_, i) => prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    email: `concurrent-${i}@test.com`,
                    firstName: `User${i}`,
                }),
            }));
            const results = await Promise.allSettled(concurrentUsers);
            const successful = results.filter(r => r.status === 'fulfilled').length;
            const failed = results.filter(r => r.status === 'rejected').length;
            expect(successful).toBe(10); // All should succeed with unique emails
            expect(failed).toBe(0);
            // Verify all users were created
            const createdUsers = await prisma.user.findMany({
                where: {
                    email: {
                        startsWith: 'concurrent-',
                    },
                },
            });
            expect(createdUsers).toHaveLength(10);
        });
        it('should handle concurrent transaction conflicts', async () => {
            // Create base user
            const user = await prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    email: 'concurrent-transaction@test.com',
                }),
            });
            // Create concurrent transactions that modify the same user
            const concurrentTransactions = Array.from({ length: 5 }, (_, i) => prisma.$transaction(async (tx) => {
                // Read current user state
                const currentUser = await tx.user.findUnique({
                    where: { id: user.id },
                });
                if (!currentUser) {
                    throw new Error('User not found');
                }
                // Simulate some processing time
                await new Promise(resolve => setTimeout(resolve, Math.random() * 100));
                // Update user with new information
                const updatedUser = await tx.user.update({
                    where: { id: user.id },
                    data: {
                        firstName: `Updated${i}`,
                        bio: `Transaction ${i} bio update`,
                        updatedAt: new Date(),
                    },
                });
                // Create activity log
                await tx.userActivity.create({
                    data: {
                        userId: user.id,
                        activityType: 'profile_update',
                        activityData: {
                            updateNumber: i,
                            timestamp: new Date().toISOString(),
                        },
                    },
                });
                return updatedUser;
            }));
            const results = await Promise.allSettled(concurrentTransactions);
            const successful = results.filter(r => r.status === 'fulfilled').length;
            // All transactions should succeed due to proper isolation
            expect(successful).toBe(5);
            // Verify final state consistency
            const finalUser = await prisma.user.findUnique({
                where: { id: user.id },
                include: {
                    activities: {
                        orderBy: { createdAt: 'desc' },
                    },
                },
            });
            expect(finalUser?.activities).toHaveLength(5);
            expect(finalUser?.firstName).toMatch(/Updated\d/);
        });
        it('should handle optimistic concurrency control', async () => {
            // Create meeting for concurrent updates
            const clientUser = await prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    role: 'client',
                    email: 'concurrency-client@test.com',
                }),
            });
            const therapistUser = await prisma.user.create({
                data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                    role: 'therapist',
                    email: 'concurrency-therapist@test.com',
                }),
            });
            const client = await prisma.client.create({
                data: {
                    userId: clientUser.id,
                    hasSeenTherapistRecommendations: true,
                },
            });
            const therapist = await prisma.therapist.create({
                data: {
                    userId: therapistUser.id,
                    mobile: '+1234567890',
                    province: 'Ontario',
                    providerType: 'Clinical Psychologist',
                    professionalLicenseType: 'Licensed',
                    isPRCLicensed: 'yes',
                    prcLicenseNumber: 'PRC123456',
                    practiceStartDate: new Date('2020-01-01'),
                    yearsOfExperience: 5,
                    areasOfExpertise: ['Anxiety'],
                    assessmentTools: ['PHQ-9'],
                    therapeuticApproachesUsedList: ['CBT'],
                    languagesOffered: ['English'],
                    providedOnlineTherapyBefore: true,
                    comfortableUsingVideoConferencing: true,
                    preferredSessionLength: [60],
                    acceptTypes: ['Individual'],
                    status: 'approved',
                    hourlyRate: 150,
                    expirationDateOfLicense: new Date('2025-01-01'),
                    compliesWithDataPrivacyAct: true,
                    willingToAbideByPlatformGuidelines: true,
                    treatmentSuccessRates: {},
                    sessionLength: '60 minutes',
                },
            });
            const meeting = await prisma.meeting.create({
                data: {
                    clientId: client.userId,
                    therapistId: therapist.userId,
                    startTime: new Date('2024-12-01T10:00:00Z'),
                    duration: 60,
                    status: 'SCHEDULED',
                    meetingType: 'video',
                    description: 'Initial meeting',
                },
            });
            // Simulate concurrent updates to the meeting
            const concurrentUpdates = [
                prisma.meeting.update({
                    where: { id: meeting.id },
                    data: {
                        description: 'Updated by client',
                        updatedAt: new Date(),
                    },
                }),
                prisma.meeting.update({
                    where: { id: meeting.id },
                    data: {
                        status: 'IN_PROGRESS',
                        updatedAt: new Date(),
                    },
                }),
                prisma.meeting.update({
                    where: { id: meeting.id },
                    data: {
                        duration: 90,
                        updatedAt: new Date(),
                    },
                }),
            ];
            const updateResults = await Promise.allSettled(concurrentUpdates);
            const successfulUpdates = updateResults.filter(r => r.status === 'fulfilled').length;
            // All updates should succeed
            expect(successfulUpdates).toBe(3);
            // Verify final meeting state is consistent
            const finalMeeting = await prisma.meeting.findUnique({
                where: { id: meeting.id },
            });
            expect(finalMeeting).toBeTruthy();
            expect(finalMeeting?.updatedAt.getTime()).toBeGreaterThan(meeting.updatedAt.getTime());
        });
    });
    describe('Transaction Performance and Deadlock Prevention', () => {
        it('should handle large transaction volumes efficiently', async () => {
            const startTime = Date.now();
            const batchSize = 20;
            // Create batch of transactions
            const transactions = Array.from({ length: batchSize }, (_, i) => prisma.$transaction(async (tx) => {
                const user = await tx.user.create({
                    data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        email: `batch-${i}@test.com`,
                        firstName: `BatchUser${i}`,
                    }),
                });
                const client = await tx.client.create({
                    data: {
                        userId: user.id,
                        hasSeenTherapistRecommendations: false,
                    },
                });
                const settings = await tx.notificationSettings.create({
                    data: {
                        userId: user.id,
                        emailNotifications: true,
                        pushNotifications: true,
                    },
                });
                return { user, client, settings };
            }));
            const results = await Promise.allSettled(transactions);
            const endTime = Date.now();
            const duration = endTime - startTime;
            const successful = results.filter(r => r.status === 'fulfilled').length;
            expect(successful).toBe(batchSize);
            expect(duration).toBeLessThan(10000); // Should complete within 10 seconds
            console.log(`âœ… Batch Transaction Performance:
        Transactions: ${batchSize}
        Successful: ${successful}
        Duration: ${duration}ms
        Avg per transaction: ${(duration / batchSize).toFixed(2)}ms`);
        });
        it('should prevent deadlocks in complex scenarios', async () => {
            // Create base entities
            const users = await Promise.all([
                prisma.user.create({
                    data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        email: 'deadlock-1@test.com',
                    }),
                }),
                prisma.user.create({
                    data: enhanced_test_helpers_1.TestDataGenerator.createUser({
                        email: 'deadlock-2@test.com',
                    }),
                }),
            ]);
            const conversation = await prisma.conversation.create({
                data: {
                    type: 'DIRECT',
                    participants: {
                        create: [
                            { userId: users[0].id, role: 'MEMBER' },
                            { userId: users[1].id, role: 'MEMBER' },
                        ],
                    },
                },
            });
            // Create transactions that could potentially deadlock
            const potentialDeadlockTransactions = [
                // Transaction 1: Update user1 then user2
                prisma.$transaction(async (tx) => {
                    await tx.user.update({
                        where: { id: users[0].id },
                        data: { bio: 'Updated by transaction 1' },
                    });
                    await new Promise(resolve => setTimeout(resolve, 50));
                    await tx.user.update({
                        where: { id: users[1].id },
                        data: { bio: 'Also updated by transaction 1' },
                    });
                    await tx.message.create({
                        data: {
                            conversationId: conversation.id,
                            senderId: users[0].id,
                            content: 'Message from transaction 1',
                            messageType: 'TEXT',
                        },
                    });
                    return 'transaction-1-success';
                }),
                // Transaction 2: Update user2 then user1
                prisma.$transaction(async (tx) => {
                    await tx.user.update({
                        where: { id: users[1].id },
                        data: { firstName: 'Updated by transaction 2' },
                    });
                    await new Promise(resolve => setTimeout(resolve, 50));
                    await tx.user.update({
                        where: { id: users[0].id },
                        data: { firstName: 'Also updated by transaction 2' },
                    });
                    await tx.message.create({
                        data: {
                            conversationId: conversation.id,
                            senderId: users[1].id,
                            content: 'Message from transaction 2',
                            messageType: 'TEXT',
                        },
                    });
                    return 'transaction-2-success';
                }),
            ];
            const deadlockResults = await Promise.allSettled(potentialDeadlockTransactions);
            const successful = deadlockResults.filter(r => r.status === 'fulfilled').length;
            // Both transactions should complete successfully (no deadlock)
            expect(successful).toBeGreaterThanOrEqual(1); // At least one should succeed
            // Verify final state consistency
            const finalUsers = await prisma.user.findMany({
                where: {
                    id: { in: [users[0].id, users[1].id] },
                },
            });
            const messages = await prisma.message.findMany({
                where: { conversationId: conversation.id },
            });
            expect(finalUsers).toHaveLength(2);
            expect(messages.length).toBeGreaterThanOrEqual(1);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL3Rlc3QtdXRpbHMvaW50ZWdyYXRpb24tdGVzdHMvZGF0YWJhc2UtdHJhbnNhY3Rpb25zLmludGVncmF0aW9uLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFFdEQsbUZBQXVFO0FBQ3ZFLGdFQUEyRDtBQUMzRCxvRUFBNkQ7QUFFN0Q7Ozs7O0dBS0c7QUFDSCxRQUFRLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO0lBQ2pELElBQUksR0FBcUIsQ0FBQztJQUMxQixJQUFJLE1BQXFCLENBQUM7SUFDMUIsSUFBSSxTQUF3QixDQUFDO0lBRTdCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixzQkFBc0I7UUFDdEIsTUFBTSxHQUFHLE1BQU0sdUNBQWlCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUVyRCxTQUFTLEdBQUcsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDekMsU0FBUyxFQUFFO2dCQUNUO29CQUNFLE9BQU8sRUFBRSxzQ0FBYTtvQkFDdEIsUUFBUSxFQUFFLE1BQU07aUJBQ2pCO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixHQUFHLEdBQUcsU0FBUyxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDeEMsTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsaUNBQWlDO1FBQ2pDLE1BQU0sdUNBQWlCLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbEIsTUFBTSx1Q0FBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN4QyxNQUFNLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNsQixNQUFNLFNBQVMsQ0FBQyxLQUFL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QVUsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1lBQ2hGLE1BQU0sVUFBVSxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxLQUFLLFdBQVcsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUVoRiwrREFBK0Q7WUFDL0QsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsOEJBQThCO1lBRTVFLGlDQUFpQztZQUNqQyxNQUFNLFVBQVUsR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO2dCQUM1QyxLQUFLLEVBQUU7b0JBQ0wsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUU7aUJBQ3ZDO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxRQUFRLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztnQkFDN0MsS0FBSyxFQUFFLEVBQUUsY0FBYyxFQUFFLFlBQVksQ0FBQyxFQUFFLEVBQUU7YUFDM0MsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS93ZXRvb2EvRG9jdW1lbnRzL2NvZGUvcHJvamVjdHMvbWVudGFyYS9tZW50YXJhLWFwaS9zcmMvdGVzdC11dGlscy9pbnRlZ3JhdGlvbi10ZXN0cy9kYXRhYmFzZS10cmFuc2FjdGlvbnMuaW50ZWdyYXRpb24uc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IElOZXN0QXBwbGljYXRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBQcmlzbWFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vcHJvdmlkZXJzL3ByaXNtYS1jbGllbnQucHJvdmlkZXInO1xuaW1wb3J0IHsgRGF0YWJhc2VUZXN0U2V0dXAgfSBmcm9tICcuLi9kYXRhYmFzZS10ZXN0LnNldHVwJztcbmltcG9ydCB7IFRlc3REYXRhR2VuZXJhdG9yIH0gZnJvbSAnLi4vZW5oYW5jZWQtdGVzdC1oZWxwZXJzJztcblxuLyoqXG4gKiBEYXRhYmFzZSBUcmFuc2FjdGlvbnMgSW50ZWdyYXRpb24gVGVzdHNcbiAqIFxuICogQ29tcHJlaGVuc2l2ZSB0ZXN0aW5nIG9mIHRyYW5zYWN0aW9uIGludGVncml0eSwgcm9sbGJhY2sgc2NlbmFyaW9zLFxuICogY29uc3RyYWludCB2YWxpZGF0aW9uLCBhbmQgY29uY3VycmVudCB0cmFuc2FjdGlvbiBoYW5kbGluZy5cbiAqL1xuZGVzY3JpYmUoJ0RhdGFiYXNlIFRyYW5zYWN0aW9ucyBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgbGV0IGFwcDogSU5lc3RBcHBsaWNhdGlvbjtcbiAgbGV0IHByaXNtYTogUHJpc21hU2VydmljZTtcbiAgbGV0IG1vZHVsZVJlZjogVGVzdGluZ01vZHVsZTtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIFNldHVwIHRlc3QgZGF0YWJhc2VcbiAgICBwcmlzbWEgPSBhd2FpdCBEYXRhYmFzZVRlc3RTZXR1cC5zZXR1cFRlc3REYXRhYmFzZSgpO1xuXG4gICAgbW9kdWxlUmVmID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUHJpc21hU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogcHJpc21hLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBhcHAgPSBtb2R1bGVSZWYuY3JlYXRlTmVzdEFwcGxpY2F0aW9uKCk7XG4gICAgYXdhaXQgYXBwLmluaXQoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiBkYXRhYmFzZSBhZnRlciBlYWNoIHRlc3RcbiAgICBhd2FpdCBEYXRhYmFzZVRlc3RTZXR1cC5jbGVhbnVwRGF0YWJhc2UoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IERhdGFiYXNlVGVzdFNldHVwLnN0b3BDb250YWluZXIoKTtcbiAgICBhd2FpdCBhcHAuY2xvc2UoKTtcbiAgICBhd2FpdCBtb2R1bGVSZWYuY2xvc2UoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ011bHRpLU1vZGVsIFRyYW5zYWN0aW9uIEludGVncml0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBjb21taXQgY29tcGxleCBtdWx0aS1tb2RlbCB0cmFuc2FjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIC8vIDEuIENyZWF0ZSB1c2VyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0eC51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICBlbWFpbDogJ3RyYW5zYWN0aW9uLXN1Y2Nlc3NAdGVzdC5jb20nLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiAnVHJhbnNhY3Rpb24nLFxuICAgICAgICAgICAgbGFzdE5hbWU6ICdTdWNjZXNzJyxcbiAgICAgICAgICAgIHJvbGU6ICdjbGllbnQnLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyAyLiBDcmVhdGUgY2xpZW50IHByb2ZpbGVcbiAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgdHguY2xpZW50LmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gMy4gQ3JlYXRlIG5vdGlmaWNhdGlvbiBzZXR0aW5nc1xuICAgICAgICBjb25zdCBub3RpZmljYXRpb25TZXR0aW5ncyA9IGF3YWl0IHR4Lm5vdGlmaWNhdGlvblNldHRpbmdzLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgZW1haWxOb3RpZmljYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgcHVzaE5vdGlmaWNhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICBzbXNOb3RpZmljYXRpb25zOiBmYWxzZSxcbiAgICAgICAgICAgIG1hcmtldGluZ0VtYWlsczogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gNC4gQ3JlYXRlIHByZS1hc3Nlc3NtZW50XG4gICAgICAgIGNvbnN0IHByZUFzc2Vzc21lbnQgPSBhd2FpdCB0eC5wcmVBc3Nlc3NtZW50LmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgcXVlc3Rpb25uYWlyZXM6IHtcbiAgICAgICAgICAgICAgUEhROTogWzEsIDIsIDEsIDAsIDIsIDEsIDMsIDIsIDFdLFxuICAgICAgICAgICAgICBHQUQ3OiBbMiwgMSwgMywgMiwgMSwgMiwgM10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2NvcmVzOiB7XG4gICAgICAgICAgICAgIGRlcHJlc3Npb246IDE1LFxuICAgICAgICAgICAgICBhbnhpZXR5OiAxMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXZlcml0eUxldmVsczoge1xuICAgICAgICAgICAgICBkZXByZXNzaW9uOiAnbW9kZXJhdGUnLFxuICAgICAgICAgICAgICBhbnhpZXR5OiAnbWlsZCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyA1LiBDcmVhdGUgdXNlciBhY3Rpdml0eVxuICAgICAgICBjb25zdCB1c2VyQWN0aXZpdHkgPSBhd2FpdCB0eC51c2VyQWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICAgICAgICBhY3Rpdml0eVR5cGU6ICdhY2NvdW50X2NyZWF0aW9uJyxcbiAgICAgICAgICAgIGFjdGl2aXR5RGF0YToge1xuICAgICAgICAgICAgICByZWdpc3RyYXRpb25Tb3VyY2U6ICd3ZWInLFxuICAgICAgICAgICAgICBjb21wbGV0ZWRTdGVwczogWydwcm9maWxlJywgJ2Fzc2Vzc21lbnQnXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gNi4gQ3JlYXRlIGF1ZGl0IGxvZ1xuICAgICAgICBjb25zdCBhdWRpdExvZyA9IGF3YWl0IHR4LmF1ZGl0TG9nLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgYWN0aW9uOiAnVVNFUl9SRUdJU1RSQVRJT04nLFxuICAgICAgICAgICAgZW50aXR5OiAnVXNlcicsXG4gICAgICAgICAgICBlbnRpdHlJZDogdXNlci5pZCxcbiAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uQ29tcGxldGVkOiB0cnVlLFxuICAgICAgICAgICAgICBhc3Nlc3NtZW50Q29tcGxldGVkOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldmVyaXR5OiAnSU5GTycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1c2VyLFxuICAgICAgICAgIGNsaWVudCxcbiAgICAgICAgICBub3RpZmljYXRpb25TZXR0aW5ncyxcbiAgICAgICAgICBwcmVBc3Nlc3NtZW50LFxuICAgICAgICAgIHVzZXJBY3Rpdml0eSxcbiAgICAgICAgICBhdWRpdExvZyxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWZXJpZnkgYWxsIGVudGl0aWVzIHdlcmUgY3JlYXRlZFxuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyLmVtYWlsKS50b0JlKCd0cmFuc2FjdGlvbi1zdWNjZXNzQHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNsaWVudC51c2VySWQpLnRvQmUocmVzdWx0LnVzZXIuaWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ub3RpZmljYXRpb25TZXR0aW5ncy5lbWFpbE5vdGlmaWNhdGlvbnMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnByZUFzc2Vzc21lbnQuc3RhdHVzKS50b0JlKCdDT01QTEVURUQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXNlckFjdGl2aXR5LmFjdGl2aXR5VHlwZSkudG9CZSgnYWNjb3VudF9jcmVhdGlvbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hdWRpdExvZy5hY3Rpb24pLnRvQmUoJ1VTRVJfUkVHSVNUUkFUSU9OJyk7XG5cbiAgICAgIC8vIFZlcmlmeSBkYXRhIHBlcnNpc3RlbmNlIGFmdGVyIHRyYW5zYWN0aW9uXG4gICAgICBjb25zdCBwZXJzaXN0ZWRVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiByZXN1bHQudXNlci5pZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgY2xpZW50OiB0cnVlLFxuICAgICAgICAgIG5vdGlmaWNhdGlvblNldHRpbmdzOiB0cnVlLFxuICAgICAgICAgIHByZUFzc2Vzc21lbnQ6IHRydWUsXG4gICAgICAgICAgYWN0aXZpdGllczogdHJ1ZSxcbiAgICAgICAgICBhdWRpdExvZ3M6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHBlcnNpc3RlZFVzZXIpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChwZXJzaXN0ZWRVc2VyPy5jbGllbnQpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChwZXJzaXN0ZWRVc2VyPy5ub3RpZmljYXRpb25TZXR0aW5ncykudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KHBlcnNpc3RlZFVzZXI/LnByZUFzc2Vzc21lbnQpLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdChwZXJzaXN0ZWRVc2VyPy5hY3Rpdml0aWVzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocGVyc2lzdGVkVXNlcj8uYXVkaXRMb2dzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJvbGxiYWNrIHRyYW5zYWN0aW9uIG9uIGNvbnN0cmFpbnQgdmlvbGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHJhbnNhY3Rpb25GdW5jdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgLy8gMS4gQ3JlYXRlIGZpcnN0IHVzZXIgc3VjY2Vzc2Z1bGx5XG4gICAgICAgICAgY29uc3QgdXNlcjEgPSBhd2FpdCB0eC51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVVc2VyKHtcbiAgICAgICAgICAgICAgZW1haWw6ICdyb2xsYmFjay10ZXN0QHRlc3QuY29tJyxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiAnRmlyc3QnLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyAyLiBDcmVhdGUgY2xpZW50IGZvciBmaXJzdCB1c2VyXG4gICAgICAgICAgY29uc3QgY2xpZW50MSA9IGF3YWl0IHR4LmNsaWVudC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB1c2VySWQ6IHVzZXIxLmlkLFxuICAgICAgICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyAzLiBDcmVhdGUgbm90aWZpY2F0aW9uIHNldHRpbmdzXG4gICAgICAgICAgY29uc3Qgc2V0dGluZ3MxID0gYXdhaXQgdHgubm90aWZpY2F0aW9uU2V0dGluZ3MuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgdXNlcklkOiB1c2VyMS5pZCxcbiAgICAgICAgICAgICAgZW1haWxOb3RpZmljYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyA0LiBBdHRlbXB0IHRvIGNyZWF0ZSB1c2VyIHdpdGggZHVwbGljYXRlIGVtYWlsIChzaG91bGQgZmFpbClcbiAgICAgICAgICBjb25zdCB1c2VyMiA9IGF3YWl0IHR4LnVzZXIuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgaWQ6ICdkdXBsaWNhdGUtdXNlcicsXG4gICAgICAgICAgICAgIGVtYWlsOiAncm9sbGJhY2stdGVzdEB0ZXN0LmNvbScsIC8vIER1cGxpY2F0ZSBlbWFpbFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6ICdEdXBsaWNhdGUnLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4geyB1c2VyMSwgY2xpZW50MSwgc2V0dGluZ3MxLCB1c2VyMiB9O1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFRyYW5zYWN0aW9uIHNob3VsZCBmYWlsIGR1ZSB0byB1bmlxdWUgY29uc3RyYWludCB2aW9sYXRpb25cbiAgICAgIGF3YWl0IGV4cGVjdCh0cmFuc2FjdGlvbkZ1bmN0aW9uKCkpLnJlamVjdHMudG9UaHJvdygpO1xuXG4gICAgICAvLyBWZXJpZnkgbm8gZGF0YSB3YXMgcGVyc2lzdGVkXG4gICAgICBjb25zdCB1c2VycyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBlbWFpbDogJ3JvbGxiYWNrLXRlc3RAdGVzdC5jb20nLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNsaWVudHMgPSBhd2FpdCBwcmlzbWEuY2xpZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBlbWFpbDogJ3JvbGxiYWNrLXRlc3RAdGVzdC5jb20nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBwcmlzbWEubm90aWZpY2F0aW9uU2V0dGluZ3MuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIGVtYWlsOiAncm9sbGJhY2stdGVzdEB0ZXN0LmNvbScsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QodXNlcnMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChjbGllbnRzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3Qoc2V0dGluZ3MpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lc3RlZCB0cmFuc2FjdGlvbiByb2xsYmFjayBpbiBjb21wbGV4IHNjZW5hcmlvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5lc3RlZFRyYW5zYWN0aW9uRnVuY3Rpb24gPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgIC8vIENyZWF0ZSB0aGVyYXBpc3QgdXNlciBhbmQgcHJvZmlsZVxuICAgICAgICAgIGNvbnN0IHRoZXJhcGlzdFVzZXIgPSBhd2FpdCB0eC51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVVc2VyKHtcbiAgICAgICAgICAgICAgZW1haWw6ICduZXN0ZWQtdGhlcmFwaXN0QHRlc3QuY29tJyxcbiAgICAgICAgICAgICAgcm9sZTogJ3RoZXJhcGlzdCcsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IHRoZXJhcGlzdCA9IGF3YWl0IHR4LnRoZXJhcGlzdC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB1c2VySWQ6IHRoZXJhcGlzdFVzZXIuaWQsXG4gICAgICAgICAgICAgIG1vYmlsZTogJysxMjM0NTY3ODkwJyxcbiAgICAgICAgICAgICAgcHJvdmluY2U6ICdPbnRhcmlvJyxcbiAgICAgICAgICAgICAgcHJvdmlkZXJUeXBlOiAnQ2xpbmljYWwgUHN5Y2hvbG9naXN0JyxcbiAgICAgICAgICAgICAgcHJvZmVzc2lvbmFsTGljZW5zZVR5cGU6ICdMaWNlbnNlZCcsXG4gICAgICAgICAgICAgIGlzUFJDTGljZW5zZWQ6ICd5ZXMnLFxuICAgICAgICAgICAgICBwcmNMaWNlbnNlTnVtYmVyOiAnUFJDMTIzNDU2JyxcbiAgICAgICAgICAgICAgcHJhY3RpY2VTdGFydERhdGU6IG5ldyBEYXRlKCcyMDIwLTAxLTAxJyksXG4gICAgICAgICAgICAgIHllYXJzT2ZFeHBlcmllbmNlOiA1LFxuICAgICAgICAgICAgICBhcmVhc09mRXhwZXJ0aXNlOiBbJ0FueGlldHknXSxcbiAgICAgICAgICAgICAgYXNzZXNzbWVudFRvb2xzOiBbJ1BIUS05J10sXG4gICAgICAgICAgICAgIHRoZXJhcGV1dGljQXBwcm9hY2hlc1VzZWRMaXN0OiBbJ0NCVCddLFxuICAgICAgICAgICAgICBsYW5ndWFnZXNPZmZlcmVkOiBbJ0VuZ2xpc2gnXSxcbiAgICAgICAgICAgICAgcHJvdmlkZWRPbmxpbmVUaGVyYXB5QmVmb3JlOiB0cnVlLFxuICAgICAgICAgICAgICBjb21mb3J0YWJsZVVzaW5nVmlkZW9Db25mZXJlbmNpbmc6IHRydWUsXG4gICAgICAgICAgICAgIHByZWZlcnJlZFNlc3Npb25MZW5ndGg6IFs2MF0sXG4gICAgICAgICAgICAgIGFjY2VwdFR5cGVzOiBbJ0luZGl2aWR1YWwnXSxcbiAgICAgICAgICAgICAgc3RhdHVzOiAnYXBwcm92ZWQnLFxuICAgICAgICAgICAgICBob3VybHlSYXRlOiAxNTAsXG4gICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlT2ZMaWNlbnNlOiBuZXcgRGF0ZSgnMjAyNS0wMS0wMScpLFxuICAgICAgICAgICAgICBjb21wbGllc1dpdGhEYXRhUHJpdmFjeUFjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgd2lsbGluZ1RvQWJpZGVCeVBsYXRmb3JtR3VpZGVsaW5lczogdHJ1ZSxcbiAgICAgICAgICAgICAgdHJlYXRtZW50U3VjY2Vzc1JhdGVzOiB7fSxcbiAgICAgICAgICAgICAgc2Vzc2lvbkxlbmd0aDogJzYwIG1pbnV0ZXMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIENyZWF0ZSBjbGllbnQgdXNlciBhbmQgcHJvZmlsZVxuICAgICAgICAgIGNvbnN0IGNsaWVudFVzZXIgPSBhd2FpdCB0eC51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVVc2VyKHtcbiAgICAgICAgICAgICAgZW1haWw6ICduZXN0ZWQtY2xpZW50QHRlc3QuY29tJyxcbiAgICAgICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IHR4LmNsaWVudC5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB1c2VySWQ6IGNsaWVudFVzZXIuaWQsXG4gICAgICAgICAgICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQ3JlYXRlIG1lZXRpbmdcbiAgICAgICAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgdHgubWVldGluZy5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBjbGllbnRJZDogY2xpZW50LnVzZXJJZCxcbiAgICAgICAgICAgICAgdGhlcmFwaXN0SWQ6IHRoZXJhcGlzdC51c2VySWQsXG4gICAgICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjQtMTItMDFUMTA6MDA6MDBaJyksXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiA2MCxcbiAgICAgICAgICAgICAgc3RhdHVzOiAnU0NIRURVTEVEJyxcbiAgICAgICAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQ3JlYXRlIHNlc3Npb24gbG9nXG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbkxvZyA9IGF3YWl0IHR4LnNlc3Npb25Mb2cuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgY2xpZW50SWQ6IGNsaWVudC51c2VySWQsXG4gICAgICAgICAgICAgIG1lZXRpbmdJZDogbWVldGluZy5pZCxcbiAgICAgICAgICAgICAgc2Vzc2lvbkRhdGU6IG5ldyBEYXRlKCcyMDI0LTEyLTAxVDEwOjAwOjAwWicpLFxuICAgICAgICAgICAgICBkdXJhdGlvbjogNjAsXG4gICAgICAgICAgICAgIHNlc3Npb25UeXBlOiAnSW5kaXZpZHVhbCcsXG4gICAgICAgICAgICAgIG5vdGVzOiAnSW5pdGlhbCBzZXNzaW9uIG5vdGVzJyxcbiAgICAgICAgICAgICAgbW9vZDogJ25ldXRyYWwnLFxuICAgICAgICAgICAgICBwcm9ncmVzczogJ2dvb2QnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIEF0dGVtcHQgdG8gY3JlYXRlIGR1cGxpY2F0ZSBtZWV0aW5nIGF0IHNhbWUgdGltZSAoc2hvdWxkIGZhaWwpXG4gICAgICAgICAgY29uc3QgZHVwbGljYXRlTWVldGluZyA9IGF3YWl0IHR4Lm1lZXRpbmcuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgY2xpZW50SWQ6IGNsaWVudC51c2VySWQsXG4gICAgICAgICAgICAgIHRoZXJhcGlzdElkOiB0aGVyYXBpc3QudXNlcklkLFxuICAgICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDI0LTEyLTAxVDEwOjAwOjAwWicpLCAvLyBTYW1lIHRpbWVcbiAgICAgICAgICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgICAgICAgICBzdGF0dXM6ICdTQ0hFRFVMRUQnLFxuICAgICAgICAgICAgICBtZWV0aW5nVHlwZTogJ3ZpZGVvJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGhlcmFwaXN0VXNlcixcbiAgICAgICAgICAgIHRoZXJhcGlzdCxcbiAgICAgICAgICAgIGNsaWVudFVzZXIsXG4gICAgICAgICAgICBjbGllbnQsXG4gICAgICAgICAgICBtZWV0aW5nLFxuICAgICAgICAgICAgc2Vzc2lvbkxvZyxcbiAgICAgICAgICAgIGR1cGxpY2F0ZU1lZXRpbmcsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBUcmFuc2FjdGlvbiBzaG91bGQgZmFpbCAoYXNzdW1pbmcgYnVzaW5lc3MgbG9naWMgcHJldmVudHMgZG91YmxlIGJvb2tpbmcpXG4gICAgICBhd2FpdCBleHBlY3QobmVzdGVkVHJhbnNhY3Rpb25GdW5jdGlvbigpKS5yZWplY3RzLnRvVGhyb3coKTtcblxuICAgICAgLy8gVmVyaWZ5IGNvbXBsZXRlIHJvbGxiYWNrXG4gICAgICBjb25zdCB0aGVyYXBpc3RzID0gYXdhaXQgcHJpc21hLnRoZXJhcGlzdC5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgZW1haWw6ICduZXN0ZWQtdGhlcmFwaXN0QHRlc3QuY29tJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNsaWVudHMgPSBhd2FpdCBwcmlzbWEuY2xpZW50LmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBlbWFpbDogJ25lc3RlZC1jbGllbnRAdGVzdC5jb20nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWVldGluZ3MgPSBhd2FpdCBwcmlzbWEubWVldGluZy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2xpZW50OiB7XG4gICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgIGVtYWlsOiAnbmVzdGVkLWNsaWVudEB0ZXN0LmNvbScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHRoZXJhcGlzdHMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChjbGllbnRzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QobWVldGluZ3MpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbnN0cmFpbnQgVmFsaWRhdGlvbiBhbmQgQ2FzY2FkZSBEZWxldGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgZm9yZWlnbiBrZXkgY29uc3RyYWludHMgcHJvcGVybHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBdHRlbXB0IHRvIGNyZWF0ZSBjbGllbnQgd2l0aCBub24tZXhpc3RlbnQgdXNlciBJRFxuICAgICAgY29uc3QgaW52YWxpZENsaWVudENyZWF0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgcHJpc21hLmNsaWVudC5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogJ25vbi1leGlzdGVudC11c2VyLWlkJyxcbiAgICAgICAgICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGludmFsaWRDbGllbnRDcmVhdGlvbigpKS5yZWplY3RzLnRvVGhyb3coKTtcblxuICAgICAgLy8gQXR0ZW1wdCB0byBjcmVhdGUgbWVzc2FnZSB3aXRoIG5vbi1leGlzdGVudCBjb252ZXJzYXRpb24gSURcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICBkYXRhOiBUZXN0RGF0YUdlbmVyYXRvci5jcmVhdGVVc2VyKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2VDcmVhdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHByaXNtYS5tZXNzYWdlLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgY29udmVyc2F0aW9uSWQ6ICdub24tZXhpc3RlbnQtY29udmVyc2F0aW9uLWlkJyxcbiAgICAgICAgICAgIHNlbmRlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgY29udGVudDogJ1RoaXMgc2hvdWxkIGZhaWwnLFxuICAgICAgICAgICAgbWVzc2FnZVR5cGU6ICdURVhUJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChpbnZhbGlkTWVzc2FnZUNyZWF0aW9uKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FzY2FkZSBkZWxldGlvbiBjb3JyZWN0bHkgYWNyb3NzIHJlbGF0ZWQgbW9kZWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGNvbXBsZXRlIHVzZXIgaGllcmFyY2h5XG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgZW1haWw6ICdjYXNjYWRlQHRlc3QuY29tJyxcbiAgICAgICAgICByb2xlOiAnY2xpZW50JyxcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgcHJpc21hLmNsaWVudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgIGhhc1NlZW5UaGVyYXBpc3RSZWNvbW1lbmRhdGlvbnM6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSByZWxhdGVkIGVudGl0aWVzXG4gICAgICBjb25zdCBbXG4gICAgICAgIG5vdGlmaWNhdGlvblNldHRpbmdzLFxuICAgICAgICBwcmVBc3Nlc3NtZW50LFxuICAgICAgICB1c2VyQWN0aXZpdHksXG4gICAgICAgIGF1ZGl0TG9nLFxuICAgICAgICBtZWRpY2FsSGlzdG9yeSxcbiAgICAgICAgY2xpZW50UHJlZmVyZW5jZSxcbiAgICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHByaXNtYS5ub3RpZmljYXRpb25TZXR0aW5ncy5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsTm90aWZpY2F0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgIHB1c2hOb3RpZmljYXRpb25zOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgICBwcmlzbWEucHJlQXNzZXNzbWVudC5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICAgIHF1ZXN0aW9ubmFpcmVzOiB7IFBIUTk6IFsxLCAyLCAzXSB9LFxuICAgICAgICAgICAgc2NvcmVzOiB7IGRlcHJlc3Npb246IDEwIH0sXG4gICAgICAgICAgICBzZXZlcml0eUxldmVsczogeyBkZXByZXNzaW9uOiAnbWlsZCcgfSxcbiAgICAgICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHByaXNtYS51c2VyQWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICAgICAgICBhY3Rpdml0eVR5cGU6ICdsb2dpbicsXG4gICAgICAgICAgICBhY3Rpdml0eURhdGE6IHsgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpc21hLmF1ZGl0TG9nLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgYWN0aW9uOiAnVVNFUl9MT0dJTicsXG4gICAgICAgICAgICBlbnRpdHk6ICdVc2VyJyxcbiAgICAgICAgICAgIGVudGl0eUlkOiB1c2VyLmlkLFxuICAgICAgICAgICAgZGV0YWlsczogeyBpcDogJzEyNy4wLjAuMScgfSxcbiAgICAgICAgICAgIHNldmVyaXR5OiAnSU5GTycsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHByaXNtYS5jbGllbnRNZWRpY2FsSGlzdG9yeS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGNsaWVudElkOiBjbGllbnQudXNlcklkLFxuICAgICAgICAgICAgY29uZGl0aW9uOiAnQW54aWV0eScsXG4gICAgICAgICAgICBub3RlczogJ1Rlc3QgY29uZGl0aW9uJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpc21hLmNsaWVudFByZWZlcmVuY2UuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBjbGllbnRJZDogY2xpZW50LnVzZXJJZCxcbiAgICAgICAgICAgIGtleTogJ3Nlc3Npb25fdGltZScsXG4gICAgICAgICAgICB2YWx1ZTogJ21vcm5pbmcnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgXSk7XG5cbiAgICAgIC8vIEdldCBJRHMgYmVmb3JlIGRlbGV0aW9uXG4gICAgICBjb25zdCByZWxhdGVkSWRzID0ge1xuICAgICAgICBub3RpZmljYXRpb25TZXR0aW5nczogbm90aWZpY2F0aW9uU2V0dGluZ3MuaWQsXG4gICAgICAgIHByZUFzc2Vzc21lbnQ6IHByZUFzc2Vzc21lbnQuaWQsXG4gICAgICAgIHVzZXJBY3Rpdml0eTogdXNlckFjdGl2aXR5LmlkLFxuICAgICAgICBhdWRpdExvZzogYXVkaXRMb2cuaWQsXG4gICAgICAgIG1lZGljYWxIaXN0b3J5OiBtZWRpY2FsSGlzdG9yeS5pZCxcbiAgICAgICAgY2xpZW50UHJlZmVyZW5jZTogY2xpZW50UHJlZmVyZW5jZS5pZCxcbiAgICAgIH07XG5cbiAgICAgIC8vIERlbGV0ZSB1c2VyIC0gc2hvdWxkIGNhc2NhZGUgdG8gYWxsIHJlbGF0ZWQgZW50aXRpZXNcbiAgICAgIGF3YWl0IHByaXNtYS51c2VyLmRlbGV0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyLmlkIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gVmVyaWZ5IGNhc2NhZGUgZGVsZXRpb25cbiAgICAgIGNvbnN0IGNoZWNrUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChbXG4gICAgICAgIHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogdXNlci5pZCB9IH0pLFxuICAgICAgICBwcmlzbWEuY2xpZW50LmZpbmRVbmlxdWUoeyB3aGVyZTogeyB1c2VySWQ6IHVzZXIuaWQgfSB9KSxcbiAgICAgICAgcHJpc21hLm5vdGlmaWNhdGlvblNldHRpbmdzLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogcmVsYXRlZElkcy5ub3RpZmljYXRpb25TZXR0aW5ncyB9IH0pLFxuICAgICAgICBwcmlzbWEucHJlQXNzZXNzbWVudC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQ6IHJlbGF0ZWRJZHMucHJlQXNzZXNzbWVudCB9IH0pLFxuICAgICAgICBwcmlzbWEudXNlckFjdGl2aXR5LmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogcmVsYXRlZElkcy51c2VyQWN0aXZpdHkgfSB9KSxcbiAgICAgICAgcHJpc21hLmF1ZGl0TG9nLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogcmVsYXRlZElkcy5hdWRpdExvZyB9IH0pLFxuICAgICAgICBwcmlzbWEuY2xpZW50TWVkaWNhbEhpc3RvcnkuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkOiByZWxhdGVkSWRzLm1lZGljYWxIaXN0b3J5IH0gfSksXG4gICAgICAgIHByaXNtYS5jbGllbnRQcmVmZXJlbmNlLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogcmVsYXRlZElkcy5jbGllbnRQcmVmZXJlbmNlIH0gfSksXG4gICAgICBdKTtcblxuICAgICAgLy8gQWxsIHNob3VsZCBiZSBudWxsIChkZWxldGVkKVxuICAgICAgY2hlY2tSZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoJ2Z1bGZpbGxlZCcpO1xuICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcpIHtcbiAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbHVlKS50b0JlTnVsbCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuaXF1ZSBjb25zdHJhaW50IHZpb2xhdGlvbnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSB1c2VyIHdpdGggdW5pcXVlIGVtYWlsXG4gICAgICBjb25zdCB1c2VyMSA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgIGVtYWlsOiAndW5pcXVlQHRlc3QuY29tJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdGaXJzdCcsXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEF0dGVtcHQgdG8gY3JlYXRlIGFub3RoZXIgdXNlciB3aXRoIHNhbWUgZW1haWxcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZUVtYWlsQXR0ZW1wdCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICBlbWFpbDogJ3VuaXF1ZUB0ZXN0LmNvbScsIC8vIER1cGxpY2F0ZSBlbWFpbFxuICAgICAgICAgICAgZmlyc3ROYW1lOiAnU2Vjb25kJyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoZHVwbGljYXRlRW1haWxBdHRlbXB0KCkpLnJlamVjdHMudG9UaHJvdygpO1xuXG4gICAgICAvLyBDcmVhdGUgY29udmVyc2F0aW9uIHBhcnRpY2lwYW50XG4gICAgICBjb25zdCBjb252ZXJzYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udmVyc2F0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0eXBlOiAnRElSRUNUJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBwYXJ0aWNpcGFudDEgPSBhd2FpdCBwcmlzbWEuY29udmVyc2F0aW9uUGFydGljaXBhbnQuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiBjb252ZXJzYXRpb24uaWQsXG4gICAgICAgICAgdXNlcklkOiB1c2VyMS5pZCxcbiAgICAgICAgICByb2xlOiAnTUVNQkVSJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBdHRlbXB0IHRvIGNyZWF0ZSBkdXBsaWNhdGUgcGFydGljaXBhbnRcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZVBhcnRpY2lwYW50QXR0ZW1wdCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHByaXNtYS5jb252ZXJzYXRpb25QYXJ0aWNpcGFudC5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiBjb252ZXJzYXRpb24uaWQsXG4gICAgICAgICAgICB1c2VySWQ6IHVzZXIxLmlkLCAvLyBEdXBsaWNhdGUgY29tYmluYXRpb25cbiAgICAgICAgICAgIHJvbGU6ICdBRE1JTicsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoZHVwbGljYXRlUGFydGljaXBhbnRBdHRlbXB0KCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uY3VycmVudCBUcmFuc2FjdGlvbiBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHVzZXIgY3JlYXRpb24gY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY29uY3VycmVudFVzZXJzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+XG4gICAgICAgIHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICBlbWFpbDogYGNvbmN1cnJlbnQtJHtpfUB0ZXN0LmNvbWAsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IGBVc2VyJHtpfWAsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKGNvbmN1cnJlbnRVc2Vycyk7XG4gICAgICBjb25zdCBzdWNjZXNzZnVsID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcpLmxlbmd0aDtcbiAgICAgIGNvbnN0IGZhaWxlZCA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdyZWplY3RlZCcpLmxlbmd0aDtcblxuICAgICAgZXhwZWN0KHN1Y2Nlc3NmdWwpLnRvQmUoMTApOyAvLyBBbGwgc2hvdWxkIHN1Y2NlZWQgd2l0aCB1bmlxdWUgZW1haWxzXG4gICAgICBleHBlY3QoZmFpbGVkKS50b0JlKDApO1xuXG4gICAgICAvLyBWZXJpZnkgYWxsIHVzZXJzIHdlcmUgY3JlYXRlZFxuICAgICAgY29uc3QgY3JlYXRlZFVzZXJzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICBzdGFydHNXaXRoOiAnY29uY3VycmVudC0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGNyZWF0ZWRVc2VycykudG9IYXZlTGVuZ3RoKDEwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgdHJhbnNhY3Rpb24gY29uZmxpY3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGJhc2UgdXNlclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgIGVtYWlsOiAnY29uY3VycmVudC10cmFuc2FjdGlvbkB0ZXN0LmNvbScsXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWF0ZSBjb25jdXJyZW50IHRyYW5zYWN0aW9ucyB0aGF0IG1vZGlmeSB0aGUgc2FtZSB1c2VyXG4gICAgICBjb25zdCBjb25jdXJyZW50VHJhbnNhY3Rpb25zID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNSB9LCAoXywgaSkgPT5cbiAgICAgICAgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAvLyBSZWFkIGN1cnJlbnQgdXNlciBzdGF0ZVxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gYXdhaXQgdHgudXNlci5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyLmlkIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gU2ltdWxhdGUgc29tZSBwcm9jZXNzaW5nIHRpbWVcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgTWF0aC5yYW5kb20oKSAqIDEwMCkpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHVzZXIgd2l0aCBuZXcgaW5mb3JtYXRpb25cbiAgICAgICAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyLmlkIH0sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogYFVwZGF0ZWQke2l9YCxcbiAgICAgICAgICAgICAgYmlvOiBgVHJhbnNhY3Rpb24gJHtpfSBiaW8gdXBkYXRlYCxcbiAgICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIENyZWF0ZSBhY3Rpdml0eSBsb2dcbiAgICAgICAgICBhd2FpdCB0eC51c2VyQWN0aXZpdHkuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgICBhY3Rpdml0eVR5cGU6ICdwcm9maWxlX3VwZGF0ZScsXG4gICAgICAgICAgICAgIGFjdGl2aXR5RGF0YToge1xuICAgICAgICAgICAgICAgIHVwZGF0ZU51bWJlcjogaSxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4gdXBkYXRlZFVzZXI7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKGNvbmN1cnJlbnRUcmFuc2FjdGlvbnMpO1xuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bCA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKS5sZW5ndGg7XG5cbiAgICAgIC8vIEFsbCB0cmFuc2FjdGlvbnMgc2hvdWxkIHN1Y2NlZWQgZHVlIHRvIHByb3BlciBpc29sYXRpb25cbiAgICAgIGV4cGVjdChzdWNjZXNzZnVsKS50b0JlKDUpO1xuXG4gICAgICAvLyBWZXJpZnkgZmluYWwgc3RhdGUgY29uc2lzdGVuY3lcbiAgICAgIGNvbnN0IGZpbmFsVXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdXNlci5pZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgYWN0aXZpdGllczoge1xuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGZpbmFsVXNlcj8uYWN0aXZpdGllcykudG9IYXZlTGVuZ3RoKDUpO1xuICAgICAgZXhwZWN0KGZpbmFsVXNlcj8uZmlyc3ROYW1lKS50b01hdGNoKC9VcGRhdGVkXFxkLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBvcHRpbWlzdGljIGNvbmN1cnJlbmN5IGNvbnRyb2wnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgbWVldGluZyBmb3IgY29uY3VycmVudCB1cGRhdGVzXG4gICAgICBjb25zdCBjbGllbnRVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgcm9sZTogJ2NsaWVudCcsXG4gICAgICAgICAgZW1haWw6ICdjb25jdXJyZW5jeS1jbGllbnRAdGVzdC5jb20nLFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0aGVyYXBpc3RVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgcm9sZTogJ3RoZXJhcGlzdCcsXG4gICAgICAgICAgZW1haWw6ICdjb25jdXJyZW5jeS10aGVyYXBpc3RAdGVzdC5jb20nLFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBwcmlzbWEuY2xpZW50LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQ6IGNsaWVudFVzZXIuaWQsXG4gICAgICAgICAgaGFzU2VlblRoZXJhcGlzdFJlY29tbWVuZGF0aW9uczogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0aGVyYXBpc3QgPSBhd2FpdCBwcmlzbWEudGhlcmFwaXN0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQ6IHRoZXJhcGlzdFVzZXIuaWQsXG4gICAgICAgICAgbW9iaWxlOiAnKzEyMzQ1Njc4OTAnLFxuICAgICAgICAgIHByb3ZpbmNlOiAnT250YXJpbycsXG4gICAgICAgICAgcHJvdmlkZXJUeXBlOiAnQ2xpbmljYWwgUHN5Y2hvbG9naXN0JyxcbiAgICAgICAgICBwcm9mZXNzaW9uYWxMaWNlbnNlVHlwZTogJ0xpY2Vuc2VkJyxcbiAgICAgICAgICBpc1BSQ0xpY2Vuc2VkOiAneWVzJyxcbiAgICAgICAgICBwcmNMaWNlbnNlTnVtYmVyOiAnUFJDMTIzNDU2JyxcbiAgICAgICAgICBwcmFjdGljZVN0YXJ0RGF0ZTogbmV3IERhdGUoJzIwMjAtMDEtMDEnKSxcbiAgICAgICAgICB5ZWFyc09mRXhwZXJpZW5jZTogNSxcbiAgICAgICAgICBhcmVhc09mRXhwZXJ0aXNlOiBbJ0FueGlldHknXSxcbiAgICAgICAgICBhc3Nlc3NtZW50VG9vbHM6IFsnUEhRLTknXSxcbiAgICAgICAgICB0aGVyYXBldXRpY0FwcHJvYWNoZXNVc2VkTGlzdDogWydDQlQnXSxcbiAgICAgICAgICBsYW5ndWFnZXNPZmZlcmVkOiBbJ0VuZ2xpc2gnXSxcbiAgICAgICAgICBwcm92aWRlZE9ubGluZVRoZXJhcHlCZWZvcmU6IHRydWUsXG4gICAgICAgICAgY29tZm9ydGFibGVVc2luZ1ZpZGVvQ29uZmVyZW5jaW5nOiB0cnVlLFxuICAgICAgICAgIHByZWZlcnJlZFNlc3Npb25MZW5ndGg6IFs2MF0sXG4gICAgICAgICAgYWNjZXB0VHlwZXM6IFsnSW5kaXZpZHVhbCddLFxuICAgICAgICAgIHN0YXR1czogJ2FwcHJvdmVkJyxcbiAgICAgICAgICBob3VybHlSYXRlOiAxNTAsXG4gICAgICAgICAgZXhwaXJhdGlvbkRhdGVPZkxpY2Vuc2U6IG5ldyBEYXRlKCcyMDI1LTAxLTAxJyksXG4gICAgICAgICAgY29tcGxpZXNXaXRoRGF0YVByaXZhY3lBY3Q6IHRydWUsXG4gICAgICAgICAgd2lsbGluZ1RvQWJpZGVCeVBsYXRmb3JtR3VpZGVsaW5lczogdHJ1ZSxcbiAgICAgICAgICB0cmVhdG1lbnRTdWNjZXNzUmF0ZXM6IHt9LFxuICAgICAgICAgIHNlc3Npb25MZW5ndGg6ICc2MCBtaW51dGVzJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtZWV0aW5nID0gYXdhaXQgcHJpc21hLm1lZXRpbmcuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNsaWVudElkOiBjbGllbnQudXNlcklkLFxuICAgICAgICAgIHRoZXJhcGlzdElkOiB0aGVyYXBpc3QudXNlcklkLFxuICAgICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoJzIwMjQtMTItMDFUMTA6MDA6MDBaJyksXG4gICAgICAgICAgZHVyYXRpb246IDYwLFxuICAgICAgICAgIHN0YXR1czogJ1NDSEVEVUxFRCcsXG4gICAgICAgICAgbWVldGluZ1R5cGU6ICd2aWRlbycsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdJbml0aWFsIG1lZXRpbmcnLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIGNvbmN1cnJlbnQgdXBkYXRlcyB0byB0aGUgbWVldGluZ1xuICAgICAgY29uc3QgY29uY3VycmVudFVwZGF0ZXMgPSBbXG4gICAgICAgIHByaXNtYS5tZWV0aW5nLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmcuaWQgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZWQgYnkgY2xpZW50JyxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpc21hLm1lZXRpbmcudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogbWVldGluZy5pZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHN0YXR1czogJ0lOX1BST0dSRVNTJyxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpc21hLm1lZXRpbmcudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogbWVldGluZy5pZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGR1cmF0aW9uOiA5MCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoY29uY3VycmVudFVwZGF0ZXMpO1xuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bFVwZGF0ZXMgPSB1cGRhdGVSZXN1bHRzLmZpbHRlcihyID0+IHIuc3RhdHVzID09PSAnZnVsZmlsbGVkJykubGVuZ3RoO1xuXG4gICAgICAvLyBBbGwgdXBkYXRlcyBzaG91bGQgc3VjY2VlZFxuICAgICAgZXhwZWN0KHN1Y2Nlc3NmdWxVcGRhdGVzKS50b0JlKDMpO1xuXG4gICAgICAvLyBWZXJpZnkgZmluYWwgbWVldGluZyBzdGF0ZSBpcyBjb25zaXN0ZW50XG4gICAgICBjb25zdCBmaW5hbE1lZXRpbmcgPSBhd2FpdCBwcmlzbWEubWVldGluZy5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG1lZXRpbmcuaWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoZmluYWxNZWV0aW5nKS50b0JlVHJ1dGh5KCk7XG4gICAgICBleHBlY3QoZmluYWxNZWV0aW5nPy51cGRhdGVkQXQuZ2V0VGltZSgpKS50b0JlR3JlYXRlclRoYW4obWVldGluZy51cGRhdGVkQXQuZ2V0VGltZSgpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1RyYW5zYWN0aW9uIFBlcmZvcm1hbmNlIGFuZCBEZWFkbG9jayBQcmV2ZW50aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIHRyYW5zYWN0aW9uIHZvbHVtZXMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgYmF0Y2hTaXplID0gMjA7XG5cbiAgICAgIC8vIENyZWF0ZSBiYXRjaCBvZiB0cmFuc2FjdGlvbnNcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IGJhdGNoU2l6ZSB9LCAoXywgaSkgPT5cbiAgICAgICAgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdHgudXNlci5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICAgIGVtYWlsOiBgYmF0Y2gtJHtpfUB0ZXN0LmNvbWAsXG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogYEJhdGNoVXNlciR7aX1gLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCB0eC5jbGllbnQuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgICBoYXNTZWVuVGhlcmFwaXN0UmVjb21tZW5kYXRpb25zOiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IGF3YWl0IHR4Lm5vdGlmaWNhdGlvblNldHRpbmdzLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICAgICAgZW1haWxOb3RpZmljYXRpb25zOiB0cnVlLFxuICAgICAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4geyB1c2VyLCBjbGllbnQsIHNldHRpbmdzIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHRyYW5zYWN0aW9ucyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICAgICAgY29uc3Qgc3VjY2Vzc2Z1bCA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKS5sZW5ndGg7XG5cbiAgICAgIGV4cGVjdChzdWNjZXNzZnVsKS50b0JlKGJhdGNoU2l6ZSk7XG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbigxMDAwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gMTAgc2Vjb25kc1xuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEJhdGNoIFRyYW5zYWN0aW9uIFBlcmZvcm1hbmNlOlxuICAgICAgICBUcmFuc2FjdGlvbnM6ICR7YmF0Y2hTaXplfVxuICAgICAgICBTdWNjZXNzZnVsOiAke3N1Y2Nlc3NmdWx9XG4gICAgICAgIER1cmF0aW9uOiAke2R1cmF0aW9ufW1zXG4gICAgICAgIEF2ZyBwZXIgdHJhbnNhY3Rpb246ICR7KGR1cmF0aW9uIC8gYmF0Y2hTaXplKS50b0ZpeGVkKDIpfW1zYCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgZGVhZGxvY2tzIGluIGNvbXBsZXggc2NlbmFyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGJhc2UgZW50aXRpZXNcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IFRlc3REYXRhR2VuZXJhdG9yLmNyZWF0ZVVzZXIoe1xuICAgICAgICAgICAgZW1haWw6ICdkZWFkbG9jay0xQHRlc3QuY29tJyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICAgIHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YTogVGVzdERhdGFHZW5lcmF0b3IuY3JlYXRlVXNlcih7XG4gICAgICAgICAgICBlbWFpbDogJ2RlYWRsb2NrLTJAdGVzdC5jb20nLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCBjb252ZXJzYXRpb24gPSBhd2FpdCBwcmlzbWEuY29udmVyc2F0aW9uLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0eXBlOiAnRElSRUNUJyxcbiAgICAgICAgICBwYXJ0aWNpcGFudHM6IHtcbiAgICAgICAgICAgIGNyZWF0ZTogW1xuICAgICAgICAgICAgICB7IHVzZXJJZDogdXNlcnNbMF0uaWQsIHJvbGU6ICdNRU1CRVInIH0sXG4gICAgICAgICAgICAgIHsgdXNlcklkOiB1c2Vyc1sxXS5pZCwgcm9sZTogJ01FTUJFUicgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgdHJhbnNhY3Rpb25zIHRoYXQgY291bGQgcG90ZW50aWFsbHkgZGVhZGxvY2tcbiAgICAgIGNvbnN0IHBvdGVudGlhbERlYWRsb2NrVHJhbnNhY3Rpb25zID0gW1xuICAgICAgICAvLyBUcmFuc2FjdGlvbiAxOiBVcGRhdGUgdXNlcjEgdGhlbiB1c2VyMlxuICAgICAgICBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2Vyc1swXS5pZCB9LFxuICAgICAgICAgICAgZGF0YTogeyBiaW86ICdVcGRhdGVkIGJ5IHRyYW5zYWN0aW9uIDEnIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTApKTtcblxuICAgICAgICAgIGF3YWl0IHR4LnVzZXIudXBkYXRlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2Vyc1sxXS5pZCB9LFxuICAgICAgICAgICAgZGF0YTogeyBiaW86ICdBbHNvIHVwZGF0ZWQgYnkgdHJhbnNhY3Rpb24gMScgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGF3YWl0IHR4Lm1lc3NhZ2UuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgY29udmVyc2F0aW9uSWQ6IGNvbnZlcnNhdGlvbi5pZCxcbiAgICAgICAgICAgICAgc2VuZGVySWQ6IHVzZXJzWzBdLmlkLFxuICAgICAgICAgICAgICBjb250ZW50OiAnTWVzc2FnZSBmcm9tIHRyYW5zYWN0aW9uIDEnLFxuICAgICAgICAgICAgICBtZXNzYWdlVHlwZTogJ1RFWFQnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiAndHJhbnNhY3Rpb24tMS1zdWNjZXNzJztcbiAgICAgICAgfSksXG5cbiAgICAgICAgLy8gVHJhbnNhY3Rpb24gMjogVXBkYXRlIHVzZXIyIHRoZW4gdXNlcjFcbiAgICAgICAgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogdXNlcnNbMV0uaWQgfSxcbiAgICAgICAgICAgIGRhdGE6IHsgZmlyc3ROYW1lOiAnVXBkYXRlZCBieSB0cmFuc2FjdGlvbiAyJyB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwKSk7XG5cbiAgICAgICAgICBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogdXNlcnNbMF0uaWQgfSxcbiAgICAgICAgICAgIGRhdGE6IHsgZmlyc3ROYW1lOiAnQWxzbyB1cGRhdGVkIGJ5IHRyYW5zYWN0aW9uIDInIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBhd2FpdCB0eC5tZXNzYWdlLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkOiBjb252ZXJzYXRpb24uaWQsXG4gICAgICAgICAgICAgIHNlbmRlcklkOiB1c2Vyc1sxXS5pZCxcbiAgICAgICAgICAgICAgY29udGVudDogJ01lc3NhZ2UgZnJvbSB0cmFuc2FjdGlvbiAyJyxcbiAgICAgICAgICAgICAgbWVzc2FnZVR5cGU6ICdURVhUJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICByZXR1cm4gJ3RyYW5zYWN0aW9uLTItc3VjY2Vzcyc7XG4gICAgICAgIH0pLFxuICAgICAgXTtcblxuICAgICAgY29uc3QgZGVhZGxvY2tSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHBvdGVudGlhbERlYWRsb2NrVHJhbnNhY3Rpb25zKTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3NmdWwgPSBkZWFkbG9ja1Jlc3VsdHMuZmlsdGVyKHIgPT4gci5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKS5sZW5ndGg7XG5cbiAgICAgIC8vIEJvdGggdHJhbnNhY3Rpb25zIHNob3VsZCBjb21wbGV0ZSBzdWNjZXNzZnVsbHkgKG5vIGRlYWRsb2NrKVxuICAgICAgZXhwZWN0KHN1Y2Nlc3NmdWwpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7IC8vIEF0IGxlYXN0IG9uZSBzaG91bGQgc3VjY2VlZFxuXG4gICAgICAvLyBWZXJpZnkgZmluYWwgc3RhdGUgY29uc2lzdGVuY3lcbiAgICAgIGNvbnN0IGZpbmFsVXNlcnMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgaWQ6IHsgaW46IFt1c2Vyc1swXS5pZCwgdXNlcnNbMV0uaWRdIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCBwcmlzbWEubWVzc2FnZS5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGNvbnZlcnNhdGlvbklkOiBjb252ZXJzYXRpb24uaWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoZmluYWxVc2VycykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2VzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=