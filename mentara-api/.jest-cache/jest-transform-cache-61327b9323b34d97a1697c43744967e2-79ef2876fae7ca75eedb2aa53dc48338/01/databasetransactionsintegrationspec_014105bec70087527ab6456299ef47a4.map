{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/integration-tests/database-transactions.integration.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/test-utils/integration-tests/database-transactions.integration.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { INestApplication } from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { DatabaseTestSetup } from '../database-test.setup';\nimport { TestDataGenerator } from '../enhanced-test-helpers';\n\n/**\n * Database Transactions Integration Tests\n * \n * Comprehensive testing of transaction integrity, rollback scenarios,\n * constraint validation, and concurrent transaction handling.\n */\ndescribe('Database Transactions Integration', () => {\n  let app: INestApplication;\n  let prisma: PrismaService;\n  let moduleRef: TestingModule;\n\n  beforeAll(async () => {\n    // Setup test database\n    prisma = await DatabaseTestSetup.setupTestDatabase();\n\n    moduleRef = await Test.createTestingModule({\n      providers: [\n        {\n          provide: PrismaService,\n          useValue: prisma,\n        },\n      ],\n    }).compile();\n\n    app = moduleRef.createNestApplication();\n    await app.init();\n  });\n\n  afterEach(async () => {\n    // Clean database after each test\n    await DatabaseTestSetup.cleanupDatabase();\n  });\n\n  afterAll(async () => {\n    await DatabaseTestSetup.stopContainer();\n    await app.close();\n    await moduleRef.close();\n  });\n\n  describe('Multi-Model Transaction Integrity', () => {\n    it('should successfully commit complex multi-model transaction', async () => {\n      const result = await prisma.$transaction(async (tx) => {\n        // 1. Create user\n        const user = await tx.user.create({\n          data: TestDataGenerator.createUser({\n            email: 'transaction-success@test.com',\n            firstName: 'Transaction',\n            lastName: 'Success',\n            role: 'client',\n          }),\n        });\n\n        // 2. Create client profile\n        const client = await tx.client.create({\n          data: {\n            userId: user.id,\n            hasSeenTherapistRecommendations: false,\n          },\n        });\n\n        // 3. Create notification settings\n        const notificationSettings = await tx.notificationSettings.create({\n          data: {\n            userId: user.id,\n            emailNotifications: true,\n            pushNotifications: true,\n            smsNotifications: false,\n            marketingEmails: false,\n          },\n        });\n\n        // 4. Create pre-assessment\n        const preAssessment = await tx.preAssessment.create({\n          data: {\n            userId: user.id,\n            questionnaires: {\n              PHQ9: [1, 2, 1, 0, 2, 1, 3, 2, 1],\n              GAD7: [2, 1, 3, 2, 1, 2, 3],\n            },\n            scores: {\n              depression: 15,\n              anxiety: 12,\n            },\n            severityLevels: {\n              depression: 'moderate',\n              anxiety: 'mild',\n            },\n            status: 'COMPLETED',\n          },\n        });\n\n        // 5. Create user activity\n        const userActivity = await tx.userActivity.create({\n          data: {\n            userId: user.id,\n            activityType: 'account_creation',\n            activityData: {\n              registrationSource: 'web',\n              completedSteps: ['profile', 'assessment'],\n            },\n          },\n        });\n\n        // 6. Create audit log\n        const auditLog = await tx.auditLog.create({\n          data: {\n            userId: user.id,\n            action: 'USER_REGISTRATION',\n            entity: 'User',\n            entityId: user.id,\n            details: {\n              registrationCompleted: true,\n              assessmentCompleted: true,\n            },\n            severity: 'INFO',\n          },\n        });\n\n        return {\n          user,\n          client,\n          notificationSettings,\n          preAssessment,\n          userActivity,\n          auditLog,\n        };\n      });\n\n      // Verify all entities were created\n      expect(result.user.email).toBe('transaction-success@test.com');\n      expect(result.client.userId).toBe(result.user.id);\n      expect(result.notificationSettings.emailNotifications).toBe(true);\n      expect(result.preAssessment.status).toBe('COMPLETED');\n      expect(result.userActivity.activityType).toBe('account_creation');\n      expect(result.auditLog.action).toBe('USER_REGISTRATION');\n\n      // Verify data persistence after transaction\n      const persistedUser = await prisma.user.findUnique({\n        where: { id: result.user.id },\n        include: {\n          client: true,\n          notificationSettings: true,\n          preAssessment: true,\n          activities: true,\n          auditLogs: true,\n        },\n      });\n\n      expect(persistedUser).toBeTruthy();\n      expect(persistedUser?.client).toBeTruthy();\n      expect(persistedUser?.notificationSettings).toBeTruthy();\n      expect(persistedUser?.preAssessment).toBeTruthy();\n      expect(persistedUser?.activities).toHaveLength(1);\n      expect(persistedUser?.auditLogs).toHaveLength(1);\n    });\n\n    it('should rollback transaction on constraint violation', async () => {\n      const transactionFunction = async () => {\n        return await prisma.$transaction(async (tx) => {\n          // 1. Create first user successfully\n          const user1 = await tx.user.create({\n            data: TestDataGenerator.createUser({\n              email: 'rollback-test@test.com',\n              firstName: 'First',\n              lastName: 'User',\n            }),\n          });\n\n          // 2. Create client for first user\n          const client1 = await tx.client.create({\n            data: {\n              userId: user1.id,\n              hasSeenTherapistRecommendations: false,\n            },\n          });\n\n          // 3. Create notification settings\n          const settings1 = await tx.notificationSettings.create({\n            data: {\n              userId: user1.id,\n              emailNotifications: true,\n              pushNotifications: true,\n            },\n          });\n\n          // 4. Attempt to create user with duplicate email (should fail)\n          const user2 = await tx.user.create({\n            data: {\n              id: 'duplicate-user',\n              email: 'rollback-test@test.com', // Duplicate email\n              firstName: 'Duplicate',\n              lastName: 'User',\n              role: 'client',\n            },\n          });\n\n          return { user1, client1, settings1, user2 };\n        });\n      };\n\n      // Transaction should fail due to unique constraint violation\n      await expect(transactionFunction()).rejects.toThrow();\n\n      // Verify no data was persisted\n      const users = await prisma.user.findMany({\n        where: {\n          email: 'rollback-test@test.com',\n        },\n      });\n\n      const clients = await prisma.client.findMany({\n        where: {\n          user: {\n            email: 'rollback-test@test.com',\n          },\n        },\n      });\n\n      const settings = await prisma.notificationSettings.findMany({\n        where: {\n          user: {\n            email: 'rollback-test@test.com',\n          },\n        },\n      });\n\n      expect(users).toHaveLength(0);\n      expect(clients).toHaveLength(0);\n      expect(settings).toHaveLength(0);\n    });\n\n    it('should handle nested transaction rollback in complex scenarios', async () => {\n      const nestedTransactionFunction = async () => {\n        return await prisma.$transaction(async (tx) => {\n          // Create therapist user and profile\n          const therapistUser = await tx.user.create({\n            data: TestDataGenerator.createUser({\n              email: 'nested-therapist@test.com',\n              role: 'therapist',\n            }),\n          });\n\n          const therapist = await tx.therapist.create({\n            data: {\n              userId: therapistUser.id,\n              mobile: '+1234567890',\n              province: 'Ontario',\n              providerType: 'Clinical Psychologist',\n              professionalLicenseType: 'Licensed',\n              isPRCLicensed: 'yes',\n              prcLicenseNumber: 'PRC123456',\n              practiceStartDate: new Date('2020-01-01'),\n              yearsOfExperience: 5,\n              areasOfExpertise: ['Anxiety'],\n              assessmentTools: ['PHQ-9'],\n              therapeuticApproachesUsedList: ['CBT'],\n              languagesOffered: ['English'],\n              providedOnlineTherapyBefore: true,\n              comfortableUsingVideoConferencing: true,\n              preferredSessionLength: [60],\n              acceptTypes: ['Individual'],\n              status: 'approved',\n              hourlyRate: 150,\n              expirationDateOfLicense: new Date('2025-01-01'),\n              compliesWithDataPrivacyAct: true,\n              willingToAbideByPlatformGuidelines: true,\n              treatmentSuccessRates: {},\n              sessionLength: '60 minutes',\n            },\n          });\n\n          // Create client user and profile\n          const clientUser = await tx.user.create({\n            data: TestDataGenerator.createUser({\n              email: 'nested-client@test.com',\n              role: 'client',\n            }),\n          });\n\n          const client = await tx.client.create({\n            data: {\n              userId: clientUser.id,\n              hasSeenTherapistRecommendations: true,\n            },\n          });\n\n          // Create meeting\n          const meeting = await tx.meeting.create({\n            data: {\n              clientId: client.userId,\n              therapistId: therapist.userId,\n              startTime: new Date('2024-12-01T10:00:00Z'),\n              duration: 60,\n              status: 'SCHEDULED',\n              meetingType: 'video',\n            },\n          });\n\n          // Create session log\n          const sessionLog = await tx.sessionLog.create({\n            data: {\n              clientId: client.userId,\n              meetingId: meeting.id,\n              sessionDate: new Date('2024-12-01T10:00:00Z'),\n              duration: 60,\n              sessionType: 'Individual',\n              notes: 'Initial session notes',\n              mood: 'neutral',\n              progress: 'good',\n            },\n          });\n\n          // Attempt to create duplicate meeting at same time (should fail)\n          const duplicateMeeting = await tx.meeting.create({\n            data: {\n              clientId: client.userId,\n              therapistId: therapist.userId,\n              startTime: new Date('2024-12-01T10:00:00Z'), // Same time\n              duration: 60,\n              status: 'SCHEDULED',\n              meetingType: 'video',\n            },\n          });\n\n          return {\n            therapistUser,\n            therapist,\n            clientUser,\n            client,\n            meeting,\n            sessionLog,\n            duplicateMeeting,\n          };\n        });\n      };\n\n      // Transaction should fail (assuming business logic prevents double booking)\n      await expect(nestedTransactionFunction()).rejects.toThrow();\n\n      // Verify complete rollback\n      const therapists = await prisma.therapist.findMany({\n        where: {\n          user: {\n            email: 'nested-therapist@test.com',\n          },\n        },\n      });\n\n      const clients = await prisma.client.findMany({\n        where: {\n          user: {\n            email: 'nested-client@test.com',\n          },\n        },\n      });\n\n      const meetings = await prisma.meeting.findMany({\n        where: {\n          client: {\n            user: {\n              email: 'nested-client@test.com',\n            },\n          },\n        },\n      });\n\n      expect(therapists).toHaveLength(0);\n      expect(clients).toHaveLength(0);\n      expect(meetings).toHaveLength(0);\n    });\n  });\n\n  describe('Constraint Validation and Cascade Deletion', () => {\n    it('should enforce foreign key constraints properly', async () => {\n      // Attempt to create client with non-existent user ID\n      const invalidClientCreation = async () => {\n        return await prisma.client.create({\n          data: {\n            userId: 'non-existent-user-id',\n            hasSeenTherapistRecommendations: false,\n          },\n        });\n      };\n\n      await expect(invalidClientCreation()).rejects.toThrow();\n\n      // Attempt to create message with non-existent conversation ID\n      const user = await prisma.user.create({\n        data: TestDataGenerator.createUser(),\n      });\n\n      const invalidMessageCreation = async () => {\n        return await prisma.message.create({\n          data: {\n            conversationId: 'non-existent-conversation-id',\n            senderId: user.id,\n            content: 'This should fail',\n            messageType: 'TEXT',\n          },\n        });\n      };\n\n      await expect(invalidMessageCreation()).rejects.toThrow();\n    });\n\n    it('should handle cascade deletion correctly across related models', async () => {\n      // Create complete user hierarchy\n      const user = await prisma.user.create({\n        data: TestDataGenerator.createUser({\n          email: 'cascade@test.com',\n          role: 'client',\n        }),\n      });\n\n      const client = await prisma.client.create({\n        data: {\n          userId: user.id,\n          hasSeenTherapistRecommendations: false,\n        },\n      });\n\n      // Create related entities\n      const [\n        notificationSettings,\n        preAssessment,\n        userActivity,\n        auditLog,\n        medicalHistory,\n        clientPreference,\n      ] = await Promise.all([\n        prisma.notificationSettings.create({\n          data: {\n            userId: user.id,\n            emailNotifications: true,\n            pushNotifications: true,\n          },\n        }),\n        prisma.preAssessment.create({\n          data: {\n            userId: user.id,\n            questionnaires: { PHQ9: [1, 2, 3] },\n            scores: { depression: 10 },\n            severityLevels: { depression: 'mild' },\n            status: 'COMPLETED',\n          },\n        }),\n        prisma.userActivity.create({\n          data: {\n            userId: user.id,\n            activityType: 'login',\n            activityData: { timestamp: new Date().toISOString() },\n          },\n        }),\n        prisma.auditLog.create({\n          data: {\n            userId: user.id,\n            action: 'USER_LOGIN',\n            entity: 'User',\n            entityId: user.id,\n            details: { ip: '127.0.0.1' },\n            severity: 'INFO',\n          },\n        }),\n        prisma.clientMedicalHistory.create({\n          data: {\n            clientId: client.userId,\n            condition: 'Anxiety',\n            notes: 'Test condition',\n          },\n        }),\n        prisma.clientPreference.create({\n          data: {\n            clientId: client.userId,\n            key: 'session_time',\n            value: 'morning',\n          },\n        }),\n      ]);\n\n      // Get IDs before deletion\n      const relatedIds = {\n        notificationSettings: notificationSettings.id,\n        preAssessment: preAssessment.id,\n        userActivity: userActivity.id,\n        auditLog: auditLog.id,\n        medicalHistory: medicalHistory.id,\n        clientPreference: clientPreference.id,\n      };\n\n      // Delete user - should cascade to all related entities\n      await prisma.user.delete({\n        where: { id: user.id },\n      });\n\n      // Verify cascade deletion\n      const checkResults = await Promise.allSettled([\n        prisma.user.findUnique({ where: { id: user.id } }),\n        prisma.client.findUnique({ where: { userId: user.id } }),\n        prisma.notificationSettings.findUnique({ where: { id: relatedIds.notificationSettings } }),\n        prisma.preAssessment.findUnique({ where: { id: relatedIds.preAssessment } }),\n        prisma.userActivity.findUnique({ where: { id: relatedIds.userActivity } }),\n        prisma.auditLog.findUnique({ where: { id: relatedIds.auditLog } }),\n        prisma.clientMedicalHistory.findUnique({ where: { id: relatedIds.medicalHistory } }),\n        prisma.clientPreference.findUnique({ where: { id: relatedIds.clientPreference } }),\n      ]);\n\n      // All should be null (deleted)\n      checkResults.forEach(result => {\n        expect(result.status).toBe('fulfilled');\n        if (result.status === 'fulfilled') {\n          expect(result.value).toBeNull();\n        }\n      });\n    });\n\n    it('should handle unique constraint violations gracefully', async () => {\n      // Create user with unique email\n      const user1 = await prisma.user.create({\n        data: TestDataGenerator.createUser({\n          email: 'unique@test.com',\n          firstName: 'First',\n        }),\n      });\n\n      // Attempt to create another user with same email\n      const duplicateEmailAttempt = async () => {\n        return await prisma.user.create({\n          data: TestDataGenerator.createUser({\n            email: 'unique@test.com', // Duplicate email\n            firstName: 'Second',\n          }),\n        });\n      };\n\n      await expect(duplicateEmailAttempt()).rejects.toThrow();\n\n      // Create conversation participant\n      const conversation = await prisma.conversation.create({\n        data: {\n          type: 'DIRECT',\n          isActive: true,\n        },\n      });\n\n      const participant1 = await prisma.conversationParticipant.create({\n        data: {\n          conversationId: conversation.id,\n          userId: user1.id,\n          role: 'MEMBER',\n        },\n      });\n\n      // Attempt to create duplicate participant\n      const duplicateParticipantAttempt = async () => {\n        return await prisma.conversationParticipant.create({\n          data: {\n            conversationId: conversation.id,\n            userId: user1.id, // Duplicate combination\n            role: 'ADMIN',\n          },\n        });\n      };\n\n      await expect(duplicateParticipantAttempt()).rejects.toThrow();\n    });\n  });\n\n  describe('Concurrent Transaction Handling', () => {\n    it('should handle concurrent user creation correctly', async () => {\n      const concurrentUsers = Array.from({ length: 10 }, (_, i) =>\n        prisma.user.create({\n          data: TestDataGenerator.createUser({\n            email: `concurrent-${i}@test.com`,\n            firstName: `User${i}`,\n          }),\n        })\n      );\n\n      const results = await Promise.allSettled(concurrentUsers);\n      const successful = results.filter(r => r.status === 'fulfilled').length;\n      const failed = results.filter(r => r.status === 'rejected').length;\n\n      expect(successful).toBe(10); // All should succeed with unique emails\n      expect(failed).toBe(0);\n\n      // Verify all users were created\n      const createdUsers = await prisma.user.findMany({\n        where: {\n          email: {\n            startsWith: 'concurrent-',\n          },\n        },\n      });\n\n      expect(createdUsers).toHaveLength(10);\n    });\n\n    it('should handle concurrent transaction conflicts', async () => {\n      // Create base user\n      const user = await prisma.user.create({\n        data: TestDataGenerator.createUser({\n          email: 'concurrent-transaction@test.com',\n        }),\n      });\n\n      // Create concurrent transactions that modify the same user\n      const concurrentTransactions = Array.from({ length: 5 }, (_, i) =>\n        prisma.$transaction(async (tx) => {\n          // Read current user state\n          const currentUser = await tx.user.findUnique({\n            where: { id: user.id },\n          });\n\n          if (!currentUser) {\n            throw new Error('User not found');\n          }\n\n          // Simulate some processing time\n          await new Promise(resolve => setTimeout(resolve, Math.random() * 100));\n\n          // Update user with new information\n          const updatedUser = await tx.user.update({\n            where: { id: user.id },\n            data: {\n              firstName: `Updated${i}`,\n              bio: `Transaction ${i} bio update`,\n              updatedAt: new Date(),\n            },\n          });\n\n          // Create activity log\n          await tx.userActivity.create({\n            data: {\n              userId: user.id,\n              activityType: 'profile_update',\n              activityData: {\n                updateNumber: i,\n                timestamp: new Date().toISOString(),\n              },\n            },\n          });\n\n          return updatedUser;\n        })\n      );\n\n      const results = await Promise.allSettled(concurrentTransactions);\n      const successful = results.filter(r => r.status === 'fulfilled').length;\n\n      // All transactions should succeed due to proper isolation\n      expect(successful).toBe(5);\n\n      // Verify final state consistency\n      const finalUser = await prisma.user.findUnique({\n        where: { id: user.id },\n        include: {\n          activities: {\n            orderBy: { createdAt: 'desc' },\n          },\n        },\n      });\n\n      expect(finalUser?.activities).toHaveLength(5);\n      expect(finalUser?.firstName).toMatch(/Updated\\d/);\n    });\n\n    it('should handle optimistic concurrency control', async () => {\n      // Create meeting for concurrent updates\n      const clientUser = await prisma.user.create({\n        data: TestDataGenerator.createUser({\n          role: 'client',\n          email: 'concurrency-client@test.com',\n        }),\n      });\n\n      const therapistUser = await prisma.user.create({\n        data: TestDataGenerator.createUser({\n          role: 'therapist',\n          email: 'concurrency-therapist@test.com',\n        }),\n      });\n\n      const client = await prisma.client.create({\n        data: {\n          userId: clientUser.id,\n          hasSeenTherapistRecommendations: true,\n        },\n      });\n\n      const therapist = await prisma.therapist.create({\n        data: {\n          userId: therapistUser.id,\n          mobile: '+1234567890',\n          province: 'Ontario',\n          providerType: 'Clinical Psychologist',\n          professionalLicenseType: 'Licensed',\n          isPRCLicensed: 'yes',\n          prcLicenseNumber: 'PRC123456',\n          practiceStartDate: new Date('2020-01-01'),\n          yearsOfExperience: 5,\n          areasOfExpertise: ['Anxiety'],\n          assessmentTools: ['PHQ-9'],\n          therapeuticApproachesUsedList: ['CBT'],\n          languagesOffered: ['English'],\n          providedOnlineTherapyBefore: true,\n          comfortableUsingVideoConferencing: true,\n          preferredSessionLength: [60],\n          acceptTypes: ['Individual'],\n          status: 'approved',\n          hourlyRate: 150,\n          expirationDateOfLicense: new Date('2025-01-01'),\n          compliesWithDataPrivacyAct: true,\n          willingToAbideByPlatformGuidelines: true,\n          treatmentSuccessRates: {},\n          sessionLength: '60 minutes',\n        },\n      });\n\n      const meeting = await prisma.meeting.create({\n        data: {\n          clientId: client.userId,\n          therapistId: therapist.userId,\n          startTime: new Date('2024-12-01T10:00:00Z'),\n          duration: 60,\n          status: 'SCHEDULED',\n          meetingType: 'video',\n          description: 'Initial meeting',\n        },\n      });\n\n      // Simulate concurrent updates to the meeting\n      const concurrentUpdates = [\n        prisma.meeting.update({\n          where: { id: meeting.id },\n          data: {\n            description: 'Updated by client',\n            updatedAt: new Date(),\n          },\n        }),\n        prisma.meeting.update({\n          where: { id: meeting.id },\n          data: {\n            status: 'IN_PROGRESS',\n            updatedAt: new Date(),\n          },\n        }),\n        prisma.meeting.update({\n          where: { id: meeting.id },\n          data: {\n            duration: 90,\n            updatedAt: new Date(),\n          },\n        }),\n      ];\n\n      const updateResults = await Promise.allSettled(concurrentUpdates);\n      const successfulUpdates = updateResults.filter(r => r.status === 'fulfilled').length;\n\n      // All updates should succeed\n      expect(successfulUpdates).toBe(3);\n\n      // Verify final meeting state is consistent\n      const finalMeeting = await prisma.meeting.findUnique({\n        where: { id: meeting.id },\n      });\n\n      expect(finalMeeting).toBeTruthy();\n      expect(finalMeeting?.updatedAt.getTime()).toBeGreaterThan(meeting.updatedAt.getTime());\n    });\n  });\n\n  describe('Transaction Performance and Deadlock Prevention', () => {\n    it('should handle large transaction volumes efficiently', async () => {\n      const startTime = Date.now();\n      const batchSize = 20;\n\n      // Create batch of transactions\n      const transactions = Array.from({ length: batchSize }, (_, i) =>\n        prisma.$transaction(async (tx) => {\n          const user = await tx.user.create({\n            data: TestDataGenerator.createUser({\n              email: `batch-${i}@test.com`,\n              firstName: `BatchUser${i}`,\n            }),\n          });\n\n          const client = await tx.client.create({\n            data: {\n              userId: user.id,\n              hasSeenTherapistRecommendations: false,\n            },\n          });\n\n          const settings = await tx.notificationSettings.create({\n            data: {\n              userId: user.id,\n              emailNotifications: true,\n              pushNotifications: true,\n            },\n          });\n\n          return { user, client, settings };\n        })\n      );\n\n      const results = await Promise.allSettled(transactions);\n      const endTime = Date.now();\n      const duration = endTime - startTime;\n\n      const successful = results.filter(r => r.status === 'fulfilled').length;\n\n      expect(successful).toBe(batchSize);\n      expect(duration).toBeLessThan(10000); // Should complete within 10 seconds\n\n      console.log(` Batch Transaction Performance:\n        Transactions: ${batchSize}\n        Successful: ${successful}\n        Duration: ${duration}ms\n        Avg per transaction: ${(duration / batchSize).toFixed(2)}ms`);\n    });\n\n    it('should prevent deadlocks in complex scenarios', async () => {\n      // Create base entities\n      const users = await Promise.all([\n        prisma.user.create({\n          data: TestDataGenerator.createUser({\n            email: 'deadlock-1@test.com',\n          }),\n        }),\n        prisma.user.create({\n          data: TestDataGenerator.createUser({\n            email: 'deadlock-2@test.com',\n          }),\n        }),\n      ]);\n\n      const conversation = await prisma.conversation.create({\n        data: {\n          type: 'DIRECT',\n          participants: {\n            create: [\n              { userId: users[0].id, role: 'MEMBER' },\n              { userId: users[1].id, role: 'MEMBER' },\n            ],\n          },\n        },\n      });\n\n      // Create transactions that could potentially deadlock\n      const potentialDeadlockTransactions = [\n        // Transaction 1: Update user1 then user2\n        prisma.$transaction(async (tx) => {\n          await tx.user.update({\n            where: { id: users[0].id },\n            data: { bio: 'Updated by transaction 1' },\n          });\n\n          await new Promise(resolve => setTimeout(resolve, 50));\n\n          await tx.user.update({\n            where: { id: users[1].id },\n            data: { bio: 'Also updated by transaction 1' },\n          });\n\n          await tx.message.create({\n            data: {\n              conversationId: conversation.id,\n              senderId: users[0].id,\n              content: 'Message from transaction 1',\n              messageType: 'TEXT',\n            },\n          });\n\n          return 'transaction-1-success';\n        }),\n\n        // Transaction 2: Update user2 then user1\n        prisma.$transaction(async (tx) => {\n          await tx.user.update({\n            where: { id: users[1].id },\n            data: { firstName: 'Updated by transaction 2' },\n          });\n\n          await new Promise(resolve => setTimeout(resolve, 50));\n\n          await tx.user.update({\n            where: { id: users[0].id },\n            data: { firstName: 'Also updated by transaction 2' },\n          });\n\n          await tx.message.create({\n            data: {\n              conversationId: conversation.id,\n              senderId: users[1].id,\n              content: 'Message from transaction 2',\n              messageType: 'TEXT',\n            },\n          });\n\n          return 'transaction-2-success';\n        }),\n      ];\n\n      const deadlockResults = await Promise.allSettled(potentialDeadlockTransactions);\n      const successful = deadlockResults.filter(r => r.status === 'fulfilled').length;\n\n      // Both transactions should complete successfully (no deadlock)\n      expect(successful).toBeGreaterThanOrEqual(1); // At least one should succeed\n\n      // Verify final state consistency\n      const finalUsers = await prisma.user.findMany({\n        where: {\n          id: { in: [users[0].id, users[1].id] },\n        },\n      });\n\n      const messages = await prisma.message.findMany({\n        where: { conversationId: conversation.id },\n      });\n\n      expect(finalUsers).toHaveLength(2);\n      expect(messages.length).toBeGreaterThanOrEqual(1);\n    });\n  });\n});"],"version":3}