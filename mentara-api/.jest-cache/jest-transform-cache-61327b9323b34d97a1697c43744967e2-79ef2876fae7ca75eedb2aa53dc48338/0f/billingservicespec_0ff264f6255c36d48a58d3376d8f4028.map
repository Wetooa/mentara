{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.service.spec.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/billing/billing.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\nimport { NotFoundException, BadRequestException, ConflictException } from '@nestjs/common';\nimport { BillingService } from './billing.service';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport {\n  SubscriptionStatus,\n  SubscriptionTier,\n  BillingCycle,\n  PaymentStatus,\n  PaymentMethodType,\n  InvoiceStatus,\n  DiscountType,\n} from '@prisma/client';\nimport { createMockPrismaService, TEST_USER_IDS } from '../test-utils';\n\ndescribe('BillingService', () => {\n  let service: BillingService;\n  let prismaService: jest.Mocked<PrismaService>;\n\n  beforeEach(async () => {\n    const mockPrisma = createMockPrismaService();\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        BillingService,\n        {\n          provide: PrismaService,\n          useValue: mockPrisma,\n        },\n      ],\n    }).compile();\n\n    service = module.get<BillingService>(BillingService);\n    prismaService = module.get(PrismaService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Subscription Management', () => {\n    describe('createSubscription', () => {\n      const mockPlan = {\n        id: 'plan-id',\n        name: 'Premium Plan',\n        tier: SubscriptionTier.PREMIUM,\n        monthlyPrice: 29.99,\n        yearlyPrice: 299.99,\n      };\n\n      const mockSubscriptionData = {\n        userId: TEST_USER_IDS.CLIENT,\n        planId: 'plan-id',\n        billingCycle: BillingCycle.MONTHLY,\n      };\n\n      it('should successfully create a monthly subscription', async () => {\n        const expectedSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          planId: 'plan-id',\n          tier: SubscriptionTier.PREMIUM,\n          billingCycle: BillingCycle.MONTHLY,\n          amount: 29.99,\n          status: SubscriptionStatus.ACTIVE,\n          plan: mockPlan,\n          defaultPaymentMethod: null,\n        };\n\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue(\n          expectedSubscription,\n        );\n\n        const result = await service.createSubscription(mockSubscriptionData);\n\n        expect(result).toEqual(expectedSubscription);\n        expect(prismaService.subscription.create).toHaveBeenCalledWith({\n          data: expect.objectContaining({\n            userId: TEST_USER_IDS.CLIENT,\n            planId: 'plan-id',\n            tier: SubscriptionTier.PREMIUM,\n            billingCycle: BillingCycle.MONTHLY,\n            amount: 29.99,\n            status: SubscriptionStatus.ACTIVE,\n          }),\n          include: {\n            plan: true,\n            defaultPaymentMethod: true,\n          },\n        });\n      });\n\n      it('should successfully create a yearly subscription', async () => {\n        const yearlyData = {\n          ...mockSubscriptionData,\n          billingCycle: BillingCycle.YEARLY,\n        };\n\n        const expectedSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          amount: 299.99,\n          billingCycle: BillingCycle.YEARLY,\n        };\n\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue(\n          expectedSubscription,\n        );\n\n        const result = await service.createSubscription(yearlyData);\n\n        expect(result.amount).toBe(299.99);\n        expect(result.billingCycle).toBe(BillingCycle.YEARLY);\n      });\n\n      it('should create subscription with trial period', async () => {\n        const trialStart = new Date();\n        const trialEnd = new Date();\n        trialEnd.setDate(trialEnd.getDate() + 14);\n\n        const trialData = {\n          ...mockSubscriptionData,\n          trialStart,\n          trialEnd,\n        };\n\n        const expectedSubscription = {\n          id: 'subscription-id',\n          status: SubscriptionStatus.TRIALING,\n          trialStart,\n          trialEnd,\n        };\n\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue(\n          expectedSubscription,\n        );\n\n        const result = await service.createSubscription(trialData);\n\n        expect(result.status).toBe(SubscriptionStatus.TRIALING);\n        expect(prismaService.subscription.create).toHaveBeenCalledWith({\n          data: expect.objectContaining({\n            status: SubscriptionStatus.TRIALING,\n            trialStart,\n            trialEnd,\n          }),\n          include: expect.any(Object),\n        });\n      });\n\n      it('should throw NotFoundException when plan does not exist', async () => {\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(null);\n\n        await expect(\n          service.createSubscription(mockSubscriptionData),\n        ).rejects.toThrow(NotFoundException);\n\n        expect(prismaService.subscription.create).not.toHaveBeenCalled();\n      });\n    });\n\n    describe('findUserSubscription', () => {\n      it('should return user subscription with included data', async () => {\n        const mockSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          plan: { name: 'Premium Plan' },\n          defaultPaymentMethod: { cardLast4: '4242' },\n          invoices: [{ id: 'invoice-1' }],\n        };\n\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(\n          mockSubscription,\n        );\n\n        const result = await service.findUserSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result).toEqual(mockSubscription);\n        expect(prismaService.subscription.findUnique).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT },\n          include: {\n            plan: true,\n            defaultPaymentMethod: true,\n            invoices: {\n              orderBy: { createdAt: 'desc' },\n              take: 5,\n            },\n          },\n        });\n      });\n\n      it('should return null when subscription does not exist', async () => {\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(\n          null,\n        );\n\n        const result = await service.findUserSubscription('non-existent-user');\n\n        expect(result).toBeNull();\n      });\n    });\n\n    describe('updateSubscription', () => {\n      const mockSubscription = {\n        id: 'subscription-id',\n        userId: TEST_USER_IDS.CLIENT,\n        planId: 'old-plan-id',\n      };\n\n      const mockNewPlan = {\n        id: 'new-plan-id',\n        tier: SubscriptionTier.ENTERPRISE,\n        monthlyPrice: 99.99,\n        yearlyPrice: 999.99,\n      };\n\n      it('should successfully update subscription plan', async () => {\n        const updateData = {\n          planId: 'new-plan-id',\n          billingCycle: BillingCycle.MONTHLY,\n        };\n\n        const updatedSubscription = {\n          ...mockSubscription,\n          planId: 'new-plan-id',\n          tier: SubscriptionTier.ENTERPRISE,\n          amount: 99.99,\n        };\n\n        jest\n          .spyOn(service, 'findUserSubscription')\n          .mockResolvedValue(mockSubscription as any);\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(mockNewPlan);\n        (prismaService.subscription.update as jest.Mock).mockResolvedValue(\n          updatedSubscription,\n        );\n\n        const result = await service.updateSubscription(\n          TEST_USER_IDS.CLIENT,\n          updateData,\n        );\n\n        expect(result).toEqual(updatedSubscription);\n        expect(prismaService.subscription.update).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT },\n          data: expect.objectContaining({\n            planId: 'new-plan-id',\n            tier: SubscriptionTier.ENTERPRISE,\n            amount: 99.99,\n            billingCycle: BillingCycle.MONTHLY,\n          }),\n          include: expect.any(Object),\n        });\n      });\n\n      it('should throw NotFoundException when subscription does not exist', async () => {\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(null);\n\n        await expect(\n          service.updateSubscription('non-existent-user', {\n            planId: 'new-plan',\n          }),\n        ).rejects.toThrow(NotFoundException);\n      });\n\n      it('should throw NotFoundException when new plan does not exist', async () => {\n        jest\n          .spyOn(service, 'findUserSubscription')\n          .mockResolvedValue(mockSubscription as any);\n        (\n          prismaService.subscriptionPlan.findUnique as jest.Mock\n        ).mockResolvedValue(null);\n\n        await expect(\n          service.updateSubscription(TEST_USER_IDS.CLIENT, {\n            planId: 'non-existent-plan',\n          }),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n\n    describe('cancelSubscription', () => {\n      it('should cancel subscription by updating status', async () => {\n        const canceledSubscription = {\n          id: 'subscription-id',\n          status: SubscriptionStatus.CANCELED,\n        };\n\n        jest\n          .spyOn(service, 'updateSubscription')\n          .mockResolvedValue(canceledSubscription as any);\n\n        const result = await service.cancelSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result.status).toBe(SubscriptionStatus.CANCELED);\n        expect(service.updateSubscription).toHaveBeenCalledWith(\n          TEST_USER_IDS.CLIENT,\n          {\n            status: SubscriptionStatus.CANCELED,\n          },\n        );\n      });\n    });\n  });\n\n  describe('Subscription Plans', () => {\n    describe('createSubscriptionPlan', () => {\n      it('should successfully create a subscription plan', async () => {\n        const planData = {\n          name: 'Premium Plan',\n          description: 'Full access plan',\n          tier: SubscriptionTier.PREMIUM,\n          monthlyPrice: 29.99,\n          yearlyPrice: 299.99,\n          features: { sessions: 'unlimited', storage: '100GB' },\n          limits: { clients: 50 },\n          trialDays: 14,\n        };\n\n        const expectedPlan = {\n          id: 'plan-id',\n          ...planData,\n        };\n\n        (prismaService.subscriptionPlan.create as jest.Mock).mockResolvedValue(\n          expectedPlan,\n        );\n\n        const result = await service.createSubscriptionPlan(planData);\n\n        expect(result).toEqual(expectedPlan);\n        expect(prismaService.subscriptionPlan.create).toHaveBeenCalledWith({\n          data: planData,\n        });\n      });\n    });\n\n    describe('findAllPlans', () => {\n      it('should return active plans by default', async () => {\n        const mockPlans = [\n          { id: 'plan-1', name: 'Basic', monthlyPrice: 9.99 },\n          { id: 'plan-2', name: 'Premium', monthlyPrice: 29.99 },\n        ];\n\n        (\n          prismaService.subscriptionPlan.findMany as jest.Mock\n        ).mockResolvedValue(mockPlans);\n\n        const result = await service.findAllPlans();\n\n        expect(result).toEqual(mockPlans);\n        expect(prismaService.subscriptionPlan.findMany).toHaveBeenCalledWith({\n          where: { isActive: true },\n          orderBy: { monthlyPrice: 'asc' },\n        });\n      });\n\n      it('should return inactive plans when specified', async () => {\n        await service.findAllPlans(false);\n\n        expect(prismaService.subscriptionPlan.findMany).toHaveBeenCalledWith({\n          where: { isActive: false },\n          orderBy: { monthlyPrice: 'asc' },\n        });\n      });\n    });\n\n    describe('updatePlan', () => {\n      it('should successfully update plan', async () => {\n        const updateData = {\n          name: 'Updated Plan',\n          monthlyPrice: 39.99,\n          features: { newFeature: true },\n        };\n\n        const updatedPlan = {\n          id: 'plan-id',\n          ...updateData,\n        };\n\n        (prismaService.subscriptionPlan.update as jest.Mock).mockResolvedValue(\n          updatedPlan,\n        );\n\n        const result = await service.updatePlan('plan-id', updateData);\n\n        expect(result).toEqual(updatedPlan);\n        expect(prismaService.subscriptionPlan.update).toHaveBeenCalledWith({\n          where: { id: 'plan-id' },\n          data: updateData,\n        });\n      });\n    });\n  });\n\n  describe('Payment Methods', () => {\n    describe('createPaymentMethod', () => {\n      it('should create payment method and set as default', async () => {\n        const paymentMethodData = {\n          userId: TEST_USER_IDS.CLIENT,\n          type: PaymentMethodType.CARD,\n          cardLast4: '4242',\n          cardBrand: 'visa',\n          cardExpMonth: 12,\n          cardExpYear: 2025,\n          isDefault: true,\n        };\n\n        const expectedPaymentMethod = {\n          id: 'payment-method-id',\n          ...paymentMethodData,\n        };\n\n        (prismaService.paymentMethod.updateMany as jest.Mock).mockResolvedValue(\n          { count: 1 },\n        );\n        (prismaService.paymentMethod.create as jest.Mock).mockResolvedValue(\n          expectedPaymentMethod,\n        );\n\n        const result = await service.createPaymentMethod(paymentMethodData);\n\n        expect(result).toEqual(expectedPaymentMethod);\n        expect(prismaService.paymentMethod.updateMany).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT, isDefault: true },\n          data: { isDefault: false },\n        });\n        expect(prismaService.paymentMethod.create).toHaveBeenCalledWith({\n          data: paymentMethodData,\n        });\n      });\n\n      it('should create payment method without setting as default', async () => {\n        const paymentMethodData = {\n          userId: TEST_USER_IDS.CLIENT,\n          type: PaymentMethodType.CARD,\n          cardLast4: '4242',\n        };\n\n        (prismaService.paymentMethod.create as jest.Mock).mockResolvedValue(\n          paymentMethodData,\n        );\n\n        await service.createPaymentMethod(paymentMethodData);\n\n        expect(prismaService.paymentMethod.updateMany).not.toHaveBeenCalled();\n      });\n    });\n\n    describe('findUserPaymentMethods', () => {\n      it('should return user payment methods ordered by default and creation date', async () => {\n        const mockPaymentMethods = [\n          { id: 'pm-1', isDefault: true, cardLast4: '4242' },\n          { id: 'pm-2', isDefault: false, cardLast4: '1234' },\n        ];\n\n        (prismaService.paymentMethod.findMany as jest.Mock).mockResolvedValue(\n          mockPaymentMethods,\n        );\n\n        const result = await service.findUserPaymentMethods(\n          TEST_USER_IDS.CLIENT,\n        );\n\n        expect(result).toEqual(mockPaymentMethods);\n        expect(prismaService.paymentMethod.findMany).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT, isActive: true },\n          orderBy: [{ isDefault: 'desc' }, { createdAt: 'desc' }],\n        });\n      });\n    });\n\n    describe('updatePaymentMethod', () => {\n      const mockPaymentMethod = {\n        id: 'payment-method-id',\n        userId: TEST_USER_IDS.CLIENT,\n      };\n\n      it('should successfully update payment method', async () => {\n        const updateData = { isDefault: true };\n        const updatedPaymentMethod = { ...mockPaymentMethod, ...updateData };\n\n        (prismaService.paymentMethod.findUnique as jest.Mock).mockResolvedValue(\n          mockPaymentMethod,\n        );\n        (prismaService.paymentMethod.updateMany as jest.Mock).mockResolvedValue(\n          { count: 1 },\n        );\n        (prismaService.paymentMethod.update as jest.Mock).mockResolvedValue(\n          updatedPaymentMethod,\n        );\n\n        const result = await service.updatePaymentMethod(\n          'payment-method-id',\n          updateData,\n        );\n\n        expect(result).toEqual(updatedPaymentMethod);\n        expect(prismaService.paymentMethod.updateMany).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT, isDefault: true },\n          data: { isDefault: false },\n        });\n      });\n\n      it('should throw NotFoundException when payment method does not exist', async () => {\n        (prismaService.paymentMethod.findUnique as jest.Mock).mockResolvedValue(\n          null,\n        );\n\n        await expect(\n          service.updatePaymentMethod('non-existent-id', { isDefault: true }),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n\n    describe('deletePaymentMethod', () => {\n      it('should soft delete payment method by setting isActive to false', async () => {\n        const deactivatedPaymentMethod = {\n          id: 'payment-method-id',\n          isActive: false,\n        };\n\n        (prismaService.paymentMethod.update as jest.Mock).mockResolvedValue(\n          deactivatedPaymentMethod,\n        );\n\n        const result = await service.deletePaymentMethod('payment-method-id');\n\n        expect(result).toEqual(deactivatedPaymentMethod);\n        expect(prismaService.paymentMethod.update).toHaveBeenCalledWith({\n          where: { id: 'payment-method-id' },\n          data: { isActive: false },\n        });\n      });\n    });\n  });\n\n  describe('Payments', () => {\n    describe('createPayment', () => {\n      it('should create payment with default values', async () => {\n        const paymentData = {\n          amount: 29.99,\n          paymentMethodId: 'payment-method-id',\n          subscriptionId: 'subscription-id',\n          description: 'Monthly subscription',\n        };\n\n        const expectedPayment = {\n          id: 'payment-id',\n          ...paymentData,\n          status: PaymentStatus.PENDING,\n          currency: 'USD',\n          paymentMethod: { cardLast4: '4242' },\n          subscription: { tier: SubscriptionTier.PREMIUM },\n          invoice: null,\n        };\n\n        (prismaService.payment.create as jest.Mock).mockResolvedValue(\n          expectedPayment,\n        );\n\n        const result = await service.createPayment(paymentData);\n\n        expect(result).toEqual(expectedPayment);\n        expect(prismaService.payment.create).toHaveBeenCalledWith({\n          data: {\n            ...paymentData,\n            status: PaymentStatus.PENDING,\n            currency: 'USD',\n          },\n          include: {\n            paymentMethod: true,\n            subscription: true,\n            invoice: true,\n          },\n        });\n      });\n\n      it('should create payment with custom currency', async () => {\n        const paymentData = {\n          amount: 25.99,\n          currency: 'EUR',\n        };\n\n        (prismaService.payment.create as jest.Mock).mockResolvedValue({\n          id: 'payment-id',\n          currency: 'EUR',\n        });\n\n        await service.createPayment(paymentData);\n\n        expect(prismaService.payment.create).toHaveBeenCalledWith({\n          data: expect.objectContaining({\n            currency: 'EUR',\n          }),\n          include: expect.any(Object),\n        });\n      });\n    });\n\n    describe('updatePaymentStatus', () => {\n      it('should update payment status to succeeded', async () => {\n        const updatedPayment = {\n          id: 'payment-id',\n          status: PaymentStatus.SUCCEEDED,\n          processedAt: expect.any(Date),\n        };\n\n        (prismaService.payment.update as jest.Mock).mockResolvedValue(\n          updatedPayment,\n        );\n\n        const result = await service.updatePaymentStatus(\n          'payment-id',\n          PaymentStatus.SUCCEEDED,\n        );\n\n        expect(result).toEqual(updatedPayment);\n        expect(prismaService.payment.update).toHaveBeenCalledWith({\n          where: { id: 'payment-id' },\n          data: {\n            status: PaymentStatus.SUCCEEDED,\n            processedAt: expect.any(Date),\n          },\n        });\n      });\n\n      it('should update payment status to failed with metadata', async () => {\n        const metadata = {\n          failureCode: 'card_declined',\n          failureMessage: 'Your card was declined.',\n        };\n\n        const updatedPayment = {\n          id: 'payment-id',\n          status: PaymentStatus.FAILED,\n          failedAt: expect.any(Date),\n          failureCode: 'card_declined',\n          failureMessage: 'Your card was declined.',\n        };\n\n        (prismaService.payment.update as jest.Mock).mockResolvedValue(\n          updatedPayment,\n        );\n\n        const result = await service.updatePaymentStatus(\n          'payment-id',\n          PaymentStatus.FAILED,\n          metadata,\n        );\n\n        expect(result).toEqual(updatedPayment);\n        expect(prismaService.payment.update).toHaveBeenCalledWith({\n          where: { id: 'payment-id' },\n          data: {\n            status: PaymentStatus.FAILED,\n            failedAt: expect.any(Date),\n            failureCode: 'card_declined',\n            failureMessage: 'Your card was declined.',\n          },\n        });\n      });\n    });\n\n    describe('findPayments', () => {\n      it('should return payments with filters', async () => {\n        const mockPayments = [\n          { id: 'payment-1', status: PaymentStatus.SUCCEEDED },\n          { id: 'payment-2', status: PaymentStatus.SUCCEEDED },\n        ];\n\n        const startDate = new Date('2024-01-01');\n        const endDate = new Date('2024-01-31');\n\n        (prismaService.payment.findMany as jest.Mock).mockResolvedValue(\n          mockPayments,\n        );\n\n        const result = await service.findPayments(\n          'subscription-id',\n          PaymentStatus.SUCCEEDED,\n          startDate,\n          endDate,\n        );\n\n        expect(result).toEqual(mockPayments);\n        expect(prismaService.payment.findMany).toHaveBeenCalledWith({\n          where: {\n            subscriptionId: 'subscription-id',\n            status: PaymentStatus.SUCCEEDED,\n            createdAt: {\n              gte: startDate,\n              lte: endDate,\n            },\n          },\n          include: {\n            paymentMethod: true,\n            subscription: true,\n            invoice: true,\n          },\n          orderBy: { createdAt: 'desc' },\n        });\n      });\n    });\n  });\n\n  describe('Invoices', () => {\n    describe('createInvoice', () => {\n      it('should create invoice with calculated total', async () => {\n        const invoiceData = {\n          subscriptionId: 'subscription-id',\n          subtotal: 100,\n          taxAmount: 10,\n          discountAmount: 5,\n          dueDate: new Date('2024-02-01'),\n        };\n\n        const expectedInvoice = {\n          id: 'invoice-id',\n          ...invoiceData,\n          number: 'INV-2024-000001',\n          total: 105, // 100 + 10 - 5\n          amountDue: 105,\n          status: InvoiceStatus.OPEN,\n        };\n\n        // Mock generateInvoiceNumber\n        jest\n          .spyOn(service as any, 'generateInvoiceNumber')\n          .mockResolvedValue('INV-2024-000001');\n        (prismaService.invoice.create as jest.Mock).mockResolvedValue(\n          expectedInvoice,\n        );\n\n        const result = await service.createInvoice(invoiceData);\n\n        expect(result).toEqual(expectedInvoice);\n        expect(prismaService.invoice.create).toHaveBeenCalledWith({\n          data: {\n            ...invoiceData,\n            number: 'INV-2024-000001',\n            total: 105,\n            amountDue: 105,\n            status: InvoiceStatus.OPEN,\n          },\n          include: {\n            subscription: true,\n            lineItems: true,\n          },\n        });\n      });\n    });\n\n    describe('findInvoices', () => {\n      it('should return invoices with filters', async () => {\n        const mockInvoices = [\n          { id: 'invoice-1', status: InvoiceStatus.OPEN },\n          { id: 'invoice-2', status: InvoiceStatus.PAID },\n        ];\n\n        (prismaService.invoice.findMany as jest.Mock).mockResolvedValue(\n          mockInvoices,\n        );\n\n        const result = await service.findInvoices(\n          'subscription-id',\n          InvoiceStatus.OPEN,\n        );\n\n        expect(result).toEqual(mockInvoices);\n        expect(prismaService.invoice.findMany).toHaveBeenCalledWith({\n          where: {\n            subscriptionId: 'subscription-id',\n            status: InvoiceStatus.OPEN,\n          },\n          include: {\n            subscription: {\n              include: { user: true },\n            },\n            lineItems: true,\n            payments: true,\n          },\n          orderBy: { createdAt: 'desc' },\n        });\n      });\n    });\n\n    describe('markInvoiceAsPaid', () => {\n      it('should mark invoice as paid when fully paid', async () => {\n        const mockInvoice = {\n          id: 'invoice-id',\n          total: 100,\n          payments: [\n            { amount: 60, status: PaymentStatus.SUCCEEDED },\n            { amount: 40, status: PaymentStatus.SUCCEEDED },\n          ],\n        };\n\n        const updatedInvoice = {\n          ...mockInvoice,\n          status: InvoiceStatus.PAID,\n          amountPaid: 100,\n          paidAt: expect.any(Date),\n        };\n\n        (prismaService.invoice.findUnique as jest.Mock).mockResolvedValue(\n          mockInvoice,\n        );\n        (prismaService.invoice.update as jest.Mock).mockResolvedValue(\n          updatedInvoice,\n        );\n\n        const result = await service.markInvoiceAsPaid('invoice-id');\n\n        expect(result).toEqual(updatedInvoice);\n        expect(prismaService.invoice.update).toHaveBeenCalledWith({\n          where: { id: 'invoice-id' },\n          data: {\n            status: InvoiceStatus.PAID,\n            amountPaid: 100,\n            paidAt: expect.any(Date),\n          },\n        });\n      });\n\n      it('should keep invoice open when partially paid', async () => {\n        const mockInvoice = {\n          id: 'invoice-id',\n          total: 100,\n          payments: [\n            { amount: 30, status: PaymentStatus.SUCCEEDED },\n            { amount: 20, status: PaymentStatus.FAILED },\n          ],\n        };\n\n        (prismaService.invoice.findUnique as jest.Mock).mockResolvedValue(\n          mockInvoice,\n        );\n        (prismaService.invoice.update as jest.Mock).mockResolvedValue({\n          ...mockInvoice,\n          status: InvoiceStatus.OPEN,\n          amountPaid: 30,\n        });\n\n        const result = await service.markInvoiceAsPaid('invoice-id');\n\n        expect(result.status).toBe(InvoiceStatus.OPEN);\n        expect(result.amountPaid).toBe(30);\n      });\n\n      it('should throw NotFoundException when invoice does not exist', async () => {\n        (prismaService.invoice.findUnique as jest.Mock).mockResolvedValue(null);\n\n        await expect(\n          service.markInvoiceAsPaid('non-existent-id'),\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n  });\n\n  describe('Discounts', () => {\n    describe('createDiscount', () => {\n      it('should create discount with default valid from date', async () => {\n        const discountData = {\n          code: 'SAVE20',\n          name: '20% Off',\n          type: DiscountType.PERCENTAGE,\n          percentOff: 20,\n        };\n\n        const expectedDiscount = {\n          id: 'discount-id',\n          ...discountData,\n          validFrom: expect.any(Date),\n        };\n\n        (prismaService.discount.create as jest.Mock).mockResolvedValue(\n          expectedDiscount,\n        );\n\n        const result = await service.createDiscount(discountData);\n\n        expect(result).toEqual(expectedDiscount);\n        expect(prismaService.discount.create).toHaveBeenCalledWith({\n          data: {\n            ...discountData,\n            validFrom: expect.any(Date),\n          },\n        });\n      });\n    });\n\n    describe('validateDiscount', () => {\n      const mockDiscount = {\n        id: 'discount-id',\n        code: 'SAVE20',\n        isActive: true,\n        validUntil: new Date('2024-12-31'),\n        maxUses: 100,\n        currentUses: 50,\n        maxUsesPerUser: 1,\n        minAmount: 50,\n        redemptions: [],\n      };\n\n      it('should return valid discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue(\n          mockDiscount,\n        );\n\n        const result = await service.validateDiscount(\n          'SAVE20',\n          TEST_USER_IDS.CLIENT,\n          100,\n        );\n\n        expect(result).toEqual(mockDiscount);\n      });\n\n      it('should throw BadRequestException for invalid discount code', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue(\n          null,\n        );\n\n        await expect(\n          service.validateDiscount('INVALID', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException for inactive discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          isActive: false,\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException for expired discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          validUntil: new Date('2020-01-01'), // Expired\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException when max uses reached', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          maxUses: 50,\n          currentUses: 50, // Reached limit\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException when user has already used discount', async () => {\n        (prismaService.discount.findUnique as jest.Mock).mockResolvedValue({\n          ...mockDiscount,\n          redemptions: [{ userId: TEST_USER_IDS.CLIENT }], // User already used\n        });\n\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 100),\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw BadRequestException when amount is below minimum', async () => {\n        await expect(\n          service.validateDiscount('SAVE20', TEST_USER_IDS.CLIENT, 25), // Below min of 50\n        ).rejects.toThrow(BadRequestException);\n      });\n    });\n\n    describe('redeemDiscount', () => {\n      it('should redeem discount in transaction', async () => {\n        const mockTransaction = {\n          ...createMockPrismaService(),\n          discountRedemption: {\n            create: jest.fn(),\n          },\n          discount: {\n            update: jest.fn(),\n          },\n        };\n\n        (prismaService.$transaction as jest.Mock).mockImplementation(\n          async (callback) => {\n            return callback(mockTransaction);\n          },\n        );\n\n        await service.redeemDiscount('discount-id', TEST_USER_IDS.CLIENT, 20);\n\n        expect(mockTransaction.discountRedemption.create).toHaveBeenCalledWith({\n          data: {\n            discountId: 'discount-id',\n            userId: TEST_USER_IDS.CLIENT,\n            amountSaved: 20,\n          },\n        });\n\n        expect(mockTransaction.discount.update).toHaveBeenCalledWith({\n          where: { id: 'discount-id' },\n          data: {\n            currentUses: { increment: 1 },\n          },\n        });\n      });\n    });\n  });\n\n  describe('Usage Records', () => {\n    describe('recordUsage', () => {\n      it('should create usage record with default date', async () => {\n        const usageData = {\n          subscriptionId: 'subscription-id',\n          feature: 'api_calls',\n          quantity: 100,\n          unit: 'requests',\n          metadata: { endpoint: '/api/users' },\n        };\n\n        const expectedUsage = {\n          id: 'usage-id',\n          ...usageData,\n          usageDate: expect.any(Date),\n        };\n\n        (prismaService.usageRecord.create as jest.Mock).mockResolvedValue(\n          expectedUsage,\n        );\n\n        const result = await service.recordUsage(usageData);\n\n        expect(result).toEqual(expectedUsage);\n        expect(prismaService.usageRecord.create).toHaveBeenCalledWith({\n          data: {\n            ...usageData,\n            usageDate: expect.any(Date),\n          },\n        });\n      });\n    });\n\n    describe('getUsageRecords', () => {\n      it('should return usage records with filters', async () => {\n        const mockUsageRecords = [\n          { id: 'usage-1', feature: 'api_calls', quantity: 100 },\n          { id: 'usage-2', feature: 'api_calls', quantity: 50 },\n        ];\n\n        const startDate = new Date('2024-01-01');\n        const endDate = new Date('2024-01-31');\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(\n          mockUsageRecords,\n        );\n\n        const result = await service.getUsageRecords(\n          'subscription-id',\n          'api_calls',\n          startDate,\n          endDate,\n        );\n\n        expect(result).toEqual(mockUsageRecords);\n        expect(prismaService.usageRecord.findMany).toHaveBeenCalledWith({\n          where: {\n            subscriptionId: 'subscription-id',\n            feature: 'api_calls',\n            usageDate: {\n              gte: startDate,\n              lte: endDate,\n            },\n          },\n          orderBy: { usageDate: 'desc' },\n        });\n      });\n    });\n  });\n\n  describe('Helper Methods', () => {\n    describe('generateInvoiceNumber', () => {\n      it('should generate first invoice number for year', async () => {\n        (prismaService.invoice.findFirst as jest.Mock).mockResolvedValue(null);\n\n        const result = await (service as any).generateInvoiceNumber();\n\n        const currentYear = new Date().getFullYear();\n        expect(result).toBe(`INV-${currentYear}-000001`);\n      });\n\n      it('should increment from last invoice number', async () => {\n        const currentYear = new Date().getFullYear();\n        const lastInvoice = {\n          number: `INV-${currentYear}-000005`,\n        };\n\n        (prismaService.invoice.findFirst as jest.Mock).mockResolvedValue(\n          lastInvoice,\n        );\n\n        const result = await (service as any).generateInvoiceNumber();\n\n        expect(result).toBe(`INV-${currentYear}-000006`);\n      });\n\n      it('should handle invalid invoice number format', async () => {\n        const lastInvoice = {\n          number: 'INVALID-FORMAT',\n        };\n\n        (prismaService.invoice.findFirst as jest.Mock).mockResolvedValue(\n          lastInvoice,\n        );\n\n        const result = await (service as any).generateInvoiceNumber();\n\n        const currentYear = new Date().getFullYear();\n        expect(result).toBe(`INV-${currentYear}-000001`);\n      });\n    });\n\n    describe('getBillingStatistics', () => {\n      it('should return billing statistics', async () => {\n        const mockStats = {\n          totalRevenue: { _sum: { amount: 10000 } },\n          activeSubscriptions: 25,\n          trialSubscriptions: 5,\n          canceledSubscriptions: 10,\n          subscriptionsByTier: [\n            { tier: SubscriptionTier.BASIC, _count: { tier: 10 } },\n            { tier: SubscriptionTier.PREMIUM, _count: { tier: 15 } },\n          ],\n        };\n\n        (prismaService.payment.aggregate as jest.Mock).mockResolvedValue(\n          mockStats.totalRevenue,\n        );\n        (prismaService.subscription.count as jest.Mock)\n          .mockResolvedValueOnce(mockStats.activeSubscriptions)\n          .mockResolvedValueOnce(mockStats.trialSubscriptions)\n          .mockResolvedValueOnce(mockStats.canceledSubscriptions);\n        (prismaService.subscription.groupBy as jest.Mock).mockResolvedValue(\n          mockStats.subscriptionsByTier,\n        );\n\n        const result = await service.getBillingStatistics();\n\n        expect(result).toEqual({\n          totalRevenue: 10000,\n          activeSubscriptions: 25,\n          trialSubscriptions: 5,\n          canceledSubscriptions: 10,\n          subscriptionsByTier: mockStats.subscriptionsByTier,\n        });\n      });\n\n      it('should handle null revenue sum', async () => {\n        (prismaService.payment.aggregate as jest.Mock).mockResolvedValue({\n          _sum: { amount: null },\n        });\n        (prismaService.subscription.count as jest.Mock).mockResolvedValue(0);\n        (prismaService.subscription.groupBy as jest.Mock).mockResolvedValue([]);\n\n        const result = await service.getBillingStatistics();\n\n        expect(result.totalRevenue).toBe(0);\n      });\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle database errors in createSubscription', async () => {\n      (\n        prismaService.subscriptionPlan.findUnique as jest.Mock\n      ).mockResolvedValue({\n        id: 'plan-id',\n        monthlyPrice: 29.99,\n      });\n      (prismaService.subscription.create as jest.Mock).mockRejectedValue(\n        new Error('Database error'),\n      );\n\n      await expect(\n        service.createSubscription({\n          userId: TEST_USER_IDS.CLIENT,\n          planId: 'plan-id',\n        }),\n      ).rejects.toThrow('Database error');\n    });\n\n    it('should handle database errors in payment operations', async () => {\n      (prismaService.payment.create as jest.Mock).mockRejectedValue(\n        new Error('Payment creation failed'),\n      );\n\n      await expect(\n        service.createPayment({\n          amount: 29.99,\n        }),\n      ).rejects.toThrow('Payment creation failed');\n    });\n\n    it('should handle transaction errors in discount redemption', async () => {\n      prismaService.$transaction.mockRejectedValue(\n        new Error('Transaction failed'),\n      );\n\n      await expect(\n        service.redeemDiscount('discount-id', TEST_USER_IDS.CLIENT, 20),\n      ).rejects.toThrow('Transaction failed');\n\n      // Verify no partial state changes\n      expect(prismaService.discountRedemption.create).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Advanced Subscription Management', () => {\n    const mockSubscription = {\n      id: 'subscription-id',\n      userId: TEST_USER_IDS.CLIENT,\n      planId: 'old-plan-id',\n      tier: SubscriptionTier.BASIC,\n      billingCycle: BillingCycle.MONTHLY,\n      amount: 9.99,\n      status: SubscriptionStatus.ACTIVE,\n      currentPeriodStart: new Date('2024-01-01'),\n      currentPeriodEnd: new Date('2024-02-01'),\n      plan: {\n        id: 'old-plan-id',\n        monthlyPrice: 9.99,\n        yearlyPrice: 99.99,\n      },\n    };\n\n    const mockNewPlan = {\n      id: 'new-plan-id',\n      tier: SubscriptionTier.PREMIUM,\n      monthlyPrice: 29.99,\n      yearlyPrice: 299.99,\n    };\n\n    describe('changeSubscriptionPlan', () => {\n      beforeEach(() => {\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(mockSubscription as any);\n        (prismaService.subscriptionPlan.findUnique as jest.Mock).mockResolvedValue(mockNewPlan);\n      });\n\n      it('should change plan with immediate proration', async () => {\n        const options = {\n          billingCycle: BillingCycle.MONTHLY,\n          prorationBehavior: 'create_prorations',\n          effectiveDate: new Date('2024-01-15'),\n        };\n\n        const expectedUpdate = {\n          ...mockSubscription,\n          planId: 'new-plan-id',\n          tier: SubscriptionTier.PREMIUM,\n          amount: 29.99,\n        };\n\n        const mockProrationCredit = {\n          id: 'credit-id',\n          amount: -5.00,\n          description: 'Proration credit for plan change',\n        };\n\n        const mockProrationCharge = {\n          id: 'charge-id',\n          amount: 15.00,\n          description: 'Proration charge for plan change',\n        };\n\n        (prismaService.$transaction as jest.Mock).mockImplementation(async (callback) => {\n          const mockTxn = {\n            subscription: {\n              update: jest.fn().mockResolvedValue(expectedUpdate),\n            },\n            invoice: {\n              create: jest.fn().mockResolvedValue({\n                id: 'proration-invoice',\n                lineItems: [mockProrationCredit, mockProrationCharge],\n              }),\n            },\n            invoiceLineItem: {\n              createMany: jest.fn(),\n            },\n          };\n          return callback(mockTxn);\n        });\n\n        const result = await service.changeSubscriptionPlan(\n          TEST_USER_IDS.CLIENT,\n          'new-plan-id',\n          options\n        );\n\n        expect(result).toEqual(expectedUpdate);\n        expect(prismaService.$transaction).toHaveBeenCalled();\n      });\n\n      it('should change plan with no proration', async () => {\n        const options = {\n          billingCycle: BillingCycle.MONTHLY,\n          prorationBehavior: 'none',\n        };\n\n        const expectedUpdate = {\n          ...mockSubscription,\n          planId: 'new-plan-id',\n          tier: SubscriptionTier.PREMIUM,\n          amount: 29.99,\n        };\n\n        (prismaService.subscription.update as jest.Mock).mockResolvedValue(expectedUpdate);\n\n        const result = await service.changeSubscriptionPlan(\n          TEST_USER_IDS.CLIENT,\n          'new-plan-id',\n          options\n        );\n\n        expect(result).toEqual(expectedUpdate);\n        expect(prismaService.subscription.update).toHaveBeenCalledWith({\n          where: { userId: TEST_USER_IDS.CLIENT },\n          data: {\n            planId: 'new-plan-id',\n            tier: SubscriptionTier.PREMIUM,\n            amount: 29.99,\n            billingCycle: BillingCycle.MONTHLY,\n          },\n          include: expect.any(Object),\n        });\n      });\n\n      it('should change plan with effective date in future', async () => {\n        const futureDate = new Date('2024-02-01');\n        const options = {\n          billingCycle: BillingCycle.YEARLY,\n          effectiveDate: futureDate,\n          prorationBehavior: 'none',\n        };\n\n        const expectedUpdate = {\n          ...mockSubscription,\n          planId: 'new-plan-id',\n          tier: SubscriptionTier.PREMIUM,\n          amount: 299.99,\n          scheduledPlanChange: {\n            newPlanId: 'new-plan-id',\n            effectiveDate: futureDate,\n          },\n        };\n\n        (prismaService.subscription.update as jest.Mock).mockResolvedValue(expectedUpdate);\n\n        const result = await service.changeSubscriptionPlan(\n          TEST_USER_IDS.CLIENT,\n          'new-plan-id',\n          options\n        );\n\n        expect(result.scheduledPlanChange).toBeDefined();\n        expect(result.scheduledPlanChange.effectiveDate).toEqual(futureDate);\n      });\n\n      it('should throw error when changing to same plan', async () => {\n        await expect(\n          service.changeSubscriptionPlan(\n            TEST_USER_IDS.CLIENT,\n            'old-plan-id',\n            { billingCycle: BillingCycle.MONTHLY }\n          )\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw error when subscription is canceled', async () => {\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue({\n          ...mockSubscription,\n          status: SubscriptionStatus.CANCELED,\n        } as any);\n\n        await expect(\n          service.changeSubscriptionPlan(\n            TEST_USER_IDS.CLIENT,\n            'new-plan-id',\n            { billingCycle: BillingCycle.MONTHLY }\n          )\n        ).rejects.toThrow(BadRequestException);\n      });\n    });\n\n    describe('pauseSubscription', () => {\n      it('should pause subscription with specified date', async () => {\n        const pauseUntil = new Date('2024-03-01');\n        const options = {\n          pauseUntil,\n          reason: 'Financial hardship',\n        };\n\n        const pausedSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.PAUSED,\n          pausedAt: new Date(),\n          pauseUntil,\n          pauseReason: 'Financial hardship',\n        };\n\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(pausedSubscription as any);\n\n        const result = await service.pauseSubscription(TEST_USER_IDS.CLIENT, options);\n\n        expect(result.status).toBe(SubscriptionStatus.PAUSED);\n        expect(result.pauseUntil).toEqual(pauseUntil);\n        expect(service.updateSubscription).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT, {\n          status: SubscriptionStatus.PAUSED,\n          pausedAt: expect.any(Date),\n          pauseUntil,\n          pauseReason: 'Financial hardship',\n        });\n      });\n\n      it('should pause subscription indefinitely', async () => {\n        const options = {\n          reason: 'Temporary break',\n        };\n\n        const pausedSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.PAUSED,\n          pausedAt: new Date(),\n          pauseReason: 'Temporary break',\n        };\n\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(pausedSubscription as any);\n\n        const result = await service.pauseSubscription(TEST_USER_IDS.CLIENT, options);\n\n        expect(result.status).toBe(SubscriptionStatus.PAUSED);\n        expect(result.pauseUntil).toBeUndefined();\n      });\n    });\n\n    describe('resumeSubscription', () => {\n      it('should resume paused subscription', async () => {\n        const pausedSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.PAUSED,\n          pausedAt: new Date('2024-01-15'),\n          pauseUntil: new Date('2024-03-01'),\n        };\n\n        const resumedSubscription = {\n          ...pausedSubscription,\n          status: SubscriptionStatus.ACTIVE,\n          pausedAt: null,\n          pauseUntil: null,\n          pauseReason: null,\n          resumedAt: new Date(),\n        };\n\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(pausedSubscription as any);\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(resumedSubscription as any);\n\n        const result = await service.resumeSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result.status).toBe(SubscriptionStatus.ACTIVE);\n        expect(result.resumedAt).toBeDefined();\n        expect(service.updateSubscription).toHaveBeenCalledWith(TEST_USER_IDS.CLIENT, {\n          status: SubscriptionStatus.ACTIVE,\n          pausedAt: null,\n          pauseUntil: null,\n          pauseReason: null,\n          resumedAt: expect.any(Date),\n        });\n      });\n\n      it('should throw error when subscription is not paused', async () => {\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(mockSubscription as any);\n\n        await expect(\n          service.resumeSubscription(TEST_USER_IDS.CLIENT)\n        ).rejects.toThrow(BadRequestException);\n      });\n    });\n\n    describe('scheduleSubscriptionCancellation', () => {\n      it('should schedule cancellation at period end', async () => {\n        const scheduleData = {\n          cancelAtPeriodEnd: true,\n          reason: 'No longer needed',\n        };\n\n        const scheduledSubscription = {\n          ...mockSubscription,\n          cancelAtPeriodEnd: true,\n          canceledAt: new Date(),\n          cancellationReason: 'No longer needed',\n          cancellationEffectiveDate: mockSubscription.currentPeriodEnd,\n        };\n\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(scheduledSubscription as any);\n\n        const result = await service.scheduleSubscriptionCancellation(\n          TEST_USER_IDS.CLIENT,\n          scheduleData\n        );\n\n        expect(result.cancelAtPeriodEnd).toBe(true);\n        expect(result.cancellationEffectiveDate).toEqual(mockSubscription.currentPeriodEnd);\n      });\n\n      it('should schedule immediate cancellation', async () => {\n        const scheduleData = {\n          cancelAtPeriodEnd: false,\n          reason: 'Dissatisfied with service',\n        };\n\n        const canceledSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.CANCELED,\n          canceledAt: new Date(),\n          cancellationReason: 'Dissatisfied with service',\n          cancellationEffectiveDate: new Date(),\n        };\n\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(canceledSubscription as any);\n\n        const result = await service.scheduleSubscriptionCancellation(\n          TEST_USER_IDS.CLIENT,\n          scheduleData\n        );\n\n        expect(result.status).toBe(SubscriptionStatus.CANCELED);\n        expect(result.cancellationReason).toBe('Dissatisfied with service');\n      });\n    });\n\n    describe('reactivateSubscription', () => {\n      it('should reactivate canceled subscription with new payment method', async () => {\n        const canceledSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.CANCELED,\n          canceledAt: new Date('2024-01-15'),\n        };\n\n        const newPaymentMethod = {\n          id: 'new-payment-method-id',\n          type: PaymentMethodType.CARD,\n          isDefault: true,\n        };\n\n        const reactivatedSubscription = {\n          ...canceledSubscription,\n          status: SubscriptionStatus.ACTIVE,\n          canceledAt: null,\n          cancellationReason: null,\n          reactivatedAt: new Date(),\n          defaultPaymentMethodId: 'new-payment-method-id',\n        };\n\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(canceledSubscription as any);\n        (prismaService.paymentMethod.findUnique as jest.Mock).mockResolvedValue(newPaymentMethod);\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(reactivatedSubscription as any);\n\n        const result = await service.reactivateSubscription(\n          TEST_USER_IDS.CLIENT,\n          'new-payment-method-id'\n        );\n\n        expect(result.status).toBe(SubscriptionStatus.ACTIVE);\n        expect(result.reactivatedAt).toBeDefined();\n        expect(result.defaultPaymentMethodId).toBe('new-payment-method-id');\n      });\n\n      it('should reactivate subscription without changing payment method', async () => {\n        const canceledSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.CANCELED,\n          defaultPaymentMethodId: 'existing-payment-method',\n        };\n\n        const reactivatedSubscription = {\n          ...canceledSubscription,\n          status: SubscriptionStatus.ACTIVE,\n          canceledAt: null,\n          reactivatedAt: new Date(),\n        };\n\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(canceledSubscription as any);\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue(reactivatedSubscription as any);\n\n        const result = await service.reactivateSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(result.status).toBe(SubscriptionStatus.ACTIVE);\n        expect(result.defaultPaymentMethodId).toBe('existing-payment-method');\n      });\n\n      it('should throw error when subscription is not canceled', async () => {\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(mockSubscription as any);\n\n        await expect(\n          service.reactivateSubscription(TEST_USER_IDS.CLIENT)\n        ).rejects.toThrow(BadRequestException);\n      });\n\n      it('should throw error when payment method does not exist', async () => {\n        const canceledSubscription = {\n          ...mockSubscription,\n          status: SubscriptionStatus.CANCELED,\n        };\n\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(canceledSubscription as any);\n        (prismaService.paymentMethod.findUnique as jest.Mock).mockResolvedValue(null);\n\n        await expect(\n          service.reactivateSubscription(TEST_USER_IDS.CLIENT, 'non-existent-payment-method')\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n\n    describe('applyDiscountToSubscription', () => {\n      it('should apply discount to subscription', async () => {\n        const mockDiscount = {\n          id: 'discount-id',\n          code: 'SAVE20',\n          type: DiscountType.PERCENTAGE,\n          percentOff: 20,\n          isActive: true,\n          validUntil: new Date('2024-12-31'),\n          currentUses: 5,\n          maxUses: 100,\n        };\n\n        const subscriptionWithDiscount = {\n          ...mockSubscription,\n          appliedDiscounts: [{\n            id: 'applied-discount-id',\n            discountId: 'discount-id',\n            subscriptionId: mockSubscription.id,\n            appliedAt: new Date(),\n          }],\n        };\n\n        jest.spyOn(service, 'validateDiscount').mockResolvedValue(mockDiscount as any);\n        (prismaService.$transaction as jest.Mock).mockImplementation(async (callback) => {\n          const mockTxn = {\n            subscriptionDiscount: {\n              create: jest.fn().mockResolvedValue(subscriptionWithDiscount.appliedDiscounts[0]),\n            },\n            discount: {\n              update: jest.fn(),\n            },\n            subscription: {\n              findUnique: jest.fn().mockResolvedValue(subscriptionWithDiscount),\n            },\n          };\n          return callback(mockTxn);\n        });\n\n        const result = await service.applyDiscountToSubscription(\n          TEST_USER_IDS.CLIENT,\n          'SAVE20'\n        );\n\n        expect(result.appliedDiscounts).toBeDefined();\n        expect(result.appliedDiscounts).toHaveLength(1);\n      });\n\n      it('should throw error when discount is already applied', async () => {\n        const mockDiscount = {\n          id: 'discount-id',\n          code: 'SAVE20',\n        };\n\n        const subscriptionWithDiscount = {\n          ...mockSubscription,\n          appliedDiscounts: [{\n            discountId: 'discount-id',\n          }],\n        };\n\n        jest.spyOn(service, 'validateDiscount').mockResolvedValue(mockDiscount as any);\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(subscriptionWithDiscount as any);\n\n        await expect(\n          service.applyDiscountToSubscription(TEST_USER_IDS.CLIENT, 'SAVE20')\n        ).rejects.toThrow(BadRequestException);\n      });\n    });\n\n    describe('processSubscriptionRenewal', () => {\n      it('should process successful renewal', async () => {\n        const renewalDate = new Date('2024-02-01');\n        const renewedSubscription = {\n          ...mockSubscription,\n          currentPeriodStart: renewalDate,\n          currentPeriodEnd: new Date('2024-03-01'),\n          renewalCount: 1,\n        };\n\n        const mockPayment = {\n          id: 'renewal-payment-id',\n          amount: mockSubscription.amount,\n          status: PaymentStatus.SUCCEEDED,\n        };\n\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(mockSubscription);\n        (prismaService.$transaction as jest.Mock).mockImplementation(async (callback) => {\n          const mockTxn = {\n            payment: {\n              create: jest.fn().mockResolvedValue(mockPayment),\n            },\n            subscription: {\n              update: jest.fn().mockResolvedValue(renewedSubscription),\n            },\n          };\n          return callback(mockTxn);\n        });\n\n        const result = await service.processSubscriptionRenewal(mockSubscription.id);\n\n        expect(result.renewalCount).toBe(1);\n        expect(result.currentPeriodStart).toEqual(renewalDate);\n      });\n\n      it('should handle renewal payment failure', async () => {\n        const mockPayment = {\n          id: 'failed-payment-id',\n          status: PaymentStatus.FAILED,\n        };\n\n        const subscriptionPastDue = {\n          ...mockSubscription,\n          status: SubscriptionStatus.PAST_DUE,\n          pastDueDate: new Date(),\n        };\n\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(mockSubscription);\n        (prismaService.$transaction as jest.Mock).mockImplementation(async (callback) => {\n          const mockTxn = {\n            payment: {\n              create: jest.fn().mockResolvedValue(mockPayment),\n            },\n            subscription: {\n              update: jest.fn().mockResolvedValue(subscriptionPastDue),\n            },\n          };\n          return callback(mockTxn);\n        });\n\n        const result = await service.processSubscriptionRenewal(mockSubscription.id);\n\n        expect(result.status).toBe(SubscriptionStatus.PAST_DUE);\n      });\n\n      it('should throw error when subscription not found', async () => {\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(null);\n\n        await expect(\n          service.processSubscriptionRenewal('non-existent-subscription')\n        ).rejects.toThrow(NotFoundException);\n      });\n    });\n\n    describe('getSubscriptionUsageAnalytics', () => {\n      it('should return usage analytics for subscription', async () => {\n        const startDate = new Date('2024-01-01');\n        const endDate = new Date('2024-01-31');\n        \n        const mockUsageRecords = [\n          { feature: 'api_calls', quantity: 1000, usageDate: new Date('2024-01-15') },\n          { feature: 'storage', quantity: 50, usageDate: new Date('2024-01-20') },\n          { feature: 'api_calls', quantity: 800, usageDate: new Date('2024-01-25') },\n        ];\n\n        const expectedAnalytics = {\n          subscriptionId: mockSubscription.id,\n          period: { start: startDate, end: endDate },\n          totalUsage: {\n            api_calls: 1800,\n            storage: 50,\n          },\n          dailyUsage: [\n            { date: '2024-01-15', api_calls: 1000 },\n            { date: '2024-01-20', storage: 50 },\n            { date: '2024-01-25', api_calls: 800 },\n          ],\n          trends: {\n            api_calls: { growth: 0.2, trend: 'increasing' },\n            storage: { growth: 0.0, trend: 'stable' },\n          },\n        };\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(mockUsageRecords);\n        (prismaService.usageRecord.groupBy as jest.Mock).mockResolvedValue([\n          { feature: 'api_calls', _sum: { quantity: 1800 } },\n          { feature: 'storage', _sum: { quantity: 50 } },\n        ]);\n\n        const result = await service.getSubscriptionUsageAnalytics(\n          mockSubscription.id,\n          startDate,\n          endDate\n        );\n\n        expect(result.subscriptionId).toBe(mockSubscription.id);\n        expect(result.totalUsage).toBeDefined();\n        expect(result.totalUsage.api_calls).toBe(1800);\n        expect(result.totalUsage.storage).toBe(50);\n      });\n\n      it('should return analytics for current month when no dates provided', async () => {\n        const currentDate = new Date();\n        const startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue([]);\n        (prismaService.usageRecord.groupBy as jest.Mock).mockResolvedValue([]);\n\n        const result = await service.getSubscriptionUsageAnalytics(mockSubscription.id);\n\n        expect(result.period.start.getMonth()).toBe(startOfMonth.getMonth());\n        expect(result.period.end.getMonth()).toBe(endOfMonth.getMonth());\n      });\n    });\n  });\n\n  describe('Advanced Billing Features', () => {\n    describe('Proration Calculations', () => {\n      it('should calculate prorated amount for mid-cycle upgrade', async () => {\n        const currentDate = new Date('2024-01-15');\n        const periodStart = new Date('2024-01-01');\n        const periodEnd = new Date('2024-02-01');\n        const oldAmount = 10.00;\n        const newAmount = 30.00;\n        \n        const result = (service as any).calculateProration(\n          oldAmount,\n          newAmount,\n          periodStart,\n          periodEnd,\n          currentDate\n        );\n\n        expect(result.credit).toBeLessThan(0);\n        expect(result.charge).toBeGreaterThan(0);\n        expect(result.netAmount).toBe(result.credit + result.charge);\n      });\n\n      it('should calculate prorated amount for downgrade', async () => {\n        const currentDate = new Date('2024-01-10');\n        const periodStart = new Date('2024-01-01');\n        const periodEnd = new Date('2024-02-01');\n        const oldAmount = 30.00;\n        const newAmount = 10.00;\n        \n        const result = (service as any).calculateProration(\n          oldAmount,\n          newAmount,\n          periodStart,\n          periodEnd,\n          currentDate\n        );\n\n        expect(result.credit).toBeLessThan(0);\n        expect(result.charge).toBeGreaterThan(0);\n        expect(result.netAmount).toBeLessThan(0);\n      });\n\n      it('should handle end-of-period changes with no proration', async () => {\n        const currentDate = new Date('2024-02-01');\n        const periodStart = new Date('2024-01-01');\n        const periodEnd = new Date('2024-02-01');\n        const oldAmount = 10.00;\n        const newAmount = 30.00;\n        \n        const result = (service as any).calculateProration(\n          oldAmount,\n          newAmount,\n          periodStart,\n          periodEnd,\n          currentDate\n        );\n\n        expect(result.credit).toBe(0);\n        expect(result.charge).toBe(0);\n        expect(result.netAmount).toBe(0);\n      });\n    });\n\n    describe('Usage-Based Billing', () => {\n      it('should calculate usage charges for metered features', async () => {\n        const mockUsageRecords = [\n          { feature: 'api_calls', quantity: 1000, unitPrice: 0.01 },\n          { feature: 'storage_gb', quantity: 25, unitPrice: 0.10 },\n          { feature: 'bandwidth_gb', quantity: 100, unitPrice: 0.05 },\n        ];\n\n        const startDate = new Date('2024-01-01');\n        const endDate = new Date('2024-01-31');\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(mockUsageRecords);\n\n        const result = await service.calculateUsageCharges(\n          'subscription-id',\n          startDate,\n          endDate\n        );\n\n        expect(result.totalCharges).toBe(17.50);\n        expect(result.breakdown).toHaveLength(3);\n        expect(result.breakdown[0]).toEqual({\n          feature: 'api_calls',\n          quantity: 1000,\n          unitPrice: 0.01,\n          totalCharge: 10.00,\n        });\n      });\n\n      it('should apply usage tiers and discounts', async () => {\n        const mockUsageRecords = [\n          { feature: 'api_calls', quantity: 10000, unitPrice: 0.01 },\n        ];\n\n        const mockPricingTiers = [\n          { min: 0, max: 1000, price: 0.01 },\n          { min: 1001, max: 5000, price: 0.008 },\n          { min: 5001, max: Infinity, price: 0.005 },\n        ];\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(mockUsageRecords);\n        (prismaService.pricingTier.findMany as jest.Mock).mockResolvedValue(mockPricingTiers);\n\n        const result = await service.calculateTieredUsageCharges(\n          'subscription-id',\n          'api_calls',\n          new Date('2024-01-01'),\n          new Date('2024-01-31')\n        );\n\n        expect(result.totalCharge).toBe(67);\n        expect(result.tiers).toHaveLength(3);\n      });\n    });\n\n    describe('Revenue Recognition', () => {\n      it('should recognize revenue for monthly subscription', async () => {\n        const subscription = {\n          id: 'subscription-id',\n          amount: 29.99,\n          billingCycle: BillingCycle.MONTHLY,\n          currentPeriodStart: new Date('2024-01-01'),\n          currentPeriodEnd: new Date('2024-02-01'),\n        };\n\n        const result = await service.calculateRevenueRecognition(subscription as any);\n\n        expect(result.totalRevenue).toBe(29.99);\n        expect(result.dailyRevenue).toBeCloseTo(0.97, 2);\n        expect(result.recognitionSchedule).toHaveLength(31);\n      });\n\n      it('should handle deferred revenue for annual subscriptions', async () => {\n        const subscription = {\n          id: 'subscription-id',\n          amount: 299.99,\n          billingCycle: BillingCycle.YEARLY,\n          currentPeriodStart: new Date('2024-01-01'),\n          currentPeriodEnd: new Date('2025-01-01'),\n        };\n\n        const result = await service.calculateRevenueRecognition(subscription as any);\n\n        expect(result.totalRevenue).toBe(299.99);\n        expect(result.monthlyRevenue).toBeCloseTo(25.00, 2);\n        expect(result.recognitionSchedule).toHaveLength(12);\n      });\n    });\n\n    describe('Tax Calculations', () => {\n      it('should calculate tax for US customers', async () => {\n        const billingAddress = {\n          country: 'US',\n          state: 'CA',\n          city: 'San Francisco',\n          postalCode: '94105',\n        };\n\n        const amount = 100.00;\n\n        const result = await service.calculateTax(amount, billingAddress);\n\n        expect(result.taxAmount).toBeGreaterThan(0);\n        expect(result.taxRate).toBeGreaterThan(0);\n        expect(result.taxJurisdiction).toBe('CA');\n        expect(result.totalAmount).toBe(amount + result.taxAmount);\n      });\n\n      it('should handle VAT for EU customers', async () => {\n        const billingAddress = {\n          country: 'DE',\n          vatNumber: 'DE123456789',\n        };\n\n        const amount = 100.00;\n\n        const result = await service.calculateTax(amount, billingAddress);\n\n        expect(result.taxType).toBe('VAT');\n        expect(result.vatNumber).toBe('DE123456789');\n      });\n\n      it('should skip tax for tax-exempt customers', async () => {\n        const billingAddress = {\n          country: 'US',\n          state: 'CA',\n          taxExempt: true,\n          exemptionCertificate: 'EXEMPT-123',\n        };\n\n        const amount = 100.00;\n\n        const result = await service.calculateTax(amount, billingAddress);\n\n        expect(result.taxAmount).toBe(0);\n        expect(result.exemptionReason).toBe('Tax exempt customer');\n      });\n    });\n\n    describe('Dunning Management', () => {\n      it('should process failed payment with retry logic', async () => {\n        const failedPayment = {\n          id: 'payment-id',\n          subscriptionId: 'subscription-id',\n          amount: 29.99,\n          status: PaymentStatus.FAILED,\n          attemptCount: 1,\n          failureCode: 'card_declined',\n        };\n\n        const mockSubscription = {\n          id: 'subscription-id',\n          status: SubscriptionStatus.ACTIVE,\n          defaultPaymentMethodId: 'payment-method-id',\n        };\n\n        (prismaService.payment.findUnique as jest.Mock).mockResolvedValue(failedPayment);\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(mockSubscription);\n\n        const result = await service.processDunning('payment-id');\n\n        expect(result.retryScheduled).toBe(true);\n        expect(result.nextRetryDate).toBeDefined();\n        expect(result.dunningLevel).toBe(1);\n      });\n\n      it('should escalate dunning after multiple failures', async () => {\n        const failedPayment = {\n          id: 'payment-id',\n          subscriptionId: 'subscription-id',\n          status: PaymentStatus.FAILED,\n          attemptCount: 3,\n        };\n\n        const mockSubscription = {\n          id: 'subscription-id',\n          status: SubscriptionStatus.PAST_DUE,\n        };\n\n        (prismaService.payment.findUnique as jest.Mock).mockResolvedValue(failedPayment);\n        (prismaService.subscription.findUnique as jest.Mock).mockResolvedValue(mockSubscription);\n\n        const result = await service.processDunning('payment-id');\n\n        expect(result.escalated).toBe(true);\n        expect(result.dunningLevel).toBe(3);\n        expect(result.actionRequired).toBe('update_payment_method');\n      });\n\n      it('should cancel subscription after maximum retries', async () => {\n        const failedPayment = {\n          id: 'payment-id',\n          subscriptionId: 'subscription-id',\n          status: PaymentStatus.FAILED,\n          attemptCount: 5,\n        };\n\n        (prismaService.payment.findUnique as jest.Mock).mockResolvedValue(failedPayment);\n        jest.spyOn(service, 'cancelSubscription').mockResolvedValue({ status: SubscriptionStatus.CANCELED } as any);\n\n        const result = await service.processDunning('payment-id');\n\n        expect(result.subscriptionCanceled).toBe(true);\n        expect(service.cancelSubscription).toHaveBeenCalled();\n      });\n    });\n\n    describe('Subscription Analytics', () => {\n      it('should calculate customer lifetime value', async () => {\n        const mockPayments = [\n          { amount: 29.99, createdAt: new Date('2024-01-01') },\n          { amount: 29.99, createdAt: new Date('2024-02-01') },\n          { amount: 29.99, createdAt: new Date('2024-03-01') },\n        ];\n\n        const mockSubscription = {\n          createdAt: new Date('2024-01-01'),\n          status: SubscriptionStatus.ACTIVE,\n        };\n\n        (prismaService.payment.findMany as jest.Mock).mockResolvedValue(mockPayments);\n\n        const result = await service.calculateCustomerLifetimeValue(\n          TEST_USER_IDS.CLIENT,\n          mockSubscription as any\n        );\n\n        expect(result.totalRevenue).toBe(89.97);\n        expect(result.averageMonthlyRevenue).toBeCloseTo(29.99, 2);\n        expect(result.subscriptionMonths).toBe(3);\n        expect(result.projectedLTV).toBeGreaterThan(89.97);\n      });\n\n      it('should calculate churn prediction', async () => {\n        const mockUsageData = {\n          lastLoginDate: new Date('2024-01-01'),\n          averageSessionDuration: 300,\n          featureUsage: {\n            api_calls: 100,\n            storage: 1,\n          },\n          supportTickets: 2,\n        };\n\n        const mockPaymentHistory = [\n          { status: PaymentStatus.FAILED, createdAt: new Date('2024-01-15') },\n          { status: PaymentStatus.SUCCEEDED, createdAt: new Date('2024-01-01') },\n        ];\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(mockUsageData.featureUsage);\n        (prismaService.payment.findMany as jest.Mock).mockResolvedValue(mockPaymentHistory);\n\n        const result = await service.calculateChurnPrediction(\n          TEST_USER_IDS.CLIENT,\n          mockUsageData\n        );\n\n        expect(result.churnRisk).toBeGreaterThan(0.5);\n        expect(result.riskFactors).toContain('low_usage');\n        expect(result.riskFactors).toContain('payment_failures');\n        expect(result.recommendedActions).toContain('engagement_campaign');\n      });\n    });\n  });\n\n  describe('Integration Tests', () => {\n    describe('Complete Subscription Lifecycle', () => {\n      it('should handle complete subscription flow from creation to cancellation', async () => {\n        const mockPlan = {\n          id: 'plan-id',\n          tier: SubscriptionTier.PREMIUM,\n          monthlyPrice: 29.99,\n        };\n\n        const mockPaymentMethod = {\n          id: 'payment-method-id',\n          type: PaymentMethodType.CARD,\n          isDefault: true,\n        };\n\n        (prismaService.subscriptionPlan.findUnique as jest.Mock).mockResolvedValue(mockPlan);\n        (prismaService.subscription.create as jest.Mock).mockResolvedValue({\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          status: SubscriptionStatus.ACTIVE,\n        });\n\n        const subscription = await service.createSubscription({\n          userId: TEST_USER_IDS.CLIENT,\n          planId: 'plan-id',\n          paymentMethodId: 'payment-method-id',\n        });\n\n        expect(subscription.status).toBe(SubscriptionStatus.ACTIVE);\n\n        (prismaService.payment.create as jest.Mock).mockResolvedValue({\n          id: 'payment-id',\n          status: PaymentStatus.SUCCEEDED,\n          amount: 29.99,\n        });\n\n        const payment = await service.createPayment({\n          amount: 29.99,\n          subscriptionId: subscription.id,\n          paymentMethodId: 'payment-method-id',\n        });\n\n        expect(payment.status).toBe(PaymentStatus.SUCCEEDED);\n\n        (prismaService.usageRecord.create as jest.Mock).mockResolvedValue({\n          id: 'usage-id',\n          feature: 'api_calls',\n          quantity: 1000,\n        });\n\n        const usage = await service.recordUsage({\n          subscriptionId: subscription.id,\n          feature: 'api_calls',\n          quantity: 1000,\n        });\n\n        expect(usage.quantity).toBe(1000);\n\n        jest.spyOn(service, 'updateSubscription').mockResolvedValue({\n          ...subscription,\n          status: SubscriptionStatus.CANCELED,\n        } as any);\n\n        const canceledSubscription = await service.cancelSubscription(TEST_USER_IDS.CLIENT);\n\n        expect(canceledSubscription.status).toBe(SubscriptionStatus.CANCELED);\n      });\n\n      it('should handle subscription upgrade with proration', async () => {\n        const basicPlan = {\n          id: 'basic-plan',\n          tier: SubscriptionTier.BASIC,\n          monthlyPrice: 9.99,\n        };\n\n        const premiumPlan = {\n          id: 'premium-plan',\n          tier: SubscriptionTier.PREMIUM,\n          monthlyPrice: 29.99,\n        };\n\n        const currentSubscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          planId: 'basic-plan',\n          tier: SubscriptionTier.BASIC,\n          amount: 9.99,\n          currentPeriodStart: new Date('2024-01-01'),\n          currentPeriodEnd: new Date('2024-02-01'),\n        };\n\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(currentSubscription as any);\n        (prismaService.subscriptionPlan.findUnique as jest.Mock).mockResolvedValue(premiumPlan);\n        \n        const upgradedSubscription = {\n          ...currentSubscription,\n          planId: 'premium-plan',\n          tier: SubscriptionTier.PREMIUM,\n          amount: 29.99,\n        };\n\n        (prismaService.$transaction as jest.Mock).mockImplementation(async (callback) => {\n          const mockTxn = {\n            subscription: {\n              update: jest.fn().mockResolvedValue(upgradedSubscription),\n            },\n            invoice: {\n              create: jest.fn().mockResolvedValue({\n                id: 'proration-invoice',\n                total: 15.00,\n              }),\n            },\n            invoiceLineItem: {\n              createMany: jest.fn(),\n            },\n          };\n          return callback(mockTxn);\n        });\n\n        const result = await service.changeSubscriptionPlan(\n          TEST_USER_IDS.CLIENT,\n          'premium-plan',\n          {\n            billingCycle: BillingCycle.MONTHLY,\n            prorationBehavior: 'create_prorations',\n          }\n        );\n\n        expect(result.tier).toBe(SubscriptionTier.PREMIUM);\n        expect(result.amount).toBe(29.99);\n      });\n    });\n\n    describe('Error Recovery and Resilience', () => {\n      it('should handle payment gateway timeouts gracefully', async () => {\n        const paymentData = {\n          amount: 29.99,\n          paymentMethodId: 'payment-method-id',\n          subscriptionId: 'subscription-id',\n        };\n\n        const timeoutError = new Error('Payment gateway timeout');\n        timeoutError.name = 'TimeoutError';\n        \n        (prismaService.payment.create as jest.Mock).mockRejectedValue(timeoutError);\n\n        await expect(\n          service.createPayment(paymentData)\n        ).rejects.toThrow('Payment gateway timeout');\n\n        expect(prismaService.subscription.update).not.toHaveBeenCalled();\n      });\n\n      it('should handle concurrent subscription modifications', async () => {\n        const subscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          version: 1,\n        };\n\n        jest.spyOn(service, 'findUserSubscription').mockResolvedValue(subscription as any);\n\n        const conflictError = new Error('Subscription was modified by another process');\n        conflictError.name = 'ConflictError';\n        \n        (prismaService.subscription.update as jest.Mock).mockRejectedValue(conflictError);\n\n        await expect(\n          service.updateSubscription(TEST_USER_IDS.CLIENT, {\n            planId: 'new-plan-id',\n          })\n        ).rejects.toThrow('Subscription was modified by another process');\n      });\n\n      it('should handle database transaction rollbacks', async () => {\n        const discountData = {\n          code: 'SAVE20',\n          type: DiscountType.PERCENTAGE,\n          percentOff: 20,\n        };\n\n        (prismaService.$transaction as jest.Mock).mockRejectedValue(\n          new Error('Database transaction failed')\n        );\n\n        await expect(\n          service.redeemDiscount('discount-id', TEST_USER_IDS.CLIENT, 20)\n        ).rejects.toThrow('Database transaction failed');\n\n        expect(prismaService.discountRedemption.create).not.toHaveBeenCalled();\n      });\n    });\n\n    describe('Performance and Scalability', () => {\n      it('should handle high-volume billing operations efficiently', async () => {\n        const operationCount = 1000;\n        const batchOperations = Array.from({ length: operationCount }, (_, i) => {\n          if (i % 3 === 0) {\n            return service.recordUsage({\n              subscriptionId: `subscription-${i}`,\n              feature: 'api_calls',\n              quantity: 100,\n            });\n          } else if (i % 3 === 1) {\n            return service.createPayment({\n              amount: 29.99,\n              subscriptionId: `subscription-${i}`,\n            });\n          } else {\n            return service.getBillingStatistics(\n              new Date('2024-01-01'),\n              new Date('2024-01-31')\n            );\n          }\n        });\n\n        (prismaService.usageRecord.create as jest.Mock).mockResolvedValue({ id: 'usage-id' });\n        (prismaService.payment.create as jest.Mock).mockResolvedValue({ id: 'payment-id' });\n        (prismaService.payment.aggregate as jest.Mock).mockResolvedValue({ _sum: { amount: 1000 } });\n        (prismaService.subscription.count as jest.Mock).mockResolvedValue(10);\n        (prismaService.subscription.groupBy as jest.Mock).mockResolvedValue([]);\n\n        const startTime = Date.now();\n        const results = await Promise.all(batchOperations);\n        const endTime = Date.now();\n\n        expect(results).toHaveLength(operationCount);\n        expect(endTime - startTime).toBeLessThan(5000);\n      });\n\n      it('should optimize memory usage for large result sets', async () => {\n        const largeUsageDataset = Array.from({ length: 50000 }, (_, i) => ({\n          id: `usage-${i}`,\n          feature: 'api_calls',\n          quantity: Math.floor(Math.random() * 1000),\n          usageDate: new Date(),\n        }));\n\n        (prismaService.usageRecord.findMany as jest.Mock).mockResolvedValue(largeUsageDataset);\n\n        const initialMemory = process.memoryUsage().heapUsed;\n        const result = await service.getUsageRecords(\n          'subscription-id',\n          'api_calls',\n          new Date('2024-01-01'),\n          new Date('2024-01-31')\n        );\n        const finalMemory = process.memoryUsage().heapUsed;\n\n        expect(result).toHaveLength(50000);\n        \n        const memoryIncrease = finalMemory - initialMemory;\n        expect(memoryIncrease).toBeLessThan(200 * 1024 * 1024);\n      });\n    });\n\n    describe('Data Consistency and Integrity', () => {\n      it('should maintain invoice number sequence integrity', async () => {\n        const concurrentInvoiceCreations = Array.from({ length: 10 }, (_, i) => {\n          (prismaService.invoice.findFirst as jest.Mock).mockResolvedValueOnce({\n            number: `INV-2024-00000${i}`,\n          });\n          (prismaService.invoice.create as jest.Mock).mockResolvedValueOnce({\n            id: `invoice-${i}`,\n            number: `INV-2024-00000${i + 1}`,\n          });\n\n          return service.createInvoice({\n            subscriptionId: `subscription-${i}`,\n            subtotal: 100,\n            dueDate: new Date(),\n          });\n        });\n\n        const results = await Promise.all(concurrentInvoiceCreations);\n        \n        const invoiceNumbers = results.map(invoice => invoice.number);\n        const uniqueNumbers = new Set(invoiceNumbers);\n        expect(uniqueNumbers.size).toBe(invoiceNumbers.length);\n      });\n\n      it('should ensure subscription state consistency during transitions', async () => {\n        const subscription = {\n          id: 'subscription-id',\n          userId: TEST_USER_IDS.CLIENT,\n          status: SubscriptionStatus.ACTIVE,\n        };\n\n        const transitions = [\n          { from: SubscriptionStatus.ACTIVE, to: SubscriptionStatus.PAUSED, valid: true },\n          { from: SubscriptionStatus.PAUSED, to: SubscriptionStatus.ACTIVE, valid: true },\n          { from: SubscriptionStatus.CANCELED, to: SubscriptionStatus.ACTIVE, valid: true },\n          { from: SubscriptionStatus.TRIALING, to: SubscriptionStatus.ACTIVE, valid: true },\n          { from: SubscriptionStatus.PAST_DUE, to: SubscriptionStatus.CANCELED, valid: true },\n        ];\n\n        for (const transition of transitions) {\n          jest.spyOn(service, 'findUserSubscription').mockResolvedValue({\n            ...subscription,\n            status: transition.from,\n          } as any);\n\n          if (transition.valid) {\n            jest.spyOn(service, 'updateSubscription').mockResolvedValue({\n              ...subscription,\n              status: transition.to,\n            } as any);\n\n            await expect(\n              service.updateSubscription(TEST_USER_IDS.CLIENT, {\n                status: transition.to,\n              })\n            ).resolves.toBeDefined();\n          }\n        }\n      });\n    });\n  });\n});\n"],"version":3}