{"version":3,"names":["cov_3p6dr8qc3","actualCoverage","common_1","s","require","passport_1","core_1","public_decorator_1","JwtAuthGuard","AuthGuard","reflector","constructor","f","canActivate","context","isPublic","getAllAndOverride","IS_PUBLIC_KEY","getHandler","getClass","b","handleRequest","err","user","info","UnauthorizedException","request","switchToHttp","getRequest","userId","userRole","role","exports","__decorate","Injectable","Reflector","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/guards/jwt-auth.guard.ts"],"sourcesContent":["import {\n  Injectable,\n  ExecutionContext,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { Reflector } from '@nestjs/core';\nimport { IS_PUBLIC_KEY } from '../decorators/public.decorator';\n\n@Injectable()\nexport class JwtAuthGuard extends AuthGuard('jwt') {\n  constructor(private reflector: Reflector) {\n    super();\n  }\n\n  canActivate(context: ExecutionContext) {\n    const isPublic = this.reflector.getAllAndOverride<boolean>(IS_PUBLIC_KEY, [\n      context.getHandler(),\n      context.getClass(),\n    ]);\n\n    if (isPublic) {\n      return true;\n    }\n\n    return super.canActivate(context);\n  }\n\n  handleRequest(err: any, user: any, info: any, context: ExecutionContext) {\n    // You can throw an exception based on either \"info\" or \"err\" arguments\n    if (err || !user) {\n      throw err || new UnauthorizedException('Invalid token');\n    }\n\n    // Set user data on request for decorators to access\n    const request = context.switchToHttp().getRequest();\n    request.user = user;\n    request.userId = user.userId; // For @CurrentUserId() decorator\n    request.userRole = user.role; // For @CurrentUserRole() decorator\n\n    return user;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}