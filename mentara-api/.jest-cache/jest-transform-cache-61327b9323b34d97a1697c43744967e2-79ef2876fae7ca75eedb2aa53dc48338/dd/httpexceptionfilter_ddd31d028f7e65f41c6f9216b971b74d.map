{"version":3,"names":["cov_1e1xwcctrq","actualCoverage","common_1","s","require","api_response_dto_1","HttpExceptionFilter","HttpExceptionFilter_1","logger","Logger","name","catch","exception","host","f","ctx","switchToHttp","response","getResponse","request","getRequest","status","HttpStatus","INTERNAL_SERVER_ERROR","message","errors","HttpException","b","getStatus","exceptionResponse","errorObj","Array","isArray","error","Error","stack","method","url","errorResponse","ApiResponseDto","length","convertStringErrorsToDetails","undefined","json","exports","__decorate","Catch"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/filters/http-exception.filter.ts"],"sourcesContent":["import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n  Logger,\n} from '@nestjs/common';\nimport { Request, Response } from 'express';\nimport { ApiResponseDto, ErrorDetail } from '../dto/api-response.dto';\n\n@Catch()\nexport class HttpExceptionFilter implements ExceptionFilter {\n  private readonly logger = new Logger(HttpExceptionFilter.name);\n\n  catch(exception: unknown, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n    const request = ctx.getRequest<Request>();\n\n    let status = HttpStatus.INTERNAL_SERVER_ERROR;\n    let message = 'Internal server error';\n    let errors: string[] = [];\n\n    if (exception instanceof HttpException) {\n      status = exception.getStatus();\n      const exceptionResponse = exception.getResponse();\n\n      if (typeof exceptionResponse === 'string') {\n        message = exceptionResponse;\n      } else if (typeof exceptionResponse === 'object') {\n        const errorObj = exceptionResponse as any;\n        message = errorObj.message || message;\n        errors = Array.isArray(errorObj.message)\n          ? errorObj.message\n          : errorObj.error\n            ? [errorObj.error]\n            : [];\n      }\n    } else if (exception instanceof Error) {\n      message = exception.message;\n      this.logger.error(exception.stack);\n    }\n\n    this.logger.error(\n      `HTTP ${status} Error - ${request.method} ${request.url}: ${message}`,\n    );\n\n    const errorResponse = ApiResponseDto.error(\n      message,\n      errors.length > 0 ? ApiResponseDto.convertStringErrorsToDetails(errors) : undefined,\n      status,\n      request.url,\n    );\n\n    response.status(status).json(errorResponse);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgBI;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAA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","ignoreList":[]}