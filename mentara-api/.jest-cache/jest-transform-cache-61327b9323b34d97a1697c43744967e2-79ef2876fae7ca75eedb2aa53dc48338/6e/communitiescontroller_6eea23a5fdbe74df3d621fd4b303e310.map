{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/communities.controller.ts","mappings":";;;;;;;;;;;;;;;;AAAA,2CAkBwB;AACxB,+DAA4D;AAC5D,mEAA8D;AAC9D,iFAAqE;AACrE,+DAA2D;AAC3D,iFAA4E;AAC5E,2FAGsD;AAetD,6FAA8E;AAC9E,yEAA4D;AAIrD,IAAM,qBAAqB,GAA3B,MAAM,qBAAqB;IAEb;IACA;IACA;IACA;IAJnB,YACmB,kBAAsC,EACtC,0BAAsD,EACtD,MAAqB,EACrB,sBAA8C;QAH9C,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,+BAA0B,GAA1B,0BAA0B,CAA4B;QACtD,WAAM,GAAN,MAAM,CAAe;QACrB,2BAAsB,GAAtB,sBAAsB,CAAwB;IAC9D,CAAC;IAKE,AAFN,mHAAmH;IACnH,kGAAkG;IAClG,KAAK,CAAC,OAAO;QACX,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,OAAO,EAAE,CAAC;QACjD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,kFAAkF;YAClF,iFAAiF;YACjF,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,QAAQ;QACZ,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,QAAQ,EAAE,CAAC;QAClD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,UAAU,CAAgB,IAAY;QAC1C,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YACjE,IAAI,CAAC,SAAS;gBAAE,MAAM,IAAI,0BAAiB,CAAC,qBAAqB,CAAC,CAAC;YACnE,OAAO,SAAS,CAAC;QACnB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,OAAO,CAAc,EAAU;QACnC,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAC5D,IAAI,CAAC,SAAS;gBAAE,MAAM,IAAI,0BAAiB,CAAC,qBAAqB,CAAC,CAAC;YACnE,OAAO,SAAS,CAAC;QACnB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,UAAU,CACD,EAAU,EACP,KAAc,EACb,MAAe;QAEhC,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAClD,MAAM,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAEpD,IAAI,KAAK,IAAI,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAC7B,MAAM,IAAI,4BAAmB,CAAC,yBAAyB,CAAC,CAAC;YAC3D,CAAC;YACD,IAAI,MAAM,IAAI,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC;gBAC/B,MAAM,IAAI,4BAAmB,CAAC,0BAA0B,CAAC,CAAC;YAC5D,CAAC;YAED,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAC7C,EAAE,EACF,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC,EAAE,sBAAsB;YAC5D,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,SAAS,CAAC,CACvB,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,MAAM,CACF,aAAsC;QAE9C,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;QACtE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,MAAM,CACG,EAAU,EACf,aAAsC;QAE9C,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,EAAE,EAAE,aAAa,CAAC,CAAC;QACjE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,MAAM,CAAc,EAAU;QAClC,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAClD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,aAAa,CACJ,WAAmB,EACf,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,kBAAkB,CAAC,aAAa,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;YACjE,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;QAC1B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,oEAAoE;YACpE,IACE,KAAK,YAAY,0BAAiB;gBAClC,KAAK,YAAY,0BAAiB;gBAClC,KAAK,YAAY,4BAAmB,EACpC,CAAC;gBACD,MAAM,KAAK,CAAC;YACd,CAAC;YAED,2BAA2B;YAC3B,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,0BAA0B,CACpE,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,cAAc,CACL,WAAmB,EACf,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;YAClE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;QACxB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,oEAAoE;YACpE,IACE,KAAK,YAAY,0BAAiB;gBAClC,KAAK,YAAY,0BAAiB;gBAClC,KAAK,YAAY,4BAAmB,EACpC,CAAC;gBACD,MAAM,KAAK,CAAC;YACd,CAAC;YAED,2BAA2B;YAC3B,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,2BAA2B,CACrE,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAFN,+HAA+H;IAC/H,iGAAiG;IACjG,KAAK,CAAC,YAAY,CACC,MAAc;QAE/B,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC5D,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,mBAAmB;QACvB,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,EAAE,CAAC;IAC9D,CAAC;IAIK,AAAN,KAAK,CAAC,6BAA6B,CAAkB,MAAc;QACjE,IAAI,CAAC;YACH,0EAA0E;YAC1E,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;QACpE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,0CAA0C,CACpF,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,mBAAmB,CAAc,EAAU;QAC/C,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,EAAE,CAAC,CAAC;IAChE,CAAC;IAIK,AAAN,KAAK,CAAC,eAAe,CACN,WAAmB,EACxB,GAAoC;QAE5C,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAClD,WAAW,EACX,GAAG,CAAC,IAAI,EACR,GAAG,CAAC,KAAK,CACV,CAAC;IACJ,CAAC;IAIK,AAAN,KAAK,CAAC,UAAU,CACQ,WAAmB,EACjC,GAAoC;QAE5C,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAC7C,WAAW,EACX,GAAG,CAAC,IAAI,EACR,GAAG,CAAC,KAAK,CACV,CAAC;IACJ,CAAC;IAGK,AAAN,KAAK,CAAC,eAAe,CAAuB,WAAmB;QAC7D,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC;IACrE,CAAC;IAED,iCAAiC;IAG3B,AAAN,KAAK,CAAC,qBAAqB,CACR,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,mBAAmB,GACvB,MAAM,IAAI,CAAC,0BAA0B,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC;YACxE,OAAO,EAAE,mBAAmB,EAAE,CAAC;QACjC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,uBAAuB,CACV,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,mBAAmB,GACvB,MAAM,IAAI,CAAC,0BAA0B,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC;YACxE,OAAO,EAAE,mBAAmB,EAAE,CAAC;QACjC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAGK,AAAN,KAAK,CAAC,2BAA2B,CACd,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,sBAAsB,GAC1B,MAAM,IAAI,CAAC,0BAA0B,CAAC,yBAAyB,CAAC,MAAM,CAAC,CAAC;YAC1E,OAAO,EAAE,sBAAsB,EAAE,CAAC;QACpC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,qBAAqB,CACjB,IAA2B;QAEnC,IAAI,CAAC;YACH,MAAM,OAAO,GACX,MAAM,IAAI,CAAC,0BAA0B,CAAC,qBAAqB,CACzD,IAAI,CAAC,OAAO,CACb,CAAC;YACJ,OAAO,EAAE,OAAO,EAAE,CAAC;QACrB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,CACzD,CAAC;QACJ,CAAC;IACH,CAAC;IAED,2DAA2D;IAIrD,AAAN,KAAK,CAAC,gBAAgB,CAAkB,MAAc;QACpD,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QAChE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,2BAA2B,CACrE,CAAC;QACJ,CAAC;IACH,CAAC;IAIK,AAAN,KAAK,CAAC,cAAc,CACD,MAAc,EAChB,IAAa,EACZ,KAAc;QAE9B,IAAI,CAAC;YACH,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC9C,MAAM,QAAQ,GAAG,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAClD,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,cAAc,CACjD,MAAM,EACN,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,EACpB,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC,CACpC,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,qBAAqB,CAC/D,CAAC;QACJ,CAAC;IACH,CAAC;IAMK,AAAN,KAAK,CAAC,UAAU,CACN,QAA4D,EACnD,MAAc,EACd,QAA+B,EAAE;QAElD,IAAI,CAAC;YACH,wCAAwC;YACxC,MAAM,WAAW,GAAuB,EAAE,CAAC;YAC3C,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC9B,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;oBACzB,MAAM,UAAU,GAAG,IAAI,CAAC,sBAAsB,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;oBAClE,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;wBACxB,MAAM,IAAI,4BAAmB,CAC3B,2BAA2B,UAAU,CAAC,KAAK,EAAE,CAC9C,CAAC;oBACJ,CAAC;gBACH,CAAC;gBAED,2BAA2B;gBAC3B,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,sBAAsB,CAAC,WAAW,CACjE,KAAK,EACL,iDAAsB,CAAC,mBAAmB,EAAE,CAAC,gBAAgB,CAC9D,CAAC;gBACF,WAAW,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,CAAC;YACrC,CAAC;YAED,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAC7C,QAAQ,CAAC,KAAK,EACd,QAAQ,CAAC,OAAO,EAChB,QAAQ,CAAC,MAAM,EACf,MAAM,EACN,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,EAC7B,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,EAClC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CACzB,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,uBAAuB,CACjE,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,SAAS,CACI,MAAc,EACd,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YACxD,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,sBAAsB,CAChE,CAAC;QACJ,CAAC;IACH,CAAC;IAKK,AAAN,KAAK,CAAC,WAAW,CACE,MAAc,EACd,MAAc;QAE/B,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,kBAAkB,CAAC,WAAW,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAC1D,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,wBAAwB,CAClE,CAAC;QACJ,CAAC;IACH,CAAC;IAIK,AAAN,KAAK,CAAC,oBAAoB,CAAkB,MAAc;QACxD,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;QACpE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,kCAAkC,CAC5E,CAAC;QACJ,CAAC;IACH,CAAC;IAIK,AAAN,KAAK,CAAC,yBAAyB,CAAkB,MAAc;QAC7D,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,yBAAyB,CAAC,MAAM,CAAC,CAAC;QACzE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,uCAAuC,CACjF,CAAC;QACJ,CAAC;IACH,CAAC;IAIK,AAAN,KAAK,CAAC,iBAAiB,CAAkB,MAAc;QACrD,IAAI,CAAC;YACH,OAAO,MAAM,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;QACjE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,qCAA4B,CACpC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,+BAA+B,CACzE,CAAC;QACJ,CAAC;IACH,CAAC;CACF,CAAA;AA3dY,sDAAqB;AAW1B;IAHL,IAAA,YAAG,GAAE;IACN,mHAAmH;IACnH,kGAAkG;;;;wDACjF,OAAO,oBAAP,OAAO;oDAUvB;AAGK;IADL,IAAA,YAAG,EAAC,OAAO,CAAC;;;wDACK,OAAO,oBAAP,OAAO;qDAQxB;AAGK;IADL,IAAA,YAAG,EAAC,YAAY,CAAC;IACA,WAAA,IAAA,cAAK,EAAC,MAAM,CAAC,CAAA;;;wDAAgB,OAAO,oBAAP,OAAO;uDAUrD;AAGK;IADL,IAAA,YAAG,EAAC,KAAK,CAAC;IACI,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;;;wDAAc,OAAO,oBAAP,OAAO;oDAU9C;AAGK;IADL,IAAA,YAAG,EAAC,aAAa,CAAC;IAEhB,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;IACX,WAAA,IAAA,cAAK,EAAC,OAAO,CAAC,CAAA;IACd,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;;;wDACf,OAAO,oBAAP,OAAO;uDAsBT;AAKK;IAHL,IAAA,aAAI,GAAE;IACN,IAAA,uBAAK,EAAC,WAAW,EAAE,OAAO,CAAC;IAC3B,IAAA,iBAAQ,EAAC,mBAAU,CAAC,OAAO,CAAC;IAE1B,WAAA,IAAA,aAAI,GAAE,CAAA;;;wDACN,OAAO,oBAAP,OAAO;mDAQT;AAKK;IAHL,IAAA,YAAG,EAAC,KAAK,CAAC;IACV,IAAA,uBAAK,EAAC,WAAW,EAAE,OAAO,CAAC;IAC3B,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;IACX,WAAA,IAAA,aAAI,GAAE,CAAA;;;wDACN,OAAO,oBAAP,OAAO;mDAQT;AAKK;IAHL,IAAA,eAAM,EAAC,KAAK,CAAC;IACb,IAAA,uBAAK,EAAC,WAAW,EAAE,OAAO,CAAC;IAC3B,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IACV,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;;;wDAAc,OAAO,oBAAP,OAAO;mDAQ7C;AAKK;IAHL,IAAA,aAAI,EAAC,UAAU,CAAC;IAChB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAClD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;IACX,WAAA,IAAA,yCAAa,GAAE,CAAA;;;wDACf,OAAO,oBAAP,OAAO;0DAmBT;AAKK;IAHL,IAAA,aAAI,EAAC,WAAW,CAAC;IACjB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAClD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;IACX,WAAA,IAAA,yCAAa,GAAE,CAAA;;;wDACf,OAAO,oBAAP,OAAO;2DAmBT;AAKK;IAHL,IAAA,YAAG,EAAC,cAAc,CAAC;IACpB,+HAA+H;IAC/H,iGAAiG;;IAE9F,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;;;wDACf,OAAO,oBAAP,OAAO;yDAQT;AAGK;IADL,IAAA,YAAG,EAAC,gBAAgB,CAAC;;;wDACO,OAAO,oBAAP,OAAO;gEAEnC;AAIK;IAFL,IAAA,YAAG,EAAC,mBAAmB,CAAC;IACxB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IACd,WAAA,IAAA,yCAAa,GAAE,CAAA;;;wDAAkB,OAAO,oBAAP,OAAO;0EAS5E;AAGK;IADL,IAAA,YAAG,EAAC,oBAAoB,CAAC;IACC,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;;;;gEAErC;AAIK;IAFL,IAAA,aAAI,EAAC,gBAAgB,CAAC;IACtB,IAAA,uBAAK,EAAC,WAAW,EAAE,OAAO,CAAC;IAEzB,WAAA,IAAA,cAAK,EAAC,IAAI,CAAC,CAAA;IACX,WAAA,IAAA,aAAI,GAAE,CAAA;;;;4DAOR;AAIK;IAFL,IAAA,aAAI,EAAC,8BAA8B,CAAC;IACpC,IAAA,uBAAK,EAAC,WAAW,EAAE,OAAO,CAAC;IAEzB,WAAA,IAAA,cAAK,EAAC,aAAa,CAAC,CAAA;IACpB,WAAA,IAAA,aAAI,GAAE,CAAA;;;;uDAOR;AAGK;IADL,IAAA,YAAG,EAAC,+BAA+B,CAAC;IACd,WAAA,IAAA,cAAK,EAAC,aAAa,CAAC,CAAA;;;;4DAE1C;AAKK;IAFL,IAAA,aAAI,EAAC,WAAW,CAAC;IACjB,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,yCAAa,GAAE,CAAA;;;wDACf,OAAO,oBAAP,OAAO;kEAUT;AAKK;IAHL,IAAA,aAAI,EAAC,gBAAgB,CAAC;IACtB,IAAA,uBAAK,EAAC,OAAO,CAAC;IACd,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;;;wDACf,OAAO,oBAAP,OAAO;oEAUT;AAGK;IADL,IAAA,YAAG,EAAC,gBAAgB,CAAC;IAEnB,WAAA,IAAA,yCAAa,GAAE,CAAA;;;wDACf,OAAO,oBAAP,OAAO;wEAUT;AAKK;IAHL,IAAA,aAAI,EAAC,aAAa,CAAC;IACnB,IAAA,uBAAK,EAAC,OAAO,CAAC;IACd,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,aAAI,GAAE,CAAA;;;wDACN,OAAO,oBAAP,OAAO;kEAYT;AAMK;IAFL,IAAA,YAAG,EAAC,gBAAgB,CAAC;IACrB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAC3B,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;6DAQtC;AAIK;IAFL,IAAA,YAAG,EAAC,qBAAqB,CAAC;IAC1B,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAEhD,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;IACf,WAAA,IAAA,cAAK,EAAC,MAAM,CAAC,CAAA;IACb,WAAA,IAAA,cAAK,EAAC,OAAO,CAAC,CAAA;;;;2DAehB;AAMK;IAJL,IAAA,aAAI,EAAC,OAAO,CAAC;IACb,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAClD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,OAAO,CAAC;IAC5B,IAAA,wBAAe,EAAC,IAAA,mCAAgB,EAAC,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC,wBAAwB;;IAEpE,WAAA,IAAA,aAAI,GAAE,CAAA;IACN,WAAA,IAAA,yCAAa,GAAE,CAAA;IACf,WAAA,IAAA,sBAAa,GAAE,CAAA;;;;uDAqCjB;AAKK;IAHL,IAAA,aAAI,EAAC,qBAAqB,CAAC;IAC3B,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAClD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;IACf,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;sDAUjB;AAKK;IAHL,IAAA,eAAM,EAAC,qBAAqB,CAAC;IAC7B,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAClD,IAAA,iBAAQ,EAAC,mBAAU,CAAC,EAAE,CAAC;IAErB,WAAA,IAAA,cAAK,EAAC,QAAQ,CAAC,CAAA;IACf,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;wDAUjB;AAIK;IAFL,IAAA,YAAG,EAAC,WAAW,CAAC;IAChB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IACvB,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;iEAQ1C;AAIK;IAFL,IAAA,YAAG,EAAC,gBAAgB,CAAC;IACrB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAClB,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;sEAQ/C;AAIK;IAFL,IAAA,YAAG,EAAC,iBAAiB,CAAC;IACtB,IAAA,uBAAK,EAAC,QAAQ,EAAE,WAAW,EAAE,WAAW,EAAE,OAAO,CAAC;IAC1B,WAAA,IAAA,yCAAa,GAAE,CAAA;;;;8DAQvC;gCA1dU,qBAAqB;IAFjC,IAAA,mBAAU,EAAC,aAAa,CAAC;IACzB,IAAA,kBAAS,EAAC,6BAAY,CAAC;yDAGiB,wCAAkB,oBAAlB,wCAAkB,oDACV,yDAA0B,oBAA1B,yDAA0B,oDAC9C,sCAAa,oBAAb,sCAAa,oDACG,iDAAsB,oBAAtB,iDAAsB;GALtD,qBAAqB,CA2djC","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/communities/communities.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Delete,\n  Get,\n  HttpCode,\n  HttpStatus,\n  Param,\n  Post,\n  Put,\n  Query,\n  UseGuards,\n  UseInterceptors,\n  UploadedFiles,\n  NotFoundException,\n  InternalServerErrorException,\n  BadRequestException,\n  ConflictException,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { JwtAuthGuard } from 'src/auth/guards/jwt-auth.guard';\nimport { PrismaService } from 'src/providers/prisma-client.provider';\nimport { CommunitiesService } from './communities.service';\nimport { CommunityAssignmentService } from './community-assignment.service';\nimport {\n  SupabaseStorageService,\n  FileUploadResult,\n} from 'src/common/services/supabase-storage.service';\nimport {\n  CommunityCreateInputDtoSchema,\n  CommunityUpdateInputDtoSchema,\n} from './validation';\nimport type {\n  CommunityCreateInputDto,\n  CommunityUpdateInputDto,\n  CommunityResponse,\n  CommunityStatsResponse,\n} from './types';\nimport {\n  CommunityWithMembersResponse,\n  CommunityWithRoomGroupsResponse,\n} from './communities.service';\nimport { CurrentUserId } from 'src/auth/decorators/current-user-id.decorator';\nimport { Roles } from 'src/auth/decorators/roles.decorator';\n\n@Controller('communities')\n@UseGuards(JwtAuthGuard)\nexport class CommunitiesController {\n  constructor(\n    private readonly communitiesService: CommunitiesService,\n    private readonly communityAssignmentService: CommunityAssignmentService,\n    private readonly prisma: PrismaService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  @Get()\n  // TODO: CONFUSING - Missing @Roles decorator - should this endpoint require authentication only or specific roles?\n  // All authenticated users can currently access this endpoint, verify if this is intended behavior\n  async findAll(): Promise<CommunityResponse[]> {\n    try {\n      return await this.communitiesService.findAll();\n    } catch (error) {\n      // TODO: CONFUSING PATTERN - This generic error handling masks specific exceptions\n      // Consider letting service-level exceptions bubble up for better error responses\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Get('stats')\n  async getStats(): Promise<CommunityStatsResponse> {\n    try {\n      return await this.communitiesService.getStats();\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Get('slug/:slug')\n  async findBySlug(@Param('slug') slug: string): Promise<CommunityResponse> {\n    try {\n      const community = await this.communitiesService.findBySlug(slug);\n      if (!community) throw new NotFoundException('Community not found');\n      return community;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Get(':id')\n  async findOne(@Param('id') id: string): Promise<CommunityResponse> {\n    try {\n      const community = await this.communitiesService.findOne(id);\n      if (!community) throw new NotFoundException('Community not found');\n      return community;\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Get(':id/members')\n  async getMembers(\n    @Param('id') id: string,\n    @Query('limit') limit?: string,\n    @Query('offset') offset?: string,\n  ): Promise<CommunityWithMembersResponse> {\n    try {\n      const limitNum = limit ? parseInt(limit, 10) : 50;\n      const offsetNum = offset ? parseInt(offset, 10) : 0;\n\n      if (limit && isNaN(limitNum)) {\n        throw new BadRequestException('Invalid limit parameter');\n      }\n      if (offset && isNaN(offsetNum)) {\n        throw new BadRequestException('Invalid offset parameter');\n      }\n\n      return await this.communitiesService.getMembers(\n        id,\n        Math.max(1, Math.min(100, limitNum)), // Clamp between 1-100\n        Math.max(0, offsetNum), // Ensure non-negative\n      );\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Post()\n  @Roles('moderator', 'admin')\n  @HttpCode(HttpStatus.CREATED)\n  async create(\n    @Body() communityData: CommunityCreateInputDto,\n  ): Promise<CommunityResponse> {\n    try {\n      return await this.communitiesService.createCommunity(communityData);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Put(':id')\n  @Roles('moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  async update(\n    @Param('id') id: string,\n    @Body() communityData: CommunityUpdateInputDto,\n  ): Promise<CommunityResponse> {\n    try {\n      return await this.communitiesService.update(id, communityData);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Delete(':id')\n  @Roles('moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  async remove(@Param('id') id: string): Promise<CommunityResponse> {\n    try {\n      return await this.communitiesService.remove(id);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Post(':id/join')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  async joinCommunity(\n    @Param('id') communityId: string,\n    @CurrentUserId() userId: string,\n  ): Promise<{ joined: boolean }> {\n    try {\n      await this.communitiesService.joinCommunity(communityId, userId);\n      return { joined: true };\n    } catch (error) {\n      // Re-throw known HTTP exceptions to preserve proper error responses\n      if (\n        error instanceof ConflictException ||\n        error instanceof NotFoundException ||\n        error instanceof BadRequestException\n      ) {\n        throw error;\n      }\n\n      // Only wrap unknown errors\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to join community',\n      );\n    }\n  }\n\n  @Post(':id/leave')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  async leaveCommunity(\n    @Param('id') communityId: string,\n    @CurrentUserId() userId: string,\n  ): Promise<{ left: boolean }> {\n    try {\n      await this.communitiesService.leaveCommunity(communityId, userId);\n      return { left: true };\n    } catch (error) {\n      // Re-throw known HTTP exceptions to preserve proper error responses\n      if (\n        error instanceof ConflictException ||\n        error instanceof NotFoundException ||\n        error instanceof BadRequestException\n      ) {\n        throw error;\n      }\n\n      // Only wrap unknown errors\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to leave community',\n      );\n    }\n  }\n\n  @Get('user/:userId')\n  // TODO: SECURITY CONCERN - Missing @Roles decorator allows any authenticated user to view another user's community memberships\n  // This could be a privacy issue - consider adding role restrictions or user ownership validation\n  async findByUserId(\n    @Param('userId') userId: string,\n  ): Promise<CommunityResponse[]> {\n    try {\n      return await this.communitiesService.findByUserId(userId);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Get('with-structure')\n  async getAllWithStructure(): Promise<CommunityWithRoomGroupsResponse[]> {\n    return await this.communitiesService.findAllWithStructure();\n  }\n\n  @Get('me/with-structure')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  async getMyCommunitiesWithStructure(@CurrentUserId() userId: string): Promise<CommunityWithRoomGroupsResponse[]> {\n    try {\n      // Use existing getJoinedCommunities which already includes full structure\n      return await this.communitiesService.getJoinedCommunities(userId);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to get communities with structure',\n      );\n    }\n  }\n\n  @Get(':id/with-structure')\n  async getOneWithStructure(@Param('id') id: string) {\n    return await this.communitiesService.findOneWithStructure(id);\n  }\n\n  @Post(':id/room-group')\n  @Roles('moderator', 'admin')\n  async createRoomGroup(\n    @Param('id') communityId: string,\n    @Body() dto: { name: string; order: number },\n  ) {\n    return await this.communitiesService.createRoomGroup(\n      communityId,\n      dto.name,\n      dto.order,\n    );\n  }\n\n  @Post('room-group/:roomGroupId/room')\n  @Roles('moderator', 'admin')\n  async createRoom(\n    @Param('roomGroupId') roomGroupId: string,\n    @Body() dto: { name: string; order: number },\n  ) {\n    return await this.communitiesService.createRoom(\n      roomGroupId,\n      dto.name,\n      dto.order,\n    );\n  }\n\n  @Get('room-group/:roomGroupId/rooms')\n  async getRoomsByGroup(@Param('roomGroupId') roomGroupId: string) {\n    return await this.communitiesService.findRoomsByGroup(roomGroupId);\n  }\n\n  // Community Assignment Endpoints\n  @Post('assign/me')\n  @HttpCode(HttpStatus.OK)\n  async assignCommunitiesToMe(\n    @CurrentUserId() userId: string,\n  ): Promise<{ assignedCommunities: string[] }> {\n    try {\n      const assignedCommunities =\n        await this.communityAssignmentService.assignCommunitiesToUser(userId);\n      return { assignedCommunities };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Post('assign/:userId')\n  @Roles('admin')\n  @HttpCode(HttpStatus.OK)\n  async assignCommunitiesToUser(\n    @Param('userId') userId: string,\n  ): Promise<{ assignedCommunities: string[] }> {\n    try {\n      const assignedCommunities =\n        await this.communityAssignmentService.assignCommunitiesToUser(userId);\n      return { assignedCommunities };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Get('recommended/me')\n  async getMyRecommendedCommunities(\n    @CurrentUserId() userId: string,\n  ): Promise<{ recommendedCommunities: string[] }> {\n    try {\n      const recommendedCommunities =\n        await this.communityAssignmentService.getRecommendedCommunities(userId);\n      return { recommendedCommunities };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  @Post('assign/bulk')\n  @Roles('admin')\n  @HttpCode(HttpStatus.OK)\n  async bulkAssignCommunities(\n    @Body() body: { userIds: string[] },\n  ): Promise<{ results: { [userId: string]: string[] } }> {\n    try {\n      const results =\n        await this.communityAssignmentService.bulkAssignCommunities(\n          body.userIds,\n        );\n      return { results };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Unknown error',\n      );\n    }\n  }\n\n  // New endpoints for community posts and content management\n\n  @Get('memberships/me')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  async getMyMemberships(@CurrentUserId() userId: string) {\n    try {\n      return await this.communitiesService.getMyMemberships(userId);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to get memberships',\n      );\n    }\n  }\n\n  @Get('rooms/:roomId/posts')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  async getPostsByRoom(\n    @Param('roomId') roomId: string,\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n  ) {\n    try {\n      const pageNum = page ? parseInt(page, 10) : 1;\n      const limitNum = limit ? parseInt(limit, 10) : 20;\n      return await this.communitiesService.getPostsByRoom(\n        roomId,\n        Math.max(1, pageNum),\n        Math.max(1, Math.min(50, limitNum)),\n      );\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to get posts',\n      );\n    }\n  }\n\n  @Post('posts')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.CREATED)\n  @UseInterceptors(FilesInterceptor('files', 5)) // Support up to 5 files\n  async createPost(\n    @Body() postData: { title: string; content: string; roomId: string },\n    @CurrentUserId() userId: string,\n    @UploadedFiles() files: Express.Multer.File[] = [], // Optional files\n  ) {\n    try {\n      // Validate and upload files if provided\n      const fileResults: FileUploadResult[] = [];\n      if (files && files.length > 0) {\n        for (const file of files) {\n          const validation = this.supabaseStorageService.validateFile(file);\n          if (!validation.isValid) {\n            throw new BadRequestException(\n              `File validation failed: ${validation.error}`,\n            );\n          }\n        }\n\n        // Upload files to Supabase\n        const uploadResults = await this.supabaseStorageService.uploadFiles(\n          files,\n          SupabaseStorageService.getSupportedBuckets().POST_ATTACHMENTS,\n        );\n        fileResults.push(...uploadResults);\n      }\n\n      return await this.communitiesService.createPost(\n        postData.title,\n        postData.content,\n        postData.roomId,\n        userId,\n        fileResults.map((f) => f.url),\n        fileResults.map((f) => f.filename),\n        files.map((f) => f.size),\n      );\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to create post',\n      );\n    }\n  }\n\n  @Post('posts/:postId/heart')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  async heartPost(\n    @Param('postId') postId: string,\n    @CurrentUserId() userId: string,\n  ) {\n    try {\n      await this.communitiesService.heartPost(postId, userId);\n      return { success: true };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to heart post',\n      );\n    }\n  }\n\n  @Delete('posts/:postId/heart')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  @HttpCode(HttpStatus.OK)\n  async unheartPost(\n    @Param('postId') postId: string,\n    @CurrentUserId() userId: string,\n  ) {\n    try {\n      await this.communitiesService.unheartPost(postId, userId);\n      return { success: true };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to unheart post',\n      );\n    }\n  }\n\n  @Get('me/joined')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  async getJoinedCommunities(@CurrentUserId() userId: string) {\n    try {\n      return await this.communitiesService.getJoinedCommunities(userId);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to get joined communities',\n      );\n    }\n  }\n\n  @Get('me/recommended')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  async getRecommendedCommunities(@CurrentUserId() userId: string) {\n    try {\n      return await this.communitiesService.getRecommendedCommunities(userId);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to get recommended communities',\n      );\n    }\n  }\n\n  @Get('activity/recent')\n  @Roles('client', 'therapist', 'moderator', 'admin')\n  async getRecentActivity(@CurrentUserId() userId: string) {\n    try {\n      return await this.communitiesService.getRecentActivity(userId);\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error ? error.message : 'Failed to get recent activity',\n      );\n    }\n  }\n}\n"],"version":3}