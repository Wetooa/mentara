81c8ac20c53447a200e10b9a9d7b8cc8
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CommunitiesController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const jwt_auth_guard_1 = require("src/auth/guards/jwt-auth.guard");
const prisma_client_provider_1 = require("src/providers/prisma-client.provider");
const communities_service_1 = require("./communities.service");
const community_assignment_service_1 = require("./community-assignment.service");
const supabase_storage_service_1 = require("src/common/services/supabase-storage.service");
const current_user_id_decorator_1 = require("src/auth/decorators/current-user-id.decorator");
const roles_decorator_1 = require("src/auth/decorators/roles.decorator");
let CommunitiesController = class CommunitiesController {
    communitiesService;
    communityAssignmentService;
    prisma;
    supabaseStorageService;
    constructor(communitiesService, communityAssignmentService, prisma, supabaseStorageService) {
        this.communitiesService = communitiesService;
        this.communityAssignmentService = communityAssignmentService;
        this.prisma = prisma;
        this.supabaseStorageService = supabaseStorageService;
    }
    // TODO: CONFUSING - Missing @Roles decorator - should this endpoint require authentication only or specific roles?
    // All authenticated users can currently access this endpoint, verify if this is intended behavior
    async findAll() {
        try {
            return await this.communitiesService.findAll();
        }
        catch (error) {
            // TODO: CONFUSING PATTERN - This generic error handling masks specific exceptions
            // Consider letting service-level exceptions bubble up for better error responses
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async getStats() {
        try {
            return await this.communitiesService.getStats();
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async findBySlug(slug) {
        try {
            const community = await this.communitiesService.findBySlug(slug);
            if (!community)
                throw new common_1.NotFoundException('Community not found');
            return community;
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async findOne(id) {
        try {
            const community = await this.communitiesService.findOne(id);
            if (!community)
                throw new common_1.NotFoundException('Community not found');
            return community;
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async getMembers(id, limit, offset) {
        try {
            const limitNum = limit ? parseInt(limit, 10) : 50;
            const offsetNum = offset ? parseInt(offset, 10) : 0;
            if (limit && isNaN(limitNum)) {
                throw new common_1.BadRequestException('Invalid limit parameter');
            }
            if (offset && isNaN(offsetNum)) {
                throw new common_1.BadRequestException('Invalid offset parameter');
            }
            return await this.communitiesService.getMembers(id, Math.max(1, Math.min(100, limitNum)), // Clamp between 1-100
            Math.max(0, offsetNum));
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async create(communityData) {
        try {
            return await this.communitiesService.createCommunity(communityData);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async update(id, communityData) {
        try {
            return await this.communitiesService.update(id, communityData);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async remove(id) {
        try {
            return await this.communitiesService.remove(id);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async joinCommunity(communityId, userId) {
        try {
            await this.communitiesService.joinCommunity(communityId, userId);
            return { joined: true };
        }
        catch (error) {
            // Re-throw known HTTP exceptions to preserve proper error responses
            if (error instanceof common_1.ConflictException ||
                error instanceof common_1.NotFoundException ||
                error instanceof common_1.BadRequestException) {
                throw error;
            }
            // Only wrap unknown errors
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to join community');
        }
    }
    async leaveCommunity(communityId, userId) {
        try {
            await this.communitiesService.leaveCommunity(communityId, userId);
            return { left: true };
        }
        catch (error) {
            // Re-throw known HTTP exceptions to preserve proper error responses
            if (error instanceof common_1.ConflictException ||
                error instanceof common_1.NotFoundException ||
                error instanceof common_1.BadRequestException) {
                throw error;
            }
            // Only wrap unknown errors
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to leave community');
        }
    }
    // TODO: SECURITY CONCERN - Missing @Roles decorator allows any authenticated user to view another user's community memberships
    // This could be a privacy issue - consider adding role restrictions or user ownership validation
    async findByUserId(userId) {
        try {
            return await this.communitiesService.findByUserId(userId);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async getAllWithStructure() {
        return await this.communitiesService.findAllWithStructure();
    }
    async getMyCommunitiesWithStructure(userId) {
        try {
            // Use existing getJoinedCommunities which already includes full structure
            return await this.communitiesService.getJoinedCommunities(userId);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to get communities with structure');
        }
    }
    async getOneWithStructure(id) {
        return await this.communitiesService.findOneWithStructure(id);
    }
    async createRoomGroup(communityId, dto) {
        return await this.communitiesService.createRoomGroup(communityId, dto.name, dto.order);
    }
    async createRoom(roomGroupId, dto) {
        return await this.communitiesService.createRoom(roomGroupId, dto.name, dto.order);
    }
    async getRoomsByGroup(roomGroupId) {
        return await this.communitiesService.findRoomsByGroup(roomGroupId);
    }
    // Community Assignment Endpoints
    async assignCommunitiesToMe(userId) {
        try {
            const assignedCommunities = await this.communityAssignmentService.assignCommunitiesToUser(userId);
            return { assignedCommunities };
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async assignCommunitiesToUser(userId) {
        try {
            const assignedCommunities = await this.communityAssignmentService.assignCommunitiesToUser(userId);
            return { assignedCommunities };
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async getMyRecommendedCommunities(userId) {
        try {
            const recommendedCommunities = await this.communityAssignmentService.getRecommendedCommunities(userId);
            return { recommendedCommunities };
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    async bulkAssignCommunities(body) {
        try {
            const results = await this.communityAssignmentService.bulkAssignCommunities(body.userIds);
            return { results };
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Unknown error');
        }
    }
    // New endpoints for community posts and content management
    async getMyMemberships(userId) {
        try {
            return await this.communitiesService.getMyMemberships(userId);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to get memberships');
        }
    }
    async getPostsByRoom(roomId, page, limit) {
        try {
            const pageNum = page ? parseInt(page, 10) : 1;
            const limitNum = limit ? parseInt(limit, 10) : 20;
            return await this.communitiesService.getPostsByRoom(roomId, Math.max(1, pageNum), Math.max(1, Math.min(50, limitNum)));
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to get posts');
        }
    }
    async createPost(postData, userId, files = []) {
        try {
            // Validate and upload files if provided
            const fileResults = [];
            if (files && files.length > 0) {
                for (const file of files) {
                    const validation = this.supabaseStorageService.validateFile(file);
                    if (!validation.isValid) {
                        throw new common_1.BadRequestException(`File validation failed: ${validation.error}`);
                    }
                }
                // Upload files to Supabase
                const uploadResults = await this.supabaseStorageService.uploadFiles(files, supabase_storage_service_1.SupabaseStorageService.getSupportedBuckets().POST_ATTACHMENTS);
                fileResults.push(...uploadResults);
            }
            return await this.communitiesService.createPost(postData.title, postData.content, postData.roomId, userId, fileResults.map((f) => f.url), fileResults.map((f) => f.filename), files.map((f) => f.size));
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to create post');
        }
    }
    async heartPost(postId, userId) {
        try {
            await this.communitiesService.heartPost(postId, userId);
            return { success: true };
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to heart post');
        }
    }
    async unheartPost(postId, userId) {
        try {
            await this.communitiesService.unheartPost(postId, userId);
            return { success: true };
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to unheart post');
        }
    }
    async getJoinedCommunities(userId) {
        try {
            return await this.communitiesService.getJoinedCommunities(userId);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to get joined communities');
        }
    }
    async getRecommendedCommunities(userId) {
        try {
            return await this.communitiesService.getRecommendedCommunities(userId);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to get recommended communities');
        }
    }
    async getRecentActivity(userId) {
        try {
            return await this.communitiesService.getRecentActivity(userId);
        }
        catch (error) {
            throw new common_1.InternalServerErrorException(error instanceof Error ? error.message : 'Failed to get recent activity');
        }
    }
};
exports.CommunitiesController = CommunitiesController;
__decorate([
    (0, common_1.Get)()
    // TODO: CONFUSING - Missing @Roles decorator - should this endpoint require authentication only or specific roles?
    // All authenticated users can currently access this endpoint, verify if this is intended behavior
    ,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], CommunitiesController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)('stats'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_f = typeof Promise !== "undefined" && Promise) === "function" ? _f : Object)
], CommunitiesController.prototype, "getStats", null);
__decorate([
    (0, common_1.Get)('slug/:slug'),
    __param(0, (0, common_1.Param)('slug')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], CommunitiesController.prototype, "findBySlug", null);
__decorate([
    (0, common_1.Get)(':id'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], CommunitiesController.prototype, "findOne", null);
__decorate([
    (0, common_1.Get)(':id/members'),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Query)('limit')),
    __param(2, (0, common_1.Query)('offset')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, String]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], CommunitiesController.prototype, "getMembers", null);
__decorate([
    (0, common_1.Post)(),
    (0, roles_decorator_1.Roles)('moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], CommunitiesController.prototype, "create", null);
__decorate([
    (0, common_1.Put)(':id'),
    (0, roles_decorator_1.Roles)('moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], CommunitiesController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)(':id'),
    (0, roles_decorator_1.Roles)('moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_m = typeof Promise !== "undefined" && Promise) === "function" ? _m : Object)
], CommunitiesController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)(':id/join'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", typeof (_o = typeof Promise !== "undefined" && Promise) === "function" ? _o : Object)
], CommunitiesController.prototype, "joinCommunity", null);
__decorate([
    (0, common_1.Post)(':id/leave'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", typeof (_p = typeof Promise !== "undefined" && Promise) === "function" ? _p : Object)
], CommunitiesController.prototype, "leaveCommunity", null);
__decorate([
    (0, common_1.Get)('user/:userId')
    // TODO: SECURITY CONCERN - Missing @Roles decorator allows any authenticated user to view another user's community memberships
    // This could be a privacy issue - consider adding role restrictions or user ownership validation
    ,
    __param(0, (0, common_1.Param)('userId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_q = typeof Promise !== "undefined" && Promise) === "function" ? _q : Object)
], CommunitiesController.prototype, "findByUserId", null);
__decorate([
    (0, common_1.Get)('with-structure'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_r = typeof Promise !== "undefined" && Promise) === "function" ? _r : Object)
], CommunitiesController.prototype, "getAllWithStructure", null);
__decorate([
    (0, common_1.Get)('me/with-structure'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_s = typeof Promise !== "undefined" && Promise) === "function" ? _s : Object)
], CommunitiesController.prototype, "getMyCommunitiesWithStructure", null);
__decorate([
    (0, common_1.Get)(':id/with-structure'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getOneWithStructure", null);
__decorate([
    (0, common_1.Post)(':id/room-group'),
    (0, roles_decorator_1.Roles)('moderator', 'admin'),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "createRoomGroup", null);
__decorate([
    (0, common_1.Post)('room-group/:roomGroupId/room'),
    (0, roles_decorator_1.Roles)('moderator', 'admin'),
    __param(0, (0, common_1.Param)('roomGroupId')),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "createRoom", null);
__decorate([
    (0, common_1.Get)('room-group/:roomGroupId/rooms'),
    __param(0, (0, common_1.Param)('roomGroupId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getRoomsByGroup", null);
__decorate([
    (0, common_1.Post)('assign/me'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_t = typeof Promise !== "undefined" && Promise) === "function" ? _t : Object)
], CommunitiesController.prototype, "assignCommunitiesToMe", null);
__decorate([
    (0, common_1.Post)('assign/:userId'),
    (0, roles_decorator_1.Roles)('admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('userId')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_u = typeof Promise !== "undefined" && Promise) === "function" ? _u : Object)
], CommunitiesController.prototype, "assignCommunitiesToUser", null);
__decorate([
    (0, common_1.Get)('recommended/me'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_v = typeof Promise !== "undefined" && Promise) === "function" ? _v : Object)
], CommunitiesController.prototype, "getMyRecommendedCommunities", null);
__decorate([
    (0, common_1.Post)('assign/bulk'),
    (0, roles_decorator_1.Roles)('admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", typeof (_w = typeof Promise !== "undefined" && Promise) === "function" ? _w : Object)
], CommunitiesController.prototype, "bulkAssignCommunities", null);
__decorate([
    (0, common_1.Get)('memberships/me'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getMyMemberships", null);
__decorate([
    (0, common_1.Get)('rooms/:roomId/posts'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    __param(0, (0, common_1.Param)('roomId')),
    __param(1, (0, common_1.Query)('page')),
    __param(2, (0, common_1.Query)('limit')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String, String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getPostsByRoom", null);
__decorate([
    (0, common_1.Post)('posts'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    (0, common_1.UseInterceptors)((0, platform_express_1.FilesInterceptor)('files', 5)) // Support up to 5 files
    ,
    __param(0, (0, common_1.Body)()),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __param(2, (0, common_1.UploadedFiles)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, Array]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "createPost", null);
__decorate([
    (0, common_1.Post)('posts/:postId/heart'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('postId')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "heartPost", null);
__decorate([
    (0, common_1.Delete)('posts/:postId/heart'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __param(0, (0, common_1.Param)('postId')),
    __param(1, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "unheartPost", null);
__decorate([
    (0, common_1.Get)('me/joined'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getJoinedCommunities", null);
__decorate([
    (0, common_1.Get)('me/recommended'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getRecommendedCommunities", null);
__decorate([
    (0, common_1.Get)('activity/recent'),
    (0, roles_decorator_1.Roles)('client', 'therapist', 'moderator', 'admin'),
    __param(0, (0, current_user_id_decorator_1.CurrentUserId)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], CommunitiesController.prototype, "getRecentActivity", null);
exports.CommunitiesController = CommunitiesController = __decorate([
    (0, common_1.Controller)('communities'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    __metadata("design:paramtypes", [typeof (_a = typeof communities_service_1.CommunitiesService !== "undefined" && communities_service_1.CommunitiesService) === "function" ? _a : Object, typeof (_b = typeof community_assignment_service_1.CommunityAssignmentService !== "undefined" && community_assignment_service_1.CommunityAssignmentService) === "function" ? _b : Object, typeof (_c = typeof prisma_client_provider_1.PrismaService !== "undefined" && prisma_client_provider_1.PrismaService) === "function" ? _c : Object, typeof (_d = typeof supabase_storage_service_1.SupabaseStorageService !== "undefined" && supabase_storage_service_1.SupabaseStorageService) === "function" ? _d : Object])
], CommunitiesController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbW11bml0aWVzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQWtCd0I7QUFDeEIsK0RBQTREO0FBQzVELG1FQUE4RDtBQUM5RCxpRkFBcUU7QUFDckUsK0RBQTJEO0FBQzNELGlGQUE0RTtBQUM1RSwyRkFHc0Q7QUFldEQsNkZBQThFO0FBQzlFLHlFQUE0RDtBQUlyRCxJQUFNLHFCQUFxQixHQUEzQixNQUFNLHFCQUFxQjtJQUViO0lBQ0E7SUFDQTtJQUNBO0lBSm5CLFlBQ21CLGtCQUFzQyxFQUN0QywwQkFBc0QsRUFDdEQsTUFBcUIsRUFDckIsc0JBQThDO1FBSDlDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsK0JBQTBCLEdBQTFCLDBCQUEwQixDQUE0QjtRQUN0RCxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3JCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7SUFDOUQsQ0FBQztJQUtFLEFBRk4sbUhBQW1IO0lBQ25ILGtHQUFrRztJQUNsRyxLQUFLLENBQUMsT0FBTztRQUNYLElBQUksQ0FBQztZQUNILE9BQU8sTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakQsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixrRkFBa0Y7WUFDbEYsaUZBQWlGO1lBQ2pGLE1BQU0sSUFBSSxxQ0FBNEIsQ0FDcEMsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUN6RCxDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7SUFHSyxBQUFOLEtBQUssQ0FBQyxRQUFRO1FBQ1osSUFBSSxDQUFDO1lBQ0gsT0FBTyxNQUFNLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNs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LGlEQUFzQixvQkFBdEIsaURBQXNCO0dBTHRELHFCQUFxQixDQTJkakMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvd2V0b29hL0RvY3VtZW50cy9jb2RlL3Byb2plY3RzL21lbnRhcmEvbWVudGFyYS1hcGkvc3JjL2NvbW11bml0aWVzL2NvbW11bml0aWVzLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQm9keSxcbiAgQ29udHJvbGxlcixcbiAgRGVsZXRlLFxuICBHZXQsXG4gIEh0dHBDb2RlLFxuICBIdHRwU3RhdHVzLFxuICBQYXJhbSxcbiAgUG9zdCxcbiAgUHV0LFxuICBRdWVyeSxcbiAgVXNlR3VhcmRzLFxuICBVc2VJbnRlcmNlcHRvcnMsXG4gIFVwbG9hZGVkRmlsZXMsXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBDb25mbGljdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgRmlsZXNJbnRlcmNlcHRvciB9IGZyb20gJ0BuZXN0anMvcGxhdGZvcm0tZXhwcmVzcyc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICdzcmMvYXV0aC9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgUHJpc21hU2VydmljZSB9IGZyb20gJ3NyYy9wcm92aWRlcnMvcHJpc21hLWNsaWVudC5wcm92aWRlcic7XG5pbXBvcnQgeyBDb21tdW5pdGllc1NlcnZpY2UgfSBmcm9tICcuL2NvbW11bml0aWVzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UgfSBmcm9tICcuL2NvbW11bml0eS1hc3NpZ25tZW50LnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgU3VwYWJhc2VTdG9yYWdlU2VydmljZSxcbiAgRmlsZVVwbG9hZFJlc3VsdCxcbn0gZnJvbSAnc3JjL2NvbW1vbi9zZXJ2aWNlcy9zdXBhYmFzZS1zdG9yYWdlLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgQ29tbXVuaXR5Q3JlYXRlSW5wdXREdG9TY2hlbWEsXG4gIENvbW11bml0eVVwZGF0ZUlucHV0RHRvU2NoZW1hLFxufSBmcm9tICcuL3ZhbGlkYXRpb24nO1xuaW1wb3J0IHR5cGUge1xuICBDb21tdW5pdHlDcmVhdGVJbnB1dER0byxcbiAgQ29tbXVuaXR5VXBkYXRlSW5wdXREdG8sXG4gIENvbW11bml0eVJlc3BvbnNlLFxuICBDb21tdW5pdHlTdGF0c1Jlc3BvbnNlLFxufSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7XG4gIENvbW11bml0eVdpdGhNZW1iZXJzUmVzcG9uc2UsXG4gIENvbW11bml0eVdpdGhSb29tR3JvdXBzUmVzcG9uc2UsXG59IGZyb20gJy4vY29tbXVuaXRpZXMuc2VydmljZSc7XG5pbXBvcnQgeyBDdXJyZW50VXNlcklkIH0gZnJvbSAnc3JjL2F1dGgvZGVjb3JhdG9ycy9jdXJyZW50LXVzZXItaWQuZGVjb3JhdG9yJztcbmltcG9ydCB7IFJvbGVzIH0gZnJvbSAnc3JjL2F1dGgvZGVjb3JhdG9ycy9yb2xlcy5kZWNvcmF0b3InO1xuXG5AQ29udHJvbGxlcignY29tbXVuaXRpZXMnKVxuQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXG5leHBvcnQgY2xhc3MgQ29tbXVuaXRpZXNDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb21tdW5pdGllc1NlcnZpY2U6IENvbW11bml0aWVzU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlOiBDb21tdW5pdHlBc3NpZ25tZW50U2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByaXNtYTogUHJpc21hU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHN1cGFiYXNlU3RvcmFnZVNlcnZpY2U6IFN1cGFiYXNlU3RvcmFnZVNlcnZpY2UsXG4gICkge31cblxuICBAR2V0KClcbiAgLy8gVE9ETzogQ09ORlVTSU5HIC0gTWlzc2luZyBAUm9sZXMgZGVjb3JhdG9yIC0gc2hvdWxkIHRoaXMgZW5kcG9pbnQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiBvbmx5IG9yIHNwZWNpZmljIHJvbGVzP1xuICAvLyBBbGwgYXV0aGVudGljYXRlZCB1c2VycyBjYW4gY3VycmVudGx5IGFjY2VzcyB0aGlzIGVuZHBvaW50LCB2ZXJpZnkgaWYgdGhpcyBpcyBpbnRlbmRlZCBiZWhhdmlvclxuICBhc3luYyBmaW5kQWxsKCk6IFByb21pc2U8Q29tbXVuaXR5UmVzcG9uc2VbXT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZmluZEFsbCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBUT0RPOiBDT05GVVNJTkcgUEFUVEVSTiAtIFRoaXMgZ2VuZXJpYyBlcnJvciBoYW5kbGluZyBtYXNrcyBzcGVjaWZpYyBleGNlcHRpb25zXG4gICAgICAvLyBDb25zaWRlciBsZXR0aW5nIHNlcnZpY2UtbGV2ZWwgZXhjZXB0aW9ucyBidWJibGUgdXAgZm9yIGJldHRlciBlcnJvciByZXNwb25zZXNcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnc3RhdHMnKVxuICBhc3luYyBnZXRTdGF0cygpOiBQcm9taXNlPENvbW11bml0eVN0YXRzUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbXVuaXRpZXNTZXJ2aWNlLmdldFN0YXRzKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnc2x1Zy86c2x1ZycpXG4gIGFzeW5jIGZpbmRCeVNsdWcoQFBhcmFtKCdzbHVnJykgc2x1Zzogc3RyaW5nKTogUHJvbWlzZTxDb21tdW5pdHlSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb21tdW5pdHkgPSBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5maW5kQnlTbHVnKHNsdWcpO1xuICAgICAgaWYgKCFjb21tdW5pdHkpIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ29tbXVuaXR5IG5vdCBmb3VuZCcpO1xuICAgICAgcmV0dXJuIGNvbW11bml0eTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAR2V0KCc6aWQnKVxuICBhc3luYyBmaW5kT25lKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nKTogUHJvbWlzZTxDb21tdW5pdHlSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb21tdW5pdHkgPSBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5maW5kT25lKGlkKTtcbiAgICAgIGlmICghY29tbXVuaXR5KSB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0NvbW11bml0eSBub3QgZm91bmQnKTtcbiAgICAgIHJldHVybiBjb21tdW5pdHk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnOmlkL21lbWJlcnMnKVxuICBhc3luYyBnZXRNZW1iZXJzKFxuICAgIEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nLFxuICAgIEBRdWVyeSgnbGltaXQnKSBsaW1pdD86IHN0cmluZyxcbiAgICBAUXVlcnkoJ29mZnNldCcpIG9mZnNldD86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxDb21tdW5pdHlXaXRoTWVtYmVyc1Jlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGxpbWl0TnVtID0gbGltaXQgPyBwYXJzZUludChsaW1pdCwgMTApIDogNTA7XG4gICAgICBjb25zdCBvZmZzZXROdW0gPSBvZmZzZXQgPyBwYXJzZUludChvZmZzZXQsIDEwKSA6IDA7XG5cbiAgICAgIGlmIChsaW1pdCAmJiBpc05hTihsaW1pdE51bSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ludmFsaWQgbGltaXQgcGFyYW1ldGVyJyk7XG4gICAgICB9XG4gICAgICBpZiAob2Zmc2V0ICYmIGlzTmFOKG9mZnNldE51bSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ludmFsaWQgb2Zmc2V0IHBhcmFtZXRlcicpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZ2V0TWVtYmVycyhcbiAgICAgICAgaWQsXG4gICAgICAgIE1hdGgubWF4KDEsIE1hdGgubWluKDEwMCwgbGltaXROdW0pKSwgLy8gQ2xhbXAgYmV0d2VlbiAxLTEwMFxuICAgICAgICBNYXRoLm1heCgwLCBvZmZzZXROdW0pLCAvLyBFbnN1cmUgbm9uLW5lZ2F0aXZlXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBQb3N0KClcbiAgQFJvbGVzKCdtb2RlcmF0b3InLCAnYWRtaW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5DUkVBVEVEKVxuICBhc3luYyBjcmVhdGUoXG4gICAgQEJvZHkoKSBjb21tdW5pdHlEYXRhOiBDb21tdW5pdHlDcmVhdGVJbnB1dER0byxcbiAgKTogUHJvbWlzZTxDb21tdW5pdHlSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuY3JlYXRlQ29tbXVuaXR5KGNvbW11bml0eURhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBQdXQoJzppZCcpXG4gIEBSb2xlcygnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZyxcbiAgICBAQm9keSgpIGNvbW11bml0eURhdGE6IENvbW11bml0eVVwZGF0ZUlucHV0RHRvLFxuICApOiBQcm9taXNlPENvbW11bml0eVJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS51cGRhdGUoaWQsIGNvbW11bml0eURhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBEZWxldGUoJzppZCcpXG4gIEBSb2xlcygnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIHJlbW92ZShAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZyk6IFByb21pc2U8Q29tbXVuaXR5UmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbXVuaXRpZXNTZXJ2aWNlLnJlbW92ZShpZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQFBvc3QoJzppZC9qb2luJylcbiAgQFJvbGVzKCdjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBhc3luYyBqb2luQ29tbXVuaXR5KFxuICAgIEBQYXJhbSgnaWQnKSBjb21tdW5pdHlJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBqb2luZWQ6IGJvb2xlYW4gfT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5qb2luQ29tbXVuaXR5KGNvbW11bml0eUlkLCB1c2VySWQpO1xuICAgICAgcmV0dXJuIHsgam9pbmVkOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIFJlLXRocm93IGtub3duIEhUVFAgZXhjZXB0aW9ucyB0byBwcmVzZXJ2ZSBwcm9wZXIgZXJyb3IgcmVzcG9uc2VzXG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgQ29uZmxpY3RFeGNlcHRpb24gfHxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbiB8fFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEJhZFJlcXVlc3RFeGNlcHRpb25cbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgLy8gT25seSB3cmFwIHVua25vd24gZXJyb3JzXG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGpvaW4gY29tbXVuaXR5JyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQFBvc3QoJzppZC9sZWF2ZScpXG4gIEBSb2xlcygnY2xpZW50JywgJ3RoZXJhcGlzdCcsICdtb2RlcmF0b3InLCAnYWRtaW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgbGVhdmVDb21tdW5pdHkoXG4gICAgQFBhcmFtKCdpZCcpIGNvbW11bml0eUlkOiBzdHJpbmcsXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IGxlZnQ6IGJvb2xlYW4gfT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5sZWF2ZUNvbW11bml0eShjb21tdW5pdHlJZCwgdXNlcklkKTtcbiAgICAgIHJldHVybiB7IGxlZnQ6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gUmUtdGhyb3cga25vd24gSFRUUCBleGNlcHRpb25zIHRvIHByZXNlcnZlIHByb3BlciBlcnJvciByZXNwb25zZXNcbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBDb25mbGljdEV4Y2VwdGlvbiB8fFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgQmFkUmVxdWVzdEV4Y2VwdGlvblxuICAgICAgKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IHdyYXAgdW5rbm93biBlcnJvcnNcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gbGVhdmUgY29tbXVuaXR5JyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgndXNlci86dXNlcklkJylcbiAgLy8gVE9ETzogU0VDVVJJVFkgQ09OQ0VSTiAtIE1pc3NpbmcgQFJvbGVzIGRlY29yYXRvciBhbGxvd3MgYW55IGF1dGhlbnRpY2F0ZWQgdXNlciB0byB2aWV3IGFub3RoZXIgdXNlcidzIGNvbW11bml0eSBtZW1iZXJzaGlwc1xuICAvLyBUaGlzIGNvdWxkIGJlIGEgcHJpdmFjeSBpc3N1ZSAtIGNvbnNpZGVyIGFkZGluZyByb2xlIHJlc3RyaWN0aW9ucyBvciB1c2VyIG93bmVyc2hpcCB2YWxpZGF0aW9uXG4gIGFzeW5jIGZpbmRCeVVzZXJJZChcbiAgICBAUGFyYW0oJ3VzZXJJZCcpIHVzZXJJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPENvbW11bml0eVJlc3BvbnNlW10+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbXVuaXRpZXNTZXJ2aWNlLmZpbmRCeVVzZXJJZCh1c2VySWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ3dpdGgtc3RydWN0dXJlJylcbiAgYXN5bmMgZ2V0QWxsV2l0aFN0cnVjdHVyZSgpOiBQcm9taXNlPENvbW11bml0eVdpdGhSb29tR3JvdXBzUmVzcG9uc2VbXT4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5maW5kQWxsV2l0aFN0cnVjdHVyZSgpO1xuICB9XG5cbiAgQEdldCgnbWUvd2l0aC1zdHJ1Y3R1cmUnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgYXN5bmMgZ2V0TXlDb21tdW5pdGllc1dpdGhTdHJ1Y3R1cmUoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8Q29tbXVuaXR5V2l0aFJvb21Hcm91cHNSZXNwb25zZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBleGlzdGluZyBnZXRKb2luZWRDb21tdW5pdGllcyB3aGljaCBhbHJlYWR5IGluY2x1ZGVzIGZ1bGwgc3RydWN0dXJlXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZ2V0Sm9pbmVkQ29tbXVuaXRpZXModXNlcklkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgY29tbXVuaXRpZXMgd2l0aCBzdHJ1Y3R1cmUnLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAR2V0KCc6aWQvd2l0aC1zdHJ1Y3R1cmUnKVxuICBhc3luYyBnZXRPbmVXaXRoU3RydWN0dXJlKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbXVuaXRpZXNTZXJ2aWNlLmZpbmRPbmVXaXRoU3RydWN0dXJlKGlkKTtcbiAgfVxuXG4gIEBQb3N0KCc6aWQvcm9vbS1ncm91cCcpXG4gIEBSb2xlcygnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgYXN5bmMgY3JlYXRlUm9vbUdyb3VwKFxuICAgIEBQYXJhbSgnaWQnKSBjb21tdW5pdHlJZDogc3RyaW5nLFxuICAgIEBCb2R5KCkgZHRvOiB7IG5hbWU6IHN0cmluZzsgb3JkZXI6IG51bWJlciB9LFxuICApIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuY3JlYXRlUm9vbUdyb3VwKFxuICAgICAgY29tbXVuaXR5SWQsXG4gICAgICBkdG8ubmFtZSxcbiAgICAgIGR0by5vcmRlcixcbiAgICApO1xuICB9XG5cbiAgQFBvc3QoJ3Jvb20tZ3JvdXAvOnJvb21Hcm91cElkL3Jvb20nKVxuICBAUm9sZXMoJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIGFzeW5jIGNyZWF0ZVJvb20oXG4gICAgQFBhcmFtKCdyb29tR3JvdXBJZCcpIHJvb21Hcm91cElkOiBzdHJpbmcsXG4gICAgQEJvZHkoKSBkdG86IHsgbmFtZTogc3RyaW5nOyBvcmRlcjogbnVtYmVyIH0sXG4gICkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5jcmVhdGVSb29tKFxuICAgICAgcm9vbUdyb3VwSWQsXG4gICAgICBkdG8ubmFtZSxcbiAgICAgIGR0by5vcmRlcixcbiAgICApO1xuICB9XG5cbiAgQEdldCgncm9vbS1ncm91cC86cm9vbUdyb3VwSWQvcm9vbXMnKVxuICBhc3luYyBnZXRSb29tc0J5R3JvdXAoQFBhcmFtKCdyb29tR3JvdXBJZCcpIHJvb21Hcm91cElkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZmluZFJvb21zQnlHcm91cChyb29tR3JvdXBJZCk7XG4gIH1cblxuICAvLyBDb21tdW5pdHkgQXNzaWdubWVudCBFbmRwb2ludHNcbiAgQFBvc3QoJ2Fzc2lnbi9tZScpXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBhc3luYyBhc3NpZ25Db21tdW5pdGllc1RvTWUoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IGFzc2lnbmVkQ29tbXVuaXRpZXM6IHN0cmluZ1tdIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYXNzaWduZWRDb21tdW5pdGllcyA9XG4gICAgICAgIGF3YWl0IHRoaXMuY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UuYXNzaWduQ29tbXVuaXRpZXNUb1VzZXIodXNlcklkKTtcbiAgICAgIHJldHVybiB7IGFzc2lnbmVkQ29tbXVuaXRpZXMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAUG9zdCgnYXNzaWduLzp1c2VySWQnKVxuICBAUm9sZXMoJ2FkbWluJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIGFzc2lnbkNvbW11bml0aWVzVG9Vc2VyKFxuICAgIEBQYXJhbSgndXNlcklkJykgdXNlcklkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8eyBhc3NpZ25lZENvbW11bml0aWVzOiBzdHJpbmdbXSB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFzc2lnbmVkQ29tbXVuaXRpZXMgPVxuICAgICAgICBhd2FpdCB0aGlzLmNvbW11bml0eUFzc2lnbm1lbnRTZXJ2aWNlLmFzc2lnbkNvbW11bml0aWVzVG9Vc2VyKHVzZXJJZCk7XG4gICAgICByZXR1cm4geyBhc3NpZ25lZENvbW11bml0aWVzIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgncmVjb21tZW5kZWQvbWUnKVxuICBhc3luYyBnZXRNeVJlY29tbWVuZGVkQ29tbXVuaXRpZXMoXG4gICAgQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IHJlY29tbWVuZGVkQ29tbXVuaXRpZXM6IHN0cmluZ1tdIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVjb21tZW5kZWRDb21tdW5pdGllcyA9XG4gICAgICAgIGF3YWl0IHRoaXMuY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UuZ2V0UmVjb21tZW5kZWRDb21tdW5pdGllcyh1c2VySWQpO1xuICAgICAgcmV0dXJuIHsgcmVjb21tZW5kZWRDb21tdW5pdGllcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBQb3N0KCdhc3NpZ24vYnVsaycpXG4gIEBSb2xlcygnYWRtaW4nKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgYXN5bmMgYnVsa0Fzc2lnbkNvbW11bml0aWVzKFxuICAgIEBCb2R5KCkgYm9keTogeyB1c2VySWRzOiBzdHJpbmdbXSB9LFxuICApOiBQcm9taXNlPHsgcmVzdWx0czogeyBbdXNlcklkOiBzdHJpbmddOiBzdHJpbmdbXSB9IH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9XG4gICAgICAgIGF3YWl0IHRoaXMuY29tbXVuaXR5QXNzaWdubWVudFNlcnZpY2UuYnVsa0Fzc2lnbkNvbW11bml0aWVzKFxuICAgICAgICAgIGJvZHkudXNlcklkcyxcbiAgICAgICAgKTtcbiAgICAgIHJldHVybiB7IHJlc3VsdHMgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvLyBOZXcgZW5kcG9pbnRzIGZvciBjb21tdW5pdHkgcG9zdHMgYW5kIGNvbnRlbnQgbWFuYWdlbWVudFxuXG4gIEBHZXQoJ21lbWJlcnNoaXBzL21lJylcbiAgQFJvbGVzKCdjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIGFzeW5jIGdldE15TWVtYmVyc2hpcHMoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZ2V0TXlNZW1iZXJzaGlwcyh1c2VySWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCBtZW1iZXJzaGlwcycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ3Jvb21zLzpyb29tSWQvcG9zdHMnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgYXN5bmMgZ2V0UG9zdHNCeVJvb20oXG4gICAgQFBhcmFtKCdyb29tSWQnKSByb29tSWQ6IHN0cmluZyxcbiAgICBAUXVlcnkoJ3BhZ2UnKSBwYWdlPzogc3RyaW5nLFxuICAgIEBRdWVyeSgnbGltaXQnKSBsaW1pdD86IHN0cmluZyxcbiAgKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhZ2VOdW0gPSBwYWdlID8gcGFyc2VJbnQocGFnZSwgMTApIDogMTtcbiAgICAgIGNvbnN0IGxpbWl0TnVtID0gbGltaXQgPyBwYXJzZUludChsaW1pdCwgMTApIDogMjA7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZ2V0UG9zdHNCeVJvb20oXG4gICAgICAgIHJvb21JZCxcbiAgICAgICAgTWF0aC5tYXgoMSwgcGFnZU51bSksXG4gICAgICAgIE1hdGgubWF4KDEsIE1hdGgubWluKDUwLCBsaW1pdE51bSkpLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBnZXQgcG9zdHMnLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBAUG9zdCgncG9zdHMnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuQ1JFQVRFRClcbiAgQFVzZUludGVyY2VwdG9ycyhGaWxlc0ludGVyY2VwdG9yKCdmaWxlcycsIDUpKSAvLyBTdXBwb3J0IHVwIHRvIDUgZmlsZXNcbiAgYXN5bmMgY3JlYXRlUG9zdChcbiAgICBAQm9keSgpIHBvc3REYXRhOiB7IHRpdGxlOiBzdHJpbmc7IGNvbnRlbnQ6IHN0cmluZzsgcm9vbUlkOiBzdHJpbmcgfSxcbiAgICBAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nLFxuICAgIEBVcGxvYWRlZEZpbGVzKCkgZmlsZXM6IEV4cHJlc3MuTXVsdGVyLkZpbGVbXSA9IFtdLCAvLyBPcHRpb25hbCBmaWxlc1xuICApIHtcbiAgICB0cnkge1xuICAgICAgLy8gVmFsaWRhdGUgYW5kIHVwbG9hZCBmaWxlcyBpZiBwcm92aWRlZFxuICAgICAgY29uc3QgZmlsZVJlc3VsdHM6IEZpbGVVcGxvYWRSZXN1bHRbXSA9IFtdO1xuICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMuc3VwYWJhc2VTdG9yYWdlU2VydmljZS52YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgICAgICAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICAgICAgICBgRmlsZSB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uLmVycm9yfWAsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwbG9hZCBmaWxlcyB0byBTdXBhYmFzZVxuICAgICAgICBjb25zdCB1cGxvYWRSZXN1bHRzID0gYXdhaXQgdGhpcy5zdXBhYmFzZVN0b3JhZ2VTZXJ2aWNlLnVwbG9hZEZpbGVzKFxuICAgICAgICAgIGZpbGVzLFxuICAgICAgICAgIFN1cGFiYXNlU3RvcmFnZVNlcnZpY2UuZ2V0U3VwcG9ydGVkQnVja2V0cygpLlBPU1RfQVRUQUNITUVOVFMsXG4gICAgICAgICk7XG4gICAgICAgIGZpbGVSZXN1bHRzLnB1c2goLi4udXBsb2FkUmVzdWx0cyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5jcmVhdGVQb3N0KFxuICAgICAgICBwb3N0RGF0YS50aXRsZSxcbiAgICAgICAgcG9zdERhdGEuY29udGVudCxcbiAgICAgICAgcG9zdERhdGEucm9vbUlkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGZpbGVSZXN1bHRzLm1hcCgoZikgPT4gZi51cmwpLFxuICAgICAgICBmaWxlUmVzdWx0cy5tYXAoKGYpID0+IGYuZmlsZW5hbWUpLFxuICAgICAgICBmaWxlcy5tYXAoKGYpID0+IGYuc2l6ZSksXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBwb3N0JyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQFBvc3QoJ3Bvc3RzLzpwb3N0SWQvaGVhcnQnKVxuICBAUm9sZXMoJ2NsaWVudCcsICd0aGVyYXBpc3QnLCAnbW9kZXJhdG9yJywgJ2FkbWluJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGFzeW5jIGhlYXJ0UG9zdChcbiAgICBAUGFyYW0oJ3Bvc3RJZCcpIHBvc3RJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5oZWFydFBvc3QocG9zdElkLCB1c2VySWQpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGhlYXJ0IHBvc3QnLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBARGVsZXRlKCdwb3N0cy86cG9zdElkL2hlYXJ0JylcbiAgQFJvbGVzKCdjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBhc3luYyB1bmhlYXJ0UG9zdChcbiAgICBAUGFyYW0oJ3Bvc3RJZCcpIHBvc3RJZDogc3RyaW5nLFxuICAgIEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcsXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS51bmhlYXJ0UG9zdChwb3N0SWQsIHVzZXJJZCk7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gdW5oZWFydCBwb3N0JyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQEdldCgnbWUvam9pbmVkJylcbiAgQFJvbGVzKCdjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIGFzeW5jIGdldEpvaW5lZENvbW11bml0aWVzKEBDdXJyZW50VXNlcklkKCkgdXNlcklkOiBzdHJpbmcpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tbXVuaXRpZXNTZXJ2aWNlLmdldEpvaW5lZENvbW11bml0aWVzKHVzZXJJZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZ2V0IGpvaW5lZCBjb21tdW5pdGllcycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ21lL3JlY29tbWVuZGVkJylcbiAgQFJvbGVzKCdjbGllbnQnLCAndGhlcmFwaXN0JywgJ21vZGVyYXRvcicsICdhZG1pbicpXG4gIGFzeW5jIGdldFJlY29tbWVuZGVkQ29tbXVuaXRpZXMoQEN1cnJlbnRVc2VySWQoKSB1c2VySWQ6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb21tdW5pdGllc1NlcnZpY2UuZ2V0UmVjb21tZW5kZWRDb21tdW5pdGllcyh1c2VySWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCByZWNvbW1lbmRlZCBjb21tdW5pdGllcycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIEBHZXQoJ2FjdGl2aXR5L3JlY2VudCcpXG4gIEBSb2xlcygnY2xpZW50JywgJ3RoZXJhcGlzdCcsICdtb2RlcmF0b3InLCAnYWRtaW4nKVxuICBhc3luYyBnZXRSZWNlbnRBY3Rpdml0eShAQ3VycmVudFVzZXJJZCgpIHVzZXJJZDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbW11bml0aWVzU2VydmljZS5nZXRSZWNlbnRBY3Rpdml0eSh1c2VySWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGdldCByZWNlbnQgYWN0aXZpdHknLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==