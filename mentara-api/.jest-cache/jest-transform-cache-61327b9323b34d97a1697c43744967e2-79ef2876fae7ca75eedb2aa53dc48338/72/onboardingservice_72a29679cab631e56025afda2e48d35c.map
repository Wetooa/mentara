{"version":3,"names":["cov_xxrumgyqf","actualCoverage","common_1","s","require","prisma_client_provider_1","OnboardingService","OnboardingService_1","prisma","logger","Logger","name","constructor","f","getRequiredStepsForRole","role","baseSteps","b","getOnboardingStatus","userId","user","findUnique","where","id","include","client","preAssessment","memberships","therapist","admin","moderator","NotFoundException","requiredSteps","steps","stepName","stepStatus","checkStepCompletion","push","step","completed","completedAt","required","completedSteps","filter","length","overallProgress","Math","round","isComplete","nextStep","find","error","hasBasicInfo","firstName","lastName","email","updatedAt","undefined","emailVerified","hasPreAssessment","createdAt","hasCommunityMemberships","joinedAt","hasVerifiedLicense","licenseVerified","licenseVerifiedAt","hasCompleteProfile","areasOfExpertise","therapeuticApproachesUsedList","hasAvailability","therapistAvailability","findFirst","therapistId","markStepCompleted","log","Date","toISOString","validateOnboardingCompleteness","status","missingSteps","map","canProceed","getOnboardingInsights","allUsers","findMany","totalProgress","completeCount","stepCompletionCounts","averageProgress","commonDropoffSteps","Object","entries","sort","a","slice","totalUsers","completeOnboarding","incompleteOnboarding","exports","__decorate","Injectable","PrismaService","_a"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/onboarding/onboarding.service.ts"],"sourcesContent":["import { Injectable, Logger, NotFoundException } from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\n\nexport interface OnboardingStep {\n  step: string;\n  completed: boolean;\n  completedAt?: Date;\n  required: boolean;\n}\n\nexport interface OnboardingStatus {\n  userId: string;\n  role: string;\n  overallProgress: number;\n  steps: OnboardingStep[];\n  isComplete: boolean;\n  nextStep?: string;\n}\n\n@Injectable()\nexport class OnboardingService {\n  private readonly logger = new Logger(OnboardingService.name);\n\n  constructor(private readonly prisma: PrismaService) {}\n\n  private getRequiredStepsForRole(role: string): string[] {\n    const baseSteps = ['profile_setup', 'email_verification'];\n\n    switch (role) {\n      case 'client':\n        return [...baseSteps, 'pre_assessment', 'community_assignment'];\n      case 'therapist':\n        return [\n          ...baseSteps,\n          'license_verification',\n          'profile_completion',\n          'availability_setup',\n        ];\n      case 'admin':\n        return [...baseSteps, 'admin_training'];\n      case 'moderator':\n        return [...baseSteps, 'moderation_training', 'community_assignment'];\n      default:\n        return baseSteps;\n    }\n  }\n\n  async getOnboardingStatus(userId: string): Promise<OnboardingStatus> {\n    try {\n      const user = await this.prisma.user.findUnique({\n        where: { id: userId },\n        include: {\n          client: {\n            include: {\n              preAssessment: true,\n            },\n          },\n          memberships: true,\n          therapist: true,\n          admin: true,\n          moderator: true,\n        },\n      });\n\n      if (!user) {\n        throw new NotFoundException('User not found');\n      }\n\n      const requiredSteps = this.getRequiredStepsForRole(user.role);\n      const steps: OnboardingStep[] = [];\n\n      // Check each required step\n      for (const stepName of requiredSteps) {\n        const stepStatus = await this.checkStepCompletion(user, stepName);\n        steps.push({\n          step: stepName,\n          completed: stepStatus.completed,\n          completedAt: stepStatus.completedAt,\n          required: true,\n        });\n      }\n\n      const completedSteps = steps.filter((s) => s.completed).length;\n      const overallProgress = Math.round((completedSteps / steps.length) * 100);\n      const isComplete = completedSteps === steps.length;\n      const nextStep = steps.find((s) => !s.completed)?.step;\n\n      return {\n        userId,\n        role: user.role,\n        overallProgress,\n        steps,\n        isComplete,\n        nextStep,\n      };\n    } catch (error) {\n      this.logger.error(\n        `Failed to get onboarding status for user ${userId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  private async checkStepCompletion(\n    user: any,\n    stepName: string,\n  ): Promise<{ completed: boolean; completedAt?: Date }> {\n    switch (stepName) {\n      case 'profile_setup': {\n        const hasBasicInfo = user.firstName && user.lastName && user.email;\n        return {\n          completed: hasBasicInfo,\n          completedAt: hasBasicInfo ? user.updatedAt : undefined,\n        };\n      }\n\n      case 'email_verification': {\n        return {\n          completed: user.emailVerified,\n          completedAt: user.emailVerified ? user.updatedAt : undefined,\n        };\n      }\n\n      case 'pre_assessment': {\n        const hasPreAssessment = user.client?.preAssessment;\n        return {\n          completed: !!hasPreAssessment,\n          completedAt: hasPreAssessment\n            ? user.client.preAssessment.createdAt\n            : undefined,\n        };\n      }\n\n      case 'community_assignment': {\n        const hasCommunityMemberships = user.memberships?.length > 0;\n        return {\n          completed: hasCommunityMemberships,\n          completedAt: hasCommunityMemberships\n            ? user.memberships[0].joinedAt\n            : undefined,\n        };\n      }\n\n      case 'license_verification': {\n        const hasVerifiedLicense = user.therapist?.licenseVerified;\n        return {\n          completed: !!hasVerifiedLicense,\n          completedAt: hasVerifiedLicense\n            ? user.therapist.licenseVerifiedAt\n            : undefined,\n        };\n      }\n\n      case 'profile_completion': {\n        const hasCompleteProfile =\n          user.therapist &&\n          user.therapist.areasOfExpertise?.length > 0 &&\n          user.therapist.therapeuticApproachesUsedList?.length > 0;\n        return {\n          completed: !!hasCompleteProfile,\n          completedAt: hasCompleteProfile\n            ? user.therapist.updatedAt\n            : undefined,\n        };\n      }\n\n      case 'availability_setup': {\n        const hasAvailability =\n          await this.prisma.therapistAvailability.findFirst({\n            where: { therapistId: user.id },\n          });\n        return {\n          completed: !!hasAvailability,\n          completedAt: hasAvailability ? hasAvailability.createdAt : undefined,\n        };\n      }\n\n      case 'admin_training': {\n        // For now, assume admin training is complete if they have admin permissions\n        return {\n          completed: !!user.admin,\n          completedAt: user.admin ? user.admin.createdAt : undefined,\n        };\n      }\n\n      case 'moderation_training': {\n        // For now, assume moderation training is complete if they have moderator permissions\n        return {\n          completed: !!user.moderator,\n          completedAt: user.moderator ? user.moderator.createdAt : undefined,\n        };\n      }\n\n      default:\n        return { completed: false };\n    }\n  }\n\n  async markStepCompleted(\n    userId: string,\n    stepName: string,\n  ): Promise<OnboardingStatus> {\n    try {\n      // In a real implementation, you might want to validate that the step is actually completed\n      // before marking it as such. For now, we'll just recalculate the status.\n\n      this.logger.log(\n        `Marking step ${stepName} as completed for user ${userId}`,\n      );\n\n      // Log onboarding step completion (alternative to audit log)\n      this.logger.log(\n        `Onboarding step completed - userId: ${userId}, step: ${stepName}, timestamp: ${new Date().toISOString()}`,\n        'OnboardingAudit'\n      );\n\n      return await this.getOnboardingStatus(userId);\n    } catch (error) {\n      this.logger.error(\n        `Failed to mark step ${stepName} as completed for user ${userId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  async validateOnboardingCompleteness(userId: string): Promise<{\n    isComplete: boolean;\n    missingSteps: string[];\n    canProceed: boolean;\n  }> {\n    try {\n      const status = await this.getOnboardingStatus(userId);\n      const missingSteps = status.steps\n        .filter((step) => step.required && !step.completed)\n        .map((step) => step.step);\n\n      const canProceed = status.overallProgress >= 80; // Allow some flexibility\n\n      return {\n        isComplete: status.isComplete,\n        missingSteps,\n        canProceed,\n      };\n    } catch (error) {\n      this.logger.error(\n        `Failed to validate onboarding completeness for user ${userId}:`,\n        error,\n      );\n      throw error;\n    }\n  }\n\n  async getOnboardingInsights(): Promise<{\n    totalUsers: number;\n    completeOnboarding: number;\n    incompleteOnboarding: number;\n    averageProgress: number;\n    commonDropoffSteps: string[];\n  }> {\n    try {\n      const allUsers = await this.prisma.user.findMany({\n        include: {\n          client: {\n            include: {\n              preAssessment: true,\n            },\n          },\n          memberships: true,\n          therapist: true,\n          admin: true,\n          moderator: true,\n        },\n      });\n\n      let totalProgress = 0;\n      let completeCount = 0;\n      const stepCompletionCounts: Record<string, number> = {};\n\n      for (const user of allUsers) {\n        const status = await this.getOnboardingStatus(user.id);\n        totalProgress += status.overallProgress;\n\n        if (status.isComplete) {\n          completeCount++;\n        }\n\n        // Track step completion for dropout analysis\n        for (const step of status.steps) {\n          if (!stepCompletionCounts[step.step]) {\n            stepCompletionCounts[step.step] = 0;\n          }\n          if (step.completed) {\n            stepCompletionCounts[step.step]++;\n          }\n        }\n      }\n\n      const averageProgress =\n        allUsers.length > 0 ? totalProgress / allUsers.length : 0;\n\n      // Find steps with lowest completion rates (potential dropoff points)\n      const commonDropoffSteps = Object.entries(stepCompletionCounts)\n        .sort(([, a], [, b]) => a - b)\n        .slice(0, 3)\n        .map(([step]) => step);\n\n      return {\n        totalUsers: allUsers.length,\n        completeOnboarding: completeCount,\n        incompleteOnboarding: allUsers.length - completeCount,\n        averageProgress,\n        commonDropoffSteps,\n      };\n    } catch (error) {\n      this.logger.error('Failed to get onboarding insights:', error);\n      throw error;\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}