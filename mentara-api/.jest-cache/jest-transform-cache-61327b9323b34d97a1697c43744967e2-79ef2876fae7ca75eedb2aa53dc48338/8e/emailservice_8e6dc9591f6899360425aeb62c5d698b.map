{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/services/email.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/services/email.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\n\nexport interface EmailNotificationData {\n  to: string;\n  name: string;\n  status: 'approved' | 'rejected';\n  adminNotes?: string;\n  credentials?: {\n    email: string;\n    password: string;\n  };\n}\n\n@Injectable()\nexport class EmailService {\n  /**\n   * Send therapist application status notification\n   * This is a placeholder that will trigger the client-side EmailJS service\n   * In a production environment, you might want to use a server-side email service\n   *\n   * @param data Email notification data\n   * @returns Promise with operation result\n   */\n  sendTherapistApplicationNotification(data: EmailNotificationData): {\n    success: boolean;\n    message: string;\n  } {\n    try {\n      console.log('Email notification requested:', {\n        recipient: data.to,\n        status: data.status,\n        hasCredentials: !!data.credentials,\n      });\n\n      const emailContent = this.generateEmailContent(data);\n\n      console.log('Generated email content:', emailContent);\n\n      // In production, integrate with email service\n      // For now, this simulates successful email delivery\n      const result = this.sendEmail(emailContent, data.to);\n\n      if (result.success) {\n        console.log(`‚úÖ Email sent successfully to ${data.to}`);\n        return {\n          success: true,\n          message: `Email notification sent to ${data.to}`,\n        };\n      } else {\n        console.error(`‚ùå Failed to send email to ${data.to}: ${result.error}`);\n        return {\n          success: false,\n          message: `Failed to send email: ${result.error}`,\n        };\n      }\n    } catch (error) {\n      console.error('Failed to send email notification:', error);\n      return {\n        success: false,\n        message:\n          error instanceof Error\n            ? error.message\n            : 'Failed to send notification',\n      };\n    }\n  }\n\n  /**\n   * Generate email content based on application status\n   * @param data Email notification data\n   * @returns Formatted email content\n   */\n  private generateEmailContent(data: EmailNotificationData) {\n    const { name, status, adminNotes, credentials } = data;\n\n    const baseContent = {\n      subject: `Mentara Therapist Application ${status === 'approved' ? 'Approved' : 'Update'}`,\n      greeting: `Dear ${name},`,\n      companySignature: 'Best regards,\\nThe Mentara Team\\nsupport@mentara.com',\n    };\n\n    if (status === 'approved') {\n      return {\n        ...baseContent,\n        body: [\n          'Congratulations! Your therapist application has been approved.',\n          '',\n          'You can now start providing therapy services through the Mentara platform.',\n          '',\n          ...(credentials\n            ? [\n                'Your account credentials:',\n                `Email: ${credentials.email}`,\n                `Temporary Password: ${credentials.password}`,\n                '',\n                'Please log in and change your password immediately.',\n                'You can access your therapist dashboard at: https://mentara.com/therapist',\n                '',\n              ]\n            : []),\n          ...(adminNotes\n            ? ['Additional notes from our team:', adminNotes, '']\n            : []),\n          'Welcome to the Mentara therapist network!',\n        ].join('\\n'),\n      };\n    } else {\n      return {\n        ...baseContent,\n        body: [\n          'Thank you for your interest in joining the Mentara therapist network.',\n          '',\n          'After careful review, we have decided not to approve your application at this time.',\n          '',\n          ...(adminNotes\n            ? ['Feedback from our review team:', adminNotes, '']\n            : []),\n          'We encourage you to address any concerns mentioned above and reapply in the future.',\n          '',\n          \"If you have any questions, please don't hesitate to contact our support team.\",\n        ].join('\\n'),\n      };\n    }\n  }\n\n  /**\n   * Send email using configured email service\n   * @param emailContent Generated email content\n   * @param recipient Email recipient\n   * @returns Send result\n   */\n  private sendEmail(\n    emailContent: any,\n    recipient: string,\n  ): { success: boolean; error?: string } {\n    try {\n      // Simulate email sending for development\n      // In production, replace with actual email service integration:\n      // - Nodemailer with SMTP\n      // - SendGrid API\n      // - AWS SES\n      // - Postmark\n      // - Or webhook to frontend EmailJS\n\n      console.log(`üìß Sending email to: ${recipient}`);\n      console.log(`üìß Subject: ${emailContent.subject}`);\n      console.log(\n        `üìß Content preview: ${emailContent.body.substring(0, 100)}...`,\n      );\n\n      // Simulate network delay and potential failures\n      const random = Math.random();\n\n      if (random < 0.05) {\n        // 5% failure rate for testing\n        return {\n          success: false,\n          error: 'Email service temporarily unavailable',\n        };\n      }\n\n      if (random < 0.1) {\n        // 5% invalid email simulation\n        return {\n          success: false,\n          error: 'Invalid email address format',\n        };\n      }\n\n      // Simulate successful email delivery\n      return {\n        success: true,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown email error',\n      };\n    }\n  }\n\n  /**\n   * Send welcome email to new therapists\n   * @param therapistEmail Therapist email address\n   * @param therapistName Therapist name\n   * @param credentials Login credentials\n   * @returns Promise with operation result\n   */\n  async sendTherapistWelcomeEmail(\n    therapistEmail: string,\n    therapistName: string,\n    credentials: { email: string; password: string },\n  ): Promise<{ success: boolean; message: string }> {\n    return this.sendTherapistApplicationNotification({\n      to: therapistEmail,\n      name: therapistName,\n      status: 'approved',\n      credentials,\n    });\n  }\n\n  /**\n   * Send rejection email to therapist applicants\n   * @param therapistEmail Therapist email address\n   * @param therapistName Therapist name\n   * @param reason Optional rejection reason\n   * @returns Promise with operation result\n   */\n  async sendTherapistRejectionEmail(\n    therapistEmail: string,\n    therapistName: string,\n    reason?: string,\n  ): Promise<{ success: boolean; message: string }> {\n    return this.sendTherapistApplicationNotification({\n      to: therapistEmail,\n      name: therapistName,\n      status: 'rejected',\n      adminNotes: reason,\n    });\n  }\n\n  /**\n   * Test email service configuration\n   * @returns Promise with test result\n   */\n  testConfiguration(): { success: boolean; message: string } {\n    try {\n      console.log('Testing email service configuration...');\n\n      // Test email generation\n      const testData: EmailNotificationData = {\n        to: 'test@example.com',\n        name: 'Test Therapist',\n        status: 'approved',\n        credentials: {\n          email: 'test@example.com',\n          password: 'temp123',\n        },\n      };\n\n      const content = this.generateEmailContent(testData);\n      console.log('Test email content generated successfully:', content);\n\n      return {\n        success: true,\n        message: 'Email service configuration test passed',\n      };\n    } catch (error) {\n      console.error('Email service test failed:', error);\n      return {\n        success: false,\n        message: error instanceof Error ? error.message : 'Test failed',\n      };\n    }\n  }\n\n  /**\n   * Public method for sending generic emails\n   */\n  async sendGenericEmail(emailData: {\n    to: string;\n    subject: string;\n    template: string;\n    data: any;\n  }): Promise<void> {\n    try {\n      console.log('Sending email:', {\n        to: emailData.to,\n        subject: emailData.subject,\n        template: emailData.template,\n      });\n\n      // For now, this is a placeholder implementation\n      // In production, integrate with actual email service like SendGrid, AWS SES, etc.\n      const emailContent = {\n        subject: emailData.subject,\n        template: emailData.template,\n        ...emailData.data,\n      };\n      const result = this.sendEmail(emailContent, emailData.to);\n\n      if (!result.success) {\n        throw new Error(result.error || 'Failed to send email');\n      }\n    } catch (error) {\n      console.error('Failed to send email:', error);\n      throw error;\n    }\n  }\n}\n"],"version":3}