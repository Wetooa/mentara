{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/services/compatibility-analysis.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/services/compatibility-analysis.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { Therapist, Client, PreAssessment } from '@prisma/client';\n\nexport interface PersonalityCompatibility {\n  communicationStyle: number;\n  personalityMatch: number;\n  culturalCompatibility: number;\n  overallCompatibility: number;\n}\n\nexport interface SessionCompatibility {\n  formatMatch: number; // online vs in-person\n  durationMatch: number;\n  frequencyMatch: number;\n  schedulingCompatibility: number;\n  overallCompatibility: number;\n}\n\nexport interface DemographicCompatibility {\n  ageCompatibility: number;\n  genderCompatibility: number;\n  languageCompatibility: number;\n  culturalCompatibility: number;\n  overallCompatibility: number;\n}\n\nexport interface CompatibilityAnalysis {\n  personalityCompatibility: PersonalityCompatibility;\n  sessionCompatibility: SessionCompatibility;\n  demographicCompatibility: DemographicCompatibility;\n  overallCompatibilityScore: number;\n  compatibilityFactors: {\n    strengths: string[];\n    concerns: string[];\n    recommendations: string[];\n  };\n}\n\n@Injectable()\nexport class CompatibilityAnalysisService {\n  async analyzeCompatibility(\n    client: Client & {\n      preAssessment: PreAssessment;\n      user: any;\n    },\n    therapist: Therapist & { user: any },\n  ): Promise<CompatibilityAnalysis> {\n    const clientPrefs = {}; // Client preferences removed - using empty object\n    const assessmentData = client.preAssessment;\n\n    // Analyze different compatibility dimensions\n    const personalityCompatibility = this.analyzePersonalityCompatibility(\n      assessmentData,\n      clientPrefs,\n      therapist,\n    );\n\n    const sessionCompatibility = this.analyzeSessionCompatibility(\n      clientPrefs,\n      therapist,\n    );\n\n    const demographicCompatibility = this.analyzeDemographicCompatibility(\n      client,\n      clientPrefs,\n      therapist,\n    );\n\n    // Calculate overall compatibility score\n    const overallCompatibilityScore = this.calculateOverallCompatibility(\n      personalityCompatibility,\n      sessionCompatibility,\n      demographicCompatibility,\n    );\n\n    // Generate compatibility factors and recommendations\n    const compatibilityFactors = this.generateCompatibilityFactors(\n      personalityCompatibility,\n      sessionCompatibility,\n      demographicCompatibility,\n      clientPrefs,\n      therapist,\n    );\n\n    return {\n      personalityCompatibility,\n      sessionCompatibility,\n      demographicCompatibility,\n      overallCompatibilityScore,\n      compatibilityFactors,\n    };\n  }\n\n  private analyzePersonalityCompatibility(\n    assessment: PreAssessment,\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): PersonalityCompatibility {\n    // Communication style analysis\n    const communicationStyle = this.analyzeCommunicationStyle(\n      assessment,\n      clientPrefs,\n      therapist,\n    );\n\n    // Personality matching based on assessment results\n    const personalityMatch = this.analyzePersonalityMatch(\n      assessment,\n      clientPrefs,\n      therapist,\n    );\n\n    // Cultural compatibility\n    const culturalCompatibility = this.analyzeCulturalCompatibility(\n      clientPrefs,\n      therapist,\n    );\n\n    const overallCompatibility = Math.round(\n      communicationStyle * 0.4 +\n        personalityMatch * 0.4 +\n        culturalCompatibility * 0.2,\n    );\n\n    return {\n      communicationStyle,\n      personalityMatch,\n      culturalCompatibility,\n      overallCompatibility,\n    };\n  }\n\n  private analyzeCommunicationStyle(\n    assessment: PreAssessment,\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    let score = 70; // Start with neutral score\n\n    // Access severityLevels from the answers JSON field\n    const answers = assessment.answers as any;\n    const severityLevels = answers?.severityLevels as Record<string, string>;\n\n    // Analyze based on mental health conditions and preferred communication style\n    const hasAnxiety =\n      severityLevels['anxiety'] &&\n      this.getSeverityWeight(severityLevels['anxiety']) >= 3;\n    const hasDepression =\n      severityLevels['depression'] &&\n      this.getSeverityWeight(severityLevels['depression']) >= 3;\n    const hasPTSD =\n      severityLevels['ptsd'] &&\n      this.getSeverityWeight(severityLevels['ptsd']) >= 3;\n\n    const preferredStyle =\n      clientPrefs.communicationStyle || clientPrefs.therapistStyle;\n    const therapistApproaches = therapist.approaches || [];\n\n    // Match communication preferences\n    if (preferredStyle) {\n      switch (preferredStyle) {\n        case 'direct':\n          if (\n            therapistApproaches.includes('Cognitive Behavioral Therapy (CBT)')\n          ) {\n            score += 20;\n          }\n          break;\n        case 'gentle':\n          if (\n            therapistApproaches.includes('Person-Centered Therapy') ||\n            therapistApproaches.includes('Humanistic Therapy')\n          ) {\n            score += 20;\n          }\n          break;\n        case 'structured':\n          if (\n            therapistApproaches.includes(\n              'Dialectical Behavior Therapy (DBT)',\n            ) ||\n            therapistApproaches.includes('Cognitive Behavioral Therapy (CBT)')\n          ) {\n            score += 20;\n          }\n          break;\n        case 'flexible':\n          if (\n            therapistApproaches.includes('Integrative Therapy') ||\n            therapistApproaches.includes('Eclectic Therapy')\n          ) {\n            score += 20;\n          }\n          break;\n      }\n    }\n\n    // Adjust based on specific conditions\n    if (\n      hasAnxiety &&\n      therapistApproaches.includes('Cognitive Behavioral Therapy (CBT)')\n    ) {\n      score += 10; // CBT is effective for anxiety\n    }\n\n    if (\n      hasPTSD &&\n      therapistApproaches.includes(\n        'Eye Movement Desensitization and Reprocessing (EMDR)',\n      )\n    ) {\n      score += 15; // EMDR is specialized for PTSD\n    }\n\n    if (\n      hasDepression &&\n      therapistApproaches.includes('Interpersonal Therapy (IPT)')\n    ) {\n      score += 10; // IPT is effective for depression\n    }\n\n    return Math.min(score, 100);\n  }\n\n  private analyzePersonalityMatch(\n    assessment: PreAssessment,\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    let score = 70; // Start with neutral score\n\n    // Access severityLevels from the answers JSON field\n    const answers = assessment.answers as any;\n    const severityLevels = answers?.severityLevels as Record<string, string>;\n\n    // Analyze introversion/extraversion needs\n    const socialAnxiety = severityLevels['social_anxiety']\n      ? this.getSeverityWeight(severityLevels['social_anxiety'])\n      : 0;\n\n    if (socialAnxiety >= 3) {\n      // Introverted clients may prefer calmer, more reserved therapists\n      const therapistPersonality = clientPrefs.therapistPersonality;\n      if (\n        therapistPersonality === 'calm' ||\n        therapistPersonality === 'reserved'\n      ) {\n        score += 15;\n      }\n    }\n\n    // Analyze need for structure vs flexibility\n    const hasOCD =\n      severityLevels['ocd'] &&\n      this.getSeverityWeight(severityLevels['ocd']) >= 3;\n    const hasADHD =\n      severityLevels['adhd'] &&\n      this.getSeverityWeight(severityLevels['adhd']) >= 3;\n\n    if (hasOCD) {\n      // OCD clients often benefit from structured approaches\n      const approaches = therapist.approaches || [];\n      if (\n        approaches.includes('Cognitive Behavioral Therapy (CBT)') ||\n        approaches.includes('Exposure and Response Prevention (ERP)')\n      ) {\n        score += 20;\n      }\n    }\n\n    if (hasADHD) {\n      // ADHD clients may benefit from more interactive approaches\n      const approaches = therapist.approaches || [];\n      if (\n        approaches.includes('Behavioral Therapy') ||\n        approaches.includes('Coaching')\n      ) {\n        score += 15;\n      }\n    }\n\n    // Match warmth preferences\n    const warmthPreference = clientPrefs.therapistWarmth;\n    if (\n      warmthPreference === 'high' &&\n      therapist.approaches?.includes('Person-Centered Therapy')\n    ) {\n      score += 15;\n    }\n\n    return Math.min(score, 100);\n  }\n\n  private analyzeCulturalCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    let score = 80; // Start with good cultural neutrality\n\n    // Language compatibility\n    const clientLanguages = clientPrefs.preferredLanguages || ['English'];\n    const therapistLanguages = therapist.languagesOffered || ['English'];\n\n    const hasLanguageMatch = clientLanguages.some((lang) =>\n      therapistLanguages.includes(lang),\n    );\n\n    if (!hasLanguageMatch) {\n      score -= 30; // Significant penalty for language barriers\n    } else if (\n      clientLanguages.length > 1 &&\n      clientLanguages.filter((lang) => therapistLanguages.includes(lang))\n        .length > 1\n    ) {\n      score += 10; // Bonus for multiple shared languages\n    }\n\n    // Cultural background considerations\n    const culturalPreference =\n      clientPrefs.culturalBackground || clientPrefs.therapistCulture;\n    if (culturalPreference && culturalPreference !== 'no_preference') {\n      // This would require additional therapist cultural background data\n      // For now, maintain neutral score unless specifically matched\n      score += 0;\n    }\n\n    // Religious/spiritual considerations\n    const spiritualPreference = clientPrefs.spiritualPreferences;\n    const therapistApproaches = therapist.approaches || [];\n\n    if (\n      spiritualPreference === 'important' &&\n      therapistApproaches.includes('Spiritual Therapy')\n    ) {\n      score += 15;\n    } else if (\n      spiritualPreference === 'avoid' &&\n      therapistApproaches.includes('Spiritual Therapy')\n    ) {\n      score -= 20;\n    }\n\n    return Math.max(score, 0);\n  }\n\n  private analyzeSessionCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): SessionCompatibility {\n    // Format matching (online vs in-person)\n    const formatMatch = this.analyzeFormatCompatibility(clientPrefs, therapist);\n\n    // Duration matching\n    const durationMatch = this.analyzeDurationCompatibility(\n      clientPrefs,\n      therapist,\n    );\n\n    // Frequency matching\n    const frequencyMatch = this.analyzeFrequencyCompatibility(\n      clientPrefs,\n      therapist,\n    );\n\n    // Scheduling compatibility (future enhancement)\n    const schedulingCompatibility = 80; // Placeholder - would integrate with availability system\n\n    const overallCompatibility = Math.round(\n      formatMatch * 0.3 +\n        durationMatch * 0.2 +\n        frequencyMatch * 0.2 +\n        schedulingCompatibility * 0.3,\n    );\n\n    return {\n      formatMatch,\n      durationMatch,\n      frequencyMatch,\n      schedulingCompatibility,\n      overallCompatibility,\n    };\n  }\n\n  private analyzeFormatCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    const clientFormat = clientPrefs.sessionFormat ||\n      clientPrefs.preferredFormat || ['online', 'in-person'];\n\n    let score = 70; // Neutral base\n\n    // Check if therapist supports client's preferred format\n    if (Array.isArray(clientFormat)) {\n      if (\n        clientFormat.includes('online') &&\n        therapist.providedOnlineTherapyBefore\n      ) {\n        score += 15;\n      }\n\n      if (clientFormat.includes('in-person')) {\n        score += 15; // Assume most therapists can do in-person\n      }\n\n      if (\n        clientFormat.includes('online') &&\n        !therapist.comfortableUsingVideoConferencing\n      ) {\n        score -= 25; // Penalty if therapist not comfortable with required format\n      }\n    }\n\n    return Math.min(score, 100);\n  }\n\n  private analyzeDurationCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    const clientDuration =\n      clientPrefs.sessionDuration || clientPrefs.preferredDuration;\n    const therapistDurations = therapist.preferredSessionLength || [50, 60];\n\n    if (!clientDuration) {\n      return 80; // Neutral score if no preference\n    }\n\n    const clientDurationNum = parseInt(clientDuration);\n    const hasMatch =\n      therapistDurations.includes(clientDurationNum) ||\n      therapistDurations.some((d) => Math.abs(d - clientDurationNum) <= 10);\n\n    return hasMatch ? 90 : 60;\n  }\n\n  private analyzeFrequencyCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    const clientFrequency = clientPrefs.sessionFrequency;\n\n    if (!clientFrequency) {\n      return 80; // Neutral if no preference\n    }\n\n    // Most therapists are flexible with frequency\n    // This could be enhanced with therapist availability data\n    return 85;\n  }\n\n  private analyzeDemographicCompatibility(\n    client: Client & { user: any },\n    clientPrefs: Record<string, any>,\n    therapist: Therapist & { user: any },\n  ): DemographicCompatibility {\n    const ageCompatibility = this.analyzeAgeCompatibility(\n      client,\n      clientPrefs,\n      therapist,\n    );\n    const genderCompatibility = this.analyzeGenderCompatibility(\n      clientPrefs,\n      therapist,\n    );\n    const languageCompatibility = this.analyzeLanguageCompatibility(\n      clientPrefs,\n      therapist,\n    );\n    const culturalCompatibility = this.analyzeCulturalCompatibility(\n      clientPrefs,\n      therapist,\n    );\n\n    const overallCompatibility = Math.round(\n      ageCompatibility * 0.2 +\n        genderCompatibility * 0.3 +\n        languageCompatibility * 0.3 +\n        culturalCompatibility * 0.2,\n    );\n\n    return {\n      ageCompatibility,\n      genderCompatibility,\n      languageCompatibility,\n      culturalCompatibility,\n      overallCompatibility,\n    };\n  }\n\n  private analyzeAgeCompatibility(\n    client: Client & { user: any },\n    clientPrefs: Record<string, any>,\n    therapist: Therapist & { user: any },\n  ): number {\n    const agePreference = clientPrefs.therapistAge || clientPrefs.agePreference;\n\n    if (!agePreference || agePreference === 'any') {\n      return 90; // No preference means high compatibility\n    }\n\n    // This would require therapist age data in the user model\n    // For now, return neutral score\n    return 75;\n  }\n\n  private analyzeGenderCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist & { user: any },\n  ): number {\n    const genderPreference =\n      clientPrefs.therapistGender || clientPrefs.genderPreference;\n\n    if (\n      !genderPreference ||\n      genderPreference === 'any' ||\n      genderPreference === 'no_preference'\n    ) {\n      return 90; // No preference means high compatibility\n    }\n\n    // This would require gender data in the user model\n    // For now, return neutral score unless specific matching is implemented\n    return 75;\n  }\n\n  private analyzeLanguageCompatibility(\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): number {\n    const clientLanguages = clientPrefs.preferredLanguages ||\n      clientPrefs.languages || ['English'];\n    const therapistLanguages = therapist.languagesOffered || ['English'];\n\n    const matchedLanguages = clientLanguages.filter((lang) =>\n      therapistLanguages.includes(lang),\n    );\n\n    if (matchedLanguages.length === 0) {\n      return 20; // Poor compatibility with no shared languages\n    }\n\n    const matchRatio = matchedLanguages.length / clientLanguages.length;\n    return Math.round(20 + matchRatio * 80); // Scale from 20-100\n  }\n\n  private calculateOverallCompatibility(\n    personality: PersonalityCompatibility,\n    session: SessionCompatibility,\n    demographic: DemographicCompatibility,\n  ): number {\n    return Math.round(\n      personality.overallCompatibility * 0.4 +\n        session.overallCompatibility * 0.3 +\n        demographic.overallCompatibility * 0.3,\n    );\n  }\n\n  private generateCompatibilityFactors(\n    personality: PersonalityCompatibility,\n    session: SessionCompatibility,\n    demographic: DemographicCompatibility,\n    clientPrefs: Record<string, any>,\n    therapist: Therapist,\n  ): { strengths: string[]; concerns: string[]; recommendations: string[] } {\n    const strengths: string[] = [];\n    const concerns: string[] = [];\n    const recommendations: string[] = [];\n\n    // Analyze strengths\n    if (personality.communicationStyle >= 80) {\n      strengths.push('Excellent communication style match');\n    }\n    if (personality.personalityMatch >= 80) {\n      strengths.push('Strong personality compatibility');\n    }\n    if (session.formatMatch >= 80) {\n      strengths.push('Session format preferences align well');\n    }\n    if (demographic.languageCompatibility >= 80) {\n      strengths.push('Shared language proficiency');\n    }\n\n    // Identify concerns\n    if (personality.communicationStyle < 60) {\n      concerns.push('Communication style may not be ideal match');\n    }\n    if (session.formatMatch < 60) {\n      concerns.push('Session format preferences may conflict');\n    }\n    if (demographic.languageCompatibility < 60) {\n      concerns.push('Language barriers may affect communication');\n    }\n\n    // Generate recommendations\n    if (personality.overallCompatibility < 70) {\n      recommendations.push(\n        'Consider discussing communication preferences in initial session',\n      );\n    }\n    if (session.overallCompatibility < 70) {\n      recommendations.push('Flexibility in session format may be beneficial');\n    }\n    if (demographic.overallCompatibility < 70) {\n      recommendations.push(\n        'Cultural sensitivity and accommodation may be important',\n      );\n    }\n\n    return { strengths, concerns, recommendations };\n  }\n\n\n  private getSeverityWeight(severity: string): number {\n    const severityWeights: Record<string, number> = {\n      Minimal: 1,\n      Mild: 2,\n      Moderate: 3,\n      'Moderately Severe': 4,\n      Severe: 5,\n      'Very Severe': 5,\n      Extreme: 5,\n      Low: 1,\n      High: 4,\n      Substantial: 4,\n      Subclinical: 1,\n      Clinical: 4,\n      Subthreshold: 2,\n      Positive: 4,\n      Negative: 0,\n      None: 0,\n    };\n\n    return severityWeights[severity] || 1;\n  }\n}\n"],"version":3}