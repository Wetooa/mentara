{"version":3,"names":["common_1","cov_2q5h5ubtdj","s","require","platform_express_1","throttler_1","jwt_auth_guard_1","current_user_id_decorator_1","public_decorator_1","types_1","therapist_auth_service_1","supabase_storage_service_1","TherapistAuthController","therapistAuthService","supabaseStorageService","constructor","f","register","applicationDataJson","fileTypes","files","registerData","b","BadRequestException","console","error","JSON","parse","requiredDocs","hasFiles","length","fileTypeMap","log","warn","uploadedDocTypes","Object","values","map","name","originalname","mimetype","missingDocs","filter","doc","includes","missingNames","docNames","prcLicense","nbiClearance","resumeCV","join","email","firstName","lastName","filesCount","fileTypeMapKeys","keys","result","registerTherapistWithDocuments","user","id","role","emailVerified","accessToken","token","refreshToken","expiresIn","message","therapistId","therapist","userId","uploadedFiles","NotFoundException","errorMessage","Error","String","InternalServerErrorException","getProfile","getTherapistProfile","exports","__decorate","Public","Throttle","default","limit","ttl","Post","HttpCode","HttpStatus","CREATED","UseInterceptors","FilesInterceptor","limits","fileSize","fileFilter","req","file","callback","ALLOWED_DOCUMENT_MIME_TYPES","__param","Body","UploadedFiles","Promise","_c","UseGuards","JwtAuthGuard","Get","CurrentUserId","Controller","TherapistAuthService","_a","_b","SupabaseStorageService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/controllers/therapist-auth.controller.ts"],"sourcesContent":["import {\n  Body,\n  Controller,\n  Get,\n  Post,\n  UseInterceptors,\n  UploadedFiles,\n  BadRequestException,\n  NotFoundException,\n  InternalServerErrorException,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n  Req,\n} from '@nestjs/common';\nimport { FilesInterceptor } from '@nestjs/platform-express';\nimport { Throttle } from '@nestjs/throttler';\nimport { JwtAuthGuard } from '../guards/jwt-auth.guard';\nimport { CurrentUserId } from '../decorators/current-user-id.decorator';\nimport { Public } from '../decorators/public.decorator';\nimport { ZodValidationPipe } from '../../common/pipes/zod-validation.pipe';\n// Import types from local auth types\nimport type {\n  RegisterTherapistDto,\n  LoginDto,\n} from '../types';\n\n// Import validation schemas from local validation\nimport {\n  LoginDtoSchema,\n} from '../validation';\n\n// Import constants from local auth constants\nimport {\n  ALLOWED_DOCUMENT_MIME_TYPES,\n} from '../types';\nimport { TherapistAuthService } from '../services/therapist-auth.service';\nimport { SupabaseStorageService } from '../../common/services/supabase-storage.service';\nimport { Request } from 'express';\n\n@Controller('auth/therapist')\nexport class TherapistAuthController {\n  constructor(\n    private readonly therapistAuthService: TherapistAuthService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n  ) {}\n\n  @Public()\n  @Throttle({ default: { limit: 3, ttl: 600000 } }) // 3 therapist registrations per 10 minutes\n  @Post('register')\n  @HttpCode(HttpStatus.CREATED)\n  @UseInterceptors(\n    FilesInterceptor('files', 10, {\n      limits: { fileSize: 10 * 1024 * 1024 }, // 10MB limit per file\n      fileFilter: (req, file, callback) => {\n        if (ALLOWED_DOCUMENT_MIME_TYPES.includes(file.mimetype as any)) {\n          callback(null, true);\n        } else {\n          callback(new BadRequestException('Invalid file type'), false);\n        }\n      },\n    }),\n  )\n  async register(\n    @Body('applicationDataJson') applicationDataJson: string,\n    @Body('fileTypes') fileTypes: string,\n    @UploadedFiles() files: Express.Multer.File[],\n  ): Promise<{\n    user: {\n      id: string;\n      email: string;\n      firstName: string;\n      lastName: string;\n      role: string;\n      emailVerified: boolean;\n    };\n    accessToken: string;\n    refreshToken: string;\n    expiresIn: number;\n    message: string;\n    therapistId?: string;\n    uploadedFiles?: Array<{ id: string; fileName: string; url: string }>;\n  }> {\n    try {\n      // Parse and validate application data from form\n      let registerData: RegisterTherapistDto;\n      try {\n        if (!applicationDataJson) {\n          throw new BadRequestException(\n            'Application data is missing. Please ensure the form is submitted correctly.',\n          );\n        }\n\n        if (typeof applicationDataJson !== 'string') {\n          console.error(\n            'Expected string but received:',\n            typeof applicationDataJson,\n            applicationDataJson,\n          );\n          throw new BadRequestException(\n            'Application data must be a JSON string.',\n          );\n        }\n\n        registerData = JSON.parse(applicationDataJson);\n      } catch (error) {\n        console.error('JSON parsing error:', error);\n        console.error('Raw applicationDataJson:', applicationDataJson);\n        throw new BadRequestException(\n          'Invalid application data format. Please check that all form fields are filled correctly.',\n        );\n      }\n\n      // Validate required documents are present\n      const requiredDocs = ['prcLicense', 'nbiClearance', 'resumeCV'];\n      const hasFiles = files && files.length > 0;\n\n      if (!hasFiles) {\n        throw new BadRequestException(\n          'Required documents must be uploaded: PRC License, NBI Clearance, Resume/CV',\n        );\n      }\n\n      // Parse file type mappings\n      let fileTypeMap: Record<string, string> = {};\n      if (fileTypes) {\n        try {\n          fileTypeMap = JSON.parse(fileTypes);\n          console.log('DEBUG: fileTypes received:', fileTypes);\n          console.log('DEBUG: parsed fileTypeMap:', fileTypeMap);\n        } catch {\n          console.warn('Invalid fileTypes JSON, proceeding without mapping');\n        }\n      }\n\n      // Validate that all required document types are present\n      const uploadedDocTypes = Object.values(fileTypeMap);\n      console.log(\n        'DEBUG: uploadedDocTypes from fileTypeMap:',\n        uploadedDocTypes,\n      );\n      console.log('DEBUG: requiredDocs expected:', requiredDocs);\n      console.log('DEBUG: files received count:', files?.length || 0);\n      console.log(\n        'DEBUG: files details:',\n        files?.map((f) => ({ name: f.originalname, mimetype: f.mimetype })),\n      );\n\n      const missingDocs = requiredDocs.filter(\n        (doc) => !uploadedDocTypes.includes(doc),\n      );\n      console.log('DEBUG: missingDocs calculated:', missingDocs);\n\n      if (missingDocs.length > 0) {\n        const missingNames = missingDocs\n          .map((doc) => {\n            const docNames = {\n              prcLicense: 'PRC License',\n              nbiClearance: 'NBI Clearance',\n              resumeCV: 'Resume/CV',\n            };\n            return docNames[doc as keyof typeof docNames];\n          })\n          .join(', ');\n\n        throw new BadRequestException(\n          `Missing required documents: ${missingNames}`,\n        );\n      }\n\n      // Create unified therapist registration with documents\n      console.log(\n        'DEBUG: About to call registerTherapistWithDocuments with data:',\n        {\n          email: registerData.email,\n          firstName: registerData.firstName,\n          lastName: registerData.lastName,\n          filesCount: files?.length || 0,\n          fileTypeMapKeys: Object.keys(fileTypeMap),\n        },\n      );\n\n      const result =\n        await this.therapistAuthService.registerTherapistWithDocuments(\n          registerData,\n          files || [],\n          fileTypeMap,\n        );\n\n      console.log(\n        'DEBUG: registerTherapistWithDocuments completed successfully',\n      );\n\n      return {\n        user: {\n          id: result.user.id,\n          email: result.user.email,\n          firstName: result.user.firstName,\n          lastName: result.user.lastName,\n          role: result.user.role,\n          emailVerified: result.user.emailVerified,\n        },\n        accessToken: result.token,\n        refreshToken: result.token, // Same token for compatibility\n        expiresIn: 0, // Non-expiring\n        message: result.message,\n        therapistId: result.therapist?.userId,\n        uploadedFiles: result.uploadedFiles,\n      };\n    } catch (error) {\n      console.error('Error registering therapist with documents:', error);\n\n      if (error instanceof BadRequestException) {\n        throw error;\n      }\n\n      if (error instanceof NotFoundException) {\n        throw error;\n      }\n\n      // Enhanced error handling with specific error types\n      const errorMessage =\n        error instanceof Error ? error.message : String(error);\n\n      // Enhanced error handling for user registration scenarios\n      if (errorMessage.includes('already have a therapist account')) {\n        throw new BadRequestException(\n          'You already have a therapist account with this email. Please sign in to your existing account instead.',\n        );\n      }\n\n      if (errorMessage.includes('email already exists')) {\n        throw new BadRequestException(\n          'An account with this email address already exists. Please use a different email or try logging in.',\n        );\n      }\n\n      if (errorMessage.includes('privileges. Please contact support')) {\n        throw new BadRequestException(errorMessage);\n      }\n\n      if (errorMessage.includes('file upload')) {\n        throw new BadRequestException(\n          'One or more files failed to upload. Please check file formats and sizes.',\n        );\n      }\n\n      if (errorMessage.includes('validation')) {\n        throw new BadRequestException(\n          'Registration data validation failed. Please check all required fields.',\n        );\n      }\n\n      throw new InternalServerErrorException(\n        'Failed to register therapist with documents. Please try again or contact support.',\n      );\n    }\n  }\n\n  // REMOVED: Duplicate login route - use universal /auth/login instead\n  // This was redundant with AuthController.login() which handles all roles\n\n  @UseGuards(JwtAuthGuard)\n  @Get('profile')\n  async getProfile(@CurrentUserId() userId: string) {\n    return this.therapistAuthService.getTherapistProfile(userId);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}