{"version":3,"names":["cov_2gz5alsydl","actualCoverage","common_1","s","require","config_1","axios_1","uuid_1","SupabaseStorageService","SupabaseStorageService_1","configService","logger","Logger","name","supabaseUrl","supabaseApiKey","constructor","f","b","get","Error","uploadFile","file","bucket","log","originalname","originalFilename","fileExtension","getFileExtension","uniqueFilename","v4","uploadToSupabase","buffer","mimetype","publicUrl","filename","url","error","message","uploadFiles","files","length","uploadPromises","map","results","Promise","all","deleteFile","response","default","delete","headers","Authorization","status","data","lastDotIndex","lastIndexOf","substring","path","fileBuffer","mimeType","post","debug","statusText","validateFile","maxSizeInBytes","allowedMimeTypes","size","isValid","Math","floor","includes","safeFilename","replace","getSupportedBuckets","USER_PROFILES","POST_ATTACHMENTS","MESSAGES","DOCUMENTS","WORKSHEETS","exports","__decorate","Injectable","ConfigService","_a","Object"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/services/supabase-storage.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport axios from 'axios';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport interface FileUploadResult {\n  filename: string;\n  url: string;\n  bucket: string;\n}\n\n@Injectable()\nexport class SupabaseStorageService {\n  private readonly logger = new Logger(SupabaseStorageService.name);\n  private readonly supabaseUrl: string;\n  private readonly supabaseApiKey: string;\n\n  constructor(private configService: ConfigService) {\n    this.supabaseUrl = this.configService.get<string>('SUPABASE_URL') || '';\n    this.supabaseApiKey =\n      this.configService.get<string>('SUPABASE_API_KEY') || '';\n\n    if (!this.supabaseUrl || !this.supabaseApiKey) {\n      throw new Error(\n        'Supabase configuration is missing. Please set SUPABASE_URL and SUPABASE_API_KEY environment variables.',\n      );\n    }\n  }\n\n  /**\n   * Upload a file to Supabase Storage\n   * @param file - The file to upload\n   * @param bucket - The storage bucket name\n   * @returns Promise<FileUploadResult> - Upload result with filename and URL\n   */\n  async uploadFile(\n    file: Express.Multer.File,\n    bucket: string,\n  ): Promise<FileUploadResult> {\n    this.logger.log(\n      `Uploading file to Supabase: ${file.originalname} (bucket: ${bucket})`,\n    );\n\n    try {\n      // Generate unique filename to avoid conflicts\n      const originalFilename = file.originalname;\n      const fileExtension = this.getFileExtension(originalFilename);\n      const uniqueFilename = `${uuidv4()}${fileExtension}`;\n\n      // Upload to Supabase\n      await this.uploadToSupabase(\n        bucket,\n        uniqueFilename,\n        file.buffer,\n        file.mimetype,\n      );\n\n      // Generate public URL\n      const publicUrl = `${this.supabaseUrl}/storage/v1/object/public/${bucket}/${uniqueFilename}`;\n\n      this.logger.log(\n        `File uploaded successfully to Supabase: ${uniqueFilename}`,\n      );\n\n      return {\n        filename: uniqueFilename,\n        url: publicUrl,\n        bucket,\n      };\n    } catch (error: any) {\n      this.logger.error(\n        `Error uploading file to Supabase: ${file.originalname}`,\n        error,\n      );\n      throw new Error(\n        `Failed to upload file to Supabase: ${error?.message || 'Unknown error'}`,\n      );\n    }\n  }\n\n  /**\n   * Upload multiple files to Supabase Storage\n   * @param files - Array of files to upload\n   * @param bucket - The storage bucket name\n   * @returns Promise<FileUploadResult[]> - Array of upload results\n   */\n  async uploadFiles(\n    files: Express.Multer.File[],\n    bucket: string,\n  ): Promise<FileUploadResult[]> {\n    if (!files || files.length === 0) {\n      return [];\n    }\n\n    this.logger.log(\n      `Uploading ${files.length} files to Supabase bucket: ${bucket}`,\n    );\n\n    try {\n      const uploadPromises = files.map((file) => this.uploadFile(file, bucket));\n      const results = await Promise.all(uploadPromises);\n\n      this.logger.log(\n        `Successfully uploaded ${results.length} files to Supabase`,\n      );\n      return results;\n    } catch (error: any) {\n      this.logger.error(`Error uploading multiple files to Supabase`, error);\n      throw new Error(\n        `Failed to upload files to Supabase: ${error?.message || 'Unknown error'}`,\n      );\n    }\n  }\n\n  /**\n   * Delete a file from Supabase Storage\n   * @param bucket - The storage bucket name\n   * @param filename - The filename to delete\n   */\n  async deleteFile(bucket: string, filename: string): Promise<void> {\n    this.logger.log(\n      `Deleting file from Supabase: ${filename} (bucket: ${bucket})`,\n    );\n\n    try {\n      const url = `${this.supabaseUrl}/storage/v1/object/${bucket}/${filename}`;\n\n      const response = await axios.delete(url, {\n        headers: {\n          Authorization: `Bearer ${this.supabaseApiKey}`,\n        },\n      });\n\n      if (response.status === 200) {\n        this.logger.log(`File deleted successfully from Supabase: ${filename}`);\n      } else {\n        this.logger.error(\n          `Failed to delete file from Supabase. Status: ${response.status}, Response: ${response.data}`,\n        );\n        throw new Error(\n          `Supabase delete failed with status: ${response.status}`,\n        );\n      }\n    } catch (error: any) {\n      this.logger.error(\n        `Error deleting file from Supabase: ${filename}`,\n        error,\n      );\n      throw new Error(\n        `Failed to delete file from Supabase: ${error?.message || 'Unknown error'}`,\n      );\n    }\n  }\n\n  /**\n   * Get file extension from filename\n   * @param filename - The original filename\n   * @returns string - The file extension including the dot\n   */\n  private getFileExtension(filename: string): string {\n    const lastDotIndex = filename.lastIndexOf('.');\n    return lastDotIndex === -1 ? '' : filename.substring(lastDotIndex);\n  }\n\n  /**\n   * Upload file content to Supabase Storage\n   * @param bucket - The storage bucket name\n   * @param path - The file path/name in the bucket\n   * @param fileBuffer - The file content as buffer\n   * @param mimeType - The MIME type of the file\n   */\n  private async uploadToSupabase(\n    bucket: string,\n    path: string,\n    fileBuffer: Buffer,\n    mimeType: string,\n  ): Promise<void> {\n    const url = `${this.supabaseUrl}/storage/v1/object/${bucket}/${path}`;\n\n    try {\n      const response = await axios.post(url, fileBuffer, {\n        headers: {\n          'Content-Type': mimeType,\n          Authorization: `Bearer ${this.supabaseApiKey}`,\n        },\n      });\n\n      if (response.status === 200 || response.status === 201) {\n        this.logger.debug(`File uploaded successfully to Supabase: ${path}`);\n      } else {\n        this.logger.error(\n          `Failed to upload file to Supabase. Status: ${response.status}, Response: ${response.data}`,\n        );\n        throw new Error(\n          `Supabase upload failed with status: ${response.status}`,\n        );\n      }\n    } catch (error: any) {\n      if (error?.response) {\n        this.logger.error(\n          `Supabase API error: ${error.response.status} - ${error.response.data}`,\n        );\n        throw new Error(\n          `Supabase upload failed: ${error.response.data?.message || error.response.statusText}`,\n        );\n      } else {\n        this.logger.error(\n          `Network error during Supabase upload: ${error.message}`,\n        );\n        throw new Error(`Failed to upload to Supabase: ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * Validate file for upload\n   * @param file - The file to validate\n   * @param maxSizeInBytes - Maximum file size allowed\n   * @param allowedMimeTypes - Array of allowed MIME types\n   */\n  validateFile(\n    file: Express.Multer.File,\n    maxSizeInBytes: number = 10 * 1024 * 1024, // 10MB default\n    allowedMimeTypes: string[] = [\n      'image/jpeg',\n      'image/png',\n      'image/gif',\n      'image/webp',\n      'application/pdf',\n      'text/plain',\n      'text/csv',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document', // .docx\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx\n      'application/vnd.openxmlformats-officedocument.presentationml.presentation', // .pptx\n      'application/msword', // .doc\n      'application/vnd.ms-excel', // .xls\n      'application/vnd.ms-powerpoint', // .ppt\n    ],\n  ): { isValid: boolean; error?: string } {\n    // File size validation\n    if (file.size > maxSizeInBytes) {\n      return {\n        isValid: false,\n        error: `File size exceeds ${Math.floor(maxSizeInBytes / (1024 * 1024))}MB limit`,\n      };\n    }\n\n    // MIME type validation\n    if (!allowedMimeTypes.includes(file.mimetype)) {\n      return {\n        isValid: false,\n        error: `File type ${file.mimetype} is not allowed`,\n      };\n    }\n\n    // Filename validation - prevent path traversal\n    const safeFilename = file.originalname.replace(/[^a-zA-Z0-9.-]/g, '_');\n    if (safeFilename !== file.originalname) {\n      return {\n        isValid: false,\n        error: 'Filename contains invalid characters',\n      };\n    }\n\n    return { isValid: true };\n  }\n\n  /**\n   * Get supported storage buckets\n   */\n  static getSupportedBuckets() {\n    return {\n      USER_PROFILES: 'user-profiles',\n      POST_ATTACHMENTS: 'post-attachments',\n      MESSAGES: 'messages',\n      DOCUMENTS: 'documents',\n      WORKSHEETS: 'worksheets',\n    } as const;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}