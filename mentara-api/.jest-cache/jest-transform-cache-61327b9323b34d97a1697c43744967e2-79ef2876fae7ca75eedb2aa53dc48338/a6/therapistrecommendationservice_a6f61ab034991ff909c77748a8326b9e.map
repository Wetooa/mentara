{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/therapist-recommendation.service.ts","mappings":"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","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/therapist/therapist-recommendation.service.ts"],"sourcesContent":["import {\n  Injectable,\n  NotFoundException,\n  InternalServerErrorException,\n} from '@nestjs/common';\nimport { PrismaService } from '../providers/prisma-client.provider';\nimport { PreAssessment } from '@prisma/client';\nimport {\n  TherapistRecommendationRequest,\n  TherapistRecommendationResponse,\n} from 'mentara-commons';\nimport {\n  AdvancedMatchingService,\n  TherapistScore,\n} from './services/advanced-matching.service';\nimport { CompatibilityAnalysisService } from './services/compatibility-analysis.service';\nimport { MatchingAnalyticsService } from './services/matching-analytics.service';\n\n@Injectable()\nexport class TherapistRecommendationService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly advancedMatching: AdvancedMatchingService,\n    private readonly compatibilityAnalysis: CompatibilityAnalysisService,\n    private readonly matchingAnalytics: MatchingAnalyticsService,\n  ) {}\n\n  private calculateYearsOfExperience(startDate: Date): number {\n    const now = new Date();\n    let years = now.getFullYear() - startDate.getFullYear();\n    if (\n      now.getMonth() < startDate.getMonth() ||\n      (now.getMonth() === startDate.getMonth() &&\n        now.getDate() < startDate.getDate())\n    ) {\n      years--;\n    }\n    return years;\n  }\n\n  async getRecommendedTherapists(\n    request: TherapistRecommendationRequest,\n  ): Promise<any> {\n    try {\n      // Get user's comprehensive data including preferences\n      const user = await this.prisma.client.findUnique({\n        where: { userId: request.userId },\n        include: {\n          preAssessment: true,\n          clientPreferences: true,\n          user: true,\n        },\n      });\n      if (!user) throw new NotFoundException('User not found');\n      if (!user.preAssessment)\n        throw new NotFoundException('No pre-assessment found for user');\n\n      // Extract user conditions and severity levels\n      const userConditions = this.extractUserConditions(user.preAssessment);\n      const severityLevels = user.preAssessment.severityLevels as Record<\n        string,\n        string\n      >;\n\n      // Fetch therapists with comprehensive data\n      const therapists = await this.prisma.therapist.findMany({\n        where: {\n          status: 'approved',\n          ...(request.province && { province: request.province }),\n          ...(request.maxHourlyRate && {\n            hourlyRate: { lte: request.maxHourlyRate },\n          }),\n        },\n        orderBy: { createdAt: 'desc' },\n        take: Math.min(request.limit ?? 10, 50), // Increase limit for better filtering\n        include: {\n          user: true,\n          reviews: {\n            where: { status: 'APPROVED' },\n            select: {\n              rating: true,\n              status: true,\n            },\n          },\n        },\n      });\n\n      // Use advanced matching algorithm\n      const therapistScores: TherapistScore[] = [];\n\n      for (const therapist of therapists) {\n        try {\n          const score = await this.advancedMatching.calculateAdvancedMatch(\n            user as any, // Safe because we verified preAssessment exists above\n            therapist,\n          );\n          therapistScores.push(score);\n        } catch (error) {\n          // Fallback to basic scoring if advanced matching fails\n          console.warn(\n            `Advanced matching failed for therapist ${therapist.userId}:`,\n            error,\n          );\n          const basicScore = this.calculateMatchScore(\n            therapist,\n            userConditions,\n          );\n          therapistScores.push({\n            therapist,\n            totalScore: basicScore,\n            breakdown: {\n              conditionScore: basicScore * 0.6,\n              approachScore: 0,\n              experienceScore: basicScore * 0.4,\n              reviewScore: 0,\n              logisticsScore: 0,\n            },\n            matchExplanation: {\n              primaryMatches: this.getPrimaryConditions(userConditions),\n              secondaryMatches: this.getSecondaryConditions(userConditions),\n              approachMatches: [],\n              experienceYears: this.calculateYearsOfExperience(\n                therapist.practiceStartDate,\n              ),\n              averageRating: 0,\n              totalReviews: 0,\n              successRates: {},\n            },\n          });\n        }\n      }\n\n      // Sort by total score descending\n      const sortedTherapistScores = therapistScores.sort(\n        (a, b) => b.totalScore - a.totalScore,\n      );\n\n      // Take only the requested number of results\n      const finalResults = sortedTherapistScores.slice(0, request.limit ?? 10);\n\n      // Track recommendation analytics\n      await this.matchingAnalytics.trackRecommendation(\n        request.userId,\n        finalResults,\n        'advanced_v1.0',\n      );\n\n      // Transform to expected format\n      const therapistsWithScores = finalResults.map((score) => ({\n        ...score.therapist,\n        matchScore: score.totalScore,\n        scoreBreakdown: score.breakdown,\n        matchExplanation: score.matchExplanation,\n      }));\n\n      // Determine primary and secondary conditions\n      const primaryConditions = this.getPrimaryConditions(userConditions);\n      const secondaryConditions = this.getSecondaryConditions(userConditions);\n\n      return {\n        totalCount: therapistsWithScores.length,\n        userConditions: Object.keys(userConditions),\n        therapists: therapistsWithScores,\n        matchCriteria: {\n          primaryConditions,\n          secondaryConditions,\n          severityLevels,\n        },\n        page: 1,\n        pageSize: request.limit ?? 10,\n      };\n    } catch (error) {\n      throw new InternalServerErrorException(\n        error instanceof Error\n          ? error.message\n          : 'Failed to get therapist recommendations',\n      );\n    }\n  }\n\n  /**\n   * Get detailed compatibility analysis between a client and therapist\n   */\n  async getCompatibilityAnalysis(clientId: string, therapistId: string) {\n    const client = await this.prisma.client.findUnique({\n      where: { userId: clientId },\n      include: {\n        preAssessment: true,\n        clientPreferences: true,\n        user: true,\n      },\n    });\n\n    const therapist = await this.prisma.therapist.findUnique({\n      where: { userId: therapistId },\n      include: {\n        user: true,\n        reviews: {\n          where: { status: 'APPROVED' },\n        },\n      },\n    });\n\n    if (!client || !therapist) {\n      throw new NotFoundException('Client or therapist not found');\n    }\n\n    if (!client.preAssessment) {\n      throw new NotFoundException('No pre-assessment found for client');\n    }\n\n    const compatibility = await this.compatibilityAnalysis.analyzeCompatibility(\n      client as any, // Safe because we verified preAssessment exists above\n      therapist,\n    );\n\n    // Track compatibility analysis\n    await this.matchingAnalytics.trackCompatibilityAnalysis(\n      clientId,\n      therapistId,\n      compatibility,\n      '1.0',\n    );\n\n    return compatibility;\n  }\n\n  private extractUserConditions(\n    preAssessment: PreAssessment,\n  ): Record<string, string> {\n    const conditions: Record<string, string> = {};\n    const severityLevels = preAssessment.severityLevels as Record<\n      string,\n      string\n    >;\n    const questionnaires = preAssessment.questionnaires as string[];\n    questionnaires.forEach((q) => {\n      if (severityLevels[q]) {\n        conditions[q] = severityLevels[q];\n      }\n    });\n    return conditions;\n  }\n\n  private calculateMatchScore(\n    therapist: any,\n    userConditions: Record<string, string>,\n  ): number {\n    let score = 0;\n    const expertise = (therapist.expertise as string[]) || [];\n    Object.keys(userConditions).forEach((condition) => {\n      if (expertise.includes(condition)) score += 20;\n    });\n    score += Math.min(\n      this.calculateYearsOfExperience(therapist.practiceStartDate) * 2,\n      20,\n    );\n    // Add base score for experience\n    score += therapist.yearsOfExperience ? therapist.yearsOfExperience * 2 : 0;\n    return score;\n  }\n\n  private getPrimaryConditions(\n    userConditions: Record<string, string>,\n  ): string[] {\n    return Object.entries(userConditions)\n      .filter(([, severity]) => this.getSeverityWeight(severity) >= 4)\n      .map(([condition]) => condition);\n  }\n\n  private getSecondaryConditions(\n    userConditions: Record<string, string>,\n  ): string[] {\n    return Object.entries(userConditions)\n      .filter(([, severity]) => {\n        const weight = this.getSeverityWeight(severity);\n        return weight >= 2 && weight < 4;\n      })\n      .map(([condition]) => condition);\n  }\n\n  private getSeverityWeight(severity: string): number {\n    const severityWeights: Record<string, number> = {\n      Minimal: 1,\n      Mild: 2,\n      Moderate: 3,\n      'Moderately Severe': 4,\n      Severe: 5,\n      'Very Severe': 5,\n      Extreme: 5,\n      Low: 1,\n      High: 4,\n      Substantial: 4,\n      Subclinical: 1,\n      Clinical: 4,\n      None: 0,\n      Subthreshold: 2,\n      Positive: 4,\n      Negative: 0,\n    };\n    return severityWeights[severity] || 1;\n  }\n}\n"],"version":3}