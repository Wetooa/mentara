{"version":3,"names":["cov_2qf8pevsp8","actualCoverage","common_1","s","require","prisma_client_provider_1","token_service_1","email_verification_service_1","email_service_1","supabase_storage_service_1","therapist_application_service_1","bcrypt","TherapistAuthService","prisma","tokenService","emailVerificationService","emailService","supabaseStorageService","therapistApplicationService","constructor","f","registerTherapist","email","password","firstName","lastName","existingUser","user","findUnique","where","b","BadRequestException","hashedPassword","hash","result","$transaction","tx","create","data","role","emailVerified","therapist","userId","id","status","mobile","province","providerType","professionalLicenseType","isPRCLicensed","prcLicenseNumber","expirationDateOfLicense","Date","practiceStartDate","sessionLength","hourlyRate","providedOnlineTherapyBefore","comfortableUsingVideoConferencing","compliesWithDataPrivacyAct","willingToAbideByPlatformGuidelines","treatmentSuccessRates","tokens","generateTokenPair","sendVerificationEmail","message","loginTherapist","ipAddress","userAgent","findFirst","include","UnauthorizedException","lockoutUntil","isPasswordValid","compare","handleFailedLogin","update","failedLoginCount","lastLoginAt","getTherapistProfile","assignedClients","client","select","avatarUrl","createApplicationWithDocuments","applicationData","files","fileTypeMap","getAllApplications","params","getApplicationById","updateApplicationStatus","updateData","getApplicationFiles","applicationId","newFailedCount","maxAttempts","lockoutDuration","now","exports","__decorate","Injectable","PrismaService","_a","Object","_b","TokenService","_c","EmailVerificationService","_d","EmailService","_e","SupabaseStorageService","_f","TherapistApplicationService"],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/auth/services/therapist-auth.service.ts"],"sourcesContent":["import {\n  Injectable,\n  UnauthorizedException,\n  BadRequestException,\n  NotFoundException,\n} from '@nestjs/common';\nimport { PrismaService } from '../../providers/prisma-client.provider';\nimport { TokenService } from './token.service';\nimport { EmailVerificationService } from './email-verification.service';\nimport { EmailService } from '../../services/email.service';\nimport { SupabaseStorageService } from '../../common/services/supabase-storage.service';\nimport { TherapistApplicationService } from '../../therapist/therapist-application.service';\nimport { type TherapistApplicationCreateDto } from 'mentara-commons';\nimport {\n  TherapistApplicationResponse,\n  ApplicationStatusUpdateDto,\n} from '../../therapist/interfaces/therapist-application.interfaces';\nimport * as bcrypt from 'bcrypt';\n\n@Injectable()\nexport class TherapistAuthService {\n  constructor(\n    private readonly prisma: PrismaService,\n    private readonly tokenService: TokenService,\n    private readonly emailVerificationService: EmailVerificationService,\n    private readonly emailService: EmailService,\n    private readonly supabaseStorageService: SupabaseStorageService,\n    private readonly therapistApplicationService: TherapistApplicationService,\n  ) {}\n\n  async registerTherapist(\n    email: string,\n    password: string,\n    firstName: string,\n    lastName: string,\n  ) {\n    // Check if user already exists\n    const existingUser = await this.prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (existingUser) {\n      throw new BadRequestException('User with this email already exists');\n    }\n\n    // Hash password\n    const hashedPassword = await bcrypt.hash(password, 12);\n\n    // Create user and therapist profile in transaction\n    const result = await this.prisma.$transaction(async (tx) => {\n      const user = await tx.user.create({\n        data: {\n          email,\n          password: hashedPassword,\n          firstName,\n          lastName,\n          role: 'therapist',\n          emailVerified: false,\n        },\n      });\n\n      const therapist = await tx.therapist.create({\n        data: {\n          userId: user.id,\n          status: 'pending',\n          mobile: '',\n          province: '',\n          providerType: '',\n          professionalLicenseType: '',\n          isPRCLicensed: '',\n          prcLicenseNumber: '',\n          expirationDateOfLicense: new Date(),\n          practiceStartDate: new Date(),\n          sessionLength: '60 minutes', // Default\n          hourlyRate: 0,\n          providedOnlineTherapyBefore: false,\n          comfortableUsingVideoConferencing: false,\n          compliesWithDataPrivacyAct: false,\n          willingToAbideByPlatformGuidelines: false,\n          treatmentSuccessRates: {},\n        },\n      });\n\n      return { user, therapist };\n    });\n\n    // Generate tokens\n    const tokens = await this.tokenService.generateTokenPair(\n      result.user.id,\n      result.user.email,\n      result.user.role,\n    );\n\n    // Send verification email\n    await this.emailVerificationService.sendVerificationEmail(result.user.id);\n\n    return {\n      user: result.user,\n      tokens,\n      message:\n        'Therapist registration successful. Please complete your application and submit required documents.',\n    };\n  }\n\n  async loginTherapist(\n    email: string,\n    password: string,\n    ipAddress?: string,\n    userAgent?: string,\n  ) {\n    // Find user with therapist role\n    const user = await this.prisma.user.findFirst({\n      where: {\n        email,\n        role: 'therapist',\n      },\n      include: {\n        therapist: true,\n      },\n    });\n\n    if (!user) {\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Check if account is locked\n    if (user.lockoutUntil && user.lockoutUntil > new Date()) {\n      throw new UnauthorizedException(\n        'Account is temporarily locked due to failed login attempts',\n      );\n    }\n\n    // Verify password\n    if (!user.password) {\n      throw new UnauthorizedException('Account setup incomplete');\n    }\n    const isPasswordValid = await bcrypt.compare(password, user.password);\n    if (!isPasswordValid) {\n      // Increment failed login count\n      await this.handleFailedLogin(user.id);\n      throw new UnauthorizedException('Invalid credentials');\n    }\n\n    // Reset failed login count and update last login\n    await this.prisma.user.update({\n      where: { id: user.id },\n      data: {\n        failedLoginCount: 0,\n        lockoutUntil: null,\n        lastLoginAt: new Date(),\n      },\n    });\n\n    // Generate tokens\n    const tokens = await this.tokenService.generateTokenPair(\n      user.id,\n      user.email,\n      user.role,\n      ipAddress,\n      userAgent,\n    );\n\n    return {\n      user,\n      tokens,\n    };\n  }\n\n  async getTherapistProfile(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      include: {\n        therapist: {\n          include: {\n            assignedClients: {\n              include: {\n                client: {\n                  include: {\n                    user: {\n                      select: {\n                        id: true,\n                        firstName: true,\n                        lastName: true,\n                        email: true,\n                        avatarUrl: true,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n      },\n    });\n\n    if (!user || user.role !== 'therapist') {\n      throw new UnauthorizedException('Therapist not found');\n    }\n\n    return user;\n  }\n\n  // Application management methods (delegated to TherapistApplicationService)\n  async createApplicationWithDocuments(\n    applicationData: TherapistApplicationCreateDto,\n    files: Express.Multer.File[],\n    fileTypeMap: Record<string, string>,\n  ) {\n    return this.therapistApplicationService.createApplicationWithDocuments(\n      applicationData,\n      files,\n      fileTypeMap,\n    );\n  }\n\n  async getAllApplications(params: {\n    status?: string;\n    page: number;\n    limit: number;\n  }): Promise<{\n    applications: TherapistApplicationResponse[];\n    totalCount: number;\n    page: number;\n    totalPages: number;\n  }> {\n    return this.therapistApplicationService.getAllApplications(params);\n  }\n\n  async getApplicationById(\n    id: string,\n  ): Promise<TherapistApplicationResponse | null> {\n    return this.therapistApplicationService.getApplicationById(id);\n  }\n\n  async updateApplicationStatus(\n    id: string,\n    updateData: ApplicationStatusUpdateDto,\n  ): Promise<{\n    success: boolean;\n    message: string;\n    credentials?: { email: string; password: string };\n  }> {\n    return this.therapistApplicationService.updateApplicationStatus(\n      id,\n      updateData,\n    );\n  }\n\n  async getApplicationFiles(applicationId: string): Promise<\n    Array<{\n      id: string;\n      fileName: string;\n      fileUrl: string;\n      uploadedAt: string;\n    }>\n  > {\n    return this.therapistApplicationService.getApplicationFiles(applicationId);\n  }\n\n  private async handleFailedLogin(userId: string) {\n    const user = await this.prisma.user.findUnique({\n      where: { id: userId },\n      select: { failedLoginCount: true },\n    });\n\n    const newFailedCount = (user?.failedLoginCount || 0) + 1;\n    const maxAttempts = 5;\n    const lockoutDuration = 30 * 60 * 1000; // 30 minutes\n\n    const updateData: any = {\n      failedLoginCount: newFailedCount,\n    };\n\n    if (newFailedCount >= maxAttempts) {\n      updateData.lockoutUntil = new Date(Date.now() + lockoutDuration);\n    }\n\n    await this.prisma.user.update({\n      where: { id: userId },\n      data: updateData,\n    });\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAOA;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","ignoreList":[]}