{"file":"/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/filters/http-exception.filter.ts","mappings":";;;;;;;;;;AAAA,2CAOwB;AAExB,8DAAsE;AAG/D,IAAM,mBAAmB,2BAAzB,MAAM,mBAAmB;IACb,MAAM,GAAG,IAAI,eAAM,CAAC,qBAAmB,CAAC,IAAI,CAAC,CAAC;IAE/D,KAAK,CAAC,SAAkB,EAAE,IAAmB;QAC3C,MAAM,GAAG,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAChC,MAAM,QAAQ,GAAG,GAAG,CAAC,WAAW,EAAY,CAAC;QAC7C,MAAM,OAAO,GAAG,GAAG,CAAC,UAAU,EAAW,CAAC;QAE1C,IAAI,MAAM,GAAG,mBAAU,CAAC,qBAAqB,CAAC;QAC9C,IAAI,OAAO,GAAG,uBAAuB,CAAC;QACtC,IAAI,MAAM,GAAa,EAAE,CAAC;QAE1B,IAAI,SAAS,YAAY,sBAAa,EAAE,CAAC;YACvC,MAAM,GAAG,SAAS,CAAC,SAAS,EAAE,CAAC;YAC/B,MAAM,iBAAiB,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;YAElD,IAAI,OAAO,iBAAiB,KAAK,QAAQ,EAAE,CAAC;gBAC1C,OAAO,GAAG,iBAAiB,CAAC;YAC9B,CAAC;iBAAM,IAAI,OAAO,iBAAiB,KAAK,QAAQ,EAAE,CAAC;gBACjD,MAAM,QAAQ,GAAG,iBAAwB,CAAC;gBAC1C,OAAO,GAAG,QAAQ,CAAC,OAAO,IAAI,OAAO,CAAC;gBACtC,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC;oBACtC,CAAC,CAAC,QAAQ,CAAC,OAAO;oBAClB,CAAC,CAAC,QAAQ,CAAC,KAAK;wBACd,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC;wBAClB,CAAC,CAAC,EAAE,CAAC;YACX,CAAC;QACH,CAAC;aAAM,IAAI,SAAS,YAAY,KAAK,EAAE,CAAC;YACtC,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC;YAC5B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACrC,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,QAAQ,MAAM,YAAY,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,GAAG,KAAK,OAAO,EAAE,CACtE,CAAC;QAEF,MAAM,aAAa,GAAG,iCAAc,CAAC,KAAK,CACxC,OAAO,EACP,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,iCAAc,CAAC,4BAA4B,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,EACnF,MAAM,EACN,OAAO,CAAC,GAAG,CACZ,CAAC;QAEF,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC9C,CAAC;CACF,CAAA;AA7CY,kDAAmB;8BAAnB,mBAAmB;IAD/B,IAAA,cAAK,GAAE;GACK,mBAAmB,CA6C/B","names":[],"sources":["/home/wetooa/Documents/code/projects/mentara/mentara-api/src/common/filters/http-exception.filter.ts"],"sourcesContent":["import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n  Logger,\n} from '@nestjs/common';\nimport { Request, Response } from 'express';\nimport { ApiResponseDto, ErrorDetail } from '../dto/api-response.dto';\n\n@Catch()\nexport class HttpExceptionFilter implements ExceptionFilter {\n  private readonly logger = new Logger(HttpExceptionFilter.name);\n\n  catch(exception: unknown, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n    const request = ctx.getRequest<Request>();\n\n    let status = HttpStatus.INTERNAL_SERVER_ERROR;\n    let message = 'Internal server error';\n    let errors: string[] = [];\n\n    if (exception instanceof HttpException) {\n      status = exception.getStatus();\n      const exceptionResponse = exception.getResponse();\n\n      if (typeof exceptionResponse === 'string') {\n        message = exceptionResponse;\n      } else if (typeof exceptionResponse === 'object') {\n        const errorObj = exceptionResponse as any;\n        message = errorObj.message || message;\n        errors = Array.isArray(errorObj.message)\n          ? errorObj.message\n          : errorObj.error\n            ? [errorObj.error]\n            : [];\n      }\n    } else if (exception instanceof Error) {\n      message = exception.message;\n      this.logger.error(exception.stack);\n    }\n\n    this.logger.error(\n      `HTTP ${status} Error - ${request.method} ${request.url}: ${message}`,\n    );\n\n    const errorResponse = ApiResponseDto.error(\n      message,\n      errors.length > 0 ? ApiResponseDto.convertStringErrorsToDetails(errors) : undefined,\n      status,\n      request.url,\n    );\n\n    response.status(status).json(errorResponse);\n  }\n}\n"],"version":3}